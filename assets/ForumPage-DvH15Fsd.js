import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{m as F}from"./useFiles-DgHx6Fcc.js";import{o as p,p as N,q as j}from"./VerificationSubmission-BDh1zA9f.js";import"./StringUtils-NPb0VexC.js";import{p as M,S as w}from"./SynapseConstants-DGyiOG2g.js";import{r as i}from"./index-BdUAYS9h.js";import"./OrientationBanner-Dg3sFsFB.js";import{u as L,a as R}from"./useForum-CSqqOjgi.js";import{a as A}from"./useSubscription-C9pwALTZ.js";import{C as O}from"./ConfirmationDialog-BIJeoBvt.js";import{d as V}from"./ToastMessage-Dk3j3n_C.js";import{I as U}from"./InfiniteTableLayout-B7ExHROl.js";import{u as k,g as P,S as z,c as B}from"./StyledTanStackTable-BWiMZl3M.js";import{d as q}from"./dayjs.min-CdID1Wrq.js";import{i as H}from"./_baseUniq-CFJWH6fy.js";import{I as G}from"./IconSvg--EOIxLkr.js";import{C as l}from"./ColumnHeader-Bfi7lg7A.js";import{U as Y,a as X}from"./UserBadge-B87k6uzs.js";import{L as W}from"./Link-HYpi97nk.js";import{F as J}from"./ForumThreadEditor-BBrX7MK_.js";import{S as K}from"./SubscribersModal-BbFoNRa6.js";import{B as E}from"./Button-DC_qvPIS.js";import{T as Q}from"./Typography-DtWAgXAy.js";const d=B();function Z(r){return[d.accessor("title",{header:e=>t.jsx(l,{...e,title:"Topic"}),cell:({row:e})=>t.jsxs(W,{onClick:()=>r(e.original.id),children:[e.original.isPinned?t.jsx(G,{icon:"pushpin"}):t.jsx(t.Fragment,{}),e.original.title]}),enableSorting:!0,size:250}),d.accessor("createdBy",{header:e=>t.jsx(l,{...e,title:"Author"}),cell:({getValue:e})=>t.jsx(Y,{userId:e()}),enableSorting:!1,size:60}),d.accessor("activeAuthors",{header:e=>t.jsx(l,{...e,title:"Active Users"}),cell:({getValue:e})=>e().map(n=>t.jsx("div",{className:"avatarContainer",children:t.jsx(X,{showCardOnHover:!0,className:"ActiveUsers",size:M,avatarSize:"MEDIUM",ownerId:n})},n)),enableSorting:!1}),d.accessor("numberOfReplies",{header:e=>t.jsx(l,{...e,title:"Replies"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("numberOfViews",{header:e=>t.jsx(l,{...e,title:"Views"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("lastActivity",{header:e=>t.jsx(l,{...e,title:"Activity"}),cell:({getValue:e})=>q(e()).format("L"),enableSorting:!0,size:30})]}function T({forumId:r,limit:e,filter:n,onClickLink:f}){var s;const[a,b]=i.useState([{desc:!0,id:"lastActivity"}]),c=i.useMemo(()=>{if(!H(a)){if(a[0].id=="lastActivity")return p.PINNED_AND_LAST_ACTIVITY;if(a[0].id=="numberOfReplies")return p.NUMBER_OF_REPLIES;if(a[0].id=="title")return p.THREAD_TITLE;if(a[0].id=="numberOfViews")return p.NUMBER_OF_VIEWS}return p.PINNED_AND_LAST_ACTIVITY},[a]),{data:o,isLoading:h,hasNextPage:_,fetchNextPage:x,isFetchingNextPage:g}=L(r,e,c,!((s=a[0])!=null&&s.desc),n),y=i.useMemo(()=>(o==null?void 0:o.pages.flatMap(m=>m.results))??[],[o]),C=i.useMemo(()=>Z(f),[f]),S=k({data:y,columns:C,state:{sorting:a},onSortingChange:b,getRowId:m=>m.id,getCoreRowModel:P(),columnResizeMode:"onChange",manualSorting:!0,enableMultiSort:!1,enableFilters:!1}),u=!h&&S.getRowModel().rows.length===0;return t.jsx("div",{className:"ForumTable",children:t.jsx(U,{table:t.jsx(z,{table:S,styledTableContainerProps:{sx:{my:2,maxHeight:"250px"}}}),isLoading:h,isEmpty:u,hasNextPage:_,onFetchNextPageClicked:()=>{x()},isFetchingNextPage:g})})}try{T.displayName="ForumTable",T.__docgenInfo={description:"",displayName:"ForumTable",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"enum",value:[{value:'"NO_FILTER"'},{value:'"DELETED_ONLY"'},{value:'"EXCLUDE_DELETED"'}]}}}}}catch{}const $="You will need to sign in for access to that resource";function I({forumId:r,limit:e,onClickLink:n}){const[f,a]=i.useState(!1),[b,c]=i.useState(!1),[o,h]=i.useState(!1),[_,x]=i.useState(!1),{subscription:g,isLoading:y,toggleSubscribed:C}=A(r,N.FORUM);function S(){try{C()}catch(D){V(D.reason,"danger")}}const{data:u}=R(r),{data:s}=F(),m=u==null?void 0:u.includes((s==null?void 0:s.ownerId)??""),v=()=>{(s==null?void 0:s.userName)=="anonymous"?c(!0):a(!0)};return t.jsxs("div",{className:"ForumTable",children:[t.jsxs("div",{className:"ForumTable__top-level-control",children:[t.jsx(K,{id:r,objectType:N.FORUM,showModal:_,handleModal:x}),t.jsx(E,{variant:g?"outlined":"contained",color:"primary",onClick:()=>S(),disabled:y,children:g?"Unfollow":"Follow"}),t.jsx(E,{variant:"contained",color:"primary",onClick:()=>v(),children:"New Thread"}),m&&t.jsx(E,{variant:"contained",color:"primary",onClick:()=>h(!o),children:o?"Hide Deleted Threads":"Show Deleted Threads"})]}),o&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{variant:"h4",children:"Deleted Threads"}),t.jsx(T,{onClickLink:n,forumId:r,limit:e,filter:j.DELETED_ONLY})]}),t.jsx(T,{onClickLink:n,forumId:r,limit:e,filter:j.EXCLUDE_DELETED}),t.jsx(J,{isReply:!1,id:r,onClose:()=>a(!1),isDialog:!0,openDialog:f}),t.jsx(O,{open:b,title:"Sign In Required",content:$,onCancel:()=>c(!1),hasCancelButton:!1,onConfirm:()=>c(!1),confirmButtonProps:{children:"Sign In",className:w}})]})}try{I.displayName="ForumPage",I.__docgenInfo={description:"",displayName:"ForumPage",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}}}}}catch{}export{I as F};
