import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{l as O,S as he}from"./useFiles-Ef0oneNy.js";import"./VerificationSubmission-OWkqLMYZ.js";import"./StringUtils-BYEtqtR3.js";import"./OrientationBanner-DqcE34N4.js";import{r as n}from"./index-C0YALZQz.js";import{u as Y}from"./QueryClientProvider-P2ZJzewi.js";import{u as J}from"./useMutation-2tBDrWOY.js";import{u as Ae}from"./useInfiniteQuery-CeHQ3b9j.js";import{f as oe}from"./DateFormatter-DZJs5cxU.js";import{u as be,d as Me,S as Oe,e as Re}from"./StyledTanStackTable-DkQd-XIu.js";import{d as ne}from"./dayjs.min-D6d06RXv.js";import{C as De}from"./CopyToClipboardInput-B4sgx_WX.js";import{D as se}from"./DialogBase-D-Q0Xjr7.js";import{W as fe}from"./WarningDialog-DUTI-VE7.js";import{C as y}from"./ColumnHeader-B3PgUqg5.js";import{d as M}from"./ToastMessage-DVZU4JBa.js";import{u as Te}from"./useDebouncedEffect-DS_Lau7X.js";import{D as ae}from"./DeleteTwoTone-D0jx7_dJ.js";import{C as ke}from"./ConfirmationDialog-DbK1bKYl.js";import{S as Ne}from"./LoadingScreen-CadQ7IKA.js";import{T as S}from"./TextField-0iGLDRwl.js";import{I as qe}from"./InputAdornment-BE6CGhaa.js";import{I as Ee}from"./IconButton-BV4SsEJa.js";import{B as v}from"./Button-CKtQREg-.js";import{T as F}from"./Typography-Dkw7b_5d.js";import{G as d}from"./GridLegacy-D08-N8DN.js";import{M as le}from"./MenuItem-B_4n9weI.js";import{B as ge}from"./Box-ChNzIem_.js";import{A as Pe}from"./Alert-Bb7a67Ce.js";import{A as Ue}from"./IconSvg-3ecnZ-ah.js";import{L as Ve}from"./Link-CUpi234w.js";import"./SynapseConstants-BB0gB5B7.js";import"./fetchWithExponentialTimeout-CXmnpl-T.js";import"./useTimeout-CAkteiZD.js";import"./FullWidthAlert-rW1wVqb8.js";import"./spreadSx-CwcO6WA9.js";import"./Stack-CKeJ5axq.js";import"./DefaultPropsProvider-BaeKOKQ6.js";import"./createTheme-C9Yd5-wm.js";import"./extendSxProp-Bm1yDns3.js";import"./getThemeProps-DNL-t9j-.js";import"./useTheme-BMHAz49G.js";import"./AlertTitle-CvlcKp51.js";import"./useForkRef-BIB30eql.js";import"./useSlot-dvUBOlYM.js";import"./useTheme-7IS2TKwD.js";import"./ClickAwayListener-CSXPHlBT.js";import"./getReactElementRef-CDLdFmX1.js";import"./index-HfouNIaw.js";import"./iframe-C4ix3hWR.js";import"./index-BAarkWvg.js";import"./ownerDocument-DW-IO8s5.js";import"./Paper-DcnJEfW5.js";import"./Grow-CvjOcJ_V.js";import"./Tooltip-BMzFZUM0.js";import"./index-Ck0HNX7_.js";import"./useControlled-CsPICl5Q.js";import"./Popper-ySgvMYOx.js";import"./isFocusVisible-B8k4qzLc.js";import"./useQuery-CiMHuQSW.js";import"./Collapse-BUARP0av.js";import"./_baseUniq-DoCrQ_-f.js";import"./_Uint8Array-sWmVj1m7.js";import"./isArray-ytjrkkJI.js";import"./_getTag-CFeNUIWp.js";import"./isEqual-CYc3xBpk.js";import"./merge-Czk3qD9O.js";import"./_initCloneObject-bRjdrz6V.js";import"./identity-DKeuBCMA.js";import"./createSvgIcon-Dvlo-p3N.js";import"./tinycolor-Begke6kS.js";import"./Fade-CWId73Dt.js";import"./inputBaseClasses-rBiWWOSB.js";import"./calculateFriendlyFileSize-Daa-sKbB.js";import"./CheckCircleTwoTone-CZzNVvfI.js";import"./InfoTwoTone-BJRcyr42.js";import"./index-D96GLD0m.js";import"./createSimplePaletteValueFilter-Dhw4lf7H.js";import"./chunk-AYJ5UCUI-C8yCxPut.js";import"./cloneDeep-D50FkvFh.js";import"./Skeleton-C3PZrg9q.js";import"./index-DZPFWSyF.js";import"./react-C3CXrV37.js";import"./localizedFormat-EtNUFyBN.js";import"./utc-DmsDvH3u.js";import"./StyledTableContainer-BB2lNDMT.js";import"./ExpandCollapseButton-C90l1aRs.js";import"./index-CkFZtW_O.js";import"./index-C8d1xODX.js";import"./const-BP60AzNb.js";import"./ContentCopy-BFdUwRs6.js";import"./Close-Dh5dlm21.js";import"./HelpPopover-HPYE4Dss.js";import"./MarkdownPopover-WOZpa-w5.js";import"./LightTooltip-CN9_Q60b.js";import"./MarkdownSynapse-10ReFeN4.js";import"./SkeletonButton-c_RblRuN.js";import"./SkeletonInlineBlock-BVTAIM4j.js";import"./SkeletonTable-DyurC3hR.js";import"./times-Ba0qCTK-.js";import"./toInteger-CvwSi6Pj.js";import"./toNumber-eJTPDU5k.js";import"./isSymbol-vms_p5JZ.js";import"./SkeletonParagraph-Cj-DM6F1.js";import"./HelpOutlineTwoTone-C6BxZfge.js";import"./DialogTitle-Daydmgw2.js";import"./DialogContent-DTv1mhUJ.js";import"./Dialog-DD3QZ5hK.js";import"./Modal-Ctj-syDF.js";import"./getScrollbarSize-CaCM53D3.js";import"./ownerWindow-HkKU3E4x.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Backdrop-b9ToPcV-.js";import"./EnumFacetFilterUI-D_nRMtyz.js";import"./FacetFilterHeader-C6ArUe9w.js";import"./FormControlLabel-DEvBWm2O.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-C5UY3TFn.js";import"./Checkbox-CvmYLp96.js";import"./SwitchBase-CaiWw9MY.js";import"./ButtonBase-DH9Ov36O.js";import"./mergeSlotProps-C-8Xn18D.js";import"./Radio-C4ymOfYk.js";import"./Select-EBZncNFF.js";import"./Menu-B6goGkuq.js";import"./Popover-6v8v2HKN.js";import"./isHostComponent-DVu5iVWx.js";import"./debounce-Be36O1Ab.js";import"./MenuList-MTVdY0vQ.js";import"./List-CdLKK0bg.js";import"./FormControl-CIxvRHbW.js";import"./isMuiElement-BGNH_iJv.js";import"./InputBase-XPnfW9AB.js";import"./Input-1VSZA8Gy.js";import"./HelpTwoTone-Czayt88g.js";import"./uniqueId-CFMK5psZ.js";import"./toString-BvT8LWHb.js";import"./CSSTransition-CVmut3bU.js";import"./LinearProgress-D9AX1YUx.js";import"./InputLabel-B12Zxtr1.js";import"./FormLabel-Bkvt6JVT.js";import"./FormHelperText-DLLKCF2i.js";import"./CircularProgress-2GLfT7Hs.js";import"./dividerClasses-Bfc_2h6a.js";import"./Close-CM6q2e7n.js";import"./LayersTwoTone-HI3aCN5C.js";import"./ContentCopyTwoTone-DbpXlKfZ.js";import"./ErrorOutlined-DYE84B5j.js";import"./GetAppTwoTone-Co2HRy_w.js";import"./InfoOutlined-nfu41j4f.js";import"./PhoneTwoTone-Cj642nu-.js";const We={RS256:"RS256"};function Be(o){const{synapseClient:a,keyFactory:m}=O();return Ae({...o,queryKey:m.getMyOAuthClientsQueryKey(),queryFn:async t=>await a.openIDConnectServicesClient.getAuthV1Oauth2Client({nextPageToken:t.pageParam}),initialPageParam:void 0,getNextPageParam:t=>t.nextPageToken})}function Fe(o){const a=Y(),{accessToken:m,keyFactory:t}=O();return J({...o,mutationFn:s=>he.deleteOAuthClient(s,m),onSuccess:async(s,c,r)=>{await a.invalidateQueries({queryKey:t.getMyOAuthClientsQueryKey()}),o!=null&&o.onSuccess&&await o.onSuccess(s,c,r)}})}function Le(o){const a=Y(),{synapseClient:m,keyFactory:t}=O();return J({...o,mutationFn:s=>m.openIDConnectServicesClient.putAuthV1Oauth2ClientId({id:s.client_id,oAuthClient:s}),onSuccess:async(s,c,r)=>{await a.invalidateQueries({queryKey:t.getMyOAuthClientsQueryKey()}),o!=null&&o.onSuccess&&await o.onSuccess(s,c,r)}})}function Ge(o){const a=Y(),{synapseClient:m,keyFactory:t}=O();return J({...o,mutationFn:s=>m.openIDConnectServicesClient.postAuthV1Oauth2Client({oAuthClient:s}),onSuccess:async(s,c,r)=>{await a.invalidateQueries({queryKey:t.getMyOAuthClientsQueryKey()}),o!=null&&o.onSuccess&&await o.onSuccess(s,c,r)}})}const P="JSON",Qe="Are you absolutely sure?",Ke="Editing this detail will render your client invalid and will require you to resubmit verification. This action cannot be undone.",He=500,h=12,f=6,me=1,ce=2;function z({isShowingModal:o=!1,isEdit:a,onClose:m,client:t,setIsShowingConfirmModal:s,isShowingConfirmModal:c,setIsShowingModal:r}){const{synapseClient:U}=O(),[R,D]=n.useState(""),[l,C]=n.useState([{uri:""}]),[I,w]=n.useState(""),[_,T]=n.useState(""),[A,g]=n.useState(""),[k,N]=n.useState(""),[b,q]=n.useState(P),[G,Q]=n.useState(!1),[K,V]=n.useState(!1),[p,Ce]=n.useState(),[W,E]=n.useState(),x=n.useMemo(()=>({client_id:t==null?void 0:t.client_id,client_name:R,redirect_uris:(l==null?void 0:l.map(i=>i.uri))??[""],policy_uri:I,client_uri:_,sector_identifier_uri:A,userinfo_signed_response_alg:b===P?void 0:b,tos_uri:k,etag:t==null?void 0:t.etag}),[t==null?void 0:t.client_id,t==null?void 0:t.etag,R,_,I,l,A,b,k]);n.useEffect(()=>{var i;D((t==null?void 0:t.client_name)??""),C(((i=t==null?void 0:t.redirect_uris)==null?void 0:i.map(u=>({uri:u})))??[{uri:""}]),w((t==null?void 0:t.policy_uri)??""),T((t==null?void 0:t.client_uri)??""),g((t==null?void 0:t.sector_identifier_uri)??""),q((t==null?void 0:t.userinfo_signed_response_alg)??P),N((t==null?void 0:t.tos_uri)??"")},[o,t]),Te(()=>{x.client_id&&U.openIDConnectServicesClient.putAuthV1Oauth2ClientIdVerificationPrecheck({id:x.client_id,oAuthClient:x}).then(i=>{Q(i.reverificationRequired)})},[x,U.openIDConnectServicesClient],He);const B=()=>{D(""),C([{uri:""}]),w(""),T(""),g(""),q(P),N(""),m()},Z=()=>{s(!1),V(!1)},{mutate:xe}=Ge({onSuccess:()=>{M("Successfully created","success"),E(void 0),B()},onError:i=>{E(i)}}),{mutate:$,isPending:X}=Le({onSuccess:()=>{M("Successfully saved","success"),E(void 0),B()},onError:i=>{E(i),r(!0)}}),{mutate:ye}=Fe({onSuccess:()=>{M("Successfully deleted","success"),B()},onError:i=>{M(i.reason,"danger")}}),Se=()=>{try{Ce(x),G===!0?s(!0):a?$(x):xe(x)}catch(i){M(i.reason,"danger")}},je=()=>{l&&C([...l,{uri:""}])},ve=i=>{if(l){const u=[...l];u.splice(i,1),C(u)}},Ie=(i,u)=>{if(l){const{name:H,value:_e}=i.target,ie=[...l];ie[u][H]=_e,C(ie)}},ee={color:a?"error.main":void 0,"&.Mui-focused":{color:a?"error.main":void 0}},te=e.jsx(S,{onChange:i=>g(i.target.value),placeholder:"https://",type:"text",value:A,id:"sectorURI",label:"Sector Identifier URI",margin:"normal",fullWidth:!0,slotProps:{inputLabel:{sx:ee}}}),re=e.jsx(e.Fragment,{children:l==null?void 0:l.map((i,u)=>e.jsxs("div",{children:[e.jsx(S,{required:u===0,label:u===0&&"Redirect URI(s)",name:"uri",fullWidth:!0,id:`redirect-uri-${u}`,onChange:H=>Ie(H,u),value:i.uri,placeholder:"https://",type:"text",margin:u===0?"normal":"dense",slotProps:{input:{endAdornment:l.length>1&&e.jsx(qe,{position:"end",children:e.jsx(Ee,{onClick:()=>ve(u),children:e.jsx(ae,{sx:{color:"error.main"}})})})},inputLabel:{sx:ee}}}),l.length-1===u&&e.jsx(v,{variant:"contained",color:"primary",onClick:je,disabled:i.uri.length===0,sx:{my:"10px"},children:"Add URI"})]},u))}),we=e.jsxs(e.Fragment,{children:[X&&e.jsx("div",{className:"SRC-center-text",children:e.jsx(Ne,{size:40})}),!X&&e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"body1",sx:{mb:"10px"},children:"To protect you and your users, your consent screen and application will need to be verified by Sage Bionetworks. Before your consent screen and application are verified by Sage Bionetworks, you can still test your application with limitations."}),a&&e.jsxs(F,{sx:{mt:"16px"},variant:"label",children:["Client ID: ",t==null?void 0:t.client_id]}),e.jsxs(d,{container:!0,rowSpacing:me,columnSpacing:ce,children:[e.jsx(d,{item:!0,md:f,xs:h,children:e.jsx(S,{label:"Client Name",required:!0,onChange:i=>D(i.target.value),placeholder:"Client Name",type:"text",value:R,id:"clientName",margin:"normal",fullWidth:!0})}),e.jsx(d,{item:!0,md:f,xs:h,children:e.jsx(S,{label:"Client Homepage",onChange:i=>T(i.target.value),placeholder:"https://",type:"text",value:_,id:"clientUri",fullWidth:!0,margin:"normal"})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,md:f,xs:h,children:re}),e.jsx(d,{item:!0,md:f,xs:h,children:te})]}),e.jsx(d,{item:!0,md:f,xs:h,children:e.jsx(S,{label:"Link to Privacy Policy",onChange:i=>w(i.target.value),placeholder:"https://",type:"text",value:I,fullWidth:!0,margin:"normal"})}),e.jsx(d,{item:!0,md:f,xs:h,children:e.jsx(S,{label:"Links to Terms of Service",onChange:i=>N(i.target.value),placeholder:"https://",type:"text",value:k,fullWidth:!0,margin:"normal"})}),e.jsx(d,{item:!0,md:f,xs:h,children:e.jsxs(S,{label:"User Info Signed Response Algorithm",value:b,onChange:i=>q(i.target.value),select:!0,fullWidth:!0,margin:"normal",children:[e.jsx(le,{value:P,children:"JSON"}),e.jsx(le,{value:We.RS256,children:"JWT"})]})})]}),a&&e.jsxs(ge,{sx:{mt:"10px",padding:1,backgroundColor:"rgb(178, 36, 42, 0.03)"},children:[e.jsx(F,{sx:{my:1},color:"error",variant:"headline3",children:"DANGER ZONE"}),e.jsx(F,{variant:"smallText1",children:"Editing the following information will render your client invalid and will require you to create it again and resubmit verification if needed."}),e.jsxs(d,{container:!0,rowSpacing:me,columnSpacing:ce,children:[e.jsx(d,{item:!0,md:f,xs:h,children:re}),e.jsx(d,{item:!0,md:f,xs:h,children:te})]}),e.jsx(v,{onClick:()=>{V(!0),s(!0)},color:"error",variant:"text",startIcon:e.jsx(ae,{}),sx:{padding:0,mb:1},children:"DELETE CLIENT"})]})]}),W&&e.jsx(Pe,{severity:"error",children:W==null?void 0:W.reason})]});return e.jsxs(e.Fragment,{children:[e.jsx(ke,{open:o&&!c,onCancel:()=>{B(),E(void 0)},maxWidth:"md",title:a?"Client Details":"Create New OAuth Client",content:we,onConfirm:Se,confirmButtonProps:{children:"Save"}}),e.jsx(fe,{open:c,title:Qe,content:Ke,onCancel:Z,onConfirm:()=>{K?ye(t==null?void 0:t.client_id):$(p),Z()},confirmButtonColor:"error",confirmButtonText:"Yes, Continue"})]})}try{z.displayName="CreateOAuthModal",z.__docgenInfo={description:"",displayName:"CreateOAuthModal",props:{isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},isEdit:{defaultValue:null,description:"",name:"isEdit",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},setIsShowingConfirmModal:{defaultValue:null,description:"",name:"setIsShowingConfirmModal",required:!0,type:{name:"(a: boolean) => void"}},isShowingConfirmModal:{defaultValue:null,description:"",name:"isShowingConfirmModal",required:!0,type:{name:"boolean"}},client:{defaultValue:null,description:"",name:"client",required:!1,type:{name:"OAuthClient"}},setIsShowingModal:{defaultValue:null,description:"",name:"setIsShowingModal",required:!0,type:{name:"(a: boolean) => void"}}}}}catch{}const j=Re();function ze(o){const{setIsShowingVerification:a,setSelectedClient:m,setIsShowingSecretWarning:t,setIsEdit:s,setIsShowingCreateClientModal:c}=o;return[j.accessor("createdOn",{header:r=>e.jsx(y,{...r,title:"Created"}),cell:r=>oe(ne(r.getValue()))}),j.accessor("modifiedOn",{header:r=>e.jsx(y,{...r,title:"Modified"}),cell:r=>oe(ne(r.getValue()))}),j.accessor("client_id",{header:r=>e.jsx(y,{...r,title:"ID"})}),j.accessor("client_name",{header:r=>e.jsx(y,{...r,title:"Client"})}),j.accessor("verified",{header:r=>e.jsx(y,{...r,title:"Verified"}),cell:({getValue:r})=>r()?"Yes":e.jsx(v,{variant:"outlined",size:"small",onClick:()=>a(!0),children:"Submit Verification"})}),j.display({id:"generateSecret",header:r=>e.jsx(y,{...r,title:"App Secret"}),cell:({row:r})=>e.jsx(v,{variant:"outlined",onClick:()=>{m(r.original),t(!0)},size:"small",children:"Generate Secret"})}),j.display({id:"actions",header:r=>e.jsx(y,{...r,title:"Actions"}),cell:({row:r})=>e.jsx(v,{variant:"outlined",onClick:()=>{m(r.original),s(!0),c(!0)},size:"small",children:"Edit"})})]}function Ye(){const{accessToken:o}=O(),[a,m]=n.useState(!1),[t,s]=n.useState(!1),[c,r]=n.useState(),[U,R]=n.useState(!1),[D,l]=n.useState(!1),[C,I]=n.useState(!1),[w,_]=n.useState(),[T,A]=n.useState(!1),{data:g,hasNextPage:k,fetchNextPage:N}=Be(),b=n.useMemo(()=>(g==null?void 0:g.pages.flatMap(p=>p.results||[]))||[],[g]),q="Are you absolutely sure?",G="If you have an existing secret, generating a new secret will make your application invalid after generation. This action cannot be undone.",Q=async()=>{l(!1);try{const p=await he.createOAuthClientSecret(o,c==null?void 0:c.client_id);r(void 0),I(!0),_(p.client_secret)}catch(p){M(p.reason,"danger")}},K=n.useMemo(()=>ze({setIsShowingVerification:A,setSelectedClient:r,setIsShowingSecretWarning:l,setIsEdit:s,setIsShowingCreateClientModal:m}),[]),V=be({data:b,columns:K,getRowId:p=>p.client_id,enableRowSelection:!0,enableSorting:!1,getCoreRowModel:Me(),columnResizeMode:"onChange"});return e.jsxs("div",{children:[e.jsx(ge,{sx:{display:"flex",width:"100%",justifyContent:"flex-end",mb:2},children:e.jsx(v,{variant:"contained",color:"primary",onClick:()=>{m(!0),s(!1)},sx:{float:"right"},startIcon:e.jsx(Ue,{}),children:"Create New Client"})}),e.jsx(Oe,{table:V}),k&&e.jsx("div",{className:"text-center",children:e.jsx(v,{variant:"contained",color:"primary",onClick:()=>{N()},children:"Load more"})}),e.jsx(z,{onClose:()=>{m(!1)},isShowingModal:a,client:t?c:void 0,isEdit:t,setIsShowingConfirmModal:R,isShowingConfirmModal:U,setIsShowingModal:m}),e.jsx(se,{open:T,onCancel:()=>A(!1),title:"Submit Verification",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["In order to verify an OAuth client please submit a request to the"," ",e.jsx(Ve,{target:"_blank",rel:"noopener noreferrer",href:"https://sagebionetworks.jira.com/servicedesk/customer/portal/9",children:"Synapse Service Desk."})]}),e.jsx("b",{children:"Please list the following items in your request:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Your name"}),e.jsxs("li",{children:["The ID of the client to be verified ",e.jsx("br",{})]}),e.jsx("li",{children:"A description of your application"})]})]})}),e.jsx(fe,{open:D,title:q,content:G,onCancel:()=>{l(!1),r(void 0)},onConfirm:Q,confirmButtonColor:"error",confirmButtonText:"Yes, Continue"}),w&&e.jsx(se,{open:C,title:"App Secret",onCancel:()=>{I(!1),_(void 0)},content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("b",{children:"This secret will not be able to be retrieved again."})," If needed, in order to generate a new secret select Generate from the Client List."]}),e.jsx(De,{value:w,inputWidth:"400px"})]})})]})}const Wi={title:"Synapse/OAuthManagement",component:Ye},L={};var ue,de,pe;L.parameters={...L.parameters,docs:{...(ue=L.parameters)==null?void 0:ue.docs,source:{originalSource:"{}",...(pe=(de=L.parameters)==null?void 0:de.docs)==null?void 0:pe.source}}};const Bi=["OAuthManagementDemo"];export{L as OAuthManagementDemo,Bi as __namedExportsOrder,Wi as default};
