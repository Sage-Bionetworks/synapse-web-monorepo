import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as n}from"./index-DC_F6LC3.js";import{T as b}from"./TextField-CIo3jSWq.js";import{l as A,S as M}from"./useFiles-D_Jzezen.js";import"./VerificationSubmission-D0sL2gwz.js";import"./StringUtils-Bt2r5KGg.js";import"./OrientationBanner-Bzpnatw7.js";import{u as F}from"./QueryClientProvider-BJ02iD0i.js";import{u as N}from"./useMutation-FhdIYqNP.js";import{a as q}from"./useTeam-Bv9iOwQk.js";import{d as V}from"./useTeamMembers-kwd8IsCe.js";import{p as O}from"./papaparse.min-D1KxGBLm.js";import{n as w}from"./useQuery-CgX23BOz.js";import{B as h}from"./Box-BMvETEd-.js";import{T as E}from"./Typography-6ljS8WSa.js";import{i as k}from"./_baseUniq-9aYP-DvN.js";import{A as W}from"./Alert-BBtsbdxl.js";function B(g){const{accessToken:f,keyFactory:l}=A(),m=F();return N({...g,mutationFn:d=>M.registerChallengeTeam(d,f),onSuccess:async(d,i,a)=>{await m.invalidateQueries({queryKey:l.getChallengeTeamListQueryKey(i.challengeId)})}})}function Q(){const{mutateAsync:g,isPending:f,error:l}=q(),{mutateAsync:m,isPending:d,error:i}=V(),{mutateAsync:a,isPending:j,error:u}=B(),T=n.useCallback(async(c,p,r)=>{const y=[];for(const s of p){const o=await m({teamId:c,inviteeEmail:s.trim(),message:r});y.push(o)}return y},[m]),v=n.useCallback(async(c,p,r,y)=>{const s=await g(c),o=a({teamId:s.id,challengeId:p}),C=T(s.id,r,y);return Promise.all([Promise.resolve(s),o,C])},[g,T,a]),P=n.useMemo(()=>l||i||u?[l,i,u].filter(r=>r!=null):void 0,[u,l,i]);return{createAndRegisterTeam:v,isPending:f||d||j,errors:P}}const U=3,D="Please limit the initial number of invited members to three. You may add additional members after the team has been created.",_=n.forwardRef(function(f,l){const{challengeId:m,onCanSubmitChange:d=w,onFinished:i=w}=f,[a,j]=n.useState({name:"",description:""}),[u,T]=n.useState(""),[v,P]=n.useState(""),c=e=>{const x={...a,...e};j(x)},{inviteesParseResult:p,parsedInvitees:r}=n.useMemo(()=>{const e=O.parse(v,{delimiter:",",transform(S){return S.trim()}}),x=e.data[0]||[];return{inviteesParseResult:e,parsedInvitees:x}},[v]),s=r.length>U,o=!!(a&&a.name&&a.name.length>1&&!s);n.useEffect(()=>{d(o)},[o,d]);const{createAndRegisterTeam:C,isPending:I,errors:R}=Q();return n.useImperativeHandle(l,()=>({submit(){if(!o){console.warn("Attempted to submit when form data was not valid. Nothing will happen.");return}C(a,m,r,u).then(([e])=>{i(e.id)}).catch(()=>{})}}),[o,r,C,a,m,u,i]),t.jsxs(h,{children:[t.jsx(E,{variant:"body1",sx:{lineHeight:"20px"},children:"Create a new team for this Challenge!"}),t.jsx(b,{id:"name",label:"Team Name",value:a.name,fullWidth:!0,autoFocus:!0,required:!0,onChange:e=>c({name:e.target.value}),disabled:I}),t.jsx(h,{sx:{display:"flex"},children:t.jsx(b,{id:"description",label:t.jsx(h,{sx:{display:"flex",gap:2},children:t.jsx(h,{children:"Team Description"})}),value:a.description,fullWidth:!0,multiline:!0,rows:4,onChange:e=>c({description:e.target.value}),disabled:I})}),t.jsx(h,{sx:{display:"flex"},children:t.jsx(b,{id:"message",label:t.jsx(h,{sx:{display:"flex",gap:2},children:t.jsx(h,{children:"Recruitment Message"})}),value:u,fullWidth:!0,multiline:!0,rows:4,onChange:e=>T(e.target.value),disabled:I})}),t.jsx(b,{id:"invitees",label:"Emails of Additional Members to Invite (max 3)",placeholder:"Enter emails separated by comma",value:v,fullWidth:!0,onChange:e=>P(e.target.value),disabled:I}),(s||!k(p.errors)||R)&&t.jsxs(W,{severity:"error",children:[s&&t.jsx(E,{variant:"body1",children:D}),p.errors.map((e,x)=>t.jsx(E,{variant:"body1",children:e.message},x)),R&&R.map(e=>t.jsx(E,{variant:"body1",children:e.reason},e.reason))]})]})});try{_.displayName="CreateChallengeTeam",_.__docgenInfo={description:"",displayName:"CreateChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCanSubmitChange:{defaultValue:null,description:"",name:"onCanSubmitChange",required:!1,type:{name:"(canSubmit: boolean) => void"}},onFinished:{defaultValue:null,description:"",name:"onFinished",required:!1,type:{name:"(teamId: string) => void"}}}}}catch{}export{_ as C};
