import{gZ as $,j as e,dk as w,ic as G,dJ as j,dI as A,ca as H,r as i,hP as J,B as T,cu as Z,cv as z,c2 as Q,bW as X,K as Y,c0 as ee}from"./iframe-vUTu6M8D.js";import{u as g}from"./useEntityBundle-HV3Xzo9J.js";import{C as te}from"./ConfirmationDialog-BPtNL54i.js";import{D as ae}from"./DialogBase-B4OLAYCG.js";import{S as ne}from"./SchemaDrivenAnnotationEditor-DWlLjKXn.js";import{A as se}from"./AnnotationsTable-7ULQWiM_.js";import{g as oe,u as ie,a as le}from"./FileHandleUtils-Cm2VFaBL.js";import{U as E}from"./UserBadge-DThzTs_4.js";const b=({entityId:c,versionNumber:o})=>{const{data:t}=g(c,o),h=t&&$(t.entity),l=t?oe(t):void 0,m=t?.entity?.parentId,_=l?.storageLocationId,{data:u}=ie(m,_,{enabled:m!==void 0&&_!=null});let d;return l&&(d=le(l,u)),t?e.jsx("table",{className:"MetadataTable",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Name"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:t.entity?.name})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Type"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:w(t.entityType)})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:t.entity?.id})]}),h&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Version"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:G(t.entity)})]}),d&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:d})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(E,{userId:t.entity?.modifiedBy})," at"," ",j(A(t.entity?.modifiedOn))]})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Created By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(E,{userId:t.entity?.createdBy})," at"," ",j(A(t.entity?.createdOn))]})]})]})}):null};try{b.displayName="MetadataTable",b.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const de=["METADATA","ANNOTATIONS"];function M(c){const{entityId:o,versionNumber:t,show:h,onClose:l,initialTab:m="METADATA",showTabs:_=!0,onEditModeChanged:u=H}=c,d=i.useRef(null),[s,v]=i.useState(m),[C,y]=i.useState(!1),[n,r]=i.useState(!1),[I,N]=i.useState(()=>r(!1));i.useEffect(()=>(u(n),()=>{u(!1)}),[n,u]);const{data:a}=g(o,t),R=a&&a.permissions.canEdit,f=a&&J(a.entityType),S=f&&a.entity.isLatestVersion,V=s==="METADATA"&&a&&!window.location.href.includes(o),O=e.jsxs(T,{variant:"contained",onClick:()=>window.open(`${Z(z.PORTAL_ENDPOINT)}Synapse:${o}`,"_blank","noopener"),children:["Open"," ",a?w(a?.entityType):""]}),B=s==="ANNOTATIONS"&&n,D=e.jsx(T,{variant:"contained",onClick:()=>{d.current.formElement.current.requestSubmit()},children:"Save Annotations"}),q=s==="ANNOTATIONS"&&n,L=e.jsx(T,{variant:"outlined",onClick:()=>{N(()=>()=>r(!1)),y(!0)},children:"Cancel"}),k=R&&s==="ANNOTATIONS"&&!n,x=f&&!S,K=e.jsx(ee,{title:x?"Annotations can only be edited on the latest version":void 0,children:e.jsx("span",{children:e.jsx(T,{variant:"contained",disabled:x,onClick:()=>{r(!0)},children:"Edit"})})}),F=e.jsxs(e.Fragment,{children:[_&&!n?e.jsx("div",{className:"Tabs",children:de.map(p=>e.jsx("div",{className:"Tab",role:"tab",onClick:W=>{W.stopPropagation(),v(p)},"aria-selected":p===s,children:p},p))}):null,e.jsx("div",{style:s==="ANNOTATIONS"?{}:{display:"none"},children:n?e.jsx(X,{children:e.jsx(ne,{entityId:o,formRef:d,hideActions:!0,onSuccess:()=>{Y("Annotations successfully updated.","success"),r(!1)},onCancel:()=>r(!1)})}):e.jsx(se,{entityId:o,versionNumber:t})}),e.jsx("div",{style:s==="METADATA"?{}:{display:"none"},children:e.jsx(b,{entityId:o,versionNumber:t})})]}),P=e.jsx(te,{open:C,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{y(!1)},onConfirm:()=>{y(!1),I()}}),U=i.useMemo(()=>{if(a?.entity.name){if(s==="ANNOTATIONS")return`${n?"Edit ":""}Annotations for ${a.entity.name}`}else return e.jsx(Q,{width:"40%"});return a.entity.name},[s,a?.entity.name,n]);return e.jsx(ae,{className:"EntityMetadata",open:h,onCancel:()=>{n?(y(!0),N(()=>()=>{r(!1),l()})):l()},maxWidth:n?"md":"sm",title:U,content:F,actions:e.jsxs(e.Fragment,{children:[P,q&&L,B&&D,k&&K,V&&O]})})}try{M.displayName="EntityModal",M.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"(isInEditMode: boolean) => void"}}}}}catch{}export{M as E};
