import{j as l}from"./jsx-runtime-Du8NFWEI.js";import{b as C}from"./index-CIIvWsNs.js";import{r as u,R as N}from"./index-Dl6G-zuu.js";import"./SynapseClient-BZSwUuIi.js";import"./OrientationBanner-D9RUUnWX.js";import"./EntityTypeUtils-BpOAC-k-.js";import"./getEndpoint-CjoHA800.js";import{e as G,i as H,j as P,k as q}from"./useAccessRequirements-fFEMTtVC.js";import{c as U}from"./UserBadge-BWg-cM41.js";import{c as h,P as _}from"./SynapseConstants-Ck5wAR80.js";import{n as T}from"./noop-DX6rZLP_.js";import{A as j}from"./AclEditor-9fkgs0vj.js";import{i as M}from"./isEqual-fx5nODOB.js";import{S as O}from"./Stack-D3AEdRlD.js";import{B}from"./Box-DRYT9rh3.js";import{T as y}from"./Typography-DgBbIcOX.js";import{A as D}from"./Alert-Aa0bm5Nm.js";function b(r,i){let d;(t=>{t[t.A_FIRST=-1]="A_FIRST",t[t.B_FIRST=1]="B_FIRST"})(d||(d={}));const a=r.resourceAccess.accessType.includes(C.CHANGE_PERMISSIONS),o=i.resourceAccess.accessType.includes(C.CHANGE_PERMISSIONS);return a&&!o?-1:!a&&o?1:r.resourceAccess.principalId===h&&i.resourceAccess.principalId!==h?-1:r.resourceAccess.principalId!==h&&i.resourceAccess.principalId===h?1:r.resourceAccess.principalId===_&&i.resourceAccess.principalId!==_?-1:r.resourceAccess.principalId!==_&&i.resourceAccess.principalId===_?1:r.userGroupHeader.userName.localeCompare(i.userGroupHeader.userName)}function w(r){const i=u.useMemo(()=>r.map(c=>c.principalId),[r]),{data:d,isLoading:a,error:o}=U(i.map(String));return u.useEffect(()=>{o&&console.error("Error fetching user group headers: ",o)},[o]),{sortedResourceAccessList:u.useMemo(()=>{if(!d)return r;const c=r.map(n=>({resourceAccess:n,userGroupHeader:d.find(e=>String(e.ownerId)===String(n.principalId))}));return c.every(n=>!!n.userGroupHeader)?c.toSorted(b).map(n=>n.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",c.filter(n=>!n.userGroupHeader)),r)},[r,d]),isLoading:a}}const V="User or team already has permissions.";function F(r){const{onChange:i=T,onError:d=T}=r,[a,o]=u.useState(!1),[t,c]=u.useState([]),[A,n]=u.useState(!1),{sortedResourceAccessList:e,isLoading:R}=w(t);return u.useEffect(()=>{!a&&!R&&!A&&(c(e),n(!0))},[A,a,R,e]),u.useEffect(()=>{i(t)},[t]),{resourceAccessList:t,setResourceAccessList:c,addResourceAccessItem:(m,I)=>{if(o(!0),m)if(t.some(p=>p.principalId===Number(m)))d(V);else{const p={principalId:Number(m),accessType:I},E=[...t,p];c(E)}},updateResourceAccessItem:(m,I)=>{o(!0);const S=t.map(p=>p.principalId===m?{...p,accessType:I}:p);c(S)},removeResourceAccessItem:m=>{o(!0);const I=t.filter(S=>S.principalId!==m);c(I)}}}const g={variant:"body1",lineHeight:"20px",color:"grey.800"},W="Only ACT has permissions on this AR.",X=["CAN_REVIEW_SUBMISSIONS","IS_EXEMPTION_ELIGIBLE","CAN_REVIEW_SUBMISSIONS_AND_IS_EXEMPTION_ELIGIBLE"],v=N.forwardRef(function(i,d){const{accessRequirementId:a,onSaveComplete:o}=i,[t,c]=u.useState(null),A=()=>{c(null),o(!0)},n=s=>{c(s.reason),o(!1)},{data:e,isLoading:R}=G(a,{staleTime:1/0}),{resourceAccessList:f,setResourceAccessList:L,addResourceAccessItem:x,updateResourceAccessItem:m,removeResourceAccessItem:I}=F({onChange:()=>c(null),onError:c});u.useEffect(()=>{e&&L(e.resourceAccess)},[e,L]);const{mutate:S}=H({onSuccess:()=>A(),onError:s=>n(s)}),{mutate:p}=P({onSuccess:()=>A(),onError:s=>n(s)}),{mutate:E}=q({onSuccess:()=>A(),onError:s=>n(s)});return u.useImperativeHandle(d,()=>({save(){const s=f.length===0?null:{...e,id:(e==null?void 0:e.id)||a,resourceAccess:f};e===null&&s==null||M(e==null?void 0:e.resourceAccess,f)&&(e==null?void 0:e.id)===(s==null?void 0:s.id)?o(!0):e===null&&s!==null?p(s):s===null?S(a):E(s)}}),[a,e,f,p,S,o,E]),l.jsxs(O,{gap:"20px",direction:"column",children:[l.jsxs(B,{children:[l.jsx(y,{variant:"headline3",mb:"10px",children:"Guide to AR permissions"}),l.jsxs(y,{sx:g,mb:"10px",children:[l.jsx("span",{style:{fontStyle:"italic"},children:"Can Review"})," means a user or team has access request review permission for this AR."]}),l.jsxs(y,{sx:g,mb:"10px",children:[l.jsx("span",{style:{fontStyle:"italic"},children:"Exempt Eligible"}),' users and teams can bypass access requirements for entities they have been granted "edit and delete" permission on, via the "Sharing Settings" dialog in the Project Settings.']}),l.jsx(y,{sx:{...g,color:"grey.900"},children:"ACT members always retain the ability to review or modify Access Requirements."})]}),l.jsx(j,{resourceAccessList:f,availablePermissionLevels:X,isLoading:R,isInEditMode:!0,emptyText:W,onAddPrincipalToAcl:s=>x(s,[C.REVIEW_SUBMISSIONS]),updateResourceAccessItem:m,removeResourceAccessItem:I}),t&&l.jsx(D,{severity:"error",children:t})]})});try{v.displayName="AccessRequirementAclEditor",v.__docgenInfo={description:"",displayName:"AccessRequirementAclEditor",props:{accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!0,type:{name:"string"}},onSaveComplete:{defaultValue:null,description:"",name:"onSaveComplete",required:!0,type:{name:"(saveSuccessful: boolean) => void"}}}}}catch{}export{v as A};
