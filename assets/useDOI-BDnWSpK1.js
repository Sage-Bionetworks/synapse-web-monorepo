import{l as r,S as i}from"./useFiles-DA4xKLZp.js";import"./VerificationSubmission-CWAFIXEx.js";import"./StringUtils-DBSsSsIU.js";import{d as c}from"./fetchWithExponentialTimeout-Cpvpsfq8.js";import{u}from"./useQuery-DFbKL1Tm.js";import{u as y}from"./utils-DPkdG3Lw.js";import{u as l}from"./useMutation-DU0JAunR.js";async function D(e,o){let n=125;const a=1e3;let t=await e();for(;"jobState"in t&&t.jobState==="PROCESSING";)await c(n),t=await e(),n=Math.min(n*2,a);return t}function q(e,o,n="ENTITY",a){const{accessToken:t,keyFactory:s}=r();return u({...a,queryKey:s.getDOIAssociationQueryKey(n,e,o),queryFn:()=>i.getDOIAssociation(t,e,o,n)})}function C(e,o,n="ENTITY",a){const{accessToken:t,keyFactory:s}=r();return u({...a,queryKey:s.getDOIQueryKey(n,e,o),queryFn:()=>i.getDOI(t,e,o,n)})}function k(e){const o=y(),{synapseClient:n,keyFactory:a}=r();return l({...e,mutationFn:async t=>{const s=await n.doiServicesClient.postRepoV1DoiAsyncStart({doiRequest:t});return D(()=>n.doiServicesClient.getRepoV1DoiAsyncGetAsyncToken({asyncToken:s.token}))},onSuccess(...t){e!=null&&e.onSuccess&&e.onSuccess(...t);const s=t[1].doi;s&&(o.invalidateQueries({queryKey:a.getDOIAssociationQueryKey(s.objectType,s.objectId,s.objectVersion)}),o.invalidateQueries({queryKey:a.getDOIQueryKey(s.objectType,s.objectId,s.objectVersion)}))}})}export{k as a,q as b,C as u};
