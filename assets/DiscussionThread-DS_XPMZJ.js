import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{d as L}from"./dayjs.min-d18Up55D.js";import{r as n}from"./index-Dl6G-zuu.js";import{f as A}from"./DateFormatter-BB-wk6UA.js";import{u as te,a as oe,F as x,b as se}from"./ForumThreadEditor-DxxWu5FJ.js";import{u as ne,a as ie,b as re}from"./useThread-CDog2UKY.js";import{S as ae}from"./SynapseConstants-BVYQRCsB.js";import{O as F,t as v,s as le}from"./index-S3N2_v0E.js";import{d as j}from"./ToastMessage-CyCjbTLE.js";import{M as O,C as de}from"./HelpPopover-F37HRDEf.js";import{I as i}from"./IconSvg-Djvs0a91.js";import{I as Y}from"./SynapseClient-Ihq4xrvb.js";import"./OrientationBanner-BV5RFxzC.js";import"./getEndpoint-CjoHA800.js";import{u as G}from"./RequestDownloadCard-8cdxfLI-.js";import{W as R}from"./WarningDialog-DY7P0_8l.js";import{S as ce}from"./SkeletonTable-CULGn8eZ.js";import{U as H}from"./UserBadge-BHTGGiBp.js";import{a as ue}from"./useSubscription-Ci-oHjNQ.js";import{S as me}from"./SubscribersModal-CJGVUAjj.js";import{B as D}from"./Button-mb55Lwfk.js";import{T as pe}from"./Typography-B88_J_TK.js";import{F as k}from"./Form--9Y-bW00.js";const he=()=>alert("This functionality has not been implemented yet"),_=({reply:o,onClickLink:r=he})=>{const[y,a]=n.useState(!1),[h,u]=n.useState(!1),{data:l}=Y(),{data:m}=G(o.projectId),{data:d,isLoading:C}=te(o),{mutate:f}=oe({onSuccess:()=>{u(!1),j("A reply has been deleted.","info")}}),b=o.createdBy==(l==null?void 0:l.ownerId);return e.jsx("div",{className:"reply-container",children:C?e.jsx(ce,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(H,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{className:"message-body",children:[e.jsx(O,{markdown:d,objectType:F.REPLY}),e.jsxs("span",{children:["posted ",A(L(o.createdOn),"M/D/YYYY")]}),e.jsxs("div",{style:{float:"right"},children:[e.jsx("button",{onClick:()=>r(),children:e.jsx(i,{icon:"link"})}),b&&e.jsx("button",{onClick:()=>a(!0),children:e.jsx(i,{icon:"edit"})}),(m==null?void 0:m.permissions.canModerate)&&e.jsx("button",{onClick:()=>u(!0),children:e.jsx(i,{icon:"delete"})})]})]})]}),e.jsx(x,{isReply:!0,initialText:d,onClose:()=>a(!1),id:o.id,isDialog:!0,openDialog:y}),e.jsx(R,{open:h,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{u(!1)},onConfirm:()=>f({forumId:o.forumId,threadId:o.threadId,replyId:o.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})};try{_.displayName="DiscussionReply",_.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},onClickLink:{defaultValue:{value:`() =>
  alert('This functionality has not been implemented yet')`},description:"",name:"onClickLink",required:!1,type:{name:"(() => void)"}}}}}catch{}const fe="You are following this topic. Click to stop following.",xe="You are not following this topic. Click to follow.",je="You will need to sign in for access to that resource",E="Write a reply...";function B(o){const{threadId:r,limit:y}=o,[a,h]=n.useState(!0),[u,l]=n.useState(!1),[m,d]=n.useState(!1),[C,f]=n.useState(!1),[b,g]=n.useState(!1),[q,p]=n.useState(!1),[P,S]=n.useState(!1),[U,W]=n.useState(!1),{threadData:t,threadBody:T,togglePin:V}=ne(r),{data:s}=Y(),{data:w}=G((t==null?void 0:t.projectId)??"",void 0,le,{enabled:!!t}),{subscription:M,toggleSubscribed:X,isLoading:z}=ue(r,v.THREAD),{mutate:K}=ie({onSuccess:()=>{g(!1),j("A thread has been deleted.","info")}}),{mutate:J}=re({onSuccess:()=>{S(!1),j("A thread has been restored.","info")}}),Q=(t==null?void 0:t.createdBy)==(s==null?void 0:s.ownerId);function Z(){if((s==null?void 0:s.userName)=="anonymous")p(!0);else try{X()}catch(c){j(c.reason,"danger")}}const{data:I,hasNextPage:$,fetchNextPage:ee}=se(r,a,y),N=(I==null?void 0:I.pages.flatMap(c=>c.results))??[];return e.jsxs("div",{className:"bootstrap-4-backport DiscussionThread",children:[t&&T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(D,{variant:a?"contained":"outlined",onClick:()=>h(!0),children:"Date Posted"}),e.jsx(D,{variant:a?"outlined":"contained",onClick:()=>h(!1),children:"Most Recent"})]}),e.jsx(H,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{children:[e.jsx(pe,{style:{marginTop:"4px"},variant:"headline2",children:t.title}),e.jsx(me,{id:r,objectType:v.THREAD,showModal:U,handleModal:W})]}),e.jsx("div",{children:e.jsx(O,{markdown:T,objectType:F.THREAD})}),e.jsxs("span",{children:["posted ",A(L(t.createdOn),"M/D/YYYY")]}),e.jsx(x,{isReply:!1,initialText:T,onClose:()=>l(!1),initialTitle:t==null?void 0:t.title,id:r,isDialog:!0,openDialog:u})]}):e.jsx(e.Fragment,{}),e.jsx("div",{className:"control-container",children:t!=null&&t.isDeleted?e.jsx("button",{onClick:()=>S(!0),children:e.jsx(i,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":M?"Unfollow thread":"Follow thread",disabled:z,onClick:()=>Z(),children:M?e.jsx(i,{icon:"visibility",label:fe}):e.jsx(i,{icon:"visibilityOff",label:xe})})}),Q&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(i,{icon:"edit",label:"Edit thread"})}),w!=null&&w.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(!0),children:e.jsx(i,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>V(),children:t!=null&&t.isPinned?e.jsx(i,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(i,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),m?e.jsx(x,{id:r,isReply:!0,onClose:()=>d(!1),isDialog:!1}):e.jsx(k,{type:"text",placeholder:E,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?p(!0):d(!0)}}),e.jsx("div",{children:N.map(c=>e.jsx(_,{reply:c},c.id))}),N.length>0&&e.jsx(e.Fragment,{children:C?e.jsx(x,{id:r,isReply:!0,onClose:()=>f(!1),isDialog:!1}):e.jsx(k,{type:"text",placeholder:E,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?p(!0):f(!0)}})}),$?e.jsx(D,{variant:"outlined",onClick:()=>{ee()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(R,{open:b,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>g(!1),onConfirm:()=>t&&K(t),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(R,{open:P,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>S(!1),onConfirm:()=>t&&J(t),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(de,{open:q,title:"Sign In Required",content:je,onCancel:()=>p(!1),hasCancelButton:!1,onConfirm:()=>p(!1),confirmButtonProps:{children:"Sign In",className:ae}})]})}try{B.displayName="DiscussionThread",B.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{B as D};
