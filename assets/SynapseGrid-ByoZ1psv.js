import{iZ as xh,i_ as sc,da as Fe,r as D,g_ as jh,i$ as Ph,j0 as Mh,j1 as Dh,ie as ic,j,B as Yd,ao as ut,aJ as Ie,K as be,c2 as Bh,j2 as qh,j3 as Lh,hi as Uh,j4 as Fh,aI as Xd,dc as Vh,j5 as Jh,dj as Gh,d0 as zh,j6 as Hh,j7 as Wh,bC as ft,c4 as Kh,em as B,hX as $h,cu as oc,ca as Te,c7 as Yh,az as Xh,ah as Qh}from"./iframe-Djf1Gvja.js";import"./ErrorPage-Bpv22xGR.js";import"./AccessTokenPage-DRoroU1t.js";import"./AccountLevelBadges-BAMHSE35.js";import"./CardContainerLogic-igkLF7o5.js";import"./RowDataTable-DkBM_a1u.js";import"./RowDataTableWithQuery-DG9FhxRr.js";import"./MarkdownPopover-15pHq4Q_.js";import"./SkeletonButton-D5sJL5B9.js";import"./SkeletonInlineBlock-CSkbk-eL.js";import{S as Zh}from"./SkeletonTable-CUnfVmXh.js";import"./SkeletonParagraph-nhe0tvw8.js";import"./CertificationAnswer-BZS8gnCa.js";import"./ChallengeDetailPage-BQO9VSI_.js";import"./index-DnuhKcBl.js";import"./AvailableEvaluationQueueList-Ddr-gnV4.js";import"./ChallengeSubmission-CAKh1KG1.js";import"./ChangePassword-CtG1TKe6.js";import"./ChangePasswordWithToken-CKvgvvUf.js";import"./ConfirmationDialog-COmnWvpz.js";import"./CookiesNotification-90gJNpTf.js";import"./DownloadCartPage-iejWry2L.js";import"./ShowDownloadV2-5SR6N-b_.js";import"./DynamicForm-CdOYNJmO.js";import"./EntityBadgeIcons-DPu1MHSk.js";import"./EntityFinder-eY-kDoTl.js";import"./EvaluationCard-BYq-75aP.js";import"./EvaluationEditorPage-eZi0HeBB.js";import"./ExperimentalMode-BG8sv3jd.js";import"./FileUpload-C00C4g4f.js";import"./FeaturedDataTabs-Bbc3GB7n.js";import"./FeaturedToolsList-DAIC4XHP.js";import"./DiscussionThread-9iVfj_D6.js";import"./ForumPage-B5dD9xJF.js";import"./SynapseCardLabel-BJBftcww.js";import"./GenericCard-lo84E5sN.js";import"./HeaderCardV2-r17Og_pU.js";import"./CardUtils-D5yKlw-8.js";import"./Goals-Cz0nqftd.js";import"./GoalsV2-BpeUdT9p.js";import"./GoogleMap-Di9CsKPo.js";import"./HasAccessV2-DSz9YTal.js";import"./Icon-Cd3_JPUM.js";import"./MarkdownCollapse-CPISFtNL.js";import"./MarkdownEditor-DtczKt0M.js";import"./MarkdownGithub-CHdTZkOd.js";import"./ModalDownload-O6adcBn7.js";import"./InfiniteTableLayout-COP2qlXZ.js";import"./CopyToClipboardInput-C9PKwP7B.js";import"./DialogBase-DFoHyZgy.js";import"./WarningDialog-CPLBxqmr.js";import"./ColumnHeader-BeDMXmND.js";import"./StyledTanStackTable-CUfJXzL6.js";import"./OAuthAclEditorModal-BeBd6DK6.js";import"./ThemesPlot-Bveq_4Ro.js";import"./UpsetPlot-B09n4hoU.js";import"./SynapsePlot-FefGCCQA.js";import"./Programs-4W0BOdas.js";import"./ProvenanceGraph-no5v6gXv.js";import"./ProjectDataAvailability-EW6NMCub.js";import"./QueryContext-BiBOTym3.js";import"./QueryCount--R8a87YM.js";import"./QueryWrapper-BxrzylEk.js";import"./RegisterPageLogoutPrompt-Cx-JDdLc.js";import"./RenderIfInView-DDbzso7P.js";import"./Resources-B50dgXWJ.js";import"./AccessRequirementAclEditor-Cx3Egdvy.js";import"./RssFeedCards-D6N2kMl0.js";import"./ShowMore-V1dz61Ur.js";import"./LightTooltip-CCYEKJGf.js";import"./WideButton-D4KZhZKy.js";import"./InputSizedButton-CebYa_-x.js";import"./DropdownSelect-paw0yy-9.js";import"./SubscriptionItem-DwhKTjiW.js";import"./SubsectionRowRenderer-DJjoIqf7.js";import"./SynapseFormWrapper-C4AYUkGq.js";import"./SynapseFormSubmissionGrid-DEm7qLXo.js";import"./SynapseTable-DXbkM159.js";import{u as e0,S as t0,a as n0}from"./SynapseChat-CSYdBs1h.js";import"./TableFeedCards-DWRY0ffH.js";import"./TermsAndConditions-Cj2-VIfR.js";import"./UserBadge-CHqh5HJA.js";import"./UserCardListRotate-CGzWy3W6.js";import"./UserCardListGroups-kLG7jRJ9.js";import"./UserOrTeamBadge-CIR1lEs7.js";import"./UserProfileLinks-CyhnC04q.js";import"./EntityHeaderTable-BMZJ-4d8.js";import"./AccessRequirementRelatedProjectsList-DPLlT_Sc.js";import"./HelpPopover-COYTKA2i.js";import"./SageResourcesPopover-D8sBD3Dk.js";import"./RecentPublicationsGrid-JCxHJ3ec.js";import"./ImageCardGridWithLinks-CCdxhB-P.js";import"./PortalFeatureHighlights-C7rxjKw2.js";import"./CreatePortalModal-BFbvcIbR.js";import"./PortalSectionHeader-bfKFIMLG.js";import{C as r0}from"./CsvPreviewDialog-CSLvElod.js";import{w as ps}from"./waitForAsyncResult-CjjrhT2Q.js";import{u as s0}from"./upperFirst-BBYCtEYT.js";import{u as ms,k as i0}from"./useEntity-CtpNy3rh.js";import{D as o0}from"./DownloadTwoTone-DwiwyN_a.js";import{b as cc}from"./useSchema-CU8jzR_f.js";import{G as c0,p as a0,r as u0,D as l0}from"./DataGrid-dLdYUiIV.js";import{e as d0}from"./useUserBundle-CRYenpVP.js";import{B as ac,P as f0}from"./enums-Dwtdrxdy.js";import{a as h0,d as ge}from"./index-Chi_LkuB.js";import{g as p0}from"./_baseIteratee-_uY9ZW-D.js";import{t as m0}from"./useUploadFiles-Cma1_1Sa.js";import{D as b0}from"./DraggableDialog-CsYi8RZq.js";import{K as uc}from"./KeyboardArrowDown-B1T0t269.js";import{M as Rr}from"./MenuItem-DLvW-sib.js";import{u as g0,a as y0,b as v0,c as w0}from"./useGridSession-CNl2_6aX.js";import{A as _0}from"./Autocomplete-D0YQh8j1.js";import{G as ce}from"./Grid-9pegnziy.js";import{f as S0}from"./fetchWithExponentialTimeout-BcWxmw6r.js";import{C as E0}from"./CertificationRequirement-DDY6fSSc.js";var Ps=function(){return xh.Date.now()},C0="Expected a function",O0=Math.max,A0=Math.min;function N0(e,t,r){var i,n,o,s,a,c,l=0,u=!1,d=!1,h=!0;if(typeof e!="function")throw new TypeError(C0);t=sc(t)||0,Fe(r)&&(u=!!r.leading,d="maxWait"in r,o=d?O0(sc(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h);function f(S){var E=i,O=n;return i=n=void 0,l=S,s=e.apply(O,E),s}function g(S){return l=S,a=setTimeout(_,t),u?f(S):s}function y(S){var E=S-c,O=S-l,A=t-E;return d?A0(A,o-O):A}function w(S){var E=S-c,O=S-l;return c===void 0||E>=t||E<0||d&&O>=o}function _(){var S=Ps();if(w(S))return m(S);a=setTimeout(_,y(S))}function m(S){return a=void 0,h&&i?f(S):(i=n=void 0,s)}function b(){a!==void 0&&clearTimeout(a),l=0,i=c=n=a=void 0}function p(){return a===void 0?s:m(Ps())}function v(){var S=Ps(),E=w(S);if(i=arguments,n=this,c=S,E){if(a===void 0)return g(c);if(d)return clearTimeout(a),a=setTimeout(_,t),f(c)}return a===void 0&&(a=setTimeout(_,t)),s}return v.cancel=b,v.flush=p,v}var I0="Expected a function";function k0(e,t,r){var i=!0,n=!0;if(typeof e!="function")throw new TypeError(I0);return Fe(r)&&(i="leading"in r?!1:i,n="trailing"in r?!0:n),N0(e,t,{leading:i,maxWait:t,trailing:n})}function R0(e=!1){const t=D.useRef(e),r=D.useCallback(()=>t.current,[]);return D.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),r}function T0(e){D.useEffect(()=>{e()},[])}function x0(e,...t){const r=R0(),i=jh(t[1]),n=D.useMemo(()=>function(...o){r()&&(typeof i.current=="function"?i.current.apply(this,o):typeof i.current.handleEvent=="function"&&i.current.handleEvent.apply(this,o))},[]);D.useEffect(()=>{const o=j0(e)?e.current:e;if(!o)return;const s=t.slice(2);return Ph(o,t[0],n,...s),()=>{Mh(o,t[0],n,...s)}},[e,t[0]])}function j0(e){return e!==null&&typeof e=="object"&&Dh(e,"current")}const Ms=()=>document.visibilityState==="visible";function P0(e=!0){const[t,r]=D.useState(ic&&e?Ms():void 0);return T0(()=>{e||r(Ms())}),x0(ic?document:null,"visibilitychange",()=>{r(Ms())}),t}const M0="_button_dw0oy_1",D0={button:M0};function Ve(e){return j.jsx(Yd,{...e,className:D0.button})}try{Ve.displayName="GridMenuButton",Ve.__docgenInfo={description:"",displayName:"GridMenuButton",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function B0(e){const{synapseClient:t}=ut();return Ie({...e,mutationFn:async r=>{const i=await t.gridServicesClient.postRepoV1GridImportCsvAsyncStart({gridCsvImportRequest:r});return(await ps(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:i.token}))).responseBody}})}function vo({createdCount:e=0,updatedCount:t=0}){let r="";return e>0&&(r+=`created ${e.toLocaleString()} rows`),e>0&&t>0?r+=" and ":t==0&&(r+="."),t>0&&(r+=`updated ${t.toLocaleString()} rows.`),s0(r)}function wo(e){const{gridSessionId:t,open:r,onClose:i,onComplete:n}=e,{mutate:o,isPending:s,error:a}=B0({onSuccess:c=>{be(vo(c),"success",{title:"Data imported successfully"}),n()}});return j.jsx(r0,{open:r,onClose:i,onConfirm:(c,l,u)=>{o({concreteType:"org.sagebionetworks.repo.model.grid.GridCsvImportRequest",sessionId:t,fileHandleId:c,csvDescriptor:u,schema:l})},errorMessage:a?.message,confirmIsPending:s})}try{vo.displayName="getUpdateMessage",vo.__docgenInfo={description:"",displayName:"getUpdateMessage",props:{concreteType:{defaultValue:null,description:"@memberof GridCsvImportResponse",name:"concreteType",required:!0,type:{name:"{string}"}},sessionId:{defaultValue:null,description:`The grid session ID.
@memberof GridCsvImportResponse`,name:"sessionId",required:!1,type:{name:"{string}"}},totalCount:{defaultValue:null,description:`The total number of processed rows.
@memberof GridCsvImportResponse`,name:"totalCount",required:!1,type:{name:"{number}"}},createdCount:{defaultValue:{value:"0"},description:`The number of newly created rows in the grid.
@memberof GridCsvImportResponse`,name:"createdCount",required:!1,type:{name:"{number}"}},updatedCount:{defaultValue:{value:"0"},description:`The number of updated rows in the grid.
@memberof GridCsvImportResponse`,name:"updatedCount",required:!1,type:{name:"{number}"}}}}}catch{}try{wo.displayName="UploadCsvToGridDialog",wo.__docgenInfo={description:"",displayName:"UploadCsvToGridDialog",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onComplete:{defaultValue:null,description:"",name:"onComplete",required:!0,type:{name:"() => void"}}}}}catch{}function _o(e){const{sourceEntityId:t,gridSessionId:r}=e,[i,n]=D.useState(!1),{data:o,isLoading:s}=ms(t);return s?j.jsx(Bh,{variant:"rectangular",width:100}):o&&!qh(o)?null:j.jsxs(j.Fragment,{children:[i&&j.jsx(wo,{gridSessionId:r,open:i,onClose:()=>n(!1),onComplete:()=>n(!1)}),j.jsx(Ve,{onClick:()=>{n(!0)},variant:"outlined",startIcon:j.jsx(Lh,{}),children:"Upload"})]})}try{_o.displayName="UploadCsvToGridButton",_o.__docgenInfo={description:"",displayName:"UploadCsvToGridButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}function Qd(e){const{synapseClient:t}=ut();return Ie({...e,mutationFn:async r=>{const i=await t.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:r});return(await ps(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:i.token}))).responseBody}})}function q0(e){const{gridSessionId:t,filename:r}=e,{accessToken:i}=ut(),{mutate:n,isPending:o}=Qd({onSuccess:a=>{a?.resultsFileHandleId&&Uh(a.resultsFileHandleId,i).then(c=>fetch(c).then(l=>l.blob()).then(l=>{const u=URL.createObjectURL(l),d=document.createElement("a");d.href=u;const h=new Date().toISOString().replace(/[:.]/g,"-");d.setAttribute("download",`${r}-${h}.csv`),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u),be("CSV export completed successfully","success")})).catch(c=>{be(`Failed to download CSV: ${c instanceof Error?c.message:"Unknown error"}`,"danger")})},onError:a=>{be(`CSV export failed: ${a.reason||"Unknown error"}`,"danger")}});return{exportToCsv:()=>{n({sessionId:t,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"})},isExporting:o}}function So(e){const{gridSessionId:t,filename:r}=e,{exportToCsv:i,isExporting:n}=q0({gridSessionId:t,filename:r});return j.jsx(Ve,{onClick:i,variant:"outlined",startIcon:j.jsx(o0,{}),loading:n,children:"Export CSV"})}try{So.displayName="ExportCsvFromGridButton",So.__docgenInfo={description:"",displayName:"ExportCsvFromGridButton",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},filename:{defaultValue:null,description:"",name:"filename",required:!0,type:{name:"string"}}}}}catch{}const L0=Object.prototype;function Tr(e){for(const t in e)if(L0.hasOwnProperty.call(e,t))return!1;return!0}const U0=["array","boolean","integer","null","number","object","string"];new Set(U0);const F0=["$defs","definitions","properties","patternProperties","dependencies"];new Set(F0);const V0=["items","allOf","oneOf","anyOf"];new Set(V0);const J0=["items","additionalItems","additionalProperties","propertyNames","contains","if","then","else","not"];new Set(J0);function ss(e){return typeof e=="object"}function Ae(e){return ss(e)?Tr(e):e===!0}function dt(e,t){return e<t?-1:e>t?1:0}function Ds(e,t){const r=e.length;if(r===0)return t;let i=t.length;if(i===0)return e;if(r<i){const o=e;e=t,t=o,i=r}const n=new Set(e);for(let o=0;o<i;o++)n.add(t[o]);return Array.from(n)}function G0(e,t){const r=[];if(e.length===0||t.length===0)return r;if(e.length>t.length){const n=e;e=t,t=n}const i=new Set(t);for(let n=0;n<e.length&&i.size>0;n++){const o=e[n];i.delete(o)&&r.push(o)}return r}function lc(e){return e.length===0}function Bs(e){return(t,r)=>{const i=t.length-r.length;if(i!==0)return i;for(let n=0;n<t.length;n++)if(t[n]!==r[n]){const o=e(t[n],r[n]);if(o!==0)return o}return 0}}function Zd(e,{threshold:t=12}={}){return r=>{const i=r.length;if(i===0)return r;if(i<=t){const s=[];let a=0;e:for(let c=0;c<i;c++){const l=r[c];for(let u=0;u<a;u++)if(e(l,s[u])===0)continue e;a=s.push(l)}return s}const n=r.slice().sort(e);let o=0;for(let s=1;s<i;s++)e(n[o],n[s])!==0&&++o!==s&&(n[o]=n[s]);return n.length=o+1,n}}function z0(e){return(t,r)=>{const i=[];let n=t.length,o=r.length;if(n===0||o===0)return i;if(n>o){const u=t;t=r,r=u;const d=n;n=o,o=d}const s=[...t].sort(e),a=[...r].sort(e);let c=0,l=0;for(;c<n&&l<o;){const u=e(s[c],a[l]);u===0?((i.length===0||e(i[i.length-1],s[c])!==0)&&i.push(s[c]),c++,l++):u<0?c++:l++}return i}}function H0(e,t){return r=>{if(e.has(r))return e.get(r);const i=t(r);return e.set(r,i),i}}const dc=H0,ef=()=>0,W0=e=>e===void 0,K0=e=>typeof e!="object",fc={boolean:0,number:1,string:2};function $0(e,t){const r=typeof e,i=typeof t;return r===i?dt(e,t):fc[r]-fc[i]}function Y0(e,t){const r=e.length;if(r===0)return t;const i=t.length;if(i===0)return e;if(i>r){const s=e;e=t,t=s}const n=new Set(e),o=t.length;for(let s=0;s<o;s++){const a=t[s];n.has(a)||e.push(a)}return e}function bs(e,t,r=ef){return(i,n)=>e(i)?e(n)?r(i,n):-1:e(n)?1:t(i,n)}function lt(e){return bs(W0,e)}function qe(e,t){return bs(r=>r===void 0||e(r),t)}function qs(e,t){return bs(Array.isArray,e,t)}const re=lt(dt),Ls=qe(e=>e===0,(e,t)=>e-t);function X0({deduplicationCache:e=new WeakMap,sortedKeysCache:t=new WeakMap}={}){const r=dc(t,y=>Object.keys(y).sort());function i(y){return(w,_)=>{const m=r(w),b=r(_),p=Math.min(m.length,b.length);for(let v=0;v<p;v++){const S=dt(m[v],b[v]);if(S!==0)return S}if(m.length!==b.length)return m.length-b.length;for(let v=0;v<p;v++){const S=m[v],E=y(w[S],_[S]);if(E!==0)return E}return 0}}function n(y){const w=Bs(y),_=dc(e,Zd(y,{threshold:0}));return(m,b)=>w(_(m),_(b))}const o=n(dt);function s(y,w){if(ss(y)){if(ss(w)){const _=Object.keys(y),m=Object.keys(w),b=Y0(_,m),p=b.length;for(let v=0;v<p;v++){const S=b[v];if(y[S]===w[S])continue;const O=(g[S]??a)(y[S],w[S]);if(O!==0)return O}return 0}return w===!0&&Tr(y)?0:1}return ss(w)?y===!0&&Tr(w)?0:-1:dt(y,w)}const a=lt(l),c=bs(K0,qs(i(a),Bs(l)),$0);function l(y,w){return y===null?-1:w===null?1:c(y,w)}const u=lt(s),d=qe(Tr,i(u)),h=lt(n(s)),f=qe(Ae,s),g={$id:re,$comment:re,$defs:d,$ref:re,$schema:re,const:a,contains:u,contentEncoding:re,contentMediaType:re,default:a,definitions:d,description:re,else:u,examples:a,exclusiveMaximum:re,exclusiveMinimum:re,format:re,if:u,maximum:re,maxItems:re,maxLength:re,maxProperties:re,minimum:re,multipleOf:re,not:u,pattern:re,propertyNames:u,readOnly:re,then:u,title:re,writeOnly:re,uniqueItems:qe(y=>y===!1,ef),minLength:Ls,minItems:Ls,minProperties:Ls,required:qe(lc,o),enum:qe(lc,n(l)),type:lt((y,w)=>{const _=Array.isArray(y),m=Array.isArray(w);return!_&&!m?dt(y,w):o(_?y:[y],m?w:[w])}),items:qe(y=>!Array.isArray(y)&&Ae(y),qs(s,Bs(s))),anyOf:h,allOf:h,oneOf:h,properties:d,patternProperties:d,additionalProperties:f,additionalItems:f,dependencies:qe(Tr,i(lt(qs(s,o))))};return{compareSchemaValues:l,compareSchemaDefinitions:s}}function hc(e){return e}const tf=(e,t)=>e?tf(t%e,e):t,Q0=(e,t)=>Math.abs(e*t)/tf(e,t);function Z0(e,t){return e===t?e:`^(?=.*(?:${e}))(?=.*(?:${t})).*$`}function*Us(e,t,r){const i=e.length,n=t.length;if(i>0&&n>0)for(let o=0;o<i;o++){const s=e[o];for(let a=0;a<n;a++)yield r(s,t[a])}}function Fs(e,t){return e||t}function pc(e){return(t,r)=>{const i={...t},n=Object.keys(r),o=n.length;for(let s=0;s<o;s++){const a=n[s];i[a]=t[a]===void 0?r[a]:e(t[a],r[a])}return i}}function ep(e){const t=new Map;for(const r of e)for(const i of r[0])t.set(i,r[1]);return t}function He(e,t,r){r===void 0||Ae(r)?delete e[t]:e[t]=r}const tp=["properties","patternProperties","additionalProperties"];function mc(e){const t=Object.keys(e),r=t.length,i=[];for(let n=0;n<r;n++){const o=t[n];i.push({regExp:new RegExp(o),schema:e[o]})}return[i,t]}const bc=[[],[]];function gc(e,t,r){const i=r.length;for(let n=0;n<i;n++){const o=r[n];if(!o.regExp.test(t))continue;const s=o.schema;if(s===!1)return!0;e.push(s)}return!1}const np=["items","additionalItems"],rp=["if","then","else"];function yc(e,t){return t.if!==void 0&&(e.if=t.if),t.then!==void 0&&(e.then=t.then),t.else!==void 0&&(e.else=t.else),e}function Vs(e,t){if(e===t)return e;switch(e){case"number":if(t==="integer")return"integer";case"integer":if(t==="number")return"integer";default:return}}function We(e,t,r){return[e,t,r]}function sp(e){const t=new Map;for(const[r,i,n]of e){const o=s=>{if(!n(s))throw new Error(`Schema keys '${r}' and '${i}' are conflicting (${r}: ${JSON.stringify(s[r])}, ${i}: ${JSON.stringify(s[i])})`)};for(const s of[[r,i],[i,r]]){let a=t.get(s[0]);a===void 0&&(a=[],t.set(s[0],a)),a.push({oppositeKey:s[1],check:o})}}return t}const ip=[We("minimum","maximum",e=>e.maximum>=e.minimum),We("exclusiveMinimum","maximum",e=>e.maximum>e.exclusiveMinimum),We("minimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.minimum),We("exclusiveMinimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.exclusiveMinimum),We("minLength","maxLength",e=>e.maxLength>=e.minLength),We("minItems","maxItems",e=>e.maxItems>=e.minItems),We("minProperties","maxProperties",e=>e.maxProperties>=e.minProperties)];function op({mergePatterns:e=Z0,isSubRegExp:t=Object.is,intersectJson:r=G0,deduplicateJsonSchemaDef:i=hc,defaultMerger:n=hc,assigners:o=[],checks:s=ip,mergers:a}={}){function c(p){const v=p.length;let S=p[0];for(let E=1;E<v;E++){const O=_(S,p[E]);if(O===!1)return!1;Ae(O)||(S=O)}return S}function l(p,v,S,E,O,A,C){if(p.length=0,S===!1)return!1;if(p.push(S),O!==void 0){if(O===!1)return!1;p.push(O)}if(gc(p,v,A))return!1;const I=p.length<2;if(C===!1){if(I)return;if(gc(p,v,E))return!1}else I&&C!==void 0&&p.push(C);return p.length===1?p[0]:c(p)}function u(p,v,S,E,O,A){const C=S.length;if(C>0&&O!==!1)if(A)Object.assign(p,v);else for(let N=0;N<C;N++){const I=S[N];E.has(I)||(p[I]=_(v[I],O))}return p}const d=(p,{properties:v={},patternProperties:S,additionalProperties:E=!0},{properties:O={},patternProperties:A,additionalProperties:C=!0})=>{const N=Ae(E),I=Ae(C);if(N&&I)return He(p,"properties",m(v,O)),He(p,"patternProperties",S&&A?m(S,A):S??A),delete p.additionalProperties,p;const k=_(E,C);He(p,"additionalProperties",k);const R={},x=Object.keys(v),T=x.length,[M,q]=S?mc(S):bc,[U,V]=A?mc(A):bc,F=[],L=new Set,ee=I?void 0:C;for(let Q=0;Q<T;Q++){const ie=x[Q];L.add(ie);const de=l(F,ie,v[ie],M,O[ie],U,ee);de!==void 0&&(R[ie]=de)}const X=Object.keys(O),le=X.length,Se=N?void 0:E;for(let Q=0;Q<le;Q++){const ie=X[Q];if(L.has(ie))continue;const de=l(F,ie,O[ie],U,void 0,M,Se);de!==void 0&&(R[ie]=de)}He(p,"properties",R);let K={};const Y=new Set;if(q.length>0&&V.length>0){const Q=Us(q,V,(ie,de)=>{t(ie,de)&&Y.add(ie),t(de,ie)&&Y.add(de),K[e(ie,de)]=_(S[ie],A[de])});for(;!Q.next().done;);}return K=u(K,S,q,Y,C,I),K=u(K,A,V,Y,E,N),He(p,"patternProperties",K),p},h=(p,{items:v=[],additionalItems:S},{items:E=[],additionalItems:O})=>{const A=Array.isArray(v),C=Array.isArray(E),N=[];if(p.items=N,A&&C){const[I,k,R]=v.length<E.length?[v.length,S,E]:[E.length,O,v];let x=0;for(;x<I;x++)N.push(_(v[x],E[x]));if(k===!1)p.additionalItems=!1;else{const T=k===void 0||Ae(k);for(;x<R.length;x++)N.push(T?R[x]:_(R[x],k));He(p,"additionalItems",S!==void 0&&O!==void 0?_(S,O):S??O)}}else if(A||C){const[I,k,R]=A?[v,E,S]:[E,v,O];He(p,"additionalItems",R&&_(R,k));for(let x=0;x<I.length;x++)N.push(_(I[x],k))}else delete p.additionalItems,p.items=_(v,E);return p},f=(p,v,S)=>{yc(p,v);const E=yc({},S);return p.allOf===void 0?p.allOf=[E]:p.allOf=p.allOf.concat(E),p};function g(p,v){return i(Array.from(Us(p,v,_)))}const y=ep([[tp,d],[np,h],[rp,f],...o]),w=sp(s);function _(p,v){if(p===!1||v===!1)return!1;if(Ae(p))return Ae(v)?!0:v;if(Ae(v))return p;let S={...p};const E=new Set,O=new Set,A=Object.keys(v),C=A.length;for(let N=0;N<C;N++){const I=A[N],k=v[I];if(k===void 0)continue;const R=w.get(I);if(R!==void 0){const q=R.length;for(let U=0;U<q;U++){const V=R[U];p[V.oppositeKey]!==void 0&&O.add(V.check)}}const x=p[I];if(x===void 0){S[I]=k;continue}const T=y.get(I);if(T){E.add(T);continue}const M=b[I]??n;S[I]=M(x,k)}for(const N of E)S=N(S,p,v);for(const N of O)N(S);return S}const m=pc(_),b={$id:n,$ref:n,$schema:n,$comment:n,$defs:m,definitions:m,type:(p,v)=>{if(p===v)return p;const S=Array.isArray(p),E=Array.isArray(v);if(!S&&!E){const O=Vs(p,v);if(O!==void 0)return O}else if(S||E){const O=new Set;if(S&&E)for(const C of Us(p,v,Vs))C!==void 0&&O.add(C);else{const C=S?p:v,N=S?v:p,I=C.length;for(let k=0;k<I;k++){const R=Vs(N,C[k]);R!==void 0&&O.add(R)}}const A=O.size;if(A===1)return O.values().next().value;if(A>1)return Array.from(O)}throw new Error(`It is not possible to create an intersection of the following incompatible types: ${p.toString()}, ${v.toString()}`)},default:n,description:n,title:n,const:n,format:n,contentEncoding:n,contentMediaType:n,not:(p,v)=>{const S=i([p,v]);return S.length===1?S[0]:{anyOf:S}},pattern:e,readOnly:Fs,writeOnly:Fs,enum:(p,v)=>{const S=r(p,v);if(S.length===0)throw new Error(`Intersection of the following enums is empty: "${JSON.stringify(p)}", "${JSON.stringify(v)}"`);return S},anyOf:g,oneOf:g,allOf:(p,v)=>i(p.concat(v)),propertyNames:_,contains:_,dependencies:pc((p,v)=>Array.isArray(p)?Array.isArray(v)?Ds(p,v):_(v,{required:p}):Array.isArray(v)?_(p,{required:v}):_(p,v)),examples:(p,v)=>{if(!Array.isArray(p)||!Array.isArray(v))throw new Error(`Value of the 'examples' field should be an array, but got "${JSON.stringify(p)}" and "${JSON.stringify(v)}"`);return Ds(p,v)},multipleOf:(p,v)=>{let S=1;for(;!Number.isInteger(p)||!Number.isInteger(v);)S*=10,p*=10,v*=10;return Q0(p,v)/S},exclusiveMaximum:Math.min,maximum:Math.min,maxItems:Math.min,maxLength:Math.min,maxProperties:Math.min,exclusiveMinimum:Math.max,minimum:Math.max,minItems:Math.max,minLength:Math.max,minProperties:Math.max,uniqueItems:Fs,required:Ds,...a};return{mergeSchemaDefinitions:_,mergeArrayOfSchemaDefinitions:c}}function cp(e){const t=[],r=[e];for(;r.length>0;){const i=r.pop();if(typeof i=="boolean"||i.allOf===void 0){t.push(i);continue}const{allOf:n,...o}=i;t.push(o);for(let s=n.length-1;s>=0;s--)r.push(n[s])}return t}function ap(e){return t=>e(cp(t))}const{compareSchemaDefinitions:up,compareSchemaValues:lp}=X0(),{mergeArrayOfSchemaDefinitions:dp}=op({intersectJson:z0(lp),deduplicateJsonSchemaDef:Zd(up)}),fp=ap(dp),hp=["id","createdBy","createdOn","modifiedBy","modifiedOn","etag","concreteType","parentId","path","type","currentVersion","benefactorId"];function pp(e){if(!e.properties)return e;const t={...e.properties};return hp.forEach(i=>{t[i]?t[i]={...Fe(t[i])?t[i]:{},readOnly:!0}:t[i]={readOnly:!0}}),{...e,properties:t}}function mp(e){const{data:t}=cc(e?.gridJsonSchema$Id??"",{enabled:!!e?.gridJsonSchema$Id}),{data:r}=ms(e?.sourceEntityId,void 0,{enabled:!!e?.sourceEntityId});let i=!1;r&&Fh(r)&&(i=!0);const{data:n}=cc("org.sagebionetworks-repo.model.Entity",{enabled:i,select:pp});return D.useMemo(()=>t&&n?fp({allOf:[n,t]}):t,[t,n])}function bp(e){const{keyFactory:t,synapseClient:r}=ut(),i=Xd();return Ie({...e,mutationFn:async n=>{const o=await r.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:n.entityId,tableUpdateTransactionRequest:n});return(await ps(()=>r.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:o.token}))).responseBody},onSuccess:async(n,o,s)=>{await Vh(i,t,o.entityId)}})}function gp(e){const t=Xd(),{mutateAsync:r}=Qd(),{mutateAsync:i}=bp(),n=i0();return Ie({...e,mutationFn:async({gridSessionId:o,sourceEntityId:s})=>{const a=await t.fetchQuery(n(s)),c={...yp(a),sessionId:o},l=await r(c),u={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:s,changes:[{uploadFileHandleId:l.resultsFileHandleId,tableId:s,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return i(u)}})}function yp(e){return Jh(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}function vp(e){const{synapseClient:t}=ut();return Ie({...e,mutationFn:async({gridSessionId:r})=>{const i={sessionId:r,concreteType:"org.sagebionetworks.repo.model.grid.GridRecordSetExportRequest"},n=await t.gridServicesClient.postRepoV1GridExportRecordsetAsyncStart({gridRecordSetExportRequest:i});return(await ps(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:n.token}))).responseBody}})}function wp(e){const t=gp(),r=vp();return Ie({...e,mutationFn:async({gridSessionId:i,sourceEntityId:n,sourceEntityType:o})=>o===Gh.recordset?{type:"recordset",data:await r.mutateAsync({gridSessionId:i})}:{type:"table",data:await t.mutateAsync({gridSessionId:i,sourceEntityId:n})}})}function Eo(e){const{sourceEntityId:t,gridSessionId:r}=e,{data:i,isLoading:n}=ms(t),o=i?.concreteType?zh(i.concreteType):void 0,{mutate:s,isPending:a}=wp({onSuccess:c=>{c.type==="table"?_p(c.data):be("Successfully updated RecordSet.","success")},onError:c=>be(c.message,"danger")});return j.jsx(Ve,{loading:a,disabled:n,onClick:()=>s({gridSessionId:r,sourceEntityId:t,sourceEntityType:o}),variant:"contained",children:"Apply changes"})}function _p(e){if(e.results?.length){const t=e.results[0];if(Hh(t)){const r=Sp(t).join(`
`);r?be(`Some changes could not be applied:
${r}`,"danger"):be("Changes applied successfully","success")}else if(Wh(t)){const r=t.rowsProcessed?.toLocaleString();be(`Successfully updated ${r} rows.`,"success")}}}function Sp(e){return e.updateResults?.filter(t=>!!t.failureCode).map(t=>`${t.entityId}: ${t.failureMessage} (code: ${t.failureCode})`)??[]}try{Eo.displayName="MergeGridWithSourceTableButton",Eo.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},sourceEntityType:{defaultValue:null,description:"",name:"sourceEntityType",required:!1,type:{name:"enum",value:[{value:'"link"'},{value:'"table"'},{value:'"project"'},{value:'"folder"'},{value:'"file"'},{value:'"entityview"'},{value:'"dockerrepo"'},{value:'"submissionview"'},{value:'"dataset"'},{value:'"datasetcollection"'},{value:'"materializedview"'},{value:'"virtualtable"'},{value:'"recordset"'}]}}}}}catch{}function Ep(e,t){const r={},i=t.api.getSnapshot();if(vc(i.rows,e.min.row,e.max.row))r.rowSelectAll=!0;else{const n=t.api.arr(["rows"]);r.rowSelection=wc(n,e.min.row,e.max.row)}if(vc(i.columnOrder,e.min.col,e.max.col))r.columnSelectAll=!0;else{const n=t.api.arr(["columnOrder"]);r.columnSelection=wc(n,e.min.col,e.max.col)}return r}function vc(e,t,r){return t===0&&r===e.length-1}function wc(e,t,r){const i=[];for(let n=t;n<=r;n++){const o=e.node.findChunk(n);if(o){const[s,a]=o;i.push({rep:s.id.sid,seq:s.id.time+a})}else console.warn(`getCrdtIdsForArrayRange: No chunk found for array index ${n}. This may indicate an unexpected state.`)}return i}function Cp(e,t){let r;try{r=e.api.con(["rows",String(t),"metadata","rowValidation"])}catch{return!1}const i=r?.node?.id;try{const n=e.api.vec(["rows",String(t),"data"]);for(let o=0;o<n?.length();o++)if(n.get(o).asCon().node.id.time>i?.time)return!1}catch{}return!0}function Op(e){return`[${e.sid},${e.time}]`}function Ap(e){const t=new Map,r=/^#(?:\/([^/:]+)(?:\/\d+)?)?:\s*(.*)$/;for(const i of e){if(typeof i!="string")continue;const o=i.trimStart().match(r);if(o){let s=o[1]?.trim()??"_row";const a=o[2].trim();if(s==="_row"){const c=a.match(/^required key \[([^\]]+)\] not found$/i);c&&(s=c[1])}t.has(s)||t.set(s,[]),t.get(s).push(a)}}return t}function Np(e,t){if(!e||!t)return[];const{columnNames:r,columnOrder:i,rows:n}=t;return n.map((s,a)=>{const c={};return i.forEach(l=>{const u=r[l];u&&(c[u]=s.data[l])}),c[c0]=Op(e.api.obj(["rows",String(a)]).node.id),c.__validationResults=s.metadata?.rowValidation,c.__validationResults&&(c.__validationStatus=c.__validationResults?.isValid?"valid":"invalid"),Cp(e,a)||(c.__validationStatus="pending"),c.__validationResults?.allValidationMessages&&(c.__cellValidationResults=Ap(c.__validationResults.allValidationMessages)),c})}function Ip(e){return Fe(e)&&"type"in e&&(e.type=="null"||Kh(e.type,["null"]))}function nf(e){if(e?.oneOf&&ft(e.oneOf)){const t=e.oneOf.filter(r=>!Ip(r));if(t.length==1&&Fe(t[0]))return t[0]}}function kp(e){return{value:e.value}}function Rp(e){return ft(e)&&e.every(t=>Fe(t)&&"const"in t)}function _c(e){let t=[];if(e.type==="boolean")return[{value:!0},{value:!1}];try{if(e?.oneOf&&ft(e.oneOf)&&!Rp(e.oneOf)){const r=nf(e);r&&Object.hasOwn(r,"enum")&&(t=ac(r)||[])}else t=ac(e)||[]}catch(r){console.error("Error getting enumerated values from schema",r,e)}return t.map(kp)}function Tp(e,t){return p0(e,[f0,t],{})}function xp(e){if(!e||!Fe(e))return[];const t=new Set,r=new Set;function i(n){if(!(!Fe(n)||r.has(n))){if(r.add(n),ft(n.required))for(const o of n.required)typeof o=="string"&&t.add(o);["allOf"].forEach(o=>{const s=n[o];ft(s)&&s.forEach(a=>i(a))})}}return i(e),Array.from(t)}const Sc={type:"string",isArray:!1};function Co(e){const t={...Sc};if(e.format&&(t.format=e.format),e.readOnly&&(t.readOnly=e.readOnly),e.type){if(e.type==="array"&&e.items){const r=Array.isArray(e.items)?e.items[0]:e.items,i=Co(r)??Sc;return{...t,...i,isArray:!0}}return{...t,type:e.type}}if(e?.oneOf&&ft(e.oneOf)){const r=nf(e);if(r)return Co(r)}return t}function jp(e){if(!e)return{};const t=xp(e),r={};return e.properties&&Object.keys(e.properties).forEach(i=>{const n=Tp(e,i),o=Co(n);let s=_c(n).map(a=>a.value);if(s.length===0&&n&&n.items){const a=Array.isArray(n.items)?n.items[0]:n.items;s=_c(a).map(c=>c.value)}r[i]={type:o,isRequired:t.includes(i),enumeratedValues:s.length>0?s:null}}),r}var Js={};const z=h0(m0);var yt={},vt={},Ec;function Br(){if(Ec)return vt;Ec=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.context=void 0;const e=B();return vt.context=e.createContext(null),vt}var Gs={},Cc;function ue(){return Cc||(Cc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useStyles=e.context=void 0;const t=B();e.context=t.createContext({});const r=()=>t.useContext(e.context);e.useStyles=r})(Gs)),Gs}var zs={},Hs={},Ws={},Ks={},Oc;function Pp(){return Oc||(Oc=1,Object.defineProperty(Ks,"__esModule",{value:!0})),Ks}var Ee={},Ac;function Mp(){if(Ac)return Ee;Ac=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.COLOR=Ee.SYMBOL=Ee.ZINDEX=Ee.SIZE=void 0;var e;(function(n){n[n.SITE_WIDTH=1300]="SITE_WIDTH",n[n.SITE_PADDING=32]="SITE_PADDING",n[n.PAGE_WIDTH=1e3]="PAGE_WIDTH",n[n.TOP_NAV_HEIGHT=64]="TOP_NAV_HEIGHT",n[n.SIDEBAR_WIDTH=300]="SIDEBAR_WIDTH"})(e||(Ee.SIZE=e={}));var t;(function(n){n[n.TOP_NAV=1e3]="TOP_NAV",n[n.SIDEBAR=1001]="SIDEBAR",n[n.CONTEXT=1002]="CONTEXT",n[n.PROGRESS=2e3]="PROGRESS",n[n.MODAL=4e3]="MODAL",n[n.CURSOR=1e6]="CURSOR"})(t||(Ee.ZINDEX=t={}));var r;(function(n){n.CHECKMARK="✓",n.CROSS="✗",n.NIL="∅",n.ELLIPSIS="…",n.MDASH="—",n.NDASH="–",n.FDASH="‒",n.CTRL="⌃",n.CMD="⌘",n.ALT="⌥",n.SHIFT="⇧"})(r||(Ee.SYMBOL=r={}));var i;return(function(n){n.LINK="#0089ff"})(i||(Ee.COLOR=i={})),Ee}var $s={},Ys={},Nc;function Ic(){if(Nc)return Ys;Nc=1;var e=/[A-Z]/g,t=function(r){for(var i=5381,n=r.length;n;)i=i*33^r.charCodeAt(--n);return"_"+(i>>>0).toString(36)};return Ys.create=function(r){r=r||{};var i=r.assign||Object.assign,n=typeof window=="object",o=i({raw:"",pfx:"_",client:n,assign:i,stringify:JSON.stringify,kebab:function(s){return s.replace(e,"-$&").toLowerCase()},decl:function(s,a){return s=o.kebab(s),s+":"+a+";"},hash:function(s){return t(o.stringify(s))},selector:function(s,a){return s+(a[0]===":"?"":" ")+a},putRaw:function(s){o.raw+=s}},r);return o.client&&(o.sh||document.head.appendChild(o.sh=document.createElement("style")),o.putRaw=function(s){{var a=o.sh.sheet;try{a.insertRule(s,a.cssRules.length)}catch{}}}),o.put=function(s,a,c){var l="",u,d,h=[];for(u in a)d=a[u],d instanceof Object&&!(d instanceof Array)?h.push(u):l+=o.decl(u,d,s,c);l&&(l=s+"{"+l+"}",o.putRaw(c?c+"{"+l+"}":l));for(var f=0;f<h.length;f++)u=h[f],u[0]==="@"&&u!=="@font-face"?o.putAt(s,a[u],u):o.put(o.selector(s,u),a[u],c)},o.putAt=o.put,o},Ys}var Xs={},kc;function Dp(){return kc||(kc=1,Xs.addon=function(e){var t={};e.cache=function(r){if(!r)return"";var i=e.hash(r);return t[i]||(t[i]=e.rule(r,i)),t[i]}}),Xs}var Qs={},Zs,Rc;function Bp(){if(Rc)return Zs;Rc=1;var e=Object.keys,t=JSON.stringify;function r(i,n){var o,s,a,c,l,u,d;if(d=typeof i,d==="string")return t(i);if(i===!0)return"true";if(i===!1)return"false";if(i===null)return"null";if(i instanceof Array){for(a="[",s=i.length-1,o=0;o<s;o++)a+=r(i[o],!1)+",";return s>-1&&(a+=r(i[o],!1)),a+"]"}if(i instanceof Object){if(typeof i.toJSON=="function")return r(i.toJSON(),n);for(c=e(i).sort(),s=c.length,a="",o=0;o<s;)l=c[o],u=r(i[l],!0),u!==void 0&&(o&&a!==""&&(a+=","),a+=t(l)+":"+u),o++;return"{"+a+"}"}switch(d){case"function":case"undefined":return n?void 0:null;default:return isFinite(i)?i:null}}return Zs=function(i){return""+r(i,!1)},Zs}var Tc;function qp(){if(Tc)return Qs;Tc=1;var e=Bp();return Qs.addon=function(t){t.stringify=e},Qs}var ei={},xc;function Lp(){return xc||(xc=1,ei.addon=function(e){e.selector=function(t,r){var i=t.split(","),n=[],o=r.split(","),s=i.length,a=o.length,c,l,u,d,h,f;for(c=0;c<a;c++)if(u=o[c],d=u.indexOf("&"),d>-1)for(l=0;l<s;l++)h=i[l],f=u.replace(/&/g,h),n.push(f);else for(l=0;l<s;l++)h=i[l],h?n.push(h+" "+u):n.push(u);return n.join(",")}}),ei}var zr={},jc;function Up(){if(jc)return zr;jc=1;var e="position",t="top",r="right",i="bottom",n="left",o="width",s="height",a="overflow",c="color",l="content",u=a+"-x",d=a+"-y",h="flex",f=h+"-direction",g=h+"-grow",y=h+"-shrink",w=h+"-basis",_=h+"-wrap",m="align",b=m+"-items",p=m+"-"+l,v=m+"-self",S="margin",E=S+"-"+t,O=S+"-"+r,A=S+"-"+i,C=S+"-"+n,N="padding",I=N+"-"+t,k=N+"-"+r,R=N+"-"+i,x=N+"-"+n,T="border",M=T+"-"+t,q=T+"-"+r,U=T+"-"+i,V=T+"-"+n,F=T+"-radius",L="background",ee=L+"-"+c,X=L+"-image",le=L+"-repeat",Se=L+"-attachment",K=L+"-position",Y=L+"-size",Q=L+"-origin",ie=L+"-clip",de="style",bt="font",gh=bt+"-size",yh=bt+"-"+de,vh=bt+"-weight",wh=bt+"-family",gt="text",_h=gt+"-align",Sh=gt+"-decoration",Eh=gt+"-transform",Ch=gt+"-shadow",Oh=gt+"-overflow",js="stroke",Ah=js+"-width",Nh=js+"-linecap",ze="animation",Ih=ze+"-name",kh=zr.atoms={pos:e,t,r,b:i,l:n,z:"z-index",d:"display",vis:"visibility",w:o,h:s,minW:"min-"+o,maxW:"max-"+o,minH:"min-"+s,maxH:"max-"+s,ov:a,ovx:u,ovy:d,bxz:"box-sizing",cl:"clip",clp:"clip-path",clr:"clear",tbl:"table-layout",fl:h,fld:f,flg:g,fls:y,flb:w,flw:_,jc:"justify-"+l,ai:b,ac:p,as:v,mr:S,mrt:E,mrr:O,mrb:A,mrl:C,mar:S,mart:E,marr:O,marb:A,marl:C,pd:N,pdt:I,pdr:k,pdb:R,pdl:x,pad:N,padt:I,padr:k,padb:R,padl:x,bd:T,bdt:M,bdr:q,bdb:U,bdl:V,bdrad:F,bdc:T+"-"+c,bds:T+"-"+de,out:"outline",bxsh:"box-shadow",col:c,op:"opacity",bg:L,bgc:ee,bgi:X,bgr:le,bga:Se,bgp:K,bgs:Y,bgo:Q,bgcl:ie,bdfl:"backdrop-filter",bfvis:"backface-visibility",f:bt,fz:gh,fs:yh,fw:vh,ff:wh,ta:_h,td:Sh,tt:Eh,ts:Ch,tov:Oh,ww:"word-wrap",lts:"letter-spacing",ws:"white-space",lh:"line-"+s,va:"vertical-"+m,cur:"cursor",pe:"pointer-events",us:"user-select",an:ze,ann:Ih,and:ze+"-duration",anf:ze+"-fill-mode",anit:ze+"-iteration-count",anp:ze+"-play-state",ant:ze+"-timing-function",trs:"transition",tr:"transform",st:js,stw:Ah,stl:Nh,ls:"list-"+de,con:l};return zr.addon=function(nc){var Rh=nc.decl;nc.decl=function(rc,Th){return Rh(kh[rc]||rc,Th)}},zr}var ti={},Pc;function Fp(){return Pc||(Pc=1,ti.addon=function(e){e.rule=function(t,r){return r=r||e.hash(t),r=e.pfx+r,e.put("."+r,t)," "+r}}),ti}var ni={},Mc;function Vp(){return Mc||(Mc=1,ni.addon=function(e){e.drule=function(t,r){var i=e.rule(t,r),n=function(o){if(!o)return i;var s=e.cache(o);return i+s};return n.toString=function(){return i},n}}),ni}var ri={},Dc;function Jp(){return Dc||(Dc=1,ri.addon=function(e,t){t=e.assign({prefixes:["-webkit-","-moz-","-o-",""]},t||{});var r=t.prefixes;e.client&&document.head.appendChild(e.ksh=document.createElement("style"));var i=e.putAt;e.putAt=function(n,o,s){if(s[1]==="k"){var a="";for(var c in o){var l=o[c],u="";for(var d in l)u+=e.decl(d,l[d]);a+=c+"{"+u+"}"}for(var h=0;h<r.length;h++){var f=r[h],g=s.replace("@keyframes","@"+f+"keyframes")+"{"+a+"}";e.client?e.ksh.appendChild(document.createTextNode(g)):e.putRaw(g)}return}i(n,o,s)},e.keyframes=function(n,o){return o||(o=e.hash(n)),o=e.pfx+o,e.putAt("",n,"@keyframes "+o),o}}),ri}var si={},Bc;function Gp(){return Bc||(Bc=1,si.addon=function(e){var t={html:{lineHeight:1.15,"-webkit-text-size-adjust":"100%"},body:{margin:0},h1:{fontSize:"2em",margin:"0.67em 0"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp":{fontFamily:"monospace, monospace",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:1.15,margin:0},"button,input":{overflow:"visible"},"button,select":{textTransform:"none"},fieldset:{padding:"0.35em 0.75em 0.625em"},legend:{boxSizing:"border-box",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{verticalAlign:"baseline"},summary:{display:"list-item"}};e.put("",t)}),si}var ii={},qc;function zp(){return qc||(qc=1,ii.addon=function(e){e.put("",{"html, body":{fontFamily:'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif',fontWeight:400,fontSize:"16px","-moz-text-size-adjust":"100%","-ms-text-size-adjust":"100%","-webkit-text-size-adjust":"100%","text-size-adjust":"100%","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"}})}),ii}var oi={},Lc;function Hp(){if(Lc)return oi;Lc=1;function e(t,r,i){var n="?family="+encodeURIComponent(t);return r&&(r instanceof Array||(r=[r]),n+=":"+r.join(",")),i&&(i instanceof Array||(i=[i]),n+="&subset="+i.join(",")),"https://fonts.googleapis.com/css"+n}return oi.addon=function(t){t.client?t.googleFont=function(r,i,n){var o=document.createElement("link");o.href=e(r,i,n),o.rel="stylesheet",o.type="text/css",document.head.appendChild(o)}:t.googleFont=function(r,i,n){t.putRaw("@import url('"+e(r,i,n)+"');")}},oi}var Uc;function rf(){return Uc||(Uc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nano=e.googleFont=e.keyframes=e.drule=e.rule=e.put=e.reset=void 0;const t=z,r=Ic(),i=Dp(),n=qp(),o=Lp(),s=Up(),a=Fp(),c=Vp(),l=Jp(),u=Gp(),d=zp(),h=Hp();t.__exportStar(Ic(),e);const f=(0,r.create)({pfx:"nano-css"});e.nano=f,(0,i.addon)(f),(0,n.addon)(f),(0,o.addon)(f),(0,s.addon)(f),(0,a.addon)(f),(0,c.addon)(f),(0,l.addon)(f),(0,h.addon)(f);const g=()=>{(0,u.addon)(f),(0,d.addon)(f)};e.reset=g,e.put=f.put,e.rule=f.rule,e.drule=f.drule,e.keyframes=f.keyframes,e.googleFont=f.googleFont})($s)),$s}var ci={},Fc;function Wp(){return Fc||(Fc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.m4=e.m3=e.m2=e.m1=e.b4=e.b3=e.b2=e.b1=void 0,e.b1=520,e.b2=960,e.b3=1300,e.b4=1800,e.m1=`@media (max-width:${e.b1}px)`,e.m2=`@media (max-width:${e.b2}px)`,e.m3=`@media (max-width:${e.b3}px)`,e.m4=`@media (max-width:${e.b4}px)`})(ci)),ci}var wt={},Vc;function sf(){if(Vc)return wt;Vc=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.font=void 0;const e='"Open Sans",sans-serif',t='"Merriweather","Linux Libertine"',r='"Roboto Slab"',i='Ubuntu,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Cantarell,"Open Sans","Helvetica Neue",sans-serif',n='-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,"Apple Color Emoji",Arial,sans-serif,"Segoe UI Emoji","Segoe UI Symbol",'+i,o="Roboto,sans-serif,"+n;return wt.font={sans:{lite:{fw:300,ff:e},mid:{fw:400,ff:e},bold:{fw:700,ff:e},black:{fw:800,ff:e}},serif:{lite:{fw:300,ff:t},mid:{fw:400,ff:t},bold:{fw:700,ff:t},black:{fw:700,ff:t}},slab:{lite:{fw:300,ff:r},mid:{fw:400,ff:r},bold:{fw:700,ff:r},black:{fw:800,ff:r}},mono:{mid:{fw:300,ff:'"Menlo","DejaVu Sans Mono","Roboto Mono","Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'},bold:{fw:400,ff:'"Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'}},ui1:{lite:{fw:300,ff:i},mid:{fw:400,ff:i},bold:{fw:700,ff:i},black:{fw:800,ff:i}},ui2:{lite:{fw:300,ff:n},mid:{fw:400,ff:n},bold:{fw:700,ff:n},black:{fw:800,ff:n}},ui3:{lite:{fw:300,ff:o},mid:{fw:400,ff:o},bold:{fw:700,ff:o},black:{fw:800,ff:o}}},wt}var ai={},ui={},_t={},Jc;function Kp(){if(Jc)return _t;Jc=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.hash=void 0;const e=t=>{let r=5381,i=t.length;for(;i;)r=r*33^t.charCodeAt(--i);return r>>>0};return _t.hash=e,_t}var Gc;function of(){return Gc||(Gc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toColor=e.color=void 0,e.color=["#FFC312","#F79F1F","#EE5A24","#EA2027","#C4E538","#A3CB38","#009432","#006266","#12CBC4","#1289A7","#0652DD","#1B1464","#9980FA","#ED4C67","#B53471","#833471","#6F1E51","#e27d60","#85dcbb","#e8a87c","#c38d9e","#41b3a3","#242582","#553d67","#f64c72","#99738e","#2f2fa2","#05386b","#fc4445","#3feee6","#55bcc9","#8ee4af","#5cdb95","#907163","#379683","#84ceeb","#5ab9ea","#8860d0","#75b5d8","#a64ac9","#fccd04","#17e9e0","#61892f","#86c232","#222629","#474b4f","#6b6e70","#eadb02","#46344e","#5a5560","#fa72a1","#e64398","#f78888","#1FB6FF","#13CE66","#FF4949","#FFC82C","#76266C","#8C2E5E","#5B2971","#9B344E","#4D2B73","#AA4139","#432F75","#AA5D38","#702D0C","#3C1200","#353377","#FE8C00","#FE7301","#FE4301","#FE0100","#E5013B","#CC0174","#A0048C","#560DAB","#252AAC","#0A6BA1","#09A471","#9DED05"];const t=Kp(),r=i=>e.color[(0,t.hash)(i)%e.color.length];e.toColor=r})(ui)),ui}var zc;function Do(){return zc||(zc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.theme=e.lightTheme=void 0;const t=of(),r=sf(),i=(s,a=1)=>{const c=Math.round(255*s);return`rgba(${c},${c},${c},${a})`},n=[0,4,8,16,24,32,64,128,256,512],o=[10,12,14,16,20,24,32,48,64,96,128];e.lightTheme={isLight:!0,name:"light",bg:"#fff",color:{color:t.color,sem:{accent:["#07f","#1340EB","#07ACEB"],blue:["#07f","#1340EB","#07ACEB"],positive:["#13CE66","#16BA32","#38D420"],negative:["#FF4949","#EB4C31","#DB521A"],warning:["#FFC82C","#EBC715","#DBCC00"],link:["#0089ff","#134EEB","#07BBEB"],brand:["#E44A28","#985DF7","#EE69B1","#F6A832","#5FCC8A","#58B9F8"]},ui:{lightLine:i(.1,.04),line:i(.1,.08),lineDark:i(.1,.16)}},font:r.font,green:s=>`rgba(19,206,102,${s})`,red:s=>`rgba(225,20,10,${s})`,blue:s=>`rgba(40,160,222,${s})`,fontSize:(s=0)=>o[Math.min(Math.max(s+3,0),o.length-1)],space:(s=0)=>n[Math.min(Math.max(s+3,0),n.length-1)],g:i},e.theme=e.lightTheme})(ai)),ai}var St={},Hc;function cf(){if(Hc)return St;Hc=1,Object.defineProperty(St,"__esModule",{value:!0}),St.darkTheme=void 0;const e=Do(),t=(r,i=1)=>{const n=255-Math.round(255*r);return`rgba(${n},${n},${n},${i})`};return St.darkTheme=Object.assign(Object.assign({},e.lightTheme),{isLight:!1,name:"dark",bg:"#101921",color:Object.assign(Object.assign({},e.lightTheme.color),{ui:{lightLine:t(.1,.04),line:t(.1,.08),lineDark:t(.1,.16)}}),g:t}),St}var li={},Hr={},he={},Wc;function af(){if(Wc)return he;Wc=1,Object.defineProperty(he,"__esModule",{value:!0}),he.isNavigator=he.isBrowser=he.off=he.on=he.noop=void 0;var e=function(){};he.noop=e;function t(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];i&&i.addEventListener&&i.addEventListener.apply(i,n)}he.on=t;function r(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];i&&i.removeEventListener&&i.removeEventListener.apply(i,n)}return he.off=r,he.isBrowser=typeof window<"u",he.isNavigator=typeof navigator<"u",he}var Kc;function $p(){if(Kc)return Hr;Kc=1,Object.defineProperty(Hr,"__esModule",{value:!0});var e=B(),t=af(),r=t.isBrowser?e.useLayoutEffect:e.useEffect;return Hr.default=r,Hr}var $c;function Yp(){return $c||($c=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalCss=e.makeRule=e.useRule=e.useTheme=e.Provider=void 0;const t=B(),r=Do(),i=cf(),n=rf(),o=t.createContext(r.lightTheme);e.Provider=t.memo(({theme:d,children:h})=>{const f=d==="light"?r.lightTheme:i.darkTheme;return t.createElement(o.Provider,{value:f},h)});const s=()=>t.useContext(o);e.useTheme=s;const a=d=>{const h=(0,e.useTheme)(),f=d(h);return n.nano.cache(f)};e.useRule=a;const c=d=>()=>(0,e.useRule)(d);e.makeRule=c;const l=$p(),u=()=>{const d=(0,e.useTheme)();return(0,l.default)(()=>{document.body.style.background=d.bg,document.body.style.color=d.g(.05,.85)},[d]),null};e.GlobalCss=u})(li)),li}var Yc;function ne(){return Yc||(Yc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(Pp(),e),t.__exportStar(Mp(),e),t.__exportStar(rf(),e),t.__exportStar(Wp(),e),t.__exportStar(sf(),e),t.__exportStar(Do(),e),t.__exportStar(cf(),e),t.__exportStar(Yp(),e),t.__exportStar(of(),e)})(Ws)),Ws}var Xc;function se(){return Xc||(Xc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bottomRightActionPos=e.tooltip=e.insArrButton=e.insArrLine=e.insArrDot=e.insArrBlock=e.bracketHovered=e.collapsed=e.collapser=e.bracket=e.lineInner=e.line=e.list=e.colon=e.inputActive=e.input=e.property=e.quote=e.ValueColor=e.object=e.block=e.negative=e.blue=void 0;const t=ne();e.blue=t.theme.color.sem.blue[0],e.negative=t.theme.color.sem.negative[0],e.block=(0,t.rule)({d:"inline-block",ff:"monospace",col:t.theme.g(.1)}),e.object=(0,t.rule)({pos:"relative",d:"inline-block"}),e.ValueColor={nil:[t.theme.g(0,.4),t.darkTheme.g(0,.4)],undef:[t.theme.g(0,.2),t.darkTheme.g(0,.2)],str:["#e00e44","#f01e54"],bool:["#411888","#9168c8"],num:["#0a8F3F","#0FaF4F"],zero:["#748A00","#94AA11"],float:["#016873","#51a8b3"]},e.quote=(0,t.rule)({col:"#E84D3D"}),e.property=(0,t.rule)({pad:"0",fw:"bold",bxz:"border-box",va:"top"});const r={col:t.theme.g(0),pd:"5px",bg:t.theme.bg,bd:`1px solid ${t.theme.g(.7)}`,mr:"-6px",out:0};e.input=(0,t.rule)({z:2,pos:"relative",bd:0,mar:0,pad:0,bg:"transparent",bdrad:"5px",d:"inline-block",minW:"auto",w:"auto","&::selection":{col:"#fff",bgc:e.blue},input:{out:0}}),e.inputActive=(0,t.rule)(r),e.colon=(0,t.rule)({pd:"0 8px 0 0px",cur:"default",va:"top","&>span":{pd:"0 2px"},"&:hover":{"&>span":{out:`1px dotted ${e.blue}`}}}),e.list=(0,t.rule)({d:"block",listStyleType:"none",pd:0,mr:"0 0 0 32px"}),e.line=(0,t.rule)({d:"block",ls:"none",pd:0,mr:0}),e.lineInner=(0,t.rule)({d:"inline-block"}),e.bracket=(0,t.rule)({pos:"relative",cur:"default"}),e.collapser=(0,t.rule)({pd:"0 6px",pos:"absolute",t:"0px",l:"-24px",cur:"default",us:"none"}),e.collapsed=(0,t.rule)({col:e.blue,cur:"default",fw:"bold",bg:t.theme.blue(.1),pd:"2px",mr:"-2px",bdrad:"4px"}),e.bracketHovered=(0,t.rule)({out:`1px dotted ${e.blue}`}),e.insArrBlock=(0,t.rule)({pos:"relative",h:"0px",w:"0px"}),e.insArrDot=(0,t.rule)({pos:"absolute",t:"0px",l:"-4px",w:"3px",h:"3px",bdrad:"50%",bg:e.blue,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{top:"-2px",left:"2px",w:"7px",h:"7px"}}),e.insArrLine=(0,t.rule)({pos:"absolute",t:"1px",l:"-56px",w:"50px",h:"0px",bdt:`1px dotted ${e.blue}`,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{l:"-56px",w:"56px",bdt:`1px solid ${e.blue}`}}),e.insArrButton=(0,t.rule)({pos:"absolute",d:"block",t:"-8px",l:"-75px"}),e.tooltip=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.ui1),{pos:"absolute",d:"none",t:"-2.5em",l:"0px",bg:"rgba(0,0,0,.8)",col:"#fff",fz:12/13.4+"em",pad:".4em .8em",bdrad:".4em",z:3,pe:"none",us:"none",ws:"nowrap"})),e.bottomRightActionPos=(0,t.rule)({d:"inline-block",pos:"absolute",r:"-6px",b:"-9px",z:2})})(Hs)),Hs}var Et={},di={},fi={},Qc;function Xp(){return Qc||(Qc=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi}var hi={},Zc;function Bo(){return Zc||(Zc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=o,e.escapeComponent=s,e.parseJsonPointer=a,e.formatJsonPointer=c,e.isChild=u,e.isPathEqual=d,e.parent=f,e.isValidIndex=g;const t=/~1/g,r=/~0/g,i=/~/g,n=/\//g;function o(w){return w.indexOf("~")===-1?w:w.replace(t,"/").replace(r,"~")}function s(w){return w.indexOf("/")===-1&&w.indexOf("~")===-1?w:w.replace(i,"~0").replace(n,"~1")}function a(w){return w?w.slice(1).split("/").map(o):[]}function c(w){return(0,e.isRoot)(w)?"":"/"+w.map(_=>s(String(_))).join("/")}const l=w=>typeof w=="string"?a(w):w;e.toPath=l;function u(w,_){if(w.length>=_.length)return!1;for(let m=0;m<w.length;m++)if(w[m]!==_[m])return!1;return!0}function d(w,_){if(w.length!==_.length)return!1;for(let m=0;m<w.length;m++)if(w[m]!==_[m])return!1;return!0}const h=w=>!w.length;e.isRoot=h;function f(w){if(w.length<1)throw new Error("NO_PARENT");return w.slice(0,w.length-1)}function g(w){if(typeof w=="number")return!0;const _=Number.parseInt(w,10);return String(_)===w&&_>=0}const y=w=>{const _=w.length;let m=0,b;for(;m<_;){if(b=w.charCodeAt(m),b>=48&&b<=57){m++;continue}return!1}return!0};e.isInteger=y})(hi)),hi}var pi={},ea;function Qp(){return ea||(ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const t=n=>{if(typeof n=="string"){if(n){if(n[0]!=="/")throw new Error("POINTER_INVALID");if(n.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(n)};e.validateJsonPointer=t;const{isArray:r}=Array,i=n=>{if(!r(n))throw new Error("Invalid path.");if(n.length>256)throw new Error("Path too long.");for(const o of n)switch(typeof o){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=i})(pi)),pi}var Ct={},Wr={},ta;function qo(){if(ta)return Wr;ta=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.hasOwnProperty=t;const e=Object.prototype.hasOwnProperty;function t(r,i){return e.call(r,i)}return Wr}var na;function uf(){if(na)return Ct;na=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.get=void 0;const e=qo(),t=(r,i)=>{const n=i.length;let o;if(!n)return r;for(let s=0;s<n;s++)if(o=i[s],r instanceof Array){if(typeof o!="number"){if(o==="-")return;const a=~~o;if(""+a!==o)return;o=a}r=r[o]}else if(typeof r=="object"){if(!r||!(0,e.hasOwnProperty)(r,o))return;r=r[o]}else return;return r};return Ct.get=t,Ct}var Ce={},ra;function Zp(){if(ra)return Ce;ra=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.isObjectReference=Ce.isArrayEnd=Ce.isArrayReference=Ce.find=void 0;const e=qo(),{isArray:t}=Array,r=(s,a)=>{const c=a.length;if(!c)return{val:s};let l,u;for(let h=0;h<c;h++)if(l=s,u=a[h],t(l)){const f=l.length;if(u==="-")u=f;else if(typeof u=="string"){const g=~~u;if(""+g!==u)throw new Error("INVALID_INDEX");if(u=g,u<0)throw new Error("INVALID_INDEX")}s=l[u]}else if(typeof l=="object"&&l)s=(0,e.hasOwnProperty)(l,u)?l[u]:void 0;else throw new Error("NOT_FOUND");return{val:s,obj:l,key:u}};Ce.find=r;const i=s=>t(s.obj)&&typeof s.key=="number";Ce.isArrayReference=i;const n=s=>s.obj.length===s.key;Ce.isArrayEnd=n;const o=s=>typeof s.obj=="object"&&typeof s.key=="string";return Ce.isObjectReference=o,Ce}var mi={},Ot={},sa;function em(){if(sa)return Ot;sa=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.findByPointer=void 0;const e=qo(),t=Bo(),{isArray:r}=Array,i=(n,o)=>{if(!n)return{val:o};let s,a,c=0,l=1;for(;c>-1;)if(c=n.indexOf("/",l),a=c>-1?n.substring(l,c):n.substring(l),l=c+1,s=o,r(s)){const u=s.length;if(a==="-")a=u;else{const d=~~a;if(""+d!==a)throw new Error("INVALID_INDEX");if(a=d,a<0)throw"INVALID_INDEX"}o=s[a]}else if(typeof s=="object"&&s)a=(0,t.unescapeComponent)(a),o=(0,e.hasOwnProperty)(s,a)?s[a]:void 0;else throw"NOT_FOUND";return{val:o,obj:s,key:a}};return Ot.findByPointer=i,Ot}var ia;function tm(){return ia||(ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),z.__exportStar(em(),e)})(mi)),mi}var oa;function gs(){return oa||(oa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(Xp(),e),t.__exportStar(Bo(),e),t.__exportStar(Qp(),e),t.__exportStar(uf(),e),t.__exportStar(Zp(),e),t.__exportStar(tm(),e)})(di)),di}var At={},Nt={},ca;function nm(){if(ca)return Nt;ca=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.copyStyles=void 0;const e=(t,r,i)=>{const n=window.getComputedStyle(t);if(n)for(const o of i)r.style[o]=n[o]};return Nt.copyStyles=e,Nt}var aa;function qr(){if(aa)return At;aa=1,Object.defineProperty(At,"__esModule",{value:!0}),At.FlexibleInput=void 0;const e=B(),t=ne(),r=nm(),i=(0,t.rule)({d:"inline-block",pos:"relative"}),n=(0,t.rule)({d:"inline-block",va:"bottom",bxz:"border-box",ov:"hidden",pd:0,mr:0,bd:0,bg:0,out:0,col:"inherit",fw:"inherit",f:"inherit",lh:"inherit",ws:"pre",resize:"none"}),o=(0,t.rule)({d:"inline-block",pos:"absolute",ov:"hidden",pe:"none",us:"none",bxz:"border-box",t:0,l:0,ws:"pre"}),s=({inp:a,value:c,uncontrolled:l,multiline:u,typebefore:d="",typeahead:h="",extraWidth:f,minWidth:g=8,maxWidth:y,focus:w,onChange:_,onFocus:m,onBlur:b,onKeyDown:p,onSubmit:v,onCancel:S,onTab:E})=>{const O=e.useRef(null),A=e.useRef(null),C=(0,t.useTheme)();e.useLayoutEffect(()=>{!O.current||!A.current||(w&&O.current.focus(),(0,r.copyStyles)(O.current,A.current,["font","fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","boxSizing"]))},[]),e.useLayoutEffect(()=>{const k=O.current,R=A.current;if(!k||!R)return;let x=R.scrollWidth;f&&(x+=f),g&&(x=Math.max(x,g)),y&&(x=Math.min(x,y));const T=k.style;if(T.width=x+"px",u){const M=R.scrollHeight;T.height=M+"px"}},[c,h,f]);const N={ref:k=>{O.current=k,a&&a(k)},className:n,onChange:_,onFocus:m,onBlur:b,onKeyDown:k=>{k.key==="Enter"&&(!u||k.ctrlKey)?v&&v(k):k.key==="Escape"?S&&S(k):k.key==="Tab"&&E&&E(k),p&&p(k)}},I=u?e.createElement("textarea",Object.assign({},N,{value:l?void 0:c})):e.createElement("input",Object.assign({},N,{value:l?void 0:c}));return e.createElement(e.Fragment,null,!!d&&e.createElement("span",{style:{color:C.g(.7),verticalAlign:"top"}},d),e.createElement("span",{className:i},I,e.createElement("span",{ref:A,className:o},e.createElement("span",{style:{visibility:"hidden"}},c),"​",!!h&&e.createElement("span",{style:{color:C.g(.7)}},h))))};return At.FlexibleInput=s,At}var ua;function lf(){if(ua)return Et;ua=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.JsonProperty=void 0;const e=B(),t=ne(),r=gs(),i=se(),n=qr(),o=ue(),s=({pointer:a,onChange:c})=>{const{formal:l}=(0,o.useStyles)(),u=e.useMemo(()=>a.split("/"),[a]),d=e.useMemo(()=>(0,r.unescapeComponent)(u[u.length-1]),[u]),[h,f]=e.useState(d),g=e.useRef(null),[y,w]=e.useState(!1),_=(0,t.useTheme)(),m={color:_.g(.1)};y&&(m.background=_.bg,m.border=`1px solid ${_.g(.9)}`,m.fontWeight="bold",m.margin="-3px",m.padding="2px"),(!d||d.indexOf(" ")!==-1)&&(m.background=_.blue(.1));const b=p=>{p&&p.preventDefault(),p&&p.stopPropagation(),c&&c([{op:"move",from:a,path:u.slice(0,u.length-1).join("/")+"/"+(0,r.escapeComponent)(h)}])};return e.createElement(e.Fragment,null,c?e.createElement("span",{className:i.property+i.input,style:m},e.createElement(n.FlexibleInput,{inp:p=>g.current=p,value:y?h:d,onChange:p=>f(p.target.value),onFocus:p=>{const v=p.target,E=v.value.length;E&&E<6&&setTimeout(()=>{v.setSelectionRange(0,E,"forward")},155),w(!0)},onBlur:()=>{w(!1)},onSubmit:p=>{g.current&&(g.current.blur(),w(!1)),b(p)},onCancel:()=>{g.current&&(g.current.blur(),w(!1))}})):e.createElement("span",{className:i.property,style:m},l?JSON.stringify(d):d),e.createElement("span",{className:i.colon,style:{color:_.g(.5)}},e.createElement("span",null,":")))};return Et.JsonProperty=s,Et}var It={},kt={},bi={},la;function ys(){return la||(la=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.typeahead=e.inputStyle=e.inputColor=e.valueBg=e.valueColor=void 0;const t=ne(),r=se(),i=(c,l)=>{switch(typeof l){case"boolean":return r.ValueColor.bool[~~c];case"string":return r.ValueColor.str[~~c];case"number":return l?l===Math.round(l)?r.ValueColor.num[~~c]:r.ValueColor.float[~~c]:r.ValueColor.zero[~~c];case"bigint":return r.ValueColor.float[~~c];case"object":return l===null?r.ValueColor.nil[~~c]:void 0;case"undefined":return r.ValueColor.undef[~~c]}};e.valueColor=i;const n=c=>c===!1||typeof c=="number"&&c<0?t.theme.red(.06):void 0;e.valueBg=n;const o=(c,l)=>{if(l){if(l=l.trim(),l==="true"||l==="false")return r.ValueColor.bool[~~c];if(l==="null")return r.ValueColor.nil[~~c];if(l==="undefined")return r.ValueColor.undef[~~c];if(l==="0")return r.ValueColor.zero[~~c];if(l.length<24&&(l[0]==="-"||l[0]>="0"&&l[0]<="9"))try{const u=JSON.parse(l);if(typeof u=="number")return u===Math.round(u)?r.ValueColor.num[~~c]:r.ValueColor.float[~~c]}catch{}if(!(l[0]==="["||l[0]==="{"))return r.ValueColor.str[~~c]}};e.inputColor=o;const s=(c,l,u)=>({color:(0,e.inputColor)(l,u)||c.g(.1),background:c.bg,borderColor:c.g(.7)});e.inputStyle=s;const a=c=>{if(!c)return"";const l=c.length;return l>=5?"":"true".startsWith(c)?"true".slice(l):"false".startsWith(c)?"false".slice(l):"null".startsWith(c)?"null".slice(l):""};e.typeahead=a})(bi)),bi}var Rt={},da;function Lo(){if(da)return Rt;da=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.selectOnFocus=void 0;const e=t=>{const r=t.value,i=r.length;i&&i<40&&setTimeout(()=>{if(r[0]==='"'&&r[i-1]==='"')(i<17||r.indexOf(`
`)===-1&&r.indexOf(" ")===-1)&&t.setSelectionRange(1,i-1,"forward");else if(r==="null")t.setSelectionRange(0,4,"forward");else try{switch(typeof JSON.parse(r)){case"number":case"boolean":{t.setSelectionRange(0,i,"forward");break}}}catch{}},155),r[0]==='"'&&r[i-1]==='"'&&t.setSelectionRange(i-1,i-1)};return Rt.selectOnFocus=e,Rt}var fa;function rm(){if(fa)return kt;fa=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.ValueInput=void 0;const e=B(),t=ne(),r=se(),i=ys(),n=qr(),o=Lo(),s=a=>{const{value:c,onChange:l}=a,u=e.useRef(null),d=(0,t.useTheme)(),h=e.useMemo(()=>c===null?"null":typeof c=="boolean"?c?"true":"false":typeof c=="string"?JSON.stringify(c):String(c),[c,d]),[f,g]=e.useState(h),[y,w]=e.useState(!1);e.useEffect(()=>{g(h)},[h]);const _=E=>{E&&E.preventDefault(),E&&E.stopPropagation();let O;try{O=JSON.parse(f)}catch{O=String(f)}l&&l(O)},m=E=>{const O=E.target;O.value===f&&(0,o.selectOnFocus)(O),w(!0)},b=()=>{w(!1)},p=E=>{u.current&&u.current.blur(),_(E)},v=()=>{h!==f?g(h):u.current&&u.current.blur()},S=E=>{const O=(0,i.typeahead)(f);O&&(E.preventDefault(),g(f+O))};return e.createElement("span",{className:r.input,style:y?(0,i.inputStyle)(d,!d.isLight,f):{color:(0,i.valueColor)(!d.isLight,c),background:(0,i.valueBg)(c)}},e.createElement(n.FlexibleInput,{inp:E=>u.current=E,value:y?f:h,typeahead:y?(0,i.typeahead)(f):"",onChange:E=>g(E.target.value),onFocus:m,onBlur:b,onSubmit:p,onCancel:v,onTab:S}))};return kt.ValueInput=s,kt}var Tt={},ha;function ht(){if(ha)return Tt;ha=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.JsonAtom=void 0;const e=B(),t=ne(),r=ys(),i=t.theme.color.sem.blue[0],n=o=>{var s;const{value:a,onClick:c}=o,l=(0,t.useTheme)();let u=l.g(.2),d="∅";if(Array.isArray(a))u=i,d="["+a.length+"]";else if(a instanceof Uint8Array)u=l.g(.45),d=e.createElement("span",null,[...a].slice(0,128).map(g=>g<16?"0"+g.toString(16):g.toString(16)).join(" "),a.length>128?e.createElement("span",{style:{color:l.g(.3)}},` … (${a.length-128} more)`):"");else if(a&&typeof a=="object")u=i,d="{"+Object.keys(a).length+"}";else if(u=(s=(0,r.valueColor)(!l.isLight,a))!==null&&s!==void 0?s:u,typeof a=="string"){const y=a.length>64,w=JSON.stringify(y?a.slice(0,64):a);y?d=e.createElement("span",null,w.slice(0,-1),e.createElement("span",{style:{color:l.g(.3)}},` … (${a.length-64} more)`),'"'):d=w}else d=String(a);const h=(0,r.valueBg)(a),f={color:u,background:h};return h&&(f.borderRadius=4,f.margin=-1,f.padding=1),e.createElement("span",{style:f,onClick:c},d)};return Tt.JsonAtom=n,Tt}var pa;function sm(){if(pa)return It;pa=1,Object.defineProperty(It,"__esModule",{value:!0}),It.JsonValue=void 0;const e=B(),t=lf(),r=rm(),i=ht(),n=o=>{const{pointer:s,property:a,doc:c,parentCollapsed:l,comma:u,onChange:d}=o,h=c instanceof Uint8Array,f=g=>{d&&d([{op:"replace",path:s,value:g}])};return e.createElement(e.Fragment,null,typeof a=="string"&&e.createElement(t.JsonProperty,{key:"k"+String(l),pointer:s,onChange:d}),!d||h?e.createElement(i.JsonAtom,{value:c}):e.createElement(r.ValueInput,{key:String(l),value:c,onChange:f}),!!u&&",")};return It.JsonValue=n,It}var xt={},jt={},gi={},yi={},ma;function im(){return ma||(ma=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTranslations=void 0;var t=z,r=B(),i=r.createContext,n=r.createElement,o=r.Fragment,s=function(c){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];for(var d=[],h=0;h<l.length;h++)d.push(c[h]),d.push(l[h]);return d.push(c[h]),n.apply(void 0,t.__spreadArrays([o,{}],d))},a=function(c){return function(l){for(var u=[],d=1;d<arguments.length;d++)u[d-1]=arguments[d];for(var h=[],f=0;f<u.length;f++)h.push(l[f]),h.push(c[u[f]]);return h.push(l[f]),n.apply(void 0,t.__spreadArrays([o,{}],h))}};e.createTranslations=function(c){var l;c===void 0&&(c="main");var u=i({}),d=u.Consumer,h=(l=(function(_){t.__extends(m,_);function m(b){var p,v=_.call(this,b)||this;v.load=function(N,I){return t.__awaiter(v,void 0,void 0,function(){var k;return t.__generator(this,function(R){switch(R.label){case 0:return this.state.map[N]||(this.state.map[N]={}),this.state.map[N][I]?[3,2]:(this.state.map[N][I]={},this.setState(t.__assign({},this.state)),[4,this.props.loader(N,I)]);case 1:k=R.sent(),this.state.map[N][I]=k,this.setState(t.__assign({},this.state)),R.label=2;case 2:return[2]}})})},v.setLocale=function(N){N!==v.state.locale&&(v.state.map[N]||(v.state.map[N]={}),v.setState({locale:N}))},v.createT=function(N){N===void 0&&(N=[v.props.ns]);for(var I=v.state.locale,k=v.state.map[I],R=0,x=N;R<x.length;R++){var T=x[R];k[T]||v.load(I,T).catch(function(q){return console.error(q)})}var M=(function(q){for(var U=[],V=1;V<arguments.length;V++)U[V-1]=arguments[V];for(var F=0,L=[I,v.props.defaultLocale];F<L.length;F++){var ee=L[F];if(!ee)break;for(var X=v.state.map[ee],le=0,Se=N;le<Se.length;le++){var K=Se[le],Y=X[K],Q=Y[q];if(Q!==void 0)return typeof Q=="function"?Q(a(U)):Q||q}}return q});return M.t=function(q){return function(U){for(var V=[],F=1;F<arguments.length;F++)V[F-1]=arguments[F];var L=M.apply(void 0,t.__spreadArrays([q],V));return typeof L=="object"?L:L!==q?n(o,{},L):s.apply(void 0,t.__spreadArrays([U],V))}},M};var S=b.map,E=S===void 0?{}:S,O=b.locale,A=b.defaultLocale,C=b.ns;return E[A]?E[A][C]||(E[A][C]={}):E[A]=(p={},p[C]={},p),v.state={locale:O,ns:C,map:E,load:v.load,setLocale:v.setLocale,createT:v.createT},O!==A&&v.load(O,C),v}return m.prototype.shouldComponentUpdate=function(b){return b.locale!==this.props.locale&&this.setLocale(b.locale),!0},m.prototype.render=function(){return r.createElement(u.Provider,{value:this.state,children:this.props.children})},m})(r.Component),l.defaultProps={locale:"en",defaultLocale:"en",ns:c},l),f=(function(_){return _});f.t=function(_){return function(m){for(var b=[],p=1;p<arguments.length;p++)b[p-1]=arguments[p];return s(m,b)}};var g=function(_){var m=_ instanceof Array?_:[_||c],b=r.useContext(u);return[b.createT?b.createT(m):f,b]},y=function(_,m){return m===void 0&&(m=c),Array.isArray(m)||(m=[m]),(function(b){var p=g(m),v=p[0],S=p[1];return r.createElement(_,t.__assign(t.__assign({},b),{t:v,T:S}))})},w=function(_){var m=_.children,b=_.ns instanceof Array?_.ns:[_.ns||c],p=g(b),v=p[0],S=p[1];return(typeof m=="function"?m(v,S):m instanceof Array?r.createElement.apply(r,t.__spreadArrays([r.Fragment,null],m.map(function(E){return typeof E=="function"?E(v):typeof E=="string"?v(E):E||null}))):typeof m=="string"?v(m):m)||null};return{Consumer:d,Provider:h,context:u,useT:g,Trans:w,withT:y,T:f}},e.default=e.createTranslations})(yi)),yi}var vi={},ba;function om(){return ba||(ba=1,Object.defineProperty(vi,"__esModule",{value:!0})),vi}var ga;function Je(){return ga||(ga=1,(function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.T=e.withT=e.useT=e.context=e.Trans=e.Provider=e.Consumer=void 0;var r=z,i=im();r.__exportStar(om(),e),e.Consumer=(t=i.default(),t.Consumer),e.Provider=t.Provider,e.Trans=t.Trans,e.context=t.context,e.useT=t.useT,e.withT=t.withT,e.T=t.T})(gi)),gi}var Pt={},Mt={},ya;function Lr(){if(ya)return Mt;ya=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.Action=void 0;const e=B(),t=ne(),r=se(),i=(0,t.drule)({pos:"relative",d:"flex",jc:"center",ai:"center",w:"17px",h:"17px",bdrad:"2px",pad:0,mr:0,out:0,ff:"monospace",lh:"16px",cur:"pointer",bd:`1px dotted ${r.blue}`,col:r.blue,fw:"normal",z:3}),n=(0,t.drule)({[`.${i.toString().trim()}:hover &`]:{d:"inline-block"}}),o=({className:s="",tooltip:a,children:c,onClick:l,onMouseEnter:u,onMouseLeave:d,onMouseOver:h})=>{const f=(0,t.useTheme)();return e.createElement("button",{className:i({bg:f.bg,"&:hover":{col:f.bg,bg:r.blue},"&:active":{col:f.g(.9),bg:f.g(.1),bd:`1px solid ${f.g(.1)}`}})+s,onClick:l,onMouseEnter:u,onMouseLeave:d,onMouseOver:h},c,!!a&&e.createElement("span",{className:r.tooltip+n({})},a))};return Mt.Action=o,Mt}var va;function vs(){if(va)return Pt;va=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.CancelAction=void 0;const e=B(),t=ne(),r=se(),i=Lr(),n=(0,t.drule)({w:"20px",h:"20px",pos:"absolute",t:"-11px",l:"-11px",z:2,bdrad:"50%",svg:{fill:r.blue}}),o=s=>{const a=(0,t.useTheme)();return e.createElement(i.Action,Object.assign({},s,{className:n({"&:hover":{bg:r.negative,bd:`1px solid ${r.negative}`,svg:{fill:"#fff"}},"&:active":{bg:a.g(.1),bd:`1px solid ${a.g(.1)}`}})}),"×")};return Pt.CancelAction=o,Pt}var Dt={},wa;function cm(){if(wa)return Dt;wa=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.EditAction=void 0;const e=B(),t=Lr(),r=i=>e.createElement(t.Action,Object.assign({},i),"…");return Dt.EditAction=r,Dt}var _a;function Uo(){if(_a)return jt;_a=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.FocusRegion=void 0;const e=B(),t=ne(),r=Je(),i=se(),n=vs(),o=cm(),s=(0,t.rule)({d:"inline-block",pos:"relative",va:"top",bxz:"border-box",pd:"3px",bdrad:"4px",trs:"background-color .3s ease-out"}),a=(0,t.rule)({pd:"1px 3px"}),c=(0,t.rule)({bgc:t.theme.blue(.1)}),l=(0,t.rule)({bgc:t.theme.red(.1)}),u=(0,t.rule)({bgc:t.theme.red(.08)}),d=(0,t.rule)({out:`1px dotted ${i.blue}`}),h=(0,t.rule)({out:`1px dotted ${i.negative}`}),f=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-1px",l:"calc(100% + 0.5em)"}),g=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-11px",l:"calc(100% - 24px)"}),y=w=>{const{focused:_,pointed:m,compact:b,aside:p,toolbar:v,negative:S,children:E,onClick:O,onMouseMove:A,onMouseEnter:C,onMouseLeave:N,onDelete:I,onEdit:k}=w,[R]=(0,r.useT)(),[x,T]=e.useState(!1),M=I?e.createElement(n.CancelAction,{tooltip:R("Delete"),onClick:I,onMouseEnter:()=>T(!0),onMouseOver:()=>T(!0),onMouseLeave:()=>T(!1)}):void 0,q=s+(b?a:"")+(m?S?l:c:"")+(x?u:"")+(_?S?h:d:"");return e.createElement("span",{className:q,style:{outline:x?`1px dotted ${i.negative}`:void 0},onMouseMove:A,onMouseEnter:C,onMouseLeave:N,onClick:O},E,M,!!_&&k&&e.createElement("span",{className:i.bottomRightActionPos},e.createElement(o.EditAction,{tooltip:R("Set"),onClick:k})),!!p&&e.createElement("span",{className:f},p),!!_&&!!v&&e.createElement("span",{className:g},v))};return jt.FocusRegion=y,jt}var wi={},Sa;function ve(){return Sa||(Sa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FocusProvider=e.useIsFocused=e.useFocus=e.context=void 0;const t=B();e.context=t.createContext(null);const r=()=>t.useContext(e.context);e.useFocus=r;const i=o=>{const{focused:s}=(0,e.useFocus)();return s===o};e.useIsFocused=i;const n=({children:o,onFocus:s})=>{const[a,c]=t.useState(null),[l,u]=t.useState(null),d=t.useCallback(h=>{c(h),s?.(h)},[s]);return t.useEffect(()=>{const h=f=>{const g=document.activeElement;g&&(g.nodeName==="INPUT"||g.nodeName==="TEXTAREA")||f.key==="Escape"&&d(null)};return document.addEventListener("keydown",h,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",h)},[]),t.createElement(e.context.Provider,{value:{focused:a,focus:d,pointed:l,point:u}},o)};e.FocusProvider=n})(wi)),wi}var _i={},Ea;function df(){return Ea||(Ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputProvider=e.useInput=e.context=void 0;const t=B();e.context=t.createContext(null);const r=()=>t.useContext(e.context);e.useInput=r;const i=({children:n})=>{const o=(0,e.useInput)(),[s,a]=t.useState(!1);return t.useEffect(()=>{if(o)return;const c=()=>{a(!!document.activeElement&&document.activeElement.tagName==="INPUT")};return document.addEventListener("focus",c,!0),document.addEventListener("blur",c,!0),()=>{document.removeEventListener("focus",c),document.removeEventListener("blur",c)}},[]),o?n:t.createElement(e.context.Provider,{value:{focused:s}},n)};e.InputProvider=i})(_i)),_i}var Ca;function ff(){if(Ca)return xt;Ca=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.JsonHoverable=void 0;const e=B(),t=Br(),r=Uo(),i=ve(),n=ue(),o=df(),s=({pointer:a,children:c})=>{const{focused:l,focus:u,pointed:d,point:h}=(0,i.useFocus)(),{pfx:f,onChange:g}=e.useContext(t.context),{compact:y}=(0,n.useStyles)(),w=(0,o.useInput)(),_=f+a,m=S=>{S.stopPropagation(),d!==_&&h(_)},b=S=>{S.preventDefault(),S.stopPropagation(),h(_)},p=()=>{h(null)},v=S=>{S.preventDefault(),S.stopPropagation(),u(_)};return e.createElement(r.FocusRegion,{pointed:d===_,focused:l===_,compact:y,onClick:v,onMouseMove:m,onMouseEnter:b,onMouseLeave:p,onDelete:g&&!w.focused&&_===l?()=>g([{op:"remove",path:a}]):void 0},c)};return xt.JsonHoverable=s,xt}var Bt={},qt={},Lt={},Ut={},Ft={},Oa;function am(){if(Oa)return Ft;Oa=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.TypeSwitch=void 0;const e=B(),t=ne(),r=(0,t.drule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",col:t.theme.color.sem.blue[0],d:"inline-block",pd:"2px 2px",mr:"0",bxz:"border-box",bd:0,bdrad:"1em"}));return Ft.TypeSwitch=e.memo(({value:i,onKeyDown:n,onClick:o})=>{const s=(0,t.useTheme)();return e.createElement("button",{className:r({bg:s.g(.96),"&:hover":{bg:s.g(.88)}}),onClick:o,onKeyDown:n},i)}),Ft}var Aa;function um(){if(Aa)return Ut;Aa=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.CrdtTypeSwitch=void 0;const e=B(),t=am(),r=({types:i=["any","con","vec","val"],type:n,onSubmit:o,onClick:s})=>{const[a,c]=e.useState(i.findIndex(d=>d===n.current));e.useLayoutEffect(()=>{n.current=i[a]},[]);const l=()=>{c(d=>{const h=(d+1)%i.length;return n.current=i[h],h})},u=()=>{c(d=>{const h=(d-1+i.length)%i.length;return n.current=i[h],h})};return e.createElement("span",{style:{display:"inline-block",padding:"0 0 0 4px",margin:"-1px 0"}},e.createElement(t.TypeSwitch,{value:i[a],onClick:d=>{l(),s&&s(d)},onKeyDown:d=>{switch(d.key){case"ArrowDown":case"ArrowRight":{d.preventDefault(),l();break}case"ArrowUp":case"ArrowLeft":{d.preventDefault(),u();break}case"Enter":{d.preventDefault(),o&&(d.preventDefault(),o());break}}}}))};return Ut.CrdtTypeSwitch=r,Ut}var Na;function Fo(){if(Na)return Lt;Na=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.ValueInput=void 0;const e=B(),t=ne(),r=qr(),i=se(),n=ys(),o=um(),s=Lo(),a=({inp:c,focus:l,initialValue:u="",visible:d,types:h=["any","con","val","vec"],initialType:f,withType:g,onSubmit:y,onCancel:w})=>{const[_,m]=e.useState(u),b=e.useRef(null),p=(0,t.useTheme)(),v=e.useRef(f??(h&&h.length?h[0]:"")),S=()=>{b.current&&b.current.blur(),m(""),y(_,v.current)},E=(0,n.inputStyle)(p,!p.isLight,_);E.display=d?void 0:"none",E.margin="-1px 0 -1px -2px",E.padding="3px 4px 3px 5px",E.border=`1px solid ${p.g(.85)}`;let O=null;return h&&h.length&&g&&(O=e.createElement(o.CrdtTypeSwitch,{type:v,onSubmit:S,onClick:()=>{b.current&&b.current.focus()}})),e.createElement("span",{className:i.input,style:E},e.createElement(r.FlexibleInput,{focus:l,inp:A=>{b.current=A,c&&c(A)},value:_,typeahead:(0,n.typeahead)(_),onChange:A=>m(A.target.value),onSubmit:S,onFocus:A=>(0,s.selectOnFocus)(A.target),onCancel:A=>{m(""),w&&w(A)},onTab:A=>{const C=(0,n.typeahead)(_);C&&(A.preventDefault(),m(_+C))}}),O)};return Lt.ValueInput=a,Lt}var Vt={},Ia;function hf(){if(Ia)return Vt;Ia=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.AddAction=void 0;const e=B(),t=Lr(),r=i=>e.createElement(t.Action,Object.assign({},i),"+");return Vt.AddAction=r,Vt}var ka;function pf(){if(ka)return qt;ka=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ObjectInsert=void 0;const e=B(),t=Je(),r=se(),i=ne(),n=qr(),o=Fo(),s=hf(),a=({visible:c,withType:l,onSubmit:u})=>{const[d]=(0,t.useT)(),[h,f]=e.useState(!1),[g,y]=e.useState(""),[w,_]=e.useState(""),m=e.useRef(null),b=e.useRef(null),p=(0,i.useTheme)(),v=(S,E)=>{b.current&&b.current.blur(),u(g,S,E),y(""),_(""),f(!1)};if(!c)return null;if(h){const S=e.createElement("span",{className:r.property+r.input,style:{color:p.g(.1),background:p.bg,display:c?void 0:"none",margin:"-1px 0 -1px -2px",padding:"3px 4px",border:`1px solid ${p.g(.85)}`,fontWeight:"bold"}},e.createElement(n.FlexibleInput,{focus:!0,inp:O=>m.current=O,value:g,onChange:O=>y(O.target.value),onSubmit:()=>{b.current&&b.current.focus()},onCancel:()=>{g?y(""):w?_(""):f(!1)}})),E=e.createElement(o.ValueInput,{inp:O=>b.current=O,visible:c,withType:l,onSubmit:v,onCancel:()=>{m.current&&m.current.focus()}});return e.createElement("span",{style:{display:c?void 0:"none"}},S,e.createElement("span",{className:r.colon},e.createElement("span",null,":")),E)}return e.createElement("span",{className:r.insArrBlock,style:{display:c?void 0:"none"},onClick:()=>f(!0)},e.createElement("span",{className:r.insArrDot}),e.createElement("span",{className:r.insArrLine}),e.createElement("span",{className:r.insArrButton},e.createElement(s.AddAction,{tooltip:d("Add key"),onClick:()=>f(!0)})))};return qt.ObjectInsert=a,qt}var Ra;function lm(){if(Ra)return Bt;Ra=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.JsonObjectInsert=void 0;const e=B(),t=gs(),r=Br(),i=pf(),n=({pointer:o,visible:s})=>{const{onChange:a}=e.useContext(r.context);if(!a)return null;const c=(l,u)=>{let d;try{d=JSON.parse(u)}catch{d=String(u)}a([{op:"add",path:o+"/"+(0,t.escapeComponent)(l),value:d}])};return e.createElement(i.ObjectInsert,{visible:s,onSubmit:c})};return Bt.JsonObjectInsert=n,Bt}var Jt={},Gt={},Ta;function Vo(){if(Ta)return Gt;Ta=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ArrayInsert=void 0;const e=B(),t=Je(),r=se(),i=Fo(),n=hf(),o=vs(),s=({visible:a,withType:c,onSubmit:l})=>{const[u]=(0,t.useT)(),[d,h]=e.useState(!1),f=(g,y)=>{h(!1),l(g,y)};return d?e.createElement("span",{style:{position:"relative"}},e.createElement(i.ValueInput,{focus:!0,withType:c,visible:a,onSubmit:f,onCancel:()=>h(!1)}),e.createElement(o.CancelAction,{onClick:()=>h(!1)})):e.createElement("span",{className:r.insArrBlock,style:{display:a?void 0:"none"}},e.createElement("span",{className:r.insArrDot}),e.createElement("span",{className:r.insArrLine}),e.createElement("span",{className:r.insArrButton},e.createElement(n.AddAction,{tooltip:u("Insert"),onClick:()=>h(!0)})))};return Gt.ArrayInsert=s,Gt}var xa;function dm(){if(xa)return Jt;xa=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.JsonArrayInsert=void 0;const e=B(),t=Br(),r=Vo(),i=({pointer:n,visible:o})=>{const{onChange:s}=e.useContext(t.context);if(!s)return null;const a=c=>{let l;try{l=JSON.parse(c)}catch{l=String(c)}s([{op:"add",path:n,value:l}])};return e.createElement(r.ArrayInsert,{visible:o,onSubmit:a})};return Jt.JsonArrayInsert=i,Jt}var zt={},ja;function mf(){if(ja)return zt;ja=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.ObjectLayout=void 0;const e=B(),t=ne(),r=se(),i=ue(),n=({property:o,collapsedView:s,header:a,collapsed:c,comma:l,brackets:u=["{","}"],children:d,onClick:h,onCollapserClick:f,onCollapsedClick:g,onBracketClick:y})=>{const[w,_]=e.useState(!1),m=(0,t.useTheme)(),{noCollapseToggles:b}=(0,i.useStyles)(),p=()=>{_(!0)},v=()=>{_(!1)},S=m.g(.3);s=e.createElement("span",{className:r.collapsed,style:{display:c?void 0:"none"},onClick:g},e.createElement("span",{style:{color:r.blue}},u[0]),s,e.createElement("span",{style:{color:r.blue}},u[1]));const E=e.createElement("span",null,o,e.createElement("span",{className:r.bracket+(w?r.bracketHovered:""),style:{display:c?"none":void 0,color:S},onMouseEnter:p,onMouseLeave:v,onClick:y},u[0],!!a&&e.createElement("span",{style:{display:"inline-block",position:"absolute",top:"-0.27em",left:"1em"}},a)));return e.createElement("span",{className:r.object,onClick:h},!b&&e.createElement("span",{className:r.collapser,style:{color:m.g(.6)},onClick:f},c?"+":"—"),E,s,e.createElement("span",{className:r.list,style:{display:c?"none":void 0}},d),e.createElement("span",{className:r.bracket+(w?r.bracketHovered:""),style:{display:c?"none":void 0,color:S},onMouseEnter:p,onMouseLeave:v,onClick:y},u[1]),!!l&&",")};return zt.ObjectLayout=n,zt}var Pa;function fm(){return Pa||(Pa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonDoc=void 0;const t=B(),r=se(),i=Br(),n=lf(),o=sm(),s=ff(),a=lm(),c=dm(),l=mf(),u=ve(),d=ue(),h=gs(),f=({property:w,doc:_,pointer:m,parentCollapsed:b,comma:p,onChange:v})=>{const{pfx:S}=t.useContext(i.context),{focused:E}=(0,u.useFocus)(),{formal:O,keepOrder:A,collapsed:C}=(0,d.useStyles)(),N=t.useMemo(()=>{const T=Object.keys(_);return A?T:T.sort()},[_]),[I,k]=t.useState(C),R=()=>{!I&&S+m===E&&k(!0)},x=N.map((T,M)=>{const q=`${m}/${(0,h.escapeComponent)(T)}`;return t.createElement("span",{key:T,className:r.line},t.createElement(s.JsonHoverable,{pointer:q},t.createElement("span",{className:r.lineInner},t.createElement(e.JsonDoc,{property:T,doc:_[T],pointer:q,parentCollapsed:I,comma:O&&M<N.length-1,onChange:v}))))});return t.createElement(l.ObjectLayout,{collapsed:I,collapsedView:!!N.length&&t.createElement("strong",null,N.length),comma:p,property:typeof w=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(b),pointer:m,onChange:v}),onClick:()=>{I&&k(!1)},onCollapserClick:()=>k(T=>!T),onBracketClick:R},x,t.createElement(a.JsonObjectInsert,{pointer:m,visible:E===S+m}))},g=({property:w,doc:_,pointer:m,parentCollapsed:b,comma:p,onChange:v})=>{const{pfx:S}=t.useContext(i.context),{focused:E}=(0,u.useFocus)(),{formal:O,collapsed:A}=(0,d.useStyles)(),[C,N]=t.useState(A),I=()=>{!C&&S+m===E&&N(!0)},k=_.map((R,x)=>{const T=`${m}/${x}`;return t.createElement(t.Fragment,{key:x},t.createElement(c.JsonArrayInsert,{pointer:`${m}/${x}`,visible:E===S+m}),t.createElement("span",{className:r.line},t.createElement(s.JsonHoverable,{pointer:T},t.createElement("span",{className:r.lineInner},t.createElement(e.JsonDoc,{doc:_[x],pointer:T,parentCollapsed:C,comma:O&&x<_.length-1,onChange:v})))))});return t.createElement(l.ObjectLayout,{collapsed:C,collapsedView:!!_.length&&t.createElement("strong",null,_.length),comma:p,property:typeof w=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(b),pointer:m,onChange:v}),onClick:()=>{C&&N(!1)},onCollapserClick:()=>N(R=>!R),onBracketClick:I,brackets:["[","]"]},k,t.createElement(c.JsonArrayInsert,{pointer:`${m}/-`,visible:E===S+m}))},y=w=>{const{doc:_,comma:m}=w;return _?typeof _=="object"?Array.isArray(_)?t.createElement(g,Object.assign({},w,{doc:_})):_ instanceof Uint8Array?t.createElement(o.JsonValue,Object.assign({},w,{comma:m})):t.createElement(f,Object.assign({},w,{doc:_})):t.createElement(o.JsonValue,Object.assign({},w)):t.createElement(o.JsonValue,Object.assign({},w))};e.JsonDoc=y})(zs)),zs}var Ht={},Kr={},Ma;function hm(){if(Ma)return Kr;Ma=1,Object.defineProperty(Kr,"__esModule",{value:!0});var e=B(),t=af(),r=["mousedown","touchstart"],i=function(n,o,s){s===void 0&&(s=r);var a=e.useRef(o);e.useEffect(function(){a.current=o},[o]),e.useEffect(function(){for(var c=function(h){var f=n.current;f&&!f.contains(h.target)&&a.current(h)},l=0,u=s;l<u.length;l++){var d=u[l];t.on(document,d,c)}return function(){for(var h=0,f=s;h<f.length;h++){var g=f[h];t.off(document,g,c)}}},[s,n])};return Kr.default=i,Kr}var $r={},Da;function pm(){if(Da)return $r;Da=1,Object.defineProperty($r,"__esModule",{value:!0});var e=B();function t(){var r=e.useRef(!1),i=e.useCallback(function(){return r.current},[]);return e.useEffect(function(){return r.current=!0,function(){r.current=!1}},[]),i}return $r.default=t,$r}var Ba;function bf(){if(Ba)return Ht;Ba=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.Root=void 0;const e=B(),t=hm(),r=pm(),i=ue(),n=ve(),o=df(),a=(0,ne().rule)({d:"inline-block",ff:"monospace"}),c=({children:l,onFocus:u})=>{const d=(0,r.default)(),h=(0,i.useStyles)(),{focused:f,focus:g,point:y}=(0,n.useFocus)(),w=e.useRef(null),_=e.useRef(f);return(0,t.default)(w,()=>{d&&(y(null),g(null))}),u&&f!==_.current&&(_.current=f,u(f)),e.createElement(o.InputProvider,null,e.createElement("span",{ref:w,className:a,style:{fontSize:h.fontSize||"13.4px"}},l))};return Ht.Root=c,Ht}var qa;function gf(){if(qa)return yt;qa=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.ClickableJson=void 0;const e=B(),t=Br(),r=ue(),i=fm(),n=bf(),o=ve(),s=ff(),a=c=>{var l;const{onFocus:u}=c,d=c.readonly?void 0:c.onChange;return e.createElement(o.FocusProvider,null,e.createElement(r.context.Provider,{value:c},e.createElement(t.context.Provider,{value:{pfx:(l=c.pfx)!==null&&l!==void 0?l:"",onChange:d}},e.createElement(n.Root,{onFocus:u},e.createElement(s.JsonHoverable,{pointer:""},e.createElement(i.JsonDoc,Object.assign({},c,{pointer:"",onChange:d})))))))};return yt.ClickableJson=a,yt}var Wt={},Si={},La;function we(){return La||(La=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useJsonCrdt=e.context=void 0;const t=B();e.context=t.createContext(null);const r=()=>t.useContext(e.context);e.useJsonCrdt=r})(Si)),Si}var Ke={},Ua;function Ur(){if(Ua)return Ke;Ua=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.nodeRef=Ke.NodeRef=void 0;let e=class{constructor(n,o,s){this.node=n,this.parent=o,this.step=s}};Ke.NodeRef=e;const t=new WeakMap,r=(i,n,o)=>{try{const s=t.get(i);if(s)return s;const a=new e(i,n,o);return t.set(i,a),a}catch{return}};return Ke.nodeRef=r,Ke}var Ei={},Ci={},Oi={},Fa;function mm(){return Fa||(Fa=1,Object.defineProperty(Oi,"__esModule",{value:!0})),Oi}var Ai={},Kt={},Ni={},Ii={},$t={},Va;function bm(){if(Va)return $t;Va=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.dim=void 0;const e=t=>t;return $t.dim=e,$t}var Ja;function gm(){return Ja||(Ja=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toLine=void 0;const t=bm(),r=n=>" "+(n.length?`{ ${n.toString().split(",").map(o=>Number(o).toString(16).toUpperCase().padStart(n.BYTES_PER_ELEMENT<<1,"0")).join(" ")} }`:"{}"),i=(n,o=" ")=>{switch(n){case null:return"!n";case void 0:return"!u";case!0:return"!t";case!1:return"!f"}switch(typeof n){case"number":case"bigint":{const s=typeof n=="number"&&Math.round(n)!==n?n+"":Intl.NumberFormat("en-US").format(n)+(typeof n=="bigint"?"n":"");return s[0]==="0"&&s[1]==="."?s.slice(1):s}case"string":return n?n.split(/([\u0000-\u001F]|\n|\t)/).filter(Boolean).map(a=>a===`
`?"⏎":a==="	"?"⇥":a.length===1&&a.charCodeAt(0)<32?"\\x"+a.charCodeAt(0).toString(16).padStart(2,"0"):(0,t.dim)('"')+JSON.stringify(a).slice(1,-1)+(0,t.dim)('"')).join(" "):'""';case"object":{if(Array.isArray(n))return n.length?`[${o}${n.map(a=>(0,e.toLine)(a,o)).join(","+o)}${o}]`:"[]";if(n instanceof DataView)return n.constructor.name+r(new Uint8Array(n.buffer,n.byteOffset,n.byteLength));if(ArrayBuffer.isView(n))return n.constructor.name+r(n);if(n instanceof ArrayBuffer)return"ArrayBuffer"+r(new Uint8Array(n));if(n instanceof Date)return"Date { "+n.getTime()+" }";if(n instanceof RegExp)return n+"";const s=Object.keys(n);return s.length?`{${o}${s.map(a=>`${a}${o}${(0,t.dim)("=")}${o}${(0,e.toLine)(n[a],o)}`).join(","+o)}${o}}`:"{}"}case"function":return`fn ${(0,e.toLine)(n.name)} ( ${n.length} args )`;case"symbol":return`sym ( ${n.description} )`}return"?"};e.toLine=i})(Ii)),Ii}var ki={},Ri={},Ga;function ym(){return Ga||(Ga=1,Object.defineProperty(Ri,"__esModule",{value:!0})),Ri}var Ti={},xi={},za;function vm(){return za||(za=1,Object.defineProperty(xi,"__esModule",{value:!0})),xi}var ji={},Ha;function wm(){return Ha||(Ha=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class t{constructor(w,_){this.sid=w,this.time=_}}e.Timestamp=t;class r{constructor(w,_,m){this.sid=w,this.time=_,this.span=m}}e.Timespan=r;const i=(y,w)=>new t(y,w);e.ts=i;const n=(y,w,_)=>new r(y,w,_);e.tss=n;const o=(y,w)=>(0,e.ts)(y.sid,y.time+w);e.tick=o;const s=(y,w)=>y.time===w.time&&y.sid===w.sid;e.equal=s;const a=(y,w)=>{const _=y.time,m=w.time;if(_>m)return 1;if(_<m)return-1;const b=y.sid,p=w.sid;return b>p?1:b<p?-1:0};e.compare=a;const c=(y,w,_,m)=>{if(y.sid!==_.sid)return!1;const b=y.time,p=_.time;return!(b>p||b+w<p+m)};e.contains=c;const l=(y,w,_)=>{if(y.sid!==_.sid)return!1;const m=y.time,b=_.time;return!(m>b||m+w<b+1)};e.containsId=l;const u=y=>{if(y.sid===1)return"."+y.time;let w=""+y.sid;return w.length>4&&(w=".."+w.slice(w.length-4)),w+"."+y.time};e.printTs=u;const d=(y,w,_)=>new r(y.sid,y.time+w,_);e.interval=d;class h extends t{tick(w){const _=new t(this.sid,this.time);return this.time+=w,_}}e.LogicalClock=h;class f extends h{constructor(){super(...arguments),this.peers=new Map}observe(w,_){const m=w.time+_-1,b=w.sid;if(b!==this.sid){const p=this.peers.get(w.sid);p?m>p.time&&(p.time=m):this.peers.set(w.sid,(0,e.ts)(b,m))}m>=this.time&&(this.time=m+1)}clone(){return this.fork(this.sid)}fork(w){const _=new f(w,this.time);return w!==this.sid&&_.observe((0,e.tick)(this,-1),1),this.peers.forEach(m=>{_.observe(m,1)}),_}toString(w=""){const _=this.peers.size;let m=1,b="";return this.peers.forEach(p=>{b+=`
${w}${m===_?"└─":"├─"} ${p.sid}.${p.time}`,m++}),`clock ${this.sid}.${this.time}${b}`}}e.ClockVector=f;class g extends h{constructor(){super(...arguments),this.peers=new Map}observe(w,_){if(w.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<w.time)throw new Error("TIME_TRAVEL");const m=w.time+_;m>this.time&&(this.time=m)}clone(){return this.fork()}fork(){return new g(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=g})(ji)),ji}var Wa;function $(){return Wa||(Wa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(vm(),e),t.__exportStar(wm(),e)})(Ti)),Ti}var H={},Yt={},Ka;function _e(){if(Ka)return Yt;Ka=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.printTree=void 0;const e=(t="",r)=>{let i="",n=r.length-1;for(;n>=0&&!r[n];n--);for(let o=0;o<=n;o++){const s=r[o];if(!s)continue;const a=o===n,c=s(t+(a?" ":"│")+"  "),l=c?a?"└─":"├─":"│";i+=`
`+t+l+(c?" "+c:"")}return i};return Yt.printTree=e,Yt}var $a;function pt(){if($a)return H;$a=1,Object.defineProperty(H,"__esModule",{value:!0}),H.NopOp=H.DelOp=H.UpdArrOp=H.InsArrOp=H.InsBinOp=H.InsStrOp=H.InsVecOp=H.InsObjOp=H.InsValOp=H.NewArrOp=H.NewBinOp=H.NewStrOp=H.NewVecOp=H.NewObjOp=H.NewValOp=H.NewConOp=void 0;const e=_e(),t=$();class r{constructor(p){this.id=p}span(){return 1}toString(){let p=this.name()+" "+(0,t.printTs)(this.id);const v=this.span();return v>1&&(p+="!"+v),p}}class i extends r{constructor(p,v){super(p),this.id=p,this.val=v}name(){return"new_con"}toString(){const p=this.val,v="Uint8Array",S=p instanceof t.Timestamp?`{ ${(0,t.printTs)(p)} }`:p instanceof Uint8Array?p.length<13?`${v} { ${(""+p).replaceAll(",",", ")} }`:`${v}(${p.length})`:`{ ${JSON.stringify(p)} }`;return super.toString()+" "+S}}H.NewConOp=i;class n extends r{name(){return"new_val"}}H.NewValOp=n;class o extends r{name(){return"new_obj"}}H.NewObjOp=o;class s extends r{name(){return"new_vec"}}H.NewVecOp=s;class a extends r{name(){return"new_str"}}H.NewStrOp=a;class c extends r{name(){return"new_bin"}}H.NewBinOp=c;class l extends r{name(){return"new_arr"}}H.NewArrOp=l;class u extends r{constructor(p,v,S){super(p),this.id=p,this.obj=v,this.val=S}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}, val = ${(0,t.printTs)(this.val)}`}}H.InsValOp=u;class d extends r{constructor(p,v,S){super(p),this.id=p,this.obj=v,this.data=S}name(){return"ins_obj"}toString(p=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(p,this.data.map(S=>E=>`${JSON.stringify(S[0])}: ${(0,t.printTs)(S[1])}`))}}H.InsObjOp=d;class h extends r{constructor(p,v,S){super(p),this.id=p,this.obj=v,this.data=S}name(){return"ins_vec"}toString(p=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(p,this.data.map(S=>E=>`${S[0]}: ${(0,t.printTs)(S[1])}`))}}H.InsVecOp=h;class f extends r{constructor(p,v,S,E){super(p),this.id=p,this.obj=v,this.ref=S,this.data=E}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${(0,t.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}H.InsStrOp=f;class g extends r{constructor(p,v,S,E){super(p),this.id=p,this.obj=v,this.ref=S,this.data=E}span(){return this.data.length}name(){return"ins_bin"}toString(){const p=(0,t.printTs)(this.ref);return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${p} ← ${this.data} }`}}H.InsBinOp=g;class y extends r{constructor(p,v,S,E){super(p),this.id=p,this.obj=v,this.ref=S,this.data=E}span(){return this.data.length}name(){return"ins_arr"}toString(){const p=(0,t.printTs)(this.obj),v=(0,t.printTs)(this.ref),S=this.data.map(t.printTs).join(", ");return super.toString()+", obj = "+p+" { "+v+" ← "+S+" }"}}H.InsArrOp=y;class w extends r{constructor(p,v,S,E){super(p),this.id=p,this.obj=v,this.ref=S,this.val=E}name(){return"upd_arr"}toString(){const p=(0,t.printTs)(this.obj),v=(0,t.printTs)(this.ref),S=(0,t.printTs)(this.val);return super.toString()+", obj = "+p+" { "+v+": "+S+" }"}}H.UpdArrOp=w;class _ extends r{constructor(p,v,S){super(p),this.id=p,this.obj=v,this.what=S}name(){return"del"}toString(){const p=this.what.map(v=>(0,t.printTs)(v)+"!"+v.span).join(", ");return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${p} }`}}H.DelOp=_;class m extends r{constructor(p,v){super(p),this.id=p,this.len=v}span(){return this.len}name(){return"nop"}}return H.NopOp=m,H}var Xt={},Pi={},Qt={},Zt={},en={},tn={},Ya;function _m(){if(Ya)return tn;Ya=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.Slice=void 0;let e=class{constructor(r,i,n,o){this.uint8=r,this.view=i,this.start=n,this.end=o}subarray(){return this.uint8.subarray(this.start,this.end)}};return tn.Slice=e,tn}var Xa;function yf(){if(Xa)return en;Xa=1,Object.defineProperty(en,"__esModule",{value:!0}),en.Writer=void 0;const e=_m(),t=new Uint8Array([]),r=new DataView(t.buffer),i=typeof ge.Buffer=="function",n=i?ge.Buffer.prototype.utf8Write:null,o=i?ge.Buffer.from:null,s=typeof TextEncoder<"u"?new TextEncoder:null;let a=class{constructor(l=64*1024){this.allocSize=l,this.view=r,this.x0=0,this.x=0,this.uint8=new Uint8Array(l),this.size=l,this.view=new DataView(this.uint8.buffer)}grow(l){const u=this.x0,d=this.x,h=this.uint8,f=new Uint8Array(l),g=new DataView(f.buffer),y=h.subarray(u,d);f.set(y,0),this.x=d-u,this.x0=0,this.uint8=f,this.size=l,this.view=g}ensureCapacity(l){const u=this.size,d=u-this.x;if(d<l){const h=u-this.x0,f=l-d,g=h+f;this.grow(g<=this.allocSize?this.allocSize:g*2)}}move(l){this.ensureCapacity(l),this.x+=l}reset(){this.x0=this.x}newBuffer(l){const u=this.uint8=new Uint8Array(l);this.size=l,this.view=new DataView(u.buffer),this.x=this.x0=0}flush(){const l=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,l}flushSlice(){const l=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,l}u8(l){this.ensureCapacity(1),this.uint8[this.x++]=l}u16(l){this.ensureCapacity(2),this.view.setUint16(this.x,l),this.x+=2}u32(l){this.ensureCapacity(4),this.view.setUint32(this.x,l),this.x+=4}i32(l){this.ensureCapacity(4),this.view.setInt32(this.x,l),this.x+=4}u64(l){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(l)),this.x+=8}f64(l){this.ensureCapacity(8),this.view.setFloat64(this.x,l),this.x+=8}u8u16(l,u){this.ensureCapacity(3);let d=this.x;this.uint8[d++]=l,this.uint8[d++]=u>>>8,this.uint8[d++]=u&255,this.x=d}u8u32(l,u){this.ensureCapacity(5);let d=this.x;this.uint8[d++]=l,this.view.setUint32(d,u),this.x=d+4}u8u64(l,u){this.ensureCapacity(9);let d=this.x;this.uint8[d++]=l,this.view.setBigUint64(d,BigInt(u)),this.x=d+8}u8f32(l,u){this.ensureCapacity(5);let d=this.x;this.uint8[d++]=l,this.view.setFloat32(d,u),this.x=d+4}u8f64(l,u){this.ensureCapacity(9);let d=this.x;this.uint8[d++]=l,this.view.setFloat64(d,u),this.x=d+8}buf(l,u){this.ensureCapacity(u);const d=this.x;this.uint8.set(l,d),this.x=d+u}utf8(l){const u=l.length*4;if(u<168)return this.utf8Native(l);this.ensureCapacity(u);const d=this.size-this.x;if(n){const h=n.call(this.uint8,l,this.x,d);return this.x+=h,h}else if(o){const h=this.uint8,f=h.byteOffset+this.x,y=o(h.buffer).subarray(f,f+d).write(l,0,d,"utf8");return this.x+=y,y}else if(u>1024&&s){const h=s.encodeInto(l,this.uint8.subarray(this.x,this.x+d)).written;return this.x+=h,h}return this.utf8Native(l)}utf8Native(l){const u=l.length,d=this.uint8;let h=this.x,f=0;for(;f<u;){let y=l.charCodeAt(f++);if((y&4294967168)===0){d[h++]=y;continue}else if((y&4294965248)===0)d[h++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&f<u){const w=l.charCodeAt(f);(w&64512)===56320&&(f++,y=((y&1023)<<10)+(w&1023)+65536)}(y&4294901760)===0?(d[h++]=y>>12&15|224,d[h++]=y>>6&63|128):(d[h++]=y>>18&7|240,d[h++]=y>>12&63|128,d[h++]=y>>6&63|128)}d[h++]=y&63|128}const g=h-this.x;return this.x=h,g}ascii(l){const u=l.length;this.ensureCapacity(u);const d=this.uint8;let h=this.x,f=0;for(;f<u;)d[h++]=l.charCodeAt(f++);this.x=h}};return en.Writer=a,en}var Qa;function Jo(){if(Qa)return Zt;Qa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.CrdtWriter=void 0;const e=yf();let t=class extends e.Writer{id(i,n){i<=7&&n<=15?this.u8(i<<4|n):(this.b1vu56(1,i),this.vu57(n))}vu57(i){if(i<=127)this.u8(i);else if(i<=16383){this.ensureCapacity(2);const n=this.uint8;n[this.x++]=128|i&127,n[this.x++]=i>>>7}else if(i<=2097151){this.ensureCapacity(3);const n=this.uint8;n[this.x++]=128|i&127,n[this.x++]=128|i>>>7&127,n[this.x++]=i>>>14}else if(i<=268435455){this.ensureCapacity(4);const n=this.uint8;n[this.x++]=128|i&127,n[this.x++]=128|i>>>7&127,n[this.x++]=128|i>>>14&127,n[this.x++]=i>>>21}else{let n=i|0;n<0&&(n+=4294967296);const o=(i-n)/4294967296;if(i<=34359738367){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=128|i&127,s[this.x++]=128|i>>>7&127,s[this.x++]=128|i>>>14&127,s[this.x++]=128|i>>>21&127,s[this.x++]=o<<4|i>>>28}else if(i<=4398046511103){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=128|i&127,s[this.x++]=128|i>>>7&127,s[this.x++]=128|i>>>14&127,s[this.x++]=128|i>>>21&127,s[this.x++]=128|(o&7)<<4|i>>>28,s[this.x++]=o>>>3}else if(i<=562949953421311){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=128|i&127,s[this.x++]=128|i>>>7&127,s[this.x++]=128|i>>>14&127,s[this.x++]=128|i>>>21&127,s[this.x++]=128|(o&7)<<4|i>>>28,s[this.x++]=128|(o&1016)>>>3,s[this.x++]=o>>>10}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=128|i&127,s[this.x++]=128|i>>>7&127,s[this.x++]=128|i>>>14&127,s[this.x++]=128|i>>>21&127,s[this.x++]=128|(o&7)<<4|i>>>28,s[this.x++]=128|(o&1016)>>>3,s[this.x++]=128|(o&130048)>>>10,s[this.x++]=o>>>17}}}b1vu56(i,n){if(n<=63)this.u8(i<<7|n);else{const o=i<<7|64;if(n<=8191){this.ensureCapacity(2);const s=this.uint8;s[this.x++]=o|n&63,s[this.x++]=n>>>6}else if(n<=1048575){this.ensureCapacity(3);const s=this.uint8;s[this.x++]=o|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=n>>>13}else if(n<=134217727){this.ensureCapacity(4);const s=this.uint8;s[this.x++]=o|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=n>>>20}else{let s=n|0;s<0&&(s+=4294967296);const a=(n-s)/4294967296;if(n<=17179869183){this.ensureCapacity(5);const c=this.uint8;c[this.x++]=o|n&63,c[this.x++]=128|n>>>6&127,c[this.x++]=128|n>>>13&127,c[this.x++]=128|n>>>20&127,c[this.x++]=a<<5|n>>>27}else if(n<=2199023255551){this.ensureCapacity(6);const c=this.uint8;c[this.x++]=o|n&63,c[this.x++]=128|n>>>6&127,c[this.x++]=128|n>>>13&127,c[this.x++]=128|n>>>20&127,c[this.x++]=128|(a&3)<<5|n>>>27,c[this.x++]=a>>>2}else if(n<=0xffffffffffff){this.ensureCapacity(7);const c=this.uint8;c[this.x++]=o|n&63,c[this.x++]=128|n>>>6&127,c[this.x++]=128|n>>>13&127,c[this.x++]=128|n>>>20&127,c[this.x++]=128|(a&3)<<5|n>>>27,c[this.x++]=128|(a&508)>>>2,c[this.x++]=a>>>9}else{this.ensureCapacity(8);const c=this.uint8;c[this.x++]=o|n&63,c[this.x++]=128|n>>>6&127,c[this.x++]=128|n>>>13&127,c[this.x++]=128|n>>>20&127,c[this.x++]=128|(a&3)<<5|n>>>27,c[this.x++]=128|(a&508)>>>2,c[this.x++]=128|(a&65024)>>>9,c[this.x++]=a>>>16}}}}};return Zt.CrdtWriter=t,Zt}var nn={},rn={},Za;function Sm(){if(Za)return rn;Za=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),t=r=>(e.setFloat32(0,r),r===e.getFloat32(0));return rn.isFloat32=t,rn}var sn={},eu;function vf(){if(eu)return sn;eu=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.JsonPackExtension=void 0;let e=class{constructor(r,i){this.tag=r,this.val=i}};return sn.JsonPackExtension=e,sn}var on={},tu;function Em(){if(tu)return on;tu=1,Object.defineProperty(on,"__esModule",{value:!0}),on.CborEncoderFast=void 0;const e=yf(),t=Number.isSafeInteger;let r=class{constructor(n=new e.Writer){this.writer=n}encode(n){return this.writeAny(n),this.writer.flush()}writeAny(n){switch(typeof n){case"number":return this.writeNumber(n);case"string":return this.writeStr(n);case"boolean":return this.writer.u8(244+ +n);case"object":return n?n.constructor===Array?this.writeArr(n):this.writeObj(n):this.writer.u8(246)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(n){n?this.writer.u8(245):this.writer.u8(244)}writeNumber(n){t(n)?this.writeInteger(n):typeof n=="bigint"?this.writeBigInt(n):this.writeFloat(n)}writeBigInt(n){n>=0?this.writeBigUint(n):this.writeBigSint(n)}writeBigUint(n){if(n<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(n));this.writer.u8u64(27,n)}writeBigSint(n){if(n>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(n));const o=-BigInt(1)-n;this.writer.u8u64(59,o)}writeInteger(n){n>=0?this.writeUInteger(n):this.encodeNint(n)}writeUInteger(n){const o=this.writer;o.ensureCapacity(9);const s=o.uint8;let a=o.x;n<=23?s[a++]=0+n:n<=255?(s[a++]=24,s[a++]=n):n<=65535?(s[a++]=25,o.view.setUint16(a,n),a+=2):n<=4294967295?(s[a++]=26,o.view.setUint32(a,n),a+=4):(s[a++]=27,o.view.setBigUint64(a,BigInt(n)),a+=8),o.x=a}encodeNumber(n){this.writeNumber(n)}encodeInteger(n){this.writeInteger(n)}encodeUint(n){this.writeUInteger(n)}encodeNint(n){const o=-1-n,s=this.writer;s.ensureCapacity(9);const a=s.uint8;let c=s.x;o<24?a[c++]=32+o:o<=255?(a[c++]=56,a[c++]=o):o<=65535?(a[c++]=57,s.view.setUint16(c,o),c+=2):o<=4294967295?(a[c++]=58,s.view.setUint32(c,o),c+=4):(a[c++]=59,s.view.setBigUint64(c,BigInt(o)),c+=8),s.x=c}writeFloat(n){this.writer.u8f64(251,n)}writeBin(n){const o=n.length;this.writeBinHdr(o),this.writer.buf(n,o)}writeBinHdr(n){const o=this.writer;n<=23?o.u8(64+n):n<=255?o.u16(22528+n):n<=65535?o.u8u16(89,n):n<=4294967295?o.u8u32(90,n):o.u8u64(91,n)}writeStr(n){const o=this.writer,a=n.length*4;o.ensureCapacity(5+a);const c=o.uint8;let l=o.x;a<=23?o.x++:a<=255?(c[o.x++]=120,l=o.x,o.x++):a<=65535?(c[o.x++]=121,l=o.x,o.x+=2):(c[o.x++]=122,l=o.x,o.x+=4);const u=o.utf8(n);a<=23?c[l]=96+u:a<=255?c[l]=u:a<=65535?o.view.setUint16(l,u):o.view.setUint32(l,u)}writeStrHdr(n){const o=this.writer;n<=23?o.u8(96+n):n<=255?o.u16(30720+n):n<=65535?o.u8u16(121,n):o.u8u32(122,n)}writeAsciiStr(n){this.writeStrHdr(n.length),this.writer.ascii(n)}writeArr(n){const o=n.length;this.writeArrHdr(o);for(let s=0;s<o;s++)this.writeAny(n[s])}writeArrHdr(n){const o=this.writer;n<=23?o.u8(128+n):n<=255?o.u16(38912+n):n<=65535?o.u8u16(153,n):n<=4294967295?o.u8u32(154,n):o.u8u64(155,n)}writeObj(n){const o=Object.keys(n),s=o.length;this.writeObjHdr(s);for(let a=0;a<s;a++){const c=o[a];this.writeStr(c),this.writeAny(n[c])}}writeObjHdr(n){const o=this.writer;n<=23?o.u8(160+n):n<=255?o.u16(47104+n):n<=65535?o.u8u16(185,n):n<=4294967295?o.u8u32(186,n):o.u8u64(187,n)}writeMapHdr(n){this.writeObjHdr(n)}writeStartMap(){this.writer.u8(191)}writeTag(n,o){this.writeTagHdr(n),this.writeAny(o)}writeTagHdr(n){const o=this.writer;n<=23?o.u8(192+n):n<=255?o.u16(55296+n):n<=65535?o.u8u16(217,n):n<=4294967295?o.u8u32(218,n):o.u8u64(219,n)}writeTkn(n){const o=this.writer;n<=23?o.u8(224+n):n<=255&&o.u16(63488+n)}writeStartStr(){this.writer.u8(127)}writeStrChunk(n){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(n){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(n){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(n,o){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return on.CborEncoderFast=r,on}var cn={},nu;function Go(){if(nu)return cn;nu=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.JsonPackValue=void 0;let e=class{constructor(r){this.val=r}};return cn.JsonPackValue=e,cn}var ru;function wf(){if(ru)return nn;ru=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.CborEncoder=void 0;const e=Sm(),t=vf(),r=Em(),i=Go();let n=class extends r.CborEncoderFast{writeUnknown(s){this.writeNull()}writeAny(s){switch(typeof s){case"number":return this.writeNumber(s);case"string":return this.writeStr(s);case"boolean":return this.writer.u8(244+ +s);case"object":{if(!s)return this.writer.u8(246);switch(s.constructor){case Object:return this.writeObj(s);case Array:return this.writeArr(s);case Uint8Array:return this.writeBin(s);case Map:return this.writeMap(s);case t.JsonPackExtension:return this.writeTag(s.tag,s.val);case i.JsonPackValue:{const c=s.val;return this.writer.buf(c,c.length)}default:return s instanceof Uint8Array?this.writeBin(s):Array.isArray(s)?this.writeArr(s):s instanceof Map?this.writeMap(s):this.writeUnknown(s)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(s);default:return this.writeUnknown(s)}}writeFloat(s){(0,e.isFloat32)(s)?this.writer.u8f32(250,s):this.writer.u8f64(251,s)}writeMap(s){this.writeMapHdr(s.size),s.forEach((a,c)=>{this.writeAny(c),this.writeAny(a)})}writeUndef(){this.writer.u8(247)}};return nn.CborEncoder=n,nn}var su;function _f(){if(su)return Qt;su=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.Encoder=void 0;const t=z.__importStar(pt()),r=Jo(),i=$(),n=wf();class o extends n.CborEncoder{constructor(a=new r.CrdtWriter){super(a),this.writer=a,this.patchSid=0}encode(a){this.writer.reset();const c=a.getId(),l=this.patchSid=c.sid,u=this.writer;u.vu57(l),u.vu57(c.time);const d=a.meta;return d===void 0?this.writeUndef():this.writeArr([d]),this.encodeOperations(a),u.flush()}encodeOperations(a){const c=a.ops,l=c.length;this.writer.vu57(l);for(let u=0;u<l;u++)this.encodeOperation(c[u])}encodeId(a){const c=a.sid,l=a.time,u=this.writer;c===this.patchSid?u.b1vu56(0,l):(u.b1vu56(1,l),u.vu57(c))}encodeTss(a){this.encodeId(a),this.writer.vu57(a.span)}writeInsStr(a,c,l,u){const d=this.writer;return a<=7?d.u8(96+a):(d.u8(96),d.vu57(a)),this.encodeId(c),this.encodeId(l),d.utf8(u)}encodeOperation(a){const c=this.writer;switch(a.constructor){case t.NewConOp:{const d=a.val;d instanceof i.Timestamp?(c.u8(1),this.encodeId(d)):(c.u8(0),this.writeAny(d));break}case t.NewValOp:{c.u8(8);break}case t.NewObjOp:{c.u8(16);break}case t.NewVecOp:{c.u8(24);break}case t.NewStrOp:{c.u8(32);break}case t.NewBinOp:{c.u8(40);break}case t.NewArrOp:{c.u8(48);break}case t.InsValOp:{const u=a;c.u8(72),this.encodeId(u.obj),this.encodeId(u.val);break}case t.InsObjOp:{const u=a,d=u.data,h=d.length;h<=7?c.u8(80+h):(c.u8(80),c.vu57(h)),this.encodeId(u.obj);for(let f=0;f<h;f++){const g=d[f];this.writeStr(g[0]),this.encodeId(g[1])}break}case t.InsVecOp:{const u=a,d=u.data,h=d.length;h<=7?c.u8(88+h):(c.u8(88),c.vu57(h)),this.encodeId(u.obj);for(let f=0;f<h;f++){const g=d[f];c.u8(g[0]),this.encodeId(g[1])}break}case t.InsStrOp:{const u=a,d=u.obj,h=u.ref,f=u.data,g=f.length;c.ensureCapacity(24+g*4);const y=c.x,w=this.writeInsStr(g,d,h,f);g!==w&&(c.x=y,this.writeInsStr(w,d,h,f));break}case t.InsBinOp:{const u=a,d=u.data,h=d.length;h<=7?c.u8(104+h):(c.u8(104),c.vu57(h)),this.encodeId(u.obj),this.encodeId(u.ref),c.buf(d,h);break}case t.InsArrOp:{const u=a,d=u.data,h=d.length;h<=7?c.u8(112+h):(c.u8(112),c.vu57(h)),this.encodeId(u.obj),this.encodeId(u.ref);for(let f=0;f<h;f++)this.encodeId(d[f]);break}case t.UpdArrOp:{const u=a;c.u8(120),this.encodeId(u.obj),this.encodeId(u.ref),this.encodeId(u.val);break}case t.DelOp:{const u=a,d=u.what,h=d.length;h<=7?c.u8(128+h):(c.u8(128),c.vu57(h)),this.encodeId(u.obj);for(let f=0;f<h;f++)this.encodeTss(d[f]);break}case t.NopOp:{const d=a.len;d<=7?c.u8(136+d):(c.u8(136),c.vu57(d));break}default:throw new Error("UNKNOWN_OP")}}}return Qt.Encoder=o,Qt}var an={},un={},ln={},dn={},Yr={},$e={},iu;function Cm(){if(iu)return $e;iu=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.decodeAsciiMax15=$e.decodeAscii=void 0;const e=String.fromCharCode,t=(i,n,o)=>{const s=[];for(let a=0;a<o;a++){const c=i[n++];if(c&128)return;s.push(c)}return e.apply(String,s)};$e.decodeAscii=t;const r=(i,n,o)=>{if(o<4)if(o<2){if(o===0)return"";{const s=i[n++];if((s&128)>1){n-=1;return}return e(s)}}else{const s=i[n++],a=i[n++];if((s&128)>0||(a&128)>0){n-=2;return}if(o<3)return e(s,a);const c=i[n++];if((c&128)>0){n-=3;return}return e(s,a,c)}else{const s=i[n++],a=i[n++],c=i[n++],l=i[n++];if((s&128)>0||(a&128)>0||(c&128)>0||(l&128)>0){n-=4;return}if(o<6){if(o===4)return e(s,a,c,l);{const u=i[n++];if((u&128)>0){n-=5;return}return e(s,a,c,l,u)}}else if(o<8){const u=i[n++],d=i[n++];if((u&128)>0||(d&128)>0){n-=6;return}if(o<7)return e(s,a,c,l,u,d);const h=i[n++];if((h&128)>0){n-=7;return}return e(s,a,c,l,u,d,h)}else{const u=i[n++],d=i[n++],h=i[n++],f=i[n++];if((u&128)>0||(d&128)>0||(h&128)>0||(f&128)>0){n-=8;return}if(o<10){if(o===8)return e(s,a,c,l,u,d,h,f);{const g=i[n++];if((g&128)>0){n-=9;return}return e(s,a,c,l,u,d,h,f,g)}}else if(o<12){const g=i[n++],y=i[n++];if((g&128)>0||(y&128)>0){n-=10;return}if(o<11)return e(s,a,c,l,u,d,h,f,g,y);const w=i[n++];if((w&128)>0){n-=11;return}return e(s,a,c,l,u,d,h,f,g,y,w)}else{const g=i[n++],y=i[n++],w=i[n++],_=i[n++];if((g&128)>0||(y&128)>0||(w&128)>0||(_&128)>0){n-=12;return}if(o<14){if(o===12)return e(s,a,c,l,u,d,h,f,g,y,w,_);{const m=i[n++];if((m&128)>0){n-=13;return}return e(s,a,c,l,u,d,h,f,g,y,w,_,m)}}else{const m=i[n++],b=i[n++];if((m&128)>0||(b&128)>0){n-=14;return}if(o<15)return e(s,a,c,l,u,d,h,f,g,y,w,_,m,b);const p=i[n++];if((p&128)>0){n-=15;return}return e(s,a,c,l,u,d,h,f,g,y,w,_,m,b,p)}}}}};return $e.decodeAsciiMax15=r,$e}var Xr={},ou;function Om(){if(ou)return Xr;ou=1,Object.defineProperty(Xr,"__esModule",{value:!0});const e=String.fromCharCode;return Xr.default=(t,r,i)=>{let n=r;const o=n+i,s=[];for(;n<o;){let a=t[n++];if((a&128)!==0){const c=t[n++]&63;if((a&224)===192)a=(a&31)<<6|c;else{const l=t[n++]&63;if((a&240)===224)a=(a&31)<<12|c<<6|l;else if((a&248)===240){const u=t[n++]&63;let d=(a&7)<<18|c<<12|l<<6|u;if(d>65535){d-=65536;const h=d>>>10&1023|55296;a=56320|d&1023,s.push(h)}else a=d}}}s.push(a)}return e.apply(String,s)},Xr}var cu;function Am(){if(cu)return Yr;cu=1,Object.defineProperty(Yr,"__esModule",{value:!0});const e=z,t=Cm(),r=e.__importDefault(Om()),i=typeof ge.Buffer<"u",n=i?ge.Buffer.prototype.utf8Slice:null,o=i?ge.Buffer.from:null,s=(u,d,h)=>(0,t.decodeAsciiMax15)(u,d,h)??(0,r.default)(u,d,h),a=(u,d,h)=>(0,t.decodeAscii)(u,d,h)??(0,r.default)(u,d,h),c=n?(u,d,h)=>n.call(u,d,d+h):o?(u,d,h)=>o(u).subarray(d,d+h).toString("utf8"):r.default,l=(u,d,h)=>h<16?s(u,d,h):h<32?a(u,d,h):c(u,d,h);return Yr.default=l,Yr}var au;function Nm(){if(au)return dn;au=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.decodeUtf8=void 0;const t=z.__importDefault(Am());return dn.decodeUtf8=t.default,dn}var uu;function Ef(){if(uu)return ln;uu=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.Reader=void 0;const e=Nm();let t=class Sf{constructor(i=new Uint8Array([]),n=new DataView(i.buffer,i.byteOffset,i.length),o=0,s=i.length){this.uint8=i,this.view=n,this.x=o,this.end=s}reset(i){this.x=0,this.uint8=i,this.view=new DataView(i.buffer,i.byteOffset,i.length)}size(){return this.end-this.x}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(i){this.x+=i}buf(i=this.size()){const n=this.x,o=n+i,s=this.uint8.subarray(n,o);return this.x=o,s}subarray(i=0,n){const o=this.x,s=o+i,a=typeof n=="number"?o+n:this.end;return this.uint8.subarray(s,a)}slice(i=0,n){const o=this.x,s=o+i,a=typeof n=="number"?o+n:this.end;return new Sf(this.uint8,this.view,s,a)}cut(i=this.size()){const n=this.slice(0,i);return this.skip(i),n}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let i=this.x;const n=(this.uint8[i++]<<8)+this.uint8[i++];return this.x=i,n}i16(){const i=this.view.getInt16(this.x);return this.x+=2,i}u32(){const i=this.view.getUint32(this.x);return this.x+=4,i}i32(){const i=this.view.getInt32(this.x);return this.x+=4,i}u64(){const i=this.view.getBigUint64(this.x);return this.x+=8,i}i64(){const i=this.view.getBigInt64(this.x);return this.x+=8,i}f32(){const i=this.x;return this.x+=4,this.view.getFloat32(i)}f64(){const i=this.x;return this.x+=8,this.view.getFloat64(i)}utf8(i){const n=this.x;return this.x+=i,(0,e.decodeUtf8)(this.uint8,n,i)}ascii(i){const n=this.uint8;let o="";const s=this.x+i;for(let a=this.x;a<s;a++)o+=String.fromCharCode(n[a]);return this.x=s,o}};return ln.Reader=t,ln}var lu;function zo(){if(lu)return un;lu=1,Object.defineProperty(un,"__esModule",{value:!0}),un.CrdtReader=void 0;const e=Ef();let t=class extends e.Reader{id(){const i=this.u8();return i<=127?[i>>>4,i&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const i=this.u8();if(i<=127)return i;const n=this.u8();if(n<=127)return n<<7|i&127;const o=this.u8();if(o<=127)return o<<14|(n&127)<<7|i&127;const s=this.u8();if(s<=127)return s<<21|(o&127)<<14|(n&127)<<7|i&127;const a=this.u8();if(a<=127)return a*268435456+((s&127)<<21|(o&127)<<14|(n&127)<<7|i&127);const c=this.u8();if(c<=127)return c*34359738368+((a&127)*268435456+((s&127)<<21|(o&127)<<14|(n&127)<<7|i&127));const l=this.u8();return l<=127?l*4398046511104+((c&127)*34359738368+((a&127)*268435456+((s&127)<<21|(o&127)<<14|(n&127)<<7|i&127))):this.u8()*562949953421312+((l&127)*4398046511104+((c&127)*34359738368+((a&127)*268435456+((s&127)<<21|(o&127)<<14|(n&127)<<7|i&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const i=this.u8(),n=i&128?1:0,o=127&i;if(o<=63)return[n,o];const s=this.u8();if(s<=127)return[n,s<<6|o&63];const a=this.u8();if(a<=127)return[n,a<<13|(s&127)<<6|o&63];const c=this.u8();if(c<=127)return[n,c<<20|(a&127)<<13|(s&127)<<6|o&63];const l=this.u8();if(l<=127)return[n,l*134217728+((c&127)<<20|(a&127)<<13|(s&127)<<6|o&63)];const u=this.u8();if(u<=127)return[n,u*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(s&127)<<6|o&63))];const d=this.u8();if(d<=127)return[n,d*2199023255552+((u&127)*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(s&127)<<6|o&63)))];const h=this.u8();return[n,h*281474976710656+((d&127)*2199023255552+((u&127)*17179869184+((l&127)*134217728+((c&127)<<20|(a&127)<<13|(s&127)<<6|o&63))))]}};return un.CrdtReader=t,un}var fn={},hn={},du;function Ho(){return du||(du=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.isUint8Array=void 0,hn.isUint8Array=typeof ge.Buffer=="function"?e=>e instanceof Uint8Array||ge.Buffer.isBuffer(e):e=>e instanceof Uint8Array),hn}var Mi={},Di={},fu;function Im(){return fu||(fu=1,Object.defineProperty(Di,"__esModule",{value:!0})),Di}var hu;function ws(){return hu||(hu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const t=z,r=$();t.__exportStar(Im(),e),e.ORIGIN=(0,r.ts)(0,0)})(Mi)),Mi}var Bi={},qi={},pn={},pu;function _s(){if(pu)return pn;pu=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.printBinary=void 0;const e=(t="",r)=>{const i=r[0],n=r[1];let o="";return i&&(o+=`
`+t+"← "+i(t+"  ")),n&&(o+=`
`+t+"→ "+n(t+"  ")),o};return pn.printBinary=e,pn}var mn={},mu;function km(){if(mu)return mn;mu=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.printJson=void 0;const e=(t="",r,i=2)=>(JSON.stringify(r,null,i)||"nil").split(`
`).join(`
`+t);return mn.printJson=e,mn}var bu;function Rm(){return bu||(bu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(_e(),e),t.__exportStar(_s(),e),t.__exportStar(km(),e)})(qi)),qi}var gu;function Wo(){return gu||(gu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.SchemaNode=e.NodeBuilder=void 0;const t=z,r=Ho(),i=$(),n=t.__importStar(Nf()),o=Rm(),s=u=>{switch(typeof u){case"number":case"boolean":case"undefined":return!0;case"object":return u===null||u instanceof i.Timestamp;default:return!1}};class a{constructor(d){this._build=d}build(d){return this._build?.(d)??d.con(void 0)}}e.NodeBuilder=a;class c extends a{toString(d){return this.type}}e.SchemaNode=c;var l;(function(u){class d extends c{constructor(p){super(),this.raw=p,this.type="con"}build(p){return p.con(this.raw)}toString(p){return this.type+" "+n.con(this.raw)}}u.con=d;class h extends c{constructor(p){super(),this.raw=p,this.type="str"}build(p){return p.json(this.raw)}toString(p){return this.type+" "+n.con(this.raw)}}u.str=h;class f extends c{constructor(p){super(),this.raw=p,this.type="bin"}build(p){return p.json(this.raw)}toString(p){return this.type+" "+n.bin(this.raw)}}u.bin=f;class g extends c{constructor(p){super(),this.value=p,this.type="val"}build(p){const v=p.val(),S=this.value.build(p);return p.setVal(v,S),v}toString(p){return this.type+(0,o.printTree)(p,[v=>this.value.toString(v)])}}u.val=g;class y extends c{constructor(p){super(),this.value=p,this.type="vec"}build(p){const v=p.vec(),S=this.value,E=S.length;if(E){const O=[];for(let A=0;A<E;A++){const C=S[A];if(!C)continue;const N=C.build(p);O.push([A,N])}p.insVec(v,O)}return v}toString(p){return this.type+(0,o.printTree)(p,[...this.value.map((v,S)=>E=>`${S}: ${v?v.toString(E):n.line(v)}`)])}}u.vec=y;class w extends c{constructor(p,v){super(),this.obj=p,this.opt=v,this.type="obj"}optional(){return this}build(p){const v=p.obj(),S=[],E={...this.obj,...this.opt},O=Object.keys(E),A=O.length;if(A){for(let C=0;C<A;C++){const N=O[C],I=E[N].build(p);S.push([N,I])}p.insObj(v,S)}return v}toString(p=""){return this.type+(0,o.printTree)(p,[...[...Object.entries(this.obj)].map(([v,S])=>E=>n.line(v)+(0,o.printTree)(E+" ",[O=>S.toString(O)])),...[...Object.entries(this.opt??[])].map(([v,S])=>E=>n.line(v)+"?"+(0,o.printTree)(E+" ",[O=>S.toString(O)]))])}}u.obj=w;class _ extends c{constructor(p){super(),this.arr=p,this.type="arr"}build(p){const v=p.arr(),S=this.arr,E=S.length;if(E){const O=[];for(let A=0;A<E;A++)O.push(S[A].build(p));p.insArr(v,v,O)}return v}toString(p){return this.type+(0,o.printTree)(p,[...this.arr.map((v,S)=>E=>`[${S}]: ${v?v.toString(E):n.line(v)}`)])}}u.arr=_;class m extends c{constructor(p,v){super(),this.id=p,this.data=v,this.type="ext"}build(p){const v=new Uint8Array([this.id,0,0]),S=p.vec();return v[1]=S.sid%256,v[2]=S.time%256,p.insVec(S,[[0,p.constOrJson(e.s.con(v))],[1,this.data.build(p)]]),S}toString(p){return this.type+"("+this.id+")"+(0,o.printTree)(p,[v=>this.data.toString(v)])}}u.ext=m})(l||(e.nodes=l={})),e.schema={con:u=>new l.con(u),str:u=>new l.str(u||""),bin:u=>new l.bin(u),val:u=>new l.val(u),vec:(...u)=>new l.vec(u),obj:(u,d)=>new l.obj(u,d),map:u=>e.schema.obj(u),arr:u=>new l.arr(u),json:u=>{switch(typeof u){case"object":{if(!u)return e.s.val(e.s.con(u));if(u instanceof a)return u;if(Array.isArray(u))return e.s.arr(u.map(d=>e.s.json(d)));if((0,r.isUint8Array)(u))return e.s.bin(u);if(u instanceof i.Timestamp)return e.s.val(e.s.con(u));{const d={},h=Object.keys(u);for(const f of h)d[f]=e.s.jsonCon(u[f]);return e.s.obj(d)}}case"string":return e.s.str(u);default:return e.s.val(e.s.con(u))}},jsonCon:u=>s(u)?e.s.con(u):e.s.json(u),ext:(u,d)=>new l.ext(u,d)},e.s=e.schema})(Bi)),Bi}var yu;function Ss(){if(yu)return fn;yu=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.PatchBuilder=void 0;const t=z.__importStar(pt()),r=$(),i=Ho(),n=Af(),o=ws(),s=Wo(),a=l=>{switch(typeof l){case"number":case"boolean":return!0;default:return l===null}};let c=class{constructor(u){this.clock=u,this.patch=new n.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const u=this.patch;return this.patch=new n.Patch,u}obj(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewObjOp(u)),u}arr(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewArrOp(u)),u}vec(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewVecOp(u)),u}str(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewStrOp(u)),u}bin(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewBinOp(u)),u}con(u){this.pad();const d=this.clock.tick(1);return this.patch.ops.push(new t.NewConOp(d,u)),d}val(){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new t.NewValOp(u)),u}root(u){return this.setVal(o.ORIGIN,u)}insObj(u,d){if(!d.length)throw new Error("EMPTY_TUPLES");this.pad();const h=this.clock.tick(1),f=new t.InsObjOp(h,u,d),g=f.span();return g>1&&this.clock.tick(g-1),this.patch.ops.push(f),h}insVec(u,d){if(!d.length)throw new Error("EMPTY_TUPLES");this.pad();const h=this.clock.tick(1),f=new t.InsVecOp(h,u,d),g=f.span();return g>1&&this.clock.tick(g-1),this.patch.ops.push(f),h}setVal(u,d){this.pad();const h=this.clock.tick(1),f=new t.InsValOp(h,u,d);return this.patch.ops.push(f),h}insStr(u,d,h){if(!h.length)throw new Error("EMPTY_STRING");this.pad();const f=this.clock.tick(1),g=new t.InsStrOp(f,u,d,h),y=g.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(g),f}insBin(u,d,h){if(!h.length)throw new Error("EMPTY_BINARY");this.pad();const f=this.clock.tick(1),g=new t.InsBinOp(f,u,d,h),y=g.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(g),f}insArr(u,d,h){this.pad();const f=this.clock.tick(1),g=new t.InsArrOp(f,u,d,h),y=g.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(g),f}updArr(u,d,h){this.pad();const f=this.clock.tick(1),g=new t.UpdArrOp(f,u,d,h);return this.patch.ops.push(g),f}del(u,d){this.pad();const h=this.clock.tick(1);return this.patch.ops.push(new t.DelOp(h,u,d)),h}nop(u){this.pad();const d=this.clock.tick(u);return this.patch.ops.push(new t.NopOp(d,u)),d}jsonObj(u){const d=this.obj(),h=Object.keys(u);if(h.length){const f=[];for(const g of h){const y=u[g],w=y instanceof r.Timestamp?y:a(y)?this.con(y):this.json(y);f.push([g,w])}this.insObj(d,f)}return d}jsonArr(u){const d=this.arr();if(u.length){const h=[];for(const f of u)h.push(this.json(f));this.insArr(d,d,h)}return d}jsonStr(u){const d=this.str();return u&&this.insStr(d,d,u),d}jsonBin(u){const d=this.bin();return u.length&&this.insBin(d,d,u),d}jsonVal(u){const d=this.val(),h=this.con(u);return this.setVal(d,h),d}json(u){if(u instanceof r.Timestamp)return u;if(u===void 0)return this.con(u);if(u instanceof Array)return this.jsonArr(u);if((0,i.isUint8Array)(u))return this.jsonBin(u);if(u instanceof s.NodeBuilder)return u.build(this);switch(typeof u){case"object":return u===null?this.jsonVal(u):this.jsonObj(u);case"string":return this.jsonStr(u);case"number":case"boolean":return this.jsonVal(u)}throw new Error("INVALID_JSON")}constOrJson(u){return u instanceof r.Timestamp?u:a(u)?this.con(u):this.json(u)}maybeConst(u){return u instanceof r.Timestamp?u:this.con(u)}pad(){const u=this.patch.nextTime();if(!u)return;const d=this.clock.time-u;if(d>0){const h=(0,r.ts)(this.clock.sid,u),f=new t.NopOp(h,d);this.patch.ops.push(f)}}};return fn.PatchBuilder=c,fn}var bn={},gn={},yn={},vu;function Tm(){if(vu)return yn;vu=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.decodeF16=void 0;const e=Math.pow,t=r=>{const i=(r&31744)>>10,n=r&1023;return(r>>15?-1:1)*(i?i===31?n?NaN:1/0:e(2,i-15)*(1+n/1024):6103515625e-14*(n/1024))};return yn.decodeF16=t,yn}var Qr={},vn={},Zr={},wu;function xm(){if(wu)return Zr;wu=1,Object.defineProperty(Zr,"__esModule",{value:!0});const e=String.fromCharCode;return Zr.default=(t,r,i)=>{let n=r;const o=n+i;let s="";for(;n<o;){const a=t[n++];if((a&128)===0){s+=e(a);continue}const c=t[n++]&63;if((a&224)===192){s+=e((a&31)<<6|c);continue}const l=t[n++]&63;if((a&240)===224){s+=e((a&31)<<12|c<<6|l);continue}if((a&248)===240){const u=t[n++]&63;let d=(a&7)<<18|c<<12|l<<6|u;if(d>65535){d-=65536;const h=d>>>10&1023|55296;d=56320|d&1023,s+=e(h,d)}else s+=e(d)}else s+=e(a)}return s},Zr}var _u;function jm(){if(_u)return vn;_u=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.CachedUtf8Decoder=void 0;const t=z.__importDefault(xm());let r=1+Math.round(Math.random()*((-1>>>0)-1));function i(s,a){return r^=r<<13,r^=r>>>17,r^=r<<5,(r>>>0)%(a-s+1)+s}class n{constructor(a,c){this.bytes=a,this.value=c}}let o=class{constructor(){this.caches=[];for(let a=0;a<31;a++)this.caches.push([])}get(a,c,l){const u=this.caches[l-1],d=u.length;e:for(let h=0;h<d;h++){const f=u[h],g=f.bytes;for(let y=0;y<l;y++)if(g[y]!==a[c+y])continue e;return f.value}return null}store(a,c){const l=this.caches[a.length-1],u=new n(a,c);l.length>=16?l[i(0,15)]=u:l.push(u)}decode(a,c,l){if(!l)return"";const u=this.get(a,c,l);if(u!==null)return u;const d=(0,t.default)(a,c,l),h=Uint8Array.prototype.slice.call(a,c,c+l);return this.store(h,d),d}};return vn.CachedUtf8Decoder=o,vn}var Su;function Pm(){if(Su)return Qr;Su=1,Object.defineProperty(Qr,"__esModule",{value:!0});const e=jm();return Qr.default=new e.CachedUtf8Decoder,Qr}var Eu;function Ko(){if(Eu)return gn;Eu=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.CborDecoderBase=void 0;const e=z,t=Tm(),r=vf(),i=Go(),n=Ef(),o=e.__importDefault(Pm());let s=class{constructor(c=new n.Reader,l=o.default){this.reader=c,this.keyDecoder=l}read(c){return this.reader.reset(c),this.readAny()}decode(c){return this.reader.reset(c),this.readAny()}val(){return this.readAny()}readAny(){const l=this.reader.u8(),u=l>>5,d=l&31;return u<4?u<2?u===0?this.readUint(d):this.readNint(d):u===2?this.readBin(d):this.readStr(d):u<6?u===4?this.readArr(d):this.readObj(d):u===6?this.readTag(d):this.readTkn(d)}readAnyRaw(c){const l=c>>5,u=c&31;return l<4?l<2?l===0?this.readUint(u):this.readNint(u):l===2?this.readBin(u):this.readStr(u):l<6?l===4?this.readArr(u):this.readObj(u):l===6?this.readTag(u):this.readTkn(u)}readMinorLen(c){if(c<24)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(c){if(c<25)return c===24?this.reader.u8():c;if(c<27)return c===25?this.reader.u16():this.reader.u32();{const l=this.reader.u64();return l>9007199254740991?l:Number(l)}}readNint(c){if(c<25)return c===24?-this.reader.u8()-1:-c-1;if(c<27)return c===25?-this.reader.u16()-1:-this.reader.u32()-1;{const l=this.reader.u64();return l>9007199254740991-1?-l-BigInt(1):-Number(l)-1}}readBin(c){const l=this.reader;if(c<=23)return l.buf(c);switch(c){case 24:return l.buf(l.u8());case 25:return l.buf(l.u16());case 26:return l.buf(l.u32());case 27:return l.buf(Number(l.u64()));case 31:{let u=0;const d=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();u+=y.length,d.push(y)}this.reader.x++;const h=new Uint8Array(u);let f=0;const g=d.length;for(let y=0;y<g;y++){const w=d[y];h.set(w,f),f+=w.length}return h}default:throw 1}}readBinChunk(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==2)throw 2;if(u>27)throw 3;return this.readBin(u)}readAsStr(){const l=this.reader.u8(),u=l>>5,d=l&31;if(u!==3)throw 11;return this.readStr(d)}readStr(c){const l=this.reader;if(c<=23)return l.utf8(c);switch(c){case 24:return l.utf8(l.u8());case 25:return l.utf8(l.u16());case 26:return l.utf8(l.u32());case 27:return l.utf8(Number(l.u64()));case 31:{let u="";for(;l.peak()!==255;)u+=this.readStrChunk();return this.reader.x++,u}default:throw 1}}readStrLen(c){if(c<=23)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==3)throw 4;if(u>27)throw 5;return this.readStr(u)}readArr(c){const l=this.readMinorLen(c);return l>=0?this.readArrRaw(l):this.readArrIndef()}readArrRaw(c){const l=[];for(let u=0;u<c;u++)l.push(this.readAny());return l}readArrIndef(){const c=[];for(;this.reader.peak()!==255;)c.push(this.readAny());return this.reader.x++,c}readObj(c){if(c<28){let l=c;switch(c){case 24:l=this.reader.u8();break;case 25:l=this.reader.u16();break;case 26:l=this.reader.u32();break;case 27:l=Number(this.reader.u64());break}const u={};for(let d=0;d<l;d++){const h=this.key();if(h==="__proto__")throw 6;const f=this.readAny();u[h]=f}return u}else{if(c===31)return this.readObjIndef();throw 1}}readObjRaw(c){const l={};for(let u=0;u<c;u++){const d=this.key(),h=this.readAny();l[d]=h}return l}readObjIndef(){const c={};for(;this.reader.peak()!==255;){const l=this.key();if(this.reader.peak()===255)throw 7;const u=this.readAny();c[l]=u}return this.reader.x++,c}key(){const c=this.reader.u8(),l=c>>5,u=c&31;if(l!==3)return String(this.readAnyRaw(c));const d=this.readStrLen(u);if(d>31)return this.reader.utf8(d);const h=this.keyDecoder.decode(this.reader.uint8,this.reader.x,d);return this.reader.skip(d),h}readTag(c){if(c<=23)return this.readTagRaw(c);switch(c){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(c){return new r.JsonPackExtension(c,this.readAny())}readTkn(c){switch(c){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new i.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(c<=23)return new i.JsonPackValue(c);throw 1}f16(){return(0,t.decodeF16)(this.reader.u16())}};return gn.CborDecoderBase=s,gn}var Cu;function Mm(){if(Cu)return bn;Cu=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.CborDecoder=void 0;const e=Ko(),t=Go();let r=class extends e.CborDecoderBase{readAsMap(){const n=this.reader.u8(),o=n>>5,s=n&31;if(o===5)return this.readMap(s);throw 0}readMap(n){const o=this.readMinorLen(n);return o>=0?this.readMapRaw(o):this.readMapIndef()}readMapRaw(n){const o=new Map;for(let s=0;s<n;s++){const a=this.readAny(),c=this.readAny();o.set(a,c)}return o}readMapIndef(){const n=new Map;for(;this.reader.peak()!==255;){const o=this.readAny();if(this.reader.peak()===255)throw 7;const s=this.readAny();n.set(o,s)}return this.reader.x++,n}skipN(n){for(let o=0;o<n;o++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(n){const o=n>>5,s=n&31;switch(o){case 0:case 1:this.skipUNint(s);break;case 2:this.skipBin(s);break;case 3:this.skipStr(s);break;case 4:this.skipArr(s);break;case 5:this.skipObj(s);break;case 7:this.skipTkn(s);break;case 6:this.skipTag(s);break}}skipMinorLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(n){if(!(n<=23))switch(n){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(n){const o=this.skipMinorLen(n);if(o>=0)this.reader.skip(o);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const n=this.reader.u8(),o=n>>5,s=n&31;if(o!==2)throw 2;if(s>27)throw 3;this.skipBin(s)}skipStr(n){const o=this.skipMinorLen(n);if(o>=0)this.reader.skip(o);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const n=this.reader.u8(),o=n>>5,s=n&31;if(o!==3)throw 4;if(s>27)throw 5;this.skipStr(s)}skipArr(n){const o=this.skipMinorLen(n);if(o>=0)this.skipN(o);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(n){const o=this.readMinorLen(n);if(o>=0)return this.skipN(o*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(n){if(this.skipMinorLen(n)<0)throw 1;this.skipAny()}skipTkn(n){switch(n){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(n<=23))throw 1}validate(n,o=0,s=n.length){this.reader.reset(n),this.reader.x=o;const a=o;if(this.skipAny(),this.reader.x-a!==s)throw 8}decodeLevel(n){return this.reader.reset(n),this.readLevel()}readLevel(){const n=this.reader.u8(),o=n>>5,s=n&31;switch(o){case 4:return this.readArrLevel(s);case 5:return this.readObjLevel(s);default:return super.readAnyRaw(n)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.readAny()}}readAsValue(){const n=this.reader,o=n.x;this.skipAny();const s=n.x;return new t.JsonPackValue(n.uint8.subarray(o,s))}readObjLevel(n){const o=this.readMinorLen(n);return o>=0?this.readObjRawLevel(o):this.readObjIndefLevel()}readObjRawLevel(n){const o={};for(let s=0;s<n;s++){const a=this.key(),c=this.readPrimitiveOrVal();o[a]=c}return o}readObjIndefLevel(){const n={};for(;this.reader.peak()!==255;){const o=this.key();if(this.reader.peak()===255)throw 7;const s=this.readPrimitiveOrVal();n[o]=s}return this.reader.x++,n}readArrLevel(n){const o=this.readMinorLen(n);return o>=0?this.readArrRawLevel(o):this.readArrIndefLevel()}readArrRawLevel(n){const o=[];for(let s=0;s<n;s++)o.push(this.readPrimitiveOrVal());return o}readArrIndefLevel(){const n=[];for(;this.reader.peak()!==255;)n.push(this.readPrimitiveOrVal());return this.reader.x++,n}readHdr(n){const o=this.reader.u8();if(o>>5!==n)throw 0;const a=o&31;if(a<24)return a;switch(a){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(n){const o=this.readObjHdr();for(let s=0;s<o;s++){if(this.key()===n)return this;this.skipAny()}throw 9}findIndex(n){const o=this.readArrHdr();if(n>=o)throw 10;for(let s=0;s<n;s++)this.skipAny();return this}find(n){for(let o=0;o<n.length;o++){const s=n[o];typeof s=="string"?this.findKey(s):this.findIndex(s)}return this}};return bn.CborDecoder=r,bn}var Ou;function Cf(){if(Ou)return an;Ou=1,Object.defineProperty(an,"__esModule",{value:!0}),an.Decoder=void 0;const e=zo(),t=$(),r=Ss(),i=Mm();class n extends i.CborDecoder{constructor(s=new e.CrdtReader){super(s)}decode(s){return this.reader.reset(s),this.readPatch()}readPatch(){const s=this.reader,a=s.vu57(),c=s.vu57(),u=a===1?new t.ServerClockVector(1,c):new t.ClockVector(a,c);this.patchSid=u.sid;const d=this.builder=new r.PatchBuilder(u),h=this.val();return Array.isArray(h)&&(d.patch.meta=h[0]),this.decodeOperations(),d.patch}decodeId(){const s=this.reader,[a,c]=s.b1vu56();return a?new t.Timestamp(s.vu57(),c):new t.Timestamp(this.patchSid,c)}decodeTss(){const s=this.decodeId(),a=this.reader.vu57();return(0,t.interval)(s,0,a)}decodeOperations(){const a=this.reader.vu57();for(let c=0;c<a;c++)this.decodeOperation()}decodeOperation(){const s=this.builder,a=this.reader,c=a.u8();switch(c>>3){case 0:{const u=c&7;s.con(u?this.decodeId():this.val());break}case 1:{s.val();break}case 2:{s.obj();break}case 3:{s.vec();break}case 4:{s.str();break}case 5:{s.bin();break}case 6:{s.arr();break}case 9:{const u=this.decodeId(),d=this.decodeId();s.setVal(u,d);break}case 10:{const u=c&7||a.vu57(),d=this.decodeId(),h=[];for(let f=0;f<u;f++){const g=this.val();if(typeof g!="string")continue;const y=this.decodeId();h.push([g,y])}s.insObj(d,h);break}case 11:{const u=c&7||a.vu57(),d=this.decodeId(),h=[];for(let f=0;f<u;f++){const g=this.val();if(typeof g!="number")continue;const y=this.decodeId();h.push([g,y])}s.insVec(d,h);break}case 12:{const u=c&7||a.vu57(),d=this.decodeId(),h=this.decodeId(),f=a.utf8(u);s.insStr(d,h,f);break}case 13:{const u=c&7||a.vu57(),d=this.decodeId(),h=this.decodeId(),f=a.buf(u);if(!(f instanceof Uint8Array))return;s.insBin(d,h,f);break}case 14:{const u=c&7||a.vu57(),d=this.decodeId(),h=this.decodeId(),f=[];for(let g=0;g<u;g++)f.push(this.decodeId());s.insArr(d,h,f);break}case 15:{const u=this.decodeId(),d=this.decodeId(),h=this.decodeId();s.updArr(u,d,h);break}case 16:{const u=c&7||a.vu57(),d=this.decodeId(),h=[];for(let f=0;f<u;f++)h.push(this.decodeTss());s.del(d,h);break}case 17:{const u=c&7||a.vu57();s.nop(u);break}default:throw new Error("UNKNOWN_OP")}}}return an.Decoder=n,an}var Li={},Au;function Dm(){return Au||(Au=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const t=_f(),r=Cf(),i=Jo(),n=new i.CrdtWriter(1024*4);e.encoder=new t.Encoder(n);const o=a=>e.encoder.encode(a);e.encode=o,e.decoder=new r.Decoder;const s=a=>e.decoder.decode(a);e.decode=s})(Li)),Li}var Nu;function Bm(){return Nu||(Nu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(_f(),e),t.__exportStar(Cf(),e),t.__exportStar(Dm(),e)})(Pi)),Pi}var Iu;function Af(){if(Iu)return Xt;Iu=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Patch=void 0;const t=z.__importStar(pt()),r=$(),i=_e(),n=Bm();let o=class Of{constructor(){this.ops=[],this.meta=void 0}static fromBinary(a){return(0,n.decode)(a)}getId(){const a=this.ops[0];if(a)return a.id}span(){let a=0;for(const c of this.ops)a+=c.span();return a}nextTime(){const a=this.ops,c=a.length;if(!c)return 0;const l=a[c-1];return l.id.time+l.span()}rewriteTime(a){const c=new Of,l=this.ops,u=l.length,d=c.ops;for(let h=0;h<u;h++){const f=l[h];f instanceof t.DelOp?d.push(new t.DelOp(a(f.id),a(f.obj),f.what)):f instanceof t.NewConOp?d.push(new t.NewConOp(a(f.id),f.val instanceof r.Timestamp?a(f.val):f.val)):f instanceof t.NewVecOp?d.push(new t.NewVecOp(a(f.id))):f instanceof t.NewValOp?d.push(new t.NewValOp(a(f.id))):f instanceof t.NewObjOp?d.push(new t.NewObjOp(a(f.id))):f instanceof t.NewStrOp?d.push(new t.NewStrOp(a(f.id))):f instanceof t.NewBinOp?d.push(new t.NewBinOp(a(f.id))):f instanceof t.NewArrOp?d.push(new t.NewArrOp(a(f.id))):f instanceof t.InsArrOp?d.push(new t.InsArrOp(a(f.id),a(f.obj),a(f.ref),f.data.map(a))):f instanceof t.UpdArrOp?d.push(new t.UpdArrOp(a(f.id),a(f.obj),a(f.ref),a(f.val))):f instanceof t.InsStrOp?d.push(new t.InsStrOp(a(f.id),a(f.obj),a(f.ref),f.data)):f instanceof t.InsBinOp?d.push(new t.InsBinOp(a(f.id),a(f.obj),a(f.ref),f.data)):f instanceof t.InsValOp?d.push(new t.InsValOp(a(f.id),a(f.obj),a(f.val))):f instanceof t.InsObjOp?d.push(new t.InsObjOp(a(f.id),a(f.obj),f.data.map(([g,y])=>[g,a(y)]))):f instanceof t.InsVecOp?d.push(new t.InsVecOp(a(f.id),a(f.obj),f.data.map(([g,y])=>[g,a(y)]))):f instanceof t.NopOp&&d.push(new t.NopOp(a(f.id),f.len))}return c}rebase(a,c){const l=this.getId();if(!l)throw new Error("EMPTY_PATCH");const u=l.sid,d=l.time;if(c??(c=d),d===a)return this;const h=a-d;return this.rewriteTime(f=>{if(f.sid!==u)return f;const g=f.time;return g<c?f:(0,r.ts)(u,g+h)})}clone(){return this.rewriteTime(a=>a)}toBinary(){return(0,n.encode)(this)}toString(a=""){const c=this.getId();return`Patch ${c?(0,r.printTs)(c):"(nil)"}!${this.span()}`+(0,i.printTree)(a,this.ops.map(u=>d=>u.toString(d)))}};return Xt.Patch=o,Xt}var ku;function mt(){return ku||(ku=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(ym(),e),t.__exportStar($(),e),t.__exportStar(pt(),e),t.__exportStar(Af(),e),t.__exportStar(Ss(),e),t.__exportStar(Wo(),e)})(ki)),ki}var Ru;function Nf(){return Ru||(Ru=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bin=e.con=e.line=void 0;const t=gm(),r=mt();e.line=t.toLine;const i=o=>o instanceof Uint8Array?"Uint8Array "+(0,e.bin)(o):`{ ${o instanceof r.Timestamp?(0,r.printTs)(o):(0,e.line)(o)} }`;e.con=i;const n=o=>"{ "+(""+o).replaceAll(",",", ")+" }";e.bin=n})(Ni)),Ni}var Tu;function Es(){if(Tu)return Kt;Tu=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.ConNode=void 0;const e=Nf(),t=$();let r=class{constructor(n,o){this.id=n,this.val=o,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(n){return this.name()+" "+(0,t.printTs)(this.id)+" "+(0,e.con)(this.val)}};return Kt.ConNode=r,Kt}var wn={},Ye={},Xe={},_n={},Sn={},En={},xu;function qm(){if(xu)return En;xu=1,Object.defineProperty(En,"__esModule",{value:!0}),En.RelativeTimestamp=void 0;let e=class{constructor(r,i){this.sessionIndex=r,this.timeDiff=i}};return En.RelativeTimestamp=e,En}var ju;function Lm(){if(ju)return Sn;ju=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.ClockEncoder=void 0;const e=$(),t=qm();class r{constructor(o,s){this.index=o,this.clock=s}}let i=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(o){this.index=1,this.clock=o;const s=new r(this.index++,(0,e.tick)(o,-1));this.table.clear(),this.table.set(o.sid,s)}append(o){const s=o.time,a=o.sid;let c=this.table.get(a);if(!c){let d=this.clock.peers.get(a);d||(d=new e.Timestamp(a,this.clock.time-1)),c=new r(this.index++,d),this.table.set(a,c)}const u=c.clock.time-s;if(u<0)throw new Error("TIME_TRAVEL");return new t.RelativeTimestamp(c.index,u)}toJson(){const o=[];return this.table.forEach(s=>{const a=s.clock;o.push(a.sid,a.time)}),o}};return Sn.ClockEncoder=i,Sn}var Qe={},Pu;function $o(){if(Pu)return Qe;Pu=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.CRDT_MAJOR_OVERLAY=Qe.CRDT_MAJOR=void 0;var e;(function(r){r[r.CON=0]="CON",r[r.VAL=1]="VAL",r[r.OBJ=2]="OBJ",r[r.VEC=3]="VEC",r[r.STR=4]="STR",r[r.BIN=5]="BIN",r[r.ARR=6]="ARR"})(e||(Qe.CRDT_MAJOR=e={}));var t;return(function(r){r[r.CON=0]="CON",r[r.VAL=32]="VAL",r[r.VEC=96]="VEC",r[r.OBJ=64]="OBJ",r[r.STR=128]="STR",r[r.BIN=160]="BIN",r[r.ARR=192]="ARR"})(t||(Qe.CRDT_MAJOR_OVERLAY=t={})),Qe}var Mu;function Um(){if(Mu)return _n;Mu=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.Encoder=void 0;const t=z.__importStar(je()),r=Lm(),i=Jo(),n=$(),o=wf(),s=$o();class a extends o.CborEncoder{constructor(l){super(l||new i.CrdtWriter),this.clockEncoder=new r.ClockEncoder,this.time=0,this.cTableEntry=u=>{const d=u.clock,h=this.writer;h.vu57(d.sid),h.vu57(d.time)},this.tsLogical=u=>{const d=this.clockEncoder.append(u);this.writer.id(d.sessionIndex,d.timeDiff)},this.tsServer=u=>{this.writer.vu57(u.time)},this.ts=this.tsLogical,this.cKey=(u,d)=>{this.writeStr(d),this.cNode(this.doc.index.get(u))}}encode(l){this.doc=l;const u=this.writer;return u.reset(),l.clock.sid===1?this.encodeServer(l):this.encodeLogical(l),u.flush()}encodeLogical(l){const u=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(l.clock),u.ensureCapacity(4);const d=u.x0,h=u.x;u.x+=4,this.cRoot(l.root),this.encodeClockTable(d,h)}encodeServer(l){this.ts=this.tsServer;const u=this.writer;u.u8(128),u.vu57(this.time=l.clock.time),this.cRoot(l.root)}encodeClockTable(l,u){const d=this.writer,h=d.x0-l;d.view.setUint32(d.x0+(u-l),d.x-u-h-4);const g=this.clockEncoder.table,y=g.size;d.vu57(y),g.forEach(this.cTableEntry)}cRoot(l){l.val.sid===0?this.writer.u8(0):this.cNode(l.node())}writeTL(l,u){const d=this.writer;u<31?d.u8(l|u):(d.u8(l|31),d.vu57(u))}cNode(l){l instanceof t.ConNode?this.cCon(l):l instanceof t.ValNode?this.cVal(l):l instanceof t.StrNode?this.cStr(l):l instanceof t.ObjNode?this.cObj(l):l instanceof t.VecNode?this.cVec(l):l instanceof t.ArrNode?this.cArr(l):l instanceof t.BinNode&&this.cBin(l)}cCon(l){const u=l.val;this.ts(l.id),u instanceof n.Timestamp?(this.writer.u8(1),this.ts(u)):(this.writer.u8(0),this.writeAny(u))}cVal(l){this.ts(l.id),this.writer.u8(32),this.cNode(l.node())}cObj(l){this.ts(l.id);const u=l.keys;this.writeTL(s.CRDT_MAJOR_OVERLAY.OBJ,u.size),u.forEach(this.cKey)}cVec(l){const u=l.elements,d=u.length;this.ts(l.id),this.writeTL(s.CRDT_MAJOR_OVERLAY.VEC,d);const h=this.doc.index;for(let f=0;f<d;f++){const g=u[f];g?this.cNode(h.get(g)):this.writer.u8(0)}}cStr(l){const u=this.ts;u(l.id),this.writeTL(s.CRDT_MAJOR_OVERLAY.STR,l.count);for(let d=l.first();d;d=l.next(d))u(d.id),d.del?this.writeUInteger(d.span):this.writeStr(d.data)}cBin(l){const u=this.ts,d=this.writer;u(l.id),this.writeTL(s.CRDT_MAJOR_OVERLAY.BIN,l.count);for(let h=l.first();h;h=l.next(h)){u(h.id);const f=h.span,g=h.del;d.b1vu56(~~g,f),!g&&d.buf(h.data,f)}}cArr(l){const u=this.ts,d=this.writer;u(l.id),this.writeTL(s.CRDT_MAJOR_OVERLAY.ARR,l.count);const h=this.doc.index;for(let f=l.first();f;f=l.next(f)){u(f.id);const g=f.span,y=f.del;if(d.b1vu56(~~y,g),y)continue;const w=f.data;for(let _=0;_<g;_++)this.cNode(h.get(w[_]))}}}return _n.Encoder=a,_n}var Cn={},On={},Du;function Fm(){if(Du)return On;Du=1,Object.defineProperty(On,"__esModule",{value:!0}),On.ClockDecoder=void 0;const e=$();let t=class If{static fromArr(i){const n=new If(i[0],i[1]),o=i.length;for(let s=2;s<o;s+=2)n.pushTuple(i[s],i[s+1]);return n}constructor(i,n){this.table=[],this.clock=new e.ClockVector(i,n+1),this.table.push((0,e.ts)(i,n))}pushTuple(i,n){const o=(0,e.ts)(i,n);this.clock.observe(o,1),this.table.push(o)}decodeId(i,n){if(!i)return(0,e.ts)(0,n);const o=this.table[i-1];if(!o)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(o.sid,o.time-n)}};return On.ClockDecoder=t,On}var Bu;function Vm(){if(Bu)return Cn;Bu=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.Decoder=void 0;const t=z.__importStar(je()),r=Fm(),i=zo(),n=$(),o=As(),s=Ko(),a=$o();class c extends s.CborDecoderBase{constructor(){super(new i.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const u=this.ts(),d=this.val();return typeof d=="string"?new t.StrChunk(u,d.length,d):new t.StrChunk(u,~~d,"")},this.cBinChunk=()=>{const u=this.ts(),d=this.reader,[h,f]=d.b1vu56();return h?new t.BinChunk(u,f,void 0):new t.BinChunk(u,f,d.buf(f))},this.cArrChunk=()=>{const u=this.ts(),[d,h]=this.reader.b1vu56();if(d)return new t.ArrChunk(u,h,void 0);const f=[];for(let g=0;g<h;g++)f.push(this.cNode().id);return new t.ArrChunk(u,h,f)}}decode(u,d){this.clockDecoder=void 0,this.time=-1;const h=this.reader;if(h.reset(u),h.peak()&128){h.x++;const g=this.time=h.vu57();d||(d=o.Model.withServerClock(void 0,g))}else if(this.decodeClockTable(),!d){const g=this.clockDecoder.clock;d=o.Model.create(void 0,g)}return this.doc=d,d.root=new t.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,d}decodeClockTable(){const u=this.reader,d=u.u32(),h=u.x;u.x+=d;const f=u.vu57(),g=u.vu57(),y=u.vu57();this.clockDecoder=new r.ClockDecoder(g,y);for(let w=1;w<f;w++){const _=u.vu57(),m=u.vu57();this.clockDecoder.pushTuple(_,m)}u.x=h}ts(){if(this.time<0){const[h,f]=this.reader.id();return this.clockDecoder.decodeId(h,f)}else return new n.Timestamp(1,this.reader.vu57())}cRoot(){const u=this.reader;return u.uint8[u.x]?this.cNode():o.UNDEFINED}cNode(){const u=this.reader,d=this.ts(),h=u.u8(),f=h>>5,g=h&31;switch(f){case a.CRDT_MAJOR.CON:return this.cCon(d,g);case a.CRDT_MAJOR.VAL:return this.cVal(d);case a.CRDT_MAJOR.OBJ:return this.cObj(d,g!==31?g:u.vu57());case a.CRDT_MAJOR.VEC:return this.cVec(d,g!==31?g:u.vu57());case a.CRDT_MAJOR.STR:return this.cStr(d,g!==31?g:u.vu57());case a.CRDT_MAJOR.BIN:return this.cBin(d,g!==31?g:u.vu57());case a.CRDT_MAJOR.ARR:return this.cArr(d,g!==31?g:u.vu57())}throw new Error("UNKNOWN_NODE")}cCon(u,d){const h=this.doc,f=d?this.ts():this.val(),g=new t.ConNode(u,f);return h.index.set(u,g),g}cVal(u){const d=this.cNode(),h=this.doc,f=new t.ValNode(h,u,d.id);return h.index.set(u,f),f}cObj(u,d){const h=new t.ObjNode(this.doc,u);for(let f=0;f<d;f++)this.cObjChunk(h);return this.doc.index.set(u,h),h}cObjChunk(u){const d=this.key();u.keys.set(d,this.cNode().id)}cVec(u,d){const h=this.reader,f=new t.VecNode(this.doc,u),g=f.elements;for(let y=0;y<d;y++)h.peak()?g.push(this.cNode().id):(h.x++,g.push(void 0));return this.doc.index.set(u,f),f}cStr(u,d){const h=new t.StrNode(u);return d&&h.ingest(d,this.cStrChunk),this.doc.index.set(u,h),h}cBin(u,d){const h=new t.BinNode(u);return d&&h.ingest(d,this.cBinChunk),this.doc.index.set(u,h),h}cArr(u,d){const h=new t.ArrNode(this.doc,u);return d&&h.ingest(d,this.cArrChunk),this.doc.index.set(u,h),h}}return Cn.Decoder=c,Cn}var qu;function Jm(){if(qu)return Xe;qu=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.decoder=Xe.encoder=void 0;const e=Um(),t=Vm();return Xe.encoder=new e.Encoder,Xe.decoder=new t.Decoder,Xe}var Ui={},te={},An={},Lu;function Gm(){if(Lu)return An;Lu=1,Object.defineProperty(An,"__esModule",{value:!0}),An.find=void 0;const e=gs(),t=je(),r=(i,n)=>{const o=(0,e.toPath)(n);let s=i;const a=o.length;if(!a)return s;let c=0;for(;c<a&&s;){const l=o[c++];if(s=s.container(),!s)throw new Error("NOT_CONTAINER");if(s instanceof t.ObjNode){const u=s.get(String(l));if(!u)throw new Error("NOT_FOUND");s=u}else if(s instanceof t.ArrNode){const u=s.getNode(Number(l));if(!u)throw new Error("NOT_FOUND");s=u}else if(s instanceof t.VecNode){const u=s.get(Number(l));if(!u)throw new Error("NOT_FOUND");s=u}}return s};return An.find=r,An}var Nn={},Oe={},In={},Uu;function kf(){if(Uu)return In;Uu=1,Object.defineProperty(In,"__esModule",{value:!0}),In.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(r){this.listeners.forEach(i=>i(r))}listen(r){const i=this.listeners;return i.add(r),()=>i.delete(r)}}return In.FanOut=e,In}var Fu;function Rf(){if(Fu)return Oe;Fu=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.OnNewFanOut=Oe.MapFanOut=Oe.MicrotaskBufferFanOut=Oe.MergeFanOut=void 0;const e=kf();class t extends e.FanOut{constructor(s){super(),this.fanouts=s,this.unsubs=[]}listen(s){this.listeners.size||(this.unsubs=this.fanouts.map(c=>c.listen(l=>this.emit(l))));const a=super.listen(s);return()=>{if(a(),!this.listeners.size){for(const c of this.unsubs)c();this.unsubs=[]}}}}Oe.MergeFanOut=t;class r extends e.FanOut{constructor(s){super(),this.source=s,this.buffer=[],this.unsub=void 0}listen(s){this.unsub||(this.unsub=this.source.listen(c=>{const l=this.buffer;l.length||queueMicrotask(()=>{this.emit(l),this.buffer=[]}),l.push(c)}));const a=super.listen(s);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}Oe.MicrotaskBufferFanOut=r;class i extends e.FanOut{constructor(s,a){super(),this.source=s,this.mapper=a,this.unsub=void 0}listen(s){this.unsub||(this.unsub=this.source.listen(c=>this.emit(this.mapper(c))));const a=super.listen(s);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}Oe.MapFanOut=i;class n extends e.FanOut{constructor(s,a=void 0){super(),this.source=s,this.last=a,this.unsub=void 0}listen(s){this.unsub||(this.unsub=this.source.listen(c=>{this.last!==c&&this.emit(this.last=c)}));const a=super.listen(s);return()=>{a(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}return Oe.OnNewFanOut=n,Oe}var Vu;function zm(){if(Vu)return Nn;Vu=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.NodeEvents=void 0;const e=Rf();let t=class{constructor(i){this.api=i,this.subscribe=n=>this.onViewChanges.listen(()=>n()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Nn.NodeEvents=t,Nn}var kn={},Ju;function Hm(){if(Ju)return kn;Ju=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.ExtNode=void 0;const e=$();let t=class{constructor(i){this.data=i,this.api=void 0,this.id=i.id}children(i){}child(){return this.data}container(){return this.data.container()}toString(i,n){return this.name()+(n?" "+(0,e.printTs)(n):"")+" "+this.data.toString(i)}};return kn.ExtNode=t,kn}var Ze={},Fi={},Vi={},Gu;function Wm(){return Gu||(Gu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const t=Array.isArray,r=Object.prototype,i=(n,o)=>{if(n===o)return!0;let s=0,a=0;if(t(n)){if(!t(o)||(s=n.length,s!==o.length))return!1;for(a=s;a--!==0;)if(!(0,e.deepEqual)(n[a],o[a]))return!1;return!0}if(n&&o&&typeof n=="object"&&typeof o=="object"){e:{if(n.__proto__===r)break e;if(n instanceof Uint8Array){if(!(o instanceof Uint8Array))return!1;const l=n.length;if(l!==o.length)return!1;for(let u=0;u<l;u++)if(n[u]!==o[u])return!1;return!0}}const c=Object.keys(n);if(s=c.length,s!==Object.keys(o).length||t(o))return!1;for(a=s;a--!==0;){const l=c[a];if(!(0,e.deepEqual)(n[l],o[l]))return!1}return!0}return!1};e.deepEqual=i})(Vi)),Vi}var zu;function Km(){return zu||(zu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),z.__exportStar(Wm(),e)})(Fi)),Fi}var Rn={},Hu;function $m(){if(Hu)return Rn;Hu=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.cmpUint8Array=void 0;const e=(t,r)=>{const i=t.length;if(i!==r.length)return!1;for(let n=0;n<i;n++)if(t[n]!==r[n])return!1;return!0};return Rn.cmpUint8Array=e,Rn}var Ji={},Wu;function Cs(){return Wu||(Wu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.overlap=e.sfx=e.pfx=e.normalize=void 0;const t=b=>{const p=b.length;if(p<2)return b;let v=0;e:{if(!b[0][1])break e;for(v=1;v<p;v++){const E=b[v-1],O=b[v];if(!O[1]||E[0]===O[0])break e}return b}const S=[];for(let E=0;E<v;E++)S.push(b[E]);for(let E=v;E<p;E++){const O=b[E];if(!O[1])continue;const A=S.length>0?S[S.length-1]:null;A&&A[0]===O[0]?A[1]+=O[1]:S.push(O)}return S};e.normalize=t;const r=b=>{const p=b.charCodeAt(0);return p>=56320&&p<=57343},i=b=>{const p=b.charCodeAt(b.length-1);return p>=55296&&p<=56319},n=(b,p)=>{b.push([0,""]);let v=0,S=0,E=0,O="",A="",C=0;for(;v<b.length;){if(v<b.length-1&&!b[v][1]){b.splice(v,1);continue}const I=b[v];switch(I[0]){case 1:E++,v++,A+=I[1];break;case-1:S++,v++,O+=I[1];break;case 0:{let k=v-E-S-1;if(p){const M=b[k];if(k>=0){let V=M[1];if(i(V)){const F=V.slice(-1);if(M[1]=V=V.slice(0,-1),O=F+O,A=F+A,!V){b.splice(k,1),v--;let L=k-1;const ee=b[L];if(ee){const X=ee[0];X===1?(E++,L--,A=ee[1]+A):X===-1&&(S++,L--,O=ee[1]+O)}k=L}}}const q=b[v],U=q[1];if(r(U)){const V=U.charAt(0);q[1]=U.slice(1),O+=V,A+=V}}if(v<b.length-1&&!b[v][1]){b.splice(v,1);break}const R=O.length>0,x=A.length>0;if(R||x){R&&x&&(C=(0,e.pfx)(A,O),C!==0&&(k>=0?b[k][1]+=A.slice(0,C):(b.splice(0,0,[0,A.slice(0,C)]),v++),A=A.slice(C),O=O.slice(C)),C=(0,e.sfx)(A,O),C!==0&&(b[v][1]=A.slice(A.length-C)+b[v][1],A=A.slice(0,A.length-C),O=O.slice(0,O.length-C)));const M=E+S,q=O.length,U=A.length;q===0&&U===0?(b.splice(v-M,M),v=v-M):q===0?(b.splice(v-M,M,[1,A]),v=v-M+1):U===0?(b.splice(v-M,M,[-1,O]),v=v-M+1):(b.splice(v-M,M,[-1,O],[1,A]),v=v-M+2)}const T=b[v-1];v!==0&&T[0]===0?(T[1]+=b[v][1],b.splice(v,1)):v++,E=0,S=0,O="",A="";break}}}b[b.length-1][1]===""&&b.pop();let N=!1;for(v=1;v<b.length-1;){const I=b[v-1],k=b[v+1];if(I[0]===0&&k[0]===0){const R=I[1],x=b[v],T=x[1],M=k[1];T.slice(T.length-R.length)===R?(b[v][1]=R+T.slice(0,T.length-R.length),k[1]=R+M,b.splice(v-1,1),N=!0):T.slice(0,M.length)===M&&(I[1]+=k[1],x[1]=T.slice(M.length)+M,b.splice(v+1,1),N=!0)}v++}N&&n(b,p)},o=(b,p,v,S)=>{if(v>0&&v<b.length){const A=b.charCodeAt(v);A>=56320&&A<=57343&&v--}if(S>0&&S<p.length){const A=p.charCodeAt(S);A>=56320&&A<=57343&&S--}const E=d(b.slice(0,v),p.slice(0,S),!1),O=d(b.slice(v),p.slice(S),!1);return E.concat(O)},s=(b,p)=>{const v=b.length,S=p.length,E=Math.ceil((v+S)/2),O=E,A=2*E,C=new Array(A),N=new Array(A);for(let q=0;q<A;q++)C[q]=-1,N[q]=-1;C[O+1]=0,N[O+1]=0;const I=v-S,k=I%2!==0;let R=0,x=0,T=0,M=0;for(let q=0;q<E;q++){for(let U=-q+R;U<=q-x;U+=2){const V=O+U;let F=0;const L=C[V-1],ee=C[V+1];U===-q||U!==q&&L<ee?F=ee:F=L+1;let X=F-U;for(;F<v&&X<S&&b.charAt(F)===p.charAt(X);)F++,X++;if(C[V]=F,F>v)x+=2;else if(X>S)R+=2;else if(k){const le=O+I-U,Se=N[le];if(le>=0&&le<A&&Se!==-1&&F>=v-Se)return o(b,p,F,X)}}for(let U=-q+T;U<=q-M;U+=2){const V=O+U;let F=U===-q||U!==q&&N[V-1]<N[V+1]?N[V+1]:N[V-1]+1,L=F-U;for(;F<v&&L<S&&b.charAt(v-F-1)===p.charAt(S-L-1);)F++,L++;if(N[V]=F,F>v)M+=2;else if(L>S)T+=2;else if(!k){const ee=O+I-U,X=C[ee];if(ee>=0&&ee<A&&X!==-1){const le=O+X-ee;if(F=v-F,X>=F)return o(b,p,X,le)}}}}return[[-1,b],[1,p]]},a=(b,p)=>{if(!b)return[[1,p]];if(!p)return[[-1,b]];const v=b.length,S=p.length,E=v>S?b:p,O=v>S?p:b,A=O.length,C=E.indexOf(O);if(C>=0){const N=E.slice(0,C),I=E.slice(C+A);return v>S?[[-1,N],[0,O],[-1,I]]:[[1,N],[0,O],[1,I]]}return A===1?[[-1,b],[1,p]]:s(b,p)},c=(b,p)=>{if(!b||!p||b.charAt(0)!==p.charAt(0))return 0;let v=0,S=Math.min(b.length,p.length),E=S,O=0;for(;v<E;)b.slice(O,E)===p.slice(O,E)?(v=E,O=v):S=E,E=Math.floor((S-v)/2+v);const A=b.charCodeAt(E-1);return A>=55296&&A<=56319&&E--,E};e.pfx=c;const l=(b,p)=>{if(!b||!p||b.slice(-1)!==p.slice(-1))return 0;let v=0,S=Math.min(b.length,p.length),E=S,O=0;for(;v<E;)b.slice(b.length-E,b.length-O)===p.slice(p.length-E,p.length-O)?(v=E,O=v):S=E,E=Math.floor((S-v)/2+v);if(E>0&&E<b.length){const A=b.length-E-1,C=b.charCodeAt(A),N=C>=55296&&C<=56319,I=C===8205||C>=65024&&C<=65039||C>=768&&C<=879;if(N||I)for(E--;E>0;){const k=b.length-E-1;if(k<0)break;const R=b.charCodeAt(k),x=R>=55296&&R<=56319,T=R===8205||R>=65024&&R<=65039||R>=768&&R<=879;if(!x&&!T)break;E--}}return E};e.sfx=l;const u=(b,p)=>{const v=b.length,S=p.length;if(v===0||S===0)return 0;let E=v;if(v>S?(E=S,b=b.substring(v-S)):v<S&&(p=p.substring(0,v)),b===p)return E;let O=0,A=1;for(;;){const C=b.substring(E-A),N=p.indexOf(C);if(N===-1)return O;A+=N,(N===0||b.substring(E-A)===p.substring(0,A))&&(O=A,A++)}};e.overlap=u;const d=(b,p,v)=>{if(b===p)return b?[[0,b]]:[];const S=(0,e.pfx)(b,p),E=b.slice(0,S);b=b.slice(S),p=p.slice(S);const O=(0,e.sfx)(b,p),A=b.slice(b.length-O);b=b.slice(0,b.length-O),p=p.slice(0,p.length-O);const C=a(b,p);return E&&C.unshift([0,E]),A&&C.push([0,A]),n(C,v),C},h=(b,p)=>d(b,p,!0);e.diff=h;const f=(b,p,v)=>{e:{if(v<0)break e;const S=b.length,E=p.length;if(S===E)break e;const O=p.slice(v),A=O.length;if(A>S||b.slice(S-A)!==O)break e;if(E>S){const I=S-A,k=b.slice(0,I),R=p.slice(0,I);if(k!==R)break e;const x=p.slice(I,v),T=[];return k&&T.push([0,k]),x&&T.push([1,x]),O&&T.push([0,O]),T}else{const I=E-A,k=p.slice(0,I),R=b.slice(0,I);if(R!==k)break e;const x=b.slice(I,S-A),T=[];return R&&T.push([0,R]),x&&T.push([-1,x]),O&&T.push([0,O]),T}}return(0,e.diff)(b,p)};e.diffEdit=f;const g=b=>{let p="";const v=b.length;for(let S=0;S<v;S++){const E=b[S];E[0]!==1&&(p+=E[1])}return p};e.src=g;const y=b=>{let p="";const v=b.length;for(let S=0;S<v;S++){const E=b[S];E[0]!==-1&&(p+=E[1])}return p};e.dst=y;const w=b=>{const p=b[0];return p===0?b:p===1?[-1,b[1]]:[1,b[1]]},_=b=>b.map(w);e.invert=_;const m=(b,p,v,S)=>{const E=b.length;let O=p;for(let A=E-1;A>=0;A--){const[C,N]=b[A];if(C===0)O-=N.length;else if(C===1)v(O,N);else{const I=N.length;O-=I,S(O,I,N)}}};e.apply=m})(Ji)),Ji}var Gi={},Ku;function Ym(){return Ku||(Ku=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const r=z.__importStar(Cs()),i=l=>{let u="";const d=l.length;for(let h=0;h<d;h++)u+=String.fromCharCode(l[h]);return u};e.toStr=i;const n=l=>{const u=l.length,d=new Uint8Array(u);for(let h=0;h<u;h++)d[h]=l.charCodeAt(h);return d};e.toBin=n;const o=(l,u)=>{const d=(0,e.toStr)(l),h=(0,e.toStr)(u);return r.diff(d,h)};e.diff=o;const s=(l,u,d,h)=>r.apply(l,u,(f,g)=>d(f,(0,e.toBin)(g)),h);e.apply=s;const a=l=>(0,e.toBin)(r.src(l));e.src=a;const c=l=>(0,e.toBin)(r.dst(l));e.dst=c})(Gi)),Gi}var zi={},$u;function Xm(){return $u||($u=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.diff=e.agg=void 0;const r=z.__importStar(Cs()),i=s=>{const a=[],c=s.length;let l=[];const u=(d,h)=>{if(!h.length)return;const f=l.length;if(f){const g=l[f-1];if(g[0]===d){g[1]+=h;return}}l.push([d,h])};e:for(let d=0;d<c;d++){const h=s[d],f=h[0],g=h[1],y=g.indexOf(`
`);if(y<0){u(f,g);continue e}else u(f,g.slice(0,y+1)),l.length&&a.push(l),l=[];let w=y;const _=g.length;t:for(;w<_;){const m=g.indexOf(`
`,w+1);if(m<0){u(f,g.slice(w+1));break t}a.push([[f,g.slice(w+1,m+1)]]),w=m}}l.length&&a.push(l);{const d=a.length;for(let h=0;h<d;h++){const f=a[h]=r.normalize(a[h]),g=f.length;e:{if(g<2)break e;const y=f[0],w=f[1],_=w[0];if(y[0]!==0||_!==-1&&_!==1)break e;for(let m=2;m<g;m++)if(f[m][0]!==_)break e;for(let m=h+1;m<d;m++){const b=a[m]=r.normalize(a[m]),p=b.length,v=y[1];let S,E;if(b.length>1&&(S=b[0])[0]===_&&(E=b[1])[0]===0&&v===S[1]){f.splice(0,1),w[1]=v+w[1],E[1]=v+E[1],b.splice(0,1);break e}else for(let O=0;O<p;O++)if(b[O][0]!==_)break e}}e:{if(f.length<2)break e;const y=f[f.length-1],w=y[1];if(y[0]!==-1)break e;t:for(let _=h+1;_<d;_++){const m=a[_]=r.normalize(a[_]),b=m.length;let p;if(b===0)continue t;if(b===1){if(p=m[0],p[0]===-1)continue t;if(m[0][0]!==0)break e}else if(p=m[1],b>2||m[0][0]!==-1)break e;const v=p[0];if(v===-1)continue t;if(v!==0)break e;const S=p[1];if(S.length>w.length||!w.endsWith(S))break e;const E=w.length-S.length;y[1]=w.slice(0,E),f.push([0,S]),p[0]=-1,a[h]=r.normalize(a[h]),a[_]=r.normalize(a[_]);break e}}}}return a};e.agg=i;const n=(s,a)=>{if(!a.length)return s.map((m,b)=>[-1,b,-1]);if(!s.length)return a.map((m,b)=>[1,-1,b]);const c=s.join(`
`)+`
`,l=a.join(`
`)+`
`;if(c===l)return[];const u=r.diff(c,l),d=(0,e.agg)(u),h=d.length,f=[];let g=-1,y=-1;const w=s.length,_=a.length;for(let m=0;m<h;m++){const b=d[m];let p=b.length;if(!p)continue;const v=b[p-1],S=v[0],E=v[1];if(E===`
`)b.splice(p-1,1);else{const A=E.length;E[A-1]===`
`&&(A===1?b.splice(p-1,1):v[1]=E.slice(0,A-1))}let O=0;if(p=b.length,!p)S===0?(O=0,g++,y++):S===1?(O=1,y++):S===-1&&(O=-1,g++);else if(m+1===h)g+1<w?y+1<_?(O=p===1&&b[0][0]===0?0:2,g++,y++):(O=-1,g++):(O=1,y++);else{const C=b[0][0];p===1&&C===S&&C===0?(g++,y++):S===0?(O=2,g++,y++):S===1?(O=1,y++):S===-1&&(O=-1,g++)}O===0&&s[g]!==a[y]&&(O=2),f.push([O,g,y])}return f};e.diff=n;const o=(s,a,c,l)=>{const u=s.length;e:for(let d=u-1;d>=0;d--){const[h,f,g]=s[d];switch(h){case 0:continue e;case-1:a(f);break;case 1:c(f,g);break;case 2:l(f,g);break}}};e.apply=o})(zi)),zi}var Hi={},Tn={},Yu;function Os(){if(Yu)return Tn;Yu=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.sort=void 0;const e=t=>{const r=t.length;for(let i=1;i<r;i++){const n=t[i];let o=i;for(;o!==0&&t[o-1]>n;)t[o]=t[o-1],o--;t[o]=n}return t};return Tn.sort=e,Tn}var Wi={},Xu;function Yo(){return Xu||(Xu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const t=Os();var r;(function(c){c[c.START_STATE=5381]="START_STATE",c[c.NULL=982452847]="NULL",c[c.TRUE=982453247]="TRUE",c[c.FALSE=982454243]="FALSE",c[c.ARRAY=982452259]="ARRAY",c[c.STRING=982453601]="STRING",c[c.OBJECT=982454533]="OBJECT",c[c.BINARY=982454837]="BINARY"})(r||(e.CONST=r={}));const i=(c,l)=>(c<<5)+c+l;e.updateNum=i;const n=(c,l)=>{const u=l.length;c=(0,e.updateNum)(c,r.STRING),c=(0,e.updateNum)(c,u);let d=u;for(;d;)c=(c<<5)+c+l.charCodeAt(--d);return c};e.updateStr=n;const o=(c,l)=>{const u=l.length;c=(0,e.updateNum)(c,r.BINARY),c=(0,e.updateNum)(c,u);let d=u;for(;d;)c=(c<<5)+c+l[--d];return c};e.updateBin=o;const s=(c,l)=>{switch(typeof l){case"number":return(0,e.updateNum)(c,l);case"string":return c=(0,e.updateNum)(c,r.STRING),(0,e.updateStr)(c,l);case"object":{if(l===null)return(0,e.updateNum)(c,r.NULL);if(Array.isArray(l)){const h=l.length;c=(0,e.updateNum)(c,r.ARRAY);for(let f=0;f<h;f++)c=(0,e.updateJson)(c,l[f]);return c}if(l instanceof Uint8Array)return(0,e.updateBin)(c,l);c=(0,e.updateNum)(c,r.OBJECT);const u=(0,t.sort)(Object.keys(l)),d=u.length;for(let h=0;h<d;h++){const f=u[h];c=(0,e.updateStr)(c,f),c=(0,e.updateJson)(c,l[f])}return c}case"boolean":return(0,e.updateNum)(c,l?r.TRUE:r.FALSE)}return c};e.updateJson=s;const a=c=>(0,e.updateJson)(r.START_STATE,c)>>>0;e.hash=a})(Wi)),Wi}var Ki={},Qu;function Tf(){return Qu||(Qu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const t=Os(),r=Yo(),i=mt(),n=o=>{switch(typeof o){case"string":return(0,r.hash)(o).toString(36);case"number":case"bigint":return o.toString(36);case"boolean":return o?"T":"F";case"object":if(o===null)return"N";if(o instanceof i.Timestamp)return(o.sid%2e6).toString(36)+"."+o.time.toString(36);if(Array.isArray(o)){const s=o.length;let a="[";for(let c=0;c<s;c++)a+=(0,e.structHash)(o[c])+";";return a+"]"}else{if(o instanceof Uint8Array)return(0,r.hash)(o).toString(36);{const s=Object.keys(o);(0,t.sort)(s);let a="{";const c=s.length;for(let l=0;l<c;l++){const u=s[l];a+=(0,r.hash)(u).toString(36)+":"+(0,e.structHash)(o[u])+","}return a+"}"}}default:return"U"}};e.structHash=n})(Ki)),Ki}var Zu;function Qm(){return Zu||(Zu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const t=Os(),r=Fr(),i=Yo(),n=Tf(),o=s=>{if(s instanceof r.ConNode)return(0,n.structHash)(s.val);if(s instanceof r.ValNode)return(0,e.structHashCrdt)(s.node());if(s instanceof r.StrNode)return(0,i.hash)(s.view()).toString(36);if(s instanceof r.ObjNode){let a="{";const c=Array.from(s.keys.keys());(0,t.sort)(c);const l=c.length;for(let u=0;u<l;u++){const d=c[u],h=s.get(d);a+=(0,i.hash)(d).toString(36)+":"+(0,e.structHashCrdt)(h)+","}return a+"}"}else if(s instanceof r.ArrNode||s instanceof r.VecNode){let a="[";return s.children(c=>{a+=(0,e.structHashCrdt)(c)+";"}),a+"]"}else if(s instanceof r.BinNode)return(0,i.hash)(s.view()).toString(36);return"U"};e.structHashCrdt=o})(Hi)),Hi}var $i={},el;function Zm(){return el||(el=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashSchema=void 0;const t=Os(),r=Wo(),i=Yo(),n=Tf(),o=s=>{if(s instanceof r.nodes.con||s instanceof r.nodes.str||s instanceof r.nodes.bin)return(0,n.structHash)(s.raw);if(s instanceof r.nodes.val)return(0,e.structHashSchema)(s.value);if(s instanceof r.nodes.obj){let a="{";const c={...s.obj,...s.opt},l=Object.keys(c);(0,t.sort)(l);const u=l.length;for(let d=0;d<u;d++){const h=l[d],f=c[h];a+=(0,i.hash)(h).toString(36)+":"+(0,e.structHashSchema)(f)+","}return a+"}"}else if(s instanceof r.nodes.arr||s instanceof r.nodes.vec){let a="[";const c=s instanceof r.nodes.arr?s.arr:s.value;for(const l of c)a+=(0,e.structHashSchema)(l)+";";return a+"]"}return(0,n.structHash)(s)};e.structHashSchema=o})($i)),$i}var tl;function xf(){if(tl)return Ze;tl=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.JsonCrdtDiff=Ze.DiffError=void 0;const e=z,t=Km(),r=$m(),i=mt(),n=je(),o=e.__importStar(Cs()),s=e.__importStar(Ym()),a=e.__importStar(Xm()),c=Qm(),l=Zm();class u extends Error{constructor(f="DIFF"){super(f)}}Ze.DiffError=u;let d=class{constructor(f){this.model=f,this.builder=new i.PatchBuilder(f.clock.clone())}diffStr(f,g){const y=f.view();if(y===g)return;const w=this.builder;o.apply(o.diff(y,g),y.length,(_,m)=>w.insStr(f.id,_?f.find(_-1):f.id,m),(_,m)=>w.del(f.id,f.findInterval(_,m)))}diffBin(f,g){const y=f.view();if((0,r.cmpUint8Array)(y,g))return;const w=this.builder;s.apply(s.diff(y,g),y.length,(_,m)=>w.insBin(f.id,_?f.find(_-1):f.id,m),(_,m)=>w.del(f.id,f.findInterval(_,m)))}diffArr(f,g){if(f.size()===0){const E=g.length;if(E===0)return;let O=f.id;for(let A=0;A<E;A++)O=this.builder.insArr(f.id,O,[this.buildView(g[A])]);return}else if(g.length===0){const E=[];for(const O of f.chunks()){if(O.del)continue;const A=O.id;E.push((0,i.tss)(A.sid,A.time,O.span))}E.length&&this.builder.del(f.id,E);return}const y=[];f.children(E=>y.push((0,c.structHashCrdt)(E)));const w=[],_=g.length;for(let E=0;E<_;E++)w.push((0,l.structHashSchema)(g[E]));const m=a.diff(y,w);if(!m.length)return;const b=[],p=[];a.apply(m,E=>{const O=f.findInterval(E,1);if(!O||!O.length)throw new u;p.push(...O)},(E,O)=>{const A=g[O],C=E>=0?f.find(E):f.id;if(!C)throw new u;b.push([C,[A]])},(E,O)=>{const A=g[O];try{this.diffAny(f.getNode(E),A)}catch(C){if(C instanceof u){const N=f.findInterval(E,1);p.push(...N);const I=E?f.find(E-1):f.id;if(!I)throw new u;b.push([I,[A]])}else throw C}});const v=this.builder,S=b.length;for(let E=0;E<S;E++){const[O,A]=b[E];v.insArr(f.id,O,A.map(C=>this.buildView(C)))}p.length&&v.del(f.id,p)}diffObj(f,g){const y=this.builder,w=[],_=new Set;f.forEach(p=>{_.add(p),g[p]===void 0&&w.push([p,y.con(void 0)])});const m=Object.keys(g),b=m.length;for(let p=0;p<b;p++){const v=m[p],S=g[v];if(_.has(v)){const E=f.get(v);if(E)try{this.diffAny(E,S);continue}catch(O){if(!(O instanceof u))throw O}}w.push([v,this.buildConView(S)])}w.length&&y.insObj(f.id,w)}diffVec(f,g){const y=this.builder,w=[],_=f.elements,m=_.length,b=g.length,p=f.doc.index,v=Math.min(m,b);for(let S=b;S<m;S++){const E=_[S];if(E){const O=p.get(E);if(!O||O instanceof n.ConNode&&O.val===void 0)continue;w.push([S,y.con(void 0)])}}e:for(let S=0;S<v;S++){const E=g[S],O=f.get(S);if(O){try{this.diffAny(O,E);continue}catch(A){if(!(A instanceof u))throw A}if(O instanceof n.ConNode&&typeof E!="object"){const A=y.con(E);w.push([S,A]);continue e}}w.push([S,this.buildConView(E)])}for(let S=m;S<b;S++)w.push([S,this.buildConView(g[S])]);w.length&&y.insVec(f.id,w)}diffVal(f,g){try{this.diffAny(f.node(),g)}catch(y){if(y instanceof u)this.builder.setVal(f.id,this.buildConView(g));else throw y}}diffAny(f,g){if(f instanceof n.ConNode){g instanceof i.nodes.con&&(g=g.raw);const y=f.val;if(y!==g&&(y instanceof i.Timestamp&&!(g instanceof i.Timestamp)||!(y instanceof i.Timestamp)&&g instanceof i.Timestamp||!(0,t.deepEqual)(f.val,g)))throw new u}else if(f instanceof n.StrNode){if(g instanceof i.nodes.str&&(g=g.raw),typeof g!="string")throw new u;this.diffStr(f,g)}else if(f instanceof n.ObjNode){if(g instanceof i.nodes.obj&&(g=g.opt?{...g.obj,...g.opt}:g.obj),g instanceof i.NodeBuilder)throw new u;if(g instanceof Uint8Array)throw new u;if(!g||typeof g!="object"||Array.isArray(g))throw new u;this.diffObj(f,g)}else if(f instanceof n.ValNode)g instanceof i.nodes.val&&(g=g.value),this.diffVal(f,g);else if(f instanceof n.ArrNode){if(g instanceof i.nodes.arr&&(g=g.arr),!Array.isArray(g))throw new u;this.diffArr(f,g)}else if(f instanceof n.VecNode){if(g instanceof i.nodes.vec&&(g=g.value),!Array.isArray(g))throw new u;this.diffVec(f,g)}else if(f instanceof n.BinNode){if(g instanceof i.nodes.bin&&(g=g.raw),!(g instanceof Uint8Array))throw new u;this.diffBin(f,g)}else throw new u}diff(f,g){return this.diffAny(f,g),this.builder.flush()}diffDstKeys(f,g){const y=this.builder,w=[],_=Object.keys(g),m=_.length;for(let b=0;b<m;b++){const p=_[b],v=f.get(p),S=g[p];if(!v){w.push([p,this.buildConView(S)]);continue}try{this.diffAny(v,S)}catch(E){if(E instanceof u)w.push([p,this.buildConView(S)]);else throw E}}return w.length&&y.insObj(f.id,w),this.builder.flush()}buildView(f){const g=this.builder;return f instanceof i.Timestamp?g.con(f):f instanceof i.nodes.con?g.con(f.raw):g.json(f)}buildConView(f){const g=this.builder;return f instanceof i.Timestamp?g.con(f):f instanceof i.nodes.con?g.con(f.raw):g.constOrJson(f)}};return Ze.JsonCrdtDiff=d,Ze}var Yi={},nl;function e1(){return nl||(nl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const t=xf(),r=(n,o)=>{const a=new t.JsonCrdtDiff(n.api.model).diff(n.node,o);return a.ops.length?a:void 0};e.diff=r;const i=(n,o)=>{const s=(0,e.diff)(n,o);return s&&n.api.model.applyLocalPatch(s),s};e.merge=i})(Yi)),Yi}var Xi={},rl;function t1(){return rl||(rl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const t=(i,n=[])=>new Proxy(()=>{},{get:(o,s,a)=>(n.push(String(s)),(0,e.proxy)(i,n)),apply:(o,s,a)=>i(n,...a)});e.proxy=t;const r=(i,n,o=[])=>new Proxy({},{get:(s,a,c)=>a===n?i(o):(o.push(String(a)),(0,e.proxy$)(i,n,o))});e.proxy$=r})(Xi)),Xi}var sl;function n1(){if(sl)return te;sl=1,Object.defineProperty(te,"__esModule",{value:!0}),te.ModelApi=te.ArrApi=te.BinApi=te.StrApi=te.ObjApi=te.VecApi=te.ValApi=te.ConApi=te.NodeApi=void 0;const e=z,t=_e(),r=uf(),i=Bo(),n=Gm(),o=je(),s=zm(),a=kf(),c=Ss(),l=Rf(),u=Hm(),d=xf(),h=e.__importStar(e1()),f=$(),g=t1(),y=A=>{if(!A)return[void 0,""];if(typeof A=="number")return[void 0,A];switch(typeof A=="string"&&(A=(0,i.toPath)(A)),A.length){case 0:return[void 0,""];case 1:return[void 0,A[0]];default:{const C=A[A.length-1];return[A.slice(0,-1),C]}}};class w{constructor(C,N){this.node=C,this.api=N,this.ev=void 0}get events(){return this.ev||(this.ev=new s.NodeEvents(this))}find(C){let N=this.node;if(C===void 0){if(typeof N.child=="function"){const I=N.child();if(!I){if(N instanceof o.RootNode)return N;throw new Error("NO_CHILD")}return I}throw new Error("CANNOT_IN")}for(typeof C=="string"&&C&&C[0]!=="/"&&(C="/"+C),typeof C=="number"&&(C=[C]);N instanceof o.ValNode;)N=N.child();return(0,n.find)(N,C)}in(C){const N=this.find(C);return this.api.wrap(N)}asVal(){if(this.node instanceof o.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof o.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof o.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof o.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof o.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof o.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof o.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(C){let N;const I=this.node;if(I instanceof u.ExtNode&&(N=I),I instanceof o.VecNode&&(N=I.ext()),!N)throw new Error("NOT_EXT");const k=this.api.wrap(N);if(!C||k instanceof C.Api)return k;throw new Error("NOT_EXT")}val(C){return this.in(C).asVal()}str(C){return this.in(C).asStr()}bin(C){return this.in(C).asBin()}arr(C){return this.in(C).asArr()}vec(C){return this.in(C).asVec()}obj(C){return this.in(C).asObj()}con(C){return this.in(C).asCon()}view(){return this.node.view()}select(C,N){try{let I=C!==void 0?this.find(C):this.node;if(N)for(;I instanceof o.ValNode;)I=I.child();return this.api.wrap(I)}catch{return}}read(C){const N=this.view();if(Array.isArray(C))return(0,r.get)(N,C);if(!C)return N;let I=C+"";return C&&I[0]!=="/"&&(I="/"+I),(0,r.get)(N,(0,i.toPath)(I))}add(C,N){const[I,k]=y(C);e:try{const R=this.select(I,!0);if(R instanceof p)R.set({[k]:N});else if(R instanceof E||R instanceof v||R instanceof S){const x=R.length();let T=0;if(typeof k=="number")T=k;else if(k==="-")T=x;else if(T=~~k,T+""!==k)break e;if(T!==T)break e;if(T<0&&(T=0),T>x&&(T=x),R instanceof E)R.ins(T,Array.isArray(N)?N:[N]);else if(R instanceof v)R.ins(T,N+"");else if(R instanceof S){if(!(N instanceof Uint8Array))break e;R.ins(T,N)}}else if(R instanceof b)R.set([[~~k,N]]);else break e;return!0}catch{}return!1}replace(C,N){const[I,k]=y(C);e:try{const R=this.select(I,!0);if(R instanceof p){const x=k+"";if(!R.has(x))break e;R.set({[k]:N})}else if(R instanceof E){const x=R.length();let T=0;if(typeof k=="number")T=k;else if(T=~~k,T+""!==k)break e;if(T!==T||T<0||T>x)break e;T===x?R.ins(T,[N]):R.upd(T,N)}else if(R instanceof b)R.set([[~~k,N]]);else break e;return!0}catch{}return!1}remove(C,N=1){const[I,k]=y(C);e:try{const R=this.select(I,!0);if(R instanceof p){const x=k+"";if(!R.has(x))break e;R.del([x])}else if(R instanceof E||R instanceof v||R instanceof S){const x=R.length();let T=0;if(typeof k=="number")T=k;else if(k==="-")T=N;else if(T=~~k,T+""!==k)break e;if(T!==T||T<0||T>x)break e;R.del(T,Math.min(N,x-T))}else if(R instanceof b)R.set([[~~k,void 0]]);else break e;return!0}catch{}return!1}diff(C){return h.diff(this,C)}merge(C){return h.merge(this,C)}op(C){if(!Array.isArray(C))return!1;const[N,I,k]=C;switch(N){case"add":return this.add(I,k);case"replace":return this.replace(I,k);case"merge":return!!this.select(I)?.merge(k);case"remove":return this.remove(I,k)}}get s(){return{$:this}}get $(){return(0,g.proxy$)(C=>{try{return this.api.wrap(this.find(C))}catch{return}},"$")}toString(C=""){return"api("+(this.constructor===w?"*":this.node.name())+")"+(0,t.printTree)(C,[I=>this.node.toString(I)])}}te.NodeApi=w;class _ extends w{get s(){return{$:this}}}te.ConApi=_;class m extends w{get(){return this.in()}set(C){const{api:N,node:I}=this,R=N.builder.constOrJson(C);N.builder.setVal(I.id,R),N.apply()}get s(){const C=this;return{$:this,get _(){const I=C.node.node();return C.api.wrap(I).s}}}}te.ValApi=m;class b extends w{get(C){return this.in(C)}set(C){const{api:N,node:I}=this,{builder:k}=N;k.insVec(I.id,C.map(([R,x])=>[R,k.constOrJson(x)])),N.apply()}push(...C){const N=this.length();this.set(C.map((I,k)=>[N+k,I]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(N,I,k)=>{if(I==="$")return this;if(I==="toExt")return()=>this.asExt();const R=Number(I);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const x=this.node.get(R);if(!x)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(x).s}})}}te.VecApi=b;class p extends w{get(C){return this.in(C)}set(C){const{api:N,node:I}=this,{builder:k}=N;k.insObj(I.id,Object.entries(C).map(([R,x])=>[R,k.constOrJson(x)])),N.apply()}del(C){const{api:N,node:I}=this,{builder:k}=N;N.builder.insObj(I.id,C.map(R=>[R,k.con(void 0)])),N.apply()}has(C){return this.node.keys.has(C)}diffKeys(C){const I=new d.JsonCrdtDiff(this.api.model).diffDstKeys(this.node,C);return I.ops.length?I:void 0}mergeKeys(C){const N=this.diffKeys(C);return N&&this.api.model.applyLocalPatch(N),N}get s(){return new Proxy({},{get:(N,I,k)=>{if(I==="$")return this;const R=String(I),x=this.node.get(R);if(!x)throw new Error("NO_SUCH_KEY");return this.api.wrap(x).s}})}}te.ObjApi=p;class v extends w{ins(C,N){const{api:I,node:k}=this;I.onBeforeLocalChange.emit(I.next);const R=I.builder;R.pad();const x=I.builder.nextTime(),T=new f.Timestamp(R.clock.sid,x),M=k.insAt(C,T,N);if(!M)throw new Error("OUT_OF_BOUNDS");R.insStr(k.id,M,N),I.advance()}del(C,N){const{api:I,node:k}=this;I.onBeforeLocalChange.emit(I.next);const R=I.builder;R.pad();const x=k.findInterval(C,N);if(!x)throw new Error("OUT_OF_BOUNDS");k.delete(x),R.del(k.id,x),I.advance()}findId(C){const N=this.node,k=N.length()-1;return C>k&&(C=k),C<0?N.id:N.find(C)||N.id}findPos(C){const N=this.node,I=N.id;if(I.sid===C.sid&&I.time===C.time)return-1;const k=N.findById(C);return k?N.pos(k)+(k.del?0:C.time-k.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}te.StrApi=v;class S extends w{ins(C,N){const{api:I,node:k}=this,R=C?k.find(C-1):k.id;if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.insBin(k.id,R,N),I.apply()}del(C,N){const{api:I,node:k}=this,R=k.findInterval(C,N);if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.del(k.id,R),I.apply()}length(){return this.node.length()}get s(){return{$:this}}}te.BinApi=S;class E extends w{get(C){return this.in(C)}ins(C,N){const{api:I,node:k}=this,{builder:R}=I,x=C?k.find(C-1):k.id;if(!x)throw new Error("OUT_OF_BOUNDS");const T=[];for(let M=0;M<N.length;M++)T.push(R.json(N[M]));R.insArr(k.id,x,T),I.apply()}push(...C){const N=this.length();this.ins(N,C)}upd(C,N){const{api:I,node:k}=this,R=k.getId(C);if(!R)throw new Error("OUT_OF_BOUNDS");const{builder:x}=I;x.updArr(k.id,R,x.constOrJson(N)),I.apply()}del(C,N){const{api:I,node:k}=this,R=k.findInterval(C,N);if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.del(k.id,R),I.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(N,I,k)=>{if(I==="$")return this;const R=Number(I);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const x=this.node.getNode(R);if(!x)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(x).s}})}}te.ArrApi=E;class O extends m{constructor(C){super(C.root,void 0),this.model=C,this.next=0,this.onBeforeReset=new a.FanOut,this.onReset=new a.FanOut,this.onBeforePatch=new a.FanOut,this.onPatch=new a.FanOut,this.onBeforeLocalChange=new a.FanOut,this.onLocalChange=new a.FanOut,this.onLocalChanges=new l.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new a.FanOut,this.onTransaction=new a.FanOut,this.onChange=new l.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new l.MicrotaskBufferFanOut(this.onChange),this.onFlush=new a.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=N=>this.onChanges.listen(()=>N()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new c.PatchBuilder(C.clock),C.onbeforereset=()=>this.onBeforeReset.emit(),C.onreset=()=>this.onReset.emit(),C.onbeforepatch=N=>this.onBeforePatch.emit(N),C.onpatch=N=>this.onPatch.emit(N)}wrap(C){if(C instanceof o.ValNode)return C.api||(C.api=new m(C,this));if(C instanceof o.StrNode)return C.api||(C.api=new v(C,this));if(C instanceof o.BinNode)return C.api||(C.api=new S(C,this));if(C instanceof o.ArrNode)return C.api||(C.api=new E(C,this));if(C instanceof o.ObjNode)return C.api||(C.api=new p(C,this));if(C instanceof o.ConNode)return C.api||(C.api=new _(C,this));if(C instanceof o.VecNode)return C.api||(C.api=new b(C,this));if(C instanceof u.ExtNode){if(C.api)return C.api;const N=this.model.ext.get(C.extId);return C.api=new N.Api(C,this)}else throw new Error("UNKNOWN_NODE")}root(C){return this.set(C)}set(C){return super.set(C),this}apply(){const C=this.builder.patch.ops,N=C.length,I=this.model,k=this.next;this.onBeforeLocalChange.emit(k);for(let R=this.next;R<N;R++)I.applyOperation(C[R]);this.next=N,I.tick++,this.onLocalChange.emit(k)}advance(){const C=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(C)}transaction(C){if(this.inTx)C();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),C(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const C=this.builder.flush();return this.next=0,C.ops.length&&this.onFlush.emit(C),C}autoFlush(C=!1){const N=()=>this.builder.patch.ops.length&&this.flush(),I=this.onLocalChanges.listen(N),k=this.onBeforeTransaction.listen(N),R=this.onTransaction.listen(N);return C&&N(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,I(),k(),R()}}}return te.ModelApi=O,te}var il;function jf(){return il||(il=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),z.__exportStar(n1(),e)})(Ui)),Ui}var xn={},ol;function r1(){if(ol)return xn;ol=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.randomSessionId=void 0;const e=65535,t=9007199254740991-e,r=()=>Math.floor(t*Math.random()+e);return xn.randomSessionId=r,xn}var jn={},cl;function s1(){if(cl)return jn;cl=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.Extensions=void 0;const e=_e();let t=class Pf{constructor(){this.ext={}}register(i){this.ext[i.id]=i}get(i){return this.ext[i]}size(){return Object.keys(this.ext).length}clone(){const i=new Pf;for(const n of Object.values(this.ext))i.register(n);return i}toString(i=""){const n=Object.keys(this.ext).map(o=>+o).sort();return"extensions"+(0,e.printTree)(i,n.map(o=>s=>`${o}: ${this.ext[o].name}`))}};return jn.Extensions=t,jn}var et={},Qi={},Zi={},al;function i1(){return al||(al=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),z.__exportStar(_s(),e)})(Zi)),Zi}var ul;function o1(){return ul||(ul=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const t=i1(),r=JSON.stringify,i=(y,w,_)=>{const m=w.p;if(!m)return y;const b=w===m.l;let p=m.bf|0;switch(b?m.bf=++p:m.bf=--p,p){case 0:return y;case 1:case-1:return i(y,m,w);default:{const v=_===w.l;return b?v?(n(m,w),w.p?y:w):(s(m,w,_),_.p?y:_):v?(a(m,w,_),_.p?y:_):(o(m,w),w.p?y:w)}}},n=(y,w)=>{const _=y.p,m=w.r;w.p=_,w.r=y,y.p=w,y.l=m,m&&(m.p=y),_&&(_.l===y?_.l=w:_.r=w);let b=y.bf,p=w.bf;b+=-1-(p>0?p:0),p+=-1+(b<0?b:0),y.bf=b,w.bf=p},o=(y,w)=>{const _=y.p,m=w.l;w.p=_,w.l=y,y.p=w,y.r=m,m&&(m.p=y),_&&(_.l===y?_.l=w:_.r=w);let b=y.bf,p=w.bf;b+=1-(p<0?p:0),p+=1+(b>0?b:0),y.bf=b,w.bf=p},s=(y,w,_)=>{o(w,_),n(y,_)},a=(y,w,_)=>{n(w,_),o(y,_)},c=(y,w,_)=>(_.r=w,w.p=_,_.bf--,_.l?y:i(y,_,w));e.insertRight=c;const l=(y,w,_)=>(_.l=w,w.p=_,_.bf++,_.r?y:i(y,_,w));e.insertLeft=l;const u=(y,w,_)=>{if(!y)return w;const m=w.k;let b=y,p,v=0;for(;p=(v=_(m,b.k))<0?b.l:b.r;)b=p;return v<0?(0,e.insertLeft)(y,w,b):(0,e.insertRight)(y,w,b)};e.insert=u;const d=(y,w)=>{if(!y)return w;const _=w.p,m=w.l,b=w.r;if(w.p=w.l=w.r=void 0,m&&b)if(m.r){let S=m,E=S;for(;E=S.r;)S=E;const O=S.l,A=S.p,C=O;return _&&(_.l===w?_.l=S:_.r=S),S.p=_,S.r=b,S.bf=w.bf,m!==S&&(S.l=m,m.p=S),b.p=S,A&&(A.l===S?A.l=C:A.r=C),C&&(C.p=A),f(_?y:S,A,1)}else{_&&(_.l===w?_.l=m:_.r=m),m.p=_,m.r=b,b.p=m;const S=w.bf;if(_)return m.bf=S,h(y,m,1);const E=S-1;if(m.bf=E,E>=-1)return m;const O=b.l;return b.bf>0?(a(m,b,O),O):(o(m,b),b)}const p=m||b;return p&&(p.p=_),_?_.l===w?(_.l=p,h(y,_,1)):(_.r=p,f(y,_,1)):p};e.remove=d;const h=(y,w,_)=>{let m=w.bf|0;m-=_,w.bf=m;let b=_;if(m===-1)return y;if(m<-1){const v=w.r;if(v.bf<=0)v.l&&v.bf===0&&(b=0),o(w,v),w=v;else{const S=v.l;a(w,v,S),w=S}}const p=w.p;return p?p.l===w?h(y,p,b):f(y,p,b):w},f=(y,w,_)=>{let m=w.bf|0;m+=_,w.bf=m;let b=_;if(m===1)return y;if(m>1){const v=w.l;if(v.bf>=0)v.r&&v.bf===0&&(b=0),n(w,v),w=v;else{const S=v.r;s(w,v,S),w=S}}const p=w.p;return p?p.l===w?h(y,p,b):f(y,p,b):w},g=(y,w="")=>{if(!y)return"∅";const{bf:_,l:m,r:b,k:p,v}=y,S=v&&typeof v=="object"&&v.constructor===Object?r(v):v&&typeof v=="object"?v.toString(w):r(v),E=p!==void 0?` { ${r(p)} = ${S} }`:"",O=_?` [${_}]`:"";return y.constructor.name+`${O}`+E+(0,t.printBinary)(w,[m?A=>(0,e.print)(m,A):null,b?A=>(0,e.print)(b,A):null])};e.print=g})(Qi)),Qi}var Pn={},eo={},Mn={},ll;function Mf(){if(ll)return Mn;ll=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.first=void 0;const e=t=>{let r=t;for(;r;)if(r.l)r=r.l;else return r;return r};return Mn.first=e,Mn}var Dn={},dl;function c1(){if(dl)return Dn;dl=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.next=void 0;const e=Mf(),t=r=>{const i=r.r;if(i)return(0,e.first)(i);let n=r.p;for(;n&&n.r===r;)r=n,n=n.p;return n};return Dn.next=t,Dn}var fl;function Df(){return fl||(fl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const t=Mf();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return t.first}});const r=c1();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return r.next}});const i=f=>{let g=f;for(;g;)if(g.r)g=g.r;else return g;return g};e.last=i;const n=f=>{if(f.l){for(f=f.l;f.r;)f=f.r;return f}let g=f.p;for(;g&&g.l===f;)f=g,g=g.p;return g};e.prev=n;const o=f=>{const g=f.l,y=f.r;return 1+(g?o(g):0)+(y?o(y):0)},s=f=>f?o(f):0;e.size=s;const a=(f,g,y)=>{let w=f;for(;w;){const _=y(g,w.k);if(_===0)return w;w=_<0?w.l:w.r}return w};e.find=a;const c=(f,g,y)=>{let w=f,_;for(;w;){const m=y(w.k,g);if(m===0)return w;if(m>0)w=w.l;else{const b=w.r;if(_=w,!b)return _;w=b}}return _};e.findOrNextLower=c;const l=(f,g)=>{const y=f.r=g.r;g.r=f,f.p=g,y&&(y.p=f)};e.insertRight=l;const u=(f,g)=>{const y=f.l=g.l;g.l=f,f.p=g,y&&(y.p=f)};e.insertLeft=u;const d=(f,g,y)=>{if(!f)return g;const w=g.k;let _=f;for(;_;){const m=y(w,_.k),b=m<0?_.l:_.r;if(b)_=b;else{m<0?(0,e.insertLeft)(g,_):(0,e.insertRight)(g,_);break}}return f};e.insert=d;const h=(f,g)=>{const y=g.p,w=g.l,_=g.r;if(g.p=g.l=g.r=void 0,!w&&!_){if(y)y.l===g?y.l=void 0:y.r=void 0;else return;return f}else if(w&&_){let b=w;for(;b.r;)b=b.r;return b.r=_,_.p=b,y?(y.l===g?y.l=w:y.r=w,w.p=y,f):(w.p=void 0,w)}const m=w||_;if(m.p=y,y)y.l===g?y.l=m:y.r=m;else return m;return f};e.remove=h})(eo)),eo}var to={},hl;function a1(){return hl||(hl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),z.__exportStar(_e(),e)})(to)),to}var pl;function u1(){if(pl)return Pn;pl=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.createMap=void 0;const e=Df(),t=a1(),r=(n,o)=>n===o?0:n<o?-1:1,i=(n,o,s,a,c,l)=>{class u{constructor(h){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=h||r}set(h,f){const g=this.root;if(g===void 0){this._size=1;const p=new n(h,f);return this.root=this.min=this.max=o(void 0,p,this.comparator)}const y=this.comparator;let w;const _=this.max;if(w=y(h,_.k),w===0)return _.v=f,_;if(w>0){const p=this.max=new n(h,f);return this.root=a(g,p,_),this._size++,p}const m=this.min;if(w=y(h,m.k),w===0)return m.v=f,m;if(w<0){const p=this.min=new n(h,f);return this.root=s(g,p,m),this._size++,p}let b=g;do{if(w=y(h,b.k),w===0)return b.v=f,b;if(w>0){const p=b.r;if(p===void 0){const v=new n(h,f);return this.root=a(g,v,b),this._size++,v}b=p}else if(w<0){const p=b.l;if(p===void 0){const v=new n(h,f);return this.root=s(g,v,b),this._size++,v}b=p}}while(!0)}find(h){const f=this.comparator;let g=this.root;for(;g;){const y=+f(h,g.k);if(y===0)return g;g=y<0?g.l:g.r}}get(h){return this.find(h)?.v}del(h){const f=this.find(h);return f?(f===this.max&&(this.max=(0,e.prev)(f)),f===this.min&&(this.min=(0,e.next)(f)),this.root=c(this.root,f),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(h){return!!this.find(h)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(h){return(0,e.findOrNextLower)(this.root,h,this.comparator)||void 0}forEach(h){let f=this.first();if(f)do h(f);while(f=(0,e.next)(f))}first(){return this.min}last(){return this.max}iterator0(){let h=this.first();return()=>{if(!h)return;const f=h;return h=(0,e.next)(h),f}}iterator(){const h=this.iterator0();return{next:()=>{const f=h();return{value:f,done:!f}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(h){return this.constructor.name+(0,t.printTree)(h,[f=>l(this.root,f)])}}return u};return Pn.createMap=i,Pn}var ml;function l1(){if(ml)return et;ml=1,Object.defineProperty(et,"__esModule",{value:!0}),et.AvlMap=et.AvlNode=void 0;const e=o1(),t=u1();class r{constructor(n,o){this.k=n,this.v=o,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return et.AvlNode=r,et.AvlMap=(0,t.createMap)(r,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),et}var bl;function As(){if(bl)return Ye;bl=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Model=Ye.UNDEFINED=void 0;const e=z,t=e.__importStar(pt()),r=e.__importStar($()),i=Jm(),n=jf(),o=ws(),s=r1(),a=je(),c=Es(),l=_e(),u=s1(),d=l1(),h=mt();Ye.UNDEFINED=new c.ConNode(o.ORIGIN,void 0);let f=class Oo{rndSid(){const y=this.clock,w=y.sid,_=y.peers;for(;;){const m=(0,s.randomSessionId)();if(w!==m&&!_.has(m))return m}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const m=y[0].getId().sid;if(!m)throw new Error("NO_SID");const b=Oo.create(void 0,m);return b.applyBatch(y),b}constructor(y){this.root=new a.RootNode(this,o.ORIGIN),this.index=new d.AvlMap(r.compare),this.ext=new u.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new n.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const w=y.length;for(let _=0;_<w;_++)this.applyPatch(y[_])}applyLocalPatch(y){const w=y.getId();if(w){const _=this.clock;if(_.sid===w.sid){const m=_.time;m>w.time&&(y=y.rebase(m))}}this.applyPatch(y)}applyPatch(y){this.onbeforepatch?.(y);const w=y.ops,{length:_}=w;for(let m=0;m<_;m++)this.applyOperation(w[m]);this.tick++,this.onpatch?.(y)}applyOperation(y){this.clock.observe(y.id,y.span());const w=this.index;if(y instanceof t.InsStrOp){const _=w.get(y.obj);_ instanceof a.StrNode&&_.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewObjOp){const _=y.id;w.get(_)||w.set(_,new a.ObjNode(this,_))}else if(y instanceof t.NewArrOp){const _=y.id;w.get(_)||w.set(_,new a.ArrNode(this,_))}else if(y instanceof t.NewStrOp){const _=y.id;w.get(_)||w.set(_,new a.StrNode(_))}else if(y instanceof t.NewValOp){const _=y.id;w.get(_)||w.set(_,new a.ValNode(this,_,o.ORIGIN))}else if(y instanceof t.NewConOp){const _=y.id;w.get(_)||w.set(_,new c.ConNode(_,y.val))}else if(y instanceof t.InsObjOp){const _=w.get(y.obj),m=y.data,b=m.length;if(_ instanceof a.ObjNode)for(let p=0;p<b;p++){const v=m[p],S=w.get(v[1]);if(!S||_.id.time>=v[1].time)continue;const E=_.put(v[0]+"",S.id);E&&this._gcTree(E)}}else if(y instanceof t.InsVecOp){const _=w.get(y.obj),m=y.data,b=m.length;if(_ instanceof a.VecNode)for(let p=0;p<b;p++){const v=m[p],S=w.get(v[1]);if(!S||_.id.time>=v[1].time)continue;const E=_.put(Number(v[0]),S.id);E&&this._gcTree(E)}}else if(y instanceof t.InsValOp){const _=y.obj,m=_.sid===0&&_.time===0?this.root:w.get(_);if(m instanceof a.ValNode&&w.get(y.val)){const p=m.set(y.val);p&&this._gcTree(p)}}else if(y instanceof t.InsArrOp){const _=w.get(y.obj);if(_ instanceof a.ArrNode){const m=[],b=y.data,p=b.length;for(let v=0;v<p;v++){const S=b[v];w.get(S)&&(_.id.time>=S.time||m.push(S))}m.length&&_.ins(y.ref,y.id,m)}}else if(y instanceof t.UpdArrOp){const _=w.get(y.obj);if(_ instanceof a.ArrNode){const m=y.val;if(w.get(m)){const b=_.upd(y.ref,m);b&&this._gcTree(b)}}}else if(y instanceof t.DelOp){const _=w.get(y.obj);if(_ instanceof a.ArrNode){const m=y.what.length;for(let b=0;b<m;b++){const p=y.what[b];for(let v=0;v<p.span;v++){const S=_.getById(new r.Timestamp(p.sid,p.time+v));S&&this._gcTree(S)}}_.delete(y.what)}else(_ instanceof a.StrNode||_ instanceof a.BinNode)&&_.delete(y.what)}else if(y instanceof t.NewBinOp){const _=y.id;w.get(_)||w.set(_,new a.BinNode(_))}else if(y instanceof t.InsBinOp){const _=w.get(y.obj);_ instanceof a.BinNode&&_.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewVecOp){const _=y.id;w.get(_)||w.set(_,new a.VecNode(this,_))}}_gcTree(y){if(y.sid===0)return;const _=this.index.get(y);if(!_)return;const m=_.api;m&&m.events.handleDelete(),_.children(b=>this._gcTree(b.id)),this.index.del(y)}fork(y=this.rndSid()){const w=Oo.fromBinary(this.toBinary());return w.clock.sid!==y&&w.clock instanceof r.ClockVector&&(w.clock=w.clock.fork(y)),w.ext=this.ext,w}clone(){return this.fork(this.clock.sid)}reset(y){this.onbeforereset?.();const w=this.index;this.index=new d.AvlMap(r.compare);const _=y.toBinary();i.decoder.decode(_,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const m=this._api;m&&(m.flush(),m.builder.clock=this.clock,m.node=this.root),w.forEach(({v:b})=>{const p=b.api;if(!p)return;const v=this.index.get(b.id);if(!v){p.events.handleDelete();return}p.node=v,v.api=p}),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return i.encoder.encode(this)}setSchema(y,w=!0){const _=this.clock;if(_.time===1){const b=_.sid;w&&(_.sid=2),this.api.set(y),w&&this.setSid(b)}return this}setSid(y){const w=this.clock,_=w.sid;_!==y&&(w.sid=y,w.observe(new r.Timestamp(_,w.time-1),1))}toString(y=""){const w=()=>"",_=this.ext.size()>0;return"model"+(0,l.printTree)(y,[m=>this.root.toString(m),w,m=>{const b=[];return this.index.forEach(p=>b.push(p.v)),`index (${b.length} nodes)`+(b.length?(0,l.printTree)(m,b.map(p=>v=>`${p.name()} ${r.printTs(p.id)}`)):"")},w,m=>`view${(0,l.printTree)(m,[b=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+b)])}`,w,m=>this.clock.toString(m),_?w:null,_?m=>this.ext.toString(m):null])}};return Ye.Model=f,f.sid=s.randomSessionId,f.create=(g,y=f.sid())=>{const w=typeof y=="number"?y===1?new r.ServerClockVector(1,1):new r.ClockVector(y,1):y,_=new f(w);return g!==void 0&&_.setSchema(g instanceof h.NodeBuilder?g:h.s.json(g),!0),_},f.withServerClock=(g,y=1)=>f.create(g,new r.ServerClockVector(1,y)),f.fromBinary=g=>i.decoder.decode(g),f.load=(g,y,w)=>{const _=i.decoder.decode(g);return w&&_.setSchema(w,!0),typeof y=="number"&&_.setSid(y),_},Ye}var gl;function Bf(){if(gl)return wn;gl=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.ValNode=void 0;const e=$(),t=_e(),r=As();let i=class{constructor(o,s,a){this.doc=o,this.id=s,this.val=a,this.api=void 0}set(o){if((0,e.compare)(o,this.val)<=0&&this.val.sid!==0||(0,e.compare)(o,this.id)<=0)return;const s=this.val;return this.val=o,s}node(){return this.val.sid===0?r.UNDEFINED:this.child()}view(){return this.node()?.view()}children(o){o(this.node())}child(){return this.doc.index.get(this.val)}container(){const o=this.node();return o?o.container():void 0}name(){return"val"}toString(o=""){const s=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,t.printTree)(o,[c=>s?s.toString(c):(0,e.printTs)(this.val)])}};return wn.ValNode=i,wn}var Bn={},yl;function d1(){if(yl)return Bn;yl=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.RootNode=void 0;const e=ws(),t=Bf();let r=class extends t.ValNode{constructor(n,o){super(n,e.ORIGIN,o)}name(){return"root"}};return Bn.RootNode=r,Bn}var qn={},Ln={},vl;function f1(){if(vl)return Ln;vl=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.CRDT_CONSTANTS=void 0;var e;return(function(t){t[t.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"})(e||(Ln.CRDT_CONSTANTS=e={})),Ln}var wl;function h1(){if(wl)return qn;wl=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.VecNode=void 0;const e=Es(),t=f1(),r=_e(),i=$();let n=class{constructor(s,a){this.doc=s,this.id=a,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(s){return this.elements[s]}get(s){const a=this.elements[s];if(a)return this.doc.index.get(a)}put(s,a){if(s>t.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const c=this.val(s);if(!(c&&(0,i.compare)(c,a)>=0)){if(s>this.elements.length)for(let l=this.elements.length;l<s;l++)this.elements.push(void 0);return s<this.elements.length?this.elements[s]=a:this.elements.push(a),c}}ext(){if(this.__extNode)return this.__extNode;const s=this.getExtId();if(!(s>=0))return;const c=this.doc.ext.get(s);if(c)return this.__extNode=new c.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const s=this.get(0);if(!(s instanceof e.ConNode))return-1;const a=s.val,c=this.id;return!(a instanceof Uint8Array)||a.length!==3||a[1]!==c.sid%256||a[2]!==c.time%256?-1:a[0]}child(){return this.ext()}container(){return this}children(s){const a=this.elements,c=a.length,l=this.doc.index;for(let u=0;u<c;u++){const d=a[u];if(!d)continue;const h=l.get(d);h&&s(h)}}view(){const s=this.ext();if(s)return s.view();let a=!0;const c=this._view,l=[],u=this.doc.index,d=this.elements,h=d.length;for(let f=0;f<h;f++){const g=d[f],y=g?u.get(g):void 0,w=y?y.view():void 0;c[f]!==w&&(a=!1),l.push(w)}return a?c:this._view=l}name(){return"vec"}toString(s=""){const a=this.ext(),c=this.name()+" "+(0,i.printTs)(this.id)+(a?` { extension = ${this.getExtId()} }`:"");if(a)return this.child().toString(s,this.id);const l=this.doc.index;return c+(0,r.printTree)(s,[...this.elements.map((u,d)=>h=>`${d}: ${u&&l.get(u)?l.get(u).toString(h+"  "+" ".repeat((""+d).length)):"nil"}`),...a?[u=>`${this.child().toString(u)}`]:[]])}};return qn.VecNode=n,qn}var Un={},_l;function p1(){if(_l)return Un;_l=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.ObjNode=void 0;const e=_e(),t=$(),r=Es();let i=class{constructor(o,s){this.doc=o,this.id=s,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(o){const s=this.keys.get(o);if(s)return this.doc.index.get(s)}put(o,s){const a=this.keys.get(o);if(!(a&&(0,t.compare)(a,s)>=0))return this.keys.set(o,s),a}nodes(o){const s=this.doc.index;this.keys.forEach((a,c)=>o(s.get(a),c))}forEach(o){const s=this.doc.index;this.keys.forEach((a,c)=>{const l=s.get(a);!l||l instanceof r.ConNode&&l.val===void 0||o(c,l)})}children(o){const s=this.doc.index;this.keys.forEach((a,c)=>o(s.get(a)))}child(){}container(){return this}view(){const o=this.doc,s=o.clock.time+o.tick,a=this._view;if(this._tick===s)return a;const c={},l=o.index;let u=!0;return this.keys.forEach((d,h)=>{const f=l.get(d);if(!f){u=!1;return}const g=f.view();g!==void 0?(a[h]!==g&&(u=!1),c[h]=g):a[h]!==void 0&&(u=!1)}),u?a:(this._tick=s,this._view=c)}name(){return"obj"}toString(o=""){return this.name()+" "+(0,t.printTs)(this.id)+(0,e.printTree)(o,[...this.keys.entries()].filter(([,a])=>!!this.doc.index.get(a)).map(([a,c])=>l=>JSON.stringify(a)+(0,e.printTree)(l+" ",[u=>this.doc.index.get(c).toString(u)])))}};return Un.ObjNode=i,Un}var tt={},Fn={},Vn={},Sl;function m1(){if(Sl)return Vn;Sl=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.printOctets=void 0;const e=(t,r=16)=>{let i="";if(!t.length)return i;t[0]<16&&(i+="0"),i+=t[0].toString(16);for(let n=1;n<t.length&&n<r;n++){const o=t[n];i+=" ",o<16&&(i+="0"),i+=o.toString(16)}return t.length>r&&(i+=`… (${t.length-r} more)`),i};return Vn.printOctets=e,Vn}var no={},El;function b1(){return El||(El=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const t=(c,l,u)=>{const d=l.p;if(!d)return c;const h=d.p,f=d.l===l;return h?(h.l===d?f?c=(0,e.llSplay)(c,l,d,h):c=(0,e.lrSplay)(c,l,d,h):f?c=(0,e.rlSplay)(c,l,d,h):c=(0,e.rrSplay)(c,l,d,h),u>1?(0,e.splay)(c,l,u-1):c):(f?(0,e.rSplay)(l,d):(0,e.lSplay)(l,d),l)};e.splay=t;const r=(c,l)=>{const u=c.r;c.p=void 0,c.r=l,l.p=c,l.l=u,u&&(u.p=l)};e.rSplay=r;const i=(c,l)=>{const u=c.l;c.p=void 0,c.l=l,l.p=c,l.r=u,u&&(u.p=l)};e.lSplay=i;const n=(c,l,u,d)=>{const h=u.l,f=l.l,g=d.p;return l.p=g,l.l=u,u.p=l,u.l=d,u.r=f,d.p=u,d.r=h,h&&(h.p=d),f&&(f.p=u),g?g.l===d?g.l=l:g.r=l:c=l,c};e.rrSplay=n;const o=(c,l,u,d)=>{const h=u.r,f=l.r,g=d.p;return l.p=g,l.r=u,u.p=l,u.l=f,u.r=d,d.p=u,d.l=h,h&&(h.p=d),f&&(f.p=u),g?g.l===d?g.l=l:g.r=l:c=l,c};e.llSplay=o;const s=(c,l,u,d)=>{const h=l.l,f=l.r,g=d.p;return l.p=g,l.l=u,l.r=d,u.p=l,u.r=h,d.p=l,d.l=f,h&&(h.p=u),f&&(f.p=d),g?g.l===d?g.l=l:g.r=l:c=l,c};e.lrSplay=s;const a=(c,l,u,d)=>{const h=l.r,f=l.l,g=d.p;return l.p=g,l.l=d,l.r=u,u.p=l,u.l=h,d.p=l,d.r=f,h&&(h.p=u),f&&(f.p=d),g?g.l===d?g.l=l:g.r=l:c=l,c};e.rlSplay=a})(no)),no}var ro={},Cl;function g1(){return Cl||(Cl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const t=(c,l)=>{const u=l.p2;if(!u)return c;const d=u.p2,h=u.l2===l;return d?(d.l2===u?h?c=o(c,l,u,d):c=s(c,l,u,d):h?c=a(c,l,u,d):c=n(c,l,u,d),(0,e.splay2)(c,l)):(h?r(l,u):i(l,u),l)};e.splay2=t;const r=(c,l)=>{const u=c.r2;c.p2=void 0,c.r2=l,l.p2=c,l.l2=u,u&&(u.p2=l)},i=(c,l)=>{const u=c.l2;c.p2=void 0,c.l2=l,l.p2=c,l.r2=u,u&&(u.p2=l)},n=(c,l,u,d)=>{const h=u.l2,f=l.l2,g=d.p2;return l.p2=g,l.l2=u,u.p2=l,u.l2=d,u.r2=f,d.p2=u,d.r2=h,h&&(h.p2=d),f&&(f.p2=u),g?g.l2===d?g.l2=l:g.r2=l:c=l,c},o=(c,l,u,d)=>{const h=u.r2,f=l.r2,g=d.p2;return l.p2=g,l.r2=u,u.p2=l,u.l2=f,u.r2=d,d.p2=u,d.l2=h,h&&(h.p2=d),f&&(f.p2=u),g?g.l2===d?g.l2=l:g.r2=l:c=l,c},s=(c,l,u,d)=>{const h=l.l2,f=l.r2,g=d.p2;return l.p2=g,l.l2=u,l.r2=d,u.p2=l,u.r2=h,d.p2=l,d.l2=f,h&&(h.p2=u),f&&(f.p2=d),g?g.l2===d?g.l2=l:g.r2=l:c=l,c},a=(c,l,u,d)=>{const h=l.r2,f=l.l2,g=d.p2;return l.p2=g,l.l2=d,l.r2=u,u.p2=l,u.l2=h,d.p2=l,d.r2=f,h&&(h.p2=u),f&&(f.p2=d),g?g.l2===d?g.l2=l:g.r2=l:c=l,c}})(ro)),ro}var fe={},Ol;function y1(){if(Ol)return fe;Ol=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.remove2=fe.insert2=fe.prev2=fe.next2=fe.last2=fe.first2=void 0;const e=c=>{let l=c;for(;l;)if(l.l2)l=l.l2;else return l;return l};fe.first2=e;const t=c=>{let l=c;for(;l;)if(l.r2)l=l.r2;else return l;return l};fe.last2=t;const r=c=>{if(c.r2){for(c=c.r2;c.l2;)c=c.l2;return c}let l=c.p2;for(;l&&l.r2===c;)c=l,l=l.p2;return l};fe.next2=r;const i=c=>{if(c.l2){for(c=c.l2;c.r2;)c=c.r2;return c}let l=c.p2;for(;l&&l.l2===c;)c=l,l=l.p2;return l};fe.prev2=i;const n=(c,l)=>{const u=c.r2=l.r2;l.r2=c,c.p2=l,u&&(u.p2=c)},o=(c,l)=>{const u=c.l2=l.l2;l.l2=c,c.p2=l,u&&(u.p2=c)},s=(c,l,u)=>{if(!c)return l;let d=c;for(;d;){const h=u(l,d),f=h<0?d.l2:d.r2;if(f)d=f;else{h<0?o(l,d):n(l,d);break}}return c};fe.insert2=s;const a=(c,l)=>{const u=l.p2,d=l.l2,h=l.r2;if(l.p2=l.l2=l.r2=void 0,!d&&!h){if(u)u.l2===l?u.l2=void 0:u.r2=void 0;else return;return c}else if(d&&h){let g=d;for(;g.r2;)g=g.r2;return g.r2=h,h.p2=g,u?(u.l2===l?u.l2=d:u.r2=d,d.p2=u,c):(d.p2=void 0,d)}const f=d||h;if(f.p2=u,u)u.l2===l?u.l2=f:u.r2=f;else return f;return c};return fe.remove2=a,fe}var Jn={},Al={},Nl;function v1(){if(Nl)return Al;if(Nl=1,typeof Iterator>"u"&&typeof globalThis=="object"){class e{[Symbol.iterator](){return this}find(r){for(const i of this)if(r(i))return i}}globalThis.Iterator=e}return Al}var Il;function w1(){if(Il)return Jn;Il=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.UndEndIterator=void 0,v1();class e extends Iterator{constructor(i){super(),this.n=i}next(){const i=this.n();return new t(i,i===void 0)}}Jn.UndEndIterator=e;class t{constructor(i,n){this.value=i,this.done=n}}return Jn}var kl;function Xo(){if(kl)return Fn;kl=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.AbstractRga=void 0;const e=$(),t=Ho(),r=m1(),i=b1(),n=g1(),o=y1(),s=ws(),a=_e(),c=_s(),l=w1(),u=(_,m)=>{const b=_.id,p=m.id;return b.sid-p.sid||b.time-p.time},d=_=>{const m=_.l,b=_.r;_.len=(_.del?0:_.span)+(m?m.len:0)+(b?b.len:0)},h=_=>{const m=_.l,b=_.r;_.len=_.span+(m?m.len:0)+(b?b.len:0)},f=(_,m)=>{for(;_;)_.len+=m,_=_.p},g=_=>{const m=_.r;if(m){_=m;let p;for(;p=_.l;)_=p;return _}let b=_.p;for(;b&&b.r===_;)_=b,b=b.p;return b},y=_=>{const m=_.l;if(m){_=m;let p;for(;p=_.r;)_=p;return _}let b=_.p;for(;b&&b.l===_;)_=b,b=b.p;return b};let w=class{constructor(m){this.id=m,this.root=void 0,this.ids=void 0,this.count=0}ins(m,b,p){const v=this.id,S=m.time,E=m.sid;if(v.time===S&&v.sid===E){this.insAfterRoot(m,b,p);return}let A=this.ids,C=A;for(;A;){const M=A.id,q=M.sid;if(q>E)A=A.l2;else if(q<E)C=A,A=A.r2;else{const U=M.time;if(U>S)A=A.l2;else if(U<S)C=A,A=A.r2;else{C=A;break}}}if(!C)return;const N=C.id,I=N.time,k=N.sid,R=C.span;if(k!==E||S-I>=R)return;const T=S-I;this.insAfterChunk(m,C,T,b,p)}insAt(m,b,p){if(!m){const C=this.id;return this.insAfterRoot(C,b,p),C}const v=this.findChunk(m-1);if(!v)return;const[S,E]=v,O=S.id,A=E===0?O:new e.Timestamp(O.sid,O.time+E);return this.insAfterChunk(A,S,E,b,p),A}insAfterRoot(m,b,p){const v=this.createChunk(b,p),S=this.first();if(!S)this.setRoot(v);else if((0,e.compare)(S.id,b)<0)this.insertBefore(v,S);else{if((0,e.containsId)(S.id,S.span,b))return;this.insertAfterRef(v,m,S)}}insAfterChunk(m,b,p,v,S){const E=b.id,O=E.time,A=E.sid,C=b.span,N=this.createChunk(v,S);if(p+1<C){const k=v.sid,R=v.time;if(A===k&&O<=R&&O+C-1>=R)return;if(R>m.time+1||k>m.sid){this.insertInside(N,b,p+1),this.splay(N);return}}this.insertAfterRef(N,m,b),this.splay(N)}delete(m){const b=m.length;for(let p=0;p<b;p++)this.deleteSpan(m[p]);this.onChange()}deleteSpan(m){const b=m.span,p=m.time,v=p+b-1,S=this.findById(m);if(!S)return;let E=S,O=E;for(;E;){O=E;const A=E.id,C=E.span,N=A.time,I=N+C-1;if(E.del){if(I>=v)break;E=E.s;continue}const k=p<=N,R=p<=I;if(k)if(v>=I){if(E.delete(),f(E,-E.span),v<=I)break}else{const T=v-N+1,M=this.split(E,T);E.delete(),d(M),f(E,-E.span);break}else if(R)if(v>=I){const T=p-N,M=this.split(E,T);if(M.delete(),M.len=M.r?M.r.len:0,f(E,-M.span),v<=I)break}else{const T=this.split(E,v-N+1),M=this.split(E,p-N);M.delete(),d(T),d(M),f(E,-M.span);break}E=E.s}O&&this.mergeTombstones2(S,O)}find(m){let b=this.root;for(;b;){const p=b.l,v=p?p.len:0;let S;if(m<v)b=p;else if(b.del)m-=v,b=b.r;else if(m<v+(S=b.span)){const E=m-v,O=b.id;return E?new e.Timestamp(O.sid,O.time+E):O}else m-=v+S,b=b.r}}findChunk(m){let b=this.root;for(;b;){const p=b.l,v=p?p.len:0;let S;if(m<v)b=p;else if(b.del)m-=v,b=b.r;else{if(m<v+(S=b.span))return[b,m-v];m-=v+S,b=b.r}}}findInterval(m,b){const p=[];if(!b)return p;let v=this.root,S=0;for(;v;){const A=v.l?v.l.len:0;if(m<A)v=v.l;else if(v.del)m-=A,v=v.r;else if(m<A+v.span){S=m-A;break}else m-=A+v.span,v=v.r}if(!v)return p;if(v.span>=b+S){const A=v.id;return p.push((0,e.tss)(A.sid,A.time+S,b)),p}const E=v.span-S,O=v.id;if(p.push((0,e.tss)(O.sid,O.time+S,E)),b-=E,v=g(v),!v)return p;do{if(v.del)continue;const A=v.id,C=v.span;if(b<=C)return p.push((0,e.tss)(A.sid,A.time,b)),p;p.push((0,e.tss)(A.sid,A.time,C)),b-=C}while((v=g(v))&&b>0);return p}findInterval2(m,b){const p=[];return this.range0(void 0,m,b,(v,S,E)=>{const O=v.id;p.push((0,e.tss)(O.sid,O.time+S,E))}),p}range0(m,b,p,v){let S=m||this.findById(b);if(m)for(;S&&!(0,e.containsId)(S.id,S.span,b);)S=g(S);if(S){if(S.del){if((0,e.containsId)(S.id,S.span,p))return}else{const E=b.time-S.id.time;if((0,e.containsId)(S.id,S.span,p)){const C=p.time-b.time+1;return v(S,E,C),S}const A=S.span-E;if(v(S,E,A))return S}for(S=g(S);S;){if((0,e.containsId)(S.id,S.span,p))return!S.del&&v(S,0,p.time-S.id.time+1),S;if(!S.del&&v(S,0,S.span))return S;S=g(S)}return S}}first(){let m=this.root;for(;m;){const b=m.l;if(b)m=b;else return m}return m}last(){let m=this.root;for(;m;){const b=m.r;if(b)m=b;else return m}return m}lastId(){const m=this.last();if(!m)return;const b=m.id,p=m.span;return p===1?b:new e.Timestamp(b.sid,b.time+p-1)}next(m){return g(m)}prev(m){return y(m)}length(){const m=this.root;return m?m.len:0}size(){return this.count}pos(m){const b=m.p,p=m.l;if(!b)return p?p.len:0;const v=this.pos(b);if(b.r===m)return v+(b.del?0:b.span)+(p?p.len:0);const E=m.r;return v-(m.del?0:m.span)-(E?E.len:0)}chunks0(){let m=this.first();return()=>{const b=m;return m&&(m=g(m)),b}}chunks(){return new l.UndEndIterator(this.chunks0())}setRoot(m){this.root=m,this.insertId(m),this.onChange()}insertBefore(m,b){const p=b.l;b.l=m,m.l=p,m.p=b;let v=0;p&&(p.p=m,v=p.len),m.len=m.span+v,f(b,m.span),this.insertId(m),this.onChange()}insertAfter(m,b){const p=b.r;b.r=m,m.r=p,m.p=b;let v=0;p&&(p.p=m,v=p.len),m.len=m.span+v,f(b,m.span),this.insertId(m),this.onChange()}insertAfterRef(m,b,p){const v=m.id,S=v.sid,E=v.time;let O=!1;for(;;){const A=p.id,C=A.time+p.span;p.s||(O=A.sid===S&&C===E&&C-1===b.time,O&&(p.s=m));const N=g(p);if(!N)break;const I=N.id,k=I.time,R=I.sid;if(k<E)break;if(k===E){if(R===S)return;if(R<S)break}p=N}O&&!p.del?(this.mergeContent(p,m.data),p.s=void 0):this.insertAfter(m,p)}mergeContent(m,b){const p=m.span;m.merge(b),f(m,m.span-p),this.onChange()}insertInside(m,b,p){const v=b.p,S=b.l,E=b.r,O=b.s,A=b.len,C=b.split(p);if(b.s=C,C.s=O,b.l=b.r=C.l=C.r=void 0,C.l=void 0,m.p=v,!S)m.l=b,b.p=m;else{m.l=S,S.p=m;const k=S.r;S.r=b,b.p=S,b.l=k,k&&(k.p=b)}if(!E)m.r=C,C.p=m;else{m.r=E,E.p=m;const k=E.l;E.l=C,C.p=E,C.r=k,k&&(k.p=C)}v?v.l===b?v.l=m:v.r=m:this.root=m,d(b),d(C),S&&(S.len=(S.l?S.l.len:0)+b.len+(S.del?0:S.span)),E&&(E.len=(E.r?E.r.len:0)+C.len+(E.del?0:E.span)),m.len=A+m.span;const N=m.span;let I=m.p;for(;I;)I.len+=N,I=I.p;this.insertId(C),this.insertIdFast(m),this.onChange()}split(m,b){const p=m.s,v=m.split(b),S=m.r;return m.s=v,v.r=S,v.s=p,m.r=v,v.p=m,this.insertId(v),S&&(S.p=v),v}mergeTombstones(m,b){if(!m.del||!b.del)return!1;const p=m.id,v=b.id;return p.sid!==v.sid||p.time+m.span!==v.time?!1:(m.s=b.s,m.span+=b.span,this.deleteChunk(b),!0)}mergeTombstones2(m,b){let p=m;for(;p;){const S=g(p);if(!S)break;if(!this.mergeTombstones(p,S)){if(S===b){if(S){const O=g(S);O&&this.mergeTombstones(S,O)}break}p=p.s}}const v=y(m);v&&this.mergeTombstones(v,m)}rmTombstones(){let m=this.first();const b=[];for(;m;)m.del&&b.push(m),m=g(m);for(let p=0;p<b.length;p++)this.deleteChunk(b[p])}deleteChunk(m){this.deleteId(m);const b=m.p,p=m.l,v=m.r;if(m.id=s.ORIGIN,!p&&!v)b?b.l===m?b.l=void 0:b.r=void 0:this.root=void 0;else if(p&&v){let S=p;for(;S.r;)S=S.r;S.r=v,v.p=S;const E=v.len;let O;for(O=S,b?(b.l===m?b.l=p:b.r=p,p.p=b):(this.root=p,p.p=void 0);O&&O!==b;)O.len+=E,O=O.p}else{const S=p||v;S.p=b,b?b.l===m?b.l=S:b.r=S:this.root=S}}insertId(m){this.ids=(0,o.insert2)(this.ids,m,u),this.count++,this.ids=(0,n.splay2)(this.ids,m)}insertIdFast(m){this.ids=(0,o.insert2)(this.ids,m,u),this.count++}deleteId(m){this.ids=(0,o.remove2)(this.ids,m),this.count--}findById(m){const b=m.sid,p=m.time;let v=this.ids,S=v;for(;v;){const I=v.id,k=I.sid;if(k>b)v=v.l2;else if(k<b)S=v,v=v.r2;else{const R=I.time;if(R>p)v=v.l2;else if(R<p)S=v,v=v.r2;else{S=v;break}}}if(!S)return;const E=S.id,O=E.time,A=E.sid,C=S.span;if(!(A!==b||p<O||p-O>=C))return S}posById(m){const b=this.findById(m);if(!b)return;const p=this.pos(b);return b.del?p:p+(m.time-b.id.time)}prevId(m){let b=this.findById(m);if(!b)return;const p=m.time;if(b.id.time<p)return new e.Timestamp(m.sid,p-1);if(b=y(b),!b)return;const v=b.id;return b.span>1?new e.Timestamp(v.sid,v.time+b.span-1):v}spanView(m){const b=[];let p=m.span;const v=m.time;let S=this.findById(m);if(!S)return b;if(!S.del)if(S.span>=p+v-S.id.time){const E=v-S.id.time,O=E+p,A=S.view().slice(E,O);return b.push(A),b}else{const E=v-S.id.time,O=S.view().slice(E,m.span);p-=S.span-E,b.push(O)}for(;S=S.s;){const E=S.span;if(!S.del){if(E>p){const O=S.view().slice(0,p);b.push(O);break}b.push(S.data)}if(p-=E,p<=0)break}return b}splay(m){const b=m.p;if(!b)return;const p=b.p,v=b.l===m;if(!p){v?(0,i.rSplay)(m,b):(0,i.lSplay)(m,b),this.root=m,d(b),h(m);return}p.l===b?v?this.root=(0,i.llSplay)(this.root,m,b,p):this.root=(0,i.lrSplay)(this.root,m,b,p):v?this.root=(0,i.rlSplay)(this.root,m,b,p):this.root=(0,i.rrSplay)(this.root,m,b,p),d(p),d(b),h(m),this.splay(m)}iterator(){let m=this.first();return()=>{const b=m;return m&&(m=g(m)),b}}ingest(m,b){if(m<1)return;const p=new Map;this.root=this._ingest(m,()=>{const v=b(),S=v.id,E=S.sid+"."+S.time,O=p.get(E);O&&(O.s=v,p.delete(E));const A=(0,e.tick)(S,v.span);return p.set(A.sid+"."+A.time,v),v})}_ingest(m,b){const p=m>>1,v=m-p-1,S=p>0?this._ingest(p,b):void 0,E=b();S&&(E.l=S,S.p=E);const O=v>0?this._ingest(v,b):void 0;return O&&(E.r=O,O.p=E),d(E),this.insertId(E),E}toStringName(){return"AbstractRga"}toString(m=""){const b=this.view();let p="";return(0,t.isUint8Array)(b)?p+=` { ${(0,r.printOctets)(b)||"∅"} }`:typeof b=="string"&&(p+=`{ ${b.length>32?JSON.stringify(b.substring(0,32))+" …":JSON.stringify(b)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${p}`+(0,a.printTree)(m,[S=>this.root?this.printChunk(S,this.root):"∅"])}printChunk(m,b){return this.formatChunk(b)+(0,c.printBinary)(m,[b.l?p=>this.printChunk(p,b.l):null,b.r?p=>this.printChunk(p,b.r):null])}formatChunk(m){let p=`chunk ${(0,e.printTs)(m.id)}:${m.span} .${m.len}.`;if(m.del)p+=` [${m.span}]`;else if((0,t.isUint8Array)(m.data))p+=` { ${(0,r.printOctets)(m.data)||"∅"} }`;else if(typeof m.data=="string"){const v=m.data.length>32?JSON.stringify(m.data.substring(0,32))+" …":JSON.stringify(m.data);p+=` { ${v} }`}return p}};return Fn.AbstractRga=w,Fn}var Rl;function _1(){if(Rl)return tt;Rl=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.ArrNode=tt.ArrChunk=void 0;const e=Xo(),t=$(),r=_s(),i=_e();class n{constructor(a,c,l){this.id=a,this.span=c,this.len=l?c:0,this.del=!l,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=l}merge(a){this.data.push(...a),this.span=this.data.length}split(a){const c=this.span;if(this.span=a,!this.del){const u=this.data.splice(a);return new n((0,t.tick)(this.id,a),c-a,u)}return new n((0,t.tick)(this.id,a),c-a,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new n(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}tt.ArrChunk=n;let o=class extends e.AbstractRga{constructor(a,c){super(c),this.doc=a,this._tick=0,this._view=[],this.api=void 0}get(a){const c=this.findChunk(a);if(c)return c[0].data[c[1]]}getNode(a){const c=this.get(a);if(c)return this.doc.index.get(c)}getId(a){const c=this.findChunk(a);if(!c)return;const[l,u]=c,d=l.id;return u?(0,t.tick)(d,u):d}getById(a){const c=this.findById(a);if(!c||c.del)return;const l=a.time-c.id.time;return c.data[l]}upd(a,c){const l=this.findById(a);if(!l)return;const u=l.data;if(!u)return;const d=a.time-l.id.time,h=u[d];if(!(h&&(0,t.compare)(h,c)>=0))return u[d]=c,this.onChange(),h}createChunk(a,c){return new n(a,c?c.length:0,c)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const a=this.doc,c=a.clock.time+a.tick,l=this._view;if(this._tick===c)return l;const u=[],d=a.index;let h=!0;for(let g=this.first();g;g=this.next(g))if(!g.del)for(const y of g.data){const w=d.get(y);if(!w){h=!1;continue}const _=w.view();l[u.length]!==_&&(h=!1),u.push(_)}return l.length!==u.length&&(h=!1),h?l:(this._tick=c,this._view=u)}children(a){const c=this.doc.index;for(let l=this.first();l;l=this.next(l)){const u=l.data;if(!u)continue;const d=u.length;for(let h=0;h<d;h++)a(c.get(u[h]))}}name(){return"arr"}printChunk(a,c){const l=this.pos(c);let u="";if(!c.del){const d=this.doc.index;u=(0,i.printTree)(a,c.data.map(h=>d.get(h)).filter(h=>!!h).map((h,f)=>g=>`[${l+f}]: ${h.toString(g+"    "+" ".repeat(String(f).length))}`))}return this.formatChunk(c)+u+(0,r.printBinary)(a,[c.l?d=>this.printChunk(d,c.l):null,c.r?d=>this.printChunk(d,c.r):null])}};return tt.ArrNode=o,tt}var nt={},Tl;function S1(){if(Tl)return nt;Tl=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.BinNode=nt.BinChunk=void 0;const e=$(),t=Xo();class r{constructor(o,s,a){this.id=o,this.span=s,this.len=a?s:0,this.del=!a,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=a}merge(o){const s=this.data.length,a=new Uint8Array(s+o.length);a.set(this.data),a.set(o,s),this.data=a,this.span=a.length}split(o){if(!this.del){const a=this.data,c=a.subarray(o),l=new r((0,e.tick)(this.id,o),this.span-o,c);return this.data=a.subarray(0,o),this.span=o,l}const s=new r((0,e.tick)(this.id,o),this.span-o,void 0);return this.span=o,s}delete(){this.del=!0,this.data=void 0}clone(){return new r(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}nt.BinChunk=r;let i=class extends t.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const o=new Uint8Array(this.length());let s=0,a=this.first();for(;a;){if(!a.del){const c=a.data;o.set(c,s),s+=c.length}a=this.next(a)}return this._view=o}children(){}child(){}container(){}name(){return"bin"}createChunk(o,s){return new r(o,s?s.length:0,s)}onChange(){this._view=null}toStringName(){return this.name()}};return nt.BinNode=i,nt}var rt={},xl;function E1(){if(xl)return rt;xl=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.StrNode=rt.StrChunk=void 0;const e=$(),t=Xo(),r=Df();class i{constructor(s,a,c){this.id=s,this.span=a,this.len=c?a:0,this.del=!c,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=c}merge(s){this.data+=s,this.span=this.data.length}split(s){if(!this.del){const c=new i((0,e.tick)(this.id,s),this.span-s,this.data.slice(s));return this.data=this.data.slice(0,s),this.span=s,c}const a=new i((0,e.tick)(this.id,s),this.span-s,"");return this.span=s,a}delete(){this.del=!0,this.data=""}clone(){return new i(this.id,this.span,this.data)}view(){return this.data}}rt.StrChunk=i;let n=class extends t.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let s="";for(let a=this.first();a;a=(0,r.next)(a))s+=a.data;return this._view=s}name(){return"str"}createChunk(s,a){return new i(s,a?a.length:0,a||"")}onChange(){this._view=""}toStringName(){return this.name()}};return rt.StrNode=n,rt}var jl;function C1(){return jl||(jl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var t=Es();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return t.ConNode}});var r=Bf();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return r.ValNode}});var i=d1();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return i.RootNode}});var n=h1();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return n.VecNode}});var o=p1();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return o.ObjNode}});var s=_1();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return s.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return s.ArrChunk}});var a=S1();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return a.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return a.BinChunk}});var c=E1();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return c.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return c.StrChunk}})})(Ai)),Ai}var Pl;function je(){return Pl||(Pl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(mm(),e),t.__exportStar(C1(),e)})(Ci)),Ci}var so={},Ml;function O1(){return Ml||(Ml=1,Object.defineProperty(so,"__esModule",{value:!0})),so}var io={},Dl;function A1(){return Dl||(Dl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const t=z;var r=As();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return r.Model}}),t.__exportStar(jf(),e)})(io)),io}var Bl;function Fr(){return Bl||(Bl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(je(),e),t.__exportStar(O1(),e),t.__exportStar(A1(),e),t.__exportStar(mt(),e)})(Ei)),Ei}var Gn={},zn={},Hn={},ql;function N1(){if(ql)return Hn;ql=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.PropertyLayout=void 0;const e=B(),t=ne(),r=se(),i=({property:n,formal:o,focused:s})=>{const a=(0,t.useTheme)(),c={color:a.g(.1)};return s&&(c.background=a.bg,c.border=`1px solid ${a.g(.9)}`,c.fontWeight="bold",c.margin="-3px",c.padding="2px"),(!n||n.indexOf(" ")!==-1)&&(c.background=a.blue(.1)),e.createElement(e.Fragment,null,e.createElement("span",{className:r.property,style:c},o?JSON.stringify(n):n),e.createElement("span",{className:r.colon,style:{color:a.g(.5)}},e.createElement("span",null,":")))};return Hn.PropertyLayout=i,Hn}var Ll;function Pe(){if(Ll)return zn;Ll=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.JsonCrdtProperty=void 0;const e=B(),t=N1(),r=({node:i})=>!i.parent||i.parent.node.name()!=="obj"?null:e.createElement(t.PropertyLayout,{property:i.step});return zn.JsonCrdtProperty=r,zn}var Wn={},Kn={},Ul;function I1(){if(Ul)return Kn;Ul=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.TypeAndId=void 0;const e=B(),t=ne(),r=Fr(),i=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",us:"none",pe:"none"}));return Kn.TypeAndId=e.memo(({node:n,active:o,negative:s,extension:a})=>{const c=(0,t.useTheme)(),l=n.node;let u=l.name();a&&l instanceof r.VecNode&&l.isExt()&&(u=e.createElement("span",{style:{whiteSpace:"nowrap"}},"ext ",e.createElement("span",{style:{color:c.color.sem.brand[1]}},l.ext().name())));const{sid:d,time:h}=l.id;return e.createElement("span",{className:i,style:{color:o?s?c.color.sem.negative[0]:c.color.sem.blue[0]:c.g(0,.5)}},u,e.createElement("span",{style:{color:o?c.g(0,.45):c.g(0,.2),display:"block"}},o?(d>999?"...":"")+String(d).slice(String(d).length-4):null,e.createElement("span",{style:{color:o?c.g(0,.7):c.g(0,.3)}},"."+h)))}),Kn}var ke={},Fl;function Me(){if(Fl)return ke;Fl=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.isContainer=ke.createValue=ke.id=void 0;const e=i=>{const n=i.node.id;return n.sid+"."+n.time};ke.id=e;const t=(i,n,o,s)=>{let a=n;try{a=JSON.parse(n)}catch{}const c=i.api,l=c.builder,u=o==="any"?s?l.constOrJson(a):l.json(a):o==="con"?c.builder.const(a):o==="vec"?c.builder.vec():o==="val"?c.builder.val():c.builder.const(void 0);if(o==="vec"){if(n){const d=Array.isArray(a)?a:[a];l.insVec(u,d.map((h,f)=>[f,c.builder.maybeConst(h)]))}}else o==="val"&&l.setVal(u,n?c.builder.maybeConst(a):c.builder.const(void 0));return u};ke.createValue=t;const r=i=>!!i&&typeof i=="object";return ke.isContainer=r,ke}var $n={},Vl;function k1(){if(Vl)return $n;Vl=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.JsonCrdtRegionEdit=void 0;const e=B(),t=Pe(),r=Fo(),i=vs(),n=Uo(),o=ue(),s=Me(),a=we(),c=({node:l,onCancel:u})=>{const{compact:d}=(0,o.useStyles)(),{model:h}=(0,a.useJsonCrdt)(),f=(w,_)=>{const m=l.parent;if(m&&m.node.name()==="obj"){const b=(0,s.createValue)(h,w,_,!0);h.api.wrap(m.node).set({[l.step]:b})}else if(m&&(m.node.name()==="val"||m.node.name()==="root")){const b=(0,s.createValue)(h,w,_,!0);h.api.wrap(m.node).set(b)}else if(m&&m.node.name()==="vec"){const b=(0,s.createValue)(h,w,_,!0);h.api.wrap(m.node).set([[+l.step,b]])}u&&u()},g=l.node.view(),y=(0,s.isContainer)(g)?"":JSON.stringify(g);return e.createElement(n.FocusRegion,{compact:d},e.createElement(t.JsonCrdtProperty,{node:l}),e.createElement("span",{style:{display:"inline-block",margin:"-3px 0",position:"relative"}},e.createElement(r.ValueInput,{focus:!0,withType:!0,visible:!0,initialType:l.node.name()==="con"&&l.node.view()!==void 0?"con":"any",initialValue:y,onSubmit:f,onCancel:u}),!!u&&e.createElement(i.CancelAction,{onClick:()=>u()})))};return $n.JsonCrdtRegionEdit=c,$n}var Jl;function Ge(){if(Jl)return Wn;Jl=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.JsonCrdtRegion=void 0;const e=B(),t=Uo(),r=ve(),i=ue(),n=we(),o=I1(),s=Me(),a=k1(),c=u=>!u.parent||u.node.name()!=="con"?!1:u.node.val===void 0,l=({node:u,editing:d,extension:h,toolbar:f,children:g})=>{var y;const{model:w}=(0,n.useJsonCrdt)(),{compact:_,readonly:m}=(0,i.useStyles)(),{focused:b,focus:p,pointed:v,point:S}=(0,r.useFocus)(),E=(0,s.id)(u),[O,A]=e.useState(!1),C=L=>{L.stopPropagation(),v!==E&&S(E)},N=L=>{L.preventDefault(),L.stopPropagation(),S(E)},I=()=>{S("")},k=L=>{L.preventDefault(),L.stopPropagation(),p(E)},R=b===E,x=v===E,T=(y=u.parent)===null||y===void 0?void 0:y.node.name(),M=c(u),q=T==="obj",U=T==="arr",V=T==="vec",F=R?e.createElement("span",{style:{display:"inline-block",margin:"-4px 0 0"}},e.createElement(o.TypeAndId,{node:u,active:R,negative:M,extension:h})):void 0;return O?e.createElement(a.JsonCrdtRegionEdit,{node:u,onCancel:()=>A(!1)}):e.createElement(t.FocusRegion,{pointed:x,focused:R,compact:_,negative:M,aside:F,toolbar:f,onClick:k,onMouseMove:C,onMouseEnter:N,onMouseLeave:I,onDelete:d||m||!R||M?void 0:q?()=>{w.api.wrap(u.parent.node).del([u.step])}:U?()=>{w.api.wrap(u.parent.node).del(+u.step,1)}:V?()=>{w.api.wrap(u.parent.node).set([[+u.step,void 0]])}:T==="val"&&!M?()=>{w.api.wrap(u.parent.node).set(void 0)}:void 0,onEdit:d||m?void 0:R&&(T==="obj"||T==="val"||T==="root"||T==="vec")?()=>A(!0):void 0},g)};return Wn.JsonCrdtRegion=l,Wn}var Yn={},Gl;function qf(){if(Gl)return Yn;Gl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.JsonCrdtConstant=void 0;const e=B(),t=ht(),r=gf(),i=ve(),n=({id:o,view:s})=>{const{focus:a}=(0,i.useFocus)(),[c,l]=e.useState(!1),u=()=>{s&&typeof s=="object"&&l(!c)};return c?e.createElement("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"}},e.createElement(r.ClickableJson,{readonly:!0,compact:!0,noCollapseToggles:!0,pfx:o,doc:s,onFocus:d=>{d!==null&&a(o)}})):e.createElement(t.JsonAtom,{value:s,onClick:u})};return Yn.JsonCrdtConstant=n,Yn}var zl;function R1(){if(zl)return Gn;zl=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.JsonCrdtConNode=void 0;const e=B(),t=Pe(),r=Ge(),i=ue(),n=Me(),o=qf(),s=({node:a})=>{const{formal:c}=(0,i.useStyles)();return e.createElement(r.JsonCrdtRegion,{node:a},e.createElement(t.JsonCrdtProperty,{node:a}),e.createElement(o.JsonCrdtConstant,{id:(0,n.id)(a),view:a.node.view()}),!!c&&",")};return Gn.JsonCrdtConNode=s,Gn}var Xn={},Qn={},Hl;function Vr(){if(Hl)return Qn;Hl=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.JsonCrdtObjectLayout=void 0;const e=z,t=B(),r=mf(),i=ue(),n=ve(),o=Me(),s=a=>{var{node:c}=a,l=e.__rest(a,["node"]);const{collapsed:u}=(0,i.useStyles)(),{focused:d}=(0,n.useFocus)(),[h,f]=t.useState(u),g=()=>{!h&&(0,o.id)(c)===d&&f(!0)};return t.createElement(r.ObjectLayout,Object.assign({collapsed:h,onCollapserClick:()=>f(!h),onBracketClick:g,onCollapsedClick:()=>{h&&f(!1)}},l))};return Qn.JsonCrdtObjectLayout=s,Qn}var oo={},Wl;function Jr(){return Wl||(Wl=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useRerenderModel=e.useRerender=e.useNodeApi=void 0;const t=B(),r=we(),i=s=>{const{model:a}=(0,r.useJsonCrdt)();return a.api.wrap(s.node)};e.useNodeApi=i;const n=s=>{const a=(0,e.useNodeApi)(s).events;return t.useSyncExternalStore(a.subscribe,a.getSnapshot)};e.useRerender=n;const o=()=>{const{model:s}=(0,r.useJsonCrdt)(),a=s.api;t.useSyncExternalStore(a.subscribe,()=>s.tick)};e.useRerenderModel=o})(oo)),oo}var Kl;function T1(){if(Kl)return Xn;Kl=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.JsonCrdtValNode=void 0;const e=B(),t=se(),r=Ur(),i=we(),n=Ge(),o=Pe(),s=Vr(),a=ht(),c=Jr(),l=({node:u})=>{const{render:d}=(0,i.useJsonCrdt)();(0,c.useRerenderModel)();const h=u.node.node();if(!h)return null;const f=(0,r.nodeRef)(h,u,"");if(!f)return null;const g=e.createElement("span",{className:t.line},d(f));let y="…";if(h.name()==="con"){const w=h.view();y=e.createElement(a.JsonAtom,{value:w})}return e.createElement(n.JsonCrdtRegion,{node:u},e.createElement(s.JsonCrdtObjectLayout,{node:u,property:e.createElement(o.JsonCrdtProperty,{node:u}),collapsedView:y,brackets:["(",")"]},g))};return Xn.JsonCrdtValNode=l,Xn}var Zn={},er={},$l;function x1(){if($l)return er;$l=1,Object.defineProperty(er,"__esModule",{value:!0}),er.AddKey=void 0;const e=B(),t=pf(),r=ve(),i=Me(),n=we(),o=({node:s})=>{const{model:a}=(0,n.useJsonCrdt)(),c=(0,r.useIsFocused)((0,i.id)(s)),l=e.useCallback((u,d,h)=>{const f=(0,i.createValue)(a,d,h,!0);a.api.wrap(s.node).set({[u]:f})},[s.node]);return e.createElement(t.ObjectInsert,{withType:!0,visible:c,onSubmit:l})};return er.AddKey=o,er}var tr={},nr={},Yl;function j1(){if(Yl)return nr;Yl=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.MiniTitle=void 0;const e=B(),t=ne(),r=(0,t.rule)({...t.theme.font.sans.bold,fz:"10px",textTransform:"uppercase",col:t.theme.g(.5),pad:0,mar:0}),i=({component:n="span",style:o,onClick:s,children:a})=>e.createElement(n,{className:r,style:o,onClick:s,children:a});return nr.MiniTitle=i,nr}var Xl;function P1(){if(Xl)return tr;Xl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.Tombstones=void 0;const e=B(),t=ne(),r=Je(),i=j1(),n=(0,t.rule)({d:"block",bxz:"border-box",pd:"0 4px 4px 16px",bdrad:"8px",mr:"4px 0 0 -16px",w:"calc(100% + 16px)",bg:t.theme.red(.05)}),o=(0,t.rule)({d:"block",w:"100%",bxz:"border-box",pd:"4px 8px 3px 3px",cur:"default",us:"none"}),s=({tombstones:a})=>{const[c,l]=e.useState(!1),[u]=(0,r.useT)();return a.length?e.createElement("span",{className:n},e.createElement("style",{className:o,onClick:()=>l(d=>!d)},e.createElement(i.MiniTitle,{style:{fontSize:"0.65em",color:t.theme.red(.75)}},a.length+" "+(a.length===1?u("tombstone"):u("tombstones")))),c&&a):null};return tr.Tombstones=s,tr}var Ql;function M1(){if(Ql)return Zn;Ql=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.JsonCrdtObjNode=void 0;const e=B(),t=Fr(),r=se(),i=we(),n=Ur(),o=Ge(),s=Pe(),a=Vr(),c=Jr(),l=x1(),u=P1(),d=ue(),h=g=>g instanceof t.ConNode&&g.val===void 0,f=({node:g})=>{const{readonly:y}=(0,d.useStyles)(),{render:w}=(0,i.useJsonCrdt)();(0,c.useRerender)(g);const _=[],m=[];return g.node.nodes((b,p)=>{if(!b)return;const v=(0,n.nodeRef)(b,g,p);if(!v)return;const S=e.createElement("span",{key:p,className:r.line},w(v));h(b)?m.push(S):_.push(S)}),e.createElement(o.JsonCrdtRegion,{node:g},e.createElement(a.JsonCrdtObjectLayout,{node:g,property:e.createElement(s.JsonCrdtProperty,{node:g}),collapsedView:!!_.length&&_.length},_,!y&&e.createElement(l.AddKey,{node:g}),!!m.length&&e.createElement(u.Tombstones,{tombstones:m})))};return Zn.JsonCrdtObjNode=f,Zn}var rr={},sr={},Zl;function D1(){if(Zl)return sr;Zl=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.PushElement=void 0;const e=B(),t=Vo(),r=ve(),i=Me(),n=we(),o=({node:s})=>{const{model:a}=(0,n.useJsonCrdt)(),c=(0,r.useIsFocused)((0,i.id)(s)),l=e.useCallback((u,d)=>{const h=(0,i.createValue)(a,u,d,!0),f=a.api.wrap(s.node);f.set([[f.view().length,h]])},[s.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:c,onSubmit:l})};return sr.PushElement=o,sr}var ir={},or={},ed;function Lf(){if(ed)return or;ed=1,Object.defineProperty(or,"__esModule",{value:!0}),or.SwitchAction=void 0;const e=B(),t=ne(),r=se(),i=Lr(),n=(0,t.drule)({w:"20px",h:"20px",bdrad:"50%",svg:{fill:r.blue}}),o=s=>e.createElement(i.Action,Object.assign({},s,{className:n()}),"~");return or.SwitchAction=o,or}var td;function B1(){if(td)return ir;td=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.JsonCrdtExtNode=void 0;const e=B(),t=Je(),r=Ge(),i=Pe(),n=Vr(),o=Jr(),s=qf(),a=Me(),c=ht(),l=Lf(),u=({node:d,onViewChange:h})=>{const[f]=(0,t.useT)();(0,o.useRerenderModel)();const y=d.node.view();return e.createElement(r.JsonCrdtRegion,{node:d,extension:!0,toolbar:e.createElement(l.SwitchAction,{onClick:h,tooltip:f('Show "vec" node')})},e.createElement(n.JsonCrdtObjectLayout,{node:d,property:e.createElement(i.JsonCrdtProperty,{node:d}),collapsedView:e.createElement(c.JsonAtom,{value:y}),brackets:["(",")"]},e.createElement(s.JsonCrdtConstant,{id:(0,a.id)(d),view:y})))};return ir.JsonCrdtExtNode=u,ir}var nd;function q1(){if(nd)return rr;nd=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.JsonCrdtVecNode=void 0;const e=B(),t=Je(),r=se(),i=we(),n=Ur(),o=Ge(),s=Pe(),a=Vr(),c=Jr(),l=D1(),u=ue(),d=B1(),h=Lf(),f=({node:g})=>{const[y]=(0,t.useT)(),[w,_]=e.useState(!1),{readonly:m}=(0,u.useStyles)(),{render:b}=(0,i.useJsonCrdt)();(0,c.useRerenderModel)();const p=g.node.isExt();if(p&&!w)return e.createElement(d.JsonCrdtExtNode,{node:g,onViewChange:()=>_(!0)});const v=[];let S=0;return g.node.children(E=>{if(!E)return;const O=(0,n.nodeRef)(E,g,String(S));O&&(v.push(e.createElement("span",{key:E.id.sid+"."+E.id.time,className:r.line},b(O))),S++)}),e.createElement(o.JsonCrdtRegion,{node:g,toolbar:p?e.createElement(h.SwitchAction,{onClick:()=>_(!1),tooltip:y('Show "ext" view')}):void 0},e.createElement(a.JsonCrdtObjectLayout,{node:g,property:e.createElement(s.JsonCrdtProperty,{node:g}),collapsedView:!!v.length&&v.length,brackets:["[","]"],header:e.createElement("span",{style:{opacity:.5,display:"inline-block",margin:"0.25em 0 0 -0.3em"}},"→")},v,!m&&e.createElement(l.PushElement,{node:g})))};return rr.JsonCrdtVecNode=f,rr}var cr={},ar={},rd;function L1(){if(rd)return ar;rd=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.InsertElement=void 0;const e=B(),t=Vo(),r=ve(),i=Me(),n=we(),o=({node:s,index:a})=>{const{model:c}=(0,n.useJsonCrdt)(),l=(0,r.useIsFocused)((0,i.id)(s)),u=e.useCallback((d,h)=>{const f=(0,i.createValue)(c,d,h);c.api.wrap(s.node).ins(a,[f])},[s.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:l,onSubmit:u})};return ar.InsertElement=o,ar}var sd;function U1(){if(sd)return cr;sd=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.JsonCrdtArrNode=void 0;const e=B(),t=se(),r=we(),i=Ur(),n=Ge(),o=Pe(),s=Vr(),a=Jr(),c=L1(),l=ue(),u=({node:d})=>{const{readonly:h}=(0,l.useStyles)(),{render:f}=(0,r.useJsonCrdt)();(0,a.useRerender)(d);const g=[];let y=0;return d.node.children(w=>{if(!w)return;const _=(0,i.nodeRef)(w,d,String(y));if(!_)return;_.step=String(y);const m=w.id.sid+"."+w.id.time+"."+y;g.push(e.createElement(e.Fragment,{key:m},!h&&e.createElement(c.InsertElement,{key:m,node:d,index:y}),e.createElement("span",{className:t.line},f(_)))),y++}),e.createElement(n.JsonCrdtRegion,{node:d},e.createElement(s.JsonCrdtObjectLayout,{node:d,property:e.createElement(o.JsonCrdtProperty,{node:d}),collapsedView:!!g.length&&g.length,brackets:["[","]"]},g,!h&&e.createElement(c.InsertElement,{key:d.node.length(),node:d,index:d.node.length()})))};return cr.JsonCrdtArrNode=u,cr}var ur={},lr={},dr={},co={},ao={},id;function F1(){return id||(id=1,Object.defineProperty(ao,"__esModule",{value:!0})),ao}var fr={},od;function Uf(){if(od)return fr;od=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.Selection=void 0;let e=class{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}};return fr.Selection=e,fr}var hr={},st={},cd;function ad(){if(cd)return st;cd=1,Object.defineProperty(st,"__esModule",{value:!0}),st.invokeFirstOnly=st.applyChange=void 0;const e=(r,i,n,o)=>r.slice(0,i)+o+r.slice(i+n);st.applyChange=e;const t=()=>{let r=!1;return i=>{if(!r){r=!0;try{i()}finally{r=!1}}}};return st.invokeFirstOnly=t,st}var ud;function V1(){if(ud)return hr;ud=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.StrBinding=void 0;const e=ad(),t=Uf(),r=ad(),i=Cs();let n=class{constructor(s,a){this.str=s,this.editor=a,this.race=(0,e.invokeFirstOnly)(),this.onModelChange=()=>{this.race(()=>{this.syncFromModel(),this.saveSelection()})},this.onchange=(c,l)=>{this.race(()=>{if(c instanceof Array&&c.length>0){const u=this.str();if(!u)return;let d=!0;if(l){let h=this.view;for(let g=0;g<length;g++){const y=c[g],[w,_,m]=y;h=(0,r.applyChange)(h,w,_,m)}const f=this.editor;f.getLength&&h.length!==f.getLength()||h!==f.get()?d=!1:this.view=h}if(d){const h=c.length;try{u.api.transaction(()=>{let f=this.view;for(let g=0;g<h;g++){const y=c[g],[w,_,m]=y;f=(0,r.applyChange)(f,w,_,m),_&&u.del(w,_),m&&u.ins(w,m)}this.view=f}),this.saveSelection();return}catch{}}}this.syncFromEditor()})},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout(()=>{this.race(()=>{try{const c=this.view,l=this.editor;(l.getLength&&c.length!==l.getLength()||c!==l.get())&&this.syncFromEditor()}catch{}this._p&&this.pollChanges()})},this.pollingInterval)},this._s=null,this.bind=c=>{this.syncFromModel();const l=this.editor;l.onchange=this.onchange,l.onselection=()=>this.saveSelection(),c&&this.pollChanges(),this._s=this.str().api.onChange.listen(this.onModelChange)},this.unbind=()=>{var c,l,u;this.stopPolling(),(c=this._s)===null||c===void 0||c.call(this),(u=(l=this.editor).dispose)===null||u===void 0||u.call(l)},this.view=s().view(),a.selection=this.selection=new t.Selection}saveSelection(){var s,a,c;const{editor:l,selection:u}=this,d=this.str();if(!d)return;const[h,f,g]=((s=l.getSelection)===null||s===void 0?void 0:s.call(l))||[-1,-1,0],{start:y,end:w}=u,_=Date.now(),m=d.api.model.tick;y===h&&w===f&&(m===u.tick||_-u.ts<3e3)||(u.start=h,u.end=f,u.dir=g,u.ts=_,u.tick=m,u.startId=typeof h=="number"&&(a=d.findId((h??0)-1))!==null&&a!==void 0?a:null,u.endId=typeof f=="number"&&(c=d.findId((f??0)-1))!==null&&c!==void 0?c:null)}syncFromModel(){const s=this.editor,a=this.str();if(!a)return;const c=(this.view=a.view())||"";if(s.ins&&s.del){const l=s.get();if(c===l)return;const u=(0,i.diff)(l,c),d=u.length;let h=0;for(let f=0;f<d;f++){const g=u[f],[y,w]=g,_=w.length;switch(y){case-1:s.del(h,_);break;case 0:h+=_;break;case 1:s.ins(h,w),h+=_;break}}}else{s.set(c);const{selection:l}=this;if(s.setSelection){const u=l.startId?a.findPos(l.startId)+1:-1,d=l.endId?a.findPos(l.endId)+1:-1;s.setSelection(u,d,l.dir)}}}syncFromEditor(){var s;let a=this.view;const c=this.editor.get();if(c===a)return;const l=this.selection,u=l.start===l.end&&(s=l.start)!==null&&s!==void 0?s:void 0,d=(0,i.diffEdit)(a,c,u||0),h=d.length,f=this.str();f&&(f.api.transaction(()=>{let g=0;for(let y=0;y<h;y++){const w=d[y],[_,m]=w;switch(_){case-1:{a=(0,r.applyChange)(a,g,m.length,""),f.del(g,m.length);break}case 0:{g+=m.length;break}case 1:{a=(0,r.applyChange)(a,g,0,m),f.ins(g,m),g+=m.length;break}}}}),this.view=a,this.saveSelection())}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}};return hr.StrBinding=n,n.bind=(o,s,a)=>{const c=new n(o,s);return c.syncFromModel(),c.bind(a),c.unbind},hr}var ld;function J1(){return ld||(ld=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(F1(),e),t.__exportStar(Uf(),e),t.__exportStar(V1(),e)})(co)),co}var pr={},dd;function G1(){if(dd)return pr;dd=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.InputEditor=void 0;let e=class{constructor(r,i){this.str=r,this.input=i,this.onInput=n=>{this.emitChange(n)},this.onSelectionChange=()=>{this.onselection()},i.addEventListener("input",this.onInput),document.addEventListener("selectionchange",this.onSelectionChange)}get(){return this.input.value}getLength(){return this.input.value.length}set(r){this.input.value=r}ins(r,i){const n=this.getSelection(),o=this.get(),s=o.slice(0,r)+i+o.slice(r);if(this.set(s),n){let[a,c]=n;const l=i.length;a>=r&&(a+=l),c>r&&(c+=l),this.setSelection(a,c,n[2])}}del(r,i){const n=this.getSelection(),o=this.get(),s=o.slice(0,r)+o.slice(r+i);if(this.set(s),n){let[a,c]=n;a>=r&&(a=Math.max(r,a-i)),c>=r&&(c=Math.max(r,c-i)),this.setSelection(a,c,n[2])}}getSelection(){const r=this.input,{selectionStart:i,selectionEnd:n,selectionDirection:o}=r;return[typeof i=="number"?i:-1,typeof n=="number"?n:-1,o==="backward"?-1:o==="forward"?1:0]}setSelection(r,i,n){const o=this.input;o.selectionStart=r>-1?r:null,o.selectionEnd=i>-1?i:null,o.selectionDirection=n===-1?"backward":n===1?"forward":"none"}emitChange(r){var i,n;if(!r.isComposing){switch(r.inputType){case"insertText":{const o=r.data;if(!o||o.length!==1)break;const{selectionStart:s,selectionEnd:a}=this.input;if(s===null||a===null||s!==a||s<=0)break;const c=this.selection;if(s-o.length!==c.start||typeof c.end!="number"||typeof c.end!="number")break;const l=c.end-c.start,u=[c.start,l,o];this.onchange([u]);return}case"deleteContentBackward":{const{start:o,end:s}=this.selection;if(typeof o!="number"||typeof s!="number")break;const a=o===s?[o-1,1,""]:[o,s-o,""];this.onchange([a]);return}case"deleteContentForward":{const{start:o,end:s}=this.selection;if(typeof o!="number"||typeof s!="number")break;const a=o===s?[o,1,""]:[o,s-o,""];this.onchange([a]);return}case"deleteByCut":{const{start:o,end:s}=this.selection;if(typeof o!="number"||typeof s!="number"||o===s)break;const a=Math.min(o,s),c=Math.max(o,s),l=this.str().view(),d=this.input.value;if(l.length-d.length!==c-a)break;const h=[a,c-a,""];this.onchange([h]);return}case"insertFromPaste":{const{start:o,end:s}=this.selection;if(typeof o!="number"||typeof s!="number")break;const a=Math.min(o,s),c=Math.max(o,s),l=this.str().view(),u=this.input,d=u.value,h=Math.max((i=u.selectionStart)!==null&&i!==void 0?i:0,(n=u.selectionEnd)!==null&&n!==void 0?n:0);if(h<=a)break;const f=c-a,g=d.slice(a,h);if(d.length!==l.length-f+g.length)return;const y=[a,f,g];this.onchange([y]);return}}this.onchange()}}dispose(){this.input.removeEventListener("input",this.onInput),document.removeEventListener("selectionchange",this.onSelectionChange)}};return pr.InputEditor=e,pr}var fd;function z1(){if(fd)return dr;fd=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.bind=void 0;const e=J1(),t=G1(),r=(i,n,o)=>{const s=new t.InputEditor(i,n),a=new e.StrBinding(i,s);return a.syncFromModel(),a.bind(o),a.unbind};return dr.bind=r,dr}var mr={},hd;function H1(){if(hd)return mr;hd=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.SubmitAction=void 0;const e=B(),t=Lr(),r=i=>e.createElement(t.Action,Object.assign({},i),"→");return mr.SubmitAction=r,mr}var pd;function W1(){if(pd)return lr;pd=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.StrEdit=void 0;const e=B(),t=ne(),r=z1(),i=qr(),n=Je(),o=se(),s=Lo(),a=ys(),c=vs(),l=H1(),u=we(),d=({node:h,onCancel:f,onDone:g})=>{const[y]=(0,n.useT)(),w=e.useRef(),{model:_}=(0,u.useJsonCrdt)(),[m,b]=e.useMemo(()=>{const E=_.clone();E.api.flush();const O=E.index.get(h.node.id),A=E.api.wrap(O);return[E,A]},[]),p=e.useSyncExternalStore(b.events.subscribe,b.events.getSnapshot);e.useEffect(()=>{if(!w.current)return;const E=(0,r.bind)(()=>b,w.current);return()=>{E()}},[_]);const v=()=>{if(!!m.api.builder.patch.ops.length){const O=m.api.flush();_.applyLocalPatch(O)}g()},S=(0,a.inputStyle)(t.theme,!t.theme.isLight,'""');return S.margin="-3px -3px -3px -5px",S.padding="2px 4px",S.border=`1px solid ${t.theme.g(.85)}`,e.createElement("span",{className:o.input,style:S},e.createElement(i.FlexibleInput,{focus:!0,inp:E=>{w.current=E},value:p,multiline:!0,uncontrolled:!0,typebefore:'"',typeahead:'"',maxWidth:800,onSubmit:v,onFocus:E=>(0,s.selectOnFocus)(E.target),onCancel:()=>{f&&f()}}),e.createElement(c.CancelAction,{onClick:f,tooltip:y("Cancel")}),e.createElement("span",{className:o.bottomRightActionPos},e.createElement(l.SubmitAction,{onClick:v,tooltip:y("Done (Ctrl + Enter)")})))};return lr.StrEdit=d,lr}var md;function K1(){if(md)return ur;md=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.JsonCrdtStrNode=void 0;const e=B(),t=ne(),r=Je(),i=Ge(),n=Pe(),o=ht(),s=ue(),a=ve(),c=Me(),l=se(),u=W1(),d=(0,t.rule)({d:"inline-block",pos:"relative",cur:"pointer",bdrad:"2px"}),h=(0,t.rule)({out:"1px dotted transparent","&:hover":{out:`1px dotted ${t.theme.color.sem.blue[0]}`},[`&:hover .${l.tooltip.trim()}`]:{d:"inline-block"}}),f=({node:g})=>{const[y]=(0,r.useT)(),{formal:w,readonly:_}=(0,s.useStyles)(),{focused:m}=(0,a.useFocus)(),[b,p]=e.useState(!1),v=m===(0,c.id)(g);return e.createElement(i.JsonCrdtRegion,{node:g,editing:b},e.createElement(n.JsonCrdtProperty,{node:g}),b?e.createElement(u.StrEdit,{node:g,onCancel:()=>p(!1),onDone:()=>p(!1)}):e.createElement("span",{className:d+(v&&!_?h:""),onClick:v&&!_?()=>p(!0):void 0},e.createElement(o.JsonAtom,{value:g.node.view()}),!_&&e.createElement("span",{className:l.tooltip},y("Edit"))),!!w&&",")};return ur.JsonCrdtStrNode=f,ur}var br={},bd;function $1(){if(bd)return br;bd=1,Object.defineProperty(br,"__esModule",{value:!0}),br.JsonCrdtBinNode=void 0;const e=B(),t=Ge(),r=Pe(),i=ht(),n=ue(),o=({node:s})=>{const{formal:a}=(0,n.useStyles)();return e.createElement(t.JsonCrdtRegion,{node:s},e.createElement(r.JsonCrdtProperty,{node:s}),e.createElement(i.JsonAtom,{value:s.node.view()}),!!a&&",")};return br.JsonCrdtBinNode=o,br}var gd;function Y1(){if(gd)return Wt;gd=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.ClickableJsonCrdt=void 0;const e=B(),t=we(),r=ue(),i=Ur(),n=bf(),o=ve(),s=Fr(),a=R1(),c=T1(),l=M1(),u=q1(),d=U1(),h=K1(),f=$1(),g=w=>w.node instanceof s.ConNode?e.createElement(a.JsonCrdtConNode,{node:w}):w.node instanceof s.ValNode?e.createElement(c.JsonCrdtValNode,{node:w}):w.node instanceof s.ObjNode?e.createElement(l.JsonCrdtObjNode,{node:w}):w.node instanceof s.StrNode?e.createElement(h.JsonCrdtStrNode,{node:w}):w.node instanceof s.VecNode?e.createElement(u.JsonCrdtVecNode,{node:w}):w.node instanceof s.ArrNode?e.createElement(d.JsonCrdtArrNode,{node:w}):w.node instanceof s.BinNode?e.createElement(f.JsonCrdtBinNode,{node:w}):"∅",y=w=>{const{model:_,compact:m,readonly:b,showRoot:p,onFocus:v}=w,[S,E]=e.useState(0);e.useEffect(()=>{const A=_.api.onReset.listen(()=>E(C=>C+1));return()=>A()},[_]);const O=e.useMemo(()=>(0,i.nodeRef)(p?_.root:_.root.node(),null,""),[_,S]);return e.createElement(r.context.Provider,{value:{compact:m,readonly:b}},e.createElement(t.context.Provider,{value:{model:_,render:g}},e.createElement(o.FocusProvider,{onFocus:v},!!O&&e.createElement(n.Root,{key:S},g(O)))))};return Wt.ClickableJsonCrdt=y,Wt}var yd;function X1(){return yd||(yd=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(gf(),e),t.__exportStar(Y1(),e)})(Js)),Js}var Q1=X1();function Ao({gridSessionId:e,usersReplicaId:t,chatbotName:r="Grid Assistant",initialMessage:i,open:n,onClose:o,agentRegistrationId:s}){const[a,c]=D.useState(),l=e0(a),u={concreteType:"org.sagebionetworks.repo.model.agent.GridAgentSessionContext",gridSessionId:e,usersReplicaId:t};return j.jsx(b0,{open:n,onClose:o,title:r,children:j.jsx(t0,{agentRegistrationId:s,chatbotName:r,initialMessage:i,sessionContext:u,textboxPositionOffset:"16px",hideTitle:!0,showAccessLevelMenu:!1,defaultAgentAccessLevel:$h.WRITE_YOUR_PRIVATE_DATA,externalSession:a,setExternalSession:c,externalChatState:l})})}try{Ao.displayName="GridAgentChat",Ao.__docgenInfo={description:"",displayName:"GridAgentChat",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},usersReplicaId:{defaultValue:null,description:"",name:"usersReplicaId",required:!0,type:{name:"number"}},chatbotName:{defaultValue:{value:"Grid Assistant"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},agentRegistrationId:{defaultValue:null,description:"Optional ID to use a different agent registered in Synapse",name:"agentRegistrationId",required:!1,type:{name:"string"}}}}}catch{}function es(e,t){switch(e.type){case"CREATE":return t==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const r=t==="undo"?e.previousValue:e.newValue;return r?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:r}:null}case"DELETE":return t==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function cs(e=[],t){const[r,i]=D.useState(e),n=D.useCallback(l=>{i(u=>{const d=[...u,l];return t&&d.length>t&&d.shift(),d})},[t]),o=D.useCallback(()=>{if(r.length===0)return;const l=r[r.length-1];return i(u=>u.slice(0,-1)),l},[r]),s=D.useCallback(()=>r[r.length-1],[r]),a=D.useCallback(()=>{i([])},[]),c=D.useCallback(()=>r.length===0,[r]);return{stack:r,push:n,pop:o,clear:a,peek:s,size:r.length,isEmpty:c}}try{cs.displayName="useStack",cs.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}function No(e){return{type:"COMPOSITE",actions:e}}const Z1=100,eb=100;function Io(e){const t=cs([],Z1),r=cs([],eb),[i,n]=D.useState(null),[o,s]=D.useState(null),a=!!i,c=!!o,l=A=>{n(A.currentTarget)},u=A=>{s(A.currentTarget)},d=()=>n(null),h=()=>s(null),f=D.useCallback(()=>{if(t.isEmpty())return null;const A=t.peek();let C,N=0;if(A.type==="COMPOSITE"){C="COMPOSITE";for(let I=t.stack.length-1;I>=0&&t.stack[I].type==="COMPOSITE";I--)N++}else{C=A.type;for(let I=t.stack.length-1;I>=0&&t.stack[I].type===C;I--)N++}return{lastType:C,sameTypeCount:N,totalActions:t.size}},[t]),g=D.useCallback(()=>{if(r.isEmpty())return null;const A=r.peek();let C,N=0;if(A.type==="COMPOSITE")C="COMPOSITE",N=1;else{C=A.type;for(let I=r.stack.length-1;I>=0&&r.stack[I].type===C;I--)N++}return{lastType:C,sameTypeCount:N,totalActions:r.size}},[r]),y=f(),w=g(),_=D.useCallback(()=>{if(t.isEmpty())return;const A=t.pop();if(A)if(A.type==="COMPOSITE"){for(let C=A.actions.length-1;C>=0;C--){const N=A.actions[C],I=es(N,"undo");I&&e(I)}r.push(A)}else{const C=es(A,"undo");if(!C)return;e(C),r.push(A)}d()},[e,t,r]),m=D.useCallback(()=>{if(r.isEmpty())return;const A=r.pop();if(A)if(A.type==="COMPOSITE"){for(let C=0;C<A.actions.length;C++){const N=A.actions[C],I=es(N,"redo");I&&e(I)}t.push(A)}else{const C=es(A,"redo");if(!C)return;e(C),t.push(A)}h()},[r,t,e]);D.useEffect(()=>{const A=C=>{C.ctrlKey&&C.key==="z"&&!C.shiftKey||C.metaKey&&C.key==="z"&&!C.shiftKey?(C.preventDefault(),_()):(C.ctrlKey&&C.key==="y"||C.ctrlKey&&C.shiftKey&&C.key==="z"||C.metaKey&&C.shiftKey&&C.key==="z")&&(C.preventDefault(),m())};return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}},[_,m]);const b=A=>{t.push(A)},p=()=>t.clear(),v=()=>r.clear(),S=(A,C,N)=>{v();const I=[];for(const k of A){const R=k.fromRowIndex,x=k.toRowIndex;if(k.type==="CREATE")for(let T=R;T<x;T++){const M=N[T];I.push({type:"CREATE",rowIndex:T,newValue:M})}if(k.type==="UPDATE"){const T=C.slice(R,x);N.slice(R,x).forEach((q,U)=>{const V=T[U],F=R+U;I.push({type:"UPDATE",rowIndex:F,previousValue:V,newValue:q})})}k.type==="DELETE"&&C.slice(R,x).forEach((M,q)=>{I.push({type:"DELETE",rowIndex:R+q,previousValue:M})})}I.length===1?b(I[0]):I.length>1&&b(No(I))},E=j.jsxs(j.Fragment,{children:[j.jsxs(Ve,{variant:"outlined","aria-controls":a?"undo-menu":void 0,"aria-haspopup":"true",onClick:l,disabled:!y,endIcon:j.jsx(uc,{}),children:["Undo ",y&&`(${y.totalActions})`]}),j.jsx(oc,{id:"undo-menu",anchorEl:i,open:a,onClose:d,children:y?j.jsxs(Rr,{onClick:_,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(Rr,{disabled:!0,children:"No actions to undo"})})]}),O=j.jsxs(j.Fragment,{children:[j.jsxs(Ve,{variant:"outlined","aria-controls":c?"redo-menu":void 0,"aria-haspopup":"true",onClick:u,disabled:!w,endIcon:j.jsx(uc,{}),children:["Redo ",w&&`(${w.totalActions})`]}),j.jsx(oc,{id:"redo-menu",anchorEl:o,open:c,onClose:h,children:w?j.jsxs(Rr,{onClick:m,children:["Redo last ",w.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(Rr,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:_,addToUndoStack:b,clearUndoStack:p,addOperationsToUndoStack:S,undoUI:E,undoTotalActions:y?y.totalActions:0,redoPreview:w,redoUI:O,redoTotalActions:w?w.totalActions:0,handleRedo:m,clearRedoStack:v}}try{No.displayName="batchGridActions",No.__docgenInfo={description:"Helper to batch multiple single actions into a composite action",displayName:"batchGridActions",props:{}}}catch{}try{Io.displayName="useGridUndoRedo",Io.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}function ko(e){const{inputValue:t,onInputValueChange:r,onConfirmInput:i=Te,onSessionChange:n=Te,onReplicaChange:o=Te}=e,{data:s}=g0({}),{mutate:a}=y0({onSuccess:(l,u)=>{be(`Successfully deleted grid session ${u}`,"success"),n(null),o(null)},onError:l=>{be(l.reason,"danger")}}),c=D.useMemo(()=>s?.pages.flatMap(l=>l.page||[])||[],[s]);return j.jsx(_0,{freeSolo:!0,fullWidth:!0,renderInput:l=>j.jsx(Yh,{...l,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:c,getOptionLabel:l=>typeof l=="string"?l:l.sessionId||"",value:t,onInputChange:(l,u)=>{r(u)},onChange:(l,u)=>{u&&typeof u=="object"?(r(u.sessionId||""),i(u.sessionId||"")):r(u||"")},onKeyDown:l=>{l.key==="Enter"&&i(t)},renderOption:(l,u)=>D.createElement(Rr,{...l,key:u.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs(ce,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx(ce,{size:{xs:6,md:2},children:u.sessionId}),j.jsx(ce,{size:{xs:5,md:2},children:u.sourceEntityId}),j.jsx(ce,{size:{xs:0,md:6},children:u.gridJsonSchema$Id??"No schema"}),j.jsx(ce,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:d=>{d.stopPropagation(),a(u.sessionId)},children:"🗑️"})})]}))})}try{ko.displayName="GridSessionSelectionField",ko.__docgenInfo={description:"Utility form field to pick the grid session from existing sessions. Currently, for testing/demo purposes only.",displayName:"GridSessionSelectionField",props:{inputValue:{defaultValue:null,description:"",name:"inputValue",required:!0,type:{name:"string"}},onInputValueChange:{defaultValue:null,description:"",name:"onInputValueChange",required:!0,type:{name:"(value: string) => void"}},onConfirmInput:{defaultValue:null,description:"",name:"onConfirmInput",required:!1,type:{name:"(value: string) => void"}},onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}}}}}catch{}function tb(){const{mutateAsync:e}=w0(),{synapseClient:t}=ut();return Ie({mutationFn:async({createGridRequest:r,sessionId:i})=>{if(!(r||i))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(r){const n=await e(r);return console.log("Grid session started:",n),n.gridSession}return console.log(`Joining existing session ID: ${i}`),await t.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:i})}})}function nb(e){const{mutateAsync:t}=tb(),{mutateAsync:r}=v0();return Ie({...e,mutationFn:async({createGridRequest:i,sessionId:n})=>{if(!(i||n))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const o=await t({createGridRequest:i,sessionId:n}),s=o.sessionId;try{const a=await r(s);console.log("Replica created:",a);const c=a.replica;return{session:o,replica:c}}catch(a){throw new Error("Error starting session:",{cause:a})}}})}const Ro=D.forwardRef((e,t)=>{const{show:r=!1,onSessionChange:i=Te,onReplicaChange:n=Te}=e,[o,s]=D.useState(""),{mutate:a}=nb({onMutate(l){console.debug("Starting grid session with args:",l)},onSuccess({session:l,replica:u}){i(l),n(u.replicaId)},onError(l){const u=l&&typeof l=="object"&&"message"in l&&typeof l.message=="string"?l.message:"An error occurred";be(u,"danger")}}),c=function(l){a(rb(l))};return D.useImperativeHandle(t,()=>({handleStartSession:l=>{a({createGridRequest:l})},handleLoadSession:l=>{a({sessionId:l})}}),[a]),r?j.jsxs(ce,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx(ce,{size:{xs:12},sx:{position:"relative"},children:j.jsx(ko,{inputValue:o,onInputValueChange:s,onConfirmInput:c,onSessionChange:i,onReplicaChange:n})}),j.jsx(ce,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(Yd,{color:"primary",variant:"contained",onClick:()=>{c(o)},children:"Start Grid Session"})})]}):null});function rb(e){const t=a0(e);if(t.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query, Synapse ID, or session ID.");switch(t.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:t.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:t.input};case"recordSetId":return{createGridRequest:{recordSetId:t.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{Ro.displayName="StartGridSession",Ro.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function sb(e){const t=D.useMemo(()=>e?e.api.subscribe:()=>Te,[e]),r=D.useCallback(()=>e?e.api.getSnapshot():null,[e]);return D.useSyncExternalStore(t,r)}function ib(){const{synapseClient:e}=ut();return Ie({mutationFn:async({sessionId:t,replicaId:r})=>{const{presignedUrl:i}=await e.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:t,createGridPresignedUrlRequest:{gridSessionId:t,replicaId:r}});return i}})}class Gr{typeCode;constructor(t){this.typeCode=t}}const Ff=8;class Vf extends Gr{methodName;payload;getMethodName(){return this.methodName}getPayload(){return this.payload}constructor(t,r){super(Ff),this.methodName=t,this.payload=r}getJson(){const t=[this.typeCode,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const Jf=0;class ob extends Gr{requestId;methodName;payload;constructor(t,r,i){super(Jf),this.requestId=t,this.methodName=r,this.payload=i}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const Gf=4;class zf extends Gr{subscriptionId;payload;getPayload(){return this.payload}constructor(t,r){super(Gf),this.subscriptionId=t,this.payload=r}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const Hf=5;class Wf extends Gr{subscriptionId;payload;getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}constructor(t,r){super(Hf),this.subscriptionId=t,this.payload=r}getJson(){const t=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&t.push(this.payload),t}}const Kf=1;class is extends Gr{requestId;methodName;payload;constructor(t,r,i){super(Kf),this.requestId=t,this.methodName=r,this.payload=i}setRequestId(t){this.requestId=t}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}class cb{static fromJson(t){if(!Array.isArray(t))throw new Error("Invalid JSON-Rx message: not an array");const r=t[0];if(typeof r!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${r}`);switch(r){case Jf:{const[i,n,o,s]=t;return new ob(n,o,s)}case Kf:{const[i,n,o,s]=t;return new is(n,o,s)}case Gf:{const[i,n,o]=t;return new zf(n,o)}case Hf:{const[i,n,o]=t;return new Wf(n,o)}case Ff:{const[i,n,o]=t;return new Vf(n,o)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${r}`)}}}const ab=Math.pow(2,31)-1;class ub{counter;constructor(){this.counter=1}getNext(){const t=this.counter;return this.counter+=1,this.counter>ab&&(this.counter=1),t}}var uo={},lo={},vd;function lb(){return vd||(vd=1,Object.defineProperty(lo,"__esModule",{value:!0})),lo}var gr={},yr={},it={},wd;function Ns(){return wd||(wd=1,Object.defineProperty(it,"__esModule",{value:!0}),it.hasBuffer=it.alphabet=void 0,it.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it.hasBuffer=typeof ge.Buffer=="function"&&typeof ge.Buffer.from=="function"),it}var vr={},wr={},_d;function db(){if(_d)return wr;_d=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.flatstr=void 0;const e=t=>t;return wr.flatstr=e,wr}var Sd;function fb(){if(Sd)return vr;Sd=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.createToBase64=void 0;const e=db(),t=Ns(),r=(i=t.alphabet,n="=")=>{if(i.length!==64)throw new Error("chars must be 64 characters long");const o=i.split(""),s=[];for(const l of o)for(const u of o){const d=(0,e.flatstr)(l+u);s.push(d)}const a=n,c=(0,e.flatstr)(n+n);return(l,u)=>{let d="";const h=u%3,f=u-h;for(let g=0;g<f;g+=3){const y=l[g],w=l[g+1],_=l[g+2],m=y<<4|w>>4,b=(w&15)<<8|_;d+=s[m]+s[b]}if(!h)return d;if(h===1){const g=l[f];d+=s[g<<4]+c}else{const g=l[f],y=l[f+1],w=g<<4|y>>4,_=(y&15)<<2;d+=s[w]+o[_]+a}return d}};return vr.createToBase64=r,vr}var Ed;function $f(){if(Ed)return yr;Ed=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.toBase64=void 0;const e=Ns(),r=(0,fb().createToBase64)();return yr.toBase64=e.hasBuffer?i=>{const n=i.length;return n<=48?r(i,n):ge.Buffer.from(i).toString("base64")}:i=>r(i,i.length),yr}var Cd;function hb(){if(Cd)return gr;Cd=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.encode=void 0;const t=z.__importStar(pt()),r=$(),i=$f(),n=(a,c)=>{const l=c.sid;return l===a?c.time:[l,c.time]},o=(a,c)=>{const l=n(a,c);return Array.isArray(l)?(l.push(c.span),l):[l,c.span]},s=a=>{const c=a.getId();if(!c)throw new Error("PATCH_EMPTY");const l=c.sid,u=c.time,d=l===1?[u]:[[l,u]],h=a.meta;h!==void 0&&d.push(h);const f=[d];for(const g of a.ops)if(g instanceof t.NewConOp){const y=g.val;y instanceof r.Timestamp?f.push([0,n(l,y),!0]):y===void 0?f.push([0]):f.push([0,y])}else if(g instanceof t.NewValOp)f.push([1]);else if(g instanceof t.NewObjOp)f.push([2]);else if(g instanceof t.NewVecOp)f.push([3]);else if(g instanceof t.NewStrOp)f.push([4]);else if(g instanceof t.NewBinOp)f.push([5]);else if(g instanceof t.NewArrOp)f.push([6]);else if(g instanceof t.InsValOp)f.push([9,n(l,g.obj),n(l,g.val)]);else if(g instanceof t.InsObjOp){const y=[];for(const[_,m]of g.data)y.push([_,n(l,m)]);const w=[10,n(l,g.obj),y];f.push(w)}else if(g instanceof t.InsVecOp){const y=[];for(const[_,m]of g.data)y.push([_,n(l,m)]);const w=[11,n(l,g.obj),y];f.push(w)}else if(g instanceof t.InsStrOp){const y=[12,n(l,g.obj),n(l,g.ref),g.data];f.push(y)}else if(g instanceof t.InsBinOp){const y=[13,n(l,g.obj),n(l,g.ref),(0,i.toBase64)(g.data)];f.push(y)}else if(g instanceof t.InsArrOp){const y=[];for(const _ of g.data)y.push(n(l,_));const w=[14,n(l,g.obj),n(l,g.ref),y];f.push(w)}else if(g instanceof t.UpdArrOp){const y=[15,n(l,g.obj),n(l,g.ref),n(l,g.val)];f.push(y)}else if(g instanceof t.DelOp){const y=[16,n(l,g.obj),g.what.map(w=>o(l,w))];f.push(y)}else if(g instanceof t.NopOp){const y=[17],w=g.len;w>1&&y.push(w),f.push(y)}return f};return gr.encode=s,gr}var _r={},Sr={},Er={},Od;function pb(){if(Od)return Er;Od=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.bufferToUint8Array=void 0;const e=t=>new Uint8Array(t.buffer,t.byteOffset,t.length);return Er.bufferToUint8Array=e,Er}var Cr={},Ad;function mb(){if(Ad)return Cr;Ad=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.createFromBase64=void 0;const e=Ns(),t="=",r=(i=e.alphabet,n=!1)=>{if(i.length!==64)throw new Error("chars must be 64 characters long");let o=0;for(let a=0;a<i.length;a++)o=Math.max(o,i.charCodeAt(a));const s=[];for(let a=0;a<=o;a+=1)s[a]=-1;for(let a=0;a<i.length;a++)s[i.charCodeAt(a)]=a;return a=>{if(!a)return new Uint8Array(0);let c=a.length;if(n){const y=c%4;y===2?(a+="==",c+=2):y===3&&(a+="=",c+=1)}if(c%4!==0)throw new Error("Base64 string length must be a multiple of 4");const l=a[c-1]!==t?c:c-4;let u=(c>>2)*3,d=0;a[c-2]===t?(d=2,u-=2):a[c-1]===t&&(d=1,u-=1);const h=new Uint8Array(u);let f=0,g=0;for(;g<l;g+=4){const y=s[a.charCodeAt(g)],w=s[a.charCodeAt(g+1)],_=s[a.charCodeAt(g+2)],m=s[a.charCodeAt(g+3)];if(y<0||w<0||_<0||m<0)throw new Error("INVALID_BASE64_STRING");h[f]=y<<2|w>>4,h[f+1]=w<<4|_>>2,h[f+2]=_<<6|m,f+=3}if(d===2){const y=s[a.charCodeAt(l)],w=s[a.charCodeAt(l+1)];if(y<0||w<0)throw new Error("INVALID_BASE64_STRING");h[f]=y<<2|w>>4}else if(d===1){const y=s[a.charCodeAt(l)],w=s[a.charCodeAt(l+1)],_=s[a.charCodeAt(l+2)];if(y<0||w<0||_<0)throw new Error("INVALID_BASE64_STRING");h[f]=y<<2|w>>4,h[f+1]=w<<4|_>>2}return h}};return Cr.createFromBase64=r,Cr}var Nd;function bb(){if(Nd)return Sr;Nd=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.fromBase64=void 0;const e=pb(),t=Ns(),r=mb(),i=t.hasBuffer?o=>(0,e.bufferToUint8Array)(ge.Buffer.from(o,"base64")):null,n=(0,r.createFromBase64)();return Sr.fromBase64=i?o=>o.length>48?i(o):n(o):n,Sr}var Id;function gb(){if(Id)return _r;Id=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.decode=void 0;const e=bb(),t=$(),r=Ss(),i=(s,a)=>Array.isArray(a)?new t.Timestamp(a[0],a[1]):new t.Timestamp(s,a),n=(s,a)=>a.length===3?new t.Timespan(a[0],a[1],a[2]):new t.Timespan(s,a[0],a[1]),o=s=>{const a=s[0],c=a[0],l=Array.isArray(c)?new t.ClockVector(c[0],c[1]):new t.ServerClockVector(1,c),u=l.sid;l.time;const d=new r.PatchBuilder(l),h=s.length;for(let g=1;g<h;g++){const y=s[g];switch(y[0]){case 0:{const[,w,_]=y;d.con(_?i(u,w):w);break}case 1:{d.val();break}case 2:{d.obj();break}case 3:{d.vec();break}case 4:{d.str();break}case 5:{d.bin();break}case 6:{d.arr();break}case 9:{d.setVal(i(u,y[1]),i(u,y[2]));break}case 10:{const w=i(u,y[1]),_=[],m=y[2],b=m.length;for(let p=0;p<b;p++){const[v,S]=m[p];_.push([v,i(u,S)])}d.insObj(w,_);break}case 11:{const w=i(u,y[1]),_=[],m=y[2],b=m.length;for(let p=0;p<b;p++){const[v,S]=m[p];_.push([v,i(u,S)])}d.insVec(w,_);break}case 12:{d.insStr(i(u,y[1]),i(u,y[2]),y[3]);break}case 13:{d.insBin(i(u,y[1]),i(u,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const w=i(u,y[1]),_=i(u,y[2]),m=y[3],b=[],p=m.length;for(let v=0;v<p;v++)b.push(i(u,m[v]));d.insArr(w,_,b);break}case 15:{const w=i(u,y[1]),_=i(u,y[2]),m=i(u,y[3]);d.updArr(w,_,m);break}case 16:{const w=i(u,y[1]),_=y[2],m=[],b=_.length;for(let p=0;p<b;p++)m.push(n(u,_[p]));d.del(w,m);break}case 17:{d.nop(y[1]||1);break}}}const f=d.patch;return f.meta=a[1],f};return _r.decode=o,_r}var kd;function yb(){return kd||(kd=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(lb(),e),t.__exportStar(hb(),e),t.__exportStar(gb(),e)})(uo)),uo}var Qo=yb();function Rd(e){return new TextEncoder().encode(JSON.stringify(e)).length}function vb(e){const t=Qo.decode(e),r=t.getId(),i=t.span();return[[r?.sid,r.time+i]]}function wb(e,t){if(!e.ops||e.ops.length===0)return[];const r=Qo.encode(e),i=Rd(r);if(i<=t)return[r];if(e.ops.length==1)return console.warn(`Patch is too large (${i} B) but cannot be split further since it only contains one operation.`),[r];const n=r[0],o=[];let s=[n];for(let a=1;a<r.length;a+=1){const c=s.length-1;Rd([...s,r[a]])>t&&c>0&&(o.push(s),s=[vb(s)]),s.push(r[a])}return s.length>1&&o.push(s),o}var _b=Fr(),Or={},Td;function Sb(){if(Td)return Or;Td=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.Encoder=void 0;const t=z.__importStar(je()),r=$f(),i=$();let n=class{encode(s){this.model=s;const a=s.clock;return{time:a.sid===1?a.time:this.cClock(s.clock),root:this.cVal(s.root)}}cClock(s){const a=[],c=s.sid;s.peers.get(c)||a.push([c,s.time]);for(const u of s.peers.values())a.push([u.sid,u.time]);return a}cTs(s){return s.sid===1?s.time:[s.sid,s.time]}cNode(s){if(s instanceof t.ObjNode)return this.cObj(s);if(s instanceof t.ArrNode)return this.cArr(s);if(s instanceof t.StrNode)return this.cStr(s);if(s instanceof t.ValNode)return this.cVal(s);if(s instanceof t.ConNode)return this.cCon(s);if(s instanceof t.BinNode)return this.cBin(s);if(s instanceof t.VecNode)return this.cVec(s);throw new Error("UNKNOWN_NODE")}cObj(s){const a={};return s.nodes((c,l)=>{a[l]=this.cNode(c)}),{type:"obj",id:this.cTs(s.id),map:a}}cVec(s){const a=[],c=s.elements,l=c.length,u=this.model.index;for(let d=0;d<l;d++){const h=c[d];h===void 0?a.push(null):a.push(this.cNode(u.get(h)))}return{type:"vec",id:this.cTs(s.id),map:a}}cArr(s){const a=[],c=s.iterator();let l;for(;l=c();)a.push(this.cArrChunk(l));return{type:"arr",id:this.cTs(s.id),chunks:a}}cArrChunk(s){if(s.del)return{id:this.cTs(s.id),span:s.span};const a=this.model.index;return{id:this.cTs(s.id),value:s.data.map(l=>this.cNode(a.get(l)))}}cStr(s){const a=[],c=s.iterator();let l;for(;l=c();)a.push(this.cStrChunk(l));return{type:"str",id:this.cTs(s.id),chunks:a}}cStrChunk(s){return s.del?{id:this.cTs(s.id),span:s.span}:{id:this.cTs(s.id),value:s.data}}cBin(s){const a=[],c=s.iterator();let l;for(;l=c();)a.push(this.cBinChunk(l));return{type:"bin",id:this.cTs(s.id),chunks:a}}cBinChunk(s){return s.del?{id:this.cTs(s.id),span:s.span}:{id:this.cTs(s.id),value:(0,r.toBase64)(s.data)}}cVal(s){return{type:"val",id:this.cTs(s.id),value:this.cNode(s.node())}}cCon(s){const a={type:"con",id:this.cTs(s.id)},c=s.val;return c instanceof i.Timestamp?(a.timestamp=!0,a.value=this.cTs(c)):c!==void 0&&(a.value=c),a}};return Or.Encoder=n,Or}var Eb=Sb(),Ar={},ot={},xd;function Cb(){if(xd)return ot;xd=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.ClockTable=ot.ClockTableEntry=void 0;const e=$();class t{constructor(n,o){this.index=n,this.id=o}}ot.ClockTableEntry=t;let r=class To{constructor(){this.bySid=new Map,this.byIdx=[]}static from(n){const o=new To;return o.push(new e.Timestamp(n.sid,n.time-1)),n.peers.forEach(s=>o.push(s)),o}static decode(n){const o=new To,s=n.vu57();o.push(new e.Timestamp(n.vu57(),n.vu57()));for(let a=1;a<s;a++)o.push(new e.Timestamp(n.vu57(),n.vu57()));return o}parseField(n){const o=n.indexOf("_"),s=Number.parseInt(n.slice(0,o),36),a=Number.parseInt(n.slice(o+1),36),c=this.byIdx[s];return new e.Timestamp(c.sid,a)}push(n){const o=this.byIdx,s=o.length;o.push(n),this.bySid.set(n.sid,new t(s,n))}getBySid(n){const o=this.bySid.get(n);if(!o)throw new Error("CLOCK_NOT_FOUND");return o}write(n){const o=this.byIdx,s=o.length;n.vu57(s);for(let a=0;a<s;a++){const c=o[a];n.vu57(c.sid),n.vu57(c.time)}}};return ot.ClockTable=r,ot}var jd;function Ob(){if(jd)return Ar;jd=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.Decoder=void 0;const t=z.__importStar(je()),r=Cb(),i=zo(),n=$(),o=As(),s=Ko(),a=$o();let c=class{constructor(u){this.decodeStrChunk=()=>{const d=this.dec;d.reader;const h=this.ts(),f=d.val();return typeof f=="string"?new t.StrChunk(h,f.length,f):new t.StrChunk(h,~~f,"")},this.decodeBinChunk=()=>{const d=this.ts(),h=this.dec.reader,[f,g]=h.b1vu56();return f?new t.BinChunk(d,g,void 0):new t.BinChunk(d,g,h.buf(g))},this.decodeArrChunk=()=>{const d=this.ts(),h=this.dec.reader,[f,g]=h.b1vu56();if(f)return new t.ArrChunk(d,g,void 0);{const y=[];for(let w=0;w<g;w++)y.push(this.ts());return new t.ArrChunk(d,g,y)}},this.dec=new s.CborDecoderBase(u||new i.CrdtReader)}decode(u,d=o.Model){const h=this.dec.reader;h.reset(u.c);const f=this.clockTable=r.ClockTable.decode(h);return this.decodeFields(f,u,d)}decodeFields(u,d,h=o.Model){const f=this.dec.reader,g=u.byIdx[0],y=new n.ClockVector(g.sid,g.time+1),w=this.doc=new h(y),_=d.r;if(_&&_.length){f.reset(_);const v=this.ts();w.root.set(v)}const m=w.index,b=Object.keys(d),p=b.length;for(let v=0;v<p;v++){const S=b[v];if(S.length<3)continue;const E=d[S],O=u.parseField(S);f.reset(E);const A=this.decodeNode(O);m.set(O,A)}return w}ts(){const[u,d]=this.dec.reader.id();return new n.Timestamp(this.clockTable.byIdx[u].sid,d)}decodeNode(u){const d=this.dec.reader,h=d.u8(),f=h>>5,g=h&31,y=g<24?g:g===24?d.u8():g===25?d.u16():d.u32();switch(f){case a.CRDT_MAJOR.CON:return this.decodeCon(u,y);case a.CRDT_MAJOR.VAL:return this.decodeVal(u);case a.CRDT_MAJOR.OBJ:return this.decodeObj(u,y);case a.CRDT_MAJOR.VEC:return this.decodeVec(u,y);case a.CRDT_MAJOR.STR:return this.decodeStr(u,y);case a.CRDT_MAJOR.BIN:return this.decodeBin(u,y);case a.CRDT_MAJOR.ARR:return this.decodeArr(u,y)}return o.UNDEFINED}decodeCon(u,d){const h=this.dec,f=d?this.ts():h.val();return new t.ConNode(u,f)}decodeVal(u){const d=this.ts();return new t.ValNode(this.doc,u,d)}decodeObj(u,d){const h=this.dec,f=new t.ObjNode(this.doc,u),g=f.keys;for(let y=0;y<d;y++){const w=h.val()+"",_=this.ts();g.set(w,_)}return f}decodeVec(u,d){const h=this.dec.reader,f=new t.VecNode(this.doc,u),g=f.elements;for(let y=0;y<d;y++)h.u8()?g.push(this.ts()):g.push(void 0);return f}decodeStr(u,d){const h=new t.StrNode(u);return h.ingest(d,this.decodeStrChunk),h}decodeBin(u,d){const h=new t.BinNode(u);return h.ingest(d,this.decodeBinChunk),h}decodeArr(u,d){const h=new t.ArrNode(this.doc,u);return h.ingest(d,this.decodeArrChunk),h}};return Ar.Decoder=c,Ar}var Ab=Ob();const P={POS_INT:0,NEG_INT:1,BYTE_STRING:2,UTF8_STRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE_FLOAT:7},W={DATE_STRING:0,DATE_EPOCH:1,POS_BIGINT:2,NEG_BIGINT:3,CBOR:24,URI:32,BASE64URL:33,BASE64:34,DATE_EPOCH_DAYS:100,SET:258,JSON:262,WTF8:273,DATE_FULL:1004,REGEXP:21066,SELF_DESCRIBED:55799,INVALID_16:65535,INVALID_32:4294967295,INVALID_64:0xffffffffffffffffn},G={ZERO:0,ONE:24,TWO:25,FOUR:26,EIGHT:27,INDEFINITE:31},Ue={FALSE:20,TRUE:21,NULL:22,UNDEFINED:23};let ae=class{static BREAK=Symbol.for("github.com/hildjj/cbor2/break");static ENCODED=Symbol.for("github.com/hildjj/cbor2/cbor-encoded");static LENGTH=Symbol.for("github.com/hildjj/cbor2/length")};const as={MIN:-(2n**63n),MAX:2n**64n-1n};let J=class os{static#e=new Map;tag;contents;constructor(t,r=void 0){this.tag=t,this.contents=r}get noChildren(){return!!os.#e.get(this.tag)?.noChildren}static registerDecoder(t,r,i){const n=this.#e.get(t);return this.#e.set(t,r),n&&("comment"in r||(r.comment=n.comment),"noChildren"in r||(r.noChildren=n.noChildren)),i&&!r.comment&&(r.comment=()=>`(${i})`),n}static clearDecoder(t){const r=this.#e.get(t);return this.#e.delete(t),r}static getDecoder(t){return this.#e.get(t)}static getAllDecoders(){return new Map(this.#e)}*[Symbol.iterator](){yield this.contents}push(t){return this.contents=t,1}decode(t){const r=t?.tags?.get(this.tag)??(t?.ignoreGlobalTags?void 0:os.#e.get(this.tag));return r?r(this,t):this}comment(t,r){const i=t?.tags?.get(this.tag)??(t?.ignoreGlobalTags?void 0:os.#e.get(this.tag));if(i?.comment)return i.comment(this,t,r)}toCBOR(){return[this.tag,this.contents]}[Symbol.for("nodejs.util.inspect.custom")](t,r,i){return`${this.tag}(${i(this.contents,r)})`}};function us(e){if(e!=null&&typeof e=="object")return e[ae.ENCODED]}function Nb(e){if(e!=null&&typeof e=="object")return e[ae.LENGTH]}function Pr(e,t){Object.defineProperty(e,ae.ENCODED,{configurable:!0,enumerable:!1,value:t})}function xr(e,t){const r=Object(e);return Pr(r,t),r}const Zo=Symbol("CBOR_RANGES");function Yf(e,t){Object.defineProperty(e,Zo,{configurable:!1,enumerable:!1,writable:!1,value:t})}function ls(e){return e[Zo]}function Ib(e){return ls(e)!==void 0}function xo(e,t=0,r=e.length-1){const i=e.subarray(t,r),n=ls(e);if(n){const o=[];for(const s of n)if(s[0]>=t&&s[0]+s[1]<=r){const a=[...s];a[0]-=t,o.push(a)}o.length&&Yf(i,o)}return i}function Xf(e){let t=Math.ceil(e.length/2);const r=new Uint8Array(t);t--;for(let i=e.length,n=i-2;i>=0;i=n,n-=2,t--)r[t]=parseInt(e.substring(n,i),16);return r}function pe(e){return e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),"")}function kb(e){const t=e.reduce((s,a)=>s+a.length,0),r=e.some(s=>Ib(s)),i=[],n=new Uint8Array(t);let o=0;for(const s of e){if(!(s instanceof Uint8Array))throw new TypeError(`Invalid array: ${s}`);if(n.set(s,o),r){const a=s[Zo]??[[0,s.length]];for(const c of a)c[0]+=o;i.push(...a)}o+=s.length}return r&&Yf(n,i),n}function ec(e){const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0))}const Rb={"-":"+",_:"/"};function Tb(e){const t=e.replace(/[_-]/g,r=>Rb[r]);return ec(t.padEnd(Math.ceil(t.length/4)*4,"="))}function xb(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])}function Pd(e){let t="";for(const r of e){const i=r.codePointAt(0)?.toString(16).padStart(4,"0");t&&(t+=", "),t+=`U+${i}`}return t}class jb{#e=new Map;registerEncoder(t,r){const i=this.#e.get(t);return this.#e.set(t,r),i}get(t){return this.#e.get(t)}delete(t){return this.#e.delete(t)}clear(){this.#e.clear()}}function Qf(e,t){const[r,i,n]=e,[o,s,a]=t,c=Math.min(n.length,a.length);for(let l=0;l<c;l++){const u=n[l]-a[l];if(u!==0)return u}return 0}class Is{static defaultOptions={chunkSize:4096};#e;#t=[];#n=null;#r=0;#s=0;constructor(t={}){if(this.#e={...Is.defaultOptions,...t},this.#e.chunkSize<8)throw new RangeError(`Expected size >= 8, got ${this.#e.chunkSize}`);this.#i()}get length(){return this.#s}read(){this.#a();const t=new Uint8Array(this.#s);let r=0;for(const i of this.#t)t.set(i,r),r+=i.length;return this.#i(),t}write(t){const r=t.length;r>this.#u()?(this.#a(),r>this.#e.chunkSize?(this.#t.push(t),this.#i()):(this.#i(),this.#t[this.#t.length-1].set(t),this.#r=r)):(this.#t[this.#t.length-1].set(t,this.#r),this.#r+=r),this.#s+=r}writeUint8(t){this.#o(1),this.#n.setUint8(this.#r,t),this.#c(1)}writeUint16(t,r=!1){this.#o(2),this.#n.setUint16(this.#r,t,r),this.#c(2)}writeUint32(t,r=!1){this.#o(4),this.#n.setUint32(this.#r,t,r),this.#c(4)}writeBigUint64(t,r=!1){this.#o(8),this.#n.setBigUint64(this.#r,t,r),this.#c(8)}writeInt16(t,r=!1){this.#o(2),this.#n.setInt16(this.#r,t,r),this.#c(2)}writeInt32(t,r=!1){this.#o(4),this.#n.setInt32(this.#r,t,r),this.#c(4)}writeBigInt64(t,r=!1){this.#o(8),this.#n.setBigInt64(this.#r,t,r),this.#c(8)}writeFloat32(t,r=!1){this.#o(4),this.#n.setFloat32(this.#r,t,r),this.#c(4)}writeFloat64(t,r=!1){this.#o(8),this.#n.setFloat64(this.#r,t,r),this.#c(8)}clear(){this.#s=0,this.#t=[],this.#i()}#i(){const t=new Uint8Array(this.#e.chunkSize);this.#t.push(t),this.#r=0,this.#n=new DataView(t.buffer,t.byteOffset,t.byteLength)}#a(){if(this.#r===0){this.#t.pop();return}const t=this.#t.length-1;this.#t[t]=this.#t[t].subarray(0,this.#r),this.#r=0,this.#n=null}#u(){const t=this.#t.length-1;return this.#t[t].length-this.#r}#o(t){this.#u()<t&&(this.#a(),this.#i())}#c(t){this.#r+=t,this.#s+=t}}const fo=1n<<15n,Nr=0b11111n<<10n,Zf=1n<<9n,eh=Zf-1n,Md=Zf|eh,ho=1n<<31n,Ir=0b11111111n<<23n,th=1n<<22n,nh=th-1n,Dd=th|nh,ts=1n<<63n,Re=0b11111111111n<<52n,jr=1n<<51n,ks=jr-1n,Bd=jr|ks,qd=ks-(eh<<42n),Ld=ks-(nh<<29n),Pb={2:"0b",8:"0o",16:"0x"};var Mb=(e=>(e[e.NATURAL=-2]="NATURAL",e[e.UNKNOWN=-1]="UNKNOWN",e[e.F16=2]="F16",e[e.F32=4]="F32",e[e.F64=8]="F64",e))(Mb||{});function Ud(e,t,r,i){let n="nan'";return e.quiet||(n+="!"),e.sign===-1&&(n+="-"),n+=i(Math.abs(e.payload),r),n+="'",n+=e.encodingIndicator,n}let Db=class extends Number{#e;#t=-1;constructor(t,r=!0,i=-1){super(NaN);const n=t;if(typeof t=="number"){if(!Number.isSafeInteger(t))throw new Error(`Invalid NAN payload: ${t}`);t=BigInt(t);let o=0n;if(t<0&&(o=ts,t=-t),t>=jr)throw new Error(`Payload too large: ${n}`);const s=r?jr:0n;switch(this.#e=o|Re|s|t,i){case-2:throw new Error("NAN_SIZE.NATURAL only valid for bigint constructor");case-1:i=this.preferredSize;break;case 2:if(this.#e&qd)throw new Error("Invalid size for payload");break;case 4:if(this.#e&Ld)throw new Error("Invalid size for payload");break;case 8:break;default:throw new Error(`Invalid size: ${i}`)}this.#t=i}else if(typeof t=="bigint"){let o=-1;if((t&Re)===Re)this.#e=t,o=8;else if((t&Ir)===Ir){const s=(t&ho)<<32n;this.#e=s|Re|(t&Dd)<<29n,o=4}else if((t&Nr)===Nr){const s=(t&fo)<<48n;this.#e=s|Re|(t&Md)<<42n,o=2}else throw new Error(`Invalid raw NaN value: ${t}`);if(i===-1)this.#t=this.preferredSize;else if(i===-2)this.#t=o;else{if(i<o)throw new Error("Invalid bigint NaN size");this.#t=i}}else{const o=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.length){case 3:{if(t[0]!==249)throw new Error("Invalid CBOR encoding for half float");const s=BigInt(o.getUint16(1,!1));if((s&Nr)!==Nr)throw new Error("Not a NaN");const a=(s&fo)<<48n;this.#e=a|Re|(s&Md)<<42n,this.#t=2;break}case 5:{if(t[0]!==250)throw new Error("Invalid CBOR encoding for single float");const s=BigInt(o.getUint32(1,!1));if((s&Ir)!==Ir)throw new Error("Not a NaN");const a=(s&ho)<<32n;this.#e=a|Re|(s&Dd)<<29n,this.#t=4;break}case 9:{if(t[0]!==251)throw new Error("Invalid CBOR encoding for double float");if(this.#e=o.getBigUint64(1,!1),(this.#e&Re)!==Re)throw new Error("Not a NaN (NaNaN)");this.#t=8;break}default:throw new RangeError(`Invalid NAN size (should be 2, 4, or 8): ${t.length-1}`)}}if(!this.payload&&!this.quiet)throw new Error("Signalling NaN with zero payload")}get bytes(){const t=new ArrayBuffer(this.#t+1),r=new DataView(t);switch(this.#t){case 2:{r.setUint8(0,249);const i=(this.#e&ts?fo:0n)|Nr|(this.#e&Bd)>>42n;r.setUint16(1,Number(i),!1);break}case 4:{r.setUint8(0,250);const i=(this.#e&ts?ho:0n)|Ir|(this.#e&Bd)>>29n;r.setUint32(1,Number(i),!1);break}case 8:r.setUint8(0,251),r.setBigUint64(1,this.#e);break}return new Uint8Array(t)}get quiet(){return!!(this.#e&jr)}get sign(){return this.#e&ts?-1:1}get payload(){return Number(this.#e&ks)*this.sign}get raw(){return this.#e}get encodingIndicator(){switch(this.#t){case 2:return"_1";case 4:return"_2"}return"_3"}get size(){return this.#t}get preferredSize(){return(this.#e&qd)===0n?2:(this.#e&Ld)===0n?4:8}get isShortestEncoding(){return this.preferredSize===this.#t}toCBOR(t){t.write(this.bytes)}toString(t=10){return Ud(this,1,{},r=>(Pb[t]??"")+r.toString(t))}[Symbol.for("nodejs.util.inspect.custom")](t,r,i){return Ud(this,t,r,i)}};function rh(e,t=0,r=!1){const i=e[t]&128?-1:1,n=(e[t]&124)>>2,o=(e[t]&3)<<8|e[t+1];if(n===0){if(r&&o!==0)throw new Error(`Unwanted subnormal: ${i*5960464477539063e-23*o}`);return i*5960464477539063e-23*o}else if(n===31)return o?NaN:i*(1/0);return i*2**(n-25)*(1024+o)}function sh(e){const t=new DataView(new ArrayBuffer(4));t.setFloat32(0,e,!1);const r=t.getUint32(0,!1);if((r&8191)!==0)return null;let i=r>>16&32768;const n=r>>23&255,o=r&8388607;if(!(n===0&&o===0))if(n>=113&&n<=142)i+=(n-112<<10)+(o>>13);else if(n>=103&&n<113){if(o&(1<<126-n)-1)return null;i+=o+8388608>>126-n}else if(n===255)i|=31744,i|=o>>13;else return null;return i}function Bb(e){if(e!==0){const t=new ArrayBuffer(8),r=new DataView(t);r.setFloat64(0,e,!1);const i=r.getBigUint64(0,!1);if((i&0x7ff0000000000000n)===0n)return i&0x8000000000000000n?-0:0}return e}function qb(e){switch(e.length){case 2:rh(e,0,!0);break;case 4:{const t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getUint32(0,!1);if((r&2139095040)===0&&r&8388607)throw new Error(`Unwanted subnormal: ${t.getFloat32(0,!1)}`);break}case 8:{const t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getBigUint64(0,!1);if((r&0x7ff0000000000000n)===0n&&r&0x000fffffffffffn)throw new Error(`Unwanted subnormal: ${t.getFloat64(0,!1)}`);break}default:throw new TypeError(`Bad input to isSubnormal: ${e}`)}}class Lb extends TypeError{code="ERR_ENCODING_INVALID_ENCODED_DATA";constructor(){super("The encoded data was not valid for encoding wtf-8")}}class Ub extends RangeError{code="ERR_ENCODING_NOT_SUPPORTED";constructor(t){super(`Invalid encoding: "${t}"`)}}const Fb=65279,ih=new Uint8Array(0),Vb=55296,Jb=56320,Gb=65533,oh="wtf-8";function zb(e){return e&&!(e instanceof ArrayBuffer)&&e.buffer instanceof ArrayBuffer}function Hb(e){return e?e instanceof Uint8Array?e:zb(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e):ih}const Wb=[0,0,0,0,0,0,0,0,-1,-1,-1,-1,1,1,2,3];class Rs{static DEFAULT_BUFFERSIZE=4096;encoding=oh;fatal;ignoreBOM;bufferSize;#e=0;#t=0;#n=0;#r=!0;#s;constructor(t="wtf8",r=void 0){if(t.toLowerCase().replace("-","")!=="wtf8")throw new Ub(t);if(this.fatal=!!r?.fatal,this.ignoreBOM=!!r?.ignoreBOM,this.bufferSize=Math.floor(r?.bufferSize??Rs.DEFAULT_BUFFERSIZE),isNaN(this.bufferSize)||this.bufferSize<1)throw new RangeError(`Invalid buffer size: ${r?.bufferSize}`);this.#s=new Uint16Array(this.bufferSize)}decode(t,r){const i=!!r?.stream,n=Hb(t),o=[],s=this.#s,a=this.bufferSize-3;let c=0;const l=()=>{if(this.#t=0,this.#e=0,this.#n=0,this.fatal)throw new Lb;s[c++]=Gb},u=()=>{const h=this.#n;for(let f=0;f<h;f++)l()},d=h=>{if(this.#e===0)switch(Wb[h>>4]){case-1:l();break;case 0:s[c++]=h;break;case 1:this.#t=h&31,(this.#t&30)===0?l():(this.#e=1,this.#n=1);break;case 2:this.#t=h&15,this.#e=2,this.#n=1;break;case 3:h&8?l():(this.#t=h&7,this.#e=3,this.#n=1);break}else{if((h&192)!==128||this.#n===1&&this.#e===2&&this.#t===0&&(h&32)===0||this.#e===3&&this.#t===0&&(h&48)===0)return u(),d(h);if(this.#t=this.#t<<6|h&63,this.#n++,--this.#e===0){if(this.ignoreBOM||!this.#r||this.#t!==Fb)if(this.#t<65536)s[c++]=this.#t;else{const f=this.#t-65536;s[c++]=f>>>10&1023|Vb,s[c++]=f&1023|Jb}this.#t=0,this.#n=0,this.#r=!1}}};for(const h of n)c>=a&&(o.push(String.fromCharCode.apply(null,s.subarray(0,c))),c=0),d(h);return i||(this.#r=!0,(this.#t||this.#e)&&u()),c>0&&o.push(String.fromCharCode.apply(null,s.subarray(0,c))),o.join("")}}function Kb(e){let t=0;for(const r of e){const i=r.codePointAt(0);i<128?t++:i<2048?t+=2:i<65536?t+=3:t+=4}return t}class $b{encoding=oh;encode(t){if(!t)return ih;const r=new Uint8Array(Kb(String(t)));return this.encodeInto(t,r),r}encodeInto(t,r){const i=String(t),n=i.length,o=r.length;let s=0,a=0;for(a=0;a<n;a++){const c=i.codePointAt(a);if(c<128){if(s>=o)break;r[s++]=c}else if(c<2048){if(s>=o-1)break;r[s++]=192|c>>6,r[s++]=128|c&63}else if(c<65536){if(s>=o-2)break;r[s++]=224|c>>12,r[s++]=128|c>>6&63,r[s++]=128|c&63}else{if(s>=o-3)break;r[s++]=240|c>>18,r[s++]=128|c>>12&63,r[s++]=128|c>>6&63,r[s++]=128|c&63,a++}}return{read:a,written:s}}}const Fd=P.SIMPLE_FLOAT<<5|G.TWO,Yb=P.SIMPLE_FLOAT<<5|G.FOUR,Xb=P.SIMPLE_FLOAT<<5|G.EIGHT,Qb=P.SIMPLE_FLOAT<<5|Ue.TRUE,Zb=P.SIMPLE_FLOAT<<5|Ue.FALSE,eg=P.SIMPLE_FLOAT<<5|Ue.UNDEFINED,tg=P.SIMPLE_FLOAT<<5|Ue.NULL,ng=new TextEncoder,rg=new $b,ch={...Is.defaultOptions,avoidInts:!1,cde:!1,collapseBigInts:!0,dateTag:W.DATE_EPOCH,dcbor:!1,float64:!1,flushToZero:!1,forceEndian:null,ignoreOriginalEncoding:!1,largeNegativeAsBigInt:!1,reduceUnsafeNumbers:!1,rejectBigInts:!1,rejectCustomSimples:!1,rejectDuplicateKeys:!1,rejectFloats:!1,rejectUndefined:!1,simplifyNegativeZero:!1,sortKeys:null,stringNormalization:null,types:null,wtf8:!1,ignoreGlobalTags:!1},ah={cde:!0,ignoreOriginalEncoding:!0,sortKeys:Qf},sg={...ah,dcbor:!0,largeNegativeAsBigInt:!0,reduceUnsafeNumbers:!0,rejectCustomSimples:!0,rejectDuplicateKeys:!0,rejectUndefined:!0,simplifyNegativeZero:!0,stringNormalization:"NFC"};function uh(e){const t=e<0;return typeof e=="bigint"?[t?-e-1n:e,t]:[t?-e-1:e,t]}function po(e,t,r){if(r.rejectFloats)throw new Error(`Attempt to encode an unwanted floating point number: ${e}`);if(isNaN(e))t.writeUint8(Fd),t.writeUint16(32256);else if(!r.float64&&Math.fround(e)===e){const i=sh(e);i===null?(t.writeUint8(Yb),t.writeFloat32(e)):(t.writeUint8(Fd),t.writeUint16(i))}else t.writeUint8(Xb),t.writeFloat64(e)}function ye(e,t,r){const[i,n]=uh(e);if(n&&r)throw new TypeError(`Negative size: ${e}`);r??=n?P.NEG_INT:P.POS_INT,r<<=5,i<24?t.writeUint8(r|i):i<=255?(t.writeUint8(r|G.ONE),t.writeUint8(i)):i<=65535?(t.writeUint8(r|G.TWO),t.writeUint16(i)):i<=4294967295?(t.writeUint8(r|G.FOUR),t.writeUint32(i)):(t.writeUint8(r|G.EIGHT),t.writeBigUint64(BigInt(i)))}function Mr(e,t,r){typeof e=="number"?ye(e,t,P.TAG):typeof e=="object"&&!r.ignoreOriginalEncoding&&ae.ENCODED in e?t.write(e[ae.ENCODED]):e<=Number.MAX_SAFE_INTEGER?ye(Number(e),t,P.TAG):(t.writeUint8(P.TAG<<5|G.EIGHT),t.writeBigUint64(BigInt(e)))}function lh(e,t,r){const[i,n]=uh(e);if(r.collapseBigInts&&(!r.largeNegativeAsBigInt||e>=-0x8000000000000000n)){if(i<=0xffffffffn){ye(Number(e),t);return}if(i<=0xffffffffffffffffn){const l=(n?P.NEG_INT:P.POS_INT)<<5;t.writeUint8(l|G.EIGHT),t.writeBigUint64(i);return}}if(r.rejectBigInts)throw new Error(`Attempt to encode unwanted bigint: ${e}`);const o=n?W.NEG_BIGINT:W.POS_BIGINT,s=i.toString(16),a=s.length%2?"0":"";Mr(o,t,r);const c=Xf(a+s);ye(c.length,t,P.BYTE_STRING),t.write(c)}function ig(e,t,r){r.flushToZero&&(e=Bb(e)),Object.is(e,-0)?r.simplifyNegativeZero?r.avoidInts?po(0,t,r):ye(0,t):po(e,t,r):!r.avoidInts&&Number.isSafeInteger(e)?ye(e,t):r.reduceUnsafeNumbers&&Math.floor(e)===e&&e>=as.MIN&&e<=as.MAX?lh(BigInt(e),t,r):po(e,t,r)}function og(e,t,r){const i=r.stringNormalization?e.normalize(r.stringNormalization):e;if(r.wtf8&&!e.isWellFormed()){const n=rg.encode(i);Mr(W.WTF8,t,r),ye(n.length,t,P.BYTE_STRING),t.write(n)}else{const n=ng.encode(i);ye(n.length,t,P.UTF8_STRING),t.write(n)}}function cg(e,t,r){const i=e;tc(i,i.length,P.ARRAY,t,r);for(const n of i)at(n,t,r)}function ag(e,t){ye(e.length,t,P.BYTE_STRING),t.write(e)}const ds=new jb;ds.registerEncoder(Array,cg),ds.registerEncoder(Uint8Array,ag);function Z(e,t){return ds.registerEncoder(e,t)}function tc(e,t,r,i,n){const o=Nb(e);o&&!n.ignoreOriginalEncoding?i.write(o):ye(t,i,r)}function ug(e,t,r){if(e===null){t.writeUint8(tg);return}if(!r.ignoreOriginalEncoding&&ae.ENCODED in e){t.write(e[ae.ENCODED]);return}const i=e.constructor;if(i){const o=r.types?.get(i)??(r.ignoreGlobalTags?void 0:ds.get(i));if(o){const s=o(e,t,r);if(s!==void 0){if(!Array.isArray(s)||s.length!==2)throw new Error("Invalid encoder return value");(typeof s[0]=="bigint"||isFinite(Number(s[0])))&&Mr(s[0],t,r),at(s[1],t,r)}return}}if(typeof e.toCBOR=="function"){const o=e.toCBOR(t,r);o&&((typeof o[0]=="bigint"||isFinite(Number(o[0])))&&Mr(o[0],t,r),at(o[1],t,r));return}if(typeof e.toJSON=="function"){at(e.toJSON(),t,r);return}const n=Object.entries(e).map(o=>[o[0],o[1],Dr(o[0],r)]);r.sortKeys&&n.sort(r.sortKeys),tc(e,n.length,P.MAP,t,r);for(const[o,s,a]of n)t.write(a),at(s,t,r)}function at(e,t,r){switch(typeof e){case"number":ig(e,t,r);break;case"bigint":lh(e,t,r);break;case"string":og(e,t,r);break;case"boolean":t.writeUint8(e?Qb:Zb);break;case"undefined":if(r.rejectUndefined)throw new Error("Attempt to encode unwanted undefined.");t.writeUint8(eg);break;case"object":ug(e,t,r);break;case"symbol":throw new TypeError(`Unknown symbol: ${e.toString()}`);default:throw new TypeError(`Unknown type: ${typeof e}, ${String(e)}`)}}function Dr(e,t={}){const r={...ch};t.dcbor?Object.assign(r,sg):t.cde&&Object.assign(r,ah),Object.assign(r,t);const i=new Is(r);return at(e,i,r),i.read()}var fs=(e=>(e[e.NEVER=-1]="NEVER",e[e.PREFERRED=0]="PREFERRED",e[e.ALWAYS=1]="ALWAYS",e))(fs||{});class Ne{static KnownSimple=new Map([[Ue.FALSE,!1],[Ue.TRUE,!0],[Ue.NULL,null],[Ue.UNDEFINED,void 0]]);value;constructor(t){this.value=t}static create(t){return Ne.KnownSimple.has(t)?Ne.KnownSimple.get(t):new Ne(t)}toCBOR(t,r){if(r.rejectCustomSimples)throw new Error(`Cannot encode non-standard Simple value: ${this.value}`);ye(this.value,t,P.SIMPLE_FLOAT)}toString(){return`simple(${this.value})`}decode(){return Ne.KnownSimple.has(this.value)?Ne.KnownSimple.get(this.value):this}[Symbol.for("nodejs.util.inspect.custom")](t,r,i){return`simple(${i(this.value,r)})`}}const lg=new TextDecoder("utf8",{fatal:!0,ignoreBOM:!0});let Ts=class dh{static defaultOptions={maxDepth:1024,encoding:"hex",requirePreferred:!1};#e;#t;#n=0;#r;constructor(t,r){if(this.#r={...dh.defaultOptions,...r},typeof t=="string")switch(this.#r.encoding){case"hex":this.#e=Xf(t);break;case"base64":this.#e=ec(t);break;default:throw new TypeError(`Encoding not implemented: "${this.#r.encoding}"`)}else this.#e=t;this.#t=new DataView(this.#e.buffer,this.#e.byteOffset,this.#e.byteLength)}toHere(t){return xo(this.#e,t,this.#n)}*[Symbol.iterator](){if(yield*this.#s(0),this.#n!==this.#e.length)throw new Error("Extra data in input")}*seq(){for(;this.#n<this.#e.length;)yield*this.#s(0)}*#s(t){if(t++>this.#r.maxDepth)throw new Error(`Maximum depth ${this.#r.maxDepth} exceeded`);const r=this.#n,i=this.#t.getUint8(this.#n++),n=i>>5,o=i&31;let s=o,a=!1,c=0;switch(o){case G.ONE:if(c=1,s=this.#t.getUint8(this.#n),n===P.SIMPLE_FLOAT){if(s<32)throw new Error(`Invalid simple encoding in extra byte: ${s}`);a=!0}else if(this.#r.requirePreferred&&s<24)throw new Error(`Unexpectedly long integer encoding (1) for ${s}`);break;case G.TWO:if(c=2,n===P.SIMPLE_FLOAT)s=rh(this.#e,this.#n);else if(s=this.#t.getUint16(this.#n,!1),this.#r.requirePreferred&&s<=255)throw new Error(`Unexpectedly long integer encoding (2) for ${s}`);break;case G.FOUR:if(c=4,n===P.SIMPLE_FLOAT)s=this.#t.getFloat32(this.#n,!1);else if(s=this.#t.getUint32(this.#n,!1),this.#r.requirePreferred&&s<=65535)throw new Error(`Unexpectedly long integer encoding (4) for ${s}`);break;case G.EIGHT:{if(c=8,n===P.SIMPLE_FLOAT)s=this.#t.getFloat64(this.#n,!1);else if(s=this.#t.getBigUint64(this.#n,!1),s<=Number.MAX_SAFE_INTEGER&&(s=Number(s)),this.#r.requirePreferred&&s<=4294967295)throw new Error(`Unexpectedly long integer encoding (8) for ${s}`);break}case 28:case 29:case 30:throw new Error(`Additional info not implemented: ${o}`);case G.INDEFINITE:switch(n){case P.POS_INT:case P.NEG_INT:case P.TAG:throw new Error(`Invalid indefinite encoding for MT ${n}`);case P.SIMPLE_FLOAT:yield[n,o,ae.BREAK,r,0];return}s=1/0;break;default:a=!0}switch(this.#n+=c,n){case P.POS_INT:yield[n,o,s,r,c];break;case P.NEG_INT:yield[n,o,typeof s=="bigint"?-1n-s:-1-Number(s),r,c];break;case P.BYTE_STRING:s===1/0?yield*this.#a(n,t,r):yield[n,o,this.#i(s),r,s];break;case P.UTF8_STRING:s===1/0?yield*this.#a(n,t,r):yield[n,o,lg.decode(this.#i(s)),r,s];break;case P.ARRAY:if(s===1/0)yield*this.#a(n,t,r,!1);else{const l=Number(s);yield[n,o,l,r,c];for(let u=0;u<l;u++)yield*this.#s(t+1)}break;case P.MAP:if(s===1/0)yield*this.#a(n,t,r,!1);else{const l=Number(s);yield[n,o,l,r,c];for(let u=0;u<l;u++)yield*this.#s(t),yield*this.#s(t)}break;case P.TAG:yield[n,o,s,r,c],yield*this.#s(t);break;case P.SIMPLE_FLOAT:{const l=s;a&&(s=Ne.create(Number(s))),yield[n,o,s,r,l];break}}}#i(t){const r=xo(this.#e,this.#n,this.#n+=t);if(r.length!==t)throw new Error(`Unexpected end of stream reading ${t} bytes, got ${r.length}`);return r}*#a(t,r,i,n=!0){for(yield[t,G.INDEFINITE,1/0,i,1/0];;){const o=this.#s(r),s=o.next(),[a,c,l]=s.value;if(l===ae.BREAK){yield s.value,o.next();return}if(n){if(a!==t)throw new Error(`Unmatched major type.  Expected ${t}, got ${a}.`);if(c===G.INDEFINITE)throw new Error("New stream started in typed stream")}yield s.value,yield*o}}};const dg=new Map([[G.ZERO,1],[G.ONE,2],[G.TWO,3],[G.FOUR,5],[G.EIGHT,9]]),fg=new Uint8Array(0);function hg(e,t){return!t.boxed&&!t.preferMap&&e.every(([r])=>typeof r=="string")?Object.fromEntries(e):new Map(e)}let me=class fh{static defaultDecodeOptions={...Ts.defaultOptions,ParentType:fh,boxed:!1,cde:!1,dcbor:!1,diagnosticSizes:fs.PREFERRED,collapseBigInts:!1,convertUnsafeIntsToFloat:!1,createObject:hg,keepNanPayloads:!1,pretty:!1,preferBigInt:!1,preferMap:!1,rejectLargeNegatives:!1,rejectBigInts:!1,rejectDuplicateKeys:!1,rejectFloats:!1,rejectInts:!1,rejectLongLoundNaN:!1,rejectLongFloats:!1,rejectNegativeZero:!1,rejectSimple:!1,rejectStreaming:!1,rejectStringsNotNormalizedAs:null,rejectSubnormals:!1,rejectUndefined:!1,rejectUnsafeFloatInts:!1,saveOriginal:!1,sortKeys:null,tags:null,ignoreGlobalTags:!1};static cdeDecodeOptions={cde:!0,rejectStreaming:!0,requirePreferred:!0,sortKeys:Qf};static dcborDecodeOptions={...this.cdeDecodeOptions,dcbor:!0,convertUnsafeIntsToFloat:!0,rejectDuplicateKeys:!0,rejectLargeNegatives:!0,rejectLongLoundNaN:!0,rejectLongFloats:!0,rejectNegativeZero:!0,rejectSimple:!0,rejectUndefined:!0,rejectUnsafeFloatInts:!0,rejectStringsNotNormalizedAs:"NFC"};parent;mt;ai;left;offset;count=0;children=[];depth=0;#e;#t=null;constructor(t,r,i,n){if([this.mt,this.ai,,this.offset]=t,this.left=r,this.parent=i,this.#e=n,i&&(this.depth=i.depth+1),this.mt===P.MAP&&(this.#e.sortKeys||this.#e.rejectDuplicateKeys)&&(this.#t=[]),this.#e.rejectStreaming&&this.ai===G.INDEFINITE)throw new Error("Streaming not supported")}get isStreaming(){return this.left===1/0}get done(){return this.left===0}static create(t,r,i,n){const[o,s,a,c]=t;switch(o){case P.POS_INT:case P.NEG_INT:{if(i.rejectInts)throw new Error(`Unexpected integer: ${a}`);if(i.rejectLargeNegatives&&a<-0x8000000000000000n)throw new Error(`Invalid 65bit negative number: ${a}`);let l=a;return i.preferBigInt?l=BigInt(l):i.convertUnsafeIntsToFloat&&l>=as.MIN&&l<=as.MAX&&(l=Number(a)),i.boxed?xr(l,n.toHere(c)):l}case P.SIMPLE_FLOAT:if(s>G.ONE){if(typeof a=="symbol")return a;if(i.rejectFloats)throw new Error(`Decoding unwanted floating point number: ${a}`);if(i.rejectNegativeZero&&Object.is(a,-0))throw new Error("Decoding negative zero");if(isNaN(a)){const l=n.toHere(c),u=new Db(l);if(i.rejectLongLoundNaN){if(u.payload||l.length>3)throw new Error(`Invalid NaN encoding: "${pe(l)}"`)}else if(i.keepNanPayloads&&(u.payload||u.sign===-1)){if(i.rejectLongFloats&&!u.isShortestEncoding)throw new Error(`NaN should have been encoded shorter: ${a}`);return u}}if(i.rejectSubnormals&&qb(n.toHere(c+1)),i.rejectLongFloats){const l=Dr(a,{chunkSize:9,reduceUnsafeNumbers:i.rejectUnsafeFloatInts});if(l[0]>>5!==o)throw new Error(`Should have been encoded as int, not float: ${a}`);if(l.length<dg.get(s))throw new Error(`Number should have been encoded shorter: ${a}`)}if(typeof a=="number"&&i.boxed)return xr(a,n.toHere(c))}else{if(i.rejectSimple&&a instanceof Ne)throw new Error(`Invalid simple value: ${a}`);if(i.rejectUndefined&&a===void 0)throw new Error("Unexpected undefined")}return a;case P.BYTE_STRING:case P.UTF8_STRING:if(a===1/0)return new i.ParentType(t,1/0,r,i);if(i.rejectStringsNotNormalizedAs&&typeof a=="string"){const l=a.normalize(i.rejectStringsNotNormalizedAs);if(a!==l)throw new Error(`String not normalized as "${i.rejectStringsNotNormalizedAs}", got [${Pd(a)}] instead of [${Pd(l)}]`)}return i.boxed?xr(a,n.toHere(c)):a;case P.ARRAY:return new i.ParentType(t,a,r,i);case P.MAP:return new i.ParentType(t,a*2,r,i);case P.TAG:{const l=new i.ParentType(t,1,r,i);return l.children=new J(a),l}}throw new TypeError(`Invalid major type: ${o}`)}static decodeToEncodeOpts(t){return{...ch,avoidInts:t.rejectInts,float64:!t.rejectLongFloats,flushToZero:t.rejectSubnormals,largeNegativeAsBigInt:t.rejectLargeNegatives,sortKeys:t.sortKeys}}push(t,r,i){if(this.children.push(t),this.#t){const n=us(t)||r.toHere(i);this.#t.push(n)}return--this.left}replaceLast(t,r,i){let n,o=-1/0;if(this.children instanceof J?(o=0,n=this.children.contents,this.children.contents=t):(o=this.children.length-1,n=this.children[o],this.children[o]=t),this.#t){const s=us(t)||i.toHere(r.offset);this.#t[o]=s}return n}convert(t){let r;switch(this.mt){case P.ARRAY:r=this.children;break;case P.MAP:{const i=this.#n();if(this.#e.sortKeys){let n;for(const o of i){if(n&&this.#e.sortKeys(n,o)>=0)throw new Error(`Duplicate or out of order key: "0x${o[2]}"`);n=o}}else if(this.#e.rejectDuplicateKeys){const n=new Set;for(const[o,s,a]of i){const c=pe(a);if(n.has(c))throw new Error(`Duplicate key: "0x${c}"`);n.add(c)}}r=this.#e.createObject(i,this.#e);break}case P.BYTE_STRING:return kb(this.children);case P.UTF8_STRING:{const i=this.children.join("");r=this.#e.boxed?xr(i,t.toHere(this.offset)):i;break}case P.TAG:r=this.children.decode(this.#e);break;default:throw new TypeError(`Invalid mt on convert: ${this.mt}`)}return this.#e.saveOriginal&&r&&typeof r=="object"&&Pr(r,t.toHere(this.offset)),r}#n(){const t=this.children,r=t.length;if(r%2)throw new Error("Missing map value");const i=new Array(r/2);if(this.#t)for(let n=0;n<r;n+=2)i[n>>1]=[t[n],t[n+1],this.#t[n]];else for(let n=0;n<r;n+=2)i[n>>1]=[t[n],t[n+1],fg];return i}};const mo="  ",pg=new TextEncoder;class Vd extends me{close="";quote='"';get isEmptyStream(){return(this.mt===P.UTF8_STRING||this.mt===P.BYTE_STRING)&&this.count===0}}function De(e,t,r,i){let n="";if(t===G.INDEFINITE)n+="_";else{if(i.diagnosticSizes===fs.NEVER)return"";{let o=i.diagnosticSizes===fs.ALWAYS;if(!o){let s=G.ZERO;if(Object.is(r,-0))s=G.TWO;else if(e===P.POS_INT||e===P.NEG_INT){const a=r<0,c=typeof r=="bigint"?1n:1,l=a?-r-c:r;l<=23?s=Number(l):l<=255?s=G.ONE:l<=65535?s=G.TWO:l<=4294967295?s=G.FOUR:s=G.EIGHT}else isFinite(r)?Math.fround(r)===r?sh(r)==null?s=G.FOUR:s=G.TWO:s=G.EIGHT:s=G.TWO;o=s!==t}o&&(n+="_",t<G.ONE?n+="i":n+=String(t-24))}}return n}function mg(e,t){const r={...me.defaultDecodeOptions,...t,ParentType:Vd},i=new Ts(e,r);let n,o,s="";for(const a of i){const[c,l,u]=a;switch(n&&(n.count>0&&u!==ae.BREAK&&(n.mt===P.MAP&&n.count%2?s+=": ":(s+=",",r.pretty||(s+=" "))),r.pretty&&(n.mt!==P.MAP||n.count%2===0)&&(s+=`
${mo.repeat(n.depth+1)}`)),o=me.create(a,n,r,i),c){case P.POS_INT:case P.NEG_INT:s+=String(u),s+=De(c,l,u,r);break;case P.SIMPLE_FLOAT:if(u!==ae.BREAK)if(typeof u=="number"){const d=Object.is(u,-0)?"-0.0":String(u);s+=d,isFinite(u)&&!/[.e]/.test(d)&&(s+=".0"),s+=De(c,l,u,r)}else u instanceof Ne?(s+="simple(",s+=String(u.value),s+=De(P.POS_INT,l,u.value,r),s+=")"):s+=String(u);break;case P.BYTE_STRING:u===1/0?(s+="(_ ",o.close=")",o.quote="'"):(s+="h'",s+=pe(u),s+="'",s+=De(P.POS_INT,l,u.length,r));break;case P.UTF8_STRING:u===1/0?(s+="(_ ",o.close=")"):(s+=JSON.stringify(u),s+=De(P.POS_INT,l,pg.encode(u).length,r));break;case P.ARRAY:{s+="[";const d=De(P.POS_INT,l,u,r);s+=d,d&&(s+=" "),r.pretty&&u?o.close=`
${mo.repeat(o.depth)}]`:o.close="]";break}case P.MAP:{s+="{";const d=De(P.POS_INT,l,u,r);s+=d,d&&(s+=" "),r.pretty&&u?o.close=`
${mo.repeat(o.depth)}}`:o.close="}";break}case P.TAG:s+=String(u),s+=De(P.POS_INT,l,u,r),s+="(",o.close=")";break}if(o===ae.BREAK)if(n?.isStreaming)n.left=0;else throw new Error("Unexpected BREAK");else n&&(n.count++,n.left--);for(o instanceof Vd&&(n=o);n?.done;){if(n.isEmptyStream)s=s.slice(0,-3),s+=`${n.quote}${n.quote}_`;else{if(n.mt===P.MAP&&n.count%2!==0)throw new Error(`Odd streaming map size: ${n.count}`);s+=n.close}n=n.parent}}return s}const bg=new TextDecoder;class jo extends me{depth=0;leaf=!1;value;length;[ae.ENCODED];constructor(t,r,i,n){super(t,r,i,n),this.parent?this.depth=this.parent.depth+1:this.depth=n.initialDepth,[,,this.value,,this.length]=t}numBytes(){switch(this.ai){case G.ONE:return 1;case G.TWO:return 2;case G.FOUR:return 4;case G.EIGHT:return 8}return 0}}function hh(e){return e instanceof jo}function ns(e,t){return e===1/0?"Indefinite":t?`${e} ${t}${e!==1&&e!==1n?"s":""}`:String(e)}function kr(e){return"".padStart(e," ")}function ph(e,t,r){let i="";i+=kr(e.depth*2);const n=us(e);i+=pe(n.subarray(0,1));const o=e.numBytes();o&&(i+=" ",i+=pe(n.subarray(1,o+1))),i=i.padEnd(t.minCol+1," "),i+="-- ",r!==void 0&&(i+=kr(e.depth*2),r!==""&&(i+=`[${r}] `));let s=!1;const[a]=e.children;switch(e.mt){case P.POS_INT:i+=`Unsigned: ${a}`,typeof a=="bigint"&&(i+="n");break;case P.NEG_INT:i+=`Negative: ${a}`,typeof a=="bigint"&&(i+="n");break;case P.BYTE_STRING:i+=`Bytes (Length: ${ns(e.length)})`;break;case P.UTF8_STRING:i+=`UTF8 (Length: ${ns(e.length)})`,e.length!==1/0&&(i+=`: ${JSON.stringify(a)}`);break;case P.ARRAY:i+=`Array (Length: ${ns(e.value,"item")})`;break;case P.MAP:i+=`Map (Length: ${ns(e.value,"pair")})`;break;case P.TAG:{i+=`Tag #${e.value}`;const c=e.children,[l]=c.contents.children,u=new J(c.tag,l);Pr(u,n);const d=u.comment(t,e.depth);d&&(i+=": ",i+=d),s||=u.noChildren;break}case P.SIMPLE_FLOAT:a===ae.BREAK?i+="BREAK":e.ai>G.ONE?Object.is(a,-0)?i+="Float: -0":i+=`Float: ${a}`:(i+="Simple: ",a instanceof Ne?i+=a.value:i+=a);break}if(!s)if(e.leaf){if(i+=`
`,n.length>o+1){const c=kr((e.depth+1)*2),l=ls(n);if(l?.length){l.sort((d,h)=>d[0]-h[0]||h[1]-d[1]);let u=0;for(const[d,h,f]of l)if(!(d<u)){if(u=d+h,f==="<<"){i+=kr(t.minCol+1),i+="--",i+=c,i+="<< ";const g=xo(n,d,d+h),y=ls(g);if(y){const w=y.findIndex(([_,m,b])=>_===0&&m===h&&b==="<<");w>=0&&y.splice(w,1)}i+=mg(g),i+=` >>
`,i+=mh(g,{initialDepth:e.depth+1,minCol:t.minCol,noPrefixHex:!0});continue}else f==="'"&&(i+=kr(t.minCol+1),i+="--",i+=c,i+="'",i+=bg.decode(n.subarray(d,d+h)),i+=`'
`);if(d>o)for(let g=d;g<d+h;g+=8){const y=Math.min(g+8,d+h);i+=c,i+=pe(n.subarray(g,y)),i+=`
`}}}else for(let u=o+1;u<n.length;u+=8)i+=c,i+=pe(n.subarray(u,u+8)),i+=`
`}}else{i+=`
`;let c=0;for(const l of e.children){if(hh(l)){let u=String(c);e.mt===P.MAP?u=c%2?`val ${(c-1)/2}`:`key ${c/2}`:e.mt===P.TAG&&(u=""),i+=ph(l,t,u)}c++}}return i}const gg={...me.defaultDecodeOptions,initialDepth:0,noPrefixHex:!1,minCol:0};function mh(e,t){const r={...gg,...t,ParentType:jo,saveOriginal:!0},i=new Ts(e,r);let n,o;for(const a of i){if(o=me.create(a,n,r,i),a[2]===ae.BREAK)if(n?.isStreaming)n.left=1;else throw new Error("Unexpected BREAK");if(!hh(o)){const u=new jo(a,0,n,r);u.leaf=!0,u.children.push(o),Pr(u,i.toHere(a[3])),o=u}let c=(o.depth+1)*2;const l=o.numBytes();for(l&&(c+=1,c+=l*2),r.minCol=Math.max(r.minCol,c),n&&n.push(o,i,a[3]),n=o;n?.done;)o=n,o.leaf||Pr(o,i.toHere(o.offset)),{parent:n}=n}t&&(t.minCol=r.minCol);let s=r.noPrefixHex?"":`0x${pe(i.toHere(0))}
`;return s+=ph(o,r),s}const Jd=!xb();function xs(e){if(typeof e=="object"&&e){if(e.constructor!==Number)throw new Error(`Expected number: ${e}`)}else if(typeof e!="number")throw new Error(`Expected number: ${e}`)}function Le(e){if(typeof e=="object"&&e){if(e.constructor!==String)throw new Error(`Expected string: ${e}`)}else if(typeof e!="string")throw new Error(`Expected string: ${e}`)}function xe(e){if(!(e instanceof Uint8Array))throw new Error(`Expected Uint8Array: ${e}`)}function bh(e){if(!Array.isArray(e))throw new Error(`Expected Array: ${e}`)}Z(Map,(e,t,r)=>{const i=[...e.entries()].map(n=>[n[0],n[1],Dr(n[0],r)]);if(r.rejectDuplicateKeys){const n=new Set;for(const[o,s,a]of i){const c=pe(a);if(n.has(c))throw new Error(`Duplicate map key: 0x${c}`);n.add(c)}}r.sortKeys&&i.sort(r.sortKeys),tc(e,e.size,P.MAP,t,r);for(const[n,o,s]of i)t.write(s),at(o,t,r)});function bo(e){return Le(e.contents),new Date(e.contents)}bo.comment=e=>{Le(e.contents);const t=new Date(e.contents);return`(String ${e.tag===W.DATE_FULL?"Full ":""}Date) ${t.toISOString()}`},J.registerDecoder(W.DATE_STRING,bo),J.registerDecoder(W.DATE_FULL,bo);function Gd(e){return xs(e.contents),new Date(e.contents*1e3)}Gd.comment=e=>(xs(e.contents),`(Epoch Date) ${new Date(e.contents*1e3).toISOString()}`),J.registerDecoder(W.DATE_EPOCH,Gd);const Po=1e3*60*60*24;function zd(e){return xs(e.contents),new Date(e.contents*Po)}zd.comment=e=>(xs(e.contents),`(Epoch Date) ${new Date(e.contents*Po).toISOString()}`),J.registerDecoder(W.DATE_EPOCH_DAYS,zd),Z(Date,(e,t,r)=>{switch(r.dateTag){case W.DATE_EPOCH:return[r.dateTag,e.valueOf()/1e3];case W.DATE_STRING:return[r.dateTag,e.toISOString().replace(/\.000Z$/,"Z")];case W.DATE_EPOCH_DAYS:return[r.dateTag,Math.floor(e.valueOf()/Po)];case W.DATE_FULL:return[r.dateTag,e.toISOString().split("T")[0]];default:throw new Error(`Unsupported date tag: ${r.dateTag}`)}});function hs(e,t,r){if(xe(t.contents),r.rejectBigInts)throw new Error(`Decoding unwanted big integer: ${t}(h'${pe(t.contents)}')`);if(r.requirePreferred&&t.contents[0]===0)throw new Error(`Decoding overly-large bigint: ${t.tag}(h'${pe(t.contents)})`);let i=t.contents.reduce((o,s)=>o<<8n|BigInt(s),0n);e&&(i=-1n-i);const n=i>=Number.MIN_SAFE_INTEGER&&i<=Number.MAX_SAFE_INTEGER;if(r.requirePreferred&&n)throw new Error(`Decoding bigint that could have been int: ${i}n`);return r.collapseBigInts&&n&&(i=Number(i)),r.boxed?xr(i,t.contents):i}const Hd=hs.bind(null,!1),Wd=hs.bind(null,!0);Hd.comment=(e,t)=>`(Positive BigInt) ${hs(!1,e,t)}n`,Wd.comment=(e,t)=>`(Negative BigInt) ${hs(!0,e,t)}n`,J.registerDecoder(W.POS_BIGINT,Hd),J.registerDecoder(W.NEG_BIGINT,Wd);function go(e,t){return xe(e.contents),e}go.comment=(e,t,r)=>{xe(e.contents);const i={...t,initialDepth:r+2,noPrefixHex:!0},n=us(e);let o=2**((n[0]&31)-24)+1;const s=n[o]&31;let a=pe(n.subarray(o,++o));s>=24&&(a+=" ",a+=pe(n.subarray(o,o+2**(s-24)))),i.minCol=Math.max(i.minCol,(r+1)*2+a.length);const c=mh(e.contents,i);let l=`Embedded CBOR
`;return l+=`${"".padStart((r+1)*2," ")}${a}`.padEnd(i.minCol+1," "),l+=`-- Bytes (Length: ${e.contents.length})
`,l+=c,l},go.noChildren=!0,J.registerDecoder(W.CBOR,go),J.registerDecoder(W.URI,e=>(Le(e.contents),new URL(e.contents)),"URI"),Z(URL,e=>[W.URI,e.toString()]),J.registerDecoder(W.BASE64URL,e=>(Le(e.contents),Tb(e.contents)),"Base64url-encoded"),J.registerDecoder(W.BASE64,e=>(Le(e.contents),ec(e.contents)),"Base64-encoded"),J.registerDecoder(35,e=>(Le(e.contents),new RegExp(e.contents)),"RegExp"),J.registerDecoder(21065,e=>{Le(e.contents);const t=`^(?:${e.contents})$`;return new RegExp(t,"u")},"I-RegExp"),J.registerDecoder(W.REGEXP,e=>{if(bh(e.contents),e.contents.length<1||e.contents.length>2)throw new Error(`Invalid RegExp Array: ${e.contents}`);return new RegExp(e.contents[0],e.contents[1])},"RegExp"),Z(RegExp,e=>[W.REGEXP,[e.source,e.flags]]),J.registerDecoder(64,e=>(xe(e.contents),e.contents),"uint8 Typed Array");function oe(e,t,r){xe(e.contents);let i=e.contents.length;if(i%t.BYTES_PER_ELEMENT!==0)throw new Error(`Number of bytes must be divisible by ${t.BYTES_PER_ELEMENT}, got: ${i}`);i/=t.BYTES_PER_ELEMENT;const n=new t(i),o=new DataView(e.contents.buffer,e.contents.byteOffset,e.contents.byteLength),s=o[`get${t.name.replace(/Array/,"")}`].bind(o);for(let a=0;a<i;a++)n[a]=s(a*t.BYTES_PER_ELEMENT,r);return n}function Be(e,t,r,i,n){const o=n.forceEndian??Jd;if(Mr(o?t:r,e,n),ye(i.byteLength,e,P.BYTE_STRING),Jd===o)e.write(new Uint8Array(i.buffer,i.byteOffset,i.byteLength));else{const s=`write${i.constructor.name.replace(/Array/,"")}`,a=e[s].bind(e);for(const c of i)a(c,o)}}J.registerDecoder(65,e=>oe(e,Uint16Array,!1),"uint16, big endian, Typed Array"),J.registerDecoder(66,e=>oe(e,Uint32Array,!1),"uint32, big endian, Typed Array"),J.registerDecoder(67,e=>oe(e,BigUint64Array,!1),"uint64, big endian, Typed Array"),J.registerDecoder(68,e=>(xe(e.contents),new Uint8ClampedArray(e.contents)),"uint8 Typed Array, clamped arithmetic"),Z(Uint8ClampedArray,e=>[68,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)]),J.registerDecoder(69,e=>oe(e,Uint16Array,!0),"uint16, little endian, Typed Array"),Z(Uint16Array,(e,t,r)=>Be(t,69,65,e,r)),J.registerDecoder(70,e=>oe(e,Uint32Array,!0),"uint32, little endian, Typed Array"),Z(Uint32Array,(e,t,r)=>Be(t,70,66,e,r)),J.registerDecoder(71,e=>oe(e,BigUint64Array,!0),"uint64, little endian, Typed Array"),Z(BigUint64Array,(e,t,r)=>Be(t,71,67,e,r)),J.registerDecoder(72,e=>(xe(e.contents),new Int8Array(e.contents)),"sint8 Typed Array"),Z(Int8Array,e=>[72,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)]),J.registerDecoder(73,e=>oe(e,Int16Array,!1),"sint16, big endian, Typed Array"),J.registerDecoder(74,e=>oe(e,Int32Array,!1),"sint32, big endian, Typed Array"),J.registerDecoder(75,e=>oe(e,BigInt64Array,!1),"sint64, big endian, Typed Array"),J.registerDecoder(77,e=>oe(e,Int16Array,!0),"sint16, little endian, Typed Array"),Z(Int16Array,(e,t,r)=>Be(t,77,73,e,r)),J.registerDecoder(78,e=>oe(e,Int32Array,!0),"sint32, little endian, Typed Array"),Z(Int32Array,(e,t,r)=>Be(t,78,74,e,r)),J.registerDecoder(79,e=>oe(e,BigInt64Array,!0),"sint64, little endian, Typed Array"),Z(BigInt64Array,(e,t,r)=>Be(t,79,75,e,r)),J.registerDecoder(81,e=>oe(e,Float32Array,!1),"IEEE 754 binary32, big endian, Typed Array"),J.registerDecoder(82,e=>oe(e,Float64Array,!1),"IEEE 754 binary64, big endian, Typed Array"),J.registerDecoder(85,e=>oe(e,Float32Array,!0),"IEEE 754 binary32, little endian, Typed Array"),Z(Float32Array,(e,t,r)=>Be(t,85,81,e,r)),J.registerDecoder(86,e=>oe(e,Float64Array,!0),"IEEE 754 binary64, big endian, Typed Array"),Z(Float64Array,(e,t,r)=>Be(t,86,82,e,r)),J.registerDecoder(W.SET,(e,t)=>{if(bh(e.contents),t.sortKeys){const r=me.decodeToEncodeOpts(t);let i=null;for(const n of e.contents){const o=[n,void 0,Dr(n,r)];if(i&&t.sortKeys(i,o)>=0)throw new Error(`Set items out of order in tag #${W.SET}`);i=o}}return new Set(e.contents)},"Set"),Z(Set,(e,t,r)=>{let i=[...e];if(r.sortKeys){const n=i.map(o=>[o,void 0,Dr(o,r)]);n.sort(r.sortKeys),i=n.map(([o])=>o)}return[W.SET,i]}),J.registerDecoder(W.JSON,e=>(Le(e.contents),JSON.parse(e.contents)),"JSON-encoded");function Kd(e){return xe(e.contents),new Rs().decode(e.contents)}Kd.comment=e=>{xe(e.contents);const t=new Rs;return`(WTF8 string): ${JSON.stringify(t.decode(e.contents))}`},J.registerDecoder(W.WTF8,Kd),J.registerDecoder(W.SELF_DESCRIBED,e=>e.contents,"Self-Described"),J.registerDecoder(W.INVALID_16,()=>{throw new Error(`Tag always invalid: ${W.INVALID_16}`)},"Invalid"),J.registerDecoder(W.INVALID_32,()=>{throw new Error(`Tag always invalid: ${W.INVALID_32}`)},"Invalid"),J.registerDecoder(W.INVALID_64,()=>{throw new Error(`Tag always invalid: ${W.INVALID_64}`)},"Invalid");function yo(e){throw new Error(`Encoding ${e.constructor.name} intentionally unimplmented.  It is not concrete enough to interoperate.  Convert to Uint8Array first.`)}Z(ArrayBuffer,yo),Z(DataView,yo),typeof SharedArrayBuffer<"u"&&Z(SharedArrayBuffer,yo);function rs(e){return[NaN,e.valueOf()]}Z(Boolean,rs),Z(Number,rs),Z(String,rs),Z(BigInt,rs);function yg(e){const t={...me.defaultDecodeOptions};if(e.dcbor?Object.assign(t,me.dcborDecodeOptions):e.cde&&Object.assign(t,me.cdeDecodeOptions),Object.assign(t,e),Object.hasOwn(t,"rejectLongNumbers"))throw new TypeError("rejectLongNumbers has changed to requirePreferred");return t.boxed&&(t.saveOriginal=!0),t}let vg=class{parent=void 0;ret=void 0;step(t,r,i){if(this.ret=me.create(t,this.parent,r,i),t[2]===ae.BREAK)if(this.parent?.isStreaming)this.parent.left=0;else throw new Error("Unexpected BREAK");else this.parent&&this.parent.push(this.ret,i,t[3]);for(this.ret instanceof me&&(this.parent=this.ret);this.parent?.done;){this.ret=this.parent.convert(i);const n=this.parent.parent;n?.replaceLast(this.ret,this.parent,i),this.parent=n}}};function wg(e,t={}){const r=yg(t),i=new Ts(e,r),n=new vg;for(const o of i)n.step(o,r,i);return n.ret}const{cdeDecodeOptions:vw,dcborDecodeOptions:ww,defaultDecodeOptions:_w}=me,_g=30*1024,Sg=250;class Eg{socket;model=null;messageCounter;replicaId;verboseEncoder=new Eb.Encoder;maxPayloadSizeBytes;throttledSendPatch;snapshotDecoder=new Ab.Decoder;onModelCreate;onGridReady;onStatusChange;constructor(t){const{replicaId:r,url:i,onGridReady:n,onStatusChange:o,onModelCreate:s,maxPayloadSizeBytes:a,socket:c,model:l,patchThrottleMs:u}=t;this.messageCounter=new ub,this.replicaId=r,this.maxPayloadSizeBytes=a??_g,this.socket=c??new WebSocket(i),this.onModelCreate=s??Te,this.onGridReady=n??Te,this.onStatusChange=o??Te,l&&(this.model=l),this.attachSocketHandlers(),this.throttledSendPatch=k0(()=>this.sendPatchImmediate(),u??Sg,{leading:!1,trailing:!0})}attachSocketHandlers(){this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=t=>{typeof t.data=="string"?this.handleMessage(t.data):console.error("Received non-string message data:",t.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=t=>{console.error("WebSocket error:",t)}}disconnect(){this.throttledSendPatch.flush(),this.throttledSendPatch.cancel(),this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}sendClockSync(){if(!this.model){console.error("Model is not initialized. Cannot sync model.");return}if(!this.sendPatchImmediate()){const r=this.verboseEncoder.encode(this.model);this.sendSyncMessage(r.time)}}handleMessage(t){const r=cb.fromJson(JSON.parse(t));r instanceof zf?this.handleResponse(r):r instanceof Wf?this.handleResponseComplete():r instanceof Vf?this.handleNotification(r):console.warn("Unexpected WebSocket message format:",r)}handleResponse(t){const r=t.getPayload();if(Array.isArray(r)){this.handlePatchPayload(r);return}switch(r.type){case"patch":this.handlePatchPayload(r.body);break;case"snapshot":this.handleSnapshotPayload(r.body);break;default:console.warn("Unknown payload type:",r);break}}handlePatchPayload(t){try{const r=Qo.decode(t);this.model?this.model.applyPatch(r):(this.model=_b.Model.fromPatches([r]).fork(this.replicaId),this.onModelCreate(this.model)),this.sendClockSync()}catch(r){console.error("Failed to apply patch or send clock:",r)}}async handleSnapshotPayload(t){console.debug("Received snapshot URL from server:",t);try{const r=await this.fetchAndDecodeSnapshot(t);this.model=r.fork(this.replicaId),this.onModelCreate(this.model),this.sendClockSync()}catch(r){console.error("Failed to fetch or decode snapshot",r)}}handleResponseComplete(){this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.")}handleNotification(t){const r=t.getMethodName();switch(console.debug("Notification received from server:",r),r){case"ping":console.debug("Received ping from server");break;case"connected":console.debug("Server ready to receive patches"),this.sendSyncMessage(this.model?this.verboseEncoder.encode(this.model).time:void 0);break;case"error":console.warn("Error from server:",t.getPayload());break;case"new-patch":if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");break}{const i=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",i.time);const n=new is(this.messageCounter.getNext(),"synchronize-clock",i.time);this.sendMessage(n)}break;default:console.warn("Unknown notification method:",r);break}}sendMessage(t){this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t.getJson())):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){this.throttledSendPatch()}sendPatchImmediate(){if(!this.model)return console.warn("Model is not initialized. Cannot send patch."),!1;const t=this.model.api.flush(),r=t.ops.length>0;return r&&wb(t,this.maxPayloadSizeBytes).forEach(n=>{console.debug("Sending patch to server:",n);const o=new is(this.messageCounter.getNext(),"patch",n);this.sendMessage(o)}),r}sendSyncMessage(t){const r=new is(this.messageCounter.getNext(),"synchronize-clock",t??[]);this.sendMessage(r)}async fetchAndDecodeSnapshot(t){const n=await(await(await S0(t)).blob()).arrayBuffer(),o=wg(new Uint8Array(n));return this.snapshotDecoder.decode(o)}}function Cg(e){const{mutateAsync:t}=ib(),[r,i]=D.useState(null),n=D.useCallback(()=>{i(null)},[]);return{...Ie({retry:5,retryDelay:s=>Math.min(s>1?2**s*1e3:1e3,30*1e3),mutationFn:async({replicaId:s,sessionId:a,websocketOptions:c})=>{if(!s)throw new Error("replicaId is required");const l=await t({replicaId:s,sessionId:a});return i(l),new Eg({replicaId:s,url:l,...c||{}})},...e}),presignedUrl:r,clearPresignedUrl:n}}function Og(e,t){switch(t.type){case"CONNECT_REQUESTED":{const r=e.connectionParams&&e.connectionParams.replicaId===t.payload.replicaId&&e.connectionParams.sessionId===t.payload.sessionId;return{...e,connectionParams:{replicaId:t.payload.replicaId,sessionId:t.payload.sessionId},hasCompletedInitialSync:r?e.hasCompletedInitialSync:!1,model:r?e.model:null,isConnected:!1,isConnecting:!1,connectionAttemptId:t.payload.attemptId,connectionError:null}}case"CONNECTION_ESTABLISHED":return{...e,websocketInstance:t.payload,isConnecting:!0};case"CONNECTION_OPENED":return{...e,isConnected:!0,isConnecting:!1};case"CONNECTION_CLOSED":return{...e,isConnected:!1,isConnecting:!1};case"GRID_READY":return{...e,hasCompletedInitialSync:!0};case"MODEL_CREATED":return{...e,model:t.payload};case"CONNECTION_ERROR":return{...e,connectionError:t.payload,isConnecting:!1};default:return e}}const Ag={model:null,hasCompletedInitialSync:!1,isConnected:!1,isConnecting:!1,connectionParams:null,websocketInstance:null,connectionAttemptId:null,connectionError:null};function Ng(){const[e,t]=D.useReducer(Og,Ag),r=D.useRef(0),i=D.useRef(null),n=sb(e.model),o=P0(),{mutateAsync:s,isPending:a,error:c,presignedUrl:l,reset:u,clearPresignedUrl:d}=Cg(),h=D.useCallback(_=>{t({type:"MODEL_CREATED",payload:_})},[t]),f=D.useMemo(()=>({onGridReady:()=>t({type:"GRID_READY"}),onStatusChange:_=>t({type:_?"CONNECTION_OPENED":"CONNECTION_CLOSED"}),onModelCreate:h}),[h]),g=D.useCallback((_,m)=>{u(),(!e.connectionParams||e.connectionParams.replicaId!==_||e.connectionParams.sessionId!==m)&&d(),r.current+=1;const p=r.current;t({type:"CONNECT_REQUESTED",payload:{replicaId:_,sessionId:m,attemptId:p}})},[t,e.connectionParams,u,d,r]);D.useEffect(()=>{const{connectionParams:_,connectionAttemptId:m}=e;!_||m===null||e.isConnected||e.isConnecting||a||c||e.connectionError||!o||(i.current=m,s({replicaId:_.replicaId,sessionId:_.sessionId,websocketOptions:{...f,model:e.model}}).then(b=>{if(i.current!==m){b.disconnect();return}t({type:"CONNECTION_ESTABLISHED",payload:b})}).catch(b=>{t({type:"CONNECTION_ERROR",payload:b}),console.error("Failed to establish WebSocket",b)}))},[e,e.connectionParams,e.connectionAttemptId,e.isConnected,e.isConnecting,a,c,o,s,f]);const y=D.useRef(null);D.useEffect(()=>{const _=y.current,m=e.connectionParams;_&&m&&(_.replicaId!==m.replicaId||_.sessionId!==m.sessionId)&&e.websocketInstance?.disconnect(),y.current=m},[e.connectionParams,e.websocketInstance]),D.useEffect(()=>()=>{e.websocketInstance?.disconnect(),i.current=null},[e.websocketInstance]);function w(_){if(!_||!_.api.getSnapshot()||!n)return!1;const{columnNames:m,columnOrder:b,rows:p}=n,v=m.length>=1,S=b.length>=1,E=p.length>=0;return v&&S&&E}return{isConnected:e.isConnected,websocketInstance:e.websocketInstance,hasCompletedInitialSync:e.hasCompletedInitialSync,model:e.model,modelSnapshot:n,connect:g,presignedUrl:l,errorEstablishingWebsocketConnection:e.connectionError??c,hasSufficientData:w(e.model)}}var ct=mt();function Ig(e,t,r){let i;return Object.hasOwn(e,t)?i=e[t]:r[t]?.isRequired?i=null:i=void 0,i}function kg(e,t,r){const i=e.api.arr(["rows"]),{columnNames:n}=e.api.getSnapshot();switch(t.type){case"CREATE":{const o=n.map(s=>ct.s.con(Ig(t.rowData,s,r)));i?.ins(t.rowIndex,[ct.s.obj({data:ct.s.vec(...o),metadata:ct.s.obj({})})]);break}case"DELETE":i?.del(t.rowIndex,t.count??1);break;case"UPDATE":{Object.entries(t.updatedData).forEach(([o,s])=>{if(o.startsWith("_"))return;const a=n.indexOf(o);a!==-1&&e.api.vec(["rows",String(t.rowIndex),"data"])?.set([[a,ct.s.con(s)]])});break}case"SET_SELECTION":{e.api.obj().has("selection")||e.api.obj().add(["selection"],ct.s.obj({})),e.api.obj(["selection"]).set({[t.replicaId]:ct.s.con(t.selection)});break}}}function Rg(e,t){const r=[];return e.forEach(i=>{if(i.type==="CREATE")for(let n=i.fromRowIndex;n<i.toRowIndex;n++)r.push({type:"CREATE",rowIndex:n,rowData:t[n]});if(i.type==="UPDATE")for(let n=i.fromRowIndex;n<i.toRowIndex;n++)r.push({type:"UPDATE",rowIndex:n,updatedData:t[n]});i.type==="DELETE"&&r.push({type:"DELETE",rowIndex:i.fromRowIndex,count:i.toRowIndex-i.fromRowIndex})}),r}const Mo=({selectedRowIndex:e,rowValues:t})=>{if(e===null)return null;const r=t[e];if(!r)return null;const i=r.__validationResults?.allValidationMessages;return!Array.isArray(i)||i.length===0?null:j.jsx(Xh,{variant:"warning",title:"Validation Messages For Selected Row:",isGlobal:!1,description:j.jsx("ul",{children:i.map(n=>j.jsx("li",{children:n},n))}),sx:{marginTop:"12px"}})};try{Mo.displayName="ValidationAlert",Mo.__docgenInfo={description:"",displayName:"ValidationAlert",props:{selectedRowIndex:{defaultValue:null,description:"",name:"selectedRowIndex",required:!0,type:{name:"number"}},rowValues:{defaultValue:null,description:"",name:"rowValues",required:!0,type:{name:"DataGridRow[]"}}}}}catch{}const $d=D.forwardRef(({agentRegistrationId:e,showDebugInfo:t=!1},r)=>{const[i,n]=D.useState(null),[o,s]=D.useState(null),[a,c]=D.useState(!1),[l,u]=D.useState(null),d=D.useRef(null),h=D.useRef(null),{data:f,isLoading:g}=d0();D.useImperativeHandle(r,()=>({initializeGrid:K=>{d.current&&d.current.handleStartSession(K)},loadExistingSession:K=>{d.current&&d.current.handleLoadSession(K)}}),[]);const{isConnected:y,websocketInstance:w,hasCompletedInitialSync:_,model:m,modelSnapshot:b,connect:p,presignedUrl:v,hasSufficientData:S}=Ng(),E=D.useRef(null);D.useEffect(()=>{E.current=w},[w]);const O=D.useRef(null);D.useEffect(()=>{if(o==null||!i?.sessionId){O.current=null;return}const K={replicaId:o,sessionId:i.sessionId},Y=O.current;Y&&Y.replicaId===K.replicaId&&Y.sessionId===K.sessionId||(O.current=K,p(o,i.sessionId))},[o,i?.sessionId,p]),D.useEffect(()=>{m===null&&(u(null),h.current&&h.current.setActiveCell(null))},[m]);const A=mp(i),{data:C}=ms(i?.sourceEntityId,void 0,{enabled:!!i?.sourceEntityId}),N=C?.concreteType==="org.sagebionetworks.repo.model.table.EntityView",I=D.useMemo(()=>jp(A??null),[A]),k=y?"Connected":"Disconnected",R=D.useMemo(()=>b?Np(m,b):[],[m,b]),x=D.useCallback(()=>{!y||!E.current||E.current.sendPatch()},[y,E]);D.useEffect(()=>{y&&x()},[y,x]);const T=D.useCallback((K,Y)=>{Y.forEach(Q=>{kg(K,Q,I)}),x()},[x,I]),M=D.useCallback(K=>{if(!m){console.error("Model is not initialized");return}K.type==="DELETE"&&h.current&&h.current.setActiveCell(null),T(m,[K])},[m,T]),{undoUI:q,redoUI:U,addOperationsToUndoStack:V,clearRedoStack:F}=Io(M),L=D.useCallback((K,Y)=>{if(!m){console.error("Model is not initialized");return}if(Y=u0(K,R,Y),Y.length>0){F(),V(Y,R,K);const Q=Rg(Y,K);T(m,Q)}},[m,R,F,V,T]),ee=D.useCallback(K=>{const{selection:Y}=K;if(Y!=null&&(u(Y),m!=null&&o!=null)){const Q=Ep(Y,m);T(m,[{type:"SET_SELECTION",replicaId:o.toString(),selection:Q}])}},[T,m,o]),X=D.useRef(null),[,le]=D.useState({}),Se=D.useCallback((K,Y)=>{X.current=K,le({})},[]);return!g&&!f?.isCertified?j.jsx(E0,{}):j.jsx("div",{children:j.jsxs(ce,{container:!0,spacing:2,children:[j.jsx(ce,{size:{xs:12,xl:8},children:j.jsx(Ro,{ref:d,onSessionChange:n,onReplicaChange:s,show:t})}),j.jsx(ce,{size:{xs:12,xl:4},children:t&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",i?.sessionId||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",o||"No replica created"]}),j.jsxs("p",{children:["Source Entity ID:"," ",i?.sourceEntityId||"No source entity"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",i?.gridJsonSchema$Id||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",v?v.substring(0,30)+(v.length>30?" ... "+v.substring(v.length-10):""):"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:y?"green":"red"},children:k})]})]})}),i&&j.jsxs(j.Fragment,{children:[!S&&j.jsxs(ce,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!i&&j.jsx("p",{children:"Creating grid session..."}),i&&!o&&j.jsx("p",{children:"Setting up real-time sync..."}),i&&o&&!v&&j.jsx("p",{children:"Establishing secure connection..."}),i&&o&&v&&!y&&j.jsx("p",{children:"Connecting to server..."}),y&&!_&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Zh,{numRows:4,numCols:1})]})]}),S&&j.jsxs(j.Fragment,{children:[j.jsx(ce,{size:12,children:j.jsxs(Qh,{direction:"row",spacing:1,sx:{justifyContent:"flex-end"},children:[q,U,j.jsx(Ve,{variant:"outlined",onClick:()=>c(!0),startIcon:j.jsx(n0,{}),children:"Open chat"}),j.jsx(Ao,{agentRegistrationId:e,open:a,onClose:()=>c(!1),gridSessionId:i.sessionId,usersReplicaId:o,chatbotName:"Grid Assistant"}),i.sourceEntityId&&j.jsx(_o,{sourceEntityId:i.sourceEntityId,gridSessionId:i.sessionId}),i.sessionId&&j.jsx(So,{gridSessionId:i.sessionId,filename:"grid-"+(i.sourceEntityId||"export")}),i.sourceEntityId&&j.jsx(Eo,{sourceEntityId:i.sourceEntityId,gridSessionId:i.sessionId})]})}),j.jsx(ce,{size:12,children:j.jsx(l0,{gridRef:h,rowValues:R,columnNames:b?.columnNames??[],columnOrder:b?.columnOrder??[],schemaPropertiesInfo:I,entityIsView:N,jsonSchema:A,lastSelection:l,handleChange:L,handleSelectionChange:ee,onSelectedRowChange:Se})}),j.jsx(ce,{size:12,children:j.jsx(Mo,{selectedRowIndex:X.current,rowValues:R})})]}),t&&j.jsxs(ce,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model"}),m?j.jsx(Q1.ClickableJsonCrdt,{model:m}):"No model available"]})]})]})})});try{$d.displayName="SynapseGrid",$d.__docgenInfo={description:"",displayName:"SynapseGrid",props:{agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}export{ko as G,$d as S};
