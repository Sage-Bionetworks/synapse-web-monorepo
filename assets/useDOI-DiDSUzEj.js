import{aO as c,l as i,S as r}from"./useFiles-Bo-B-1VH.js";import"./VerificationSubmission-CWAFIXEx.js";import"./StringUtils-DBSsSsIU.js";import{u}from"./useQuery-BiN9FESP.js";import{u as y}from"./utils-Bx1BRerw.js";import{u as l}from"./useMutation-DjwfMZ6R.js";async function D(e,a){let n=125;const o=1e3;let t=await e();for(;"jobState"in t&&t.jobState==="PROCESSING";)await c(n),t=await e(),n=Math.min(n*2,o);return t}function d(e,a,n="ENTITY",o){const{accessToken:t,keyFactory:s}=i();return u({...o,queryKey:s.getDOIAssociationQueryKey(n,e,a),queryFn:()=>r.getDOIAssociation(t,e,a,n)})}function q(e,a,n="ENTITY",o){const{accessToken:t,keyFactory:s}=i();return u({...o,queryKey:s.getDOIQueryKey(n,e,a),queryFn:()=>r.getDOI(t,e,a,n)})}function C(e){const a=y(),{synapseClient:n,keyFactory:o}=i();return l({...e,mutationFn:async t=>{const s=await n.doiServicesClient.postRepoV1DoiAsyncStart({doiRequest:t});return D(()=>n.doiServicesClient.getRepoV1DoiAsyncGetAsyncToken({asyncToken:s.token}))},onSuccess(...t){e!=null&&e.onSuccess&&e.onSuccess(...t);const s=t[1].doi;s&&(a.invalidateQueries({queryKey:o.getDOIAssociationQueryKey(s.objectType,s.objectId,s.objectVersion)}),a.invalidateQueries({queryKey:o.getDOIQueryKey(s.objectType,s.objectId,s.objectVersion)}))}})}export{C as a,d as b,q as u};
