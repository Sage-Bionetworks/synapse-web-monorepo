import{j as n,a as m,F as q}from"./jsx-runtime-670450c2.js";import{a8 as $e,aF as Ze,az as Oe,a9 as Xe,ab as et,aL as tt,aR as nt}from"./SynapseContext-e269a896.js";import{r as p,R as ke}from"./index-f1f749bf.js";import{i as at,r as rt,h as lt,a as He}from"./queryUtils-ec977ae6.js";import{a as ze,b as st,u as ot}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as it}from"./NoSearchResults-af5e6b64.js";import{s as ct}from"./NoData-a9ac3abd.js";import{u as ut}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-5116adf5.js";import{p as dt,q as mt,o as pt,i as ht,j as yt,n as ft,V as W,I as ce,x as gt,y as _t,w as Ct}from"./SynapseConstants-41b9b1f3.js";import{u as Ft}from"./useEntity-e5e4c517.js";import{b as Nt}from"./useGetQueryResultBundle-fc425a9f.js";import{p as St,a as bt}from"./sqlFunctions-d0f62c1d.js";import{i as _e,a as Ce,c as vt}from"./QueryFilter-5c744347.js";import{c as pe}from"./cloneDeep-34a58e88.js";import{i as Z}from"./isEqual-35e59f6a.js";import{E as ae}from"./ElementWithTooltip-f12e81bb.js";import{u as he}from"./useGetInfoFromIds-7a9fbbf2.js";import{I as Y,a as Et}from"./IconSvg-cc4c779b.js";import{C as Ye}from"./Checkbox-23c2f4f8.js";import{D as A}from"./Dropdown-9ada1c97.js";import{R as wt}from"./RadioGroup-e708cf9e.js";import{d as Qe}from"./dayjs.min-e0adaab4.js";import{R as Tt}from"./RangeSlider-1b9f6a1d.js";import{B as ye}from"./Box-5df43b07.js";import{S as te}from"./Skeleton-1377209b.js";import{S as xt}from"./Stack-5733f74f.js";import{c as Vt,P as It}from"./factory-76e91d33.js";import{r as Rt}from"./react-sizeme-2217af01.js";import{g as kt}from"./ColorGradient-3d3e1969.js";import{l as qt}from"./LoadingScreen-81288bea.js";import{M as X}from"./Modal-269ceb3c.js";import{B as We}from"./Button-a16e56e5.js";import{T as Qt}from"./Clear-b4ccb838.js";import{S as Lt}from"./SelectionCriteriaPill-26666f4b.js";const Pt="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",At="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Fe=$e(Pt),Dt=$e(At),re=e=>n(te,{style:{...e.style,display:"inline-block"},...e});try{re.displayName="SkeletonInlineBlock",re.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rounded"'},{value:'"rectangular"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const $=p.createContext(void 0),Ne=({children:e,queryContext:t})=>n($.Provider,{value:t,children:e});function U(){const e=p.useContext($);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function na(){const e=p.useContext($);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function aa(){const e=p.useContext($);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Le=$.Consumer;try{$.displayName="QueryContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{Ne.displayName="QueryContextProvider",Ne.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{Le.displayName="QueryContextConsumer",Le.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function Ge(e,t){return`${e}${t}`}function Ut(e,t){const a=window.location.search,r=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${r}`:o).join("&"):`${a.substr(1)}&${r}`:r}function Mt(e,t){if(!window.location.search)return;const a=Ge(e,t),l=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===a).map(s=>s.split("=")[1])[0];return l?decodeURIComponent(l):void 0}function Bt(e,t,a){const r=t!==void 0?Ge(e,t):e,l=Ut(r,a),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${l}`;window.history.replaceState("object or string","Title",o)}function $t(e,t){const a=Mt(e,t);let r;if(a){const l=JSON.parse(a);l.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:dt|mt|pt|ht|yt,entityId:St(l.sql),query:l})}return r}function Ot(e){const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:r=!1,onQueryChange:l}=e,[s,o]=p.useState(t);p.useEffect(()=>{const f=$t("QueryWrapper",a);f&&o(f)},[a]);const c=p.useCallback(()=>pe(s),[s]),d=p.useCallback(()=>pe(t),[t]),i=p.useCallback(f=>{let F;typeof f=="function"?F=f(c()):F=f;const V=pe(F);if(o(V),V.query){const S=JSON.stringify(V.query);if(r){const L=encodeURIComponent(S);Bt("QueryWrapper",a,L)}l&&l(S)}},[a,c,l,r]),{entityId:g,versionNumber:T}=p.useMemo(()=>bt(s.query.sql),[s.query.sql]),_=s.query.limit??ft,I=Math.ceil(((s.query.offset??0)+Number(_))/_),u=p.useCallback(f=>{i(F=>(F.query.limit=f,F))},[i]),C=p.useCallback(f=>{i(F=>(F.query.offset=(f-1)*_,F))},[_,i]),y=p.useCallback(()=>{i(t)},[t,i]),w=p.useCallback(f=>{i(F=>(F.query.selectedFacets=(F.query.selectedFacets??[]).filter(V=>!Z(V,f)),F))},[i]),h=p.useCallback((f,F)=>{i(V=>(V.query.selectedFacets=(V.query.selectedFacets??[]).map(S=>(Fe(S)&&Z(S,f)&&(S.facetValues=S.facetValues.filter(L=>L!==F)),S)).filter(S=>Fe(S)?Array.isArray(S.facetValues)&&S.facetValues.length>0:!0),V))},[i]),x=p.useCallback(f=>{i(F=>(F.query.additionalFilters=(F.query.additionalFilters??[]).filter(V=>!Z(V,f)),F))},[i]),N=p.useCallback((f,F)=>{i(V=>(V.query.additionalFilters=(V.query.additionalFilters??[]).map(S=>((_e(S)||Ce(S))&&Z(S,f)&&(S.values=S.values.filter(L=>L!==F)),S)).filter(S=>_e(S)||Ce(S)?Array.isArray(S.values)&&S.values.length>0:!0),V))},[i]);return{entityId:g,versionNumber:T,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:_,currentPage:I,setPageSize:u,goToPage:C,resetQuery:y,removeSelectedFacet:w,removeValueFromSelectedFacet:h,removeQueryFilter:x,removeValueFromQueryFilter:N}}const ue="isShowingFacetFilters",de="isHidingFacetFilters";function Pe(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:r,lockedColumn:l,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:g,getInitQueryRequest:T,getLastQueryRequest:_,setQuery:I,currentPage:u,pageSize:C,goToPage:y,setPageSize:w,resetQuery:h,removeSelectedFacet:x,removeValueFromSelectedFacet:N,removeQueryFilter:f,removeValueFromQueryFilter:F}=Ot({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:a}),V=p.useMemo(()=>_(),[_]),{data:S,isLoading:L,error:v,isPreviousData:R}=Nt(V,{keepPreviousData:!0},d),b=S==null?void 0:S.responseBody,k=L||R,{data:P}=Ft(i,g);ze(()=>{b&&r&&r(JSON.stringify(b))},[b,r]);const J=b?at(b.facets,b.selectColumns):!0,B=p.useMemo(()=>rt(b,l),[b,l]),z=p.useMemo(()=>{const H=_();return lt(H.query,l)},[_,l]),K=p.useCallback(H=>{var me;return((me=b==null?void 0:b.columnModels)==null?void 0:me.find(Ke=>Ke.name===H))??null},[b==null?void 0:b.columnModels]),E={data:B,currentPage:u,pageSize:C,setPageSize:w,isLoadingNewBundle:k,getLastQueryRequest:_,getInitQueryRequest:T,error:v,entity:P,executeQueryRequest:I,isFacetsAvailable:J,asyncJobStatus:c,goToPage:y,hasResettableFilters:z,removeSelectedFacet:x,removeValueFromSelectedFacet:N,resetQuery:h,removeQueryFilter:f,removeValueFromQueryFilter:F,lockedColumn:l,getColumnModel:K},{children:D}=e;return n(Ne,{queryContext:E,children:n("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${J?"has-facets":""}`,children:D})})}try{Pe.displayName="QueryWrapper",Pe.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function Ht(){return m(q,{children:[n("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),n("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ne=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ne||{});function zt(){return m("div",{className:"text-center",children:[it,n("h4",{children:"No Matching Results"}),n("p",{children:"Try checking the spelling or removing filters."})]})}function Yt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ct,n("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Wt=()=>{try{return JSON.parse(sessionStorage.getItem(gt)||"")}catch{return[]}},Gt=()=>{try{return JSON.parse(sessionStorage.getItem(_t)||"")}catch{return[]}},jt=()=>{try{return JSON.parse(sessionStorage.getItem(Ct)||"")}catch{return[]}},Jt=e=>{const t=Wt().find(a=>a.id===e);return(t==null?void 0:t.name)??e},Kt=e=>{const t=jt().find(a=>a.id===e);return(t==null?void 0:t.name)||e},Zt=e=>{const t=Gt().find(a=>a.ownerId===e);return(t==null?void 0:t.userName)||e},Xt=(e,t)=>{if(e===W)return ce;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return Jt(e);case Q.USERID:case Q.USERID_LIST:return Zt(e);case Q.EVALUATIONID:return Kt(e);default:return e}},G=p.createContext(void 0),Se=({children:e,queryVisualizationContext:t})=>n(G.Provider,{value:t,children:e});function M(){const e=p.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Ae=G.Consumer;function De(e){const{noContentPlaceholderType:t=ne.INTERACTIVE}=e,{data:a,getLastQueryRequest:r,isFacetsAvailable:l,isLoadingNewBundle:s,hasResettableFilters:o}=U(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{l||i(N=>({...N,showFacetFilter:!1,showFacetVisualization:!1}))},[l]),p.useEffect(()=>{s&&I([])},[s]);const[g,T]=p.useState([]),[_,I]=p.useState([]),u=r(),C=st(a==null?void 0:a.selectColumns);p.useEffect(()=>{T((C==null?void 0:C.slice(0,e.visibleColumnCount??1/0).map(N=>N.name))??[])},[C,u.query.sql,e.visibleColumnCount]);const y=p.useCallback(N=>{const f=localStorage.getItem("force-display-original-column-names")==="true";return!N||f?N:c[N]?c[N]:ut(N)},[c]),w=p.useCallback(()=>{switch(t){case ne.INTERACTIVE:return o?n(zt,{}):n(Yt,{});case ne.STATIC:default:return n(Ht,{})}},[t,o]),h={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:g,setColumnsToShowInTable:T,selectedRowIndices:_,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:y,getDisplayValue:Xt,NoContentPlaceholder:w},{children:x}=e;return n(Se,{queryVisualizationContext:h,children:x})}try{De.displayName="QueryVisualizationWrapper",De.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{Se.displayName="QueryVisualizationContextProvider",Se.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{Ae.displayName="QueryVisualizationContextConsumer",Ae.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const Ue=()=>{const{error:e}=U();return n(Ze,{error:e})};try{Ue.displayName="QueryWrapperErrorBanner",Ue.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const be=e=>m("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{be.displayName="IconPlus",be.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const ve=e=>m("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{ve.displayName="IconMinus",ve.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const le=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:r}=M();return m("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:r(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(be,{className:"icon-plus",title:"Expand Menu"}):n(ve,{className:"icon-minus",title:"Collapse Menu"})})]})};try{le.displayName="FacetFilterHeader",le.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function en(e){return e.replace(/\s/g,"").toLowerCase()}function Me(e,t=[],a=[],r=[]){const{value:l}=e;let s=l;l===W&&(s=ce);const o=t.find(i=>i.ownerId===l);o&&(s=o?o.userName:`unknown (${l})`);const c=a.find(i=>i.id===l);c&&(s=c?c.name:`unknown (${l})`);const d=r.find(i=>i.id===l);return d!=null&&d.name&&(s=d.name),`${s}`}function tn(e,t,a){const r=[...e.sort((l,s)=>s.count-l.count)];return t||r.length<=a||r.slice(a).find(l=>l.isSelected)?r:r.splice(0,a)}const j=({facetValues:e,columnModel:t,onClear:a,onChange:r,containerAs:l="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,g]=p.useState(o),[T,_]=p.useState(!1),[I,u]=p.useState(!1),[C,y]=p.useState(""),[w,h]=p.useState(e);ot(()=>{h(e)},[e]);const x=5,N=1500,f=ke.createRef(),F={};let V;const S=e.filter(E=>E.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(E=>E.value):[],v=he({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(E=>E.value):[],b=he({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(E=>E.value):[],P=he({ids:k,type:"EVALUATION_QUEUE"}),J=E=>{const D=E.target.value;if(y(D),d(!0),!D)e.forEach(O=>{O.isSelected=!1}),h(e);else{const O=e.filter(H=>Me(H,v,b,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?H:null);h(O)}};if(!t)return n(q,{});const B=l==="Dropdown",z=m("div",{className:B?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{h(e),u(!1),d(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(Y,{icon:"arrowBack"})})}),C.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var E;y(""),(E=f.current)==null||E.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(Y,{icon:"close"})})}),n("input",{type:"text",placeholder:"Find values",value:C,ref:f,onChange:E=>{J(E)}})]}),!I&&m("div",{className:"EnumFacetFilter__checkAll",children:[n(Ye,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:S,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var E;y(""),u(!0),(E=f.current)==null||E.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(Y,{icon:"search"})})})]})]}),m("div",{children:[w.length>0&&tn(w,c||B,x).map((E,D)=>n(nn,{id:en(E.value),index:D,label:Me(E,v,b,P),count:E.count,isDropdown:B,initialIsSelected:E.isSelected,onChange:O=>{F[E.value]=O,clearTimeout(V),V=setTimeout(()=>{r(F),_(!1)},N)}},`checkLabel${D}`)),!B&&m(q,{children:[!c&&w.length>x&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",w.length,")"]})})}),c&&w.length>x&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),w.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),K=()=>_(!T);return B?s==="SelectBox"?m(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:T,onToggle:K,children:[m(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[S&&"All",!S&&e.filter(E=>E.isSelected).length===1&&e.filter(E=>E.isSelected)[0].value,!S&&e.filter(E=>E.isSelected).length>1&&"Multiple Values Selected"]}),n(A.Menu,{children:z})]}):m(A,{className:"EnumFacetFilter",show:T,onToggle:K,children:[n(ae,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(A.Menu,{children:z})]}):m(q,{children:[n(le,{isCollapsed:i,label:t.name,onClick:E=>g(E)}),n(Oe,{className:"EnumFacetFilter",in:!i,children:z})]})};function nn({id:e,index:t,label:a,count:r,isDropdown:l,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return ke.useEffect(()=>{d(s)},[s]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{l&&(d(!c),o(!c))},children:[n(Ye,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:a},`${e}-${t}`),l&&m("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!l&&n("div",{className:"EnumFacetFilter__count",children:r})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Ee=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:r}=M();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[r(e.columnName),n(Y,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{Ee.displayName="FacetChip",Ee.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const we=e=>{const t="Min value should be less then max value",[a,r]=p.useState(!1),[l,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Qe(e.initialValues.min).format("YYYY-MM-DD"),max:Qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:g},T="number")=>{if(i==null||g===null||g===void 0)return r(!1),!0;if(T==="number"){if(Number(i)>Number(g))return r(!0),!1}else if(Date.parse(i)>Date.parse(g))return r(!0),!1;return r(!1),!0},d=(i,g,T="number")=>{c(i,T)&&g(i)};return m("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:l.min,onChange:({target:i})=>s({min:i.value,max:l.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:l.max,onChange:({target:i})=>s({min:l.min,max:i.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(l,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{we.displayName="Range",we.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const Te=({facetResult:e,columnModel:t,onChange:a,collapsed:r=!1})=>{const[l,s]=p.useState(r),o=[{label:ce,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:g}=e;const T=!i&&!g;i=i||c,g=g||d;const _=t.columnType==="DOUBLE"?"number":"date",I=(h,x)=>x?"":h===W?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",u=(h,x)=>{y(h),h!=="RANGE"&&x([h,h])},[C,y]=p.useState(I(i,T));return m("div",{children:[n(le,{isCollapsed:l,label:t.name,onClick:h=>s(h)}),m(Oe,{in:!l,children:[n(wt,{value:C,id:"rangeSelector",options:o,onChange:h=>u(h,a)}),C==="RANGE"&&(c===d?n("label",{children:d}):m(q,{children:[t.columnType==="INTEGER"&&m(Tt,{domain:[c,d],initialValues:{min:i,max:g},step:1,doUpdateOnApply:!0,onChange:h=>a([h.min,h.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(we,{initialValues:{min:i,max:g},type:_,onChange:h=>a([h.min,h.max])},"Range")]}))]})]})};try{Te.displayName="RangeFacetFilter",Te.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const je=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),an=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},qe=(e,t)=>{var s;const a=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],r=a.findIndex(o=>o.columnName===e.columnName),l=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?l?a.splice(r,1):a[r]=e:a.push(e),a};function se(e,t,a,r,l=!1){r?t.facetValues.forEach(c=>{c.value===r&&(c.isSelected=l)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=je(t),o=qe(s,e);a(o)}const xe=(e,t,a,r)=>{const l=r&&Object.keys(r)||[];l.length&&t.facetValues.forEach(c=>{l.includes(c.value)&&(c.isSelected=r?!!r[c.value]:!1)});const s=je(t),o=qe(s,e);a(o)},rn=(e,t,a,r)=>{t.columnMin=r[0],t.columnMax=r[1];const l=an(t),s=qe(l,e);a(s)};function oe(e,t){const a=(t??[]).map(r=>r.columnName);return new Set([...e.slice(0,3).map(r=>r.columnName),...a])}function ee(){const e=m(xt,{direction:"row",gap:"10px",sx:{my:1},children:[n(te,{width:"15px"}),n(te,{width:"40%"})]});return m(ye,{className:"FacetFilterControls__facet",children:[n(ye,{className:"FacetFilterHeader",children:n(te,{width:"100%"})}),m(ye,{children:[e,e,e]})]})}function ln(){const{topLevelControlsState:e}=M(),{showFacetFilter:t}=e;return m("div",{className:`FacetFilterControls ${t?ue:de}`,children:[n(ee,{}),n(ee,{}),n(ee,{}),n(ee,{})]})}function Ve(e){const{availableFacets:t}=e,{data:a,getLastQueryRequest:r,executeQueryRequest:l}=U(),s=r(),o=a.facets.filter(u=>t==null||t.includes(u.columnName)).filter(u=>!He(u)),[c,d]=ke.useState(oe(o,s.query.selectedFacets)),{topLevelControlsState:i}=M(),{showFacetFilter:g}=i;ze(()=>{d(oe(o,s.query.selectedFacets))},[o]);const T=a.selectColumns,_=u=>{const C=r();C.query.selectedFacets=u,C.query.offset=0,l(C)},I=u=>{const C=new Set(c);C.has(u.columnName)?C.delete(u.columnName):C.add(u.columnName),d(C)};return m("div",{className:`FacetFilterControls ${g?ue:de}`,children:[(o??[]).filter(u=>c.has(u.columnName)).map(u=>{const C=T.find(y=>y.name===u.columnName);return m("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&C&&n(j,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:C,onChange:y=>xe(s,u,_,y),onClear:()=>se(s,u,_)}),u.facetType==="range"&&C&&n(Te,{facetResult:u,columnModel:C,collapsed:!1,onChange:y=>rn(s,u,_,y)})]},u.columnName)}),m("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),o.map(u=>n(Ee,{facet:u,onClick:()=>I(u),isChecked:c.has(u.columnName)},u.columnName))]})]})}function ra(e){const{data:t,isLoadingNewBundle:a}=U();return a?n(ln,{}):t==null||t.facets==null?n(q,{}):n(Ve,{...e})}try{oe.displayName="getDefaultShownFacetFilters",oe.__docgenInfo={description:`Determines which facet filters should be shown after loading a new bundle. The shown facets will be the first
three available facets, plus any other facets that have a filter applied.`,displayName:"getDefaultShownFacetFilters",props:{}}}catch{}try{Ve.displayName="FacetFilterControls",Ve.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{availableFacets:{defaultValue:null,description:"",name:"availableFacets",required:!1,type:{name:"string[]"}}}}}catch{}const sn=Vt(It),on=19,cn=30,un={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},dn=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let r=0;r<t;r++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function Je(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"â€¦":e}async function mn(e,t,a,r,l){var u,C;const{colorPalette:s}=kt(a,e.facetValues.length),o=async(y,w,h)=>{const x=new Map;x.set(W,ce);const N=y.map(f=>f.value).filter(f=>f!==W);if(w===Q.ENTITYID||w===Q.ENTITYID_LIST){const f=await tt(N,h);for(const F of f.results)x.set(F.id,F.name)}else if(w===Q.USERID||w===Q.USERID_LIST){const f=await nt(N,h);for(const F of f.children)x.set(F.ownerId,F.userName)}return y.map(f=>({facet:f,label:c(f,!1,x),truncatedLabel:c(f,!0,x),count:f.count}))},c=(y,w,h)=>{let x=h.get(y.value)??y.value;return w&&(x=Je(x,on)),x},d=await o(e.facetValues,t,l),i=d.map(y=>y.truncatedLabel),T=e.facetValues.some(y=>y.isSelected)?e.facetValues.map((y,w)=>y.isSelected?s[w]:s[w].replace("rgb(","rgba(").replace(")",", 0.25)")):s,_={values:r==="PIE"?e.facetValues.map(y=>y.count):void 0,labels:d.map(y=>y.label),text:i,x:r==="BAR"?e.facetValues.map(y=>{var w;return((w=d.find(h=>h.facet===y))==null?void 0:w.label)??y.value}):void 0,y:r==="BAR"?e.facetValues.map(y=>y.count):void 0,facetEnumerationValues:e.facetValues.map(y=>y.value),name:e.columnName,hovertemplate:r==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:r==="PIE"?"pie":"bar",pull:r==="PIE"?e.facetValues.map(y=>y.isSelected?.1:0):void 0,marker:{colors:r==="PIE"?T:void 0,color:r==="BAR"?T:void 0}};return{data:[_],labels:d,colors:r==="PIE"?(u=_.marker)==null?void 0:u.colors:(C=_.marker)==null?void 0:C.color}}const pn=(e,t,a)=>{if(e.points&&e.points[0]){const r=e.points[0],l=r.data.facetEnumerationValues[r.pointNumber],s=t.facetValues.find(o=>o.value===l);a(t,s,!s.isSelected)}};function hn(e,t,a){const l=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?l:l/3;return s>a&&(s=a),{width:`${l}px`,height:`${s}px`}}function Ie(e){const{labels:t,colors:a=[],isExpanded:r}=e;if(!t)return n(q,{});const l=r?Math.min(t.length,9):Math.min(t.length,3);if(l===0)return n(q,{});const s=t.reduce((o,c)=>o+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${r?"--expanded":""}`,children:t.slice(0,l).map((o,c)=>{const i=`(${dn(o.count/s,1)}) ${o.label}`,g=Je(i,cn);return n(ae,{tooltipText:o.label,children:m("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[c]}}),n("label",{children:g})]},`legendLabel_${c}`)},o.label)})})}const yn=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",ie=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:r,applyChangesToGraphSlice:l,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=Xe(),{data:g,isLoadingNewBundle:T,getLastQueryRequest:_}=U(),{getColumnDisplayName:I}=M(),[u,C]=p.useState(!1),y=I(o.columnName),w=p.useCallback(()=>{var N,f;return(f=(N=g==null?void 0:g.columnModels)==null?void 0:N.find(F=>F.name===o.columnName))==null?void 0:f.columnType},[g,o.columnName]),{data:h}=et(["extractPlotDataArray",o,w(),s,c,i],()=>mn(o,w(),s,c,i),{enabled:!!o}),x=()=>m("div",{onClick:N=>{N.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(A,{children:[n(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(A.Menu,{className:"chart-tools",children:[n(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),n(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!g&&T||!o?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:qt}):m(q,{children:[m(X,{animation:!1,show:u,onHide:()=>C(!1),backdrop:"static",children:[n(X.Header,{closeButton:!0,children:n(X.Title,{children:y??""})}),m(X.Body,{children:[n(ie,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(We,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>C(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&m("div",{className:"FacetNavPanel__title",children:[!g&&T?n(re,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:y}),m("div",{className:"FacetNavPanel__title__tools",children:[n(j,{facetValues:o.facetValues,columnModel:g==null?void 0:g.columnModels.find(N=>N.name===o.columnName),onChange:N=>{xe(_(),o,r,N)},onClear:()=>{se(_(),o,r)},containerAs:"Dropdown"}),n(ae,{tooltipText:"Expand to large graph",callbackFn:()=>C(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(ae,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&m(q,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(j,{facetValues:o.facetValues,columnModel:g==null?void 0:g.columnModels.find(N=>N.name===o.columnName),onChange:N=>{xe(_(),o,r,N)},onClear:()=>{se(_(),o,r)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(Qt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Et,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(x,{})]}),m("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,role:"graphics-object",children:[n(Rt.SizeMe,{monitorHeight:!0,children:({size:N})=>n("div",{className:yn(a,c),children:n(sn,{layout:un,data:(h==null?void 0:h.data)??[],style:hn(N.width,c,a?300:150),config:{displayModeBar:!1},onClick:f=>pn(f,o,l)},`${o.columnName}-${c}-${N.width}`)})}),n(Ie,{labels:h==null?void 0:h.labels,colors:h==null?void 0:h.colors,isExpanded:a})]})]})]})};try{Ie.displayName="FacetPlotLegend",Ie.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{ie.displayName="FacetNavPanel",ie.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function fn(e,t,a){const r=t.getColumnModel(e.columnName);return e.values.map(l=>{let s=l;l!=null&&l.startsWith("%")&&(l!=null&&l.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=a.getDisplayValue(s,r.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${l}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,l)}}})}function gn(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function _n(e,t,a){var r;return _e(e)||Ce(e)?e.columnName===((r=t.lockedColumn)==null?void 0:r.columnName)?[]:fn(e,t,a):vt(e)?[gn(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function Cn(e,t,a){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const r=t.getColumnModel(e.columnName),{getColumnDisplayName:l,getDisplayValue:s}=a;if(Fe(e))return e.facetValues.map(c=>{const d=s(c,r.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${l(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Dt(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${l(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function Fn(){var c;const e=U(),t=M(),{getLastQueryRequest:a}=e,r=a(),l=(((c=r.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>_n(d,e,t)),s=(r.query.selectedFacets??[]).flatMap(d=>Cn(d,e,t)),o=[...l,...s];return n(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(Lt,{...d,key:i})})})}function Re(e){const{style:t,frontText:a,endText:r="",hideIfUnfiltered:l=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=U(),{topLevelControlsState:g,unitDescription:T}=M(),_=s==null?void 0:s.queryCount,I=g==null?void 0:g.showFacetFilter,u=i;return d?n(q,{}):n("div",{className:`TotalQueryResults ${I?ue:de} ${i?"hasFilters":""}`,style:t,children:o?n(re,{width:100}):m(q,{children:[(i||!l)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[a," ",_==null?void 0:_.toLocaleString()," ",T," ",r]}),u&&m("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[n(Y,{icon:"deleteSweep"}),"Clear all filters"]})]}),n("div",{className:"TotalQueryResults__selections",children:n(Fn,{})})]})})}try{Re.displayName="TotalQueryResults",Re.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const fe=2;function ge(e,t){var r;return((r=e==null?void 0:e.facets)==null?void 0:r.filter(l=>l.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(l.columnName)>-1)&&l.facetValues.length>0&&!He(l)))??[]}const Be=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:r,executeQueryRequest:l,error:s,asyncJobStatus:o}=U(),{topLevelControlsState:c}=M(),[d,i]=p.useState([]),[g,T]=p.useState(!0),{showFacetVisualization:_,showFacetFilter:I}=c,u=a();p.useEffect(()=>{const v=ge(t,e);v.length!==0&&g&&(i(v.map((R,b)=>({name:R.columnName,isHidden:b>=fe,plotType:"PIE"}))),T(!1))},[t,g,e]);const C=v=>{i(R=>R.map((b,k)=>v?{...b,isHidden:!1}:{...b,isHidden:k>=fe}))},y=v=>{u.query.selectedFacets=v,u.query.offset=0,l(u)},w=v=>d.find(k=>k.name===v&&k.isHidden===!0)!==void 0,h=p.useMemo(()=>d.find(v=>v.isHidden===!0)?"MORE":d.length<=fe?"NONE":"LESS",[d]),x=v=>{F(v,"isHidden",!0)},N=(v,R)=>{F(v,"plotType",R)},f=v=>{var b;return((b=d.find(k=>k.name===v))==null?void 0:b.plotType)??"PIE"},F=(v,R,b)=>{i(k=>k.map(P=>P.name===v?{...P,[R]:b}:P))},V=ge(t,e),S=ge(t,e).map((v,R)=>({columnName:v.columnName,colorIndex:R})),L=(u==null?void 0:u.query.selectedFacets)!==void 0&&u.query.selectedFacets.length>0||(u==null?void 0:u.query.additionalFilters)!==void 0&&(u==null?void 0:u.query.additionalFilters.length)>0;return s?n(q,{}):!t&&r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&m("div",{children:[n("span",{className:"spinner"}),o.progressMessage]})}):m(q,{children:[n(Re,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),V.length>0&&m("div",{className:`FacetNav ${_?"":"hidden"} ${I?ue:de} ${h==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:V.map(v=>{var R;return n("div",{className:"col-sm-12 col-md-4",style:{display:w(v.columnName)?"none":"block"},children:n(ie,{index:(R=S.find(b=>b.columnName===v.columnName))==null?void 0:R.colorIndex,onHide:()=>x(v.columnName),plotType:f(v.columnName),onSetPlotType:b=>N(v.columnName,b),facetToPlot:v,applyChangesToFacetFilter:y,applyChangesToGraphSlice:(b,k,P)=>se(u,b,y,k==null?void 0:k.value,P),isModalView:!1})},v.columnName)})}),h!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(We,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>C(h==="MORE"),style:{zIndex:500},children:h==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Be.displayName="FacetNav",Be.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{j as E,ra as F,ve as I,ne as N,ue as Q,re as S,Re as T,de as a,M as b,Ot as c,Ne as d,De as e,Le as f,aa as g,na as h,xe as i,se as j,Ae as k,Ue as l,Be as m,Pe as n,ge as o,mn as p,hn as q,Ie as r,be as s,U as u};
//# sourceMappingURL=FacetNav-3ff471f6.js.map
