import{r as a,iO as U,F as P,j as e,c4 as h,dZ as S,V as m,X as _,bV as M,c6 as O}from"./iframe-CV5uF1_e.js";import{r as H,w as k}from"./useAccessRequirements-DYB9COxg.js";import{U as B}from"./UploadDocumentField-Dx3C-aNK.js";import{A as V,a as N}from"./SetBasicAccessRequirementFields-DqQ6meYF.js";import{F as o}from"./FormControlLabel-BDjFPPQX.js";import{C as d}from"./Checkbox-C2-C51xv.js";const $="There was an error uploading the DUC template. ",x=n=>{if(n==="")return 0;const l="Please enter a valid expiration period (in days): ";if(/^[-]?\d+$/.test(n)){const c=Number(n);return c<0?`${l}If expiration period is set, then it must be greater than 0.`:c*U}return`${l}For input string: "${n}"`},v=a.forwardRef(function(l,c){const{accessRequirementId:D,onSave:T,onError:f}=l,{data:u,error:R}=H(D,{staleTime:1/0});a.useEffect(()=>{u&&(i(u),I((u.expirationPeriod/U).toString()))},[u]);const[q,A]=a.useState(null),[j,g]=a.useState(null),[r,i]=a.useState(null),[p,I]=a.useState(""),y=a.useMemo(()=>{if(r?.ducTemplateFileHandleId)return{fileHandleId:r.ducTemplateFileHandleId,associateObjectType:P.AccessRequirementAttachment,associateObjectId:r.id.toString()}},[r?.ducTemplateFileHandleId,r?.id]),F=s=>{if(s.resp&&s.success&&r){A(null);const t=s.resp;i({...r,ducTemplateFileHandleId:t.fileHandleId})}else!s.success&&s.error&&A(`${$} ${s.error.reason}`)},{mutate:E,isPending:C,error:b}=k({onSuccess:()=>T(),onError:()=>f()});return a.useImperativeHandle(c,()=>({save(){if(r){const s=x(p);typeof s=="string"?(g(s),f()):E({...r,expirationPeriod:s})}}}),[p,r,E,f]),r?e.jsxs(e.Fragment,{children:[e.jsx(V,{accessRequirement:r}),e.jsxs(m,{children:[e.jsx(_,{sx:{bgcolor:"#f5f5f5",borderBottom:"1px solid #ddd",color:"#333",px:2,py:1},children:"Data Access Request Parameters"}),e.jsxs(m,{sx:{mt:2,mb:4},children:[e.jsx(N,{accessRequirement:r,onChange:s=>i(s)}),e.jsxs(m,{sx:{mb:2},children:[e.jsx(_,{variant:"body1",sx:{fontWeight:700},children:"DUC"}),e.jsx(o,{control:e.jsx(d,{}),label:"DUC is required.",checked:r.isDUCRequired,onChange:(s,t)=>i({...r,isDUCRequired:t})}),e.jsxs(M,{children:[e.jsx(B,{id:"duc",isLoading:C,uploadCallback:s=>F(s),documentName:"Template DUC",fileHandleAssociations:y?[y]:void 0,isMultiFileUpload:!1,uploadBtnVariant:"contained"}),q&&e.jsx(h,{severity:"error",sx:{marginTop:2},children:q})]}),e.jsx(o,{label:"IRB approval is required.",checked:r.isIRBApprovalRequired,control:e.jsx(d,{}),onChange:(s,t)=>i({...r,isIRBApprovalRequired:t}),sx:{ml:0}}),e.jsx(o,{control:e.jsx(d,{}),label:"Other documents are required.",checked:r.areOtherAttachmentsRequired,onChange:(s,t)=>i({...r,areOtherAttachmentsRequired:t})}),e.jsx(O,{id:"expirationPeriod",name:"expirationPeriod",label:"Expiration period (days)",value:p,error:!!j,helperText:j,sx:{mt:1},fullWidth:!0,onChange:s=>{g(null),I(s.target.value)},onBlur:()=>{const s=x(p);typeof s=="string"&&g(s)}}),e.jsxs(m,{sx:{mt:1},children:[e.jsx(o,{control:e.jsx(d,{}),label:"Intended Data Use statement is required.",checked:r.isIDURequired,onChange:(s,t)=>{i(t?{...r,isIDURequired:!0}:{...r,isIDURequired:!1,isIDUPublic:!1})}}),e.jsx(o,{control:e.jsx(d,{}),label:"Intended Data Use statements will be publicly available.",checked:r.isIDUPublic,disabled:!r.isIDURequired,onChange:(s,t)=>i({...r,isIDUPublic:t})})]})]})]})]}),b&&e.jsx(h,{severity:"error",sx:{marginTop:2},children:b.reason})]}):R?e.jsx(h,{severity:"error",children:R.reason}):e.jsx(S,{})});try{x.displayName="getValidExpirationPeriodOrErrorMessage",x.__docgenInfo={description:"",displayName:"getValidExpirationPeriodOrErrorMessage",props:{}}}catch{}try{v.displayName="SetManagedAccessRequirementFields",v.__docgenInfo={description:"",displayName:"SetManagedAccessRequirementFields",props:{accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!0,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"() => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{v as S};
