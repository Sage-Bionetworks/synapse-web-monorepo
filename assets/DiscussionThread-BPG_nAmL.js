import{j as e}from"./jsx-runtime-d_jSGfuW.js";import{m as q,aW as ue}from"./useFiles-Dsa3u--j.js";import{O as H,r as O}from"./VerificationSubmission-DsgC4t7y.js";import{u as $,A as pe}from"./useEntityBundle-Bmh0n-e4.js";import{f as me}from"./StringUtils-tNCAfVhp.js";import{S as fe}from"./SynapseConstants-BmRSEcUC.js";import{r}from"./index-CsMIurHC.js";import"./OrientationBanner-B-arf4vv.js";import{u as he,a as xe,F as I,b as ye}from"./ForumThreadEditor-BOvA0dUu.js";import{c as je,d as ge,e as be}from"./useThread-bX3bQAT2.js";import{a as we}from"./useSubscription-D2LdQCDs.js";import{f as V}from"./DateFormatter-BiEPs3tR.js";import{d as X}from"./dayjs.min-h1P3Bc9m.js";import{C as Ce}from"./ConfirmationDialog-ClxZqXIf.js";import{I as l}from"./IconSvg-6kXIY0Li.js";import{M as z}from"./MarkdownSynapse-Bplz6Xi1.js";import{W as A}from"./WarningDialog-Dw0ziRQq.js";import{d as C}from"./ToastMessage-Yb-tjj0l.js";import{U as K}from"./UserBadge-DZKd56rw.js";import{S as Se}from"./SkeletonTable-8F8y6Hkc.js";import{B as h}from"./Box-0w0QXb9q.js";import{S as Te}from"./SubscribersModal-DRZsXFP0.js";import{a as Re}from"./useForum-BrTTJjcJ.js";import{B as M}from"./Button-S6YMXMba.js";import{T as G}from"./Typography-DI7kYxjv.js";import{T as P}from"./TextField-Bzr3Ms3F.js";const N="replyid",Me=a=>{const x=`${`${window.location.origin}${window.location.pathname}`}?${N}=${a}`;me(x).then(()=>C("Reply link copied to clipboard","info"))};function v(a){const{reply:t,isReplyAuthorModerator:x=!1}=a,[c,u]=r.useState(!1),[S,y]=r.useState(!1),{data:p}=q(),{data:j}=$(t.projectId),{data:m,isLoading:k}=he(t),i=r.useRef(null),{mutate:B}=xe({onSuccess:()=>{y(!1),C("A reply has been deleted.","info")}}),g=t.createdBy==(p==null?void 0:p.ownerId);return r.useEffect(()=>{const d=new URLSearchParams(window.location.search).get(N);let b;return d===t.id&&i.current&&(i.current.style.transition="background-color 1s ease",i.current.style.backgroundColor="#fbf4e0",i.current.style.borderColor="#f4dda3",b=setTimeout(()=>{i.current&&(i.current.style.backgroundColor="#f9f9f9",i.current.style.borderColor="#ccc")},2e3)),()=>{b&&clearTimeout(b)}},[t.id]),e.jsx("div",{className:"reply-container",id:`reply._${t.id}`,ref:i,children:k?e.jsx(Se,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(K,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:x}),e.jsxs("div",{className:"message-body",children:[e.jsx(z,{markdown:m,objectType:H.REPLY}),e.jsxs("span",{children:["posted ",V(X(t.createdOn),"M/D/YYYY")]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[e.jsx("button",{onClick:()=>Me(t.id),children:e.jsx(l,{icon:"link",label:"Copy link to this reply"})}),g&&e.jsx("button",{onClick:()=>u(!0),children:e.jsx(l,{icon:"edit"})}),(j==null?void 0:j.permissions.canModerate)&&e.jsx("button",{onClick:()=>y(!0),children:e.jsx(l,{icon:"delete"})})]})]})]}),e.jsx(I,{isReply:!0,initialText:m,onClose:()=>u(!1),id:t.id,isDialog:!0,openDialog:c}),e.jsx(A,{open:S,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{y(!1)},onConfirm:()=>B({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{v.displayName="DiscussionReply",v.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const Ie="You are following this topic. Click to stop following.",ke="You are not following this topic. Click to follow.",Be="You will need to sign in for access to that resource",W="Write a reply...";function U(a){const{threadId:t,limit:x}=a,c="16px",[u,S]=r.useState(!0),[y,p]=r.useState(!1),[j,m]=r.useState(!1),[k,i]=r.useState(!1),[B,g]=r.useState(!1),[L,d]=r.useState(!1),[b,D]=r.useState(!1),[J,Q]=r.useState(!1),{threadData:o,threadBody:_,togglePin:Z}=je(t),{data:n}=q(),{data:E}=$((o==null?void 0:o.projectId)??"",void 0,pe,{enabled:!!o}),{subscription:F,toggleSubscribed:ee,isLoading:oe}=we(t,O.THREAD),{mutate:te}=ge({onSuccess:()=>{g(!1),C("A thread has been deleted.","info")}}),{mutate:se}=be({onSuccess:()=>{D(!1),C("A thread has been restored.","info")}}),re=(o==null?void 0:o.createdBy)==(n==null?void 0:n.ownerId);function ne(){if((n==null?void 0:n.userName)=="anonymous")d(!0);else try{ee()}catch(s){C(s.reason,"danger")}}const{data:T,hasNextPage:ie,fetchNextPage:le}=ye(t,u,x),{data:f}=Re((o==null?void 0:o.forumId)??""),ae=f==null?void 0:f.results.includes((o==null?void 0:o.createdBy)??""),[R,de]=ue(N),Y=r.useMemo(()=>{const s=(T==null?void 0:T.pages.flatMap(w=>w.results))??[];return R?s.filter(w=>w.id===R):s},[T,R]),ce=()=>{de(null)};return e.jsxs("div",{className:"DiscussionThread",children:[o&&_?e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:s=>({textAlign:"center",[s.breakpoints.down("sm")]:{display:"flex",marginBottom:c,button:{whiteSpace:"nowrap"}}}),children:[e.jsx(M,{variant:u?"contained":"outlined",onClick:()=>S(!0),children:"Date Posted"}),e.jsx(M,{variant:u?"outlined":"contained",onClick:()=>S(!1),children:"Most Recent"})]}),e.jsx(K,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:ae}),e.jsxs(h,{sx:s=>({[s.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:c,marginTop:c,".SubscribersModal":{justifyContent:"flex-start",marginBottom:c}}}),children:[e.jsx(G,{sx:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(Te,{id:t,objectType:O.THREAD,showModal:J,handleModal:Q})]}),e.jsx("div",{children:e.jsx(z,{markdown:_,objectType:H.THREAD})}),e.jsxs("span",{children:["posted ",V(X(o.createdOn),"M/D/YYYY")]}),e.jsx(I,{isReply:!1,initialText:_,onClose:()=>p(!1),initialTitle:o==null?void 0:o.title,id:t,isDialog:!0,openDialog:y})]}):e.jsx(e.Fragment,{}),e.jsx(h,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>D(!0),children:e.jsx(l,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":F?"Unfollow thread":"Follow thread",disabled:oe,onClick:()=>ne(),children:F?e.jsx(l,{icon:"visibility",label:Ie}):e.jsx(l,{icon:"visibilityOff",label:ke})})}),re&&e.jsx("button",{onClick:()=>p(!0),children:e.jsx(l,{icon:"edit",label:"Edit thread"})}),E!=null&&E.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(!0),children:e.jsx(l,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>Z(),children:o!=null&&o.isPinned?e.jsx(l,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(l,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(h,{sx:{mt:2,mb:3},children:j?e.jsx(I,{id:t,isReply:!0,onClose:()=>m(!1),isDialog:!1}):e.jsx(P,{fullWidth:!0,placeholder:W,onClick:()=>{(n==null?void 0:n.userName)=="anonymous"?d(!0):m(!0)}})}),R&&e.jsxs(M,{variant:"outlined",onClick:ce,sx:{display:"flex",alignItems:"center",padding:"2px 8px",marginBottom:"12px",gap:"4px"},children:[e.jsx(l,{icon:"arrowBack",sx:{width:"16px"}}),e.jsx(G,{variant:"smallText2",children:"Show all replies"})]}),e.jsx("div",{children:Y.map(s=>{const w=f==null?void 0:f.results.includes(s.createdBy);return e.jsx(v,{reply:s,isReplyAuthorModerator:w},s.id)})}),Y.length>0&&e.jsx(h,{sx:s=>({mt:2,mb:3,[s.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:k?e.jsx(I,{id:t,isReply:!0,onClose:()=>i(!1),isDialog:!1}):e.jsx(P,{fullWidth:!0,placeholder:W,onClick:()=>{(n==null?void 0:n.userName)=="anonymous"?d(!0):i(!0)}})}),ie?e.jsx(M,{variant:"outlined",onClick:()=>{le()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(A,{open:B,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>g(!1),onConfirm:()=>o&&te(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(A,{open:b,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>D(!1),onConfirm:()=>o&&se(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(Ce,{open:L,title:"Sign In Required",content:Be,onCancel:()=>d(!1),hasCancelButton:!1,onConfirm:()=>d(!1),confirmButtonProps:{children:"Sign In",className:fe}})]})}try{U.displayName="DiscussionThread",U.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{U as D};
