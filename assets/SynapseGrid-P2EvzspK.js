import{i_ as Od,i$ as Fi,da as Se,r as P,g_ as Ed,j0 as kd,j1 as Ad,j2 as Nd,ie as Ui,j,B as ll,an as We,aI as be,J as ye,c1 as xd,j3 as Rd,j4 as Id,j5 as Td,aH as dl,dc as jd,j6 as Pd,dj as Md,d0 as qd,j7 as Bd,j8 as Vd,bB as ze,c3 as Jd,ek as M,hX as Ld,cv as Gi,c9 as ve,c6 as Dd,ag as Fd,ay as Ud}from"./iframe-z21gSILm.js";import"./ErrorPage-DYj-4PkL.js";import"./AccessTokenPage-SfFofTV6.js";import"./AccountLevelBadges-BZouD7UG.js";import"./CardContainerLogic-I80FDuKM.js";import"./RowDataTable-BfICCH4S.js";import"./RowDataTableWithQuery-Cw85LnJm.js";import"./MarkdownPopover-BmUk5Bqy.js";import"./SkeletonButton-Q38ELWwJ.js";import"./SkeletonInlineBlock-DuFis4qM.js";import{S as Gd}from"./SkeletonTable-HmkSCDv0.js";import"./SkeletonParagraph-DwVqH0kg.js";import"./CertificationAnswer-CwBiowQf.js";import"./ChallengeDetailPage-DUPf6KMN.js";import"./index-BBKx2UiU.js";import"./AvailableEvaluationQueueList-BvAJ2A_S.js";import"./ChallengeSubmission-CWFYkPp0.js";import"./ChangePassword-B1dMVuRX.js";import"./ChangePasswordWithToken-BnvAmIVv.js";import"./ConfirmationDialog-C8lFb7mH.js";import"./CookiesNotification-yemcJL-X.js";import"./DownloadCartPage-BBTq-6WE.js";import"./ShowDownloadV2-BWsGvc5F.js";import"./DynamicForm-hgQXWqWq.js";import"./EntityBadgeIcons-zBgjl1I3.js";import"./EntityFinder-CZQW5IEO.js";import"./EvaluationCard-DqcRFUQ6.js";import"./EvaluationEditorPage-Dn64oE2_.js";import"./ExperimentalMode-CPlcBNuz.js";import"./FileUpload-ChWeZegG.js";import"./FeaturedDataTabs-NVA02aRR.js";import"./FeaturedToolsList-DDGFaqLS.js";import"./DiscussionThread-3hAlV_AK.js";import"./ForumPage-CPOSEiqL.js";import"./SynapseCardLabel-HNA8kJ8p.js";import"./GenericCard-qSzaLEec.js";import"./HeaderCardV2-B9XgHwVl.js";import"./CardUtils-ypvvJKy2.js";import"./Goals-DgRod6rB.js";import"./GoalsV2-B5ClWAco.js";import"./GoogleMap-D1Lz2xUR.js";import"./HasAccessV2-CoCjiMux.js";import"./Icon-C_HtzVj0.js";import"./MarkdownCollapse-BEWbRcC3.js";import"./MarkdownEditor-CghM5qww.js";import"./MarkdownGithub-Dr7__aBQ.js";import"./ModalDownload-DdZVOu62.js";import"./InfiniteTableLayout-fGfL_hHU.js";import"./CopyToClipboardInput-PRGPKsWj.js";import"./DialogBase-DQK4XqJC.js";import"./WarningDialog-BRSmms4A.js";import"./ColumnHeader-CV7qpd_q.js";import"./StyledTanStackTable-DWB-xZ2i.js";import"./OAuthAclEditorModal-CHPajrWB.js";import"./ThemesPlot-BjyUy6u1.js";import"./UpsetPlot-DmqPwLps.js";import"./SynapsePlot-DfutO_S6.js";import"./Programs-t2KcO7ob.js";import"./ProvenanceGraph-Ccr5HogL.js";import"./ProjectDataAvailability-Dz4WWm6c.js";import"./QueryContext-DPiclcxV.js";import"./QueryCount-BOxgpoQX.js";import"./QueryWrapper-Ds9ajgUD.js";import"./RegisterPageLogoutPrompt-xV5NqoJb.js";import"./RenderIfInView-CDEpLe-W.js";import"./Resources-DmQZraNL.js";import"./AccessRequirementAclEditor-CL5AF1ed.js";import"./RssFeedCards-C4rS3HKr.js";import"./ShowMore-B4gv2aJa.js";import"./LightTooltip-S0tAvjiv.js";import"./WideButton-DdY_HAs7.js";import"./InputSizedButton-Cb6w9PuW.js";import"./DropdownSelect-yDIJC32A.js";import"./SubscriptionItem-B1tuIBdK.js";import"./SubsectionRowRenderer-De322XE6.js";import"./SynapseFormWrapper-le4X4XF1.js";import"./SynapseFormSubmissionGrid-hjLN4x4q.js";import"./SynapseTable-BF7iznjB.js";import{u as Hd,S as zd,a as Wd}from"./SynapseChat-DgOURtuC.js";import"./TableFeedCards-CPUPWs6s.js";import"./TermsAndConditions-q2MVPHg6.js";import"./UserBadge-nSpluHjM.js";import"./UserCardListRotate-C_cVZ9v9.js";import"./UserCardListGroups-BAnvuQE2.js";import"./UserOrTeamBadge-VdPS--Jh.js";import"./UserProfileLinks-CmKBZ1Hj.js";import"./EntityHeaderTable-DeudlkRE.js";import"./AccessRequirementRelatedProjectsList-CbWRGNR-.js";import"./HelpPopover-Boy-nK2n.js";import"./SageResourcesPopover-abSKxBRQ.js";import"./RecentPublicationsGrid-DiDOzpfO.js";import"./ImageCardGridWithLinks-sqUL1uAk.js";import"./PortalFeatureHighlights-DAXAdWVR.js";import"./CreatePortalModal-DF3hNc-u.js";import"./PortalSectionHeader-DMpbfryK.js";import{C as Kd}from"./CsvPreviewDialog-BLhEHpcA.js";import{w as Ar}from"./waitForAsyncResult-CVac7f0I.js";import{u as Yd}from"./upperFirst-CwuAAFJV.js";import{u as Nr,r as Xd}from"./useEntity-DnU3C6M5.js";import{b as Hi}from"./useSchema-44hzelmi.js";import{G as Qd,p as Zd,D as $d,r as ef}from"./DataGrid-Dli5EeAQ.js";import{e as tf}from"./useUserBundle-Bi_03OP-.js";import{B as zi,P as nf}from"./enums-Rgo4j3BR.js";import{a as rf,d as ae}from"./index-Chi_LkuB.js";import{g as sf}from"./_baseIteratee-K4gGkGhX.js";import{t as of}from"./useUploadFiles-D5N-qIW0.js";import{D as cf}from"./DraggableDialog-qrWPnq7Z.js";import{K as Wi}from"./KeyboardArrowDown-Ba7y3ncz.js";import{M as sr}from"./MenuItem-BqzvmG8S.js";import{u as af,a as uf,b as lf,c as df}from"./useGridSession-TtC_iXt2.js";import{A as ff}from"./Autocomplete-DqbspXHB.js";import{G as ee}from"./Grid-ZG61elFB.js";import{C as hf}from"./CertificationRequirement-B4DdwbBm.js";var Lr=function(){return Od.Date.now()},pf="Expected a function",mf=Math.max,bf=Math.min;function gf(e,t,d){var a,n,l,r,c,s,o=0,i=!1,f=!1,m=!0;if(typeof e!="function")throw new TypeError(pf);t=Fi(t)||0,Se(d)&&(i=!!d.leading,f="maxWait"in d,l=f?mf(Fi(d.maxWait)||0,t):l,m="trailing"in d?!!d.trailing:m);function p(C){var O=a,k=n;return a=n=void 0,o=C,r=e.apply(k,O),r}function v(C){return o=C,c=setTimeout(u,t),i?p(C):r}function y(C){var O=C-s,k=C-o,S=t-O;return f?bf(S,l-k):S}function b(C){var O=C-s,k=C-o;return s===void 0||O>=t||O<0||f&&k>=l}function u(){var C=Lr();if(b(C))return h(C);c=setTimeout(u,y(C))}function h(C){return c=void 0,m&&a?p(C):(a=n=void 0,r)}function w(){c!==void 0&&clearTimeout(c),o=0,a=s=n=c=void 0}function g(){return c===void 0?r:h(Lr())}function _(){var C=Lr(),O=b(C);if(a=arguments,n=this,s=C,O){if(c===void 0)return v(s);if(f)return clearTimeout(c),c=setTimeout(u,t),p(s)}return c===void 0&&(c=setTimeout(u,t)),r}return _.cancel=w,_.flush=g,_}var yf="Expected a function";function vf(e,t,d){var a=!0,n=!0;if(typeof e!="function")throw new TypeError(yf);return Se(d)&&(a="leading"in d?!1:a,n="trailing"in d?!0:n),gf(e,t,{leading:a,maxWait:t,trailing:n})}function wf(e=!1){const t=P.useRef(e),d=P.useCallback(()=>t.current,[]);return P.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),d}function _f(e){P.useEffect(()=>{e()},[])}function Cf(e,...t){const d=wf(),a=Ed(t[1]),n=P.useMemo(()=>function(...l){d()&&(typeof a.current=="function"?a.current.apply(this,l):typeof a.current.handleEvent=="function"&&a.current.handleEvent.apply(this,l))},[]);P.useEffect(()=>{const l=Sf(e)?e.current:e;if(!l)return;const r=t.slice(2);return kd(l,t[0],n,...r),()=>{Ad(l,t[0],n,...r)}},[e,t[0]])}function Sf(e){return e!==null&&typeof e=="object"&&Nd(e,"current")}const Dr=()=>document.visibilityState==="visible";function Of(e=!0){const[t,d]=P.useState(Ui&&e?Dr():void 0);return _f(()=>{e||d(Dr())}),Cf(Ui?document:null,"visibilitychange",()=>{d(Dr())}),t}const Ef="_button_185qd_17",kf={button:Ef};function Ue(e){return j.jsx(ll,{...e,className:kf.button})}try{Ue.displayName="GridMenuButton",Ue.__docgenInfo={description:"",displayName:"GridMenuButton",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function Af(e){const{synapseClient:t}=We();return be({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridImportCsvAsyncStart({gridCsvImportRequest:d});return(await Ar(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function pi({createdCount:e=0,updatedCount:t=0}){let d="";return e>0&&(d+=`created ${e.toLocaleString()} rows`),e>0&&t>0?d+=" and ":t==0&&(d+="."),t>0&&(d+=`updated ${t.toLocaleString()} rows.`),Yd(d)}function mi(e){const{gridSessionId:t,open:d,onClose:a,onComplete:n}=e,{mutate:l,isPending:r,error:c}=Af({onSuccess:s=>{ye(pi(s),"success",{title:"Data imported successfully"}),n()}});return j.jsx(Kd,{open:d,onClose:a,onConfirm:(s,o,i)=>{l({concreteType:"org.sagebionetworks.repo.model.grid.GridCsvImportRequest",sessionId:t,fileHandleId:s,csvDescriptor:i,schema:o})},errorMessage:c?.message,confirmIsPending:r})}try{pi.displayName="getUpdateMessage",pi.__docgenInfo={description:"",displayName:"getUpdateMessage",props:{concreteType:{defaultValue:null,description:"@memberof GridCsvImportResponse",name:"concreteType",required:!0,type:{name:"{string}"}},sessionId:{defaultValue:null,description:`The grid session ID.
@memberof GridCsvImportResponse`,name:"sessionId",required:!1,type:{name:"{string}"}},totalCount:{defaultValue:null,description:`The total number of processed rows.
@memberof GridCsvImportResponse`,name:"totalCount",required:!1,type:{name:"{number}"}},createdCount:{defaultValue:{value:"0"},description:`The number of newly created rows in the grid.
@memberof GridCsvImportResponse`,name:"createdCount",required:!1,type:{name:"{number}"}},updatedCount:{defaultValue:{value:"0"},description:`The number of updated rows in the grid.
@memberof GridCsvImportResponse`,name:"updatedCount",required:!1,type:{name:"{number}"}}}}}catch{}try{mi.displayName="UploadCsvToGridDialog",mi.__docgenInfo={description:"",displayName:"UploadCsvToGridDialog",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onComplete:{defaultValue:null,description:"",name:"onComplete",required:!0,type:{name:"() => void"}}}}}catch{}function bi(e){const{sourceEntityId:t,gridSessionId:d}=e,[a,n]=P.useState(!1),{data:l,isLoading:r}=Nr(t);return r?j.jsx(xd,{variant:"rectangular",width:100}):l&&!Rd(l)?null:j.jsxs(j.Fragment,{children:[a&&j.jsx(mi,{gridSessionId:d,open:a,onClose:()=>n(!1),onComplete:()=>n(!1)}),j.jsx(Ue,{onClick:()=>{n(!0)},variant:"outlined",startIcon:j.jsx(Id,{}),children:"Upload"})]})}try{bi.displayName="UploadCsvToGridButton",bi.__docgenInfo={description:"",displayName:"UploadCsvToGridButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}const Nf=Object.prototype;function ir(e){for(const t in e)if(Nf.hasOwnProperty.call(e,t))return!1;return!0}const xf=["array","boolean","integer","null","number","object","string"];new Set(xf);const Rf=["$defs","definitions","properties","patternProperties","dependencies"];new Set(Rf);const If=["items","allOf","oneOf","anyOf"];new Set(If);const Tf=["items","additionalItems","additionalProperties","propertyNames","contains","if","then","else","not"];new Set(Tf);function Or(e){return typeof e=="object"}function me(e){return Or(e)?ir(e):e===!0}function He(e,t){return e<t?-1:e>t?1:0}function Fr(e,t){const d=e.length;if(d===0)return t;let a=t.length;if(a===0)return e;if(d<a){const l=e;e=t,t=l,a=d}const n=new Set(e);for(let l=0;l<a;l++)n.add(t[l]);return Array.from(n)}function jf(e,t){const d=[];if(e.length===0||t.length===0)return d;if(e.length>t.length){const n=e;e=t,t=n}const a=new Set(t);for(let n=0;n<e.length&&a.size>0;n++){const l=e[n];a.delete(l)&&d.push(l)}return d}function Ki(e){return e.length===0}function Ur(e){return(t,d)=>{const a=t.length-d.length;if(a!==0)return a;for(let n=0;n<t.length;n++)if(t[n]!==d[n]){const l=e(t[n],d[n]);if(l!==0)return l}return 0}}function fl(e,{threshold:t=12}={}){return d=>{const a=d.length;if(a===0)return d;if(a<=t){const r=[];let c=0;e:for(let s=0;s<a;s++){const o=d[s];for(let i=0;i<c;i++)if(e(o,r[i])===0)continue e;c=r.push(o)}return r}const n=d.slice().sort(e);let l=0;for(let r=1;r<a;r++)e(n[l],n[r])!==0&&++l!==r&&(n[l]=n[r]);return n.length=l+1,n}}function Pf(e){return(t,d)=>{const a=[];let n=t.length,l=d.length;if(n===0||l===0)return a;if(n>l){const i=t;t=d,d=i;const f=n;n=l,l=f}const r=[...t].sort(e),c=[...d].sort(e);let s=0,o=0;for(;s<n&&o<l;){const i=e(r[s],c[o]);i===0?((a.length===0||e(a[a.length-1],r[s])!==0)&&a.push(r[s]),s++,o++):i<0?s++:o++}return a}}function Mf(e,t){return d=>{if(e.has(d))return e.get(d);const a=t(d);return e.set(d,a),a}}const Yi=Mf,hl=()=>0,qf=e=>e===void 0,Bf=e=>typeof e!="object",Xi={boolean:0,number:1,string:2};function Vf(e,t){const d=typeof e,a=typeof t;return d===a?He(e,t):Xi[d]-Xi[a]}function Jf(e,t){const d=e.length;if(d===0)return t;const a=t.length;if(a===0)return e;if(a>d){const r=e;e=t,t=r}const n=new Set(e),l=t.length;for(let r=0;r<l;r++){const c=t[r];n.has(c)||e.push(c)}return e}function xr(e,t,d=hl){return(a,n)=>e(a)?e(n)?d(a,n):-1:e(n)?1:t(a,n)}function Ge(e){return xr(qf,e)}function Ce(e,t){return xr(d=>d===void 0||e(d),t)}function Gr(e,t){return xr(Array.isArray,e,t)}const Y=Ge(He),Hr=Ce(e=>e===0,(e,t)=>e-t);function Lf({deduplicationCache:e=new WeakMap,sortedKeysCache:t=new WeakMap}={}){const d=Yi(t,y=>Object.keys(y).sort());function a(y){return(b,u)=>{const h=d(b),w=d(u),g=Math.min(h.length,w.length);for(let _=0;_<g;_++){const C=He(h[_],w[_]);if(C!==0)return C}if(h.length!==w.length)return h.length-w.length;for(let _=0;_<g;_++){const C=h[_],O=y(b[C],u[C]);if(O!==0)return O}return 0}}function n(y){const b=Ur(y),u=Yi(e,fl(y,{threshold:0}));return(h,w)=>b(u(h),u(w))}const l=n(He);function r(y,b){if(Or(y)){if(Or(b)){const u=Object.keys(y),h=Object.keys(b),w=Jf(u,h),g=w.length;for(let _=0;_<g;_++){const C=w[_];if(y[C]===b[C])continue;const k=(v[C]??c)(y[C],b[C]);if(k!==0)return k}return 0}return b===!0&&ir(y)?0:1}return Or(b)?y===!0&&ir(b)?0:-1:He(y,b)}const c=Ge(o),s=xr(Bf,Gr(a(c),Ur(o)),Vf);function o(y,b){return y===null?-1:b===null?1:s(y,b)}const i=Ge(r),f=Ce(ir,a(i)),m=Ge(n(r)),p=Ce(me,r),v={$id:Y,$comment:Y,$defs:f,$ref:Y,$schema:Y,const:c,contains:i,contentEncoding:Y,contentMediaType:Y,default:c,definitions:f,description:Y,else:i,examples:c,exclusiveMaximum:Y,exclusiveMinimum:Y,format:Y,if:i,maximum:Y,maxItems:Y,maxLength:Y,maxProperties:Y,minimum:Y,multipleOf:Y,not:i,pattern:Y,propertyNames:i,readOnly:Y,then:i,title:Y,writeOnly:Y,uniqueItems:Ce(y=>y===!1,hl),minLength:Hr,minItems:Hr,minProperties:Hr,required:Ce(Ki,l),enum:Ce(Ki,n(o)),type:Ge((y,b)=>{const u=Array.isArray(y),h=Array.isArray(b);return!u&&!h?He(y,b):l(u?y:[y],h?b:[b])}),items:Ce(y=>!Array.isArray(y)&&me(y),Gr(r,Ur(r))),anyOf:m,allOf:m,oneOf:m,properties:f,patternProperties:f,additionalProperties:p,additionalItems:p,dependencies:Ce(ir,a(Ge(Gr(r,l))))};return{compareSchemaValues:o,compareSchemaDefinitions:r}}function Qi(e){return e}const pl=(e,t)=>e?pl(t%e,e):t,Df=(e,t)=>Math.abs(e*t)/pl(e,t);function Ff(e,t){return e===t?e:`^(?=.*(?:${e}))(?=.*(?:${t})).*$`}function*zr(e,t,d){const a=e.length,n=t.length;if(a>0&&n>0)for(let l=0;l<a;l++){const r=e[l];for(let c=0;c<n;c++)yield d(r,t[c])}}function Wr(e,t){return e||t}function Zi(e){return(t,d)=>{const a={...t},n=Object.keys(d),l=n.length;for(let r=0;r<l;r++){const c=n[r];a[c]=t[c]===void 0?d[c]:e(t[c],d[c])}return a}}function Uf(e){const t=new Map;for(const d of e)for(const a of d[0])t.set(a,d[1]);return t}function Ne(e,t,d){d===void 0||me(d)?delete e[t]:e[t]=d}const Gf=["properties","patternProperties","additionalProperties"];function $i(e){const t=Object.keys(e),d=t.length,a=[];for(let n=0;n<d;n++){const l=t[n];a.push({regExp:new RegExp(l),schema:e[l]})}return[a,t]}const eo=[[],[]];function to(e,t,d){const a=d.length;for(let n=0;n<a;n++){const l=d[n];if(!l.regExp.test(t))continue;const r=l.schema;if(r===!1)return!0;e.push(r)}return!1}const Hf=["items","additionalItems"],zf=["if","then","else"];function no(e,t){return t.if!==void 0&&(e.if=t.if),t.then!==void 0&&(e.then=t.then),t.else!==void 0&&(e.else=t.else),e}function Kr(e,t){if(e===t)return e;switch(e){case"number":if(t==="integer")return"integer";case"integer":if(t==="number")return"integer";default:return}}function xe(e,t,d){return[e,t,d]}function Wf(e){const t=new Map;for(const[d,a,n]of e){const l=r=>{if(!n(r))throw new Error(`Schema keys '${d}' and '${a}' are conflicting (${d}: ${JSON.stringify(r[d])}, ${a}: ${JSON.stringify(r[a])})`)};for(const r of[[d,a],[a,d]]){let c=t.get(r[0]);c===void 0&&(c=[],t.set(r[0],c)),c.push({oppositeKey:r[1],check:l})}}return t}const Kf=[xe("minimum","maximum",e=>e.maximum>=e.minimum),xe("exclusiveMinimum","maximum",e=>e.maximum>e.exclusiveMinimum),xe("minimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.minimum),xe("exclusiveMinimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.exclusiveMinimum),xe("minLength","maxLength",e=>e.maxLength>=e.minLength),xe("minItems","maxItems",e=>e.maxItems>=e.minItems),xe("minProperties","maxProperties",e=>e.maxProperties>=e.minProperties)];function Yf({mergePatterns:e=Ff,isSubRegExp:t=Object.is,intersectJson:d=jf,deduplicateJsonSchemaDef:a=Qi,defaultMerger:n=Qi,assigners:l=[],checks:r=Kf,mergers:c}={}){function s(g){const _=g.length;let C=g[0];for(let O=1;O<_;O++){const k=u(C,g[O]);if(k===!1)return!1;me(k)||(C=k)}return C}function o(g,_,C,O,k,S,E){if(g.length=0,C===!1)return!1;if(g.push(C),k!==void 0){if(k===!1)return!1;g.push(k)}if(to(g,_,S))return!1;const N=g.length<2;if(E===!1){if(N)return;if(to(g,_,O))return!1}else N&&E!==void 0&&g.push(E);return g.length===1?g[0]:s(g)}function i(g,_,C,O,k,S){const E=C.length;if(E>0&&k!==!1)if(S)Object.assign(g,_);else for(let A=0;A<E;A++){const N=C[A];O.has(N)||(g[N]=u(_[N],k))}return g}const f=(g,{properties:_={},patternProperties:C,additionalProperties:O=!0},{properties:k={},patternProperties:S,additionalProperties:E=!0})=>{const A=me(O),N=me(E);if(A&&N)return Ne(g,"properties",h(_,k)),Ne(g,"patternProperties",C&&S?h(C,S):C??S),delete g.additionalProperties,g;const x=u(O,E);Ne(g,"additionalProperties",x);const I={},R=Object.keys(_),T=R.length,[q,B]=C?$i(C):eo,[J,D]=S?$i(S):eo,U=[],V=new Set,X=N?void 0:E;for(let $=0;$<T;$++){const Z=R[$];V.add(Z);const ne=o(U,Z,_[Z],q,k[Z],J,X);ne!==void 0&&(I[Z]=ne)}const ce=Object.keys(k),ie=ce.length,G=A?void 0:O;for(let $=0;$<ie;$++){const Z=ce[$];if(V.has(Z))continue;const ne=o(U,Z,k[Z],J,void 0,q,G);ne!==void 0&&(I[Z]=ne)}Ne(g,"properties",I);let H={};const se=new Set;if(B.length>0&&D.length>0){const $=zr(B,D,(Z,ne)=>{t(Z,ne)&&se.add(Z),t(ne,Z)&&se.add(ne),H[e(Z,ne)]=u(C[Z],S[ne])});for(;!$.next().done;);}return H=i(H,C,B,se,E,N),H=i(H,S,D,se,O,A),Ne(g,"patternProperties",H),g},m=(g,{items:_=[],additionalItems:C},{items:O=[],additionalItems:k})=>{const S=Array.isArray(_),E=Array.isArray(O),A=[];if(g.items=A,S&&E){const[N,x,I]=_.length<O.length?[_.length,C,O]:[O.length,k,_];let R=0;for(;R<N;R++)A.push(u(_[R],O[R]));if(x===!1)g.additionalItems=!1;else{const T=x===void 0||me(x);for(;R<I.length;R++)A.push(T?I[R]:u(I[R],x));Ne(g,"additionalItems",C!==void 0&&k!==void 0?u(C,k):C??k)}}else if(S||E){const[N,x,I]=S?[_,O,C]:[O,_,k];Ne(g,"additionalItems",I&&u(I,x));for(let R=0;R<N.length;R++)A.push(u(N[R],x))}else delete g.additionalItems,g.items=u(_,O);return g},p=(g,_,C)=>{no(g,_);const O=no({},C);return g.allOf===void 0?g.allOf=[O]:g.allOf=g.allOf.concat(O),g};function v(g,_){return a(Array.from(zr(g,_,u)))}const y=Uf([[Gf,f],[Hf,m],[zf,p],...l]),b=Wf(r);function u(g,_){if(g===!1||_===!1)return!1;if(me(g))return me(_)?!0:_;if(me(_))return g;let C={...g};const O=new Set,k=new Set,S=Object.keys(_),E=S.length;for(let A=0;A<E;A++){const N=S[A],x=_[N];if(x===void 0)continue;const I=b.get(N);if(I!==void 0){const B=I.length;for(let J=0;J<B;J++){const D=I[J];g[D.oppositeKey]!==void 0&&k.add(D.check)}}const R=g[N];if(R===void 0){C[N]=x;continue}const T=y.get(N);if(T){O.add(T);continue}const q=w[N]??n;C[N]=q(R,x)}for(const A of O)C=A(C,g,_);for(const A of k)A(C);return C}const h=Zi(u),w={$id:n,$ref:n,$schema:n,$comment:n,$defs:h,definitions:h,type:(g,_)=>{if(g===_)return g;const C=Array.isArray(g),O=Array.isArray(_);if(!C&&!O){const k=Kr(g,_);if(k!==void 0)return k}else if(C||O){const k=new Set;if(C&&O)for(const E of zr(g,_,Kr))E!==void 0&&k.add(E);else{const E=C?g:_,A=C?_:g,N=E.length;for(let x=0;x<N;x++){const I=Kr(A,E[x]);I!==void 0&&k.add(I)}}const S=k.size;if(S===1)return k.values().next().value;if(S>1)return Array.from(k)}throw new Error(`It is not possible to create an intersection of the following incompatible types: ${g.toString()}, ${_.toString()}`)},default:n,description:n,title:n,const:n,format:n,contentEncoding:n,contentMediaType:n,not:(g,_)=>{const C=a([g,_]);return C.length===1?C[0]:{anyOf:C}},pattern:e,readOnly:Wr,writeOnly:Wr,enum:(g,_)=>{const C=d(g,_);if(C.length===0)throw new Error(`Intersection of the following enums is empty: "${JSON.stringify(g)}", "${JSON.stringify(_)}"`);return C},anyOf:v,oneOf:v,allOf:(g,_)=>a(g.concat(_)),propertyNames:u,contains:u,dependencies:Zi((g,_)=>Array.isArray(g)?Array.isArray(_)?Fr(g,_):u(_,{required:g}):Array.isArray(_)?u(g,{required:_}):u(g,_)),examples:(g,_)=>{if(!Array.isArray(g)||!Array.isArray(_))throw new Error(`Value of the 'examples' field should be an array, but got "${JSON.stringify(g)}" and "${JSON.stringify(_)}"`);return Fr(g,_)},multipleOf:(g,_)=>{let C=1;for(;!Number.isInteger(g)||!Number.isInteger(_);)C*=10,g*=10,_*=10;return Df(g,_)/C},exclusiveMaximum:Math.min,maximum:Math.min,maxItems:Math.min,maxLength:Math.min,maxProperties:Math.min,exclusiveMinimum:Math.max,minimum:Math.max,minItems:Math.max,minLength:Math.max,minProperties:Math.max,uniqueItems:Wr,required:Fr,...c};return{mergeSchemaDefinitions:u,mergeArrayOfSchemaDefinitions:s}}function Xf(e){const t=[],d=[e];for(;d.length>0;){const a=d.pop();if(typeof a=="boolean"||a.allOf===void 0){t.push(a);continue}const{allOf:n,...l}=a;t.push(l);for(let r=n.length-1;r>=0;r--)d.push(n[r])}return t}function Qf(e){return t=>e(Xf(t))}const{compareSchemaDefinitions:Zf,compareSchemaValues:$f}=Lf(),{mergeArrayOfSchemaDefinitions:eh}=Yf({intersectJson:Pf($f),deduplicateJsonSchemaDef:fl(Zf)}),th=Qf(eh),nh=["id","createdBy","createdOn","modifiedBy","modifiedOn","etag","concreteType","parentId","path","type","currentVersion","benefactorId"];function rh(e){if(!e.properties)return e;const t={...e.properties};return nh.forEach(a=>{t[a]?t[a]={...Se(t[a])?t[a]:{},readOnly:!0}:t[a]={readOnly:!0}}),{...e,properties:t}}function sh(e){const{data:t}=Hi(e?.gridJsonSchema$Id??"",{enabled:!!e?.gridJsonSchema$Id}),{data:d}=Nr(e?.sourceEntityId,void 0,{enabled:!!e?.sourceEntityId});let a=!1;d&&Td(d)&&(a=!0);const{data:n}=Hi("org.sagebionetworks-repo.model.Entity",{enabled:a,select:rh});return t&&n?th({allOf:[n,t]}):t}function ih(e){const{synapseClient:t}=We();return be({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:d});return(await Ar(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function oh(e){const{keyFactory:t,synapseClient:d}=We(),a=dl();return be({...e,mutationFn:async n=>{const l=await d.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:n.entityId,tableUpdateTransactionRequest:n});return(await Ar(()=>d.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:l.token}))).responseBody},onSuccess:async(n,l,r)=>{await jd(a,t,l.entityId)}})}function ch(e){const t=dl(),{mutateAsync:d}=ih(),{mutateAsync:a}=oh(),n=Xd();return be({...e,mutationFn:async({gridSessionId:l,sourceEntityId:r})=>{const c=await t.fetchQuery(n(r)),s={...ah(c),sessionId:l},o=await d(s),i={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:r,changes:[{uploadFileHandleId:o.resultsFileHandleId,tableId:r,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return a(i)}})}function ah(e){return Pd(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}function uh(e){const{synapseClient:t}=We();return be({...e,mutationFn:async({gridSessionId:d})=>{const a={sessionId:d,concreteType:"org.sagebionetworks.repo.model.grid.GridRecordSetExportRequest"},n=await t.gridServicesClient.postRepoV1GridExportRecordsetAsyncStart({gridRecordSetExportRequest:a});return(await Ar(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:n.token}))).responseBody}})}function lh(e){const t=ch(),d=uh();return be({...e,mutationFn:async({gridSessionId:a,sourceEntityId:n,sourceEntityType:l})=>l===Md.recordset?{type:"recordset",data:await d.mutateAsync({gridSessionId:a})}:{type:"table",data:await t.mutateAsync({gridSessionId:a,sourceEntityId:n})}})}function gi(e){const{sourceEntityId:t,gridSessionId:d}=e,{data:a,isLoading:n}=Nr(t),l=a?.concreteType?qd(a.concreteType):void 0,{mutate:r,isPending:c}=lh({onSuccess:s=>{s.type==="table"?dh(s.data):ye("Successfully updated RecordSet.","success")},onError:s=>ye(s.message,"danger")});return j.jsx(Ue,{loading:c,disabled:n,onClick:()=>r({gridSessionId:d,sourceEntityId:t,sourceEntityType:l}),variant:"contained",children:"Apply changes"})}function dh(e){if(e.results?.length){const t=e.results[0];if(Bd(t)){const d=fh(t).join(`
`);d?ye(`Some changes could not be applied:
${d}`,"danger"):ye("Changes applied successfully","success")}else if(Vd(t)){const d=t.rowsProcessed?.toLocaleString();ye(`Successfully updated ${d} rows.`,"success")}}}function fh(e){return e.updateResults?.filter(t=>!!t.failureCode).map(t=>`${t.entityId}: ${t.failureMessage} (code: ${t.failureCode})`)??[]}try{gi.displayName="MergeGridWithSourceTableButton",gi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},sourceEntityType:{defaultValue:null,description:"",name:"sourceEntityType",required:!1,type:{name:"enum",value:[{value:'"link"'},{value:'"table"'},{value:'"dockerrepo"'},{value:'"file"'},{value:'"folder"'},{value:'"entityview"'},{value:'"submissionview"'},{value:'"dataset"'},{value:'"datasetcollection"'},{value:'"project"'},{value:'"materializedview"'},{value:'"virtualtable"'},{value:'"recordset"'}]}}}}}catch{}function hh(e,t){const d={},a=t.api.getSnapshot();if(ro(a.rows,e.min.row,e.max.row))d.rowSelectAll=!0;else{const n=t.api.arr(["rows"]);d.rowSelection=so(n,e.min.row,e.max.row)}if(ro(a.columnOrder,e.min.col,e.max.col))d.columnSelectAll=!0;else{const n=t.api.arr(["columnOrder"]);d.columnSelection=so(n,e.min.col,e.max.col)}return d}function ro(e,t,d){return t===0&&d===e.length-1}function so(e,t,d){const a=[];for(let n=t;n<=d;n++){const l=e.node.findChunk(n);if(l){const[r,c]=l;a.push({rep:r.id.sid,seq:r.id.time+c})}else console.warn(`getCrdtIdsForArrayRange: No chunk found for array index ${n}. This may indicate an unexpected state.`)}return a}function ph(e,t){let d;try{d=e.api.con(["rows",String(t),"metadata","rowValidation"])}catch{return!1}const a=d?.node?.id;try{const n=e.api.vec(["rows",String(t),"data"]);for(let l=0;l<n?.length();l++)if(n.get(l).asCon().node.id.time>a?.time)return!1}catch{}return!0}function mh(e){return`[${e.sid},${e.time}]`}function bh(e){const t=new Map,d=/^#(?:\/([^/:]+)(?:\/\d+)?)?:\s*(.*)$/;for(const a of e){if(typeof a!="string")continue;const l=a.trimStart().match(d);if(l){let r=l[1]?.trim()??"_row";const c=l[2].trim();if(r==="_row"){const s=c.match(/^required key \[([^\]]+)\] not found$/i);s&&(r=s[1])}t.has(r)||t.set(r,[]),t.get(r).push(c)}}return t}function gh(e,t){if(!e||!t)return[];const{columnNames:d,columnOrder:a,rows:n}=t;return n.map((r,c)=>{const s={};return a.forEach(o=>{const i=d[o];i&&(s[i]=r.data[o])}),s[Qd]=mh(e.api.obj(["rows",String(c)]).node.id),s.__validationResults=r.metadata?.rowValidation,s.__validationResults&&(s.__validationStatus=s.__validationResults?.isValid?"valid":"invalid"),ph(e,c)||(s.__validationStatus="pending"),s.__validationResults?.allValidationMessages&&(s.__cellValidationResults=bh(s.__validationResults.allValidationMessages)),s})}function yh(e){return Se(e)&&"type"in e&&(e.type=="null"||Jd(e.type,["null"]))}function ml(e){if(e?.oneOf&&ze(e.oneOf)){const t=e.oneOf.filter(d=>!yh(d));if(t.length==1&&Se(t[0]))return t[0]}}function vh(e){return{value:e.value}}function wh(e){return ze(e)&&e.every(t=>Se(t)&&"const"in t)}function io(e){let t=[];if(e.type==="boolean")return[{value:!0},{value:!1}];try{if(e?.oneOf&&ze(e.oneOf)&&!wh(e.oneOf)){const d=ml(e);d&&Object.hasOwn(d,"enum")&&(t=zi(d)||[])}else t=zi(e)||[]}catch(d){console.error("Error getting enumerated values from schema",d,e)}return t.map(vh)}function _h(e,t){return sf(e,[nf,t],{})}function Ch(e){if(!e||!Se(e))return[];const t=new Set,d=new Set;function a(n){if(!(!Se(n)||d.has(n))){if(d.add(n),ze(n.required))for(const l of n.required)typeof l=="string"&&t.add(l);["allOf"].forEach(l=>{const r=n[l];ze(r)&&r.forEach(c=>a(c))})}}return a(e),Array.from(t)}const oo={type:"string",isArray:!1};function yi(e){const t={...oo};if(e.format&&(t.format=e.format),e.readOnly&&(t.readOnly=e.readOnly),e.type){if(e.type==="array"&&e.items){const d=Array.isArray(e.items)?e.items[0]:e.items,a=yi(d)??oo;return{...t,...a,isArray:!0}}return{...t,type:e.type}}if(e?.oneOf&&ze(e.oneOf)){const d=ml(e);if(d)return yi(d)}return t}function Sh(e){if(!e)return{};const t=Ch(e),d={};return e.properties&&Object.keys(e.properties).forEach(a=>{const n=_h(e,a),l=yi(n);let r=io(n).map(c=>c.value);if(r.length===0&&n&&n.items){const c=Array.isArray(n.items)?n.items[0]:n.items;r=io(c).map(s=>s.value)}d[a]={type:l,isRequired:t.includes(a),enumeratedValues:r.length>0?r:null}}),d}var Yr={};const L=rf(of);var Ze={},$e={},co;function cr(){if(co)return $e;co=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.context=void 0;const e=M();return $e.context=e.createContext(null),$e}var Xr={},ao;function te(){return ao||(ao=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useStyles=e.context=void 0;const t=M();e.context=t.createContext({});const d=()=>t.useContext(e.context);e.useStyles=d})(Xr)),Xr}var Qr={},Zr={},$r={},es={},uo;function Oh(){return uo||(uo=1,Object.defineProperty(es,"__esModule",{value:!0})),es}var de={},lo;function Eh(){if(lo)return de;lo=1,Object.defineProperty(de,"__esModule",{value:!0}),de.COLOR=de.SYMBOL=de.ZINDEX=de.SIZE=void 0;var e;(function(n){n[n.SITE_WIDTH=1300]="SITE_WIDTH",n[n.SITE_PADDING=32]="SITE_PADDING",n[n.PAGE_WIDTH=1e3]="PAGE_WIDTH",n[n.TOP_NAV_HEIGHT=64]="TOP_NAV_HEIGHT",n[n.SIDEBAR_WIDTH=300]="SIDEBAR_WIDTH"})(e||(de.SIZE=e={}));var t;(function(n){n[n.TOP_NAV=1e3]="TOP_NAV",n[n.SIDEBAR=1001]="SIDEBAR",n[n.CONTEXT=1002]="CONTEXT",n[n.PROGRESS=2e3]="PROGRESS",n[n.MODAL=4e3]="MODAL",n[n.CURSOR=1e6]="CURSOR"})(t||(de.ZINDEX=t={}));var d;(function(n){n.CHECKMARK="✓",n.CROSS="✗",n.NIL="∅",n.ELLIPSIS="…",n.MDASH="—",n.NDASH="–",n.FDASH="‒",n.CTRL="⌃",n.CMD="⌘",n.ALT="⌥",n.SHIFT="⇧"})(d||(de.SYMBOL=d={}));var a;return(function(n){n.LINK="#0089ff"})(a||(de.COLOR=a={})),de}var ts={},ns={},fo;function ho(){if(fo)return ns;fo=1;var e=/[A-Z]/g,t=function(d){for(var a=5381,n=d.length;n;)a=a*33^d.charCodeAt(--n);return"_"+(a>>>0).toString(36)};return ns.create=function(d){d=d||{};var a=d.assign||Object.assign,n=typeof window=="object",l=a({raw:"",pfx:"_",client:n,assign:a,stringify:JSON.stringify,kebab:function(r){return r.replace(e,"-$&").toLowerCase()},decl:function(r,c){return r=l.kebab(r),r+":"+c+";"},hash:function(r){return t(l.stringify(r))},selector:function(r,c){return r+(c[0]===":"?"":" ")+c},putRaw:function(r){l.raw+=r}},d);return l.client&&(l.sh||document.head.appendChild(l.sh=document.createElement("style")),l.putRaw=function(r){{var c=l.sh.sheet;try{c.insertRule(r,c.cssRules.length)}catch{}}}),l.put=function(r,c,s){var o="",i,f,m=[];for(i in c)f=c[i],f instanceof Object&&!(f instanceof Array)?m.push(i):o+=l.decl(i,f,r,s);o&&(o=r+"{"+o+"}",l.putRaw(s?s+"{"+o+"}":o));for(var p=0;p<m.length;p++)i=m[p],i[0]==="@"&&i!=="@font-face"?l.putAt(r,c[i],i):l.put(l.selector(r,i),c[i],s)},l.putAt=l.put,l},ns}var rs={},po;function kh(){return po||(po=1,rs.addon=function(e){var t={};e.cache=function(d){if(!d)return"";var a=e.hash(d);return t[a]||(t[a]=e.rule(d,a)),t[a]}}),rs}var ss={},is,mo;function Ah(){if(mo)return is;mo=1;var e=Object.keys,t=JSON.stringify;function d(a,n){var l,r,c,s,o,i,f;if(f=typeof a,f==="string")return t(a);if(a===!0)return"true";if(a===!1)return"false";if(a===null)return"null";if(a instanceof Array){for(c="[",r=a.length-1,l=0;l<r;l++)c+=d(a[l],!1)+",";return r>-1&&(c+=d(a[l],!1)),c+"]"}if(a instanceof Object){if(typeof a.toJSON=="function")return d(a.toJSON(),n);for(s=e(a).sort(),r=s.length,c="",l=0;l<r;)o=s[l],i=d(a[o],!0),i!==void 0&&(l&&c!==""&&(c+=","),c+=t(o)+":"+i),l++;return"{"+c+"}"}switch(f){case"function":case"undefined":return n?void 0:null;default:return isFinite(a)?a:null}}return is=function(a){return""+d(a,!1)},is}var bo;function Nh(){if(bo)return ss;bo=1;var e=Ah();return ss.addon=function(t){t.stringify=e},ss}var os={},go;function xh(){return go||(go=1,os.addon=function(e){e.selector=function(t,d){var a=t.split(","),n=[],l=d.split(","),r=a.length,c=l.length,s,o,i,f,m,p;for(s=0;s<c;s++)if(i=l[s],f=i.indexOf("&"),f>-1)for(o=0;o<r;o++)m=a[o],p=i.replace(/&/g,m),n.push(p);else for(o=0;o<r;o++)m=a[o],m?n.push(m+" "+i):n.push(i);return n.join(",")}}),os}var mr={},yo;function Rh(){if(yo)return mr;yo=1;var e="position",t="top",d="right",a="bottom",n="left",l="width",r="height",c="overflow",s="color",o="content",i=c+"-x",f=c+"-y",m="flex",p=m+"-direction",v=m+"-grow",y=m+"-shrink",b=m+"-basis",u=m+"-wrap",h="align",w=h+"-items",g=h+"-"+o,_=h+"-self",C="margin",O=C+"-"+t,k=C+"-"+d,S=C+"-"+a,E=C+"-"+n,A="padding",N=A+"-"+t,x=A+"-"+d,I=A+"-"+a,R=A+"-"+n,T="border",q=T+"-"+t,B=T+"-"+d,J=T+"-"+a,D=T+"-"+n,U=T+"-radius",V="background",X=V+"-"+s,ce=V+"-image",ie=V+"-repeat",G=V+"-attachment",H=V+"-position",se=V+"-size",$=V+"-origin",Z=V+"-clip",ne="style",Xe="font",ud=Xe+"-size",ld=Xe+"-"+ne,dd=Xe+"-weight",fd=Xe+"-family",Qe="text",hd=Qe+"-align",pd=Qe+"-decoration",md=Qe+"-transform",bd=Qe+"-shadow",gd=Qe+"-overflow",Jr="stroke",yd=Jr+"-width",vd=Jr+"-linecap",Ae="animation",wd=Ae+"-name",_d=mr.atoms={pos:e,t,r:d,b:a,l:n,z:"z-index",d:"display",vis:"visibility",w:l,h:r,minW:"min-"+l,maxW:"max-"+l,minH:"min-"+r,maxH:"max-"+r,ov:c,ovx:i,ovy:f,bxz:"box-sizing",cl:"clip",clp:"clip-path",clr:"clear",tbl:"table-layout",fl:m,fld:p,flg:v,fls:y,flb:b,flw:u,jc:"justify-"+o,ai:w,ac:g,as:_,mr:C,mrt:O,mrr:k,mrb:S,mrl:E,mar:C,mart:O,marr:k,marb:S,marl:E,pd:A,pdt:N,pdr:x,pdb:I,pdl:R,pad:A,padt:N,padr:x,padb:I,padl:R,bd:T,bdt:q,bdr:B,bdb:J,bdl:D,bdrad:U,bdc:T+"-"+s,bds:T+"-"+ne,out:"outline",bxsh:"box-shadow",col:s,op:"opacity",bg:V,bgc:X,bgi:ce,bgr:ie,bga:G,bgp:H,bgs:se,bgo:$,bgcl:Z,bdfl:"backdrop-filter",bfvis:"backface-visibility",f:Xe,fz:ud,fs:ld,fw:dd,ff:fd,ta:hd,td:pd,tt:md,ts:bd,tov:gd,ww:"word-wrap",lts:"letter-spacing",ws:"white-space",lh:"line-"+r,va:"vertical-"+h,cur:"cursor",pe:"pointer-events",us:"user-select",an:Ae,ann:wd,and:Ae+"-duration",anf:Ae+"-fill-mode",anit:Ae+"-iteration-count",anp:Ae+"-play-state",ant:Ae+"-timing-function",trs:"transition",tr:"transform",st:Jr,stw:yd,stl:vd,ls:"list-"+ne,con:o};return mr.addon=function(Li){var Cd=Li.decl;Li.decl=function(Di,Sd){return Cd(_d[Di]||Di,Sd)}},mr}var cs={},vo;function Ih(){return vo||(vo=1,cs.addon=function(e){e.rule=function(t,d){return d=d||e.hash(t),d=e.pfx+d,e.put("."+d,t)," "+d}}),cs}var as={},wo;function Th(){return wo||(wo=1,as.addon=function(e){e.drule=function(t,d){var a=e.rule(t,d),n=function(l){if(!l)return a;var r=e.cache(l);return a+r};return n.toString=function(){return a},n}}),as}var us={},_o;function jh(){return _o||(_o=1,us.addon=function(e,t){t=e.assign({prefixes:["-webkit-","-moz-","-o-",""]},t||{});var d=t.prefixes;e.client&&document.head.appendChild(e.ksh=document.createElement("style"));var a=e.putAt;e.putAt=function(n,l,r){if(r[1]==="k"){var c="";for(var s in l){var o=l[s],i="";for(var f in o)i+=e.decl(f,o[f]);c+=s+"{"+i+"}"}for(var m=0;m<d.length;m++){var p=d[m],v=r.replace("@keyframes","@"+p+"keyframes")+"{"+c+"}";e.client?e.ksh.appendChild(document.createTextNode(v)):e.putRaw(v)}return}a(n,l,r)},e.keyframes=function(n,l){return l||(l=e.hash(n)),l=e.pfx+l,e.putAt("",n,"@keyframes "+l),l}}),us}var ls={},Co;function Ph(){return Co||(Co=1,ls.addon=function(e){var t={html:{lineHeight:1.15,"-webkit-text-size-adjust":"100%"},body:{margin:0},h1:{fontSize:"2em",margin:"0.67em 0"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp":{fontFamily:"monospace, monospace",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:1.15,margin:0},"button,input":{overflow:"visible"},"button,select":{textTransform:"none"},fieldset:{padding:"0.35em 0.75em 0.625em"},legend:{boxSizing:"border-box",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{verticalAlign:"baseline"},summary:{display:"list-item"}};e.put("",t)}),ls}var ds={},So;function Mh(){return So||(So=1,ds.addon=function(e){e.put("",{"html, body":{fontFamily:'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif',fontWeight:400,fontSize:"16px","-moz-text-size-adjust":"100%","-ms-text-size-adjust":"100%","-webkit-text-size-adjust":"100%","text-size-adjust":"100%","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"}})}),ds}var fs={},Oo;function qh(){if(Oo)return fs;Oo=1;function e(t,d,a){var n="?family="+encodeURIComponent(t);return d&&(d instanceof Array||(d=[d]),n+=":"+d.join(",")),a&&(a instanceof Array||(a=[a]),n+="&subset="+a.join(",")),"https://fonts.googleapis.com/css"+n}return fs.addon=function(t){t.client?t.googleFont=function(d,a,n){var l=document.createElement("link");l.href=e(d,a,n),l.rel="stylesheet",l.type="text/css",document.head.appendChild(l)}:t.googleFont=function(d,a,n){t.putRaw("@import url('"+e(d,a,n)+"');")}},fs}var Eo;function bl(){return Eo||(Eo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nano=e.googleFont=e.keyframes=e.drule=e.rule=e.put=e.reset=void 0;const t=L,d=ho(),a=kh(),n=Nh(),l=xh(),r=Rh(),c=Ih(),s=Th(),o=jh(),i=Ph(),f=Mh(),m=qh();t.__exportStar(ho(),e);const p=(0,d.create)({pfx:"nano-css"});e.nano=p,(0,a.addon)(p),(0,n.addon)(p),(0,l.addon)(p),(0,r.addon)(p),(0,c.addon)(p),(0,s.addon)(p),(0,o.addon)(p),(0,m.addon)(p);const v=()=>{(0,i.addon)(p),(0,f.addon)(p)};e.reset=v,e.put=p.put,e.rule=p.rule,e.drule=p.drule,e.keyframes=p.keyframes,e.googleFont=p.googleFont})(ts)),ts}var hs={},ko;function Bh(){return ko||(ko=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.m4=e.m3=e.m2=e.m1=e.b4=e.b3=e.b2=e.b1=void 0,e.b1=520,e.b2=960,e.b3=1300,e.b4=1800,e.m1=`@media (max-width:${e.b1}px)`,e.m2=`@media (max-width:${e.b2}px)`,e.m3=`@media (max-width:${e.b3}px)`,e.m4=`@media (max-width:${e.b4}px)`})(hs)),hs}var et={},Ao;function gl(){if(Ao)return et;Ao=1,Object.defineProperty(et,"__esModule",{value:!0}),et.font=void 0;const e='"Open Sans",sans-serif',t='"Merriweather","Linux Libertine"',d='"Roboto Slab"',a='Ubuntu,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Cantarell,"Open Sans","Helvetica Neue",sans-serif',n='-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,"Apple Color Emoji",Arial,sans-serif,"Segoe UI Emoji","Segoe UI Symbol",'+a,l="Roboto,sans-serif,"+n;return et.font={sans:{lite:{fw:300,ff:e},mid:{fw:400,ff:e},bold:{fw:700,ff:e},black:{fw:800,ff:e}},serif:{lite:{fw:300,ff:t},mid:{fw:400,ff:t},bold:{fw:700,ff:t},black:{fw:700,ff:t}},slab:{lite:{fw:300,ff:d},mid:{fw:400,ff:d},bold:{fw:700,ff:d},black:{fw:800,ff:d}},mono:{mid:{fw:300,ff:'"Menlo","DejaVu Sans Mono","Roboto Mono","Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'},bold:{fw:400,ff:'"Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'}},ui1:{lite:{fw:300,ff:a},mid:{fw:400,ff:a},bold:{fw:700,ff:a},black:{fw:800,ff:a}},ui2:{lite:{fw:300,ff:n},mid:{fw:400,ff:n},bold:{fw:700,ff:n},black:{fw:800,ff:n}},ui3:{lite:{fw:300,ff:l},mid:{fw:400,ff:l},bold:{fw:700,ff:l},black:{fw:800,ff:l}}},et}var ps={},ms={},tt={},No;function Vh(){if(No)return tt;No=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.hash=void 0;const e=t=>{let d=5381,a=t.length;for(;a;)d=d*33^t.charCodeAt(--a);return d>>>0};return tt.hash=e,tt}var xo;function yl(){return xo||(xo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toColor=e.color=void 0,e.color=["#FFC312","#F79F1F","#EE5A24","#EA2027","#C4E538","#A3CB38","#009432","#006266","#12CBC4","#1289A7","#0652DD","#1B1464","#9980FA","#ED4C67","#B53471","#833471","#6F1E51","#e27d60","#85dcbb","#e8a87c","#c38d9e","#41b3a3","#242582","#553d67","#f64c72","#99738e","#2f2fa2","#05386b","#fc4445","#3feee6","#55bcc9","#8ee4af","#5cdb95","#907163","#379683","#84ceeb","#5ab9ea","#8860d0","#75b5d8","#a64ac9","#fccd04","#17e9e0","#61892f","#86c232","#222629","#474b4f","#6b6e70","#eadb02","#46344e","#5a5560","#fa72a1","#e64398","#f78888","#1FB6FF","#13CE66","#FF4949","#FFC82C","#76266C","#8C2E5E","#5B2971","#9B344E","#4D2B73","#AA4139","#432F75","#AA5D38","#702D0C","#3C1200","#353377","#FE8C00","#FE7301","#FE4301","#FE0100","#E5013B","#CC0174","#A0048C","#560DAB","#252AAC","#0A6BA1","#09A471","#9DED05"];const t=Vh(),d=a=>e.color[(0,t.hash)(a)%e.color.length];e.toColor=d})(ms)),ms}var Ro;function Ei(){return Ro||(Ro=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.theme=e.lightTheme=void 0;const t=yl(),d=gl(),a=(r,c=1)=>{const s=Math.round(255*r);return`rgba(${s},${s},${s},${c})`},n=[0,4,8,16,24,32,64,128,256,512],l=[10,12,14,16,20,24,32,48,64,96,128];e.lightTheme={isLight:!0,name:"light",bg:"#fff",color:{color:t.color,sem:{accent:["#07f","#1340EB","#07ACEB"],blue:["#07f","#1340EB","#07ACEB"],positive:["#13CE66","#16BA32","#38D420"],negative:["#FF4949","#EB4C31","#DB521A"],warning:["#FFC82C","#EBC715","#DBCC00"],link:["#0089ff","#134EEB","#07BBEB"],brand:["#E44A28","#985DF7","#EE69B1","#F6A832","#5FCC8A","#58B9F8"]},ui:{lightLine:a(.1,.04),line:a(.1,.08),lineDark:a(.1,.16)}},font:d.font,green:r=>`rgba(19,206,102,${r})`,red:r=>`rgba(225,20,10,${r})`,blue:r=>`rgba(40,160,222,${r})`,fontSize:(r=0)=>l[Math.min(Math.max(r+3,0),l.length-1)],space:(r=0)=>n[Math.min(Math.max(r+3,0),n.length-1)],g:a},e.theme=e.lightTheme})(ps)),ps}var nt={},Io;function vl(){if(Io)return nt;Io=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.darkTheme=void 0;const e=Ei(),t=(d,a=1)=>{const n=255-Math.round(255*d);return`rgba(${n},${n},${n},${a})`};return nt.darkTheme=Object.assign(Object.assign({},e.lightTheme),{isLight:!1,name:"dark",bg:"#101921",color:Object.assign(Object.assign({},e.lightTheme.color),{ui:{lightLine:t(.1,.04),line:t(.1,.08),lineDark:t(.1,.16)}}),g:t}),nt}var bs={},br={},oe={},To;function wl(){if(To)return oe;To=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.isNavigator=oe.isBrowser=oe.off=oe.on=oe.noop=void 0;var e=function(){};oe.noop=e;function t(a){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];a&&a.addEventListener&&a.addEventListener.apply(a,n)}oe.on=t;function d(a){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];a&&a.removeEventListener&&a.removeEventListener.apply(a,n)}return oe.off=d,oe.isBrowser=typeof window<"u",oe.isNavigator=typeof navigator<"u",oe}var jo;function Jh(){if(jo)return br;jo=1,Object.defineProperty(br,"__esModule",{value:!0});var e=M(),t=wl(),d=t.isBrowser?e.useLayoutEffect:e.useEffect;return br.default=d,br}var Po;function Lh(){return Po||(Po=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalCss=e.makeRule=e.useRule=e.useTheme=e.Provider=void 0;const t=M(),d=Ei(),a=vl(),n=bl(),l=t.createContext(d.lightTheme);e.Provider=t.memo(({theme:f,children:m})=>{const p=f==="light"?d.lightTheme:a.darkTheme;return t.createElement(l.Provider,{value:p},m)});const r=()=>t.useContext(l);e.useTheme=r;const c=f=>{const m=(0,e.useTheme)(),p=f(m);return n.nano.cache(p)};e.useRule=c;const s=f=>()=>(0,e.useRule)(f);e.makeRule=s;const o=Jh(),i=()=>{const f=(0,e.useTheme)();return(0,o.default)(()=>{document.body.style.background=f.bg,document.body.style.color=f.g(.05,.85)},[f]),null};e.GlobalCss=i})(bs)),bs}var Mo;function K(){return Mo||(Mo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Oh(),e),t.__exportStar(Eh(),e),t.__exportStar(bl(),e),t.__exportStar(Bh(),e),t.__exportStar(gl(),e),t.__exportStar(Ei(),e),t.__exportStar(vl(),e),t.__exportStar(Lh(),e),t.__exportStar(yl(),e)})($r)),$r}var qo;function Q(){return qo||(qo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bottomRightActionPos=e.tooltip=e.insArrButton=e.insArrLine=e.insArrDot=e.insArrBlock=e.bracketHovered=e.collapsed=e.collapser=e.bracket=e.lineInner=e.line=e.list=e.colon=e.inputActive=e.input=e.property=e.quote=e.ValueColor=e.object=e.block=e.negative=e.blue=void 0;const t=K();e.blue=t.theme.color.sem.blue[0],e.negative=t.theme.color.sem.negative[0],e.block=(0,t.rule)({d:"inline-block",ff:"monospace",col:t.theme.g(.1)}),e.object=(0,t.rule)({pos:"relative",d:"inline-block"}),e.ValueColor={nil:[t.theme.g(0,.4),t.darkTheme.g(0,.4)],undef:[t.theme.g(0,.2),t.darkTheme.g(0,.2)],str:["#e00e44","#f01e54"],bool:["#411888","#9168c8"],num:["#0a8F3F","#0FaF4F"],zero:["#748A00","#94AA11"],float:["#016873","#51a8b3"]},e.quote=(0,t.rule)({col:"#E84D3D"}),e.property=(0,t.rule)({pad:"0",fw:"bold",bxz:"border-box",va:"top"});const d={col:t.theme.g(0),pd:"5px",bg:t.theme.bg,bd:`1px solid ${t.theme.g(.7)}`,mr:"-6px",out:0};e.input=(0,t.rule)({z:2,pos:"relative",bd:0,mar:0,pad:0,bg:"transparent",bdrad:"5px",d:"inline-block",minW:"auto",w:"auto","&::selection":{col:"#fff",bgc:e.blue},input:{out:0}}),e.inputActive=(0,t.rule)(d),e.colon=(0,t.rule)({pd:"0 8px 0 0px",cur:"default",va:"top","&>span":{pd:"0 2px"},"&:hover":{"&>span":{out:`1px dotted ${e.blue}`}}}),e.list=(0,t.rule)({d:"block",listStyleType:"none",pd:0,mr:"0 0 0 32px"}),e.line=(0,t.rule)({d:"block",ls:"none",pd:0,mr:0}),e.lineInner=(0,t.rule)({d:"inline-block"}),e.bracket=(0,t.rule)({pos:"relative",cur:"default"}),e.collapser=(0,t.rule)({pd:"0 6px",pos:"absolute",t:"0px",l:"-24px",cur:"default",us:"none"}),e.collapsed=(0,t.rule)({col:e.blue,cur:"default",fw:"bold",bg:t.theme.blue(.1),pd:"2px",mr:"-2px",bdrad:"4px"}),e.bracketHovered=(0,t.rule)({out:`1px dotted ${e.blue}`}),e.insArrBlock=(0,t.rule)({pos:"relative",h:"0px",w:"0px"}),e.insArrDot=(0,t.rule)({pos:"absolute",t:"0px",l:"-4px",w:"3px",h:"3px",bdrad:"50%",bg:e.blue,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{top:"-2px",left:"2px",w:"7px",h:"7px"}}),e.insArrLine=(0,t.rule)({pos:"absolute",t:"1px",l:"-56px",w:"50px",h:"0px",bdt:`1px dotted ${e.blue}`,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{l:"-56px",w:"56px",bdt:`1px solid ${e.blue}`}}),e.insArrButton=(0,t.rule)({pos:"absolute",d:"block",t:"-8px",l:"-75px"}),e.tooltip=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.ui1),{pos:"absolute",d:"none",t:"-2.5em",l:"0px",bg:"rgba(0,0,0,.8)",col:"#fff",fz:12/13.4+"em",pad:".4em .8em",bdrad:".4em",z:3,pe:"none",us:"none",ws:"nowrap"})),e.bottomRightActionPos=(0,t.rule)({d:"inline-block",pos:"absolute",r:"-6px",b:"-9px",z:2})})(Zr)),Zr}var rt={},gs={},ys={},Bo;function Dh(){return Bo||(Bo=1,Object.defineProperty(ys,"__esModule",{value:!0})),ys}var vs={},Vo;function ki(){return Vo||(Vo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=l,e.escapeComponent=r,e.parseJsonPointer=c,e.formatJsonPointer=s,e.isChild=i,e.isPathEqual=f,e.parent=p,e.isValidIndex=v;const t=/~1/g,d=/~0/g,a=/~/g,n=/\//g;function l(b){return b.indexOf("~")===-1?b:b.replace(t,"/").replace(d,"~")}function r(b){return b.indexOf("/")===-1&&b.indexOf("~")===-1?b:b.replace(a,"~0").replace(n,"~1")}function c(b){return b?b.slice(1).split("/").map(l):[]}function s(b){return(0,e.isRoot)(b)?"":"/"+b.map(u=>r(String(u))).join("/")}const o=b=>typeof b=="string"?c(b):b;e.toPath=o;function i(b,u){if(b.length>=u.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==u[h])return!1;return!0}function f(b,u){if(b.length!==u.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==u[h])return!1;return!0}const m=b=>!b.length;e.isRoot=m;function p(b){if(b.length<1)throw new Error("NO_PARENT");return b.slice(0,b.length-1)}function v(b){if(typeof b=="number")return!0;const u=Number.parseInt(b,10);return String(u)===b&&u>=0}const y=b=>{const u=b.length;let h=0,w;for(;h<u;){if(w=b.charCodeAt(h),w>=48&&w<=57){h++;continue}return!1}return!0};e.isInteger=y})(vs)),vs}var ws={},Jo;function Fh(){return Jo||(Jo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const t=n=>{if(typeof n=="string"){if(n){if(n[0]!=="/")throw new Error("POINTER_INVALID");if(n.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(n)};e.validateJsonPointer=t;const{isArray:d}=Array,a=n=>{if(!d(n))throw new Error("Invalid path.");if(n.length>256)throw new Error("Path too long.");for(const l of n)switch(typeof l){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=a})(ws)),ws}var st={},it={},Lo;function Ai(){if(Lo)return it;Lo=1,Object.defineProperty(it,"__esModule",{value:!0}),it.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function t(d,a){return e.call(d,a)}return it.hasOwnProperty=t,it}var Do;function _l(){if(Do)return st;Do=1,Object.defineProperty(st,"__esModule",{value:!0}),st.get=void 0;const e=Ai(),t=(d,a)=>{const n=a.length;let l;if(!n)return d;for(let r=0;r<n;r++)if(l=a[r],d instanceof Array){if(typeof l!="number"){if(l==="-")return;const c=~~l;if(""+c!==l)return;l=c}d=d[l]}else if(typeof d=="object"){if(!d||!(0,e.hasOwnProperty)(d,l))return;d=d[l]}else return;return d};return st.get=t,st}var fe={},Fo;function Uh(){if(Fo)return fe;Fo=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.isObjectReference=fe.isArrayEnd=fe.isArrayReference=fe.find=void 0;const e=Ai(),{isArray:t}=Array,d=(r,c)=>{const s=c.length;if(!s)return{val:r};let o,i;for(let m=0;m<s;m++)if(o=r,i=c[m],t(o)){const p=o.length;if(i==="-")i=p;else if(typeof i=="string"){const v=~~i;if(""+v!==i)throw new Error("INVALID_INDEX");if(i=v,i<0)throw new Error("INVALID_INDEX")}r=o[i]}else if(typeof o=="object"&&o)r=(0,e.hasOwnProperty)(o,i)?o[i]:void 0;else throw new Error("NOT_FOUND");return{val:r,obj:o,key:i}};fe.find=d;const a=r=>t(r.obj)&&typeof r.key=="number";fe.isArrayReference=a;const n=r=>r.obj.length===r.key;fe.isArrayEnd=n;const l=r=>typeof r.obj=="object"&&typeof r.key=="string";return fe.isObjectReference=l,fe}var _s={},ot={},Uo;function Gh(){if(Uo)return ot;Uo=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.findByPointer=void 0;const e=Ai(),t=ki(),{isArray:d}=Array,a=(n,l)=>{if(!n)return{val:l};let r,c,s=0,o=1;for(;s>-1;)if(s=n.indexOf("/",o),c=s>-1?n.substring(o,s):n.substring(o),o=s+1,r=l,d(r)){const i=r.length;if(c==="-")c=i;else{const f=~~c;if(""+f!==c)throw new Error("INVALID_INDEX");if(c=f,c<0)throw"INVALID_INDEX"}l=r[c]}else if(typeof r=="object"&&r)c=(0,t.unescapeComponent)(c),l=(0,e.hasOwnProperty)(r,c)?r[c]:void 0;else throw"NOT_FOUND";return{val:l,obj:r,key:c}};return ot.findByPointer=a,ot}var Go;function Hh(){return Go||(Go=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(Gh(),e)})(_s)),_s}var Ho;function Rr(){return Ho||(Ho=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Dh(),e),t.__exportStar(ki(),e),t.__exportStar(Fh(),e),t.__exportStar(_l(),e),t.__exportStar(Uh(),e),t.__exportStar(Hh(),e)})(gs)),gs}var ct={},at={},zo;function zh(){if(zo)return at;zo=1,Object.defineProperty(at,"__esModule",{value:!0}),at.copyStyles=void 0;const e=(t,d,a)=>{const n=window.getComputedStyle(t);if(n)for(const l of a)d.style[l]=n[l]};return at.copyStyles=e,at}var Wo;function ar(){if(Wo)return ct;Wo=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.FlexibleInput=void 0;const e=M(),t=K(),d=zh(),a=(0,t.rule)({d:"inline-block",pos:"relative"}),n=(0,t.rule)({d:"inline-block",va:"bottom",bxz:"border-box",ov:"hidden",pd:0,mr:0,bd:0,bg:0,out:0,col:"inherit",fw:"inherit",f:"inherit",lh:"inherit",ws:"pre",resize:"none"}),l=(0,t.rule)({d:"inline-block",pos:"absolute",ov:"hidden",pe:"none",us:"none",bxz:"border-box",t:0,l:0,ws:"pre"}),r=({inp:c,value:s,uncontrolled:o,multiline:i,typebefore:f="",typeahead:m="",extraWidth:p,minWidth:v=8,maxWidth:y,focus:b,onChange:u,onFocus:h,onBlur:w,onKeyDown:g,onSubmit:_,onCancel:C,onTab:O})=>{const k=e.useRef(null),S=e.useRef(null),E=(0,t.useTheme)();e.useLayoutEffect(()=>{!k.current||!S.current||(b&&k.current.focus(),(0,d.copyStyles)(k.current,S.current,["font","fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","boxSizing"]))},[]),e.useLayoutEffect(()=>{const x=k.current,I=S.current;if(!x||!I)return;let R=I.scrollWidth;p&&(R+=p),v&&(R=Math.max(R,v)),y&&(R=Math.min(R,y));const T=x.style;if(T.width=R+"px",i){const q=I.scrollHeight;T.height=q+"px"}},[s,m,p]);const A={ref:x=>{k.current=x,c&&c(x)},className:n,onChange:u,onFocus:h,onBlur:w,onKeyDown:x=>{x.key==="Enter"&&(!i||x.ctrlKey)?_&&_(x):x.key==="Escape"?C&&C(x):x.key==="Tab"&&O&&O(x),g&&g(x)}},N=i?e.createElement("textarea",Object.assign({},A,{value:o?void 0:s})):e.createElement("input",Object.assign({},A,{value:o?void 0:s}));return e.createElement(e.Fragment,null,!!f&&e.createElement("span",{style:{color:E.g(.7),verticalAlign:"top"}},f),e.createElement("span",{className:a},N,e.createElement("span",{ref:S,className:l},e.createElement("span",{style:{visibility:"hidden"}},s),"​",!!m&&e.createElement("span",{style:{color:E.g(.7)}},m))))};return ct.FlexibleInput=r,ct}var Ko;function Cl(){if(Ko)return rt;Ko=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.JsonProperty=void 0;const e=M(),t=K(),d=Rr(),a=Q(),n=ar(),l=te(),r=({pointer:c,onChange:s})=>{const{formal:o}=(0,l.useStyles)(),i=e.useMemo(()=>c.split("/"),[c]),f=e.useMemo(()=>(0,d.unescapeComponent)(i[i.length-1]),[i]),[m,p]=e.useState(f),v=e.useRef(null),[y,b]=e.useState(!1),u=(0,t.useTheme)(),h={color:u.g(.1)};y&&(h.background=u.bg,h.border=`1px solid ${u.g(.9)}`,h.fontWeight="bold",h.margin="-3px",h.padding="2px"),(!f||f.indexOf(" ")!==-1)&&(h.background=u.blue(.1));const w=g=>{g&&g.preventDefault(),g&&g.stopPropagation(),s&&s([{op:"move",from:c,path:i.slice(0,i.length-1).join("/")+"/"+(0,d.escapeComponent)(m)}])};return e.createElement(e.Fragment,null,s?e.createElement("span",{className:a.property+a.input,style:h},e.createElement(n.FlexibleInput,{inp:g=>v.current=g,value:y?m:f,onChange:g=>p(g.target.value),onFocus:g=>{const _=g.target,O=_.value.length;O&&O<6&&setTimeout(()=>{_.setSelectionRange(0,O,"forward")},155),b(!0)},onBlur:()=>{b(!1)},onSubmit:g=>{v.current&&(v.current.blur(),b(!1)),w(g)},onCancel:()=>{v.current&&(v.current.blur(),b(!1))}})):e.createElement("span",{className:a.property,style:h},o?JSON.stringify(f):f),e.createElement("span",{className:a.colon,style:{color:u.g(.5)}},e.createElement("span",null,":")))};return rt.JsonProperty=r,rt}var ut={},lt={},Cs={},Yo;function Ir(){return Yo||(Yo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.typeahead=e.inputStyle=e.inputColor=e.valueBg=e.valueColor=void 0;const t=K(),d=Q(),a=(s,o)=>{switch(typeof o){case"boolean":return d.ValueColor.bool[~~s];case"string":return d.ValueColor.str[~~s];case"number":return o?o===Math.round(o)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]:d.ValueColor.zero[~~s];case"bigint":return d.ValueColor.float[~~s];case"object":return o===null?d.ValueColor.nil[~~s]:void 0;case"undefined":return d.ValueColor.undef[~~s]}};e.valueColor=a;const n=s=>s===!1||typeof s=="number"&&s<0?t.theme.red(.06):void 0;e.valueBg=n;const l=(s,o)=>{if(o){if(o=o.trim(),o==="true"||o==="false")return d.ValueColor.bool[~~s];if(o==="null")return d.ValueColor.nil[~~s];if(o==="undefined")return d.ValueColor.undef[~~s];if(o==="0")return d.ValueColor.zero[~~s];if(o.length<24&&(o[0]==="-"||o[0]>="0"&&o[0]<="9"))try{const i=JSON.parse(o);if(typeof i=="number")return i===Math.round(i)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]}catch{}if(!(o[0]==="["||o[0]==="{"))return d.ValueColor.str[~~s]}};e.inputColor=l;const r=(s,o,i)=>({color:(0,e.inputColor)(o,i)||s.g(.1),background:s.bg,borderColor:s.g(.7)});e.inputStyle=r;const c=s=>{if(!s)return"";const o=s.length;return o>=5?"":"true".startsWith(s)?"true".slice(o):"false".startsWith(s)?"false".slice(o):"null".startsWith(s)?"null".slice(o):""};e.typeahead=c})(Cs)),Cs}var dt={},Xo;function Ni(){if(Xo)return dt;Xo=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.selectOnFocus=void 0;const e=t=>{const d=t.value,a=d.length;a&&a<40&&setTimeout(()=>{if(d[0]==='"'&&d[a-1]==='"')(a<17||d.indexOf(`
`)===-1&&d.indexOf(" ")===-1)&&t.setSelectionRange(1,a-1,"forward");else if(d==="null")t.setSelectionRange(0,4,"forward");else try{switch(typeof JSON.parse(d)){case"number":case"boolean":{t.setSelectionRange(0,a,"forward");break}}}catch{}},155),d[0]==='"'&&d[a-1]==='"'&&t.setSelectionRange(a-1,a-1)};return dt.selectOnFocus=e,dt}var Qo;function Wh(){if(Qo)return lt;Qo=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.ValueInput=void 0;const e=M(),t=K(),d=Q(),a=Ir(),n=ar(),l=Ni(),r=c=>{const{value:s,onChange:o}=c,i=e.useRef(null),f=(0,t.useTheme)(),m=e.useMemo(()=>s===null?"null":typeof s=="boolean"?s?"true":"false":typeof s=="string"?JSON.stringify(s):String(s),[s,f]),[p,v]=e.useState(m),[y,b]=e.useState(!1);e.useEffect(()=>{v(m)},[m]);const u=O=>{O&&O.preventDefault(),O&&O.stopPropagation();let k;try{k=JSON.parse(p)}catch{k=String(p)}o&&o(k)},h=O=>{const k=O.target;k.value===p&&(0,l.selectOnFocus)(k),b(!0)},w=()=>{b(!1)},g=O=>{i.current&&i.current.blur(),u(O)},_=()=>{m!==p?v(m):i.current&&i.current.blur()},C=O=>{const k=(0,a.typeahead)(p);k&&(O.preventDefault(),v(p+k))};return e.createElement("span",{className:d.input,style:y?(0,a.inputStyle)(f,!f.isLight,p):{color:(0,a.valueColor)(!f.isLight,s),background:(0,a.valueBg)(s)}},e.createElement(n.FlexibleInput,{inp:O=>i.current=O,value:y?p:m,typeahead:y?(0,a.typeahead)(p):"",onChange:O=>v(O.target.value),onFocus:h,onBlur:w,onSubmit:g,onCancel:_,onTab:C}))};return lt.ValueInput=r,lt}var ft={},Zo;function Ke(){if(Zo)return ft;Zo=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.JsonAtom=void 0;const e=M(),t=K(),d=Ir(),a=t.theme.color.sem.blue[0],n=l=>{var r;const{value:c,onClick:s}=l,o=(0,t.useTheme)();let i=o.g(.2),f="∅";if(Array.isArray(c))i=a,f="["+c.length+"]";else if(c instanceof Uint8Array)i=o.g(.45),f=e.createElement("span",null,[...c].slice(0,128).map(v=>v<16?"0"+v.toString(16):v.toString(16)).join(" "),c.length>128?e.createElement("span",{style:{color:o.g(.3)}},` … (${c.length-128} more)`):"");else if(c&&typeof c=="object")i=a,f="{"+Object.keys(c).length+"}";else if(i=(r=(0,d.valueColor)(!o.isLight,c))!==null&&r!==void 0?r:i,typeof c=="string"){const y=c.length>64,b=JSON.stringify(y?c.slice(0,64):c);y?f=e.createElement("span",null,b.slice(0,-1),e.createElement("span",{style:{color:o.g(.3)}},` … (${c.length-64} more)`),'"'):f=b}else f=String(c);const m=(0,d.valueBg)(c),p={color:i,background:m};return m&&(p.borderRadius=4,p.margin=-1,p.padding=1),e.createElement("span",{style:p,onClick:s},f)};return ft.JsonAtom=n,ft}var $o;function Kh(){if($o)return ut;$o=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.JsonValue=void 0;const e=M(),t=Cl(),d=Wh(),a=Ke(),n=l=>{const{pointer:r,property:c,doc:s,parentCollapsed:o,comma:i,onChange:f}=l,m=s instanceof Uint8Array,p=v=>{f&&f([{op:"replace",path:r,value:v}])};return e.createElement(e.Fragment,null,typeof c=="string"&&e.createElement(t.JsonProperty,{key:"k"+String(o),pointer:r,onChange:f}),!f||m?e.createElement(a.JsonAtom,{value:s}):e.createElement(d.ValueInput,{key:String(o),value:s,onChange:p}),!!i&&",")};return ut.JsonValue=n,ut}var ht={},pt={},Ss={},Os={},ec;function Yh(){return ec||(ec=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTranslations=void 0;var t=L,d=M(),a=d.createContext,n=d.createElement,l=d.Fragment,r=function(s){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];for(var f=[],m=0;m<o.length;m++)f.push(s[m]),f.push(o[m]);return f.push(s[m]),n.apply(void 0,t.__spreadArrays([l,{}],f))},c=function(s){return function(o){for(var i=[],f=1;f<arguments.length;f++)i[f-1]=arguments[f];for(var m=[],p=0;p<i.length;p++)m.push(o[p]),m.push(s[i[p]]);return m.push(o[p]),n.apply(void 0,t.__spreadArrays([l,{}],m))}};e.createTranslations=function(s){var o;s===void 0&&(s="main");var i=a({}),f=i.Consumer,m=(o=(function(u){t.__extends(h,u);function h(w){var g,_=u.call(this,w)||this;_.load=function(A,N){return t.__awaiter(_,void 0,void 0,function(){var x;return t.__generator(this,function(I){switch(I.label){case 0:return this.state.map[A]||(this.state.map[A]={}),this.state.map[A][N]?[3,2]:(this.state.map[A][N]={},this.setState(t.__assign({},this.state)),[4,this.props.loader(A,N)]);case 1:x=I.sent(),this.state.map[A][N]=x,this.setState(t.__assign({},this.state)),I.label=2;case 2:return[2]}})})},_.setLocale=function(A){A!==_.state.locale&&(_.state.map[A]||(_.state.map[A]={}),_.setState({locale:A}))},_.createT=function(A){A===void 0&&(A=[_.props.ns]);for(var N=_.state.locale,x=_.state.map[N],I=0,R=A;I<R.length;I++){var T=R[I];x[T]||_.load(N,T).catch(function(B){return console.error(B)})}var q=(function(B){for(var J=[],D=1;D<arguments.length;D++)J[D-1]=arguments[D];for(var U=0,V=[N,_.props.defaultLocale];U<V.length;U++){var X=V[U];if(!X)break;for(var ce=_.state.map[X],ie=0,G=A;ie<G.length;ie++){var H=G[ie],se=ce[H],$=se[B];if($!==void 0)return typeof $=="function"?$(c(J)):$||B}}return B});return q.t=function(B){return function(J){for(var D=[],U=1;U<arguments.length;U++)D[U-1]=arguments[U];var V=q.apply(void 0,t.__spreadArrays([B],D));return typeof V=="object"?V:V!==B?n(l,{},V):r.apply(void 0,t.__spreadArrays([J],D))}},q};var C=w.map,O=C===void 0?{}:C,k=w.locale,S=w.defaultLocale,E=w.ns;return O[S]?O[S][E]||(O[S][E]={}):O[S]=(g={},g[E]={},g),_.state={locale:k,ns:E,map:O,load:_.load,setLocale:_.setLocale,createT:_.createT},k!==S&&_.load(k,E),_}return h.prototype.shouldComponentUpdate=function(w){return w.locale!==this.props.locale&&this.setLocale(w.locale),!0},h.prototype.render=function(){return d.createElement(i.Provider,{value:this.state,children:this.props.children})},h})(d.Component),o.defaultProps={locale:"en",defaultLocale:"en",ns:s},o),p=(function(u){return u});p.t=function(u){return function(h){for(var w=[],g=1;g<arguments.length;g++)w[g-1]=arguments[g];return r(h,w)}};var v=function(u){var h=u instanceof Array?u:[u||s],w=d.useContext(i);return[w.createT?w.createT(h):p,w]},y=function(u,h){return h===void 0&&(h=s),Array.isArray(h)||(h=[h]),(function(w){var g=v(h),_=g[0],C=g[1];return d.createElement(u,t.__assign(t.__assign({},w),{t:_,T:C}))})},b=function(u){var h=u.children,w=u.ns instanceof Array?u.ns:[u.ns||s],g=v(w),_=g[0],C=g[1];return(typeof h=="function"?h(_,C):h instanceof Array?d.createElement.apply(d,t.__spreadArrays([d.Fragment,null],h.map(function(O){return typeof O=="function"?O(_):typeof O=="string"?_(O):O||null}))):typeof h=="string"?_(h):h)||null};return{Consumer:f,Provider:m,context:i,useT:v,Trans:b,withT:y,T:p}},e.default=e.createTranslations})(Os)),Os}var Es={},tc;function Xh(){return tc||(tc=1,Object.defineProperty(Es,"__esModule",{value:!0})),Es}var nc;function Oe(){return nc||(nc=1,(function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.T=e.withT=e.useT=e.context=e.Trans=e.Provider=e.Consumer=void 0;var d=L,a=Yh();d.__exportStar(Xh(),e),e.Consumer=(t=a.default(),t.Consumer),e.Provider=t.Provider,e.Trans=t.Trans,e.context=t.context,e.useT=t.useT,e.withT=t.withT,e.T=t.T})(Ss)),Ss}var mt={},bt={},rc;function ur(){if(rc)return bt;rc=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Action=void 0;const e=M(),t=K(),d=Q(),a=(0,t.drule)({pos:"relative",d:"flex",jc:"center",ai:"center",w:"17px",h:"17px",bdrad:"2px",pad:0,mr:0,out:0,ff:"monospace",lh:"16px",cur:"pointer",bd:`1px dotted ${d.blue}`,col:d.blue,fw:"normal",z:3}),n=(0,t.drule)({[`.${a.toString().trim()}:hover &`]:{d:"inline-block"}}),l=({className:r="",tooltip:c,children:s,onClick:o,onMouseEnter:i,onMouseLeave:f,onMouseOver:m})=>{const p=(0,t.useTheme)();return e.createElement("button",{className:a({bg:p.bg,"&:hover":{col:p.bg,bg:d.blue},"&:active":{col:p.g(.9),bg:p.g(.1),bd:`1px solid ${p.g(.1)}`}})+r,onClick:o,onMouseEnter:i,onMouseLeave:f,onMouseOver:m},s,!!c&&e.createElement("span",{className:d.tooltip+n({})},c))};return bt.Action=l,bt}var sc;function Tr(){if(sc)return mt;sc=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.CancelAction=void 0;const e=M(),t=K(),d=Q(),a=ur(),n=(0,t.drule)({w:"20px",h:"20px",pos:"absolute",t:"-11px",l:"-11px",z:2,bdrad:"50%",svg:{fill:d.blue}}),l=r=>{const c=(0,t.useTheme)();return e.createElement(a.Action,Object.assign({},r,{className:n({"&:hover":{bg:d.negative,bd:`1px solid ${d.negative}`,svg:{fill:"#fff"}},"&:active":{bg:c.g(.1),bd:`1px solid ${c.g(.1)}`}})}),"×")};return mt.CancelAction=l,mt}var gt={},ic;function Qh(){if(ic)return gt;ic=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.EditAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"…");return gt.EditAction=d,gt}var oc;function xi(){if(oc)return pt;oc=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.FocusRegion=void 0;const e=M(),t=K(),d=Oe(),a=Q(),n=Tr(),l=Qh(),r=(0,t.rule)({d:"inline-block",pos:"relative",va:"top",bxz:"border-box",pd:"3px",bdrad:"4px",trs:"background-color .3s ease-out"}),c=(0,t.rule)({pd:"1px 3px"}),s=(0,t.rule)({bgc:t.theme.blue(.1)}),o=(0,t.rule)({bgc:t.theme.red(.1)}),i=(0,t.rule)({bgc:t.theme.red(.08)}),f=(0,t.rule)({out:`1px dotted ${a.blue}`}),m=(0,t.rule)({out:`1px dotted ${a.negative}`}),p=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-1px",l:"calc(100% + 0.5em)"}),v=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-11px",l:"calc(100% - 24px)"}),y=b=>{const{focused:u,pointed:h,compact:w,aside:g,toolbar:_,negative:C,children:O,onClick:k,onMouseMove:S,onMouseEnter:E,onMouseLeave:A,onDelete:N,onEdit:x}=b,[I]=(0,d.useT)(),[R,T]=e.useState(!1),q=N?e.createElement(n.CancelAction,{tooltip:I("Delete"),onClick:N,onMouseEnter:()=>T(!0),onMouseOver:()=>T(!0),onMouseLeave:()=>T(!1)}):void 0,B=r+(w?c:"")+(h?C?o:s:"")+(R?i:"")+(u?C?m:f:"");return e.createElement("span",{className:B,style:{outline:R?`1px dotted ${a.negative}`:void 0},onMouseMove:S,onMouseEnter:E,onMouseLeave:A,onClick:k},O,q,!!u&&x&&e.createElement("span",{className:a.bottomRightActionPos},e.createElement(l.EditAction,{tooltip:I("Set"),onClick:x})),!!g&&e.createElement("span",{className:p},g),!!u&&!!_&&e.createElement("span",{className:v},_))};return pt.FocusRegion=y,pt}var ks={},cc;function ue(){return cc||(cc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FocusProvider=e.useIsFocused=e.useFocus=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useFocus=d;const a=l=>{const{focused:r}=(0,e.useFocus)();return r===l};e.useIsFocused=a;const n=({children:l,onFocus:r})=>{const[c,s]=t.useState(null),[o,i]=t.useState(null),f=t.useCallback(m=>{s(m),r?.(m)},[r]);return t.useEffect(()=>{const m=p=>{const v=document.activeElement;v&&(v.nodeName==="INPUT"||v.nodeName==="TEXTAREA")||p.key==="Escape"&&f(null)};return document.addEventListener("keydown",m,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",m)},[]),t.createElement(e.context.Provider,{value:{focused:c,focus:f,pointed:o,point:i}},l)};e.FocusProvider=n})(ks)),ks}var As={},ac;function Sl(){return ac||(ac=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputProvider=e.useInput=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useInput=d;const a=({children:n})=>{const l=(0,e.useInput)(),[r,c]=t.useState(!1);return t.useEffect(()=>{if(l)return;const s=()=>{c(!!document.activeElement&&document.activeElement.tagName==="INPUT")};return document.addEventListener("focus",s,!0),document.addEventListener("blur",s,!0),()=>{document.removeEventListener("focus",s),document.removeEventListener("blur",s)}},[]),l?n:t.createElement(e.context.Provider,{value:{focused:r}},n)};e.InputProvider=a})(As)),As}var uc;function Ol(){if(uc)return ht;uc=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.JsonHoverable=void 0;const e=M(),t=cr(),d=xi(),a=ue(),n=te(),l=Sl(),r=({pointer:c,children:s})=>{const{focused:o,focus:i,pointed:f,point:m}=(0,a.useFocus)(),{pfx:p,onChange:v}=e.useContext(t.context),{compact:y}=(0,n.useStyles)(),b=(0,l.useInput)(),u=p+c,h=C=>{C.stopPropagation(),f!==u&&m(u)},w=C=>{C.preventDefault(),C.stopPropagation(),m(u)},g=()=>{m(null)},_=C=>{C.preventDefault(),C.stopPropagation(),i(u)};return e.createElement(d.FocusRegion,{pointed:f===u,focused:o===u,compact:y,onClick:_,onMouseMove:h,onMouseEnter:w,onMouseLeave:g,onDelete:v&&!b.focused&&u===o?()=>v([{op:"remove",path:c}]):void 0},s)};return ht.JsonHoverable=r,ht}var yt={},vt={},wt={},_t={},Ct={},lc;function Zh(){if(lc)return Ct;lc=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.TypeSwitch=void 0;const e=M(),t=K(),d=(0,t.drule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",col:t.theme.color.sem.blue[0],d:"inline-block",pd:"2px 2px",mr:"0",bxz:"border-box",bd:0,bdrad:"1em"}));return Ct.TypeSwitch=e.memo(({value:a,onKeyDown:n,onClick:l})=>{const r=(0,t.useTheme)();return e.createElement("button",{className:d({bg:r.g(.96),"&:hover":{bg:r.g(.88)}}),onClick:l,onKeyDown:n},a)}),Ct}var dc;function $h(){if(dc)return _t;dc=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.CrdtTypeSwitch=void 0;const e=M(),t=Zh(),d=({types:a=["any","con","vec","val"],type:n,onSubmit:l,onClick:r})=>{const[c,s]=e.useState(a.findIndex(f=>f===n.current));e.useLayoutEffect(()=>{n.current=a[c]},[]);const o=()=>{s(f=>{const m=(f+1)%a.length;return n.current=a[m],m})},i=()=>{s(f=>{const m=(f-1+a.length)%a.length;return n.current=a[m],m})};return e.createElement("span",{style:{display:"inline-block",padding:"0 0 0 4px",margin:"-1px 0"}},e.createElement(t.TypeSwitch,{value:a[c],onClick:f=>{o(),r&&r(f)},onKeyDown:f=>{switch(f.key){case"ArrowDown":case"ArrowRight":{f.preventDefault(),o();break}case"ArrowUp":case"ArrowLeft":{f.preventDefault(),i();break}case"Enter":{f.preventDefault(),l&&(f.preventDefault(),l());break}}}}))};return _t.CrdtTypeSwitch=d,_t}var fc;function Ri(){if(fc)return wt;fc=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.ValueInput=void 0;const e=M(),t=K(),d=ar(),a=Q(),n=Ir(),l=$h(),r=Ni(),c=({inp:s,focus:o,initialValue:i="",visible:f,types:m=["any","con","val","vec"],initialType:p,withType:v,onSubmit:y,onCancel:b})=>{const[u,h]=e.useState(i),w=e.useRef(null),g=(0,t.useTheme)(),_=e.useRef(p??(m&&m.length?m[0]:"")),C=()=>{w.current&&w.current.blur(),h(""),y(u,_.current)},O=(0,n.inputStyle)(g,!g.isLight,u);O.display=f?void 0:"none",O.margin="-1px 0 -1px -2px",O.padding="3px 4px 3px 5px",O.border=`1px solid ${g.g(.85)}`;let k=null;return m&&m.length&&v&&(k=e.createElement(l.CrdtTypeSwitch,{type:_,onSubmit:C,onClick:()=>{w.current&&w.current.focus()}})),e.createElement("span",{className:a.input,style:O},e.createElement(d.FlexibleInput,{focus:o,inp:S=>{w.current=S,s&&s(S)},value:u,typeahead:(0,n.typeahead)(u),onChange:S=>h(S.target.value),onSubmit:C,onFocus:S=>(0,r.selectOnFocus)(S.target),onCancel:S=>{h(""),b&&b(S)},onTab:S=>{const E=(0,n.typeahead)(u);E&&(S.preventDefault(),h(u+E))}}),k)};return wt.ValueInput=c,wt}var St={},hc;function El(){if(hc)return St;hc=1,Object.defineProperty(St,"__esModule",{value:!0}),St.AddAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"+");return St.AddAction=d,St}var pc;function kl(){if(pc)return vt;pc=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.ObjectInsert=void 0;const e=M(),t=Oe(),d=Q(),a=K(),n=ar(),l=Ri(),r=El(),c=({visible:s,withType:o,onSubmit:i})=>{const[f]=(0,t.useT)(),[m,p]=e.useState(!1),[v,y]=e.useState(""),[b,u]=e.useState(""),h=e.useRef(null),w=e.useRef(null),g=(0,a.useTheme)(),_=(C,O)=>{w.current&&w.current.blur(),i(v,C,O),y(""),u(""),p(!1)};if(!s)return null;if(m){const C=e.createElement("span",{className:d.property+d.input,style:{color:g.g(.1),background:g.bg,display:s?void 0:"none",margin:"-1px 0 -1px -2px",padding:"3px 4px",border:`1px solid ${g.g(.85)}`,fontWeight:"bold"}},e.createElement(n.FlexibleInput,{focus:!0,inp:k=>h.current=k,value:v,onChange:k=>y(k.target.value),onSubmit:()=>{w.current&&w.current.focus()},onCancel:()=>{v?y(""):b?u(""):p(!1)}})),O=e.createElement(l.ValueInput,{inp:k=>w.current=k,visible:s,withType:o,onSubmit:_,onCancel:()=>{h.current&&h.current.focus()}});return e.createElement("span",{style:{display:s?void 0:"none"}},C,e.createElement("span",{className:d.colon},e.createElement("span",null,":")),O)}return e.createElement("span",{className:d.insArrBlock,style:{display:s?void 0:"none"},onClick:()=>p(!0)},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(r.AddAction,{tooltip:f("Add key"),onClick:()=>p(!0)})))};return vt.ObjectInsert=c,vt}var mc;function e0(){if(mc)return yt;mc=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.JsonObjectInsert=void 0;const e=M(),t=Rr(),d=cr(),a=kl(),n=({pointer:l,visible:r})=>{const{onChange:c}=e.useContext(d.context);if(!c)return null;const s=(o,i)=>{let f;try{f=JSON.parse(i)}catch{f=String(i)}c([{op:"add",path:l+"/"+(0,t.escapeComponent)(o),value:f}])};return e.createElement(a.ObjectInsert,{visible:r,onSubmit:s})};return yt.JsonObjectInsert=n,yt}var Ot={},Et={},bc;function Ii(){if(bc)return Et;bc=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.ArrayInsert=void 0;const e=M(),t=Oe(),d=Q(),a=Ri(),n=El(),l=Tr(),r=({visible:c,withType:s,onSubmit:o})=>{const[i]=(0,t.useT)(),[f,m]=e.useState(!1),p=(v,y)=>{m(!1),o(v,y)};return f?e.createElement("span",{style:{position:"relative"}},e.createElement(a.ValueInput,{focus:!0,withType:s,visible:c,onSubmit:p,onCancel:()=>m(!1)}),e.createElement(l.CancelAction,{onClick:()=>m(!1)})):e.createElement("span",{className:d.insArrBlock,style:{display:c?void 0:"none"}},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(n.AddAction,{tooltip:i("Insert"),onClick:()=>m(!0)})))};return Et.ArrayInsert=r,Et}var gc;function t0(){if(gc)return Ot;gc=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.JsonArrayInsert=void 0;const e=M(),t=cr(),d=Ii(),a=({pointer:n,visible:l})=>{const{onChange:r}=e.useContext(t.context);if(!r)return null;const c=s=>{let o;try{o=JSON.parse(s)}catch{o=String(s)}r([{op:"add",path:n,value:o}])};return e.createElement(d.ArrayInsert,{visible:l,onSubmit:c})};return Ot.JsonArrayInsert=a,Ot}var kt={},yc;function Al(){if(yc)return kt;yc=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.ObjectLayout=void 0;const e=M(),t=K(),d=Q(),a=te(),n=({property:l,collapsedView:r,header:c,collapsed:s,comma:o,brackets:i=["{","}"],children:f,onClick:m,onCollapserClick:p,onCollapsedClick:v,onBracketClick:y})=>{const[b,u]=e.useState(!1),h=(0,t.useTheme)(),{noCollapseToggles:w}=(0,a.useStyles)(),g=()=>{u(!0)},_=()=>{u(!1)},C=h.g(.3);r=e.createElement("span",{className:d.collapsed,style:{display:s?void 0:"none"},onClick:v},e.createElement("span",{style:{color:d.blue}},i[0]),r,e.createElement("span",{style:{color:d.blue}},i[1]));const O=e.createElement("span",null,l,e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:g,onMouseLeave:_,onClick:y},i[0],!!c&&e.createElement("span",{style:{display:"inline-block",position:"absolute",top:"-0.27em",left:"1em"}},c)));return e.createElement("span",{className:d.object,onClick:m},!w&&e.createElement("span",{className:d.collapser,style:{color:h.g(.6)},onClick:p},s?"+":"—"),O,r,e.createElement("span",{className:d.list,style:{display:s?"none":void 0}},f),e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:g,onMouseLeave:_,onClick:y},i[1]),!!o&&",")};return kt.ObjectLayout=n,kt}var vc;function n0(){return vc||(vc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonDoc=void 0;const t=M(),d=Q(),a=cr(),n=Cl(),l=Kh(),r=Ol(),c=e0(),s=t0(),o=Al(),i=ue(),f=te(),m=Rr(),p=({property:b,doc:u,pointer:h,parentCollapsed:w,comma:g,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,keepOrder:S,collapsed:E}=(0,f.useStyles)(),A=t.useMemo(()=>{const T=Object.keys(u);return S?T:T.sort()},[u]),[N,x]=t.useState(E),I=()=>{!N&&C+h===O&&x(!0)},R=A.map((T,q)=>{const B=`${h}/${(0,m.escapeComponent)(T)}`;return t.createElement("span",{key:T,className:d.line},t.createElement(r.JsonHoverable,{pointer:B},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{property:T,doc:u[T],pointer:B,parentCollapsed:N,comma:k&&q<A.length-1,onChange:_}))))});return t.createElement(o.ObjectLayout,{collapsed:N,collapsedView:!!A.length&&t.createElement("strong",null,A.length),comma:g,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(w),pointer:h,onChange:_}),onClick:()=>{N&&x(!1)},onCollapserClick:()=>x(T=>!T),onBracketClick:I},R,t.createElement(c.JsonObjectInsert,{pointer:h,visible:O===C+h}))},v=({property:b,doc:u,pointer:h,parentCollapsed:w,comma:g,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,collapsed:S}=(0,f.useStyles)(),[E,A]=t.useState(S),N=()=>{!E&&C+h===O&&A(!0)},x=u.map((I,R)=>{const T=`${h}/${R}`;return t.createElement(t.Fragment,{key:R},t.createElement(s.JsonArrayInsert,{pointer:`${h}/${R}`,visible:O===C+h}),t.createElement("span",{className:d.line},t.createElement(r.JsonHoverable,{pointer:T},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{doc:u[R],pointer:T,parentCollapsed:E,comma:k&&R<u.length-1,onChange:_})))))});return t.createElement(o.ObjectLayout,{collapsed:E,collapsedView:!!u.length&&t.createElement("strong",null,u.length),comma:g,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(w),pointer:h,onChange:_}),onClick:()=>{E&&A(!1)},onCollapserClick:()=>A(I=>!I),onBracketClick:N,brackets:["[","]"]},x,t.createElement(s.JsonArrayInsert,{pointer:`${h}/-`,visible:O===C+h}))},y=b=>{const{doc:u,comma:h}=b;return u?typeof u=="object"?Array.isArray(u)?t.createElement(v,Object.assign({},b,{doc:u})):u instanceof Uint8Array?t.createElement(l.JsonValue,Object.assign({},b,{comma:h})):t.createElement(p,Object.assign({},b,{doc:u})):t.createElement(l.JsonValue,Object.assign({},b)):t.createElement(l.JsonValue,Object.assign({},b))};e.JsonDoc=y})(Qr)),Qr}var At={},gr={},wc;function r0(){if(wc)return gr;wc=1,Object.defineProperty(gr,"__esModule",{value:!0});var e=M(),t=wl(),d=["mousedown","touchstart"],a=function(n,l,r){r===void 0&&(r=d);var c=e.useRef(l);e.useEffect(function(){c.current=l},[l]),e.useEffect(function(){for(var s=function(m){var p=n.current;p&&!p.contains(m.target)&&c.current(m)},o=0,i=r;o<i.length;o++){var f=i[o];t.on(document,f,s)}return function(){for(var m=0,p=r;m<p.length;m++){var v=p[m];t.off(document,v,s)}}},[r,n])};return gr.default=a,gr}var yr={},_c;function s0(){if(_c)return yr;_c=1,Object.defineProperty(yr,"__esModule",{value:!0});var e=M();function t(){var d=e.useRef(!1),a=e.useCallback(function(){return d.current},[]);return e.useEffect(function(){return d.current=!0,function(){d.current=!1}},[]),a}return yr.default=t,yr}var Cc;function Nl(){if(Cc)return At;Cc=1,Object.defineProperty(At,"__esModule",{value:!0}),At.Root=void 0;const e=M(),t=r0(),d=s0(),a=te(),n=ue(),l=Sl(),c=(0,K().rule)({d:"inline-block",ff:"monospace"}),s=({children:o,onFocus:i})=>{const f=(0,d.default)(),m=(0,a.useStyles)(),{focused:p,focus:v,point:y}=(0,n.useFocus)(),b=e.useRef(null),u=e.useRef(p);return(0,t.default)(b,()=>{f&&(y(null),v(null))}),i&&p!==u.current&&(u.current=p,i(p)),e.createElement(l.InputProvider,null,e.createElement("span",{ref:b,className:c,style:{fontSize:m.fontSize||"13.4px"}},o))};return At.Root=s,At}var Sc;function xl(){if(Sc)return Ze;Sc=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ClickableJson=void 0;const e=M(),t=cr(),d=te(),a=n0(),n=Nl(),l=ue(),r=Ol(),c=s=>{var o;const{onFocus:i}=s,f=s.readonly?void 0:s.onChange;return e.createElement(l.FocusProvider,null,e.createElement(d.context.Provider,{value:s},e.createElement(t.context.Provider,{value:{pfx:(o=s.pfx)!==null&&o!==void 0?o:"",onChange:f}},e.createElement(n.Root,{onFocus:i},e.createElement(r.JsonHoverable,{pointer:""},e.createElement(a.JsonDoc,Object.assign({},s,{pointer:"",onChange:f})))))))};return Ze.ClickableJson=c,Ze}var Nt={},Ns={},Oc;function le(){return Oc||(Oc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useJsonCrdt=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useJsonCrdt=d})(Ns)),Ns}var Re={},Ec;function lr(){if(Ec)return Re;Ec=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.nodeRef=Re.NodeRef=void 0;let e=class{constructor(n,l,r){this.node=n,this.parent=l,this.step=r}};Re.NodeRef=e;const t=new WeakMap,d=(a,n,l)=>{try{const r=t.get(a);if(r)return r;const c=new e(a,n,l);return t.set(a,c),c}catch{return}};return Re.nodeRef=d,Re}var xs={},Rs={},Is={},kc;function i0(){return kc||(kc=1,Object.defineProperty(Is,"__esModule",{value:!0})),Is}var Ts={},xt={},js={},Ps={},Ac;function o0(){return Ac||(Ac=1,Object.defineProperty(Ps,"__esModule",{value:!0})),Ps}var Ms={},Nc;function c0(){return Nc||(Nc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class t{constructor(b,u){this.sid=b,this.time=u}}e.Timestamp=t;class d{constructor(b,u,h){this.sid=b,this.time=u,this.span=h}}e.Timespan=d;const a=(y,b)=>new t(y,b);e.ts=a;const n=(y,b,u)=>new d(y,b,u);e.tss=n;const l=(y,b)=>(0,e.ts)(y.sid,y.time+b);e.tick=l;const r=(y,b)=>y.time===b.time&&y.sid===b.sid;e.equal=r;const c=(y,b)=>{const u=y.time,h=b.time;if(u>h)return 1;if(u<h)return-1;const w=y.sid,g=b.sid;return w>g?1:w<g?-1:0};e.compare=c;const s=(y,b,u,h)=>{if(y.sid!==u.sid)return!1;const w=y.time,g=u.time;return!(w>g||w+b<g+h)};e.contains=s;const o=(y,b,u)=>{if(y.sid!==u.sid)return!1;const h=y.time,w=u.time;return!(h>w||h+b<w+1)};e.containsId=o;const i=y=>{if(y.sid===1)return"."+y.time;let b=""+y.sid;return b.length>4&&(b=".."+b.slice(b.length-4)),b+"."+y.time};e.printTs=i;const f=(y,b,u)=>new d(y.sid,y.time+b,u);e.interval=f;class m extends t{tick(b){const u=new t(this.sid,this.time);return this.time+=b,u}}e.LogicalClock=m;class p extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,u){const h=b.time+u-1,w=b.sid;if(w!==this.sid){const g=this.peers.get(b.sid);g?h>g.time&&(g.time=h):this.peers.set(b.sid,(0,e.ts)(w,h))}h>=this.time&&(this.time=h+1)}clone(){return this.fork(this.sid)}fork(b){const u=new p(b,this.time);return b!==this.sid&&u.observe((0,e.tick)(this,-1),1),this.peers.forEach(h=>{u.observe(h,1)}),u}toString(b=""){const u=this.peers.size;let h=1,w="";return this.peers.forEach(g=>{w+=`
${b}${h===u?"└─":"├─"} ${g.sid}.${g.time}`,h++}),`clock ${this.sid}.${this.time}${w}`}}e.ClockVector=p;class v extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,u){if(b.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<b.time)throw new Error("TIME_TRAVEL");const h=b.time+u;h>this.time&&(this.time=h)}clone(){return this.fork()}fork(){return new v(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=v})(Ms)),Ms}var xc;function z(){return xc||(xc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(o0(),e),t.__exportStar(c0(),e)})(js)),js}var Rc;function jr(){if(Rc)return xt;Rc=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.ConNode=void 0;const e=z();let t=class{constructor(a,n){this.id=a,this.val=n,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(a){const n=this.val,l=n instanceof Uint8Array?`Uint8Array { ${(""+n).replaceAll(",",", ")} }`:`{ ${n instanceof e.Timestamp?(0,e.printTs)(n):JSON.stringify(n)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${l}`}};return xt.ConNode=t,xt}var Rt={},It={},Ic;function pe(){if(Ic)return It;Ic=1,Object.defineProperty(It,"__esModule",{value:!0}),It.printTree=void 0;const e=(t="",d)=>{let a="",n=d.length-1;for(;n>=0&&!d[n];n--);for(let l=0;l<=n;l++){const r=d[l];if(!r)continue;const c=l===n,s=r(t+(c?" ":"│")+"  "),o=s?c?"└─":"├─":"│";a+=`
`+t+o+(s?" "+s:"")}return a};return It.printTree=e,It}var Ie={},F={},Tc;function Ye(){if(Tc)return F;Tc=1,Object.defineProperty(F,"__esModule",{value:!0}),F.NopOp=F.DelOp=F.UpdArrOp=F.InsArrOp=F.InsBinOp=F.InsStrOp=F.InsVecOp=F.InsObjOp=F.InsValOp=F.NewArrOp=F.NewBinOp=F.NewStrOp=F.NewVecOp=F.NewObjOp=F.NewValOp=F.NewConOp=void 0;const e=pe(),t=z();class d{constructor(g){this.id=g}span(){return 1}toString(){let g=this.name()+" "+(0,t.printTs)(this.id);const _=this.span();return _>1&&(g+="!"+_),g}}class a extends d{constructor(g,_){super(g),this.id=g,this.val=_}name(){return"new_con"}toString(){const g=this.val,_="Uint8Array",C=g instanceof t.Timestamp?`{ ${(0,t.printTs)(g)} }`:g instanceof Uint8Array?g.length<13?`${_} { ${(""+g).replaceAll(",",", ")} }`:`${_}(${g.length})`:`{ ${JSON.stringify(g)} }`;return super.toString()+" "+C}}F.NewConOp=a;class n extends d{name(){return"new_val"}}F.NewValOp=n;class l extends d{name(){return"new_obj"}}F.NewObjOp=l;class r extends d{name(){return"new_vec"}}F.NewVecOp=r;class c extends d{name(){return"new_str"}}F.NewStrOp=c;class s extends d{name(){return"new_bin"}}F.NewBinOp=s;class o extends d{name(){return"new_arr"}}F.NewArrOp=o;class i extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.val=C}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}, val = ${(0,t.printTs)(this.val)}`}}F.InsValOp=i;class f extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.data=C}name(){return"ins_obj"}toString(g=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(g,this.data.map(C=>O=>`${JSON.stringify(C[0])}: ${(0,t.printTs)(C[1])}`))}}F.InsObjOp=f;class m extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.data=C}name(){return"ins_vec"}toString(g=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(g,this.data.map(C=>O=>`${C[0]}: ${(0,t.printTs)(C[1])}`))}}F.InsVecOp=m;class p extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${(0,t.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}F.InsStrOp=p;class v extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_bin"}toString(){const g=(0,t.printTs)(this.ref);return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${g} ← ${this.data} }`}}F.InsBinOp=v;class y extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_arr"}toString(){const g=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=this.data.map(t.printTs).join(", ");return super.toString()+", obj = "+g+" { "+_+" ← "+C+" }"}}F.InsArrOp=y;class b extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.val=O}name(){return"upd_arr"}toString(){const g=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=(0,t.printTs)(this.val);return super.toString()+", obj = "+g+" { "+_+": "+C+" }"}}F.UpdArrOp=b;class u extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.what=C}name(){return"del"}toString(){const g=this.what.map(_=>(0,t.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${g} }`}}F.DelOp=u;class h extends d{constructor(g,_){super(g),this.id=g,this.len=_}span(){return this.len}name(){return"nop"}}return F.NopOp=h,F}var Te={},Tt={},jt={},Pt={},jc;function a0(){if(jc)return Pt;jc=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.RelativeTimestamp=void 0;let e=class{constructor(d,a){this.sessionIndex=d,this.timeDiff=a}};return Pt.RelativeTimestamp=e,Pt}var Pc;function u0(){if(Pc)return jt;Pc=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.ClockEncoder=void 0;const e=z(),t=a0();class d{constructor(l,r){this.index=l,this.clock=r}}let a=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(l){this.index=1,this.clock=l;const r=new d(this.index++,(0,e.tick)(l,-1));this.table.clear(),this.table.set(l.sid,r)}append(l){const r=l.time,c=l.sid;let s=this.table.get(c);if(!s){let f=this.clock.peers.get(c);f||(f=new e.Timestamp(c,this.clock.time-1)),s=new d(this.index++,f),this.table.set(c,s)}const i=s.clock.time-r;if(i<0)throw new Error("TIME_TRAVEL");return new t.RelativeTimestamp(s.index,i)}toJson(){const l=[];return this.table.forEach(r=>{const c=r.clock;l.push(c.sid,c.time)}),l}};return jt.ClockEncoder=a,jt}var Mt={},qt={},Bt={},Mc;function l0(){if(Mc)return Bt;Mc=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Slice=void 0;let e=class{constructor(d,a,n,l){this.uint8=d,this.view=a,this.start=n,this.end=l}subarray(){return this.uint8.subarray(this.start,this.end)}};return Bt.Slice=e,Bt}var qc;function Rl(){if(qc)return qt;qc=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Writer=void 0;const e=l0(),t=new Uint8Array([]),d=new DataView(t.buffer),a=typeof ae.Buffer=="function",n=a?ae.Buffer.prototype.utf8Write:null,l=a?ae.Buffer.from:null,r=typeof TextEncoder<"u"?new TextEncoder:null;let c=class{constructor(o=64*1024){this.allocSize=o,this.view=d,this.x0=0,this.x=0,this.uint8=new Uint8Array(o),this.size=o,this.view=new DataView(this.uint8.buffer)}grow(o){const i=this.x0,f=this.x,m=this.uint8,p=new Uint8Array(o),v=new DataView(p.buffer),y=m.subarray(i,f);p.set(y,0),this.x=f-i,this.x0=0,this.uint8=p,this.size=o,this.view=v}ensureCapacity(o){const i=this.size,f=i-this.x;if(f<o){const m=i-this.x0,p=o-f,v=m+p;this.grow(v<=this.allocSize?this.allocSize:v*2)}}move(o){this.ensureCapacity(o),this.x+=o}reset(){this.x0=this.x}newBuffer(o){const i=this.uint8=new Uint8Array(o);this.size=o,this.view=new DataView(i.buffer),this.x=this.x0=0}flush(){const o=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,o}flushSlice(){const o=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,o}u8(o){this.ensureCapacity(1),this.uint8[this.x++]=o}u16(o){this.ensureCapacity(2),this.view.setUint16(this.x,o),this.x+=2}u32(o){this.ensureCapacity(4),this.view.setUint32(this.x,o),this.x+=4}i32(o){this.ensureCapacity(4),this.view.setInt32(this.x,o),this.x+=4}u64(o){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(o)),this.x+=8}f64(o){this.ensureCapacity(8),this.view.setFloat64(this.x,o),this.x+=8}u8u16(o,i){this.ensureCapacity(3);let f=this.x;this.uint8[f++]=o,this.uint8[f++]=i>>>8,this.uint8[f++]=i&255,this.x=f}u8u32(o,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=o,this.view.setUint32(f,i),this.x=f+4}u8u64(o,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=o,this.view.setBigUint64(f,BigInt(i)),this.x=f+8}u8f32(o,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=o,this.view.setFloat32(f,i),this.x=f+4}u8f64(o,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=o,this.view.setFloat64(f,i),this.x=f+8}buf(o,i){this.ensureCapacity(i);const f=this.x;this.uint8.set(o,f),this.x=f+i}utf8(o){const i=o.length*4;if(i<168)return this.utf8Native(o);if(n){const f=n.call(this.uint8,o,this.x,i);return this.x+=f,f}else if(l){const f=this.uint8,m=f.byteOffset+this.x,v=l(f.buffer).subarray(m,m+i).write(o,0,i,"utf8");return this.x+=v,v}else if(i>1024&&r){const f=r.encodeInto(o,this.uint8.subarray(this.x,this.x+i)).written;return this.x+=f,f}return this.utf8Native(o)}utf8Native(o){const i=o.length,f=this.uint8;let m=this.x,p=0;for(;p<i;){let y=o.charCodeAt(p++);if((y&4294967168)===0){f[m++]=y;continue}else if((y&4294965248)===0)f[m++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&p<i){const b=o.charCodeAt(p);(b&64512)===56320&&(p++,y=((y&1023)<<10)+(b&1023)+65536)}(y&4294901760)===0?(f[m++]=y>>12&15|224,f[m++]=y>>6&63|128):(f[m++]=y>>18&7|240,f[m++]=y>>12&63|128,f[m++]=y>>6&63|128)}f[m++]=y&63|128}const v=m-this.x;return this.x=m,v}ascii(o){const i=o.length;this.ensureCapacity(i);const f=this.uint8;let m=this.x,p=0;for(;p<i;)f[m++]=o.charCodeAt(p++);this.x=m}};return qt.Writer=c,qt}var Bc;function Ti(){if(Bc)return Mt;Bc=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.CrdtWriter=void 0;const e=Rl();let t=class extends e.Writer{id(a,n){a<=7&&n<=15?this.u8(a<<4|n):(this.b1vu56(1,a),this.vu57(n))}vu57(a){if(a<=127)this.u8(a);else if(a<=16383){this.ensureCapacity(2);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=a>>>7}else if(a<=2097151){this.ensureCapacity(3);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=a>>>14}else if(a<=268435455){this.ensureCapacity(4);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=128|a>>>14&127,n[this.x++]=a>>>21}else{let n=a|0;n<0&&(n+=4294967296);const l=(a-n)/4294967296;if(a<=34359738367){this.ensureCapacity(5);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=l<<4|a>>>28}else if(a<=4398046511103){this.ensureCapacity(6);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(l&7)<<4|a>>>28,r[this.x++]=l>>>3}else if(a<=562949953421311){this.ensureCapacity(7);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(l&7)<<4|a>>>28,r[this.x++]=128|(l&1016)>>>3,r[this.x++]=l>>>10}else{this.ensureCapacity(8);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(l&7)<<4|a>>>28,r[this.x++]=128|(l&1016)>>>3,r[this.x++]=128|(l&130048)>>>10,r[this.x++]=l>>>17}}}b1vu56(a,n){if(n<=63)this.u8(a<<7|n);else{const l=a<<7|64;if(n<=8191){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=l|n&63,r[this.x++]=n>>>6}else if(n<=1048575){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=l|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=n>>>13}else if(n<=134217727){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=l|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=128|n>>>13&127,r[this.x++]=n>>>20}else{let r=n|0;r<0&&(r+=4294967296);const c=(n-r)/4294967296;if(n<=17179869183){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=l|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=c<<5|n>>>27}else if(n<=2199023255551){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=l|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=c>>>2}else if(n<=0xffffffffffff){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=l|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=128|(c&508)>>>2,s[this.x++]=c>>>9}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=l|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=128|(c&508)>>>2,s[this.x++]=128|(c&65024)>>>9,s[this.x++]=c>>>16}}}}};return Mt.CrdtWriter=t,Mt}var Vt={},Jt={},Vc;function d0(){if(Vc)return Jt;Vc=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),t=d=>(e.setFloat32(0,d),d===e.getFloat32(0));return Jt.isFloat32=t,Jt}var Lt={},Jc;function Il(){if(Jc)return Lt;Jc=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.JsonPackExtension=void 0;let e=class{constructor(d,a){this.tag=d,this.val=a}};return Lt.JsonPackExtension=e,Lt}var Dt={},Lc;function f0(){if(Lc)return Dt;Lc=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.CborEncoderFast=void 0;const e=Rl(),t=Number.isSafeInteger;let d=class{constructor(n=new e.Writer){this.writer=n}encode(n){return this.writeAny(n),this.writer.flush()}encodeToSlice(n){return this.writeAny(n),this.writer.flushSlice()}writeAny(n){switch(typeof n){case"number":return this.writeNumber(n);case"string":return this.writeStr(n);case"boolean":return this.writer.u8(244+ +n);case"object":return n?n.constructor===Array?this.writeArr(n):this.writeObj(n):this.writer.u8(246)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(n){n?this.writer.u8(245):this.writer.u8(244)}writeNumber(n){t(n)?this.writeInteger(n):typeof n=="bigint"?this.writeBigInt(n):this.writeFloat(n)}writeBigInt(n){n>=0?this.writeBigUint(n):this.writeBigSint(n)}writeBigUint(n){if(n<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(n));this.writer.u8u64(27,n)}writeBigSint(n){if(n>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(n));const l=-BigInt(1)-n;this.writer.u8u64(59,l)}writeInteger(n){n>=0?this.writeUInteger(n):this.encodeNint(n)}writeUInteger(n){const l=this.writer;l.ensureCapacity(9);const r=l.uint8;let c=l.x;n<=23?r[c++]=0+n:n<=255?(r[c++]=24,r[c++]=n):n<=65535?(r[c++]=25,l.view.setUint16(c,n),c+=2):n<=4294967295?(r[c++]=26,l.view.setUint32(c,n),c+=4):(r[c++]=27,l.view.setBigUint64(c,BigInt(n)),c+=8),l.x=c}encodeNumber(n){this.writeNumber(n)}encodeInteger(n){this.writeInteger(n)}encodeUint(n){this.writeUInteger(n)}encodeNint(n){const l=-1-n,r=this.writer;r.ensureCapacity(9);const c=r.uint8;let s=r.x;l<24?c[s++]=32+l:l<=255?(c[s++]=56,c[s++]=l):l<=65535?(c[s++]=57,r.view.setUint16(s,l),s+=2):l<=4294967295?(c[s++]=58,r.view.setUint32(s,l),s+=4):(c[s++]=59,r.view.setBigUint64(s,BigInt(l)),s+=8),r.x=s}writeFloat(n){this.writer.u8f64(251,n)}writeBin(n){const l=n.length;this.writeBinHdr(l),this.writer.buf(n,l)}writeBinHdr(n){const l=this.writer;n<=23?l.u8(64+n):n<=255?l.u16(22528+n):n<=65535?l.u8u16(89,n):n<=4294967295?l.u8u32(90,n):l.u8u64(91,n)}writeStr(n){const l=this.writer,c=n.length*4;l.ensureCapacity(5+c);const s=l.uint8;let o=l.x;c<=23?l.x++:c<=255?(s[l.x++]=120,o=l.x,l.x++):c<=65535?(s[l.x++]=121,o=l.x,l.x+=2):(s[l.x++]=122,o=l.x,l.x+=4);const i=l.utf8(n);c<=23?s[o]=96+i:c<=255?s[o]=i:c<=65535?l.view.setUint16(o,i):l.view.setUint32(o,i)}writeStrHdr(n){const l=this.writer;n<=23?l.u8(96+n):n<=255?l.u16(30720+n):n<=65535?l.u8u16(121,n):l.u8u32(122,n)}writeAsciiStr(n){this.writeStrHdr(n.length),this.writer.ascii(n)}writeArr(n){const l=n.length;this.writeArrHdr(l);for(let r=0;r<l;r++)this.writeAny(n[r])}writeArrHdr(n){const l=this.writer;n<=23?l.u8(128+n):n<=255?l.u16(38912+n):n<=65535?l.u8u16(153,n):n<=4294967295?l.u8u32(154,n):l.u8u64(155,n)}writeObj(n){const l=Object.keys(n),r=l.length;this.writeObjHdr(r);for(let c=0;c<r;c++){const s=l[c];this.writeStr(s),this.writeAny(n[s])}}writeObjHdr(n){const l=this.writer;n<=23?l.u8(160+n):n<=255?l.u16(47104+n):n<=65535?l.u8u16(185,n):n<=4294967295?l.u8u32(186,n):l.u8u64(187,n)}writeMapHdr(n){this.writeObjHdr(n)}writeStartMap(){this.writer.u8(191)}writeTag(n,l){this.writeTagHdr(n),this.writeAny(l)}writeTagHdr(n){const l=this.writer;n<=23?l.u8(192+n):n<=255?l.u16(55296+n):n<=65535?l.u8u16(217,n):n<=4294967295?l.u8u32(218,n):l.u8u64(219,n)}writeTkn(n){const l=this.writer;n<=23?l.u8(224+n):n<=255&&l.u16(63488+n)}writeStartStr(){this.writer.u8(127)}writeStrChunk(n){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(n){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(n){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(n,l){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return Dt.CborEncoderFast=d,Dt}var Ft={},Dc;function ji(){if(Dc)return Ft;Dc=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.JsonPackValue=void 0;let e=class{constructor(d){this.val=d}};return Ft.JsonPackValue=e,Ft}var Fc;function Tl(){if(Fc)return Vt;Fc=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.CborEncoder=void 0;const e=d0(),t=Il(),d=f0(),a=ji();let n=class extends d.CborEncoderFast{writeUnknown(r){this.writeNull()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Object:return this.writeObj(r);case Array:return this.writeArr(r);case Uint8Array:return this.writeBin(r);case Map:return this.writeMap(r);case t.JsonPackExtension:return this.writeTag(r.tag,r.val);case a.JsonPackValue:const s=r.val;return this.writer.buf(s,s.length);default:return r instanceof Uint8Array?this.writeBin(r):Array.isArray(r)?this.writeArr(r):r instanceof Map?this.writeMap(r):this.writeUnknown(r)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(r);default:return this.writeUnknown(r)}}writeFloat(r){(0,e.isFloat32)(r)?this.writer.u8f32(250,r):this.writer.u8f64(251,r)}writeMap(r){this.writeMapHdr(r.size),r.forEach((c,s)=>{this.writeAny(s),this.writeAny(c)})}writeUndef(){this.writer.u8(247)}};return Vt.CborEncoder=n,Vt}var je={},Uc;function jl(){if(Uc)return je;Uc=1,Object.defineProperty(je,"__esModule",{value:!0}),je.CRDT_MAJOR_OVERLAY=je.CRDT_MAJOR=void 0;var e;(function(d){d[d.CON=0]="CON",d[d.VAL=1]="VAL",d[d.OBJ=2]="OBJ",d[d.VEC=3]="VEC",d[d.STR=4]="STR",d[d.BIN=5]="BIN",d[d.ARR=6]="ARR"})(e||(je.CRDT_MAJOR=e={}));var t;return(function(d){d[d.CON=0]="CON",d[d.VAL=32]="VAL",d[d.VEC=96]="VEC",d[d.OBJ=64]="OBJ",d[d.STR=128]="STR",d[d.BIN=160]="BIN",d[d.ARR=192]="ARR"})(t||(je.CRDT_MAJOR_OVERLAY=t={})),je}var Gc;function h0(){if(Gc)return Tt;Gc=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Encoder=void 0;const t=L.__importStar(Ee()),d=u0(),a=Ti(),n=z(),l=Tl(),r=jl();class c extends l.CborEncoder{constructor(o){super(o||new a.CrdtWriter),this.clockEncoder=new d.ClockEncoder,this.time=0,this.cTableEntry=i=>{const f=i.clock,m=this.writer;m.vu57(f.sid),m.vu57(f.time)},this.tsLogical=i=>{const f=this.clockEncoder.append(i);this.writer.id(f.sessionIndex,f.timeDiff)},this.tsServer=i=>{this.writer.vu57(i.time)},this.ts=this.tsLogical,this.cKey=(i,f)=>{this.writeStr(f),this.cNode(this.doc.index.get(i))}}encode(o){this.doc=o;const i=this.writer;return i.reset(),o.clock.sid===1?this.encodeServer(o):this.encodeLogical(o),i.flush()}encodeLogical(o){const i=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(o.clock),i.ensureCapacity(4);const f=i.x0,m=i.x;i.x+=4,this.cRoot(o.root),this.encodeClockTable(f,m)}encodeServer(o){this.ts=this.tsServer;const i=this.writer;i.u8(128),i.vu57(this.time=o.clock.time),this.cRoot(o.root)}encodeClockTable(o,i){const f=this.writer,m=f.x0-o;f.view.setUint32(f.x0+(i-o),f.x-i-m-4);const v=this.clockEncoder.table,y=v.size;f.vu57(y),v.forEach(this.cTableEntry)}cRoot(o){o.val.sid===0?this.writer.u8(0):this.cNode(o.node())}writeTL(o,i){const f=this.writer;i<31?f.u8(o|i):(f.u8(o|31),f.vu57(i))}cNode(o){o instanceof t.ConNode?this.cCon(o):o instanceof t.ValNode?this.cVal(o):o instanceof t.StrNode?this.cStr(o):o instanceof t.ObjNode?this.cObj(o):o instanceof t.VecNode?this.cVec(o):o instanceof t.ArrNode?this.cArr(o):o instanceof t.BinNode&&this.cBin(o)}cCon(o){const i=o.val;this.ts(o.id),i instanceof n.Timestamp?(this.writer.u8(1),this.ts(i)):(this.writer.u8(0),this.writeAny(i))}cVal(o){this.ts(o.id),this.writer.u8(32),this.cNode(o.node())}cObj(o){this.ts(o.id);const i=o.keys;this.writeTL(r.CRDT_MAJOR_OVERLAY.OBJ,i.size),i.forEach(this.cKey)}cVec(o){const i=o.elements,f=i.length;this.ts(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.VEC,f);const m=this.doc.index;for(let p=0;p<f;p++){const v=i[p];v?this.cNode(m.get(v)):this.writer.u8(0)}}cStr(o){const i=this.ts;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.STR,o.count);for(let f=o.first();f;f=o.next(f))i(f.id),f.del?this.writeUInteger(f.span):this.writeStr(f.data)}cBin(o){const i=this.ts,f=this.writer;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.BIN,o.count);for(let m=o.first();m;m=o.next(m)){i(m.id);const p=m.span,v=m.del;f.b1vu56(~~v,p),!v&&f.buf(m.data,p)}}cArr(o){const i=this.ts,f=this.writer;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.ARR,o.count);const m=this.doc.index;for(let p=o.first();p;p=o.next(p)){i(p.id);const v=p.span,y=p.del;if(f.b1vu56(~~y,v),y)continue;const b=p.data;for(let u=0;u<v;u++)this.cNode(m.get(b[u]))}}}return Tt.Encoder=c,Tt}var Ut={},Gt={},Hc;function p0(){if(Hc)return Gt;Hc=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ClockDecoder=void 0;const e=z();let t=class Pl{static fromArr(a){const n=new Pl(a[0],a[1]),l=a.length;for(let r=2;r<l;r+=2)n.pushTuple(a[r],a[r+1]);return n}constructor(a,n){this.table=[],this.clock=new e.ClockVector(a,n+1),this.table.push((0,e.ts)(a,n))}pushTuple(a,n){const l=(0,e.ts)(a,n);this.clock.observe(l,1),this.table.push(l)}decodeId(a,n){if(!a)return(0,e.ts)(0,n);const l=this.table[a-1];if(!l)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(l.sid,l.time-n)}};return Gt.ClockDecoder=t,Gt}var Ht={},zt={},Wt={},vr={},Pe={},zc;function m0(){if(zc)return Pe;zc=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.decodeAsciiMax15=Pe.decodeAscii=void 0;const e=String.fromCharCode,t=(a,n,l)=>{const r=[];for(let c=0;c<l;c++){const s=a[n++];if(s&128)return;r.push(s)}return e.apply(String,r)};Pe.decodeAscii=t;const d=(a,n,l)=>{if(l<4)if(l<2){if(l===0)return"";{const r=a[n++];if((r&128)>1){n-=1;return}return e(r)}}else{const r=a[n++],c=a[n++];if((r&128)>0||(c&128)>0){n-=2;return}if(l<3)return e(r,c);const s=a[n++];if((s&128)>0){n-=3;return}return e(r,c,s)}else{const r=a[n++],c=a[n++],s=a[n++],o=a[n++];if((r&128)>0||(c&128)>0||(s&128)>0||(o&128)>0){n-=4;return}if(l<6){if(l===4)return e(r,c,s,o);{const i=a[n++];if((i&128)>0){n-=5;return}return e(r,c,s,o,i)}}else if(l<8){const i=a[n++],f=a[n++];if((i&128)>0||(f&128)>0){n-=6;return}if(l<7)return e(r,c,s,o,i,f);const m=a[n++];if((m&128)>0){n-=7;return}return e(r,c,s,o,i,f,m)}else{const i=a[n++],f=a[n++],m=a[n++],p=a[n++];if((i&128)>0||(f&128)>0||(m&128)>0||(p&128)>0){n-=8;return}if(l<10){if(l===8)return e(r,c,s,o,i,f,m,p);{const v=a[n++];if((v&128)>0){n-=9;return}return e(r,c,s,o,i,f,m,p,v)}}else if(l<12){const v=a[n++],y=a[n++];if((v&128)>0||(y&128)>0){n-=10;return}if(l<11)return e(r,c,s,o,i,f,m,p,v,y);const b=a[n++];if((b&128)>0){n-=11;return}return e(r,c,s,o,i,f,m,p,v,y,b)}else{const v=a[n++],y=a[n++],b=a[n++],u=a[n++];if((v&128)>0||(y&128)>0||(b&128)>0||(u&128)>0){n-=12;return}if(l<14){if(l===12)return e(r,c,s,o,i,f,m,p,v,y,b,u);{const h=a[n++];if((h&128)>0){n-=13;return}return e(r,c,s,o,i,f,m,p,v,y,b,u,h)}}else{const h=a[n++],w=a[n++];if((h&128)>0||(w&128)>0){n-=14;return}if(l<15)return e(r,c,s,o,i,f,m,p,v,y,b,u,h,w);const g=a[n++];if((g&128)>0){n-=15;return}return e(r,c,s,o,i,f,m,p,v,y,b,u,h,w,g)}}}}};return Pe.decodeAsciiMax15=d,Pe}var wr={},Wc;function b0(){if(Wc)return wr;Wc=1,Object.defineProperty(wr,"__esModule",{value:!0});const e=String.fromCharCode;return wr.default=(t,d,a)=>{let n=d;const l=n+a,r=[];for(;n<l;){let c=t[n++];if((c&128)!==0){const s=t[n++]&63;if((c&224)===192)c=(c&31)<<6|s;else{const o=t[n++]&63;if((c&240)===224)c=(c&31)<<12|s<<6|o;else if((c&248)===240){const i=t[n++]&63;let f=(c&7)<<18|s<<12|o<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;c=56320|f&1023,r.push(m)}else c=f}}}r.push(c)}return e.apply(String,r)},wr}var Kc;function g0(){if(Kc)return vr;Kc=1,Object.defineProperty(vr,"__esModule",{value:!0});const e=L,t=m0(),d=e.__importDefault(b0()),a=typeof ae.Buffer<"u",n=a?ae.Buffer.prototype.utf8Slice:null,l=a?ae.Buffer.from:null,r=(i,f,m)=>(0,t.decodeAsciiMax15)(i,f,m)??(0,d.default)(i,f,m),c=(i,f,m)=>(0,t.decodeAscii)(i,f,m)??(0,d.default)(i,f,m),s=n?(i,f,m)=>n.call(i,f,f+m):l?(i,f,m)=>l(i).subarray(f,f+m).toString("utf8"):d.default,o=(i,f,m)=>m<16?r(i,f,m):m<32?c(i,f,m):s(i,f,m);return vr.default=o,vr}var Yc;function y0(){if(Yc)return Wt;Yc=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.decodeUtf8=void 0;const t=L.__importDefault(g0());return Wt.decodeUtf8=t.default,Wt}var Xc;function Ml(){if(Xc)return zt;Xc=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Reader=void 0;const e=y0();let t=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(a){this.x=0,this.uint8=a,this.view=new DataView(a.buffer,a.byteOffset,a.length)}peak(){return this.view.getUint8(this.x)}skip(a){this.x+=a}buf(a){const n=this.x+a,l=this.uint8.subarray(this.x,n);return this.x=n,l}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let a=this.x;const n=(this.uint8[a++]<<8)+this.uint8[a++];return this.x=a,n}i16(){const a=this.view.getInt16(this.x);return this.x+=2,a}u32(){const a=this.view.getUint32(this.x);return this.x+=4,a}i32(){const a=this.view.getInt32(this.x);return this.x+=4,a}u64(){const a=this.view.getBigUint64(this.x);return this.x+=8,a}i64(){const a=this.view.getBigInt64(this.x);return this.x+=8,a}f32(){const a=this.x;return this.x+=4,this.view.getFloat32(a)}f64(){const a=this.x;return this.x+=8,this.view.getFloat64(a)}utf8(a){const n=this.x;return this.x+=a,(0,e.decodeUtf8)(this.uint8,n,a)}ascii(a){const n=this.uint8;let l="";const r=this.x+a;for(let c=this.x;c<r;c++)l+=String.fromCharCode(n[c]);return this.x=r,l}};return zt.Reader=t,zt}var Qc;function ql(){if(Qc)return Ht;Qc=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CrdtReader=void 0;const e=Ml();let t=class extends e.Reader{id(){const a=this.u8();return a<=127?[a>>>4,a&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const a=this.u8();if(a<=127)return a;const n=this.u8();if(n<=127)return n<<7|a&127;const l=this.u8();if(l<=127)return l<<14|(n&127)<<7|a&127;const r=this.u8();if(r<=127)return r<<21|(l&127)<<14|(n&127)<<7|a&127;const c=this.u8();if(c<=127)return c*268435456+((r&127)<<21|(l&127)<<14|(n&127)<<7|a&127);const s=this.u8();if(s<=127)return s*34359738368+((c&127)*268435456+((r&127)<<21|(l&127)<<14|(n&127)<<7|a&127));const o=this.u8();return o<=127?o*4398046511104+((s&127)*34359738368+((c&127)*268435456+((r&127)<<21|(l&127)<<14|(n&127)<<7|a&127))):this.u8()*562949953421312+((o&127)*4398046511104+((s&127)*34359738368+((c&127)*268435456+((r&127)<<21|(l&127)<<14|(n&127)<<7|a&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const a=this.u8(),n=a&128?1:0,l=127&a;if(l<=63)return[n,l];const r=this.u8();if(r<=127)return[n,r<<6|l&63];const c=this.u8();if(c<=127)return[n,c<<13|(r&127)<<6|l&63];const s=this.u8();if(s<=127)return[n,s<<20|(c&127)<<13|(r&127)<<6|l&63];const o=this.u8();if(o<=127)return[n,o*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|l&63)];const i=this.u8();if(i<=127)return[n,i*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|l&63))];const f=this.u8();if(f<=127)return[n,f*2199023255552+((i&127)*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|l&63)))];const m=this.u8();return[n,m*281474976710656+((f&127)*2199023255552+((i&127)*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|l&63))))]}};return Ht.CrdtReader=t,Ht}var Kt={},Yt={},Zc;function v0(){if(Zc)return Yt;Zc=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.decodeF16=void 0;const e=Math.pow,t=d=>{const a=(d&31744)>>10,n=d&1023;return(d>>15?-1:1)*(a?a===31?n?NaN:1/0:e(2,a-15)*(1+n/1024):6103515625e-14*(n/1024))};return Yt.decodeF16=t,Yt}var _r={},Xt={},Cr={},$c;function w0(){if($c)return Cr;$c=1,Object.defineProperty(Cr,"__esModule",{value:!0});const e=String.fromCharCode;return Cr.default=(t,d,a)=>{let n=d;const l=n+a;let r="";for(;n<l;){const c=t[n++];if((c&128)===0){r+=e(c);continue}const s=t[n++]&63;if((c&224)===192){r+=e((c&31)<<6|s);continue}const o=t[n++]&63;if((c&240)===224){r+=e((c&31)<<12|s<<6|o);continue}if((c&248)===240){const i=t[n++]&63;let f=(c&7)<<18|s<<12|o<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;f=56320|f&1023,r+=e(m,f)}else r+=e(f)}else r+=e(c)}return r},Cr}var ea;function _0(){if(ea)return Xt;ea=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.CachedUtf8Decoder=void 0;const t=L.__importDefault(w0());let d=1+Math.round(Math.random()*((-1>>>0)-1));function a(r,c){return d^=d<<13,d^=d>>>17,d^=d<<5,(d>>>0)%(c-r+1)+r}class n{constructor(c,s){this.bytes=c,this.value=s}}let l=class{constructor(){this.caches=[];for(let c=0;c<31;c++)this.caches.push([])}get(c,s,o){const i=this.caches[o-1],f=i.length;e:for(let m=0;m<f;m++){const p=i[m],v=p.bytes;for(let y=0;y<o;y++)if(v[y]!==c[s+y])continue e;return p.value}return null}store(c,s){const o=this.caches[c.length-1],i=new n(c,s);o.length>=16?o[a(0,15)]=i:o.push(i)}decode(c,s,o){if(!o)return"";const i=this.get(c,s,o);if(i!==null)return i;const f=(0,t.default)(c,s,o),m=Uint8Array.prototype.slice.call(c,s,s+o);return this.store(m,f),f}};return Xt.CachedUtf8Decoder=l,Xt}var ta;function C0(){if(ta)return _r;ta=1,Object.defineProperty(_r,"__esModule",{value:!0});const e=_0();return _r.default=new e.CachedUtf8Decoder,_r}var na;function Bl(){if(na)return Kt;na=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.CborDecoderBase=void 0;const e=L,t=v0(),d=Il(),a=ji(),n=Ml(),l=e.__importDefault(C0());let r=class{constructor(s=new n.Reader,o=l.default){this.reader=s,this.keyDecoder=o}read(s){return this.reader.reset(s),this.val()}decode(s){return this.reader.reset(s),this.val()}val(){const o=this.reader.u8(),i=o>>5,f=o&31;return i<4?i<2?i===0?this.readUint(f):this.readNint(f):i===2?this.readBin(f):this.readStr(f):i<6?i===4?this.readArr(f):this.readObj(f):i===6?this.readTag(f):this.readTkn(f)}readAnyRaw(s){const o=s>>5,i=s&31;return o<4?o<2?o===0?this.readUint(i):this.readNint(i):o===2?this.readBin(i):this.readStr(i):o<6?o===4?this.readArr(i):this.readObj(i):o===6?this.readTag(i):this.readTkn(i)}readMinorLen(s){if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(s){if(s<25)return s===24?this.reader.u8():s;if(s<27)return s===25?this.reader.u16():this.reader.u32();{const o=this.reader.u64();return o>9007199254740991?o:Number(o)}}readNint(s){if(s<25)return s===24?-this.reader.u8()-1:-s-1;if(s<27)return s===25?-this.reader.u16()-1:-this.reader.u32()-1;{const o=this.reader.u64();return o>9007199254740991-1?-o-BigInt(1):-Number(o)-1}}readBin(s){const o=this.reader;if(s<=23)return o.buf(s);switch(s){case 24:return o.buf(o.u8());case 25:return o.buf(o.u16());case 26:return o.buf(o.u32());case 27:return o.buf(Number(o.u64()));case 31:{let i=0;const f=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();i+=y.length,f.push(y)}this.reader.x++;const m=new Uint8Array(i);let p=0;const v=f.length;for(let y=0;y<v;y++){const b=f[y];m.set(b,p),p+=b.length}return m}default:throw 1}}readBinChunk(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==2)throw 2;if(i>27)throw 3;return this.readBin(i)}readAsStr(){const o=this.reader.u8(),i=o>>5,f=o&31;if(i!==3)throw 11;return this.readStr(f)}readStr(s){const o=this.reader;if(s<=23)return o.utf8(s);switch(s){case 24:return o.utf8(o.u8());case 25:return o.utf8(o.u16());case 26:return o.utf8(o.u32());case 27:return o.utf8(Number(o.u64()));case 31:{let i="";for(;o.peak()!==255;)i+=this.readStrChunk();return this.reader.x++,i}default:throw 1}}readStrLen(s){if(s<=23)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==3)throw 4;if(i>27)throw 5;return this.readStr(i)}readArr(s){const o=this.readMinorLen(s);return o>=0?this.readArrRaw(o):this.readArrIndef()}readArrRaw(s){const o=[];for(let i=0;i<s;i++)o.push(this.val());return o}readArrIndef(){const s=[];for(;this.reader.peak()!==255;)s.push(this.val());return this.reader.x++,s}readObj(s){if(s<28){let o=s;switch(s){case 24:o=this.reader.u8();break;case 25:o=this.reader.u16();break;case 26:o=this.reader.u32();break;case 27:o=Number(this.reader.u64());break}const i={};for(let f=0;f<o;f++){const m=this.key();if(m==="__proto__")throw 6;const p=this.val();i[m]=p}return i}else{if(s===31)return this.readObjIndef();throw 1}}readObjRaw(s){const o={};for(let i=0;i<s;i++){const f=this.key(),m=this.val();o[f]=m}return o}readObjIndef(){const s={};for(;this.reader.peak()!==255;){const o=this.key();if(this.reader.peak()===255)throw 7;const i=this.val();s[o]=i}return this.reader.x++,s}key(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==3)return String(this.readAnyRaw(s));const f=this.readStrLen(i);if(f>31)return this.reader.utf8(f);const m=this.keyDecoder.decode(this.reader.uint8,this.reader.x,f);return this.reader.skip(f),m}readTag(s){if(s<=23)return this.readTagRaw(s);switch(s){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(s){return new d.JsonPackExtension(s,this.val())}readTkn(s){switch(s){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new a.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(s<=23)return new a.JsonPackValue(s);throw 1}f16(){return(0,t.decodeF16)(this.reader.u16())}};return Kt.CborDecoderBase=r,Kt}var ra;function S0(){if(ra)return Ut;ra=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Decoder=void 0;const t=L.__importStar(Ee()),d=p0(),a=ql(),n=z(),l=Vi(),r=Bl(),c=jl();class s extends r.CborDecoderBase{constructor(){super(new a.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const i=this.ts(),f=this.val();return typeof f=="string"?new t.StrChunk(i,f.length,f):new t.StrChunk(i,~~f,"")},this.cBinChunk=()=>{const i=this.ts(),f=this.reader,[m,p]=f.b1vu56();return m?new t.BinChunk(i,p,void 0):new t.BinChunk(i,p,f.buf(p))},this.cArrChunk=()=>{const i=this.ts(),[f,m]=this.reader.b1vu56();if(f)return new t.ArrChunk(i,m,void 0);const p=[];for(let v=0;v<m;v++)p.push(this.cNode().id);return new t.ArrChunk(i,m,p)}}decode(i,f){this.clockDecoder=void 0,this.time=-1;const m=this.reader;if(m.reset(i),m.peak()&128){m.x++;const v=this.time=m.vu57();f||(f=l.Model.withServerClock(void 0,v))}else if(this.decodeClockTable(),!f){const v=this.clockDecoder.clock;f=l.Model.create(void 0,v)}return this.doc=f,f.root=new t.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,f}decodeClockTable(){const i=this.reader,f=i.u32(),m=i.x;i.x+=f;const p=i.vu57(),v=i.vu57(),y=i.vu57();this.clockDecoder=new d.ClockDecoder(v,y);for(let b=1;b<p;b++){const u=i.vu57(),h=i.vu57();this.clockDecoder.pushTuple(u,h)}i.x=m}ts(){if(this.time<0){const[m,p]=this.reader.id();return this.clockDecoder.decodeId(m,p)}else return new n.Timestamp(1,this.reader.vu57())}cRoot(){const i=this.reader;return i.uint8[i.x]?this.cNode():l.UNDEFINED}cNode(){const i=this.reader,f=this.ts(),m=i.u8(),p=m>>5,v=m&31;switch(p){case c.CRDT_MAJOR.CON:return this.cCon(f,v);case c.CRDT_MAJOR.VAL:return this.cVal(f);case c.CRDT_MAJOR.OBJ:return this.cObj(f,v!==31?v:i.vu57());case c.CRDT_MAJOR.VEC:return this.cVec(f,v!==31?v:i.vu57());case c.CRDT_MAJOR.STR:return this.cStr(f,v!==31?v:i.vu57());case c.CRDT_MAJOR.BIN:return this.cBin(f,v!==31?v:i.vu57());case c.CRDT_MAJOR.ARR:return this.cArr(f,v!==31?v:i.vu57())}throw new Error("UNKNOWN_NODE")}cCon(i,f){const m=this.doc,p=f?this.ts():this.val(),v=new t.ConNode(i,p);return m.index.set(i,v),v}cVal(i){const f=this.cNode(),m=this.doc,p=new t.ValNode(m,i,f.id);return m.index.set(i,p),p}cObj(i,f){const m=new t.ObjNode(this.doc,i);for(let p=0;p<f;p++)this.cObjChunk(m);return this.doc.index.set(i,m),m}cObjChunk(i){const f=this.key();i.keys.set(f,this.cNode().id)}cVec(i,f){const m=this.reader,p=new t.VecNode(this.doc,i),v=p.elements;for(let y=0;y<f;y++)m.peak()?v.push(this.cNode().id):(m.x++,v.push(void 0));return this.doc.index.set(i,p),p}cStr(i,f){const m=new t.StrNode(i);return f&&m.ingest(f,this.cStrChunk),this.doc.index.set(i,m),m}cBin(i,f){const m=new t.BinNode(i);return f&&m.ingest(f,this.cBinChunk),this.doc.index.set(i,m),m}cArr(i,f){const m=new t.ArrNode(this.doc,i);return f&&m.ingest(f,this.cArrChunk),this.doc.index.set(i,m),m}}return Ut.Decoder=s,Ut}var sa;function O0(){if(sa)return Te;sa=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.decoder=Te.encoder=void 0;const e=h0(),t=S0();return Te.encoder=new e.Encoder,Te.decoder=new t.Decoder,Te}var qs={},W={},Qt={},ia;function E0(){if(ia)return Qt;ia=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.find=void 0;const e=Rr(),t=Ee(),d=(a,n)=>{const l=(0,e.toPath)(n);let r=a;const c=l.length;if(!c)return r;let s=0;for(;s<c&&r;){const o=l[s++];if(r=r.container(),!r)throw new Error("NOT_CONTAINER");if(r instanceof t.ObjNode){const i=r.get(String(o));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.ArrNode){const i=r.getNode(Number(o));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.VecNode){const i=r.get(Number(o));if(!i)throw new Error("NOT_FOUND");r=i}}return r};return Qt.find=d,Qt}var Zt={},he={},$t={},oa;function Vl(){if(oa)return $t;oa=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(d){this.listeners.forEach(a=>a(d))}listen(d){const a=this.listeners;return a.add(d),()=>a.delete(d)}}return $t.FanOut=e,$t}var ca;function Jl(){if(ca)return he;ca=1,Object.defineProperty(he,"__esModule",{value:!0}),he.OnNewFanOut=he.MapFanOut=he.MicrotaskBufferFanOut=he.MergeFanOut=void 0;const e=Vl();class t extends e.FanOut{constructor(r){super(),this.fanouts=r,this.unsubs=[]}listen(r){this.listeners.size||(this.unsubs=this.fanouts.map(s=>s.listen(o=>this.emit(o))));const c=super.listen(r);return()=>{if(c(),!this.listeners.size){for(const s of this.unsubs)s();this.unsubs=[]}}}}he.MergeFanOut=t;class d extends e.FanOut{constructor(r){super(),this.source=r,this.buffer=[],this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{const o=this.buffer;o.length||queueMicrotask(()=>{this.emit(o),this.buffer=[]}),o.push(s)}));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}he.MicrotaskBufferFanOut=d;class a extends e.FanOut{constructor(r,c){super(),this.source=r,this.mapper=c,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>this.emit(this.mapper(s))));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}he.MapFanOut=a;class n extends e.FanOut{constructor(r,c=void 0){super(),this.source=r,this.last=c,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{this.last!==s&&this.emit(this.last=s)}));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}return he.OnNewFanOut=n,he}var aa;function k0(){if(aa)return Zt;aa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.NodeEvents=void 0;const e=Jl();let t=class{constructor(a){this.api=a,this.subscribe=n=>this.onViewChanges.listen(()=>n()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Zt.NodeEvents=t,Zt}var en={},tn={},ua;function Pi(){return ua||(ua=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.isUint8Array=void 0,tn.isUint8Array=typeof ae.Buffer=="function"?e=>e instanceof Uint8Array||ae.Buffer.isBuffer(e):e=>e instanceof Uint8Array),tn}var nn={},Bs={},rn={},la;function Ll(){if(la)return rn;la=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.Encoder=void 0;const t=L.__importStar(Ye()),d=Ti(),a=z(),n=Tl();class l extends n.CborEncoder{constructor(c=new d.CrdtWriter){super(c),this.writer=c,this.patchSid=0}encode(c){this.writer.reset();const s=c.getId(),o=this.patchSid=s.sid,i=this.writer;i.vu57(o),i.vu57(s.time);const f=c.meta;return f===void 0?this.writeUndef():this.writeArr([f]),this.encodeOperations(c),i.flush()}encodeOperations(c){const s=c.ops,o=s.length;this.writer.vu57(o);for(let i=0;i<o;i++)this.encodeOperation(s[i])}encodeId(c){const s=c.sid,o=c.time,i=this.writer;s===this.patchSid?i.b1vu56(0,o):(i.b1vu56(1,o),i.vu57(s))}encodeTss(c){this.encodeId(c),this.writer.vu57(c.span)}writeInsStr(c,s,o,i){const f=this.writer;return c<=7?f.u8(96+c):(f.u8(96),f.vu57(c)),this.encodeId(s),this.encodeId(o),f.utf8(i)}encodeOperation(c){const s=this.writer;switch(c.constructor){case t.NewConOp:{const f=c.val;f instanceof a.Timestamp?(s.u8(1),this.encodeId(f)):(s.u8(0),this.writeAny(f));break}case t.NewValOp:{s.u8(8);break}case t.NewObjOp:{s.u8(16);break}case t.NewVecOp:{s.u8(24);break}case t.NewStrOp:{s.u8(32);break}case t.NewBinOp:{s.u8(40);break}case t.NewArrOp:{s.u8(48);break}case t.InsValOp:{const i=c;s.u8(72),this.encodeId(i.obj),this.encodeId(i.val);break}case t.InsObjOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(80+m):(s.u8(80),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const v=f[p];this.writeStr(v[0]),this.encodeId(v[1])}break}case t.InsVecOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(88+m):(s.u8(88),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const v=f[p];s.u8(v[0]),this.encodeId(v[1])}break}case t.InsStrOp:{const i=c,f=i.obj,m=i.ref,p=i.data,v=p.length;s.ensureCapacity(24+v*4);const y=s.x,b=this.writeInsStr(v,f,m,p);v!==b&&(s.x=y,this.writeInsStr(b,f,m,p));break}case t.InsBinOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(104+m):(s.u8(104),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref),s.buf(f,m);break}case t.InsArrOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(112+m):(s.u8(112),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref);for(let p=0;p<m;p++)this.encodeId(f[p]);break}case t.UpdArrOp:{const i=c;s.u8(120),this.encodeId(i.obj),this.encodeId(i.ref),this.encodeId(i.val);break}case t.DelOp:{const i=c,f=i.what,m=f.length;m<=7?s.u8(128+m):(s.u8(128),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++)this.encodeTss(f[p]);break}case t.NopOp:{const f=c.len;f<=7?s.u8(136+f):(s.u8(136),s.vu57(f));break}default:throw new Error("UNKNOWN_OP")}}}return rn.Encoder=l,rn}var sn={},on={},da;function A0(){if(da)return on;da=1,Object.defineProperty(on,"__esModule",{value:!0}),on.CborDecoder=void 0;const e=Bl(),t=ji();let d=class extends e.CborDecoderBase{readAsMap(){const n=this.reader.u8(),l=n>>5,r=n&31;if(l===5)return this.readMap(r);throw 0}readMap(n){const l=this.readMinorLen(n);return l>=0?this.readMapRaw(l):this.readMapIndef()}readMapRaw(n){const l=new Map;for(let r=0;r<n;r++){const c=this.val(),s=this.val();l.set(c,s)}return l}readMapIndef(){const n=new Map;for(;this.reader.peak()!==255;){const l=this.val();if(this.reader.peak()===255)throw 7;const r=this.val();n.set(l,r)}return this.reader.x++,n}skipN(n){for(let l=0;l<n;l++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(n){const l=n>>5,r=n&31;switch(l){case 0:case 1:this.skipUNint(r);break;case 2:this.skipBin(r);break;case 3:this.skipStr(r);break;case 4:this.skipArr(r);break;case 5:this.skipObj(r);break;case 7:this.skipTkn(r);break;case 6:this.skipTag(r);break}}skipMinorLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(n){if(!(n<=23))switch(n){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(n){const l=this.skipMinorLen(n);if(l>=0)this.reader.skip(l);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const n=this.reader.u8(),l=n>>5,r=n&31;if(l!==2)throw 2;if(r>27)throw 3;this.skipBin(r)}skipStr(n){const l=this.skipMinorLen(n);if(l>=0)this.reader.skip(l);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const n=this.reader.u8(),l=n>>5,r=n&31;if(l!==3)throw 4;if(r>27)throw 5;this.skipStr(r)}skipArr(n){const l=this.skipMinorLen(n);if(l>=0)this.skipN(l);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(n){const l=this.readMinorLen(n);if(l>=0)return this.skipN(l*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(n){if(this.skipMinorLen(n)<0)throw 1;this.skipAny()}skipTkn(n){switch(n){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(n<=23))throw 1}validate(n,l=0,r=n.length){this.reader.reset(n),this.reader.x=l;const c=l;if(this.skipAny(),this.reader.x-c!==r)throw 8}decodeLevel(n){return this.reader.reset(n),this.readLevel()}readLevel(){const n=this.reader.u8(),l=n>>5,r=n&31;switch(l){case 4:return this.readArrLevel(r);case 5:return this.readObjLevel(r);default:return super.readAnyRaw(n)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const n=this.reader,l=n.x;this.skipAny();const r=n.x;return new t.JsonPackValue(n.uint8.subarray(l,r))}readObjLevel(n){const l=this.readMinorLen(n);return l>=0?this.readObjRawLevel(l):this.readObjIndefLevel()}readObjRawLevel(n){const l={};for(let r=0;r<n;r++){const c=this.key(),s=this.readPrimitiveOrVal();l[c]=s}return l}readObjIndefLevel(){const n={};for(;this.reader.peak()!==255;){const l=this.key();if(this.reader.peak()===255)throw 7;const r=this.readPrimitiveOrVal();n[l]=r}return this.reader.x++,n}readArrLevel(n){const l=this.readMinorLen(n);return l>=0?this.readArrRawLevel(l):this.readArrIndefLevel()}readArrRawLevel(n){const l=[];for(let r=0;r<n;r++)l.push(this.readPrimitiveOrVal());return l}readArrIndefLevel(){const n=[];for(;this.reader.peak()!==255;)n.push(this.readPrimitiveOrVal());return this.reader.x++,n}readHdr(n){const l=this.reader.u8();if(l>>5!==n)throw 0;const c=l&31;if(c<24)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(n){const l=this.readObjHdr();for(let r=0;r<l;r++){if(this.key()===n)return this;this.skipAny()}throw 9}findIndex(n){const l=this.readArrHdr();if(n>=l)throw 10;for(let r=0;r<n;r++)this.skipAny();return this}find(n){for(let l=0;l<n.length;l++){const r=n[l];typeof r=="string"?this.findKey(r):this.findIndex(r)}return this}};return on.CborDecoder=d,on}var fa;function Dl(){if(fa)return sn;fa=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.Decoder=void 0;const e=ql(),t=z(),d=Mr(),a=A0();let n=class extends a.CborDecoder{constructor(r=new e.CrdtReader){super(r)}decode(r){return this.reader.reset(r),this.readPatch()}readPatch(){const r=this.reader,c=r.vu57(),s=r.vu57(),i=c===1?new t.ServerClockVector(1,s):new t.ClockVector(c,s);this.patchSid=i.sid;const f=this.builder=new d.PatchBuilder(i),m=this.val();return Array.isArray(m)&&(f.patch.meta=m[0]),this.decodeOperations(),f.patch}decodeId(){const r=this.reader,[c,s]=r.b1vu56();return c?new t.Timestamp(r.vu57(),s):new t.Timestamp(this.patchSid,s)}decodeTss(){const r=this.decodeId(),c=this.reader.vu57();return(0,t.interval)(r,0,c)}decodeOperations(){const c=this.reader.vu57();for(let s=0;s<c;s++)this.decodeOperation()}decodeOperation(){const r=this.builder,c=this.reader,s=c.u8();switch(s>>3){case 0:{const i=s&7;r.con(i?this.decodeId():this.val());break}case 1:{r.val();break}case 2:{r.obj();break}case 3:{r.vec();break}case 4:{r.str();break}case 5:{r.bin();break}case 6:{r.arr();break}case 9:{const i=this.decodeId(),f=this.decodeId();r.setVal(i,f);break}case 10:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const v=this.val();if(typeof v!="string")continue;const y=this.decodeId();m.push([v,y])}r.insObj(f,m);break}case 11:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const v=this.val();if(typeof v!="number")continue;const y=this.decodeId();m.push([v,y])}r.insVec(f,m);break}case 12:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=c.utf8(i);r.insStr(f,m,p);break}case 13:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=c.buf(i);if(!(p instanceof Uint8Array))return;r.insBin(f,m,p);break}case 14:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=[];for(let v=0;v<i;v++)p.push(this.decodeId());r.insArr(f,m,p);break}case 15:{const i=this.decodeId(),f=this.decodeId(),m=this.decodeId();r.updArr(i,f,m);break}case 16:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++)m.push(this.decodeTss());r.del(f,m);break}case 17:{const i=s&7||c.vu57();r.nop(i);break}default:throw new Error("UNKNOWN_OP")}}};return sn.Decoder=n,sn}var Vs={},ha;function N0(){return ha||(ha=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const t=Ll(),d=Dl(),a=Ti(),n=new a.CrdtWriter(1024*4);e.encoder=new t.Encoder(n);const l=c=>e.encoder.encode(c);e.encode=l,e.decoder=new d.Decoder;const r=c=>e.decoder.decode(c);e.decode=r})(Vs)),Vs}var pa;function x0(){return pa||(pa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Ll(),e),t.__exportStar(Dl(),e),t.__exportStar(N0(),e)})(Bs)),Bs}var ma;function Ul(){if(ma)return nn;ma=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.Patch=void 0;const t=L.__importStar(Ye()),d=z(),a=pe(),n=x0();let l=class Fl{constructor(){this.ops=[],this.meta=void 0}static fromBinary(c){return(0,n.decode)(c)}getId(){const c=this.ops[0];if(c)return c.id}span(){let c=0;for(const s of this.ops)c+=s.span();return c}nextTime(){const c=this.ops,s=c.length;if(!s)return 0;const o=c[s-1];return o.id.time+o.span()}rewriteTime(c){const s=new Fl,o=this.ops,i=o.length,f=s.ops;for(let m=0;m<i;m++){const p=o[m];p instanceof t.DelOp?f.push(new t.DelOp(c(p.id),c(p.obj),p.what)):p instanceof t.NewConOp?f.push(new t.NewConOp(c(p.id),p.val instanceof d.Timestamp?c(p.val):p.val)):p instanceof t.NewVecOp?f.push(new t.NewVecOp(c(p.id))):p instanceof t.NewValOp?f.push(new t.NewValOp(c(p.id))):p instanceof t.NewObjOp?f.push(new t.NewObjOp(c(p.id))):p instanceof t.NewStrOp?f.push(new t.NewStrOp(c(p.id))):p instanceof t.NewBinOp?f.push(new t.NewBinOp(c(p.id))):p instanceof t.NewArrOp?f.push(new t.NewArrOp(c(p.id))):p instanceof t.InsArrOp?f.push(new t.InsArrOp(c(p.id),c(p.obj),c(p.ref),p.data.map(c))):p instanceof t.UpdArrOp?f.push(new t.UpdArrOp(c(p.id),c(p.obj),c(p.ref),c(p.val))):p instanceof t.InsStrOp?f.push(new t.InsStrOp(c(p.id),c(p.obj),c(p.ref),p.data)):p instanceof t.InsBinOp?f.push(new t.InsBinOp(c(p.id),c(p.obj),c(p.ref),p.data)):p instanceof t.InsValOp?f.push(new t.InsValOp(c(p.id),c(p.obj),c(p.val))):p instanceof t.InsObjOp?f.push(new t.InsObjOp(c(p.id),c(p.obj),p.data.map(([v,y])=>[v,c(y)]))):p instanceof t.InsVecOp?f.push(new t.InsVecOp(c(p.id),c(p.obj),p.data.map(([v,y])=>[v,c(y)]))):p instanceof t.NopOp&&f.push(new t.NopOp(c(p.id),p.len))}return s}rebase(c,s){const o=this.getId();if(!o)throw new Error("EMPTY_PATCH");const i=o.sid,f=o.time;if(s??(s=f),f===c)return this;const m=c-f;return this.rewriteTime(p=>{if(p.sid!==i)return p;const v=p.time;return v<s?p:(0,d.ts)(i,v+m)})}clone(){return this.rewriteTime(c=>c)}toBinary(){return(0,n.encode)(this)}toString(c=""){const s=this.getId();return`Patch ${s?(0,d.printTs)(s):"(nil)"}!${this.span()}`+(0,a.printTree)(c,this.ops.map(i=>f=>i.toString(f)))}};return nn.Patch=l,nn}var Js={},Ls={},ba;function R0(){return ba||(ba=1,Object.defineProperty(Ls,"__esModule",{value:!0})),Ls}var ga;function Pr(){return ga||(ga=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const t=L,d=z();t.__exportStar(R0(),e),e.ORIGIN=(0,d.ts)(0,0)})(Js)),Js}var Ds={},ya;function Gl(){return ya||(ya=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const t=Pi(),d=z(),a=r=>{switch(typeof r){case"number":case"boolean":case"undefined":return!0;case"object":return r===null||r instanceof d.Timestamp;default:return!1}};class n{constructor(c){this.build=c}}e.NodeBuilder=n;var l;(function(r){class c extends n{constructor(b){super(u=>u.con(b)),this.raw=b,this.type="con"}}r.con=c;class s extends n{constructor(b){super(u=>u.json(b)),this.raw=b,this.type="str"}}r.str=s;class o extends n{constructor(b){super(u=>u.json(b)),this.raw=b,this.type="bin"}}r.bin=o;class i extends n{constructor(b){super(u=>{const h=u.val(),w=b.build(u);return u.setVal(h,w),h}),this.value=b,this.type="val"}}r.val=i;class f extends n{constructor(b){super(u=>{const h=u.vec(),w=b.length;if(w){const g=[];for(let _=0;_<w;_++){const O=b[_].build(u);g.push([_,O])}u.insVec(h,g)}return h}),this.value=b,this.type="vec"}}r.vec=f;class m extends n{constructor(b,u){super(h=>{const w=h.obj(),g=[],_={...b,...u},C=Object.keys(_),O=C.length;if(O){for(let k=0;k<O;k++){const S=C[k],E=_[S].build(h);g.push([S,E])}h.insObj(w,g)}return w}),this.obj=b,this.opt=u,this.type="obj"}optional(){return this}}r.obj=m;class p extends n{constructor(b){super(u=>{const h=u.arr(),w=b.length;if(w){const g=[];for(let _=0;_<w;_++)g.push(b[_].build(u));u.insArr(h,h,g)}return h}),this.arr=b,this.type="arr"}}r.arr=p;class v extends n{constructor(b,u){super(h=>{const w=new Uint8Array([b,0,0]),g=h.vec();return w[1]=g.sid%256,w[2]=g.time%256,h.insVec(g,[[0,h.constOrJson(e.s.con(w))],[1,u.build(h)]]),g}),this.id=b,this.data=u,this.type="ext"}}r.ext=v})(l||(e.nodes=l={})),e.schema={con:r=>new l.con(r),str:r=>new l.str(r||""),bin:r=>new l.bin(r),val:r=>new l.val(r),vec:(...r)=>new l.vec(r),obj:(r,c)=>new l.obj(r,c),map:r=>e.schema.obj(r),arr:r=>new l.arr(r),json:r=>{switch(typeof r){case"object":{if(!r)return e.s.val(e.s.con(r));if(r instanceof n)return r;if(Array.isArray(r))return e.s.arr(r.map(c=>e.s.json(c)));if((0,t.isUint8Array)(r))return e.s.bin(r);if(r instanceof d.Timestamp)return e.s.val(e.s.con(r));{const c={},s=Object.keys(r);for(const o of s)c[o]=e.s.jsonCon(r[o]);return e.s.obj(c)}}case"string":return e.s.str(r);default:return e.s.val(e.s.con(r))}},jsonCon:r=>a(r)?e.s.con(r):e.s.json(r),ext:(r,c)=>new l.ext(r,c)},e.s=e.schema})(Ds)),Ds}var va;function Mr(){if(va)return en;va=1,Object.defineProperty(en,"__esModule",{value:!0}),en.PatchBuilder=void 0;const t=L.__importStar(Ye()),d=z(),a=Pi(),n=Ul(),l=Pr(),r=Gl(),c=o=>{switch(typeof o){case"number":case"boolean":return!0;default:return o===null}};let s=class{constructor(i){this.clock=i,this.patch=new n.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const i=this.patch;return this.patch=new n.Patch,i}obj(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewObjOp(i)),i}arr(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewArrOp(i)),i}vec(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewVecOp(i)),i}str(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewStrOp(i)),i}bin(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewBinOp(i)),i}con(i){this.pad();const f=this.clock.tick(1);return this.patch.ops.push(new t.NewConOp(f,i)),f}val(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewValOp(i)),i}root(i){return this.setVal(l.ORIGIN,i)}insObj(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsObjOp(m,i,f),v=p.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(p),m}insVec(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsVecOp(m,i,f),v=p.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(p),m}setVal(i,f){this.pad();const m=this.clock.tick(1),p=new t.InsValOp(m,i,f);return this.patch.ops.push(p),m}insStr(i,f,m){if(!m.length)throw new Error("EMPTY_STRING");this.pad();const p=this.clock.tick(1),v=new t.InsStrOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}insBin(i,f,m){if(!m.length)throw new Error("EMPTY_BINARY");this.pad();const p=this.clock.tick(1),v=new t.InsBinOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}insArr(i,f,m){this.pad();const p=this.clock.tick(1),v=new t.InsArrOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}updArr(i,f,m){this.pad();const p=this.clock.tick(1),v=new t.UpdArrOp(p,i,f,m);return this.patch.ops.push(v),p}del(i,f){this.pad();const m=this.clock.tick(1);return this.patch.ops.push(new t.DelOp(m,i,f)),m}nop(i){this.pad();const f=this.clock.tick(i);return this.patch.ops.push(new t.NopOp(f,i)),f}jsonObj(i){const f=this.obj(),m=Object.keys(i);if(m.length){const p=[];for(const v of m){const y=i[v],b=y instanceof d.Timestamp?y:c(y)?this.con(y):this.json(y);p.push([v,b])}this.insObj(f,p)}return f}jsonArr(i){const f=this.arr();if(i.length){const m=[];for(const p of i)m.push(this.json(p));this.insArr(f,f,m)}return f}jsonStr(i){const f=this.str();return i&&this.insStr(f,f,i),f}jsonBin(i){const f=this.bin();return i.length&&this.insBin(f,f,i),f}jsonVal(i){const f=this.val(),m=this.con(i);return this.setVal(f,m),f}json(i){if(i instanceof d.Timestamp)return i;if(i===void 0)return this.con(i);if(i instanceof Array)return this.jsonArr(i);if((0,a.isUint8Array)(i))return this.jsonBin(i);if(i instanceof r.NodeBuilder)return i.build(this);switch(typeof i){case"object":return i===null?this.jsonVal(i):this.jsonObj(i);case"string":return this.jsonStr(i);case"number":case"boolean":return this.jsonVal(i)}throw new Error("INVALID_JSON")}constOrJson(i){return i instanceof d.Timestamp?i:c(i)?this.con(i):this.json(i)}maybeConst(i){return i instanceof d.Timestamp?i:this.con(i)}pad(){const i=this.patch.nextTime();if(!i)return;const f=this.clock.time-i;if(f>0){const m=(0,d.ts)(this.clock.sid,i),p=new t.NopOp(m,f);this.patch.ops.push(p)}}};return en.PatchBuilder=s,en}var cn={},wa;function I0(){if(wa)return cn;wa=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.ExtNode=void 0;const e=z();let t=class{constructor(a){this.data=a,this.api=void 0,this.id=a.id}children(a){}child(){return this.data}container(){return this.data.container()}toString(a,n){return this.name()+(n?" "+(0,e.printTs)(n):"")+" "+this.data.toString(a)}};return cn.ExtNode=t,cn}var Fs={},Me={},Us={},Gs={},_a;function T0(){return _a||(_a=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const t=Array.isArray,d=Object.prototype,a=(n,l)=>{if(n===l)return!0;let r=0,c=0;if(t(n)){if(!t(l)||(r=n.length,r!==l.length))return!1;for(c=r;c--!==0;)if(!(0,e.deepEqual)(n[c],l[c]))return!1;return!0}if(n&&l&&typeof n=="object"&&typeof l=="object"){e:{if(n.__proto__===d)break e;if(n instanceof Uint8Array){if(!(l instanceof Uint8Array))return!1;const o=n.length;if(o!==l.length)return!1;for(let i=0;i<o;i++)if(n[i]!==l[i])return!1;return!0}}const s=Object.keys(n);if(r=s.length,r!==Object.keys(l).length||t(l))return!1;for(c=r;c--!==0;){const o=s[c];if(!(0,e.deepEqual)(n[o],l[o]))return!1}return!0}return!1};e.deepEqual=a})(Gs)),Gs}var Ca;function j0(){return Ca||(Ca=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(T0(),e)})(Us)),Us}var an={},Sa;function P0(){if(Sa)return an;Sa=1,Object.defineProperty(an,"__esModule",{value:!0}),an.cmpUint8Array=void 0;const e=(t,d)=>{const a=t.length;if(a!==d.length)return!1;for(let n=0;n<a;n++)if(t[n]!==d[n])return!1;return!0};return an.cmpUint8Array=e,an}var Hs={},zs={},Oa;function M0(){return Oa||(Oa=1,Object.defineProperty(zs,"__esModule",{value:!0})),zs}var Ea;function qr(){return Ea||(Ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(M0(),e),t.__exportStar(z(),e),t.__exportStar(Ye(),e),t.__exportStar(Ul(),e),t.__exportStar(Mr(),e),t.__exportStar(Gl(),e)})(Hs)),Hs}var Ws={},ka;function Br(){return ka||(ka=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const t=u=>{const h=u.charCodeAt(0);return h>=56320&&h<=57343},d=u=>{const h=u.charCodeAt(u.length-1);return h>=55296&&h<=56319},a=(u,h)=>{u.push([0,""]);let w=0,g=0,_=0,C="",O="",k=0;for(;w<u.length;){if(w<u.length-1&&!u[w][1]){u.splice(w,1);continue}const E=u[w];switch(E[0]){case 1:_++,w++,O+=E[1];break;case-1:g++,w++,C+=E[1];break;case 0:{let A=w-_-g-1;if(h){const R=u[A];if(A>=0){let B=R[1];if(d(B)){const J=B.slice(-1);if(R[1]=B=B.slice(0,-1),C=J+C,O=J+O,!B){u.splice(A,1),w--;let D=A-1;const U=u[D];if(U){const V=U[0];V===1?(_++,D--,O=U[1]+O):V===-1&&(g++,D--,C=U[1]+C)}A=D}}}const T=u[w],q=T[1];if(t(q)){const B=q.charAt(0);T[1]=q.slice(1),C+=B,O+=B}}if(w<u.length-1&&!u[w][1]){u.splice(w,1);break}const N=C.length>0,x=O.length>0;if(N||x){N&&x&&(k=(0,e.pfx)(O,C),k!==0&&(A>=0?u[A][1]+=O.slice(0,k):(u.splice(0,0,[0,O.slice(0,k)]),w++),O=O.slice(k),C=C.slice(k)),k=(0,e.sfx)(O,C),k!==0&&(u[w][1]=O.slice(O.length-k)+u[w][1],O=O.slice(0,O.length-k),C=C.slice(0,C.length-k)));const R=_+g,T=C.length,q=O.length;T===0&&q===0?(u.splice(w-R,R),w=w-R):T===0?(u.splice(w-R,R,[1,O]),w=w-R+1):q===0?(u.splice(w-R,R,[-1,C]),w=w-R+1):(u.splice(w-R,R,[-1,C],[1,O]),w=w-R+2)}const I=u[w-1];w!==0&&I[0]===0?(I[1]+=u[w][1],u.splice(w,1)):w++,_=0,g=0,C="",O="";break}}}u[u.length-1][1]===""&&u.pop();let S=!1;for(w=1;w<u.length-1;){const E=u[w-1],A=u[w+1];if(E[0]===0&&A[0]===0){const N=E[1],x=u[w],I=x[1],R=A[1];I.slice(I.length-N.length)===N?(u[w][1]=N+I.slice(0,I.length-N.length),A[1]=N+R,u.splice(w-1,1),S=!0):I.slice(0,R.length)===R&&(E[1]+=A[1],x[1]=I.slice(R.length)+R,u.splice(w+1,1),S=!0)}w++}S&&a(u,h)},n=(u,h,w,g)=>{const _=o(u.slice(0,w),h.slice(0,g),!1),C=o(u.slice(w),h.slice(g),!1);return _.concat(C)},l=(u,h)=>{const w=u.length,g=h.length,_=Math.ceil((w+g)/2),C=_,O=2*_,k=new Array(O),S=new Array(O);for(let T=0;T<O;T++)k[T]=-1,S[T]=-1;k[C+1]=0,S[C+1]=0;const E=w-g,A=E%2!==0;let N=0,x=0,I=0,R=0;for(let T=0;T<_;T++){for(let q=-T+N;q<=T-x;q+=2){const B=C+q;let J=0;const D=k[B-1],U=k[B+1];q===-T||q!==T&&D<U?J=U:J=D+1;let V=J-q;for(;J<w&&V<g&&u.charAt(J)===h.charAt(V);)J++,V++;if(k[B]=J,J>w)x+=2;else if(V>g)N+=2;else if(A){const X=C+E-q,ce=S[X];if(X>=0&&X<O&&ce!==-1&&J>=w-ce)return n(u,h,J,V)}}for(let q=-T+I;q<=T-R;q+=2){const B=C+q;let J=q===-T||q!==T&&S[B-1]<S[B+1]?S[B+1]:S[B-1]+1,D=J-q;for(;J<w&&D<g&&u.charAt(w-J-1)===h.charAt(g-D-1);)J++,D++;if(S[B]=J,J>w)R+=2;else if(D>g)I+=2;else if(!A){const U=C+E-q,V=k[U];if(U>=0&&U<O&&V!==-1){const X=C+V-U;if(J=w-J,V>=J)return n(u,h,V,X)}}}}return[[-1,u],[1,h]]},r=(u,h)=>{if(!u)return[[1,h]];if(!h)return[[-1,u]];const w=u.length,g=h.length,_=w>g?u:h,C=w>g?h:u,O=C.length,k=_.indexOf(C);if(k>=0){const S=_.slice(0,k),E=_.slice(k+O);return w>g?[[-1,S],[0,C],[-1,E]]:[[1,S],[0,C],[1,E]]}return O===1?[[-1,u],[1,h]]:l(u,h)},c=(u,h)=>{if(!u||!h||u.charAt(0)!==h.charAt(0))return 0;let w=0,g=Math.min(u.length,h.length),_=g,C=0;for(;w<_;)u.slice(C,_)===h.slice(C,_)?(w=_,C=w):g=_,_=Math.floor((g-w)/2+w);const O=u.charCodeAt(_-1);return O>=55296&&O<=56319&&_--,_};e.pfx=c;const s=(u,h)=>{if(!u||!h||u.slice(-1)!==h.slice(-1))return 0;let w=0,g=Math.min(u.length,h.length),_=g,C=0;for(;w<_;)u.slice(u.length-_,u.length-C)===h.slice(h.length-_,h.length-C)?(w=_,C=w):g=_,_=Math.floor((g-w)/2+w);const O=u.charCodeAt(u.length-_);return O>=55296&&O<=56319&&_--,_};e.sfx=s;const o=(u,h,w)=>{if(u===h)return u?[[0,u]]:[];const g=(0,e.pfx)(u,h),_=u.slice(0,g);u=u.slice(g),h=h.slice(g);const C=(0,e.sfx)(u,h),O=u.slice(u.length-C);u=u.slice(0,u.length-C),h=h.slice(0,h.length-C);const k=r(u,h);return _&&k.unshift([0,_]),O&&k.push([0,O]),a(k,w),k},i=(u,h)=>o(u,h,!0);e.diff=i;const f=(u,h,w)=>{e:{if(w<0)break e;const g=u.length,_=h.length;if(g===_)break e;const C=h.slice(w),O=C.length;if(O>g||u.slice(g-O)!==C)break e;if(_>g){const E=g-O,A=u.slice(0,E),N=h.slice(0,E);if(A!==N)break e;const x=h.slice(E,w),I=[];return A&&I.push([0,A]),x&&I.push([1,x]),C&&I.push([0,C]),I}else{const E=_-O,A=h.slice(0,E),N=u.slice(0,E);if(N!==A)break e;const x=u.slice(E,g-O),I=[];return N&&I.push([0,N]),x&&I.push([-1,x]),C&&I.push([0,C]),I}}return(0,e.diff)(u,h)};e.diffEdit=f;const m=u=>{let h="";const w=u.length;for(let g=0;g<w;g++){const _=u[g];_[0]!==1&&(h+=_[1])}return h};e.src=m;const p=u=>{let h="";const w=u.length;for(let g=0;g<w;g++){const _=u[g];_[0]!==-1&&(h+=_[1])}return h};e.dst=p;const v=u=>{const h=u[0];return h===0?u:h===1?[-1,u[1]]:[1,u[1]]},y=u=>u.map(v);e.invert=y;const b=(u,h,w,g)=>{const _=u.length;let C=h;for(let O=_-1;O>=0;O--){const[k,S]=u[O];if(k===0)C-=S.length;else if(k===1)w(C,S);else{const E=S.length;C-=E,g(C,E,S)}}};e.apply=b})(Ws)),Ws}var Ks={},Aa;function q0(){return Aa||(Aa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const d=L.__importStar(Br()),a=o=>{let i="";const f=o.length;for(let m=0;m<f;m++)i+=String.fromCharCode(o[m]);return i};e.toStr=a;const n=o=>{const i=o.length,f=new Uint8Array(i);for(let m=0;m<i;m++)f[m]=o.charCodeAt(m);return f};e.toBin=n;const l=(o,i)=>{const f=(0,e.toStr)(o),m=(0,e.toStr)(i);return d.diff(f,m)};e.diff=l;const r=(o,i,f,m)=>d.apply(o,i,(p,v)=>f(p,(0,e.toBin)(v)),m);e.apply=r;const c=o=>(0,e.toBin)(d.src(o));e.src=c;const s=o=>(0,e.toBin)(d.dst(o));e.dst=s})(Ks)),Ks}var Ys={},Na;function B0(){return Na||(Na=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const d=L.__importStar(Br()),a=l=>{const r=[],c=l.length;let s=[];const o=(i,f)=>{if(!f.length)return;const m=s.length;if(m){const p=s[m-1];if(p[0]===i){p[1]+=f;return}}s.push([i,f])};e:for(let i=0;i<c;i++){const f=l[i],m=f[0],p=f[1],v=p.indexOf(`
`);if(v<0){o(m,p);continue e}else o(m,p.slice(0,v+1)),s.length&&r.push(s),s=[];let y=v;const b=p.length;t:for(;y<b;){const u=p.indexOf(`
`,y+1);if(u<0){o(m,p.slice(y+1));break t}r.push([[m,p.slice(y+1,u+1)]]),y=u}}s.length&&r.push(s);{const i=r.length;for(let f=0;f<i;f++){const m=r[f];let p=m.length;e:{if(p<2)break e;const v=m[0],y=m[1],b=y[0];if(v[0]===0&&(b===-1||b===1)){for(let u=2;u<p;u++)if(m[u][0]!==b)break e;for(let u=f+1;u<i;u++){const h=r[u],w=h.length,g=v[1];let _,C;if(h.length>1&&(_=h[0])[0]===b&&(C=h[1])[0]===0&&g===_[1])m.splice(0,1),y[1]=g+y[1],C[1]=g+C[1],h.splice(0,1);else for(let O=0;O<w;O++)if(h[O][0]!==b)break e}}}p=m.length;e:{if(p<2)break e;const v=m[m.length-1],y=v[1],b=m[m.length-2];if(v[0]===-1)for(let u=f+1;u<i;u++){const h=r[u],w=h.length;if(w<=1){if(h[0][0]!==-1)break e}else{const g=h[h.length-1];if(g[0]!==0)break e;for(let S=0;S<h.length-1;S++)if(h[S][0]!==-1)break e;let _=g[1];const C=_.endsWith(`
`);if(C||(_+=`
`),_.length>y.length||!y.endsWith(_))break e;const O=y.length-_.length;O<0?(v[0]=0,b[0]===0&&(b[1]+=y,m.splice(p-1,1))):O===0?(m.splice(p-1,1),b[0]===0?b[1]+=_:m.push([0,_])):(v[1]=y.slice(0,O),m.push([0,_]));const k=h[h.length-2];k[0]===-1?(k[1]+=C?_:_.slice(0,-1),h.splice(w-1,1)):g[0]=-1}}}}}return r};e.agg=a;const n=(l,r)=>{const c=l.join(`
`)+`
`,s=r.join(`
`)+`
`;if(c===s)return[];const o=d.diff(c,s),i=(0,e.agg)(o),f=i.length,m=[];let p=-1,v=-1;const y=l.length,b=r.length;for(let u=0;u<f;u++){const h=i[u];let w=h.length;if(!w)continue;const g=h[w-1],_=g[0],C=g[1];if(C===`
`)h.splice(w-1,1);else{const k=C.length;C[k-1]===`
`&&(k===1?h.splice(w-1,1):g[1]=C.slice(0,k-1))}let O=0;if(w=h.length,u+1===f)p+1<y?v+1<b?(O=w===1&&h[0][0]===0?0:2,p++,v++):(O=-1,p++):(O=1,v++);else{const S=h[0][0];w===1&&S===_&&S===0?(p++,v++):_===0?(O=2,p++,v++):_===1?(O=1,v++):_===-1&&(O=-1,p++)}m.push([O,p,v,h])}return m};e.diff=n})(Ys)),Ys}var Xs={},un={},xa;function Mi(){if(xa)return un;xa=1,Object.defineProperty(un,"__esModule",{value:!0}),un.sort=void 0;const e=t=>{const d=t.length;for(let a=1;a<d;a++){const n=t[a];let l=a;for(;l!==0&&t[l-1]>n;)t[l]=t[l-1],l--;t[l]=n}return t};return un.sort=e,un}var Qs={},Ra;function qi(){return Ra||(Ra=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const t=Mi();var d;(function(s){s[s.START_STATE=5381]="START_STATE",s[s.NULL=982452847]="NULL",s[s.TRUE=982453247]="TRUE",s[s.FALSE=982454243]="FALSE",s[s.ARRAY=982452259]="ARRAY",s[s.STRING=982453601]="STRING",s[s.OBJECT=982454533]="OBJECT",s[s.BINARY=982454837]="BINARY"})(d||(e.CONST=d={}));const a=(s,o)=>(s<<5)+s+o;e.updateNum=a;const n=(s,o)=>{const i=o.length;s=(0,e.updateNum)(s,d.STRING),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+o.charCodeAt(--f);return s};e.updateStr=n;const l=(s,o)=>{const i=o.length;s=(0,e.updateNum)(s,d.BINARY),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+o[--f];return s};e.updateBin=l;const r=(s,o)=>{switch(typeof o){case"number":return(0,e.updateNum)(s,o);case"string":return s=(0,e.updateNum)(s,d.STRING),(0,e.updateStr)(s,o);case"object":{if(o===null)return(0,e.updateNum)(s,d.NULL);if(Array.isArray(o)){const m=o.length;s=(0,e.updateNum)(s,d.ARRAY);for(let p=0;p<m;p++)s=(0,e.updateJson)(s,o[p]);return s}if(o instanceof Uint8Array)return(0,e.updateBin)(s,o);s=(0,e.updateNum)(s,d.OBJECT);const i=(0,t.sort)(Object.keys(o)),f=i.length;for(let m=0;m<f;m++){const p=i[m];s=(0,e.updateStr)(s,p),s=(0,e.updateJson)(s,o[p])}return s}case"boolean":return(0,e.updateNum)(s,o?d.TRUE:d.FALSE)}return s};e.updateJson=r;const c=s=>(0,e.updateJson)(d.START_STATE,s)>>>0;e.hash=c})(Qs)),Qs}var Zs={},Ia;function Hl(){return Ia||(Ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const t=Mi(),d=qi(),a=n=>{switch(typeof n){case"string":return(0,d.hash)(n).toString(36);case"number":case"bigint":return n.toString(36);case"boolean":return n?"T":"F";case"object":if(n===null)return"N";if(Array.isArray(n)){const l=n.length;let r="[";for(let c=0;c<l;c++)r+=(0,e.structHash)(n[c])+",";return r+"]"}else{if(n instanceof Uint8Array)return(0,d.hash)(n).toString(36);{const l=Object.keys(n);(0,t.sort)(l);let r="{";const c=l.length;for(let s=0;s<c;s++){const o=l[s];r+=(0,d.hash)(o).toString(36)+":"+(0,e.structHash)(n[o])+","}return r+"}"}}default:return"U"}};e.structHash=a})(Zs)),Zs}var Ta;function V0(){return Ta||(Ta=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const t=Mi(),d=dr(),a=qi(),n=Hl(),l=r=>{if(r instanceof d.ConNode)return(0,n.structHash)(r.val);if(r instanceof d.ValNode)return(0,e.structHashCrdt)(r.node());if(r instanceof d.StrNode)return(0,a.hash)(r.view()).toString(36);if(r instanceof d.ObjNode){let c="{";const s=Array.from(r.keys.keys());(0,t.sort)(s);const o=s.length;for(let i=0;i<o;i++){const f=s[i],m=r.get(f);c+=(0,a.hash)(f).toString(36)+":"+(0,e.structHashCrdt)(m)+","}return c+"}"}else if(r instanceof d.ArrNode||r instanceof d.VecNode){let c="[";return r.children(s=>{c+=(0,e.structHashCrdt)(s)+","}),c+"]"}else if(r instanceof d.BinNode)return(0,a.hash)(r.view()).toString(36);return"U"};e.structHashCrdt=l})(Xs)),Xs}var $s={},ja;function J0(){return ja||(ja=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(qi(),e),t.__exportStar(Hl(),e)})($s)),$s}var Pa;function L0(){if(Pa)return Me;Pa=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.JsonCrdtDiff=Me.DiffError=void 0;const e=L,t=j0(),d=P0(),a=qr(),n=Ee(),l=e.__importStar(Br()),r=e.__importStar(q0()),c=e.__importStar(B0()),s=V0(),o=J0();class i extends Error{constructor(p="DIFF"){super(p)}}Me.DiffError=i;let f=class{constructor(p){this.model=p,this.builder=new a.PatchBuilder(p.clock.clone())}diffStr(p,v){const y=p.view();if(y===v)return;const b=this.builder;l.apply(l.diff(y,v),y.length,(u,h)=>b.insStr(p.id,u?p.find(u-1):p.id,h),(u,h)=>b.del(p.id,p.findInterval(u,h)))}diffBin(p,v){const y=p.view();if((0,d.cmpUint8Array)(y,v))return;const b=this.builder;r.apply(r.diff(y,v),y.length,(u,h)=>b.insBin(p.id,u?p.find(u-1):p.id,h),(u,h)=>b.del(p.id,p.findInterval(u,h)))}diffArr(p,v){const y=[];p.children(k=>{y.push((0,s.structHashCrdt)(k))});const b=[],u=v.length;for(let k=0;k<u;k++)b.push((0,o.structHash)(v[k]));const h=c.diff(y,b);if(!h.length)return;const w=[],g=[],_=h.length;for(let k=_-1;k>=0;k--){const[S,E,A]=h[k];switch(S){case 0:break;case 1:{const N=v[A],x=E>=0?p.find(E):p.id;if(!x)throw new i;w.push([x,[N]]);break}case-1:{const N=p.findInterval(E,1);if(!N||!N.length)throw new i;g.push(...N);break}case 2:{const N=v[A];try{this.diffAny(p.getNode(E),N)}catch(x){if(x instanceof i){const I=p.findInterval(E,1);g.push(...I);const R=E?p.find(E-1):p.id;if(!R)throw new i;w.push([R,[N]])}else throw x}}}}const C=this.builder,O=w.length;for(let k=0;k<O;k++){const[S,E]=w[k];C.insArr(p.id,S,E.map(A=>C.json(A)))}g.length&&C.del(p.id,g)}diffObj(p,v){const y=this.builder,b=[],u=new Set;p.forEach(g=>{u.add(g),v[g]===void 0&&b.push([g,y.con(void 0)])});const h=Object.keys(v),w=h.length;for(let g=0;g<w;g++){const _=h[g],C=v[_];if(u.has(_)){const O=p.get(_);if(O)try{this.diffAny(O,C);continue}catch(k){if(!(k instanceof i))throw k}}b.push([_,p.get(_)instanceof n.ConNode?y.con(C):y.constOrJson(C)])}b.length&&y.insObj(p.id,b)}diffVec(p,v){const y=this.builder,b=[],u=p.elements,h=u.length,w=v.length,g=p.doc.index,_=Math.min(h,w);for(let C=w;C<h;C++){const O=u[C];if(O){const k=g.get(O);if(!k||k instanceof n.ConNode&&k.val===void 0)return;b.push([C,y.con(void 0)])}}for(let C=0;C<_;C++){const O=v[C],k=p.get(C);if(k)try{this.diffAny(k,O);continue}catch(S){if(!(S instanceof i))throw S}b.push([C,y.constOrJson(O)])}for(let C=h;C<w;C++)b.push([C,y.constOrJson(v[C])]);b.length&&y.insVec(p.id,b)}diffVal(p,v){try{this.diffAny(p.node(),v)}catch(y){if(y instanceof i){const b=this.builder;b.setVal(p.id,b.constOrJson(v))}else throw y}}diffAny(p,v){if(p instanceof n.ConNode){if(p.val!==v&&!(0,t.deepEqual)(p.val,v))throw new i}else if(p instanceof n.StrNode){if(typeof v!="string")throw new i;this.diffStr(p,v)}else if(p instanceof n.ObjNode){if(!v||typeof v!="object"||Array.isArray(v))throw new i;this.diffObj(p,v)}else if(p instanceof n.ValNode)this.diffVal(p,v);else if(p instanceof n.ArrNode){if(!Array.isArray(v))throw new i;this.diffArr(p,v)}else if(p instanceof n.VecNode){if(!Array.isArray(v))throw new i;this.diffVec(p,v)}else if(p instanceof n.BinNode){if(!(v instanceof Uint8Array))throw new i;this.diffBin(p,v)}else throw new i}diff(p,v){return this.diffAny(p,v),this.builder.flush()}};return Me.JsonCrdtDiff=f,Me}var Ma;function D0(){return Ma||(Ma=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const t=L0(),d=(n,l)=>{const c=new t.JsonCrdtDiff(n.api.model).diff(n.node,l);return c.ops.length?c:void 0};e.diff=d;const a=(n,l)=>{const r=(0,e.diff)(n,l);return r&&n.api.model.applyPatch(r),r};e.merge=a})(Fs)),Fs}var ei={},qa;function F0(){return qa||(qa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const t=(a,n=[])=>new Proxy(()=>{},{get:(l,r,c)=>(n.push(String(r)),(0,e.proxy)(a,n)),apply:(l,r,c)=>a(n,...c)});e.proxy=t;const d=(a,n,l=[])=>new Proxy({},{get:(r,c,s)=>c===n?a(l):(l.push(String(c)),(0,e.proxy$)(a,n,l))});e.proxy$=d})(ei)),ei}var Ba;function U0(){if(Ba)return W;Ba=1,Object.defineProperty(W,"__esModule",{value:!0}),W.ModelApi=W.ArrApi=W.BinApi=W.StrApi=W.ObjApi=W.VecApi=W.ValApi=W.ConApi=W.NodeApi=void 0;const e=L,t=pe(),d=_l(),a=ki(),n=E0(),l=z(),r=Ee(),c=k0(),s=Vl(),o=Mr(),i=Jl(),f=I0(),m=e.__importStar(D0()),p=F0(),v=k=>{if(!k)return[void 0,""];if(typeof k=="number")return[void 0,k];switch(typeof k=="string"&&(k=(0,a.toPath)(k)),k.length){case 0:return[void 0,""];case 1:return[void 0,k[0]];default:{const S=k[k.length-1];return[k.slice(0,-1),S]}}};class y{constructor(S,E){this.node=S,this.api=E,this.ev=void 0}get events(){return this.ev||(this.ev=new c.NodeEvents(this))}find(S){let E=this.node;if(S===void 0){if(typeof E.child=="function"){const A=E.child();if(!A){if(E instanceof r.RootNode)return E;throw new Error("NO_CHILD")}return A}throw new Error("CANNOT_IN")}for(typeof S=="string"&&S&&S[0]!=="/"&&(S="/"+S),typeof S=="number"&&(S=[S]);E instanceof r.ValNode;)E=E.child();return(0,n.find)(E,S)}in(S){const E=this.find(S);return this.api.wrap(E)}asVal(){if(this.node instanceof r.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof r.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof r.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof r.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof r.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof r.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof r.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(S){let E;const A=this.node;if(A instanceof f.ExtNode&&(E=A),A instanceof r.VecNode&&(E=A.ext()),!E)throw new Error("NOT_EXT");const N=this.api.wrap(E);if(!S||N instanceof S.Api)return N;throw new Error("NOT_EXT")}val(S){return this.in(S).asVal()}str(S){return this.in(S).asStr()}bin(S){return this.in(S).asBin()}arr(S){return this.in(S).asArr()}vec(S){return this.in(S).asVec()}obj(S){return this.in(S).asObj()}con(S){return this.in(S).asCon()}view(){return this.node.view()}select(S,E){try{let A=S!==void 0?this.find(S):this.node;if(E)for(;A instanceof r.ValNode;)A=A.child();return this.api.wrap(A)}catch{return}}read(S){const E=this.view();if(Array.isArray(S))return(0,d.get)(E,S);if(!S)return E;let A=S+"";return S&&A[0]!=="/"&&(A="/"+A),(0,d.get)(E,(0,a.toPath)(A))}add(S,E){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w)x.set({[N]:E});else if(x instanceof C||x instanceof g||x instanceof _){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(N==="-")R=I;else if(R=~~N,R+""!==N)break e;if(R!==R)break e;if(R<0&&(R=0),R>I&&(R=I),x instanceof C)x.ins(R,Array.isArray(E)?E:[E]);else if(x instanceof g)x.ins(R,E+"");else if(x instanceof _){if(!(E instanceof Uint8Array))break e;x.ins(R,E)}}else if(x instanceof h)x.set([[~~N,E]]);else break e;return!0}catch{}return!1}replace(S,E){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w){const I=N+"";if(!x.has(I))break e;x.set({[N]:E})}else if(x instanceof C){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(R=~~N,R+""!==N)break e;if(R!==R||R<0||R>I)break e;R===I?x.ins(R,[E]):x.upd(R,E)}else if(x instanceof h)x.set([[~~N,E]]);else break e;return!0}catch{}return!1}remove(S,E=1){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w){const I=N+"";if(!x.has(I))break e;x.del([I])}else if(x instanceof C||x instanceof g||x instanceof _){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(N==="-")R=E;else if(R=~~N,R+""!==N)break e;if(R!==R||R<0||R>I)break e;x.del(R,Math.min(E,I-R))}else if(x instanceof h)x.set([[~~N,void 0]]);else break e;return!0}catch{}return!1}diff(S){return m.diff(this,S)}merge(S){return m.merge(this,S)}op(S){if(!Array.isArray(S))return!1;const[E,A,N]=S;switch(E){case"add":return this.add(A,N);case"replace":return this.replace(A,N);case"merge":return!!this.select(A)?.merge(N);case"remove":return this.remove(A,N)}}get s(){return{$:this}}get $(){return(0,p.proxy$)(S=>{try{return this.api.wrap(this.find(S))}catch{return}},"$")}toString(S=""){return"api("+(this.constructor===y?"*":this.node.name())+")"+(0,t.printTree)(S,[A=>this.node.toString(A)])}}W.NodeApi=y;class b extends y{get s(){return{$:this}}}W.ConApi=b;class u extends y{get(){return this.in()}set(S){const{api:E,node:A}=this,x=E.builder.constOrJson(S);E.builder.setVal(A.id,x),E.apply()}get s(){const S=this;return{$:this,get _(){const A=S.node.node();return S.api.wrap(A).s}}}}W.ValApi=u;class h extends y{get(S){return this.in(S)}set(S){const{api:E,node:A}=this,{builder:N}=E;N.insVec(A.id,S.map(([x,I])=>[x,N.constOrJson(I)])),E.apply()}push(...S){const E=this.length();this.set(S.map((A,N)=>[E+N,A]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;if(A==="toExt")return()=>this.asExt();const x=Number(A);if(Number.isNaN(x))throw new Error("INVALID_INDEX");const I=this.node.get(x);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}W.VecApi=h;class w extends y{get(S){return this.in(S)}set(S){const{api:E,node:A}=this,{builder:N}=E;N.insObj(A.id,Object.entries(S).map(([x,I])=>[x,N.constOrJson(I)])),E.apply()}del(S){const{api:E,node:A}=this,{builder:N}=E;E.builder.insObj(A.id,S.map(x=>[x,N.con(void 0)])),E.apply()}has(S){return this.node.keys.has(S)}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;const x=String(A),I=this.node.get(x);if(!I)throw new Error("NO_SUCH_KEY");return this.api.wrap(I).s}})}}W.ObjApi=w;class g extends y{ins(S,E){const{api:A,node:N}=this;A.onBeforeLocalChange.emit(A.next);const x=A.builder;x.pad();const I=A.builder.nextTime(),R=new l.Timestamp(x.clock.sid,I),T=N.insAt(S,R,E);if(!T)throw new Error("OUT_OF_BOUNDS");x.insStr(N.id,T,E),A.advance()}del(S,E){const{api:A,node:N}=this;A.onBeforeLocalChange.emit(A.next);const x=A.builder;x.pad();const I=N.findInterval(S,E);if(!I)throw new Error("OUT_OF_BOUNDS");N.delete(I),x.del(N.id,I),A.advance()}findId(S){const E=this.node,N=E.length()-1;return S>N&&(S=N),S<0?E.id:E.find(S)||E.id}findPos(S){const E=this.node,A=E.id;if(A.sid===S.sid&&A.time===S.time)return-1;const N=E.findById(S);return N?E.pos(N)+(N.del?0:S.time-N.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}W.StrApi=g;class _ extends y{ins(S,E){const{api:A,node:N}=this,x=S?N.find(S-1):N.id;if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.insBin(N.id,x,E),A.apply()}del(S,E){const{api:A,node:N}=this,x=N.findInterval(S,E);if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.del(N.id,x),A.apply()}length(){return this.node.length()}get s(){return{$:this}}}W.BinApi=_;class C extends y{get(S){return this.in(S)}ins(S,E){const{api:A,node:N}=this,{builder:x}=A,I=S?N.find(S-1):N.id;if(!I)throw new Error("OUT_OF_BOUNDS");const R=[];for(let T=0;T<E.length;T++)R.push(x.json(E[T]));x.insArr(N.id,I,R),A.apply()}push(...S){const E=this.length();this.ins(E,S)}upd(S,E){const{api:A,node:N}=this,x=N.getId(S);if(!x)throw new Error("OUT_OF_BOUNDS");const{builder:I}=A;I.updArr(N.id,x,I.constOrJson(E)),A.apply()}del(S,E){const{api:A,node:N}=this,x=N.findInterval(S,E);if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.del(N.id,x),A.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;const x=Number(A);if(Number.isNaN(x))throw new Error("INVALID_INDEX");const I=this.node.getNode(x);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}W.ArrApi=C;class O extends u{constructor(S){super(S.root,void 0),this.model=S,this.next=0,this.onBeforeReset=new s.FanOut,this.onReset=new s.FanOut,this.onBeforePatch=new s.FanOut,this.onPatch=new s.FanOut,this.onBeforeLocalChange=new s.FanOut,this.onLocalChange=new s.FanOut,this.onLocalChanges=new i.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new s.FanOut,this.onTransaction=new s.FanOut,this.onChange=new i.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new i.MicrotaskBufferFanOut(this.onChange),this.onFlush=new s.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=E=>this.onChanges.listen(()=>E()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new o.PatchBuilder(S.clock),S.onbeforereset=()=>this.onBeforeReset.emit(),S.onreset=()=>this.onReset.emit(),S.onbeforepatch=E=>this.onBeforePatch.emit(E),S.onpatch=E=>this.onPatch.emit(E)}wrap(S){if(S instanceof r.ValNode)return S.api||(S.api=new u(S,this));if(S instanceof r.StrNode)return S.api||(S.api=new g(S,this));if(S instanceof r.BinNode)return S.api||(S.api=new _(S,this));if(S instanceof r.ArrNode)return S.api||(S.api=new C(S,this));if(S instanceof r.ObjNode)return S.api||(S.api=new w(S,this));if(S instanceof r.ConNode)return S.api||(S.api=new b(S,this));if(S instanceof r.VecNode)return S.api||(S.api=new h(S,this));if(S instanceof f.ExtNode){if(S.api)return S.api;const E=this.model.ext.get(S.extId);return S.api=new E.Api(S,this)}else throw new Error("UNKNOWN_NODE")}root(S){return this.set(S)}set(S){return super.set(S),this}apply(){const S=this.builder.patch.ops,E=S.length,A=this.model,N=this.next;this.onBeforeLocalChange.emit(N);for(let x=this.next;x<E;x++)A.applyOperation(S[x]);this.next=E,A.tick++,this.onLocalChange.emit(N)}advance(){const S=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(S)}transaction(S){if(this.inTx)S();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),S(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const S=this.builder.flush();return this.next=0,S.ops.length&&this.onFlush.emit(S),S}autoFlush(S=!1){const E=()=>this.builder.patch.ops.length&&this.flush(),A=this.onLocalChanges.listen(E),N=this.onBeforeTransaction.listen(E),x=this.onTransaction.listen(E);return S&&E(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,A(),N(),x()}}}return W.ModelApi=O,W}var Va;function zl(){return Va||(Va=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(U0(),e)})(qs)),qs}var ln={},Ja;function G0(){if(Ja)return ln;Ja=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.randomSessionId=void 0;const e=65535,t=9007199254740991-e,d=()=>Math.floor(t*Math.random()+e);return ln.randomSessionId=d,ln}var dn={},La;function H0(){if(La)return dn;La=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.Extensions=void 0;const e=pe();let t=class Wl{constructor(){this.ext={}}register(a){this.ext[a.id]=a}get(a){return this.ext[a]}size(){return Object.keys(this.ext).length}clone(){const a=new Wl;for(const n of Object.values(this.ext))a.register(n);return a}toString(a=""){const n=Object.keys(this.ext).map(l=>+l).sort();return"extensions"+(0,e.printTree)(a,n.map(l=>r=>`${l}: ${this.ext[l].name}`))}};return dn.Extensions=t,dn}var qe={},ti={},ni={},fn={},Da;function Bi(){if(Da)return fn;Da=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.printBinary=void 0;const e=(t="",d)=>{const a=d[0],n=d[1];let l="";return a&&(l+=`
`+t+"← "+a(t+"  ")),n&&(l+=`
`+t+"→ "+n(t+"  ")),l};return fn.printBinary=e,fn}var Fa;function z0(){return Fa||(Fa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(Bi(),e)})(ni)),ni}var Ua;function W0(){return Ua||(Ua=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const t=z0(),d=JSON.stringify,a=(y,b,u)=>{const h=b.p;if(!h)return y;const w=b===h.l;let g=h.bf|0;switch(w?h.bf=++g:h.bf=--g,g){case 0:return y;case 1:case-1:return a(y,h,b);default:{const _=u===b.l;return w?_?(n(h,b),b.p?y:b):(r(h,b,u),u.p?y:u):_?(c(h,b,u),u.p?y:u):(l(h,b),b.p?y:b)}}},n=(y,b)=>{const u=y.p,h=b.r;b.p=u,b.r=y,y.p=b,y.l=h,h&&(h.p=y),u&&(u.l===y?u.l=b:u.r=b);let w=y.bf,g=b.bf;w+=-1-(g>0?g:0),g+=-1+(w<0?w:0),y.bf=w,b.bf=g},l=(y,b)=>{const u=y.p,h=b.l;b.p=u,b.l=y,y.p=b,y.r=h,h&&(h.p=y),u&&(u.l===y?u.l=b:u.r=b);let w=y.bf,g=b.bf;w+=1-(g<0?g:0),g+=1+(w>0?w:0),y.bf=w,b.bf=g},r=(y,b,u)=>{l(b,u),n(y,u)},c=(y,b,u)=>{n(b,u),l(y,u)},s=(y,b,u)=>(u.r=b,b.p=u,u.bf--,u.l?y:a(y,u,b));e.insertRight=s;const o=(y,b,u)=>(u.l=b,b.p=u,u.bf++,u.r?y:a(y,u,b));e.insertLeft=o;const i=(y,b,u)=>{if(!y)return b;const h=b.k;let w=y,g,_=0;for(;g=(_=u(h,w.k))<0?w.l:w.r;)w=g;return _<0?(0,e.insertLeft)(y,b,w):(0,e.insertRight)(y,b,w)};e.insert=i;const f=(y,b)=>{if(!y)return b;const u=b.p,h=b.l,w=b.r;if(b.p=b.l=b.r=void 0,h&&w)if(h.r){let C=h,O=C;for(;O=C.r;)C=O;const k=C.l,S=C.p,E=k;return u&&(u.l===b?u.l=C:u.r=C),C.p=u,C.r=w,C.bf=b.bf,h!==C&&(C.l=h,h.p=C),w.p=C,S&&(S.l===C?S.l=E:S.r=E),E&&(E.p=S),p(u?y:C,S,1)}else{u&&(u.l===b?u.l=h:u.r=h),h.p=u,h.r=w,w.p=h;const C=b.bf;if(u)return h.bf=C,m(y,h,1);const O=C-1;if(h.bf=O,O>=-1)return h;const k=w.l;return w.bf>0?(c(h,w,k),k):(l(h,w),w)}const g=h||w;return g&&(g.p=u),u?u.l===b?(u.l=g,m(y,u,1)):(u.r=g,p(y,u,1)):g};e.remove=f;const m=(y,b,u)=>{let h=b.bf|0;h-=u,b.bf=h;let w=u;if(h===-1)return y;if(h<-1){const _=b.r;if(_.bf<=0)_.l&&_.bf===0&&(w=0),l(b,_),b=_;else{const C=_.l;c(b,_,C),b=C}}const g=b.p;return g?g.l===b?m(y,g,w):p(y,g,w):b},p=(y,b,u)=>{let h=b.bf|0;h+=u,b.bf=h;let w=u;if(h===1)return y;if(h>1){const _=b.l;if(_.bf>=0)_.r&&_.bf===0&&(w=0),n(b,_),b=_;else{const C=_.r;r(b,_,C),b=C}}const g=b.p;return g?g.l===b?m(y,g,w):p(y,g,w):b},v=(y,b="")=>{if(!y)return"∅";const{bf:u,l:h,r:w,k:g,v:_}=y,C=_&&typeof _=="object"&&_.constructor===Object?d(_):_&&typeof _=="object"?_.toString(b):d(_),O=g!==void 0?` { ${d(g)} = ${C} }`:"",k=u?` [${u}]`:"";return y.constructor.name+`${k}`+O+(0,t.printBinary)(b,[h?S=>(0,e.print)(h,S):null,w?S=>(0,e.print)(w,S):null])};e.print=v})(ti)),ti}var hn={},ri={},pn={},Ga;function Kl(){if(Ga)return pn;Ga=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.first=void 0;const e=t=>{let d=t;for(;d;)if(d.l)d=d.l;else return d;return d};return pn.first=e,pn}var mn={},Ha;function K0(){if(Ha)return mn;Ha=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.next=void 0;const e=Kl(),t=d=>{const a=d.r;if(a)return(0,e.first)(a);let n=d.p;for(;n&&n.r===d;)d=n,n=n.p;return n};return mn.next=t,mn}var za;function Yl(){return za||(za=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const t=Kl();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return t.first}});const d=K0();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return d.next}});const a=p=>{let v=p;for(;v;)if(v.r)v=v.r;else return v;return v};e.last=a;const n=p=>{if(p.l){for(p=p.l;p.r;)p=p.r;return p}let v=p.p;for(;v&&v.l===p;)p=v,v=v.p;return v};e.prev=n;const l=p=>{const v=p.l,y=p.r;return 1+(v?l(v):0)+(y?l(y):0)},r=p=>p?l(p):0;e.size=r;const c=(p,v,y)=>{let b=p;for(;b;){const u=y(v,b.k);if(u===0)return b;b=u<0?b.l:b.r}return b};e.find=c;const s=(p,v,y)=>{let b=p,u;for(;b;){const h=y(b.k,v);if(h===0)return b;if(h>0)b=b.l;else{const w=b.r;if(u=b,!w)return u;b=w}}return u};e.findOrNextLower=s;const o=(p,v)=>{const y=p.r=v.r;v.r=p,p.p=v,y&&(y.p=p)};e.insertRight=o;const i=(p,v)=>{const y=p.l=v.l;v.l=p,p.p=v,y&&(y.p=p)};e.insertLeft=i;const f=(p,v,y)=>{if(!p)return v;const b=v.k;let u=p;for(;u;){const h=y(b,u.k),w=h<0?u.l:u.r;if(w)u=w;else{h<0?(0,e.insertLeft)(v,u):(0,e.insertRight)(v,u);break}}return p};e.insert=f;const m=(p,v)=>{const y=v.p,b=v.l,u=v.r;if(v.p=v.l=v.r=void 0,!b&&!u){if(y)y.l===v?y.l=void 0:y.r=void 0;else return;return p}else if(b&&u){let w=b;for(;w.r;)w=w.r;return w.r=u,u.p=w,y?(y.l===v?y.l=b:y.r=b,b.p=y,p):(b.p=void 0,b)}const h=b||u;if(h.p=y,y)y.l===v?y.l=h:y.r=h;else return h;return p};e.remove=m})(ri)),ri}var si={},Wa;function Y0(){return Wa||(Wa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(pe(),e)})(si)),si}var Ka;function X0(){if(Ka)return hn;Ka=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.createMap=void 0;const e=Yl(),t=Y0(),d=(n,l)=>n===l?0:n<l?-1:1,a=(n,l,r,c,s,o)=>{class i{constructor(m){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=m||d}set(m,p){const v=this.root;if(v===void 0){this._size=1;const g=new n(m,p);return this.root=this.min=this.max=l(void 0,g,this.comparator)}const y=this.comparator;let b;const u=this.max;if(b=y(m,u.k),b===0)return u.v=p,u;if(b>0){const g=this.max=new n(m,p);return this.root=c(v,g,u),this._size++,g}const h=this.min;if(b=y(m,h.k),b===0)return h.v=p,h;if(b<0){const g=this.min=new n(m,p);return this.root=r(v,g,h),this._size++,g}let w=v;do{if(b=y(m,w.k),b===0)return w.v=p,w;if(b>0){const g=w.r;if(g===void 0){const _=new n(m,p);return this.root=c(v,_,w),this._size++,_}w=g}else if(b<0){const g=w.l;if(g===void 0){const _=new n(m,p);return this.root=r(v,_,w),this._size++,_}w=g}}while(!0)}find(m){const p=this.comparator;let v=this.root;for(;v;){const y=+p(m,v.k);if(y===0)return v;v=y<0?v.l:v.r}}get(m){return this.find(m)?.v}del(m){const p=this.find(m);return p?(p===this.max&&(this.max=(0,e.prev)(p)),p===this.min&&(this.min=(0,e.next)(p)),this.root=s(this.root,p),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(m){return!!this.find(m)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(m){return(0,e.findOrNextLower)(this.root,m,this.comparator)||void 0}forEach(m){let p=this.first();if(p)do m(p);while(p=(0,e.next)(p))}first(){return this.min}last(){return this.max}iterator0(){let m=this.first();return()=>{if(!m)return;const p=m;return m=(0,e.next)(m),p}}iterator(){const m=this.iterator0();return{next:()=>{const p=m();return{value:p,done:!p}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(m){return this.constructor.name+(0,t.printTree)(m,[p=>o(this.root,p)])}}return i};return hn.createMap=a,hn}var Ya;function Q0(){if(Ya)return qe;Ya=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.AvlMap=qe.AvlNode=void 0;const e=W0(),t=X0();class d{constructor(n,l){this.k=n,this.v=l,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return qe.AvlNode=d,qe.AvlMap=(0,t.createMap)(d,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),qe}var Xa;function Vi(){if(Xa)return Ie;Xa=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Model=Ie.UNDEFINED=void 0;const e=L,t=e.__importStar(Ye()),d=e.__importStar(z()),a=O0(),n=zl(),l=Pr(),r=G0(),c=Ee(),s=jr(),o=pe(),i=H0(),f=Q0(),m=qr();Ie.UNDEFINED=new s.ConNode(l.ORIGIN,void 0);let p=class vi{rndSid(){const y=this.clock,b=y.sid,u=y.peers;for(;;){const h=(0,r.randomSessionId)();if(b!==h&&!u.has(h))return h}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const h=y[0].getId().sid;if(!h)throw new Error("NO_SID");const w=vi.create(void 0,h);return w.applyBatch(y),w}constructor(y){this.root=new c.RootNode(this,l.ORIGIN),this.index=new f.AvlMap(d.compare),this.ext=new i.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new n.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const b=y.length;for(let u=0;u<b;u++)this.applyPatch(y[u])}applyLocalPatch(y){const b=y.getId();if(b){const u=this.clock;if(u.sid===b.sid){const h=u.time;h>b.time&&(y=y.rebase(h))}}this.applyPatch(y)}applyPatch(y){this.onbeforepatch?.(y);const b=y.ops,{length:u}=b;for(let h=0;h<u;h++)this.applyOperation(b[h]);this.tick++,this.onpatch?.(y)}applyOperation(y){this.clock.observe(y.id,y.span());const b=this.index;if(y instanceof t.InsStrOp){const u=b.get(y.obj);u instanceof c.StrNode&&u.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewObjOp){const u=y.id;b.get(u)||b.set(u,new c.ObjNode(this,u))}else if(y instanceof t.NewArrOp){const u=y.id;b.get(u)||b.set(u,new c.ArrNode(this,u))}else if(y instanceof t.NewStrOp){const u=y.id;b.get(u)||b.set(u,new c.StrNode(u))}else if(y instanceof t.NewValOp){const u=y.id;b.get(u)||b.set(u,new c.ValNode(this,u,l.ORIGIN))}else if(y instanceof t.NewConOp){const u=y.id;b.get(u)||b.set(u,new s.ConNode(u,y.val))}else if(y instanceof t.InsObjOp){const u=b.get(y.obj),h=y.data,w=h.length;if(u instanceof c.ObjNode)for(let g=0;g<w;g++){const _=h[g],C=b.get(_[1]);if(!C||u.id.time>=_[1].time)continue;const O=u.put(_[0]+"",C.id);O&&this._gcTree(O)}}else if(y instanceof t.InsVecOp){const u=b.get(y.obj),h=y.data,w=h.length;if(u instanceof c.VecNode)for(let g=0;g<w;g++){const _=h[g],C=b.get(_[1]);if(!C||u.id.time>=_[1].time)continue;const O=u.put(Number(_[0]),C.id);O&&this._gcTree(O)}}else if(y instanceof t.InsValOp){const u=y.obj,h=u.sid===0&&u.time===0?this.root:b.get(u);if(h instanceof c.ValNode&&b.get(y.val)){const g=h.set(y.val);g&&this._gcTree(g)}}else if(y instanceof t.InsArrOp){const u=b.get(y.obj);if(u instanceof c.ArrNode){const h=[],w=y.data,g=w.length;for(let _=0;_<g;_++){const C=w[_];b.get(C)&&(u.id.time>=C.time||h.push(C))}h.length&&u.ins(y.ref,y.id,h)}}else if(y instanceof t.UpdArrOp){const u=b.get(y.obj);if(u instanceof c.ArrNode){const h=y.val;if(b.get(h)){const w=u.upd(y.ref,h);w&&this._gcTree(w)}}}else if(y instanceof t.DelOp){const u=b.get(y.obj);if(u instanceof c.ArrNode){const h=y.what.length;for(let w=0;w<h;w++){const g=y.what[w];for(let _=0;_<g.span;_++){const C=u.getById(new d.Timestamp(g.sid,g.time+_));C&&this._gcTree(C)}}u.delete(y.what)}else(u instanceof c.StrNode||u instanceof c.BinNode)&&u.delete(y.what)}else if(y instanceof t.NewBinOp){const u=y.id;b.get(u)||b.set(u,new c.BinNode(u))}else if(y instanceof t.InsBinOp){const u=b.get(y.obj);u instanceof c.BinNode&&u.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewVecOp){const u=y.id;b.get(u)||b.set(u,new c.VecNode(this,u))}}_gcTree(y){if(y.sid===0)return;const u=this.index.get(y);if(!u)return;const h=u.api;h&&h.events.handleDelete(),u.children(w=>this._gcTree(w.id)),this.index.del(y)}fork(y=this.rndSid()){const b=vi.fromBinary(this.toBinary());return b.clock.sid!==y&&b.clock instanceof d.ClockVector&&(b.clock=b.clock.fork(y)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(y){this.onbeforereset?.();const b=this.index;this.index=new f.AvlMap(d.compare);const u=y.toBinary();a.decoder.decode(u,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const h=this._api;h&&(h.flush(),h.builder.clock=this.clock,h.node=this.root),b.forEach(({v:w})=>{const g=w.api;if(!g)return;const _=this.index.get(w.id);if(!_){g.events.handleDelete();return}g.node=_,_.api=g}),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return a.encoder.encode(this)}setSchema(y,b=!0){const u=this.clock;if(u.time===1){const w=u.sid;b&&(u.sid=2),this.api.set(y),b&&this.setSid(w)}return this}setSid(y){const b=this.clock,u=b.sid;u!==y&&(b.sid=y,b.observe(new d.Timestamp(u,b.time-1),1))}toString(y=""){const b=()=>"",u=this.ext.size()>0;return"model"+(0,o.printTree)(y,[h=>this.root.toString(h),b,h=>{const w=[];return this.index.forEach(g=>w.push(g.v)),`index (${w.length} nodes)`+(w.length?(0,o.printTree)(h,w.map(g=>_=>`${g.name()} ${d.printTs(g.id)}`)):"")},b,h=>`view${(0,o.printTree)(h,[w=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+w)])}`,b,h=>this.clock.toString(h),u?b:null,u?h=>this.ext.toString(h):null])}};return Ie.Model=p,p.sid=r.randomSessionId,p.create=(v,y=p.sid())=>{const b=typeof y=="number"?y===1?new d.ServerClockVector(1,1):new d.ClockVector(y,1):y,u=new p(b);return v!==void 0&&u.setSchema(v instanceof m.NodeBuilder?v:m.s.json(v),!0),u},p.withServerClock=(v,y=1)=>p.create(v,new d.ServerClockVector(1,y)),p.fromBinary=v=>a.decoder.decode(v),p.load=(v,y,b)=>{const u=a.decoder.decode(v);return b&&u.setSchema(b,!0),typeof y=="number"&&u.setSid(y),u},Ie}var Qa;function Xl(){if(Qa)return Rt;Qa=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.ValNode=void 0;const e=z(),t=pe(),d=Vi();let a=class{constructor(l,r,c){this.doc=l,this.id=r,this.val=c,this.api=void 0}set(l){if((0,e.compare)(l,this.val)<=0&&this.val.sid!==0||(0,e.compare)(l,this.id)<=0)return;const r=this.val;return this.val=l,r}node(){return this.val.sid===0?d.UNDEFINED:this.child()}view(){return this.node()?.view()}children(l){l(this.node())}child(){return this.doc.index.get(this.val)}container(){const l=this.node();return l?l.container():void 0}name(){return"val"}toString(l=""){const r=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,t.printTree)(l,[s=>r?r.toString(s):(0,e.printTs)(this.val)])}};return Rt.ValNode=a,Rt}var bn={},Za;function Z0(){if(Za)return bn;Za=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.RootNode=void 0;const e=Pr(),t=Xl();let d=class extends t.ValNode{constructor(n,l){super(n,e.ORIGIN,l)}name(){return"root"}};return bn.RootNode=d,bn}var gn={},yn={},$a;function $0(){if($a)return yn;$a=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.CRDT_CONSTANTS=void 0;var e;return(function(t){t[t.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"})(e||(yn.CRDT_CONSTANTS=e={})),yn}var eu;function ep(){if(eu)return gn;eu=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.VecNode=void 0;const e=jr(),t=$0(),d=pe(),a=z();let n=class{constructor(r,c){this.doc=r,this.id=c,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(r){return this.elements[r]}get(r){const c=this.elements[r];if(c)return this.doc.index.get(c)}put(r,c){if(r>t.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const s=this.val(r);if(!(s&&(0,a.compare)(s,c)>=0)){if(r>this.elements.length)for(let o=this.elements.length;o<r;o++)this.elements.push(void 0);return r<this.elements.length?this.elements[r]=c:this.elements.push(c),s}}ext(){if(this.__extNode)return this.__extNode;const r=this.getExtId();if(!(r>=0))return;const s=this.doc.ext.get(r);if(s)return this.__extNode=new s.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const r=this.get(0);if(!(r instanceof e.ConNode))return-1;const c=r.val,s=this.id;return!(c instanceof Uint8Array)||c.length!==3||c[1]!==s.sid%256||c[2]!==s.time%256?-1:c[0]}child(){return this.ext()}container(){return this}children(r){const c=this.elements,s=c.length,o=this.doc.index;for(let i=0;i<s;i++){const f=c[i];if(!f)continue;const m=o.get(f);m&&r(m)}}view(){const r=this.ext();if(r)return r.view();let c=!0;const s=this._view,o=[],i=this.doc.index,f=this.elements,m=f.length;for(let p=0;p<m;p++){const v=f[p],y=v?i.get(v):void 0,b=y?y.view():void 0;s[p]!==b&&(c=!1),o.push(b)}return c?s:this._view=o}name(){return"vec"}toString(r=""){const c=this.ext(),s=this.name()+" "+(0,a.printTs)(this.id)+(c?` { extension = ${this.getExtId()} }`:"");if(c)return this.child().toString(r,this.id);const o=this.doc.index;return s+(0,d.printTree)(r,[...this.elements.map((i,f)=>m=>`${f}: ${i&&o.get(i)?o.get(i).toString(m+"  "+" ".repeat((""+f).length)):"nil"}`),...c?[i=>`${this.child().toString(i)}`]:[]])}};return gn.VecNode=n,gn}var vn={},tu;function tp(){if(tu)return vn;tu=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.ObjNode=void 0;const e=pe(),t=z(),d=jr();let a=class{constructor(l,r){this.doc=l,this.id=r,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(l){const r=this.keys.get(l);if(r)return this.doc.index.get(r)}put(l,r){const c=this.keys.get(l);if(!(c&&(0,t.compare)(c,r)>=0))return this.keys.set(l,r),c}nodes(l){const r=this.doc.index;this.keys.forEach((c,s)=>l(r.get(c),s))}forEach(l){const r=this.doc.index;this.keys.forEach((c,s)=>{const o=r.get(c);!o||o instanceof d.ConNode&&o.val===void 0||l(s,o)})}children(l){const r=this.doc.index;this.keys.forEach((c,s)=>l(r.get(c)))}child(){}container(){return this}view(){const l=this.doc,r=l.clock.time+l.tick,c=this._view;if(this._tick===r)return c;const s={},o=l.index;let i=!0;return this.keys.forEach((f,m)=>{const p=o.get(f);if(!p){i=!1;return}const v=p.view();v!==void 0?(c[m]!==v&&(i=!1),s[m]=v):c[m]!==void 0&&(i=!1)}),i?c:(this._tick=r,this._view=s)}name(){return"obj"}toString(l=""){return this.name()+" "+(0,t.printTs)(this.id)+(0,e.printTree)(l,[...this.keys.entries()].filter(([,c])=>!!this.doc.index.get(c)).map(([c,s])=>o=>JSON.stringify(c)+(0,e.printTree)(o+" ",[i=>this.doc.index.get(s).toString(i)])))}};return vn.ObjNode=a,vn}var Be={},wn={},ii={},nu;function np(){return nu||(nu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const t=(s,o,i)=>{const f=o.p;if(!f)return s;const m=f.p,p=f.l===o;return m?(m.l===f?p?s=(0,e.llSplay)(s,o,f,m):s=(0,e.lrSplay)(s,o,f,m):p?s=(0,e.rlSplay)(s,o,f,m):s=(0,e.rrSplay)(s,o,f,m),i>1?(0,e.splay)(s,o,i-1):s):(p?(0,e.rSplay)(o,f):(0,e.lSplay)(o,f),o)};e.splay=t;const d=(s,o)=>{const i=s.r;s.p=void 0,s.r=o,o.p=s,o.l=i,i&&(i.p=o)};e.rSplay=d;const a=(s,o)=>{const i=s.l;s.p=void 0,s.l=o,o.p=s,o.r=i,i&&(i.p=o)};e.lSplay=a;const n=(s,o,i,f)=>{const m=i.l,p=o.l,v=f.p;return o.p=v,o.l=i,i.p=o,i.l=f,i.r=p,f.p=i,f.r=m,m&&(m.p=f),p&&(p.p=i),v?v.l===f?v.l=o:v.r=o:s=o,s};e.rrSplay=n;const l=(s,o,i,f)=>{const m=i.r,p=o.r,v=f.p;return o.p=v,o.r=i,i.p=o,i.l=p,i.r=f,f.p=i,f.l=m,m&&(m.p=f),p&&(p.p=i),v?v.l===f?v.l=o:v.r=o:s=o,s};e.llSplay=l;const r=(s,o,i,f)=>{const m=o.l,p=o.r,v=f.p;return o.p=v,o.l=i,o.r=f,i.p=o,i.r=m,f.p=o,f.l=p,m&&(m.p=i),p&&(p.p=f),v?v.l===f?v.l=o:v.r=o:s=o,s};e.lrSplay=r;const c=(s,o,i,f)=>{const m=o.r,p=o.l,v=f.p;return o.p=v,o.l=f,o.r=i,i.p=o,i.l=m,f.p=o,f.r=p,m&&(m.p=i),p&&(p.p=f),v?v.l===f?v.l=o:v.r=o:s=o,s};e.rlSplay=c})(ii)),ii}var oi={},ru;function rp(){return ru||(ru=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const t=(s,o)=>{const i=o.p2;if(!i)return s;const f=i.p2,m=i.l2===o;return f?(f.l2===i?m?s=l(s,o,i,f):s=r(s,o,i,f):m?s=c(s,o,i,f):s=n(s,o,i,f),(0,e.splay2)(s,o)):(m?d(o,i):a(o,i),o)};e.splay2=t;const d=(s,o)=>{const i=s.r2;s.p2=void 0,s.r2=o,o.p2=s,o.l2=i,i&&(i.p2=o)},a=(s,o)=>{const i=s.l2;s.p2=void 0,s.l2=o,o.p2=s,o.r2=i,i&&(i.p2=o)},n=(s,o,i,f)=>{const m=i.l2,p=o.l2,v=f.p2;return o.p2=v,o.l2=i,i.p2=o,i.l2=f,i.r2=p,f.p2=i,f.r2=m,m&&(m.p2=f),p&&(p.p2=i),v?v.l2===f?v.l2=o:v.r2=o:s=o,s},l=(s,o,i,f)=>{const m=i.r2,p=o.r2,v=f.p2;return o.p2=v,o.r2=i,i.p2=o,i.l2=p,i.r2=f,f.p2=i,f.l2=m,m&&(m.p2=f),p&&(p.p2=i),v?v.l2===f?v.l2=o:v.r2=o:s=o,s},r=(s,o,i,f)=>{const m=o.l2,p=o.r2,v=f.p2;return o.p2=v,o.l2=i,o.r2=f,i.p2=o,i.r2=m,f.p2=o,f.l2=p,m&&(m.p2=i),p&&(p.p2=f),v?v.l2===f?v.l2=o:v.r2=o:s=o,s},c=(s,o,i,f)=>{const m=o.r2,p=o.l2,v=f.p2;return o.p2=v,o.l2=f,o.r2=i,i.p2=o,i.l2=m,f.p2=o,f.r2=p,m&&(m.p2=i),p&&(p.p2=f),v?v.l2===f?v.l2=o:v.r2=o:s=o,s}})(oi)),oi}var re={},su;function sp(){if(su)return re;su=1,Object.defineProperty(re,"__esModule",{value:!0}),re.remove2=re.insert2=re.prev2=re.next2=re.last2=re.first2=void 0;const e=s=>{let o=s;for(;o;)if(o.l2)o=o.l2;else return o;return o};re.first2=e;const t=s=>{let o=s;for(;o;)if(o.r2)o=o.r2;else return o;return o};re.last2=t;const d=s=>{if(s.r2){for(s=s.r2;s.l2;)s=s.l2;return s}let o=s.p2;for(;o&&o.r2===s;)s=o,o=o.p2;return o};re.next2=d;const a=s=>{if(s.l2){for(s=s.l2;s.r2;)s=s.r2;return s}let o=s.p2;for(;o&&o.l2===s;)s=o,o=o.p2;return o};re.prev2=a;const n=(s,o)=>{const i=s.r2=o.r2;o.r2=s,s.p2=o,i&&(i.p2=s)},l=(s,o)=>{const i=s.l2=o.l2;o.l2=s,s.p2=o,i&&(i.p2=s)},r=(s,o,i)=>{if(!s)return o;let f=s;for(;f;){const m=i(o,f),p=m<0?f.l2:f.r2;if(p)f=p;else{m<0?l(o,f):n(o,f);break}}return s};re.insert2=r;const c=(s,o)=>{const i=o.p2,f=o.l2,m=o.r2;if(o.p2=o.l2=o.r2=void 0,!f&&!m){if(i)i.l2===o?i.l2=void 0:i.r2=void 0;else return;return s}else if(f&&m){let v=f;for(;v.r2;)v=v.r2;return v.r2=m,m.p2=v,i?(i.l2===o?i.l2=f:i.r2=f,f.p2=i,s):(f.p2=void 0,f)}const p=f||m;if(p.p2=i,i)i.l2===o?i.l2=p:i.r2=p;else return p;return s};return re.remove2=c,re}var _n={},iu;function ip(){if(iu)return _n;iu=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.printOctets=void 0;const e=(t,d=16)=>{let a="";if(!t.length)return a;t[0]<16&&(a+="0"),a+=t[0].toString(16);for(let n=1;n<t.length&&n<d;n++){const l=t[n];a+=" ",l<16&&(a+="0"),a+=l.toString(16)}return t.length>d&&(a+=`… (${t.length-d} more)`),a};return _n.printOctets=e,_n}var ou;function Ji(){if(ou)return wn;ou=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.AbstractRga=void 0;const e=z(),t=Pi(),d=np(),a=rp(),n=sp(),l=Pr(),r=pe(),c=Bi(),s=ip(),o=(b,u)=>{const h=b.id,w=u.id;return h.sid-w.sid||h.time-w.time},i=b=>{const u=b.l,h=b.r;b.len=(b.del?0:b.span)+(u?u.len:0)+(h?h.len:0)},f=b=>{const u=b.l,h=b.r;b.len=b.span+(u?u.len:0)+(h?h.len:0)},m=(b,u)=>{for(;b;)b.len+=u,b=b.p},p=b=>{const u=b.r;if(u){b=u;let w;for(;w=b.l;)b=w;return b}let h=b.p;for(;h&&h.r===b;)b=h,h=h.p;return h},v=b=>{const u=b.l;if(u){b=u;let w;for(;w=b.r;)b=w;return b}let h=b.p;for(;h&&h.l===b;)b=h,h=h.p;return h};let y=class{constructor(u){this.id=u,this.root=void 0,this.ids=void 0,this.count=0}ins(u,h,w){const g=this.id,_=u.time,C=u.sid;if(g.time===_&&g.sid===C){this.insAfterRoot(u,h,w);return}let k=this.ids,S=k;for(;k;){const T=k.id,q=T.sid;if(q>C)k=k.l2;else if(q<C)S=k,k=k.r2;else{const B=T.time;if(B>_)k=k.l2;else if(B<_)S=k,k=k.r2;else{S=k;break}}}if(!S)return;const E=S.id,A=E.time,N=E.sid,x=S.span;if(N!==C||_-A>=x)return;const R=_-A;this.insAfterChunk(u,S,R,h,w)}insAt(u,h,w){if(!u){const S=this.id;return this.insAfterRoot(S,h,w),S}const g=this.findChunk(u-1);if(!g)return;const[_,C]=g,O=_.id,k=C===0?O:new e.Timestamp(O.sid,O.time+C);return this.insAfterChunk(k,_,C,h,w),k}insAfterRoot(u,h,w){const g=this.createChunk(h,w),_=this.first();if(!_)this.setRoot(g);else if((0,e.compare)(_.id,h)<0)this.insertBefore(g,_);else{if((0,e.containsId)(_.id,_.span,h))return;this.insertAfterRef(g,u,_)}}insAfterChunk(u,h,w,g,_){const C=h.id,O=C.time,k=C.sid,S=h.span,E=this.createChunk(g,_);if(w+1<S){const N=g.sid,x=g.time;if(k===N&&O<=x&&O+S-1>=x)return;if(x>u.time+1||N>u.sid){this.insertInside(E,h,w+1),this.splay(E);return}}this.insertAfterRef(E,u,h),this.splay(E)}delete(u){const h=u.length;for(let w=0;w<h;w++)this.deleteSpan(u[w]);this.onChange()}deleteSpan(u){const h=u.span,w=u.time,g=w+h-1,_=this.findById(u);if(!_)return;let C=_,O=C;for(;C;){O=C;const k=C.id,S=C.span,E=k.time,A=E+S-1;if(C.del){if(A>=g)break;C=C.s;continue}const N=w<=E,x=w<=A;if(N)if(g>=A){if(C.delete(),m(C,-C.span),g<=A)break}else{const R=g-E+1,T=this.split(C,R);C.delete(),i(T),m(C,-C.span);break}else if(x)if(g>=A){const R=w-E,T=this.split(C,R);if(T.delete(),T.len=T.r?T.r.len:0,m(C,-T.span),g<=A)break}else{const R=this.split(C,g-E+1),T=this.split(C,w-E);T.delete(),i(R),i(T),m(C,-T.span);break}C=C.s}O&&this.mergeTombstones2(_,O)}find(u){let h=this.root;for(;h;){const w=h.l,g=w?w.len:0;let _;if(u<g)h=w;else if(h.del)u-=g,h=h.r;else if(u<g+(_=h.span)){const C=u-g,O=h.id;return C?new e.Timestamp(O.sid,O.time+C):O}else u-=g+_,h=h.r}}findChunk(u){let h=this.root;for(;h;){const w=h.l,g=w?w.len:0;let _;if(u<g)h=w;else if(h.del)u-=g,h=h.r;else{if(u<g+(_=h.span))return[h,u-g];u-=g+_,h=h.r}}}findInterval(u,h){const w=[];if(!h)return w;let g=this.root,_=0;for(;g;){const k=g.l?g.l.len:0;if(u<k)g=g.l;else if(g.del)u-=k,g=g.r;else if(u<k+g.span){_=u-k;break}else u-=k+g.span,g=g.r}if(!g)return w;if(g.span>=h+_){const k=g.id;return w.push((0,e.tss)(k.sid,k.time+_,h)),w}const C=g.span-_,O=g.id;if(w.push((0,e.tss)(O.sid,O.time+_,C)),h-=C,g=p(g),!g)return w;do{if(g.del)continue;const k=g.id,S=g.span;if(h<=S)return w.push((0,e.tss)(k.sid,k.time,h)),w;w.push((0,e.tss)(k.sid,k.time,S)),h-=S}while((g=p(g))&&h>0);return w}findInterval2(u,h){const w=[];return this.range0(void 0,u,h,(g,_,C)=>{const O=g.id;w.push((0,e.tss)(O.sid,O.time+_,C))}),w}range0(u,h,w,g){let _=u||this.findById(h);if(u)for(;_&&!(0,e.containsId)(_.id,_.span,h);)_=p(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,w))return}else{const C=h.time-_.id.time;if((0,e.containsId)(_.id,_.span,w)){const S=w.time-h.time+1;return g(_,C,S),_}const k=_.span-C;if(g(_,C,k))return _}for(_=p(_);_;){if((0,e.containsId)(_.id,_.span,w))return!_.del&&g(_,0,w.time-_.id.time+1),_;if(!_.del&&g(_,0,_.span))return _;_=p(_)}return _}}first(){let u=this.root;for(;u;){const h=u.l;if(h)u=h;else return u}return u}last(){let u=this.root;for(;u;){const h=u.r;if(h)u=h;else return u}return u}lastId(){const u=this.last();if(!u)return;const h=u.id,w=u.span;return w===1?h:new e.Timestamp(h.sid,h.time+w-1)}next(u){return p(u)}prev(u){return v(u)}length(){const u=this.root;return u?u.len:0}size(){return this.count}pos(u){const h=u.p,w=u.l;if(!h)return w?w.len:0;const g=this.pos(h);if(h.r===u)return g+(h.del?0:h.span)+(w?w.len:0);const C=u.r;return g-(u.del?0:u.span)-(C?C.len:0)}setRoot(u){this.root=u,this.insertId(u),this.onChange()}insertBefore(u,h){const w=h.l;h.l=u,u.l=w,u.p=h;let g=0;w&&(w.p=u,g=w.len),u.len=u.span+g,m(h,u.span),this.insertId(u),this.onChange()}insertAfter(u,h){const w=h.r;h.r=u,u.r=w,u.p=h;let g=0;w&&(w.p=u,g=w.len),u.len=u.span+g,m(h,u.span),this.insertId(u),this.onChange()}insertAfterRef(u,h,w){const g=u.id,_=g.sid,C=g.time;let O=!1;for(;;){const k=w.id,S=k.time+w.span;w.s||(O=k.sid===_&&S===C&&S-1===h.time,O&&(w.s=u));const E=p(w);if(!E)break;const A=E.id,N=A.time,x=A.sid;if(N<C)break;if(N===C){if(x===_)return;if(x<_)break}w=E}O&&!w.del?(this.mergeContent(w,u.data),w.s=void 0):this.insertAfter(u,w)}mergeContent(u,h){const w=u.span;u.merge(h),m(u,u.span-w),this.onChange()}insertInside(u,h,w){const g=h.p,_=h.l,C=h.r,O=h.s,k=h.len,S=h.split(w);if(h.s=S,S.s=O,h.l=h.r=S.l=S.r=void 0,S.l=void 0,u.p=g,!_)u.l=h,h.p=u;else{u.l=_,_.p=u;const N=_.r;_.r=h,h.p=_,h.l=N,N&&(N.p=h)}if(!C)u.r=S,S.p=u;else{u.r=C,C.p=u;const N=C.l;C.l=S,S.p=C,S.r=N,N&&(N.p=S)}g?g.l===h?g.l=u:g.r=u:this.root=u,i(h),i(S),_&&(_.len=(_.l?_.l.len:0)+h.len+(_.del?0:_.span)),C&&(C.len=(C.r?C.r.len:0)+S.len+(C.del?0:C.span)),u.len=k+u.span;const E=u.span;let A=u.p;for(;A;)A.len+=E,A=A.p;this.insertId(S),this.insertIdFast(u),this.onChange()}split(u,h){const w=u.s,g=u.split(h),_=u.r;return u.s=g,g.r=_,g.s=w,u.r=g,g.p=u,this.insertId(g),_&&(_.p=g),g}mergeTombstones(u,h){if(!u.del||!h.del)return!1;const w=u.id,g=h.id;return w.sid!==g.sid||w.time+u.span!==g.time?!1:(u.s=h.s,u.span+=h.span,this.deleteChunk(h),!0)}mergeTombstones2(u,h){let w=u;for(;w;){const _=p(w);if(!_)break;if(!this.mergeTombstones(w,_)){if(_===h){if(_){const O=p(_);O&&this.mergeTombstones(_,O)}break}w=w.s}}const g=v(u);g&&this.mergeTombstones(g,u)}removeTombstones(){let u=this.first();const h=[];for(;u;)u.del&&h.push(u),u=p(u);for(let w=0;w<h.length;w++)this.deleteChunk(h[w])}deleteChunk(u){this.deleteId(u);const h=u.p,w=u.l,g=u.r;if(u.id=l.ORIGIN,!w&&!g)h?h.l===u?h.l=void 0:h.r=void 0:this.root=void 0;else if(w&&g){let _=w;for(;_.r;)_=_.r;_.r=g,g.p=_;const C=g.len;let O;for(O=_,h?(h.l===u?h.l=w:h.r=w,w.p=h):(this.root=w,w.p=void 0);O&&O!==h;)O.len+=C,O=O.p}else{const _=w||g;_.p=h,h?h.l===u?h.l=_:h.r=_:this.root=_}}insertId(u){this.ids=(0,n.insert2)(this.ids,u,o),this.count++,this.ids=(0,a.splay2)(this.ids,u)}insertIdFast(u){this.ids=(0,n.insert2)(this.ids,u,o),this.count++}deleteId(u){this.ids=(0,n.remove2)(this.ids,u),this.count--}findById(u){const h=u.sid,w=u.time;let g=this.ids,_=g;for(;g;){const A=g.id,N=A.sid;if(N>h)g=g.l2;else if(N<h)_=g,g=g.r2;else{const x=A.time;if(x>w)g=g.l2;else if(x<w)_=g,g=g.r2;else{_=g;break}}}if(!_)return;const C=_.id,O=C.time,k=C.sid,S=_.span;if(!(k!==h||w<O||w-O>=S))return _}prevId(u){let h=this.findById(u);if(!h)return;const w=u.time;if(h.id.time<w)return new e.Timestamp(u.sid,w-1);if(h=v(h),!h)return;const g=h.id;return h.span>1?new e.Timestamp(g.sid,g.time+h.span-1):g}spanView(u){const h=[];let w=u.span;const g=u.time;let _=this.findById(u);if(!_)return h;if(!_.del)if(_.span>=w+g-_.id.time){const C=g-_.id.time,O=C+w,k=_.view().slice(C,O);return h.push(k),h}else{const C=g-_.id.time,O=_.view().slice(C,u.span);w-=_.span-C,h.push(O)}for(;_=_.s;){const C=_.span;if(!_.del){if(C>w){const O=_.view().slice(0,w);h.push(O);break}h.push(_.data)}if(w-=C,w<=0)break}return h}splay(u){const h=u.p;if(!h)return;const w=h.p,g=h.l===u;if(!w){g?(0,d.rSplay)(u,h):(0,d.lSplay)(u,h),this.root=u,i(h),f(u);return}w.l===h?g?this.root=(0,d.llSplay)(this.root,u,h,w):this.root=(0,d.lrSplay)(this.root,u,h,w):g?this.root=(0,d.rlSplay)(this.root,u,h,w):this.root=(0,d.rrSplay)(this.root,u,h,w),i(w),i(h),f(u),this.splay(u)}iterator(){let u=this.first();return()=>{const h=u;return u&&(u=p(u)),h}}ingest(u,h){if(u<1)return;const w=new Map;this.root=this._ingest(u,()=>{const g=h(),_=g.id,C=_.sid+"."+_.time,O=w.get(C);O&&(O.s=g,w.delete(C));const k=(0,e.tick)(_,g.span);return w.set(k.sid+"."+k.time,g),g})}_ingest(u,h){const w=u>>1,g=u-w-1,_=w>0?this._ingest(w,h):void 0,C=h();_&&(C.l=_,_.p=C);const O=g>0?this._ingest(g,h):void 0;return O&&(C.r=O,O.p=C),i(C),this.insertId(C),C}toStringName(){return"AbstractRga"}toString(u=""){const h=this.view();let w="";return(0,t.isUint8Array)(h)?w+=` { ${(0,s.printOctets)(h)||"∅"} }`:typeof h=="string"&&(w+=`{ ${h.length>32?JSON.stringify(h.substring(0,32))+" …":JSON.stringify(h)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${w}`+(0,r.printTree)(u,[_=>this.root?this.printChunk(_,this.root):"∅"])}printChunk(u,h){return this.formatChunk(h)+(0,c.printBinary)(u,[h.l?w=>this.printChunk(w,h.l):null,h.r?w=>this.printChunk(w,h.r):null])}formatChunk(u){let w=`chunk ${(0,e.printTs)(u.id)}:${u.span} .${u.len}.`;if(u.del)w+=` [${u.span}]`;else if((0,t.isUint8Array)(u.data))w+=` { ${(0,s.printOctets)(u.data)||"∅"} }`;else if(typeof u.data=="string"){const g=u.data.length>32?JSON.stringify(u.data.substring(0,32))+" …":JSON.stringify(u.data);w+=` { ${g} }`}return w}};return wn.AbstractRga=y,wn}var cu;function op(){if(cu)return Be;cu=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.ArrNode=Be.ArrChunk=void 0;const e=Ji(),t=z(),d=Bi(),a=pe();class n{constructor(c,s,o){this.id=c,this.span=s,this.len=o?s:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(c){this.data.push(...c),this.span=this.data.length}split(c){const s=this.span;if(this.span=c,!this.del){const i=this.data.splice(c);return new n((0,t.tick)(this.id,c),s-c,i)}return new n((0,t.tick)(this.id,c),s-c,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new n(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Be.ArrChunk=n;let l=class extends e.AbstractRga{constructor(c,s){super(s),this.doc=c,this._tick=0,this._view=[],this.api=void 0}get(c){const s=this.findChunk(c);if(s)return s[0].data[s[1]]}getNode(c){const s=this.get(c);if(s)return this.doc.index.get(s)}getId(c){const s=this.findChunk(c);if(!s)return;const[o,i]=s,f=o.id;return i?(0,t.tick)(f,i):f}getById(c){const s=this.findById(c);if(!s||s.del)return;const o=c.time-s.id.time;return s.data[o]}upd(c,s){const o=this.findById(c);if(!o)return;const i=o.data;if(!i)return;const f=c.time-o.id.time,m=i[f];if(!(m&&(0,t.compare)(m,s)>=0))return i[f]=s,this.onChange(),m}createChunk(c,s){return new n(c,s?s.length:0,s)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const c=this.doc,s=c.clock.time+c.tick,o=this._view;if(this._tick===s)return o;const i=[],f=c.index;let m=!0;for(let v=this.first();v;v=this.next(v))if(!v.del)for(const y of v.data){const b=f.get(y);if(!b){m=!1;continue}const u=b.view();o[i.length]!==u&&(m=!1),i.push(u)}return o.length!==i.length&&(m=!1),m?o:(this._tick=s,this._view=i)}children(c){const s=this.doc.index;for(let o=this.first();o;o=this.next(o)){const i=o.data;if(!i)continue;const f=i.length;for(let m=0;m<f;m++)c(s.get(i[m]))}}name(){return"arr"}printChunk(c,s){const o=this.pos(s);let i="";if(!s.del){const f=this.doc.index;i=(0,a.printTree)(c,s.data.map(m=>f.get(m)).filter(m=>!!m).map((m,p)=>v=>`[${o+p}]: ${m.toString(v+"    "+" ".repeat(String(p).length))}`))}return this.formatChunk(s)+i+(0,d.printBinary)(c,[s.l?f=>this.printChunk(f,s.l):null,s.r?f=>this.printChunk(f,s.r):null])}};return Be.ArrNode=l,Be}var Ve={},au;function cp(){if(au)return Ve;au=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.BinNode=Ve.BinChunk=void 0;const e=z(),t=Ji();class d{constructor(l,r,c){this.id=l,this.span=r,this.len=c?r:0,this.del=!c,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=c}merge(l){const r=this.data.length,c=new Uint8Array(r+l.length);c.set(this.data),c.set(l,r),this.data=c,this.span=c.length}split(l){if(!this.del){const c=this.data,s=c.subarray(l),o=new d((0,e.tick)(this.id,l),this.span-l,s);return this.data=c.subarray(0,l),this.span=l,o}const r=new d((0,e.tick)(this.id,l),this.span-l,void 0);return this.span=l,r}delete(){this.del=!0,this.data=void 0}clone(){return new d(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Ve.BinChunk=d;let a=class extends t.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const l=new Uint8Array(this.length());let r=0,c=this.first();for(;c;){if(!c.del){const s=c.data;l.set(s,r),r+=s.length}c=this.next(c)}return this._view=l}children(){}child(){}container(){}name(){return"bin"}createChunk(l,r){return new d(l,r?r.length:0,r)}onChange(){this._view=null}toStringName(){return this.name()}};return Ve.BinNode=a,Ve}var Je={},uu;function ap(){if(uu)return Je;uu=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.StrNode=Je.StrChunk=void 0;const e=z(),t=Ji(),d=Yl();class a{constructor(r,c,s){this.id=r,this.span=c,this.len=s?c:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=s}merge(r){this.data+=r,this.span=this.data.length}split(r){if(!this.del){const s=new a((0,e.tick)(this.id,r),this.span-r,this.data.slice(r));return this.data=this.data.slice(0,r),this.span=r,s}const c=new a((0,e.tick)(this.id,r),this.span-r,"");return this.span=r,c}delete(){this.del=!0,this.data=""}clone(){return new a(this.id,this.span,this.data)}view(){return this.data}}Je.StrChunk=a;let n=class extends t.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let r="";for(let c=this.first();c;c=(0,d.next)(c))r+=c.data;return this._view=r}name(){return"str"}createChunk(r,c){return new a(r,c?c.length:0,c||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Je.StrNode=n,Je}var lu;function up(){return lu||(lu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var t=jr();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return t.ConNode}});var d=Xl();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return d.ValNode}});var a=Z0();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return a.RootNode}});var n=ep();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return n.VecNode}});var l=tp();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return l.ObjNode}});var r=op();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return r.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return r.ArrChunk}});var c=cp();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return c.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return c.BinChunk}});var s=ap();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return s.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return s.StrChunk}})})(Ts)),Ts}var du;function Ee(){return du||(du=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(i0(),e),t.__exportStar(up(),e)})(Rs)),Rs}var ci={},fu;function lp(){return fu||(fu=1,Object.defineProperty(ci,"__esModule",{value:!0})),ci}var ai={},hu;function dp(){return hu||(hu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const t=L;var d=Vi();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return d.Model}}),t.__exportStar(zl(),e)})(ai)),ai}var pu;function dr(){return pu||(pu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Ee(),e),t.__exportStar(lp(),e),t.__exportStar(dp(),e),t.__exportStar(qr(),e)})(xs)),xs}var Cn={},Sn={},On={},mu;function fp(){if(mu)return On;mu=1,Object.defineProperty(On,"__esModule",{value:!0}),On.PropertyLayout=void 0;const e=M(),t=K(),d=Q(),a=({property:n,formal:l,focused:r})=>{const c=(0,t.useTheme)(),s={color:c.g(.1)};return r&&(s.background=c.bg,s.border=`1px solid ${c.g(.9)}`,s.fontWeight="bold",s.margin="-3px",s.padding="2px"),(!n||n.indexOf(" ")!==-1)&&(s.background=c.blue(.1)),e.createElement(e.Fragment,null,e.createElement("span",{className:d.property,style:s},l?JSON.stringify(n):n),e.createElement("span",{className:d.colon,style:{color:c.g(.5)}},e.createElement("span",null,":")))};return On.PropertyLayout=a,On}var bu;function we(){if(bu)return Sn;bu=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.JsonCrdtProperty=void 0;const e=M(),t=fp(),d=({node:a})=>!a.parent||a.parent.node.name()!=="obj"?null:e.createElement(t.PropertyLayout,{property:a.step});return Sn.JsonCrdtProperty=d,Sn}var En={},kn={},gu;function hp(){if(gu)return kn;gu=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.TypeAndId=void 0;const e=M(),t=K(),d=dr(),a=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",us:"none",pe:"none"}));return kn.TypeAndId=e.memo(({node:n,active:l,negative:r,extension:c})=>{const s=(0,t.useTheme)(),o=n.node;let i=o.name();c&&o instanceof d.VecNode&&o.isExt()&&(i=e.createElement("span",{style:{whiteSpace:"nowrap"}},"ext ",e.createElement("span",{style:{color:s.color.sem.brand[1]}},o.ext().name())));const{sid:f,time:m}=o.id;return e.createElement("span",{className:a,style:{color:l?r?s.color.sem.negative[0]:s.color.sem.blue[0]:s.g(0,.5)}},i,e.createElement("span",{style:{color:l?s.g(0,.45):s.g(0,.2),display:"block"}},l?(f>999?"...":"")+String(f).slice(String(f).length-4):null,e.createElement("span",{style:{color:l?s.g(0,.7):s.g(0,.3)}},"."+m)))}),kn}var ge={},yu;function _e(){if(yu)return ge;yu=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.isContainer=ge.createValue=ge.id=void 0;const e=a=>{const n=a.node.id;return n.sid+"."+n.time};ge.id=e;const t=(a,n,l,r)=>{let c=n;try{c=JSON.parse(n)}catch{}const s=a.api,o=s.builder,i=l==="any"?r?o.constOrJson(c):o.json(c):l==="con"?s.builder.const(c):l==="vec"?s.builder.vec():l==="val"?s.builder.val():s.builder.const(void 0);if(l==="vec"){if(n){const f=Array.isArray(c)?c:[c];o.insVec(i,f.map((m,p)=>[p,s.builder.maybeConst(m)]))}}else l==="val"&&o.setVal(i,n?s.builder.maybeConst(c):s.builder.const(void 0));return i};ge.createValue=t;const d=a=>!!a&&typeof a=="object";return ge.isContainer=d,ge}var An={},vu;function pp(){if(vu)return An;vu=1,Object.defineProperty(An,"__esModule",{value:!0}),An.JsonCrdtRegionEdit=void 0;const e=M(),t=we(),d=Ri(),a=Tr(),n=xi(),l=te(),r=_e(),c=le(),s=({node:o,onCancel:i})=>{const{compact:f}=(0,l.useStyles)(),{model:m}=(0,c.useJsonCrdt)(),p=(b,u)=>{const h=o.parent;if(h&&h.node.name()==="obj"){const w=(0,r.createValue)(m,b,u,!0);m.api.wrap(h.node).set({[o.step]:w})}else if(h&&(h.node.name()==="val"||h.node.name()==="root")){const w=(0,r.createValue)(m,b,u,!0);m.api.wrap(h.node).set(w)}else if(h&&h.node.name()==="vec"){const w=(0,r.createValue)(m,b,u,!0);m.api.wrap(h.node).set([[+o.step,w]])}i&&i()},v=o.node.view(),y=(0,r.isContainer)(v)?"":JSON.stringify(v);return e.createElement(n.FocusRegion,{compact:f},e.createElement(t.JsonCrdtProperty,{node:o}),e.createElement("span",{style:{display:"inline-block",margin:"-3px 0",position:"relative"}},e.createElement(d.ValueInput,{focus:!0,withType:!0,visible:!0,initialType:o.node.name()==="con"&&o.node.view()!==void 0?"con":"any",initialValue:y,onSubmit:p,onCancel:i}),!!i&&e.createElement(a.CancelAction,{onClick:()=>i()})))};return An.JsonCrdtRegionEdit=s,An}var wu;function ke(){if(wu)return En;wu=1,Object.defineProperty(En,"__esModule",{value:!0}),En.JsonCrdtRegion=void 0;const e=M(),t=xi(),d=ue(),a=te(),n=le(),l=hp(),r=_e(),c=pp(),s=i=>!i.parent||i.node.name()!=="con"?!1:i.node.val===void 0,o=({node:i,editing:f,extension:m,toolbar:p,children:v})=>{var y;const{model:b}=(0,n.useJsonCrdt)(),{compact:u,readonly:h}=(0,a.useStyles)(),{focused:w,focus:g,pointed:_,point:C}=(0,d.useFocus)(),O=(0,r.id)(i),[k,S]=e.useState(!1),E=V=>{V.stopPropagation(),_!==O&&C(O)},A=V=>{V.preventDefault(),V.stopPropagation(),C(O)},N=()=>{C("")},x=V=>{V.preventDefault(),V.stopPropagation(),g(O)},I=w===O,R=_===O,T=(y=i.parent)===null||y===void 0?void 0:y.node.name(),q=s(i),B=T==="obj",J=T==="arr",D=T==="vec",U=I?e.createElement("span",{style:{display:"inline-block",margin:"-4px 0 0"}},e.createElement(l.TypeAndId,{node:i,active:I,negative:q,extension:m})):void 0;return k?e.createElement(c.JsonCrdtRegionEdit,{node:i,onCancel:()=>S(!1)}):e.createElement(t.FocusRegion,{pointed:R,focused:I,compact:u,negative:q,aside:U,toolbar:p,onClick:x,onMouseMove:E,onMouseEnter:A,onMouseLeave:N,onDelete:f||h||!I||q?void 0:B?()=>{b.api.wrap(i.parent.node).del([i.step])}:J?()=>{b.api.wrap(i.parent.node).del(+i.step,1)}:D?()=>{b.api.wrap(i.parent.node).set([[+i.step,void 0]])}:T==="val"&&!q?()=>{b.api.wrap(i.parent.node).set(void 0)}:void 0,onEdit:f||h?void 0:I&&(T==="obj"||T==="val"||T==="root"||T==="vec")?()=>S(!0):void 0},v)};return En.JsonCrdtRegion=o,En}var Nn={},_u;function Ql(){if(_u)return Nn;_u=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.JsonCrdtConstant=void 0;const e=M(),t=Ke(),d=xl(),a=ue(),n=({id:l,view:r})=>{const{focus:c}=(0,a.useFocus)(),[s,o]=e.useState(!1),i=()=>{r&&typeof r=="object"&&o(!s)};return s?e.createElement("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"}},e.createElement(d.ClickableJson,{readonly:!0,compact:!0,noCollapseToggles:!0,pfx:l,doc:r,onFocus:f=>{f!==null&&c(l)}})):e.createElement(t.JsonAtom,{value:r,onClick:i})};return Nn.JsonCrdtConstant=n,Nn}var Cu;function mp(){if(Cu)return Cn;Cu=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.JsonCrdtConNode=void 0;const e=M(),t=we(),d=ke(),a=te(),n=_e(),l=Ql(),r=({node:c})=>{const{formal:s}=(0,a.useStyles)();return e.createElement(d.JsonCrdtRegion,{node:c},e.createElement(t.JsonCrdtProperty,{node:c}),e.createElement(l.JsonCrdtConstant,{id:(0,n.id)(c),view:c.node.view()}),!!s&&",")};return Cn.JsonCrdtConNode=r,Cn}var xn={},Rn={},Su;function fr(){if(Su)return Rn;Su=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.JsonCrdtObjectLayout=void 0;const e=L,t=M(),d=Al(),a=te(),n=ue(),l=_e(),r=c=>{var{node:s}=c,o=e.__rest(c,["node"]);const{collapsed:i}=(0,a.useStyles)(),{focused:f}=(0,n.useFocus)(),[m,p]=t.useState(i),v=()=>{!m&&(0,l.id)(s)===f&&p(!0)};return t.createElement(d.ObjectLayout,Object.assign({collapsed:m,onCollapserClick:()=>p(!m),onBracketClick:v,onCollapsedClick:()=>{m&&p(!1)}},o))};return Rn.JsonCrdtObjectLayout=r,Rn}var ui={},Ou;function hr(){return Ou||(Ou=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useRerenderModel=e.useRerender=e.useNodeApi=void 0;const t=M(),d=le(),a=r=>{const{model:c}=(0,d.useJsonCrdt)();return c.api.wrap(r.node)};e.useNodeApi=a;const n=r=>{const c=(0,e.useNodeApi)(r).events;return t.useSyncExternalStore(c.subscribe,c.getSnapshot)};e.useRerender=n;const l=()=>{const{model:r}=(0,d.useJsonCrdt)(),c=r.api;t.useSyncExternalStore(c.subscribe,()=>r.tick)};e.useRerenderModel=l})(ui)),ui}var Eu;function bp(){if(Eu)return xn;Eu=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.JsonCrdtValNode=void 0;const e=M(),t=Q(),d=lr(),a=le(),n=ke(),l=we(),r=fr(),c=Ke(),s=hr(),o=({node:i})=>{const{render:f}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const m=i.node.node();if(!m)return null;const p=(0,d.nodeRef)(m,i,"");if(!p)return null;const v=e.createElement("span",{className:t.line},f(p));let y="…";if(m.name()==="con"){const b=m.view();y=e.createElement(c.JsonAtom,{value:b})}return e.createElement(n.JsonCrdtRegion,{node:i},e.createElement(r.JsonCrdtObjectLayout,{node:i,property:e.createElement(l.JsonCrdtProperty,{node:i}),collapsedView:y,brackets:["(",")"]},v))};return xn.JsonCrdtValNode=o,xn}var In={},Tn={},ku;function gp(){if(ku)return Tn;ku=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.AddKey=void 0;const e=M(),t=kl(),d=ue(),a=_e(),n=le(),l=({node:r})=>{const{model:c}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),o=e.useCallback((i,f,m)=>{const p=(0,a.createValue)(c,f,m,!0);c.api.wrap(r.node).set({[i]:p})},[r.node]);return e.createElement(t.ObjectInsert,{withType:!0,visible:s,onSubmit:o})};return Tn.AddKey=l,Tn}var jn={},Pn={},Au;function yp(){if(Au)return Pn;Au=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.MiniTitle=void 0;const e=M(),t=K(),d=(0,t.rule)({...t.theme.font.sans.bold,fz:"10px",textTransform:"uppercase",col:t.theme.g(.5),pad:0,mar:0}),a=({component:n="span",style:l,onClick:r,children:c})=>e.createElement(n,{className:d,style:l,onClick:r,children:c});return Pn.MiniTitle=a,Pn}var Nu;function vp(){if(Nu)return jn;Nu=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.Tombstones=void 0;const e=M(),t=K(),d=Oe(),a=yp(),n=(0,t.rule)({d:"block",bxz:"border-box",pd:"0 4px 4px 16px",bdrad:"8px",mr:"4px 0 0 -16px",w:"calc(100% + 16px)",bg:t.theme.red(.05)}),l=(0,t.rule)({d:"block",w:"100%",bxz:"border-box",pd:"4px 8px 3px 3px",cur:"default",us:"none"}),r=({tombstones:c})=>{const[s,o]=e.useState(!1),[i]=(0,d.useT)();return c.length?e.createElement("span",{className:n},e.createElement("style",{className:l,onClick:()=>o(f=>!f)},e.createElement(a.MiniTitle,{style:{fontSize:"0.65em",color:t.theme.red(.75)}},c.length+" "+(c.length===1?i("tombstone"):i("tombstones")))),s&&c):null};return jn.Tombstones=r,jn}var xu;function wp(){if(xu)return In;xu=1,Object.defineProperty(In,"__esModule",{value:!0}),In.JsonCrdtObjNode=void 0;const e=M(),t=dr(),d=Q(),a=le(),n=lr(),l=ke(),r=we(),c=fr(),s=hr(),o=gp(),i=vp(),f=te(),m=v=>v instanceof t.ConNode&&v.val===void 0,p=({node:v})=>{const{readonly:y}=(0,f.useStyles)(),{render:b}=(0,a.useJsonCrdt)();(0,s.useRerender)(v);const u=[],h=[];return v.node.nodes((w,g)=>{if(!w)return;const _=(0,n.nodeRef)(w,v,g);if(!_)return;const C=e.createElement("span",{key:g,className:d.line},b(_));m(w)?h.push(C):u.push(C)}),e.createElement(l.JsonCrdtRegion,{node:v},e.createElement(c.JsonCrdtObjectLayout,{node:v,property:e.createElement(r.JsonCrdtProperty,{node:v}),collapsedView:!!u.length&&u.length},u,!y&&e.createElement(o.AddKey,{node:v}),!!h.length&&e.createElement(i.Tombstones,{tombstones:h})))};return In.JsonCrdtObjNode=p,In}var Mn={},qn={},Ru;function _p(){if(Ru)return qn;Ru=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.PushElement=void 0;const e=M(),t=Ii(),d=ue(),a=_e(),n=le(),l=({node:r})=>{const{model:c}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),o=e.useCallback((i,f)=>{const m=(0,a.createValue)(c,i,f,!0),p=c.api.wrap(r.node);p.set([[p.view().length,m]])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:s,onSubmit:o})};return qn.PushElement=l,qn}var Bn={},Vn={},Iu;function Zl(){if(Iu)return Vn;Iu=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.SwitchAction=void 0;const e=M(),t=K(),d=Q(),a=ur(),n=(0,t.drule)({w:"20px",h:"20px",bdrad:"50%",svg:{fill:d.blue}}),l=r=>e.createElement(a.Action,Object.assign({},r,{className:n()}),"~");return Vn.SwitchAction=l,Vn}var Tu;function Cp(){if(Tu)return Bn;Tu=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.JsonCrdtExtNode=void 0;const e=M(),t=Oe(),d=ke(),a=we(),n=fr(),l=hr(),r=Ql(),c=_e(),s=Ke(),o=Zl(),i=({node:f,onViewChange:m})=>{const[p]=(0,t.useT)();(0,l.useRerenderModel)();const y=f.node.view();return e.createElement(d.JsonCrdtRegion,{node:f,extension:!0,toolbar:e.createElement(o.SwitchAction,{onClick:m,tooltip:p('Show "vec" node')})},e.createElement(n.JsonCrdtObjectLayout,{node:f,property:e.createElement(a.JsonCrdtProperty,{node:f}),collapsedView:e.createElement(s.JsonAtom,{value:y}),brackets:["(",")"]},e.createElement(r.JsonCrdtConstant,{id:(0,c.id)(f),view:y})))};return Bn.JsonCrdtExtNode=i,Bn}var ju;function Sp(){if(ju)return Mn;ju=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.JsonCrdtVecNode=void 0;const e=M(),t=Oe(),d=Q(),a=le(),n=lr(),l=ke(),r=we(),c=fr(),s=hr(),o=_p(),i=te(),f=Cp(),m=Zl(),p=({node:v})=>{const[y]=(0,t.useT)(),[b,u]=e.useState(!1),{readonly:h}=(0,i.useStyles)(),{render:w}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const g=v.node.isExt();if(g&&!b)return e.createElement(f.JsonCrdtExtNode,{node:v,onViewChange:()=>u(!0)});const _=[];let C=0;return v.node.children(O=>{if(!O)return;const k=(0,n.nodeRef)(O,v,String(C));k&&(_.push(e.createElement("span",{key:O.id.sid+"."+O.id.time,className:d.line},w(k))),C++)}),e.createElement(l.JsonCrdtRegion,{node:v,toolbar:g?e.createElement(m.SwitchAction,{onClick:()=>u(!1),tooltip:y('Show "ext" view')}):void 0},e.createElement(c.JsonCrdtObjectLayout,{node:v,property:e.createElement(r.JsonCrdtProperty,{node:v}),collapsedView:!!_.length&&_.length,brackets:["[","]"],header:e.createElement("span",{style:{opacity:.5,display:"inline-block",margin:"0.25em 0 0 -0.3em"}},"→")},_,!h&&e.createElement(o.PushElement,{node:v})))};return Mn.JsonCrdtVecNode=p,Mn}var Jn={},Ln={},Pu;function Op(){if(Pu)return Ln;Pu=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.InsertElement=void 0;const e=M(),t=Ii(),d=ue(),a=_e(),n=le(),l=({node:r,index:c})=>{const{model:s}=(0,n.useJsonCrdt)(),o=(0,d.useIsFocused)((0,a.id)(r)),i=e.useCallback((f,m)=>{const p=(0,a.createValue)(s,f,m);s.api.wrap(r.node).ins(c,[p])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:o,onSubmit:i})};return Ln.InsertElement=l,Ln}var Mu;function Ep(){if(Mu)return Jn;Mu=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.JsonCrdtArrNode=void 0;const e=M(),t=Q(),d=le(),a=lr(),n=ke(),l=we(),r=fr(),c=hr(),s=Op(),o=te(),i=({node:f})=>{const{readonly:m}=(0,o.useStyles)(),{render:p}=(0,d.useJsonCrdt)();(0,c.useRerender)(f);const v=[];let y=0;return f.node.children(b=>{if(!b)return;const u=(0,a.nodeRef)(b,f,String(y));if(!u)return;u.step=String(y);const h=b.id.sid+"."+b.id.time+"."+y;v.push(e.createElement(e.Fragment,{key:h},!m&&e.createElement(s.InsertElement,{key:h,node:f,index:y}),e.createElement("span",{className:t.line},p(u)))),y++}),e.createElement(n.JsonCrdtRegion,{node:f},e.createElement(r.JsonCrdtObjectLayout,{node:f,property:e.createElement(l.JsonCrdtProperty,{node:f}),collapsedView:!!v.length&&v.length,brackets:["[","]"]},v,!m&&e.createElement(s.InsertElement,{key:f.node.length(),node:f,index:f.node.length()})))};return Jn.JsonCrdtArrNode=i,Jn}var Dn={},Fn={},Un={},li={},di={},qu;function kp(){return qu||(qu=1,Object.defineProperty(di,"__esModule",{value:!0})),di}var Gn={},Bu;function $l(){if(Bu)return Gn;Bu=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.Selection=void 0;let e=class{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}};return Gn.Selection=e,Gn}var Hn={},Le={},Vu;function Ju(){if(Vu)return Le;Vu=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.invokeFirstOnly=Le.applyChange=void 0;const e=(d,a,n,l)=>d.slice(0,a)+l+d.slice(a+n);Le.applyChange=e;const t=()=>{let d=!1;return a=>{if(!d){d=!0;try{a()}finally{d=!1}}}};return Le.invokeFirstOnly=t,Le}var Lu;function Ap(){if(Lu)return Hn;Lu=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.StrBinding=void 0;const e=Ju(),t=$l(),d=Ju(),a=Br();let n=class{constructor(r,c){this.str=r,this.editor=c,this.race=(0,e.invokeFirstOnly)(),this.onModelChange=()=>{this.race(()=>{this.syncFromModel(),this.saveSelection()})},this.onchange=(s,o)=>{this.race(()=>{if(s instanceof Array&&s.length>0){const i=this.str();if(!i)return;let f=!0;if(o){let m=this.view;for(let v=0;v<length;v++){const y=s[v],[b,u,h]=y;m=(0,d.applyChange)(m,b,u,h)}const p=this.editor;p.getLength&&m.length!==p.getLength()||m!==p.get()?f=!1:this.view=m}if(f){const m=s.length;try{i.api.transaction(()=>{let p=this.view;for(let v=0;v<m;v++){const y=s[v],[b,u,h]=y;p=(0,d.applyChange)(p,b,u,h),u&&i.del(b,u),h&&i.ins(b,h)}this.view=p}),this.saveSelection();return}catch{}}}this.syncFromEditor()})},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout(()=>{this.race(()=>{try{const s=this.view,o=this.editor;(o.getLength&&s.length!==o.getLength()||s!==o.get())&&this.syncFromEditor()}catch{}this._p&&this.pollChanges()})},this.pollingInterval)},this._s=null,this.bind=s=>{this.syncFromModel();const o=this.editor;o.onchange=this.onchange,o.onselection=()=>this.saveSelection(),s&&this.pollChanges(),this._s=this.str().api.onChange.listen(this.onModelChange)},this.unbind=()=>{var s,o,i;this.stopPolling(),(s=this._s)===null||s===void 0||s.call(this),(i=(o=this.editor).dispose)===null||i===void 0||i.call(o)},this.view=r().view(),c.selection=this.selection=new t.Selection}saveSelection(){var r,c,s;const{editor:o,selection:i}=this,f=this.str();if(!f)return;const[m,p,v]=((r=o.getSelection)===null||r===void 0?void 0:r.call(o))||[-1,-1,0],{start:y,end:b}=i,u=Date.now(),h=f.api.model.tick;y===m&&b===p&&(h===i.tick||u-i.ts<3e3)||(i.start=m,i.end=p,i.dir=v,i.ts=u,i.tick=h,i.startId=typeof m=="number"&&(c=f.findId((m??0)-1))!==null&&c!==void 0?c:null,i.endId=typeof p=="number"&&(s=f.findId((p??0)-1))!==null&&s!==void 0?s:null)}syncFromModel(){const r=this.editor,c=this.str();if(!c)return;const s=(this.view=c.view())||"";if(r.ins&&r.del){const o=r.get();if(s===o)return;const i=(0,a.diff)(o,s),f=i.length;let m=0;for(let p=0;p<f;p++){const v=i[p],[y,b]=v,u=b.length;switch(y){case-1:r.del(m,u);break;case 0:m+=u;break;case 1:r.ins(m,b),m+=u;break}}}else{r.set(s);const{selection:o}=this;if(r.setSelection){const i=o.startId?c.findPos(o.startId)+1:-1,f=o.endId?c.findPos(o.endId)+1:-1;r.setSelection(i,f,o.dir)}}}syncFromEditor(){var r;let c=this.view;const s=this.editor.get();if(s===c)return;const o=this.selection,i=o.start===o.end&&(r=o.start)!==null&&r!==void 0?r:void 0,f=(0,a.diffEdit)(c,s,i||0),m=f.length,p=this.str();p&&(p.api.transaction(()=>{let v=0;for(let y=0;y<m;y++){const b=f[y],[u,h]=b;switch(u){case-1:{c=(0,d.applyChange)(c,v,h.length,""),p.del(v,h.length);break}case 0:{v+=h.length;break}case 1:{c=(0,d.applyChange)(c,v,0,h),p.ins(v,h),v+=h.length;break}}}}),this.view=c,this.saveSelection())}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}};return Hn.StrBinding=n,n.bind=(l,r,c)=>{const s=new n(l,r);return s.syncFromModel(),s.bind(c),s.unbind},Hn}var Du;function Np(){return Du||(Du=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(kp(),e),t.__exportStar($l(),e),t.__exportStar(Ap(),e)})(li)),li}var zn={},Fu;function xp(){if(Fu)return zn;Fu=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.InputEditor=void 0;let e=class{constructor(d,a){this.str=d,this.input=a,this.onInput=n=>{this.emitChange(n)},this.onSelectionChange=()=>{this.onselection()},a.addEventListener("input",this.onInput),document.addEventListener("selectionchange",this.onSelectionChange)}get(){return this.input.value}getLength(){return this.input.value.length}set(d){this.input.value=d}ins(d,a){const n=this.getSelection(),l=this.get(),r=l.slice(0,d)+a+l.slice(d);if(this.set(r),n){let[c,s]=n;const o=a.length;c>=d&&(c+=o),s>d&&(s+=o),this.setSelection(c,s,n[2])}}del(d,a){const n=this.getSelection(),l=this.get(),r=l.slice(0,d)+l.slice(d+a);if(this.set(r),n){let[c,s]=n;c>=d&&(c=Math.max(d,c-a)),s>=d&&(s=Math.max(d,s-a)),this.setSelection(c,s,n[2])}}getSelection(){const d=this.input,{selectionStart:a,selectionEnd:n,selectionDirection:l}=d;return[typeof a=="number"?a:-1,typeof n=="number"?n:-1,l==="backward"?-1:l==="forward"?1:0]}setSelection(d,a,n){const l=this.input;l.selectionStart=d>-1?d:null,l.selectionEnd=a>-1?a:null,l.selectionDirection=n===-1?"backward":n===1?"forward":"none"}emitChange(d){var a,n;if(!d.isComposing){switch(d.inputType){case"insertText":{const l=d.data;if(!l||l.length!==1)break;const{selectionStart:r,selectionEnd:c}=this.input;if(r===null||c===null||r!==c||r<=0)break;const s=this.selection;if(r-l.length!==s.start||typeof s.end!="number"||typeof s.end!="number")break;const o=s.end-s.start,i=[s.start,o,l];this.onchange([i]);return}case"deleteContentBackward":{const{start:l,end:r}=this.selection;if(typeof l!="number"||typeof r!="number")break;const c=l===r?[l-1,1,""]:[l,r-l,""];this.onchange([c]);return}case"deleteContentForward":{const{start:l,end:r}=this.selection;if(typeof l!="number"||typeof r!="number")break;const c=l===r?[l,1,""]:[l,r-l,""];this.onchange([c]);return}case"deleteByCut":{const{start:l,end:r}=this.selection;if(typeof l!="number"||typeof r!="number"||l===r)break;const c=Math.min(l,r),s=Math.max(l,r),o=this.str().view(),f=this.input.value;if(o.length-f.length!==s-c)break;const m=[c,s-c,""];this.onchange([m]);return}case"insertFromPaste":{const{start:l,end:r}=this.selection;if(typeof l!="number"||typeof r!="number")break;const c=Math.min(l,r),s=Math.max(l,r),o=this.str().view(),i=this.input,f=i.value,m=Math.max((a=i.selectionStart)!==null&&a!==void 0?a:0,(n=i.selectionEnd)!==null&&n!==void 0?n:0);if(m<=c)break;const p=s-c,v=f.slice(c,m);if(f.length!==o.length-p+v.length)return;const y=[c,p,v];this.onchange([y]);return}}this.onchange()}}dispose(){this.input.removeEventListener("input",this.onInput),document.removeEventListener("selectionchange",this.onSelectionChange)}};return zn.InputEditor=e,zn}var Uu;function Rp(){if(Uu)return Un;Uu=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.bind=void 0;const e=Np(),t=xp(),d=(a,n,l)=>{const r=new t.InputEditor(a,n),c=new e.StrBinding(a,r);return c.syncFromModel(),c.bind(l),c.unbind};return Un.bind=d,Un}var Wn={},Gu;function Ip(){if(Gu)return Wn;Gu=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.SubmitAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"→");return Wn.SubmitAction=d,Wn}var Hu;function Tp(){if(Hu)return Fn;Hu=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.StrEdit=void 0;const e=M(),t=K(),d=Rp(),a=ar(),n=Oe(),l=Q(),r=Ni(),c=Ir(),s=Tr(),o=Ip(),i=le(),f=({node:m,onCancel:p,onDone:v})=>{const[y]=(0,n.useT)(),b=e.useRef(),{model:u}=(0,i.useJsonCrdt)(),[h,w]=e.useMemo(()=>{const O=u.clone();O.api.flush();const k=O.index.get(m.node.id),S=O.api.wrap(k);return[O,S]},[]),g=e.useSyncExternalStore(w.events.subscribe,w.events.getSnapshot);e.useEffect(()=>{if(!b.current)return;const O=(0,d.bind)(()=>w,b.current);return()=>{O()}},[u]);const _=()=>{if(!!h.api.builder.patch.ops.length){const k=h.api.flush();u.applyLocalPatch(k)}v()},C=(0,c.inputStyle)(t.theme,!t.theme.isLight,'""');return C.margin="-3px -3px -3px -5px",C.padding="2px 4px",C.border=`1px solid ${t.theme.g(.85)}`,e.createElement("span",{className:l.input,style:C},e.createElement(a.FlexibleInput,{focus:!0,inp:O=>{b.current=O},value:g,multiline:!0,uncontrolled:!0,typebefore:'"',typeahead:'"',maxWidth:800,onSubmit:_,onFocus:O=>(0,r.selectOnFocus)(O.target),onCancel:()=>{p&&p()}}),e.createElement(s.CancelAction,{onClick:p,tooltip:y("Cancel")}),e.createElement("span",{className:l.bottomRightActionPos},e.createElement(o.SubmitAction,{onClick:_,tooltip:y("Done (Ctrl + Enter)")})))};return Fn.StrEdit=f,Fn}var zu;function jp(){if(zu)return Dn;zu=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.JsonCrdtStrNode=void 0;const e=M(),t=K(),d=Oe(),a=ke(),n=we(),l=Ke(),r=te(),c=ue(),s=_e(),o=Q(),i=Tp(),f=(0,t.rule)({d:"inline-block",pos:"relative",cur:"pointer",bdrad:"2px"}),m=(0,t.rule)({out:"1px dotted transparent","&:hover":{out:`1px dotted ${t.theme.color.sem.blue[0]}`},[`&:hover .${o.tooltip.trim()}`]:{d:"inline-block"}}),p=({node:v})=>{const[y]=(0,d.useT)(),{formal:b,readonly:u}=(0,r.useStyles)(),{focused:h}=(0,c.useFocus)(),[w,g]=e.useState(!1),_=h===(0,s.id)(v);return e.createElement(a.JsonCrdtRegion,{node:v,editing:w},e.createElement(n.JsonCrdtProperty,{node:v}),w?e.createElement(i.StrEdit,{node:v,onCancel:()=>g(!1),onDone:()=>g(!1)}):e.createElement("span",{className:f+(_&&!u?m:""),onClick:_&&!u?()=>g(!0):void 0},e.createElement(l.JsonAtom,{value:v.node.view()}),!u&&e.createElement("span",{className:o.tooltip},y("Edit"))),!!b&&",")};return Dn.JsonCrdtStrNode=p,Dn}var Kn={},Wu;function Pp(){if(Wu)return Kn;Wu=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.JsonCrdtBinNode=void 0;const e=M(),t=ke(),d=we(),a=Ke(),n=te(),l=({node:r})=>{const{formal:c}=(0,n.useStyles)();return e.createElement(t.JsonCrdtRegion,{node:r},e.createElement(d.JsonCrdtProperty,{node:r}),e.createElement(a.JsonAtom,{value:r.node.view()}),!!c&&",")};return Kn.JsonCrdtBinNode=l,Kn}var Ku;function Mp(){if(Ku)return Nt;Ku=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.ClickableJsonCrdt=void 0;const e=M(),t=le(),d=te(),a=lr(),n=Nl(),l=ue(),r=dr(),c=mp(),s=bp(),o=wp(),i=Sp(),f=Ep(),m=jp(),p=Pp(),v=b=>b.node instanceof r.ConNode?e.createElement(c.JsonCrdtConNode,{node:b}):b.node instanceof r.ValNode?e.createElement(s.JsonCrdtValNode,{node:b}):b.node instanceof r.ObjNode?e.createElement(o.JsonCrdtObjNode,{node:b}):b.node instanceof r.StrNode?e.createElement(m.JsonCrdtStrNode,{node:b}):b.node instanceof r.VecNode?e.createElement(i.JsonCrdtVecNode,{node:b}):b.node instanceof r.ArrNode?e.createElement(f.JsonCrdtArrNode,{node:b}):b.node instanceof r.BinNode?e.createElement(p.JsonCrdtBinNode,{node:b}):"∅",y=b=>{const{model:u,compact:h,readonly:w,showRoot:g,onFocus:_}=b,[C,O]=e.useState(0);e.useEffect(()=>{const S=u.api.onReset.listen(()=>O(E=>E+1));return()=>S()},[u]);const k=e.useMemo(()=>(0,a.nodeRef)(g?u.root:u.root.node(),null,""),[u,C]);return e.createElement(d.context.Provider,{value:{compact:h,readonly:w}},e.createElement(t.context.Provider,{value:{model:u,render:v}},e.createElement(l.FocusProvider,{onFocus:_},!!k&&e.createElement(n.Root,{key:C},v(k)))))};return Nt.ClickableJsonCrdt=y,Nt}var Yu;function qp(){return Yu||(Yu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(xl(),e),t.__exportStar(Mp(),e)})(Yr)),Yr}var Bp=qp();function wi({gridSessionId:e,usersReplicaId:t,chatbotName:d="Grid Assistant",initialMessage:a,open:n,onClose:l,agentRegistrationId:r}){const[c,s]=P.useState(),o=Hd(c),i={concreteType:"org.sagebionetworks.repo.model.agent.GridAgentSessionContext",gridSessionId:e,usersReplicaId:t};return j.jsx(cf,{open:n,onClose:l,title:d,children:j.jsx(zd,{agentRegistrationId:r,chatbotName:d,initialMessage:a,sessionContext:i,textboxPositionOffset:"16px",hideTitle:!0,showAccessLevelMenu:!1,defaultAgentAccessLevel:Ld.WRITE_YOUR_PRIVATE_DATA,externalSession:c,setExternalSession:s,externalChatState:o})})}try{wi.displayName="GridAgentChat",wi.__docgenInfo={description:"",displayName:"GridAgentChat",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},usersReplicaId:{defaultValue:null,description:"",name:"usersReplicaId",required:!0,type:{name:"number"}},chatbotName:{defaultValue:{value:"Grid Assistant"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},agentRegistrationId:{defaultValue:null,description:"Optional ID to use a different agent registered in Synapse",name:"agentRegistrationId",required:!1,type:{name:"string"}}}}}catch{}function Sr(e,t){switch(e.type){case"CREATE":return t==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const d=t==="undo"?e.previousValue:e.newValue;return d?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:d}:null}case"DELETE":return t==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function Er(e=[],t){const[d,a]=P.useState(e),n=P.useCallback(o=>{a(i=>{const f=[...i,o];return t&&f.length>t&&f.shift(),f})},[t]),l=P.useCallback(()=>{if(d.length===0)return;const o=d[d.length-1];return a(i=>i.slice(0,-1)),o},[d]),r=P.useCallback(()=>d[d.length-1],[d]),c=P.useCallback(()=>{a([])},[]),s=P.useCallback(()=>d.length===0,[d]);return{stack:d,push:n,pop:l,clear:c,peek:r,size:d.length,isEmpty:s}}try{Er.displayName="useStack",Er.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}function _i(e){return{type:"COMPOSITE",actions:e}}const Vp=100,Jp=100;function Ci(e){const t=Er([],Vp),d=Er([],Jp),[a,n]=P.useState(null),[l,r]=P.useState(null),c=!!a,s=!!l,o=S=>{n(S.currentTarget)},i=S=>{r(S.currentTarget)},f=()=>n(null),m=()=>r(null),p=P.useCallback(()=>{if(t.isEmpty())return null;const S=t.peek();let E,A=0;if(S.type==="COMPOSITE"){E="COMPOSITE";for(let N=t.stack.length-1;N>=0&&t.stack[N].type==="COMPOSITE";N--)A++}else{E=S.type;for(let N=t.stack.length-1;N>=0&&t.stack[N].type===E;N--)A++}return{lastType:E,sameTypeCount:A,totalActions:t.size}},[t]),v=P.useCallback(()=>{if(d.isEmpty())return null;const S=d.peek();let E,A=0;if(S.type==="COMPOSITE")E="COMPOSITE",A=1;else{E=S.type;for(let N=d.stack.length-1;N>=0&&d.stack[N].type===E;N--)A++}return{lastType:E,sameTypeCount:A,totalActions:d.size}},[d]),y=p(),b=v(),u=P.useCallback(()=>{if(t.isEmpty())return;const S=t.pop();if(S)if(S.type==="COMPOSITE"){for(let E=S.actions.length-1;E>=0;E--){const A=S.actions[E],N=Sr(A,"undo");N&&e(N)}d.push(S)}else{const E=Sr(S,"undo");if(!E)return;e(E),d.push(S)}f()},[e,t,d]),h=P.useCallback(()=>{if(d.isEmpty())return;const S=d.pop();if(S)if(S.type==="COMPOSITE"){for(let E=0;E<S.actions.length;E++){const A=S.actions[E],N=Sr(A,"redo");N&&e(N)}t.push(S)}else{const E=Sr(S,"redo");if(!E)return;e(E),t.push(S)}m()},[d,t,e]);P.useEffect(()=>{const S=E=>{E.ctrlKey&&E.key==="z"&&!E.shiftKey||E.metaKey&&E.key==="z"&&!E.shiftKey?(E.preventDefault(),u()):(E.ctrlKey&&E.key==="y"||E.ctrlKey&&E.shiftKey&&E.key==="z"||E.metaKey&&E.shiftKey&&E.key==="z")&&(E.preventDefault(),h())};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[u,h]);const w=S=>{t.push(S)},g=()=>t.clear(),_=()=>d.clear(),C=(S,E,A)=>{_();const N=[];for(const x of S){const I=x.fromRowIndex,R=x.toRowIndex;if(x.type==="CREATE")for(let T=I;T<R;T++){const q=A[T];N.push({type:"CREATE",rowIndex:T,newValue:q})}if(x.type==="UPDATE"){const T=E.slice(I,R);A.slice(I,R).forEach((B,J)=>{const D=T[J],U=I+J;N.push({type:"UPDATE",rowIndex:U,previousValue:D,newValue:B})})}x.type==="DELETE"&&E.slice(I,R).forEach((q,B)=>{N.push({type:"DELETE",rowIndex:I+B,previousValue:q})})}N.length===1?w(N[0]):N.length>1&&w(_i(N))},O=j.jsxs(j.Fragment,{children:[j.jsxs(Ue,{variant:"outlined","aria-controls":c?"undo-menu":void 0,"aria-haspopup":"true",onClick:o,disabled:!y,endIcon:j.jsx(Wi,{}),children:["Undo ",y&&`(${y.totalActions})`]}),j.jsx(Gi,{id:"undo-menu",anchorEl:a,open:c,onClose:f,children:y?j.jsxs(sr,{onClick:u,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(sr,{disabled:!0,children:"No actions to undo"})})]}),k=j.jsxs(j.Fragment,{children:[j.jsxs(Ue,{variant:"outlined","aria-controls":s?"redo-menu":void 0,"aria-haspopup":"true",onClick:i,disabled:!b,endIcon:j.jsx(Wi,{}),children:["Redo ",b&&`(${b.totalActions})`]}),j.jsx(Gi,{id:"redo-menu",anchorEl:l,open:s,onClose:m,children:b?j.jsxs(sr,{onClick:h,children:["Redo last ",b.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(sr,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:u,addToUndoStack:w,clearUndoStack:g,addOperationsToUndoStack:C,undoUI:O,undoTotalActions:y?y.totalActions:0,redoPreview:b,redoUI:k,redoTotalActions:b?b.totalActions:0,handleRedo:h,clearRedoStack:_}}try{_i.displayName="batchGridActions",_i.__docgenInfo={description:"Helper to batch multiple single actions into a composite action",displayName:"batchGridActions",props:{}}}catch{}try{Ci.displayName="useGridUndoRedo",Ci.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}function Si(e){const{inputValue:t,onInputValueChange:d,onConfirmInput:a=ve,onSessionChange:n=ve,onReplicaChange:l=ve}=e,{data:r}=af({}),{mutate:c}=uf({onSuccess:(o,i)=>{ye(`Successfully deleted grid session ${i}`,"success"),n(null),l(null)},onError:o=>{ye(o.reason,"danger")}}),s=P.useMemo(()=>r?.pages.flatMap(o=>o.page||[])||[],[r]);return j.jsx(ff,{freeSolo:!0,fullWidth:!0,renderInput:o=>j.jsx(Dd,{...o,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:s,getOptionLabel:o=>typeof o=="string"?o:o.sessionId||"",value:t,onInputChange:(o,i)=>{d(i)},onChange:(o,i)=>{i&&typeof i=="object"?(d(i.sessionId||""),a(i.sessionId||"")):d(i||"")},onKeyDown:o=>{o.key==="Enter"&&a(t)},renderOption:(o,i)=>P.createElement(sr,{...o,key:i.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs(ee,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx(ee,{size:{xs:6,md:2},children:i.sessionId}),j.jsx(ee,{size:{xs:5,md:2},children:i.sourceEntityId}),j.jsx(ee,{size:{xs:0,md:6},children:i.gridJsonSchema$Id??"No schema"}),j.jsx(ee,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:f=>{f.stopPropagation(),c(i.sessionId)},children:"🗑️"})})]}))})}try{Si.displayName="GridSessionSelectionField",Si.__docgenInfo={description:"Utility form field to pick the grid session from existing sessions. Currently, for testing/demo purposes only.",displayName:"GridSessionSelectionField",props:{inputValue:{defaultValue:null,description:"",name:"inputValue",required:!0,type:{name:"string"}},onInputValueChange:{defaultValue:null,description:"",name:"onInputValueChange",required:!0,type:{name:"(value: string) => void"}},onConfirmInput:{defaultValue:null,description:"",name:"onConfirmInput",required:!1,type:{name:"(value: string) => void"}},onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}}}}}catch{}function Lp(){const{mutateAsync:e}=df(),{synapseClient:t}=We();return be({mutationFn:async({createGridRequest:d,sessionId:a})=>{if(!(d||a))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(d){const n=await e(d);return console.log("Grid session started:",n),n.gridSession}return console.log(`Joining existing session ID: ${a}`),await t.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:a})}})}function Dp(e){const{mutateAsync:t}=Lp(),{mutateAsync:d}=lf();return be({...e,mutationFn:async({createGridRequest:a,sessionId:n})=>{if(!(a||n))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const l=await t({createGridRequest:a,sessionId:n}),r=l.sessionId;try{const c=await d(r);console.log("Replica created:",c);const s=c.replica;return{session:l,replica:s}}catch(c){throw new Error("Error starting session:",{cause:c})}}})}const Oi=P.forwardRef((e,t)=>{const{show:d=!1,onSessionChange:a=ve,onReplicaChange:n=ve}=e,[l,r]=P.useState(""),{mutate:c}=Dp({onMutate(o){console.debug("Starting grid session with args:",o)},onSuccess({session:o,replica:i}){a(o),n(i.replicaId)},onError(o){const i=o&&typeof o=="object"&&"message"in o&&typeof o.message=="string"?o.message:"An error occurred";ye(i,"danger")}}),s=function(o){c(Fp(o))};return P.useImperativeHandle(t,()=>({handleStartSession:o=>{c({createGridRequest:o})},handleLoadSession:o=>{c({sessionId:o})}}),[c]),d?j.jsxs(ee,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx(ee,{size:{xs:12},sx:{position:"relative"},children:j.jsx(Si,{inputValue:l,onInputValueChange:r,onConfirmInput:s,onSessionChange:a,onReplicaChange:n})}),j.jsx(ee,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(ll,{color:"primary",variant:"contained",onClick:()=>{s(l)},children:"Start Grid Session"})})]}):null});function Fp(e){const t=Zd(e);if(t.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query, Synapse ID, or session ID.");switch(t.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:t.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:t.input};case"recordSetId":return{createGridRequest:{recordSetId:t.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{Oi.displayName="StartGridSession",Oi.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function Up(e){const t=P.useMemo(()=>e?e.api.subscribe:()=>ve,[e]),d=P.useCallback(()=>e?e.api.getSnapshot():null,[e]);return P.useSyncExternalStore(t,d)}function Gp(){const{synapseClient:e}=We();return be({mutationFn:async({sessionId:t,replicaId:d})=>{const{presignedUrl:a}=await e.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:t,createGridPresignedUrlRequest:{gridSessionId:t,replicaId:d}});return a}})}class pr{typeCode;constructor(t){this.typeCode=t}getJson(){throw new Error("Method should be implemented by subclass.")}}const ed=8;class td extends pr{methodName;payload;getMethodName(){return this.methodName}getPayload(){return this.payload}constructor(t,d){super(ed),this.methodName=t,this.payload=d}getJson(){const t=[this.typeCode,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const nd=0;class Hp extends pr{requestId;methodName;payload;constructor(t,d,a){super(nd),this.requestId=t,this.methodName=d,this.payload=a}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const rd=4;class sd extends pr{subscriptionId;payload;getPayload(){return this.payload}constructor(t,d){super(rd),this.subscriptionId=t,this.payload=d}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const id=5;class od extends pr{subscriptionId;payload;getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}constructor(t,d){super(id),this.subscriptionId=t,this.payload=d}getJson(){const t=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&t.push(this.payload),t}}const cd=1;class or extends pr{requestId;methodName;payload;constructor(t,d,a){super(cd),this.requestId=t,this.methodName=d,this.payload=a}setRequestId(t){this.requestId=t}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}class zp{static fromJson(t){if(!Array.isArray(t))throw new Error("Invalid JSON-Rx message: not an array");const d=t[0];if(typeof d!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${d}`);switch(d){case nd:{const[a,n,l,r]=t;return new Hp(n,l,r)}case cd:{const[a,n,l,r]=t;return new or(n,l,r)}case rd:{const[a,n,l]=t;return new sd(n,l)}case id:{const[a,n,l]=t;return new od(n,l)}case ed:{const[a,n,l]=t;return new td(n,l)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${d}`)}}}const Wp=Math.pow(2,31)-1;class Kp{counter;constructor(){this.counter=1}getNext(){const t=this.counter;return this.counter+=1,this.counter>Wp&&(this.counter=1),t}}var fi={},hi={},Xu;function Yp(){return Xu||(Xu=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var Yn={},Xn={},De={},Qu;function Vr(){return Qu||(Qu=1,Object.defineProperty(De,"__esModule",{value:!0}),De.hasBuffer=De.alphabet=void 0,De.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",De.hasBuffer=typeof ae.Buffer=="function"&&typeof ae.Buffer.from=="function"),De}var Qn={},Zn={},Zu;function Xp(){if(Zu)return Zn;Zu=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.flatstr=void 0;const e=t=>t;return Zn.flatstr=e,Zn}var $u;function Qp(){if($u)return Qn;$u=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.createToBase64=void 0;const e=Xp(),t=Vr(),d=(a=t.alphabet,n="=")=>{if(a.length!==64)throw new Error("chars must be 64 characters long");const l=a.split(""),r=[];for(const o of l)for(const i of l){const f=(0,e.flatstr)(o+i);r.push(f)}const c=n,s=(0,e.flatstr)(n+n);return(o,i)=>{let f="";const m=i%3,p=i-m;for(let v=0;v<p;v+=3){const y=o[v],b=o[v+1],u=o[v+2],h=y<<4|b>>4,w=(b&15)<<8|u;f+=r[h]+r[w]}if(!m)return f;if(m===1){const v=o[p];f+=r[v<<4]+s}else{const v=o[p],y=o[p+1],b=v<<4|y>>4,u=(y&15)<<2;f+=r[b]+l[u]+c}return f}};return Qn.createToBase64=d,Qn}var el;function ad(){if(el)return Xn;el=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.toBase64=void 0;const e=Vr(),d=(0,Qp().createToBase64)();return Xn.toBase64=e.hasBuffer?a=>{const n=a.length;return n<=48?d(a,n):ae.Buffer.from(a).toString("base64")}:a=>d(a,a.length),Xn}var tl;function Zp(){if(tl)return Yn;tl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.encode=void 0;const t=L.__importStar(Ye()),d=z(),a=ad(),n=(c,s)=>{const o=s.sid;return o===c?s.time:[o,s.time]},l=(c,s)=>{const o=n(c,s);return Array.isArray(o)?(o.push(s.span),o):[o,s.span]},r=c=>{const s=c.getId();if(!s)throw new Error("PATCH_EMPTY");const o=s.sid,i=s.time,f=o===1?[i]:[[o,i]],m=c.meta;m!==void 0&&f.push(m);const p=[f];for(const v of c.ops)if(v instanceof t.NewConOp){const y=v.val;y instanceof d.Timestamp?p.push([0,n(o,y),!0]):y===void 0?p.push([0]):p.push([0,y])}else if(v instanceof t.NewValOp)p.push([1]);else if(v instanceof t.NewObjOp)p.push([2]);else if(v instanceof t.NewVecOp)p.push([3]);else if(v instanceof t.NewStrOp)p.push([4]);else if(v instanceof t.NewBinOp)p.push([5]);else if(v instanceof t.NewArrOp)p.push([6]);else if(v instanceof t.InsValOp)p.push([9,n(o,v.obj),n(o,v.val)]);else if(v instanceof t.InsObjOp){const y=[];for(const[u,h]of v.data)y.push([u,n(o,h)]);const b=[10,n(o,v.obj),y];p.push(b)}else if(v instanceof t.InsVecOp){const y=[];for(const[u,h]of v.data)y.push([u,n(o,h)]);const b=[11,n(o,v.obj),y];p.push(b)}else if(v instanceof t.InsStrOp){const y=[12,n(o,v.obj),n(o,v.ref),v.data];p.push(y)}else if(v instanceof t.InsBinOp){const y=[13,n(o,v.obj),n(o,v.ref),(0,a.toBase64)(v.data)];p.push(y)}else if(v instanceof t.InsArrOp){const y=[];for(const u of v.data)y.push(n(o,u));const b=[14,n(o,v.obj),n(o,v.ref),y];p.push(b)}else if(v instanceof t.UpdArrOp){const y=[15,n(o,v.obj),n(o,v.ref),n(o,v.val)];p.push(y)}else if(v instanceof t.DelOp){const y=[16,n(o,v.obj),v.what.map(b=>l(o,b))];p.push(y)}else if(v instanceof t.NopOp){const y=[17],b=v.len;b>1&&y.push(b),p.push(y)}return p};return Yn.encode=r,Yn}var $n={},er={},tr={},nl;function $p(){if(nl)return tr;nl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.bufferToUint8Array=void 0;const e=t=>new Uint8Array(t.buffer,t.byteOffset,t.length);return tr.bufferToUint8Array=e,tr}var nr={},rl;function em(){if(rl)return nr;rl=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.createFromBase64=void 0;const e=Vr(),t="=",d=(a=e.alphabet,n=!1)=>{if(a.length!==64)throw new Error("chars must be 64 characters long");let l=0;for(let c=0;c<a.length;c++)l=Math.max(l,a.charCodeAt(c));const r=[];for(let c=0;c<=l;c+=1)r[c]=-1;for(let c=0;c<a.length;c++)r[a.charCodeAt(c)]=c;return c=>{if(!c)return new Uint8Array(0);let s=c.length;if(n){const y=s%4;y===2?(c+="==",s+=2):y===3&&(c+="=",s+=1)}if(s%4!==0)throw new Error("Base64 string length must be a multiple of 4");const o=c[s-1]!==t?s:s-4;let i=(s>>2)*3,f=0;c[s-2]===t?(f=2,i-=2):c[s-1]===t&&(f=1,i-=1);const m=new Uint8Array(i);let p=0,v=0;for(;v<o;v+=4){const y=r[c.charCodeAt(v)],b=r[c.charCodeAt(v+1)],u=r[c.charCodeAt(v+2)],h=r[c.charCodeAt(v+3)];if(y<0||b<0||u<0||h<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4,m[p+1]=b<<4|u>>2,m[p+2]=u<<6|h,p+=3}if(f===2){const y=r[c.charCodeAt(o)],b=r[c.charCodeAt(o+1)];if(y<0||b<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4}else if(f===1){const y=r[c.charCodeAt(o)],b=r[c.charCodeAt(o+1)],u=r[c.charCodeAt(o+2)];if(y<0||b<0||u<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4,m[p+1]=b<<4|u>>2}return m}};return nr.createFromBase64=d,nr}var sl;function tm(){if(sl)return er;sl=1,Object.defineProperty(er,"__esModule",{value:!0}),er.fromBase64=void 0;const e=$p(),t=Vr(),d=em(),a=t.hasBuffer?l=>(0,e.bufferToUint8Array)(ae.Buffer.from(l,"base64")):null,n=(0,d.createFromBase64)();return er.fromBase64=a?l=>l.length>48?a(l):n(l):n,er}var il;function nm(){if(il)return $n;il=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.decode=void 0;const e=tm(),t=z(),d=Mr(),a=(r,c)=>Array.isArray(c)?new t.Timestamp(c[0],c[1]):new t.Timestamp(r,c),n=(r,c)=>c.length===3?new t.Timespan(c[0],c[1],c[2]):new t.Timespan(r,c[0],c[1]),l=r=>{const c=r[0],s=c[0],o=Array.isArray(s)?new t.ClockVector(s[0],s[1]):new t.ServerClockVector(1,s),i=o.sid;o.time;const f=new d.PatchBuilder(o),m=r.length;for(let v=1;v<m;v++){const y=r[v];switch(y[0]){case 0:{const[,b,u]=y;f.con(u?a(i,b):b);break}case 1:{f.val();break}case 2:{f.obj();break}case 3:{f.vec();break}case 4:{f.str();break}case 5:{f.bin();break}case 6:{f.arr();break}case 9:{f.setVal(a(i,y[1]),a(i,y[2]));break}case 10:{const b=a(i,y[1]),u=[],h=y[2],w=h.length;for(let g=0;g<w;g++){const[_,C]=h[g];u.push([_,a(i,C)])}f.insObj(b,u);break}case 11:{const b=a(i,y[1]),u=[],h=y[2],w=h.length;for(let g=0;g<w;g++){const[_,C]=h[g];u.push([_,a(i,C)])}f.insVec(b,u);break}case 12:{f.insStr(a(i,y[1]),a(i,y[2]),y[3]);break}case 13:{f.insBin(a(i,y[1]),a(i,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const b=a(i,y[1]),u=a(i,y[2]),h=y[3],w=[],g=h.length;for(let _=0;_<g;_++)w.push(a(i,h[_]));f.insArr(b,u,w);break}case 15:{const b=a(i,y[1]),u=a(i,y[2]),h=a(i,y[3]);f.updArr(b,u,h);break}case 16:{const b=a(i,y[1]),u=y[2],h=[],w=u.length;for(let g=0;g<w;g++)h.push(n(i,u[g]));f.del(b,h);break}case 17:{f.nop(y[1]||1);break}}}const p=f.patch;return p.meta=c[1],p};return $n.decode=l,$n}var ol;function rm(){return ol||(ol=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Yp(),e),t.__exportStar(Zp(),e),t.__exportStar(nm(),e)})(fi)),fi}var kr=rm();function cl(e){return new TextEncoder().encode(JSON.stringify(e)).length}function sm(e){const t=kr.decode(e),d=t.getId(),a=t.span();return[[d?.sid,d.time+a]]}function im(e,t){if(!e.ops||e.ops.length===0)return[];const d=kr.encode(e),a=cl(d);if(a<=t)return[d];if(e.ops.length==1)return console.warn(`Patch is too large (${a} B) but cannot be split further since it only contains one operation.`),[d];const n=d[0],l=[];let r=[n];for(let c=1;c<d.length;c+=1){const s=r.length-1;cl([...r,d[c]])>t&&s>0&&(l.push(r),r=[sm(r)]),r.push(d[c])}return r.length>1&&l.push(r),l}var om=dr(),rr={},al;function cm(){if(al)return rr;al=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.Encoder=void 0;const t=L.__importStar(Ee()),d=ad(),a=z();let n=class{encode(r){this.model=r;const c=r.clock;return{time:c.sid===1?c.time:this.cClock(r.clock),root:this.cVal(r.root)}}cClock(r){const c=[],s=r.sid;r.peers.get(s)||c.push([s,r.time]);for(const i of r.peers.values())c.push([i.sid,i.time]);return c}cTs(r){return r.sid===1?r.time:[r.sid,r.time]}cNode(r){if(r instanceof t.ObjNode)return this.cObj(r);if(r instanceof t.ArrNode)return this.cArr(r);if(r instanceof t.StrNode)return this.cStr(r);if(r instanceof t.ValNode)return this.cVal(r);if(r instanceof t.ConNode)return this.cCon(r);if(r instanceof t.BinNode)return this.cBin(r);if(r instanceof t.VecNode)return this.cVec(r);throw new Error("UNKNOWN_NODE")}cObj(r){const c={};return r.nodes((s,o)=>{c[o]=this.cNode(s)}),{type:"obj",id:this.cTs(r.id),map:c}}cVec(r){const c=[],s=r.elements,o=s.length,i=this.model.index;for(let f=0;f<o;f++){const m=s[f];m===void 0?c.push(null):c.push(this.cNode(i.get(m)))}return{type:"vec",id:this.cTs(r.id),map:c}}cArr(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cArrChunk(o));return{type:"arr",id:this.cTs(r.id),chunks:c}}cArrChunk(r){if(r.del)return{id:this.cTs(r.id),span:r.span};const c=this.model.index;return{id:this.cTs(r.id),value:r.data.map(o=>this.cNode(c.get(o)))}}cStr(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cStrChunk(o));return{type:"str",id:this.cTs(r.id),chunks:c}}cStrChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:r.data}}cBin(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cBinChunk(o));return{type:"bin",id:this.cTs(r.id),chunks:c}}cBinChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:(0,d.toBase64)(r.data)}}cVal(r){return{type:"val",id:this.cTs(r.id),value:this.cNode(r.node())}}cCon(r){const c={type:"con",id:this.cTs(r.id)},s=r.val;return s instanceof a.Timestamp?(c.timestamp=!0,c.value=this.cTs(s)):s!==void 0&&(c.value=s),c}};return rr.Encoder=n,rr}var am=cm();const um=30*1024,lm=250;class dm{socket;model=null;messageCounter;replicaId;verboseEncoder=new am.Encoder;maxPayloadSizeBytes;throttledSendPatch;onModelCreate=ve;onGridReady=ve;onStatusChange=ve;constructor(t){const{replicaId:d,url:a,onGridReady:n,onStatusChange:l,onModelCreate:r,maxPayloadSizeBytes:c,socket:s,model:o,patchThrottleMs:i}=t;this.messageCounter=new Kp,this.replicaId=d,this.maxPayloadSizeBytes=c??um,this.socket=s??new WebSocket(a),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=f=>{typeof f.data=="string"?this.handleMessage(f.data):console.error("Received non-string message data:",f.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=f=>{console.error("WebSocket error:",f)},r&&(this.onModelCreate=r),n&&(this.onGridReady=n),l&&(this.onStatusChange=l),this.model=o||null,this.throttledSendPatch=vf(()=>this.sendPatchImmediate(),i??lm,{leading:!1,trailing:!0})}disconnect(){this.throttledSendPatch.flush(),this.throttledSendPatch.cancel(),this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}messageHandler=t=>{if(t instanceof sd){const d=t.getPayload();try{const a=kr.decode(d);this.model?(console.debug("Applying patch from server:",a),this.model?.applyPatch(a)):(console.debug("Initializing new model from patch:"),console.debug(a.toString()),this.model=om.Model.fromPatches([a]).fork(this.replicaId),this.onModelCreate(this.model));const n=this.model?.api.flush();let l;if(n?.ops.length!==0&&(l=kr.encode(n)),l){const r=new or(this.messageCounter.getNext(),"patch",l);console.debug("Responding with patch:",r),this.sendMessage(r)}else{const r=this.verboseEncoder.encode(this.model);this.sendSyncMessage(r.time)}}catch(a){console.error("Failed to apply patch or send clock:",a)}}else if(t instanceof od)this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(t instanceof td){const d=t.getMethodName();if(console.debug("Message received from server:",d),d==="ping"&&console.debug("Received ping response from server"),d==="connected"){console.debug("Server ready to receive patches");const a=this.model?this.verboseEncoder.encode(this.model):null;this.sendSyncMessage(a?.time)}if(d==="error"){console.warn("Error from server:",t.getPayload());return}if(d==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const a=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",a.time);const n=new or(this.messageCounter.getNext(),"synchronize-clock",a.time);this.sendMessage(n)}}else console.warn("Unexpected WebSocket message format:",t)};handleMessage(t){this.messageHandler(zp.fromJson(JSON.parse(t)))}sendMessage(t){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",t),this.socket.send(JSON.stringify(t.getJson()))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){this.throttledSendPatch()}sendPatchImmediate(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const t=this.model.api.flush();t&&im(t,this.maxPayloadSizeBytes).forEach(a=>{console.debug("Sending patch to server:",a);const n=new or(this.messageCounter.getNext(),"patch",a);this.sendMessage(n)})}sendSyncMessage(t=[]){const d=new or(this.messageCounter.getNext(),"synchronize-clock",t);this.sendMessage(d)}}function fm(e){const{mutateAsync:t}=Gp(),[d,a]=P.useState(null),n=P.useCallback(()=>{a(null)},[]);return{...be({retry:5,retryDelay:r=>Math.min(r>1?2**r*1e3:1e3,30*1e3),mutationFn:async({replicaId:r,sessionId:c,websocketOptions:s})=>{if(!r)throw new Error("replicaId is required");const o=await t({replicaId:r,sessionId:c});return a(o),new dm({replicaId:r,url:o,...s||{}})},...e}),presignedUrl:d,clearPresignedUrl:n}}function hm(e,t){switch(t.type){case"CONNECT_REQUESTED":{const d=e.connectionParams&&e.connectionParams.replicaId===t.payload.replicaId&&e.connectionParams.sessionId===t.payload.sessionId;return{...e,connectionParams:{replicaId:t.payload.replicaId,sessionId:t.payload.sessionId},hasCompletedInitialSync:d?e.hasCompletedInitialSync:!1,model:d?e.model:null,isConnected:!1,isConnecting:!1,connectionAttemptId:t.payload.attemptId,connectionError:null}}case"CONNECTION_ESTABLISHED":return{...e,websocketInstance:t.payload,isConnecting:!0};case"CONNECTION_OPENED":return{...e,isConnected:!0,isConnecting:!1};case"CONNECTION_CLOSED":return{...e,isConnected:!1,isConnecting:!1};case"GRID_READY":return{...e,hasCompletedInitialSync:!0};case"MODEL_CREATED":return{...e,model:t.payload};case"CONNECTION_ERROR":return{...e,connectionError:t.payload,isConnecting:!1};default:return e}}const pm={model:null,hasCompletedInitialSync:!1,isConnected:!1,isConnecting:!1,connectionParams:null,websocketInstance:null,connectionAttemptId:null,connectionError:null};function mm(){const[e,t]=P.useReducer(hm,pm),d=P.useRef(0),a=P.useRef(null),n=Up(e.model),l=Of(),{mutateAsync:r,isPending:c,error:s,presignedUrl:o,reset:i,clearPresignedUrl:f}=fm(),m=P.useCallback(u=>{t({type:"MODEL_CREATED",payload:u})},[t]),p=P.useMemo(()=>({onGridReady:()=>t({type:"GRID_READY"}),onStatusChange:u=>t({type:u?"CONNECTION_OPENED":"CONNECTION_CLOSED"}),onModelCreate:m}),[m]),v=P.useCallback((u,h)=>{i(),(!e.connectionParams||e.connectionParams.replicaId!==u||e.connectionParams.sessionId!==h)&&f(),d.current+=1;const g=d.current;t({type:"CONNECT_REQUESTED",payload:{replicaId:u,sessionId:h,attemptId:g}})},[t,e.connectionParams,i,f,d]);P.useEffect(()=>{const{connectionParams:u,connectionAttemptId:h}=e;!u||h===null||e.isConnected||e.isConnecting||c||s||e.connectionError||!l||(a.current=h,r({replicaId:u.replicaId,sessionId:u.sessionId,websocketOptions:{...p,model:e.model}}).then(w=>{if(a.current!==h){w.disconnect();return}t({type:"CONNECTION_ESTABLISHED",payload:w})}).catch(w=>{t({type:"CONNECTION_ERROR",payload:w}),console.error("Failed to establish WebSocket",w)}))},[e,e.connectionParams,e.connectionAttemptId,e.isConnected,e.isConnecting,c,s,l,r,p]);const y=P.useRef(null);P.useEffect(()=>{const u=y.current,h=e.connectionParams;u&&h&&(u.replicaId!==h.replicaId||u.sessionId!==h.sessionId)&&e.websocketInstance?.disconnect(),y.current=h},[e.connectionParams,e.websocketInstance]),P.useEffect(()=>()=>{e.websocketInstance?.disconnect(),a.current=null},[e.websocketInstance]);function b(u){if(!u||!u.api.getSnapshot()||!n)return!1;const{columnNames:h,columnOrder:w,rows:g}=n,_=h.length>=1,C=w.length>=1,O=g.length>=0;return _&&C&&O}return{isConnected:e.isConnected,websocketInstance:e.websocketInstance,hasCompletedInitialSync:e.hasCompletedInitialSync,model:e.model,modelSnapshot:n,connect:v,presignedUrl:o,errorEstablishingWebsocketConnection:e.connectionError??s,hasSufficientData:b(e.model)}}var Fe=qr();function bm(e,t,d){let a;return Object.hasOwn(e,t)?a=e[t]:d[t]?.isRequired?a=null:a=void 0,a}function gm(e,t,d){const a=e.api.arr(["rows"]),{columnNames:n}=e.api.getSnapshot();switch(t.type){case"CREATE":{const l=n.map(r=>Fe.s.con(bm(t.rowData,r,d)));a?.ins(t.rowIndex,[Fe.s.obj({data:Fe.s.vec(...l),metadata:Fe.s.obj({})})]);break}case"DELETE":a?.del(t.rowIndex,t.count??1);break;case"UPDATE":{Object.entries(t.updatedData).forEach(([l,r])=>{if(l.startsWith("_"))return;const c=n.indexOf(l);c!==-1&&e.api.vec(["rows",String(t.rowIndex),"data"])?.set([[c,Fe.s.con(r)]])});break}case"SET_SELECTION":{e.api.obj().has("selection")||e.api.obj().add(["selection"],Fe.s.obj({})),e.api.obj(["selection"]).set({[t.replicaId]:Fe.s.con(t.selection)});break}}}function ym(e,t){const d=[];return e.forEach(a=>{if(a.type==="CREATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"CREATE",rowIndex:n,rowData:t[n]});if(a.type==="UPDATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"UPDATE",rowIndex:n,updatedData:t[n]});a.type==="DELETE"&&d.push({type:"DELETE",rowIndex:a.fromRowIndex,count:a.toRowIndex-a.fromRowIndex})}),d}const ul=P.forwardRef(({agentRegistrationId:e,showDebugInfo:t=!1},d)=>{const[a,n]=P.useState(null),[l,r]=P.useState(null),[c,s]=P.useState(!1),[o,i]=P.useState(null),f=P.useRef(null),{data:m,isLoading:p}=tf();P.useImperativeHandle(d,()=>({initializeGrid:G=>{f.current&&f.current.handleStartSession(G)},loadExistingSession:G=>{f.current&&f.current.handleLoadSession(G)}}),[]);const{isConnected:v,websocketInstance:y,hasCompletedInitialSync:b,model:u,modelSnapshot:h,connect:w,presignedUrl:g,hasSufficientData:_}=mm(),C=P.useRef(null);P.useEffect(()=>{C.current=y},[y]);const O=P.useRef(null);P.useEffect(()=>{if(l==null||!a?.sessionId){O.current=null;return}const G={replicaId:l,sessionId:a.sessionId},H=O.current;H&&H.replicaId===G.replicaId&&H.sessionId===G.sessionId||(O.current=G,w(l,a.sessionId))},[l,a?.sessionId,w]),P.useEffect(()=>{u===null&&(i(null),ce(null),ie.current&&ie.current.setActiveCell(null))},[u]);const k=sh(a),{data:S}=Nr(a?.sourceEntityId,void 0,{enabled:!!a?.sourceEntityId}),E=S?.concreteType==="org.sagebionetworks.repo.model.table.EntityView",A=P.useMemo(()=>Sh(k??null),[k]),N=v?"Connected":"Disconnected",x=P.useMemo(()=>h?gh(u,h):[],[u,h]),I=P.useCallback(()=>{!v||!C.current||C.current.sendPatch()},[v,C]);P.useEffect(()=>{v&&I()},[v,I]);const R=P.useCallback((G,H)=>{H.forEach(se=>{gm(G,se,A)}),I()},[I,A]),T=(G,H)=>{if(!u){console.error("Model is not initialized");return}if(H=ef(G,x,H),H.length>0){V(),U(H,x,G);const se=ym(H,G);R(u,se)}},q=P.useCallback(G=>{const{selection:H}=G;if(H!=null&&(i(H),u!=null&&l!=null)){const se=hh(H,u);R(u,[{type:"SET_SELECTION",replicaId:l.toString(),selection:se}])}},[R,u,l]),B=P.useCallback(G=>{if(!u){console.error("Model is not initialized");return}G.type==="DELETE"&&ie.current&&ie.current.setActiveCell(null),R(u,[G])},[u,R]),{undoUI:J,redoUI:D,addOperationsToUndoStack:U,clearRedoStack:V}=Ci(B),[X,ce]=P.useState(null),ie=P.useRef(null);return!p&&!m?.isCertified?j.jsx(hf,{}):j.jsx("div",{children:j.jsxs(ee,{container:!0,spacing:2,children:[j.jsx(ee,{size:{xs:12,xl:8},children:j.jsx(Oi,{ref:f,onSessionChange:n,onReplicaChange:r,show:t})}),j.jsx(ee,{size:{xs:12,xl:4},children:t&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",a?.sessionId||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",l||"No replica created"]}),j.jsxs("p",{children:["Source Entity ID:"," ",a?.sourceEntityId||"No source entity"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",a?.gridJsonSchema$Id||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",g?g.substring(0,30)+(g.length>30?" ... "+g.substring(g.length-10):""):"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:v?"green":"red"},children:N})]})]})}),a&&j.jsxs(j.Fragment,{children:[!_&&j.jsxs(ee,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!a&&j.jsx("p",{children:"Creating grid session..."}),a&&!l&&j.jsx("p",{children:"Setting up real-time sync..."}),a&&l&&!g&&j.jsx("p",{children:"Establishing secure connection..."}),a&&l&&g&&!v&&j.jsx("p",{children:"Connecting to server..."}),v&&!b&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Gd,{numRows:4,numCols:1})]})]}),_&&j.jsxs(j.Fragment,{children:[j.jsx(ee,{size:12,children:j.jsxs(Fd,{direction:"row",spacing:1,sx:{justifyContent:"flex-end"},children:[J,D,j.jsx(Ue,{variant:"outlined",onClick:()=>s(!0),startIcon:j.jsx(Wd,{}),children:"Open chat"}),j.jsx(wi,{agentRegistrationId:e,open:c,onClose:()=>s(!1),gridSessionId:a.sessionId,usersReplicaId:l,chatbotName:"Grid Assistant"}),a.sourceEntityId&&j.jsx(bi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId}),a.sourceEntityId&&j.jsx(gi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId})]})}),j.jsx(ee,{size:12,children:j.jsx($d,{gridRef:ie,rowValues:x,columnNames:h?.columnNames??[],columnOrder:h?.columnOrder??[],schemaPropertiesInfo:A,entityIsView:E,jsonSchema:k,selectedRowIndex:X,lastSelection:o,handleChange:T,setSelectedRowIndex:ce,handleSelectionChange:q})}),j.jsx(ee,{size:12,children:X!==null&&x[X]&&Array.isArray(x[X].__validationResults?.allValidationMessages)&&x[X].__validationResults?.allValidationMessages.length>0&&j.jsx(Ud,{variant:"warning",title:"Validation Messages For Selected Row:",isGlobal:!1,description:j.jsx("ul",{children:x[X].__validationResults.allValidationMessages.map(G=>j.jsx("li",{children:G},G))}),sx:{marginTop:"12px"}})})]}),t&&j.jsxs(ee,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model"}),u?j.jsx(Bp.ClickableJsonCrdt,{model:u}):"No model available"]})]})]})})});try{ul.displayName="SynapseGrid",ul.__docgenInfo={description:"",displayName:"SynapseGrid",props:{agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}export{Si as G,ul as S};
