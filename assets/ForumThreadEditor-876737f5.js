import{j as i,F as q,a as w}from"./jsx-runtime-095bf462.js";import{r as m}from"./index-8db94870.js";import{c as B,d as j,e as O}from"./useThread-8907b6c5.js";import{u as k,S as v,ar as $,as as L,a8 as G,bQ as Y,bR as W}from"./SynapseClient-a4e4b778.js";import{u as U}from"./useMutation-0e9148bd.js";import{u as z}from"./useInfiniteQuery-9947b096.js";import{I as K}from"./IconSvg-745db870.js";import{O as H,c as J,C as X,N as Z}from"./ConfirmationDialog-7a0b5e2e.js";import{U as ee}from"./UserSearchBoxV2-975a9e72.js";import{s as te}from"./startCase-3bd1c423.js";import{B as ae}from"./Box-402daddb.js";import{b as se}from"./FormLabel-ebef8756.js";function Se(e,s,o,n,t,r){const{accessToken:c,keyFactory:h}=k();return z(h.getRepliesQueryKey(e,s,o,n,t),async d=>v.getReplies(c,e,o,d.pageParam,n,s,t),{...r,getNextPageParam:(d,b)=>{const g=b.flatMap(u=>u.results).length;if(d.totalNumberOfResults>g)return g}})}function Ce(e,s){const{accessToken:o,keyFactory:n}=k(),t=async()=>{const r=await v.getReplyMessageUrl(e.messageKey,o);return(await fetch(r.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return $(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),t,s)}function ne(e){const s=L(),{accessToken:o,keyFactory:n}=k();return U(t=>v.postReply(t,o),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function re(e){const s=L(),{accessToken:o,keyFactory:n}=k();return U(t=>v.putReply(t,o),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function Re(e){const s=L(),{accessToken:o,keyFactory:n}=k();return U(t=>v.deleteReply(o,t.replyId),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(r.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}const F=({show:e,onClose:s,handleUserTag:o})=>{const n=m.useCallback((t,r)=>{t&&r&&o(r.userName),s()},[s,o]);return i(q,{children:i(H,{open:e,onCancel:s,title:"Find User or Team",content:i(ee,{placeholder:"Search for a user or team name",onChange:n,typeFilter:G.ALL,focusOnSelect:!0}),sx:{".MuiDialog-paperFullWidth":{overflowY:"visible",".MuiDialogContent-root":{overflowY:"visible"}}}})})};try{F.displayName="UserMentionModal",F.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var N=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(N||{});const V=({placeholder:e,text:s,setText:o})=>{const[n,t]=m.useState("WRITE"),[r,c]=m.useState(0),[h,d]=m.useState(!1),[b,g]=m.useState(!1),u=m.useRef(null);m.useEffect(()=>{const a=u.current;a&&a.setSelectionRange(r,r)},[u,r]),m.useEffect(()=>{var a;(a=u.current)==null||a.focus()},[h]);const _=a=>{const l=[],p=u.current;if(p){const f=p==null?void 0:p.selectionStart,T=s.substring(0,f),S=s.substring(f,s.length);c(f+a.length),l.push(T,`${b?"":"@"}${a.replace(/\s/g,"")}`,S)}o(l.join("")),g(!1)},x=a=>{const l=u.current&&u.current.selectionStart;l&&l>0&&a.charAt(l-1)==="@"&&(g(!0),d(!0))},I=a=>{const l=u.current;if(l){const p=l.selectionStart,f=l.selectionEnd,T=s.substring(p,f),S=s.substring(0,p),E=s.substring(f,s.length),C=W[a].openSyntax,M=W[a].closeSyntax;switch(a){case"code":{const y=[];y.push(S,C,T,M,E),o(y.join(`\r
`)),l.focus(),c(p+C.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const y=`${S}${C}${T}${M}${E}`;l.focus(),c(p+C.length),o(y)}}}};return w("div",{className:"bootstrap-4-backport MarkdownEditor",children:[w("div",{className:"MarkdownEditorControls",children:[i("div",{className:"Tabs",children:Object.keys(N).map(a=>i("button",{className:"Tab",role:"tab","aria-selected":a===n,onClick:l=>{l.stopPropagation(),t(N[a])},children:a},a))}),n==="WRITE"&&w("div",{className:"MarkdownEditorControlsToolbar",children:[Y.map(a=>i("button",{onClick:()=>I(a),children:i(K,{icon:a,label:te(a)})},a)),i("button",{onClick:()=>d(!0),children:i(K,{icon:"tag",label:"Mention"})})]})]}),i("div",{children:n==="WRITE"?i("textarea",{onChange:a=>{o(a.target.value),x(a.target.value)},style:{width:"100%"},rows:6,value:s,ref:u,placeholder:e}):s?i(J,{markdown:s}):"Nothing to preview"}),i(F,{show:h,onClose:()=>d(!1),handleUserTag:_})]})};try{V.displayName="MarkdownEditor",V.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const P=e=>{const{initialText:s,initialTitle:o,id:n,onClose:t,isReply:r,isDialog:c,openDialog:h}=e,[d,b]=m.useState(o??""),[g,u]=m.useState(s??""),{mutate:_,isLoading:x}=B({onSuccess:()=>t()}),{mutate:I,isLoading:a}=j({onSuccess:()=>t()}),{mutate:l,isLoading:p}=O({onSuccess:()=>t()}),{mutate:f,isLoading:T}=ne({onSuccess:()=>t()}),{mutate:S,isLoading:E}=re({onSuccess:()=>t()}),C=a||T||p||x||E,M=!r&&o,y=(R,Q)=>{r?s?S({replyId:n,messageMarkdown:R}):f({threadId:n,messageMarkdown:R}):M?(_({title:Q,threadId:n}),I({messageMarkdown:R,threadId:n})):l({forumId:n,title:Q,messageMarkdown:R})},A=w("div",{className:"bootstrap-4-backport",children:[!r&&i(se,{type:"text",placeholder:"Title",value:d,onChange:R=>b(R.target.value)}),i(V,{text:g,setText:u})]}),D=C?"Saving":"Save";return i(q,{children:c?i(X,{maxWidth:"md",open:h,onCancel:t,title:r?"Edit Reply":M?"Edit Thread":"New Thread",content:A,onConfirm:()=>y(g,d),confirmButtonText:D}):w(q,{children:[A,i(ae,{display:"flex",justifyContent:"flex-end",children:i(Z,{onCancel:t,onConfirm:()=>y(g,d),confirmButtonText:D})})]})})};try{P.displayName="ForumThreadEditor",P.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{P as F,Re as a,Se as b,Ce as u};
//# sourceMappingURL=ForumThreadEditor-876737f5.js.map
