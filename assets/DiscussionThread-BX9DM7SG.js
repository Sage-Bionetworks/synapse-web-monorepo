import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{O as F,q as E}from"./VerificationSubmission-BmZsZ0JS.js";import{u as O,A as se}from"./useEntity-kNWKnjOE.js";import{d as Y}from"./dayjs.min-d18Up55D.js";import{r as i}from"./index-Dl6G-zuu.js";import{q as G}from"./useFiles-CdUPF4Hl.js";import"./StringUtils-DFpF2_59.js";import{S as ne}from"./SynapseConstants-hkCWvFT0.js";import"./OrientationBanner-BlRVLq4e.js";import{u as ie,a as re,F as y,b as ae}from"./ForumThreadEditor-BTbyCeJh.js";import{u as le,a as de,b as ce}from"./useThread-CAZYdLvW.js";import{a as ue}from"./useSubscription-uqURjTBq.js";import{f as q}from"./DateFormatter-CZIuh64r.js";import{M as W,C as me}from"./ConfirmationDialog-Vov4AVL6.js";import{I as r}from"./IconSvg-DwTp9wcr.js";import{W as k}from"./WarningDialog-Bs-HHVGZ.js";import{d as b}from"./ToastMessage-Cdc-RPF1.js";import{U as H}from"./UserBadge-BbrXocfe.js";import{S as pe}from"./SkeletonTable-CDz9K-62.js";import{S as he}from"./SubscribersModal-CAzo2y7Z.js";import{B as j}from"./Box-DN73Q90z.js";import{B as M}from"./Button-jaxqGIs_.js";import{T as fe}from"./Typography-Cqa7rFgc.js";import{T as v}from"./TextField-BDNZH-7j.js";const xe=()=>alert("This functionality has not been implemented yet");function _(u){const{reply:t,onClickLink:g=xe}=u,[a,l]=i.useState(!1),[f,m]=i.useState(!1),{data:d}=G(),{data:p}=O(t.projectId),{data:c,isLoading:C}=ie(t),{mutate:x}=re({onSuccess:()=>{m(!1),b("A reply has been deleted.","info")}}),S=t.createdBy==(d==null?void 0:d.ownerId);return e.jsx("div",{className:"reply-container",children:C?e.jsx(pe,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(H,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{className:"message-body",children:[e.jsx(W,{markdown:c,objectType:F.REPLY}),e.jsxs("span",{children:["posted ",q(Y(t.createdOn),"M/D/YYYY")]}),e.jsxs("div",{style:{float:"right"},children:[e.jsx("button",{onClick:()=>g(),children:e.jsx(r,{icon:"link"})}),S&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(r,{icon:"edit"})}),(p==null?void 0:p.permissions.canModerate)&&e.jsx("button",{onClick:()=>m(!0),children:e.jsx(r,{icon:"delete"})})]})]})]}),e.jsx(y,{isReply:!0,initialText:c,onClose:()=>l(!1),id:t.id,isDialog:!0,openDialog:a}),e.jsx(k,{open:f,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{m(!1)},onConfirm:()=>x({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{_.displayName="DiscussionReply",_.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"(() => void)"}}}}}catch{}const je="You are following this topic. Click to stop following.",ye="You are not following this topic. Click to follow.",be="You will need to sign in for access to that resource",L="Write a reply...";function A(u){const{threadId:t,limit:g}=u,a="16px",[l,f]=i.useState(!0),[m,d]=i.useState(!1),[p,c]=i.useState(!1),[C,x]=i.useState(!1),[S,w]=i.useState(!1),[P,h]=i.useState(!1),[U,T]=i.useState(!1),[V,X]=i.useState(!1),{threadData:o,threadBody:I,togglePin:z}=le(t),{data:s}=G(),{data:D}=O((o==null?void 0:o.projectId)??"",void 0,se,{enabled:!!o}),{subscription:N,toggleSubscribed:K,isLoading:J}=ue(t,E.THREAD),{mutate:Q}=de({onSuccess:()=>{w(!1),b("A thread has been deleted.","info")}}),{mutate:Z}=ce({onSuccess:()=>{T(!1),b("A thread has been restored.","info")}}),$=(o==null?void 0:o.createdBy)==(s==null?void 0:s.ownerId);function ee(){if((s==null?void 0:s.userName)=="anonymous")h(!0);else try{K()}catch(n){b(n.reason,"danger")}}const{data:R,hasNextPage:oe,fetchNextPage:te}=ae(t,l,g),B=(R==null?void 0:R.pages.flatMap(n=>n.results))??[];return e.jsxs("div",{className:"DiscussionThread",children:[o&&I?e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:n=>({textAlign:"center",[n.breakpoints.down("sm")]:{display:"flex",marginBottom:a,button:{whiteSpace:"nowrap"}}}),children:[e.jsx(M,{variant:l?"contained":"outlined",onClick:()=>f(!0),children:"Date Posted"}),e.jsx(M,{variant:l?"outlined":"contained",onClick:()=>f(!1),children:"Most Recent"})]}),e.jsx(H,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs(j,{sx:n=>({[n.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:a,marginTop:a,".SubscribersModal":{justifyContent:"flex-start",marginBottom:a}}}),children:[e.jsx(fe,{sx:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(he,{id:t,objectType:E.THREAD,showModal:V,handleModal:X})]}),e.jsx("div",{children:e.jsx(W,{markdown:I,objectType:F.THREAD})}),e.jsxs("span",{children:["posted ",q(Y(o.createdOn),"M/D/YYYY")]}),e.jsx(y,{isReply:!1,initialText:I,onClose:()=>d(!1),initialTitle:o==null?void 0:o.title,id:t,isDialog:!0,openDialog:m})]}):e.jsx(e.Fragment,{}),e.jsx("div",{className:"control-container",children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>T(!0),children:e.jsx(r,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":N?"Unfollow thread":"Follow thread",disabled:J,onClick:()=>ee(),children:N?e.jsx(r,{icon:"visibility",label:je}):e.jsx(r,{icon:"visibilityOff",label:ye})})}),$&&e.jsx("button",{onClick:()=>d(!0),children:e.jsx(r,{icon:"edit",label:"Edit thread"})}),D!=null&&D.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(!0),children:e.jsx(r,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>z(),children:o!=null&&o.isPinned?e.jsx(r,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(r,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(j,{sx:{mt:2,mb:3},children:p?e.jsx(y,{id:t,isReply:!0,onClose:()=>c(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?h(!0):c(!0)}})}),e.jsx("div",{children:B.map(n=>e.jsx(_,{reply:n},n.id))}),B.length>0&&e.jsx(j,{sx:n=>({mt:2,mb:3,[n.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:C?e.jsx(y,{id:t,isReply:!0,onClose:()=>x(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?h(!0):x(!0)}})}),oe?e.jsx(M,{variant:"outlined",onClick:()=>{te()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(k,{open:S,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>w(!1),onConfirm:()=>o&&Q(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(k,{open:U,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>o&&Z(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(me,{open:P,title:"Sign In Required",content:be,onCancel:()=>h(!1),hasCancelButton:!1,onConfirm:()=>h(!1),confirmButtonProps:{children:"Sign In",className:ne}})]})}try{A.displayName="DiscussionThread",A.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{A as D};
