import{a as s,j as n,F as x}from"./jsx-runtime-9dc53467.js";import{r as g,R as K}from"./index-76fb7be0.js";import{h as v,l as O,m as _,n as D,v as G,B as V,w as j}from"./ApplicationSessionManager-2e1d5529.js";import{z as Y}from"./index-4a1b1a67.js";import"./getEndpoint-ac94413e.js";import{U as P}from"./SynapseConstants-0078d114.js";import{d as b}from"./ToastMessage-3dbe47cb.js";import{f as W,y as J}from"./HelpPopover-35254bc9.js";import{u as X}from"./useMutation-68b4e1ea.js";import{f as Z}from"./DateFormatter-04dc892b.js";import{d as ee}from"./dayjs.min-f79c4412.js";import{T as p}from"./Typography-f217f607.js";import"./SkeletonButton-4e246cf8.js";import{S as ne}from"./SkeletonTable-3361182b.js";import{M as Q}from"./Alert-fd45ce28.js";import{A as q}from"./AlertTitle-9139c2ff.js";import{L as te}from"./Link-5cdd275a.js";import{B as z}from"./Button-065a21d4.js";import{H as E}from"./IconSvg-4bf1503e.js";import{S as re}from"./Skeleton-2007774f.js";function ie(t="",i){const{accessToken:r,keyFactory:c}=v();return O({...i,queryKey:c.getPassingRecordQueryKey(t),queryFn:()=>_.getPassingRecord(t,r)})}function se(t){const i=D(),{accessToken:r,keyFactory:c}=v(),{data:d}=G();return X({...t,mutationFn:l=>_.postCertifiedUserTestResponse(r,l),onSuccess:async(l,f,y)=>{await Promise.all([i.invalidateQueries({queryKey:c.getPassingRecordQueryKey(d==null?void 0:d.ownerId)}),i.invalidateQueries({queryKey:c.getUserBundleQueryKey("current",P)})]),t!=null&&t.onSuccess&&await t.onSuccess(l,f,y)}})}function w(t){const{question:i,answer:r,onClick:c,checked:d,disabled:l}=t;return s("div",{children:[n("input",{id:`${i.questionIndex}-${r.answerIndex}`,name:`${i.questionIndex}`,type:i.exclusive?"radio":"checkbox",value:r.answerIndex,onClick:c,checked:d,disabled:l}),n(p,{variant:"label",component:"label",sx:{fontWeight:400},htmlFor:`${i.questionIndex}-${r.answerIndex}`,children:r.prompt})]})}try{w.displayName="CertificationAnswer",w.__docgenInfo={description:"",displayName:"CertificationAnswer",props:{question:{defaultValue:null,description:"",name:"question",required:!0,type:{name:"MultichoiceQuestion"}},answer:{defaultValue:null,description:"",name:"answer",required:!0,type:{name:"MultichoiceAnswer"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"MouseEventHandler<HTMLInputElement>"}},checked:{defaultValue:null,description:"",name:"checked",required:!1,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}}}}}catch{}const N=()=>{var R;const{accessToken:t}=v(),i=V(),[r,c]=g.useState(),[d,l]=g.useState(!1),[f,y]=g.useState([]),{data:m}=j(P),C=m==null?void 0:m.isCertified,k=m==null?void 0:m.userId,{data:o,isLoading:L}=ie(k,{enabled:k!==void 0}),I=K.useRef(null),M="https://help.synapse.org/docs/Getting-Started.2055471150.html",S=async()=>{try{c(await _.getCertifyQuiz(t))}catch(e){i(e)}},{mutate:H,isPending:A}=se({onSuccess:()=>{l(!1),window.scrollTo(0,0)},throwOnError:!0}),T=!C&&(o==null||d);if(g.useEffect(()=>{t&&S()},[t]),L||r==null)return n(oe,{});const $=(e,a)=>{const h=[...f.filter(u=>u.questionIndex!==e),{questionIndex:e,answerIndex:[a],concreteType:Y}];y(h)},B=()=>{var e;(e=I.current)==null||e.reset(),l(!0),y([]),S()},F=()=>{try{if(r&&r.questions.length===f.length){const e={quizId:r.id,questionResponses:f};H(e)}else b("Please answer all of the questions and try again.","warning")}catch(e){b(e.reason,"danger")}},U=e=>e?{content:n(x,{children:"More info"}),closePopoverOnClick:!0,onClick:()=>window.open(e,"_blank"),color:"primary"}:void 0;return s("div",{children:[o&&!T&&s(x,{children:[(!o.passed||!C)&&s(Q,{severity:"error",children:[!o.passed&&n(q,{children:"Quiz Failed"}),s(p,{variant:"body1",sx:{marginTop:"5px"},children:["Please review the results from the previous attempt, and"," ",n(te,{href:"#",onClick:e=>{e.preventDefault(),B()},children:"retake the quiz"}),"."]})]}),o.passed&&C&&s(Q,{severity:"success",children:[n(q,{children:"Quiz Passed"}),n(p,{variant:"body1",sx:{marginTop:"5px"},children:`You passed the Synapse Certification Quiz on ${Z(ee(o.passedOn))}`})]}),s(p,{variant:"sectionTitle",sx:{marginTop:"20px",marginBottom:"20px"},children:["Score: ",o.score," / ",(R=o.corrections)==null?void 0:R.length]})]}),s("div",{className:"CertificationQuiz__container",children:[r&&T&&s(x,{children:[s(z,{onClick:()=>window.open(M,"_blank"),className:"help-button",color:"secondary",variant:"contained",children:[n(E,{className:"HelpButton",style:{marginRight:"4px"}}),"Help"]}),n("div",{dangerouslySetInnerHTML:{__html:r.header}}),n("form",{ref:I,onSubmit:e=>e.preventDefault(),children:n("ol",{children:r==null?void 0:r.questions.map(e=>{const a=e.helpText||e.docLink;return s("li",{role:e.exclusive?"radiogroup":void 0,children:[n(p,{component:"div",variant:"body1",dangerouslySetInnerHTML:{__html:e.prompt},sx:{marginTop:"20px"}}),e.answers.map(h=>n(w,{question:e,answer:h,onClick:u=>$(e.questionIndex,Number(u.currentTarget.value))},`${e.questionIndex}-${h.answerIndex}`)),a&&n(W,{contentProps:{markdown:e.helpText},placement:"right",sx:{table:{textAlign:"center",th:{padding:"5px"}}},actionButton:U(e.docLink),showCloseButton:!0,children:s(p,{variant:"hintText",color:"primary",children:[n(E,{className:"HelpButton",style:{marginRight:"4px"}}),"Need help answering this question?"]})})]},e.questionIndex)})})}),n(z,{className:"help-button",color:"primary",variant:"contained",size:"large",disabled:A,onClick:()=>{F()},children:"Submit"})]}),!T&&(o==null?void 0:o.corrections)&&n("ol",{children:o.corrections.map(e=>{const a=e.question,h=e.response;return s("li",{children:[n(p,{component:"div",variant:"body1",dangerouslySetInnerHTML:{__html:a.prompt},className:e.isCorrect?"":"incorrectQuestion",sx:{marginTop:"20px"}}),a.answers.map(u=>n(w,{question:a,answer:u,disabled:!0,checked:h.answerIndex.includes(u.answerIndex)},`${a.questionIndex}-${u.answerIndex}`))]},a.questionIndex)})})]})]})},oe=()=>{const t=[];for(let i=0;i<20;i++)t.push(n("li",{children:n(ne,{numCols:1,numRows:5})},i));return s(x,{children:[n("div",{children:n(re,{height:"80px",width:"460px"})}),n(J,{numRows:5}),n("div",{className:"CertificationQuiz__container",children:n("ol",{style:{marginTop:"20px"},children:t})})]})};try{N.displayName="CertificationQuiz",N.__docgenInfo={description:"",displayName:"CertificationQuiz",props:{}}}catch{}export{N as C};
