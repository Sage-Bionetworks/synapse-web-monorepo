import{an as C,r as o,j as e,V,c1 as D,al as T,X as m,dH as M,dG as P,jq as k,jr as q,js as A,jt as b,ju as L,cy as $,J as B,c6 as G,br as K,B as z}from"./iframe-k9YwU_Xc.js";import{N as H}from"./NoSearchResults-CEFUv4js.js";import{u as J}from"./useEntity-DLxNvIyy.js";import{c as X}from"./useForum-B9eHgwR4.js";import{S as Y}from"./Search-CIaLSzBA.js";import{S as Q}from"./SkeletonParagraph-Btg7J19e.js";import{U as W}from"./UserBadge-DuQvc6Dg.js";import{I as F}from"./InputAdornment-xFLYHLEt.js";import"./index-r8ZA1smB.js";import"./pickBy-CBoyaqdZ.js";import"./isString-D-byzQtq.js";import"./_baseIteratee-DxLFM1hL.js";import"./useQueries-J55c1hQt.js";import"./useSuspenseQuery-CiFSWrMs.js";import"./useInfiniteQuery-CV6-OEbg.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-CRLaABuD.js";import"./useUserBundle-Ciq97Tj-.js";import"./SkeletonTable-aVeOh9ct.js";import"./MenuItem-xt1g1Ufs.js";import"./Card-BUvqTfdV.js";import"./Chip-CKkKYJUZ.js";const N=async r=>(await fetch(r,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=r=>{const{threadId:p,replyId:n}=r,{accessToken:i}=C(),[s,R]=o.useState(),[h,y]=o.useState(""),[t,x]=o.useState(),[g,j]=o.useState(),[I,S]=o.useState(!1);o.useEffect(()=>{(async()=>{let c;S(!0);const l=await k(p,i);if(n){const d=await q(n,i);c=await A(d.messageKey,i),j(await b(d.createdBy)),x(d)}else j(await b(l.createdBy)),c=await L(l.messageKey,i);y(await N(c.messageUrl)),R(l),S(!1)})()},[i,n,p]);const f=(u,c,l)=>{let d=`${$.PORTAL}Synapse:${c}/discussion/threadId=${u}`;return l&&(d+=`&replyId=${l}`),d};return e.jsx("div",{className:"search-result-container",children:e.jsxs(V,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:I?e.jsx(D,{variant:"circular",width:"30px",height:"30px"}):n?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:I?e.jsx(Q,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:f(s==null?void 0:s.id,s==null?void 0:s.projectId,t==null?void 0:t.id),children:s==null?void 0:s.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[n?"Reply":"Thread"," by"," ",e.jsx(W,{userId:g==null?void 0:g.ownerId})," ",M(P(t==null?void 0:t.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const Z=()=>e.jsxs(V,{sx:{textAlign:"center"},children:[e.jsx(H,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),w=r=>{const{onSearchResultsVisible:p}=r,[n,i]=o.useState(""),[s,R]=o.useState(""),[h,y]=o.useState(!1),{data:t}=J(r.projectId,void 0,{enabled:!!r.projectId}),{data:x,isLoading:g,hasNextPage:j,isFetchingNextPage:I,fetchNextPage:S,error:f}=X(r.forumId,{searchString:s},{enabled:!!s});o.useEffect(()=>{f&&B(f.reason,"danger")},[f]);const u=(x==null?void 0:x.pages.flatMap(a=>a.matches??[]))??[],c=!g&&s&&u.length==0,l=()=>{y(!1),i("")};function d(){R(n),y(!0)}return o.useEffect(()=>{p&&p(h)},[h,p]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(G,{sx:a=>({[a.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:n,onChange:a=>{i(a.target.value)},onKeyDown:a=>{a.key==="Enter"&&d()},slotProps:{input:{startAdornment:e.jsx(F,{position:"start",children:e.jsx(Y,{})}),endAdornment:n&&e.jsx(F,{position:"end",children:e.jsx(K,{size:"small",onClick:()=>{l()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[c&&e.jsxs(e.Fragment,{children:[r.projectId&&t&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',s,'" in ',t==null?void 0:t.name]}),e.jsx(Z,{})]}),u&&e.jsxs(e.Fragment,{children:[r.projectId&&!c&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',s,'" in ',t==null?void 0:t.name,":"]}),u.map(a=>e.jsx("div",{children:e.jsx(v,{threadId:a.threadId,replyId:a.replyId})},`${a.forumId}-${a.threadId}-${a.replyId}`))]}),j&&e.jsx(z,{variant:"contained",color:"primary",disabled:I,onClick:()=>{S()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{w.displayName="ForumSearch",w.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:ee}=__STORYBOOK_MODULE_TEST__,Re={title:"Synapse/ForumSearch",component:w},_={args:{forumId:"1032",onSearchResultsVisible:ee()}};var O,E,U;_.parameters={..._.parameters,docs:{...(O=_.parameters)==null?void 0:O.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...(U=(E=_.parameters)==null?void 0:E.docs)==null?void 0:U.source}}};const Te=["Demo"];export{_ as Demo,Te as __namedExportsOrder,Re as default};
