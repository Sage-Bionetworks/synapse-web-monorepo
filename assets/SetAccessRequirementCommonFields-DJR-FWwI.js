import{r as n,cY as Y,cV as V,R as l,j as e,c2 as E,c7 as R,c5 as _,Y as y,bW as Q,ah as z,c0 as X,bz as K,X as Z,a4 as B}from"./iframe-05B79XZ4.js";import{v as ee,w as te,r as se}from"./useAccessRequirements-D8KrmOhE.js";import{p as re}from"./pluralize-DvqWrKl4.js";import{E as ne}from"./EntitySubjectsSelector-C6cQ_Whq.js";import{T as oe}from"./TeamSubjectsSelector-CRJ1hSCu.js";import{F as g}from"./FormControlLabel-Bw9mk1Z6.js";import{C as ae}from"./Checkbox-DMe8JDwK.js";import{R as ce}from"./RadioGroup-Ck6-wrTD.js";import{R as k}from"./Radio-DjM_illo.js";const ie="Please select at least one resource for this Access Requirement to be associated with.",C=c=>{const S=c===l.ENTITY?"Synapse":"Team",j=c[0].toUpperCase()+c.slice(1).toLowerCase();return`${S} IDs were specified but not added to the subjects list. Please either clear out the Add ${S} IDs textbox or click the Add ${re(j)} button.`},le="Enter access requirement name. This will also be used when sending notifications for expiring or revoked approval. For example, 'The approval for the name access requirement was revoked...'",T={variant:"body1",fontWeight:700};function ue(c){switch(c){case l.ENTITY:return B.DOWNLOAD;case l.TEAM:return B.PARTICIPATE;default:throw new Error(`RestrictableObjectType ${c} does not have an access type specified.`)}}const G=n.forwardRef(function(S,j){const{subject:i,accessRequirementId:I,onSave:$,onError:f}=S,m=!i,[u,x]=n.useState(i?[i]:[]),[A,H]=n.useState(!1),[N,p]=n.useState(null),[h,q]=n.useState(""),[o,v]=n.useState(!1),[b,w]=n.useState(i?.type===l.TEAM?Y:V),[U,M]=n.useState(null),F=t=>{M(null),$(t.id.toString(),t.concreteType)},D=t=>{M(t.reason),f()},{mutate:O}=ee({onSuccess:t=>F(t),onError:t=>D(t)}),{mutate:P}=te({onSuccess:t=>F(t),onError:t=>D(t)}),{data:s,isLoading:J,error:L}=se(I,{enabled:!!I});n.useEffect(()=>{s&&(w(s.concreteType),q(s.name),x(s.subjectIds),v(s.subjectsDefinedByAnnotations))},[s]);const a=n.useMemo(()=>{if(i)return i.type;if(s){const t=s.subjectIds;if(t.length>0)return t[0].type}return o?l.ENTITY:null},[i,s,o]),W=n.useMemo(()=>{if(!a)return e.jsx(e.Fragment,{});function t(r){p(null),x(r)}function d(r){p(null),H(r.trim()!=="")}if(o)return e.jsx(e.Fragment,{});switch(a){case l.TEAM:return e.jsx(oe,{subjects:u,onUpdate:r=>t(r),onUpdateTeamIDsTextbox:r=>d(r)});case l.ENTITY:return e.jsx(ne,{subjects:u,onUpdate:r=>t(r),onUpdateEntityIDsTextbox:r=>d(r)});default:return console.error(`RestrictableObjectType ${a} does not have a selector implemented.`),e.jsx(e.Fragment,{})}},[a,u,o]);return n.useImperativeHandle(j,()=>({save(){const t=m&&!s||!a,d=!o&&(A||u.length===0);if(t||d){d&&!t&&(A?p(C(a)):u.length===0&&p(ie)),f();return}const r=ue(a);m||O({concreteType:b,subjectIds:u,name:h,accessType:r,subjectsDefinedByAnnotations:o}),m&&s&&P({...s,subjectIds:u,name:h,accessType:r,subjectsDefinedByAnnotations:o})}}),[A,a,u,h,b,s,m,f,O,P,o]),J||!a?e.jsxs(e.Fragment,{children:[e.jsx(E,{width:100,height:30}),e.jsx(E,{width:125,height:30}),e.jsx(E,{width:"100%",children:e.jsx(R,{})}),e.jsx(E,{width:100,height:30}),e.jsx(E,{width:"100%",children:e.jsx(R,{})})]}):L?e.jsx(_,{severity:"error",children:L.reason}):e.jsxs(e.Fragment,{children:[e.jsx(y,{...T,children:"Resources"}),a!==l.TEAM&&e.jsx(g,{control:e.jsx(ae,{}),label:"Associated entities should be defined by annotations (DUO)",checked:o,onChange:()=>{p(null);let t=[];o&&(s?t=s.subjectIds:i&&(t=[i])),x(t),v(!o)}}),e.jsx(Q,{children:W}),N&&e.jsx(_,{severity:"error",children:N}),e.jsxs(z,{direction:"row",sx:{gap:1,alignItems:"center",mb:1,mt:2},children:[e.jsx(y,{component:"label",htmlFor:"arName",...T,children:"Name"}),e.jsx(X,{title:le,placement:"right",children:e.jsx(K,{sx:{color:"grey.600"}})})]}),e.jsx(R,{id:"arName",name:"arName",value:h,placeholder:"Access requirement name",fullWidth:!0,onChange:t=>q(t.target.value)}),!m&&a!==l.TEAM&&e.jsxs(e.Fragment,{children:[e.jsx(y,{...T,sx:Z({mt:2},T.sx),children:"Access requirement type"}),e.jsxs(ce,{value:b,onChange:(t,d)=>w(d),children:[e.jsx(g,{value:V,control:e.jsx(k,{}),label:"Controlled - requests are in Synapse"}),e.jsx(g,{value:Y,control:e.jsx(k,{}),label:"Click wrap"})]})]}),U&&e.jsx(_,{severity:"error",sx:{marginTop:2},children:U})]})});try{C.displayName="UNSAVED_SUBJECTS_ERROR_MESSAGE",C.__docgenInfo={description:"",displayName:"UNSAVED_SUBJECTS_ERROR_MESSAGE",props:{}}}catch{}try{G.displayName="SetAccessRequirementCommonFields",G.__docgenInfo={description:"",displayName:"SetAccessRequirementCommonFields",props:{subject:{defaultValue:null,description:"",name:"subject",required:!1,type:{name:"RestrictableObjectDescriptor"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(accessRequirementId: string, accessRequirementConreteType: ACCESS_REQUIREMENT_CONCRETE_TYPE) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{G as S};
