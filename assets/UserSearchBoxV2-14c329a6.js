import{j as w}from"./jsx-runtime-9dc53467.js";import{r as c,R as _}from"./index-76fb7be0.js";import{u as V,S as b,d as U}from"./Select-ce3716e1.esm-ea0ad4cf.js";import{_ as k}from"./emotion-use-insertion-effect-with-fallbacks.browser.esm-55b21f7f.js";import"./index-d3ea75b5.js";import{o as F,a$ as A,b0 as H,b1 as L}from"./SynapseClient-7700f4cc.js";import{T}from"./index-3a31b023.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-c0eacdfc.js";import{a as x}from"./use-deep-compare-effect.esm-3f8944c0.js";import{V as C,v as D,w as P,x as G}from"./SynapseConstants-c93e8ee4.js";import{u as Y,c as M}from"./uniq-f9854dd4.js";import{w as q}from"./without-9cea2dc4.js";import{c as B}from"./UserBadge-43829a76.js";import{U as N}from"./UserOrTeamBadge-3da677f6.js";import{S as K}from"./Skeleton-b82f86a8.js";const $=(t,e,n)=>{c.useEffect(()=>{const o=setTimeout(()=>t(),n);return()=>clearTimeout(o)},[...e||[],n])},j={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},J={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},Q={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},z=async(t,e)=>{const n=await A(t,e),s=t.filter(a=>n.results.map(l=>l.id).indexOf(a.targetId)===-1).map(a=>({...J,id:a.targetId,name:`${a.targetId}`}));return[...n.results,...s]},W=async t=>{const e=(await H(t)).children,o=t.filter(s=>e.map(a=>a.ownerId).indexOf(s)===-1).map(s=>({...j,ownerId:s,name:`Unknown User (${s})`}));return[...e,...o]},X=async(t,e)=>{const n=await L({evaluationIds:t},e),s=t.filter(a=>n.results.map(l=>l.id).indexOf(a)===-1).map(a=>({...Q,id:a,name:a}));return[...n.results,...s]};function Z(t){const{ids:e,type:n}=t,{accessToken:o}=F(),[s,a]=c.useState([]),l=n==="USER_PROFILE"?"ownerId":"id",I=(u=>{switch(u){case"USER_PROFILE":return G;case"ENTITY_HEADER":return P;case"EVALUATION_QUEUE":return D;default:return""}})(n),g=s.map(u=>u[l]),y=e.filter(u=>u!==C),f=Y(q(y,...g));return c.useEffect(()=>{(p=>{if(!p.length)return;const d=sessionStorage.getItem(I);try{const S=d?JSON.parse(d):[],E=S.map(i=>i[l]);for(const i of p)E.includes(i[l])||S.push(i);sessionStorage.setItem(I,JSON.stringify(S))}catch{sessionStorage.setItem(I,JSON.stringify(p))}})(s)},[s,l,I]),x(()=>{let u=!1;return(async()=>{if(f.length>0)try{const d=Array.from(f),S=n==="ENTITY_HEADER"?d.map(m=>({targetId:m})):d,E=M(S,45),i=[];for(const m of E){let h=[];switch(n){case"USER_PROFILE":h=await W(m);break;case"ENTITY_HEADER":h=await z(m,o);break;case"EVALUATION_QUEUE":h=await X(m,o);break}i.push(...h)}u||a(m=>m.concat(...i))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{u=!0}},[o,n,f]),s}var ee=c.forwardRef(function(t,e){var n=V(t);return c.createElement(b,k({ref:e},n))}),te=ee;const ne={Control:t=>w(U.Control,{...t,className:`form-control ${t.className??""}`}),SingleValue:t=>{const{data:e}=t;return c.createElement(U.SingleValue,{...t,key:e==null?void 0:e.id},w(N,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return c.createElement(U.Option,{...t,key:e==null?void 0:e.id},w(N,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}},v=t=>{const{inputId:e,defaultValue:n=null,onChange:o,filterPredicate:s,typeFilter:a,placeholder:l,focusOnSelect:O=!1,value:I}=t,[g,y]=c.useState(""),[f,u]=c.useState("");$(()=>{u(g)},[g],500);const[p=void 0]=Z({ids:n?[n]:[],type:"USER_PROFILE"}),d=!!f,{data:S,isLoading:E}=B(f,a,{enabled:d}),i=_.useRef(null);_.useEffect(()=>{O&&i.current&&i.current.focus()});const m=c.useMemo(()=>E||g!==f?()=>"Loadingâ€¦":void 0,[E,f,g]),h=(S??[]).filter(s??(()=>!0)).map(r=>({id:r.ownerId.toString(),value:r.ownerId.toString(),label:r.userName,header:r})),R=c.useMemo(()=>l!==void 0?l:a==T.USERS_ONLY?"Name (first and last)":a==T.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[l,a]);return n&&p==null?w(K,{width:"100%"}):w(te,{className:"bootstrap-4-backport UserSearchBoxV2",ref:i,inputValue:g,onInputChange:y,filterOption:()=>!0,isLoading:E,options:!E&&h||[],noOptionsMessage:m,openMenuOnClick:!1,placeholder:R,defaultValue:n?{id:n,value:n,label:p.userName,header:p}:void 0,inputId:e,isClearable:!0,value:I,styles:{control:r=>({...r,display:"flex !important"}),input:r=>({...r,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:r=>({...r,zIndex:2})},components:ne,onChange:r=>{o&&o((r==null?void 0:r.id)??null,(r==null?void 0:r.header)??null)}})};try{v.displayName="UserSearchBoxV2",v.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((principalId: string | null, header: UserGroupHeader | null) => void)"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"((item: UserGroupHeader) => boolean)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<UserSearchBoxValueType>"}}}}}catch{}export{te as S,v as U,Z as a,$ as u};
