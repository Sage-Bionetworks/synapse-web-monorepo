import{d9 as w,bB as C,da as q,db as h,aH as d,an as o,aI as m,dc as k,aa as r,am as E,r as M,dd as P,ao as A,de as G,df as Q,dg as v}from"./iframe-k9YwU_Xc.js";import{p as I,i as S}from"./pickBy-CBoyaqdZ.js";import{b as L}from"./_baseIteratee-DxLFM1hL.js";import{u as B}from"./useQueries-J55c1hQt.js";import{u as V}from"./useSuspenseQuery-CiFSWrMs.js";import{u as D}from"./useInfiniteQuery-CV6-OEbg.js";import{g as O}from"./InfiniteQueryUtils-CKlRW-xB.js";import{a as R}from"./useEntityBundle-CRLaABuD.js";var J="Expected a function";function U(e){if(typeof e!="function")throw new TypeError(J);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function T(e,t){return I(e,U(L(t)))}const K=(e,t)=>{if(!(C(e)||C(t))&&!(!q(e)||!q(t))&&!(!S(e,void 0)&&!S(t,void 0)))return w(T(e,s=>s===void 0),T(t,s=>s===void 0),K)};function b(e,t){return w(e,t,K)}function x(e,t){const s=new Set;for(const a of e)s.add(a.id);for(const a of t)if(a.id!=null&&!s.has(a.id))throw new Error(`Proposed schema contains a new column model with ID ${a.id} that is not in the old schema.`)}async function N(e,t,s,a){x(s,a);const n=new Map;for(const l of s)n.set(l.id,l);const c=[];for(const l of a){const y={...l};if(y.id!=null){const g=n.get(y.id);g!=null&&!b(g,y)&&delete y.id}c.push(y)}const u=(await h(e,c)).list,i=[],f=new Set;for(let l=0;l<a.length;l++){const y=a[l].id??null,g=u[l].id;y!=null&&f.add(y),f.add(g),y!=null&&y!==g?i.push({oldColumnId:y,newColumnId:g}):y==null&&i.push({oldColumnId:null,newColumnId:g})}for(const l of s){const y=l.id;f.has(y)||i.push({oldColumnId:y,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:t,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:t,changes:i,orderedColumnIds:u.map(l=>l.id)}]}}function ne(e){return e}function _(){const{keyFactory:e,accessToken:t}=o();return(s,a)=>({queryKey:e.getEntityVersionQueryKey(s,a),queryFn:s?()=>r.getEntity(t,s,a==null?void 0:a.toString()):A})}function se(e,t,s){const a=_();return E({...s,...a(e,t)})}function ae(e,t){const{accessToken:s,keyFactory:a}=o(),n=M.useMemo(()=>({queries:e.map(c=>({queryKey:a.getEntityVersionQueryKey(c.id,c.versionNumber),queryFn:()=>r.getEntity(s,c.id,c.versionNumber),options:t}))}),[s,e,a,t]);return B(n)}function ce(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({mutationFn:n=>r.createEntity(n,s),onSuccess:async(n,c,u)=>{const i=a.getEntityQueryKey(n.id);t.setQueryData(i,n),t.setQueryData(a.getEntityLookupQueryKey({parentId:n.parentId,entityName:n.name}),n.id),await k(t,a,n.id,i),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function ue(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:n=>r.updateEntity(n,s),onSuccess:async(n,c,u)=>{const i=a.getEntityQueryKey(n.id);t.setQueryData(i,n),await k(t,a,n.id,i),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function re(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:async n=>{const c=await r.getEntity(s,n);return await r.deleteEntity(s,n),c.parentId},onSuccess:async(n,c,u)=>{await k(t,a,c),n&&await k(t,a,n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function oe(e,t=0,s=200,a){const{accessToken:n,keyFactory:c}=o();return E({...a,queryKey:c.getPaginatedEntityVersionsQueryKey(e,s,t),queryFn:()=>r.getEntityVersions(e,n,t,s)})}function ie(e,t){const{accessToken:a,keyFactory:n}=o();return D({...t,queryKey:n.getEntityVersionsQueryKey(e),queryFn:async c=>await r.getEntityVersions(e,a,c.pageParam,200),initialPageParam:void 0,getNextPageParam:O})}function W(e){return G(e,Q[e.concreteType])}function X(e){return v(e,Q[e.concreteType])}function ye(e,t,s,a){const{accessToken:n,keyFactory:c}=o();return E({...a,queryKey:c.getEntityJsonQueryKey(e,t,s),queryFn:()=>r.getEntityJson(e,t,s,n),select:u=>{const i=W(u),f=X(u);return{entity:u,entityMetadata:i,annotations:f}}})}function le(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:n=>{const c=n.id;return r.updateEntityJson(c,n,s)},onSuccess:async(n,c,u)=>{const i=n.id,f=a.getEntityJsonQueryKey(i,void 0,!1);t.setQueryData(f,n),await k(t,a,i,f),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function fe(e,t){const{accessToken:s,keyFactory:a}=o();return E({...t,queryKey:a.getEntityPathQueryKey(e),queryFn:()=>r.getEntityPath(e,s)})}function de(e,t){const{accessToken:s,keyFactory:a}=o();return E({...t,queryKey:a.getEntityPathQueryKey(e),queryFn:()=>r.getEntityACL(e,s)})}function me(e,t){const{accessToken:s,keyFactory:a}=o();return E({...t,queryKey:a.getEntityAliasQueryKey(e),queryFn:()=>r.getEntityAlias(e,s)})}function Ee(e,t,s){const{accessToken:a,keyFactory:n}=o();return E({...s,queryKey:n.getEntityEvaluationsQueryKey(e),queryFn:()=>r.getAllEntityEvaluations(e,t,a)})}function ge(e,t){const{accessToken:s,keyFactory:a}=o();return E({...t,queryKey:a.getEntityPermissionsQueryKey(e),queryFn:()=>r.getEntityPermissions(e,s)})}const F=async(e,t,s,a)=>{const n=a.getEntityACLQueryKey(e);t&&s.setQueryData(n,t),await k(s,a,e,n)};function ke(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:n=>r.createEntityACL(n,s),onSuccess:async(n,c,u)=>{await F(n.id,n,t,a),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function Fe(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:n=>r.updateEntityACL(n,s),onSuccess:async(n,c,u)=>{await F(n.id,n,t,a),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function Ce(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:n=>r.deleteEntityACL(n,s),onSuccess:async(n,c,u)=>{await F(c,null,t,a),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function $(e){return R(e,void 0,{includeBenefactorACL:!0},s=>s.benefactorAcl)}function qe(e,t){const s=$(e);return V({...t,...s})}function Se(e){const t=d(),{accessToken:s,keyFactory:a}=o();return m({...e,mutationFn:async n=>{const c=await N(s,n.entityId,n.originalColumnModels,n.newColumnModels);return r.updateTable(c,s)},onSuccess:async(n,c,u)=>{await k(t,a,c.entityId),e!=null&&e.onSuccess&&await e.onSuccess(n,c,u)}})}function Te(){const{keyFactory:e,synapseClient:t}=o();return s=>({queryKey:e.getEntityLookupQueryKey(s),queryFn:async()=>{var a;return((a=await P(()=>t.entityServicesClient.postRepoV1EntityChild({entityLookupRequest:s})))==null?void 0:a.id)??null}})}export{qe as a,ke as b,Fe as c,Ce as d,oe as e,Ee as f,ae as g,me as h,de as i,ge as j,ye as k,re as l,fe as m,ie as n,le as o,T as p,ce as q,_ as r,ne as s,Te as t,se as u,ue as v,Se as w};
