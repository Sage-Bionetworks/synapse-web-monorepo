import{j as w}from"./jsx-runtime-Du8NFWEI.js";import{r as o}from"./index-Dl6G-zuu.js";import{u as b,S as v,d as U}from"./Select-49a62830.esm-DLH6iHJo.js";import{b as R}from"./createTheme-C4MKIpuQ.js";import"./index-BIzb42Jq.js";import{l as x,b6 as F,b7 as k,b8 as A}from"./useFiles-4FT4sFfR.js";import{T}from"./VerificationSubmission-CjmU3lv6.js";import"./StringUtils-CkZesiyJ.js";import"./OrientationBanner-BWRDUh7l.js";import{a as H}from"./use-deep-compare-effect.esm-COSQ_O61.js";import{V as L,H as C,I as D,J as P}from"./SynapseConstants-DURRYBQQ.js";import{u as G,c as Y}from"./uniq-Bap7cdtK.js";import{w as M}from"./without-BQ1reD5v.js";import{c as j}from"./UserBadge-Cai-ld_m.js";import{U as _}from"./UserOrTeamBadge-Cc2L6RyQ.js";import{S as q}from"./Skeleton-CW6YXi1_.js";const B=(t,e,n)=>{o.useEffect(()=>{const l=setTimeout(()=>t(),n);return()=>clearTimeout(l)},[...e||[],n])},K={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},J={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},$={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},Q=async(t,e)=>{const n=await F(t,e),s=t.filter(a=>n.results.map(u=>u.id).indexOf(a.targetId)===-1).map(a=>({...J,id:a.targetId,name:`${a.targetId}`}));return[...n.results,...s]},z=async t=>{const e=(await k(t)).children,l=t.filter(s=>e.map(a=>a.ownerId).indexOf(s)===-1).map(s=>({...K,ownerId:s,name:`Unknown User (${s})`}));return[...e,...l]},W=async(t,e)=>{const n=await A({evaluationIds:t},e),s=t.filter(a=>n.results.map(u=>u.id).indexOf(a)===-1).map(a=>({...$,id:a,name:a}));return[...n.results,...s]};function X(t){const{ids:e,type:n}=t,{accessToken:l}=x(),[s,a]=o.useState([]),u=n==="USER_PROFILE"?"ownerId":"id",I=(i=>{switch(i){case"USER_PROFILE":return P;case"ENTITY_HEADER":return D;case"EVALUATION_QUEUE":return C;default:return""}})(n),g=s.map(i=>i[u]),y=e.filter(i=>i!==L),f=G(M(y,...g));return o.useEffect(()=>{(p=>{if(!p.length)return;const d=sessionStorage.getItem(I);try{const S=d?JSON.parse(d):[],E=S.map(c=>c[u]);for(const c of p)E.includes(c[u])||S.push(c);sessionStorage.setItem(I,JSON.stringify(S))}catch{sessionStorage.setItem(I,JSON.stringify(p))}})(s)},[s,u,I]),H(()=>{let i=!1;return(async()=>{if(f.length>0)try{const d=Array.from(f),S=n==="ENTITY_HEADER"?d.map(m=>({targetId:m})):d,E=Y(S,45),c=[];for(const m of E){let h=[];switch(n){case"USER_PROFILE":h=await z(m);break;case"ENTITY_HEADER":h=await Q(m,l);break;case"EVALUATION_QUEUE":h=await W(m,l);break}c.push(...h)}i||a(m=>m.concat(...c))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{i=!0}},[l,n,f]),s}var Z=o.forwardRef(function(t,e){var n=b(t);return o.createElement(v,R({ref:e},n))}),ee=Z;const te={Control:t=>w.jsx(U.Control,{...t,className:`form-control ${t.className??""}`}),SingleValue:t=>{const{data:e}=t;return o.createElement(U.SingleValue,{...t,key:e==null?void 0:e.id},w.jsx(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return o.createElement(U.Option,{...t,key:e==null?void 0:e.id},w.jsx(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}};function N(t){const{inputId:e,defaultValue:n=null,onChange:l,filterPredicate:s,typeFilter:a,placeholder:u,focusOnSelect:O=!1,value:I}=t,[g,y]=o.useState(""),[f,i]=o.useState("");B(()=>{i(g)},[g],500);const[p=void 0]=X({ids:n?[n]:[],type:"USER_PROFILE"}),d=!!f,{data:S,isLoading:E}=j(f,a,{enabled:d}),c=o.useRef(null);o.useEffect(()=>{O&&c.current&&c.current.focus()});const m=o.useMemo(()=>E||g!==f?()=>"Loadingâ€¦":void 0,[E,f,g]),h=(S??[]).filter(s??(()=>!0)).map(r=>({id:r.ownerId.toString(),value:r.ownerId.toString(),label:r.userName,header:r})),V=o.useMemo(()=>u!==void 0?u:a==T.USERS_ONLY?"Name (first and last)":a==T.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[u,a]);return n&&p==null?w.jsx(q,{width:"100%"}):w.jsx(ee,{className:"UserSearchBoxV2",ref:c,inputValue:g,onInputChange:y,filterOption:()=>!0,isLoading:E,options:!E&&h||[],noOptionsMessage:m,openMenuOnClick:!1,placeholder:V,defaultValue:n?{id:n,value:n,label:p.userName,header:p}:void 0,inputId:e,isClearable:!0,value:I,styles:{control:r=>({...r,display:"flex !important"}),input:r=>({...r,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:r=>({...r,zIndex:2})},components:te,onChange:r=>{l&&l((r==null?void 0:r.id)??null,(r==null?void 0:r.header)??null)}})}try{N.displayName="UserSearchBoxV2",N.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((principalId: string | null, header: UserGroupHeader | null) => void)"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"((item: UserGroupHeader) => boolean)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<UserSearchBoxValueType>"}}}}}catch{}export{ee as S,N as U,X as a,B as u};
