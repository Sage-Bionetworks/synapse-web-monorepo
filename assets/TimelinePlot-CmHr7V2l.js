import{j as t}from"./jsx-runtime-Du8NFWEI.js";import{N as Q,bk as b}from"./useFiles-DGDRR3Da.js";import{p as z,g as se}from"./SqlFunctions-DehFgl6w.js";import"./StringUtils-HHDOP9xr.js";import{O as ne,h as $}from"./SynapseConstants-Dk0Mz-dJ.js";import{r as f}from"./index-Dl6G-zuu.js";import{f as re,C as oe}from"./VerificationSubmission-BUSqAuLu.js";import"./OrientationBanner-BOCf4qOE.js";import{g as B}from"./UpsetPlot-DWSd76VA.js";import{B as g}from"./Box-B2XeJDvD.js";import{T as j}from"./Typography-DUswyeAh.js";import{d as A}from"./dayjs.min-d18Up55D.js";import{t as ie}from"./ConfirmationDialog-C8dnnmmh.js";import{P as ae}from"./Plot-DSBVXOLN.js";import{D as le,a as ue}from"./DialogContent-B2GIapEN.js";import"./LeftRightPanel-C_9uiOca.js";import{S as de}from"./TextField-OBkdA2aS.js";import"./ActionRequiredCard-CceG7oRw.js";import{s as ce}from"./styled-_IoEwjFQ.js";import{B as me}from"./Button-BkKUhIiJ.js";import{I as pe}from"./InputLabel-DZDb4c2d.js";import{S as ve}from"./TextField-B3rZxamg.js";import{M as he}from"./MenuItem-BJNXNXXI.js";import{S as E}from"./Skeleton-DiWSb2YA.js";const k=ce(me,{label:"InputSizedButton"})(({theme:e})=>({height:"calc(1.4375em + 33px)",marginTop:e.spacing(3),marginBottom:e.spacing(1.5)}));try{k.displayName="InputSizedButton",k.__docgenInfo={description:"",displayName:"InputSizedButton",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLButtonElement | null) => void) | RefObject<HTMLButtonElement> | null"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const ye=e=>{const[s,a]=f.useState({width:1,height:2});return f.useEffect(()=>{const c=()=>{if(e.current){const i=e.current.getBoundingClientRect(),{width:l,height:o}=i,n=Math.round(l),r=Math.round(o);(s.width!=n||s.height!=r)&&a({width:n,height:r})}};return c(),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[s.height,s.width,e]),s},fe="species",ge="observationphase",V={concreteType:"org.sagebionetworks.repo.model.table.QueryResultBundle",queryResult:{concreteType:"org.sagebionetworks.repo.model.table.QueryResult",queryResults:{concreteType:"org.sagebionetworks.repo.model.table.RowSet",tableId:"syn52408661",etag:"a3270cb2-4373-4e12-9981-e12326e54ad1",headers:[{name:"species",columnType:"STRING",id:"152514"},{name:"observationPhase",columnType:"STRING",id:"197976"},{name:"observationPhaseOrder",columnType:"INTEGER",id:"198102"},{name:"observationTimeMax",columnType:"INTEGER",id:"198103"},{name:"observationTimeUnits",columnType:"STRING",id:"198101"}],rows:[{rowId:9,versionNumber:4,values:["Danio rerio","embryo","1","7","days"]},{rowId:10,versionNumber:4,values:["Danio rerio","larval","2","3","months"]},{rowId:11,versionNumber:4,values:["Danio rerio","juvenile","3","6","months"]},{rowId:12,versionNumber:4,values:["Danio rerio","adult","4","12","months"]},{rowId:16,versionNumber:4,values:["Drosophila","embryo","1","24","hours"]},{rowId:17,versionNumber:4,values:["Drosophila","larval","2","5","days"]},{rowId:18,versionNumber:4,values:["Drosophila","pupal","3","12","days"]},{rowId:19,versionNumber:4,values:["Drosophila","adult","4","5","weeks"]},{rowId:1,versionNumber:4,values:["Mus musculus","prenatal","1","21","days"]},{rowId:2,versionNumber:4,values:["Mus musculus","postnatal","2","6","months"]},{rowId:20,versionNumber:4,values:["Rattus norvegicus","prenatal","1","23","days"]},{rowId:21,versionNumber:4,values:["Rattus norvegicus","neonatal","2","4","weeks"]},{rowId:22,versionNumber:4,values:["Rattus norvegicus","weanling","3","2","months"]},{rowId:23,versionNumber:4,values:["Rattus norvegicus","juvenile","4","3","months"]},{rowId:24,versionNumber:4,values:["Rattus norvegicus","adolescent","5","6","months"]},{rowId:25,versionNumber:4,values:["Rattus norvegicus","adult","6","12","months"]},{rowId:13,versionNumber:4,values:["Saccharomyces","log phase","1","7","days"]},{rowId:14,versionNumber:4,values:["Saccharomyces","stationary phase","2","2","weeks"]},{rowId:15,versionNumber:4,values:["Saccharomyces","death phase","3","3","weeks"]},{rowId:3,versionNumber:4,values:["Sus scrofa","prenatal","1","115","days"]},{rowId:4,versionNumber:4,values:["Sus scrofa","neonatal","2","3","months"]},{rowId:5,versionNumber:4,values:["Sus scrofa","weanling","3","6","months"]},{rowId:6,versionNumber:4,values:["Sus scrofa","juvenile","4","12","months"]},{rowId:7,versionNumber:4,values:["Sus scrofa","adolescent","5","2","years"]},{rowId:8,versionNumber:4,values:["Sus scrofa","adult","6","3","years"]}]}}};var H;const xe=(H=V.queryResult)==null?void 0:H.queryResults.headers.findIndex(e=>e.name.toLowerCase()===fe);var D;const O=(D=V.queryResult)==null?void 0:D.queryResults.headers.findIndex(e=>e.name.toLowerCase()===ge),M=({color:e,phaseName:s})=>t.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:"7px"},children:[t.jsx(g,{sx:{backgroundColor:e,width:"20px",height:"20px"}}),t.jsx(j,{variant:"body1",children:s==null?void 0:s.toUpperCase()})]});try{M.displayName="TimelineLegendItem",M.__docgenInfo={description:"",displayName:"TimelineLegendItem",props:{color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},phaseName:{defaultValue:null,description:"",name:"phaseName",required:!0,type:{name:"string | null"}}}}}catch{}const Ie=(e,s,a,c)=>{let i=-1;return{timepoints:s.map((o,n)=>{const r=parseFloat(o.values[a.observationTime]),u=o.values[a.observationTimeUnits];return o.rowId==c&&(i=n),e.add(r,u)}),hoverOverIndex:i}},q=e=>e.length==0?A().add(1,"days"):e.reduce((s,a)=>!s||a.isAfter(s)?a:s),be=(e,s)=>{if(e.timepoints==null||e.timepoints.length==0)return[{x:[A().format()],y:[.5],mode:"lines",line:{color:"blue",width:2},customdata:[],hoverinfo:"none"}];const a=e.timepoints.reduce((i,l,o)=>{const n=i;return n[l.format()]||(n[l.format()]=[]),n[l.format()].push(s[o]),i},{});return e.timepoints.map((i,l)=>{const o=i.format(),n=l==e.hoverOverIndex,u=a[o].map(m=>m.rowId);return{x:[o,o,o],y:[0,.5,1],mode:"lines",line:{color:n?"black":"gray",width:n?2:1},customdata:[u,u,u],hoverinfo:"none"}})},Te=(e,s,a,c,i,l)=>{const o=c.map(r=>r.x[0]),n=c.map(r=>{const u=r.customdata[0];if(u&&u.length>0){const m=u.length,p=i==null?void 0:i.filter(v=>u[0]==v.rowId);if(p&&p.length>0){const v=p[0],h=parseFloat(v.values[l.observationTime]),T=v.values[l.observationTimeUnits],d=m>1?`(${m})`:"";return`${h} ${T} ${d}`}}return""});return{hovermode:"closest",dragmode:!1,showlegend:!1,xaxis:{showgrid:!1,showticklabels:!0,showline:!1,zeroline:!1,tickvals:o,ticktext:n,tickangle:-45},yaxis:{range:[0,1.25],showgrid:!1,zeroline:!1,showline:!1,showticklabels:!1},shapes:[{type:"rect",x0:e.subtract(s.diff(e)/10).format(),x1:s.add(s.diff(e)/3).format(),y0:.25,y1:.75,fillcolor:a,opacity:.8,line:{width:0}}],margin:{l:0,r:0,t:60,b:60}}},C=({color:e,rowData:s,schema:a,widthPx:c,sql:i})=>{const[l,o]=f.useState(),[n,r]=f.useState(),[u,m]=f.useState(1),p=A(),v=f.useRef(null),h=l==null?void 0:l.points[0].customdata,T=s==null?void 0:s.filter(x=>h==null?void 0:h.includes(x.rowId)),d=n==null?void 0:n.points[0].customdata,N=f.useMemo(()=>Ie(p,s,a,(d==null?void 0:d.length)>0?d[0]:void 0),[d,s,a,p]),y=q(N.timepoints),S=f.useMemo(()=>be(N,s),[N,s]),R=T.map(x=>x.rowId);return t.jsxs("div",{ref:v,style:{width:c},children:[t.jsx(ae,{style:{width:c,height:"220px"},data:S,layout:Te(p,y,e,S,s,a),config:{displayModeBar:!1},useResizeHandler:!0,onClick:x=>{o(x),r(void 0)},onDoubleClick:()=>{m(u+1)},onHover:x=>{r(x)},onUnhover:()=>{r(void 0)}},`Plot-${e}-${u}`),t.jsx(le,{onClose:()=>o(void 0),open:T&&T.length>0,children:t.jsx(ue,{children:t.jsx(ie,{topLevelEnumeratedFacetToFilter:{columnName:"observationType"},sql:i,searchParams:{ROW_ID:R.map(String).join(",")},sqlOperator:re.IN,lockedColumn:{columnName:"ROW_ID"},cardConfiguration:{type:ne},initialLimit:3})})})]})};try{q.displayName="getMaxDate",q.__docgenInfo={description:"",displayName:"getMaxDate",props:{}}}catch{}try{C.displayName="TimelinePhase",C.__docgenInfo={description:"",displayName:"TimelinePhase",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"Row[]"}},schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},widthPx:{defaultValue:null,description:"",name:"widthPx",required:!0,type:{name:"number"}},sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const L=({sql:e,additionalFilters:s,species:a,setSpecies:c})=>{var m,p;const i=z(e),l=Q({entityId:i,query:{sql:`SELECT distinct unnest(species) FROM ${i} WHERE species IS NOT NULL AND observationTime IS NOT NULL GROUP BY species`,additionalFilters:s},partMask:$,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o,isLoading:n}=l,r=(p=(m=o==null?void 0:o.queryResult)==null?void 0:m.queryResults)==null?void 0:p.rows,u=r&&r.length>0?r[0].values[0]:void 0;return a==null&&u!=null&&c(u),n||!r||r.length<2?t.jsx(t.Fragment,{}):t.jsx(g,{children:t.jsxs(de,{children:[t.jsx(pe,{children:"Species"}),t.jsx(ve,{sx:{marginLeft:"2px",marginBottom:"2px"},value:a,label:"Species",onChange:v=>{c(v.target.value)},children:r==null?void 0:r.map(v=>{const h=v.values[0];return t.jsx(he,{value:h,children:h},h)})})]})})};try{L.displayName="TimelinePlotSpeciesSelector",L.__docgenInfo={description:"",displayName:"TimelinePlotSpeciesSelector",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},additionalFilters:{defaultValue:null,description:"",name:"additionalFilters",required:!1,type:{name:"QueryFilter[]"}},species:{defaultValue:null,description:"",name:"species",required:!1,type:{name:"string | null"}},setSpecies:{defaultValue:null,description:"",name:"setSpecies",required:!0,type:{name:"Dispatch<SetStateAction<string | null | undefined>>"}}}}}catch{}const Ne="observationphase",_e="observationtime",Se="observationtimeunits",we="observationsubmittername",Re="observationtext",Ee="observationtype",Oe="synapseid",je="doi",F=({sql:e,searchParams:s,sqlOperator:a,defaultSpecies:c,title:i,subTitle:l})=>{const o=z(e),[n,r]=f.useState(c),u=f.createRef(),m=ye(u),p=se(s,a)??[],v=n?{columnName:"species",concreteType:"org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",values:[n],function:oe.HAS}:void 0,h=[...p];v&&h.push(v);const T=Q({entityId:o,query:{sql:`${e} WHERE observationTime IS NOT NULL`,sort:[{column:"observationTime",direction:"ASC"}],additionalFilters:h},partMask:$,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"},{enabled:!!n}),{data:d,isLoading:N}=T,y=f.useMemo(()=>{var I;if(n)return(I=V.queryResult)==null?void 0:I.queryResults.rows.filter(_=>_.values[xe]==n)},[n]);if(N)return t.jsx(Me,{});const S=b(Ne,d),R=b(_e,d),x=b(Se,d),G=b(we,d),W=b(Re,d),K=b(je,d),Y=b(Ee,d),X=b(Oe,d),J={observationSubmitterName:G,synapseId:X,observationType:Y,observationText:W,observationTime:R,observationTimeUnits:x,doi:K},Z=m.width&&y?m.width/y.length:0,ee=y==null?void 0:y.map(()=>"auto").join(" ");return t.jsxs(t.Fragment,{children:[n&&t.jsxs(t.Fragment,{children:[i&&t.jsx(j,{variant:"h2",children:i}),l&&t.jsx(j,{variant:"body1Italic",sx:{margin:"10px 0px"},children:l})]}),t.jsxs(g,{children:[t.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(g,{children:!c&&t.jsx(L,{setSpecies:r,species:n,sql:e,additionalFilters:p})}),y&&t.jsx(g,{sx:{display:"flex",justifyContent:"flex-end",gap:"25px"},children:y.map((I,w)=>{const{colorPalette:_}=B(w,1);return t.jsx(M,{color:_[0],phaseName:I.values[O]},I.rowId)})})]}),n&&y&&t.jsx("div",{ref:u,children:t.jsx(g,{sx:{display:"inline-grid",gridTemplateColumns:ee,minWidth:m.width,maxWidth:m.width},className:"forcePlotlyDefaultCursor",children:y.map((I,w)=>{var U;const{colorPalette:_}=B(w,1),P=(U=d==null?void 0:d.queryResult)==null?void 0:U.queryResults.rows.filter(te=>te.values[S]==I.values[O]);return P?t.jsx(C,{name:I.values[O],color:_[0],rowData:P,schema:J,widthPx:Z,sql:e},I.rowId):t.jsx(t.Fragment,{})})})})]})]})},Me=()=>t.jsxs(g,{children:[t.jsxs(g,{sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[t.jsx(E,{height:"45px",width:"80px"}),t.jsx(E,{height:"45px",width:"80px"})]}),t.jsx(g,{sx:{display:"flex"},children:t.jsx(E,{height:"150px",width:"100%"})})]});try{F.displayName="TimelinePlot",F.__docgenInfo={description:"",displayName:"TimelinePlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"enum",value:[{value:'"LIKE"'},{value:'"EQUAL"'},{value:'"IN"'},{value:'"HAS"'},{value:'"HAS_LIKE"'}]}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!1,type:{name:"string"}},defaultSpecies:{defaultValue:null,description:"",name:"defaultSpecies",required:!1,type:{name:"string"}}}}}catch{}export{k as I,F as T};
