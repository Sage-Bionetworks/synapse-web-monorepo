import{j as p,dG as Qe,e0 as pe,r as c,cM as Xn,dA as He,c7 as yn,c0 as Bn,c4 as $n,eN as Yn}from"./iframe-r7gAu2bc.js";import{D as Gn}from"./DateTimePicker-CeGWgl_6.js";import{d as Ft}from"./index-Chi_LkuB.js";import{A as vn}from"./Autocomplete-C59pVjW_.js";import{C as Jn}from"./Chip-Da8UDvbq.js";import{c as xn}from"./index-DbESNxNd.js";import{u as Zn}from"./index-B48pW3ir.js";function wt({rowData:e,setRowData:n,disabled:t,colType:o}){return p.jsx(Gn,{disabled:t,value:e?Qe(e):null,onChange:r=>{r==null?n(null):n(o==="number"?Qe(r).valueOf():Qe(r).toISOString())},sx:{pointerEvents:t?"none":void 0,width:"100%",height:"100%","& .MuiInputBase-root":{height:"100%",backgroundColor:"inherit"}}})}function yt({colType:e}){return{component:(n=>p.jsx(wt,{...n,colType:e})),copyValue:({rowData:n})=>n,pasteValue:({value:n})=>n,disableKeys:!0,keepFocus:!0}}try{wt.displayName="DateTimeCell",wt.__docgenInfo={description:"",displayName:"DateTimeCell",props:{rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"any"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean"}},focus:{defaultValue:null,description:"",name:"focus",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},columnData:{defaultValue:null,description:"",name:"columnData",required:!0,type:{name:"any"}},setRowData:{defaultValue:null,description:"",name:"setRowData",required:!0,type:{name:"(rowData: any) => void"}},stopEditing:{defaultValue:null,description:"",name:"stopEditing",required:!0,type:{name:"(opts?: { nextRow?: boolean; }) => void"}},insertRowBelow:{defaultValue:null,description:"",name:"insertRowBelow",required:!0,type:{name:"() => void"}},duplicateRow:{defaultValue:null,description:"",name:"duplicateRow",required:!0,type:{name:"() => void"}},deleteRow:{defaultValue:null,description:"",name:"deleteRow",required:!0,type:{name:"() => void"}},getContextMenuItems:{defaultValue:null,description:"",name:"getContextMenuItems",required:!0,type:{name:"() => ContextMenuItem[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}try{yt.displayName="dateTimeColumn",yt.__docgenInfo={description:"",displayName:"dateTimeColumn",props:{colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}const Qn=(e,n)=>{const t=n.map(({basis:r,minWidth:l,maxWidth:s})=>({basis:r,minWidth:l,maxWidth:s,size:r,violation:0,frozen:!1,factor:0}));let o=t.reduce((r,l)=>r-l.size,e);o>0?n.forEach(({grow:r},l)=>{t[l].factor=r}):o<0&&n.forEach(({shrink:r},l)=>{t[l].factor=r});for(const r of t)r.factor===0&&(r.frozen=!0);for(;t.some(({frozen:r})=>!r);){const r=t.reduce((s,i)=>s+(i.frozen?0:i.factor),0);let l=0;for(const s of t)s.frozen||(s.size+=o*s.factor/r,s.size<s.minWidth?s.violation=s.minWidth-s.size:s.maxWidth!==void 0&&s.size>s.maxWidth?s.violation=s.maxWidth-s.size:s.violation=0,s.size+=s.violation,l+=s.violation);if(l>0)for(const s of t)s.violation>0&&(s.frozen=!0);else if(l<0)for(const s of t)s.violation<0&&(s.frozen=!0);else break;o=t.reduce((s,i)=>s-i.size,e)}return t.map(({size:r})=>r)},er=(e,n)=>{const t=e.map(({basis:o,minWidth:r,maxWidth:l,grow:s,shrink:i})=>[o,r,l,s,i].join(",")).join("|");return c.useMemo(()=>{if(n===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const o=Qn(n,e);let r=0;const l=o.map((s,i)=>(r+=s,i===o.length-1?1/0:r));return{fullWidth:Math.abs(n-r)<.1,columnWidths:o,columnRights:l,totalWidth:r}},[n,t])};var Te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ft.global<"u"?Ft.global:typeof self<"u"?self:{};function Ke(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var et,Tt;function Et(){if(Tt)return et;Tt=1;function e(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}return et=e,et}var tt,Wt;function tr(){if(Wt)return tt;Wt=1;var e=typeof Te=="object"&&Te&&Te.Object===Object&&Te;return tt=e,tt}var nt,Lt;function bn(){if(Lt)return nt;Lt=1;var e=tr(),n=typeof self=="object"&&self&&self.Object===Object&&self,t=e||n||Function("return this")();return nt=t,nt}var rt,qt;function nr(){if(qt)return rt;qt=1;var e=bn(),n=function(){return e.Date.now()};return rt=n,rt}var ot,Pt;function rr(){if(Pt)return ot;Pt=1;var e=/\s/;function n(t){for(var o=t.length;o--&&e.test(t.charAt(o)););return o}return ot=n,ot}var lt,Ut;function or(){if(Ut)return lt;Ut=1;var e=rr(),n=/^\s+/;function t(o){return o&&o.slice(0,e(o)+1).replace(n,"")}return lt=t,lt}var st,Ht;function Cn(){if(Ht)return st;Ht=1;var e=bn(),n=e.Symbol;return st=n,st}var it,Kt;function lr(){if(Kt)return it;Kt=1;var e=Cn(),n=Object.prototype,t=n.hasOwnProperty,o=n.toString,r=e?e.toStringTag:void 0;function l(s){var i=t.call(s,r),d=s[r];try{s[r]=void 0;var h=!0}catch{}var w=o.call(s);return h&&(i?s[r]=d:delete s[r]),w}return it=l,it}var at,Xt;function sr(){if(Xt)return at;Xt=1;var e=Object.prototype,n=e.toString;function t(o){return n.call(o)}return at=t,at}var ut,Bt;function ir(){if(Bt)return ut;Bt=1;var e=Cn(),n=lr(),t=sr(),o="[object Null]",r="[object Undefined]",l=e?e.toStringTag:void 0;function s(i){return i==null?i===void 0?r:o:l&&l in Object(i)?n(i):t(i)}return ut=s,ut}var ct,$t;function ar(){if($t)return ct;$t=1;function e(n){return n!=null&&typeof n=="object"}return ct=e,ct}var dt,Yt;function ur(){if(Yt)return dt;Yt=1;var e=ir(),n=ar(),t="[object Symbol]";function o(r){return typeof r=="symbol"||n(r)&&e(r)==t}return dt=o,dt}var ht,Gt;function cr(){if(Gt)return ht;Gt=1;var e=or(),n=Et(),t=ur(),o=NaN,r=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,s=/^0o[0-7]+$/i,i=parseInt;function d(h){if(typeof h=="number")return h;if(t(h))return o;if(n(h)){var w=typeof h.valueOf=="function"?h.valueOf():h;h=n(w)?w+"":w}if(typeof h!="string")return h===0?h:+h;h=e(h);var C=l.test(h);return C||s.test(h)?i(h.slice(2),C?2:8):r.test(h)?o:+h}return ht=d,ht}var mt,Jt;function Rn(){if(Jt)return mt;Jt=1;var e=Et(),n=nr(),t=cr(),o="Expected a function",r=Math.max,l=Math.min;function s(i,d,h){var w,C,f,S,b,N,M=0,F=!1,O=!1,D=!0;if(typeof i!="function")throw new TypeError(o);d=t(d)||0,e(h)&&(F=!!h.leading,O="maxWait"in h,f=O?r(t(h.maxWait)||0,d):f,D="trailing"in h?!!h.trailing:D);function _(P){var y=w,j=C;return w=C=void 0,M=P,S=i.apply(j,y),S}function k(P){return M=P,b=setTimeout(H,d),F?_(P):S}function A(P){var y=P-N,j=P-M,ae=d-y;return O?l(ae,f-j):ae}function X(P){var y=P-N,j=P-M;return N===void 0||y>=d||y<0||O&&j>=f}function H(){var P=n();if(X(P))return L(P);b=setTimeout(H,A(P))}function L(P){return b=void 0,D&&w?_(P):(w=C=void 0,S)}function T(){b!==void 0&&clearTimeout(b),M=0,w=N=C=b=void 0}function J(){return b===void 0?S:L(n())}function K(){var P=n(),y=X(P);if(w=arguments,C=this,N=P,y){if(b===void 0)return k(N);if(O)return clearTimeout(b),b=setTimeout(H,d),_(N)}return b===void 0&&(b=setTimeout(H,d)),S}return K.cancel=T,K.flush=J,K}return mt=s,mt}var dr=Rn();const hr=Ke(dr);var pt,Zt;function mr(){if(Zt)return pt;Zt=1;var e=Rn(),n=Et(),t="Expected a function";function o(r,l,s){var i=!0,d=!0;if(typeof r!="function")throw new TypeError(t);return n(s)&&(i="leading"in s?!!s.leading:i,d="trailing"in s?!!s.trailing:d),e(r,l,{leading:i,maxWait:l,trailing:d})}return pt=o,pt}var pr=mr();const fr=Ke(pr),gr=(e,n,t,o)=>{switch(n){case"debounce":return hr(e,t,o);case"throttle":return fr(e,t,o);default:return e}};function wr({skipOnMount:e=!1,refreshMode:n,refreshRate:t=1e3,refreshOptions:o,handleWidth:r=!0,handleHeight:l=!0,targetRef:s,observerOptions:i,onResize:d}={}){const h=c.useRef(e),[w,C]=c.useState({width:void 0,height:void 0}),[f,S]=c.useState(s?.current||null);s&&setTimeout(()=>{s.current!==f&&S(s.current)},0);const b=c.useMemo(()=>new Proxy(O=>{O!==f&&S(O)},{get(O,D){return D==="current"?f:O[D]},set(O,D,_){return D==="current"?S(_):O[D]=_,!0}}),[f]),N=c.useCallback((O,D)=>!(O.width===D.width&&O.height===D.height||O.width===D.width&&!l||O.height===D.height&&!r),[r,l]),M=c.useCallback(O=>{if(!(!r&&!l)){if(h.current){h.current=!1;return}O.forEach(D=>{const{width:_,height:k}=D?.contentRect||{};C(A=>N(A,{width:_,height:k})?{width:_,height:k}:A)})}},[r,l,h,N]),F=c.useCallback(gr(M,n,t,o),[M,n,t,o]);return c.useEffect(()=>{let O;return f?(O=new window.ResizeObserver(F),O.observe(f,i)):(w.width||w.height)&&C({width:void 0,height:void 0}),()=>{var D,_,k;(D=O?.disconnect)===null||D===void 0||D.call(O),(k=(_=F).cancel)===null||k===void 0||k.call(_)}},[F,f]),c.useEffect(()=>{d?.(w.width,w.height)},[w]),Object.assign({ref:b},w)}const yr=()=>p.jsx(p.Fragment,{}),vr=()=>!1,Qt=({rowData:e})=>e,xr=()=>null,br=({rowIndex:e})=>p.jsx(p.Fragment,{children:e+1}),ft=()=>!0,Cr=e=>e,Rr=e=>{if(typeof e=="number")return{basis:0,grow:e,shrink:1};if(e.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(e.trim()),shrink:1};if(e.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(e.trim()),grow:1,shrink:1};if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[n,t]=e.trim().split(" ");return{basis:0,grow:parseFloat(n),shrink:parseFloat(t)}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[n,t]=e.trim().split(" ");return{basis:parseFloat(t),grow:parseFloat(n),shrink:1}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[n,t,o]=e.trim().split(" ");return{basis:parseFloat(o),grow:parseFloat(n),shrink:parseFloat(t)}}return{basis:0,grow:1,shrink:1}},Sr=(e,n,t)=>c.useMemo(()=>{const o=[n===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>p.jsx(p.Fragment,{}),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:ft}:{...n,basis:n?.basis??40,grow:n?.grow??0,shrink:n?.shrink??0,minWidth:n?.minWidth??0,title:n?.title??p.jsx("div",{className:"dsg-corner-indicator"}),component:n?.component??br,isCellEmpty:ft},...e];return t&&o.push({...t,basis:t?.basis??40,grow:t?.grow??0,shrink:t?.shrink??0,minWidth:t.minWidth??0,isCellEmpty:ft}),o.map(r=>{const l=r.width!==void 0?Rr(r.width):{basis:void 0,grow:void 0,shrink:void 0};return{...r,basis:r.basis??l.basis??0,grow:r.grow??l.grow??1,shrink:r.shrink??l.shrink??1,minWidth:r.minWidth??100,component:r.component??yr,disableKeys:r.disableKeys??!1,disabled:r.disabled??!1,keepFocus:r.keepFocus??!1,deleteValue:r.deleteValue??Qt,copyValue:r.copyValue??xr,pasteValue:r.pasteValue??Qt,prePasteValues:r.prePasteValues??Cr,isCellEmpty:r.isCellEmpty??vr}})},[n,t,e]);function Pe(e,n,t,o){var r,l=!1,s=0;function i(){r&&clearTimeout(r)}function d(){i(),l=!0}typeof n!="boolean"&&(o=t,t=n,n=void 0);function h(){for(var w=arguments.length,C=new Array(w),f=0;f<w;f++)C[f]=arguments[f];var S=this,b=Date.now()-s;if(l)return;function N(){s=Date.now(),t.apply(S,C)}function M(){r=void 0}o&&!r&&N(),i(),o===void 0&&b>e?N():n!==!0&&(r=setTimeout(o?M:N,o===void 0?e-b:e))}return h.cancel=d,h}function Ir(e,n,t){return t===void 0?Pe(e,n,!1):Pe(e,t,n!==!1)}var en,tn;function Er(){return tn||(tn=1,en=function e(n,t){if(n===t)return!0;if(n&&t&&typeof n=="object"&&typeof t=="object"){if(n.constructor!==t.constructor)return!1;var o,r,l;if(Array.isArray(n)){if(o=n.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!e(n[r],t[r]))return!1;return!0}if(n.constructor===RegExp)return n.source===t.source&&n.flags===t.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===t.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===t.toString();if(l=Object.keys(n),o=l.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[r]))return!1;for(r=o;r--!==0;){var s=l[r];if(!e(n[s],t[s]))return!1}return!0}return n!==n&&t!==t}),en}var Mr=Er();const Sn=Ke(Mr),qe=e=>{const[n,t]=c.useState(e),o=c.useCallback(r=>{t(l=>{const s=typeof r=="function"?r(l):r;return Sn(s,l)?l:s})},[t]);return[n,o]},Dr=(e,n,t)=>{const[o,r]=qe({top:!0,right:!0,bottom:!0,left:!0});return c.useEffect(()=>{const l=Pe(100,()=>{r({top:e.current?.scrollTop===0,right:(e.current?.scrollLeft??0)>=(e.current?.scrollWidth??0)-(n??0)-1,bottom:(e.current?.scrollTop??0)>=(e.current?.scrollHeight??0)-(t??0)-1,left:e.current?.scrollLeft===0})}),s=e.current;return s?.addEventListener("scroll",l),setTimeout(l,100),()=>{s?.removeEventListener("scroll",l),l.cancel()}},[t,n,e,r]),o},he=(e,n)=>{c.useEffect(()=>(document.addEventListener(e,n),()=>{document.removeEventListener(e,n)}),[n,e])},nn=(e,n=200)=>{const t=c.useRef(null),o=c.useMemo(()=>Pe(n,!0,()=>{setTimeout(()=>t.current=e.current?.getBoundingClientRect()||null,0)}),[e,n]);return c.useCallback((r=!1)=>(r?t.current=e.current?.getBoundingClientRect()||null:o(),t.current),[e,o])},In=(e={})=>(({addRows:n})=>{const[t,o]=c.useState(1),[r,l]=c.useState(String(t));return p.jsxs("div",{className:"dsg-add-row",children:[p.jsx("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>n(t),children:e.button??"Add"})," ",p.jsx("input",{className:"dsg-add-row-input",value:r,onBlur:()=>l(String(t)),type:"number",min:1,onChange:s=>{l(s.target.value),o(Math.max(1,Math.round(parseInt(s.target.value)||0)))},onKeyDown:s=>{s.key==="Enter"&&n(t)}})," ",e.unit??"rows"]})}),En=In();En.displayName="AddRows";const Nr=(e,n)=>{const[t,o]=c.useState(e),r=c.useRef();c.useEffect(()=>()=>r.current?.cancel(),[]);const l=c.useMemo(()=>r.current=Ir(n,s=>{o(s)}),[n]);return[t,l]},Mn=e=>e.type==="CUT"?p.jsx(p.Fragment,{children:"Cut"}):e.type==="COPY"?p.jsx(p.Fragment,{children:"Copy"}):e.type==="PASTE"?p.jsx(p.Fragment,{children:"Paste"}):e.type==="DELETE_ROW"?p.jsx(p.Fragment,{children:"Delete row"}):e.type==="DELETE_ROWS"?p.jsxs(p.Fragment,{children:["Delete rows ",p.jsx("b",{children:e.fromRow})," to ",p.jsx("b",{children:e.toRow})]}):e.type==="INSERT_ROW_BELLOW"?p.jsx(p.Fragment,{children:"Insert row below"}):e.type==="DUPLICATE_ROW"?p.jsx(p.Fragment,{children:"Duplicate row"}):e.type==="DUPLICATE_ROWS"?p.jsxs(p.Fragment,{children:["Duplicate rows ",p.jsx("b",{children:e.fromRow})," to ",p.jsx("b",{children:e.toRow})]}):e.type,Mt=(e=Mn)=>(({clientX:n,clientY:t,items:o,close:r})=>{const l=c.useRef(null),s=c.useCallback(i=>{l.current?.contains(i.target)||r()},[r]);return he("mousedown",s),p.jsx("div",{className:"dsg-context-menu",style:{left:n+"px",top:t+"px"},ref:l,children:o.map(i=>p.jsx("div",{onClick:i.action,className:"dsg-context-menu-item",children:e(i)},i.type))})}),Dn=Mt(Mn);Dn.displayName="ContextMenu";const Or=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},Vr=e=>Or.parseFromString(e,"text/html"),gt=e=>{const n=Vr(e.replace(/<br\/?>/g,`
`)),t=n.getElementsByTagName("table")[0];if(t){const r=[];for(let l=0;l<t.rows.length;l++){const s=[];r.push(s);for(let i=0;i<t.rows[l].cells.length;i++)s.push(t.rows[l].cells[i].textContent??"")}return r}const o=n.getElementsByTagName("span")[0];return o?[[o.textContent??""]]:[[""]]},We=e=>{const n=e.replace(/\r|\n$/g,""),t=[[]];let o=0,r=0,l=!1,s=0;const i=()=>{let d=n.slice(r,o);d[0]==='"'&&d[d.length-1]==='"'&&(l=!0),l&&d[d.length-1]==='"'&&d.includes(`
`)&&(d=d.slice(1,d.length-1).replace(/""/g,'"'),l=!1),l&&d[d.length-1]!=='"'?d.split(`
`).forEach((h,w,{length:C})=>{t[s].push(h),w<C-1&&(t.push([]),s++)}):t[s].push(d)};for(;o<n.length;)l&&n[o]==='"'&&![void 0,"	",'"'].includes(n[o+1])&&(l=!1),l&&n[o]==='"'&&n[o+1]==='"'&&o++,o===r&&n[o]==='"'&&(l=!0),n[o]==="	"&&(i(),r=o+1,l=!1),n[o]===`
`&&!l&&(i(),t.push([]),r=o+1,s++),o++;return i(),t},_r=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),kr=e=>e.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null,vt=(e,n,t,o)=>{if(e===null||!n||!t)return null;if(typeof e!="object")throw new Error("Value must be an object or null");const r=o.findIndex(s=>s.id===e.col),l={col:Math.max(0,Math.min(n-1,r===-1?Number(e.col):r-1)),row:Math.max(0,Math.min(t-1,Number(e.row)))};if(isNaN(l.col)||isNaN(l.row))throw new Error("col or cell are not valid positive numbers");return l},De=(e,n)=>e?{col:e.col,row:e.row,colId:n[e.col+1]?.id}:null,Ar=(e,n,t,o)=>{if(e===null||!n||!t)return null;if(typeof e!="object")throw new Error("Value must be an object or null");const r={min:vt(e.min,n,t,o),max:vt(e.max,n,t,o)};if(!r.min||!r.max)throw new Error("min and max must be defined");return r},rn=(e,n)=>e?{min:De(e.min,n),max:De(e.max,n)}:null,on=()=>Array.from(document.querySelectorAll("*")).filter(e=>e instanceof HTMLElement&&typeof e.tabIndex=="number"&&e.tabIndex>=0&&!e.disabled&&(!(e instanceof HTMLAnchorElement)||!!e.href||e.getAttribute("tabIndex")!==null)&&getComputedStyle(e).visibility!=="collapse");function Ee(e,n,t){let o=t.initialDeps??[],r,l=!0;function s(){var i,d,h;let w;t.key&&(i=t.debug)!=null&&i.call(t)&&(w=Date.now());const C=e();if(!(C.length!==o.length||C.some((S,b)=>o[b]!==S)))return r;o=C;let f;if(t.key&&(d=t.debug)!=null&&d.call(t)&&(f=Date.now()),r=n(...C),t.key&&(h=t.debug)!=null&&h.call(t)){const S=Math.round((Date.now()-w)*100)/100,b=Math.round((Date.now()-f)*100)/100,N=b/16,M=(F,O)=>{for(F=String(F);F.length<O;)F=" "+F;return F};console.info(`%câ± ${M(b,5)} /${M(S,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*N,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(l&&t.skipInitialOnChange)&&t.onChange(r),l=!1,r}return s.updateDeps=i=>{o=i},s}function ln(e,n){if(e===void 0)throw new Error("Unexpected undefined");return e}const jr=(e,n)=>Math.abs(e-n)<1.01,zr=(e,n,t)=>{let o;return function(...r){e.clearTimeout(o),o=e.setTimeout(()=>n.apply(this,r),t)}},sn=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Fr=e=>e,Nn=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),o=[];for(let r=n;r<=t;r++)o.push(r);return o},Tr=(e,n)=>{const t=e.scrollElement;if(!t)return;const o=e.targetWindow;if(!o)return;const r=s=>{const{width:i,height:d}=s;n({width:Math.round(i),height:Math.round(d)})};if(r(sn(t)),!o.ResizeObserver)return()=>{};const l=new o.ResizeObserver(s=>{const i=()=>{const d=s[0];if(d?.borderBoxSize){const h=d.borderBoxSize[0];if(h){r({width:h.inlineSize,height:h.blockSize});return}}r(sn(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return l.observe(t,{box:"border-box"}),()=>{l.unobserve(t)}},an={passive:!0},un=typeof window>"u"?!0:"onscrollend"in window,Wr=(e,n)=>{const t=e.scrollElement;if(!t)return;const o=e.targetWindow;if(!o)return;let r=0;const l=e.options.useScrollendEvent&&un?()=>{}:zr(o,()=>{n(r,!1)},e.options.isScrollingResetDelay),s=w=>()=>{const{horizontal:C,isRtl:f}=e.options;r=C?t.scrollLeft*(f&&-1||1):t.scrollTop,l(),n(r,w)},i=s(!0),d=s(!1);t.addEventListener("scroll",i,an);const h=e.options.useScrollendEvent&&un;return h&&t.addEventListener("scrollend",d,an),()=>{t.removeEventListener("scroll",i),h&&t.removeEventListener("scrollend",d)}},Lr=(e,n,t)=>{if(n?.borderBoxSize){const o=n.borderBoxSize[0];if(o)return Math.round(o[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},qr=(e,{adjustments:n=0,behavior:t},o)=>{var r,l;const s=e+n;(l=(r=o.scrollElement)==null?void 0:r.scrollTo)==null||l.call(r,{[o.options.horizontal?"left":"top"]:s,behavior:t})};class Pr{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const o=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(r=>{r.forEach(l=>{const s=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(s):s()})}));return{disconnect:()=>{var r;(r=o())==null||r.disconnect(),t=null},observe:r=>{var l;return(l=o())==null?void 0:l.observe(r,{box:"border-box"})},unobserve:r=>{var l;return(l=o())==null?void 0:l.unobserve(r)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([o,r])=>{typeof r>"u"&&delete t[o]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Fr,rangeExtractor:Nn,onChange:()=>{},measureElement:Lr,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var o,r;(r=(o=this.options).onChange)==null||r.call(o,this,t)},this.maybeNotify=Ee(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const o=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==o){if(this.cleanup(),!o){this.maybeNotify();return}this.scrollElement=o,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(r=>{this.observer.observe(r)}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(r,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<r?"forward":"backward":null,this.scrollOffset=r,this.isScrolling=l,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,o)=>{const r=new Map,l=new Map;for(let s=o-1;s>=0;s--){const i=t[s];if(r.has(i.lane))continue;const d=l.get(i.lane);if(d==null||i.end>d.end?l.set(i.lane,i):i.end<d.end&&r.set(i.lane,!0),r.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((s,i)=>s.end===i.end?s.index-i.index:s.end-i.end)[0]:void 0},this.getMeasurementOptions=Ee(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,o,r,l,s,i)=>(this.prevLanes!==void 0&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:o,scrollMargin:r,getItemKey:l,enabled:s,lanes:i}),{key:!1}),this.getMeasurements=Ee(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:o,scrollMargin:r,getItemKey:l,enabled:s,lanes:i},d)=>{if(!s)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const f of this.laneAssignments.keys())f>=t&&this.laneAssignments.delete(f);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(f=>{this.itemSizeCache.set(f.key,f.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const w=this.measurementsCache.slice(0,h),C=new Array(i).fill(void 0);for(let f=0;f<h;f++){const S=w[f];S&&(C[S.lane]=f)}for(let f=h;f<t;f++){const S=l(f),b=this.laneAssignments.get(f);let N,M;if(b!==void 0&&this.options.lanes>1){N=b;const _=C[N],k=_!==void 0?w[_]:void 0;M=k?k.end+this.options.gap:o+r}else{const _=this.options.lanes===1?w[f-1]:this.getFurthestMeasurement(w,f);M=_?_.end+this.options.gap:o+r,N=_?_.lane:f%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(f,N)}const F=d.get(S),O=typeof F=="number"?F:this.options.estimateSize(f),D=M+O;w[f]={index:f,start:M,size:O,end:D,key:S,lane:N},C[N]=f}return this.measurementsCache=w,w},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ee(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,o,r,l)=>this.range=t.length>0&&o>0?Ur({measurements:t,outerSize:o,scrollOffset:r,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ee(()=>{let t=null,o=null;const r=this.calculateRange();return r&&(t=r.startIndex,o=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,o]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,o]},(t,o,r,l,s)=>l===null||s===null?[]:t({startIndex:l,endIndex:s,overscan:o,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const o=this.options.indexAttribute,r=t.getAttribute(o);return r?parseInt(r,10):(console.warn(`Missing attribute name '${o}={index}' on measured element.`),-1)},this._measureElement=(t,o)=>{const r=this.indexFromElement(t),l=this.measurementsCache[r];if(!l)return;const s=l.key,i=this.elementsCache.get(s);i!==t&&(i&&this.observer.unobserve(i),this.observer.observe(t),this.elementsCache.set(s,t)),t.isConnected&&this.resizeItem(r,this.options.measureElement(t,o,this))},this.resizeItem=(t,o)=>{const r=this.measurementsCache[t];if(!r)return;const l=this.itemSizeCache.get(r.key)??r.size,s=o-l;s!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(r,s,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=s,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,o)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((o,r)=>{o.isConnected||(this.observer.unobserve(o),this.elementsCache.delete(r))});return}this._measureElement(t,void 0)},this.getVirtualItems=Ee(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,o)=>{const r=[];for(let l=0,s=t.length;l<s;l++){const i=t[l],d=o[i];r.push(d)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const o=this.getMeasurements();if(o.length!==0)return ln(o[On(0,o.length-1,r=>ln(o[r]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,o,r=0)=>{if(!this.scrollElement)return 0;const l=this.getSize(),s=this.getScrollOffset();o==="auto"&&(o=t>=s+l?"end":"start"),o==="center"?t+=(r-l)/2:o==="end"&&(t-=l);const i=this.getMaxScrollOffset();return Math.max(Math.min(i,t),0)},this.getOffsetForIndex=(t,o="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const r=this.measurementsCache[t];if(!r)return;const l=this.getSize(),s=this.getScrollOffset();if(o==="auto")if(r.end>=s+l-this.options.scrollPaddingEnd)o="end";else if(r.start<=s+this.options.scrollPaddingStart)o="start";else return[s,o];if(o==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),o];const i=o==="end"?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,o,r.size),o]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:o="start",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,o),{adjustments:void 0,behavior:r})},this.scrollToIndex=(t,{align:o="auto",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let l=0;const s=10,i=h=>{if(!this.targetWindow)return;const w=this.getOffsetForIndex(t,h);if(!w){console.warn("Failed to get offset for index:",t);return}const[C,f]=w;this._scrollToOffset(C,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const S=()=>{if(this.currentScrollToIndex!==t)return;const b=this.getScrollOffset(),N=this.getOffsetForIndex(t,f);if(!N){console.warn("Failed to get offset for index:",t);return}jr(N[0],b)||d(f)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(S):S()})},d=h=>{this.targetWindow&&this.currentScrollToIndex===t&&(l++,l<s?this.targetWindow.requestAnimationFrame(()=>i(h)):console.warn(`Failed to scroll to index ${t} after ${s} attempts.`))};i(o)},this.scrollBy=(t,{behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:o})},this.getTotalSize=()=>{var t;const o=this.getMeasurements();let r;if(o.length===0)r=this.options.paddingStart;else if(this.options.lanes===1)r=((t=o[o.length-1])==null?void 0:t.end)??0;else{const l=Array(this.options.lanes).fill(null);let s=o.length-1;for(;s>=0&&l.some(i=>i===null);){const i=o[s];l[i.lane]===null&&(l[i.lane]=i.end),s--}r=Math.max(...l.filter(i=>i!==null))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:o,behavior:r})=>{this.options.scrollToFn(t,{behavior:r,adjustments:o},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(n)}}const On=(e,n,t,o)=>{for(;e<=n;){const r=(e+n)/2|0,l=t(r);if(l<o)e=r+1;else if(l>o)n=r-1;else return r}return e>0?e-1:0};function Ur({measurements:e,outerSize:n,scrollOffset:t,lanes:o}){const r=e.length-1,l=d=>e[d].start;if(e.length<=o)return{startIndex:0,endIndex:r};let s=On(0,r,l,t),i=s;if(o===1)for(;i<r&&e[i].end<t+n;)i++;else if(o>1){const d=Array(o).fill(0);for(;i<r&&d.some(w=>w<t+n);){const w=e[i];d[w.lane]=w.end,i++}const h=Array(o).fill(t+n);for(;s>=0&&h.some(w=>w>=t);){const w=e[s];h[w.lane]=w.start,s--}s=Math.max(0,s-s%o),i=Math.min(r,i+(o-1-i%o))}return{startIndex:s,endIndex:i}}const cn=typeof document<"u"?c.useLayoutEffect:c.useEffect;function Hr({useFlushSync:e=!0,...n}){const t=c.useReducer(()=>({}),{})[1],o={...n,onChange:(l,s)=>{var i;e&&s?Xn.flushSync(t):t(),(i=n.onChange)==null||i.call(n,l,s)}},[r]=c.useState(()=>new Pr(o));return r.setOptions(o),cn(()=>r._didMount(),[]),cn(()=>r._willUpdate()),r}function dn(e){return Hr({observeElementRect:Tr,observeElementOffset:Wr,scrollToFn:qr,...e})}var hn={exports:{}},mn;function Kr(){return mn||(mn=1,(function(e){(function(){var n={}.hasOwnProperty;function t(){for(var l="",s=0;s<arguments.length;s++){var i=arguments[s];i&&(l=r(l,o(i)))}return l}function o(l){if(typeof l=="string"||typeof l=="number")return l;if(typeof l!="object")return"";if(Array.isArray(l))return t.apply(null,l);if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]"))return l.toString();var s="";for(var i in l)n.call(l,i)&&l[i]&&(s=r(s,i));return s}function r(l,s){return s?l?l+" "+s:l+s:l}e.exports?(t.default=t,e.exports=t):window.classNames=t})()})(hn)),hn.exports}var Xr=Kr();const Q=Ke(Xr),pn=({children:e,gutter:n,stickyRight:t,active:o,disabled:r,className:l,width:s,left:i})=>p.jsx("div",{className:Q("dsg-cell",n&&"dsg-cell-gutter",r&&"dsg-cell-disabled",n&&o&&"dsg-cell-gutter-active",t&&"dsg-cell-sticky-right",l),style:{width:s,left:t?void 0:i},children:e}),Le=(e,n)=>c.useMemo(()=>{const t=new Map;return o=>(t.has(o)||t.set(o,(...r)=>{e(o,...r.slice(0,n))}),t.get(o))},[n,e]),Br=({data:e,columns:n,outerRef:t,innerRef:o,columnWidths:r,hasStickyRightColumn:l,displayHeight:s,headerRowHeight:i,rowHeight:d,rowKey:h,fullWidth:w,selection:C,activeCell:f,rowClassName:S,cellClassName:b,children:N,editing:M,getContextMenuItems:F,setRowData:O,deleteRows:D,duplicateRows:_,insertRowAfter:k,stopEditing:A,onScroll:X})=>{const H=dn({count:e.length,getScrollElement:()=>t.current,paddingStart:i,estimateSize:E=>d(E).height,getItemKey:E=>{if(h&&E>0){const $=e[E-1];if(typeof h=="function")return h({rowData:$,rowIndex:E});if(typeof h=="string"&&$ instanceof Object&&h in $){const B=$[h];if(typeof B=="string"||typeof B=="number")return B}}return E},overscan:5}),L=dn({count:n.length,getScrollElement:()=>t.current,estimateSize:E=>r?.[E]??100,horizontal:!0,getItemKey:E=>n[E].id??E,overscan:1,rangeExtractor:E=>{const $=Nn(E);return $[0]!==0&&$.unshift(0),l&&$[$.length-1]!==n.length-1&&$.push(n.length-1),$}});c.useEffect(()=>{L.measure()},[L,r]);const T=Le(O,1),J=Le(D,0),K=Le(_,0),P=Le(k,0),y=C?.min.col??f?.col,j=C?.max.col??f?.col,ae=C?.min.row??f?.row,te=C?.max.row??f?.row;return p.jsx("div",{ref:t,className:"dsg-container",onScroll:X,style:{height:s},children:p.jsxs("div",{ref:o,style:{width:w?"100%":L.getTotalSize(),height:H.getTotalSize()},children:[i>0&&p.jsx("div",{className:Q("dsg-row","dsg-row-header"),style:{width:w?"100%":L.getTotalSize(),height:i},children:L.getVirtualItems().map(E=>p.jsx(pn,{gutter:E.index===0,stickyRight:l&&E.index===n.length-1,width:E.size,left:E.start,className:Q("dsg-cell-header",y!==void 0&&j!==void 0&&y<=E.index-1&&j>=E.index-1&&"dsg-cell-header-active",n[E.index].headerClassName),children:p.jsx("div",{className:"dsg-cell-header-container",children:n[E.index].title})},E.key))}),H.getVirtualItems().map(E=>{const $=E.index>=(ae??1/0)&&E.index<=(te??-1/0);return p.jsx("div",{className:Q("dsg-row",typeof S=="string"?S:null,typeof S=="function"?S({rowData:e[E.index],rowIndex:E.index}):null),style:{height:E.size,top:E.start,width:w?"100%":L.getTotalSize()},children:L.getVirtualItems().map(B=>{const Ne=n[B.index].cellClassName,ie=n[B.index].disabled,Xe=n[B.index].component,Oe=ie===!0||typeof ie=="function"&&ie({rowData:e[E.index],rowIndex:E.index}),Ve=f?.row===E.index&&f.col===B.index-1;return p.jsx(pn,{gutter:B.index===0,stickyRight:l&&B.index===n.length-1,active:B.index===0&&$,disabled:Oe,className:Q(typeof Ne=="function"?Ne({rowData:e[E.index],rowIndex:E.index,columnId:n[B.index].id}):Ne,typeof b=="function"?b({rowData:e[E.index],rowIndex:E.index,columnId:n[B.index].id}):b),width:B.size,left:B.start,children:p.jsx(Xe,{rowData:e[E.index],getContextMenuItems:F,disabled:Oe,active:Ve,columnIndex:B.index-1,rowIndex:E.index,focus:Ve&&M,deleteRow:J(E.index),duplicateRow:K(E.index),stopEditing:A,insertRowBelow:P(E.index),setRowData:T(E.index),columnData:n[B.index].columnData})},B.key)})},E.key)}),N]})})},fn=(e,n,t,o)=>[[o,e],[n,e],[n,t],[o,t],[o,e]],$r=(e,n,t,o)=>`polygon(evenodd, ${[...fn(0,"100%","100%",0),...fn(e,n,t,o)].map(r=>r.map(l=>typeof l=="number"&&l!==0?l+"px":l).join(" ")).join(",")})`,Vn=pe.memo(({columnWidths:e,columnRights:n,headerRowHeight:t,selection:o,rowHeight:r,activeCell:l,hasStickyRightColumn:s,dataLength:i,viewWidth:d,viewHeight:h,contentWidth:w,edges:C,isCellDisabled:f,editing:S,expandSelection:b})=>{const N=l?f(l):!1,M=c.useMemo(()=>{if(!o)return N;for(let L=o.min.col;L<=o.max.col;++L)for(let T=o.min.row;T<=o.max.row;++T)if(!f({col:L,row:T}))return!1;return!0},[N,f,o]);if(!e||!n)return null;const F=L=>L<i-1?1:0,O=L=>L<e.length-(s?3:2)?1:0,D=l&&{width:e[l.col+1]+O(l.col),height:r(l.row).height+F(l.row),left:n[l.col],top:r(l.row).top+t},_=o&&{width:e.slice(o.min.col+1,o.max.col+2).reduce((L,T)=>L+T)+O(o.max.col),height:r(o.max.row).top+r(o.max.row).height-r(o.min.row).top+F(o.max.row),left:n[o.min.col],top:r(o.min.row).top+t},k=o?.min||l,A=o?.max||l,X=A&&b!==null&&{left:n[A.col]+e[A.col+1],top:r(A.row).top+r(A.row).height+t,transform:`translate(-${A.col<e.length-(s?3:2)?50:100}%, -${A.row<i-1?50:100}%)`},H=k&&A&&b!==null&&{width:e.slice(k.col+1,A.col+2).reduce((L,T)=>L+T)+O(A.col),height:r(A.row+b).top+r(A.row+b).height-r(A.row+1).top+F(A.row+b)-1,left:n[k.col],top:r(A.row).top+r(A.row).height+t+1};return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"dsg-scrollable-view-container",style:{height:r(i-1).top+r(i-1).height+t,width:w||"100%"},children:p.jsx("div",{className:Q({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!C.top,"dsg-scrollable-view-r":!C.right,"dsg-scrollable-view-b":!C.bottom,"dsg-scrollable-view-l":!C.left}),style:{top:t,left:e[0],height:h?h-t:0,width:w&&d?d-e[0]-(s?e[e.length-1]:0):`calc(100% - ${e[0]+(s?e[e.length-1]:0)}px)`}})}),(_||D)&&p.jsx("div",{className:"dsg-selection-col-marker-container",style:{left:_?.left??D?.left,width:_?.width??D?.width,height:r(i-1).top+r(i-1).height+t},children:p.jsx("div",{className:Q("dsg-selection-col-marker",M&&"dsg-selection-col-marker-disabled"),style:{top:t}})}),(_||D)&&p.jsx("div",{className:"dsg-selection-row-marker-container",style:{top:_?.top??D?.top,height:_?.height??D?.height,width:w||"100%"},children:p.jsx("div",{className:Q("dsg-selection-row-marker",M&&"dsg-selection-row-marker-disabled"),style:{left:e[0]}})}),D&&l&&p.jsx("div",{className:Q("dsg-active-cell",{"dsg-active-cell-focus":S,"dsg-active-cell-disabled":N}),style:D}),_&&D&&p.jsx("div",{className:Q("dsg-selection-rect",M&&"dsg-selection-rect-disabled"),style:{..._,clipPath:$r(D.top-_.top,D.left-_.left,D.top+D.height-_.top,D.left+D.width-_.left)}}),H&&p.jsx("div",{className:Q("dsg-expand-rows-rect"),style:H}),X&&p.jsx("div",{className:Q("dsg-expand-rows-indicator",M&&"dsg-expand-rows-indicator-disabled"),style:X})]})});Vn.displayName="SelectionRect";const Yr=({value:e,rowHeight:n})=>{const t=c.useRef([]),[,o]=c.useState(0);return c.useMemo(()=>{const r=l=>{if(typeof n=="number")return Math.min(e.length-1,Math.max(-1,Math.floor(l/n)));let s=0,i=t.current.length-1;for(;s<=i;){const d=Math.floor((s+i)/2);if(t.current[d].top<l)s=d+1;else if(t.current[d].top>l)i=d-1;else return d}if(i===t.current.length-1&&e.length>t.current.length&&(!t.current.length||l>=t.current[i].top+t.current[i].height)){let d=i===-1?0:t.current[i].top+t.current[i].height;do{i++;const h=n({rowIndex:i,rowData:e[i]});t.current.push({height:h,top:d}),d+=h}while(d<=l&&i<t.current.length-1)}return i};return{resetAfter:l=>{t.current=t.current.slice(0,l),o(s=>s+1)},getRowSize:l=>{if(typeof n=="number")return{height:n,top:n*l};if(l>=e.length)return{height:0,top:0};if(l<t.current.length)return t.current[l];let s=t.current[t.current.length-1].top+t.current[t.current.length-1].height;for(let i=t.current.length;i<=l;i++){const d=n({rowIndex:i,rowData:e[i]});t.current.push({height:d,top:s}),s+=d}return t.current[l]},getRowIndex:r,totalSize:l=>{if(typeof n=="number")return e.length*n;const s=r(l);return t.current[s].top+t.current[s].height}}},[n,e])},Gr=[],Jr=[],Zr=()=>({}),Ae=()=>null,Qr=({rowData:e})=>({...e}),Dt=pe.memo(pe.forwardRef(({value:e=Gr,className:n,style:t,height:o=400,onChange:r=Ae,columns:l=Jr,rowHeight:s=40,headerRowHeight:i=typeof s=="number"?s:40,gutterColumn:d,stickyRightColumn:h,rowKey:w,addRowsComponent:C=En,createRow:f=Zr,autoAddRow:S=!1,lockRows:b=!1,disableExpandSelection:N=!1,disableSmartDelete:M=!1,duplicateRow:F=Qr,contextMenuComponent:O=Dn,disableContextMenu:D=!1,onFocus:_=Ae,onBlur:k=Ae,onActiveCellChange:A=Ae,onSelectionChange:X=Ae,rowClassName:H,cellClassName:L,onScroll:T},J)=>{const K=c.useRef(null),P=D||b,y=Sr(l,d,h),j=!!h,ae=c.useRef(null),te=c.useRef(null),E=c.useRef(null),$=c.useRef(null),[B,Ne]=Nr(1,100),{getRowSize:ie,totalSize:Xe,getRowIndex:Oe}=Yr({value:e,rowHeight:s}),Ve=Math.min(o,i+Xe(o)+B),{width:ye,height:ge}=wr({targetRef:te,refreshMode:"throttle",refreshRate:100});Ne(ge?Ve-ge:0);const An=Dr(te,ye,ge),{fullWidth:Vt,totalWidth:jn,columnWidths:oe,columnRights:se}=er(y,ye),[ve,le]=c.useState(null),[xe,zn]=c.useState([]),[U,Y]=c.useState(!1),[be,_t]=c.useState(0),[Ce,kt]=c.useState(null),[m,q]=qe(null),[Z,W]=qe(null),v=c.useMemo(()=>m&&Z&&{min:{col:Math.min(m.col,Z.col),row:Math.min(m.row,Z.row)},max:{col:Math.max(m.col,Z.col),row:Math.max(m.row,Z.row)}},[m,Z]),[ue,Re]=qe({columns:!1,rows:!1,active:!1}),Fn=N||U||ue.active||m?.row===e?.length-1||v?.max.row===e?.length-1||m&&y.slice((v?.min.col??m.col)+1,(v?.max.col??m.col)+2).every(a=>a.disabled===!0)?null:be,At=nn(ae),jt=nn(te);c.useEffect(()=>{m!==null&&(document.activeElement.blur(),window.getSelection()?.removeAllRanges())},[m!==null]);const we=c.useCallback((a,u=!1,x=!1)=>{const g=At(u),V=x&&jt(u);if(g&&se&&oe){let R=a.clientX-g.left,z=a.clientY-g.top;return V&&(a.clientY-V.top<=i&&(z=0),a.clientX-V.left<=oe[0]&&(R=0),j&&V.right-a.clientX<=oe[oe.length-1]&&(R=se[se.length-2]+1)),{col:se.findIndex(I=>R<I)-1,row:Oe(z-i)}}return null},[se,oe,e.length,At,jt,i,j,Oe]),ne=c.useRef(e);ne.current=e;const re=c.useCallback(a=>{const u=y[a.col+1].disabled;return!!(typeof u=="function"?u({rowData:ne.current[a.row],rowIndex:a.row}):u)},[y]),ce=c.useCallback((a,u=1)=>{b||(W(null),Y(!1),r([...ne.current.slice(0,a+1),...new Array(u).fill(0).map(f),...ne.current.slice(a+1)],[{type:"CREATE",fromRowIndex:a+1,toRowIndex:a+1+u}]),q(x=>({col:x?.col||0,row:a+u,doNotScrollX:!0})))},[f,b,r,q,W]),Se=c.useCallback((a,u=a)=>{b||(r([...ne.current.slice(0,u+1),...ne.current.slice(a,u+1).map((x,g)=>F({rowData:x,rowIndex:g+a})),...ne.current.slice(u+1)],[{type:"CREATE",fromRowIndex:u+1,toRowIndex:u+2+u-a}]),q({col:0,row:u+1,doNotScrollX:!0}),W({col:y.length-(j?3:2),row:2*u-a+1,doNotScrollX:!0}),Y(!1))},[y.length,F,b,r,q,W,j]),de=c.useCallback(a=>{if(!(!ge||!ye)){if(!a.doNotScrollY){const u=ie(a.row).top,x=ie(a.row).top+ie(a.row).height+i-ge+1,g=te.current.scrollTop;g>u?te.current.scrollTop=u:g<x&&(te.current.scrollTop=x)}if(se&&oe&&te.current&&!a.doNotScrollX){const u=se[a.col]-se[0],x=se[a.col]+oe[a.col+1]+(j?oe[oe.length-1]:0)-ye+1,g=te.current.scrollLeft;g>u?te.current.scrollLeft=u:g<x&&(te.current.scrollLeft=x)}}},[ge,ye,i,se,oe,ie,j]);c.useEffect(()=>{Z&&de(Z)},[Z,de]),c.useEffect(()=>{m&&de(m)},[m,de]);const Tn=c.useCallback((a,u)=>{r([...ne.current?.slice(0,a),u,...ne.current?.slice(a+1)],[{type:"UPDATE",fromRowIndex:a,toRowIndex:a+1}])},[r]),Ie=c.useCallback((a,u=a)=>{b||(Y(!1),q(x=>{const g=Math.min(ne.current.length-2-u+a,a);return g<0?null:x&&{col:x.col,row:g}}),W(null),r([...ne.current.slice(0,a),...ne.current.slice(u+1)],[{type:"DELETE",fromRowIndex:a,toRowIndex:u+1}]))},[b,r,q,W]),Fe=c.useCallback((a=!0)=>{const u=a&&!M;if(!m)return;const x=v?.min||m,g=v?.max||m;if(e.slice(x.row,g.row+1).every((R,z)=>y.every(I=>I.isCellEmpty({rowData:R,rowIndex:z+x.row})))){u&&Ie(x.row,g.row);return}const V=[...e];for(let R=x.row;R<=g.row;++R)for(let z=x.col;z<=g.col;++z)if(!re({col:z,row:R})){const{deleteValue:I=({rowData:G})=>G}=y[z+1];V[R]=I({rowData:V[R],rowIndex:R})}if(u&&Sn(V,e)){q({col:0,row:x.row,doNotScrollX:!0}),W({col:y.length-(j?3:2),row:g.row,doNotScrollX:!0});return}r(V,[{type:"UPDATE",fromRowIndex:x.row,toRowIndex:g.row+1}])},[m,y,e,Ie,re,r,v?.max,v?.min,q,W,j]),Be=c.useCallback(({nextRow:a=!0}={})=>{m?.row===ne.current.length-1?a&&S?ce(m.row):Y(!1):(Y(!1),a&&q(u=>u&&{col:u.col,row:u.row+1}))},[m?.row,S,ce,q]),_e=c.useCallback(async a=>{if(!U&&m){const u=[],x=v?.min||m,g=v?.max||m;for(let I=x.row;I<=g.row;++I){u.push([]);for(let G=x.col;G<=g.col;++G){const{copyValue:ee=()=>null}=y[G+1];u[I-x.row].push(ee({rowData:e[I],rowIndex:I}))}}const V=u.map(I=>I.join("	")).join(`
`),R=`<table>${u.map(I=>`<tr>${I.map(G=>`<td>${_r(String(G??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(a!==void 0){a.clipboardData?.setData("text/plain",V),a.clipboardData?.setData("text/html",R),a.preventDefault();return}let z=!1;if(navigator.clipboard.write!==void 0){const I=new Blob([V],{type:"text/plain"}),G=new Blob([R],{type:"text/html"}),ee=[new ClipboardItem({"text/plain":I,"text/html":G})];await navigator.clipboard.write(ee).then(()=>{z=!0})}else navigator.clipboard.writeText!==void 0?await navigator.clipboard.writeText(V).then(()=>{z=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(z=!0);z||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}},[m,y,e,U,v]);he("copy",_e);const $e=c.useCallback(a=>{!U&&m&&(_e(a),Fe(!1))},[m,Fe,U,_e]);he("cut",$e);const ke=c.useCallback(async a=>{if(!U&&m){const u=v?.min||m,x=v?.max||m,g=await Promise.all(a[0].map((V,R)=>{const z=y[u.col+R+1]?.prePasteValues,I=a.map(G=>G[R]);return z?.(I)??I}));if(a=a.map((V,R)=>g.map(z=>z[R])),a.length===1){const V=[...e];for(let R=0;R<a[0].length;R++){const z=y[u.col+R+1]?.pasteValue;if(z)for(let I=u.row;I<=x.row;I++)re({col:R+u.col,row:I})||(V[I]=await z({rowData:V[I],value:a[0][R],rowIndex:I}))}r(V,[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:x.row+1}]),q({col:u.col,row:u.row}),W({col:Math.min(u.col+a[0].length-1,y.length-(j?3:2)),row:x.row})}else{let V=[...e];const R=u.row+a.length-e.length;R>0&&(b?a.splice(a.length-R,R):V=[...V,...new Array(R).fill(0).map(()=>f())]);for(let I=0;I<a[0].length&&u.col+I<y.length-(j?2:1);I++){const G=y[u.col+I+1]?.pasteValue;if(G)for(let ee=0;ee<a.length;ee++)re({col:u.col+I,row:u.row+ee})||(V[u.row+ee]=await G({rowData:V[u.row+ee],value:a[ee][I],rowIndex:u.row+ee}))}const z=[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:u.row+a.length-(!b&&R>0?R:0)}];R>0&&!b&&z.push({type:"CREATE",fromRowIndex:u.row+a.length-R,toRowIndex:u.row+a.length}),r(V,z),q({col:u.col,row:u.row}),W({col:Math.min(u.col+a[0].length-1,y.length-(j?3:2)),row:u.row+a.length-1})}}},[m,y,f,e,U,j,re,b,r,v?.max,v?.min,q,W]),Wn=c.useCallback(a=>{if(m&&!U){let u=[[""]];a.clipboardData?.types.includes("text/html")?u=gt(a.clipboardData?.getData("text/html")):a.clipboardData?.types.includes("text/plain")?u=We(a.clipboardData?.getData("text/plain")):a.clipboardData?.types.includes("text")&&(u=We(a.clipboardData?.getData("text"))),ke(u),a.preventDefault()}},[m,ke,U]);he("paste",Wn);const Ln=c.useCallback(a=>{if(ve&&xe.length)return;const u=a.button===2||a.button===0&&a.ctrlKey,x=ae.current?.contains(a.target)||!1,g=x?we(a,!0,!0):null;if(!x&&U&&m&&y[m.col+1].keepFocus)return;if(a.target instanceof HTMLElement&&a.target.className.includes("dsg-expand-rows-indicator")){kt(Math.max(m?.row??0,v?.max.row??0));return}const V=g&&m&&m.col===g.col&&m.row===g.row&&!re(m);if(V&&U)return;const R=g?.col===y.length-2&&j,z=u&&v&&g&&g.row>=v.min.row&&g.row<=v.max.row&&g.col>=v.min.col&&g.col<=v.max.col,I=u&&v&&g&&g.row===-1&&g.col>=v.min.col&&g.col<=v.max.col,G=u&&v&&g&&g.row>=v.min.row&&g.row<=v.max.row&&g.col===-1,ee=R&&v&&g&&g.row>=v.min.row&&g.row<=v.max.row;if(u&&!P&&le({x:a.clientX,y:a.clientY,cursorIndex:g}),(!(a.shiftKey&&m)||u)&&e.length>0&&q(g&&{col:(z||I)&&m?m.col:Math.max(0,R?0:g.col),row:(z||G||ee)&&m?m.row:Math.max(0,g.row),doNotScrollX:!!(z&&m||R||g.col===-1),doNotScrollY:!!(z&&m||g.row===-1)}),V&&!u&&(K.current=m),Y(!!(V&&!u)),Re(g&&!u?{columns:g.col!==-1&&!R||!!(a.shiftKey&&m),rows:g.row!==-1||!!(a.shiftKey&&m),active:!0}:{columns:!1,rows:!1,active:!1}),a.shiftKey&&m&&!u)W(g&&{col:Math.max(0,g.col-(R?1:0)),row:Math.max(0,g.row)});else if(!z){if(g&&(g?.col===-1||g?.row===-1||R)){let Ye=g.col,Ge=g.row,Je=!1,Ze=!1;(g.col===-1||R)&&(Ye=y.length-(j?3:2),Je=!0),g.row===-1&&(Ge=e.length-1,Ze=!0),I&&Z&&(Ye=Z.col,Ze=!0),(G||ee)&&Z&&(Ge=Z.row,Je=!0),W({col:Ye,row:Ge,doNotScrollX:Je,doNotScrollY:Ze})}else W(null);x&&a.preventDefault()}},[ve,xe.length,we,U,m,y,re,v,j,P,Re,q,W,Z,e.length]);he("mousedown",Ln);const qn=c.useCallback(()=>{if(Ce!==null){if(be>0&&m){let a=[];const u=v?.min||m,x=v?.max||m;for(let g=u.row;g<=x.row;++g){a.push([]);for(let V=u.col;V<=x.col;++V){const{copyValue:R=()=>null}=y[V+1];a[g-u.row].push(String(R({rowData:e[g],rowIndex:g})??""))}}Promise.all(a[0].map((g,V)=>{const R=y[u.col+V+1]?.prePasteValues,z=a.map(I=>I[V]);return R?.(z)??z})).then(g=>{a=a.map((R,z)=>g.map(I=>I[z]));const V=[...e];for(let R=0;R<a[0].length;R++){const z=y[u.col+R+1]?.pasteValue;if(z)for(let I=x.row+1;I<=x.row+be;I++)re({col:R+u.col,row:I})||(V[I]=z({rowData:V[I],value:a[(I-x.row-1)%a.length][R],rowIndex:I}))}r(V,[{type:"UPDATE",fromRowIndex:x.row+1,toRowIndex:x.row+1+be}])}),_t(0),q({col:Math.min(m?.col??1/0,v?.min.col??1/0),row:Math.min(m?.row??1/0,v?.min.row??1/0),doNotScrollX:!0,doNotScrollY:!0}),W({col:Math.max(m?.col??0,v?.max.col??0),row:Math.max(m?.row??0,v?.max.row??0)+be})}kt(null)}Re({columns:!1,rows:!1,active:!1})},[Ce,Re,be,m,v?.min,v?.max,e,r,q,W,y,re]);he("mouseup",qn);const Pn=c.useCallback(a=>{if(Ce!==null){const u=we(a);u&&(_t(Math.max(0,u.row-Ce)),de({col:u.col,row:Math.max(u.row,Ce)}))}if(ue.active){const u=we(a),x=y.length-(j?3:2);W(u&&{col:ue.columns?Math.max(0,Math.min(x,u.col)):x,row:ue.rows?Math.max(0,u.row):e.length-1,doNotScrollX:!ue.columns,doNotScrollY:!ue.rows}),Y(!1)}},[de,ue.active,ue.columns,ue.rows,we,y.length,j,W,e.length,Ce]);he("mousemove",Pn);const Un=c.useCallback(a=>{if(m&&!a.isComposing){if(a.key==="Tab"&&!a.shiftKey&&m.col===y.length-(j?3:2)&&!y[m.col+1].disableKeys)if(m.row===e.length-1){if($.current){a.preventDefault(),q(null),W(null),Y(!1);const u=on(),x=u.indexOf($.current);u[(x+1)%u.length].focus();return}}else{q(u=>({col:0,row:(u?.row??0)+1})),W(null),Y(!1),a.preventDefault();return}if(a.key==="Tab"&&a.shiftKey&&m.col===0&&!y[m.col+1].disableKeys)if(m.row===0){if(E.current){a.preventDefault(),q(null),W(null),Y(!1);const u=on(),x=u.indexOf(E.current);u[(x-1+u.length)%u.length].focus();return}}else{q(u=>({col:y.length-(j?3:2),row:(u?.row??1)-1})),W(null),Y(!1),a.preventDefault();return}if(a.key?.startsWith("Arrow")||a.key==="Tab"){if(U&&y[m.col+1].disableKeys||U&&["ArrowLeft","ArrowRight"].includes(a.key))return;const u=([x,g],V)=>V&&{col:Math.max(0,Math.min(y.length-(j?3:2),V.col+x)),row:Math.max(0,Math.min(e.length-1,V.row+g))};if(a.key==="Tab"&&a.shiftKey)q(x=>u([-1,0],x)),W(null);else{const x={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[a.key];(a.ctrlKey||a.metaKey)&&(x[0]*=y.length,x[1]*=e.length),a.shiftKey?W(g=>u(x,g||m)):(q(g=>u(x,g)),W(null))}Y(!1),a.preventDefault()}else a.key==="Escape"?(!U&&!Z&&q(null),W(null),Y(!1)):(a.key==="Enter"||a.key==="F2")&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&!a.shiftKey?(W(null),U?y[m.col+1].disableKeys||(Be(),a.preventDefault()):re(m)||(K.current=m,Y(!0),de(m),a.preventDefault())):a.key==="Enter"&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&a.shiftKey?ce(v?.max.row||m.row):a.key==="d"&&(a.ctrlKey||a.metaKey)&&!a.altKey&&!a.shiftKey?(Se(v?.min.row||m.row,v?.max.row),a.preventDefault()):(kr(a.key)||a.code.match(/Key[A-Z]$/))&&!a.ctrlKey&&!a.metaKey&&!a.altKey?!U&&!re(m)&&(K.current=m,W(null),Y(!0),de(m)):["Backspace","Delete"].includes(a.key)?U||(Fe(),a.preventDefault()):a.key==="a"&&(a.ctrlKey||a.metaKey)&&(U||(q({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),W({col:y.length-(j?3:2),row:e.length-1,doNotScrollY:!0,doNotScrollX:!0}),a.preventDefault()))}},[m,y,e.length,Fe,Se,U,ce,re,de,v?.max.row,v?.min.row,Z,q,W,Be,j]);he("keydown",Un);const Hn=c.useCallback(a=>{const u=ae.current?.contains(a.target)||!1,x=u?we(a,!0,!0):null,g=x&&m&&m.col===x.col&&m.row===x.row&&U;u&&!g&&a.preventDefault()},[we,m,U]);he("contextmenu",Hn),c.useEffect(()=>{const a=[];m?.row!==void 0&&a.push({type:"COPY",action:()=>{_e(),le(null)}},{type:"CUT",action:()=>{$e(),le(null)}},{type:"PASTE",action:async()=>{if(navigator.clipboard.read!==void 0)(await navigator.clipboard.read()).forEach(async u=>{let x=[[""]];if(u.types.includes("text/html")){const g=await u.getType("text/html");x=gt(await g.text())}else if(u.types.includes("text/plain")){const g=await u.getType("text/plain");x=We(await g.text())}else if(u.types.includes("text")){const g=await u.getType("text");x=gt(await g.text())}ke(x)});else if(navigator.clipboard.readText!==void 0){const u=await navigator.clipboard.readText();ke(We(u))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");le(null)}}),v?.max.row!==void 0?a.push({type:"INSERT_ROW_BELLOW",action:()=>{le(null),ce(v.max.row)}}):m?.row!==void 0&&a.push({type:"INSERT_ROW_BELLOW",action:()=>{le(null),ce(m.row)}}),v?.min.row!==void 0&&v.min.row!==v.max.row?a.push({type:"DUPLICATE_ROWS",fromRow:v.min.row+1,toRow:v.max.row+1,action:()=>{le(null),Se(v.min.row,v.max.row)}}):m?.row!==void 0&&a.push({type:"DUPLICATE_ROW",action:()=>{le(null),Se(m.row)}}),v?.min.row!==void 0&&v.min.row!==v.max.row?a.push({type:"DELETE_ROWS",fromRow:v.min.row+1,toRow:v.max.row+1,action:()=>{le(null),Ie(v.min.row,v.max.row)}}):m?.row!==void 0&&a.push({type:"DELETE_ROW",action:()=>{le(null),Ie(m.row)}}),zn(a),a.length||le(null)},[v,m,Ie,Se,ce,$e,_e,ke]);const zt=c.useRef(xe);zt.current=xe;const Kn=c.useCallback(()=>zt.current,[]);c.useImperativeHandle(J,()=>({activeCell:De(m,y),selection:rn(v??(m?{min:m,max:m}:null),y),setSelection:a=>{const u=Ar(a,y.length-(j?2:1),e.length,y);q(u?.min||null),Y(!1),Re({columns:!1,active:!1,rows:!1}),W(u?.max||null)},setActiveCell:a=>{const u=vt(a,y.length-(j?2:1),e.length,y);q(u),Y(!1),Re({columns:!1,active:!1,rows:!1}),W(null)}}));const me=c.useRef({onFocus:_,onBlur:k,onActiveCellChange:A,onSelectionChange:X});return me.current.onFocus=_,me.current.onBlur=k,me.current.onActiveCellChange=A,me.current.onSelectionChange=X,c.useEffect(()=>{K.current&&(U?me.current.onFocus({cell:De(K.current,y)}):me.current.onBlur({cell:De(K.current,y)}))},[U,y]),c.useEffect(()=>{me.current.onActiveCellChange({cell:De(m,y)})},[m?.col,m?.row,y]),c.useEffect(()=>{me.current.onSelectionChange({selection:rn(v??(m?{min:m,max:m}:null),y)})},[v?.min.col??m?.col,v?.min.row??m?.row,v?.max.col??m?.col,v?.max.row??m?.row,m?.col,m?.row,y]),p.jsxs("div",{className:n,style:t,children:[p.jsx("div",{ref:E,tabIndex:l.length&&e.length?0:void 0,onFocus:a=>{a.target.blur(),q({col:0,row:0})}}),p.jsx(Br,{columns:y,outerRef:te,columnWidths:oe,hasStickyRightColumn:j,displayHeight:Ve,data:e,fullWidth:Vt,headerRowHeight:i,activeCell:m,innerRef:ae,rowHeight:ie,rowKey:w,selection:v,rowClassName:H,editing:U,getContextMenuItems:Kn,setRowData:Tn,deleteRows:Ie,insertRowAfter:ce,duplicateRows:Se,stopEditing:Be,cellClassName:L,onScroll:T,children:p.jsx(Vn,{columnRights:se,columnWidths:oe,activeCell:m,selection:v,headerRowHeight:i,rowHeight:ie,hasStickyRightColumn:j,dataLength:e.length,viewHeight:ge,viewWidth:ye,contentWidth:Vt?void 0:jn,edges:An,editing:U,isCellDisabled:re,expandSelection:Fn})}),p.jsx("div",{ref:$,tabIndex:l.length&&e.length?0:void 0,onFocus:a=>{a.target.blur(),q({col:y.length-(j?3:2),row:e.length-1})}}),!b&&C&&p.jsx(C,{addRows:a=>ce(e.length-1,a)}),ve&&xe.length>0&&p.jsx(O,{clientX:ve.x,clientY:ve.y,cursorIndex:ve.cursorIndex,items:xe,close:()=>le(null)})]})}));Dt.displayName="DataSheetGrid";pe.forwardRef(({columns:e,gutterColumn:n,stickyRightColumn:t,addRowsComponent:o,createRow:r,duplicateRow:l,style:s,rowKey:i,onFocus:d,onBlur:h,onActiveCellChange:w,onSelectionChange:C,rowClassName:f,rowHeight:S,...b},N)=>{const[M]=c.useState({columns:e,gutterColumn:n,stickyRightColumn:t,addRowsComponent:o,createRow:r,duplicateRow:l,style:s,rowKey:i,onFocus:d,onBlur:h,onActiveCellChange:w,onSelectionChange:C,rowClassName:f,rowHeight:S});return p.jsx(Dt,{...M,...b,rowHeight:typeof S=="number"?S:M.rowHeight,ref:N})});const eo=()=>{const e=c.useRef(!0),n=e.current;return e.current=!1,n},_n=pe.memo(({active:e,focus:n,rowData:t,setRowData:o,columnData:{placeholder:r,alignRight:l,formatInputOnFocus:s,formatBlurredInput:i,parseUserInput:d,continuousUpdates:h}})=>{const w=c.useRef(null),C=eo(),f=c.useRef({rowData:t,formatInputOnFocus:s,formatBlurredInput:i,setRowData:o,parseUserInput:d,continuousUpdates:h,firstRender:C,focusedAt:0,changedAt:0,escPressed:!1});return f.current={rowData:t,formatInputOnFocus:s,formatBlurredInput:i,setRowData:o,parseUserInput:d,continuousUpdates:h,firstRender:C,focusedAt:f.current.focusedAt,changedAt:f.current.changedAt,escPressed:f.current.escPressed},c.useLayoutEffect(()=>{n?(w.current&&(w.current.value=f.current.formatInputOnFocus(f.current.rowData),w.current.focus(),w.current.select()),f.current.escPressed=!1,f.current.focusedAt=Date.now()):w.current&&(!f.current.escPressed&&!f.current.continuousUpdates&&!f.current.firstRender&&f.current.changedAt>=f.current.focusedAt&&f.current.setRowData(f.current.parseUserInput(w.current.value)),w.current.blur())},[n]),c.useEffect(()=>{!n&&w.current&&(w.current.value=f.current.formatBlurredInput(t))},[n,t]),p.jsx("input",{defaultValue:i(t),className:Q("dsg-input",l&&"dsg-input-align-right"),placeholder:e?r:void 0,tabIndex:-1,ref:w,style:{pointerEvents:n?"auto":"none"},onChange:S=>{f.current.changedAt=Date.now(),h&&o(d(S.target.value))},onKeyDown:S=>{S.key==="Escape"&&(f.current.escPressed=!0)}})});_n.displayName="TextComponent";ze();function ze({placeholder:e,alignRight:n=!1,continuousUpdates:t=!0,deletedValue:o=null,parseUserInput:r=h=>h.trim()||null,formatBlurredInput:l=h=>String(h??""),formatInputOnFocus:s=h=>String(h??""),formatForCopy:i=h=>String(h??""),parsePastedValue:d=h=>h.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:_n,columnData:{placeholder:e,alignRight:n,continuousUpdates:t,formatInputOnFocus:s,formatBlurredInput:l,parseUserInput:r},deleteValue:()=>o,copyValue:({rowData:h})=>i(h),pasteValue:({value:h})=>d(h),isCellEmpty:({rowData:h})=>h==null}}const to=pe.memo(({focus:e,rowData:n,setRowData:t,active:o,stopEditing:r,disabled:l})=>{const s=c.useRef(null);return c.useLayoutEffect(()=>{e&&(t(!n),r({nextRow:!1}))},[e,r]),p.jsx("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:s,disabled:l,checked:!!n,onMouseDown:()=>!o&&t(!n),onChange:()=>null})});to.displayName="CheckboxComponent";const no=ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:n},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:n}});ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:Math.round(n)},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:Math.round(n)}});const ro=1e12,oo=1e10;ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(e):"",formatInputOnFocus:e=>typeof e=="number"&&!isNaN(e)?String(Math.round(e*ro)/oo):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:n/100},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:n}});const lo=pe.memo(({focus:e,active:n,rowData:t,setRowData:o})=>{const r=c.useRef(null);return c.useLayoutEffect(()=>{e?r.current?.select():r.current?.blur()},[e]),p.jsx("input",{className:Q("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:r,style:{pointerEvents:e?"auto":"none",opacity:t||n?void 0:0},value:t?.toISOString().substr(0,10)??"",onChange:l=>{const s=new Date(l.target.value);o(isNaN(s.getTime())?null:s)}})});lo.displayName="DateComponent";const so=pe.memo(({focus:e,active:n,rowData:t,setRowData:o})=>{const r=c.useRef(null);return c.useLayoutEffect(()=>{e?r.current?.select():r.current?.blur()},[e]),p.jsx("input",{className:Q("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:r,style:{pointerEvents:e?"auto":"none",opacity:t||n?void 0:0},value:t??"",onChange:l=>{const s=new Date(l.target.value);o(isNaN(s.getTime())?null:s.toISOString().substr(0,10))}})});so.displayName="IsoDateComponent";const io=({columnData:{key:e,original:n},rowData:t,setRowData:o,...r})=>{const l=c.useRef(t);l.current=t;const s=c.useCallback(d=>{o({...l.current,[e]:d})},[e,o]);if(!n.component)return p.jsx(p.Fragment,{});const i=n.component;return p.jsx(i,{columnData:n.columnData,setRowData:s,rowData:t[e],...r})},ao=(e,n)=>({id:e,...n,columnData:{key:e,original:n},component:io,copyValue:({rowData:t,rowIndex:o})=>n.copyValue?.({rowData:t[e],rowIndex:o})??null,deleteValue:({rowData:t,rowIndex:o})=>({...t,[e]:n.deleteValue?.({rowData:t[e],rowIndex:o})??null}),pasteValue:({rowData:t,value:o,rowIndex:r})=>({...t,[e]:n.pasteValue?.({rowData:t[e],value:o,rowIndex:r})??null}),disabled:typeof n.disabled=="function"?({rowData:t,rowIndex:o})=>typeof n.disabled=="function"?n.disabled({rowData:t[e],rowIndex:o}):n.disabled??!1:n.disabled,cellClassName:typeof n.cellClassName=="function"?({rowData:t,rowIndex:o,columnId:r})=>typeof n.cellClassName=="function"?n.cellClassName({rowData:t[e],rowIndex:o,columnId:r}):n.cellClassName??void 0:n.cellClassName,isCellEmpty:({rowData:t,rowIndex:o})=>n.isCellEmpty?.({rowData:t[e],rowIndex:o})??!1}),uo=Dt;function je(e,n){if(!n||n==="string")return String(e);if(n==="number"||n==="integer"){if(e.trim()==="")return e;let t;return n==="integer"?t=parseInt(e,10):t=Number(e),isNaN(t)?e:t}else{if(n==="boolean")return e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e;if(n==="object"||n==="array")try{return JSON.parse(e)}catch{return e}else return n==="null"&&(e.toLowerCase()==="null"||e.trim()==="")?null:e}}const co={width:"100%",height:"100%","& .MuiTextField-root .MuiInputBase-root":{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0},"& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}};function fe(e){return He(e)?"":typeof e=="object"?JSON.stringify(e):String(e)}function xt({rowData:e,setRowData:n,choices:t,colType:o,focus:r,stopEditing:l,active:s,clearValue:i=void 0}){const[d,h]=c.useState(!1),w=c.useRef(null),C=fe(e),[f,S]=c.useState(C);c.useEffect(()=>{s?w.current?.focus():(h(!1),w.current?.blur(),f!==C&&n(je(f,o)))},[s]),c.useEffect(()=>{!r&&!s&&S(C)},[r,s,C]);const b=!He(e)&&e!=="",N=c.useMemo(()=>({...co,"& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit",pointerEvents:r?void 0:"none"},"& .MuiAutocomplete-clearIndicator":{visibility:s?"visible":"hidden",pointerEvents:"auto"},"& .MuiAutocomplete-popupIndicator":{visibility:s?"visible":"hidden",pointerEvents:"auto"},"&:hover .MuiAutocomplete-clearIndicator":{visibility:"visible"},"&:hover .MuiAutocomplete-popupIndicator":{visibility:"visible"}}),[s,r]);return p.jsx(vn,{open:d,onOpen:()=>{h(!0)},forcePopupIcon:!0,disableClearable:!b,freeSolo:!0,disablePortal:!1,options:t,autoSelect:!0,selectOnFocus:!0,getOptionLabel:M=>fe(M),value:e,inputValue:f,onInputChange:(M,F)=>{S(F)},onKeyDown:M=>{M.key==="Tab"?(M.preventDefault(),l({nextRow:!1})):M.key==="Enter"&&(M.preventDefault(),l({nextRow:!0}))},onClose:()=>{h(!1),l({nextRow:!1})},onChange:(M,F,O)=>{n(O==="clear"?i:O==="createOption"?je(F,o):F),setTimeout(()=>l({nextRow:!1}),0)},blurOnSelect:!0,renderInput:M=>p.jsx(yn,{...M,inputRef:w}),sx:N})}const ho=c.memo(xt,(e,n)=>e.active===n.active&&e.focus===n.focus&&e.rowData===n.rowData&&e.choices===n.choices&&e.colType===n.colType&&e.clearValue===n.clearValue);function Ue({choices:e,colType:n,clearValue:t}){return{component:(o=>p.jsx(ho,{...o,choices:e,colType:n,clearValue:t})),copyValue:({rowData:o})=>o,pasteValue:({value:o})=>o,disableKeys:!0,keepFocus:!0}}try{fe.displayName="castCellValueToString",fe.__docgenInfo={description:"",displayName:"castCellValueToString",props:{}}}catch{}try{xt.displayName="AutocompleteCell",xt.__docgenInfo={description:"",displayName:"AutocompleteCell",props:{rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"any"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean"}},focus:{defaultValue:null,description:"",name:"focus",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},columnData:{defaultValue:null,description:"",name:"columnData",required:!0,type:{name:"any"}},setRowData:{defaultValue:null,description:"",name:"setRowData",required:!0,type:{name:"((rowData: any) => void) & ((value: AutocompleteOption) => void)"}},stopEditing:{defaultValue:null,description:"",name:"stopEditing",required:!0,type:{name:"(opts?: { nextRow?: boolean; }) => void"}},insertRowBelow:{defaultValue:null,description:"",name:"insertRowBelow",required:!0,type:{name:"() => void"}},duplicateRow:{defaultValue:null,description:"",name:"duplicateRow",required:!0,type:{name:"() => void"}},deleteRow:{defaultValue:null,description:"",name:"deleteRow",required:!0,type:{name:"() => void"}},getContextMenuItems:{defaultValue:null,description:"",name:"getContextMenuItems",required:!0,type:{name:"() => ContextMenuItem[]"}},choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},clearValue:{defaultValue:{value:"undefined"},description:"",name:"clearValue",required:!1,type:{name:"null"}}}}}catch{}try{Ue.displayName="autocompleteColumn",Ue.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},clearValue:{defaultValue:null,description:"",name:"clearValue",required:!0,type:{name:"null"}}}}}catch{}function bt({option:e,active:n=!1,...t}){return p.jsx(Jn,{...t,label:fe(e),sx:{maxWidth:n?"none":"120px",fontSize:"0.75rem",height:"24px",margin:"1px",flexShrink:0,...t.sx}})}try{bt.displayName="GridAutocompleteChip",bt.__docgenInfo={description:"",displayName:"GridAutocompleteChip",props:{option:{defaultValue:null,description:"",name:"option",required:!0,type:{name:"unknown"}},active:{defaultValue:{value:"false"},description:"",name:"active",required:!1,type:{name:"boolean"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}},slots:{defaultValue:{value:"{}"},description:"The components used for each slot inside.",name:"slots",required:!1,type:{name:"Partial<ChipSlots>"}},slotProps:{defaultValue:{value:"{}"},description:"The props used for each slot inside.",name:"slotProps",required:!1,type:{name:'{ root?: SlotProps<"div", {}, ChipOwnerState>; label?: SlotProps<"span", {}, ChipOwnerState>; }'}}}}}catch{}const mo={width:"100%",height:"100%","& .MuiFormControl-root":{height:"100%"},"& .MuiAutocomplete-tag":{margin:"1px"},"&:hover .MuiAutocomplete-clearIndicator":{visibility:"visible"},"&:hover .MuiAutocomplete-popupIndicator":{visibility:"visible"}},po={height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0};function gn(e){return{label:fe(e),value:e}}function Ct(e){return Array.isArray(e)?e:He(e)?[]:[e]}function fo({rowData:e,setRowData:n,choices:t,colType:o,limitTags:r=2,active:l,focus:s,stopEditing:i,clearValue:d=void 0}){const h=c.useRef(null),[w,C]=c.useState(!1),[f,S]=c.useState("");c.useEffect(()=>{l?h.current?.focus():(C(!1),h.current?.blur())},[l]);const b=Ct(e),N=t.map(gn),M=b.map(gn),F=l?-1:r,O=b.length>0?b.map(k=>fe(k)).join(","):"",D=!He(e)&&e!=="",_=c.useMemo(()=>({...mo,"& .MuiAutocomplete-inputRoot":{pointerEvents:s?void 0:"none",padding:"0 10px",backgroundColor:"inherit",flexWrap:l?"wrap":"nowrap",minHeight:"100%",maxHeight:"100%",overflowY:l?"auto":"hidden",overflowX:"hidden","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"3px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555"}},"& .MuiAutocomplete-clearIndicator":{visibility:l?"visible":"hidden",pointerEvents:"auto"},"& .MuiAutocomplete-popupIndicator":{visibility:l?"visible":"hidden",pointerEvents:"auto"}}),[l,s]);return p.jsx(Bn,{title:O,placement:"top-start",arrow:!0,enterDelay:500,disableHoverListener:l||b.length<=r,children:p.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:p.jsx(vn,{ref:h,forcePopupIcon:t.length>0,disableClearable:!D,multiple:!0,freeSolo:!0,open:w,onOpen:()=>{C(!0)},disablePortal:!1,limitTags:F,options:N,getOptionLabel:k=>typeof k=="string"?k:k.label,isOptionEqualToValue:(k,A)=>{const X=typeof k=="string"?k:k.value,H=typeof A=="string"?A:A.value;return $n(X,H)},value:M,inputValue:f,onInputChange:(k,A)=>{S(A)},onClose:()=>{C(!1),i({nextRow:!1})},onChange:(k,A,X)=>{const H=(A||[]).map(L=>typeof L=="string"?je(L,o):L.value);n(H.length===0?d:H),S("")},disableCloseOnSelect:t.length>1,onBlur:()=>{if(f.trim()){const k=je(f,o);n([...b,k]),S("")}},renderValue:(k,A)=>k.map((X,H)=>{const{key:L,...T}=A({index:H}),J=typeof X=="string"?X:X.value;return p.jsx(bt,{option:J,active:l,...T},L)}),renderInput:k=>p.jsx(yn,{...k,slotProps:{input:{...k.InputProps,disableUnderline:!0,sx:po}}}),sx:_})})})}const go=c.memo(fo,(e,n)=>e.active===n.active&&e.focus===n.focus&&e.rowData===n.rowData&&e.choices===n.choices&&e.colType===n.colType&&e.limitTags===n.limitTags&&e.clearValue===n.clearValue);function Rt({choices:e,colType:n,limitTags:t=2,dynamicHeight:o=!1,clearValue:r=void 0}){return{component:(l=>p.jsx(go,{...l,choices:e,colType:n,limitTags:t,clearValue:r})),copyValue:({rowData:l})=>Ct(l).map(i=>fe(i)).join(","),pasteValue:({value:l})=>{if(typeof l!="string")return l;const s=/[,\t]/,i=l.split(s).map(d=>d.trim()).filter(d=>d.length>0).map(d=>je(d,n)).filter(d=>d!=null);return i.length>0?i:[]},disableKeys:!0,keepFocus:!0,...o&&{cellClassName:({rowData:l})=>Ct(l).length>3?"multi-value-cell-large":"multi-value-cell"}}}try{Rt.displayName="autocompleteMultipleEnumColumn",Rt.__docgenInfo={description:"",displayName:"autocompleteMultipleEnumColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"unknown[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},limitTags:{defaultValue:{value:"2"},description:"",name:"limitTags",required:!1,type:{name:"number"}},dynamicHeight:{defaultValue:{value:"false"},description:"",name:"dynamicHeight",required:!1,type:{name:"boolean"}},clearValue:{defaultValue:{value:"undefined"},description:"",name:"clearValue",required:!1,type:{name:"null"}}}}}catch{}function Nt(e,n){const t=n?.type?.format==="date-time"?215:175,o=e.length*11;return Math.max(t,o)}function wo(e){return e?"header-cell-required":"header-cell"}function yo(e,n){return({rowData:t})=>({...t,[e]:n?null:void 0})}function vo(e){return n=>{const t=n.trim();return t===""?e?null:void 0:t}}function Me(e,n){const t=e.customWidth??Nt(e.columnName);return{...ao(e.columnName,n),title:e.columnName,headerClassName:wo(e.isRequired),minWidth:t,basis:t,grow:0,shrink:0,disabled:e.disabled,deleteValue:yo(e.columnName,e.isRequired)}}const xo={multipleEnum:e=>Me(e,Rt({choices:e.enumeratedValues??[],colType:e.typeInfo?.type||null,limitTags:3,clearValue:e.isRequired?null:void 0})),boolean:e=>Me(e,Ue({choices:[!0,!1],colType:"boolean",clearValue:e.isRequired?null:void 0})),number:e=>Me(e,no),enumerated:e=>Me(e,Ue({choices:e.enumeratedValues??[],colType:e.typeInfo?.type||null,clearValue:e.isRequired?null:void 0})),"date-time":e=>{const n=yt({colType:e.typeInfo?.type||null}),t=e.customWidth??Nt(e.columnName,{type:e.typeInfo??void 0,isRequired:e.isRequired});return{...Me(e,n),minWidth:t,basis:t}},text:e=>{const n=ze({continuousUpdates:!1,deletedValue:void 0,parseUserInput:vo(e.isRequired)});return{...Me(e,n),cellClassName:"MuiInputBase-input"}}};function bo(e,n){return e?e.format==="date-time"?"date-time":e.isArray?"multipleEnum":e.type==="boolean"?"boolean":e.type==="number"||e.type==="integer"?"number":n&&n.length>0?"enumerated":"text":n&&n.length>0?"enumerated":"text"}function Co(e){const n=bo(e.typeInfo,e.enumeratedValues);return xo[n](e)}function Ro(e,n,t,o={}){return n.map(r=>{const l=e[r],s=t[l];return Co({columnName:l,typeInfo:s?.type||null,enumeratedValues:s?.enumeratedValues||[],isRequired:s?.isRequired||!1,disabled:s?.type?.readOnly,customWidth:o[l]})})}const So=["COPY","PASTE","CUT"],Io=In(),kn=e=>{if(e.type==="COPY")return p.jsx(p.Fragment,{children:"Copy"});if(e.type==="PASTE")return p.jsx(p.Fragment,{children:"Paste"});if(e.type==="CUT")return p.jsx(p.Fragment,{children:"Cut"});if(e.type==="INSERT_ROW_BELLOW")return p.jsx(p.Fragment,{children:"Insert row below"});if(e.type==="DELETE_ROW")return p.jsx(p.Fragment,{children:"Delete row"});if(e.type==="DUPLICATE_ROW")return p.jsx(p.Fragment,{children:"Duplicate row"});if(e.type==="DELETE_ROWS")return p.jsx(p.Fragment,{children:"Delete rows"});if(e.type==="DUPLICATE_ROWS")return p.jsx(p.Fragment,{children:"Duplicate rows"})},Eo=Mt(kn),Mo=Mt(kn),Do=e=>{const n=e.items.filter(t=>So.includes(t.type));return p.jsx(Eo,{...e,items:n})},No=e=>p.jsx(Io,{...e}),St=e=>p.jsx(Do,{...e}),It=e=>p.jsx(Mo,{...e});try{St.displayName="renderViewContextMenu",St.__docgenInfo={description:"",displayName:"renderViewContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}try{It.displayName="renderRecordSetContextMenu",It.__docgenInfo={description:"",displayName:"renderRecordSetContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}const Oo="__rowKey",qo=e=>{const n=e.trim();if(n){if(n.toUpperCase().startsWith("SELECT"))return{type:"sql",input:n};if(Yn.test(n))return{type:"recordSetId",input:n};if(/^[A-Za-z]\w*=+$/.test(n))return{type:"sessionId",input:n}}else return{type:"empty",input:""};return{type:"unknown",input:n}};function Vo(e,n){const t=Object.keys(e),o=Object.keys(n);if(t.length!==o.length)return!1;for(const r of t){const l=e[r],s=n[r],i=d=>d==null||d==="";if(!(i(l)&&i(s))&&String(l)!==String(s))return!1}return!0}function Po(e,n,t){function o(r){if(r.type==="UPDATE"){const l=n.slice(r.fromRowIndex,r.toRowIndex),s=e.slice(r.fromRowIndex,r.toRowIndex);return l.map((d,h)=>Vo(d,s[h])).every(Boolean)}return!1}return t.filter(r=>!o(r))}function _o(e){const{rowData:n,rowIndex:t,columnId:o,selectedRowIndex:r,lastSelection:l,colValues:s}=e,i=r===t,d=n.__cellValidationResults,h=d&&o&&d.has(o),w=[];i&&w.push("cell-row-selected");let C=!1;return l&&o&&s&&(C=t>=l.min.row&&t<=l.max.row&&s.findIndex(f=>f.id===o)>=l.min.col&&s.findIndex(f=>f.id===o)<=l.max.col,C&&w.push("cell-selected")),h&&w.push("cell-invalid"),w.length?xn(w):void 0}class Ot{constructor(n,t){this.colValues=n,this.onColumnResize=t}static COLUMN_MIN_WIDTH_PX=50;handlesMap=new Map;cleanupFunctions=[];activeResize=null;gridContainer=null;headerRow=null;observer=null;updateColumns(n,t){this.colValues=n,this.onColumnResize=t,this.syncHandles()}initialize(n){const t=n.querySelector(".dsg-container");if(!t)return!1;const o=t.querySelector(".dsg-row.dsg-row-header");return o?(this.gridContainer=t,this.headerRow=o,this.setupEventListeners(),this.syncHandles(),!0):!1}createNewHandle(n){if(!this.gridContainer)throw new Error("Cannot create handle without grid container");const t=document.createElement("div");t.className="column-resize-handle",t.dataset.columnName=n,t.style.position="absolute",t.style.top="0",t.style.width="8px",t.style.cursor="col-resize",t.style.pointerEvents="auto",t.style.zIndex="1000";const o=r=>this.handleMouseDown(r,t);return t.addEventListener("mousedown",o),this.cleanupFunctions.push(()=>t.removeEventListener("mousedown",o)),this.gridContainer.appendChild(t),this.cleanupFunctions.push(t),this.handlesMap.set(n,t),t}createOrUpdateHandle(n,t){const o=this.colValues[t]?.title;if(!o||!this.gridContainer)return;let r=this.handlesMap.get(o);r||(r=this.createNewHandle(o)),this.updateHandlePosition(r,n)}updateHandlePosition(n,t){if(!this.gridContainer)return;const o=this.gridContainer.scrollHeight,r=t.offsetLeft+t.offsetWidth-3;n.__cellElement=t,n.__columnName=n.dataset.columnName,n.style.left=`${r}px`,n.style.height=`${o}px`,n.style.display=""}handleMouseDown(n,t){n.preventDefault(),n.stopPropagation();const o=t.__columnName,r=t.__cellElement;if(!o||!r)return;const l=parseFloat(t.style.left);this.activeResize={columnName:o,startX:n.clientX,startWidth:r.offsetWidth,handle:t,initialLeft:l},t.classList.add("is-resizing"),document.body.classList.add("col-resizing")}handleMouseMove=n=>{if(!this.activeResize)return;const{startX:t,handle:o,initialLeft:r}=this.activeResize,l=n.clientX-t;o.style.left=`${r+l}px`};handleMouseUp=n=>{if(!this.activeResize)return;const{columnName:t,startX:o,startWidth:r,handle:l}=this.activeResize,s=n.clientX-o,i=Math.max(Ot.COLUMN_MIN_WIDTH_PX,r+s);l.classList.remove("is-resizing"),document.body.classList.remove("col-resizing"),this.activeResize=null,this.onColumnResize(t,i)};syncHandles=()=>{if(this.activeResize||!this.headerRow)return;const n=this.headerRow.querySelectorAll(".dsg-cell");if(n.length<=1)return;const t=new Set;n.forEach((o,r)=>{if(r===0)return;const l=o,s=l.textContent?.trim()||"",i=this.colValues.findIndex(d=>d.title===s);if(i!==-1){const d=this.colValues[i]?.title;t.add(d),this.createOrUpdateHandle(l,i)}}),this.handlesMap.forEach((o,r)=>{t.has(r)||(o.style.display="none")})};setupEventListeners(){!this.gridContainer||!this.headerRow||(document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("mouseleave",this.handleMouseUp),this.gridContainer.addEventListener("scroll",this.syncHandles),this.observer=new MutationObserver(()=>{requestAnimationFrame(()=>{this.syncHandles()})}),this.observer.observe(this.headerRow,{childList:!0,subtree:!0}),this.cleanupFunctions.push(()=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("mouseleave",this.handleMouseUp),this.gridContainer?.removeEventListener("scroll",this.syncHandles),this.observer?.disconnect()}))}cleanup(){document.body.classList.remove("col-resizing"),this.activeResize&&(this.activeResize.handle?.classList.remove("is-resizing"),this.activeResize=null),this.cleanupFunctions.forEach(n=>{typeof n=="function"?n():n.remove()}),this.cleanupFunctions=[],this.handlesMap.clear(),this.gridContainer=null,this.headerRow=null,this.observer=null}}function ko({wrapperRef:e,colValues:n,onColumnResize:t}){const o=c.useRef(null);Zn(e,r=>{if(!(!e.current||!r||r.contentRect.height===0)&&!o.current){const l=new Ot(n,t);l.initialize(e.current)&&(o.current=l)}}),c.useEffect(()=>{o.current&&o.current.updateColumns(n,t)},[n,t]),c.useEffect(()=>()=>{o.current?.cleanup(),o.current=null},[])}function wn(e){const{gridRef:n,rowValues:t,columnNames:o,columnOrder:r,schemaPropertiesInfo:l,entityIsView:s,jsonSchema:i,lastSelection:d,handleChange:h,handleSelectionChange:w,onSelectedRowChange:C}=e,[f,S]=c.useState({});c.useEffect(()=>{!o||!r||S(T=>{const J=r.map(y=>o[y]);if(!J.some(y=>!T[y]))return T;const P={...T};return J.forEach(y=>{if(!P[y]){const j=l[y];P[y]=Nt(y,j)}}),P})},[o,r,l]);const b=c.useMemo(()=>Ro(o,r,l,f),[o,r,l,f]),[N,M]=c.useState(null),F=c.useMemo(()=>s?St:It,[s]),O=c.useMemo(()=>s?!1:No,[s]),D=c.useCallback(({rowData:T,rowIndex:J})=>xn({"row-valid":!!i&&T.__validationStatus==="valid","row-invalid":!!i&&T.__validationStatus==="invalid","row-unknown":!!i&&T.__validationStatus==="pending","row-selected":N===J}),[i,N]),_=c.useCallback(({rowData:T,rowIndex:J,columnId:K})=>_o({rowData:T,rowIndex:J,columnId:K||"",selectedRowIndex:N,lastSelection:d,colValues:b}),[N,d,b]),k=c.useCallback(({rowData:T})=>({...T}),[]),A=c.useCallback(({cell:T})=>{T?(M(T.row),C?.(T.row,t[T.row])):(M(null),C?.(null,null))},[C,t]),X=c.useRef(null),H=c.useRef(null),L=c.useCallback((T,J)=>{if(n.current){const K=n.current.activeCell;K?H.current={col:K.col,row:K.row}:H.current=null}S(K=>({...K,[T]:J}))},[n]);return ko({wrapperRef:X,colValues:b,onColumnResize:L}),p.jsx("div",{ref:X,style:{position:"relative",width:"100%"},children:p.jsx(uo,{ref:n,value:t,columns:b,autoAddRow:!s,disableSmartDelete:!0,addRowsComponent:O,contextMenuComponent:F,rowKey:Oo,rowClassName:D,cellClassName:_,duplicateRow:k,onChange:h,onActiveCellChange:A,onSelectionChange:w})})}try{wn.displayName="DataGrid",wn.__docgenInfo={description:"Component that renders a data grid/spreadsheet using react-datasheet-grid.",displayName:"DataGrid",props:{gridRef:{defaultValue:null,description:"",name:"gridRef",required:!0,type:{name:"RefObject<DataSheetGridRef>"}},columnNames:{defaultValue:null,description:"",name:"columnNames",required:!0,type:{name:"string[]"}},columnOrder:{defaultValue:null,description:"",name:"columnOrder",required:!0,type:{name:"number[]"}},schemaPropertiesInfo:{defaultValue:null,description:"",name:"schemaPropertiesInfo",required:!0,type:{name:"SchemaPropertiesMap"}},rowValues:{defaultValue:null,description:"",name:"rowValues",required:!0,type:{name:"DataGridRow[]"}},entityIsView:{defaultValue:null,description:"",name:"entityIsView",required:!0,type:{name:"boolean"}},jsonSchema:{defaultValue:null,description:"",name:"jsonSchema",required:!0,type:{name:"JSONSchema7"}},lastSelection:{defaultValue:null,description:"",name:"lastSelection",required:!0,type:{name:"SelectionWithId"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(newValue: DataGridRow[], operations: Operation[]) => void"}},handleSelectionChange:{defaultValue:null,description:"",name:"handleSelectionChange",required:!0,type:{name:"(opts: { selection: SelectionWithId; }) => void"}},onSelectedRowChange:{defaultValue:null,description:"",name:"onSelectedRowChange",required:!1,type:{name:"(rowIndex: number, row: DataGridRow) => void"}}}}}catch{}export{wn as D,Oo as G,qo as p,Po as r};
