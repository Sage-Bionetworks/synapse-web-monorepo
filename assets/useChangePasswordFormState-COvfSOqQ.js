import{S as N,aN as S,n as V,aO as W,aP as H}from"./useFiles-CtgEiROS.js";import{q as U}from"./VerificationSubmission-OWkqLMYZ.js";import{h as I,H as v}from"./index-CREhUo58.js";import{j as r}from"./jsx-runtime-D_zvdyIk.js";import"./StringUtils-BYEtqtR3.js";import{u as B}from"./useMutation-C2Mhl8Cc.js";import"./OrientationBanner-C02Ezp0s.js";import{r as o}from"./index-KaSV3nxb.js";import"./LastLoginInfo-JI0DYduQ.js";import{T as Y,R as G,O as M}from"./StandaloneLoginForm-CsaRup4Z.js";import"./TwoFactorAuthSettingsPanel-CqF241ue.js";import"./TwoFactorEnrollmentForm-BsFvuPDh.js";import"./TwoFactorBackupCodes-BLSF660O.js";import{T as y}from"./Typography-Bk-AszFU.js";import{A as O}from"./Alert-BDuCqUUc.js";function L(e){return B({...e,mutationFn:c=>N.changePassword(c)})}function de(e){return I.post(e+S,()=>new Response(null,{status:204}))}function ie(e,c,i){return I.post(e+S,async({request:h})=>{if("twoFaToken"in await h.json())return new Response(null,{status:204});const l={concreteType:"org.sagebionetworks.repo.model.auth.TwoFactorAuthErrorResponse",reason:"Two factor authentication required.",errorCode:U.TWO_FA_REQUIRED,userId:c,twoFaToken:i};return v.json(l,{status:401})})}const Q="Two-factor authentication is required to change your password. Your password has not yet been changed.";function _(e){const c=V("/reset2FA"),i=W(c,"twoFAResetToken"),[h,C]=o.useState(""),[l,R]=o.useState(""),[a,P]=o.useState(),[n,w]=o.useState("VERIFICATION_CODE"),[k,b]=o.useState(!1),{mutate:u,isPending:g,error:q}=L({onSuccess:s=>{s?P(s):(b(!0),P(void 0),e!=null&&e.onChangePasswordSuccess&&e.onChangePasswordSuccess())}}),x=o.useCallback((s,t,d)=>{C(t),R(d),u({username:s,currentPassword:t,newPassword:d,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithCurrentPassword"})},[u]),D=o.useCallback((s,t)=>{R(s),u({newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithToken",passwordChangeToken:t})},[u]),T=o.useCallback((s,t,d)=>{if(a){const E={newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithTwoFactorAuthToken",userId:a.userId,twoFaToken:a.twoFaToken,otpType:d,otpCode:t};u(E)}},[u,a]),p=!!a,{mutate:A,isSuccess:m,isPending:F}=H(),f=o.useCallback(s=>{if(a){const t={userId:a.userId,twoFaResetEndpoint:s,password:h};A(t)}},[h,A,a]),j=o.useCallback(()=>p?r.jsxs(r.Fragment,{children:[n==="VERIFICATION_CODE"&&r.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:Y}),n==="RECOVERY_CODE"&&r.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:G}),r.jsx(M,{step:n,onClickUseTOTP:()=>{w("VERIFICATION_CODE")},onClickUseBackupCode:()=>{w("RECOVERY_CODE")},loginIsPending:g,onSubmit:(s,t)=>T(l,s,t),hideReset2FA:e==null?void 0:e.hideReset2FA,onClickPromptReset2FA:()=>{w("DISABLE_2FA_PROMPT")},onClickReset2FA:()=>{f(i)},twoFactorAuthResetIsPending:F,twoFactorAuthResetIsSuccess:m}),(n==="RECOVERY_CODE"||n==="VERIFICATION_CODE")&&r.jsx(O,{severity:"info",sx:{my:2},children:Q}),n==="DISABLE_2FA_PROMPT"&&m&&r.jsxs(O,{severity:"warning",sx:{my:2},children:[r.jsx("strong",{children:"Your password has not been changed."})," To disable two-factor authentication, you may be required to enter your current password after clicking the link sent to your email address."]})]}):r.jsx(r.Fragment,{}),[f,T,g,l,e==null?void 0:e.hideReset2FA,n,p,F,m,i]);return{successfullyChangedPassword:k,isPending:g,error:q,promptForTwoFactorAuth:p,TwoFactorAuthPrompt:j,handleChangePasswordWithCurrentPassword:x,handleChangePasswordWithResetToken:D}}try{_.displayName="useChangePasswordFormState",_.__docgenInfo={description:"Hook that handles submitting a change password request and prompting the user for 2FA if necessary.",displayName:"useChangePasswordFormState",props:{hideReset2FA:{defaultValue:null,description:"",name:"hideReset2FA",required:!1,type:{name:"boolean"}},onChangePasswordSuccess:{defaultValue:null,description:"",name:"onChangePasswordSuccess",required:!1,type:{name:"() => void"}}}}}catch{}export{ie as a,de as g,_ as u};
