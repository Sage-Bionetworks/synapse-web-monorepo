import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{m as Z,bA as Te}from"./useFiles-C8pQ42sC.js";import{O as ee,q}from"./VerificationSubmission-DHtRxRPZ.js";import{u as te,A as we}from"./useEntityBundle-Cxmy9nRL.js";import{f as Se}from"./StringUtils-DP1EOPFU.js";import{S as $e}from"./SynapseConstants-BWEIGnwu.js";import{r as n}from"./index-d3rqgMCN.js";import"./OrientationBanner-CCfEbiwH.js";import{u as Me,a as ke,F as P,b as Ie}from"./ForumThreadEditor-pu0PHaND.js";import{c as Ne,d as Oe,e as De}from"./useThread-CeU_AIHb.js";import{a as Ee}from"./useSubscription-Cdk-6Ykm.js";import{f as oe}from"./DateFormatter-CKrCvfUI.js";import{d as se}from"./dayjs.min-DjKPkMPs.js";import{C as _e}from"./ConfirmationDialog-DURiw3eG.js";import{I as B}from"./IconSvg-mx68c4yJ.js";import{M as re}from"./MarkdownSynapse-C1NYhXcB.js";import{W as F}from"./WarningDialog-BTXT4heL.js";import{d as A}from"./ToastMessage-CkFQzo64.js";import{U as ae}from"./UserBadge-DVoD2MJz.js";import{S as Ae}from"./SkeletonTable-DZt1isCd.js";import{B as O}from"./Box-DpHzd5pI.js";import{S as Le}from"./SubscribersModal-qk-eNFyo.js";import{a as Ge}from"./useForum-Mjaeb4So.js";import{T as W}from"./Typography-CCVx77H_.js";import{g as ne,a as ie,c as le,b as z,e as M}from"./createTheme-DvxOXisY.js";import{r as Pe,u as de,s as ce,c as ue,m as pe}from"./DefaultPropsProvider-DbzGYC6R.js";import{g as ze}from"./getValidReactChildren-rxK4dzSS.js";import{c as We}from"./createSimplePaletteValueFilter-BGU1NRjf.js";import{B as Fe}from"./ButtonBase-DY__CRx9.js";import{T as H}from"./TextField-DZsQbxsq.js";import{B as X}from"./Button-CrXDoJqf.js";function Ye(e){return ie("MuiToggleButton",e)}const k=ne("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),fe=n.createContext({}),me=n.createContext(void 0);function Ue(e,o){return o===void 0||e===void 0?!1:Array.isArray(o)?o.includes(e):e===o}const Ve=e=>{const{classes:o,fullWidth:i,selected:p,disabled:f,size:x,color:y}=e,u={root:["root",p&&"selected",f&&"disabled",i&&"fullWidth",`size${z(x)}`,y]};return ue(u,Ye,o)},qe=ce(Fe,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:i}=e;return[o.root,o[`size${z(i.size)}`]]}})(pe(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${k.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:M(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${k.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(We()).map(([o])=>({props:{color:o},style:{[`&.${k.selected}`]:{color:(e.vars||e).palette[o].main,backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette[o].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),K=n.forwardRef(function(o,i){const{value:p,...f}=n.useContext(fe),x=n.useContext(me),y=Pe({...f,selected:Ue(o.value,p)},o),u=de({props:y,name:"MuiToggleButton"}),{children:v,className:h,color:b="standard",disabled:c=!1,disableFocusRipple:j=!1,fullWidth:d=!1,onChange:R,onClick:g,selected:m,size:T="medium",value:w,...D}=u,s={...u,color:b,disabled:c,disableFocusRipple:j,fullWidth:d,size:T},$=Ve(s),E=l=>{g&&(g(l,w),l.defaultPrevented)||R&&R(l,w)},a=x||"";return t.jsx(qe,{className:le(f.className,$.root,h,a),disabled:c,focusRipple:!j,ref:i,onClick:E,onChange:R,value:w,ownerState:s,"aria-pressed":m,...D,children:v})});function He(e){return ie("MuiToggleButtonGroup",e)}const r=ne("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Xe=e=>{const{classes:o,orientation:i,fullWidth:p,disabled:f}=e,x={root:["root",i,p&&"fullWidth"],grouped:["grouped",`grouped${z(i)}`,f&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return ue(x,He,o)},Ke=ce("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:i}=e;return[{[`& .${r.grouped}`]:o.grouped},{[`& .${r.grouped}`]:o[`grouped${z(i.orientation)}`]},{[`& .${r.firstButton}`]:o.firstButton},{[`& .${r.lastButton}`]:o.lastButton},{[`& .${r.middleButton}`]:o.middleButton},o.root,i.orientation==="vertical"&&o.vertical,i.fullWidth&&o.fullWidth]}})(pe(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${r.grouped}`]:{[`&.${r.selected} + .${r.grouped}.${r.selected}`]:{borderTop:0,marginTop:0}},[`& .${r.firstButton},& .${r.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${r.lastButton},& .${r.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${r.lastButton}.${k.disabled},& .${r.middleButton}.${k.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${r.grouped}`]:{[`&.${r.selected} + .${r.grouped}.${r.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${r.firstButton},& .${r.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${r.lastButton},& .${r.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${r.lastButton}.${k.disabled},& .${r.middleButton}.${k.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Je=n.forwardRef(function(o,i){const p=de({props:o,name:"MuiToggleButtonGroup"}),{children:f,className:x,color:y="standard",disabled:u=!1,exclusive:v=!1,fullWidth:h=!1,onChange:b,orientation:c="horizontal",size:j="medium",value:d,...R}=p,g={...p,disabled:u,fullWidth:h,orientation:c,size:j},m=Xe(g),T=n.useCallback((a,l)=>{if(!b)return;const S=d&&d.indexOf(l);let I;d&&S>=0?(I=d.slice(),I.splice(S,1)):I=d?d.concat(l):[l],b(a,I)},[b,d]),w=n.useCallback((a,l)=>{b&&b(a,d===l?null:l)},[b,d]),D=n.useMemo(()=>({className:m.grouped,onChange:v?w:T,value:d,size:j,fullWidth:h,color:y,disabled:u}),[m.grouped,v,w,T,d,j,h,y,u]),s=ze(f),$=s.length,E=a=>{const l=a===0,S=a===$-1;return l&&S?"":l?m.firstButton:S?m.lastButton:m.middleButton};return t.jsx(Ke,{role:"group",className:le(m.root,x),ref:i,ownerState:g,...R,children:t.jsx(fe.Provider,{value:D,children:s.map((a,l)=>t.jsx(me.Provider,{value:E(l),children:a},l))})})}),U="replyid",Qe=e=>{const i=`${`${window.location.origin}${window.location.pathname}`}?${U}=${e}`;Se(i).then(()=>A("Reply link copied to clipboard","info"))};function Y(e){const{reply:o,isReplyAuthorModerator:i=!1}=e,[p,f]=n.useState(!1),[x,y]=n.useState(!1),{data:u}=Z(),{data:v}=te(o.projectId),{data:h,isLoading:b}=Me(o),c=n.useRef(null),{mutate:j}=ke({onSuccess:()=>{y(!1),A("A reply has been deleted.","info")}}),d=o.createdBy==(u==null?void 0:u.ownerId);return n.useEffect(()=>{const g=new URLSearchParams(window.location.search).get(U);let m;return g===o.id&&c.current&&(c.current.style.transition="background-color 1s ease",c.current.style.backgroundColor="#fbf4e0",c.current.style.borderColor="#f4dda3",m=setTimeout(()=>{c.current&&(c.current.style.backgroundColor="#f9f9f9",c.current.style.borderColor="#ccc")},2e3)),()=>{m&&clearTimeout(m)}},[o.id]),t.jsx("div",{className:"reply-container",id:`reply._${o.id}`,ref:c,role:"article",children:b?t.jsx(Ae,{numCols:1,numRows:4}):t.jsx(t.Fragment,{children:h&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx(ae,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:i}),t.jsxs("div",{className:"message-body",children:[t.jsx(re,{markdown:h,objectType:ee.REPLY}),t.jsxs("span",{children:["posted ",oe(se(o.createdOn),"M/D/YYYY"),o.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsxs(O,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[t.jsx("button",{onClick:()=>Qe(o.id),children:t.jsx(B,{icon:"link",label:"Copy link to this reply"})}),d&&t.jsx("button",{onClick:()=>f(!0),children:t.jsx(B,{icon:"edit",label:"Edit reply"})}),(v==null?void 0:v.permissions.canModerate)&&t.jsx("button",{onClick:()=>y(!0),children:t.jsx(B,{icon:"delete",label:"Delete reply"})})]})]})]}),t.jsx(P,{isReply:!0,initialText:h,onClose:()=>f(!1),id:o.id,isDialog:!0,openDialog:p}),t.jsx(F,{open:x,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{y(!1)},onConfirm:()=>j({forumId:o.forumId,threadId:o.threadId,replyId:o.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{Y.displayName="DiscussionReply",Y.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const Ze="You are following this topic. Click to stop following.",et="You are not following this topic. Click to follow.",tt="You will need to sign in for access to that resource",J="Write a reply...";function Q(e){const{threadId:o,limit:i}=e,p="16px",[f,x]=n.useState(!0),[y,u]=n.useState(!1),[v,h]=n.useState(!1),[b,c]=n.useState(!1),[j,d]=n.useState(!1),[R,g]=n.useState(!1),[m,T]=n.useState(!1),[w,D]=n.useState(!1),{threadData:s,threadBody:$,togglePin:E}=Ne(o),{data:a}=Z(),{data:l}=te((s==null?void 0:s.projectId)??"",void 0,we,{enabled:!!s}),{subscription:S,toggleSubscribed:I,isLoading:ge}=Ee(o,q.THREAD),{mutate:xe}=Oe({onSuccess:()=>{d(!1),A("A thread has been deleted.","info")}}),{mutate:ye}=De({onSuccess:()=>{T(!1),A("A thread has been restored.","info")}}),he=(s==null?void 0:s.createdBy)==(a==null?void 0:a.ownerId);function be(){if((a==null?void 0:a.userName)=="anonymous")g(!0);else try{I()}catch(C){A(C.reason,"danger")}}const{data:L,hasNextPage:Ce,fetchNextPage:Be}=Ie(o,f,i),{data:N}=Ge((s==null?void 0:s.forumId)??"",{enabled:!!(s!=null&&s.forumId)}),ve=N==null?void 0:N.includes((s==null?void 0:s.createdBy)??""),[G,je]=Te(U),V=n.useMemo(()=>{const C=(L==null?void 0:L.pages.flatMap(_=>_.results))??[];return G?C.filter(_=>_.id===G):C},[L,G]),Re=()=>{je(null)};return t.jsxs("div",{className:"DiscussionThread",role:"article",children:[s&&$?t.jsxs(t.Fragment,{children:[t.jsxs(O,{sx:{mb:2,textAlign:"right"},children:[t.jsx(W,{component:"span",sx:{mr:1},children:"Sort:"}),t.jsxs(Je,{color:"primary",exclusive:!0,value:f?"datePosted":"mostRecent",children:[t.jsx(K,{value:"datePosted",onClick:()=>x(!0),children:"Date Posted"}),t.jsx(K,{value:"mostRecent",onClick:()=>x(!1),children:"Most Recent"})]})]}),t.jsx(ae,{userId:s.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:ve}),t.jsxs(O,{sx:C=>({[C.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:p,marginTop:p,".SubscribersModal":{justifyContent:"flex-start",marginBottom:p}}}),children:[t.jsx(W,{sx:{marginTop:"4px"},variant:"headline2",children:s.title}),t.jsx(Le,{id:o,objectType:q.THREAD,showModal:w,handleModal:D})]}),t.jsx("div",{children:t.jsx(re,{markdown:$,objectType:ee.THREAD})}),t.jsxs("span",{children:["posted ",oe(se(s.createdOn),"M/D/YYYY"),s.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsx(P,{isReply:!1,initialText:$,onClose:()=>u(!1),initialTitle:s==null?void 0:s.title,id:o,isDialog:!0,openDialog:y})]}):t.jsx(t.Fragment,{}),t.jsx(O,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:s!=null&&s.isDeleted?t.jsx("button",{onClick:()=>T(!0),children:t.jsx(B,{icon:"restore",label:"Restore deleted thread"})}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:t.jsx("button",{className:"follow-button","aria-label":S?"Unfollow thread":"Follow thread",disabled:ge,onClick:()=>be(),children:S?t.jsx(B,{icon:"visibility",label:Ze}):t.jsx(B,{icon:"visibilityOff",label:et})})}),he&&t.jsx("button",{onClick:()=>u(!0),children:t.jsx(B,{icon:"edit",label:"Edit thread"})}),l!=null&&l.permissions.canModerate?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>d(!0),children:t.jsx(B,{icon:"delete",label:"Delete thread"})}),t.jsx("button",{onClick:()=>E(),children:s!=null&&s.isPinned?t.jsx(B,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):t.jsx(B,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),t.jsx(O,{sx:{mt:2,mb:3},children:v?t.jsx(P,{id:o,isReply:!0,onClose:()=>h(!1),isDialog:!1}):t.jsx(H,{fullWidth:!0,placeholder:J,onClick:()=>{(a==null?void 0:a.userName)=="anonymous"?g(!0):h(!0)}})}),G&&t.jsxs(X,{variant:"outlined",onClick:Re,sx:{display:"flex",alignItems:"center",padding:"2px 8px",marginBottom:"12px",gap:"4px"},children:[t.jsx(B,{icon:"arrowBack",sx:{width:"16px"}}),t.jsx(W,{variant:"smallText2",children:"Show all replies"})]}),t.jsx("div",{children:V.map(C=>{const _=N==null?void 0:N.includes(C.createdBy);return t.jsx(Y,{reply:C,isReplyAuthorModerator:_},C.id)})}),V.length>0&&t.jsx(O,{sx:C=>({mt:2,mb:3,[C.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:b?t.jsx(P,{id:o,isReply:!0,onClose:()=>c(!1),isDialog:!1}):t.jsx(H,{fullWidth:!0,placeholder:J,onClick:()=>{(a==null?void 0:a.userName)=="anonymous"?g(!0):c(!0)}})}),Ce?t.jsx(X,{variant:"outlined",onClick:()=>{Be()},children:"Show more results"}):t.jsx(t.Fragment,{}),t.jsx(F,{open:j,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>d(!1),onConfirm:()=>s&&xe(s),confirmButtonColor:"error",confirmButtonText:"Delete"}),t.jsx(F,{open:m,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>s&&ye(s),confirmButtonColor:"info",confirmButtonText:"Restore"}),t.jsx(_e,{open:R,title:"Sign In Required",content:tt,onCancel:()=>g(!1),hasCancelButton:!1,onConfirm:()=>g(!1),confirmButtonProps:{children:"Sign In",className:$e}})]})}try{Q.displayName="DiscussionThread",Q.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{Q as D};
