import{j as e,d$ as le,r as l,J as de,b$ as ce,B as ue,c6 as me,c9 as pe,d4 as fe,dZ as he,c4 as N,_ as ye,ct as ge,cu as be,V as H,X as M,cx as Se}from"./iframe-DCJ7skCF.js";import{k as je,o as ve,p as Te}from"./useEntity-7Mmx4dfI.js";import{u as xe,b as U}from"./useSchema-Cwx_4fPV.js";import{h as Ve,g as G,j as Ae,v as we}from"./index-CeSsztJl.js";import{a as Fe,C as qe}from"./ConfirmationDialog-CNckvYkU.js";import{g as X,c as _e,a as Ee,b as Ie,d as Oe,s as Ce,J as Ne,t as De,e as Re,h as ke,i as Pe,j as Le}from"./JsonSchemaForm-VYwFYl8Q.js";import{A as P,d as Be,g as Je,T as $e}from"./enums-_3bGLgvO.js";import"./index-Chi_LkuB.js";import{b as He}from"./use-deep-compare-effect.esm-DRQaZ9j-.js";import{G as W}from"./GridLegacy-D2s81Tma.js";import{T as Me}from"./TextWidget-DN33xwVW.js";const O=t=>e.jsx(le,{...t,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M14 10H2V12H14V10ZM14 6H2V8H14V6ZM18 14V10H16V14H12V16H16V20H18V16H22V14H18ZM2 16H10V14H2V16Z"})});try{O.displayName="AddToList",O.__docgenInfo={description:"",displayName:"AddToList",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function D(t){const{schema:a,formData:n,onChange:s}=t,{fields:{ObjectField:f}}=Ve();return l.useEffect(()=>{const d={...n},c=X(a);c&&(Object.entries(c).forEach(([h,o])=>{const u=d[h];o[P]?Array.isArray(u)||(d[h]=_e(u)):typeof o=="object"&&"type"in o&&o.type!=="array"&&Array.isArray(u)&&(d[h]=u.map(i=>`${i}`).join(", "))}),Be(n,d)||s(d))},[a,n,s]),e.jsx(f,{...t})}try{D.displayName="SynapseAnnotationsRJSFObjectField",D.__docgenInfo={description:"Extends the",displayName:"SynapseAnnotationsRJSFObjectField",props:{schema:{defaultValue:null,description:"The schema object for the field being described",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this base component",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}function R(t){const{description:a,disabled:n,formData:s,idSchema:f,onAddClick:d,properties:c,readonly:h,registry:o,required:u,schema:i,title:j,uiSchema:g}=t,m=Je(g),v=G("TitleFieldTemplate",o,m),T=G("DescriptionFieldTemplate",o,m),A=l.useRef(new Set);return He(()=>{if("properties"in i&&i.properties){const x=Object.keys(i.properties),F=new Set(x.filter(b=>!i.properties[b][P]));if(A.current!=null){const b=Array.from(A.current).filter(p=>!F.has(p)&&!!s&&s[p]!=null&&Array.isArray(s[p])&&s[p].filter(y=>y!=null).length>0);b.length>0&&de(`The following annotations are no longer specified by the schema and have been converted to custom fields: ${b.join(", ")}.`,"warning",{title:"Fields No Longer Specified By Schema"})}A.current=F}},[i.properties]),e.jsxs("fieldset",{id:f.$id,children:[(m.title||j)&&e.jsx(v,{id:`${f.$id}__title`,schema:i,title:m.title||j,required:u,uiSchema:g,registry:o}),(m.description||a)&&e.jsx(T,{id:`${f.$id}__description`,description:m.description||a,registry:o,schema:i}),c.map(x=>x.content),Ae(i,g,s)&&e.jsx(ce,{title:"Add a new custom field",placement:"top",children:e.jsx(ue,{sx:{my:2},variant:"contained",className:"rjsf-object-property-expand",onClick:d(i),disabled:n||h,"aria-label":"Add Custom Field",children:e.jsx(O,{})})})]})}try{R.displayName="ObjectFieldTemplate",R.__docgenInfo={description:`Derived from the base ObjectFieldTemplate with annotations-editor-specific changes
- Custom button for adding additional properties
- Tracks properties to show a toast message if a property is converted to an additionalProperty because it was
  dropped from the schema (e.g. in a conditional schema)

See https://github.com/rjsf-team/react-jsonschema-form/blob/main/packages/mui/src/ObjectFieldTemplate/ObjectFieldTemplate.tsx`,displayName:"ObjectFieldTemplate",props:{schema:{defaultValue:null,description:"The schema object for the field being described",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this base component",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}},title:{defaultValue:null,description:"A string value containing the title for the object",name:"title",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"A string value containing the description for the object",name:"description",required:!1,type:{name:"string | ReactElement<unknown, string | JSXElementConstructor<any>>"}},disabled:{defaultValue:null,description:"A boolean value stating if the object is disabled",name:"disabled",required:!1,type:{name:"boolean"}},properties:{defaultValue:null,description:"An array of objects representing the properties in the object",name:"properties",required:!0,type:{name:"ObjectFieldTemplatePropertyType[]"}},onAddClick:{defaultValue:null,description:"Returns a function that adds a new property to the object (to be used with additionalProperties)",name:"onAddClick",required:!0,type:{name:"(schema: S) => () => void"}},readonly:{defaultValue:null,description:"A boolean value stating if the object is read-only",name:"readonly",required:!1,type:{name:"boolean"}},required:{defaultValue:null,description:"A boolean value stating if the object is required",name:"required",required:!1,type:{name:"boolean"}},hideError:{defaultValue:null,description:"A boolean value stating if the field is hiding its errors",name:"hideError",required:!1,type:{name:"boolean"}},idSchema:{defaultValue:null,description:"An object containing the id for this object & ids for its properties",name:"idSchema",required:!0,type:{name:"FieldId & { [x: string]: FieldId | (FieldId & { [x: string]: FieldId | (FieldId & ...); }); }"}},errorSchema:{defaultValue:null,description:"The optional validation errors in the form of an `ErrorSchema`",name:"errorSchema",required:!1,type:{name:"ErrorSchema<T>"}},formData:{defaultValue:null,description:"The form data for the object",name:"formData",required:!1,type:{name:"Record<string, any>"}},formContext:{defaultValue:null,description:"The `formContext` object that was passed to Form",name:"formContext",required:!1,type:{name:"GenericObjectType"}}}}}catch{}function k(t){const{id:a,classNames:n,disabled:s,label:f,onKeyChange:d,readonly:c,required:h,schema:o,children:u,registry:i}=t,{translateString:j}=i,g=j($e.KeyLabel,[""]);if(!(P in o))return e.jsx("div",{className:n,children:u});const v=({target:T})=>{T&&d(T.value)};return e.jsx("div",{className:n,children:e.jsxs(W,{container:!0,columnSpacing:2,rowSpacing:0,sx:{my:1},children:[e.jsx(W,{item:!0,xs:3,children:e.jsx(me,{fullWidth:!0,required:h,label:g,defaultValue:f,disabled:s||c,id:`${a}-key`,name:`${a}-key`,onBlur:c?void 0:v,type:"text"})}),u]})})}try{k.displayName="SynapseAnnotationsWrapIfAdditionalTemplate",k.__docgenInfo={description:"The `WrapIfAdditional` component is used by the `FieldTemplate` to rename, or remove properties that are\npart of an `additionalProperties` part of a schema.",displayName:"SynapseAnnotationsWrapIfAdditionalTemplate",props:{schema:{defaultValue:null,description:"The schema object for the field being described",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this base component",name:"uiSchema",required:!1,type:{name:"GenericObjectType & MakeUIType<UIOptionsBaseType<T, S, F>> & { 'ui:globalOptions'?: GlobalUISchemaOptions; 'ui:rootFieldId'?: string; 'ui:fieldReplacesAnyOrOneOf'?: boolean; 'ui:options'?: UIOptionsType<...>; }"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}},children:{defaultValue:null,description:"The field or widget component instance for this field row",name:"children",required:!0,type:{name:"ReactNode"}},style:{defaultValue:null,description:"An object containing the style as defined in the `uiSchema`",name:"style",required:!1,type:{name:"StyleHTMLAttributes<any>"}},disabled:{defaultValue:null,description:"A boolean value stating if the field is disabled",name:"disabled",required:!0,type:{name:"boolean"}},label:{defaultValue:null,description:"The computed label for this field, as a string",name:"label",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"The id of the field in the hierarchy. You can use it to render a label targeting the wrapped widget",name:"id",required:!0,type:{name:"string"}},required:{defaultValue:null,description:"A boolean value stating if the field is required",name:"required",required:!1,type:{name:"boolean"}},classNames:{defaultValue:null,description:"A string containing the base CSS classes, merged with any custom ones defined in your uiSchema",name:"classNames",required:!1,type:{name:"string"}},hideError:{defaultValue:null,description:"A boolean value stating if the field is hiding its errors",name:"hideError",required:!1,type:{name:"boolean"}},readonly:{defaultValue:null,description:"A boolean value stating if the field is read-only",name:"readonly",required:!0,type:{name:"boolean"}},rawErrors:{defaultValue:null,description:"An array of strings listing all generated error messages from encountered errors for this field",name:"rawErrors",required:!1,type:{name:"string[]"}},onKeyChange:{defaultValue:null,description:"The key change event handler; Called when the key associated with a field is changed for an additionalProperty",name:"onKeyChange",required:!0,type:{name:"(value: string) => () => void"}},onDropPropertyClick:{defaultValue:null,description:"The property drop/removal event handler; Called when a field is removed in an additionalProperty context",name:"onDropPropertyClick",required:!0,type:{name:"(value: string) => () => void"}}}}}catch{}function K(t,a){let n=Pe(t);return a&&(n=Le(n)),n}function Z(t){const{entityId:a,schemaId:n,validationSchema:s,liveValidate:f,onSuccess:d=()=>{},onCancel:c,formRef:h,onChange:o=pe,hideActions:u=!1}=t,i=l.useRef(null),j=h??i,[g,m]=l.useState(void 0),[v,T]=l.useState(void 0),[A,x]=l.useState(!1),[F,b]=l.useState(!1),{data:p}=je(a,void 0,!1,{staleTime:1/0,enabled:!!a,throwOnError:!0}),y=p?.entityMetadata,q=p?.annotations,[_,E]=l.useState(void 0);l.useEffect(()=>{if(p?.entity){const r=p.entity,w=q&&Object.keys(q).length>0?r:{...r,newKey:[""]};E(w)}},[p?.entity,q]);const{data:V,isLoading:Y}=xe(a,{enabled:!!a,refetchOnWindowFocus:!1,throwOnError:!0}),{data:z,isLoading:Q}=U(n??V?.jsonSchemaVersionInfo.$id??"",{enabled:!!n||!!V,throwOnError:!0}),C=s||z,L=Ee(y?.concreteType??""),{data:I,isLoading:ee}=U(L??"",{enabled:!!L,throwOnError:!0}),B=l.useMemo(()=>X(I??{}),[I]),te=l.useMemo(()=>Ie(C,I),[C,I]),ae=l.useMemo(()=>Oe(B),[B]),ne=Y||Q||ee,{mutate:ie,isPending:re}=ve({onSuccess:()=>{d()},onError:r=>{T(r),x(!0)}});function J(){ie({...K(_,!0),...y})}const $=f??Ce(q,C),oe=y&&fe(Te(_,(r,S)=>Object.keys(y).find(w=>w===S))),se=V===null&&oe;return e.jsx("div",{className:"JsonSchemaFormContainer",children:ne?e.jsx("div",{className:"LoadingPlaceholder",children:e.jsx(he,{size:30})}):e.jsxs(e.Fragment,{children:[y&&V&&e.jsxs(N,{severity:"info",sx:{mb:2},children:[e.jsx("b",{children:y.name})," requires scientific annotations specified by ",e.jsx("b",{children:V.jsonSchemaVersionInfo.$id}),". ",e.jsx("b",{children:e.jsx(ye,{href:`${ge(be.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${V.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:"View required schema (JSON)"})})]}),se&&e.jsx(N,{severity:"info",children:e.jsxs(H,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsxs(M,{variant:"smallText1",children:[e.jsx("b",{children:y.name})," has no annotations. Click the"," "]}),e.jsx(O,{}),e.jsx(M,{variant:"smallText1",children:"button to annotate."})]})}),e.jsxs(Ne,{validator:we,liveValidate:$,noHtml5Validate:!0,formRef:j,disabled:re,translateString:Re,formContext:{showDerivedAnnotationPlaceholder:!0,descriptionVariant:"expand",descriptionFormat:"table",allowFreeSoloEnum:!0},experimental_defaultFormStateBehavior:{emptyObjectFields:"skipDefaults"},fields:{ObjectField:D},templates:{ObjectFieldTemplate:R,WrapIfAdditionalTemplate:k},widgets:{TextWidget:Me},schema:te,uiSchema:ae,transformErrors:De,formData:_,onChange:({formData:r})=>{o(r),E(r),m(void 0)},onBlur:()=>{E(K(_,!1))},onSubmit:({formData:r,errors:S},w)=>{w.preventDefault(),S&&S.length>0&&m(S),x(!1),E(r),J()},onError:r=>{m(r),(g||$)&&a&&b(!0)},children:[v&&A&&e.jsxs(N,{severity:"error",sx:{my:2},children:["Annotations could not be updated: ",v.reason]}),!u&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{sx:{my:2}}),e.jsx(H,{sx:{display:"flex",justifyContent:"space-between",gridRowStart:5},children:e.jsx(Fe,{hasCancelButton:c!==void 0,onCancel:()=>{c&&c()},onConfirm:()=>{j.current.formElement.current.requestSubmit()},confirmButtonProps:{children:a?"Save":"Validate"}})})]})]}),F&&e.jsx(qe,{open:!0,onConfirm:()=>{J(),b(!1)},onCancel:()=>{b(!1)},title:"Update Annotations",content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"The following errors exist with the annotations you entered:"}),e.jsx("div",{children:e.jsx("ul",{children:(g??[]).map((r,S)=>e.jsxs("li",{children:[e.jsx("b",{children:`${ke(r)}: `})," ",`${r.message}`]},S))})}),e.jsx("div",{children:"Are you sure you want to save the invalid annotations?"})]}),confirmButtonProps:{children:"Save"}})]})})}try{Z.displayName="SchemaDrivenAnnotationEditor",Z.__docgenInfo={description:`Renders a form for editing an entity's annotations. The component also supports supplying just a schema ID,
but work to support annotation flows without an entity (i.e. before creating entities) is not yet complete.`,displayName:"SchemaDrivenAnnotationEditor",props:{entityId:{defaultValue:null,description:"The entity whose annotations should be edited with the form",name:"entityId",required:!1,type:{name:"string"}},schemaId:{defaultValue:null,description:"If no entity ID is supplied, the schema to use for the form",name:"schemaId",required:!1,type:{name:"string"}},validationSchema:{defaultValue:null,description:"May be used to directly provide a JSON Schema to use for the form",name:"validationSchema",required:!1,type:{name:"JSONSchema7"}},formRef:{defaultValue:null,description:"Optionally supply a ref to the form to handle submission externally with `formRef.current.submit()`.",name:"formRef",required:!1,type:{name:"RefObject<Form<any, RJSFSchema, any>>"}},liveValidate:{defaultValue:null,description:"Provide live input validation. This can cause performance degradation. By default, liveValidate will be true if an entity with a schema and existing annotations is being edited",name:"liveValidate",required:!1,type:{name:"boolean"}},onSuccess:{defaultValue:null,description:"Invoked after a successful form submission",name:"onSuccess",required:!1,type:{name:"() => void"}},onCancel:{defaultValue:null,description:"If defined and formRef is not supplied, shows a 'Cancel' button and runs this effect on click",name:"onCancel",required:!1,type:{name:"() => void"}},onChange:{defaultValue:null,description:"Passes new form data upon each change to the form",name:"onChange",required:!1,type:{name:"(annotations: Record<string, unknown>) => void"}},hideActions:{defaultValue:null,description:"If true, the editor will not render its own submit UI.",name:"hideActions",required:!1,type:{name:"boolean"}}}}}catch{}export{O as A,Z as S};
