import{an as Y,am as R,r as c,ce as X,gX as Q,d0 as P,dj as j,di as z,f5 as Z,eW as ee,j as e,X as u,_ as te,ct as ae,cu as oe,c6 as re,fc as se,dE as ie,e4 as ne,c4 as D,d4 as le,J as ce,B as k}from"./iframe-C0ErQzQQ.js";import{C as de}from"./ConfirmCloseWithoutSavingDialog-D_4mvrms.js";import{D as ue}from"./DialogBase-BqMUco36.js";import{J as pe}from"./JsonSchemaForm-DgbK39de.js";import{M as me}from"./MarkdownPopover-DEfGytzJ.js";import{a as ye,D as he,b as fe}from"./useDOI-CQJVgToG.js";import{u as be,e as ge}from"./useEntity-Clvf9s8c.js";import{d as Te}from"./useUserBundle-Cvm8I5oN.js";import{H as ve}from"./HelpTwoTone-bEVCqB9F.js";import{M as V}from"./MenuItem-C5fdYvEk.js";const F={Collection:"Collection",Dataset:"Dataset"},De={definitions:{"org.sagebionetworks.repo.model.doi.v2.DoiResourceTypeGeneral":{type:"string",enum:["Audiovisual","Collection","DataPaper","Dataset","Event","Image","InteractiveResource","Model","PhysicalObject","Service","Software","Sound","Text","Workflow","Other"]}},type:"object",properties:{titles:{description:"The title or titles of your work.",type:"array",items:{type:"string"},title:"Title(s)"},creators:{title:"Creator(s)",description:"The main creators or authors of your work, in priority order. These may be the names of actual people and/or institutions.",type:"array",items:{type:"string"}},resourceTypeGeneral:{$ref:"#/definitions/org.sagebionetworks.repo.model.doi.v2.DoiResourceTypeGeneral",title:"General Resource Type",description:"The general type of content that best matches this work."},publicationYear:{type:"integer",title:"Publication Year",description:"The year this work became or will become public. May be at most one year in the future."}},required:["titles","creators","resourceTypeGeneral","publicationYear"]},je={"ui:submitButtonOptions":{norender:!0},"ui:order":["creators","titles","resourceTypeGeneral","publicationYear"],creators:{items:{"ui:placeholder":"Last, First"}},titles:{items:{"ui:placeholder":"My Synapse Object"}},publicationYear:{"ui:placeholder":"YYYY"}};function we(a,o){const{synapseClient:r,keyFactory:s}=Y();return R({...o,queryKey:s.getPortalKey(a),queryFn:()=>r.portalsServicesClient.getRepoV1PortalPortalId({portalId:a})})}function Le(a,o){const{synapseClient:r,keyFactory:s}=Y();return R({...o,queryKey:s.getPortalPermissionsKey(a),queryFn:()=>r.portalsServicesClient.getRepoV1PortalPortalIdPermissions({portalId:a})})}function Ce(a){return a===j.project||a===j.folder?F.Collection:F.Dataset}function Ie(a){var o;return{titles:(a.titles||[]).map(r=>r.title),creators:(a.creators||[]).map(r=>r.creatorName),resourceTypeGeneral:(o=a.resourceType)==null?void 0:o.resourceTypeGeneral,publicationYear:a.publicationYear}}function xe(a){var o;return!!((o=a.creators)!=null&&o.some(r=>!le(r.nameIdentifiers)))}function Oe(a){var o,r;return{titles:((o=a.titles)==null?void 0:o.map(s=>({title:s})))||[],creators:((r=a.creators)==null?void 0:r.map(s=>({creatorName:s})))||[],resourceType:{resourceTypeGeneral:a.resourceTypeGeneral},publicationYear:a.publicationYear}}function G(a){const{open:o,onClose:r,objectType:s,objectId:p,defaultVersionNumber:L,portalId:d}=a,[M,h]=c.useState(!1),{isEditing:q,setIsEditing:f}=X();c.useEffect(()=>(f(o),()=>{f(!1)}),[o,f]);function w(){q?h(!0):r()}const[m,C]=c.useState(L),{data:b}=we(d,{enabled:!!d}),[I,g]=c.useState({titles:[""],creators:[""]}),{data:l,isLoading:A}=Te(),{data:i,isLoading:U}=be(p,m,{staleTime:1/0,enabled:s==="ENTITY",throwOnError:!0}),{data:n,isLoading:_}=ye({id:p,version:m,type:s,portalId:d},{staleTime:1/0,throwOnError:!0}),x=s===he.ENTITY&&i&&Q(i),{data:O}=ge(p,void 0,void 0,{enabled:x}),T=c.useRef(null),B=i?P(i.concreteType):j.file,y=z(B);let S=`A DOI can be associated with a specific version of this ${y}.
  
  Versioned DOIs will link to the specified version of the ${y}.
  
  A DOI without a version will always link to the newest version of this ${y},
     so the data that someone retrieves using the DOI may change over time.`;if(i&&Z(i)){const t=ee(i)?"version":"snapshot";S+=`

To create a DOI that will always link to the current set of data in the ${y},
     create a new ${t} and mint a DOI for that ${t}.`}const{mutate:$,isPending:W,error:N}=fe({onSuccess:()=>{ce("The DOI was successfully updated.","success"),r()}}),v=W||A||U||_,E=!!(n&&xe(n));c.useEffect(()=>{if(n&&g(Ie(n)),l&&i&&n===null){const t={titles:[i.name],creators:new Array,resourceTypeGeneral:Ce(P(i.concreteType)),publicationYear:new Date().getFullYear()};l.lastName&&l.firstName&&t.creators.push(`${l.lastName}, ${l.firstName}`),g(t)}},[l,n,i]);function H(){if(T.current&&T.current.validateForm()){const t=Oe(I);t.objectType=s,t.objectId=p,t.objectVersion=m,t.etag=n==null?void 0:n.etag,t.portalId=d,$({doi:t,concreteType:"org.sagebionetworks.repo.model.doi.v2.DoiRequest"})}}const J=e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"body1",gutterBottom:!0,children:"Minting a DOI allows you to credit contributors and makes it easy to cite your work."}),e.jsxs(u,{variant:"body1",gutterBottom:!0,sx:{mb:2},children:["Note that while the DOI and its associated metadata will be publicly visible outside of Synapse, your data will still adhere to its existing access conditions. If your data is private, it will remain restricted, but the DOI will still be listed. Resources with DOIs may be added to the"," ",e.jsx(te,{href:`${ae(oe.PORTAL_ENDPOINT)}DataCatalog:0`,target:"_blank",children:"Synapse Data Catalog"}),"."]}),d&&e.jsx(re,{label:"Publisher",fullWidth:!0,value:(b==null?void 0:b.name)||"",disabled:!0}),x&&e.jsxs(se,{className:"limit-type",fullWidth:!0,sx:{my:2},children:[e.jsxs(ie,{htmlFor:"doi-version-select",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:"Version"}),e.jsx(me,{contentProps:{markdown:S},maxWidth:"350px",children:e.jsx(ve,{className:"HelpButton"})})]}),e.jsxs(ne,{id:"doi-version-select",value:m??-1,onChange:t=>{t.target.value===-1?C(void 0):C(t.target.value)},children:[e.jsx(V,{value:-1,children:"No version"}),O&&O.results.map(t=>e.jsxs(V,{value:t.versionNumber,children:["Version ",t.versionNumber,t.versionLabel&&t.versionLabel!==String(t.versionNumber)?` / ${t.versionLabel}`:""]},t.versionNumber))]})]}),e.jsx("div",{className:"JsonSchemaFormContainer",children:e.jsx(pe,{formRef:T,disabled:v||E,schema:De,formData:I,onChange:t=>{g(t.formData)},uiSchema:je,showErrorList:!1})}),n&&e.jsx(D,{severity:"warning",children:e.jsx(u,{variant:"body1",children:"A DOI has already been created. Updating the DOI information will cause old information to be lost!"})}),E&&e.jsx(D,{severity:"warning",sx:{my:1},children:e.jsx(u,{variant:"body1",children:"The metadata for this DOI was modified using a programmatic client, so data may be hidden from this view. Any changes may result in metadata being lost."})}),N&&e.jsx(D,{severity:"error",sx:{mt:1},children:e.jsx(u,{variant:"body1",children:N.message})})]}),K=e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"outlined",disabled:v,onClick:w,children:"Cancel"}),e.jsx(k,{variant:"contained",disabled:v,onClick:t=>{t.preventDefault(),H()},children:"Save"})]});return e.jsxs(e.Fragment,{children:[e.jsx(de,{open:M,onCancel:()=>{h(!1)},onConfirm:()=>{h(!1),r()}}),e.jsx(ue,{open:o,onCancel:w,title:"Create or Update a DOI",content:J,actions:K})]})}try{G.displayName="CreateOrUpdateDoiModal",G.__docgenInfo={description:"",displayName:"CreateOrUpdateDoiModal",props:{open:{defaultValue:null,description:"Whether the dialog is open",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Callback to call when the dialog is closed",name:"onClose",required:!0,type:{name:"() => void"}},objectType:{defaultValue:null,description:"The type of object",name:"objectType",required:!0,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"PORTAL_RESOURCE"'}]}},objectId:{defaultValue:null,description:"The ID of the object",name:"objectId",required:!0,type:{name:"string"}},defaultVersionNumber:{defaultValue:null,description:"The optional version number of the object used to populate the form.",name:"defaultVersionNumber",required:!1,type:{name:"number"}},portalId:{defaultValue:null,description:"If minting a DOI for a portal, the ID of the portal object in Synapse",name:"portalId",required:!1,type:{name:"string"}}}}}catch{}export{G as C,Le as u};
