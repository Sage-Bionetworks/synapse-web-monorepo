{"version":3,"file":"ForumPage-1a511a6d.js","sources":["../../src/components/Forum/ForumTable.tsx","../../src/components/Forum/ForumPage.tsx"],"sourcesContent":["import dayjs from 'dayjs'\nimport React, { useState } from 'react'\nimport { Table } from 'react-bootstrap'\nimport SortIcon from '../../assets/icons/Sort'\nimport { useGetForumInfinite } from '../../synapse-queries/forum/useForum'\nimport { AVATAR } from '../../utils/SynapseConstants'\nimport {\n  Direction,\n  DiscussionFilter,\n  DiscussionThreadOrder,\n} from '@sage-bionetworks/synapse-types'\nimport IconSvg from '../IconSvg/IconSvg'\nimport UserCard from '../UserCard/UserCard'\nimport { Button, Link } from '@mui/material'\nimport { UserBadge } from '../UserCard/UserBadge'\n\nexport type ForumTableProps = {\n  forumId: string\n  limit: number\n  onClickLink: (threadId: string) => void\n  filter: DiscussionFilter\n}\n\nexport const ForumTable: React.FC<ForumTableProps> = ({\n  forumId,\n  limit,\n  filter,\n  onClickLink,\n}) => {\n  const [sort, setSort] = useState<DiscussionThreadOrder>(\n    DiscussionThreadOrder.PINNED_AND_LAST_ACTIVITY,\n  )\n  const [isAscending, setIsAscending] = useState(false)\n\n  const { data, hasNextPage, fetchNextPage } = useGetForumInfinite(\n    forumId,\n    limit,\n    sort,\n    isAscending,\n    filter,\n  )\n\n  const threads = data?.pages.flatMap(page => page.results) ?? []\n\n  const onSort = (field: DiscussionThreadOrder) => {\n    if (sort == field) {\n      setSort(field)\n      setIsAscending(!isAscending)\n    } else {\n      setSort(field)\n      setIsAscending(false)\n    }\n  }\n\n  return (\n    <div className=\"ForumTable bootstrap-4-backport\">\n      <Table>\n        <thead>\n          <tr>\n            <th>\n              <span className=\"SRC-split\">\n                <span>Topic</span>\n                <SortIcon\n                  role=\"button\"\n                  aria-label=\"Sort by Topic\"\n                  active={sort === DiscussionThreadOrder.THREAD_TITLE}\n                  direction={\n                    sort === 'THREAD_TITLE'\n                      ? isAscending === false\n                        ? Direction.DESC\n                        : Direction.ASC\n                      : Direction.DESC\n                  }\n                  onClick={() => onSort(DiscussionThreadOrder.THREAD_TITLE)}\n                />\n              </span>\n            </th>\n            <th>Author</th>\n            <th>Active Users</th>\n            <th>\n              <span className=\"SRC-split\">\n                <span>Replies</span>\n                <SortIcon\n                  role=\"button\"\n                  aria-label=\"Sort by Replies\"\n                  active={sort === DiscussionThreadOrder.NUMBER_OF_REPLIES}\n                  direction={\n                    sort === 'NUMBER_OF_REPLIES'\n                      ? isAscending === false\n                        ? Direction.DESC\n                        : Direction.ASC\n                      : Direction.DESC\n                  }\n                  onClick={() =>\n                    onSort(DiscussionThreadOrder.NUMBER_OF_REPLIES)\n                  }\n                />\n              </span>\n            </th>\n            <th>\n              <span className=\"SRC-split\">\n                <span>Views</span>\n                <SortIcon\n                  role=\"button\"\n                  aria-label=\"Sort by Views\"\n                  active={sort === DiscussionThreadOrder.NUMBER_OF_VIEWS}\n                  direction={\n                    sort === 'NUMBER_OF_VIEWS'\n                      ? isAscending === false\n                        ? Direction.DESC\n                        : Direction.ASC\n                      : Direction.DESC\n                  }\n                  onClick={() => onSort(DiscussionThreadOrder.NUMBER_OF_VIEWS)}\n                />\n              </span>\n            </th>\n            <th>\n              <span className=\"SRC-split\">\n                <span>Activity</span>\n                <SortIcon\n                  role=\"button\"\n                  aria-label=\"Sort by Last Activity\"\n                  active={\n                    sort === DiscussionThreadOrder.PINNED_AND_LAST_ACTIVITY\n                  }\n                  direction={\n                    sort === 'PINNED_AND_LAST_ACTIVITY'\n                      ? isAscending === false\n                        ? Direction.DESC\n                        : Direction.ASC\n                      : Direction.DESC\n                  }\n                  onClick={() =>\n                    onSort(DiscussionThreadOrder.PINNED_AND_LAST_ACTIVITY)\n                  }\n                />\n              </span>\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          {threads.map(item => {\n            return (\n              <tr key={item.id}>\n                <td>\n                  <Link onClick={() => onClickLink(item.id)}>\n                    {item.isPinned ? <IconSvg icon=\"pushpin\" /> : <></>}\n                    {item.title}\n                  </Link>\n                </td>\n                <td>\n                  <UserBadge userId={item.createdBy} />\n                </td>\n                <td>\n                  {item.activeAuthors.map(user => (\n                    <div key={user} className=\"avatarContainer\">\n                      <UserCard\n                        showCardOnHover={true}\n                        className=\"ActiveUsers\"\n                        size={AVATAR}\n                        avatarSize={'MEDIUM'}\n                        ownerId={user}\n                      />\n                    </div>\n                  ))}\n                </td>\n                <td>{item.numberOfReplies}</td>\n                <td>{item.numberOfViews}</td>\n                <td>{dayjs(item.lastActivity).format('L')}</td>\n              </tr>\n            )\n          })}\n        </tbody>\n      </Table>\n      {hasNextPage && (\n        <Button\n          variant=\"outlined\"\n          color=\"primary\"\n          onClick={() => {\n            fetchNextPage()\n          }}\n        >\n          Show more results\n        </Button>\n      )}\n    </div>\n  )\n}\n","import { Button, Typography } from '@mui/material'\nimport React, { useState } from 'react'\nimport { useGetCurrentUserProfile } from '../../synapse-queries'\nimport { useGetModerators } from '../../synapse-queries/forum/useForum'\nimport { useSubscription } from '../../synapse-queries/subscription/useSubscription'\nimport { SRC_SIGN_IN_CLASS } from '../../utils/SynapseConstants'\nimport { DiscussionFilter } from '@sage-bionetworks/synapse-types'\nimport { SubscriptionObjectType } from '@sage-bionetworks/synapse-types'\nimport { displayToast } from '../ToastMessage/ToastMessage'\nimport { ForumTable } from './ForumTable'\nimport { ForumThreadEditor } from './ForumThreadEditor'\nimport { SubscribersModal } from './SubscribersModal'\nimport { ConfirmationDialog } from '../ConfirmationDialog/ConfirmationDialog'\n\nexport type ForumPageProps = {\n  forumId: string\n  limit: number\n  onClickLink: (threadId: string) => void\n}\n\nconst SIGN_IN_TEXT = 'You will need to sign in for access to that resource'\n\nexport const ForumPage: React.FC<ForumPageProps> = ({\n  forumId,\n  limit,\n  onClickLink,\n}) => {\n  const [showThreadModal, setShowThreadModal] = useState(false)\n  const [showSignInModal, setShowSignInModal] = useState(false)\n  const [showDeletedThread, setShowDeletedThread] = useState(false)\n  const [showSubscriberModal, setShowSubscriberModal] = useState(false)\n  const { subscription, isLoading, toggleSubscribed } = useSubscription(\n    forumId,\n    SubscriptionObjectType.FORUM,\n  )\n\n  function handleFollowBtn() {\n    try {\n      toggleSubscribed()\n    } catch (err: any) {\n      displayToast(err.reason as string, 'danger')\n    }\n  }\n  const { data: moderatorList } = useGetModerators(forumId)\n  const { data: currentUserProfile } = useGetCurrentUserProfile()\n\n  const isCurrentUserModerator = moderatorList?.results.includes(\n    currentUserProfile?.ownerId ?? '',\n  )\n\n  const handleNewThreadBtn = () => {\n    if (currentUserProfile?.userName == 'anonymous') {\n      setShowSignInModal(true)\n    } else {\n      setShowThreadModal(true)\n    }\n  }\n\n  return (\n    <div className=\"ForumTable bootstrap-4-backport\">\n      <div className=\"ForumTable__top-level-control\">\n        <SubscribersModal\n          id={forumId}\n          objectType={SubscriptionObjectType.FORUM}\n          showModal={showSubscriberModal}\n          handleModal={setShowSubscriberModal}\n        />\n        <Button\n          variant={subscription ? 'outlined' : 'contained'}\n          color=\"primary\"\n          onClick={() => handleFollowBtn()}\n          disabled={isLoading}\n        >\n          {subscription ? 'Unfollow' : 'Follow'}\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={() => handleNewThreadBtn()}\n        >\n          New Thread\n        </Button>\n        {isCurrentUserModerator && (\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => setShowDeletedThread(!showDeletedThread)}\n          >\n            {showDeletedThread\n              ? 'Hide Deleted Threads'\n              : 'Show Deleted Threads'}\n          </Button>\n        )}\n      </div>\n      {showDeletedThread && (\n        <>\n          <Typography variant=\"h4\">Deleted Threads</Typography>\n          <ForumTable\n            onClickLink={onClickLink}\n            forumId={forumId}\n            limit={limit}\n            filter={DiscussionFilter.DELETED_ONLY}\n          />\n        </>\n      )}\n      <ForumTable\n        onClickLink={onClickLink}\n        forumId={forumId}\n        limit={limit}\n        filter={DiscussionFilter.EXCLUDE_DELETED}\n      />\n      <ForumThreadEditor\n        isReply={false}\n        id={forumId}\n        onClose={() => setShowThreadModal(false)}\n        isDialog={true}\n        openDialog={showThreadModal}\n      />\n      <ConfirmationDialog\n        open={showSignInModal}\n        title=\"Sign In Required\"\n        content={SIGN_IN_TEXT}\n        onCancel={() => setShowSignInModal(false)}\n        hasCancelButton={false}\n        onConfirm={() => setShowSignInModal(false)}\n        confirmButtonText=\"Sign In\"\n        confirmButtonClassName={SRC_SIGN_IN_CLASS}\n      />\n    </div>\n  )\n}\n"],"names":["ForumTable","forumId","limit","filter","onClickLink","sort","setSort","useState","DiscussionThreadOrder","isAscending","setIsAscending","data","hasNextPage","fetchNextPage","useGetForumInfinite","threads","page","onSort","field","jsxs","Table","jsx","SortIcon","Direction","item","Link","IconSvg","Fragment","UserBadge","user","UserCard","AVATAR","dayjs","Button","SIGN_IN_TEXT","ForumPage","showThreadModal","setShowThreadModal","showSignInModal","setShowSignInModal","showDeletedThread","setShowDeletedThread","showSubscriberModal","setShowSubscriberModal","subscription","isLoading","toggleSubscribed","useSubscription","SubscriptionObjectType","handleFollowBtn","err","displayToast","moderatorList","useGetModerators","currentUserProfile","useGetCurrentUserProfile","isCurrentUserModerator","handleNewThreadBtn","SubscribersModal","Typography","DiscussionFilter","ForumThreadEditor","ConfirmationDialog","SRC_SIGN_IN_CLASS"],"mappings":"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"}