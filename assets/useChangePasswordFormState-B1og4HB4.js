import{aE as q,a9 as j,d2 as N,hH as V,r as a,hI as U,j as r,X as y,hJ as W,hK as v,hL as Y,c3 as _}from"./iframe-DkJtXMGY.js";function H(e){return q({...e,mutationFn:d=>j.changePassword(d)})}const B="Two-factor authentication is required to change your password. Your password has not yet been changed.";function O(e){const d=N("/reset2FA"),g=V(d,"twoFAResetToken"),[C,S]=a.useState(""),[P,R]=a.useState(""),[o,F]=a.useState(),[n,h]=a.useState("VERIFICATION_CODE"),[I,f]=a.useState(!1),{mutate:c,isPending:i,error:k}=H({onSuccess:s=>{s?F(s):(f(!0),F(void 0),e!=null&&e.onChangePasswordSuccess&&e.onChangePasswordSuccess())}}),b=a.useCallback((s,t,u)=>{S(t),R(u),c({username:s,currentPassword:t,newPassword:u,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithCurrentPassword"})},[c]),x=a.useCallback((s,t)=>{R(s),c({newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithToken",passwordChangeToken:t})},[c]),T=a.useCallback((s,t,u)=>{if(o){const E={newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithTwoFactorAuthToken",userId:o.userId,twoFaToken:o.twoFaToken,otpType:u,otpCode:t};c(E)}},[c,o]),l=!!o,{mutate:A,isSuccess:w,isPending:m}=U(),p=a.useCallback(s=>{if(o){const t={userId:o.userId,twoFaResetEndpoint:s,password:C};A(t)}},[C,A,o]),D=a.useCallback(()=>l?r.jsxs(r.Fragment,{children:[n==="VERIFICATION_CODE"&&r.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:W}),n==="RECOVERY_CODE"&&r.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:v}),r.jsx(Y,{step:n,onClickUseTOTP:()=>{h("VERIFICATION_CODE")},onClickUseBackupCode:()=>{h("RECOVERY_CODE")},loginIsPending:i,onSubmit:(s,t)=>T(P,s,t),hideReset2FA:e==null?void 0:e.hideReset2FA,onClickPromptReset2FA:()=>{h("DISABLE_2FA_PROMPT")},onClickReset2FA:()=>{p(g)},twoFactorAuthResetIsPending:m,twoFactorAuthResetIsSuccess:w}),(n==="RECOVERY_CODE"||n==="VERIFICATION_CODE")&&r.jsx(_,{severity:"info",sx:{my:2},children:B}),n==="DISABLE_2FA_PROMPT"&&w&&r.jsxs(_,{severity:"warning",sx:{my:2},children:[r.jsx("strong",{children:"Your password has not been changed."})," To disable two-factor authentication, you may be required to enter your current password after clicking the link sent to your email address."]})]}):r.jsx(r.Fragment,{}),[p,T,i,P,e==null?void 0:e.hideReset2FA,n,l,m,w,g]);return{successfullyChangedPassword:I,isPending:i,error:k,promptForTwoFactorAuth:l,TwoFactorAuthPrompt:D,handleChangePasswordWithCurrentPassword:b,handleChangePasswordWithResetToken:x}}try{O.displayName="useChangePasswordFormState",O.__docgenInfo={description:"Hook that handles submitting a change password request and prompting the user for 2FA if necessary.",displayName:"useChangePasswordFormState",props:{hideReset2FA:{defaultValue:null,description:"",name:"hideReset2FA",required:!1,type:{name:"boolean"}},onChangePasswordSuccess:{defaultValue:null,description:"",name:"onChangePasswordSuccess",required:!1,type:{name:"() => void"}}}}}catch{}export{O as u};
