import{ao as O,r,j as e,W as F,c2 as E,am as T,Y as m,dJ as U,dI as D,jv as C,jw as V,jx as A,jy as b,jz as M,cz as P,K as k,c7 as q,bs as L,B as $}from"./iframe-C_dryyJN.js";import{N as K}from"./NoSearchResults-DLm5C7Jn.js";import{u as z}from"./useEntity-BvJnGaOd.js";import{c as G}from"./useForum-CC___Uzt.js";import{S as Y}from"./Search-D2C9CZec.js";import{S as H}from"./SkeletonParagraph-Me_ye6-N.js";import{U as J}from"./UserBadge-DyxfWgNS.js";import{I as B}from"./InputAdornment-CxE9uA8t.js";import"./index-Chi_LkuB.js";import"./pickBy-DYsFflkF.js";import"./isString-DiG9etdC.js";import"./_baseIteratee-BWtFRFDt.js";import"./useQueries-CV3SItnz.js";import"./useSuspenseQuery-DbrtCnso.js";import"./useInfiniteQuery-CNeRYV1j.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-CnImPArp.js";import"./useUserBundle-QtzgNDHJ.js";import"./SkeletonTable-DtAMx_Lr.js";import"./MenuItem-DGJNpis4.js";import"./Card-CVLPxeE5.js";import"./Chip-0QWq_ruD.js";const N=async s=>(await fetch(s,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=s=>{const{threadId:l,replyId:a}=s,{accessToken:o}=O(),[n,S]=r.useState(),[h,g]=r.useState(""),[u,_]=r.useState(),[R,y]=r.useState(),[f,j]=r.useState(!1);r.useEffect(()=>{(async()=>{let i;j(!0);const c=await C(l,o);if(a){const d=await V(a,o);i=await A(d.messageKey,o),y(await b(d.createdBy)),_(d)}else y(await b(c.createdBy)),i=await M(c.messageKey,o);g(await N(i.messageUrl)),S(c),j(!1)})()},[o,a,l]);const x=(p,i,c)=>{let d=`${P.PORTAL}Synapse:${i}/discussion/threadId=${p}`;return c&&(d+=`&replyId=${c}`),d};return e.jsx("div",{className:"search-result-container",children:e.jsxs(F,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:f?e.jsx(E,{variant:"circular",width:"30px",height:"30px"}):a?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:f?e.jsx(H,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:x(n?.id,n?.projectId,u?.id),children:n?.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[a?"Reply":"Thread"," by"," ",e.jsx(J,{userId:R?.ownerId})," ",U(D(u?.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const W=()=>e.jsxs(F,{sx:{textAlign:"center"},children:[e.jsx(K,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),w=s=>{const{onSearchResultsVisible:l}=s,[a,o]=r.useState(""),[n,S]=r.useState(""),[h,g]=r.useState(!1),{data:u}=z(s.projectId,void 0,{enabled:!!s.projectId}),{data:_,isLoading:R,hasNextPage:y,isFetchingNextPage:f,fetchNextPage:j,error:x}=G(s.forumId,{searchString:n},{enabled:!!n});r.useEffect(()=>{x&&k(x.reason,"danger")},[x]);const p=_?.pages.flatMap(t=>t.matches??[])??[],i=!R&&n&&p.length==0,c=()=>{g(!1),o("")};function d(){S(a),g(!0)}return r.useEffect(()=>{l&&l(h)},[h,l]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(q,{sx:t=>({[t.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:a,onChange:t=>{o(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&d()},slotProps:{input:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(Y,{})}),endAdornment:a&&e.jsx(B,{position:"end",children:e.jsx(L,{size:"small",onClick:()=>{c()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[s.projectId&&u&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',n,'" in ',u?.name]}),e.jsx(W,{})]}),p&&e.jsxs(e.Fragment,{children:[s.projectId&&!i&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',n,'" in ',u?.name,":"]}),p.map(t=>e.jsx("div",{children:e.jsx(v,{threadId:t.threadId,replyId:t.replyId})},`${t.forumId}-${t.threadId}-${t.replyId}`))]}),y&&e.jsx($,{variant:"contained",color:"primary",disabled:f,onClick:()=>{j()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{w.displayName="ForumSearch",w.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:Q}=__STORYBOOK_MODULE_TEST__,Ie={title:"Synapse/ForumSearch",component:w},I={args:{forumId:"1032",onSearchResultsVisible:Q()}};I.parameters={...I.parameters,docs:{...I.parameters?.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...I.parameters?.docs?.source}}};const Se=["Demo"];export{I as Demo,Se as __namedExportsOrder,Ie as default};
