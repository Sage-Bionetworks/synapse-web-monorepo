import{as as q,r as o,j as e,V,c0 as C,aq as T,X as m,dP as P,dO as D,jn as M,jo as k,jp as A,jq as b,jr as L,cz as $,J as B,c5 as K,bq as z,B as G}from"./iframe-DkJtXMGY.js";import{N as H}from"./NoSearchResults-ViLdhsmp.js";import{u as J}from"./useEntity-CO16wdW2.js";import{c as X}from"./useForum-C6UNl3uw.js";import{S as Y}from"./Search-YNLkUiEj.js";import{S as Q}from"./SkeletonParagraph-D2M_qyIo.js";import{U as W}from"./UserBadge-D10KGNES.js";import{I as O}from"./InputAdornment-C08nIKom.js";import"./index-r8ZA1smB.js";import"./pickBy-TCGe6MDQ.js";import"./isString-BGlEt5YE.js";import"./_baseIteratee-fqRe5hEX.js";import"./useQueries-Z-3gwq5U.js";import"./queryOptions-C9woPjwX.js";import"./useInfiniteQuery-iYy68X6j.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-B1ApGHDu.js";import"./SkeletonTable-Boy2sN_O.js";import"./MenuItem-__VZzdvD.js";import"./Card-BrdkgB5x.js";import"./Chip-C5Eg6zQf.js";const N=async r=>(await fetch(r,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=r=>{const{threadId:p,replyId:n}=r,{accessToken:i}=q(),[s,R]=o.useState(),[h,y]=o.useState(""),[t,x]=o.useState(),[g,j]=o.useState(),[I,S]=o.useState(!1);o.useEffect(()=>{(async()=>{let c;S(!0);const d=await M(p,i);if(n){const l=await k(n,i);c=await A(l.messageKey,i),j(await b(l.createdBy)),x(l)}else j(await b(d.createdBy)),c=await L(d.messageKey,i);y(await N(c.messageUrl)),R(d),S(!1)})()},[i,n,p]);const f=(u,c,d)=>{let l=`${$.PORTAL}Synapse:${c}/discussion/threadId=${u}`;return d&&(l+=`&replyId=${d}`),l};return e.jsx("div",{className:"search-result-container",children:e.jsxs(V,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:I?e.jsx(C,{variant:"circular",width:"30px",height:"30px"}):n?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:I?e.jsx(Q,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:f(s==null?void 0:s.id,s==null?void 0:s.projectId,t==null?void 0:t.id),children:s==null?void 0:s.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[n?"Reply":"Thread"," by"," ",e.jsx(W,{userId:g==null?void 0:g.ownerId})," ",P(D(t==null?void 0:t.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const Z=()=>e.jsxs(V,{sx:{textAlign:"center"},children:[e.jsx(H,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),w=r=>{const{onSearchResultsVisible:p}=r,[n,i]=o.useState(""),[s,R]=o.useState(""),[h,y]=o.useState(!1),{data:t}=J(r.projectId,void 0,{enabled:!!r.projectId}),{data:x,isLoading:g,hasNextPage:j,isFetchingNextPage:I,fetchNextPage:S,error:f}=X(r.forumId,{searchString:s},{enabled:!!s});o.useEffect(()=>{f&&B(f.reason,"danger")},[f]);const u=(x==null?void 0:x.pages.flatMap(a=>a.matches??[]))??[],c=!g&&s&&u.length==0,d=()=>{y(!1),i("")};function l(){R(n),y(!0)}return o.useEffect(()=>{p&&p(h)},[h,p]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(K,{sx:a=>({[a.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:n,onChange:a=>{i(a.target.value)},onKeyDown:a=>{a.key==="Enter"&&l()},slotProps:{input:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Y,{})}),endAdornment:n&&e.jsx(O,{position:"end",children:e.jsx(z,{size:"small",onClick:()=>{d()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[c&&e.jsxs(e.Fragment,{children:[r.projectId&&t&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',s,'" in ',t==null?void 0:t.name]}),e.jsx(Z,{})]}),u&&e.jsxs(e.Fragment,{children:[r.projectId&&!c&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',s,'" in ',t==null?void 0:t.name,":"]}),u.map(a=>e.jsx("div",{children:e.jsx(v,{threadId:a.threadId,replyId:a.replyId})},`${a.forumId}-${a.threadId}-${a.replyId}`))]}),j&&e.jsx(G,{variant:"contained",color:"primary",disabled:I,onClick:()=>{S()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{w.displayName="ForumSearch",w.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:ee}=__STORYBOOK_MODULE_TEST__,_e={title:"Synapse/ForumSearch",component:w},_={args:{forumId:"1032",onSearchResultsVisible:ee()}};var F,E,U;_.parameters={..._.parameters,docs:{...(F=_.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...(U=(E=_.parameters)==null?void 0:E.docs)==null?void 0:U.source}}};const Re=["Demo"];export{_ as Demo,Re as __namedExportsOrder,_e as default};
