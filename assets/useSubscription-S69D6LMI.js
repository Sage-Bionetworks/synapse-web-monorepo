import{an as y,aH as l,r as d,am as p,aI as S,aa as b,eg as g,id as Q,d4 as K}from"./iframe-k0ljdA_F.js";import{u as f}from"./useInfiniteQuery-Cnf3ehf_.js";function T(t,e){const{accessToken:s,keyFactory:i}=y();return p({...e,queryKey:i.getSubscribersQueryKey(t.objectId,t.objectType),queryFn:()=>b.getSubscribers(s,t)})}function m(t,e,s){const{accessToken:i,keyFactory:r}=y(),n=async()=>{const u={objectType:e,idList:[t],sortByType:Q.OBJECT_ID,sortDirection:g.ASC},o=await b.postSubscriptionList(i,u);return K(o.results)?null:o.results[0]};return p({...s,queryKey:r.getSubscriptionQueryKey(t,e),queryFn:n})}function C(t,e,s){const{accessToken:i,keyFactory:r}=y(),n=l();return f({...e,queryKey:s??r.getAllSubscriptionsQueryKey(t),queryFn:async u=>{const o=u.pageParam,c=await b.getAllSubscriptions(i,10,o,t);return c.results.forEach(a=>{n.setQueryData(r.getSubscriptionQueryKey(a.objectId,a.objectType),a)}),c},initialPageParam:void 0,getNextPageParam:(u,o)=>{const c=o.flatMap(a=>a.results).length;if(u.totalNumberOfResults>c)return c}})}function q(t){const e=l(),{accessToken:s,keyFactory:i}=y();return S({...t,mutationFn:r=>b.postSubscription(s,r),onSuccess:async(r,n,u)=>{await Promise.all([e.invalidateQueries({queryKey:i.getAllSubscriptionsQueryKey()}),e.invalidateQueries({queryKey:i.getSubscriptionQueryKey(n.objectId,n.objectType)}),e.invalidateQueries({queryKey:i.getSubscribersQueryKey(n.objectId,n.objectType)})])}})}function P(t){const e=l(),{accessToken:s,keyFactory:i}=y();return S({...t,mutationFn:r=>b.deleteSubscription(s,r.subscriptionId),onSuccess:async(r,n,u)=>{await Promise.all([e.invalidateQueries({queryKey:i.getAllSubscriptionsQueryKey()}),e.invalidateQueries({queryKey:i.getSubscriptionQueryKey(n.objectId,n.objectType)}),e.invalidateQueries({queryKey:i.getSubscribersQueryKey(n.objectId,n.objectType)})])}})}const I=(t,e)=>{const{data:s,isLoading:i}=m(t,e),{mutate:r,isPending:n}=q(),{mutate:u,isPending:o}=P(),c=i||n||o,a=d.useCallback(()=>{s?u(s):r({objectId:t,objectType:e})},[u,t,e,r,s]);return{isLoading:c,subscription:s,toggleSubscribed:a,isSubscribed:!!s}};export{T as a,C as b,I as u};
