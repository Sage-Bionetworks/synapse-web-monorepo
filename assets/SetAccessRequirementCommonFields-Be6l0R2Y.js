import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{R as l,e as B,M as V,c as Y}from"./index--5FOymzB.js";import{p as W}from"./pluralize-D3rOHoU0.js";import{a as z,r as i}from"./index-Cu9bd8lq.js";import{H as X}from"./SynapseClient-D4ATx1tI.js";import"./RegularExpressions-C2ZZh8jv.js";import"./OrientationBanner-Ct6IgTPI.js";import{f as K,g as Z,h as ee}from"./useAccessRequirements-Dr_DKUGM.js";import{E as te}from"./EntitySubjectsSelector-scclMlPK.js";import{T as se}from"./TeamSubjectsSelector-BQm8x0zr.js";import{S as E}from"./Skeleton-D3uxr_0h.js";import{T as R}from"./TextField-Babz9VTU.js";import{A as _}from"./Alert-DevAguyB.js";import{T as b}from"./Typography-Ctk8_6Bo.js";import{F as y}from"./FormControlLabel-GzIHkHAg.js";import{C as re}from"./Checkbox-x_qQJTR0.js";import{S as ne}from"./Stack-BCUKu9qx.js";import{T as oe}from"./Tooltip-Cr4lETRB.js";import{H as ae}from"./IconSvg-DhS8koyn.js";import{R as ie}from"./RadioGroup-CGT24UIA.js";import{R as k}from"./Radio-DK5tOnGk.js";const ce="Please select at least one resource for this Access Requirement to be associated with.",C=c=>{const f=c===l.ENTITY?"Synapse":"Team",T=c[0].toUpperCase()+c.slice(1).toLowerCase();return`${f} IDs were specified but not added to the subjects list. Please either clear out the Add ${f} IDs textbox or click the Add ${W(T)} button.`},le="Enter access requirement name. This will also be used when sending notifications for expiring or revoked approval. For example, 'The approval for the name access requirement was revoked...'",g={variant:"body1",fontWeight:700};function ue(c){switch(c){case l.ENTITY:return Y.DOWNLOAD;case l.TEAM:return Y.PARTICIPATE;default:throw new Error(`RestrictableObjectType ${c} does not have an access type specified.`)}}const G=z.forwardRef(function(f,T){const{subject:n,accessRequirementId:I,onSave:H,onError:h}=f,m=!n,[u,j]=i.useState(n?[n]:[]),[x,$]=i.useState(!1),[N,p]=i.useState(null),[S,q]=i.useState(""),[o,v]=i.useState(!1),[A,w]=i.useState((n==null?void 0:n.type)===l.TEAM?B:V),[U,M]=i.useState(null),F=t=>{M(null),H(t.id.toString(),t.concreteType)},D=t=>{M(t.reason),h()},{mutate:O}=K({onSuccess:t=>F(t),onError:t=>D(t)}),{mutate:P}=Z({onSuccess:t=>F(t),onError:t=>D(t)}),{data:s,isLoading:J,error:L}=ee(I,{enabled:!!I});i.useEffect(()=>{s&&(w(s.concreteType),q(s.name),j(s.subjectIds),v(s.subjectsDefinedByAnnotations))},[s]);const a=i.useMemo(()=>{if(n)return n.type;if(s){const t=s.subjectIds;if(t.length>0)return t[0].type}return o?l.ENTITY:null},[n,s,o]),Q=i.useMemo(()=>{if(!a)return e.jsx(e.Fragment,{});function t(r){p(null),j(r)}function d(r){p(null),$(r.trim()!=="")}if(o)return e.jsx(e.Fragment,{});switch(a){case l.TEAM:return e.jsx(se,{subjects:u,onUpdate:r=>t(r),onUpdateTeamIDsTextbox:r=>d(r)});case l.ENTITY:return e.jsx(te,{subjects:u,onUpdate:r=>t(r),onUpdateEntityIDsTextbox:r=>d(r)});default:return console.error(`RestrictableObjectType ${a} does not have a selector implemented.`),e.jsx(e.Fragment,{})}},[a,u,o]);return i.useImperativeHandle(T,()=>({save(){const t=m&&!s||!a,d=!o&&(x||u.length===0);if(t||d){d&&!t&&(x?p(C(a)):u.length===0&&p(ce)),h();return}const r=ue(a);m||O({concreteType:A,subjectIds:u,name:S,accessType:r,subjectsDefinedByAnnotations:o}),m&&s&&P({...s,subjectIds:u,name:S,accessType:r,subjectsDefinedByAnnotations:o})}}),[x,a,u,S,A,s,m,h,O,P,o]),J||!a?e.jsxs(e.Fragment,{children:[e.jsx(E,{width:100,height:30}),e.jsx(E,{width:125,height:30}),e.jsx(E,{width:"100%",children:e.jsx(R,{})}),e.jsx(E,{width:100,height:30}),e.jsx(E,{width:"100%",children:e.jsx(R,{})})]}):L?e.jsx(_,{severity:"error",children:L.reason}):e.jsxs(e.Fragment,{children:[e.jsx(b,{...g,children:"Resources"}),a!==l.TEAM&&e.jsx(y,{control:e.jsx(re,{}),label:"Associated entities should be defined by annotations (DUO)",checked:o,onChange:()=>{p(null);let t=[];o&&(s?t=s.subjectIds:n&&(t=[n])),j(t),v(!o)}}),e.jsx(X,{children:Q}),N&&e.jsx(_,{severity:"error",children:N}),e.jsxs(ne,{direction:"row",gap:1,alignItems:"center",mb:1,mt:2,children:[e.jsx(b,{component:"label",htmlFor:"arName",...g,children:"Name"}),e.jsx(oe,{title:le,placement:"right",children:e.jsx(ae,{sx:{color:"grey.600"}})})]}),e.jsx(R,{id:"arName",name:"arName",value:S,placeholder:"Access requirement name",fullWidth:!0,onChange:t=>q(t.target.value)}),!m&&a!==l.TEAM&&e.jsxs(e.Fragment,{children:[e.jsx(b,{...g,mt:2,children:"Access requirement type"}),e.jsxs(ie,{value:A,onChange:(t,d)=>w(d),children:[e.jsx(y,{value:V,control:e.jsx(k,{}),label:"Controlled - requests are in Synapse"}),e.jsx(y,{value:B,control:e.jsx(k,{}),label:"Click wrap"})]})]}),U&&e.jsx(_,{severity:"error",sx:{marginTop:2},children:U})]})});try{C.displayName="UNSAVED_SUBJECTS_ERROR_MESSAGE",C.__docgenInfo={description:"",displayName:"UNSAVED_SUBJECTS_ERROR_MESSAGE",props:{}}}catch{}try{G.displayName="SetAccessRequirementCommonFields",G.__docgenInfo={description:"",displayName:"SetAccessRequirementCommonFields",props:{subject:{defaultValue:null,description:"",name:"subject",required:!1,type:{name:"RestrictableObjectDescriptor"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(accessRequirementId: string, accessRequirementConreteType: ACCESS_REQUIREMENT_CONCRETE_TYPE) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{G as S};
