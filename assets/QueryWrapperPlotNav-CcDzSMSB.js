import{j as t}from"./jsx-runtime-DzZnOzqg.js";import{r as h}from"./index-C60fwWGm.js";import{u as M,d as k,Q as U,a as H,N as K,b as Y}from"./QueryWrapper-D_ggt4IJ.js";import{aW as $,r as G}from"./useFiles-D8uG9HU0.js";import{b as z,g as J}from"./SqlFunctions-BxVSBgLJ.js";import{m as Z}from"./StringUtils-Df7AZImX.js";import{u as X}from"./useQuery-DlRymLBd.js";import{k as ee,i as te,f as ae,j as oe,z as ne,m as se,l as re,y as le,n as ie}from"./SynapseConstants-B1FWRhdk.js";import"./VerificationSubmission-dxY1kvC5.js";import"./OrientationBanner-w1VcnD_5.js";import{u as ue}from"./useEntity-Br9yHWll.js";import"./DownloadConfirmationUI-CUGY-CqA.js";import{a as ce,T as de,R as me}from"./RowSetView-DvBdCoJd.js";import{F as pe,S as ye,T as fe}from"./TopLevelControls-CUSNNeuh.js";import{M as he}from"./ModalDownload-C_rtYwiY.js";import{u as O}from"./QueryContext-CyYZ60wC.js";import{a as Pe}from"./TableRowSelectionState-BaOGS5-d.js";import{Q as ve,S as Se}from"./QueryWrapperErrorBoundary-D7Hhoo5F.js";import"./ThemesPlot-D45xw-_n.js";import"./UpsetPlot-jFjBxCn9.js";import{S as xe}from"./SynapsePlot-HiHJBiAx.js";import{P as _e,u as ge,g as Ce,F as Ee,a as Te}from"./useFacetPlots-DfLr149S.js";import{B as j}from"./Box-FDIqTSOb.js";import{S as _}from"./Skeleton-FYvl9i-x.js";import{S as we}from"./Stack-BisZ62cv.js";import{B as je}from"./Button-DpKUeDej.js";import{u as Ne}from"./react-BhSIdDPr.js";function L(e){const o=O(),{currentQueryRequest:r}=o,{title:l,onCustomPlotClick:c,onHide:g}=e,{showPlots:d}=M(),y=h.useMemo(()=>({...e,title:void 0,showlegend:!1,displayModebar:!1}),[e]),p=h.useMemo(()=>{const{selectedFacets:v,additionalFilters:C}=r.query;return{selectedFacets:v,additionalFilters:C,onCustomPlotClick:c,queryContext:o}},[r.query,c,o]);return t.jsx("div",{role:"figure",className:"SynapsePlot",children:d&&t.jsxs(t.Fragment,{children:[l&&t.jsx(_e,{title:l,onHide:g}),t.jsx(xe,{synapsePlotWidgetParams:y,customPlotParams:p})]})})}try{L.displayName="QueryWrapperSynapsePlot",L.__docgenInfo={description:`This component wraps a SynapsePlot.  It passes in the current query context, and has a custom
"title" style so that it looks like it belongs in the QueryWrapperPlotNav plots.`,displayName:"QueryWrapperSynapsePlot",props:{onCustomPlotClick:{defaultValue:null,description:"",name:"onCustomPlotClick",required:!1,type:{name:"(event: QueryWrapperSynapsePlotRowClickEvent) => void"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"box"'},{value:'"table"'},{value:'"image"'},{value:'"bar"'},{value:'"volume"'},{value:'"barpolar"'},{value:'"candlestick"'},{value:'"carpet"'},{value:'"choropleth"'},{value:'"choroplethmapbox"'},{value:'"cone"'},{value:'"contour"'},{value:'"contourcarpet"'},{value:'"densitymapbox"'},{value:'"funnel"'},{value:'"funnelarea"'},{value:'"heatmap"'},{value:'"heatmapgl"'},{value:'"histogram"'},{value:'"histogram2d"'},{value:'"histogram2dcontour"'},{value:'"indicator"'},{value:'"isosurface"'},{value:'"mesh3d"'},{value:'"ohlc"'},{value:'"parcats"'},{value:'"parcoords"'},{value:'"pie"'},{value:'"pointcloud"'},{value:'"sankey"'},{value:'"scatter"'},{value:'"scatter3d"'},{value:'"scattercarpet"'},{value:'"scattergeo"'},{value:'"scattergl"'},{value:'"scattermapbox"'},{value:'"scatterpolar"'},{value:'"scatterpolargl"'},{value:'"scatterternary"'},{value:'"splom"'},{value:'"streamtube"'},{value:'"sunburst"'},{value:'"surface"'},{value:'"treemap"'},{value:'"violin"'},{value:'"waterfall"'}]}},horizontal:{defaultValue:null,description:"",name:"horizontal",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},xtitle:{defaultValue:null,description:"",name:"xtitle",required:!1,type:{name:"Plotly.LayoutAxis"}},ytitle:{defaultValue:null,description:"",name:"ytitle",required:!1,type:{name:"Plotly.LayoutAxis"}},xaxistype:{defaultValue:null,description:"",name:"xaxistype",required:!1,type:{name:"enum",value:[{value:'"log"'},{value:'"date"'},{value:'"linear"'},{value:'"-"'},{value:'"category"'},{value:'"multicategory"'}]}},showlegend:{defaultValue:null,description:"",name:"showlegend",required:!1,type:{name:"Plotly.Layout"}},barmode:{defaultValue:null,description:"",name:"barmode",required:!1,type:{name:"Plotly.Layout"}},displayModeBar:{defaultValue:null,description:"",name:"displayModeBar",required:!1,type:{name:"Plotly.Config"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function D(){return t.jsxs(j,{className:"FacetNavPanel",flexGrow:1,children:[t.jsxs(j,{className:"FacetNavPanel__title",children:[t.jsx(_,{variant:"rectangular",height:20,width:170}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(_,{variant:"rectangular",height:20,width:20}),t.jsx(_,{variant:"rectangular",height:20,width:20,sx:{ml:1}})]}),t.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{minWidth:"435px",flexGrow:1},height:200,px:2,children:[t.jsx(_,{variant:"circular",width:140,height:140}),t.jsxs(we,{gap:1,children:[t.jsx(_,{variant:"rectangular",height:15,width:220}),t.jsx(_,{variant:"rectangular",height:15,width:220}),t.jsx(_,{variant:"rectangular",height:15,width:220}),t.jsx(_,{variant:"rectangular",height:15,width:220})]})]})]})}function Ie(){return t.jsxs(j,{className:"PlotsContainer",display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:4,children:[t.jsx(D,{}),t.jsx(D,{})]})}const b=2,P=(e,o)=>"__custom"in o&&"__custom"in e?e.title==o.title:!("__custom"in o)&&!("__custom"in e)?$(e,o):!1;function Fe(e){return e==="bar"?"BAR":"PIE"}const be=e=>"__custom"in e.plotId?`custom-${e.plotId.title}`:`facet-${e.plotId.columnName}-${e.plotId.jsonPath}`,Ae=(e,o)=>!!o.find(r=>P(r.plotId,e)),R=e=>({__custom:!0,title:e.title??""}),Le=(e=[],o=[],r=q)=>[...e.map((l,c)=>({plotId:R(l),isHidden:c>=b,plotType:Fe(l.type)})),...o.map((l,c)=>({plotId:l.facetToPlot,isHidden:c+e.length>=b,plotType:r}))],qe=(e,o,r)=>o.some(l=>P(R(l),e.plotId))||r.some(l=>P(l.facetToPlot,e.plotId)),q="PIE",Qe=[],Me=[];function Q(e){const{facetsToPlot:o=Qe,customPlots:r=Me,initialPlotType:l=q}=e,{data:c}=k(),{showPlots:g}=M(),[d,y]=h.useState([]),p=ge(o),v=a=>{var n;return((n=d.find(i=>P(a,i.plotId)))==null?void 0:n.plotType)??q};h.useEffect(()=>{const a=Le(r,p,l);y(s=>{const n=a.filter(u=>!Ae(u.plotId,s));return[...s.filter(u=>qe(u,r,p)),...n]})},[r,p]);const C=a=>{y(s=>s.map((n,i)=>a?{...n,isHidden:!1}:{...n,isHidden:i>=b}))},S=a=>d.find(i=>P(a,i.plotId)&&i.isHidden===!0)!==void 0,x=h.useMemo(()=>d.find(a=>a.isHidden===!0)?"MORE":d.length<=b?"NONE":"LESS",[d]),E=a=>{T(a,"isHidden",!0)},N=(a,s)=>{T(a,"plotType",s)},T=(a,s,n)=>{y(i=>i.map(m=>P(a,m.plotId)?{...m,[s]:n}:m))},w=Ce(c,o).map((a,s)=>({facet:{columnName:a.columnName,jsonPath:a.jsonPath},colorIndex:s}));return t.jsx(t.Fragment,{children:d.length>0&&t.jsxs("div",{className:`PlotsContainer ${g?"":"hidden"} ${x==="LESS"?"less":""}`,children:[t.jsx("div",{className:"PlotsContainer__row",role:"list",children:d.map(a=>{var m;const s="__custom"in a.plotId,n=r.find(u=>P(R(u),a.plotId)),i=p.find(u=>P(u.facetToPlot,a.plotId));return t.jsxs("div",{style:{minWidth:"435px",display:S(a.plotId)?"none":"block"},children:[s&&n&&t.jsx(L,{...n,onHide:()=>E(a.plotId)}),!s&&i&&t.jsx(Ee,{index:(m=w.find(u=>P(u.facet,a.plotId)))==null?void 0:m.colorIndex,onHide:()=>E(a.plotId),plotType:v(a.plotId),onSetPlotType:u=>N(a.plotId,u),isModalView:!1,...i})]},be(a))})}),x!=="NONE"&&t.jsx(j,{display:"flex",justifyContent:"center",sx:{backgroundColor:"grey.100",p:2,mt:2},children:t.jsx(je,{variant:"contained",color:"secondary",onClick:()=>C(x==="MORE"),sx:{width:"150px"},children:x==="LESS"?"Hide Charts":"View All Charts"})})]})})}function Re(e){const{showPlots:o}=M();return t.jsx(h.Suspense,{fallback:o?t.jsx(Ie,{}):null,children:t.jsx(Q,{...e})})}try{Q.displayName="PlotsContainer",Q.__docgenInfo={description:"",displayName:"PlotsContainer",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}},customPlots:{defaultValue:null,description:"",name:"customPlots",required:!1,type:{name:"QueryWrapperSynapsePlotProps[]"}},initialPlotType:{defaultValue:null,description:"",name:"initialPlotType",required:!1,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'},{value:'"STACKED_HORIZONTAL_BAR"'}]}}}}}catch{}const De="isShowingFacetFilters",Ve="isHidingFacetFilters",Oe="hasSelectedRows";function Be(e){const{tableConfiguration:o,name:r,cardConfiguration:l,facetsToPlot:c,availableFacets:g,facetValueSortConfigs:d,initialExpandedFacetControls:y,hideDownload:p,hideQueryCount:v,hideSqlEditorControl:C,searchConfiguration:S,cavaticaConnectAccountURL:x,customControls:E,remount:N,isFullTextSearchEnabled:T,customPlots:w,initialLimit:a,initialPlotType:s}=e,n=O(),[i,m]=h.useState(!1),{hasFacetedSelectColumn:u,queryMetadataQueryOptions:I}=n,{isLoading:A}=X(I),B=Ne(Pe),f=n.currentQueryRequest,W=(f==null?void 0:f.query.selectedFacets)!==void 0&&f.query.selectedFacets.length>0||(f==null?void 0:f.query.additionalFilters)!==void 0&&(f==null?void 0:f.query.additionalFilters.length)>0;return t.jsx(Y,{children:F=>{if(F===void 0)throw new Error("No queryVisualizationContext found when using QueryVisualizationContextConsumer");return t.jsx(j,{className:`QueryWrapperPlotNav ${F.showFacetFilter?De:Ve} ${B?Oe:""}`,sx:{"*":{cursor:A?"wait":void 0}},children:t.jsxs(ve,{children:[T?t.jsx(pe,{ftsConfig:S==null?void 0:S.ftsConfig}):t.jsx(ye,{...S,queryContext:n,queryVisualizationContext:F}),t.jsx(Se,{}),F.showDownloadConfirmation&&t.jsx(ce,{onClose:()=>F.setShowDownloadConfirmation(!1)}),t.jsx(G,{children:t.jsx(fe,{showColumnSelection:o!==void 0,name:r,hideDownload:p,hideQueryCount:v,hideFacetFilterControl:!u,hideVisualizationsControl:!u,hideSqlEditorControl:C,cavaticaConnectAccountURL:x,customControls:E,remount:N})}),u&&t.jsx(t.Fragment,{children:t.jsx(Te,{availableFacets:g,facetValueSortConfigs:d,initialExpandedFacetControls:y})}),t.jsx(de,{frontText:"",endText:W?"filtered by":"",hideIfUnfiltered:!0}),t.jsx(Re,{facetsToPlot:c,customPlots:w,initialPlotType:s}),t.jsx(me,{tableConfiguration:o,hideDownload:p,cardConfiguration:l,initialLimit:a}),i&&t.jsx(he,{getLastQueryRequest:n==null?void 0:n.getCurrentQueryRequest,onClose:()=>m(!1)})]})})}})}function V(e){var I;const{sql:o,tableConfiguration:r,isInfinite:l=!r,limit:c=ee,showLastUpdatedOn:g,unitDescription:d,additionalFiltersSessionStorageKey:y,helpConfiguration:p,customPlots:v,enabledExternalAnalysisPlatforms:C}=e,S=((I=e.query)==null?void 0:I.sql)??o??"",x=z(S),{entityId:E,versionNumber:N}=x??{entityId:""},T=h.useMemo(()=>{if(e.query)return e.query;if(e.initQueryJson)return JSON.parse(e.initQueryJson);{const A=J(e.searchParams,e.sqlOperator,y);return{sql:o,additionalFilters:A,limit:c,offset:0}}},[e.query,e.initQueryJson,e.searchParams,e.sqlOperator,y,o,c]),[w,a]=h.useState(1),s=()=>{a(w+1)},{data:n}=ue(E,N),i={entityId:E,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:te|ae|oe|ne|se|re|le|ie,query:T},m=(n&&Z(n)&&n.isSearchEnabled)??!1,u=`${JSON.stringify(i)}-${w}`;return h.createElement(U,{...e,initQueryRequest:i,key:u,isInfinite:l},t.jsx(H,{unitDescription:d,rgbIndex:e.rgbIndex,columnAliases:e.columnAliases,helpConfiguration:p,visibleColumnCount:e.visibleColumnCount,defaultShowPlots:e.defaultShowPlots,hideCopyToClipboard:e.hideCopyToClipboard,defaultShowSearchBar:e.defaultShowSearchBox||m,showLastUpdatedOn:g,noContentPlaceholderType:K.INTERACTIVE,hasCustomPlots:Array.isArray(v)&&v.length>0,enabledExternalAnalysisPlatforms:C,children:t.jsx(Be,{...e,isFullTextSearchEnabled:m,remount:s})}))}try{V.displayName="QueryWrapperPlotNav",V.__docgenInfo={description:"",displayName:"QueryWrapperPlotNav",props:{}}}catch{}export{V as Q};
