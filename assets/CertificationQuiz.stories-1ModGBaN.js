import{ao as T,an as G,az as $,d2 as Y,aA as J,aa as S,cH as L,hk as V,r as h,d8 as X,j as e,b_ as w,i2 as C,X as o,_ as v,dK as W,dJ as Z,B as I,V as _,bs as E,bX as ee,J as P}from"./iframe-zheGqhAq.js";import{M as se}from"./MarkdownPopover-BacXeUFr.js";import"./SkeletonButton-DnBFAAqj.js";import"./SkeletonInlineBlock-DQ4vmVkM.js";import{S as te}from"./SkeletonTable-B_5GfUT7.js";import{S as ne}from"./SkeletonParagraph-0XdWF-57.js";import{C as q}from"./CertificationAnswer-DUaESrkU.js";import"./index-r8ZA1smB.js";import"./LightTooltip-DB1oMCwe.js";import"./MarkdownSynapse-Ct83EToF.js";const re="org.sagebionetworks.repo.model.quiz.MultichoiceResponse";function ie(t="",i){const{accessToken:r,keyFactory:l}=T();return G({...i,queryKey:l.getPassingRecordQueryKey(t),queryFn:()=>S.getPassingRecord(t,r)})}function ae(t){const i=$(),{accessToken:r,keyFactory:l}=T(),{data:m}=Y();return J({...t,mutationFn:d=>S.postCertifiedUserTestResponse(r,d),onSuccess:async(d,x,g)=>{await Promise.all([i.invalidateQueries({queryKey:l.getPassingRecordQueryKey(m==null?void 0:m.ownerId)}),i.invalidateQueries({queryKey:l.getUserBundleQueryKey("current",L)})]),t!=null&&t.onSuccess&&await t.onSuccess(d,x,g)}})}function oe(){var z;const{accessToken:t}=T(),i=V(),[r,l]=h.useState(),[m,d]=h.useState(!1),[x,g]=h.useState([]),{data:u}=X(L),f=u==null?void 0:u.isCertified,k=u==null?void 0:u.userId,{data:n,isLoading:H}=ie(k,{enabled:k!==void 0}),R=h.useRef(null),A="https://help.synapse.org/docs/Getting-Started.2055471150.html",b=async()=>{try{l(await S.getCertifyQuiz(t))}catch(s){i(s)}},{mutate:D,isPending:M}=ae({onSuccess:()=>{d(!1),window.scrollTo(0,0)},throwOnError:!0}),j=!f&&(n==null||m);if(h.useEffect(()=>{t&&b()},[t]),H||r==null)return e.jsx(ce,{});const O=(s,a)=>{const p=[...x.filter(c=>c.questionIndex!==s),{questionIndex:s,answerIndex:[a],concreteType:re}];g(p)},Q=()=>{var s;(s=R.current)==null||s.reset(),d(!0),g([]),b()},U=()=>{try{if(r&&r.questions.length===x.length){const s={quizId:r.id,questionResponses:x};D(s)}else P("Please answer all of the questions and try again.","warning")}catch(s){P(s.reason,"danger")}},K=s=>s?{content:e.jsx(e.Fragment,{children:"More info"}),closePopoverOnClick:!0,onClick:()=>window.open(s,"_blank"),color:"primary"}:void 0;return e.jsxs("div",{children:[n&&!j&&e.jsxs(e.Fragment,{children:[(n.revokedOn||n.passed)&&!f&&e.jsxs(w,{severity:"error",children:[!n.passed&&e.jsx(C,{children:"Certification Revoked"}),e.jsxs(o,{variant:"body1",sx:{marginTop:"5px"},children:["Your certification was revoked. To become certified, you must"," ",e.jsx(v,{href:"#",onClick:s=>{s.preventDefault(),Q()},children:"retake the quiz"}),"."]})]}),!n.passed&&!f&&e.jsxs(w,{severity:"error",children:[!n.passed&&e.jsx(C,{children:"Quiz Failed"}),e.jsxs(o,{variant:"body1",sx:{marginTop:"5px"},children:["Please review the results from the previous attempt, and"," ",e.jsx(v,{href:"#",onClick:s=>{s.preventDefault(),Q()},children:"retake the quiz"}),"."]})]}),n.passed&&f&&e.jsxs(w,{severity:"success",children:[e.jsx(C,{children:"Quiz Passed"}),e.jsx(o,{variant:"body1",sx:{marginTop:"5px"},children:`You passed the Synapse Certification Quiz on ${W(Z(n.passedOn))}`})]}),e.jsxs(o,{variant:"sectionTitle",sx:{marginTop:"20px",marginBottom:"20px"},children:["Score: ",n.score," / ",(z=n.corrections)==null?void 0:z.length]})]}),e.jsxs("div",{className:"CertificationQuiz__container",children:[r&&j&&e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>window.open(A,"_blank"),className:"help-button",color:"primary",variant:"contained",children:e.jsxs(_,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px",color:"white"}}),e.jsx(e.Fragment,{children:"Help"})]})}),e.jsx(o,{variant:"headline1",sx:{marginBottom:"25px"},children:"Certified User Quiz"}),e.jsx(o,{variant:"body1",sx:{marginBottom:"15px"},children:"Certified users are authorized to use the full Synapse functionality. In order to ensure that users who create content in the system and/or wish to interact more freely within Synapse are familiar with the governance process and Synapse operating procedures when dealing with possibly sensitive data, users must pass a short quiz (approximately 15 minutes) to become Synapse certified."}),e.jsx(o,{variant:"body1",sx:{marginBottom:"15px"},children:"Please answer the following questions to become certified."}),e.jsx("form",{ref:R,onSubmit:s=>s.preventDefault(),children:e.jsx("ol",{children:r==null?void 0:r.questions.map(s=>{const a=s.helpText||s.docLink;return e.jsxs("li",{role:s.exclusive?"radiogroup":void 0,children:[e.jsx(o,{variant:"headline3",dangerouslySetInnerHTML:{__html:s.prompt},sx:{marginTop:"40px",marginBottom:"10px"}}),s.answers.map(p=>e.jsx(q,{question:s,answer:p,onClick:c=>O(s.questionIndex,Number(c.currentTarget.value))},`${s.questionIndex}-${p.answerIndex}`)),a&&e.jsx(se,{contentProps:{markdown:s.helpText},placement:"right",sx:{table:{textAlign:"center",th:{padding:"5px"}}},actionButton:K(s.docLink),showCloseButton:!0,children:e.jsxs(_,{sx:{display:"flex",alignItems:"center",marginTop:"10px"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px"}}),e.jsx(v,{children:"Need help answering this question?"})]})})]},s.questionIndex)})})}),e.jsx(I,{className:"help-button",color:"primary",variant:"contained",size:"large",disabled:M,onClick:()=>{U()},children:"Submit"})]}),!j&&(n==null?void 0:n.corrections)&&e.jsx("ol",{children:n.corrections.map(s=>{const a=s.question,p=s.response;return e.jsxs("li",{children:[e.jsx(o,{variant:"headline3",dangerouslySetInnerHTML:{__html:a.prompt},className:s.isCorrect?"":"incorrectQuestion",sx:{marginTop:"40px",marginBottom:"10px"}}),a.answers.map(c=>e.jsx(q,{question:a,answer:c,disabled:!0,checked:p.answerIndex.includes(c.answerIndex)},`${a.questionIndex}-${c.answerIndex}`))]},a.questionIndex)})})]})]})}function ce(){const t=[];for(let i=0;i<20;i++)t.push(e.jsx("li",{children:e.jsx(te,{numCols:1,numRows:5})},i));return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(ee,{height:"80px",width:"460px"})}),e.jsx(ne,{numRows:5}),e.jsx("div",{className:"CertificationQuiz__container",children:e.jsx("ol",{style:{marginTop:"20px"},children:t})})]})}const je={title:"Synapse/CertificationQuiz",component:oe},y={};var B,N,F;y.parameters={...y.parameters,docs:{...(B=y.parameters)==null?void 0:B.docs,source:{originalSource:"{}",...(F=(N=y.parameters)==null?void 0:N.docs)==null?void 0:F.source}}};const we=["CertificationQuizDemo"];export{y as CertificationQuizDemo,we as __namedExportsOrder,je as default};
