import{gX as G,j as e,di as C,i9 as W,dH as M,dG as w,c9 as H,r,hM as J,B as N,ct as X,cu as z,c1 as Q,bV as Y,J as Z,b$ as ee}from"./iframe-CXX3j3k4.js";import{u as I}from"./useEntityBundle-BpJg0bA7.js";import{C as ae}from"./ConfirmationDialog-BBYfC9oT.js";import{D as te}from"./DialogBase-DiPVYK5d.js";import{S as ne}from"./SchemaDrivenAnnotationEditor-DVgbeaHD.js";import{A as se}from"./AnnotationsTable-Cv2-HpdB.js";import{g as oe,u as ie,a as le}from"./FileHandleUtils-d7_V6qVt.js";import{U as g}from"./UserBadge-BK9OLj7v.js";const x=({entityId:u,versionNumber:i})=>{var s,p,T,d,n,o,h;const{data:a}=I(u,i),f=a&&G(a.entity),l=a?oe(a):void 0,_=(s=a==null?void 0:a.entity)==null?void 0:s.parentId,y=l==null?void 0:l.storageLocationId,{data:m}=ie(_,y,{enabled:_!==void 0&&y!=null});let c;return l&&(c=le(l,m)),a?e.jsx("table",{className:"MetadataTable",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Name"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(p=a.entity)==null?void 0:p.name})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Type"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:C(a.entityType)})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(T=a.entity)==null?void 0:T.id})]}),f&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Version"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:W(a.entity)})]}),c&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:c})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(g,{userId:(d=a.entity)==null?void 0:d.modifiedBy})," at"," ",M(w((n=a.entity)==null?void 0:n.modifiedOn))]})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Created By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(g,{userId:(o=a.entity)==null?void 0:o.createdBy})," at"," ",M(w((h=a.entity)==null?void 0:h.createdOn))]})]})]})}):null};try{x.displayName="MetadataTable",x.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const de=["METADATA","ANNOTATIONS"];function v(u){const{entityId:i,versionNumber:a,show:f,onClose:l,initialTab:_="METADATA",showTabs:y=!0,onEditModeChanged:m=H}=u,c=r.useRef(null),[s,p]=r.useState(_),[T,d]=r.useState(!1),[n,o]=r.useState(!1),[h,j]=r.useState(()=>o(!1));r.useEffect(()=>(m(n),()=>{m(!1)}),[n,m]);const{data:t}=I(i,a),R=t&&t.permissions.canEdit,A=t&&J(t.entityType),V=A&&t.entity.isLatestVersion,S=s==="METADATA"&&t&&!window.location.href.includes(i),O=e.jsxs(N,{variant:"contained",onClick:()=>window.open(`${X(z.PORTAL_ENDPOINT)}Synapse:${i}`,"_blank","noopener"),children:["Open"," ",t?C(t==null?void 0:t.entityType):""]}),D=s==="ANNOTATIONS"&&n,B=e.jsx(N,{variant:"contained",onClick:()=>{c.current.formElement.current.requestSubmit()},children:"Save Annotations"}),q=s==="ANNOTATIONS"&&n,L=e.jsx(N,{variant:"outlined",onClick:()=>{j(()=>()=>o(!1)),d(!0)},children:"Cancel"}),k=R&&s==="ANNOTATIONS"&&!n,E=A&&!V,K=e.jsx(ee,{title:E?"Annotations can only be edited on the latest version":void 0,children:e.jsx("span",{children:e.jsx(N,{variant:"contained",disabled:E,onClick:()=>{o(!0)},children:"Edit"})})}),F=e.jsxs(e.Fragment,{children:[y&&!n?e.jsx("div",{className:"Tabs",children:de.map(b=>e.jsx("div",{className:"Tab",role:"tab",onClick:$=>{$.stopPropagation(),p(b)},"aria-selected":b===s,children:b},b))}):null,e.jsx("div",{style:s==="ANNOTATIONS"?{}:{display:"none"},children:n?e.jsx(Y,{children:e.jsx(ne,{entityId:i,formRef:c,hideActions:!0,onSuccess:()=>{Z("Annotations successfully updated.","success"),o(!1)},onCancel:()=>o(!1)})}):e.jsx(se,{entityId:i,versionNumber:a})}),e.jsx("div",{style:s==="METADATA"?{}:{display:"none"},children:e.jsx(x,{entityId:i,versionNumber:a})})]}),P=e.jsx(ae,{open:T,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{d(!1)},onConfirm:()=>{d(!1),h()}}),U=r.useMemo(()=>{if(t!=null&&t.entity.name){if(s==="ANNOTATIONS")return`${n?"Edit ":""}Annotations for ${t.entity.name}`}else return e.jsx(Q,{width:"40%"});return t.entity.name},[s,t==null?void 0:t.entity.name,n]);return e.jsx(te,{className:"EntityMetadata",open:f,onCancel:()=>{n?(d(!0),j(()=>()=>{o(!1),l()})):l()},maxWidth:n?"md":"sm",title:U,content:F,actions:e.jsxs(e.Fragment,{children:[P,q&&L,D&&B,k&&K,S&&O]})})}try{v.displayName="EntityModal",v.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"(isInEditMode: boolean) => void"}}}}}catch{}export{v as E};
