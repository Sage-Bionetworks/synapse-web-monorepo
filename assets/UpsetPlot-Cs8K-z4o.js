import{j as G}from"./jsx-runtime-DoxjgJx5.js";import{a as f,r as T}from"./index-Cu9bd8lq.js";import{l as Oe}from"./lz-string-D345GCHL.js";import{l as ft,q as mt,S as dt}from"./useFiles-DYv-TsLD.js";import{p as pt}from"./SqlFunctions-BnNaO_kX.js";import"./RegularExpressions-CmcMRs19.js";import{f as ht}from"./SynapseConstants-03FNPEMB.js";import"./VerificationSubmission-DL9jxYsQ.js";import"./OrientationBanner-CW2K3-RQ.js";import{r as yt}from"./react-sizeme-Vw-aaS2E.js";import{a as Ge,C as Ye}from"./colorPalette-BSrfa2_g.js";import{l as gt}from"./LoadingScreen-DHkC6j6Z.js";import{L as bt}from"./LargeButton-B_TzE9Hg.js";function St(e){return e instanceof Set?e.size:e.length}function re(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),s=r.size,n={setA:s,setB:s,union:s,intersection:s};return o=>{if(o===e)return n;let a=0;o.forEach(c=>{(t&&r.has(t(c))||!t&&r.has(c))&&a++});const i=St(o);return{setA:s,setB:i,intersection:a,union:s+i-a}}}function Ke(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),s=Array.isArray(e)?e:Array.from(e),n={setA:s,setB:s,union:s,intersection:s};return o=>{if(o===e)return n;const a=[],i=s.slice();return o.forEach(c=>{t&&r.has(t(c))||!t&&r.has(c)?a.push(c):i.push(c)}),{setA:s,setB:Array.isArray(o)?o:Array.from(o),intersection:a,union:i}}}function xt(e,t){const r=e instanceof Set?Array.from(e):e,s=t?new Set(r.map(t)):e instanceof Set?e:new Set(e);return n=>{if(n===e)return r;const o=[];return n.forEach(a=>{(t&&s.has(t(a))||!t&&s.has(a))&&o.push(a)}),o}}function Q(e){return Array.isArray(e.elems)}function Qe(e){return typeof e.overlap=="function"}function J(e){return e.set!=null}function $t(e,t,r){if(Qe(e))return e.overlap;if(J(e)&&e.set.overlap)return e.set.overlap;const s=re(Q(e)?e.elems:e.set.elems,r);return n=>n.overlap&&Q(e)&&Array.isArray(e.elems)?n.overlap(e.elems):n.overlap&&J(e)?n.overlap(e.set):s(n.elems)[t]}function vt(e,t,r){if(Qe(e))return()=>null;if(t==="intersection"){const n=xt(Q(e)?e.elems:e.set.elems,r);return o=>n(o.elems)}const s=Ke(Q(e)?e.elems:e.set.elems,r);return n=>s(n.elems)[t]}function Je(e){const t=e;return e!=null&&typeof t.cardinality=="number"&&typeof e.name=="string"&&Array.isArray(e.elems)}function ye(e){return Je(e)&&e.type==="set"}function Et(e){const t=e;return Je(e)&&["composite","union","intersection","distinctIntersection"].includes(t.type)&&t.sets instanceof Set&&typeof t.degree=="number"}function se(e){return ye(e)||Et(e)}function W(e,t){return e.name.localeCompare(t.name)}function ue(e,t){return t.cardinality-e.cardinality}function Me(e,t){return e.degree-t.degree}function ge(e){return(t,r)=>e.reduce((s,n)=>s===0?n(t,r):s,0)}function Z(e){return(t,r)=>-e(t,r)}function Te(e){return(t,r)=>{const s=a=>a<0?Number.POSITIVE_INFINITY:a,n=s(e.findIndex(a=>t.sets.has(a))),o=s(e.findIndex(a=>r.sets.has(a)));return n-o}}function Ct(e,t){if(!t)return W;const r=Array.isArray(t)?t:[t];return r.length===0?W:ge(r.map(s=>{switch(s){case"cardinality":case"cardinality:desc":return ue;case"cardinality:asc":return Z(ue);case"name:desc":return Z(W);case"degree":case"degree:asc":return Me;case"degree:desc":return Z(Me);case"group":case"group:asc":return Te(e);case"group:desc":return Z(Te(e));default:return W}}))}function wt(e,t,r={}){let s=t;return r.order&&(s=s.sort(Ct(e,r.order))),r.limit!=null?s.slice(0,r.limit):s}const ve={distinctIntersection:" ∩ ",intersection:" ∩ ",union:" ∪ ",composite:","};function Nt(e){if(!e)return[255,255,255];const t=e.match(/#([\da-f]{2})([\da-f]{2})([\da-f]{2})/i);if(t)return[Number.parseInt(t[1],16),Number.parseInt(t[2],16),Number.parseInt(t[3],16)];const r=e.match(/\(([\d]+)[, ]([\d]+)[, ]([\d]+)\)/i);return r?[Number.parseInt(r[1],10),Number.parseInt(r[2],10),Number.parseInt(r[3],10)]:[255,255,255]}function kt(e){if(e.length===1)return e[0];if(e.every(o=>o==null))return;const t=e.map(Nt),r=Math.floor(t.reduce((o,a)=>o+a[0],0)/t.length),s=Math.floor(t.reduce((o,a)=>o+a[1],0)/t.length),n=Math.floor(t.reduce((o,a)=>o+a[2],0)/t.length);return`#${r.toString(16)}${s.toString(16)}${n.toString(16)}`}function Xe(e,t,r){const s=Array.from(e).sort((n,o)=>t.get(n)-t.get(o));return s.length===1?s[0].name:`(${s.map(n=>n.name).join(r)})`}function V(e,t,r,s,n){return{type:r.size===0?"composite":e,elems:s,color:n(Array.from(r).map(o=>o.color)),sets:r,name:t,cardinality:s.length,degree:r.size}}function At(e,t,r,s,n,o,a){const i=new Set(e.sets);t.sets.forEach(b=>i.add(b));const c=Xe(i,n,ve[o]);if(e.cardinality===0||t.cardinality===0)return V(o,c,i,[],a);let m=e,l=t;e.cardinality>t.cardinality&&(m=t,l=e);const u=new Set,d=r.get(l),p=[],h=m.elems.length;for(let b=0;b<h;b++){const v=m.elems[b],x=s(v);d.has(x)&&(u.add(x),p.push(v))}const y=V(o,c,i,p,a);return r.set(y,u),y}function Lt(e,t,r,s,n,o,a){const i=new Set(e.sets);t.sets.forEach(y=>i.add(y));const c=Xe(i,n,ve[o]);if(e.cardinality===0){const y=V(o,c,i,t.elems,a);return r.set(y,r.get(t)),y}if(t.cardinality===0){const y=V(o,c,i,e.elems,a);return r.set(y,r.get(e)),y}let m=e,l=t;e.cardinality>t.cardinality&&(m=t,l=e);const u=new Set(r.get(l)),d=r.get(l),p=l.elems.slice();m.elems.forEach(y=>{const b=s(y);d.has(b)||(u.add(b),p.push(y))});const h=V(o,c,i,p,a);return r.set(h,u),h}function _e(e,t,r,s,n,o){if(typeof t=="number")return{type:"composite",elems:[],color:o?o([]):void 0,sets:new Set,name:"()",cardinality:t,overlap(c){return c===this||se(c)&&c.name===this.name&&c.cardinality===this.cardinality?this.cardinality:0},degree:0};if(Array.isArray(t))return V(e,"()",new Set,t,o);const a=Array.from(s.values()),i=r.filter(c=>{const m=n(c);return a.every(l=>!l.has(m))});return V(e,"()",new Set,i,o)}function Ze(e,t={}){const{type:r="intersection",min:s=0,max:n=Number.POSITIVE_INFINITY,empty:o=!1,elems:a=[],notPartOfAnySet:i,toElemKey:c,mergeColors:m=kt}=t,l=[],u=new Map(e.map((g,S)=>[g,S])),d=new Map(e.map(g=>[g,c?new Set(g.elems.map(c)):new Set(g.elems)])),p=c?null:d,h=c?d:null,y=r==="union"?Lt:At;function b(g){if(g.degree<s||g.degree>n||g.cardinality===0&&!o)return;if(r!=="distinctIntersection"){l.push(g);return}const S=e.filter(k=>!g.sets.has(k));let N=[];if(c){const k=S.map($=>h.get($));N=g.elems.filter($=>{const E=c($);return k.every(w=>!w.has(E))})}else{const k=S.map($=>p.get($));N=g.elems.filter($=>k.every(E=>!E.has($)))}if(N.length===g.cardinality){l.push(g);return}const L=V(r,g.name,g.sets,N,m);L.cardinality===0&&!o||l.push(L)}function v(g,S,N,L){if(S>n)return;const k=g.length;for(let $=0;$<k;$++){const E=g[$],w=[];for(let _=$+1;_<k;_++){const I=g[_],D=y(E,I,N,L,u,r,m);b(D),(r==="union"||D.cardinality>0||o)&&w.push(D)}w.length>1&&v(w,S+1,N,L)}}s<=0&&b(c?_e(r,i,a,h,c,m):_e(r,i,a,p,g=>g,m));const x=e.map(g=>{const S=V(r,g.name,new Set([g]),g.elems,m);return d.set(S,d.get(g)),b(S),S});return c?v(x,2,h,c):v(x,2,p,g=>g),wt(e,l,t)}function Ot(e){if(!e)return W;switch(e){case"cardinality":case"cardinality:desc":return ge([ue,W]);case"cardinality:asc":return ge([Z(ue),W]);case"name:desc":return Z(W);default:return W}}function Mt(e,t={}){let r=e;if(t.order){const s=Ot(t.order);r=r.slice().sort(s)}return t.limit!=null?r.slice(0,t.limit):r}function Tt(e,t,r={}){var s;const n=i=>i.sets,o=(s=t)!==null&&s!==void 0?s:{},a=Object.create(null);return e.forEach(i=>{n(i).forEach(c=>{const m=typeof c=="string"?c:String(c),l=a[m];l==null?a[m]=[i]:l.push(i)})}),Mt(Object.entries(a).map(([i,c])=>({type:"set",elems:c,name:String(i),cardinality:c.length})),o)}function q(e){return`${e.name}:${e.type}#${e.cardinality}`}function Ie(e){return e.sets.size===0}function Ee(e,t,r=q){const s={done:null,aKey:"",bKey:"",aIsSet:!1,bIsSet:!1,toKey:r};return e===t?(s.done=e.cardinality,s):e.cardinality===0||t.cardinality===0?(s.done=0,s):(s.aKey=r(e),s.bKey=r(t),s.aKey===s.bKey?(s.done=e.cardinality,s):(s.aIsSet=ye(e),s.bIsSet=ye(t),(!s.aIsSet&&Ie(e)||!s.bIsSet&&Ie(t))&&(s.done=0),s))}function Ce(e,t){return t.bIsSet||!t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.aKey)}function we(e,t){return!t.bIsSet||t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.bKey)}function Ne(e,t=q){return e.map(r=>{const s=Array.from(r.sets).map(t).sort();return{key:s.join("&"),s,sets:new Set(s),degree:r.degree,cardinality:r.cardinality}})}function ze(e,t,r){const s=new Set;if(r.aIsSet)s.add(r.aKey);else for(const n of Array.from(e.sets))s.add(r.toKey(n));if(r.bIsSet)s.add(r.bKey);else for(const n of Array.from(t.sets))s.add(r.toKey(n));return Array.from(s).sort().join("&")}function _t(e,t,r=q){const s=new Map;for(const n of Ne(e,r))for(const o of n.s)s.has(o)?s.get(o).push(n):s.set(o,[n]);return(n,o)=>{const a=Ee(n,o,r);if(a.done!=null)return a.done;if(!a.aIsSet&&!a.bIsSet)return 0;if(a.aIsSet&&!a.bIsSet)return Ce(o,a)?o.cardinality:0;if(!a.aIsSet&&a.bIsSet)return we(n,a)?n.cardinality:0;const i=s.get(a.aKey),c=s.get(a.bKey);return!i||!c?t(n,o):i.length<c.length?i.reduce((m,l)=>m+(l.sets.has(a.bKey)?l.cardinality:0),0):c.reduce((m,l)=>m+(l.sets.has(a.aKey)?l.cardinality:0),0)}}function It(e,t,r=q){const s=new Map(Ne(e,r).map(n=>[n.key,n.cardinality]));return(n,o)=>{const a=Ee(n,o,r);if(a.done!=null)return a.done;if(a.aIsSet&&!a.bIsSet&&Ce(o,a))return o.cardinality;if(!a.aIsSet&&a.bIsSet&&we(n,a))return n.cardinality;const i=ze(n,o,a);return s.has(i)?s.get(i):t(n,o)}}function Pt(e,t,r=q){const s=new Map(Ne(e,r).map(n=>[n.key,n.cardinality]));return(n,o)=>{const a=Ee(n,o,r);if(a.done!=null)return a.done;if(a.aIsSet&&!a.bIsSet&&Ce(o,a))return n.cardinality;if(!a.aIsSet&&a.bIsSet&&we(n,a))return o.cardinality;const i=ze(n,o,a);return s.has(i)?n.cardinality+o.cardinality-s.get(i):t(n,o)}}function Ut(e,t,r=q){if(e.length===0)return t;const s=e[0].type;if(e.some(n=>n.type!==s))return t;switch(s){case"union":return Pt(e,t,r);case"intersection":return It(e,t,r);case"distinctIntersection":return _t(e,t,r)}return t}function Ft(e){if(e.length===0)return"";const t=[];let r=e[0],s=1;for(let n=1;n<e.length;n++){const o=e[n];o===r?s++:(s>1?t.push(`${r}=${s-1}`):r===0?t.push(""):t.push(r.toString()),r=o,s=1)}return s>1?t.push(`${r}=${s}`):r===0?t.push(""):t.push(r.toString()),t.join(",")}function Bt(e){if(e.length===0)return"";const t=e.length,r=e.flat();return`${t};${Ft(r)}`}function Dt(e,t,{toElemKey:r,what:s="intersection",compress:n="auto"}={}){const o=e.concat(t);function a(u){if(u.overlap)return u.overlap;const d=re(u.elems,r);return p=>p.overlap?p.overlap(u):d(p.elems)[s]}const i=o.map((u,d)=>{const p=a(u),h=[];for(let y=d+1;y<o.length;y++)h.push(p(o[y]));return h});if(i.pop(),n==="no")return i;const c=Bt(i);if(n==="yes")return c;const m=JSON.stringify(i).length;return c.length+2<m*.6?c:i}const Rt=(e,t,r)=>{const s=e.length+r,n=t/Math.max(1,s),o=t-n*e.length,a=new Map(e.map((m,l)=>[m,l])),i=n/(1+r),c=m=>{const l=a.get(m);if(l!=null)return o+n*l};return c.bandwidth=()=>i,c};function Pe(e,t,r=1){for(let s=0;s<e.length-r;s+=r){const n=e[s],o=e[s+1];if(n<o){const a=n+t[s]/2,i=o-t[s+1]/2;if(a>i)return!0}else{const a=n-t[s]/2;if(o+t[s+1]/2>a)return!0}}return!1}function be(e,t,r,s,n){let o=e[e.length-1];if(!o.label){for(let a=e.length-2;a>0;--a)if(e[a].label){o=e[a];break}}if(o.value<t){const a=r(o.value),i=r(t);if(a<i){const c=a+s(o.value)/2,m=i-s(t)/2;c<m&&e.push({value:t,label:n(t)})}else{const c=a-s(o.value)/2;i+s(t)/2<c&&e.push({value:t,label:n(t)})}}return e}function fe(e,t=String,r=1){return e.map((s,n)=>({value:s,label:r===1||n%r===0?t(s):void 0}))}function et(e,t,r,s,n){const o=e.map(i=>t(i)),a=e.map(i=>r(i));return!Pe(o,a)||!Pe(o,a,2)?be(fe(e,n),s,t,r,n):null}function me(e){return e.toLocaleString()}function jt(e,t=11){const r=Math.max(0,Math.floor(Math.log10(e)-.5)),s=Math.pow(10,r),n=[1,2,5],o=n.map(i=>i*s);r>0&&o.unshift(n[n.length-1]*Math.pow(10,r-1)),o.push(n[0]*Math.pow(10,r+1));const a=Math.ceil(e/t);return o.filter(i=>i>=a&&i<=e)}function Ht(e,t=1){const r=[];for(let s=0;s<=e;s+=t)r.push(s);return r}function Ue(e,t,r,s){if(t<=0)return[];const n=jt(e,t);for(let o=0;o<n.length;o++){const a=Ht(e,n[o]),i=et(a,r,s,e,me);if(i)return i}return fe([0,e],me)}const Wt=(e,t,r)=>{const s=t[1]-t[0],n=e,o=a=>{const c=Math.max(0,Math.min(a,n))/n;return t[0]+c*s};return o.ticks=(a=10)=>{if(r.orientation==="vertical"){const c=Math.ceil(r.fontSizeHint*1.4);return Ue(e,a+1,o,()=>c)}const i=r.fontSizeHint/1.4;return Ue(e,a+1,o,c=>Math.ceil(me(c).length*i))},o.tickFormat=()=>me,o};function z(e){const t=["","k","M","G"],r=Math.max(0,Math.min(Math.floor(Math.log10(e)/3),t.length-1));return`${(Math.round(e/Math.pow(10,r*3-1))/10).toLocaleString()}${t[r]}`}function Vt(e,t){const r=[],s=Math.pow(10,t);for(let n=1;n<=e;n*=s)r.push(n);return r}function qt(e,t){const r=[];for(let n=1,o=0;n<=e;n*=10,o++){r.push({value:n,label:t===1||o%t===0?z(n):void 0});for(let a=n+n;a<n*10&&a<e;a+=n*t)r.push({value:a})}return r}function Fe(e,t,r,s){if(t<=0)return[];for(const n of[1,2,5]){const o=Vt(e,n);if(et(o,r,s,e,z))return be(qt(e,n),e,r,s,z)}return fe([0,e],z)}const Gt=(e,t,r)=>{const s=t[1]-t[0],n=e<1?1:Math.log10(e),o=a=>{const i=Math.max(0,Math.min(a,n)),c=i<=1?0:Math.log10(i)/n;return t[0]+c*s};return o.ticks=(a=10)=>{if(r.orientation==="vertical"){const c=Math.ceil(r.fontSizeHint*1.4);return Fe(e,a+1,o,()=>c)}const i=r.fontSizeHint/1.4;return Fe(e,a+1,o,c=>Math.ceil(z(c).length*i))},o.tickFormat=()=>z,o};function Yt(e){if(e.length===0)return"";const t=[];let r=0;const s=n=>(n===r+1?t.push(e[r].toString()):n===r+2&&n<10?t.push(`${e[r]},${e[r+1]}`):t.push(`${e[r]}+${n-r-1}`),n);for(let n=1;n<e.length;n++){const o=e[n-1]+1;e[n]!==o&&(r=s(n),r=n)}return s(e.length),t.join(",")}function te(e,t,{sortAble:r,compress:s="auto"}={}){if(e.length===0)return[];const n=e.map(c=>t(c));if(s==="no")return n;r&&n.sort((c,m)=>c-m);const o=Yt(n),a=JSON.stringify(n).length,i=o.length+2;return i<a*.6||a-i>50||s==="yes"&&i<a?o:n}function de(e,t){return t.color&&(e.color=t.color),e}function Kt(e,t={}){var r;const s=Object.assign({sortAble:!0},t),n=(r=t.toKey)!==null&&r!==void 0?r:q,o=new Map(e.sets.map((m,l)=>[n(m),l])),a=new Map(e.combinations.map((m,l)=>[n(m),l])),i=m=>{if(m.type==="set")return{type:m.type,index:o.get(n(m))};const l=a.get(n(m));return l==null||l<0?te(m.elems,e.toElemIndex,s):{type:m.type,index:l}},c=e.sets.map((m,l)=>({key:n(m),i:l}));return{sets:e.sets.map(m=>de({name:m.name,cardinality:m.cardinality,elems:te(m.elems,e.toElemIndex,s)},m)),combinations:t.compress==="no"?e.combinations.map(m=>{const l=new Set(Array.from(m.sets).map(n));return de({name:m.name,type:m.type,cardinality:m.cardinality,degree:m.degree,sets:c.filter(({key:u})=>l.has(u)).map(({i:u})=>u),elems:te(m.elems,e.toElemIndex,s)},m)}):void 0,combinationOptions:e.combinationOptions,selection:e.selection?Array.isArray(e.selection)?te(e.selection,e.toElemIndex,s):i(e.selection):void 0,queries:e.queries.map(m=>{const l=J(m)?i(m.set):te(Array.from(m.elems),e.toElemIndex,s);return{name:m.name,color:m.color,set:typeof l=="string"||Array.isArray(l)?void 0:l,elems:typeof l=="string"||Array.isArray(l)?l:void 0}})}}function Qt(e,t){return e.length===1?e[0].name:`(${e.map(r=>r.name).join(ve[t])})`}function Jt(e,t={}){var r;const s=(r=t.toKey)!==null&&r!==void 0?r:q,n=new Map(e.sets.map((u,d)=>[s(u),d])),o=new Map(e.combinations.map((u,d)=>[s(u),d])),a=u=>{if(se(u)){if(u.type==="set")return{type:u.type,index:n.get(s(u))};const p=o.get(s(u));if(p!=null&&p>=0)return{type:u.type,index:p}}const d=re(se(u)?u.elems:u);return e.sets.map(p=>d(p.elems).intersection).concat(e.combinations.map(p=>d(p.elems).intersection))},i=new Map(e.sets.map((u,d)=>[s(u),d])),c=Dt(e.sets,e.combinations,t),m=t.compress==="yes",l=u=>{const d=Array.from(u.sets).map(h=>i.get(s(h))).sort((h,y)=>h-y),p={c:u.cardinality,s:d.reduce((h,y)=>h+Math.pow(2,y),0)};return u.name!==Qt(d.map(h=>e.sets[h]),u.type)&&(p.n=u.name),u.type!=="intersection"&&(p.type=u.type[0]),u.color&&(p.cc=u.color),p};return{sets:m?e.sets.map(u=>({n:u.name,cc:u.color,c:u.cardinality})):e.sets.map(u=>de({name:u.name,cardinality:u.cardinality},u)),combinations:m?e.combinations.map(l):e.combinations.map(u=>de({name:u.name,cardinality:u.cardinality,type:u.type,sets:Array.from(u.sets).map(d=>i.get(s(d))).sort((d,p)=>d-p)},u)),overlaps:c,selection:e.selection?a(e.selection):void 0,queries:e.queries.map(u=>{if(J(u)){const h=a(u.set);return Array.isArray(h)?{name:u.name,color:u.color,overlaps:h}:{name:u.name,color:u.color,set:h}}const d=re(u.elems),p=e.sets.map(h=>d(h.elems).intersection).concat(e.combinations.map(h=>d(h.elems).intersection));return{name:u.name,color:u.color,overlaps:p}})}}function tt(e){return Array.from(e.classList).find(t=>t.startsWith("root-")).slice(5)}function nt(e,t){var r,s;return(s=(r=e.querySelector(`titleTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&s!==void 0?s:"UpSetJS"}function Xt(e,t){var r,s;return(s=(r=e.querySelector(`descTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&s!==void 0?s:""}const ne={},Se=[],xe={setLabel:"16px",axisTick:"10px",chartLabel:"16px",barLabel:"10px",legend:"10px",description:"16px",title:"24px",valueLabel:"12px",exportLabel:"10px"},Zt=[.18,.12,.7],zt=[.6,.4],rt={type:"intersection",order:["cardinality:desc","name:asc"]},en=Object.keys(xe),ie=[.7,.4],oe=[.15,.3],tn={selectionColor:"#ffa500",color:"#000000",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!1},nn={selectionColor:"#ffa500",color:"#cccccc",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#ffffff",hoverHintColor:"#d9d9d9",notMemberColor:"#666666",alternatingBackgroundColor:"rgba(255, 255, 255, 0.2)",valueTextColor:"#ffffff",strokeColor:"#ffffff",backgroundColor:"#303030",filled:!1},rn={selectionColor:"#4c78a8",color:"#4c78a8",hasSelectionColor:"#c9d6e5",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!0};function ke(e){return e==="vega"?rn:e==="dark"?nn:tn}function sn(e){return Array.isArray(e)}function on(e){return f.createElement("style",null,e)}function an(e,t,r={}){const s=ke(t.theme);return Object.assign(e,{queryLegend:t.queries!=null&&t.queries.length>0,theme:"light",padding:20,selection:null,title:"",description:"",fontFamily:"sans-serif",queries:Se,exportButtons:!0,className:"",fontSizes:xe,classNames:ne,style:ne,styles:ne,toKey:q,tooltips:!0,styleFactory:on},s,t,r,t.fontSizes?{fontSizes:Object.assign({},xe,t.fontSizes)}:ne)}function ln(e){return an({barPadding:.3,dotPadding:.7,combinations:rt,combinationName:e.combinations!=null&&!sn(e.combinations)&&e.combinations.type==="union"?"Union Size":"Intersection Size",barLabelOffset:2,setNameAxisOffset:"auto",combinationNameAxisOffset:"auto",setName:"Set Size",widthRatios:Zt,heightRatios:zt,setLabelAlignment:"center",numericScale:"linear",bandScale:"band",childrenFactories:ne,setAddons:Se,combinationAddons:Se,setAddonPadding:1,combinationAddonPadding:1,emptySelection:!0},e)}function st(e){return ln(e)}function cn(e,t){const r=e.cloneNode(!0);return r.style.backgroundColor=ke(e.dataset.theme).backgroundColor,t&&Array.from(r.querySelectorAll(t)).forEach(s=>s.remove()),new XMLSerializer().serializeToString(r)}function un(e,{type:t="png",title:r,toRemove:s}){const n=new Blob([cn(e,s)],{type:"image/svg+xml;charset=utf-8"}),o=tt(e),a=r??nt(e,o),i=URL.createObjectURL(n);return t==="svg"?(pe(i,`${a}.${t}`,e.ownerDocument),URL.revokeObjectURL(i),Promise.resolve()):fn(i,e).then(c=>{pe(c,`${a}.${t}`,e.ownerDocument),URL.revokeObjectURL(i)})}function fn(e,t){const r=t.ownerDocument.createElement("canvas"),s=t.getBoundingClientRect();r.width=s.width,r.height=s.height;const n=r.getContext("2d"),o=new Image(r.width,r.height);return new Promise(a=>{o.onload=()=>{n.drawImage(o,0,0);const i=r.toDataURL("image/png");a(i)},o.src=e})}function pe(e,t,r){const s=r.createElement("a");s.href=e,s.style.position="absolute",s.style.left="-10000px",s.style.top="-10000px",s.download=t,r.body.appendChild(s),s.click(),s.remove()}function mn(e,t){var r,s,n,o,a;const i=(n=e.getComputedStyle||((s=(r=e.ownerDocument)===null||r===void 0?void 0:r.defaultView)===null||s===void 0?void 0:s.getComputedStyle))!==null&&n!==void 0?n:window.getComputedStyle,c=tt(e),m=t??nt(e,c),l=Array.from(e.querySelectorAll("[data-upset=sets] [data-cardinality]")).map(C=>({name:C.querySelector(`text.setTextStyle-${c}`).textContent,cardinality:Number.parseInt(C.dataset.cardinality,10)})).reverse(),u=-Number.parseFloat(e.querySelector(`.sBarTextStyle-${c}`).getAttribute("dx")),d=i(e.querySelector(`.fillPrimary-${c}`)).fill,p=i(e.querySelector(`.fillNotMember-${c}`)).fill,h=i(e.querySelector("text")).fill,y=e.querySelector(`.cChartTextStyle-${c}`).textContent,b=e.querySelector(`.sChartTextStyle-${c}`).textContent,v=Array.from(e.querySelectorAll("[data-upset=cs] [data-cardinality]")).map(C=>({name:C.querySelector(`text.hoverBarTextStyle-${c}`).textContent,cardinality:Number.parseInt(C.dataset.cardinality,10),sets:Array.from(C.querySelectorAll(`.fillPrimary-${c} > title`)).map(O=>O.textContent)})),x=C=>Number.parseFloat(C.getAttribute("transform").match(/([\d.]+),/)[1]),g=C=>Number.parseFloat(C.getAttribute("transform").match(/,([\d.]+)/)[1]),S=e.querySelector("[data-upset=base]"),N=x(S),L=x(e.querySelector("[data-upset=csaxis]")),k=Number.parseFloat(S.querySelector("g").firstElementChild.children[1].getAttribute("x2")),$=g(e.querySelector("[data-upset=setaxis]")),E=Number.parseFloat(e.querySelector("defs rect").getAttribute("width")),w=Number.parseFloat(e.querySelector("defs rect").getAttribute("height")),_=Number.parseFloat(e.querySelector(`[data-cardinality] circle.fillPrimary-${c}`).getAttribute("r")),I=e.querySelector("[data-upset=sets-s] [data-cardinality]")!=null,D=e.querySelector("[data-upset=sets-q] [data-cardinality]")!=null,H=I||D;let R="orange";H&&(Array.from(e.querySelectorAll(`[data-upset=sets-${I?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(C=>{const O=l.length-Number.parseInt(C.dataset.i,10)-1;l[O].selection=Number.parseInt(C.dataset.cardinality,10)}),Array.from(e.querySelectorAll(`[data-upset=cs-${I?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(C=>{const O=Number.parseInt(C.dataset.i,10);v[O].selection=Number.parseInt(C.dataset.cardinality,10)}),R=i(e.querySelector(`[data-upset=sets-${I?"s":"q"}] [data-cardinality]`)).fill);const P=Number.parseInt((a=(o=e.querySelector("[data-upset=cs-ss]"))===null||o===void 0?void 0:o.dataset.i)!==null&&a!==void 0?a:"-1",10),U=P>=0?{field:"partOf",oneOf:[1,2]}:{field:"partOf",equal:1};return{$schema:"https://vega.github.io/schema/vega-lite/v4.json",title:m,description:Xt(e,c),datasets:{sets:l,combinations:v.map((C,O)=>Object.assign({},C,{partOf:P===O?2:1,nsets:[""]})).concat(v.map(C=>({name:C.name,cardinality:C.cardinality,partOf:0,sets:[""],nsets:l.filter(O=>!C.sets.includes(O.name)).map(O=>O.name)})))},vconcat:[{hconcat:[{mark:"bar",width:L+E-40,height:$},{width:k,height:$,data:{name:"combinations"},transform:[{filter:U}],layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"center",baseline:"bottom",dy:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},H&&{mark:{type:"bar",fill:R,tooltip:!0},encoding:{y:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null},y:{field:"cardinality",type:"quantitative",axis:{grid:!1},title:y}}}]},{hconcat:[{width:L,height:w,data:{name:"sets"},layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"right",baseline:"middle",dx:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},H&&{mark:{type:"bar",fill:R,tooltip:!0},encoding:{x:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},x:{field:"cardinality",type:"quantitative",title:b,sort:"descending",axis:{grid:!1}}}},{data:{name:"sets"},width:E,height:w,mark:{type:"text",align:"center",baseline:"middle",fontSize:Number.parseInt(i(e.querySelector(`.setTextStyle-${c}`)).fontSize,10)},encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},text:{field:"name",type:"ordinal"}}},{width:k,height:w,data:{name:"combinations"},transform:[{flatten:["sets"],as:["has_set"]},{flatten:["nsets"],as:["has_not_set"]},{calculate:"datum.has_set+datum.has_not_set",as:"set"}],layer:[{mark:{type:"circle",size:_*_*Math.PI,tooltip:!0},encoding:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[p,d].concat(P>=0?[R]:[])}},y:{field:"set",type:"ordinal",axis:null,sort:null,scale:{domain:l.map(C=>C.name)}}}},{mark:"rule",transform:[{filter:U},{calculate:"datum.sets[datum.sets.length -1]",as:"set_end"}],encoding:Object.assign({y:{field:"sets[0]",type:"ordinal",axis:null,sort:null},y2:{field:"set_end"}},P<0?{}:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[d,R]}}})}],encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null}}}]}],config:{padding:N,background:ke(e.dataset.theme).backgroundColor,concat:{spacing:0},view:{stroke:null},bar:{fill:d},circle:{opacity:1},rule:{stroke:d,strokeWidth:Number.parseInt(i(e.querySelector("[data-upset=cs] [data-cardinality] line")).strokeWidth,10)},axis:{labelColor:h,labelFontSize:Number.parseInt(i(e.querySelector(`.axisTextStyle-${c}`)).fontSize,10),titleColor:h,titleFontSize:Number.parseInt(i(e.querySelector(`.cChartTextStyle-${c}`)).fontSize,10)},title:{color:h},text:{fill:h,fontSize:Number.parseInt(i(e.querySelector(`.sBarTextStyle-${c}`)).fontSize,10)}}}}function dn(e,{title:t}={}){const r=mn(e,t),s=URL.createObjectURL(new Blob([JSON.stringify(r,null,2)],{type:"application/json"}));pe(s,`${r.title}.json`,e.ownerDocument),URL.revokeObjectURL(s)}const pn=["selectionColor","color","textColor","hoverHintColor","notMemberColor","alternatingBackgroundColor","hasSelectionColor","hasSelectionOpacity","opacity","strokeColor","valueTextColor"],hn=["padding","barPadding","dotPadding","widthRatios","heightRatios"],yn=["fontSizes","combinationName","setName","barLabelOffset","setNameAxisOffset","combinationNameAxisOffset","theme","fontFamily","emptySelection","exportButtons","queryLegend"],gn=["bandScale","numericScale"].concat(pn,hn,yn);function ot(e){var t;const r=st({width:0,height:0,sets:(t=e.sets)!==null&&t!==void 0?t:[],combinations:e.combinations,theme:e.theme}),s={};return gn.forEach(n=>{const o=e[n],a=r[n];if(n==="theme"&&o!=="light"){s[n]=o;return}if(!(o==null||o===a))if(n==="fontSizes"){let i=!0;const c={};en.forEach(m=>{const l=o[m],u=a[m];l!==u&&(c[m]=l,i=!1)}),i||(s[n]=c)}else s[n]=o}),s}function bn(e,t,r,s,n){return Object.assign({$schema:"https://upset.js.org/schema.1.0.0.json",name:typeof r.title=="string"?r.title:"UpSetJS",description:typeof r.description=="string"?r.description:"",mode:n,author:s,elements:t,attrs:[],props:ot(r)},e)}function Sn(e,t,r,s){return Object.assign({$schema:"https://upset.js.org/schema-static.1.0.0.json",name:typeof t.title=="string"?t.title:"UpSetJS",description:typeof t.description=="string"?t.description:"",mode:s,author:r,props:ot(t)},e)}function at(e,t,r=!1,s){var n,o;const a=[],i=new Map,c=l=>i.has(l)?i.get(l):(i.set(l,a.length),a.push(l),a.length-1),m=Kt({sets:e.sets,queries:(o=(n=e.queries)===null||n===void 0?void 0:n.filter(l=>Q(l)||J(l)))!==null&&o!==void 0?o:[],toElemIndex:c,selection:e.selection&&se(e.selection)?e.selection:void 0,combinations:t.cs.v,combinationOptions:Array.isArray(e.combinations)?{}:e.combinations},{compress:r?"yes":"no"});return bn(m,a,e,void 0,s)}function xn(e,t,r=!1,s){var n,o;const a=Jt({sets:e.sets,queries:(o=(n=e.queries)===null||n===void 0?void 0:n.filter(i=>Q(i)||J(i)))!==null&&o!==void 0?o:[],selection:e.selection&&se(e.selection)?e.selection:void 0,combinations:t.cs.v},{compress:r?"yes":"no"});return Sn(a,e,void 0,s)}function $n(e,t,r,s){const n=at(t,r,!1,s),o=URL.createObjectURL(new Blob([JSON.stringify(n,null,2)],{type:"application/json"}));pe(o,`${n.name}.json`,e.ownerDocument),URL.revokeObjectURL(o)}const Be=2048*2;function vn(e,t,r){const s=at(e,t,!0,r);delete s.$schema;const n=Oe.compressToEncodedURIComponent(JSON.stringify(s)),o=new URL("https://upset.js.org/app/embed.html");if(o.searchParams.set("p",n),o.toString().length<Be)return window.open(o.toString(),"_blank"),!0;const a=xn(e,t,!0,r);delete a.$schema;const i=Oe.compressToEncodedURIComponent(JSON.stringify(a));if(o.searchParams.set("p",i),o.toString().length<Be)return window.open(o.toString(),"_blank"),!0;o.searchParams.delete("p");const c=window.open(o.toString(),"_blank");return c==null||c.addEventListener("load",()=>{c==null||c.postMessage(s,o.origin)}),!1}function A(...e){return e.filter(Boolean).join(" ")}function Ae(e){return`upset-${Math.random().toString(36).slice(4)}`}function De(e){return e!=null&&!Array.isArray(e)}function Re(e,t){const r=re(e,t);return s=>r(s.elems).intersection}function En(){return-1}function Cn(e,t,r){if(!e)return Nn;if(typeof e=="function")return e;if(Array.isArray(e))return Re(e,r);const s=e;if(s.overlap)return s.overlap.bind(s);let n=null;return o=>{if(o.overlap)return o.overlap(s);const a=t(o,s);return a>=0?a:(n||(n=Re(s.elems,r)),n(o))}}function it(e){var t;return Array.isArray(e)?`Array(${e.length})`:typeof e=="function"?"?":(t=e)===null||t===void 0?void 0:t.name}function wn(e,t){const r=Ke(e,t);return s=>r(s.elems).intersection}function Nn(){return 0}function je(e){return e==null?10:e.endsWith("pt")?Math.floor(4/3*Number.parseInt(e,10)):Number.parseInt(e,10)}function kn(e){var t;return(t={left:"start",center:"middle",right:"end"}[e])!==null&&t!==void 0?t:"middle"}function An(e){return e==="linear"?Wt:e==="log"?Gt:e}function Ln(e){return e==="band"?Rt:e}function On(e){return Array.isArray(e)}function Mn(e,t,r,s,n,o,a,i,c,m,l,u,d,p,h){var y;const b=An(s),v=Ln(n),x=On(t)?t:Ze(e,Object.assign({toElemKey:u},rt,t)),g=x.map(l),S=v(g,r.cs.w,r.padding),N=x.reduce((M,F)=>Math.max(M,F.cardinality),0),L=h??N,k=L>N?0:o,$=b(L,[r.cs.h,k],{orientation:"vertical",fontSizeHint:c}),E=M=>Math.floor(o/1.4*.7*M.length),w=M=>E($.tickFormat()(M)),_=e.reduce((M,F)=>Math.max(M,F.cardinality),0),I=p??_,D=w(I);let H=w(L);for(const M of m){if(!M.scale)continue;const F=M.scale.ticks(3),ae=M.scale.tickFormat();for(const X of F){const ut=typeof X=="number"?ae(X):(y=X.label)!==null&&y!==void 0?y:ae(X.value),Le=E(ut);Le>H&&(H=Le)}}const R=I>_?0:D,P=b(I,[r.sets.w,R],{orientation:"horizontal",fontSizeHint:c}),U=e.map(l),C=v(U.slice().reverse(),r.sets.h,r.padding),O=Math.min(C.bandwidth(),S.bandwidth())/2*a,j=Math.max(2,Math.min(C.bandwidth(),S.bandwidth())/2*i);return{id:d||Ae(),r:O,triangleSize:j,sets:{v:e,keys:U,rv:e.slice().reverse(),x:P,xAxisWidth:r.sets.w-R,y:M=>C(l(M)),max:I,bandWidth:C.bandwidth(),cy:C.bandwidth()/2+r.cs.h,format:P.tickFormat(),labelOffset:o+9+2},cs:{v:x,keys:x.map(l),x:M=>S(l(M)),max:L,y:$,yAxisWidth:r.cs.h-k,cx:S.bandwidth()/2,bandWidth:S.bandwidth(),format:$.tickFormat(),has:(M,F)=>{const ae=l(F);return Array.from(M.sets).some(X=>l(X)===ae)},labelOffset:H+9+6},toKey:l,toElemKey:u,overlapGuesser:Ut(x,En,l)}}function Tn(e,t,r,s,n,o,a,i,c,m,l){const u=a.reduce((S,N)=>S+(N.position==="before"?N.size+m:0),0),d=a.reduce((S,N)=>S+(N.position!=="before"?N.size+m:0),0),p=i.reduce((S,N)=>S+(N.position==="before"?N.size+m:0),0),h=i.reduce((S,N)=>S+(N.position!=="before"?N.size+m:0),0),y=t-2*r-20-h-p,b=e-2*r-u-d,v=n[0]>1?n[0]:b*n[0],x=n[1]>1?n[1]:b*n[1],g=o[0]>1?o[0]:y*o[0];return{id:c||Ae(),cs:{before:p,after:h,x:u+v+x,y:p,w:b-v-x,h:g,addons:i,addonPadding:l},labels:{x:u+v,y:p+g,w:x,h:y-g},sets:{before:u,after:d,x:u,y:p+g,w:v,h:y-g,addons:a,addonPadding:m},padding:s,legend:{x:e/2},margin:r,w:e,h:t}}function _n(e,t,r,s,n,o,a,i,c,m,l,u,d,p,h){return{theme:e,styles:t,classNames:r,cs:{name:s,offset:n},sets:{name:o,offset:a},emptySelection:l,id:i,barLabelOffset:c,selectionColor:m,title:u,description:d,tooltips:p,setLabelAlignment:h}}function In({transform:e,styleId:t,exportButtons:r,exportChart:s}){if(!r)return null;const n=26,o=26,a=34,i=34,c=42,m=2;let l=0;const u=[];return(r===!0||r.svg!==!1)&&(l+=n,u.push(f.createElement("g",{key:"svg",className:`exportButton-${t}`,onClick:s,"data-type":"svg",transform:`translate(-${l}, 0)`},f.createElement("title",null,"Download SVG Image"),f.createElement("rect",{y:-9,width:n,height:11,rx:2,ry:2}),f.createElement("text",{className:`exportTextStyle-${t}`,x:n/2},"SVG"))),l+=m),(r===!0||r.png!==!1)&&(l+=o,u.push(f.createElement("g",{key:"png",className:`exportButton-${t}`,onClick:s,"data-type":"png",transform:`translate(-${l}, 0)`},f.createElement("title",null,"Download PNG Image"),f.createElement("rect",{y:-9,width:o,height:11,rx:2,ry:2}),f.createElement("text",{className:`exportTextStyle-${t}`,x:o/2},"PNG"))),l+=m),(r===!0||r.vega!==!1)&&(l+=a,u.push(f.createElement("g",{key:"vega",className:`exportButton-${t}`,onClick:s,"data-type":"vega",transform:`translate(-${l}, 0)`},f.createElement("title",null,"Download VEGA-Lite Specification"),f.createElement("rect",{y:-9,width:a,height:11,rx:2,ry:2}),f.createElement("text",{className:`exportTextStyle-${t}`,x:a/2},"VEGA"))),l+=m),(r===!0||r.dump!==!1)&&(l+=i,u.push(f.createElement("g",{key:"dump",className:`exportButton-${t}`,onClick:s,"data-type":"dump",transform:`translate(-${l}, 0)`},f.createElement("title",null,"Download UpSet.js JSON Dump"),f.createElement("rect",{y:-9,width:i,height:11,rx:2,ry:2}),f.createElement("text",{className:`exportTextStyle-${t}`,x:i/2},"DUMP"))),l+=m),(r===!0||r.share!==!1)&&(l+=c,u.push(f.createElement("g",{key:"share",className:`exportButton-${t}`,onClick:s,"data-type":"share",transform:`translate(-${l}, 0)`},f.createElement("title",null,"Open a shareable URL"),f.createElement("rect",{y:-9,width:c,height:11,rx:2,ry:2}),f.createElement("text",{className:`exportTextStyle-${t}`,x:c/2},"SHARE"))),l+=m),f.createElement("g",{className:`exportButtons-${t}`,transform:e},u)}const Pn=f.memo(function({queries:t,x:r,style:s,data:n}){return f.createElement("text",{transform:`translate(${r},4)`,style:s.styles.legend,className:A(`legendTextStyle-${s.id}`,s.classNames.legend)},t.map((o,a)=>{let i=null;return J(o)?i=o.set.cardinality:Q(o)&&(i=o.elems instanceof Set?o.elems.size:o.elems.length),f.createElement(f.Fragment,{key:o.name},f.createElement("tspan",{className:`fillQ${a}-${n.id}`},"  ⬤ "),f.createElement("tspan",null,o.name,i!=null?`: ${n.sets.format(i)}`:""))}))}),Un=f.memo(function({pos:t,spacing:r,tickSizeInner:s,orient:n,name:o,style:a}){const i=n==="top"||n==="left"?-1:1;return f.createElement("g",{transform:`translate(0, ${t+.5})`},o&&f.createElement("text",{x:i*r,dy:"0.32em",className:A(`axisTextStyle-${a.id}`,n==="right"?`startText-${a.id}`:`endText-${a.id}`,a.classNames.axisTick),style:a.styles.axisTick},o),f.createElement("line",{x2:i*s,className:`axisLine-${a.id}`}))}),Fn=f.memo(function({pos:t,name:r,spacing:s,orient:n,tickSizeInner:o,style:a}){const i=n==="top"||n==="left"?-1:1;return f.createElement("g",{transform:`translate(${t+.5}, 0)`},r&&f.createElement("text",{y:i*s,dy:n==="top"?"0em":"0.71em",className:A(`axisTextStyle-${a.id}`,a.classNames.axisTick),style:a.styles.axisTick},r),f.createElement("line",{y2:i*o,className:`axisLine-${a.id}`}))});function le({scale:e,orient:t,tickSizeInner:r=6,tickSizeOuter:s=6,tickPadding:n=3,size:o,start:a,style:i,transform:c}){const m=Math.max(r,0)+n,l=a,u=o,d=t==="top"||t==="left"?-1:1,p=t==="left"||t==="right"?Un:Fn,h=e.ticks().map(y=>typeof y=="number"?{value:y,label:y.toLocaleString()}:y);return f.createElement("g",{transform:c},h.map(y=>f.createElement(p,{key:y.value,pos:e(y.value),name:y.label,spacing:m,tickSizeInner:r,orient:t,style:i})),f.createElement("path",{className:`axisLine-${i.id}`,d:t==="left"||t==="right"?s?`M${d*s},${l}H0.5V${u}H${d*s}`:`M0.5,${l}V${u}`:s?`M${l},${d*s}V0.5H${u}V${d*s}`:`M${l},0.5H${u}`}))}const He=f.memo(function({width:t,text:r,dy:s,x:n,style:o,className:a}){const i=T.useRef(null),[c,m]=T.useState(typeof r=="string"?[r]:[]);return T.useLayoutEffect(()=>{m(typeof r=="string"?[r]:[])},[r]),T.useLayoutEffect(()=>{if(!i.current||i.current.childElementCount>0||typeof r!="string"||typeof i.current.getComputedTextLength!="function")return;const l=i.current.getComputedTextLength(),u=[];let d=t,p=0;const h=i.current.getStartPositionOfChar(0);for(;l>d;){h.x=d;const y=i.current.getCharNumAtPosition(h),b=r.lastIndexOf(" ",y);if(b<p)break;u.push(r.slice(p,b+1));const v=i.current.getEndPositionOfChar(b+1).x;p=b+1,d=v+t}u.push(r.slice(p)),m(u)},[i,r,t]),r?f.createElement("tspan",{ref:i,dy:s,style:o,x:n,className:a},c.length>1?c.map((l,u)=>f.createElement("tspan",{key:l,x:0,dy:u>0?"1.2em":s},l)):r):null});var Bn=f.memo(function({width:t,descriptionWidth:r=t,style:s}){return!s.title&&!s.description?null:f.createElement("text",null,f.createElement(He,{text:s.title,width:t,dy:"10px",className:A(`titleTextStyle-${s.id}`,s.classNames.title),style:s.styles.title}),f.createElement(He,{x:0,width:r,dy:s.title?"2em":"10px",text:s.description,className:A(`descTextStyle-${s.id}`,s.classNames.description),style:s.styles.description}))});function Dn(){}function ce(e){return e?(t,r)=>function(s){return e.call(this,t,s.nativeEvent,r.map(n=>n.createOnHandlerData?n.createOnHandlerData(t):null))}:Dn}function ee(e,t){let r=0,s=0;return n=>{let o=0;return n.position==="before"?(r+=n.size+t,o=-r):(o=e+s+t,s+=n.size+t),o}}function B(e,t,r="fill"){return t?e?Object.assign({[r]:t},e):t?{[r]:t}:void 0:e}const Rn=f.memo(function({size:t,style:r,data:s}){const n=ee(t.sets.w+t.labels.w+t.cs.w,t.sets.addonPadding),o=ee(t.cs.h+t.sets.h,t.cs.addonPadding),a=r.cs.offset==="auto"?s.cs.labelOffset:r.cs.offset,i=r.sets.offset==="auto"?s.sets.labelOffset:r.sets.offset;return f.createElement("g",null,f.createElement(Bn,{style:r,width:t.cs.x-a-20}),t.cs.h>0&&f.createElement("g",{transform:`translate(${t.cs.x},${t.cs.y})`,"data-upset":"csaxis"},f.createElement(le,{scale:s.cs.y,orient:"left",size:t.cs.h,start:t.cs.h-s.cs.yAxisWidth,style:r}),f.createElement("line",{x1:0,x2:t.cs.w,y1:t.cs.h+1,y2:t.cs.h+1,className:`axisLine-${r.id}`}),f.createElement("text",{className:A(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-a}, ${t.cs.h/2})rotate(-90)`},r.cs.name),t.cs.addons.map(c=>{const m=o(c),l=f.createElement("text",{key:c.name,className:A(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-a}, ${m+c.size/2})rotate(-90)`},c.name);return c.scale?f.createElement(f.Fragment,{key:c.name},f.createElement(le,{scale:c.scale,orient:"left",size:c.size,start:0,style:r,transform:`translate(0,${m})`}),l):l})),t.sets.w>0&&f.createElement("g",{transform:`translate(${t.sets.x},${t.sets.y})`,"data-upset":"setaxis"},f.createElement(le,{scale:s.sets.x,orient:"bottom",size:t.sets.w,start:t.sets.w-s.sets.xAxisWidth,transform:`translate(0, ${t.sets.h})`,style:r}),f.createElement("text",{className:A(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${t.sets.w/2}, ${t.sets.h+i})`},r.sets.name),t.sets.addons.map(c=>{const m=n(c),l=f.createElement("text",{key:c.name,className:A(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${m+c.size/2}, ${t.sets.h+i})`},c.name);return c.scale?f.createElement(f.Fragment,{key:c.name},f.createElement(le,{scale:c.scale,orient:"bottom",size:c.size,start:0,transform:`translate(${m}, ${t.sets.h})`,style:r}),l):l})))}),$e=f.memo(function({cx:t,r,cy:s,name:n,className:o,style:a,fill:i}){return f.createElement("circle",{r,cx:t,cy:s,className:o,style:B(a,i)},n&&f.createElement("title",null,n))});function he(e,t,r){const s=[r(e)];for(let n=0;n<oe.length&&e>t;n++)e-=t,s.push(r(e));return s}const jn=f.memo(function({d:t,h:r,className:s,data:n,size:o,style:a,children:i}){const c=he(t.cardinality,n.cs.max,n.cs.y),m=ee(o.cs.h+o.sets.h,o.cs.addonPadding);return f.createElement("g",{transform:`translate(${n.cs.x(t)}, 0)`,onMouseEnter:r.onMouseEnter(t,o.cs.addons),onMouseLeave:r.onMouseLeave,onClick:r.onClick(t,o.cs.addons),onContextMenu:r.onContextMenu(t,o.cs.addons),onMouseMove:r.onMouseMove(t,o.cs.addons),className:s,"data-cardinality":t.cardinality},a.tooltips&&f.createElement("title",null,t.name,": ",n.cs.format(t.cardinality)),f.createElement("rect",{y:-o.cs.before,width:n.cs.bandWidth,height:o.sets.h+o.cs.h+o.cs.before+o.cs.after,className:`hoverBar-${a.id}`}),o.cs.h>0&&f.createElement(f.Fragment,null,c.map((l,u)=>{const d=u>0?Math.floor(n.cs.bandWidth*oe[u-1]):0;return f.createElement("rect",{key:u,x:d,y:l,height:o.cs.h-l,width:n.cs.bandWidth-d*2,className:A(`fillPrimary-${a.id}`,u<c.length-1&&`fillOverflow${c.length-1-u}-${a.id}`,a.classNames.bar),style:B(a.styles.bar,t.color)})}),f.createElement("text",{y:c[0]-a.barLabelOffset,x:n.cs.bandWidth/2,style:a.styles.barLabel,className:A(`cBarTextStyle-${a.id}`,a.classNames.barLabel)},n.cs.format(t.cardinality))),f.createElement("text",{y:-a.barLabelOffset-o.cs.before,x:n.cs.bandWidth/2,style:a.styles.barLabel,className:A(`hoverBarTextStyle-${a.id}`,a.classNames.barLabel)},t.name),n.sets.v.map((l,u)=>n.cs.has(t,l)?null:f.createElement($e,{key:n.sets.keys[u],r:n.r,cx:n.cs.cx,cy:n.sets.y(l)+n.sets.cy,name:a.tooltips?t.name:"",style:a.styles.dot,fill:void 0,className:A(`fillNotMember-${a.id}`,a.classNames.dot)})),t.sets.size>1&&f.createElement("line",{x1:n.cs.cx,y1:n.sets.y(n.sets.v.find(l=>n.cs.has(t,l)))+n.sets.cy-(n.r-1),x2:n.cs.cx,y2:n.sets.y(n.sets.rv.find(l=>n.cs.has(t,l)))+n.sets.cy+(n.r-1),style:t.color?{stroke:t.color}:void 0,className:`upsetLine-${n.id}`}),n.sets.v.map((l,u)=>{var d;return n.cs.has(t,l)?f.createElement($e,{key:n.sets.keys[u],r:n.r,cx:n.cs.cx,cy:n.sets.y(l)+n.sets.cy,name:a.tooltips?l.name:"",style:a.styles.dot,fill:(d=l.color)!==null&&d!==void 0?d:t.color,className:A(`fillPrimary-${a.id}`,a.classNames.dot)}):null}),o.cs.addons.map(l=>f.createElement("g",{key:l.name,transform:`translate(0,${m(l)})`},l.render({set:t,width:n.cs.bandWidth,height:l.size,theme:a.theme}))),i)}),Hn=f.memo(function({d:t,i:r,h:s,className:n,size:o,data:a,style:i,children:c}){const m=he(t.cardinality,a.sets.max,a.sets.x),l=ee(o.sets.w+o.labels.w+o.cs.w,o.sets.addonPadding),u=i.setLabelAlignment==="center"?o.labels.w/2:i.setLabelAlignment==="left"?2:o.labels.w-2;return f.createElement("g",{transform:`translate(0, ${a.sets.y(t)})`,onMouseEnter:s.onMouseEnter(t,o.sets.addons),onMouseLeave:s.onMouseLeave,onClick:s.onClick(t,o.sets.addons),onContextMenu:s.onContextMenu(t,o.sets.addons),onMouseMove:s.onMouseMove(t,o.sets.addons),className:n,"data-cardinality":t.cardinality},i.tooltips&&f.createElement("title",null,t.name,": ",a.sets.format(t.cardinality)),f.createElement("rect",{x:-o.sets.before,width:o.sets.w+o.labels.w+o.cs.w+o.sets.after,height:a.sets.bandWidth,className:`hoverBar-${i.id}`}),r%2===1&&f.createElement("rect",{x:o.sets.w,width:o.labels.w+o.cs.w+o.sets.after,height:a.sets.bandWidth,className:`fillAlternating-${i.id}`}),o.sets.w>0&&f.createElement(f.Fragment,null,m.map((d,p)=>{const h=p>0?Math.floor(a.sets.bandWidth*oe[p-1]):0;return f.createElement("rect",{key:p,x:d,y:h,width:o.sets.w-d,height:a.sets.bandWidth-h*2,className:A(`fillPrimary-${i.id}`,p<m.length-1&&`fillOverflow${m.length-1-p}-${i.id}`,i.classNames.bar),style:B(i.styles.bar,t.color)})}),f.createElement("text",{x:m[0],dx:-i.barLabelOffset,y:a.sets.bandWidth/2,style:i.styles.barLabel,className:A(`sBarTextStyle-${i.id}`,i.classNames.barLabel)},a.sets.format(t.cardinality))),f.createElement("text",{x:o.sets.w+u,y:a.sets.bandWidth/2,className:A(`setTextStyle-${i.id}`,i.classNames.setLabel),style:i.styles.setLabel,clipPath:`url(#clip-${o.id})`},t.name),o.sets.addons.map(d=>f.createElement("g",{key:d.name,transform:`translate(${l(d)},0)`},d.render({set:t,width:d.size,height:a.sets.bandWidth,theme:i.theme}))),c)}),Wn=f.memo(function({data:t,size:r,style:s,h:n,setChildrenFactory:o,combinationChildrenFactory:a}){return f.createElement("g",{className:n.hasClick?`clickAble-${s.id}`:void 0},f.createElement("g",{transform:`translate(${r.sets.x},${r.sets.y})`,"data-upset":"sets"},t.sets.v.map((i,c)=>f.createElement(Hn,{key:t.sets.keys[c],d:i,i:c,h:n,className:n.hasClick||n.hasHover?`interactive-${s.id}`:void 0,data:t,style:s,size:r},o&&o(i)))),f.createElement("g",{transform:`translate(${r.cs.x},${r.cs.y})`,"data-upset":"cs"},t.cs.v.map((i,c)=>f.createElement(jn,{key:t.cs.keys[c],d:i,h:n,className:n.hasClick||n.hasHover?`interactive-${s.id}`:void 0,data:t,style:s,size:r},a&&a(i)))))});function lt({data:e,size:t,style:r,elemOverlap:s,secondary:n,tooltip:o,suffix:a,transform:i,empty:c,combinationAddons:m}){const l=e.cs.bandWidth,u=t.cs.h+t.sets.h,d=t.cs.h,p=A(`fill${a}`,!o&&`pnone-${r.id}`,r.classNames.bar);return f.createElement("g",{transform:i,"data-upset":n?"cs-q":"cs-s"},e.cs.v.map((h,y)=>{const b=e.cs.x(h),v=e.cs.keys[y];if(c&&!n)return f.createElement("rect",{key:v,x:b,y:d,height:0,width:l,className:p,style:B(r.styles.bar,r.selectionColor?void 0:h.color)},o&&f.createElement("title",null));const x=s(h);if(x===0)return null;const g=he(x,e.cs.max,e.cs.y),S=o&&f.createElement("title",null,`${h.name} ∩ ${o}: ${x}`),N=n?f.createElement("path",{key:v,transform:`translate(${b}, ${g[0]})`,d:`M0,-1 l${l},0 l0,2 l${-l},0 L-${e.triangleSize},-${e.triangleSize} L-${e.triangleSize},${e.triangleSize} Z`,className:p,"data-i":y,"data-cardinality":x,style:B(void 0,r.selectionColor?void 0:h.color)},S):g.map(($,E)=>{const w=E>0?Math.floor(e.cs.bandWidth*oe[E-1]):0;return f.createElement("rect",{key:E,x:b+w,y:$,height:d-$,width:l-w*2,"data-i":E>0?null:y,"data-cardinality":E>0?null:x,className:A(p,E<g.length-1&&`fillOverflow${g.length-1-E}-${r.id}`),style:B(r.styles.bar,r.selectionColor?void 0:h.color)},S)}),L=ee(u,t.cs.addonPadding),k=m.map($=>{const E=L($),w=$.render({set:h,width:l,height:$.size,theme:r.theme});return w?f.createElement("g",{key:$.name,transform:`translate(${b},${E})`},w):null}).filter(Boolean);return k.length===0?N:f.createElement("g",{key:v},N,k)}))}function ct({data:e,size:t,style:r,elemOverlap:s,suffix:n,secondary:o,empty:a,tooltip:i,setAddons:c,transform:m}){const l=t.sets.w,u=t.sets.w+t.labels.w+t.cs.w,d=e.sets.bandWidth,p=A(`fill${n}`,!i&&` pnone-${r.id}`,r.classNames.bar);return f.createElement("g",{transform:m,"data-upset":o?"sets-q":"sets-s"},e.sets.v.map((h,y)=>{const b=e.sets.y(h),v=e.sets.keys[y];if(a&&!o)return f.createElement("rect",{key:v,x:l,y:b,width:0,height:d,className:p,style:B(r.styles.bar,r.selectionColor?void 0:h.color)},r.tooltips&&i&&f.createElement("title",null));const x=s(h);if(x===0)return null;const g=he(x,e.sets.max,e.sets.x),S=r.tooltips&&i&&f.createElement("title",null,`${h.name} ∩ ${i}: ${x}`),N=o?f.createElement("path",{key:v,transform:`translate(${g[0]}, ${b+d})`,d:`M1,0 l0,${-d} l-2,0 l0,${d} L-${e.triangleSize},${e.triangleSize} L${e.triangleSize},${e.triangleSize} Z`,"data-i":y,"data-cardinality":x,className:p,style:B(void 0,r.selectionColor?void 0:h.color)},S):g.map(($,E)=>{const w=E>0?Math.floor(e.sets.bandWidth*oe[E-1]):0;return f.createElement("rect",{key:E,"data-i":E>0?null:y,"data-cardinality":E>0?null:x,x:$,y:b+w,width:l-$,height:d-w*2,className:A(p,E<g.length-1&&`fillOverflow${g.length-1-E}-${r.id}`),style:B(r.styles.bar,r.selectionColor?void 0:h.color)},S)}),L=ee(u,t.sets.addonPadding),k=c.map($=>{const E=L($),w=$.render({set:h,width:$.size,height:d,theme:r.theme});return w?f.createElement("g",{key:$.name,transform:`translate(${E},${b})`},w):null}).filter(Boolean);return k.length===0?N:f.createElement("g",{key:v},N,k)}))}const We=[],Vn=f.memo(function({size:t,data:r,style:s,hasHover:n,secondary:o,queries:a}){const i=t.sets.addons.some(l=>l.renderQuery!=null)||t.cs.addons.some(l=>l.renderQuery!=null),c=T.useMemo(()=>a.map(l=>Object.assign(Object.assign({},l),{overlap:$t(l,"intersection",r.toElemKey),elemOverlap:i?vt(l,"intersection",r.toElemKey):null})),[a,i,r.toElemKey]);function m(l,u,d,p,h){return Object.assign(Object.assign({},l),{render:y=>{const b=p(y.set);return l.renderQuery?l.renderQuery(Object.assign({query:u,overlap:b,index:d,secondary:h},y)):null}})}return f.createElement("g",{className:n&&!o?`pnone-${s.id}`:void 0},f.createElement("g",{transform:`translate(${t.sets.x},${t.sets.y})`},c.map((l,u)=>f.createElement(ct,{key:l.name,data:r,size:t,style:s,elemOverlap:l.overlap,suffix:`Q${u}-${r.id}`,secondary:o||u>0,tooltip:n&&!(o||u>0)?void 0:l.name,setAddons:t.sets.addons.length===0?We:t.sets.addons.map((d,p)=>m(d,l,p,l.elemOverlap,o||p>0))}))),f.createElement("g",{transform:`translate(${t.cs.x},${t.cs.y})`},c.map((l,u)=>f.createElement(lt,{key:l.name,data:r,size:t,style:s,elemOverlap:l.overlap,suffix:`Q${u}-${r.id}`,secondary:o||u>0,tooltip:n&&!(o||u>0)?void 0:l.name,combinationAddons:t.cs.addons.length===0?We:t.cs.addons.map((d,p)=>m(d,l,p,l.elemOverlap,o||p>0))}))))});function qn({data:e,size:t,style:r,selection:s}){if(!s||s.type!=="set"||!e.sets.keys.includes(e.toKey(s)))return null;const n=s;return f.createElement("rect",{y:e.sets.y(n),width:t.labels.w+t.cs.w+t.sets.after,height:e.sets.bandWidth,className:`selectionHint-${r.id}`})}function Gn({data:e,size:t,style:r,selection:s}){const n=e.sets.bandWidth/2,o=e.cs.cx,a=e.r,i=t.sets.h+t.sets.after,c=e.cs.bandWidth;if(!s||s.type==="set"||!e.cs)return null;const m=s,l=e.cs.keys.indexOf(e.toKey(m));return l<0?null:f.createElement("g",{transform:`translate(${t.labels.w+e.cs.x(m)}, 0)`,"data-upset":"cs-ss","data-i":l},f.createElement("rect",{width:c,height:i,className:`selectionHint-${r.id}`}),m.sets.size>1&&f.createElement("line",{x1:o,y1:e.sets.y(e.sets.v.find(u=>e.cs.has(m,u)))+n-(e.r-1),x2:o,y2:e.sets.y(e.sets.rv.find(u=>e.cs.has(m,u)))+n+(e.r-1),className:`upsetSelectionLine-${e.id}`,style:B(void 0,r.selectionColor?void 0:m.color,"stroke")}),e.sets.v.filter(u=>e.cs.has(m,u)).map(u=>f.createElement($e,{key:e.toKey(u),r:a*1.1,cx:o,cy:e.sets.y(u)+n,name:r.tooltips?u.name:"",className:A(`fillSelection-${r.id}`,`pnone-${r.id}`,r.classNames.dot),style:B(r.styles.dot,r.selectionColor?void 0:u.color)})))}const Ve=[];function Yn({size:e,data:t,style:r,selection:s,hasHover:n}){const o=r.emptySelection,a=Cn(s,t.overlapGuesser,t.toElemKey),i=it(s),c=e.sets.addons.some(u=>u.renderSelection!=null)||e.cs.addons.some(u=>u.renderSelection!=null),m=s&&typeof s!="function"&&c?wn(Array.isArray(s)?s:s.elems,t.toElemKey):null;function l(u){return Object.assign(Object.assign({},u),{render:d=>{const p=m?m(d.set):null;return u.renderSelection?u.renderSelection(Object.assign({selection:s,selectionColor:r.selectionColor||d.set.color||"orange",overlap:p},d)):null}})}return f.createElement("g",{className:n?`pnone-${r.id}`:void 0},(s||o)&&f.createElement(lt,{data:t,size:e,style:r,transform:`translate(${e.cs.x},${e.cs.y})`,empty:o&&!s,elemOverlap:a,suffix:`Selection-${r.id}`,tooltip:n?void 0:i,combinationAddons:e.cs.addons.length===0?Ve:e.cs.addons.map(l)}),(s||o)&&f.createElement(ct,{data:t,size:e,style:r,transform:`translate(${e.sets.x},${e.sets.y})`,empty:o&&!s,elemOverlap:a,suffix:`Selection-${r.id}`,tooltip:n?void 0:i,setAddons:e.sets.addons.length===0?Ve:e.sets.addons.map(l)}),f.createElement("g",{transform:`translate(${e.labels.x},${e.labels.y})`},De(s)&&f.createElement(qn,{data:t,size:e,style:r,selection:s}),De(s)&&f.createElement(Gn,{data:t,size:e,style:r,selection:s})))}function Y(e,t="font-size"){return e?`${t}: ${e};`:""}function Kn(e,t,r,s){const n=[];t.hasSelectionColor&&n.push(`fill: ${t.hasSelectionColor};`);const o=t.hasSelectionOpacity!=null&&t.hasSelectionOpacity>=0;return o&&n.push(`fill-opacity: ${t.hasSelectionOpacity};`),{p:Y,root:`
  .root-${e} {
    ${Y(r,"font-family")}
  }
  `,text:`
  .titleTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(s.title)}
  }
  .descTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(s.description)}
  }

  .legendTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(s.legend)}
    text-anchor: middle;
    dominant-baseline: hanging;
    pointer-events: none;
  }
  `,hasSFill:n.join(" "),hasSStroke:n.join(" ").replace("fill:","stroke:").replace("fill-","stroke-"),fill:`
  .fillPrimary-${e} { fill: ${t.color}; fill-opacity: ${t.opacity}; }
  .fillOverflow1-${e} { fill-opacity: ${t.opacity*ie[0]}; }
  .fillOverflow2-${e} { fill-opacity: ${t.opacity*ie[1]}; }
  ${n.length>0?`.root-${e}[data-selection] .fillPrimary-${e} { ${n.join(" ")} }`:""}
  ${o?`
      .root-${e}[data-selection] .fillOverflow1-${e} { fill-opacity: ${t.opacity*ie[0]}; }
      .root-${e}[data-selection] .fillOverflow2-${e} { fill-opacity: ${t.opacity*ie[1]}; }`:""}
  ${t.selectionColor?`.fillSelection-${e} { fill: ${t.selectionColor}; }`:""}
  .fillTransparent-${e} { fill: transparent; }

  .selectionHint-${e} {
    fill: transparent;
    pointer-events: none;
    ${Y(t.selectionColor,"stroke")}
  }
  .clickAble-${e} {
    cursor: pointer;
  }

  .startText-${e} {
    text-anchor: start;
  }
  .endText-${e} {
    text-anchor: end;
  }
  .pnone-${e} {
    pointer-events: none;
  }`,export:`
  .exportTextStyle-${e} {
    fill: ${t.textColor};
    ${Y(s.exportLabel)}
  }
  .exportButtons-${e} {
    text-anchor: middle;
  }
  .exportButton-${e} {
    cursor: pointer;
    opacity: 0.5;
  }
  .exportButton-${e}:hover {
    opacity: 1;
  }
  .exportButton-${e} > rect {
    fill: none;
    stroke: ${t.textColor};
  }
  `}}function Qn(e){const t=e.onClick;return T.useMemo(()=>({hasClick:t!=null,hasHover:e.onHover!=null,onClick:ce(t),onMouseEnter:ce(e.onHover),onContextMenu:ce(e.onContextMenu),onMouseLeave:e.onHover?r=>e.onHover(null,r.nativeEvent,[]):void 0,onMouseMove:ce(e.onMouseMove),reset:r=>t?t(null,r.nativeEvent,[]):null}),[t,e.onHover,e.onContextMenu,e.onMouseMove])}const Jn=f.forwardRef(function(t,r){var s;const n=st(t),{selection:o=null,queries:a=[],fontSizes:i}=n,c=T.useMemo(()=>n.id?n.id:Ae([n.fontFamily,i.axisTick,i.barLabel,i.chartLabel,i.legend,i.setLabel,i.title,i.exportLabel,i.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),[n.id,n.fontFamily,i.axisTick,i.barLabel,i.chartLabel,i.legend,i.setLabel,i.title,i.exportLabel,i.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),m=T.useMemo(()=>_n(n.theme,n.styles,n.classNames,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,c,n.barLabelOffset,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment),[n.theme,n.styles,n.classNames,n.barLabelOffset,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,c,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment]),l=T.useMemo(()=>Tn(n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding),[n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding]),u=T.useMemo(()=>Mn(n.sets,n.combinations,l,n.numericScale,n.bandScale,n.barLabelOffset+je(i.barLabel),n.dotPadding,n.barPadding,je(i.axisTick),n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale),[n.sets,n.combinations,l,n.numericScale,n.bandScale,n.barLabelOffset,i.barLabel,n.dotPadding,n.barPadding,i.axisTick,n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale]),d=Kn(c,n,n.fontFamily,i),p=Qn(n),h=`
  ${d.root}
  ${d.text}

  .axisTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.axisTick)}
    text-anchor: middle;
  }
  .barTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.barLabel)}
  }
  .cBarTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.barLabel)}
    text-anchor: middle;
  }
  .sBarTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.barLabel)}
    text-anchor: end;
    dominant-baseline: central;
  }
  .hoverBarTextStyle-${c} {
    ${d.p(i.barLabel)}
    fill: ${n.hoverHintColor};
    display: none;
    text-anchor: middle;
  }
  .setTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.setLabel)}
    text-anchor: ${kn(n.setLabelAlignment)};
    dominant-baseline: central;
  }
  .cChartTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.chartLabel)}
    text-anchor: middle;
  }
  .sChartTextStyle-${c} {
    fill: ${n.textColor};
    ${d.p(i.chartLabel)}
    text-anchor: middle;
    dominant-baseline: hanging;
  }

  ${d.fill}
  .fillNotMember-${c} { fill: ${n.notMemberColor}; }
  .fillAlternating-${c} { fill: ${n.alternatingBackgroundColor||"transparent"}; }

  .axisLine-${c} {
    fill: none;
    stroke: ${n.textColor};
  }
  .hoverBar-${c} {
    fill: transparent;
  }

  .interactive-${c}:hover > .hoverBar-${c} {
    stroke: ${n.hoverHintColor};
  }
  .interactive-${c}:hover > .hoverBarTextStyle-${c} {
    display: unset;
  }

  ${d.export}

  .upsetLine-${u.id} {
    stroke-width: ${u.r*.6};
    stroke: ${n.color};
    stroke-opacity: ${n.opacity};
  }
  ${d.hasSStroke?`.root-${c}[data-selection] .upsetLine-${u.id} { ${d.hasSStroke} }`:""}

  .upsetSelectionLine-${u.id} {
    stroke-width: ${u.r*.6*1.1};
    ${d.p(n.selectionColor,"stroke")}
    pointer-events: none;
  }

  ${a.map((v,x)=>`.fillQ${x}-${u.id} {
    fill: ${v.color};
  }`).join(`
`)}
  `,y=T.useCallback(v=>{const x=v.currentTarget.closest("svg"),g=v.currentTarget.dataset.type||"png";switch(g){case"vega":dn(x);break;case"dump":$n(x,t,u);break;case"share":vn(t,u);break;case"svg":case"png":un(x,{type:g,toRemove:`.${v.currentTarget.getAttribute("class")}`})}},[u,t]),b=it(o);return f.createElement("svg",{id:n.id,className:A(`root-${c}`,n.className),style:n.style,width:n.width,height:n.height,ref:r,viewBox:`0 0 ${n.width} ${n.height}`,"data-theme":(s=n.theme)!==null&&s!==void 0?s:"light","data-selection":b||void 0},n.styleFactory(h),f.createElement("defs",null,f.createElement("clipPath",{id:`clip-${l.id}`},f.createElement("rect",{x:l.sets.w,y:0,width:l.labels.w,height:l.sets.h}))),n.queryLegend&&f.createElement(Pn,{queries:a,x:l.legend.x,style:m,data:u}),f.createElement(In,{transform:`translate(${l.w-2},${l.h-3})`,styleId:c,exportButtons:n.exportButtons,exportChart:y}),f.createElement("g",{transform:`translate(${n.padding},${n.padding})`,"data-upset":"base"},n.onClick&&f.createElement("rect",{width:l.cs.x,height:l.sets.y,onClick:p.reset,className:`fillTransparent-${c}`}),f.createElement(Rn,{size:l,style:m,data:u}),f.createElement(Wn,{size:l,style:m,data:u,h:p,setChildrenFactory:n.setChildrenFactory,combinationChildrenFactory:n.combinationChildrenFactory}),f.createElement(Yn,{size:l,style:m,data:u,hasHover:p.hasHover,selection:o}),f.createElement(Vn,{size:l,style:m,data:u,hasHover:p.hasHover,queries:a,secondary:n.onHover!=null||o!=null})),t.children)}),K=5,Xn=Math.floor(Ge.length/K);function Zn(e,t){let r=[];const s=[];let n=-1;e%2===0?(r=Ge,n=e*K):(r=Ye,n=(e-1)*K);const o=[];for(let a=0;a<t;a++){const i=a%(K*2)<2||a%(K*2)>7?"white":"black",c=r[(n+a)%r.length];o.push(c),s.push(i)}return{colorPalette:o,textColors:s}}function mr(e,t,r){let s=[];s=Ye;const n=[];for(let o=0;o<r;o++){const a=o*K,i=(t+Math.floor(o/Xn))%K,c=s[(a+i)%s.length];n.push(c)}return n}const qe=({sql:e,rgbIndex:t,maxBarCount:r,setName:s,combinationName:n,height:o=700,summaryLinkText:a,summaryLink:i,onClick:c})=>{const{accessToken:m}=ft(),[l,u]=T.useState(),[d,p]=T.useState(),[h,y]=T.useState(),[b,v]=T.useState(null),{colorPalette:x}=Zn(t,2),g={setLabel:"14px"};return T.useEffect(()=>{let S=!1;return(async()=>{u(!0);try{const L=pt(e),$={partMask:ht,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:L,query:{sql:e}},{queryResult:E}=await dt.getFullQueryTableResults($,m),w={},_={};for(const P of(E==null?void 0:E.queryResults.rows)??[])for(let U=1;U<P.values.length;U+=1){const C=P.values;C.some(F=>F===null)&&console.warn("Row has null value(s) when no nulls expected");const O=C[0];let j=C[U];w[O]=w[O]||{},w[O].name=O,w[O].sets=w[O].sets||[],!w[O].sets.find(F=>F==j)&&j&&(_[j.toUpperCase()]?j=_[j.toUpperCase()]:_[j.toUpperCase()]=j,w[O].sets.push(j))}const I=Object.values(w),D=Tt(I),H=D.sort((P,U)=>(""+U.name).localeCompare(P.name)),R=Ze(H,{type:"intersection",min:1,limit:r,order:"cardinality:desc"});S||(p({sets:D,combinations:R}),u(!1))}catch(L){if(!S){u(!1);let k=L.reason;k||(console.error(L),k="Error retrieving data"),y(k)}}})(),()=>{S=!0}},[e,m]),G.jsxs(G.Fragment,{children:[l&&gt,!l&&d&&G.jsx(yt.SizeMe,{children:({size:S})=>G.jsxs("div",{className:"UpsetPlot",children:[G.jsx(Jn,{sets:d.sets,combinations:d.combinations,width:S.width,height:o,onHover:v,onClick:c,selection:b,color:x[0],selectionColor:x[0],hasSelectionOpacity:.3,setName:s==null?void 0:s.toUpperCase(),combinationName:n==null?void 0:n.toUpperCase(),fontFamily:"'DM Sans', sans-serif",fontSizes:g,exportButtons:!1,notMemberColor:"transparent"}),i&&a&&G.jsx("div",{className:"UpsetPlot__summary",children:G.jsx(bt,{color:"secondary",variant:"contained",href:i,children:a})})]})}),G.jsx(mt,{error:h})]})};try{qe.displayName="UpsetPlot",qe.__docgenInfo={description:`Upset plot.  See https://medium.com/@sgratzl/upset-js-javascript-tutorial-1b84bfd6896d
Currently this is driven by a Synapse Table/View, but we may want to alter it to read in the data from a flat file instead.`,displayName:"UpsetPlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!0,type:{name:"number"}},maxBarCount:{defaultValue:null,description:"",name:"maxBarCount",required:!1,type:{name:"number"}},setName:{defaultValue:null,description:"",name:"setName",required:!1,type:{name:"string"}},combinationName:{defaultValue:null,description:"",name:"combinationName",required:!1,type:{name:"string"}},height:{defaultValue:{value:"700"},description:"",name:"height",required:!1,type:{name:"number"}},summaryLinkText:{defaultValue:null,description:"",name:"summaryLinkText",required:!1,type:{name:"string"}},summaryLink:{defaultValue:null,description:"",name:"summaryLink",required:!1,type:{name:"string"}}}}}catch{}export{qe as U,mr as a,Zn as g};
