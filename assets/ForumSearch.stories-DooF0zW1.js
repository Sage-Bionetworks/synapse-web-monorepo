import{at as C,r as o,j as e,V,c1 as P,ar as T,X as m,dQ as D,dP as M,js as k,jt as A,ju as q,jv as b,jw as L,cA as $,J as B,c6 as K,br as G,B as z}from"./iframe-DgbfDeQR.js";import{N as H}from"./NoSearchResults-BdkDNT9D.js";import{u as J}from"./useEntity-BDtI3FCk.js";import{c as Q}from"./useForum-DHOqJDaU.js";import{S as X}from"./Search-C_Fo__wV.js";import{S as Y}from"./SkeletonParagraph-BtYiDY2A.js";import{U as W}from"./UserBadge-DT_nDzPV.js";import{I as F}from"./InputAdornment-CbYV-FLf.js";import"./index-r8ZA1smB.js";import"./pickBy-DN8TTyGb.js";import"./isString-BRpTpojV.js";import"./_baseIteratee-CiKc5xq1.js";import"./useQueries-6GpUHBte.js";import"./queryOptions-C9woPjwX.js";import"./useInfiniteQuery-DkLtRlOU.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-B6xeIF8B.js";import"./SkeletonTable-CkIMw70Y.js";import"./MenuItem-kceyAJzH.js";import"./Card-Bp2w-evW.js";import"./Chip-D6WFZ5Ud.js";const N=async r=>(await fetch(r,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=r=>{const{threadId:p,replyId:n}=r,{accessToken:i}=C(),[s,R]=o.useState(),[h,y]=o.useState(""),[t,x]=o.useState(),[g,j]=o.useState(),[I,S]=o.useState(!1);o.useEffect(()=>{(async()=>{let c;S(!0);const d=await k(p,i);if(n){const l=await A(n,i);c=await q(l.messageKey,i),j(await b(l.createdBy)),x(l)}else j(await b(d.createdBy)),c=await L(d.messageKey,i);y(await N(c.messageUrl)),R(d),S(!1)})()},[i,n,p]);const f=(u,c,d)=>{let l=`${$.PORTAL}Synapse:${c}/discussion/threadId=${u}`;return d&&(l+=`&replyId=${d}`),l};return e.jsx("div",{className:"search-result-container",children:e.jsxs(V,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:I?e.jsx(P,{variant:"circular",width:"30px",height:"30px"}):n?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:I?e.jsx(Y,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:f(s==null?void 0:s.id,s==null?void 0:s.projectId,t==null?void 0:t.id),children:s==null?void 0:s.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[n?"Reply":"Thread"," by"," ",e.jsx(W,{userId:g==null?void 0:g.ownerId})," ",D(M(t==null?void 0:t.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const Z=()=>e.jsxs(V,{sx:{textAlign:"center"},children:[e.jsx(H,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),w=r=>{const{onSearchResultsVisible:p}=r,[n,i]=o.useState(""),[s,R]=o.useState(""),[h,y]=o.useState(!1),{data:t}=J(r.projectId,void 0,{enabled:!!r.projectId}),{data:x,isLoading:g,hasNextPage:j,isFetchingNextPage:I,fetchNextPage:S,error:f}=Q(r.forumId,{searchString:s},{enabled:!!s});o.useEffect(()=>{f&&B(f.reason,"danger")},[f]);const u=(x==null?void 0:x.pages.flatMap(a=>a.matches??[]))??[],c=!g&&s&&u.length==0,d=()=>{y(!1),i("")};function l(){R(n),y(!0)}return o.useEffect(()=>{p&&p(h)},[h,p]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(K,{sx:a=>({[a.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:n,onChange:a=>{i(a.target.value)},onKeyDown:a=>{a.key==="Enter"&&l()},slotProps:{input:{startAdornment:e.jsx(F,{position:"start",children:e.jsx(X,{})}),endAdornment:n&&e.jsx(F,{position:"end",children:e.jsx(G,{size:"small",onClick:()=>{d()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[c&&e.jsxs(e.Fragment,{children:[r.projectId&&t&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',s,'" in ',t==null?void 0:t.name]}),e.jsx(Z,{})]}),u&&e.jsxs(e.Fragment,{children:[r.projectId&&!c&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',s,'" in ',t==null?void 0:t.name,":"]}),u.map(a=>e.jsx("div",{children:e.jsx(v,{threadId:a.threadId,replyId:a.replyId})},`${a.forumId}-${a.threadId}-${a.replyId}`))]}),j&&e.jsx(z,{variant:"contained",color:"primary",disabled:I,onClick:()=>{S()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{w.displayName="ForumSearch",w.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:ee}=__STORYBOOK_MODULE_TEST__,_e={title:"Synapse/ForumSearch",component:w},_={args:{forumId:"1032",onSearchResultsVisible:ee()}};var O,E,U;_.parameters={..._.parameters,docs:{...(O=_.parameters)==null?void 0:O.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...(U=(E=_.parameters)==null?void 0:E.docs)==null?void 0:U.source}}};const Re=["Demo"];export{_ as Demo,Re as __namedExportsOrder,_e as default};
