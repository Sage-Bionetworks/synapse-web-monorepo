import{r as R,eG as O,j as e,az as B,a2 as k,Y as c,ah as M,dZ as P,bY as V,ax as D,c7 as G,am as U,Z as Y}from"./iframe-CKbLOTsP.js";import{S as W}from"./immutable.es-C7Y1z7XT.js";import{C as Q}from"./ConfirmationDialog-Cpo9FRDD.js";import{F as z}from"./FormControlLabel-CcttKXCu.js";import{C as X}from"./Checkbox-7g56acu5.js";const w="category",J="category email prompt",Z="rejection reason",K="email text";function $(i){const{category:u,rows:l,selectedRowIds:o,setSelectedRowIds:m,rejectionReasonFormTextIndex:a,initialIsExpanded:h=!1}=i,[d,y]=R.useState(h);return e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"body1",onClick:()=>y(!d),sx:{fontWeight:700,cursor:"pointer",my:1},children:[e.jsx(U,{icon:d?"expandMore":"chevronRight",sx:{color:"grey.700"},wrap:!1}),u]}),e.jsx(Y,{in:d,children:e.jsx(M,{sx:{ml:3},children:(l??[]).map(s=>e.jsx(z,{control:e.jsx(X,{checked:o.has(s.rowId),size:"small",onChange:n=>{n.target.checked?m(o.add(s.rowId)):m(o.remove(s.rowId))}}),label:e.jsx(c,{variant:"smallText1",children:s.values[a]})},s.rowId))})})]})}function H(i){const{tableQuery:u,selectedRowIds:l,setSelectedRowIds:o,rejectionFormPromptCopy:m}=i,{data:a,isLoading:h,error:d}=u,y=a?.queryResult?.queryResults.headers.findIndex(r=>r.name.toLowerCase()===w),s=a?.queryResult?.queryResults.headers.findIndex(r=>r.name.toLowerCase()===Z),n=a&&a.queryResult&&a.queryResult.queryResults.rows.reduce((r,g)=>{const j=g.values[y];return r[j]=[...r[j]||[],g],r},{});return e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"headline3",gutterBottom:!0,children:"Reasons for rejecting"}),m&&e.jsx(c,{variant:"body1",gutterBottom:!0,children:m}),h&&e.jsx(M,{sx:{my:2},children:e.jsx(P,{size:30})}),d&&e.jsx(V,{error:d}),n&&e.jsx(D,{children:Object.keys(n).map(r=>e.jsx($,{category:r,rows:n[r],selectedRowIds:l,setSelectedRowIds:o,rejectionReasonFormTextIndex:s,initialIsExpanded:Object.keys(n).length===1},r))}),e.jsx(c,{variant:"headline3",sx:{mt:1},gutterBottom:!0,children:"We’ll generate a response email message based on your selections."}),e.jsx(c,{variant:"body1",gutterBottom:!0,children:"If your reasons for rejecting are not shown here, that’s okay! You can edit the complete text of the message on the next screen before sending it."})]})}function ee(i){const{emailText:u,setEmailText:l}=i;return e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"headline3",gutterBottom:!0,children:"Edit the text of the rejection message"}),e.jsx(c,{variant:"body1",gutterBottom:!0,children:"This message will be sent to the requester. You may edit it, or add custom text to the message."}),e.jsx(G,{multiline:!0,fullWidth:!0,rows:15,value:u,onChange:o=>{l(o.target.value)}})]})}function _(i){const{open:u,tableId:l,onClose:o,onConfirm:m,defaultMessagePrefix:a="",defaultMessageAppend:h="",rejectionFormPromptCopy:d,children:y,error:s}=i,[n,r]=R.useState(1),[g,j]=R.useState(""),[I,v]=R.useState(W()),T=O({entityId:l,query:{sql:`SELECT * FROM ${l}`},partMask:k,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:x}=T,S=x?.queryResult?.queryResults.headers.findIndex(t=>t.name.toLowerCase()===w),F=x?.queryResult?.queryResults.headers.findIndex(t=>t.name.toLowerCase()===J),N=x?.queryResult?.queryResults.headers.findIndex(t=>t.name.toLowerCase()===K),C=x&&x.queryResult&&I.reduce((t,E)=>{const f=x.queryResult.queryResults.rows.find(L=>L.rowId===E),p=f.values[S],A=f.values[F],b=f.values[N];return t[p]?t[p].reasons=[...t[p].reasons,b]:t[p]={sectionText:A,reasons:[b]},t},{}),q=C&&a+Object.keys(C).reduce((t,E)=>{t+=`
`;const f=C[E].sectionText;f&&(t+=f+`
`);for(const p of C[E].reasons)p!=null&&(t+=`
* `+p.replaceAll("\\n",`
`)+`
`);return t},"")+h;return R.useEffect(()=>{q&&j(q)},[I]),e.jsx(Q,{open:u,onCancel:()=>{n===1&&o(),n===2&&r(1)},maxWidth:"md",fullWidth:!0,title:"Reject Request?",content:e.jsxs(e.Fragment,{children:[n===1&&e.jsx(H,{tableQuery:T,selectedRowIds:I,setSelectedRowIds:v,rejectionFormPromptCopy:d}),n===2&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{emailText:g,setEmailText:j}),y]}),s&&e.jsx(B,{variant:"danger",description:s.reason,isGlobal:!1})]}),onConfirm:()=>{n===1&&r(2),n===2&&m(g)},confirmButtonProps:{children:n===1?"Generate Email":"Reject and Notify Requester"},cancelButtonProps:{children:n===1?"Cancel":"Back"}})}try{_.displayName="CannedRejectionDialog",_.__docgenInfo={description:`Modal component presented to a data access submission reviewer when they decide to reject a request.
The modal contains a form for selecting rejection reasons and a text field for editing the rejection message.
After crafting a message, the user can reject the submission and send the message to the requester.`,displayName:"CannedRejectionDialog",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},tableId:{defaultValue:null,description:"",name:"tableId",required:!0,type:{name:"string"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"(message: string) => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},defaultMessagePrefix:{defaultValue:null,description:"Text injected into the beginning of the email template",name:"defaultMessagePrefix",required:!1,type:{name:"string"}},defaultMessageAppend:{defaultValue:null,description:"Text appended onto the end of the email template",name:"defaultMessageAppend",required:!1,type:{name:"string"}},rejectionFormPromptCopy:{defaultValue:null,description:"Text to display above the canned rejection reasons",name:"rejectionFormPromptCopy",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Error to display, in case one occurred in the callback to `onReject`",name:"error",required:!0,type:{name:"any"}},children:{defaultValue:null,description:"Optional children, can be used to extend the form as needed on step 2",name:"children",required:!1,type:{name:"ReactNode"}}}}}catch{}export{_ as C};
