import{j as A}from"./jsx-runtime-D_zvdyIk.js";import{l as o,S as x,am as _}from"./useFiles-C8pQ42sC.js";import"./VerificationSubmission-DHtRxRPZ.js";import"./StringUtils-DP1EOPFU.js";import"./OrientationBanner-CCfEbiwH.js";import{r as y}from"./index-d3rqgMCN.js";import{i as q}from"./isEqual-BafHoWgl.js";import{u as L}from"./useQuery-DYyOnCTL.js";import{u as C}from"./QueryClientProvider-BFF2BFJZ.js";import{u as m}from"./useMutation-DZbu7UUC.js";import{u as Q}from"./useInfiniteQuery-DEoQTEUr.js";import{A as T}from"./AclEditor-I7Mqgsx9.js";import{u as F}from"./useUpdateAcl-Dpiw-JcQ.js";import{c as R,u as K}from"./AccessControlListUtils-COMe5mhA.js";import{S as k}from"./Stack-D_7wB_A8.js";import{A as P}from"./Alert-BzUj_4eQ.js";function ne(e){const{synapseClient:s,keyFactory:r}=o();return Q({...e,queryKey:r.getMyOAuthClientsQueryKey(),queryFn:async n=>await s.openIDConnectServicesClient.getAuthV1Oauth2Client({nextPageToken:n.pageParam}),initialPageParam:void 0,getNextPageParam:n=>n.nextPageToken})}function se(e){const s=C(),{accessToken:r,keyFactory:n}=o();return m({...e,mutationFn:t=>x.deleteOAuthClient(t,r),onSuccess:async(t,i,u)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),e!=null&&e.onSuccess&&await e.onSuccess(t,i,u)}})}function re(e){const s=C(),{synapseClient:r,keyFactory:n}=o();return m({...e,mutationFn:t=>r.openIDConnectServicesClient.putAuthV1Oauth2ClientId({id:t.client_id,oAuthClient:t}),onSuccess:async(t,i,u)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),e!=null&&e.onSuccess&&await e.onSuccess(t,i,u)}})}function ue(e){const s=C(),{synapseClient:r,keyFactory:n}=o();return m({...e,mutationFn:t=>r.openIDConnectServicesClient.postAuthV1Oauth2Client({oAuthClient:t}),onSuccess:async(t,i,u)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),e!=null&&e.onSuccess&&await e.onSuccess(t,i,u)}})}function D(e,s){const{synapseClient:r,keyFactory:n}=o();return L({...s,queryKey:n.getOAuthClientAclQueryKey(e),queryFn:()=>r.openIDConnectServicesClient.getAuthV1Oauth2ClientIdAcl({id:e})})}function N(e){const s=C(),{synapseClient:r,keyFactory:n}=o();return m({...e,mutationFn:t=>r.openIDConnectServicesClient.putAuthV1Oauth2ClientIdAcl({id:t.id,accessControlList:t}),onSuccess:async(t,i,u)=>{const d=n.getOAuthClientAclQueryKey(t.id);if(s.setQueryData(d,t),e!=null&&e.onSuccess)return await e.onSuccess(t,i,u)}})}const w=["CAN_ADMINISTER_OAUTH_CLIENT"],p=y.forwardRef(function(s,r){const{clientId:n,onSaveComplete:t}=s,[i,u]=y.useState(null),d=()=>{u(null),t(!0)},S=a=>{u(a.reason),t(!1)},{data:c,isLoading:I}=D(n,{staleTime:1/0}),{resourceAccessList:l,setResourceAccessList:f,addResourceAccessItem:O,updateResourceAccessItem:g,removeResourceAccessItem:v,resetDirtyState:E}=F({onChange:()=>u(null),onError:u});y.useEffect(()=>{c&&(E(),f(R(c.resourceAccess)))},[c,f]);const{mutate:h}=N({onSuccess:()=>d(),onError:a=>S(a)});return y.useImperativeHandle(r,()=>({save(){const a=K(c,l);c===null&&a==null||q(c==null?void 0:c.resourceAccess,l)&&(c==null?void 0:c.id)===(a==null?void 0:a.id)?t(!0):h(a)}}),[n,c,l,t,h]),A.jsxs(k,{direction:"column",sx:{gap:"20px"},children:[A.jsx(T,{resourceAccessList:l,availablePermissionLevels:w,isLoading:I,canEdit:!0,emptyText:"",onAddPrincipalToAcl:a=>O(a,_("CAN_ADMINISTER_OAUTH_CLIENT")),updateResourceAccessItem:g,removeResourceAccessItem:v,showAddRemovePublicButton:!1,showNotifyCheckbox:!1,isInherited:!1}),i&&A.jsx(P,{severity:"error",children:i})]})});try{p.displayName="OAuthClientAclEditor",p.__docgenInfo={description:"",displayName:"OAuthClientAclEditor",props:{clientId:{defaultValue:null,description:"",name:"clientId",required:!0,type:{name:"string"}},onSaveComplete:{defaultValue:null,description:"",name:"onSaveComplete",required:!0,type:{name:"(saveSuccessful: boolean) => void"}}}}}catch{}export{p as O,re as a,se as b,ne as c,ue as u};
