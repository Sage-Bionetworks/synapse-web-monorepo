import{r as u,eG as F,$ as b,aa as m,j as e,B as h}from"./iframe-DCJ7skCF.js";import{F as R,v as D}from"./index-CeSsztJl.js";import"./enums-_3bGLgvO.js";import"./index-Chi_LkuB.js";import{D as T}from"./DialogBase-DG8iPOdE.js";import{S as j,a as I,b as _}from"./SynapseFormRadioWidget-DeTODgU2.js";const i="First line is the columns names.",l="Include row metadata (Row Id and Row Version).",s="Comma Separated Values (CSV)",y="Tab Separated Values (TSV)",v={type:"object",properties:{"File Type":{type:"string",oneOf:[{const:s,title:s},{const:y,title:y}]},Contents:{type:"array",title:"Contents",items:{type:"string",enum:[i,l]},uniqueItems:!0}}},V={"File Type":{"ui:widget":"radio"},Contents:{"ui:widget":"checkboxes"}},k={description:"File is ready for download. Select the download button to download the file.",type:"object"},B={},L=[v,k],E=[V,B];class n extends u.Component{static contextType=F;constructor(t){super(t),this.state={isLoading:!1,step:0,formData:{"File Type":s,Contents:[i,l]}}}handleSubmit=t=>{this.state.step===0?this.handleDownloadSetup(t):this.onDownload()};handleDownloadSetup=t=>{this.setState({isLoading:!0});const{formData:o}=t,f=o["File Type"],c=o.Contents,{queryBundleRequest:g,getLastQueryRequest:w}=this.props,x=f===s?",":"	",S=c.includes(i),q=c.includes(l),a=g??w(),p=a.query.sql,C={sql:p,entityId:b(p),selectedFacets:a.query.selectedFacets,concreteType:"org.sagebionetworks.repo.model.table.DownloadFromTableRequest",writeHeader:S,includeRowIdAndRowVersion:q,csvTableDescriptor:{separator:x},additionalFilters:a.query.additionalFilters};m.createTableCsvForDownload(C,this.context.accessToken).then(r=>{this.setState({isLoading:!1,step:1,data:r})}).catch(r=>{console.log("Error getDownloadFromTableRequest: ",r)})};onDownload=()=>{const{data:t}=this.state;m.getFileHandleByIdURL(t.resultsFileHandleId,this.context.accessToken).then(o=>{window.location.href=o,this.props.onClose()})};handleChange=t=>{const{formData:o}=t;this.setState({formData:o})};render(){const t={height:50,width:50,backgroundSize:50};return e.jsx(T,{open:!0,onCancel:this.props.onClose,title:"Download query results",content:e.jsx(e.Fragment,{children:e.jsxs(R,{validator:D,id:"modal-download-form",schema:L[this.state.step],uiSchema:E[this.state.step],onChange:this.handleChange,formData:this.state.formData,onSubmit:this.handleSubmit,widgets:{CheckboxWidget:_,CheckboxesWidget:I,RadioWidget:j},children:[this.state.isLoading&&e.jsx("div",{className:"SRC-centerAndJustifyContent",children:e.jsxs("div",{className:"SRC-center-text",children:[e.jsx("p",{children:" Creating the File "}),e.jsx("div",{style:t,className:"spinner"}),e.jsx("p",{children:" Loading... "})]})}),e.jsx(u.Fragment,{})]})}),actions:e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"outlined",color:"primary",onClick:this.props.onClose,children:"Cancel"}),e.jsx(h,{form:"modal-download-form",type:"submit",variant:"contained",color:"primary",children:this.state.step===0?"Next":"Download"})]})})}}try{n.displayName="ModalDownload",n.__docgenInfo={description:"",displayName:"ModalDownload",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(...args: any[]) => void"}},includeEntityEtag:{defaultValue:null,description:"",name:"includeEntityEtag",required:!1,type:{name:"boolean"}},queryBundleRequest:{defaultValue:null,description:"",name:"queryBundleRequest",required:!1,type:{name:"QueryBundleRequest"}},getLastQueryRequest:{defaultValue:null,description:"",name:"getLastQueryRequest",required:!1,type:{name:"() => QueryBundleRequest"}},offset:{defaultValue:null,description:"",name:"offset",required:!1,type:{name:"number"}},limit:{defaultValue:null,description:"",name:"limit",required:!1,type:{name:"number"}},sort:{defaultValue:null,description:"",name:"sort",required:!1,type:{name:"SortItem[]"}}}}}catch{}try{n.contextType.displayName="ModalDownload.contextType",n.contextType.__docgenInfo={description:"If set, `this.context` will be set at runtime to the current value of the given Context.",displayName:"ModalDownload.contextType",props:{}}}catch{}export{n as M};
