var J=r=>{throw TypeError(r)};var K=(r,t,e)=>t.has(r)||J("Cannot "+e);var s=(r,t,e)=>(K(r,t,"read from private field"),e?e.call(r):t.get(r)),c=(r,t,e)=>t.has(r)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),l=(r,t,e,i)=>(K(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e),u=(r,t,e)=>(K(r,t,"access private method"),e);import{r as E}from"./index-DWtRjqxE.js";import{R as Z,c as _,n as A,S as $,b as tt,h as V,u as st,a as et,d as it}from"./QueryClientProvider-CUCt5UMY.js";var d,n,O,p,v,W,ut=(W=class extends Z{constructor(t){super();c(this,p);c(this,d);c(this,n);c(this,O);this.mutationId=t.mutationId,l(this,n,t.mutationCache),l(this,d,[]),this.state=t.state||Y(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){s(this,d).includes(t)||(s(this,d).push(t),this.clearGcTimeout(),s(this,n).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){l(this,d,s(this,d).filter(e=>e!==t)),this.scheduleGc(),s(this,n).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){s(this,d).length||(this.state.status==="pending"?this.scheduleGc():s(this,n).remove(this))}continue(){var t;return((t=s(this,O))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var g,f,C,R,S,m,M,D,F,T,U,I,j,q,L,N,Q,z,B,H;const e=()=>{u(this,p,v).call(this,{type:"continue"})};l(this,O,_({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(o,P)=>{u(this,p,v).call(this,{type:"failed",failureCount:o,error:P})},onPause:()=>{u(this,p,v).call(this,{type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>s(this,n).canRun(this)}));const i=this.state.status==="pending",h=!s(this,O).canStart();try{if(i)e();else{u(this,p,v).call(this,{type:"pending",variables:t,isPaused:h}),await((f=(g=s(this,n).config).onMutate)==null?void 0:f.call(g,t,this));const P=await((R=(C=this.options).onMutate)==null?void 0:R.call(C,t));P!==this.state.context&&u(this,p,v).call(this,{type:"pending",context:P,variables:t,isPaused:h})}const o=await s(this,O).start();return await((m=(S=s(this,n).config).onSuccess)==null?void 0:m.call(S,o,t,this.state.context,this)),await((D=(M=this.options).onSuccess)==null?void 0:D.call(M,o,t,this.state.context)),await((T=(F=s(this,n).config).onSettled)==null?void 0:T.call(F,o,null,this.state.variables,this.state.context,this)),await((I=(U=this.options).onSettled)==null?void 0:I.call(U,o,null,t,this.state.context)),u(this,p,v).call(this,{type:"success",data:o}),o}catch(o){try{throw await((q=(j=s(this,n).config).onError)==null?void 0:q.call(j,o,t,this.state.context,this)),await((N=(L=this.options).onError)==null?void 0:N.call(L,o,t,this.state.context)),await((z=(Q=s(this,n).config).onSettled)==null?void 0:z.call(Q,void 0,o,this.state.variables,this.state.context,this)),await((H=(B=this.options).onSettled)==null?void 0:H.call(B,void 0,o,t,this.state.context)),o}finally{u(this,p,v).call(this,{type:"error",error:o})}}finally{s(this,n).runNext(this)}}},d=new WeakMap,n=new WeakMap,O=new WeakMap,p=new WeakSet,v=function(t){const e=i=>{switch(t.type){case"failed":return{...i,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...i,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:t.error,failureCount:i.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),A.batch(()=>{s(this,d).forEach(i=>{i.onMutationUpdate(t)}),s(this,n).notify({mutation:this,type:"updated",action:t})})},W);function Y(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var x,w,a,y,b,G,k,X,rt=(X=class extends ${constructor(t,e){super();c(this,b);c(this,x);c(this,w);c(this,a);c(this,y);l(this,x,t),this.setOptions(e),this.bindMethods(),u(this,b,G).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const e=this.options;this.options=s(this,x).defaultMutationOptions(t),tt(this.options,e)||s(this,x).getMutationCache().notify({type:"observerOptionsUpdated",mutation:s(this,a),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&V(e.mutationKey)!==V(this.options.mutationKey)?this.reset():((i=s(this,a))==null?void 0:i.state.status)==="pending"&&s(this,a).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=s(this,a))==null||t.removeObserver(this)}onMutationUpdate(t){u(this,b,G).call(this),u(this,b,k).call(this,t)}getCurrentResult(){return s(this,w)}reset(){var t;(t=s(this,a))==null||t.removeObserver(this),l(this,a,void 0),u(this,b,G).call(this),u(this,b,k).call(this)}mutate(t,e){var i;return l(this,y,e),(i=s(this,a))==null||i.removeObserver(this),l(this,a,s(this,x).getMutationCache().build(s(this,x),this.options)),s(this,a).addObserver(this),s(this,a).execute(t)}},x=new WeakMap,w=new WeakMap,a=new WeakMap,y=new WeakMap,b=new WeakSet,G=function(){var e;const t=((e=s(this,a))==null?void 0:e.state)??Y();l(this,w,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},k=function(t){A.batch(()=>{var e,i,h,g,f,C,R,S;if(s(this,y)&&this.hasListeners()){const m=s(this,w).variables,M=s(this,w).context;(t==null?void 0:t.type)==="success"?((i=(e=s(this,y)).onSuccess)==null||i.call(e,t.data,m,M),(g=(h=s(this,y)).onSettled)==null||g.call(h,t.data,null,m,M)):(t==null?void 0:t.type)==="error"&&((C=(f=s(this,y)).onError)==null||C.call(f,t.error,m,M),(S=(R=s(this,y)).onSettled)==null||S.call(R,void 0,t.error,m,M))}this.listeners.forEach(m=>{m(s(this,w))})})},X);function ht(r,t){const e=st(),[i]=E.useState(()=>new rt(e,r));E.useEffect(()=>{i.setOptions(r)},[i,r]);const h=E.useSyncExternalStore(E.useCallback(f=>i.subscribe(A.batchCalls(f)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),g=E.useCallback((f,C)=>{i.mutate(f,C).catch(et)},[i]);if(h.error&&it(i.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:g,mutateAsync:h.mutate}}export{ut as M,ht as u};
