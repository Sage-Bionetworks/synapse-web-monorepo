import{j as e}from"./jsx-runtime-3KUIpe_B.js";import{l as h,S as E,k as _,t as Q}from"./useFiles-BUTSDjpp.js";import"./OrientationBanner-hPZ43e6I.js";import{r as d}from"./index-DKQmXyTg.js";import{S as w}from"./fetchWithExponentialTimeout-Cpvpsfq8.js";import"./VerificationSubmission-dxY1kvC5.js";import"./StringUtils-lE31obNl.js";import{u as C}from"./useQuery-B7kP4S9m.js";import{u as v,A as b}from"./ActionRequiredListItem-NDrxy01G.js";import{u as q}from"./QueryContext-iEUUu-aU.js";import{H as j}from"./HelpPopover-BMtlHCIC.js";import{u as k}from"./QueryWrapper-CZl3Cwg-.js";import{I}from"./IconSvg-Bda0zwsA.js";import{C as A}from"./Collapse-DgDuu3nh.js";import{T as V}from"./TextField-3pjgqPrw.js";function T(t,o){const{accessToken:s,keyFactory:r}=h();return C({...o,queryKey:r.getEntityActionsRequiredQueryKey(t),queryFn:()=>E.getEntityDownloadActionsRequired(t,s)})}function y(t){const{entityId:o,onViewSharingSettingsClicked:s}=t,{data:r}=T(o),l=r==null?void 0:r.actions,i=v(r==null?void 0:r.actions);return e.jsx(e.Fragment,{children:l&&l.length>0&&e.jsx("div",{className:"EntityActionsRequired",children:i.map((u,a)=>u?e.jsx(b,{action:u,onViewSharingSettingsClicked:s},a):!1)})})}try{y.displayName="EntityActionsRequired",y.__docgenInfo={description:"",displayName:"EntityActionsRequired",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},onViewSharingSettingsClicked:{defaultValue:null,description:"",name:"onViewSharingSettingsClicked",required:!1,type:{name:"(benefactorId: string) => void"}}}}}catch{}const R="The data within tables and views can be retrieved by using a SQL-like query language either from the web interface or from the programmatic clients.",B="https://help.synapse.org/docs/Querying-Tables,-Views,-and-Datasets.2667642897.html#QueryingTables,Views,andDatasets-UsingAdvancedSearchQueries";function m({helpMessage:t=R,helpUrl:o=B,resetErrorBoundary:s}){const{executeQueryRequest:r,getCurrentQueryRequest:l}=q(),{showSqlEditor:i}=k(),[u,a]=d.useState(""),p=d.useRef(null),f=d.useMemo(()=>l(),[l]);d.useEffect(()=>{var c;if(i){const n=f.query.sql;a(n),(c=p.current)==null||c.focus()}},[i,f]);const x=c=>{c.preventDefault(),s&&s(),r(n=>(n.query.sql=u,n.query.offset=0,n.query.additionalFilters=[],n.query.selectedFacets=[],n))},S=c=>{var n;(n=p.current)==null||n.setCustomValidity(""),a(c.currentTarget.value)};return e.jsx("div",{className:"QueryWrapperSqlEditorInput",children:e.jsx(A,{in:i,timeout:{enter:300,exit:300},children:e.jsx("form",{onSubmit:x,children:e.jsx(V,{inputProps:{ref:p},sx:{width:"100%"},InputProps:{startAdornment:e.jsx(I,{icon:"search",wrap:!1,sx:{mr:1,color:"grey.600"}}),endAdornment:e.jsx(j,{markdownText:t,helpUrl:o,placement:"right"})},onChange:S,placeholder:"Enter Query",value:u,type:"text"})})})})}try{m.displayName="SqlEditor",m.__docgenInfo={description:"",displayName:"SqlEditor",props:{helpMessage:{defaultValue:{value:"The data within tables and views can be retrieved by using a SQL-like query language either from the web interface or from the programmatic clients."},description:"",name:"helpMessage",required:!1,type:{name:"string"}},helpUrl:{defaultValue:{value:"https://help.synapse.org/docs/Querying-Tables,-Views,-and-Datasets.2667642897.html#QueryingTables,Views,andDatasets-UsingAdvancedSearchQueries"},description:"",name:"helpUrl",required:!1,type:{name:"string"}},resetErrorBoundary:{defaultValue:null,description:"",name:"resetErrorBoundary",required:!1,type:{name:"(...args: unknown[]) => void"}}}}}catch{}function g({children:t}){const{getCurrentQueryRequest:o,onViewSharingSettingsClicked:s}=q(),{entityId:r}=d.useMemo(()=>o(),[o]),{accessToken:l}=h(),i=!!l,u=d.useCallback(a=>a.error instanceof w&&a.error.status===403&&i?e.jsx("div",{className:"ErrorBannerWrapper",children:e.jsx(y,{entityId:r,onViewSharingSettingsClicked:s})}):e.jsxs("div",{className:"ErrorBannerWrapper",children:[e.jsx(m,{resetErrorBoundary:a.resetErrorBoundary}),e.jsx(_,{...a})]}),[r,i,s]);return e.jsx(Q,{FallbackComponent:u,children:t})}try{g.displayName="QueryWrapperErrorBoundary",g.__docgenInfo={description:"Error boundary that automatically pulls the error from QueryContext.  If 403, shows entity actions required",displayName:"QueryWrapperErrorBoundary",props:{}}}catch{}export{g as Q,m as S};
