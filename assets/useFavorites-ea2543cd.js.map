{"version":3,"file":"useFavorites-ea2543cd.js","sources":["../../src/synapse-queries/user/useFavorites.ts"],"sourcesContent":["import {\n  UseInfiniteQueryOptions,\n  useQuery,\n  UseQueryOptions,\n  useInfiniteQuery,\n  useMutation,\n  useQueryClient,\n  UseMutationOptions,\n} from 'react-query'\nimport SynapseClient from '../../synapse-client'\nimport { SynapseClientError } from '../../utils/SynapseClientError'\nimport { useSynapseContext } from '../../utils/context/SynapseContext'\nimport { EntityHeader, PaginatedResults } from '@sage-bionetworks/synapse-types'\nimport {\n  FavoriteSortBy,\n  FavoriteSortDirection,\n} from '@sage-bionetworks/synapse-types'\nimport { getNextPageParamForPaginatedResults } from '../InfiniteQueryUtils'\n\nexport function useIsFavorite(entityId: string) {\n  // TODO: Handle pagination - the default limit is 200\n  // It would probably make more sense to add a backend service to check if an entity ID is favorited\n  const { data: allFavorites, isLoading } = useGetFavorites()\n  const isFavorite = allFavorites?.results?.some(\n    favorite => favorite.id === entityId,\n  )\n  return { isFavorite, isLoading }\n}\n\nexport function useAddFavorite(\n  options?: UseMutationOptions<EntityHeader, SynapseClientError, string>,\n) {\n  const { accessToken, keyFactory } = useSynapseContext()\n  const queryClient = useQueryClient()\n  return useMutation({\n    ...options,\n    mutationFn: (entityId: string) =>\n      SynapseClient.addUserFavorite(entityId, accessToken),\n    mutationKey: ['addFavorite'],\n    onSuccess: async (data, variables, ctx) => {\n      await queryClient.invalidateQueries(keyFactory.getFavoritesQueryKey())\n      if (options?.onSuccess) {\n        return options.onSuccess(data, variables, ctx)\n      }\n      return\n    },\n  })\n}\n\nexport function useRemoveFavorite(\n  options?: UseMutationOptions<void, SynapseClientError, string>,\n) {\n  const { accessToken } = useSynapseContext()\n  const queryClient = useQueryClient()\n  const { keyFactory } = useSynapseContext()\n\n  return useMutation({\n    ...options,\n    mutationFn: (entityId: string) =>\n      SynapseClient.removeUserFavorite(entityId, accessToken),\n    mutationKey: ['removeFavorite'],\n    onSuccess: async (data, variables, ctx) => {\n      await queryClient.invalidateQueries(keyFactory.getFavoritesQueryKey())\n      if (options?.onSuccess) {\n        return options.onSuccess(data, variables, ctx)\n      }\n      return\n    },\n  })\n}\n\nexport function useGetFavorites(\n  sort: FavoriteSortBy = 'FAVORITED_ON',\n  sortDirection: FavoriteSortDirection = 'DESC',\n  options?: UseQueryOptions<\n    PaginatedResults<EntityHeader>,\n    SynapseClientError,\n    PaginatedResults<EntityHeader>\n  >,\n) {\n  const { accessToken, keyFactory } = useSynapseContext()\n\n  return useQuery<PaginatedResults<EntityHeader>, SynapseClientError>(\n    keyFactory.getUserFavoritesQueryKey(sort, sortDirection),\n    () =>\n      SynapseClient.getUserFavorites(\n        accessToken,\n        undefined,\n        undefined,\n        sort,\n        sortDirection,\n      ),\n    options,\n  )\n}\n\nexport function useGetFavoritesInfinite(\n  sort: FavoriteSortBy = 'FAVORITED_ON',\n  sortDirection: FavoriteSortDirection = 'DESC',\n  options?: UseInfiniteQueryOptions<\n    PaginatedResults<EntityHeader>,\n    SynapseClientError\n  >,\n) {\n  const LIMIT = 10\n\n  const { accessToken, keyFactory } = useSynapseContext()\n\n  return useInfiniteQuery<PaginatedResults<EntityHeader>, SynapseClientError>(\n    keyFactory.getUserFavoritesInfiniteQueryKey(sort, sortDirection),\n    async context => {\n      return SynapseClient.getUserFavorites(\n        accessToken,\n        // pass the context.pageParam for the new offset\n        context.pageParam,\n        LIMIT,\n        sort,\n        sortDirection,\n      )\n    },\n    {\n      ...options,\n      getNextPageParam: getNextPageParamForPaginatedResults,\n    },\n  )\n}\n"],"names":["useIsFavorite","entityId","allFavorites","isLoading","useGetFavorites","_a","favorite","useAddFavorite","options","accessToken","keyFactory","useSynapseContext","queryClient","useQueryClient","useMutation","SynapseClient","data","variables","ctx","useRemoveFavorite","sort","sortDirection","useQuery","useGetFavoritesInfinite","useInfiniteQuery","context","getNextPageParamForPaginatedResults"],"mappings":"qSAmBO,SAASA,EAAcC,EAAkB,OAG9C,KAAM,CAAE,KAAMC,EAAc,UAAAC,GAAcC,EAAgB,EAInD,MAAA,CAAE,YAHUC,EAAAH,GAAA,YAAAA,EAAc,UAAd,YAAAG,EAAuB,KACxCC,GAAYA,EAAS,KAAOL,GAET,UAAAE,EACvB,CAEO,SAASI,EACdC,EACA,CACA,KAAM,CAAE,YAAAC,EAAa,WAAAC,CAAW,EAAIC,EAAkB,EAChDC,EAAcC,IACpB,OAAOC,EAAY,CACjB,GAAGN,EACH,WAAaP,GACXc,EAAc,gBAAgBd,EAAUQ,CAAW,EACrD,YAAa,CAAC,aAAa,EAC3B,UAAW,MAAOO,EAAMC,EAAWC,IAAQ,CAEzC,GADA,MAAMN,EAAY,kBAAkBF,EAAW,qBAAsB,CAAA,EACjEF,GAAA,MAAAA,EAAS,UACX,OAAOA,EAAQ,UAAUQ,EAAMC,EAAWC,CAAG,CAGjD,CAAA,CACD,CACH,CAEO,SAASC,EACdX,EACA,CACM,KAAA,CAAE,YAAAC,GAAgBE,IAClBC,EAAcC,IACd,CAAE,WAAAH,GAAeC,IAEvB,OAAOG,EAAY,CACjB,GAAGN,EACH,WAAaP,GACXc,EAAc,mBAAmBd,EAAUQ,CAAW,EACxD,YAAa,CAAC,gBAAgB,EAC9B,UAAW,MAAOO,EAAMC,EAAWC,IAAQ,CAEzC,GADA,MAAMN,EAAY,kBAAkBF,EAAW,qBAAsB,CAAA,EACjEF,GAAA,MAAAA,EAAS,UACX,OAAOA,EAAQ,UAAUQ,EAAMC,EAAWC,CAAG,CAGjD,CAAA,CACD,CACH,CAEO,SAASd,EACdgB,EAAuB,eACvBC,EAAuC,OACvCb,EAKA,CACA,KAAM,CAAE,YAAAC,EAAa,WAAAC,CAAW,EAAIC,EAAkB,EAE/C,OAAAW,EACLZ,EAAW,yBAAyBU,EAAMC,CAAa,EACvD,IACEN,EAAc,iBACZN,EACA,OACA,OACAW,EACAC,CACF,EACFb,CAAA,CAEJ,CAEO,SAASe,EACdH,EAAuB,eACvBC,EAAuC,OACvCb,EAIA,CAGA,KAAM,CAAE,YAAAC,EAAa,WAAAC,CAAW,EAAIC,EAAkB,EAE/C,OAAAa,EACLd,EAAW,iCAAiCU,EAAMC,CAAa,EAC/D,MAAMI,GACGV,EAAc,iBACnBN,EAEAgB,EAAQ,UACR,GACAL,EACAC,CAAA,EAGJ,CACE,GAAGb,EACH,iBAAkBkB,CACpB,CAAA,CAEJ"}