import{i8 as me,ao as P,an as ae,aa as ne,U as pe,j as e,r as d,c3 as Y,d2 as R,V as b,e0 as N,b_ as v,X as y,c0 as he,B as j,ag as ge,gP as fe,dK as Te,_ as xe,cn as Ce,co as Ie,bV as se,dJ as ye,d_ as be,dq as _e,bP as Se}from"./iframe-CQAvee5F.js";import{u as je}from"./useGetEntityChallenge-BkJcHdfE.js";import{d as ve,a as re,e as ie,u as Ee}from"./useTeamMembers-DrygbNXr.js";import{u as Me}from"./useGetUserTeams-cpfZtrvh.js";import{D as Ne}from"./DialogBase-A7SeZij4.js";import{C as Re}from"./CreateChallengeTeam-CSuUVBAe.js";import{u as Q}from"./useTeam-B591q4WN.js";import{U as we}from"./UserBadge-ChS5ZWfy.js";import{U as qe}from"./UserOrTeamBadge-BGqT0PHu.js";import{S as Ae}from"./Search-DeS21Gsc.js";import{B as ee}from"./Box-hCSCiZtJ.js";import{R as Le}from"./Radio-pvaSUjJI.js";import{D as Fe}from"./DataGrid--Bk5GgUo.js";const Oe=me();function ke(a,r){const{accessToken:i,keyFactory:n}=P();return ae({...r,queryKey:n.getTeamListQueryKey(a.sort().join()),queryFn:()=>ne.getTeamList(a,i)})}function Ve(a,r){const{accessToken:i,keyFactory:n}=P();return ae({...r,queryKey:n.getChallengeTeamListQueryKey(a),queryFn:()=>ne.getAllChallengeTeams(i,a)})}const Be=pe([e.jsx("path",{d:"m20 8-8 5-8-5v10h16zm0-2H4l8 4.99z",opacity:".3"},"0"),e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2M20 6l-8 4.99L4 6zM4 8l8 5 8-5v10H4z"},"1")]),V=d.forwardRef(function(r,i){const{teamId:n,onRequestSubmitted:s=Y}=r,[c,o]=d.useState(""),{data:t}=R(),{data:m,status:_,error:E}=Q(n,{enabled:!!n}),{mutate:h}=ve({onSuccess:()=>{s()}}),M=T=>{const x=T.target.value;o(x)};return d.useImperativeHandle(i,()=>({submit(){t&&h({teamId:n,userId:t.ownerId,message:c,expiresOn:void 0})}}),[c,h,n,t]),_==="pending"?e.jsx(b,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):_==="error"?e.jsx(v,{severity:"error",children:E.message}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e.jsx("strong",{children:m.name})," team."]}),e.jsx(b,{children:e.jsx(he,{label:"Your Message to Team Managers(s)",id:"membershipRequestMessage",value:c,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:M})})]})});try{V.displayName="MembershipRequestForm",V.__docgenInfo={description:"Component that provides a form that a user can use to create a MembershipRequest for a Team.\n\nTo submit the form, pass a ref and call the `submit` handle on the ref.",displayName:"MembershipRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onRequestSubmitted:{defaultValue:null,description:"",name:"onRequestSubmitted",required:!0,type:{name:"() => void"}}}}}catch{}function B(a){const{teamId:r,onSuccess:i=Y,...n}=a,{data:s}=R(),{mutate:c,isPending:o}=re({onSuccess:()=>{i()}}),t=!s||o,m=d.useCallback(()=>{s!=null&&s.ownerId&&c({teamId:r,userId:s.ownerId})},[s==null?void 0:s.ownerId,c,r]);return e.jsx(j,{variant:"contained",disabled:t,startIcon:o?e.jsx(N,{}):void 0,...n,onClick:m,children:"Accept Invitation"})}function U(a){const{teamId:r}=a,{data:i}=R(),{data:n,status:s,error:c}=ie(i==null?void 0:i.ownerId,{enabled:!!(i!=null&&i.ownerId)}),{data:o}=Q(r,{enabled:!!r});if(s==="pending")return e.jsx(N,{});if(s==="error")return e.jsx(v,{severity:"error",children:c.message});const t=n.find(m=>m.teamId===r);return t==null?e.jsxs(v,{severity:"error",children:["No matching invitation for team ",o?o.name:`ID: ${r}`]}):e.jsxs(ge,{sx:{gap:2},children:[e.jsxs(y,{variant:"body1",children:[e.jsx(we,{userId:t.createdBy})," has invited you to join"," ",e.jsx("span",{children:e.jsx(qe,{principalId:r})}),t.message?" with the following message:":"."]}),t.message&&e.jsx(y,{variant:"body1",component:"blockquote",children:t.message}),e.jsx(y,{variant:"body1",children:"Do you want to accept this invitation?"})]})}try{B.displayName="AcceptMembershipInvitationButton",B.__docgenInfo={description:"",displayName:"AcceptMembershipInvitationButton",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}try{U.displayName="OpenMembershipInvitation",U.__docgenInfo={description:`For the current, authenticated user, displays the details of an open MembershipInvitation for the provided team ID.

This component requires
  1. The current user is logged-in
  2. The current user has an open invitation to join the teamId passed in via props

To prompt the user to accept the invitation, use the {@link AcceptMembershipInvitationButton} component.`,displayName:"OpenMembershipInvitation",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}}}}}catch{}const G=({createdNewTeam:a,teamId:r})=>{const{data:i,status:n,error:s}=Q(r,{enabled:!!r});return r?n==="pending"?e.jsx(b,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):n==="error"?e.jsx(v,{severity:"error",children:s.message}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",a?"created":"joined"," team"," ",e.jsx("b",{children:i.name})," and have been added to this challenge."]}),a&&e.jsx(b,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{G.displayName="RegistrationSuccessful",G.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}}}}}catch{}function D(a){const{value:r,rowCount:i,onChange:n}=a,s=i>5?"calc(100% - 8px)":"100%";return e.jsxs(ee,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:s,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e.jsx(ee,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e.jsx(Ae,{sx:{color:"#878E95"}})}),e.jsx(fe,{value:r,onChange:n,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})}try{D.displayName="ChallengeTeamSearch",D.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function H(a){const{challengeId:r,onSelectTeam:i,selectedTeamId:n}=a,{data:s,isLoading:c}=Ve(r),{data:o}=R(),{data:t}=ie(o==null?void 0:o.ownerId,{enabled:!!(o!=null&&o.ownerId)}),[m,_]=d.useState(""),E=(s==null?void 0:s.map(l=>l.teamId))??[],{data:h,isLoading:M}=ke(E,{enabled:!!E.length}),T=d.useMemo(()=>{const l=m.toLowerCase(),p=(h==null?void 0:h.list.filter(g=>g.canPublicJoin||g.canRequestMembership!==!1||(t==null?void 0:t.some(f=>f.teamId===g.id))))??[];let w=p;return l.length&&(w=p.filter(g=>{var f;return g.name.toLowerCase().includes(l)||((f=g.description)==null?void 0:f.toLowerCase().includes(l))})),w.map(g=>({...g,hasInvitation:!!(t!=null&&t.some(f=>f.teamId===g.id))}))},[t,m,h==null?void 0:h.list]),x=c||M,C=d.useMemo(()=>[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:l})=>e.jsx(Le,{value:l.id,checked:String(l.id)===n,onClick:()=>{i(String(l.id))},inputProps:{"aria-label":`Select ${l.name}`}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:l})=>e.jsx(xe,{href:`${Ce(Ie.PORTAL_ENDPOINT)}/Team:${l.id}`,target:"_blank",underline:"hover",children:l.name})},{field:"hasInvitation",headerName:"",width:15,filterable:!1,hideable:!1,disableColumnMenu:!0,align:"center",renderCell:({value:l})=>l?e.jsx(se,{title:"You have been invited to join this team",children:e.jsx(Be,{fontSize:"small",sx:{color:"grey.700"}})}):null},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({value:l})=>Te(ye(l),"MM/DD/YY")},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}],[i,n]);return e.jsxs(b,{sx:{height:220},children:[!x&&e.jsx(D,{value:m,onChange:l=>_(l.target.value),rowCount:T.length}),e.jsx(Fe,{initialState:{sorting:{sortModel:[{field:"hasInvitation",sort:"desc"}]}},loading:x,rows:T,columns:C,rowCount:5,hideFooter:!0,density:"compact",rowBufferPx:500,sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:l=>l.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]})}try{H.displayName="ChallengeTeamTable",H.__docgenInfo={description:`Table component that displays teams that
 1. are registered for the challenge specified by the challengeId prop
 2. the current user is able to join, create a request to join, or accept an invitation to join`,displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}const Ue='To participate in a challenge, you need to create a new Team or join an existing one.   By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.   All team members will need a Synapse account so that they can login and accept the team invitation.',J=({challengeId:a,onCreateTeam:r,selectedTeamId:i,onSelectTeam:n})=>e.jsxs(Oe,{spacing:2,children:[e.jsx(y,{variant:"body1",sx:{lineHeight:"20px"},children:Ue}),e.jsx(b,{sx:{height:270},children:e.jsx(H,{challengeId:a,selectedTeamId:i,onSelectTeam:n})}),e.jsx(b,{children:e.jsx(j,{color:"primary",variant:"contained",onClick:r,startIcon:e.jsx(be,{}),children:"Create New Team"})})]});try{J.displayName="SelectChallengeTeam",J.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}function Ge(a){switch(a){case"SELECT_YOUR_CHALLENGE_TEAM":return"Select Your Challenge Team";case"ACCEPT_INVITATION":return"Invitation to Join Team";case"JOIN_REQUEST_FORM":return"Request Team Membership";case"JOIN_REQUEST_SENT":return"Request Sent";case"CREATE_NEW_TEAM":return"Create Team";case"REGISTRATION_SUCCESSFUL":return"Registration Successful!"}}function te(a){const{projectId:r,isShowingModal:i=!1,onClose:n}=a,{isAuthenticated:s}=P(),[c,o]=d.useState("SELECT_YOUR_CHALLENGE_TEAM"),[t,m]=d.useState(),[_,E]=d.useState(!1),[h,M]=d.useState(!1),T=d.useRef(null),x=d.useRef(null),{data:C,isLoading:l}=R({enabled:s}),{data:p,isLoading:w}=je(r),{mutateAsync:g,isPending:f,error:A}=re(),{data:z,error:L}=Me(p==null?void 0:p.id,1,0,{enabled:!!(s&&p)}),F=z&&z.results.length>0,{data:I,isLoading:W,error:O}=Ee(t,String(C==null?void 0:C.ownerId),{enabled:s&&!!t&&!!C}),$=d.useCallback(async()=>{!t||!C||(await g({teamId:t,userId:C.ownerId}),o("REGISTRATION_SUCCESSFUL"))},[g,o,t,C]),oe=d.useCallback(()=>{M(!1),m(void 0),n()},[n]),le=l||w,S=d.useMemo(()=>{switch(c){case"SELECT_YOUR_CHALLENGE_TEAM":case"JOIN_REQUEST_SENT":case"REGISTRATION_SUCCESSFUL":return e.jsx(e.Fragment,{});case"ACCEPT_INVITATION":case"JOIN_REQUEST_FORM":case"CREATE_NEW_TEAM":default:return e.jsx(j,{variant:"outlined",onClick:()=>{o("SELECT_YOUR_CHALLENGE_TEAM"),m(void 0)},children:"Back"})}},[c]),k=d.useMemo(()=>e.jsx(j,{variant:"contained",onClick:()=>{n()},children:"Close"}),[n]),{actions:de=e.jsx(e.Fragment,{}),content:ce=e.jsx(e.Fragment,{})}=d.useMemo(()=>{if(!s)return{content:e.jsx(v,{severity:"error",children:e.jsx(_e,{})})};if(F)return{content:e.jsx(v,{severity:"error",children:e.jsx(y,{children:"You are already a member of a registered submission team for this Challenge."})})};switch(c){case"SELECT_YOUR_CHALLENGE_TEAM":{let u="Join Team",X=!1,q=Y,Z="";return I&&I.hasOpenInvitation?(u="View Invitation to Join Team",q=()=>{o("ACCEPT_INVITATION")}):I&&I.hasOpenRequest?(u="Join Request Pending",X=!0,Z="You have already submitted a request to join this team."):I&&I.membershipApprovalRequired?(u="Request to Join Team",q=()=>{o("JOIN_REQUEST_FORM")}):I&&I.canJoin&&(u="Join Team",q=()=>{$()}),{content:p&&!F&&e.jsx(J,{challengeId:p.id,onCreateTeam:()=>o("CREATE_NEW_TEAM"),selectedTeamId:t,onSelectTeam:ue=>m(ue)}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(se,{title:Z,children:e.jsx("span",{children:e.jsx(j,{onClick:q,startIcon:f?e.jsx(N,{}):void 0,disabled:!t||W||f||X,variant:"contained",children:u})})})]})}}case"ACCEPT_INVITATION":return{content:e.jsx(U,{teamId:t}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(B,{teamId:t,onSuccess:()=>{o("REGISTRATION_SUCCESSFUL")}})]})};case"JOIN_REQUEST_FORM":return{content:e.jsx(V,{ref:T,teamId:t,onRequestSubmitted:()=>{o("JOIN_REQUEST_SENT")}}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(j,{variant:"contained",onClick:()=>{var u;(u=T==null?void 0:T.current)==null||u.submit()},children:"Send Request"})]})};case"JOIN_REQUEST_SENT":return{content:e.jsx(y,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."}),actions:e.jsxs(e.Fragment,{children:[S,k]})};case"REGISTRATION_SUCCESSFUL":return{content:e.jsx(G,{createdNewTeam:h,teamId:t}),actions:e.jsxs(e.Fragment,{children:[S,k]})};case"CREATE_NEW_TEAM":return{content:e.jsx(Re,{ref:x,challengeId:p==null?void 0:p.id,onCanSubmitChange:u=>E(u),onFinished:u=>{M(!0),m(u),o("REGISTRATION_SUCCESSFUL")}}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(j,{variant:"contained",disabled:!_,onClick:()=>{var u;(u=x==null?void 0:x.current)==null||u.submit()},children:"Create Team"})]})}}},[s,F,c,t,S,k,h,I,p,f,W,$,_]),K=(A==null?void 0:A.message)||(O==null?void 0:O.message)||(L==null?void 0:L.message);return e.jsx(Ne,{onCancel:oe,open:i,actions:de,title:Ge(c),content:e.jsx(Se,{children:e.jsx(b,{sx:{display:"flex",flexDirection:"column",gap:1},children:le?e.jsx(N,{size:40}):e.jsxs(e.Fragment,{children:[ce,K&&e.jsx(v,{severity:"error",children:K})]})})})})}try{te.displayName="ChallengeTeamWizard",te.__docgenInfo={description:`The ChallengeTeamWizard is used to guide a user through the process of joining or creating a team for a challenge.

A required precondition is that the user is NOT on any registered submission team for the challenge.`,displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:null,description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{te as C};
