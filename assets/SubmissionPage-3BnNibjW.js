import{gD as Q,an as N,am as z,aa as $,c9 as J,r as u,j as e,B as p,X as t,c4 as E,J as C,S as x,dG as j,kh as X,a3 as Y,c1 as d,ag as v,d4 as F,kg as Z,dH as k,bV as ee,F as se}from"./iframe-BVXHJH4u.js";import{A as te}from"./AccessRequirementList-DpRSev5E.js";import{D as O}from"./DialogBase-CcwXDs7D.js";import{g as ae,r as ie,a as re,e as ne}from"./useAccessRequirements-DgbpPYYv.js";import{b as oe,c as ce}from"./useDataAccessSubmission-gUWdHpe_.js";import{u as de}from"./useInfiniteQuery-D0pzNhrd.js";import{d as le}from"./useUserBundle-BoxU-Q5V.js";import{d as ue}from"./duration-DbmI10NM.js";import{M as me}from"./MarkdownSynapse-C6WRwt-e.js";import{U as q}from"./UserBadge-D8YQIqU3.js";import{U}from"./UserOrTeamBadge-D4N_23_Q.js";import{F as pe}from"./FileHandleLink-BgkDN6It.js";import{R as he}from"./RejectDataAccessRequestModal-DbbFRkGV.js";import{G as S}from"./Grid-By05aazM.js";import{u as xe}from"./upperFirst-DZyhAcR7.js";function je(i){return Q(i).toLowerCase()}function ye(i,a){const{keyFactory:r,synapseClient:o}=N();return z({...a,queryKey:r.getUserAccessApprovalQueryKey(i),queryFn:()=>o.dataAccessServicesClient.getRepoV1DataAccessSubmissionSubmissionIdUserAccessApproval({submissionId:i})})}function Ue(i,a){const{accessToken:r,keyFactory:o}=N();return de({...a,queryKey:o.searchAccessApprovalsQueryKey(i),queryFn:l=>$.searchAccessApprovals({...i,nextPageToken:l.pageParam},r),initialPageParam:void 0,getNextPageParam:l=>l.nextPageToken})}function I(i){const{open:a,onClose:r=J,submissionId:o,accessRequirementId:l}=i,{mutate:m,isPending:s,error:h}=ae({onSuccess:()=>{C("Access request cancelled","success"),r()}}),y=u.useCallback(()=>{m({submissionId:o,accessRequirementId:l})},[l,m,o]);return e.jsx(O,{title:"Cancel Access Request?",onCancel:()=>{r()},open:a,content:e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"body1",children:"Are you sure you want to cancel your request for access? If you want to make changes to the information included in your request, you can modify and resubmit your request after cancelling it."}),h&&e.jsx(E,{severity:"error",sx:{mt:2},children:e.jsx(t,{variant:"body1",children:h.reason})})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outlined",onClick:()=>r(),disabled:s,children:"Back"}),e.jsx(p,{variant:"contained",color:"error",onClick:()=>y(),disabled:s,children:"Cancel Request"})]})})}try{I.displayName="CancelDataAccessRequestConfirmationModal",I.__docgenInfo={description:"Confirmation modal that allows a requestor to cancel a submitted data access request.",displayName:"CancelDataAccessRequestConfirmationModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},submissionId:{defaultValue:null,description:"",name:"submissionId",required:!0,type:{name:"string"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"() => void"}}}}}catch{}function R(i){const{open:a,submissionId:r,onClose:o}=i,{mutate:l,isPending:m,error:s}=oe({onSuccess:()=>{C("Submission approved","success"),o()}}),h=u.useCallback(()=>{l({submissionId:r,newState:x.APPROVED})},[r,l]);return e.jsx(O,{open:a,title:"Approve Request?",onCancel:()=>{o()},content:e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"body1",sx:{marginBottom:"10px"},children:"Approving the request will grant access to controlled data."}),e.jsx(t,{variant:"body1",children:"In addition, the user will receive an email notification alerting them that the request has been granted."}),s&&e.jsx(E,{severity:"error",sx:{mt:1},children:s.message})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outlined",onClick:()=>o(),disabled:m,children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:()=>h(),disabled:m,children:"Approve Request"})]})})}try{R.displayName="ApproveSubmissionConfirmationModal",R.__docgenInfo={description:"Confirmation modal to approve a data access submission asa a reviewer/ACT member.",displayName:"ApproveSubmissionConfirmationModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},submissionId:{defaultValue:null,description:"",name:"submissionId",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}j.extend(ue);function A(i){const{submissionId:a,fileHandleId:r}=i,o=u.useMemo(()=>({fileHandleId:r,associateObjectId:a,associateObjectType:se.DataAccessSubmissionAttachment}),[r,a]);return e.jsx(pe,{showDownloadIcon:!0,fileHandleAssociation:o},r)}function ge(i){const{data:a}=ne(i.accessRequirementId,{throwOnError:!0});return a?e.jsx("div",{className:"AccessRequirementWikiContainer",children:e.jsxs("div",{className:"AccessRequirementWikiContent",children:[e.jsx(t,{variant:"headline1",children:"Access Requirement"}),e.jsx("hr",{}),e.jsx(me,{wikiId:a?.wikiPageId,ownerId:a?.ownerObjectId,objectType:a?.ownerObjectType})]})}):e.jsx(d,{width:"100%",height:"600px"})}function be(i,a){return a.submittedBy===i||!!a.accessorChanges.find(r=>r.userId===i)}function _(i){const{submissionId:a,isReviewer:r}=i,[o,l]=u.useState(!1),{data:m}=le(),{data:s,isLoading:h}=ce(a,{throwOnError:!0}),y=!!(s&&m&&be(m.ownerId,s)),{data:w,isLoading:D}=ye(String(a),{enabled:y&&s&&s.state===x.APPROVED}),B=!!(w&&j(w.expiredOn).isBefore(j())),K=s&&s.submittedBy===m?.ownerId,{data:c}=ie(parseInt(s?.accessRequirementId),{enabled:!!s}),{data:V,isLoading:g}=re(s?.accessRequirementId,{enabled:!!s,throwOnError:!0}),[M,b]=u.useState(!1),[L,P]=u.useState(!1),[H,T]=u.useState(!1),G=X(),f=V?.resourceAccess.filter(n=>n.accessType.includes(Y.REVIEW_SUBMISSIONS)).map(n=>n.principalId),W=u.useMemo(()=>s&&!D?B?"Expired":s.state:e.jsx(d,{width:100}),[B,D,s]);return e.jsxs(S,{container:!0,spacing:4,className:"SubmissionPage",children:[M&&c&&e.jsx(te,{renderAsModal:!0,accessRequirementFromProps:[c],onHide:()=>b(!1),onSubmissionCreated:n=>{b(!1),C("Data access request submitted","success",{primaryButtonConfig:{text:"View Request",onClick:()=>{G("/submissions/"+n)}}})}}),e.jsx(R,{open:H,onClose:()=>{T(!1)},submissionId:String(a)}),o&&e.jsx(he,{submissionId:a,open:o,onClose:()=>l(!1)}),e.jsxs(S,{className:"SubmissionSummary",size:{xs:12,sm:4,lg:3},children:[e.jsx(t,{variant:"dataFieldKey",gutterBottom:!0,children:"Status"}),e.jsx(t,{variant:"headline3",sx:{textTransform:"uppercase"},gutterBottom:!0,children:W}),e.jsx("br",{}),h&&e.jsx(d,{width:200}),s&&r&&s.state===x.SUBMITTED&&e.jsxs("div",{className:"ButtonContainer",children:[e.jsx(p,{onClick:()=>{T(!0)},color:"success",variant:"contained",children:"Approve"}),e.jsx(p,{onClick:()=>{l(!0)},color:"error",variant:"contained",children:"Reject"})]}),s&&K&&e.jsxs("div",{className:"ButtonContainer",children:[e.jsx(I,{open:L,submissionId:String(a),accessRequirementId:s?.accessRequirementId||"",onClose:()=>P(!1)}),s.state===x.SUBMITTED&&e.jsx(p,{onClick:()=>{P(!0)},color:"primary",variant:"outlined",children:"Cancel Request"}),s.state!==x.SUBMITTED&&e.jsxs(p,{onClick:()=>{b(!0)},color:"primary",variant:"outlined",children:[s.state===x.APPROVED?"Update":"Modify"," ","Request"]})]}),e.jsx(t,{variant:"dataFieldKey",gutterBottom:!0,children:"Access Requirement Name"}),e.jsx(t,{variant:"smallText1",gutterBottom:!0,children:c?.name??e.jsx(d,{width:100})}),e.jsx("br",{}),r&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"dataFieldKey",gutterBottom:!0,children:"Assigned Reviewer"}),e.jsxs(v,{children:[g&&e.jsx(d,{width:100}),!g&&!F(f)&&f.map(n=>e.jsx(U,{principalId:n},n)),!g&&F(f)&&e.jsx(U,{principalId:Z})]}),e.jsx("br",{})]}),e.jsx(t,{variant:"dataFieldKey",gutterBottom:!0,children:"Conditions"}),c?e.jsx(t,{variant:"smallText1",component:"div",gutterBottom:!0,children:e.jsxs("ul",{children:[e.jsxs("li",{children:["Expiration period:"," ",j.duration({milliseconds:c.expirationPeriod}).asDays()," ","day(s)",c.expirationPeriod===0&&" (no expiration)"]}),c.isCertifiedUserRequired&&e.jsx("li",{children:"User must be Certified"}),c.isValidatedProfileRequired&&e.jsx("li",{children:"User Profile must be Validated"}),c.isDUCRequired&&e.jsx("li",{children:"DUC is required"}),c.isIDURequired&&e.jsx("li",{children:"IDU is required"}),c.isIDUPublic&&e.jsx("li",{children:"IDU will be made public"}),c.isIRBApprovalRequired&&e.jsx("li",{children:"IRB Approval is required"}),c.areOtherAttachmentsRequired&&e.jsx("li",{children:"Other attachments are required"})]})}):e.jsx(d,{width:100}),e.jsx("br",{}),e.jsxs("div",{className:"SubmissionSummaryGrid",children:[e.jsx(t,{variant:"dataFieldKey",children:"Submitted By"}),e.jsx(t,{variant:"smallText1",children:s?e.jsx(q,{userId:s.submittedBy}):e.jsx(d,{width:100})}),e.jsx(t,{variant:"dataFieldKey",children:"Submitted On"}),e.jsx(t,{variant:"smallText1",children:s?k(j(s.submittedOn)):e.jsx(d,{width:100})}),r&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"dataFieldKey",children:"Modified By"}),e.jsx(t,{variant:"smallText1",children:s?e.jsx(q,{userId:s.modifiedBy}):e.jsx(d,{width:100})})]}),e.jsx(t,{variant:"dataFieldKey",children:"Modified On"}),e.jsx(t,{variant:"smallText1",children:s?k(j(s.modifiedOn)):e.jsx(d,{width:100})}),e.jsxs(t,{className:"Key",variant:"dataFieldKey",children:["Data Requesters",`${s?` (${s.accessorChanges.length})`:""}`]}),s?s.accessorChanges.map(n=>e.jsxs(u.Fragment,{children:[e.jsx(t,{className:"Key DataAccessor",variant:"smallText1",children:e.jsx("span",{style:{whiteSpace:"nowrap"},children:e.jsx(q,{userId:n.userId},n.userId)})}),e.jsx(t,{className:"Value DataAccessor",variant:"smallText1",children:xe(je(n.type.substring(0,n.type.indexOf("_"))))})]},n.userId)):e.jsx(d,{width:100}),e.jsx(t,{className:"Key",variant:"dataFieldKey",children:"Institution"}),e.jsx(t,{className:"Value",variant:"smallText1",children:s?s.researchProjectSnapshot.institution:e.jsx(d,{width:100})}),e.jsx(t,{className:"Key",variant:"dataFieldKey",children:"Project Lead"}),e.jsx(t,{className:"Value",variant:"smallText1",children:s?s.researchProjectSnapshot.projectLead:e.jsx(d,{width:100})})]})]}),e.jsx(S,{size:{xs:12,sm:8,lg:9},children:e.jsxs(v,{sx:{gap:2},children:[e.jsx(ee,{children:s?e.jsx(ge,{accessRequirementId:s.accessRequirementId}):e.jsx(e.Fragment,{})}),s?.rejectedReason&&e.jsxs("section",{children:[e.jsx(t,{variant:"headline1",gutterBottom:!0,children:"Reason for rejection given by reviewer"}),e.jsx("hr",{}),e.jsx(t,{variant:"body1",style:{whiteSpace:"pre-line"},gutterBottom:!0,children:s.rejectedReason})]}),e.jsxs("section",{children:[e.jsxs(t,{variant:"headline1",children:["Contents of the Access Request",e.jsx("hr",{})]}),e.jsxs(v,{sx:{gap:2},children:[s?.researchProjectSnapshot?.intendedDataUseStatement&&e.jsxs("section",{children:[e.jsx(t,{variant:"headline2",gutterBottom:!0,children:"Intended Data Use Statement"}),e.jsx(t,{variant:"body1",style:{whiteSpace:"pre-line"},gutterBottom:!0,children:s.researchProjectSnapshot.intendedDataUseStatement})]}),e.jsx(t,{variant:"headline2",gutterBottom:!0,children:"Documents"}),s?.ducFileHandleId&&e.jsxs("section",{children:[e.jsx(t,{variant:"smallText2",children:"Data Use Certificate (DUC)"}),e.jsx(A,{submissionId:s.id,fileHandleId:s.ducFileHandleId})]}),s?.irbFileHandleId&&e.jsxs("section",{children:[e.jsx(t,{variant:"smallText2",gutterBottom:!0,children:"IRB Approval Letter"}),e.jsx(A,{submissionId:s.id,fileHandleId:s.irbFileHandleId})]}),s?.attachments&&e.jsxs("section",{children:[e.jsx(t,{variant:"smallText2",gutterBottom:!0,children:"Other Attachments"}),s.attachments.map(n=>e.jsxs(u.Fragment,{children:[e.jsx(A,{submissionId:s.id,fileHandleId:n}),e.jsx("br",{})]},n))]})]})]})]})})]})}try{_.displayName="SubmissionPage",_.__docgenInfo={description:`Page for a Data Access Submission. Supports the following user types:
 - ACT member or other designated reviewer can view, and choose to approve or reject.
 - Data Access Request submitter can view and modify their own submission.
 - Data Access Request requester (who is not a submitter) can view their own submission.`,displayName:"SubmissionPage",props:{submissionId:{defaultValue:null,description:"The ID of the submission to view",name:"submissionId",required:!0,type:{name:"string | number"}},isReviewer:{defaultValue:null,description:"If true, display reviewer controls on the page",name:"isReviewer",required:!0,type:{name:"boolean"}}}}}catch{}export{_ as S,Ue as u};
