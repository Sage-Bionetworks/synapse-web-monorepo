import{j as t}from"./jsx-runtime-Du8NFWEI.js";import{r as d,R as pe,g as ve,c as Te}from"./index-Dl6G-zuu.js";import{k as Z,p as V,N as ee,ce as Re,cf as De,cg as _e,ch as Ae}from"./SynapseClient-Ihq4xrvb.js";import"./OrientationBanner-BV5RFxzC.js";import"./getEndpoint-CjoHA800.js";import{a as ke,C as oe}from"./CreatedOnByUserDiv-BGLMF_Tx.js";import{W as fe}from"./WarningDialog-DY7P0_8l.js";import{I as te,C as Oe}from"./IconSvg-Djvs0a91.js";import{R as E}from"./Row-GEteuHPK.js";import{C as f}from"./Col-DHoeYEWd.js";import{a as v,b as U,F as G}from"./Form--9Y-bW00.js";import{M as ne}from"./Alert-HJYNNEvY.js";import{B as T}from"./Button-mb55Lwfk.js";import{D as x}from"./Dropdown-Sqg-5xfw.js";import{d as S}from"./dayjs.min-d18Up55D.js";import{I as le}from"./IconButton-CgTC7RgJ.js";import{c as Ve}from"./createSvgIcon-BYNyJbGL.js";import{u as Me}from"./timezone-Cq1SAuLw.js";import{D as de}from"./DateTimePicker-CMxj8dRI.js";import{a as qe}from"./ThemesPlot-Y4FQEyww.js";const Fe=Ve(t.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox"),xe=e=>{const[n,s]=d.useState(e);return{list:n,handleListChange:o=>l=>{const c=[...n];c[o]=l,s(c)},handleListRemove:o=>()=>{const l=n.filter((c,m)=>o!==m);s(l)},appendToList:(...o)=>{const l=[...n];l.push(...o),s(l)},setList:s}},$=({evaluationId:e,entityId:n,onDeleteSuccess:s,onSaveSuccess:a})=>{if(e&&n)throw new Error("please use either evaluationId or entityId but not both");const{accessToken:r}=Z(),[i,o]=d.useState(),[l,c]=d.useState(!1);d.useEffect(()=>{i&&c(!1)},[i]);const[m,g]=d.useState(""),[R,L]=d.useState(""),[D,N]=d.useState(""),[C,_]=d.useState(""),[h,A]=d.useState({contentSource:n});d.useEffect(()=>{g(h.name??""),L(h.description??""),N(h.submissionInstructionsMessage??""),_(h.submissionReceiptMessage??"")},[h]),d.useEffect(()=>{e&&(o(void 0),V.getEvaluation(e,r).then(u=>{A(u)}).catch(u=>o(u)))},[e,r]);const k=()=>{o(void 0),c(!1);const u={...h,name:m,description:R,submissionInstructionsMessage:D,submissionReceiptMessage:C};(u.id?V.updateEvaluation(u,r):V.createEvaluation(u,r)).then(b=>{A(b),c(!0),a&&a(b.id)}).catch(b=>o(b))},w=h!=null&&h.id?()=>{o(void 0),V.deleteEvaluation(h.id,r).then(s).catch(u=>o(u))}:void 0;return t.jsx("div",{className:"bootstrap-4-backport",children:t.jsxs("div",{className:"evaluation-editor",children:[t.jsxs(E,{children:[t.jsx(f,{children:t.jsxs("h4",{children:[h.id?"Edit":"Create"," Evaluation Queue"]})}),t.jsx(f,{children:t.jsx(Be,{onClick:k,onDelete:w})})]}),t.jsxs(v,{children:[t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-name",children:"Name"}),t.jsx(v.Control,{id:"evaluation-name",type:"text",value:m,onChange:u=>g(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-description",children:"Description"}),t.jsx(v.Control,{id:"evaluation-description",as:"textarea",value:R,rows:2,onChange:u=>L(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-submissioninstructions",children:"Submission Instructions"}),t.jsx(v.Control,{as:"textarea",id:"evaluation-submissioninstructions",value:D,rows:2,onChange:u=>N(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-receiptmessage",children:"Submission Receipt Message"}),t.jsx(v.Control,{id:"evaluation-receiptmessage",type:"text",value:C,onChange:u=>_(u.target.value)})]}),(h==null?void 0:h.createdOn)&&t.jsx(ke,{userId:h.ownerId,date:new Date(h.createdOn)}),i&&t.jsx(ee,{error:i}),l&&t.jsx(ne,{className:"save-success-alert",severity:"success",onClose:()=>c(!1),sx:{marginBottom:"20px"},children:"Successfully saved."}),t.jsx("div",{className:"d-flex justify-content-end",children:t.jsx(T,{variant:"contained",color:"primary",className:"save-button",onClick:k,children:"Save"})})]})]})})},Be=({onClick:e,onDelete:n})=>{const[s,a]=d.useState(!1);return t.jsxs(t.Fragment,{children:[n&&t.jsx(fe,{title:"Delete Evaluation Queue",content:"Are you sure you want to delete this Evaluation Queue?",open:s,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),t.jsxs(x,{className:"float-right",children:[t.jsx(x.Toggle,{variant:"link",className:"dropdown-no-caret",children:t.jsx(te,{icon:"verticalEllipsis"})}),t.jsxs(x.Menu,{alignRight:!0,children:[t.jsx(x.Item,{role:"menuitem",onClick:e,children:"Save"}),n&&t.jsxs(t.Fragment,{children:[t.jsx(x.Divider,{}),t.jsx(x.Item,{role:"menuitem",onClick:()=>a(!0),children:"Delete"})]})]})]})]})};try{$.displayName="EvaluationEditor",$.__docgenInfo={description:"Edits basic properties of an Evaluation",displayName:"EvaluationEditor",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}},onSaveSuccess:{defaultValue:null,description:"Callback after successful save of the Evaluation",name:"onSaveSuccess",required:!1,type:{name:"((evaluationId: string) => void)"}}}}}catch{}const Ee={DAILY:"Daily Limit",WEEKLY:"Weekly Limit",MONTHLY:"Monthly Limit"},W=({limitInput:e,allSelectedTypes:n,onChange:s})=>t.jsxs(pe.Fragment,{children:[t.jsxs(U,{className:"limit-type",children:[t.jsx("label",{children:"Limit Type"}),t.jsx(G,{as:"select",custom:!0,value:e.type,onChange:a=>{s({type:a.target.value,maxSubmissionString:e.maxSubmissionString})},children:Object.entries(Ee).map(([a,r])=>t.jsx("option",{value:a,disabled:n.has(a)&&a!==e.type,children:r},a))})]}),t.jsxs(U,{className:"limit-input",children:[t.jsx("label",{children:"Maximum Submissions"}),t.jsx(G,{type:"text",pattern:"[0-9]*",value:e.maxSubmissionString,onChange:a=>{s({type:e.type,maxSubmissionString:a.target.value})}})]})]});try{W.displayName="EvaluationRoundLimitOptions",W.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptions",props:{limitInput:{defaultValue:null,description:"",name:"limitInput",required:!0,type:{name:"EvaluationRoundLimitInput"}},allSelectedTypes:{defaultValue:null,description:"",name:"allSelectedTypes",required:!0,type:{name:"Set<EvaluationRoundLimitType>"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(limitInput: EvaluationRoundLimitInput) => void"}}}}}catch{}const ge=Object.keys(Ee),Pe=e=>ge.find(n=>!e.has(n)),Y=({limitInputs:e,handleChange:n,handleDeleteLimit:s,onAddNewLimit:a})=>{const r=new Set(e.map(o=>o.type)),i=d.useCallback(()=>{a({type:Pe(r),maxSubmissionString:""})},[a,r]);return d.useEffect(()=>{e.length===0&&i()},[e,i]),t.jsx("div",{"data-testid":"EvaluationRoundLimitOptionsList",className:"advanced-limits-grid",children:e.map((o,l)=>t.jsxs(pe.Fragment,{children:[t.jsx(W,{limitInput:o,allSelectedTypes:r,onChange:n(l)}),t.jsx(le,{color:"primary","aria-label":"Remove",className:"remove-button",onClick:s(l),children:t.jsx(Oe,{})}),l===e.length-1&&e.length<ge.length&&t.jsx(le,{color:"primary","aria-label":"Add",onClick:i,className:"add-button",children:t.jsx(Fe,{})})]},o.type))})};try{Y.displayName="EvaluationRoundLimitOptionsList",Y.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptionsList",props:{limitInputs:{defaultValue:null,description:"",name:"limitInputs",required:!0,type:{name:"EvaluationRoundLimitInput[]"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(index: number) => (limitInput: EvaluationRoundLimitInput) => void"}},handleDeleteLimit:{defaultValue:null,description:"",name:"handleDeleteLimit",required:!0,type:{name:"(index: number) => () => void"}},onAddNewLimit:{defaultValue:null,description:"",name:"onAddNewLimit",required:!0,type:{name:"(limit: EvaluationRoundLimitInput) => void"}}}}}catch{}var Se={exports:{}},F=1;function Ue(){return F=(F*9301+49297)%233280,F/233280}function Ge(e){F=e}var $e={nextValue:Ue,seed:Ge},K=$e,y="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",j,ue,I;function Q(){I=!1}function je(e){if(!e){j!==y&&(j=y,Q());return}if(e!==j){if(e.length!==y.length)throw new Error("Custom alphabet for shortid must be "+y.length+" unique characters. You submitted "+e.length+" characters: "+e);var n=e.split("").filter(function(s,a,r){return a!==r.lastIndexOf(s)});if(n.length)throw new Error("Custom alphabet for shortid must be "+y.length+" unique characters. These characters were not unique: "+n.join(", "));j=e,Q()}}function We(e){return je(e),j}function Ye(e){K.seed(e),ue!==e&&(Q(),ue=e)}function Ke(){j||je(y);for(var e=j.split(""),n=[],s=K.nextValue(),a;e.length>0;)s=K.nextValue(),a=Math.floor(s*e.length),n.push(e.splice(a,1)[0]);return n.join("")}function ye(){return I||(I=Ke(),I)}function Qe(e){var n=ye();return n[e]}function He(){return j||y}var ae={get:He,characters:We,seed:Ye,lookup:Qe,shuffled:ye},P=typeof window=="object"&&(window.crypto||window.msCrypto),H;!P||!P.getRandomValues?H=function(e){for(var n=[],s=0;s<e;s++)n.push(Math.floor(Math.random()*256));return n}:H=function(e){return P.getRandomValues(new Uint8Array(e))};var Je=H,ze=function(e,n,s){for(var a=(2<<Math.log(n.length-1)/Math.LN2)-1,r=-~(1.6*a*s/n.length),i="";;)for(var o=e(r),l=r;l--;)if(i+=n[o[l]&a]||"",i.length===+s)return i},Xe=ae,Ze=Je,et=ze;function tt(e){for(var n=0,s,a="";!s;)a=a+et(Ze,Xe.get(),1),s=e<Math.pow(16,n+1),n++;return a}var nt=tt,M=nt,at=1567752802062,st=7,q,ce;function rt(e){var n="",s=Math.floor((Date.now()-at)*.001);return s===ce?q++:(q=0,ce=s),n=n+M(st),n=n+M(e),q>0&&(n=n+M(q)),n=n+M(s),n}var it=rt,ot=ae;function lt(e){if(!e||typeof e!="string"||e.length<6)return!1;var n=new RegExp("[^"+ot.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!n.test(e)}var dt=lt;(function(e){var n=ae,s=it,a=dt,r=0;function i(m){return n.seed(m),e.exports}function o(m){return r=m,e.exports}function l(m){return m!==void 0&&n.characters(m),n.shuffled()}function c(){return s(r)}e.exports=c,e.exports.generate=c,e.exports.seed=i,e.exports.worker=o,e.exports.characters=l,e.exports.isValid=a})(Se);var ut=Se.exports,ct=ut;const be=ve(ct),Le=(e,n)=>({reactListKey:n??be.generate(),evaluationId:e.evaluationId,id:e.id,etag:e.etag,roundStart:e.roundStart,roundEnd:e.roundEnd,totalSubmissionLimit:mt(e.limits),otherLimits:ht(e.limits)}),mt=e=>(e||[]).filter(n=>n.limitType==="TOTAL").reduce((n,s)=>s.maximumSubmissions.toString(),""),ht=e=>(e||[]).filter(n=>n.limitType!=="TOTAL").reduce((n,s)=>(n.push({type:s.limitType,maxSubmissionString:s.maximumSubmissions.toString()}),n),[]),J=({onSave:e,onDelete:n})=>{const[s,a]=d.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(fe,{title:"Delete Evaluation Round",content:"Are you sure you want to delete this Evaluation Round?",open:s,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),t.jsxs(x,{className:"float-right",children:[t.jsx(x.Toggle,{"aria-label":"Round Options",variant:"link",className:"dropdown-no-caret evaluation-round-editor-dropdown",children:t.jsx(te,{icon:"verticalEllipsis"})}),t.jsxs(x.Menu,{alignRight:!0,children:[t.jsx(x.Item,{onClick:e,children:"Save"}),t.jsx(x.Divider,{}),t.jsx(x.Item,{onClick:()=>a(!0),children:"Delete"})]})]})]})};try{J.displayName="EvaluationRoundEditorDropdown",J.__docgenInfo={description:"",displayName:"EvaluationRoundEditorDropdown",props:{onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"() => void"}}}}}catch{}var Ne={exports:{}};(function(e,n){(function(s,a){e.exports=a()})(Te,function(){return function(s,a){a.prototype.isSameOrAfter=function(r,i){return this.isSame(r,i)||this.isAfter(r,i)}}})})(Ne);var pt=Ne.exports;const vt=ve(pt);S.extend(Me);S.extend(vt);const ft=(e,n)=>{let s,a,r;const i=S();return i.isSameOrAfter(e)?i.isBefore(n)?(s="status-in-progress",a={icon:"sync"},r="IN PROGRESS"):(s="status-completed",a={icon:"clipboardCheck"},r="COMPLETED"):(s="status-not-yet-started",a=void 0,r="NOT YET STARTED"),t.jsx("div",{className:s,children:t.jsxs("div",{className:"status",children:[a&&t.jsx(te,{...a}),t.jsx("span",{children:r})]})})},xt=(e,n,s,a,r)=>{const i=[];if(a){const o=Number(a);if(Number.isNaN(o))throw TypeError("Total Submission is not an integer");i.push({limitType:"TOTAL",maximumSubmissions:o})}return r.forEach(o=>{if(o.maxSubmissionString){const l=Number(o.maxSubmissionString);if(Number.isNaN(l))throw TypeError(o.type+" Limit is not an integer");i.push({limitType:o.type,maximumSubmissions:l})}}),{id:e.id,etag:e.etag,evaluationId:e.evaluationId,roundStart:S.utc(n).toJSON(),roundEnd:S.utc(s).toJSON(),limits:i}};function me(e,n){if(n==null)return null;switch(n){case"disablePast":return`${qe(e)} date cannot be in the past`;case"invalidDate":default:return"Invalid date"}}const z=({evaluationRoundInput:e,onSave:n,onDelete:s})=>{const{accessToken:a}=Z(),[r,i]=d.useState(),[o,l]=d.useState(!1);d.useEffect(()=>{r&&l(!1)},[r]);const[c,m]=d.useState(e.roundStart?S(e.roundStart):null),[g,R]=d.useState(e.roundEnd?S(e.roundEnd):null),[L,D]=d.useState(e.totalSubmissionLimit),[N,C]=d.useState(!1),[_,h]=d.useState(null),[A,k]=d.useState(null),{list:w,handleListRemove:u,handleListChange:se,appendToList:b}=xe(e.otherLimits),Ce=p=>{const O=u(p);return()=>{O(),w.length===1&&C(!1)}},re=()=>{l(!1);let p;try{p=xt(e,c,g,L,w)}catch(O){i(O)}p&&(p.id?Re(p,a):De(p,a)).then(B=>{const Ie=Le(B,e.reactListKey);i(void 0),l(!0),n(Ie)}).catch(B=>i(B))},we=()=>{e.id?_e(e.evaluationId,e.id,a).then(()=>s()).catch(p=>i(p)):s()},ie=S().isSameOrAfter(e.roundStart);return t.jsx("div",{className:"evaluation-round-editor",children:t.jsx(oe,{children:t.jsx(oe.Body,{children:t.jsxs(v,{role:"form",children:[t.jsxs(E,{children:[t.jsx(f,{children:t.jsxs("h5",{children:["ROUND STATUS",e.id&&" ("+e.id+")"]})}),t.jsx(f,{children:t.jsx(J,{onDelete:we,onSave:re})})]}),t.jsx(E,{className:"mb-3",children:t.jsx(f,{children:t.jsx("div",{className:"round-status",children:ft(e.roundStart,e.roundEnd)})})}),t.jsx(E,{children:t.jsx(f,{children:t.jsx("h5",{children:"DURATION"})})}),t.jsxs(E,{children:[t.jsx(f,{children:t.jsx(de,{label:"Round Start",value:c,onChange:m,onError:p=>h(p),disabled:ie,disablePast:!ie,slotProps:{textField:{helperText:me("start",_)}}})}),t.jsx(f,{children:t.jsx(de,{label:"Round End",value:g,onChange:R,onError:p=>k(p),disablePast:!S(g).isSame(e.roundEnd),slotProps:{textField:{helperText:me("end",A)}}})})]}),t.jsx(E,{children:t.jsx(f,{children:t.jsx("h5",{style:{marginTop:"20px"},children:"SUBMISSION LIMITS"})})}),t.jsx(E,{children:t.jsx(f,{children:t.jsxs(U,{children:[t.jsx("label",{children:"Total Submissions / Round"}),t.jsx(G,{value:L,type:"text",pattern:"[0-9]*",onChange:p=>D(p.target.value),autoComplete:"new-password"})]})})}),t.jsx(E,{className:"mb-3",children:t.jsx(f,{children:t.jsx(T,{variant:"text",color:"primary",sx:{fontSize:"16px !important"},className:"advanced-limits-link",onClick:()=>C(!N),children:"Advanced Limits"})})}),N&&t.jsx(Y,{limitInputs:w,handleChange:se,handleDeleteLimit:Ce,onAddNewLimit:b}),r&&t.jsx(E,{className:"my-3",children:t.jsx(f,{children:t.jsx(ee,{error:r})})}),o&&t.jsx(E,{className:"my-3",children:t.jsx(f,{children:t.jsx(ne,{className:"save-success-alert",severity:"success",onClose:()=>l(!1),sx:{mb:"20px"},children:"Successfully saved."})})}),t.jsx(E,{className:"mt-3",children:t.jsx(f,{children:t.jsx(T,{variant:"contained",color:"primary",className:"save-button float-right border-0",onClick:re,children:"Save"})})})]})})})})};try{z.displayName="EvaluationRoundEditor",z.__docgenInfo={description:"",displayName:"EvaluationRoundEditor",props:{evaluationRoundInput:{defaultValue:null,description:"",name:"evaluationRoundInput",required:!0,type:{name:"EvaluationRoundInput"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(evaluationRound: EvaluationRoundInput) => void"}}}}}catch{}const Et=(e,n,s,a)=>{const r=[],i=o=>{Ae(e,{nextPageToken:o},n).then(l=>{const c=l.page.map(m=>Le(m));r.push(...c),a(void 0),l.nextPageToken?i(l.nextPageToken):s(r)}).catch(l=>{a(l)})};i(void 0)},X=({evaluationId:e})=>{const{accessToken:n}=Z(),[s,a]=d.useState(),{list:r,appendToList:i,handleListChange:o,handleListRemove:l,setList:c}=xe([]);return d.useEffect(()=>{Et(e,n,c,a)},[n,e]),s?t.jsx(ee,{error:s}):t.jsxs("div",{className:"evaluation-round-editor-list bootstrap-4-backport",children:[t.jsx("div",{className:"evaluation-rounds",children:r.map((m,g)=>t.jsx(z,{evaluationRoundInput:m,onSave:o(g),onDelete:l(g)},m.reactListKey))}),t.jsx("div",{children:t.jsx(T,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{i({reactListKey:be(),evaluationId:e,roundStart:"",roundEnd:"",totalSubmissionLimit:"",otherLimits:[]})},children:"Add Round"})})]})};try{X.displayName="EvaluationRoundEditorList",X.__docgenInfo={description:"Edits EvaluationsRounds for an Evaluation.",displayName:"EvaluationRoundEditorList",props:{evaluationId:{defaultValue:null,description:"id of the Evaluation containing EvaluationRounds to edit",name:"evaluationId",required:!0,type:{name:"string"}}}}}catch{}const he=({evaluationId:e,entityId:n,onDeleteSuccess:s})=>{const[a,r]=d.useState(e);return t.jsxs("div",{className:"bootstrap-4-backport",children:[t.jsx($,{evaluationId:a,entityId:a?void 0:n,onDeleteSuccess:s,onSaveSuccess:r}),t.jsx("div",{className:"my-4",children:a?t.jsx(X,{evaluationId:a}):t.jsx(gt,{})})]})},gt=()=>{const[e,n]=d.useState(!1);return t.jsx("div",{"data-testid":"FakeEvaluationRoundEditorList",children:e?t.jsx(ne,{severity:"info",children:"Evaluation Rounds can be edited once the Evaluation has been created."}):t.jsx(T,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{n(!0)},children:"Add Round"})})};try{he.displayName="EvaluationEditorPage",he.__docgenInfo={description:"Combined editor that allows editing an Evaluation's data and also it's associated rounds (once the Evaluation exists on Synapse)",displayName:"EvaluationEditorPage",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}}}}}catch{}export{he as E};
