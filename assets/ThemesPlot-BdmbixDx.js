import{j as l}from"./jsx-runtime-Du8NFWEI.js";import{l as X,bn as Z}from"./useFiles-CRNYnzvZ.js";import{r as D}from"./SqlFunctions-CdbhcYHP.js";import"./StringUtils-CCbjCejM.js";import{h as H}from"./SynapseConstants-Dk0Mz-dJ.js";import{r as _}from"./index-Dl6G-zuu.js";import"./VerificationSubmission-BUSqAuLu.js";import"./OrientationBanner-BOCf4qOE.js";import{l as J}from"./LoadingScreen-DXya-_sQ.js";import{c as B}from"./cloneDeep-DwbK2PGz.js";import{n as Y}from"./noop-DX6rZLP_.js";import{u as O}from"./uniq-CIqInB5m.js";import{P as U}from"./Plot-DSBVXOLN.js";import{e as K}from"./_initCloneObject-CZ6qv1A1.js";import{b as W}from"./_baseEach-DDQVroiY.js";import{b as ee}from"./_baseIteratee-DsVKhaMU.js";import{i as j}from"./isArray-Dxzbedgu.js";import{b as te}from"./_baseOrderBy-C2grRRFd.js";import{T as ae}from"./Tooltip-CbFhYBpv.js";function oe(t,a,e,o){for(var r=-1,n=t==null?0:t.length;++r<n;){var s=t[r];a(o,s,e(s),t)}return o}function re(t,a,e,o){return W(t,function(r,n,s){a(o,r,e(r),s)}),o}function le(t,a){return function(e,o){var r=j(e)?oe:re,n=a?a():{};return r(e,t,ee(o),n)}}var ne=Object.prototype,se=ne.hasOwnProperty,ie=le(function(t,a,e){se.call(t,e)?++t[e]:K(t,e,1)});function ue(t){return t&&t.length?t[0]:void 0}function M(t,a,e,o){return t==null?[]:(j(a)||(a=a==null?[]:[a]),e=e,j(e)||(e=e==null?[]:[e]),te(t,a,e))}const de=t=>t.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,a=>a.toUpperCase());function ce(t,a,e){a&&(t=t.filter(s=>s.y===a));const o=O(t.map(s=>s.group)).sort(),r=[],n=["(28,118,175,1)","rgba(91,176,181,1)"];return o.forEach((s,d)=>{const p=t.filter(i=>i.group===s);r.push({x:p.map(i=>i.x),y:p.map(i=>i.y),name:s,orientation:"h",marker:{color:e?e[s]:n[d],width:1},text:[s],hovertemplate:"%{x} %{text}<extra></extra>",textposition:"none",type:"bar"})}),r}function pe(t,{isTop:a,maxValue:e,backgroundColor:o}){const r=B(t);return r.xaxis={visible:!1,range:[0,e]},o&&(r.plot_bgcolor=o,r.paper_bgcolor=o),a||(r.hoverlabel={font:{size:10}}),r.showlegend=!1,r.height=a?40:20,r}const me={backgroundColor:"transparent"},fe={width:"100%",height:"100%"};function C({plotData:t,optionsConfig:a,isTop:e,layoutConfig:o,label:r,xMax:n,colors:s,plotStyle:d=me,style:p=fe,onClick:i}){return l.jsx(U,{style:p,layout:pe(o,{isTop:e,maxValue:n,backgroundColor:d.backgroundColor}),config:a,data:ce(t,r,s),onClick:c=>i?i(c):Y})}try{C.displayName="BarPlot",C.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: Plotly.PlotMouseEvent) => void)"}}}}}catch{}function ye(t,a){const e=B(t);if(!a)return e;a.backgroundColor&&(e.plot_bgcolor=a.backgroundColor),e.yaxis.showgrid=!1,e.yaxis.zeroline=!0,e.yaxis.zerolinecolor="#aeb5bc",e.yaxis.showticklabels=!1,e.xaxis.type==="log"?(e.xaxis.tickformat="f",e.xaxis.range=[-.1,Math.log10(a.maxValue)+.1]):e.xaxis.range=[a.maxValue/50*-1,a.maxValue+30],e.xaxis.visible=a.isXAxis,e.showlegend=a.isLegend,e.margin={t:0,b:a.isXAxis?50:0,l:0,r:0,pad:15};let o=40;return a.isLegend&&(o=35,e.margin.pad=0,e.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},e.yaxis={visible:!1,showline:!1}),a.isXAxis&&(e.yaxis={visible:!1,showgrid:!1,showline:!1},o=50),e.height=o,e}function ge(t,a){const e=new Array(t.length);return a.forEach(o=>{const r=t.indexOf(o.y);r!==-1&&(e[r]=o.x)}),e}function w(t){const a=[],e=(t-1)/2;for(let o=0;o<t;o++)a.push(o-e);return a}function N(t){const a=ie(t,r=>r[0]),e={},o={};return Object.keys(t).forEach(r=>{const n=t[r][0];if(a[n]===1)e[r]=[0];else{o[n]==null&&(o[n]=0);const d=w(a[n])[o[n]];e[r]=[d],o[n]=o[n]+1}}),e}function he(t,a,e,o){const r=e===void 0,n=O(t.map(c=>c.group)),s=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"],d=n.reduce((c,y)=>{const h=r?[-100]:ge(e,t.filter(g=>g.group===y));return{...c,[y]:h}},{}),p=N(d);return n.map((c,y)=>{const h=d[c],g=p[c];return{type:"scatter",x:h,y:g,text:[c],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:c,marker:{color:a.markerFill,line:{color:a.markerLine,width:1},symbol:o?o[c]:s[y],size:a.markerSize}}})}const xe={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},_e={width:"100%",height:"100%"};function b({plotData:t,optionsConfig:a,layoutConfig:e,label:o,id:r,xMax:n,style:s=_e,markerSymbols:d,plotStyle:p=xe,onClick:i,isLegend:c=!1,isXAxis:y=!1}){const h=o?[o]:void 0;return l.jsx(U,{layout:ye(e,{isLegend:c,isXAxis:y,maxValue:n,backgroundColor:p.backgroundColor}),style:s,data:he(t,p,h,d),config:a,onClick:g=>i?i(g):Y},`dotPlot_${r}`)}try{w.displayName="generateCenteredSequence",w.__docgenInfo={description:`Generates a sequence of n numbers centered around 0

Examples:
if n is 4, the result would be [-1.5, -0.5, 0.5, 1.5]
if n is 5 the result would be [-2, -1, 0, 1, 2]`,displayName:"generateCenteredSequence",props:{}}}catch{}try{N.displayName="getYDataForDotPlotOffset",N.__docgenInfo={description:`Returns a set of y values where
 - if an x value is unique, the y value is 0
 - if an x value is repeated, the y value is an offset from 0

This has the effect of preventing overlapping points in a dot plot`,displayName:"getYDataForDotPlotOffset",props:{}}}catch{}try{b.displayName="DotPlot",b.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
  markerFill: '#515359',
  markerLine: '#515359',
  markerSize: 9,
  backgroundColor: 'transparent',
}`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: Plotly.PlotMouseEvent) => void)"}}}}}catch{}const P={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},L={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd",type:"log"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},F={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function q(t,{xField:a,yField:e,groupField:o,entityId:r,whereClause:n,infoField:s}){const d=`SELECT ${a} as "x", ${e} as "y", ${s?s+' as "info", ':""} ${o} as "group"
                 FROM ${r} ${n?" WHERE "+n:""}`;return Z({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:H,entityId:r,query:{sql:d}},t).then(i=>i.queryResult.queryResults)}function S(t,a){const e=t.reduce((r,n)=>(r[n[a]]=(n[a]in r?Number(r[n[a]]):0)+Number(n.x),r),{}),o=[];for(const r in e)o.push({[a]:r,count:e[r]});return o}const V=(t,a)=>{const e=t.points[0].data;let o=e.y[0],r=e.name;return a&&([o,r]=[r,o]),{facetValue:o,type:r,event:t.event}},Pe=(t,a)=>l.jsx("div",{className:"ThemesPlot__barPlotLegend",children:a.map((e,o)=>l.jsxs("div",{style:{float:"left"},children:[l.jsx("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${t?t[e]:"transparent"}`}},"topBar_label"),l.jsx("div",{className:"ThemesPlot__barPlotLegend__graph",children:e},"topBar_graph")," "]},`topBar_${o}`))}),R=(t,a)=>{for(const e in t)t[e]=t[e].replace(",1)",`, ${a})`).replace(",1.0)",`, ${a})`);return t},be=(t,a)=>ue(t.filter(e=>e.y===a).map(e=>e.info));function z({dotPlot:t,topBarPlot:a,sideBarPlot:e,onPointClick:o,onIndividualThemeBarPlotPointClick:r,dotPlotYAxisLabel:n="Research Themes"}){const{accessToken:s}=X(),[d,p]=_.useState(!1),[i,c]=_.useState([]),[y,h]=_.useState([]),[g,I]=_.useState([]);_.useEffect(()=>{const u=q(s,t),m=q(s,a),x=q(s,e);return Promise.all([u,m,x]).then(f=>{c(D(f[0].headers,f[0].rows)),h(D(f[1].headers,f[1].rows)),I(D(f[2].headers,f[2].rows)),p(!0)}).catch(f=>{throw f}),()=>{}},[s,t,a,e]);let A=[],E=[],T=0,$=[],v=[];return d&&(v=S(g,"y"),A=v.sort((u,m)=>m.count-u.count).map(u=>u.y),T=Math.max(...i.map(u=>Number(u.x))),$=M(S(y,"y"),["y"]),E=M(S(y,"group"),["group"]).map(u=>u.group)),l.jsxs(l.Fragment,{children:[!d&&J,d&&l.jsxs("div",{className:"ThemesPlot",children:[l.jsx("div",{className:"ThemesPlot__dotPlotLegend",children:l.jsx(b,{id:"head",plotData:i,isLegend:!0,markerSymbols:t.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:L,optionsConfig:{...P,responsive:!0,staticPlot:!0},plotStyle:{...t.plotStyle,backgroundColor:"transparent"}})}),a.colors&&Pe(a.colors,E),$.map((u,m)=>l.jsxs("div",{className:"ThemesPlot__topBarPlot",children:[l.jsxs("div",{className:"ThemesPlot__topBarPlot__label",children:[u.count,"Â ",de(u.y)]}),l.jsx("div",{className:"ThemesPlot__topBarPlot__plot",children:l.jsx(C,{style:{width:"100%",height:"100%"},layoutConfig:B(F),optionsConfig:{...P},plotData:y,isTop:!0,label:u.y,xMax:u.count,onClick:x=>o(V(x,!0)),colors:m%2===0?a.colors:R({...a.colors},"1")})})]},`topBarDiv_${m}`)),l.jsxs("div",{style:{display:"flex",position:"relative"},children:[l.jsx("div",{className:"ThemesPlot__dotPlotYLabel",children:n}),l.jsxs("div",{className:"ThemesPlot__dotPlot",children:[A.map((u,m)=>{var x,f;return l.jsxs("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:(x=t.plotStyle)==null?void 0:x.backgroundColor},children:[l.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",children:l.jsx(ae,{title:`${be(i,u)} `,placement:"right",children:l.jsxs("div",{children:[l.jsx("span",{className:"ThemesPlot__dotPlot__themeLabel",children:u}),l.jsx("br",{}),l.jsxs("span",{className:"ThemesPlot__dotPlot__countLabel",children:[v[m].count," ",e.countLabel]}),l.jsx("br",{}),l.jsx(C,{style:{width:"100%"},layoutConfig:F,optionsConfig:P,plotData:g,isTop:!1,xMax:v[m].count,label:u,colors:R({...a.colors},"1"),onClick:k=>{r&&r(V(k,!1))}})]})})}),l.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:l.jsx("div",{style:{width:"100%",backgroundColor:(f=t.plotStyle)==null?void 0:f.backgroundColor},children:l.jsx(b,{id:`${m}`,onClick:k=>{const{type:Q,event:G}=V(k,!1);o({facetValue:u,type:Q,event:G})},plotData:i,plotStyle:t.plotStyle,markerSymbols:t.markerSymbols,xMax:T,label:u,layoutConfig:L,optionsConfig:{...P,responsive:!1}})})})]},`plotDiv_${+m}`)}),l.jsxs("div",{className:"ThemesPlot__dotPlot__row",children:[l.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),l.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:l.jsx(b,{id:"footer",plotData:i,isXAxis:!0,xMax:T,layoutConfig:L,optionsConfig:{...P,responsive:!1}})})]})]})]}),l.jsx("div",{})]})]})}try{z.displayName="ThemesPlot",z.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},onIndividualThemeBarPlotPointClick:{defaultValue:null,description:"",name:"onIndividualThemeBarPlotPointClick",required:!1,type:{name:"(({ facetValue, type, event, }: ClickCallbackParams) => void)"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}export{z as T,le as c,ue as h,de as u};
