var D=t=>{throw TypeError(t)};var S=(t,e,s)=>e.has(t)||D("Cannot "+s);var a=(t,e,s)=>(S(t,e,"read from private field"),s?s.call(t):e.get(t)),v=(t,e,s)=>e.has(t)?D("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),b=(t,e,s,r)=>(S(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(S(t,e,"access private method"),s);import{r as x}from"./index-Dl6G-zuu.js";import{au as j,av as B,aw as J,ax as _,o as K,ay as N,az as T,aA as V,aB as X,aC as Y,aD as F,aE as I,aF as Z,aG as $}from"./SynapseClient-_diANZ_z.js";function U(t,e){return t.filter(s=>!e.includes(s))}function W(t,e,s){const r=t.slice(0);return r[e]=s,r}var R,E,w,f,H,C,c,M,A,P,k,z,G,ee=(G=class extends j{constructor(e,s,r){super();v(this,c);v(this,R);v(this,E);v(this,w);v(this,f);v(this,H);v(this,C);b(this,R,e),b(this,w,[]),b(this,f,[]),p(this,c,M).call(this,[]),this.setQueries(s,r)}onSubscribe(){this.listeners.size===1&&a(this,f).forEach(e=>{e.subscribe(s=>{p(this,c,k).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,f).forEach(e=>{e.destroy()})}setQueries(e,s,r){b(this,w,e),b(this,H,s),B.batch(()=>{const n=a(this,f),i=p(this,c,P).call(this,a(this,w));i.forEach(h=>h.observer.setOptions(h.defaultedQueryOptions,r));const u=i.map(h=>h.observer),d=u.map(h=>h.getCurrentResult()),Q=u.some((h,g)=>h!==n[g]);n.length===u.length&&!Q||(b(this,f,u),p(this,c,M).call(this,d),this.hasListeners()&&(U(n,u).forEach(h=>{h.destroy()}),U(u,n).forEach(h=>{h.subscribe(g=>{p(this,c,k).call(this,h,g)})}),p(this,c,z).call(this)))})}getCurrentResult(){return a(this,C)}getQueries(){return a(this,f).map(e=>e.getCurrentQuery())}getObservers(){return a(this,f)}getOptimisticResult(e,s){const r=p(this,c,P).call(this,e),n=r.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[n,i=>p(this,c,A).call(this,i??n,s),()=>r.map((i,u)=>{const d=n[u];return i.defaultedQueryOptions.notifyOnChangeProps?d:i.observer.trackResult(d)})]}},R=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,H=new WeakMap,C=new WeakMap,c=new WeakSet,M=function(e){var s;b(this,E,e),b(this,C,p(this,c,A).call(this,e,(s=a(this,H))==null?void 0:s.combine))},A=function(e,s){return s?J(a(this,C),s(e)):e},P=function(e){const s=a(this,f),r=new Map(s.map(o=>[o.options.queryHash,o])),n=e.map(o=>a(this,R).defaultQueryOptions(o)),i=n.flatMap(o=>{const y=r.get(o.queryHash);return y!=null?[{defaultedQueryOptions:o,observer:y}]:[]}),u=new Set(i.map(o=>o.defaultedQueryOptions.queryHash)),d=n.filter(o=>!u.has(o.queryHash)),Q=o=>{const y=a(this,R).defaultQueryOptions(o);return a(this,f).find(l=>l.options.queryHash===y.queryHash)??new _(a(this,R),y)},h=d.map(o=>({defaultedQueryOptions:o,observer:Q(o)})),g=(o,y)=>n.indexOf(o.defaultedQueryOptions)-n.indexOf(y.defaultedQueryOptions);return i.concat(h).sort(g)},k=function(e,s){const r=a(this,f).indexOf(e);r!==-1&&(p(this,c,M).call(this,W(a(this,E),r,s)),p(this,c,z).call(this))},z=function(){B.batch(()=>{this.listeners.forEach(e=>{e(a(this,E))})})},G);function ne({queries:t,...e},s){const r=K(),n=N(),i=T(),u=x.useMemo(()=>t.map(l=>{const m=r.defaultQueryOptions(l);return m._optimisticResults=n?"isRestoring":"optimistic",m}),[t,r,n]);u.forEach(l=>{V(l),X(l,i)}),Y(i);const[d]=x.useState(()=>new ee(r,u,e)),[Q,h,g]=d.getOptimisticResult(u,e.combine);x.useSyncExternalStore(x.useCallback(l=>n?()=>{}:d.subscribe(B.batchCalls(l)),[d,n]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),x.useEffect(()=>{d.setQueries(u,e,{listeners:!1})},[u,e,d]);const y=Q.some((l,m)=>F(u[m],l))?Q.flatMap((l,m)=>{const O=u[m];if(O){const L=new _(r,O);if(F(O,l))return I(O,L,i);Z(l,n)&&I(O,L,i)}return[]}):[];if(y.length>0)throw Promise.all(y);const q=Q.find((l,m)=>{const O=u[m];return O&&$({result:l,errorResetBoundary:i,throwOnError:O.throwOnError,query:r.getQueryCache().get(O.queryHash)})});if(q!=null&&q.error)throw q.error;return h(g())}export{ne as u};
