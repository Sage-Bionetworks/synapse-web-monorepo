var qp=Object.defineProperty;var Dp=(e,a,u)=>a in e?qp(e,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[a]=u;var pe=(e,a,u)=>Dp(e,typeof a!="symbol"?a+"":a,u);import{j0 as Vp,j1 as ec,di as Kt,r as L,h1 as Bp,j2 as Lp,j3 as $p,j4 as Fp,ii as tc,j as q,B as Oa,at as fn,aF as at,aE as sh,dk as Jp,j5 as Up,ds as zp,d6 as Gp,J as xt,j6 as Wp,j7 as Hp,eO as Kp,c1 as Xp,j8 as Yp,j9 as Qp,bB as dn,c3 as oh,et as F,cT as Zp,ja as e0,cv as nc,c9 as ln,c6 as xa,dJ as t0,b$ as n0,h_ as r0,bq as i0,ay as s0}from"./iframe-kh7i1csa.js";import{w as bs}from"./waitForAsyncResult-V4_ZeFtV.js";import{r as o0,u as Ra}from"./useEntity-C1yyUaFg.js";import"./ErrorPage-D_peXPty.js";import"./AccessTokenPage-j_Rw5FER.js";import"./AccountLevelBadges-BKrSzZUq.js";import"./CardContainerLogic-C7OYBiDA.js";import"./RowDataTable-BxQiBfu6.js";import"./RowDataTableWithQuery-Bk91M2mc.js";import"./MarkdownPopover-4Eys4uDE.js";import"./SkeletonButton-B_CN37W2.js";import"./SkeletonInlineBlock-ClnumZW6.js";import{S as a0}from"./SkeletonTable-BqcwQAxC.js";import"./SkeletonParagraph-BnqUYHvv.js";import"./CertificationAnswer-Cf6LtSLA.js";import"./ChallengeDetailPage-D7MmpFkI.js";import"./index-Dbctw6wH.js";import"./AvailableEvaluationQueueList-BUWU2fRH.js";import"./ChallengeSubmission-BaCNV_93.js";import"./ChangePassword-BBtw7dar.js";import"./ChangePasswordWithToken-FHhPxg9w.js";import"./ConfirmationDialog-BNscjmOg.js";import"./CookiesNotification-BdHVEJB6.js";import"./DownloadCartPage-TLGcR2UC.js";import"./ShowDownloadV2-DmqXM4-D.js";import"./DynamicForm-BWpcSzHT.js";import"./EntityBadgeIcons-Drh5gHWV.js";import"./EntityFinder-DoHFKVle.js";import"./EvaluationCard-m51fu8qP.js";import"./EvaluationEditorPage-BPLGcPI5.js";import"./ExperimentalMode-BtaNDiEu.js";import"./FileUpload-DX6JWbt3.js";import"./FeaturedDataTabs-BoVRib3G.js";import"./FeaturedToolsList-UqV5r6ie.js";import"./DiscussionThread-uE2ok2Dm.js";import"./ForumPage-01VOIPo9.js";import"./SynapseCardLabel-CLF-0w5E.js";import"./GenericCard-BalvQbFH.js";import"./HeaderCardV2-DZRmnoXj.js";import"./CardUtils-BibhDNF-.js";import"./Goals-CgRX-ZG_.js";import"./GoalsV2-BeLQz5P5.js";import"./GoogleMap-S8wDq5Jh.js";import"./HasAccessV2-o76awKIs.js";import"./Icon-C3YRkKaC.js";import"./MarkdownCollapse-Bj0AvClT.js";import"./MarkdownEditor-CJU0hJCN.js";import"./MarkdownGithub-DGbTM_2K.js";import"./ModalDownload-BujnnYmE.js";import"./InfiniteTableLayout-BYKMGJEM.js";import"./CopyToClipboardInput-6EHPUie6.js";import"./DialogBase-BL1IBdld.js";import"./WarningDialog-CzOQlllN.js";import"./ColumnHeader-Bqc1J4k9.js";import"./StyledTanStackTable-BjAO_O_7.js";import"./OAuthAclEditorModal-DzyBtyoI.js";import"./ThemesPlot-DhDNYsNd.js";import"./UpsetPlot-DdX73qsz.js";import"./SynapsePlot-DSL6PQzf.js";import"./Programs-C_8E028x.js";import"./ProvenanceGraph-Cdy0I91L.js";import"./ProjectDataAvailability-EPw4Vh9U.js";import"./QueryContext-DwB-ZAM3.js";import"./QueryCount-BRB40RR6.js";import"./QueryWrapper-paYef-Bw.js";import"./RegisterPageLogoutPrompt-C1TCblAS.js";import"./RenderIfInView-BNPx8VCE.js";import"./Resources-BxIPZprt.js";import"./AccessRequirementAclEditor-BGD3JEqG.js";import"./RssFeedCards-DWDtruA7.js";import"./ShowMore-fM6FiebQ.js";import"./LightTooltip-CpgsJh3_.js";import"./WideButton-XD2RZUH-.js";import"./InputSizedButton-CgmOmzQ_.js";import"./DropdownSelect-ri1bsek8.js";import"./SubscriptionItem-Cj73KdCS.js";import"./SubsectionRowRenderer-N-tjDrah.js";import"./SynapseFormWrapper-7-ZGz9eV.js";import"./SynapseFormSubmissionGrid-BdxsMYpY.js";import"./SynapseTable-D8xKNfxA.js";import{S as c0,a as l0}from"./SynapseChat-DRXXWJSG.js";import"./TableFeedCards-odv-jeD-.js";import"./TermsAndConditions-DEewYJi_.js";import"./UserBadge-CdRmIen3.js";import"./UserCardListRotate-DCk5B2gL.js";import"./UserCardListGroups-CGZXT2Sj.js";import"./UserOrTeamBadge-lWvXpb5L.js";import"./UserProfileLinks-C83DO-Zh.js";import"./EntityHeaderTable-CbSMCoRq.js";import"./AccessRequirementRelatedProjectsList-COClvTC3.js";import"./HelpPopover-BJBDK_g9.js";import"./SageResourcesPopover-RtXZtUlZ.js";import"./RecentPublicationsGrid-Bv8R1syF.js";import"./ImageCardGridWithLinks-C62baHov.js";import"./PortalFeatureHighlights-CBmpeWDs.js";import"./PortalSectionHeader-DW7lLQMf.js";import{b as u0}from"./useSchema-Cm8En2e_.js";import{C as d0}from"./CsvPreviewDialog-BMxEkhhZ.js";import{u as f0}from"./upperFirst-f9qG6sZG.js";import{B as rc,P as h0}from"./enums-BfA0Jntc.js";import{a as ah,d as Te}from"./index-r8ZA1smB.js";import{g as p0}from"./_baseIteratee-CNSij9QJ.js";import{r as hn,c as ch}from"./index-Dy0fAFKr.js";import{t as m0}from"./useUploadFiles-D38VA07z.js";import{r as lh}from"./index-DD-jbIpn.js";import{K as ic}from"./CitationPopoverContent-CqnFxwcA.js";import{M as Ji}from"./MenuItem-CfQGt1HR.js";import{u as b0,a as v0,b as g0,c as y0}from"./useGridSession-C8w5nKBn.js";import{G as Oe}from"./Grid-nnrsqVv6.js";import{A as Ia}from"./Autocomplete-DxWBSpdz.js";import{C as _0}from"./Chip-BOVRxSkP.js";import{D as w0}from"./DraggableDialog-CU7V-twl.js";import"./pickBy-COpr4INF.js";import"./isString-BzYB4S-B.js";import"./useQueries-gSpjMszZ.js";import"./queryOptions-C9woPjwX.js";import"./useInfiniteQuery-DYbKlyxH.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-DJ7rMmas.js";import"./useDOI-DpfZD0me.js";import"./useMessage-DoivTT7q.js";import"./relativeTime-DWzL5P1y.js";import"./Card-CcySjyv2.js";import"./FormControlLabel-BdtGU7On.js";import"./Checkbox-BwE9-nDN.js";import"./SwitchBase-jMUczUFb.js";import"./AccountLevelBadge-DdeXzrys.js";import"./UserSearchBoxV2-Ca-x9gNQ.js";import"./useDebouncedEffect-TX9PC0FH.js";import"./use-deep-compare-effect.esm-B88DIzUC.js";import"./uniq-C6C8K34y.js";import"./without-B_273GKB.js";import"./Select-aab027f3.esm-CSUHZq12.js";import"./defineProperty-CegpTSss.js";import"./JsonSchemaForm-D0j_H30P.js";import"./GridLegacy-ZqbjlI9w.js";import"./HelpTwoTone-BYWYybOB.js";import"./ContentCopy-DfsnV8dz.js";import"./Close-Cx-5EQFG.js";import"./ArrowUpward-BPS5Aqed.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./groupBy-3vHGIfxQ.js";import"./_createAggregator-ClyW0yBd.js";import"./_baseEach-C-q0c1u0.js";import"./_baseMap-BsEQLRd5.js";import"./ListItem-CarGqENm.js";import"./listItemButtonClasses-CHWCFeWd.js";import"./DateTimePicker-6ffwWj2o.js";import"./useMobilePicker-blMy10o-.js";import"./index-C-_p9hnQ.js";import"./index-Chjiymov.js";import"./visuallyHidden-Dan1xhjv.js";import"./InputAdornment-BAgkfdty.js";import"./index-BmXyVNEx.js";import"./Tabs-DQ_VL4oy.js";import"./KeyboardArrowRight-CM4chgR1.js";import"./GenericCardIcon-Cbc8Wn7D.js";import"./index-CSyWWe2M.js";import"./ImageFileHandle-Dry5jxkq.js";import"./index-DiG87GFc.js";import"./CopyToClipboardIcon-Dg_B8b1V.js";import"./CreateOrUpdateDoiModal-DIbnPBev.js";import"./ConfirmCloseWithoutSavingDialog-ClIwr531.js";import"./SynapseTableUtils-CcQCTeFo.js";import"./CardGridWithLinks-Bkj0h08Y.js";import"./useDownloadList-D2qxBtG8.js";import"./CTASectionWrapper-qyfKLBGo.js";import"./GoalsV3-DX7w9bRY.js";import"./ExpandableContent-ByTdRT3A.js";import"./CardActionArea-BPK8J8Qc.js";import"./ProgrammaticInstructionsModal-DUsftEN2.js";import"./TableRowSelectionState-CPI4HtU7.js";import"./ExportToAnalysisPlatformDialog-DOEP8CrQ.js";import"./WizardChoiceButtonGroup-K4sqfF_4.js";import"./ActionRequiredListItem-CLtCqo8t.js";import"./differenceWith-CQBjKuot.js";import"./MeetAccessRequirementCard-OO8DbUdb.js";import"./useAccessRequirements-C0APFYXT.js";import"./_baseOrderBy-CqcX2iUX.js";import"./AccessRequirementList-BbKMeHeZ.js";import"./EntityLink-CRKbnt2E.js";import"./useGetEntityHeaders-Bg1AMix9.js";import"./EntityIcon-DnGNi4QV.js";import"./ErrorChip-BkFZ21y1.js";import"./UnmanagedACTAccessRequirementItem-CxnOBLbb.js";import"./MarkdownSynapse-BXo153sN.js";import"./RequirementItem-BMTDSSKp.js";import"./LockTwoTone-B42v6zCl.js";import"./ManagedACTAccessRequirementItemView-q8E0y0YU.js";import"./SelfSignAccessRequirementItem-7OZwv2lW.js";import"./DataAccessRequestAccessorsFilesForm-DSuposlY.js";import"./useDataAccessSubmission-DKlZftXy.js";import"./RadioGroup-BVYEgdFY.js";import"./Radio-B0W9sHa3.js";import"./FormGroup-QCZKBm1U.js";import"./UploadDocumentField-CgoKlP6X.js";import"./ManagedACTAccessRequirementFormWikiWrapper-4oDqVOQ8.js";import"./ResearchProjectForm-D5zJGLA_.js";import"./TextFieldWithWordLimit-DwDggd8V.js";import"./AuthenticatedRequirement-0MQNKy1V.js";import"./CertificationRequirement-BUCYznfp.js";import"./TwoFactorAuthEnabledRequirement-hgpK31kZ.js";import"./ValidationRequirement-sCPk0e-t.js";import"./ActionRequiredCard-BCyEa24d.js";import"./RequestDownloadCard-DpFWu9Uy.js";import"./useGetFeatureFlag-DYR8ZiI5.js";import"./EntityAclEditorModal-Df-mwjNm.js";import"./AccessControlListUtils-B6hVWU7E.js";import"./AclEditor-B0gvTzNS.js";import"./IconSvgButton-B0BhcpsN.js";import"./useUpdateAcl-CqY_X4rJ.js";import"./OpenData-Barc6GLT.js";import"./EnableTwoFaRequirementCard-BpX602wt.js";import"./pluralize-Dtp1DlEB.js";import"./SynapseTableConstants-2qH3fDlQ.js";import"./RowSelectionUI-MI9CLOR3.js";import"./Badge-D2zypvOl.js";import"./usePreviousProps-iOEW2BmJ.js";import"./DownloadLoginModal-C5Iuj5Zx.js";import"./SelectionCriteriaPill-Cq5O-P_Z.js";import"./ColorGradient-Zy7TAKxK.js";import"./colorPalette-BALeOMsp.js";import"./Box-B6rfJ0Q8.js";import"./Plot-DtJnQ60o.js";import"./index-Dr0gyuLW.js";import"./index-CGf53PYD.js";import"./index-J8GyMrSI.js";import"./CardMedia-CCtrruj9.js";import"./DownloadConfirmationUI-DlQ14rib.js";import"./duration-DQ1NfnzY.js";import"./DownloadConfirmationUtils-CFeN1C-4.js";import"./IconList-DUUd8Cgy.js";import"./ShareThisPage-BKMyLGps.js";import"./index-Bqgf_cuw.js";import"./DataGrid-B_JTg7d5.js";import"./index-DB0Fz1zf.js";import"./Switch-BYa_KKAR.js";import"./ListItemIcon-BUFEjsaO.js";import"./ListItemText-BOLkHArO.js";import"./extends-CF3RwP-h.js";import"./StyledTableContainer-ByhoXqLL.js";import"./useGetEntityChallenge-CWWeTVEK.js";import"./useTeamMembers-DQTKlTVH.js";import"./useGetUserTeams-BtnfYzQH.js";import"./ChallengeRegisterButton-B9Pqg1YF.js";import"./ExitToApp-BwPGDcEa.js";import"./SpinnerButton-BZ7QVMtk.js";import"./LoginAwareButton-DTGrJDWW.js";import"./ChallengeTeamWizard-D0osD_Bb.js";import"./CreateChallengeTeam-BVbZueW_.js";import"./useTeam-D456FB5P.js";import"./papaparse.min-D1KxGBLm.js";import"./Search-Bm9_rp2A.js";import"./useEntitySelection-Bdp1KE-T.js";import"./useGetEntityChildren-CqZ2o1O4.js";import"./ModifiedOnCell-BpOpXED7.js";import"./FileEntityDirectDownload-CfGR0M5T.js";import"./DirectDownload-Deyy1sNP.js";import"./immutable.es-BJjDfH8f.js";import"./StepperDialog-CGHwHsVz.js";import"./useEvaluation-44j-PK0F.js";import"./useChangePasswordFormState-B4vQAOoT.js";import"./InteractiveCopyIdsIcon-Do3srLt5.js";import"./AnnotationsTable-BCeiFPMi.js";import"./EntityModal-CT1InWXq.js";import"./SchemaDrivenAnnotationEditor-D5Mnwiyd.js";import"./TextWidget-CD95ddgT.js";import"./FileHandleUtils-Bvi0HF8i.js";import"./useFavorites-D298hefw.js";import"./NoSearchResults-BvwaaAD9.js";import"./useSearch-BCZzMZNN.js";import"./index.esm-B6HudkYd.js";import"./CreatedOnByUserDiv-dp2QRmMT.js";import"./CardContent-CozA0oOL.js";import"./index.prod-eXiTZ_5J.js";import"./EnumFacetFilter-CGhutdfD.js";import"./EnumFacetFilterSkeleton-kubRTSdy.js";import"./EnumFacetFilterUI-C6M_MbF6.js";import"./FacetFilterHeader-fQroga9b.js";import"./RangeFacetFilterUI-DmPLmiO4.js";import"./RangeSlider-UKN-R4nG.js";import"./Slider-XGev_dqK.js";import"./NoContentAvailable-DGR0-p5l.js";import"./ForumThreadEditor-CH_2-Awq.js";import"./useThread-D0elq4Nj.js";import"./useSubscription-BjWCzCeA.js";import"./SubscribersModal-CZUh80wx.js";import"./useForum-tMa7JXzv.js";import"./getValidReactChildren-BHuupMCD.js";import"./HeaderCard-BmwV-12i.js";import"./SustainabilityScorecard-DVTvlNWn.js";import"./Dial-BdP7XGnF.js";import"./CheckIcon-CNlvlW8G.js";import"./FileHandleLink-BY1UVUYk.js";import"./NavigateNext-CeMi2iLx.js";import"./mouse-DMznIvcE.js";import"./SortDown-CUo4xl9k.js";import"./_arrayReduce-CrxnWFSq.js";import"./Container-DOe2liAo.js";import"./SynapseFormRadioWidget-B48XApW9.js";import"./ExpandCollapseButton-CPUkPtL6.js";import"./OAuthClientAclEditor-jkvzULdN.js";import"./unCamelCase-ZiU_emRy.js";import"./head-aneRfQQJ.js";import"./LargeButton-B6nSpfUG.js";import"./forEach-B8iwwgef.js";import"./NoData-B98M_jrd.js";import"./index-CXa248OQ.js";import"./index-B0mkPNCX.js";import"./SageFullLogo-BFpGvyrU.js";import"./index-DeHyV-bG.js";import"./events-DQ172AOg.js";import"./Topic-Bvj_ZEds.js";import"./_stringToArray-DTAGKDJL.js";import"./types-CP9zjM1W.js";import"./SynapseTableCell-P7eIZWia.js";import"./TeamBadge-Cl2ueHwO.js";import"./EntityFinderModal-Dm9SMM4V.js";import"./EntityHeaderTableCellRenderers-ObcToZbT.js";import"./Slide-Ka8W1RBl.js";import"./CsvTableDescriptorForm-C4RURjPL.js";import"./AccordionSummary-B_0K0Ftr.js";import"./FileUploadProgress-XSTXfMx5.js";var Ts=function(){return Vp.Date.now()},C0="Expected a function",S0=Math.max,E0=Math.min;function O0(e,a,u){var d,r,c,t,s,n,o=0,i=!1,l=!1,p=!0;if(typeof e!="function")throw new TypeError(C0);a=ec(a)||0,Kt(u)&&(i=!!u.leading,l="maxWait"in u,c=l?S0(ec(u.maxWait)||0,a):c,p="trailing"in u?!!u.trailing:p);function h(C){var E=d,O=r;return d=r=void 0,o=C,t=e.apply(O,E),t}function v(C){return o=C,s=setTimeout(f,a),i?h(C):t}function y(C){var E=C-n,O=C-o,S=a-E;return l?E0(S,c-O):S}function g(C){var E=C-n,O=C-o;return n===void 0||E>=a||E<0||l&&O>=c}function f(){var C=Ts();if(g(C))return m(C);s=setTimeout(f,y(C))}function m(C){return s=void 0,p&&d?h(C):(d=r=void 0,t)}function b(){s!==void 0&&clearTimeout(s),o=0,d=n=r=s=void 0}function _(){return s===void 0?t:m(Ts())}function w(){var C=Ts(),E=g(C);if(d=arguments,r=this,n=C,E){if(s===void 0)return v(n);if(l)return clearTimeout(s),s=setTimeout(f,a),h(n)}return s===void 0&&(s=setTimeout(f,a)),t}return w.cancel=b,w.flush=_,w}var x0="Expected a function";function R0(e,a,u){var d=!0,r=!0;if(typeof e!="function")throw new TypeError(x0);return Kt(u)&&(d="leading"in u?!1:d,r="trailing"in u?!0:r),O0(e,a,{leading:d,maxWait:a,trailing:r})}function I0(e=!1){const a=L.useRef(e),u=L.useCallback(()=>a.current,[]);return L.useEffect(()=>(a.current=!0,()=>{a.current=!1}),[]),u}function N0(e){L.useEffect(()=>{e()},[])}function k0(e,...a){const u=I0(),d=Bp(a[1]),r=L.useMemo(()=>function(...c){u()&&(typeof d.current=="function"?d.current.apply(this,c):typeof d.current.handleEvent=="function"&&d.current.handleEvent.apply(this,c))},[]);L.useEffect(()=>{const c=A0(e)?e.current:e;if(!c)return;const t=a.slice(2);return Lp(c,a[0],r,...t),()=>{$p(c,a[0],r,...t)}},[e,a[0]])}function A0(e){return e!==null&&typeof e=="object"&&Fp(e,"current")}const js=()=>document.visibilityState==="visible";function T0(e=!0){const[a,u]=L.useState(tc&&e?js():void 0);return N0(()=>{e||u(js())}),k0(tc?document:null,"visibilitychange",()=>{u(js())}),a}const j0="_button_kn52w_16",P0={button:j0};function Xt(e){return q.jsx(Oa,{...e,className:P0.button})}try{Xt.displayName="GridMenuButton",Xt.__docgenInfo={description:"",displayName:"GridMenuButton",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function M0(e){const{synapseClient:a}=fn();return at({...e,mutationFn:async u=>{const d=await a.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:u});return(await bs(()=>a.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:d.token}))).responseBody}})}function q0(e){const{keyFactory:a,synapseClient:u}=fn(),d=sh();return at({...e,mutationFn:async r=>{const c=await u.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:r.entityId,tableUpdateTransactionRequest:r});return(await bs(()=>u.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:c.token}))).responseBody},onSuccess:async(r,c,t)=>{await Jp(d,a,c.entityId)}})}function D0(e){const a=sh(),{mutateAsync:u}=M0(),{mutateAsync:d}=q0(),r=o0();return at({...e,mutationFn:async({gridSessionId:c,sourceEntityId:t})=>{const s=await a.fetchQuery(r(t)),n={...V0(s),sessionId:c},o=await u(n),i={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:t,changes:[{uploadFileHandleId:o.resultsFileHandleId,tableId:t,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return d(i)}})}function V0(e){return Up(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}function B0(e){const{synapseClient:a}=fn();return at({...e,mutationFn:async({gridSessionId:u})=>{const d={sessionId:u,concreteType:"org.sagebionetworks.repo.model.grid.GridRecordSetExportRequest"},r=await a.gridServicesClient.postRepoV1GridExportRecordsetAsyncStart({gridRecordSetExportRequest:d});return(await bs(()=>a.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:r.token}))).responseBody}})}function L0(e){const a=D0(),u=B0();return at({...e,mutationFn:async({gridSessionId:d,sourceEntityId:r,sourceEntityType:c})=>c===zp.recordset?{type:"recordset",data:await u.mutateAsync({gridSessionId:d})}:{type:"table",data:await a.mutateAsync({gridSessionId:d,sourceEntityId:r})}})}function aa(e){const{sourceEntityId:a,gridSessionId:u}=e,{data:d,isLoading:r}=Ra(a),c=d!=null&&d.concreteType?Gp(d.concreteType):void 0,{mutate:t,isPending:s}=L0({onSuccess:n=>{n.type==="table"?$0(n.data):xt("Successfully updated RecordSet.","success")},onError:n=>xt(n.message,"danger")});return q.jsx(Xt,{loading:s,disabled:r,onClick:()=>t({gridSessionId:u,sourceEntityId:a,sourceEntityType:c}),variant:"contained",children:"Apply changes"})}function $0(e){var a,u;if((a=e.results)!=null&&a.length){const d=e.results[0];if(Wp(d)){const r=F0(d).join(`
`);r?xt(`Some changes could not be applied:
${r}`,"danger"):xt("Changes applied successfully","success")}else if(Hp(d)){const r=(u=d.rowsProcessed)==null?void 0:u.toLocaleString();xt(`Successfully updated ${r} rows.`,"success")}}}function F0(e){var a;return((a=e.updateResults)==null?void 0:a.filter(u=>!!u.failureCode).map(u=>`${u.entityId}: ${u.failureMessage} (code: ${u.failureCode})`))??[]}try{aa.displayName="MergeGridWithSourceTableButton",aa.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},sourceEntityType:{defaultValue:null,description:"",name:"sourceEntityType",required:!1,type:{name:"enum",value:[{value:'"link"'},{value:'"table"'},{value:'"file"'},{value:'"folder"'},{value:'"entityview"'},{value:'"submissionview"'},{value:'"dataset"'},{value:'"datasetcollection"'},{value:'"project"'},{value:'"dockerrepo"'},{value:'"materializedview"'},{value:'"virtualtable"'},{value:'"recordset"'}]}}}}}catch{}function J0(e,a){const u={},d=a.api.getSnapshot();if(sc(d.rows,e.min.row,e.max.row))u.rowSelectAll=!0;else{const r=a.api.arr(["rows"]);u.rowSelection=oc(r,e.min.row,e.max.row)}if(sc(d.columnOrder,e.min.col,e.max.col))u.columnSelectAll=!0;else{const r=a.api.arr(["columnOrder"]);u.columnSelection=oc(r,e.min.col,e.max.col)}return u}function sc(e,a,u){return a===0&&u===e.length-1}function oc(e,a,u){const d=[];for(let r=a;r<=u;r++){const{node:c}=e.get(r);d.push({rep:c.id.sid,seq:c.id.time})}return d}const uh="__rowKey",U0=e=>{const a=e.trim();if(a){if(a.toUpperCase().startsWith("SELECT"))return{type:"sql",input:a};if(Kp.test(a))return{type:"recordSetId",input:a};if(/^[A-Za-z]\w*=+$/.test(a))return{type:"sessionId",input:a}}else return{type:"empty",input:""};return{type:"unknown",input:a}};function z0(e,a){const u=Object.keys(e),d=Object.keys(a);if(u.length!==d.length)return!1;for(const r of u){const c=e[r],t=a[r],s=n=>n==null||n==="";if(!(s(c)&&s(t))&&String(c)!==String(t))return!1}return!0}function G0(e,a,u){function d(r){if(r.type==="UPDATE"){const c=a.slice(r.fromRowIndex,r.toRowIndex),t=e.slice(r.fromRowIndex,r.toRowIndex);return c.map((n,o)=>z0(n,t[o])).every(Boolean)}return!1}return u.filter(r=>!d(r))}function W0(e){return`[${e.sid},${e.time}]`}function H0(e){const a=new Map,u=/^#\/([^/:]+)(?:\/\d+)?:\s*(.*)$/;for(const d of e){if(typeof d!="string")continue;const c=d.trimStart().match(u);if(c){const t=c[1].trim(),s=c[2].trim();a.has(t)||a.set(t,[]),a.get(t).push(s)}}return a}function K0(e,a){if(!e||!a)return[];const{columnNames:u,columnOrder:d,rows:r}=a;return r.map(t=>{var n,o;const s={};return d.forEach(i=>{const l=u[i];l&&(s[l]=t.data[i])}),s[uh]=W0(e.api.obj(["rows",String(r.indexOf(t))]).node.id),s.__validationResults=(n=t.metadata)==null?void 0:n.rowValidation,(o=s.__validationResults)!=null&&o.allValidationMessages&&(s.__cellValidationResults=H0(s.__validationResults.allValidationMessages)),s})}function X0(e){const{synapseClient:a}=fn();return at({...e,mutationFn:async u=>{const d=await a.gridServicesClient.postRepoV1GridImportCsvAsyncStart({gridCsvImportRequest:u});return(await bs(()=>a.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:d.token}))).responseBody}})}function ca({createdCount:e=0,updatedCount:a=0}){let u="";return e>0&&(u+=`created ${e.toLocaleString()} rows`),e>0&&a>0?u+=" and ":a==0&&(u+="."),a>0&&(u+=`updated ${a.toLocaleString()} rows.`),f0(u)}function la(e){const{gridSessionId:a,open:u,onClose:d,onComplete:r}=e,{mutate:c,isPending:t,error:s}=X0({onSuccess:n=>{xt(ca(n),"success",{title:"Data imported successfully"}),r()}});return q.jsx(d0,{open:u,onClose:d,onConfirm:(n,o,i)=>{c({concreteType:"org.sagebionetworks.repo.model.grid.GridCsvImportRequest",sessionId:a,fileHandleId:n,csvDescriptor:i,schema:o})},errorMessage:s==null?void 0:s.message,confirmIsPending:t})}try{ca.displayName="getUpdateMessage",ca.__docgenInfo={description:"",displayName:"getUpdateMessage",props:{concreteType:{defaultValue:null,description:"@memberof GridCsvImportResponse",name:"concreteType",required:!0,type:{name:"{string}"}},sessionId:{defaultValue:null,description:`The grid session ID.
@memberof GridCsvImportResponse`,name:"sessionId",required:!1,type:{name:"{string}"}},totalCount:{defaultValue:null,description:`The total number of processed rows.
@memberof GridCsvImportResponse`,name:"totalCount",required:!1,type:{name:"{number}"}},createdCount:{defaultValue:{value:"0"},description:`The number of newly created rows in the grid.
@memberof GridCsvImportResponse`,name:"createdCount",required:!1,type:{name:"{number}"}},updatedCount:{defaultValue:{value:"0"},description:`The number of updated rows in the grid.
@memberof GridCsvImportResponse`,name:"updatedCount",required:!1,type:{name:"{number}"}}}}}catch{}try{la.displayName="UploadCsvToGridDialog",la.__docgenInfo={description:"",displayName:"UploadCsvToGridDialog",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onComplete:{defaultValue:null,description:"",name:"onComplete",required:!0,type:{name:"() => void"}}}}}catch{}function ua(e){const{sourceEntityId:a,gridSessionId:u}=e,[d,r]=L.useState(!1),{data:c,isLoading:t}=Ra(a);return t?q.jsx(Xp,{variant:"rectangular",width:100}):c&&!Yp(c)?null:q.jsxs(q.Fragment,{children:[d&&q.jsx(la,{gridSessionId:u,open:d,onClose:()=>r(!1),onComplete:()=>r(!1)}),q.jsx(Xt,{onClick:()=>{r(!0)},variant:"outlined",startIcon:q.jsx(Qp,{}),children:"Upload"})]})}try{ua.displayName="UploadCsvToGridButton",ua.__docgenInfo={description:"",displayName:"UploadCsvToGridButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}function Y0(e){return Kt(e)&&"type"in e&&(e.type=="null"||oh(e.type,["null"]))}function dh(e){if(e!=null&&e.oneOf&&dn(e.oneOf)){const a=e.oneOf.filter(u=>!Y0(u));if(a.length==1&&Kt(a[0]))return a[0]}}function Q0(e){return{value:e.value}}function Z0(e){return dn(e)&&e.every(a=>Kt(a)&&"const"in a)}function ac(e){let a=[];try{if(e!=null&&e.oneOf&&dn(e.oneOf)&&!Z0(e.oneOf)){const u=dh(e);u&&Object.hasOwn(u,"enum")&&(a=rc(u)||[])}else a=rc(e)||[]}catch(u){console.error("Error getting enumerated values from schema",u,e)}return a.map(Q0)}function em(e,a){return p0(e,[h0,a],{})}function tm(e){if(!e||!Kt(e))return[];const a=new Set,u=new Set;function d(r){if(!(!Kt(r)||u.has(r))){if(u.add(r),dn(r.required))for(const c of r.required)typeof c=="string"&&a.add(c);["allOf"].forEach(c=>{const t=r[c];dn(t)&&t.forEach(s=>d(s))})}}return d(e),Array.from(a)}function da(e){if(e.type){if(e.type==="array"&&e.items){const a=Array.isArray(e.items)?e.items[0]:e.items;return{type:"array",itemType:da(a)}}return{type:e.type}}if(e!=null&&e.oneOf&&dn(e.oneOf)){const a=dh(e);if(a)return da(a)}}function nm(e){if(!e)return{};const a=tm(e),u={};return e.properties&&Object.keys(e.properties).forEach(d=>{const r=em(e,d),c=da(r);let t=ac(r).map(s=>s.value);if(t.length===0&&r&&r.items){const s=Array.isArray(r.items)?r.items[0]:r.items;t=ac(s).map(n=>n.value)}u[d]={type:c,isRequired:a.includes(d),enumeratedValues:t.length>0?t:null}}),u}var Ps={};const ne=ah(m0);var Cn={},Sn={},cc;function Gi(){if(cc)return Sn;cc=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.context=void 0;const e=F();return Sn.context=e.createContext(null),Sn}var Ms={},lc;function xe(){return lc||(lc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useStyles=e.context=void 0;const a=F();e.context=a.createContext({});const u=()=>a.useContext(e.context);e.useStyles=u}(Ms)),Ms}var qs={},Ds={},Vs={},Bs={},uc;function rm(){return uc||(uc=1,Object.defineProperty(Bs,"__esModule",{value:!0})),Bs}var Ze={},dc;function im(){if(dc)return Ze;dc=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.COLOR=Ze.SYMBOL=Ze.ZINDEX=Ze.SIZE=void 0;var e;(function(r){r[r.SITE_WIDTH=1300]="SITE_WIDTH",r[r.SITE_PADDING=32]="SITE_PADDING",r[r.PAGE_WIDTH=1e3]="PAGE_WIDTH",r[r.TOP_NAV_HEIGHT=64]="TOP_NAV_HEIGHT",r[r.SIDEBAR_WIDTH=300]="SIDEBAR_WIDTH"})(e||(Ze.SIZE=e={}));var a;(function(r){r[r.TOP_NAV=1e3]="TOP_NAV",r[r.SIDEBAR=1001]="SIDEBAR",r[r.CONTEXT=1002]="CONTEXT",r[r.PROGRESS=2e3]="PROGRESS",r[r.MODAL=4e3]="MODAL",r[r.CURSOR=1e6]="CURSOR"})(a||(Ze.ZINDEX=a={}));var u;(function(r){r.CHECKMARK="✓",r.CROSS="✗",r.NIL="∅",r.ELLIPSIS="…",r.MDASH="—",r.NDASH="–",r.FDASH="‒",r.CTRL="⌃",r.CMD="⌘",r.ALT="⌥",r.SHIFT="⇧"})(u||(Ze.SYMBOL=u={}));var d;return function(r){r.LINK="#0089ff"}(d||(Ze.COLOR=d={})),Ze}var Ls={},$s={},fc;function hc(){if(fc)return $s;fc=1;var e=/[A-Z]/g,a=function(u){for(var d=5381,r=u.length;r;)d=d*33^u.charCodeAt(--r);return"_"+(d>>>0).toString(36)};return $s.create=function(u){u=u||{};var d=u.assign||Object.assign,r=typeof window=="object",c=d({raw:"",pfx:"_",client:r,assign:d,stringify:JSON.stringify,kebab:function(t){return t.replace(e,"-$&").toLowerCase()},decl:function(t,s){return t=c.kebab(t),t+":"+s+";"},hash:function(t){return a(c.stringify(t))},selector:function(t,s){return t+(s[0]===":"?"":" ")+s},putRaw:function(t){c.raw+=t}},u);return c.client&&(c.sh||document.head.appendChild(c.sh=document.createElement("style")),c.putRaw=function(t){{var s=c.sh.sheet;try{s.insertRule(t,s.cssRules.length)}catch{}}}),c.put=function(t,s,n){var o="",i,l,p=[];for(i in s)l=s[i],l instanceof Object&&!(l instanceof Array)?p.push(i):o+=c.decl(i,l,t,n);o&&(o=t+"{"+o+"}",c.putRaw(n?n+"{"+o+"}":o));for(var h=0;h<p.length;h++)i=p[h],i[0]==="@"&&i!=="@font-face"?c.putAt(t,s[i],i):c.put(c.selector(t,i),s[i],n)},c.putAt=c.put,c},$s}var Fs={},pc;function sm(){return pc||(pc=1,Fs.addon=function(e){var a={};e.cache=function(u){if(!u)return"";var d=e.hash(u);return a[d]||(a[d]=e.rule(u,d)),a[d]}}),Fs}var Js={},Us,mc;function om(){if(mc)return Us;mc=1;var e=Object.keys,a=JSON.stringify;function u(d,r){var c,t,s,n,o,i,l;if(l=typeof d,l==="string")return a(d);if(d===!0)return"true";if(d===!1)return"false";if(d===null)return"null";if(d instanceof Array){for(s="[",t=d.length-1,c=0;c<t;c++)s+=u(d[c],!1)+",";return t>-1&&(s+=u(d[c],!1)),s+"]"}if(d instanceof Object){if(typeof d.toJSON=="function")return u(d.toJSON(),r);for(n=e(d).sort(),t=n.length,s="",c=0;c<t;)o=n[c],i=u(d[o],!0),i!==void 0&&(c&&s!==""&&(s+=","),s+=a(o)+":"+i),c++;return"{"+s+"}"}switch(l){case"function":case"undefined":return r?void 0:null;default:return isFinite(d)?d:null}}return Us=function(d){return""+u(d,!1)},Us}var bc;function am(){if(bc)return Js;bc=1;var e=om();return Js.addon=function(a){a.stringify=e},Js}var zs={},vc;function cm(){return vc||(vc=1,zs.addon=function(e){e.selector=function(a,u){var d=a.split(","),r=[],c=u.split(","),t=d.length,s=c.length,n,o,i,l,p,h;for(n=0;n<s;n++)if(i=c[n],l=i.indexOf("&"),l>-1)for(o=0;o<t;o++)p=d[o],h=i.replace(/&/g,p),r.push(h);else for(o=0;o<t;o++)p=d[o],p?r.push(p+" "+i):r.push(i);return r.join(",")}}),zs}var ns={},gc;function lm(){if(gc)return ns;gc=1;var e="position",a="top",u="right",d="bottom",r="left",c="width",t="height",s="overflow",n="color",o="content",i=s+"-x",l=s+"-y",p="flex",h=p+"-direction",v=p+"-grow",y=p+"-shrink",g=p+"-basis",f=p+"-wrap",m="align",b=m+"-items",_=m+"-"+o,w=m+"-self",C="margin",E=C+"-"+a,O=C+"-"+u,S=C+"-"+d,x=C+"-"+r,I="padding",N=I+"-"+a,R=I+"-"+u,M=I+"-"+d,T=I+"-"+r,j="border",D=j+"-"+a,G=j+"-"+u,z=j+"-"+d,W=j+"-"+r,Z=j+"-radius",U="background",ee=U+"-"+n,ge=U+"-image",X=U+"-repeat",ie=U+"-attachment",se=U+"-position",Re=U+"-size",Ce=U+"-origin",_t=U+"-clip",ct="style",K="font",de=K+"-size",ve=K+"-"+ct,wt=K+"-weight",Ct=K+"-family",lt="text",Yt=lt+"-align",Qt=lt+"-decoration",Rs=lt+"-transform",bn=lt+"-shadow",vn=lt+"-overflow",kt="stroke",gn=kt+"-width",yn=kt+"-linecap",Ye="animation",St=Ye+"-name",es=ns.atoms={pos:e,t:a,r:u,b:d,l:r,z:"z-index",d:"display",vis:"visibility",w:c,h:t,minW:"min-"+c,maxW:"max-"+c,minH:"min-"+t,maxH:"max-"+t,ov:s,ovx:i,ovy:l,bxz:"box-sizing",cl:"clip",clp:"clip-path",clr:"clear",tbl:"table-layout",fl:p,fld:h,flg:v,fls:y,flb:g,flw:f,jc:"justify-"+o,ai:b,ac:_,as:w,mr:C,mrt:E,mrr:O,mrb:S,mrl:x,mar:C,mart:E,marr:O,marb:S,marl:x,pd:I,pdt:N,pdr:R,pdb:M,pdl:T,pad:I,padt:N,padr:R,padb:M,padl:T,bd:j,bdt:D,bdr:G,bdb:z,bdl:W,bdrad:Z,bdc:j+"-"+n,bds:j+"-"+ct,out:"outline",bxsh:"box-shadow",col:n,op:"opacity",bg:U,bgc:ee,bgi:ge,bgr:X,bga:ie,bgp:se,bgs:Re,bgo:Ce,bgcl:_t,bdfl:"backdrop-filter",bfvis:"backface-visibility",f:K,fz:de,fs:ve,fw:wt,ff:Ct,ta:Yt,td:Qt,tt:Rs,ts:bn,tov:vn,ww:"word-wrap",lts:"letter-spacing",ws:"white-space",lh:"line-"+t,va:"vertical-"+m,cur:"cursor",pe:"pointer-events",us:"user-select",an:Ye,ann:St,and:Ye+"-duration",anf:Ye+"-fill-mode",anit:Ye+"-iteration-count",anp:Ye+"-play-state",ant:Ye+"-timing-function",trs:"transition",tr:"transform",st:kt,stw:gn,stl:yn,ls:"list-"+ct,con:o};return ns.addon=function(H){var ue=H.decl;H.decl=function(At,je){return ue(es[At]||At,je)}},ns}var Gs={},yc;function um(){return yc||(yc=1,Gs.addon=function(e){e.rule=function(a,u){return u=u||e.hash(a),u=e.pfx+u,e.put("."+u,a)," "+u}}),Gs}var Ws={},_c;function dm(){return _c||(_c=1,Ws.addon=function(e){e.drule=function(a,u){var d=e.rule(a,u),r=function(c){if(!c)return d;var t=e.cache(c);return d+t};return r.toString=function(){return d},r}}),Ws}var Hs={},wc;function fm(){return wc||(wc=1,Hs.addon=function(e,a){a=e.assign({prefixes:["-webkit-","-moz-","-o-",""]},a||{});var u=a.prefixes;e.client&&document.head.appendChild(e.ksh=document.createElement("style"));var d=e.putAt;e.putAt=function(r,c,t){if(t[1]==="k"){var s="";for(var n in c){var o=c[n],i="";for(var l in o)i+=e.decl(l,o[l]);s+=n+"{"+i+"}"}for(var p=0;p<u.length;p++){var h=u[p],v=t.replace("@keyframes","@"+h+"keyframes")+"{"+s+"}";e.client?e.ksh.appendChild(document.createTextNode(v)):e.putRaw(v)}return}d(r,c,t)},e.keyframes=function(r,c){return c||(c=e.hash(r)),c=e.pfx+c,e.putAt("",r,"@keyframes "+c),c}}),Hs}var Ks={},Cc;function hm(){return Cc||(Cc=1,Ks.addon=function(e){var a={html:{lineHeight:1.15,"-webkit-text-size-adjust":"100%"},body:{margin:0},h1:{fontSize:"2em",margin:"0.67em 0"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp":{fontFamily:"monospace, monospace",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:1.15,margin:0},"button,input":{overflow:"visible"},"button,select":{textTransform:"none"},fieldset:{padding:"0.35em 0.75em 0.625em"},legend:{boxSizing:"border-box",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{verticalAlign:"baseline"},summary:{display:"list-item"}};e.put("",a)}),Ks}var Xs={},Sc;function pm(){return Sc||(Sc=1,Xs.addon=function(e){e.put("",{"html, body":{fontFamily:'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif',fontWeight:400,fontSize:"16px","-moz-text-size-adjust":"100%","-ms-text-size-adjust":"100%","-webkit-text-size-adjust":"100%","text-size-adjust":"100%","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"}})}),Xs}var Ys={},Ec;function mm(){if(Ec)return Ys;Ec=1;function e(a,u,d){var r="?family="+encodeURIComponent(a);return u&&(u instanceof Array||(u=[u]),r+=":"+u.join(",")),d&&(d instanceof Array||(d=[d]),r+="&subset="+d.join(",")),"https://fonts.googleapis.com/css"+r}return Ys.addon=function(a){a.client?a.googleFont=function(u,d,r){var c=document.createElement("link");c.href=e(u,d,r),c.rel="stylesheet",c.type="text/css",document.head.appendChild(c)}:a.googleFont=function(u,d,r){a.putRaw("@import url('"+e(u,d,r)+"');")}},Ys}var Oc;function fh(){return Oc||(Oc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nano=e.googleFont=e.keyframes=e.drule=e.rule=e.put=e.reset=void 0;const a=ne,u=hc(),d=sm(),r=am(),c=cm(),t=lm(),s=um(),n=dm(),o=fm(),i=hm(),l=pm(),p=mm();a.__exportStar(hc(),e);const h=(0,u.create)({pfx:"nano-css"});e.nano=h,(0,d.addon)(h),(0,r.addon)(h),(0,c.addon)(h),(0,t.addon)(h),(0,s.addon)(h),(0,n.addon)(h),(0,o.addon)(h),(0,p.addon)(h);const v=()=>{(0,i.addon)(h),(0,l.addon)(h)};e.reset=v,e.put=h.put,e.rule=h.rule,e.drule=h.drule,e.keyframes=h.keyframes,e.googleFont=h.googleFont}(Ls)),Ls}var Qs={},xc;function bm(){return xc||(xc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.m4=e.m3=e.m2=e.m1=e.b4=e.b3=e.b2=e.b1=void 0,e.b1=520,e.b2=960,e.b3=1300,e.b4=1800,e.m1=`@media (max-width:${e.b1}px)`,e.m2=`@media (max-width:${e.b2}px)`,e.m3=`@media (max-width:${e.b3}px)`,e.m4=`@media (max-width:${e.b4}px)`}(Qs)),Qs}var En={},Rc;function hh(){if(Rc)return En;Rc=1,Object.defineProperty(En,"__esModule",{value:!0}),En.font=void 0;const e='"Open Sans",sans-serif',a='"Merriweather","Linux Libertine"',u='"Roboto Slab"',d='Ubuntu,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Cantarell,"Open Sans","Helvetica Neue",sans-serif',r='-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,"Apple Color Emoji",Arial,sans-serif,"Segoe UI Emoji","Segoe UI Symbol",'+d,c="Roboto,sans-serif,"+r;return En.font={sans:{lite:{fw:300,ff:e},mid:{fw:400,ff:e},bold:{fw:700,ff:e},black:{fw:800,ff:e}},serif:{lite:{fw:300,ff:a},mid:{fw:400,ff:a},bold:{fw:700,ff:a},black:{fw:700,ff:a}},slab:{lite:{fw:300,ff:u},mid:{fw:400,ff:u},bold:{fw:700,ff:u},black:{fw:800,ff:u}},mono:{mid:{fw:300,ff:'"Menlo","DejaVu Sans Mono","Roboto Mono","Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'},bold:{fw:400,ff:'"Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'}},ui1:{lite:{fw:300,ff:d},mid:{fw:400,ff:d},bold:{fw:700,ff:d},black:{fw:800,ff:d}},ui2:{lite:{fw:300,ff:r},mid:{fw:400,ff:r},bold:{fw:700,ff:r},black:{fw:800,ff:r}},ui3:{lite:{fw:300,ff:c},mid:{fw:400,ff:c},bold:{fw:700,ff:c},black:{fw:800,ff:c}}},En}var Zs={},eo={},On={},Ic;function vm(){if(Ic)return On;Ic=1,Object.defineProperty(On,"__esModule",{value:!0}),On.hash=void 0;const e=a=>{let u=5381,d=a.length;for(;d;)u=u*33^a.charCodeAt(--d);return u>>>0};return On.hash=e,On}var Nc;function ph(){return Nc||(Nc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toColor=e.color=void 0,e.color=["#FFC312","#F79F1F","#EE5A24","#EA2027","#C4E538","#A3CB38","#009432","#006266","#12CBC4","#1289A7","#0652DD","#1B1464","#9980FA","#ED4C67","#B53471","#833471","#6F1E51","#e27d60","#85dcbb","#e8a87c","#c38d9e","#41b3a3","#242582","#553d67","#f64c72","#99738e","#2f2fa2","#05386b","#fc4445","#3feee6","#55bcc9","#8ee4af","#5cdb95","#907163","#379683","#84ceeb","#5ab9ea","#8860d0","#75b5d8","#a64ac9","#fccd04","#17e9e0","#61892f","#86c232","#222629","#474b4f","#6b6e70","#eadb02","#46344e","#5a5560","#fa72a1","#e64398","#f78888","#1FB6FF","#13CE66","#FF4949","#FFC82C","#76266C","#8C2E5E","#5B2971","#9B344E","#4D2B73","#AA4139","#432F75","#AA5D38","#702D0C","#3C1200","#353377","#FE8C00","#FE7301","#FE4301","#FE0100","#E5013B","#CC0174","#A0048C","#560DAB","#252AAC","#0A6BA1","#09A471","#9DED05"];const a=vm(),u=d=>e.color[(0,a.hash)(d)%e.color.length];e.toColor=u}(eo)),eo}var kc;function Na(){return kc||(kc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.theme=e.lightTheme=void 0;const a=ph(),u=hh(),d=(t,s=1)=>{const n=Math.round(255*t);return`rgba(${n},${n},${n},${s})`},r=[0,4,8,16,24,32,64,128,256,512],c=[10,12,14,16,20,24,32,48,64,96,128];e.lightTheme={isLight:!0,name:"light",bg:"#fff",color:{color:a.color,sem:{accent:["#07f","#1340EB","#07ACEB"],blue:["#07f","#1340EB","#07ACEB"],positive:["#13CE66","#16BA32","#38D420"],negative:["#FF4949","#EB4C31","#DB521A"],warning:["#FFC82C","#EBC715","#DBCC00"],link:["#0089ff","#134EEB","#07BBEB"],brand:["#E44A28","#985DF7","#EE69B1","#F6A832","#5FCC8A","#58B9F8"]},ui:{lightLine:d(.1,.04),line:d(.1,.08),lineDark:d(.1,.16)}},font:u.font,green:t=>`rgba(19,206,102,${t})`,red:t=>`rgba(225,20,10,${t})`,blue:t=>`rgba(40,160,222,${t})`,fontSize:(t=0)=>c[Math.min(Math.max(t+3,0),c.length-1)],space:(t=0)=>r[Math.min(Math.max(t+3,0),r.length-1)],g:d},e.theme=e.lightTheme}(Zs)),Zs}var xn={},Ac;function mh(){if(Ac)return xn;Ac=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.darkTheme=void 0;const e=Na(),a=(u,d=1)=>{const r=255-Math.round(255*u);return`rgba(${r},${r},${r},${d})`};return xn.darkTheme=Object.assign(Object.assign({},e.lightTheme),{isLight:!1,name:"dark",bg:"#101921",color:Object.assign(Object.assign({},e.lightTheme.color),{ui:{lightLine:a(.1,.04),line:a(.1,.08),lineDark:a(.1,.16)}}),g:a}),xn}var to={},rs={},Ve={},Tc;function bh(){if(Tc)return Ve;Tc=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.isNavigator=Ve.isBrowser=Ve.off=Ve.on=Ve.noop=void 0;var e=function(){};Ve.noop=e;function a(d){for(var r=[],c=1;c<arguments.length;c++)r[c-1]=arguments[c];d&&d.addEventListener&&d.addEventListener.apply(d,r)}Ve.on=a;function u(d){for(var r=[],c=1;c<arguments.length;c++)r[c-1]=arguments[c];d&&d.removeEventListener&&d.removeEventListener.apply(d,r)}return Ve.off=u,Ve.isBrowser=typeof window<"u",Ve.isNavigator=typeof navigator<"u",Ve}var jc;function gm(){if(jc)return rs;jc=1,Object.defineProperty(rs,"__esModule",{value:!0});var e=F(),a=bh(),u=a.isBrowser?e.useLayoutEffect:e.useEffect;return rs.default=u,rs}var Pc;function ym(){return Pc||(Pc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalCss=e.makeRule=e.useRule=e.useTheme=e.Provider=void 0;const a=F(),u=Na(),d=mh(),r=fh(),c=a.createContext(u.lightTheme);e.Provider=a.memo(({theme:l,children:p})=>{const h=l==="light"?u.lightTheme:d.darkTheme;return a.createElement(c.Provider,{value:h},p)});const t=()=>a.useContext(c);e.useTheme=t;const s=l=>{const p=(0,e.useTheme)(),h=l(p);return r.nano.cache(h)};e.useRule=s;const n=l=>()=>(0,e.useRule)(l);e.makeRule=n;const o=gm(),i=()=>{const l=(0,e.useTheme)();return(0,o.default)(()=>{document.body.style.background=l.bg,document.body.style.color=l.g(.05,.85)},[l]),null};e.GlobalCss=i}(to)),to}var Mc;function _e(){return Mc||(Mc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(rm(),e),a.__exportStar(im(),e),a.__exportStar(fh(),e),a.__exportStar(bm(),e),a.__exportStar(hh(),e),a.__exportStar(Na(),e),a.__exportStar(mh(),e),a.__exportStar(ym(),e),a.__exportStar(ph(),e)}(Vs)),Vs}var qc;function we(){return qc||(qc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bottomRightActionPos=e.tooltip=e.insArrButton=e.insArrLine=e.insArrDot=e.insArrBlock=e.bracketHovered=e.collapsed=e.collapser=e.bracket=e.lineInner=e.line=e.list=e.colon=e.inputActive=e.input=e.property=e.quote=e.ValueColor=e.object=e.block=e.negative=e.blue=void 0;const a=_e();e.blue=a.theme.color.sem.blue[0],e.negative=a.theme.color.sem.negative[0],e.block=(0,a.rule)({d:"inline-block",ff:"monospace",col:a.theme.g(.1)}),e.object=(0,a.rule)({pos:"relative",d:"inline-block"}),e.ValueColor={nil:[a.theme.g(0,.4),a.darkTheme.g(0,.4)],undef:[a.theme.g(0,.2),a.darkTheme.g(0,.2)],str:["#e00e44","#f01e54"],bool:["#411888","#9168c8"],num:["#0a8F3F","#0FaF4F"],zero:["#748A00","#94AA11"],float:["#016873","#51a8b3"]},e.quote=(0,a.rule)({col:"#E84D3D"}),e.property=(0,a.rule)({pad:"0",fw:"bold",bxz:"border-box",va:"top"});const u={col:a.theme.g(0),pd:"5px",bg:a.theme.bg,bd:`1px solid ${a.theme.g(.7)}`,mr:"-6px",out:0};e.input=(0,a.rule)({z:2,pos:"relative",bd:0,mar:0,pad:0,bg:"transparent",bdrad:"5px",d:"inline-block",minW:"auto",w:"auto","&::selection":{col:"#fff",bgc:e.blue},input:{out:0}}),e.inputActive=(0,a.rule)(u),e.colon=(0,a.rule)({pd:"0 8px 0 0px",cur:"default",va:"top","&>span":{pd:"0 2px"},"&:hover":{"&>span":{out:`1px dotted ${e.blue}`}}}),e.list=(0,a.rule)({d:"block",listStyleType:"none",pd:0,mr:"0 0 0 32px"}),e.line=(0,a.rule)({d:"block",ls:"none",pd:0,mr:0}),e.lineInner=(0,a.rule)({d:"inline-block"}),e.bracket=(0,a.rule)({pos:"relative",cur:"default"}),e.collapser=(0,a.rule)({pd:"0 6px",pos:"absolute",t:"0px",l:"-24px",cur:"default",us:"none"}),e.collapsed=(0,a.rule)({col:e.blue,cur:"default",fw:"bold",bg:a.theme.blue(.1),pd:"2px",mr:"-2px",bdrad:"4px"}),e.bracketHovered=(0,a.rule)({out:`1px dotted ${e.blue}`}),e.insArrBlock=(0,a.rule)({pos:"relative",h:"0px",w:"0px"}),e.insArrDot=(0,a.rule)({pos:"absolute",t:"0px",l:"-4px",w:"3px",h:"3px",bdrad:"50%",bg:e.blue,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{top:"-2px",left:"2px",w:"7px",h:"7px"}}),e.insArrLine=(0,a.rule)({pos:"absolute",t:"1px",l:"-56px",w:"50px",h:"0px",bdt:`1px dotted ${e.blue}`,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{l:"-56px",w:"56px",bdt:`1px solid ${e.blue}`}}),e.insArrButton=(0,a.rule)({pos:"absolute",d:"block",t:"-8px",l:"-75px"}),e.tooltip=(0,a.rule)(Object.assign(Object.assign({},a.theme.font.ui1),{pos:"absolute",d:"none",t:"-2.5em",l:"0px",bg:"rgba(0,0,0,.8)",col:"#fff",fz:12/13.4+"em",pad:".4em .8em",bdrad:".4em",z:3,pe:"none",us:"none",ws:"nowrap"})),e.bottomRightActionPos=(0,a.rule)({d:"inline-block",pos:"absolute",r:"-6px",b:"-9px",z:2})}(Ds)),Ds}var Rn={},no={},ro={},Dc;function _m(){return Dc||(Dc=1,Object.defineProperty(ro,"__esModule",{value:!0})),ro}var io={},Vc;function ka(){return Vc||(Vc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=c,e.escapeComponent=t,e.parseJsonPointer=s,e.formatJsonPointer=n,e.isChild=i,e.isPathEqual=l,e.parent=h,e.isValidIndex=v;const a=/~1/g,u=/~0/g,d=/~/g,r=/\//g;function c(g){return g.indexOf("~")===-1?g:g.replace(a,"/").replace(u,"~")}function t(g){return g.indexOf("/")===-1&&g.indexOf("~")===-1?g:g.replace(d,"~0").replace(r,"~1")}function s(g){return g?g.slice(1).split("/").map(c):[]}function n(g){return(0,e.isRoot)(g)?"":"/"+g.map(f=>t(String(f))).join("/")}const o=g=>typeof g=="string"?s(g):g;e.toPath=o;function i(g,f){if(g.length>=f.length)return!1;for(let m=0;m<g.length;m++)if(g[m]!==f[m])return!1;return!0}function l(g,f){if(g.length!==f.length)return!1;for(let m=0;m<g.length;m++)if(g[m]!==f[m])return!1;return!0}const p=g=>!g.length;e.isRoot=p;function h(g){if(g.length<1)throw new Error("NO_PARENT");return g.slice(0,g.length-1)}function v(g){if(typeof g=="number")return!0;const f=Number.parseInt(g,10);return String(f)===g&&f>=0}const y=g=>{const f=g.length;let m=0,b;for(;m<f;){if(b=g.charCodeAt(m),b>=48&&b<=57){m++;continue}return!1}return!0};e.isInteger=y}(io)),io}var so={},Bc;function wm(){return Bc||(Bc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const a=r=>{if(typeof r=="string"){if(r){if(r[0]!=="/")throw new Error("POINTER_INVALID");if(r.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(r)};e.validateJsonPointer=a;const{isArray:u}=Array,d=r=>{if(!u(r))throw new Error("Invalid path.");if(r.length>256)throw new Error("Path too long.");for(const c of r)switch(typeof c){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=d}(so)),so}var In={},Nn={},Lc;function Aa(){if(Lc)return Nn;Lc=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function a(u,d){return e.call(u,d)}return Nn.hasOwnProperty=a,Nn}var $c;function vh(){if($c)return In;$c=1,Object.defineProperty(In,"__esModule",{value:!0}),In.get=void 0;const e=Aa(),a=(u,d)=>{const r=d.length;let c;if(!r)return u;for(let t=0;t<r;t++)if(c=d[t],u instanceof Array){if(typeof c!="number"){if(c==="-")return;const s=~~c;if(""+s!==c)return;c=s}u=u[c]}else if(typeof u=="object"){if(!u||!(0,e.hasOwnProperty)(u,c))return;u=u[c]}else return;return u};return In.get=a,In}var et={},Fc;function Cm(){if(Fc)return et;Fc=1,Object.defineProperty(et,"__esModule",{value:!0}),et.isObjectReference=et.isArrayEnd=et.isArrayReference=et.find=void 0;const e=Aa(),{isArray:a}=Array,u=(t,s)=>{const n=s.length;if(!n)return{val:t};let o,i;for(let p=0;p<n;p++)if(o=t,i=s[p],a(o)){const h=o.length;if(i==="-")i=h;else if(typeof i=="string"){const v=~~i;if(""+v!==i)throw new Error("INVALID_INDEX");if(i=v,i<0)throw new Error("INVALID_INDEX")}t=o[i]}else if(typeof o=="object"&&o)t=(0,e.hasOwnProperty)(o,i)?o[i]:void 0;else throw new Error("NOT_FOUND");return{val:t,obj:o,key:i}};et.find=u;const d=t=>a(t.obj)&&typeof t.key=="number";et.isArrayReference=d;const r=t=>t.obj.length===t.key;et.isArrayEnd=r;const c=t=>typeof t.obj=="object"&&typeof t.key=="string";return et.isObjectReference=c,et}var oo={},kn={},Jc;function Sm(){if(Jc)return kn;Jc=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.findByPointer=void 0;const e=Aa(),a=ka(),{isArray:u}=Array,d=(r,c)=>{if(!r)return{val:c};let t,s,n=0,o=1;for(;n>-1;)if(n=r.indexOf("/",o),s=n>-1?r.substring(o,n):r.substring(o),o=n+1,t=c,u(t)){const i=t.length;if(s==="-")s=i;else{const l=~~s;if(""+l!==s)throw new Error("INVALID_INDEX");if(s=l,s<0)throw"INVALID_INDEX"}c=t[s]}else if(typeof t=="object"&&t)s=(0,a.unescapeComponent)(s),c=(0,e.hasOwnProperty)(t,s)?t[s]:void 0;else throw"NOT_FOUND";return{val:c,obj:t,key:s}};return kn.findByPointer=d,kn}var Uc;function Em(){return Uc||(Uc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ne.__exportStar(Sm(),e)}(oo)),oo}var zc;function vs(){return zc||(zc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(_m(),e),a.__exportStar(ka(),e),a.__exportStar(wm(),e),a.__exportStar(vh(),e),a.__exportStar(Cm(),e),a.__exportStar(Em(),e)}(no)),no}var An={},Tn={},Gc;function Om(){if(Gc)return Tn;Gc=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.copyStyles=void 0;const e=(a,u,d)=>{const r=window.getComputedStyle(a);if(r)for(const c of d)u.style[c]=r[c]};return Tn.copyStyles=e,Tn}var Wc;function Wi(){if(Wc)return An;Wc=1,Object.defineProperty(An,"__esModule",{value:!0}),An.FlexibleInput=void 0;const e=F(),a=_e(),u=Om(),d=(0,a.rule)({d:"inline-block",pos:"relative"}),r=(0,a.rule)({d:"inline-block",va:"bottom",bxz:"border-box",ov:"hidden",pd:0,mr:0,bd:0,bg:0,out:0,col:"inherit",fw:"inherit",f:"inherit",lh:"inherit",ws:"pre",resize:"none"}),c=(0,a.rule)({d:"inline-block",pos:"absolute",ov:"hidden",pe:"none",us:"none",bxz:"border-box",t:0,l:0,ws:"pre"}),t=({inp:s,value:n,uncontrolled:o,multiline:i,typebefore:l="",typeahead:p="",extraWidth:h,minWidth:v=8,maxWidth:y,focus:g,onChange:f,onFocus:m,onBlur:b,onKeyDown:_,onSubmit:w,onCancel:C,onTab:E})=>{const O=e.useRef(null),S=e.useRef(null),x=(0,a.useTheme)();e.useLayoutEffect(()=>{!O.current||!S.current||(g&&O.current.focus(),(0,u.copyStyles)(O.current,S.current,["font","fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","boxSizing"]))},[]),e.useLayoutEffect(()=>{const R=O.current,M=S.current;if(!R||!M)return;let T=M.scrollWidth;h&&(T+=h),v&&(T=Math.max(T,v)),y&&(T=Math.min(T,y));const j=R.style;if(j.width=T+"px",i){const D=M.scrollHeight;j.height=D+"px"}},[n,p,h]);const I={ref:R=>{O.current=R,s&&s(R)},className:r,onChange:f,onFocus:m,onBlur:b,onKeyDown:R=>{R.key==="Enter"&&(!i||R.ctrlKey)?w&&w(R):R.key==="Escape"?C&&C(R):R.key==="Tab"&&E&&E(R),_&&_(R)}},N=i?e.createElement("textarea",Object.assign({},I,{value:o?void 0:n})):e.createElement("input",Object.assign({},I,{value:o?void 0:n}));return e.createElement(e.Fragment,null,!!l&&e.createElement("span",{style:{color:x.g(.7),verticalAlign:"top"}},l),e.createElement("span",{className:d},N,e.createElement("span",{ref:S,className:c},e.createElement("span",{style:{visibility:"hidden"}},n),"​",!!p&&e.createElement("span",{style:{color:x.g(.7)}},p))))};return An.FlexibleInput=t,An}var Hc;function gh(){if(Hc)return Rn;Hc=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.JsonProperty=void 0;const e=F(),a=_e(),u=vs(),d=we(),r=Wi(),c=xe(),t=({pointer:s,onChange:n})=>{const{formal:o}=(0,c.useStyles)(),i=e.useMemo(()=>s.split("/"),[s]),l=e.useMemo(()=>(0,u.unescapeComponent)(i[i.length-1]),[i]),[p,h]=e.useState(l),v=e.useRef(null),[y,g]=e.useState(!1),f=(0,a.useTheme)(),m={color:f.g(.1)};y&&(m.background=f.bg,m.border=`1px solid ${f.g(.9)}`,m.fontWeight="bold",m.margin="-3px",m.padding="2px"),(!l||l.indexOf(" ")!==-1)&&(m.background=f.blue(.1));const b=_=>{_&&_.preventDefault(),_&&_.stopPropagation(),n&&n([{op:"move",from:s,path:i.slice(0,i.length-1).join("/")+"/"+(0,u.escapeComponent)(p)}])};return e.createElement(e.Fragment,null,n?e.createElement("span",{className:d.property+d.input,style:m},e.createElement(r.FlexibleInput,{inp:_=>v.current=_,value:y?p:l,onChange:_=>h(_.target.value),onFocus:_=>{const w=_.target,E=w.value.length;E&&E<6&&setTimeout(()=>{w.setSelectionRange(0,E,"forward")},155),g(!0)},onBlur:()=>{g(!1)},onSubmit:_=>{v.current&&(v.current.blur(),g(!1)),b(_)},onCancel:()=>{v.current&&(v.current.blur(),g(!1))}})):e.createElement("span",{className:d.property,style:m},o?JSON.stringify(l):l),e.createElement("span",{className:d.colon,style:{color:f.g(.5)}},e.createElement("span",null,":")))};return Rn.JsonProperty=t,Rn}var jn={},Pn={},ao={},Kc;function gs(){return Kc||(Kc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.typeahead=e.inputStyle=e.inputColor=e.valueBg=e.valueColor=void 0;const a=_e(),u=we(),d=(n,o)=>{switch(typeof o){case"boolean":return u.ValueColor.bool[~~n];case"string":return u.ValueColor.str[~~n];case"number":return o?o===Math.round(o)?u.ValueColor.num[~~n]:u.ValueColor.float[~~n]:u.ValueColor.zero[~~n];case"bigint":return u.ValueColor.float[~~n];case"object":return o===null?u.ValueColor.nil[~~n]:void 0;case"undefined":return u.ValueColor.undef[~~n]}};e.valueColor=d;const r=n=>n===!1||typeof n=="number"&&n<0?a.theme.red(.06):void 0;e.valueBg=r;const c=(n,o)=>{if(o){if(o=o.trim(),o==="true"||o==="false")return u.ValueColor.bool[~~n];if(o==="null")return u.ValueColor.nil[~~n];if(o==="undefined")return u.ValueColor.undef[~~n];if(o==="0")return u.ValueColor.zero[~~n];if(o.length<24&&(o[0]==="-"||o[0]>="0"&&o[0]<="9"))try{const i=JSON.parse(o);if(typeof i=="number")return i===Math.round(i)?u.ValueColor.num[~~n]:u.ValueColor.float[~~n]}catch{}if(!(o[0]==="["||o[0]==="{"))return u.ValueColor.str[~~n]}};e.inputColor=c;const t=(n,o,i)=>({color:(0,e.inputColor)(o,i)||n.g(.1),background:n.bg,borderColor:n.g(.7)});e.inputStyle=t;const s=n=>{if(!n)return"";const o=n.length;return o>=5?"":"true".startsWith(n)?"true".slice(o):"false".startsWith(n)?"false".slice(o):"null".startsWith(n)?"null".slice(o):""};e.typeahead=s}(ao)),ao}var Mn={},Xc;function Ta(){if(Xc)return Mn;Xc=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.selectOnFocus=void 0;const e=a=>{const u=a.value,d=u.length;d&&d<40&&setTimeout(()=>{if(u[0]==='"'&&u[d-1]==='"')(d<17||u.indexOf(`
`)===-1&&u.indexOf(" ")===-1)&&a.setSelectionRange(1,d-1,"forward");else if(u==="null")a.setSelectionRange(0,4,"forward");else try{switch(typeof JSON.parse(u)){case"number":case"boolean":{a.setSelectionRange(0,d,"forward");break}}}catch{}},155),u[0]==='"'&&u[d-1]==='"'&&a.setSelectionRange(d-1,d-1)};return Mn.selectOnFocus=e,Mn}var Yc;function xm(){if(Yc)return Pn;Yc=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.ValueInput=void 0;const e=F(),a=_e(),u=we(),d=gs(),r=Wi(),c=Ta(),t=s=>{const{value:n,onChange:o}=s,i=e.useRef(null),l=(0,a.useTheme)(),p=e.useMemo(()=>n===null?"null":typeof n=="boolean"?n?"true":"false":typeof n=="string"?JSON.stringify(n):String(n),[n,l]),[h,v]=e.useState(p),[y,g]=e.useState(!1);e.useEffect(()=>{v(p)},[p]);const f=E=>{E&&E.preventDefault(),E&&E.stopPropagation();let O;try{O=JSON.parse(h)}catch{O=String(h)}o&&o(O)},m=E=>{const O=E.target;O.value===h&&(0,c.selectOnFocus)(O),g(!0)},b=()=>{g(!1)},_=E=>{i.current&&i.current.blur(),f(E)},w=()=>{p!==h?v(p):i.current&&i.current.blur()},C=E=>{const O=(0,d.typeahead)(h);O&&(E.preventDefault(),v(h+O))};return e.createElement("span",{className:u.input,style:y?(0,d.inputStyle)(l,!l.isLight,h):{color:(0,d.valueColor)(!l.isLight,n),background:(0,d.valueBg)(n)}},e.createElement(r.FlexibleInput,{inp:E=>i.current=E,value:y?h:p,typeahead:y?(0,d.typeahead)(h):"",onChange:E=>v(E.target.value),onFocus:m,onBlur:b,onSubmit:_,onCancel:w,onTab:C}))};return Pn.ValueInput=t,Pn}var qn={},Qc;function pn(){if(Qc)return qn;Qc=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.JsonAtom=void 0;const e=F(),a=_e(),u=gs(),d=a.theme.color.sem.blue[0],r=c=>{var t;const{value:s,onClick:n}=c,o=(0,a.useTheme)();let i=o.g(.2),l="∅";if(Array.isArray(s))i=d,l="["+s.length+"]";else if(s instanceof Uint8Array)i=o.g(.45),l=e.createElement("span",null,[...s].slice(0,128).map(v=>v<16?"0"+v.toString(16):v.toString(16)).join(" "),s.length>128?e.createElement("span",{style:{color:o.g(.3)}},` … (${s.length-128} more)`):"");else if(s&&typeof s=="object")i=d,l="{"+Object.keys(s).length+"}";else if(i=(t=(0,u.valueColor)(!o.isLight,s))!==null&&t!==void 0?t:i,typeof s=="string"){const y=s.length>64,g=JSON.stringify(y?s.slice(0,64):s);y?l=e.createElement("span",null,g.slice(0,-1),e.createElement("span",{style:{color:o.g(.3)}},` … (${s.length-64} more)`),'"'):l=g}else l=String(s);const p=(0,u.valueBg)(s),h={color:i,background:p};return p&&(h.borderRadius=4,h.margin=-1,h.padding=1),e.createElement("span",{style:h,onClick:n},l)};return qn.JsonAtom=r,qn}var Zc;function Rm(){if(Zc)return jn;Zc=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.JsonValue=void 0;const e=F(),a=gh(),u=xm(),d=pn(),r=c=>{const{pointer:t,property:s,doc:n,parentCollapsed:o,comma:i,onChange:l}=c,p=n instanceof Uint8Array,h=v=>{l&&l([{op:"replace",path:t,value:v}])};return e.createElement(e.Fragment,null,typeof s=="string"&&e.createElement(a.JsonProperty,{key:"k"+String(o),pointer:t,onChange:l}),!l||p?e.createElement(d.JsonAtom,{value:n}):e.createElement(u.ValueInput,{key:String(o),value:n,onChange:h}),!!i&&",")};return jn.JsonValue=r,jn}var Dn={},Vn={},co={},lo={},el;function Im(){return el||(el=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTranslations=void 0;var a=ne,u=F(),d=u.createContext,r=u.createElement,c=u.Fragment,t=function(n){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];for(var l=[],p=0;p<o.length;p++)l.push(n[p]),l.push(o[p]);return l.push(n[p]),r.apply(void 0,a.__spreadArrays([c,{}],l))},s=function(n){return function(o){for(var i=[],l=1;l<arguments.length;l++)i[l-1]=arguments[l];for(var p=[],h=0;h<i.length;h++)p.push(o[h]),p.push(n[i[h]]);return p.push(o[h]),r.apply(void 0,a.__spreadArrays([c,{}],p))}};e.createTranslations=function(n){var o;n===void 0&&(n="main");var i=d({}),l=i.Consumer,p=(o=function(f){a.__extends(m,f);function m(b){var _,w=f.call(this,b)||this;w.load=function(I,N){return a.__awaiter(w,void 0,void 0,function(){var R;return a.__generator(this,function(M){switch(M.label){case 0:return this.state.map[I]||(this.state.map[I]={}),this.state.map[I][N]?[3,2]:(this.state.map[I][N]={},this.setState(a.__assign({},this.state)),[4,this.props.loader(I,N)]);case 1:R=M.sent(),this.state.map[I][N]=R,this.setState(a.__assign({},this.state)),M.label=2;case 2:return[2]}})})},w.setLocale=function(I){I!==w.state.locale&&(w.state.map[I]||(w.state.map[I]={}),w.setState({locale:I}))},w.createT=function(I){I===void 0&&(I=[w.props.ns]);for(var N=w.state.locale,R=w.state.map[N],M=0,T=I;M<T.length;M++){var j=T[M];R[j]||w.load(N,j).catch(function(G){return console.error(G)})}var D=function(G){for(var z=[],W=1;W<arguments.length;W++)z[W-1]=arguments[W];for(var Z=0,U=[N,w.props.defaultLocale];Z<U.length;Z++){var ee=U[Z];if(!ee)break;for(var ge=w.state.map[ee],X=0,ie=I;X<ie.length;X++){var se=ie[X],Re=ge[se],Ce=Re[G];if(Ce!==void 0)return typeof Ce=="function"?Ce(s(z)):Ce||G}}return G};return D.t=function(G){return function(z){for(var W=[],Z=1;Z<arguments.length;Z++)W[Z-1]=arguments[Z];var U=D.apply(void 0,a.__spreadArrays([G],W));return typeof U=="object"?U:U!==G?r(c,{},U):t.apply(void 0,a.__spreadArrays([z],W))}},D};var C=b.map,E=C===void 0?{}:C,O=b.locale,S=b.defaultLocale,x=b.ns;return E[S]?E[S][x]||(E[S][x]={}):E[S]=(_={},_[x]={},_),w.state={locale:O,ns:x,map:E,load:w.load,setLocale:w.setLocale,createT:w.createT},O!==S&&w.load(O,x),w}return m.prototype.shouldComponentUpdate=function(b){return b.locale!==this.props.locale&&this.setLocale(b.locale),!0},m.prototype.render=function(){return u.createElement(i.Provider,{value:this.state,children:this.props.children})},m}(u.Component),o.defaultProps={locale:"en",defaultLocale:"en",ns:n},o),h=function(f){return f};h.t=function(f){return function(m){for(var b=[],_=1;_<arguments.length;_++)b[_-1]=arguments[_];return t(m,b)}};var v=function(f){var m=f instanceof Array?f:[f||n],b=u.useContext(i);return[b.createT?b.createT(m):h,b]},y=function(f,m){return m===void 0&&(m=n),Array.isArray(m)||(m=[m]),function(b){var _=v(m),w=_[0],C=_[1];return u.createElement(f,a.__assign(a.__assign({},b),{t:w,T:C}))}},g=function(f){var m=f.children,b=f.ns instanceof Array?f.ns:[f.ns||n],_=v(b),w=_[0],C=_[1];return(typeof m=="function"?m(w,C):m instanceof Array?u.createElement.apply(u,a.__spreadArrays([u.Fragment,null],m.map(function(E){return typeof E=="function"?E(w):typeof E=="string"?w(E):E||null}))):typeof m=="string"?w(m):m)||null};return{Consumer:l,Provider:p,context:i,useT:v,Trans:g,withT:y,T:h}},e.default=e.createTranslations}(lo)),lo}var uo={},tl;function Nm(){return tl||(tl=1,Object.defineProperty(uo,"__esModule",{value:!0})),uo}var nl;function Rt(){return nl||(nl=1,function(e){var a;Object.defineProperty(e,"__esModule",{value:!0}),e.T=e.withT=e.useT=e.context=e.Trans=e.Provider=e.Consumer=void 0;var u=ne,d=Im();u.__exportStar(Nm(),e),e.Consumer=(a=d.default(),a.Consumer),e.Provider=a.Provider,e.Trans=a.Trans,e.context=a.context,e.useT=a.useT,e.withT=a.withT,e.T=a.T}(co)),co}var Bn={},Ln={},rl;function Hi(){if(rl)return Ln;rl=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.Action=void 0;const e=F(),a=_e(),u=we(),d=(0,a.drule)({pos:"relative",d:"flex",jc:"center",ai:"center",w:"17px",h:"17px",bdrad:"2px",pad:0,mr:0,out:0,ff:"monospace",lh:"16px",cur:"pointer",bd:`1px dotted ${u.blue}`,col:u.blue,fw:"normal",z:3}),r=(0,a.drule)({[`.${d.toString().trim()}:hover &`]:{d:"inline-block"}}),c=({className:t="",tooltip:s,children:n,onClick:o,onMouseEnter:i,onMouseLeave:l,onMouseOver:p})=>{const h=(0,a.useTheme)();return e.createElement("button",{className:d({bg:h.bg,"&:hover":{col:h.bg,bg:u.blue},"&:active":{col:h.g(.9),bg:h.g(.1),bd:`1px solid ${h.g(.1)}`}})+t,onClick:o,onMouseEnter:i,onMouseLeave:l,onMouseOver:p},n,!!s&&e.createElement("span",{className:u.tooltip+r({})},s))};return Ln.Action=c,Ln}var il;function ys(){if(il)return Bn;il=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.CancelAction=void 0;const e=F(),a=_e(),u=we(),d=Hi(),r=(0,a.drule)({w:"20px",h:"20px",pos:"absolute",t:"-11px",l:"-11px",z:2,bdrad:"50%",svg:{fill:u.blue}}),c=t=>{const s=(0,a.useTheme)();return e.createElement(d.Action,Object.assign({},t,{className:r({"&:hover":{bg:u.negative,bd:`1px solid ${u.negative}`,svg:{fill:"#fff"}},"&:active":{bg:s.g(.1),bd:`1px solid ${s.g(.1)}`}})}),"×")};return Bn.CancelAction=c,Bn}var $n={},sl;function km(){if(sl)return $n;sl=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.EditAction=void 0;const e=F(),a=Hi(),u=d=>e.createElement(a.Action,Object.assign({},d),"…");return $n.EditAction=u,$n}var ol;function ja(){if(ol)return Vn;ol=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.FocusRegion=void 0;const e=F(),a=_e(),u=Rt(),d=we(),r=ys(),c=km(),t=(0,a.rule)({d:"inline-block",pos:"relative",va:"top",bxz:"border-box",pd:"3px",bdrad:"4px",trs:"background-color .3s ease-out"}),s=(0,a.rule)({pd:"1px 3px"}),n=(0,a.rule)({bgc:a.theme.blue(.1)}),o=(0,a.rule)({bgc:a.theme.red(.1)}),i=(0,a.rule)({bgc:a.theme.red(.08)}),l=(0,a.rule)({out:`1px dotted ${d.blue}`}),p=(0,a.rule)({out:`1px dotted ${d.negative}`}),h=(0,a.rule)({d:"inline-block",pos:"absolute",top:"-1px",l:"calc(100% + 0.5em)"}),v=(0,a.rule)({d:"inline-block",pos:"absolute",top:"-11px",l:"calc(100% - 24px)"}),y=g=>{const{focused:f,pointed:m,compact:b,aside:_,toolbar:w,negative:C,children:E,onClick:O,onMouseMove:S,onMouseEnter:x,onMouseLeave:I,onDelete:N,onEdit:R}=g,[M]=(0,u.useT)(),[T,j]=e.useState(!1),D=N?e.createElement(r.CancelAction,{tooltip:M("Delete"),onClick:N,onMouseEnter:()=>j(!0),onMouseOver:()=>j(!0),onMouseLeave:()=>j(!1)}):void 0,G=t+(b?s:"")+(m?C?o:n:"")+(T?i:"")+(f?C?p:l:"");return e.createElement("span",{className:G,style:{outline:T?`1px dotted ${d.negative}`:void 0},onMouseMove:S,onMouseEnter:x,onMouseLeave:I,onClick:O},E,D,!!f&&R&&e.createElement("span",{className:d.bottomRightActionPos},e.createElement(c.EditAction,{tooltip:M("Set"),onClick:R})),!!_&&e.createElement("span",{className:h},_),!!f&&!!w&&e.createElement("span",{className:v},w))};return Vn.FocusRegion=y,Vn}var fo={},al;function Ke(){return al||(al=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FocusProvider=e.useIsFocused=e.useFocus=e.context=void 0;const a=F();e.context=a.createContext(null);const u=()=>a.useContext(e.context);e.useFocus=u;const d=c=>{const{focused:t}=(0,e.useFocus)();return t===c};e.useIsFocused=d;const r=({children:c,onFocus:t})=>{const[s,n]=a.useState(null),[o,i]=a.useState(null),l=a.useCallback(p=>{n(p),t==null||t(p)},[t]);return a.useEffect(()=>{const p=h=>{const v=document.activeElement;v&&(v.nodeName==="INPUT"||v.nodeName==="TEXTAREA")||h.key==="Escape"&&l(null)};return document.addEventListener("keydown",p,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",p)},[]),a.createElement(e.context.Provider,{value:{focused:s,focus:l,pointed:o,point:i}},c)};e.FocusProvider=r}(fo)),fo}var ho={},cl;function yh(){return cl||(cl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputProvider=e.useInput=e.context=void 0;const a=F();e.context=a.createContext(null);const u=()=>a.useContext(e.context);e.useInput=u;const d=({children:r})=>{const c=(0,e.useInput)(),[t,s]=a.useState(!1);return a.useEffect(()=>{if(c)return;const n=()=>{s(!!document.activeElement&&document.activeElement.tagName==="INPUT")};return document.addEventListener("focus",n,!0),document.addEventListener("blur",n,!0),()=>{document.removeEventListener("focus",n),document.removeEventListener("blur",n)}},[]),c?r:a.createElement(e.context.Provider,{value:{focused:t}},r)};e.InputProvider=d}(ho)),ho}var ll;function _h(){if(ll)return Dn;ll=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.JsonHoverable=void 0;const e=F(),a=Gi(),u=ja(),d=Ke(),r=xe(),c=yh(),t=({pointer:s,children:n})=>{const{focused:o,focus:i,pointed:l,point:p}=(0,d.useFocus)(),{pfx:h,onChange:v}=e.useContext(a.context),{compact:y}=(0,r.useStyles)(),g=(0,c.useInput)(),f=h+s,m=C=>{C.stopPropagation(),l!==f&&p(f)},b=C=>{C.preventDefault(),C.stopPropagation(),p(f)},_=()=>{p(null)},w=C=>{C.preventDefault(),C.stopPropagation(),i(f)};return e.createElement(u.FocusRegion,{pointed:l===f,focused:o===f,compact:y,onClick:w,onMouseMove:m,onMouseEnter:b,onMouseLeave:_,onDelete:v&&!g.focused&&f===o?()=>v([{op:"remove",path:s}]):void 0},n)};return Dn.JsonHoverable=t,Dn}var Fn={},Jn={},Un={},zn={},Gn={},ul;function Am(){if(ul)return Gn;ul=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.TypeSwitch=void 0;const e=F(),a=_e(),u=(0,a.drule)(Object.assign(Object.assign({},a.theme.font.mono),{fz:"10px",lh:"9px",col:a.theme.color.sem.blue[0],d:"inline-block",pd:"2px 2px",mr:"0",bxz:"border-box",bd:0,bdrad:"1em"}));return Gn.TypeSwitch=e.memo(({value:d,onKeyDown:r,onClick:c})=>{const t=(0,a.useTheme)();return e.createElement("button",{className:u({bg:t.g(.96),"&:hover":{bg:t.g(.88)}}),onClick:c,onKeyDown:r},d)}),Gn}var dl;function Tm(){if(dl)return zn;dl=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.CrdtTypeSwitch=void 0;const e=F(),a=Am(),u=({types:d=["any","con","vec","val"],type:r,onSubmit:c,onClick:t})=>{const[s,n]=e.useState(d.findIndex(l=>l===r.current));e.useLayoutEffect(()=>{r.current=d[s]},[]);const o=()=>{n(l=>{const p=(l+1)%d.length;return r.current=d[p],p})},i=()=>{n(l=>{const p=(l-1+d.length)%d.length;return r.current=d[p],p})};return e.createElement("span",{style:{display:"inline-block",padding:"0 0 0 4px",margin:"-1px 0"}},e.createElement(a.TypeSwitch,{value:d[s],onClick:l=>{o(),t&&t(l)},onKeyDown:l=>{switch(l.key){case"ArrowDown":case"ArrowRight":{l.preventDefault(),o();break}case"ArrowUp":case"ArrowLeft":{l.preventDefault(),i();break}case"Enter":{l.preventDefault(),c&&(l.preventDefault(),c());break}}}}))};return zn.CrdtTypeSwitch=u,zn}var fl;function Pa(){if(fl)return Un;fl=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.ValueInput=void 0;const e=F(),a=_e(),u=Wi(),d=we(),r=gs(),c=Tm(),t=Ta(),s=({inp:n,focus:o,initialValue:i="",visible:l,types:p=["any","con","val","vec"],initialType:h,withType:v,onSubmit:y,onCancel:g})=>{const[f,m]=e.useState(i),b=e.useRef(null),_=(0,a.useTheme)(),w=e.useRef(h??(p&&p.length?p[0]:"")),C=()=>{b.current&&b.current.blur(),m(""),y(f,w.current)},E=(0,r.inputStyle)(_,!_.isLight,f);E.display=l?void 0:"none",E.margin="-1px 0 -1px -2px",E.padding="3px 4px 3px 5px",E.border=`1px solid ${_.g(.85)}`;let O=null;return p&&p.length&&v&&(O=e.createElement(c.CrdtTypeSwitch,{type:w,onSubmit:C,onClick:()=>{b.current&&b.current.focus()}})),e.createElement("span",{className:d.input,style:E},e.createElement(u.FlexibleInput,{focus:o,inp:S=>{b.current=S,n&&n(S)},value:f,typeahead:(0,r.typeahead)(f),onChange:S=>m(S.target.value),onSubmit:C,onFocus:S=>(0,t.selectOnFocus)(S.target),onCancel:S=>{m(""),g&&g(S)},onTab:S=>{const x=(0,r.typeahead)(f);x&&(S.preventDefault(),m(f+x))}}),O)};return Un.ValueInput=s,Un}var Wn={},hl;function wh(){if(hl)return Wn;hl=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.AddAction=void 0;const e=F(),a=Hi(),u=d=>e.createElement(a.Action,Object.assign({},d),"+");return Wn.AddAction=u,Wn}var pl;function Ch(){if(pl)return Jn;pl=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.ObjectInsert=void 0;const e=F(),a=Rt(),u=we(),d=_e(),r=Wi(),c=Pa(),t=wh(),s=({visible:n,withType:o,onSubmit:i})=>{const[l]=(0,a.useT)(),[p,h]=e.useState(!1),[v,y]=e.useState(""),[g,f]=e.useState(""),m=e.useRef(null),b=e.useRef(null),_=(0,d.useTheme)(),w=(C,E)=>{b.current&&b.current.blur(),i(v,C,E),y(""),f(""),h(!1)};if(!n)return null;if(p){const C=e.createElement("span",{className:u.property+u.input,style:{color:_.g(.1),background:_.bg,display:n?void 0:"none",margin:"-1px 0 -1px -2px",padding:"3px 4px",border:`1px solid ${_.g(.85)}`,fontWeight:"bold"}},e.createElement(r.FlexibleInput,{focus:!0,inp:O=>m.current=O,value:v,onChange:O=>y(O.target.value),onSubmit:()=>{b.current&&b.current.focus()},onCancel:()=>{v?y(""):g?f(""):h(!1)}})),E=e.createElement(c.ValueInput,{inp:O=>b.current=O,visible:n,withType:o,onSubmit:w,onCancel:()=>{m.current&&m.current.focus()}});return e.createElement("span",{style:{display:n?void 0:"none"}},C,e.createElement("span",{className:u.colon},e.createElement("span",null,":")),E)}return e.createElement("span",{className:u.insArrBlock,style:{display:n?void 0:"none"},onClick:()=>h(!0)},e.createElement("span",{className:u.insArrDot}),e.createElement("span",{className:u.insArrLine}),e.createElement("span",{className:u.insArrButton},e.createElement(t.AddAction,{tooltip:l("Add key"),onClick:()=>h(!0)})))};return Jn.ObjectInsert=s,Jn}var ml;function jm(){if(ml)return Fn;ml=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.JsonObjectInsert=void 0;const e=F(),a=vs(),u=Gi(),d=Ch(),r=({pointer:c,visible:t})=>{const{onChange:s}=e.useContext(u.context);if(!s)return null;const n=(o,i)=>{let l;try{l=JSON.parse(i)}catch{l=String(i)}s([{op:"add",path:c+"/"+(0,a.escapeComponent)(o),value:l}])};return e.createElement(d.ObjectInsert,{visible:t,onSubmit:n})};return Fn.JsonObjectInsert=r,Fn}var Hn={},Kn={},bl;function Ma(){if(bl)return Kn;bl=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.ArrayInsert=void 0;const e=F(),a=Rt(),u=we(),d=Pa(),r=wh(),c=ys(),t=({visible:s,withType:n,onSubmit:o})=>{const[i]=(0,a.useT)(),[l,p]=e.useState(!1),h=(v,y)=>{p(!1),o(v,y)};return l?e.createElement("span",{style:{position:"relative"}},e.createElement(d.ValueInput,{focus:!0,withType:n,visible:s,onSubmit:h,onCancel:()=>p(!1)}),e.createElement(c.CancelAction,{onClick:()=>p(!1)})):e.createElement("span",{className:u.insArrBlock,style:{display:s?void 0:"none"}},e.createElement("span",{className:u.insArrDot}),e.createElement("span",{className:u.insArrLine}),e.createElement("span",{className:u.insArrButton},e.createElement(r.AddAction,{tooltip:i("Insert"),onClick:()=>p(!0)})))};return Kn.ArrayInsert=t,Kn}var vl;function Pm(){if(vl)return Hn;vl=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.JsonArrayInsert=void 0;const e=F(),a=Gi(),u=Ma(),d=({pointer:r,visible:c})=>{const{onChange:t}=e.useContext(a.context);if(!t)return null;const s=n=>{let o;try{o=JSON.parse(n)}catch{o=String(n)}t([{op:"add",path:r,value:o}])};return e.createElement(u.ArrayInsert,{visible:c,onSubmit:s})};return Hn.JsonArrayInsert=d,Hn}var Xn={},gl;function Sh(){if(gl)return Xn;gl=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.ObjectLayout=void 0;const e=F(),a=_e(),u=we(),d=xe(),r=({property:c,collapsedView:t,header:s,collapsed:n,comma:o,brackets:i=["{","}"],children:l,onClick:p,onCollapserClick:h,onCollapsedClick:v,onBracketClick:y})=>{const[g,f]=e.useState(!1),m=(0,a.useTheme)(),{noCollapseToggles:b}=(0,d.useStyles)(),_=()=>{f(!0)},w=()=>{f(!1)},C=m.g(.3);t=e.createElement("span",{className:u.collapsed,style:{display:n?void 0:"none"},onClick:v},e.createElement("span",{style:{color:u.blue}},i[0]),t,e.createElement("span",{style:{color:u.blue}},i[1]));const E=e.createElement("span",null,c,e.createElement("span",{className:u.bracket+(g?u.bracketHovered:""),style:{display:n?"none":void 0,color:C},onMouseEnter:_,onMouseLeave:w,onClick:y},i[0],!!s&&e.createElement("span",{style:{display:"inline-block",position:"absolute",top:"-0.27em",left:"1em"}},s)));return e.createElement("span",{className:u.object,onClick:p},!b&&e.createElement("span",{className:u.collapser,style:{color:m.g(.6)},onClick:h},n?"+":"—"),E,t,e.createElement("span",{className:u.list,style:{display:n?"none":void 0}},l),e.createElement("span",{className:u.bracket+(g?u.bracketHovered:""),style:{display:n?"none":void 0,color:C},onMouseEnter:_,onMouseLeave:w,onClick:y},i[1]),!!o&&",")};return Xn.ObjectLayout=r,Xn}var yl;function Mm(){return yl||(yl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonDoc=void 0;const a=F(),u=we(),d=Gi(),r=gh(),c=Rm(),t=_h(),s=jm(),n=Pm(),o=Sh(),i=Ke(),l=xe(),p=vs(),h=({property:g,doc:f,pointer:m,parentCollapsed:b,comma:_,onChange:w})=>{const{pfx:C}=a.useContext(d.context),{focused:E}=(0,i.useFocus)(),{formal:O,keepOrder:S,collapsed:x}=(0,l.useStyles)(),I=a.useMemo(()=>{const j=Object.keys(f);return S?j:j.sort()},[f]),[N,R]=a.useState(x),M=()=>{!N&&C+m===E&&R(!0)},T=I.map((j,D)=>{const G=`${m}/${(0,p.escapeComponent)(j)}`;return a.createElement("span",{key:j,className:u.line},a.createElement(t.JsonHoverable,{pointer:G},a.createElement("span",{className:u.lineInner},a.createElement(e.JsonDoc,{property:j,doc:f[j],pointer:G,parentCollapsed:N,comma:O&&D<I.length-1,onChange:w}))))});return a.createElement(o.ObjectLayout,{collapsed:N,collapsedView:!!I.length&&a.createElement("strong",null,I.length),comma:_,property:typeof g=="string"&&a.createElement(r.JsonProperty,{key:"k"+String(b),pointer:m,onChange:w}),onClick:()=>{N&&R(!1)},onCollapserClick:()=>R(j=>!j),onBracketClick:M},T,a.createElement(s.JsonObjectInsert,{pointer:m,visible:E===C+m}))},v=({property:g,doc:f,pointer:m,parentCollapsed:b,comma:_,onChange:w})=>{const{pfx:C}=a.useContext(d.context),{focused:E}=(0,i.useFocus)(),{formal:O,collapsed:S}=(0,l.useStyles)(),[x,I]=a.useState(S),N=()=>{!x&&C+m===E&&I(!0)},R=f.map((M,T)=>{const j=`${m}/${T}`;return a.createElement(a.Fragment,{key:T},a.createElement(n.JsonArrayInsert,{pointer:`${m}/${T}`,visible:E===C+m}),a.createElement("span",{className:u.line},a.createElement(t.JsonHoverable,{pointer:j},a.createElement("span",{className:u.lineInner},a.createElement(e.JsonDoc,{doc:f[T],pointer:j,parentCollapsed:x,comma:O&&T<f.length-1,onChange:w})))))});return a.createElement(o.ObjectLayout,{collapsed:x,collapsedView:!!f.length&&a.createElement("strong",null,f.length),comma:_,property:typeof g=="string"&&a.createElement(r.JsonProperty,{key:"k"+String(b),pointer:m,onChange:w}),onClick:()=>{x&&I(!1)},onCollapserClick:()=>I(M=>!M),onBracketClick:N,brackets:["[","]"]},R,a.createElement(n.JsonArrayInsert,{pointer:`${m}/-`,visible:E===C+m}))},y=g=>{const{doc:f,comma:m}=g;return f?typeof f=="object"?Array.isArray(f)?a.createElement(v,Object.assign({},g,{doc:f})):f instanceof Uint8Array?a.createElement(c.JsonValue,Object.assign({},g,{comma:m})):a.createElement(h,Object.assign({},g,{doc:f})):a.createElement(c.JsonValue,Object.assign({},g)):a.createElement(c.JsonValue,Object.assign({},g))};e.JsonDoc=y}(qs)),qs}var Yn={},is={},_l;function qm(){if(_l)return is;_l=1,Object.defineProperty(is,"__esModule",{value:!0});var e=F(),a=bh(),u=["mousedown","touchstart"],d=function(r,c,t){t===void 0&&(t=u);var s=e.useRef(c);e.useEffect(function(){s.current=c},[c]),e.useEffect(function(){for(var n=function(p){var h=r.current;h&&!h.contains(p.target)&&s.current(p)},o=0,i=t;o<i.length;o++){var l=i[o];a.on(document,l,n)}return function(){for(var p=0,h=t;p<h.length;p++){var v=h[p];a.off(document,v,n)}}},[t,r])};return is.default=d,is}var ss={},wl;function Dm(){if(wl)return ss;wl=1,Object.defineProperty(ss,"__esModule",{value:!0});var e=F();function a(){var u=e.useRef(!1),d=e.useCallback(function(){return u.current},[]);return e.useEffect(function(){return u.current=!0,function(){u.current=!1}},[]),d}return ss.default=a,ss}var Cl;function Eh(){if(Cl)return Yn;Cl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.Root=void 0;const e=F(),a=qm(),u=Dm(),d=xe(),r=Ke(),c=yh(),s=(0,_e().rule)({d:"inline-block",ff:"monospace"}),n=({children:o,onFocus:i})=>{const l=(0,u.default)(),p=(0,d.useStyles)(),{focused:h,focus:v,point:y}=(0,r.useFocus)(),g=e.useRef(null),f=e.useRef(h);return(0,a.default)(g,()=>{l&&(y(null),v(null))}),i&&h!==f.current&&(f.current=h,i(h)),e.createElement(c.InputProvider,null,e.createElement("span",{ref:g,className:s,style:{fontSize:p.fontSize||"13.4px"}},o))};return Yn.Root=n,Yn}var Sl;function Oh(){if(Sl)return Cn;Sl=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.ClickableJson=void 0;const e=F(),a=Gi(),u=xe(),d=Mm(),r=Eh(),c=Ke(),t=_h(),s=n=>{var o;const{onFocus:i}=n,l=n.readonly?void 0:n.onChange;return e.createElement(c.FocusProvider,null,e.createElement(u.context.Provider,{value:n},e.createElement(a.context.Provider,{value:{pfx:(o=n.pfx)!==null&&o!==void 0?o:"",onChange:l}},e.createElement(r.Root,{onFocus:i},e.createElement(t.JsonHoverable,{pointer:""},e.createElement(d.JsonDoc,Object.assign({},n,{pointer:"",onChange:l})))))))};return Cn.ClickableJson=s,Cn}var Qn={},po={},El;function Xe(){return El||(El=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useJsonCrdt=e.context=void 0;const a=F();e.context=a.createContext(null);const u=()=>a.useContext(e.context);e.useJsonCrdt=u}(po)),po}var Pt={},Ol;function Ki(){if(Ol)return Pt;Ol=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.nodeRef=Pt.NodeRef=void 0;let e=class{constructor(r,c,t){this.node=r,this.parent=c,this.step=t}};Pt.NodeRef=e;const a=new WeakMap,u=(d,r,c)=>{try{const t=a.get(d);if(t)return t;const s=new e(d,r,c);return a.set(d,s),s}catch{return}};return Pt.nodeRef=u,Pt}var mo={},bo={},vo={},xl;function Vm(){return xl||(xl=1,Object.defineProperty(vo,"__esModule",{value:!0})),vo}var go={},Zn={},yo={},_o={},Rl;function Bm(){return Rl||(Rl=1,Object.defineProperty(_o,"__esModule",{value:!0})),_o}var wo={},Il;function Lm(){return Il||(Il=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class a{constructor(g,f){this.sid=g,this.time=f}}e.Timestamp=a;class u{constructor(g,f,m){this.sid=g,this.time=f,this.span=m}}e.Timespan=u;const d=(y,g)=>new a(y,g);e.ts=d;const r=(y,g,f)=>new u(y,g,f);e.tss=r;const c=(y,g)=>(0,e.ts)(y.sid,y.time+g);e.tick=c;const t=(y,g)=>y.time===g.time&&y.sid===g.sid;e.equal=t;const s=(y,g)=>{const f=y.time,m=g.time;if(f>m)return 1;if(f<m)return-1;const b=y.sid,_=g.sid;return b>_?1:b<_?-1:0};e.compare=s;const n=(y,g,f,m)=>{if(y.sid!==f.sid)return!1;const b=y.time,_=f.time;return!(b>_||b+g<_+m)};e.contains=n;const o=(y,g,f)=>{if(y.sid!==f.sid)return!1;const m=y.time,b=f.time;return!(m>b||m+g<b+1)};e.containsId=o;const i=y=>{if(y.sid===1)return"."+y.time;let g=""+y.sid;return g.length>4&&(g=".."+g.slice(g.length-4)),g+"."+y.time};e.printTs=i;const l=(y,g,f)=>new u(y.sid,y.time+g,f);e.interval=l;class p extends a{tick(g){const f=new a(this.sid,this.time);return this.time+=g,f}}e.LogicalClock=p;class h extends p{constructor(){super(...arguments),this.peers=new Map}observe(g,f){const m=g.time+f-1,b=g.sid;if(b!==this.sid){const _=this.peers.get(g.sid);_?m>_.time&&(_.time=m):this.peers.set(g.sid,(0,e.ts)(b,m))}m>=this.time&&(this.time=m+1)}clone(){return this.fork(this.sid)}fork(g){const f=new h(g,this.time);return g!==this.sid&&f.observe((0,e.tick)(this,-1),1),this.peers.forEach(m=>{f.observe(m,1)}),f}toString(g=""){const f=this.peers.size;let m=1,b="";return this.peers.forEach(_=>{b+=`
${g}${m===f?"└─":"├─"} ${_.sid}.${_.time}`,m++}),`clock ${this.sid}.${this.time}${b}`}}e.ClockVector=h;class v extends p{constructor(){super(...arguments),this.peers=new Map}observe(g,f){if(g.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<g.time)throw new Error("TIME_TRAVEL");const m=g.time+f;m>this.time&&(this.time=m)}clone(){return this.fork()}fork(){return new v(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=v}(wo)),wo}var Nl;function me(){return Nl||(Nl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(Bm(),e),a.__exportStar(Lm(),e)}(yo)),yo}var kl;function _s(){if(kl)return Zn;kl=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.ConNode=void 0;const e=me();let a=class{constructor(d,r){this.id=d,this.val=r,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(d){const r=this.val,c=r instanceof Uint8Array?`Uint8Array { ${(""+r).replaceAll(",",", ")} }`:`{ ${r instanceof e.Timestamp?(0,e.printTs)(r):JSON.stringify(r)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${c}`}};return Zn.ConNode=a,Zn}var er={},tr={},Al;function st(){if(Al)return tr;Al=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.printTree=void 0;const e=(a="",u)=>{let d="",r=u.length-1;for(;r>=0&&!u[r];r--);for(let c=0;c<=r;c++){const t=u[c];if(!t)continue;const s=c===r,n=t(a+(s?" ":"│")+"  "),o=n?s?"└─":"├─":"│";d+=`
`+a+o+(n?" "+n:"")}return d};return tr.printTree=e,tr}var Mt={},re={},Tl;function mn(){if(Tl)return re;Tl=1,Object.defineProperty(re,"__esModule",{value:!0}),re.NopOp=re.DelOp=re.UpdArrOp=re.InsArrOp=re.InsBinOp=re.InsStrOp=re.InsVecOp=re.InsObjOp=re.InsValOp=re.NewArrOp=re.NewBinOp=re.NewStrOp=re.NewVecOp=re.NewObjOp=re.NewValOp=re.NewConOp=void 0;const e=st(),a=me();class u{constructor(_){this.id=_}span(){return 1}toString(){let _=this.name()+" "+(0,a.printTs)(this.id);const w=this.span();return w>1&&(_+="!"+w),_}}class d extends u{constructor(_,w){super(_),this.id=_,this.val=w}name(){return"new_con"}toString(){const _=this.val,w="Uint8Array",C=_ instanceof a.Timestamp?`{ ${(0,a.printTs)(_)} }`:_ instanceof Uint8Array?_.length<13?`${w} { ${(""+_).replaceAll(",",", ")} }`:`${w}(${_.length})`:`{ ${JSON.stringify(_)} }`;return super.toString()+" "+C}}re.NewConOp=d;class r extends u{name(){return"new_val"}}re.NewValOp=r;class c extends u{name(){return"new_obj"}}re.NewObjOp=c;class t extends u{name(){return"new_vec"}}re.NewVecOp=t;class s extends u{name(){return"new_str"}}re.NewStrOp=s;class n extends u{name(){return"new_bin"}}re.NewBinOp=n;class o extends u{name(){return"new_arr"}}re.NewArrOp=o;class i extends u{constructor(_,w,C){super(_),this.id=_,this.obj=w,this.val=C}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,a.printTs)(this.obj)}, val = ${(0,a.printTs)(this.val)}`}}re.InsValOp=i;class l extends u{constructor(_,w,C){super(_),this.id=_,this.obj=w,this.data=C}name(){return"ins_obj"}toString(_=""){return super.toString()+`, obj = ${(0,a.printTs)(this.obj)}`+(0,e.printTree)(_,this.data.map(C=>E=>`${JSON.stringify(C[0])}: ${(0,a.printTs)(C[1])}`))}}re.InsObjOp=l;class p extends u{constructor(_,w,C){super(_),this.id=_,this.obj=w,this.data=C}name(){return"ins_vec"}toString(_=""){return super.toString()+`, obj = ${(0,a.printTs)(this.obj)}`+(0,e.printTree)(_,this.data.map(C=>E=>`${C[0]}: ${(0,a.printTs)(C[1])}`))}}re.InsVecOp=p;class h extends u{constructor(_,w,C,E){super(_),this.id=_,this.obj=w,this.ref=C,this.data=E}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,a.printTs)(this.obj)} { ${(0,a.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}re.InsStrOp=h;class v extends u{constructor(_,w,C,E){super(_),this.id=_,this.obj=w,this.ref=C,this.data=E}span(){return this.data.length}name(){return"ins_bin"}toString(){const _=(0,a.printTs)(this.ref);return super.toString()+`, obj = ${(0,a.printTs)(this.obj)} { ${_} ← ${this.data} }`}}re.InsBinOp=v;class y extends u{constructor(_,w,C,E){super(_),this.id=_,this.obj=w,this.ref=C,this.data=E}span(){return this.data.length}name(){return"ins_arr"}toString(){const _=(0,a.printTs)(this.obj),w=(0,a.printTs)(this.ref),C=this.data.map(a.printTs).join(", ");return super.toString()+", obj = "+_+" { "+w+" ← "+C+" }"}}re.InsArrOp=y;class g extends u{constructor(_,w,C,E){super(_),this.id=_,this.obj=w,this.ref=C,this.val=E}name(){return"upd_arr"}toString(){const _=(0,a.printTs)(this.obj),w=(0,a.printTs)(this.ref),C=(0,a.printTs)(this.val);return super.toString()+", obj = "+_+" { "+w+": "+C+" }"}}re.UpdArrOp=g;class f extends u{constructor(_,w,C){super(_),this.id=_,this.obj=w,this.what=C}name(){return"del"}toString(){const _=this.what.map(w=>(0,a.printTs)(w)+"!"+w.span).join(", ");return super.toString()+`, obj = ${(0,a.printTs)(this.obj)} { ${_} }`}}re.DelOp=f;class m extends u{constructor(_,w){super(_),this.id=_,this.len=w}span(){return this.len}name(){return"nop"}}return re.NopOp=m,re}var qt={},nr={},rr={},ir={},jl;function $m(){if(jl)return ir;jl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.RelativeTimestamp=void 0;let e=class{constructor(u,d){this.sessionIndex=u,this.timeDiff=d}};return ir.RelativeTimestamp=e,ir}var Pl;function Fm(){if(Pl)return rr;Pl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.ClockEncoder=void 0;const e=me(),a=$m();class u{constructor(c,t){this.index=c,this.clock=t}}let d=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(c){this.index=1,this.clock=c;const t=new u(this.index++,(0,e.tick)(c,-1));this.table.clear(),this.table.set(c.sid,t)}append(c){const t=c.time,s=c.sid;let n=this.table.get(s);if(!n){let l=this.clock.peers.get(s);l||(l=new e.Timestamp(s,this.clock.time-1)),n=new u(this.index++,l),this.table.set(s,n)}const i=n.clock.time-t;if(i<0)throw new Error("TIME_TRAVEL");return new a.RelativeTimestamp(n.index,i)}toJson(){const c=[];return this.table.forEach(t=>{const s=t.clock;c.push(s.sid,s.time)}),c}};return rr.ClockEncoder=d,rr}var sr={},or={},ar={},Ml;function Jm(){if(Ml)return ar;Ml=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.Slice=void 0;let e=class{constructor(u,d,r,c){this.uint8=u,this.view=d,this.start=r,this.end=c}subarray(){return this.uint8.subarray(this.start,this.end)}};return ar.Slice=e,ar}var ql;function xh(){if(ql)return or;ql=1,Object.defineProperty(or,"__esModule",{value:!0}),or.Writer=void 0;const e=Jm(),a=new Uint8Array([]),u=new DataView(a.buffer),d=typeof Te.Buffer=="function",r=d?Te.Buffer.prototype.utf8Write:null,c=d?Te.Buffer.from:null,t=typeof TextEncoder<"u"?new TextEncoder:null;let s=class{constructor(o=64*1024){this.allocSize=o,this.view=u,this.x0=0,this.x=0,this.uint8=new Uint8Array(o),this.size=o,this.view=new DataView(this.uint8.buffer)}grow(o){const i=this.x0,l=this.x,p=this.uint8,h=new Uint8Array(o),v=new DataView(h.buffer),y=p.subarray(i,l);h.set(y,0),this.x=l-i,this.x0=0,this.uint8=h,this.size=o,this.view=v}ensureCapacity(o){const i=this.size,l=i-this.x;if(l<o){const p=i-this.x0,h=o-l,v=p+h;this.grow(v<=this.allocSize?this.allocSize:v*2)}}move(o){this.ensureCapacity(o),this.x+=o}reset(){this.x0=this.x}newBuffer(o){const i=this.uint8=new Uint8Array(o);this.size=o,this.view=new DataView(i.buffer),this.x=this.x0=0}flush(){const o=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,o}flushSlice(){const o=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,o}u8(o){this.ensureCapacity(1),this.uint8[this.x++]=o}u16(o){this.ensureCapacity(2),this.view.setUint16(this.x,o),this.x+=2}u32(o){this.ensureCapacity(4),this.view.setUint32(this.x,o),this.x+=4}i32(o){this.ensureCapacity(4),this.view.setInt32(this.x,o),this.x+=4}u64(o){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(o)),this.x+=8}f64(o){this.ensureCapacity(8),this.view.setFloat64(this.x,o),this.x+=8}u8u16(o,i){this.ensureCapacity(3);let l=this.x;this.uint8[l++]=o,this.uint8[l++]=i>>>8,this.uint8[l++]=i&255,this.x=l}u8u32(o,i){this.ensureCapacity(5);let l=this.x;this.uint8[l++]=o,this.view.setUint32(l,i),this.x=l+4}u8u64(o,i){this.ensureCapacity(9);let l=this.x;this.uint8[l++]=o,this.view.setBigUint64(l,BigInt(i)),this.x=l+8}u8f32(o,i){this.ensureCapacity(5);let l=this.x;this.uint8[l++]=o,this.view.setFloat32(l,i),this.x=l+4}u8f64(o,i){this.ensureCapacity(9);let l=this.x;this.uint8[l++]=o,this.view.setFloat64(l,i),this.x=l+8}buf(o,i){this.ensureCapacity(i);const l=this.x;this.uint8.set(o,l),this.x=l+i}utf8(o){const i=o.length*4;if(i<168)return this.utf8Native(o);if(r){const l=r.call(this.uint8,o,this.x,i);return this.x+=l,l}else if(c){const l=this.uint8,p=l.byteOffset+this.x,v=c(l.buffer).subarray(p,p+i).write(o,0,i,"utf8");return this.x+=v,v}else if(i>1024&&t){const l=t.encodeInto(o,this.uint8.subarray(this.x,this.x+i)).written;return this.x+=l,l}return this.utf8Native(o)}utf8Native(o){const i=o.length,l=this.uint8;let p=this.x,h=0;for(;h<i;){let y=o.charCodeAt(h++);if((y&4294967168)===0){l[p++]=y;continue}else if((y&4294965248)===0)l[p++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&h<i){const g=o.charCodeAt(h);(g&64512)===56320&&(h++,y=((y&1023)<<10)+(g&1023)+65536)}(y&4294901760)===0?(l[p++]=y>>12&15|224,l[p++]=y>>6&63|128):(l[p++]=y>>18&7|240,l[p++]=y>>12&63|128,l[p++]=y>>6&63|128)}l[p++]=y&63|128}const v=p-this.x;return this.x=p,v}ascii(o){const i=o.length;this.ensureCapacity(i);const l=this.uint8;let p=this.x,h=0;for(;h<i;)l[p++]=o.charCodeAt(h++);this.x=p}};return or.Writer=s,or}var Dl;function qa(){if(Dl)return sr;Dl=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.CrdtWriter=void 0;const e=xh();let a=class extends e.Writer{id(d,r){d<=7&&r<=15?this.u8(d<<4|r):(this.b1vu56(1,d),this.vu57(r))}vu57(d){if(d<=127)this.u8(d);else if(d<=16383){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=d>>>7}else if(d<=2097151){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=d>>>14}else if(d<=268435455){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=128|d>>>14&127,r[this.x++]=d>>>21}else{let r=d|0;r<0&&(r+=4294967296);const c=(d-r)/4294967296;if(d<=34359738367){this.ensureCapacity(5);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=c<<4|d>>>28}else if(d<=4398046511103){this.ensureCapacity(6);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=c>>>3}else if(d<=562949953421311){this.ensureCapacity(7);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=128|(c&1016)>>>3,t[this.x++]=c>>>10}else{this.ensureCapacity(8);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=128|(c&1016)>>>3,t[this.x++]=128|(c&130048)>>>10,t[this.x++]=c>>>17}}}b1vu56(d,r){if(r<=63)this.u8(d<<7|r);else{const c=d<<7|64;if(r<=8191){this.ensureCapacity(2);const t=this.uint8;t[this.x++]=c|r&63,t[this.x++]=r>>>6}else if(r<=1048575){this.ensureCapacity(3);const t=this.uint8;t[this.x++]=c|r&63,t[this.x++]=128|r>>>6&127,t[this.x++]=r>>>13}else if(r<=134217727){this.ensureCapacity(4);const t=this.uint8;t[this.x++]=c|r&63,t[this.x++]=128|r>>>6&127,t[this.x++]=128|r>>>13&127,t[this.x++]=r>>>20}else{let t=r|0;t<0&&(t+=4294967296);const s=(r-t)/4294967296;if(r<=17179869183){this.ensureCapacity(5);const n=this.uint8;n[this.x++]=c|r&63,n[this.x++]=128|r>>>6&127,n[this.x++]=128|r>>>13&127,n[this.x++]=128|r>>>20&127,n[this.x++]=s<<5|r>>>27}else if(r<=2199023255551){this.ensureCapacity(6);const n=this.uint8;n[this.x++]=c|r&63,n[this.x++]=128|r>>>6&127,n[this.x++]=128|r>>>13&127,n[this.x++]=128|r>>>20&127,n[this.x++]=128|(s&3)<<5|r>>>27,n[this.x++]=s>>>2}else if(r<=0xffffffffffff){this.ensureCapacity(7);const n=this.uint8;n[this.x++]=c|r&63,n[this.x++]=128|r>>>6&127,n[this.x++]=128|r>>>13&127,n[this.x++]=128|r>>>20&127,n[this.x++]=128|(s&3)<<5|r>>>27,n[this.x++]=128|(s&508)>>>2,n[this.x++]=s>>>9}else{this.ensureCapacity(8);const n=this.uint8;n[this.x++]=c|r&63,n[this.x++]=128|r>>>6&127,n[this.x++]=128|r>>>13&127,n[this.x++]=128|r>>>20&127,n[this.x++]=128|(s&3)<<5|r>>>27,n[this.x++]=128|(s&508)>>>2,n[this.x++]=128|(s&65024)>>>9,n[this.x++]=s>>>16}}}}};return sr.CrdtWriter=a,sr}var cr={},lr={},Vl;function Um(){if(Vl)return lr;Vl=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),a=u=>(e.setFloat32(0,u),u===e.getFloat32(0));return lr.isFloat32=a,lr}var ur={},Bl;function Rh(){if(Bl)return ur;Bl=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.JsonPackExtension=void 0;let e=class{constructor(u,d){this.tag=u,this.val=d}};return ur.JsonPackExtension=e,ur}var dr={},Ll;function zm(){if(Ll)return dr;Ll=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.CborEncoderFast=void 0;const e=xh(),a=Number.isSafeInteger;let u=class{constructor(r=new e.Writer){this.writer=r}encode(r){return this.writeAny(r),this.writer.flush()}encodeToSlice(r){return this.writeAny(r),this.writer.flushSlice()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Array:return this.writeArr(r);default:return this.writeObj(r)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(r){r?this.writer.u8(245):this.writer.u8(244)}writeNumber(r){a(r)?this.writeInteger(r):typeof r=="bigint"?this.writeBigInt(r):this.writeFloat(r)}writeBigInt(r){r>=0?this.writeBigUint(r):this.writeBigSint(r)}writeBigUint(r){if(r<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(r));this.writer.u8u64(27,r)}writeBigSint(r){if(r>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(r));const c=-BigInt(1)-r;this.writer.u8u64(59,c)}writeInteger(r){r>=0?this.writeUInteger(r):this.encodeNint(r)}writeUInteger(r){const c=this.writer;c.ensureCapacity(9);const t=c.uint8;let s=c.x;r<=23?t[s++]=0+r:r<=255?(t[s++]=24,t[s++]=r):r<=65535?(t[s++]=25,c.view.setUint16(s,r),s+=2):r<=4294967295?(t[s++]=26,c.view.setUint32(s,r),s+=4):(t[s++]=27,c.view.setBigUint64(s,BigInt(r)),s+=8),c.x=s}encodeNumber(r){this.writeNumber(r)}encodeInteger(r){this.writeInteger(r)}encodeUint(r){this.writeUInteger(r)}encodeNint(r){const c=-1-r,t=this.writer;t.ensureCapacity(9);const s=t.uint8;let n=t.x;c<24?s[n++]=32+c:c<=255?(s[n++]=56,s[n++]=c):c<=65535?(s[n++]=57,t.view.setUint16(n,c),n+=2):c<=4294967295?(s[n++]=58,t.view.setUint32(n,c),n+=4):(s[n++]=59,t.view.setBigUint64(n,BigInt(c)),n+=8),t.x=n}writeFloat(r){this.writer.u8f64(251,r)}writeBin(r){const c=r.length;this.writeBinHdr(c),this.writer.buf(r,c)}writeBinHdr(r){const c=this.writer;r<=23?c.u8(64+r):r<=255?c.u16(22528+r):r<=65535?c.u8u16(89,r):r<=4294967295?c.u8u32(90,r):c.u8u64(91,r)}writeStr(r){const c=this.writer,s=r.length*4;c.ensureCapacity(5+s);const n=c.uint8;let o=c.x;s<=23?c.x++:s<=255?(n[c.x++]=120,o=c.x,c.x++):s<=65535?(n[c.x++]=121,o=c.x,c.x+=2):(n[c.x++]=122,o=c.x,c.x+=4);const i=c.utf8(r);s<=23?n[o]=96+i:s<=255?n[o]=i:s<=65535?c.view.setUint16(o,i):c.view.setUint32(o,i)}writeStrHdr(r){const c=this.writer;r<=23?c.u8(96+r):r<=255?c.u16(30720+r):r<=65535?c.u8u16(121,r):c.u8u32(122,r)}writeAsciiStr(r){this.writeStrHdr(r.length),this.writer.ascii(r)}writeArr(r){const c=r.length;this.writeArrHdr(c);for(let t=0;t<c;t++)this.writeAny(r[t])}writeArrHdr(r){const c=this.writer;r<=23?c.u8(128+r):r<=255?c.u16(38912+r):r<=65535?c.u8u16(153,r):r<=4294967295?c.u8u32(154,r):c.u8u64(155,r)}writeObj(r){const c=Object.keys(r),t=c.length;this.writeObjHdr(t);for(let s=0;s<t;s++){const n=c[s];this.writeStr(n),this.writeAny(r[n])}}writeObjHdr(r){const c=this.writer;r<=23?c.u8(160+r):r<=255?c.u16(47104+r):r<=65535?c.u8u16(185,r):r<=4294967295?c.u8u32(186,r):c.u8u64(187,r)}writeMapHdr(r){this.writeObjHdr(r)}writeStartMap(){this.writer.u8(191)}writeTag(r,c){this.writeTagHdr(r),this.writeAny(c)}writeTagHdr(r){const c=this.writer;r<=23?c.u8(192+r):r<=255?c.u16(55296+r):r<=65535?c.u8u16(217,r):r<=4294967295?c.u8u32(218,r):c.u8u64(219,r)}writeTkn(r){const c=this.writer;r<=23?c.u8(224+r):r<=255&&c.u16(63488+r)}writeStartStr(){this.writer.u8(127)}writeStrChunk(r){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(r){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(r){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(r,c){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return dr.CborEncoderFast=u,dr}var fr={},$l;function Da(){if($l)return fr;$l=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.JsonPackValue=void 0;let e=class{constructor(u){this.val=u}};return fr.JsonPackValue=e,fr}var Fl;function Ih(){if(Fl)return cr;Fl=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.CborEncoder=void 0;const e=Um(),a=Rh(),u=zm(),d=Da();let r=class extends u.CborEncoderFast{writeUnknown(t){this.writeNull()}writeAny(t){switch(typeof t){case"number":return this.writeNumber(t);case"string":return this.writeStr(t);case"boolean":return this.writer.u8(244+ +t);case"object":{if(!t)return this.writer.u8(246);switch(t.constructor){case Object:return this.writeObj(t);case Array:return this.writeArr(t);case Uint8Array:return this.writeBin(t);case Map:return this.writeMap(t);case a.JsonPackExtension:return this.writeTag(t.tag,t.val);case d.JsonPackValue:const n=t.val;return this.writer.buf(n,n.length);default:return t instanceof Uint8Array?this.writeBin(t):Array.isArray(t)?this.writeArr(t):t instanceof Map?this.writeMap(t):this.writeUnknown(t)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(t);default:return this.writeUnknown(t)}}writeFloat(t){(0,e.isFloat32)(t)?this.writer.u8f32(250,t):this.writer.u8f64(251,t)}writeMap(t){this.writeMapHdr(t.size),t.forEach((s,n)=>{this.writeAny(n),this.writeAny(s)})}writeUndef(){this.writer.u8(247)}};return cr.CborEncoder=r,cr}var Dt={},Jl;function Nh(){if(Jl)return Dt;Jl=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.CRDT_MAJOR_OVERLAY=Dt.CRDT_MAJOR=void 0;var e;(function(u){u[u.CON=0]="CON",u[u.VAL=1]="VAL",u[u.OBJ=2]="OBJ",u[u.VEC=3]="VEC",u[u.STR=4]="STR",u[u.BIN=5]="BIN",u[u.ARR=6]="ARR"})(e||(Dt.CRDT_MAJOR=e={}));var a;return function(u){u[u.CON=0]="CON",u[u.VAL=32]="VAL",u[u.VEC=96]="VEC",u[u.OBJ=64]="OBJ",u[u.STR=128]="STR",u[u.BIN=160]="BIN",u[u.ARR=192]="ARR"}(a||(Dt.CRDT_MAJOR_OVERLAY=a={})),Dt}var Ul;function Gm(){if(Ul)return nr;Ul=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.Encoder=void 0;const a=ne.__importStar(It()),u=Fm(),d=qa(),r=me(),c=Ih(),t=Nh();class s extends c.CborEncoder{constructor(o){super(o||new d.CrdtWriter),this.clockEncoder=new u.ClockEncoder,this.time=0,this.cTableEntry=i=>{const l=i.clock,p=this.writer;p.vu57(l.sid),p.vu57(l.time)},this.tsLogical=i=>{const l=this.clockEncoder.append(i);this.writer.id(l.sessionIndex,l.timeDiff)},this.tsServer=i=>{this.writer.vu57(i.time)},this.ts=this.tsLogical,this.cKey=(i,l)=>{this.writeStr(l),this.cNode(this.doc.index.get(i))}}encode(o){this.doc=o;const i=this.writer;return i.reset(),o.clock.sid===1?this.encodeServer(o):this.encodeLogical(o),i.flush()}encodeLogical(o){const i=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(o.clock),i.ensureCapacity(4);const l=i.x0,p=i.x;i.x+=4,this.cRoot(o.root),this.encodeClockTable(l,p)}encodeServer(o){this.ts=this.tsServer;const i=this.writer;i.u8(128),i.vu57(this.time=o.clock.time),this.cRoot(o.root)}encodeClockTable(o,i){const l=this.writer,p=l.x0-o;l.view.setUint32(l.x0+(i-o),l.x-i-p-4);const v=this.clockEncoder.table,y=v.size;l.vu57(y),v.forEach(this.cTableEntry)}cRoot(o){o.val.sid===0?this.writer.u8(0):this.cNode(o.node())}writeTL(o,i){const l=this.writer;i<31?l.u8(o|i):(l.u8(o|31),l.vu57(i))}cNode(o){o instanceof a.ConNode?this.cCon(o):o instanceof a.ValNode?this.cVal(o):o instanceof a.StrNode?this.cStr(o):o instanceof a.ObjNode?this.cObj(o):o instanceof a.VecNode?this.cVec(o):o instanceof a.ArrNode?this.cArr(o):o instanceof a.BinNode&&this.cBin(o)}cCon(o){const i=o.val;this.ts(o.id),i instanceof r.Timestamp?(this.writer.u8(1),this.ts(i)):(this.writer.u8(0),this.writeAny(i))}cVal(o){this.ts(o.id),this.writer.u8(32),this.cNode(o.node())}cObj(o){this.ts(o.id);const i=o.keys;this.writeTL(t.CRDT_MAJOR_OVERLAY.OBJ,i.size),i.forEach(this.cKey)}cVec(o){const i=o.elements,l=i.length;this.ts(o.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.VEC,l);const p=this.doc.index;for(let h=0;h<l;h++){const v=i[h];v?this.cNode(p.get(v)):this.writer.u8(0)}}cStr(o){const i=this.ts;i(o.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.STR,o.count);for(let l=o.first();l;l=o.next(l))i(l.id),l.del?this.writeUInteger(l.span):this.writeStr(l.data)}cBin(o){const i=this.ts,l=this.writer;i(o.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.BIN,o.count);for(let p=o.first();p;p=o.next(p)){i(p.id);const h=p.span,v=p.del;l.b1vu56(~~v,h),!v&&l.buf(p.data,h)}}cArr(o){const i=this.ts,l=this.writer;i(o.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.ARR,o.count);const p=this.doc.index;for(let h=o.first();h;h=o.next(h)){i(h.id);const v=h.span,y=h.del;if(l.b1vu56(~~y,v),y)continue;const g=h.data;for(let f=0;f<v;f++)this.cNode(p.get(g[f]))}}}return nr.Encoder=s,nr}var hr={},pr={},zl;function Wm(){if(zl)return pr;zl=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.ClockDecoder=void 0;const e=me();let a=class kh{static fromArr(d){const r=new kh(d[0],d[1]),c=d.length;for(let t=2;t<c;t+=2)r.pushTuple(d[t],d[t+1]);return r}constructor(d,r){this.table=[],this.clock=new e.ClockVector(d,r+1),this.table.push((0,e.ts)(d,r))}pushTuple(d,r){const c=(0,e.ts)(d,r);this.clock.observe(c,1),this.table.push(c)}decodeId(d,r){if(!d)return(0,e.ts)(0,r);const c=this.table[d-1];if(!c)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(c.sid,c.time-r)}};return pr.ClockDecoder=a,pr}var mr={},br={},vr={},os={},Vt={},Gl;function Hm(){if(Gl)return Vt;Gl=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.decodeAsciiMax15=Vt.decodeAscii=void 0;const e=String.fromCharCode,a=(d,r,c)=>{const t=[];for(let s=0;s<c;s++){const n=d[r++];if(n&128)return;t.push(n)}return e.apply(String,t)};Vt.decodeAscii=a;const u=(d,r,c)=>{if(c<4)if(c<2){if(c===0)return"";{const t=d[r++];if((t&128)>1){r-=1;return}return e(t)}}else{const t=d[r++],s=d[r++];if((t&128)>0||(s&128)>0){r-=2;return}if(c<3)return e(t,s);const n=d[r++];if((n&128)>0){r-=3;return}return e(t,s,n)}else{const t=d[r++],s=d[r++],n=d[r++],o=d[r++];if((t&128)>0||(s&128)>0||(n&128)>0||(o&128)>0){r-=4;return}if(c<6){if(c===4)return e(t,s,n,o);{const i=d[r++];if((i&128)>0){r-=5;return}return e(t,s,n,o,i)}}else if(c<8){const i=d[r++],l=d[r++];if((i&128)>0||(l&128)>0){r-=6;return}if(c<7)return e(t,s,n,o,i,l);const p=d[r++];if((p&128)>0){r-=7;return}return e(t,s,n,o,i,l,p)}else{const i=d[r++],l=d[r++],p=d[r++],h=d[r++];if((i&128)>0||(l&128)>0||(p&128)>0||(h&128)>0){r-=8;return}if(c<10){if(c===8)return e(t,s,n,o,i,l,p,h);{const v=d[r++];if((v&128)>0){r-=9;return}return e(t,s,n,o,i,l,p,h,v)}}else if(c<12){const v=d[r++],y=d[r++];if((v&128)>0||(y&128)>0){r-=10;return}if(c<11)return e(t,s,n,o,i,l,p,h,v,y);const g=d[r++];if((g&128)>0){r-=11;return}return e(t,s,n,o,i,l,p,h,v,y,g)}else{const v=d[r++],y=d[r++],g=d[r++],f=d[r++];if((v&128)>0||(y&128)>0||(g&128)>0||(f&128)>0){r-=12;return}if(c<14){if(c===12)return e(t,s,n,o,i,l,p,h,v,y,g,f);{const m=d[r++];if((m&128)>0){r-=13;return}return e(t,s,n,o,i,l,p,h,v,y,g,f,m)}}else{const m=d[r++],b=d[r++];if((m&128)>0||(b&128)>0){r-=14;return}if(c<15)return e(t,s,n,o,i,l,p,h,v,y,g,f,m,b);const _=d[r++];if((_&128)>0){r-=15;return}return e(t,s,n,o,i,l,p,h,v,y,g,f,m,b,_)}}}}};return Vt.decodeAsciiMax15=u,Vt}var as={},Wl;function Km(){if(Wl)return as;Wl=1,Object.defineProperty(as,"__esModule",{value:!0});const e=String.fromCharCode;return as.default=(a,u,d)=>{let r=u;const c=r+d,t=[];for(;r<c;){let s=a[r++];if((s&128)!==0){const n=a[r++]&63;if((s&224)===192)s=(s&31)<<6|n;else{const o=a[r++]&63;if((s&240)===224)s=(s&31)<<12|n<<6|o;else if((s&248)===240){const i=a[r++]&63;let l=(s&7)<<18|n<<12|o<<6|i;if(l>65535){l-=65536;const p=l>>>10&1023|55296;s=56320|l&1023,t.push(p)}else s=l}}}t.push(s)}return e.apply(String,t)},as}var Hl;function Xm(){if(Hl)return os;Hl=1,Object.defineProperty(os,"__esModule",{value:!0});const e=ne,a=Hm(),u=e.__importDefault(Km()),d=typeof Te.Buffer<"u",r=d?Te.Buffer.prototype.utf8Slice:null,c=d?Te.Buffer.from:null,t=(i,l,p)=>(0,a.decodeAsciiMax15)(i,l,p)??(0,u.default)(i,l,p),s=(i,l,p)=>(0,a.decodeAscii)(i,l,p)??(0,u.default)(i,l,p),n=r?(i,l,p)=>r.call(i,l,l+p):c?(i,l,p)=>c(i).subarray(l,l+p).toString("utf8"):u.default,o=(i,l,p)=>p<16?t(i,l,p):p<32?s(i,l,p):n(i,l,p);return os.default=o,os}var Kl;function Ym(){if(Kl)return vr;Kl=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.decodeUtf8=void 0;const a=ne.__importDefault(Xm());return vr.decodeUtf8=a.default,vr}var Xl;function Ah(){if(Xl)return br;Xl=1,Object.defineProperty(br,"__esModule",{value:!0}),br.Reader=void 0;const e=Ym();let a=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(d){this.x=0,this.uint8=d,this.view=new DataView(d.buffer,d.byteOffset,d.length)}peak(){return this.view.getUint8(this.x)}skip(d){this.x+=d}buf(d){const r=this.x+d,c=this.uint8.subarray(this.x,r);return this.x=r,c}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let d=this.x;const r=(this.uint8[d++]<<8)+this.uint8[d++];return this.x=d,r}i16(){const d=this.view.getInt16(this.x);return this.x+=2,d}u32(){const d=this.view.getUint32(this.x);return this.x+=4,d}i32(){const d=this.view.getInt32(this.x);return this.x+=4,d}u64(){const d=this.view.getBigUint64(this.x);return this.x+=8,d}i64(){const d=this.view.getBigInt64(this.x);return this.x+=8,d}f32(){const d=this.x;return this.x+=4,this.view.getFloat32(d)}f64(){const d=this.x;return this.x+=8,this.view.getFloat64(d)}utf8(d){const r=this.x;return this.x+=d,(0,e.decodeUtf8)(this.uint8,r,d)}ascii(d){const r=this.uint8;let c="";const t=this.x+d;for(let s=this.x;s<t;s++)c+=String.fromCharCode(r[s]);return this.x=t,c}};return br.Reader=a,br}var Yl;function Th(){if(Yl)return mr;Yl=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.CrdtReader=void 0;const e=Ah();let a=class extends e.Reader{id(){const d=this.u8();return d<=127?[d>>>4,d&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const d=this.u8();if(d<=127)return d;const r=this.u8();if(r<=127)return r<<7|d&127;const c=this.u8();if(c<=127)return c<<14|(r&127)<<7|d&127;const t=this.u8();if(t<=127)return t<<21|(c&127)<<14|(r&127)<<7|d&127;const s=this.u8();if(s<=127)return s*268435456+((t&127)<<21|(c&127)<<14|(r&127)<<7|d&127);const n=this.u8();if(n<=127)return n*34359738368+((s&127)*268435456+((t&127)<<21|(c&127)<<14|(r&127)<<7|d&127));const o=this.u8();return o<=127?o*4398046511104+((n&127)*34359738368+((s&127)*268435456+((t&127)<<21|(c&127)<<14|(r&127)<<7|d&127))):this.u8()*562949953421312+((o&127)*4398046511104+((n&127)*34359738368+((s&127)*268435456+((t&127)<<21|(c&127)<<14|(r&127)<<7|d&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const d=this.u8(),r=d&128?1:0,c=127&d;if(c<=63)return[r,c];const t=this.u8();if(t<=127)return[r,t<<6|c&63];const s=this.u8();if(s<=127)return[r,s<<13|(t&127)<<6|c&63];const n=this.u8();if(n<=127)return[r,n<<20|(s&127)<<13|(t&127)<<6|c&63];const o=this.u8();if(o<=127)return[r,o*134217728+((n&127)<<20|(s&127)<<13|(t&127)<<6|c&63)];const i=this.u8();if(i<=127)return[r,i*17179869184+((o&127)*134217728+((n&127)<<20|(s&127)<<13|(t&127)<<6|c&63))];const l=this.u8();if(l<=127)return[r,l*2199023255552+((i&127)*17179869184+((o&127)*134217728+((n&127)<<20|(s&127)<<13|(t&127)<<6|c&63)))];const p=this.u8();return[r,p*281474976710656+((l&127)*2199023255552+((i&127)*17179869184+((o&127)*134217728+((n&127)<<20|(s&127)<<13|(t&127)<<6|c&63))))]}};return mr.CrdtReader=a,mr}var gr={},yr={},Ql;function Qm(){if(Ql)return yr;Ql=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.decodeF16=void 0;const e=Math.pow,a=u=>{const d=(u&31744)>>10,r=u&1023;return(u>>15?-1:1)*(d?d===31?r?NaN:1/0:e(2,d-15)*(1+r/1024):6103515625e-14*(r/1024))};return yr.decodeF16=a,yr}var cs={},_r={},ls={},Zl;function Zm(){if(Zl)return ls;Zl=1,Object.defineProperty(ls,"__esModule",{value:!0});const e=String.fromCharCode;return ls.default=(a,u,d)=>{let r=u;const c=r+d;let t="";for(;r<c;){const s=a[r++];if((s&128)===0){t+=e(s);continue}const n=a[r++]&63;if((s&224)===192){t+=e((s&31)<<6|n);continue}const o=a[r++]&63;if((s&240)===224){t+=e((s&31)<<12|n<<6|o);continue}if((s&248)===240){const i=a[r++]&63;let l=(s&7)<<18|n<<12|o<<6|i;if(l>65535){l-=65536;const p=l>>>10&1023|55296;l=56320|l&1023,t+=e(p,l)}else t+=e(l)}else t+=e(s)}return t},ls}var eu;function e1(){if(eu)return _r;eu=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.CachedUtf8Decoder=void 0;const a=ne.__importDefault(Zm());let u=1+Math.round(Math.random()*((-1>>>0)-1));function d(t,s){return u^=u<<13,u^=u>>>17,u^=u<<5,(u>>>0)%(s-t+1)+t}class r{constructor(s,n){this.bytes=s,this.value=n}}let c=class{constructor(){this.caches=[];for(let s=0;s<31;s++)this.caches.push([])}get(s,n,o){const i=this.caches[o-1],l=i.length;e:for(let p=0;p<l;p++){const h=i[p],v=h.bytes;for(let y=0;y<o;y++)if(v[y]!==s[n+y])continue e;return h.value}return null}store(s,n){const o=this.caches[s.length-1],i=new r(s,n);o.length>=16?o[d(0,15)]=i:o.push(i)}decode(s,n,o){if(!o)return"";const i=this.get(s,n,o);if(i!==null)return i;const l=(0,a.default)(s,n,o),p=Uint8Array.prototype.slice.call(s,n,n+o);return this.store(p,l),l}};return _r.CachedUtf8Decoder=c,_r}var tu;function t1(){if(tu)return cs;tu=1,Object.defineProperty(cs,"__esModule",{value:!0});const e=e1();return cs.default=new e.CachedUtf8Decoder,cs}var nu;function jh(){if(nu)return gr;nu=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.CborDecoderBase=void 0;const e=ne,a=Qm(),u=Rh(),d=Da(),r=Ah(),c=e.__importDefault(t1());let t=class{constructor(n=new r.Reader,o=c.default){this.reader=n,this.keyDecoder=o}read(n){return this.reader.reset(n),this.val()}decode(n){return this.reader.reset(n),this.val()}val(){const o=this.reader.u8(),i=o>>5,l=o&31;return i<4?i<2?i===0?this.readUint(l):this.readNint(l):i===2?this.readBin(l):this.readStr(l):i<6?i===4?this.readArr(l):this.readObj(l):i===6?this.readTag(l):this.readTkn(l)}readAnyRaw(n){const o=n>>5,i=n&31;return o<4?o<2?o===0?this.readUint(i):this.readNint(i):o===2?this.readBin(i):this.readStr(i):o<6?o===4?this.readArr(i):this.readObj(i):o===6?this.readTag(i):this.readTkn(i)}readMinorLen(n){if(n<24)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(n){if(n<25)return n===24?this.reader.u8():n;if(n<27)return n===25?this.reader.u16():this.reader.u32();{const o=this.reader.u64();return o>9007199254740991?o:Number(o)}}readNint(n){if(n<25)return n===24?-this.reader.u8()-1:-n-1;if(n<27)return n===25?-this.reader.u16()-1:-this.reader.u32()-1;{const o=this.reader.u64();return o>9007199254740991-1?-o-BigInt(1):-Number(o)-1}}readBin(n){const o=this.reader;if(n<=23)return o.buf(n);switch(n){case 24:return o.buf(o.u8());case 25:return o.buf(o.u16());case 26:return o.buf(o.u32());case 27:return o.buf(Number(o.u64()));case 31:{let i=0;const l=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();i+=y.length,l.push(y)}this.reader.x++;const p=new Uint8Array(i);let h=0;const v=l.length;for(let y=0;y<v;y++){const g=l[y];p.set(g,h),h+=g.length}return p}default:throw 1}}readBinChunk(){const n=this.reader.u8(),o=n>>5,i=n&31;if(o!==2)throw 2;if(i>27)throw 3;return this.readBin(i)}readAsStr(){const o=this.reader.u8(),i=o>>5,l=o&31;if(i!==3)throw 11;return this.readStr(l)}readStr(n){const o=this.reader;if(n<=23)return o.utf8(n);switch(n){case 24:return o.utf8(o.u8());case 25:return o.utf8(o.u16());case 26:return o.utf8(o.u32());case 27:return o.utf8(Number(o.u64()));case 31:{let i="";for(;o.peak()!==255;)i+=this.readStrChunk();return this.reader.x++,i}default:throw 1}}readStrLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const n=this.reader.u8(),o=n>>5,i=n&31;if(o!==3)throw 4;if(i>27)throw 5;return this.readStr(i)}readArr(n){const o=this.readMinorLen(n);return o>=0?this.readArrRaw(o):this.readArrIndef()}readArrRaw(n){const o=[];for(let i=0;i<n;i++)o.push(this.val());return o}readArrIndef(){const n=[];for(;this.reader.peak()!==255;)n.push(this.val());return this.reader.x++,n}readObj(n){if(n<28){let o=n;switch(n){case 24:o=this.reader.u8();break;case 25:o=this.reader.u16();break;case 26:o=this.reader.u32();break;case 27:o=Number(this.reader.u64());break}const i={};for(let l=0;l<o;l++){const p=this.key();if(p==="__proto__")throw 6;const h=this.val();i[p]=h}return i}else{if(n===31)return this.readObjIndef();throw 1}}readObjRaw(n){const o={};for(let i=0;i<n;i++){const l=this.key(),p=this.val();o[l]=p}return o}readObjIndef(){const n={};for(;this.reader.peak()!==255;){const o=this.key();if(this.reader.peak()===255)throw 7;const i=this.val();n[o]=i}return this.reader.x++,n}key(){const n=this.reader.u8(),o=n>>5,i=n&31;if(o!==3)return String(this.readAnyRaw(n));const l=this.readStrLen(i);if(l>31)return this.reader.utf8(l);const p=this.keyDecoder.decode(this.reader.uint8,this.reader.x,l);return this.reader.skip(l),p}readTag(n){if(n<=23)return this.readTagRaw(n);switch(n){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(n){return new u.JsonPackExtension(n,this.val())}readTkn(n){switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new d.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(n<=23)return new d.JsonPackValue(n);throw 1}f16(){return(0,a.decodeF16)(this.reader.u16())}};return gr.CborDecoderBase=t,gr}var ru;function n1(){if(ru)return hr;ru=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.Decoder=void 0;const a=ne.__importStar(It()),u=Wm(),d=Th(),r=me(),c=Fa(),t=jh(),s=Nh();class n extends t.CborDecoderBase{constructor(){super(new d.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const i=this.ts(),l=this.val();return typeof l=="string"?new a.StrChunk(i,l.length,l):new a.StrChunk(i,~~l,"")},this.cBinChunk=()=>{const i=this.ts(),l=this.reader,[p,h]=l.b1vu56();return p?new a.BinChunk(i,h,void 0):new a.BinChunk(i,h,l.buf(h))},this.cArrChunk=()=>{const i=this.ts(),[l,p]=this.reader.b1vu56();if(l)return new a.ArrChunk(i,p,void 0);const h=[];for(let v=0;v<p;v++)h.push(this.cNode().id);return new a.ArrChunk(i,p,h)}}decode(i,l){this.clockDecoder=void 0,this.time=-1;const p=this.reader;if(p.reset(i),p.peak()&128){p.x++;const v=this.time=p.vu57();l||(l=c.Model.withServerClock(void 0,v))}else if(this.decodeClockTable(),!l){const v=this.clockDecoder.clock;l=c.Model.create(void 0,v)}return this.doc=l,l.root=new a.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,l}decodeClockTable(){const i=this.reader,l=i.u32(),p=i.x;i.x+=l;const h=i.vu57(),v=i.vu57(),y=i.vu57();this.clockDecoder=new u.ClockDecoder(v,y);for(let g=1;g<h;g++){const f=i.vu57(),m=i.vu57();this.clockDecoder.pushTuple(f,m)}i.x=p}ts(){if(this.time<0){const[p,h]=this.reader.id();return this.clockDecoder.decodeId(p,h)}else return new r.Timestamp(1,this.reader.vu57())}cRoot(){const i=this.reader;return i.uint8[i.x]?this.cNode():c.UNDEFINED}cNode(){const i=this.reader,l=this.ts(),p=i.u8(),h=p>>5,v=p&31;switch(h){case s.CRDT_MAJOR.CON:return this.cCon(l,v);case s.CRDT_MAJOR.VAL:return this.cVal(l);case s.CRDT_MAJOR.OBJ:return this.cObj(l,v!==31?v:i.vu57());case s.CRDT_MAJOR.VEC:return this.cVec(l,v!==31?v:i.vu57());case s.CRDT_MAJOR.STR:return this.cStr(l,v!==31?v:i.vu57());case s.CRDT_MAJOR.BIN:return this.cBin(l,v!==31?v:i.vu57());case s.CRDT_MAJOR.ARR:return this.cArr(l,v!==31?v:i.vu57())}throw new Error("UNKNOWN_NODE")}cCon(i,l){const p=this.doc,h=l?this.ts():this.val(),v=new a.ConNode(i,h);return p.index.set(i,v),v}cVal(i){const l=this.cNode(),p=this.doc,h=new a.ValNode(p,i,l.id);return p.index.set(i,h),h}cObj(i,l){const p=new a.ObjNode(this.doc,i);for(let h=0;h<l;h++)this.cObjChunk(p);return this.doc.index.set(i,p),p}cObjChunk(i){const l=this.key();i.keys.set(l,this.cNode().id)}cVec(i,l){const p=this.reader,h=new a.VecNode(this.doc,i),v=h.elements;for(let y=0;y<l;y++)p.peak()?v.push(this.cNode().id):(p.x++,v.push(void 0));return this.doc.index.set(i,h),h}cStr(i,l){const p=new a.StrNode(i);return l&&p.ingest(l,this.cStrChunk),this.doc.index.set(i,p),p}cBin(i,l){const p=new a.BinNode(i);return l&&p.ingest(l,this.cBinChunk),this.doc.index.set(i,p),p}cArr(i,l){const p=new a.ArrNode(this.doc,i);return l&&p.ingest(l,this.cArrChunk),this.doc.index.set(i,p),p}}return hr.Decoder=n,hr}var iu;function r1(){if(iu)return qt;iu=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.decoder=qt.encoder=void 0;const e=Gm(),a=n1();return qt.encoder=new e.Encoder,qt.decoder=new a.Decoder,qt}var Co={},ye={},wr={},su;function i1(){if(su)return wr;su=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.find=void 0;const e=vs(),a=It(),u=(d,r)=>{const c=(0,e.toPath)(r);let t=d;const s=c.length;if(!s)return t;let n=0;for(;n<s&&t;){const o=c[n++];if(t=t.container(),!t)throw new Error("NOT_CONTAINER");if(t instanceof a.ObjNode){const i=t.get(String(o));if(!i)throw new Error("NOT_FOUND");t=i}else if(t instanceof a.ArrNode){const i=t.getNode(Number(o));if(!i)throw new Error("NOT_FOUND");t=i}else if(t instanceof a.VecNode){const i=t.get(Number(o));if(!i)throw new Error("NOT_FOUND");t=i}}return t};return wr.find=u,wr}var Cr={},tt={},Sr={},ou;function Ph(){if(ou)return Sr;ou=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(u){this.listeners.forEach(d=>d(u))}listen(u){const d=this.listeners;return d.add(u),()=>d.delete(u)}}return Sr.FanOut=e,Sr}var au;function Mh(){if(au)return tt;au=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.OnNewFanOut=tt.MapFanOut=tt.MicrotaskBufferFanOut=tt.MergeFanOut=void 0;const e=Ph();class a extends e.FanOut{constructor(t){super(),this.fanouts=t,this.unsubs=[]}listen(t){this.listeners.size||(this.unsubs=this.fanouts.map(n=>n.listen(o=>this.emit(o))));const s=super.listen(t);return()=>{if(s(),!this.listeners.size){for(const n of this.unsubs)n();this.unsubs=[]}}}}tt.MergeFanOut=a;class u extends e.FanOut{constructor(t){super(),this.source=t,this.buffer=[],this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(n=>{const o=this.buffer;o.length||queueMicrotask(()=>{this.emit(o),this.buffer=[]}),o.push(n)}));const s=super.listen(t);return()=>{s(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),this.buffer=[],(t=this.unsub)==null||t.call(this),this.unsub=void 0}}tt.MicrotaskBufferFanOut=u;class d extends e.FanOut{constructor(t,s){super(),this.source=t,this.mapper=s,this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(n=>this.emit(this.mapper(n))));const s=super.listen(t);return()=>{s(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),(t=this.unsub)==null||t.call(this),this.unsub=void 0}}tt.MapFanOut=d;class r extends e.FanOut{constructor(t,s=void 0){super(),this.source=t,this.last=s,this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(n=>{this.last!==n&&this.emit(this.last=n)}));const s=super.listen(t);return()=>{s(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),this.last=void 0,(t=this.unsub)==null||t.call(this),this.unsub=void 0}}return tt.OnNewFanOut=r,tt}var cu;function s1(){if(cu)return Cr;cu=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.NodeEvents=void 0;const e=Mh();let a=class{constructor(d){this.api=d,this.subscribe=r=>this.onViewChanges.listen(()=>r()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Cr.NodeEvents=a,Cr}var Er={},Or={},lu;function Va(){return lu||(lu=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.isUint8Array=void 0,Or.isUint8Array=typeof Te.Buffer=="function"?e=>e instanceof Uint8Array||Te.Buffer.isBuffer(e):e=>e instanceof Uint8Array),Or}var xr={},So={},Rr={},uu;function qh(){if(uu)return Rr;uu=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.Encoder=void 0;const a=ne.__importStar(mn()),u=qa(),d=me(),r=Ih();class c extends r.CborEncoder{constructor(s=new u.CrdtWriter){super(s),this.writer=s,this.patchSid=0}encode(s){this.writer.reset();const n=s.getId(),o=this.patchSid=n.sid,i=this.writer;i.vu57(o),i.vu57(n.time);const l=s.meta;return l===void 0?this.writeUndef():this.writeArr([l]),this.encodeOperations(s),i.flush()}encodeOperations(s){const n=s.ops,o=n.length;this.writer.vu57(o);for(let i=0;i<o;i++)this.encodeOperation(n[i])}encodeId(s){const n=s.sid,o=s.time,i=this.writer;n===this.patchSid?i.b1vu56(0,o):(i.b1vu56(1,o),i.vu57(n))}encodeTss(s){this.encodeId(s),this.writer.vu57(s.span)}writeInsStr(s,n,o,i){const l=this.writer;return s<=7?l.u8(96+s):(l.u8(96),l.vu57(s)),this.encodeId(n),this.encodeId(o),l.utf8(i)}encodeOperation(s){const n=this.writer;switch(s.constructor){case a.NewConOp:{const l=s.val;l instanceof d.Timestamp?(n.u8(1),this.encodeId(l)):(n.u8(0),this.writeAny(l));break}case a.NewValOp:{n.u8(8);break}case a.NewObjOp:{n.u8(16);break}case a.NewVecOp:{n.u8(24);break}case a.NewStrOp:{n.u8(32);break}case a.NewBinOp:{n.u8(40);break}case a.NewArrOp:{n.u8(48);break}case a.InsValOp:{const i=s;n.u8(72),this.encodeId(i.obj),this.encodeId(i.val);break}case a.InsObjOp:{const i=s,l=i.data,p=l.length;p<=7?n.u8(80+p):(n.u8(80),n.vu57(p)),this.encodeId(i.obj);for(let h=0;h<p;h++){const v=l[h];this.writeStr(v[0]),this.encodeId(v[1])}break}case a.InsVecOp:{const i=s,l=i.data,p=l.length;p<=7?n.u8(88+p):(n.u8(88),n.vu57(p)),this.encodeId(i.obj);for(let h=0;h<p;h++){const v=l[h];n.u8(v[0]),this.encodeId(v[1])}break}case a.InsStrOp:{const i=s,l=i.obj,p=i.ref,h=i.data,v=h.length;n.ensureCapacity(24+v*4);const y=n.x,g=this.writeInsStr(v,l,p,h);v!==g&&(n.x=y,this.writeInsStr(g,l,p,h));break}case a.InsBinOp:{const i=s,l=i.data,p=l.length;p<=7?n.u8(104+p):(n.u8(104),n.vu57(p)),this.encodeId(i.obj),this.encodeId(i.ref),n.buf(l,p);break}case a.InsArrOp:{const i=s,l=i.data,p=l.length;p<=7?n.u8(112+p):(n.u8(112),n.vu57(p)),this.encodeId(i.obj),this.encodeId(i.ref);for(let h=0;h<p;h++)this.encodeId(l[h]);break}case a.UpdArrOp:{const i=s;n.u8(120),this.encodeId(i.obj),this.encodeId(i.ref),this.encodeId(i.val);break}case a.DelOp:{const i=s,l=i.what,p=l.length;p<=7?n.u8(128+p):(n.u8(128),n.vu57(p)),this.encodeId(i.obj);for(let h=0;h<p;h++)this.encodeTss(l[h]);break}case a.NopOp:{const l=s.len;l<=7?n.u8(136+l):(n.u8(136),n.vu57(l));break}default:throw new Error("UNKNOWN_OP")}}}return Rr.Encoder=c,Rr}var Ir={},Nr={},du;function o1(){if(du)return Nr;du=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.CborDecoder=void 0;const e=jh(),a=Da();let u=class extends e.CborDecoderBase{readAsMap(){const r=this.reader.u8(),c=r>>5,t=r&31;switch(c){case 5:return this.readMap(t);default:throw 0}}readMap(r){const c=this.readMinorLen(r);return c>=0?this.readMapRaw(c):this.readMapIndef()}readMapRaw(r){const c=new Map;for(let t=0;t<r;t++){const s=this.val(),n=this.val();c.set(s,n)}return c}readMapIndef(){const r=new Map;for(;this.reader.peak()!==255;){const c=this.val();if(this.reader.peak()===255)throw 7;const t=this.val();r.set(c,t)}return this.reader.x++,r}skipN(r){for(let c=0;c<r;c++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(r){const c=r>>5,t=r&31;switch(c){case 0:case 1:this.skipUNint(t);break;case 2:this.skipBin(t);break;case 3:this.skipStr(t);break;case 4:this.skipArr(t);break;case 5:this.skipObj(t);break;case 7:this.skipTkn(t);break;case 6:this.skipTag(t);break}}skipMinorLen(r){if(r<=23)return r;switch(r){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(r){if(!(r<=23))switch(r){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(r){const c=this.skipMinorLen(r);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const r=this.reader.u8(),c=r>>5,t=r&31;if(c!==2)throw 2;if(t>27)throw 3;this.skipBin(t)}skipStr(r){const c=this.skipMinorLen(r);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const r=this.reader.u8(),c=r>>5,t=r&31;if(c!==3)throw 4;if(t>27)throw 5;this.skipStr(t)}skipArr(r){const c=this.skipMinorLen(r);if(c>=0)this.skipN(c);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(r){const c=this.readMinorLen(r);if(c>=0)return this.skipN(c*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(r){if(this.skipMinorLen(r)<0)throw 1;this.skipAny()}skipTkn(r){switch(r){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(r<=23))throw 1}validate(r,c=0,t=r.length){this.reader.reset(r),this.reader.x=c;const s=c;if(this.skipAny(),this.reader.x-s!==t)throw 8}decodeLevel(r){return this.reader.reset(r),this.readLevel()}readLevel(){const r=this.reader.u8(),c=r>>5,t=r&31;switch(c){case 4:return this.readArrLevel(t);case 5:return this.readObjLevel(t);default:return super.readAnyRaw(r)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const r=this.reader,c=r.x;this.skipAny();const t=r.x;return new a.JsonPackValue(r.uint8.subarray(c,t))}readObjLevel(r){const c=this.readMinorLen(r);return c>=0?this.readObjRawLevel(c):this.readObjIndefLevel()}readObjRawLevel(r){const c={};for(let t=0;t<r;t++){const s=this.key(),n=this.readPrimitiveOrVal();c[s]=n}return c}readObjIndefLevel(){const r={};for(;this.reader.peak()!==255;){const c=this.key();if(this.reader.peak()===255)throw 7;const t=this.readPrimitiveOrVal();r[c]=t}return this.reader.x++,r}readArrLevel(r){const c=this.readMinorLen(r);return c>=0?this.readArrRawLevel(c):this.readArrIndefLevel()}readArrRawLevel(r){const c=[];for(let t=0;t<r;t++)c.push(this.readPrimitiveOrVal());return c}readArrIndefLevel(){const r=[];for(;this.reader.peak()!==255;)r.push(this.readPrimitiveOrVal());return this.reader.x++,r}readHdr(r){const c=this.reader.u8();if(c>>5!==r)throw 0;const s=c&31;if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(r){const c=this.readObjHdr();for(let t=0;t<c;t++){if(this.key()===r)return this;this.skipAny()}throw 9}findIndex(r){const c=this.readArrHdr();if(r>=c)throw 10;for(let t=0;t<r;t++)this.skipAny();return this}find(r){for(let c=0;c<r.length;c++){const t=r[c];typeof t=="string"?this.findKey(t):this.findIndex(t)}return this}};return Nr.CborDecoder=u,Nr}var fu;function Dh(){if(fu)return Ir;fu=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.Decoder=void 0;const e=Th(),a=me(),u=Cs(),d=o1();let r=class extends d.CborDecoder{constructor(t=new e.CrdtReader){super(t)}decode(t){return this.reader.reset(t),this.readPatch()}readPatch(){const t=this.reader,s=t.vu57(),n=t.vu57(),i=s===1?new a.ServerClockVector(1,n):new a.ClockVector(s,n);this.patchSid=i.sid;const l=this.builder=new u.PatchBuilder(i),p=this.val();return Array.isArray(p)&&(l.patch.meta=p[0]),this.decodeOperations(),l.patch}decodeId(){const t=this.reader,[s,n]=t.b1vu56();return s?new a.Timestamp(t.vu57(),n):new a.Timestamp(this.patchSid,n)}decodeTss(){const t=this.decodeId(),s=this.reader.vu57();return(0,a.interval)(t,0,s)}decodeOperations(){const s=this.reader.vu57();for(let n=0;n<s;n++)this.decodeOperation()}decodeOperation(){const t=this.builder,s=this.reader,n=s.u8();switch(n>>3){case 0:{const i=n&7;t.con(i?this.decodeId():this.val());break}case 1:{t.val();break}case 2:{t.obj();break}case 3:{t.vec();break}case 4:{t.str();break}case 5:{t.bin();break}case 6:{t.arr();break}case 9:{const i=this.decodeId(),l=this.decodeId();t.setVal(i,l);break}case 10:{const i=n&7||s.vu57(),l=this.decodeId(),p=[];for(let h=0;h<i;h++){const v=this.val();if(typeof v!="string")continue;const y=this.decodeId();p.push([v,y])}t.insObj(l,p);break}case 11:{const i=n&7||s.vu57(),l=this.decodeId(),p=[];for(let h=0;h<i;h++){const v=this.val();if(typeof v!="number")continue;const y=this.decodeId();p.push([v,y])}t.insVec(l,p);break}case 12:{const i=n&7||s.vu57(),l=this.decodeId(),p=this.decodeId(),h=s.utf8(i);t.insStr(l,p,h);break}case 13:{const i=n&7||s.vu57(),l=this.decodeId(),p=this.decodeId(),h=s.buf(i);if(!(h instanceof Uint8Array))return;t.insBin(l,p,h);break}case 14:{const i=n&7||s.vu57(),l=this.decodeId(),p=this.decodeId(),h=[];for(let v=0;v<i;v++)h.push(this.decodeId());t.insArr(l,p,h);break}case 15:{const i=this.decodeId(),l=this.decodeId(),p=this.decodeId();t.updArr(i,l,p);break}case 16:{const i=n&7||s.vu57(),l=this.decodeId(),p=[];for(let h=0;h<i;h++)p.push(this.decodeTss());t.del(l,p);break}case 17:{const i=n&7||s.vu57();t.nop(i);break}default:throw new Error("UNKNOWN_OP")}}};return Ir.Decoder=r,Ir}var Eo={},hu;function a1(){return hu||(hu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const a=qh(),u=Dh(),d=qa(),r=new d.CrdtWriter(1024*4);e.encoder=new a.Encoder(r);const c=s=>e.encoder.encode(s);e.encode=c,e.decoder=new u.Decoder;const t=s=>e.decoder.decode(s);e.decode=t}(Eo)),Eo}var pu;function c1(){return pu||(pu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(qh(),e),a.__exportStar(Dh(),e),a.__exportStar(a1(),e)}(So)),So}var mu;function Bh(){if(mu)return xr;mu=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.Patch=void 0;const a=ne.__importStar(mn()),u=me(),d=st(),r=c1();let c=class Vh{constructor(){this.ops=[],this.meta=void 0}static fromBinary(s){return(0,r.decode)(s)}getId(){const s=this.ops[0];if(s)return s.id}span(){let s=0;for(const n of this.ops)s+=n.span();return s}nextTime(){const s=this.ops,n=s.length;if(!n)return 0;const o=s[n-1];return o.id.time+o.span()}rewriteTime(s){const n=new Vh,o=this.ops,i=o.length,l=n.ops;for(let p=0;p<i;p++){const h=o[p];h instanceof a.DelOp?l.push(new a.DelOp(s(h.id),s(h.obj),h.what)):h instanceof a.NewConOp?l.push(new a.NewConOp(s(h.id),h.val instanceof u.Timestamp?s(h.val):h.val)):h instanceof a.NewVecOp?l.push(new a.NewVecOp(s(h.id))):h instanceof a.NewValOp?l.push(new a.NewValOp(s(h.id))):h instanceof a.NewObjOp?l.push(new a.NewObjOp(s(h.id))):h instanceof a.NewStrOp?l.push(new a.NewStrOp(s(h.id))):h instanceof a.NewBinOp?l.push(new a.NewBinOp(s(h.id))):h instanceof a.NewArrOp?l.push(new a.NewArrOp(s(h.id))):h instanceof a.InsArrOp?l.push(new a.InsArrOp(s(h.id),s(h.obj),s(h.ref),h.data.map(s))):h instanceof a.UpdArrOp?l.push(new a.UpdArrOp(s(h.id),s(h.obj),s(h.ref),s(h.val))):h instanceof a.InsStrOp?l.push(new a.InsStrOp(s(h.id),s(h.obj),s(h.ref),h.data)):h instanceof a.InsBinOp?l.push(new a.InsBinOp(s(h.id),s(h.obj),s(h.ref),h.data)):h instanceof a.InsValOp?l.push(new a.InsValOp(s(h.id),s(h.obj),s(h.val))):h instanceof a.InsObjOp?l.push(new a.InsObjOp(s(h.id),s(h.obj),h.data.map(([v,y])=>[v,s(y)]))):h instanceof a.InsVecOp?l.push(new a.InsVecOp(s(h.id),s(h.obj),h.data.map(([v,y])=>[v,s(y)]))):h instanceof a.NopOp&&l.push(new a.NopOp(s(h.id),h.len))}return n}rebase(s,n){const o=this.getId();if(!o)throw new Error("EMPTY_PATCH");const i=o.sid,l=o.time;if(n??(n=l),l===s)return this;const p=s-l;return this.rewriteTime(h=>{if(h.sid!==i)return h;const v=h.time;return v<n?h:(0,u.ts)(i,v+p)})}clone(){return this.rewriteTime(s=>s)}toBinary(){return(0,r.encode)(this)}toString(s=""){const n=this.getId();return`Patch ${n?(0,u.printTs)(n):"(nil)"}!${this.span()}`+(0,d.printTree)(s,this.ops.map(i=>l=>i.toString(l)))}};return xr.Patch=c,xr}var Oo={},xo={},bu;function l1(){return bu||(bu=1,Object.defineProperty(xo,"__esModule",{value:!0})),xo}var vu;function ws(){return vu||(vu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const a=ne,u=me();a.__exportStar(l1(),e),e.ORIGIN=(0,u.ts)(0,0)}(Oo)),Oo}var Ro={},gu;function Lh(){return gu||(gu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const a=Va(),u=me(),d=t=>{switch(typeof t){case"number":case"boolean":case"undefined":return!0;case"object":return t===null||t instanceof u.Timestamp;default:return!1}};class r{constructor(s){this.build=s}}e.NodeBuilder=r;var c;(function(t){class s extends r{constructor(g){super(f=>f.con(g)),this.raw=g,this.type="con"}}t.con=s;class n extends r{constructor(g){super(f=>f.json(g)),this.raw=g,this.type="str"}}t.str=n;class o extends r{constructor(g){super(f=>f.json(g)),this.raw=g,this.type="bin"}}t.bin=o;class i extends r{constructor(g){super(f=>{const m=f.val(),b=g.build(f);return f.setVal(m,b),m}),this.value=g,this.type="val"}}t.val=i;class l extends r{constructor(g){super(f=>{const m=f.vec(),b=g.length;if(b){const _=[];for(let w=0;w<b;w++){const E=g[w].build(f);_.push([w,E])}f.insVec(m,_)}return m}),this.value=g,this.type="vec"}}t.vec=l;class p extends r{constructor(g,f){super(m=>{const b=m.obj(),_=[],w={...g,...f},C=Object.keys(w),E=C.length;if(E){for(let O=0;O<E;O++){const S=C[O],x=w[S].build(m);_.push([S,x])}m.insObj(b,_)}return b}),this.obj=g,this.opt=f,this.type="obj"}optional(){return this}}t.obj=p;class h extends r{constructor(g){super(f=>{const m=f.arr(),b=g.length;if(b){const _=[];for(let w=0;w<b;w++)_.push(g[w].build(f));f.insArr(m,m,_)}return m}),this.arr=g,this.type="arr"}}t.arr=h;class v extends r{constructor(g,f){super(m=>{const b=new Uint8Array([g,0,0]),_=m.vec();return b[1]=_.sid%256,b[2]=_.time%256,m.insVec(_,[[0,m.constOrJson(e.s.con(b))],[1,f.build(m)]]),_}),this.id=g,this.data=f,this.type="ext"}}t.ext=v})(c||(e.nodes=c={})),e.schema={con:t=>new c.con(t),str:t=>new c.str(t||""),bin:t=>new c.bin(t),val:t=>new c.val(t),vec:(...t)=>new c.vec(t),obj:(t,s)=>new c.obj(t,s),map:t=>e.schema.obj(t),arr:t=>new c.arr(t),json:t=>{switch(typeof t){case"object":{if(!t)return e.s.val(e.s.con(t));if(t instanceof r)return t;if(Array.isArray(t))return e.s.arr(t.map(s=>e.s.json(s)));if((0,a.isUint8Array)(t))return e.s.bin(t);if(t instanceof u.Timestamp)return e.s.val(e.s.con(t));{const s={},n=Object.keys(t);for(const o of n)s[o]=e.s.jsonCon(t[o]);return e.s.obj(s)}}case"string":return e.s.str(t);default:return e.s.val(e.s.con(t))}},jsonCon:t=>d(t)?e.s.con(t):e.s.json(t),ext:(t,s)=>new c.ext(t,s)},e.s=e.schema}(Ro)),Ro}var yu;function Cs(){if(yu)return Er;yu=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.PatchBuilder=void 0;const a=ne.__importStar(mn()),u=me(),d=Va(),r=Bh(),c=ws(),t=Lh(),s=o=>{switch(typeof o){case"number":case"boolean":return!0;default:return o===null}};let n=class{constructor(i){this.clock=i,this.patch=new r.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const i=this.patch;return this.patch=new r.Patch,i}obj(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewObjOp(i)),i}arr(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewArrOp(i)),i}vec(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewVecOp(i)),i}str(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewStrOp(i)),i}bin(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewBinOp(i)),i}con(i){this.pad();const l=this.clock.tick(1);return this.patch.ops.push(new a.NewConOp(l,i)),l}val(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new a.NewValOp(i)),i}root(i){return this.setVal(c.ORIGIN,i)}insObj(i,l){if(!l.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new a.InsObjOp(p,i,l),v=h.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(h),p}insVec(i,l){if(!l.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new a.InsVecOp(p,i,l),v=h.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(h),p}setVal(i,l){this.pad();const p=this.clock.tick(1),h=new a.InsValOp(p,i,l);return this.patch.ops.push(h),p}insStr(i,l,p){if(!p.length)throw new Error("EMPTY_STRING");this.pad();const h=this.clock.tick(1),v=new a.InsStrOp(h,i,l,p),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),h}insBin(i,l,p){if(!p.length)throw new Error("EMPTY_BINARY");this.pad();const h=this.clock.tick(1),v=new a.InsBinOp(h,i,l,p),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),h}insArr(i,l,p){this.pad();const h=this.clock.tick(1),v=new a.InsArrOp(h,i,l,p),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),h}updArr(i,l,p){this.pad();const h=this.clock.tick(1),v=new a.UpdArrOp(h,i,l,p);return this.patch.ops.push(v),h}del(i,l){this.pad();const p=this.clock.tick(1);return this.patch.ops.push(new a.DelOp(p,i,l)),p}nop(i){this.pad();const l=this.clock.tick(i);return this.patch.ops.push(new a.NopOp(l,i)),l}jsonObj(i){const l=this.obj(),p=Object.keys(i);if(p.length){const h=[];for(const v of p){const y=i[v],g=y instanceof u.Timestamp?y:s(y)?this.con(y):this.json(y);h.push([v,g])}this.insObj(l,h)}return l}jsonArr(i){const l=this.arr();if(i.length){const p=[];for(const h of i)p.push(this.json(h));this.insArr(l,l,p)}return l}jsonStr(i){const l=this.str();return i&&this.insStr(l,l,i),l}jsonBin(i){const l=this.bin();return i.length&&this.insBin(l,l,i),l}jsonVal(i){const l=this.val(),p=this.con(i);return this.setVal(l,p),l}json(i){if(i instanceof u.Timestamp)return i;if(i===void 0)return this.con(i);if(i instanceof Array)return this.jsonArr(i);if((0,d.isUint8Array)(i))return this.jsonBin(i);if(i instanceof t.NodeBuilder)return i.build(this);switch(typeof i){case"object":return i===null?this.jsonVal(i):this.jsonObj(i);case"string":return this.jsonStr(i);case"number":case"boolean":return this.jsonVal(i)}throw new Error("INVALID_JSON")}constOrJson(i){return i instanceof u.Timestamp?i:s(i)?this.con(i):this.json(i)}maybeConst(i){return i instanceof u.Timestamp?i:this.con(i)}pad(){const i=this.patch.nextTime();if(!i)return;const l=this.clock.time-i;if(l>0){const p=(0,u.ts)(this.clock.sid,i),h=new a.NopOp(p,l);this.patch.ops.push(h)}}};return Er.PatchBuilder=n,Er}var kr={},_u;function u1(){if(_u)return kr;_u=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.ExtNode=void 0;const e=me();let a=class{constructor(d){this.data=d,this.api=void 0,this.id=d.id}children(d){}child(){return this.data}container(){return this.data.container()}toString(d,r){return this.name()+(r?" "+(0,e.printTs)(r):"")+" "+this.data.toString(d)}};return kr.ExtNode=a,kr}var Io={},Bt={},No={},ko={},wu;function d1(){return wu||(wu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const a=Array.isArray,u=Object.prototype,d=(r,c)=>{if(r===c)return!0;let t=0,s=0;if(a(r)){if(!a(c)||(t=r.length,t!==c.length))return!1;for(s=t;s--!==0;)if(!(0,e.deepEqual)(r[s],c[s]))return!1;return!0}if(r&&c&&typeof r=="object"&&typeof c=="object"){e:{if(r.__proto__===u)break e;if(r instanceof Uint8Array){if(!(c instanceof Uint8Array))return!1;const o=r.length;if(o!==c.length)return!1;for(let i=0;i<o;i++)if(r[i]!==c[i])return!1;return!0}}const n=Object.keys(r);if(t=n.length,t!==Object.keys(c).length||a(c))return!1;for(s=t;s--!==0;){const o=n[s];if(!(0,e.deepEqual)(r[o],c[o]))return!1}return!0}return!1};e.deepEqual=d}(ko)),ko}var Cu;function f1(){return Cu||(Cu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ne.__exportStar(d1(),e)}(No)),No}var Ar={},Su;function h1(){if(Su)return Ar;Su=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.cmpUint8Array=void 0;const e=(a,u)=>{const d=a.length;if(d!==u.length)return!1;for(let r=0;r<d;r++)if(a[r]!==u[r])return!1;return!0};return Ar.cmpUint8Array=e,Ar}var Ao={},To={},Eu;function p1(){return Eu||(Eu=1,Object.defineProperty(To,"__esModule",{value:!0})),To}var Ou;function Ss(){return Ou||(Ou=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(p1(),e),a.__exportStar(me(),e),a.__exportStar(mn(),e),a.__exportStar(Bh(),e),a.__exportStar(Cs(),e),a.__exportStar(Lh(),e)}(Ao)),Ao}var jo={},xu;function Es(){return xu||(xu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const a=f=>{const m=f.charCodeAt(0);return m>=56320&&m<=57343},u=f=>{const m=f.charCodeAt(f.length-1);return m>=55296&&m<=56319},d=(f,m)=>{f.push([0,""]);let b=0,_=0,w=0,C="",E="",O=0;for(;b<f.length;){if(b<f.length-1&&!f[b][1]){f.splice(b,1);continue}const x=f[b];switch(x[0]){case 1:w++,b++,E+=x[1];break;case-1:_++,b++,C+=x[1];break;case 0:{let I=b-w-_-1;if(m){const T=f[I];if(I>=0){let G=T[1];if(u(G)){const z=G.slice(-1);if(T[1]=G=G.slice(0,-1),C=z+C,E=z+E,!G){f.splice(I,1),b--;let W=I-1;const Z=f[W];if(Z){const U=Z[0];U===1?(w++,W--,E=Z[1]+E):U===-1&&(_++,W--,C=Z[1]+C)}I=W}}}const j=f[b],D=j[1];if(a(D)){const G=D.charAt(0);j[1]=D.slice(1),C+=G,E+=G}}if(b<f.length-1&&!f[b][1]){f.splice(b,1);break}const N=C.length>0,R=E.length>0;if(N||R){N&&R&&(O=(0,e.pfx)(E,C),O!==0&&(I>=0?f[I][1]+=E.slice(0,O):(f.splice(0,0,[0,E.slice(0,O)]),b++),E=E.slice(O),C=C.slice(O)),O=(0,e.sfx)(E,C),O!==0&&(f[b][1]=E.slice(E.length-O)+f[b][1],E=E.slice(0,E.length-O),C=C.slice(0,C.length-O)));const T=w+_,j=C.length,D=E.length;j===0&&D===0?(f.splice(b-T,T),b=b-T):j===0?(f.splice(b-T,T,[1,E]),b=b-T+1):D===0?(f.splice(b-T,T,[-1,C]),b=b-T+1):(f.splice(b-T,T,[-1,C],[1,E]),b=b-T+2)}const M=f[b-1];b!==0&&M[0]===0?(M[1]+=f[b][1],f.splice(b,1)):b++,w=0,_=0,C="",E="";break}}}f[f.length-1][1]===""&&f.pop();let S=!1;for(b=1;b<f.length-1;){const x=f[b-1],I=f[b+1];if(x[0]===0&&I[0]===0){const N=x[1],R=f[b],M=R[1],T=I[1];M.slice(M.length-N.length)===N?(f[b][1]=N+M.slice(0,M.length-N.length),I[1]=N+T,f.splice(b-1,1),S=!0):M.slice(0,T.length)===T&&(x[1]+=I[1],R[1]=M.slice(T.length)+T,f.splice(b+1,1),S=!0)}b++}S&&d(f,m)},r=(f,m,b,_)=>{const w=o(f.slice(0,b),m.slice(0,_),!1),C=o(f.slice(b),m.slice(_),!1);return w.concat(C)},c=(f,m)=>{const b=f.length,_=m.length,w=Math.ceil((b+_)/2),C=w,E=2*w,O=new Array(E),S=new Array(E);for(let j=0;j<E;j++)O[j]=-1,S[j]=-1;O[C+1]=0,S[C+1]=0;const x=b-_,I=x%2!==0;let N=0,R=0,M=0,T=0;for(let j=0;j<w;j++){for(let D=-j+N;D<=j-R;D+=2){const G=C+D;let z=0;const W=O[G-1],Z=O[G+1];D===-j||D!==j&&W<Z?z=Z:z=W+1;let U=z-D;for(;z<b&&U<_&&f.charAt(z)===m.charAt(U);)z++,U++;if(O[G]=z,z>b)R+=2;else if(U>_)N+=2;else if(I){const ee=C+x-D,ge=S[ee];if(ee>=0&&ee<E&&ge!==-1&&z>=b-ge)return r(f,m,z,U)}}for(let D=-j+M;D<=j-T;D+=2){const G=C+D;let z=D===-j||D!==j&&S[G-1]<S[G+1]?S[G+1]:S[G-1]+1,W=z-D;for(;z<b&&W<_&&f.charAt(b-z-1)===m.charAt(_-W-1);)z++,W++;if(S[G]=z,z>b)T+=2;else if(W>_)M+=2;else if(!I){const Z=C+x-D,U=O[Z];if(Z>=0&&Z<E&&U!==-1){const ee=C+U-Z;if(z=b-z,U>=z)return r(f,m,U,ee)}}}}return[[-1,f],[1,m]]},t=(f,m)=>{if(!f)return[[1,m]];if(!m)return[[-1,f]];const b=f.length,_=m.length,w=b>_?f:m,C=b>_?m:f,E=C.length,O=w.indexOf(C);if(O>=0){const S=w.slice(0,O),x=w.slice(O+E);return b>_?[[-1,S],[0,C],[-1,x]]:[[1,S],[0,C],[1,x]]}return E===1?[[-1,f],[1,m]]:c(f,m)},s=(f,m)=>{if(!f||!m||f.charAt(0)!==m.charAt(0))return 0;let b=0,_=Math.min(f.length,m.length),w=_,C=0;for(;b<w;)f.slice(C,w)===m.slice(C,w)?(b=w,C=b):_=w,w=Math.floor((_-b)/2+b);const E=f.charCodeAt(w-1);return E>=55296&&E<=56319&&w--,w};e.pfx=s;const n=(f,m)=>{if(!f||!m||f.slice(-1)!==m.slice(-1))return 0;let b=0,_=Math.min(f.length,m.length),w=_,C=0;for(;b<w;)f.slice(f.length-w,f.length-C)===m.slice(m.length-w,m.length-C)?(b=w,C=b):_=w,w=Math.floor((_-b)/2+b);const E=f.charCodeAt(f.length-w);return E>=55296&&E<=56319&&w--,w};e.sfx=n;const o=(f,m,b)=>{if(f===m)return f?[[0,f]]:[];const _=(0,e.pfx)(f,m),w=f.slice(0,_);f=f.slice(_),m=m.slice(_);const C=(0,e.sfx)(f,m),E=f.slice(f.length-C);f=f.slice(0,f.length-C),m=m.slice(0,m.length-C);const O=t(f,m);return w&&O.unshift([0,w]),E&&O.push([0,E]),d(O,b),O},i=(f,m)=>o(f,m,!0);e.diff=i;const l=(f,m,b)=>{e:{if(b<0)break e;const _=f.length,w=m.length;if(_===w)break e;const C=m.slice(b),E=C.length;if(E>_||f.slice(_-E)!==C)break e;if(w>_){const x=_-E,I=f.slice(0,x),N=m.slice(0,x);if(I!==N)break e;const R=m.slice(x,b),M=[];return I&&M.push([0,I]),R&&M.push([1,R]),C&&M.push([0,C]),M}else{const x=w-E,I=m.slice(0,x),N=f.slice(0,x);if(N!==I)break e;const R=f.slice(x,_-E),M=[];return N&&M.push([0,N]),R&&M.push([-1,R]),C&&M.push([0,C]),M}}return(0,e.diff)(f,m)};e.diffEdit=l;const p=f=>{let m="";const b=f.length;for(let _=0;_<b;_++){const w=f[_];w[0]!==1&&(m+=w[1])}return m};e.src=p;const h=f=>{let m="";const b=f.length;for(let _=0;_<b;_++){const w=f[_];w[0]!==-1&&(m+=w[1])}return m};e.dst=h;const v=f=>{const m=f[0];return m===0?f:m===1?[-1,f[1]]:[1,f[1]]},y=f=>f.map(v);e.invert=y;const g=(f,m,b,_)=>{const w=f.length;let C=m;for(let E=w-1;E>=0;E--){const[O,S]=f[E];if(O===0)C-=S.length;else if(O===1)b(C,S);else{const x=S.length;C-=x,_(C,x,S)}}};e.apply=g}(jo)),jo}var Po={},Ru;function m1(){return Ru||(Ru=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const u=ne.__importStar(Es()),d=o=>{let i="";const l=o.length;for(let p=0;p<l;p++)i+=String.fromCharCode(o[p]);return i};e.toStr=d;const r=o=>{const i=o.length,l=new Uint8Array(i);for(let p=0;p<i;p++)l[p]=o.charCodeAt(p);return l};e.toBin=r;const c=(o,i)=>{const l=(0,e.toStr)(o),p=(0,e.toStr)(i);return u.diff(l,p)};e.diff=c;const t=(o,i,l,p)=>u.apply(o,i,(h,v)=>l(h,(0,e.toBin)(v)),p);e.apply=t;const s=o=>(0,e.toBin)(u.src(o));e.src=s;const n=o=>(0,e.toBin)(u.dst(o));e.dst=n}(Po)),Po}var Mo={},Iu;function b1(){return Iu||(Iu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const u=ne.__importStar(Es()),d=c=>{const t=[],s=c.length;let n=[];const o=(i,l)=>{if(!l.length)return;const p=n.length;if(p){const h=n[p-1];if(h[0]===i){h[1]+=l;return}}n.push([i,l])};e:for(let i=0;i<s;i++){const l=c[i],p=l[0],h=l[1],v=h.indexOf(`
`);if(v<0){o(p,h);continue e}else o(p,h.slice(0,v+1)),n.length&&t.push(n),n=[];let y=v;const g=h.length;t:for(;y<g;){const f=h.indexOf(`
`,y+1);if(f<0){o(p,h.slice(y+1));break t}t.push([[p,h.slice(y+1,f+1)]]),y=f}}n.length&&t.push(n);{const i=t.length;for(let l=0;l<i;l++){const p=t[l];let h=p.length;e:{if(h<2)break e;const v=p[0],y=p[1],g=y[0];if(v[0]===0&&(g===-1||g===1)){for(let f=2;f<h;f++)if(p[f][0]!==g)break e;for(let f=l+1;f<i;f++){const m=t[f],b=m.length,_=v[1];let w,C;if(m.length>1&&(w=m[0])[0]===g&&(C=m[1])[0]===0&&_===w[1])p.splice(0,1),y[1]=_+y[1],C[1]=_+C[1],m.splice(0,1);else for(let E=0;E<b;E++)if(m[E][0]!==g)break e}}}h=p.length;e:{if(h<2)break e;const v=p[p.length-1],y=v[1],g=p[p.length-2];if(v[0]===-1)for(let f=l+1;f<i;f++){const m=t[f],b=m.length;if(b<=1){if(m[0][0]!==-1)break e}else{const _=m[m.length-1];if(_[0]!==0)break e;for(let S=0;S<m.length-1;S++)if(m[S][0]!==-1)break e;let w=_[1];const C=w.endsWith(`
`);if(C||(w+=`
`),w.length>y.length||!y.endsWith(w))break e;const E=y.length-w.length;E<0?(v[0]=0,g[0]===0&&(g[1]+=y,p.splice(h-1,1))):E===0?(p.splice(h-1,1),g[0]===0?g[1]+=w:p.push([0,w])):(v[1]=y.slice(0,E),p.push([0,w]));const O=m[m.length-2];O[0]===-1?(O[1]+=C?w:w.slice(0,-1),m.splice(b-1,1)):_[0]=-1}}}}}return t};e.agg=d;const r=(c,t)=>{const s=c.join(`
`)+`
`,n=t.join(`
`)+`
`;if(s===n)return[];const o=u.diff(s,n),i=(0,e.agg)(o),l=i.length,p=[];let h=-1,v=-1;const y=c.length,g=t.length;for(let f=0;f<l;f++){const m=i[f];let b=m.length;if(!b)continue;const _=m[b-1],w=_[0],C=_[1];if(C===`
`)m.splice(b-1,1);else{const O=C.length;C[O-1]===`
`&&(O===1?m.splice(b-1,1):_[1]=C.slice(0,O-1))}let E=0;if(b=m.length,f+1===l)h+1<y?v+1<g?(E=b===1&&m[0][0]===0?0:2,h++,v++):(E=-1,h++):(E=1,v++);else{const S=m[0][0];b===1&&S===w&&S===0?(h++,v++):w===0?(E=2,h++,v++):w===1?(E=1,v++):w===-1&&(E=-1,h++)}p.push([E,h,v,m])}return p};e.diff=r}(Mo)),Mo}var qo={},Tr={},Nu;function Ba(){if(Nu)return Tr;Nu=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.sort=void 0;const e=a=>{const u=a.length;for(let d=1;d<u;d++){const r=a[d];let c=d;for(;c!==0&&a[c-1]>r;)a[c]=a[c-1],c--;a[c]=r}return a};return Tr.sort=e,Tr}var Do={},ku;function La(){return ku||(ku=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const a=Ba();var u;(function(n){n[n.START_STATE=5381]="START_STATE",n[n.NULL=982452847]="NULL",n[n.TRUE=982453247]="TRUE",n[n.FALSE=982454243]="FALSE",n[n.ARRAY=982452259]="ARRAY",n[n.STRING=982453601]="STRING",n[n.OBJECT=982454533]="OBJECT",n[n.BINARY=982454837]="BINARY"})(u||(e.CONST=u={}));const d=(n,o)=>(n<<5)+n+o;e.updateNum=d;const r=(n,o)=>{const i=o.length;n=(0,e.updateNum)(n,u.STRING),n=(0,e.updateNum)(n,i);let l=i;for(;l;)n=(n<<5)+n+o.charCodeAt(--l);return n};e.updateStr=r;const c=(n,o)=>{const i=o.length;n=(0,e.updateNum)(n,u.BINARY),n=(0,e.updateNum)(n,i);let l=i;for(;l;)n=(n<<5)+n+o[--l];return n};e.updateBin=c;const t=(n,o)=>{switch(typeof o){case"number":return(0,e.updateNum)(n,o);case"string":return n=(0,e.updateNum)(n,u.STRING),(0,e.updateStr)(n,o);case"object":{if(o===null)return(0,e.updateNum)(n,u.NULL);if(Array.isArray(o)){const p=o.length;n=(0,e.updateNum)(n,u.ARRAY);for(let h=0;h<p;h++)n=(0,e.updateJson)(n,o[h]);return n}if(o instanceof Uint8Array)return(0,e.updateBin)(n,o);n=(0,e.updateNum)(n,u.OBJECT);const i=(0,a.sort)(Object.keys(o)),l=i.length;for(let p=0;p<l;p++){const h=i[p];n=(0,e.updateStr)(n,h),n=(0,e.updateJson)(n,o[h])}return n}case"boolean":return(0,e.updateNum)(n,o?u.TRUE:u.FALSE)}return n};e.updateJson=t;const s=n=>(0,e.updateJson)(u.START_STATE,n)>>>0;e.hash=s}(Do)),Do}var Vo={},Au;function $h(){return Au||(Au=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const a=Ba(),u=La(),d=r=>{switch(typeof r){case"string":return(0,u.hash)(r).toString(36);case"number":case"bigint":return r.toString(36);case"boolean":return r?"T":"F";case"object":if(r===null)return"N";if(Array.isArray(r)){const c=r.length;let t="[";for(let s=0;s<c;s++)t+=(0,e.structHash)(r[s])+",";return t+"]"}else{if(r instanceof Uint8Array)return(0,u.hash)(r).toString(36);{const c=Object.keys(r);(0,a.sort)(c);let t="{";const s=c.length;for(let n=0;n<s;n++){const o=c[n];t+=(0,u.hash)(o).toString(36)+":"+(0,e.structHash)(r[o])+","}return t+"}"}}default:return"U"}};e.structHash=d}(Vo)),Vo}var Tu;function v1(){return Tu||(Tu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const a=Ba(),u=Xi(),d=La(),r=$h(),c=t=>{if(t instanceof u.ConNode)return(0,r.structHash)(t.val);if(t instanceof u.ValNode)return(0,e.structHashCrdt)(t.node());if(t instanceof u.StrNode)return(0,d.hash)(t.view()).toString(36);if(t instanceof u.ObjNode){let s="{";const n=Array.from(t.keys.keys());(0,a.sort)(n);const o=n.length;for(let i=0;i<o;i++){const l=n[i],p=t.get(l);s+=(0,d.hash)(l).toString(36)+":"+(0,e.structHashCrdt)(p)+","}return s+"}"}else if(t instanceof u.ArrNode||t instanceof u.VecNode){let s="[";return t.children(n=>{s+=(0,e.structHashCrdt)(n)+","}),s+"]"}else if(t instanceof u.BinNode)return(0,d.hash)(t.view()).toString(36);return"U"};e.structHashCrdt=c}(qo)),qo}var Bo={},ju;function g1(){return ju||(ju=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(La(),e),a.__exportStar($h(),e)}(Bo)),Bo}var Pu;function y1(){if(Pu)return Bt;Pu=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.JsonCrdtDiff=Bt.DiffError=void 0;const e=ne,a=f1(),u=h1(),d=Ss(),r=It(),c=e.__importStar(Es()),t=e.__importStar(m1()),s=e.__importStar(b1()),n=v1(),o=g1();class i extends Error{constructor(h="DIFF"){super(h)}}Bt.DiffError=i;let l=class{constructor(h){this.model=h,this.builder=new d.PatchBuilder(h.clock.clone())}diffStr(h,v){const y=h.view();if(y===v)return;const g=this.builder;c.apply(c.diff(y,v),y.length,(f,m)=>g.insStr(h.id,f?h.find(f-1):h.id,m),(f,m)=>g.del(h.id,h.findInterval(f,m)))}diffBin(h,v){const y=h.view();if((0,u.cmpUint8Array)(y,v))return;const g=this.builder;t.apply(t.diff(y,v),y.length,(f,m)=>g.insBin(h.id,f?h.find(f-1):h.id,m),(f,m)=>g.del(h.id,h.findInterval(f,m)))}diffArr(h,v){const y=[];h.children(O=>{y.push((0,n.structHashCrdt)(O))});const g=[],f=v.length;for(let O=0;O<f;O++)g.push((0,o.structHash)(v[O]));const m=s.diff(y,g);if(!m.length)return;const b=[],_=[],w=m.length;for(let O=w-1;O>=0;O--){const[S,x,I]=m[O];switch(S){case 0:break;case 1:{const N=v[I],R=x>=0?h.find(x):h.id;if(!R)throw new i;b.push([R,[N]]);break}case-1:{const N=h.findInterval(x,1);if(!N||!N.length)throw new i;_.push(...N);break}case 2:{const N=v[I];try{this.diffAny(h.getNode(x),N)}catch(R){if(R instanceof i){const M=h.findInterval(x,1);_.push(...M);const T=x?h.find(x-1):h.id;if(!T)throw new i;b.push([T,[N]])}else throw R}}}}const C=this.builder,E=b.length;for(let O=0;O<E;O++){const[S,x]=b[O];C.insArr(h.id,S,x.map(I=>C.json(I)))}_.length&&C.del(h.id,_)}diffObj(h,v){const y=this.builder,g=[],f=new Set;h.forEach(_=>{f.add(_),v[_]===void 0&&g.push([_,y.con(void 0)])});const m=Object.keys(v),b=m.length;for(let _=0;_<b;_++){const w=m[_],C=v[w];if(f.has(w)){const E=h.get(w);if(E)try{this.diffAny(E,C);continue}catch(O){if(!(O instanceof i))throw O}}g.push([w,h.get(w)instanceof r.ConNode?y.con(C):y.constOrJson(C)])}g.length&&y.insObj(h.id,g)}diffVec(h,v){const y=this.builder,g=[],f=h.elements,m=f.length,b=v.length,_=h.doc.index,w=Math.min(m,b);for(let C=b;C<m;C++){const E=f[C];if(E){const O=_.get(E);if(!O||O instanceof r.ConNode&&O.val===void 0)return;g.push([C,y.con(void 0)])}}for(let C=0;C<w;C++){const E=v[C],O=h.get(C);if(O)try{this.diffAny(O,E);continue}catch(S){if(!(S instanceof i))throw S}g.push([C,y.constOrJson(E)])}for(let C=m;C<b;C++)g.push([C,y.constOrJson(v[C])]);g.length&&y.insVec(h.id,g)}diffVal(h,v){try{this.diffAny(h.node(),v)}catch(y){if(y instanceof i){const g=this.builder;g.setVal(h.id,g.constOrJson(v))}else throw y}}diffAny(h,v){if(h instanceof r.ConNode){if(h.val!==v&&!(0,a.deepEqual)(h.val,v))throw new i}else if(h instanceof r.StrNode){if(typeof v!="string")throw new i;this.diffStr(h,v)}else if(h instanceof r.ObjNode){if(!v||typeof v!="object"||Array.isArray(v))throw new i;this.diffObj(h,v)}else if(h instanceof r.ValNode)this.diffVal(h,v);else if(h instanceof r.ArrNode){if(!Array.isArray(v))throw new i;this.diffArr(h,v)}else if(h instanceof r.VecNode){if(!Array.isArray(v))throw new i;this.diffVec(h,v)}else if(h instanceof r.BinNode){if(!(v instanceof Uint8Array))throw new i;this.diffBin(h,v)}else throw new i}diff(h,v){return this.diffAny(h,v),this.builder.flush()}};return Bt.JsonCrdtDiff=l,Bt}var Mu;function _1(){return Mu||(Mu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const a=y1(),u=(r,c)=>{const s=new a.JsonCrdtDiff(r.api.model).diff(r.node,c);return s.ops.length?s:void 0};e.diff=u;const d=(r,c)=>{const t=(0,e.diff)(r,c);return t&&r.api.model.applyPatch(t),t};e.merge=d}(Io)),Io}var Lo={},qu;function w1(){return qu||(qu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const a=(d,r=[])=>new Proxy(()=>{},{get:(c,t,s)=>(r.push(String(t)),(0,e.proxy)(d,r)),apply:(c,t,s)=>d(r,...s)});e.proxy=a;const u=(d,r,c=[])=>new Proxy({},{get:(t,s,n)=>s===r?d(c):(c.push(String(s)),(0,e.proxy$)(d,r,c))});e.proxy$=u}(Lo)),Lo}var Du;function C1(){if(Du)return ye;Du=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.ModelApi=ye.ArrApi=ye.BinApi=ye.StrApi=ye.ObjApi=ye.VecApi=ye.ValApi=ye.ConApi=ye.NodeApi=void 0;const e=ne,a=st(),u=vh(),d=ka(),r=i1(),c=me(),t=It(),s=s1(),n=Ph(),o=Cs(),i=Mh(),l=u1(),p=e.__importStar(_1()),h=w1(),v=O=>{if(!O)return[void 0,""];if(typeof O=="number")return[void 0,O];switch(typeof O=="string"&&(O=(0,d.toPath)(O)),O.length){case 0:return[void 0,""];case 1:return[void 0,O[0]];default:{const S=O[O.length-1];return[O.slice(0,-1),S]}}};class y{constructor(S,x){this.node=S,this.api=x,this.ev=void 0}get events(){return this.ev||(this.ev=new s.NodeEvents(this))}find(S){let x=this.node;if(S===void 0){if(typeof x.child=="function"){const I=x.child();if(!I){if(x instanceof t.RootNode)return x;throw new Error("NO_CHILD")}return I}throw new Error("CANNOT_IN")}for(typeof S=="string"&&S&&S[0]!=="/"&&(S="/"+S),typeof S=="number"&&(S=[S]);x instanceof t.ValNode;)x=x.child();return(0,r.find)(x,S)}in(S){const x=this.find(S);return this.api.wrap(x)}asVal(){if(this.node instanceof t.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof t.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof t.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof t.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof t.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof t.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof t.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(S){let x;const I=this.node;if(I instanceof l.ExtNode&&(x=I),I instanceof t.VecNode&&(x=I.ext()),!x)throw new Error("NOT_EXT");const N=this.api.wrap(x);if(!S||N instanceof S.Api)return N;throw new Error("NOT_EXT")}val(S){return this.in(S).asVal()}str(S){return this.in(S).asStr()}bin(S){return this.in(S).asBin()}arr(S){return this.in(S).asArr()}vec(S){return this.in(S).asVec()}obj(S){return this.in(S).asObj()}con(S){return this.in(S).asCon()}view(){return this.node.view()}select(S,x){try{let I=S!==void 0?this.find(S):this.node;if(x)for(;I instanceof t.ValNode;)I=I.child();return this.api.wrap(I)}catch{return}}read(S){const x=this.view();if(Array.isArray(S))return(0,u.get)(x,S);if(!S)return x;let I=S+"";return S&&I[0]!=="/"&&(I="/"+I),(0,u.get)(x,(0,d.toPath)(I))}add(S,x){const[I,N]=v(S);e:try{const R=this.select(I,!0);if(R instanceof b)R.set({[N]:x});else if(R instanceof C||R instanceof _||R instanceof w){const M=R.length();let T=0;if(typeof N=="number")T=N;else if(N==="-")T=M;else if(T=~~N,T+""!==N)break e;if(T!==T)break e;if(T<0&&(T=0),T>M&&(T=M),R instanceof C)R.ins(T,Array.isArray(x)?x:[x]);else if(R instanceof _)R.ins(T,x+"");else if(R instanceof w){if(!(x instanceof Uint8Array))break e;R.ins(T,x)}}else if(R instanceof m)R.set([[~~N,x]]);else break e;return!0}catch{}return!1}replace(S,x){const[I,N]=v(S);e:try{const R=this.select(I,!0);if(R instanceof b){const M=N+"";if(!R.has(M))break e;R.set({[N]:x})}else if(R instanceof C){const M=R.length();let T=0;if(typeof N=="number")T=N;else if(T=~~N,T+""!==N)break e;if(T!==T||T<0||T>M)break e;T===M?R.ins(T,[x]):R.upd(T,x)}else if(R instanceof m)R.set([[~~N,x]]);else break e;return!0}catch{}return!1}remove(S,x=1){const[I,N]=v(S);e:try{const R=this.select(I,!0);if(R instanceof b){const M=N+"";if(!R.has(M))break e;R.del([M])}else if(R instanceof C||R instanceof _||R instanceof w){const M=R.length();let T=0;if(typeof N=="number")T=N;else if(N==="-")T=x;else if(T=~~N,T+""!==N)break e;if(T!==T||T<0||T>M)break e;R.del(T,Math.min(x,M-T))}else if(R instanceof m)R.set([[~~N,void 0]]);else break e;return!0}catch{}return!1}diff(S){return p.diff(this,S)}merge(S){return p.merge(this,S)}op(S){var R;if(!Array.isArray(S))return!1;const[x,I,N]=S;switch(x){case"add":return this.add(I,N);case"replace":return this.replace(I,N);case"merge":return!!((R=this.select(I))!=null&&R.merge(N));case"remove":return this.remove(I,N)}}get s(){return{$:this}}get $(){return(0,h.proxy$)(S=>{try{return this.api.wrap(this.find(S))}catch{return}},"$")}toString(S=""){return"api("+(this.constructor===y?"*":this.node.name())+")"+(0,a.printTree)(S,[I=>this.node.toString(I)])}}ye.NodeApi=y;class g extends y{get s(){return{$:this}}}ye.ConApi=g;class f extends y{get(){return this.in()}set(S){const{api:x,node:I}=this,R=x.builder.constOrJson(S);x.builder.setVal(I.id,R),x.apply()}get s(){const S=this;return{$:this,get _(){const I=S.node.node();return S.api.wrap(I).s}}}}ye.ValApi=f;class m extends y{get(S){return this.in(S)}set(S){const{api:x,node:I}=this,{builder:N}=x;N.insVec(I.id,S.map(([R,M])=>[R,N.constOrJson(M)])),x.apply()}push(...S){const x=this.length();this.set(S.map((I,N)=>[x+N,I]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(x,I,N)=>{if(I==="$")return this;if(I==="toExt")return()=>this.asExt();const R=Number(I);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const M=this.node.get(R);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}ye.VecApi=m;class b extends y{get(S){return this.in(S)}set(S){const{api:x,node:I}=this,{builder:N}=x;N.insObj(I.id,Object.entries(S).map(([R,M])=>[R,N.constOrJson(M)])),x.apply()}del(S){const{api:x,node:I}=this,{builder:N}=x;x.builder.insObj(I.id,S.map(R=>[R,N.con(void 0)])),x.apply()}has(S){return this.node.keys.has(S)}get s(){return new Proxy({},{get:(x,I,N)=>{if(I==="$")return this;const R=String(I),M=this.node.get(R);if(!M)throw new Error("NO_SUCH_KEY");return this.api.wrap(M).s}})}}ye.ObjApi=b;class _ extends y{ins(S,x){const{api:I,node:N}=this;I.onBeforeLocalChange.emit(I.next);const R=I.builder;R.pad();const M=I.builder.nextTime(),T=new c.Timestamp(R.clock.sid,M),j=N.insAt(S,T,x);if(!j)throw new Error("OUT_OF_BOUNDS");R.insStr(N.id,j,x),I.advance()}del(S,x){const{api:I,node:N}=this;I.onBeforeLocalChange.emit(I.next);const R=I.builder;R.pad();const M=N.findInterval(S,x);if(!M)throw new Error("OUT_OF_BOUNDS");N.delete(M),R.del(N.id,M),I.advance()}findId(S){const x=this.node,N=x.length()-1;return S>N&&(S=N),S<0?x.id:x.find(S)||x.id}findPos(S){const x=this.node,I=x.id;if(I.sid===S.sid&&I.time===S.time)return-1;const N=x.findById(S);return N?x.pos(N)+(N.del?0:S.time-N.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}ye.StrApi=_;class w extends y{ins(S,x){const{api:I,node:N}=this,R=S?N.find(S-1):N.id;if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.insBin(N.id,R,x),I.apply()}del(S,x){const{api:I,node:N}=this,R=N.findInterval(S,x);if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.del(N.id,R),I.apply()}length(){return this.node.length()}get s(){return{$:this}}}ye.BinApi=w;class C extends y{get(S){return this.in(S)}ins(S,x){const{api:I,node:N}=this,{builder:R}=I,M=S?N.find(S-1):N.id;if(!M)throw new Error("OUT_OF_BOUNDS");const T=[];for(let j=0;j<x.length;j++)T.push(R.json(x[j]));R.insArr(N.id,M,T),I.apply()}push(...S){const x=this.length();this.ins(x,S)}upd(S,x){const{api:I,node:N}=this,R=N.getId(S);if(!R)throw new Error("OUT_OF_BOUNDS");const{builder:M}=I;M.updArr(N.id,R,M.constOrJson(x)),I.apply()}del(S,x){const{api:I,node:N}=this,R=N.findInterval(S,x);if(!R)throw new Error("OUT_OF_BOUNDS");I.builder.del(N.id,R),I.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(x,I,N)=>{if(I==="$")return this;const R=Number(I);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const M=this.node.getNode(R);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}ye.ArrApi=C;class E extends f{constructor(S){super(S.root,void 0),this.model=S,this.next=0,this.onBeforeReset=new n.FanOut,this.onReset=new n.FanOut,this.onBeforePatch=new n.FanOut,this.onPatch=new n.FanOut,this.onBeforeLocalChange=new n.FanOut,this.onLocalChange=new n.FanOut,this.onLocalChanges=new i.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new n.FanOut,this.onTransaction=new n.FanOut,this.onChange=new i.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new i.MicrotaskBufferFanOut(this.onChange),this.onFlush=new n.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=x=>this.onChanges.listen(()=>x()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new o.PatchBuilder(S.clock),S.onbeforereset=()=>this.onBeforeReset.emit(),S.onreset=()=>this.onReset.emit(),S.onbeforepatch=x=>this.onBeforePatch.emit(x),S.onpatch=x=>this.onPatch.emit(x)}wrap(S){if(S instanceof t.ValNode)return S.api||(S.api=new f(S,this));if(S instanceof t.StrNode)return S.api||(S.api=new _(S,this));if(S instanceof t.BinNode)return S.api||(S.api=new w(S,this));if(S instanceof t.ArrNode)return S.api||(S.api=new C(S,this));if(S instanceof t.ObjNode)return S.api||(S.api=new b(S,this));if(S instanceof t.ConNode)return S.api||(S.api=new g(S,this));if(S instanceof t.VecNode)return S.api||(S.api=new m(S,this));if(S instanceof l.ExtNode){if(S.api)return S.api;const x=this.model.ext.get(S.extId);return S.api=new x.Api(S,this)}else throw new Error("UNKNOWN_NODE")}root(S){return this.set(S)}set(S){return super.set(S),this}apply(){const S=this.builder.patch.ops,x=S.length,I=this.model,N=this.next;this.onBeforeLocalChange.emit(N);for(let R=this.next;R<x;R++)I.applyOperation(S[R]);this.next=x,I.tick++,this.onLocalChange.emit(N)}advance(){const S=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(S)}transaction(S){if(this.inTx)S();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),S(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const S=this.builder.flush();return this.next=0,S.ops.length&&this.onFlush.emit(S),S}autoFlush(S=!1){const x=()=>this.builder.patch.ops.length&&this.flush(),I=this.onLocalChanges.listen(x),N=this.onBeforeTransaction.listen(x),R=this.onTransaction.listen(x);return S&&x(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,I(),N(),R()}}}return ye.ModelApi=E,ye}var Vu;function Fh(){return Vu||(Vu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ne.__exportStar(C1(),e)}(Co)),Co}var jr={},Bu;function S1(){if(Bu)return jr;Bu=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.randomSessionId=void 0;const e=65535,a=9007199254740991-e,u=()=>Math.floor(a*Math.random()+e);return jr.randomSessionId=u,jr}var Pr={},Lu;function E1(){if(Lu)return Pr;Lu=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.Extensions=void 0;const e=st();let a=class Jh{constructor(){this.ext={}}register(d){this.ext[d.id]=d}get(d){return this.ext[d]}size(){return Object.keys(this.ext).length}clone(){const d=new Jh;for(const r of Object.values(this.ext))d.register(r);return d}toString(d=""){const r=Object.keys(this.ext).map(c=>+c).sort();return"extensions"+(0,e.printTree)(d,r.map(c=>t=>`${c}: ${this.ext[c].name}`))}};return Pr.Extensions=a,Pr}var Lt={},$o={},Fo={},Mr={},$u;function $a(){if($u)return Mr;$u=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.printBinary=void 0;const e=(a="",u)=>{const d=u[0],r=u[1];let c="";return d&&(c+=`
`+a+"← "+d(a+"  ")),r&&(c+=`
`+a+"→ "+r(a+"  ")),c};return Mr.printBinary=e,Mr}var Fu;function O1(){return Fu||(Fu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ne.__exportStar($a(),e)}(Fo)),Fo}var Ju;function x1(){return Ju||(Ju=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const a=O1(),u=JSON.stringify,d=(y,g,f)=>{const m=g.p;if(!m)return y;const b=g===m.l;let _=m.bf|0;switch(b?m.bf=++_:m.bf=--_,_){case 0:return y;case 1:case-1:return d(y,m,g);default:{const w=f===g.l;return b?w?(r(m,g),g.p?y:g):(t(m,g,f),f.p?y:f):w?(s(m,g,f),f.p?y:f):(c(m,g),g.p?y:g)}}},r=(y,g)=>{const f=y.p,m=g.r;g.p=f,g.r=y,y.p=g,y.l=m,m&&(m.p=y),f&&(f.l===y?f.l=g:f.r=g);let b=y.bf,_=g.bf;b+=-1-(_>0?_:0),_+=-1+(b<0?b:0),y.bf=b,g.bf=_},c=(y,g)=>{const f=y.p,m=g.l;g.p=f,g.l=y,y.p=g,y.r=m,m&&(m.p=y),f&&(f.l===y?f.l=g:f.r=g);let b=y.bf,_=g.bf;b+=1-(_<0?_:0),_+=1+(b>0?b:0),y.bf=b,g.bf=_},t=(y,g,f)=>{c(g,f),r(y,f)},s=(y,g,f)=>{r(g,f),c(y,f)},n=(y,g,f)=>(f.r=g,g.p=f,f.bf--,f.l?y:d(y,f,g));e.insertRight=n;const o=(y,g,f)=>(f.l=g,g.p=f,f.bf++,f.r?y:d(y,f,g));e.insertLeft=o;const i=(y,g,f)=>{if(!y)return g;const m=g.k;let b=y,_,w=0;for(;_=(w=f(m,b.k))<0?b.l:b.r;)b=_;return w<0?(0,e.insertLeft)(y,g,b):(0,e.insertRight)(y,g,b)};e.insert=i;const l=(y,g)=>{if(!y)return g;const f=g.p,m=g.l,b=g.r;if(g.p=g.l=g.r=void 0,m&&b)if(m.r){let C=m,E=C;for(;E=C.r;)C=E;const O=C.l,S=C.p,x=O;return f&&(f.l===g?f.l=C:f.r=C),C.p=f,C.r=b,C.bf=g.bf,m!==C&&(C.l=m,m.p=C),b.p=C,S&&(S.l===C?S.l=x:S.r=x),x&&(x.p=S),h(f?y:C,S,1)}else{f&&(f.l===g?f.l=m:f.r=m),m.p=f,m.r=b,b.p=m;const C=g.bf;if(f)return m.bf=C,p(y,m,1);const E=C-1;if(m.bf=E,E>=-1)return m;const O=b.l;return b.bf>0?(s(m,b,O),O):(c(m,b),b)}const _=m||b;return _&&(_.p=f),f?f.l===g?(f.l=_,p(y,f,1)):(f.r=_,h(y,f,1)):_};e.remove=l;const p=(y,g,f)=>{let m=g.bf|0;m-=f,g.bf=m;let b=f;if(m===-1)return y;if(m<-1){const w=g.r;if(w.bf<=0)w.l&&w.bf===0&&(b=0),c(g,w),g=w;else{const C=w.l;s(g,w,C),g=C}}const _=g.p;return _?_.l===g?p(y,_,b):h(y,_,b):g},h=(y,g,f)=>{let m=g.bf|0;m+=f,g.bf=m;let b=f;if(m===1)return y;if(m>1){const w=g.l;if(w.bf>=0)w.r&&w.bf===0&&(b=0),r(g,w),g=w;else{const C=w.r;t(g,w,C),g=C}}const _=g.p;return _?_.l===g?p(y,_,b):h(y,_,b):g},v=(y,g="")=>{if(!y)return"∅";const{bf:f,l:m,r:b,k:_,v:w}=y,C=w&&typeof w=="object"&&w.constructor===Object?u(w):w&&typeof w=="object"?w.toString(g):u(w),E=_!==void 0?` { ${u(_)} = ${C} }`:"",O=f?` [${f}]`:"";return y.constructor.name+`${O}`+E+(0,a.printBinary)(g,[m?S=>(0,e.print)(m,S):null,b?S=>(0,e.print)(b,S):null])};e.print=v}($o)),$o}var qr={},Jo={},Dr={},Uu;function Uh(){if(Uu)return Dr;Uu=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.first=void 0;const e=a=>{let u=a;for(;u;)if(u.l)u=u.l;else return u;return u};return Dr.first=e,Dr}var Vr={},zu;function R1(){if(zu)return Vr;zu=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.next=void 0;const e=Uh(),a=u=>{const d=u.r;if(d)return(0,e.first)(d);let r=u.p;for(;r&&r.r===u;)u=r,r=r.p;return r};return Vr.next=a,Vr}var Gu;function zh(){return Gu||(Gu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const a=Uh();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return a.first}});const u=R1();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return u.next}});const d=h=>{let v=h;for(;v;)if(v.r)v=v.r;else return v;return v};e.last=d;const r=h=>{if(h.l){for(h=h.l;h.r;)h=h.r;return h}let v=h.p;for(;v&&v.l===h;)h=v,v=v.p;return v};e.prev=r;const c=h=>{const v=h.l,y=h.r;return 1+(v?c(v):0)+(y?c(y):0)},t=h=>h?c(h):0;e.size=t;const s=(h,v,y)=>{let g=h;for(;g;){const f=y(v,g.k);if(f===0)return g;g=f<0?g.l:g.r}return g};e.find=s;const n=(h,v,y)=>{let g=h,f;for(;g;){const m=y(g.k,v);if(m===0)return g;if(m>0)g=g.l;else{const b=g.r;if(f=g,!b)return f;g=b}}return f};e.findOrNextLower=n;const o=(h,v)=>{const y=h.r=v.r;v.r=h,h.p=v,y&&(y.p=h)};e.insertRight=o;const i=(h,v)=>{const y=h.l=v.l;v.l=h,h.p=v,y&&(y.p=h)};e.insertLeft=i;const l=(h,v,y)=>{if(!h)return v;const g=v.k;let f=h;for(;f;){const m=y(g,f.k),b=m<0?f.l:f.r;if(b)f=b;else{m<0?(0,e.insertLeft)(v,f):(0,e.insertRight)(v,f);break}}return h};e.insert=l;const p=(h,v)=>{const y=v.p,g=v.l,f=v.r;if(v.p=v.l=v.r=void 0,!g&&!f){if(y)y.l===v?y.l=void 0:y.r=void 0;else return;return h}else if(g&&f){let b=g;for(;b.r;)b=b.r;return b.r=f,f.p=b,y?(y.l===v?y.l=g:y.r=g,g.p=y,h):(g.p=void 0,g)}const m=g||f;if(m.p=y,y)y.l===v?y.l=m:y.r=m;else return m;return h};e.remove=p}(Jo)),Jo}var Uo={},Wu;function I1(){return Wu||(Wu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ne.__exportStar(st(),e)}(Uo)),Uo}var Hu;function N1(){if(Hu)return qr;Hu=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.createMap=void 0;const e=zh(),a=I1(),u=(r,c)=>r===c?0:r<c?-1:1,d=(r,c,t,s,n,o)=>{class i{constructor(p){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=p||u}set(p,h){const v=this.root;if(v===void 0){this._size=1;const _=new r(p,h);return this.root=this.min=this.max=c(void 0,_,this.comparator)}const y=this.comparator;let g;const f=this.max;if(g=y(p,f.k),g===0)return f.v=h,f;if(g>0){const _=this.max=new r(p,h);return this.root=s(v,_,f),this._size++,_}const m=this.min;if(g=y(p,m.k),g===0)return m.v=h,m;if(g<0){const _=this.min=new r(p,h);return this.root=t(v,_,m),this._size++,_}let b=v;do{if(g=y(p,b.k),g===0)return b.v=h,b;if(g>0){const _=b.r;if(_===void 0){const w=new r(p,h);return this.root=s(v,w,b),this._size++,w}b=_}else if(g<0){const _=b.l;if(_===void 0){const w=new r(p,h);return this.root=t(v,w,b),this._size++,w}b=_}}while(!0)}find(p){const h=this.comparator;let v=this.root;for(;v;){const y=+h(p,v.k);if(y===0)return v;v=y<0?v.l:v.r}}get(p){var h;return(h=this.find(p))==null?void 0:h.v}del(p){const h=this.find(p);return h?(h===this.max&&(this.max=(0,e.prev)(h)),h===this.min&&(this.min=(0,e.next)(h)),this.root=n(this.root,h),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(p){return!!this.find(p)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(p){return(0,e.findOrNextLower)(this.root,p,this.comparator)||void 0}forEach(p){let h=this.first();if(h)do p(h);while(h=(0,e.next)(h))}first(){return this.min}last(){return this.max}iterator0(){let p=this.first();return()=>{if(!p)return;const h=p;return p=(0,e.next)(p),h}}iterator(){const p=this.iterator0();return{next:()=>{const h=p();return{value:h,done:!h}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(p){return this.constructor.name+(0,a.printTree)(p,[h=>o(this.root,h)])}}return i};return qr.createMap=d,qr}var Ku;function k1(){if(Ku)return Lt;Ku=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.AvlMap=Lt.AvlNode=void 0;const e=x1(),a=N1();class u{constructor(r,c){this.k=r,this.v=c,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Lt.AvlNode=u,Lt.AvlMap=(0,a.createMap)(u,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),Lt}var Xu;function Fa(){if(Xu)return Mt;Xu=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.Model=Mt.UNDEFINED=void 0;const e=ne,a=e.__importStar(mn()),u=e.__importStar(me()),d=r1(),r=Fh(),c=ws(),t=S1(),s=It(),n=_s(),o=st(),i=E1(),l=k1(),p=Ss();Mt.UNDEFINED=new n.ConNode(c.ORIGIN,void 0);let h=class fa{rndSid(){const y=this.clock,g=y.sid,f=y.peers;for(;;){const m=(0,t.randomSessionId)();if(g!==m&&!f.has(m))return m}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const m=y[0].getId().sid;if(!m)throw new Error("NO_SID");const b=fa.create(void 0,m);return b.applyBatch(y),b}constructor(y){this.root=new s.RootNode(this,c.ORIGIN),this.index=new l.AvlMap(u.compare),this.ext=new i.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new r.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const g=y.length;for(let f=0;f<g;f++)this.applyPatch(y[f])}applyLocalPatch(y){const g=y.getId();if(g){const f=this.clock;if(f.sid===g.sid){const m=f.time;m>g.time&&(y=y.rebase(m))}}this.applyPatch(y)}applyPatch(y){var m,b;(m=this.onbeforepatch)==null||m.call(this,y);const g=y.ops,{length:f}=g;for(let _=0;_<f;_++)this.applyOperation(g[_]);this.tick++,(b=this.onpatch)==null||b.call(this,y)}applyOperation(y){this.clock.observe(y.id,y.span());const g=this.index;if(y instanceof a.InsStrOp){const f=g.get(y.obj);f instanceof s.StrNode&&f.ins(y.ref,y.id,y.data)}else if(y instanceof a.NewObjOp){const f=y.id;g.get(f)||g.set(f,new s.ObjNode(this,f))}else if(y instanceof a.NewArrOp){const f=y.id;g.get(f)||g.set(f,new s.ArrNode(this,f))}else if(y instanceof a.NewStrOp){const f=y.id;g.get(f)||g.set(f,new s.StrNode(f))}else if(y instanceof a.NewValOp){const f=y.id;g.get(f)||g.set(f,new s.ValNode(this,f,c.ORIGIN))}else if(y instanceof a.NewConOp){const f=y.id;g.get(f)||g.set(f,new n.ConNode(f,y.val))}else if(y instanceof a.InsObjOp){const f=g.get(y.obj),m=y.data,b=m.length;if(f instanceof s.ObjNode)for(let _=0;_<b;_++){const w=m[_],C=g.get(w[1]);if(!C||f.id.time>=w[1].time)continue;const E=f.put(w[0]+"",C.id);E&&this._gcTree(E)}}else if(y instanceof a.InsVecOp){const f=g.get(y.obj),m=y.data,b=m.length;if(f instanceof s.VecNode)for(let _=0;_<b;_++){const w=m[_],C=g.get(w[1]);if(!C||f.id.time>=w[1].time)continue;const E=f.put(Number(w[0]),C.id);E&&this._gcTree(E)}}else if(y instanceof a.InsValOp){const f=y.obj,m=f.sid===0&&f.time===0?this.root:g.get(f);if(m instanceof s.ValNode&&g.get(y.val)){const _=m.set(y.val);_&&this._gcTree(_)}}else if(y instanceof a.InsArrOp){const f=g.get(y.obj);if(f instanceof s.ArrNode){const m=[],b=y.data,_=b.length;for(let w=0;w<_;w++){const C=b[w];g.get(C)&&(f.id.time>=C.time||m.push(C))}m.length&&f.ins(y.ref,y.id,m)}}else if(y instanceof a.UpdArrOp){const f=g.get(y.obj);if(f instanceof s.ArrNode){const m=y.val;if(g.get(m)){const b=f.upd(y.ref,m);b&&this._gcTree(b)}}}else if(y instanceof a.DelOp){const f=g.get(y.obj);if(f instanceof s.ArrNode){const m=y.what.length;for(let b=0;b<m;b++){const _=y.what[b];for(let w=0;w<_.span;w++){const C=f.getById(new u.Timestamp(_.sid,_.time+w));C&&this._gcTree(C)}}f.delete(y.what)}else(f instanceof s.StrNode||f instanceof s.BinNode)&&f.delete(y.what)}else if(y instanceof a.NewBinOp){const f=y.id;g.get(f)||g.set(f,new s.BinNode(f))}else if(y instanceof a.InsBinOp){const f=g.get(y.obj);f instanceof s.BinNode&&f.ins(y.ref,y.id,y.data)}else if(y instanceof a.NewVecOp){const f=y.id;g.get(f)||g.set(f,new s.VecNode(this,f))}}_gcTree(y){if(y.sid===0)return;const f=this.index.get(y);if(!f)return;const m=f.api;m&&m.events.handleDelete(),f.children(b=>this._gcTree(b.id)),this.index.del(y)}fork(y=this.rndSid()){const g=fa.fromBinary(this.toBinary());return g.clock.sid!==y&&g.clock instanceof u.ClockVector&&(g.clock=g.clock.fork(y)),g.ext=this.ext,g}clone(){return this.fork(this.clock.sid)}reset(y){var b,_;(b=this.onbeforereset)==null||b.call(this);const g=this.index;this.index=new l.AvlMap(u.compare);const f=y.toBinary();d.decoder.decode(f,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const m=this._api;m&&(m.flush(),m.builder.clock=this.clock,m.node=this.root),g.forEach(({v:w})=>{const C=w.api;if(!C)return;const E=this.index.get(w.id);if(!E){C.events.handleDelete();return}C.node=E,E.api=C}),this.tick++,(_=this.onreset)==null||_.call(this)}view(){return this.root.view()}toBinary(){return d.encoder.encode(this)}setSchema(y,g=!0){const f=this.clock;if(f.time===1){const b=f.sid;g&&(f.sid=2),this.api.set(y),g&&this.setSid(b)}return this}setSid(y){const g=this.clock,f=g.sid;f!==y&&(g.sid=y,g.observe(new u.Timestamp(f,g.time-1),1))}toString(y=""){const g=()=>"",f=this.ext.size()>0;return"model"+(0,o.printTree)(y,[m=>this.root.toString(m),g,m=>{const b=[];return this.index.forEach(_=>b.push(_.v)),`index (${b.length} nodes)`+(b.length?(0,o.printTree)(m,b.map(_=>w=>`${_.name()} ${u.printTs(_.id)}`)):"")},g,m=>`view${(0,o.printTree)(m,[b=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+b)])}`,g,m=>this.clock.toString(m),f?g:null,f?m=>this.ext.toString(m):null])}};return Mt.Model=h,h.sid=t.randomSessionId,h.create=(v,y=h.sid())=>{const g=typeof y=="number"?y===1?new u.ServerClockVector(1,1):new u.ClockVector(y,1):y,f=new h(g);return v!==void 0&&f.setSchema(v instanceof p.NodeBuilder?v:p.s.json(v),!0),f},h.withServerClock=(v,y=1)=>h.create(v,new u.ServerClockVector(1,y)),h.fromBinary=v=>d.decoder.decode(v),h.load=(v,y,g)=>{const f=d.decoder.decode(v);return g&&f.setSchema(g,!0),typeof y=="number"&&f.setSid(y),f},Mt}var Yu;function Gh(){if(Yu)return er;Yu=1,Object.defineProperty(er,"__esModule",{value:!0}),er.ValNode=void 0;const e=me(),a=st(),u=Fa();let d=class{constructor(c,t,s){this.doc=c,this.id=t,this.val=s,this.api=void 0}set(c){if((0,e.compare)(c,this.val)<=0&&this.val.sid!==0||(0,e.compare)(c,this.id)<=0)return;const t=this.val;return this.val=c,t}node(){return this.val.sid===0?u.UNDEFINED:this.child()}view(){var c;return(c=this.node())==null?void 0:c.view()}children(c){c(this.node())}child(){return this.doc.index.get(this.val)}container(){const c=this.node();return c?c.container():void 0}name(){return"val"}toString(c=""){const t=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,a.printTree)(c,[n=>t?t.toString(n):(0,e.printTs)(this.val)])}};return er.ValNode=d,er}var Br={},Qu;function A1(){if(Qu)return Br;Qu=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.RootNode=void 0;const e=ws(),a=Gh();let u=class extends a.ValNode{constructor(r,c){super(r,e.ORIGIN,c)}name(){return"root"}};return Br.RootNode=u,Br}var Lr={},$r={},Zu;function T1(){if(Zu)return $r;Zu=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.CRDT_CONSTANTS=void 0;var e;return function(a){a[a.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(e||($r.CRDT_CONSTANTS=e={})),$r}var ed;function j1(){if(ed)return Lr;ed=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.VecNode=void 0;const e=_s(),a=T1(),u=st(),d=me();let r=class{constructor(t,s){this.doc=t,this.id=s,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(t){return this.elements[t]}get(t){const s=this.elements[t];if(s)return this.doc.index.get(s)}put(t,s){if(t>a.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const n=this.val(t);if(!(n&&(0,d.compare)(n,s)>=0)){if(t>this.elements.length)for(let o=this.elements.length;o<t;o++)this.elements.push(void 0);return t<this.elements.length?this.elements[t]=s:this.elements.push(s),n}}ext(){if(this.__extNode)return this.__extNode;const t=this.getExtId();if(!(t>=0))return;const n=this.doc.ext.get(t);if(n)return this.__extNode=new n.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const t=this.get(0);if(!(t instanceof e.ConNode))return-1;const s=t.val,n=this.id;return!(s instanceof Uint8Array)||s.length!==3||s[1]!==n.sid%256||s[2]!==n.time%256?-1:s[0]}child(){return this.ext()}container(){return this}children(t){const s=this.elements,n=s.length,o=this.doc.index;for(let i=0;i<n;i++){const l=s[i];if(!l)continue;const p=o.get(l);p&&t(p)}}view(){const t=this.ext();if(t)return t.view();let s=!0;const n=this._view,o=[],i=this.doc.index,l=this.elements,p=l.length;for(let h=0;h<p;h++){const v=l[h],y=v?i.get(v):void 0,g=y?y.view():void 0;n[h]!==g&&(s=!1),o.push(g)}return s?n:this._view=o}name(){return"vec"}toString(t=""){const s=this.ext(),n=this.name()+" "+(0,d.printTs)(this.id)+(s?` { extension = ${this.getExtId()} }`:"");if(s)return this.child().toString(t,this.id);const o=this.doc.index;return n+(0,u.printTree)(t,[...this.elements.map((i,l)=>p=>`${l}: ${i&&o.get(i)?o.get(i).toString(p+"  "+" ".repeat((""+l).length)):"nil"}`),...s?[i=>`${this.child().toString(i)}`]:[]])}};return Lr.VecNode=r,Lr}var Fr={},td;function P1(){if(td)return Fr;td=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.ObjNode=void 0;const e=st(),a=me(),u=_s();let d=class{constructor(c,t){this.doc=c,this.id=t,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(c){const t=this.keys.get(c);if(t)return this.doc.index.get(t)}put(c,t){const s=this.keys.get(c);if(!(s&&(0,a.compare)(s,t)>=0))return this.keys.set(c,t),s}nodes(c){const t=this.doc.index;this.keys.forEach((s,n)=>c(t.get(s),n))}forEach(c){const t=this.doc.index;this.keys.forEach((s,n)=>{const o=t.get(s);!o||o instanceof u.ConNode&&o.val===void 0||c(n,o)})}children(c){const t=this.doc.index;this.keys.forEach((s,n)=>c(t.get(s)))}child(){}container(){return this}view(){const c=this.doc,t=c.clock.time+c.tick,s=this._view;if(this._tick===t)return s;const n={},o=c.index;let i=!0;return this.keys.forEach((l,p)=>{const h=o.get(l);if(!h){i=!1;return}const v=h.view();v!==void 0?(s[p]!==v&&(i=!1),n[p]=v):s[p]!==void 0&&(i=!1)}),i?s:(this._tick=t,this._view=n)}name(){return"obj"}toString(c=""){return this.name()+" "+(0,a.printTs)(this.id)+(0,e.printTree)(c,[...this.keys.entries()].filter(([,s])=>!!this.doc.index.get(s)).map(([s,n])=>o=>JSON.stringify(s)+(0,e.printTree)(o+" ",[i=>this.doc.index.get(n).toString(i)])))}};return Fr.ObjNode=d,Fr}var $t={},Jr={},zo={},nd;function M1(){return nd||(nd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const a=(n,o,i)=>{const l=o.p;if(!l)return n;const p=l.p,h=l.l===o;return p?(p.l===l?h?n=(0,e.llSplay)(n,o,l,p):n=(0,e.lrSplay)(n,o,l,p):h?n=(0,e.rlSplay)(n,o,l,p):n=(0,e.rrSplay)(n,o,l,p),i>1?(0,e.splay)(n,o,i-1):n):(h?(0,e.rSplay)(o,l):(0,e.lSplay)(o,l),o)};e.splay=a;const u=(n,o)=>{const i=n.r;n.p=void 0,n.r=o,o.p=n,o.l=i,i&&(i.p=o)};e.rSplay=u;const d=(n,o)=>{const i=n.l;n.p=void 0,n.l=o,o.p=n,o.r=i,i&&(i.p=o)};e.lSplay=d;const r=(n,o,i,l)=>{const p=i.l,h=o.l,v=l.p;return o.p=v,o.l=i,i.p=o,i.l=l,i.r=h,l.p=i,l.r=p,p&&(p.p=l),h&&(h.p=i),v?v.l===l?v.l=o:v.r=o:n=o,n};e.rrSplay=r;const c=(n,o,i,l)=>{const p=i.r,h=o.r,v=l.p;return o.p=v,o.r=i,i.p=o,i.l=h,i.r=l,l.p=i,l.l=p,p&&(p.p=l),h&&(h.p=i),v?v.l===l?v.l=o:v.r=o:n=o,n};e.llSplay=c;const t=(n,o,i,l)=>{const p=o.l,h=o.r,v=l.p;return o.p=v,o.l=i,o.r=l,i.p=o,i.r=p,l.p=o,l.l=h,p&&(p.p=i),h&&(h.p=l),v?v.l===l?v.l=o:v.r=o:n=o,n};e.lrSplay=t;const s=(n,o,i,l)=>{const p=o.r,h=o.l,v=l.p;return o.p=v,o.l=l,o.r=i,i.p=o,i.l=p,l.p=o,l.r=h,p&&(p.p=i),h&&(h.p=l),v?v.l===l?v.l=o:v.r=o:n=o,n};e.rlSplay=s}(zo)),zo}var Go={},rd;function q1(){return rd||(rd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const a=(n,o)=>{const i=o.p2;if(!i)return n;const l=i.p2,p=i.l2===o;return l?(l.l2===i?p?n=c(n,o,i,l):n=t(n,o,i,l):p?n=s(n,o,i,l):n=r(n,o,i,l),(0,e.splay2)(n,o)):(p?u(o,i):d(o,i),o)};e.splay2=a;const u=(n,o)=>{const i=n.r2;n.p2=void 0,n.r2=o,o.p2=n,o.l2=i,i&&(i.p2=o)},d=(n,o)=>{const i=n.l2;n.p2=void 0,n.l2=o,o.p2=n,o.r2=i,i&&(i.p2=o)},r=(n,o,i,l)=>{const p=i.l2,h=o.l2,v=l.p2;return o.p2=v,o.l2=i,i.p2=o,i.l2=l,i.r2=h,l.p2=i,l.r2=p,p&&(p.p2=l),h&&(h.p2=i),v?v.l2===l?v.l2=o:v.r2=o:n=o,n},c=(n,o,i,l)=>{const p=i.r2,h=o.r2,v=l.p2;return o.p2=v,o.r2=i,i.p2=o,i.l2=h,i.r2=l,l.p2=i,l.l2=p,p&&(p.p2=l),h&&(h.p2=i),v?v.l2===l?v.l2=o:v.r2=o:n=o,n},t=(n,o,i,l)=>{const p=o.l2,h=o.r2,v=l.p2;return o.p2=v,o.l2=i,o.r2=l,i.p2=o,i.r2=p,l.p2=o,l.l2=h,p&&(p.p2=i),h&&(h.p2=l),v?v.l2===l?v.l2=o:v.r2=o:n=o,n},s=(n,o,i,l)=>{const p=o.r2,h=o.l2,v=l.p2;return o.p2=v,o.l2=l,o.r2=i,i.p2=o,i.l2=p,l.p2=o,l.r2=h,p&&(p.p2=i),h&&(h.p2=l),v?v.l2===l?v.l2=o:v.r2=o:n=o,n}}(Go)),Go}var Ie={},id;function D1(){if(id)return Ie;id=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.remove2=Ie.insert2=Ie.prev2=Ie.next2=Ie.last2=Ie.first2=void 0;const e=n=>{let o=n;for(;o;)if(o.l2)o=o.l2;else return o;return o};Ie.first2=e;const a=n=>{let o=n;for(;o;)if(o.r2)o=o.r2;else return o;return o};Ie.last2=a;const u=n=>{if(n.r2){for(n=n.r2;n.l2;)n=n.l2;return n}let o=n.p2;for(;o&&o.r2===n;)n=o,o=o.p2;return o};Ie.next2=u;const d=n=>{if(n.l2){for(n=n.l2;n.r2;)n=n.r2;return n}let o=n.p2;for(;o&&o.l2===n;)n=o,o=o.p2;return o};Ie.prev2=d;const r=(n,o)=>{const i=n.r2=o.r2;o.r2=n,n.p2=o,i&&(i.p2=n)},c=(n,o)=>{const i=n.l2=o.l2;o.l2=n,n.p2=o,i&&(i.p2=n)},t=(n,o,i)=>{if(!n)return o;let l=n;for(;l;){const p=i(o,l),h=p<0?l.l2:l.r2;if(h)l=h;else{p<0?c(o,l):r(o,l);break}}return n};Ie.insert2=t;const s=(n,o)=>{const i=o.p2,l=o.l2,p=o.r2;if(o.p2=o.l2=o.r2=void 0,!l&&!p){if(i)i.l2===o?i.l2=void 0:i.r2=void 0;else return;return n}else if(l&&p){let v=l;for(;v.r2;)v=v.r2;return v.r2=p,p.p2=v,i?(i.l2===o?i.l2=l:i.r2=l,l.p2=i,n):(l.p2=void 0,l)}const h=l||p;if(h.p2=i,i)i.l2===o?i.l2=h:i.r2=h;else return h;return n};return Ie.remove2=s,Ie}var Ur={},sd;function V1(){if(sd)return Ur;sd=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.printOctets=void 0;const e=(a,u=16)=>{let d="";if(!a.length)return d;a[0]<16&&(d+="0"),d+=a[0].toString(16);for(let r=1;r<a.length&&r<u;r++){const c=a[r];d+=" ",c<16&&(d+="0"),d+=c.toString(16)}return a.length>u&&(d+=`… (${a.length-u} more)`),d};return Ur.printOctets=e,Ur}var od;function Ja(){if(od)return Jr;od=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.AbstractRga=void 0;const e=me(),a=Va(),u=M1(),d=q1(),r=D1(),c=ws(),t=st(),s=$a(),n=V1(),o=(g,f)=>{const m=g.id,b=f.id;return m.sid-b.sid||m.time-b.time},i=g=>{const f=g.l,m=g.r;g.len=(g.del?0:g.span)+(f?f.len:0)+(m?m.len:0)},l=g=>{const f=g.l,m=g.r;g.len=g.span+(f?f.len:0)+(m?m.len:0)},p=(g,f)=>{for(;g;)g.len+=f,g=g.p},h=g=>{const f=g.r;if(f){g=f;let b;for(;b=g.l;)g=b;return g}let m=g.p;for(;m&&m.r===g;)g=m,m=m.p;return m},v=g=>{const f=g.l;if(f){g=f;let b;for(;b=g.r;)g=b;return g}let m=g.p;for(;m&&m.l===g;)g=m,m=m.p;return m};let y=class{constructor(f){this.id=f,this.root=void 0,this.ids=void 0,this.count=0}ins(f,m,b){const _=this.id,w=f.time,C=f.sid;if(_.time===w&&_.sid===C){this.insAfterRoot(f,m,b);return}let O=this.ids,S=O;for(;O;){const j=O.id,D=j.sid;if(D>C)O=O.l2;else if(D<C)S=O,O=O.r2;else{const G=j.time;if(G>w)O=O.l2;else if(G<w)S=O,O=O.r2;else{S=O;break}}}if(!S)return;const x=S.id,I=x.time,N=x.sid,R=S.span;if(N!==C||w-I>=R)return;const T=w-I;this.insAfterChunk(f,S,T,m,b)}insAt(f,m,b){if(!f){const S=this.id;return this.insAfterRoot(S,m,b),S}const _=this.findChunk(f-1);if(!_)return;const[w,C]=_,E=w.id,O=C===0?E:new e.Timestamp(E.sid,E.time+C);return this.insAfterChunk(O,w,C,m,b),O}insAfterRoot(f,m,b){const _=this.createChunk(m,b),w=this.first();if(!w)this.setRoot(_);else if((0,e.compare)(w.id,m)<0)this.insertBefore(_,w);else{if((0,e.containsId)(w.id,w.span,m))return;this.insertAfterRef(_,f,w)}}insAfterChunk(f,m,b,_,w){const C=m.id,E=C.time,O=C.sid,S=m.span,x=this.createChunk(_,w);if(b+1<S){const N=_.sid,R=_.time;if(O===N&&E<=R&&E+S-1>=R)return;if(R>f.time+1||N>f.sid){this.insertInside(x,m,b+1),this.splay(x);return}}this.insertAfterRef(x,f,m),this.splay(x)}delete(f){const m=f.length;for(let b=0;b<m;b++)this.deleteSpan(f[b]);this.onChange()}deleteSpan(f){const m=f.span,b=f.time,_=b+m-1,w=this.findById(f);if(!w)return;let C=w,E=C;for(;C;){E=C;const O=C.id,S=C.span,x=O.time,I=x+S-1;if(C.del){if(I>=_)break;C=C.s;continue}const N=b<=x,R=b<=I;if(N)if(_>=I){if(C.delete(),p(C,-C.span),_<=I)break}else{const T=_-x+1,j=this.split(C,T);C.delete(),i(j),p(C,-C.span);break}else if(R)if(_>=I){const T=b-x,j=this.split(C,T);if(j.delete(),j.len=j.r?j.r.len:0,p(C,-j.span),_<=I)break}else{const T=this.split(C,_-x+1),j=this.split(C,b-x);j.delete(),i(T),i(j),p(C,-j.span);break}C=C.s}E&&this.mergeTombstones2(w,E)}find(f){let m=this.root;for(;m;){const b=m.l,_=b?b.len:0;let w;if(f<_)m=b;else if(m.del)f-=_,m=m.r;else if(f<_+(w=m.span)){const C=f-_,E=m.id;return C?new e.Timestamp(E.sid,E.time+C):E}else f-=_+w,m=m.r}}findChunk(f){let m=this.root;for(;m;){const b=m.l,_=b?b.len:0;let w;if(f<_)m=b;else if(m.del)f-=_,m=m.r;else{if(f<_+(w=m.span))return[m,f-_];f-=_+w,m=m.r}}}findInterval(f,m){const b=[];if(!m)return b;let _=this.root,w=0;for(;_;){const O=_.l?_.l.len:0;if(f<O)_=_.l;else if(_.del)f-=O,_=_.r;else if(f<O+_.span){w=f-O;break}else f-=O+_.span,_=_.r}if(!_)return b;if(_.span>=m+w){const O=_.id;return b.push((0,e.tss)(O.sid,O.time+w,m)),b}const C=_.span-w,E=_.id;if(b.push((0,e.tss)(E.sid,E.time+w,C)),m-=C,_=h(_),!_)return b;do{if(_.del)continue;const O=_.id,S=_.span;if(m<=S)return b.push((0,e.tss)(O.sid,O.time,m)),b;b.push((0,e.tss)(O.sid,O.time,S)),m-=S}while((_=h(_))&&m>0);return b}findInterval2(f,m){const b=[];return this.range0(void 0,f,m,(_,w,C)=>{const E=_.id;b.push((0,e.tss)(E.sid,E.time+w,C))}),b}range0(f,m,b,_){let w=f||this.findById(m);if(f)for(;w&&!(0,e.containsId)(w.id,w.span,m);)w=h(w);if(w){if(w.del){if((0,e.containsId)(w.id,w.span,b))return}else{const C=m.time-w.id.time;if((0,e.containsId)(w.id,w.span,b)){const S=b.time-m.time+1;return _(w,C,S),w}const O=w.span-C;if(_(w,C,O))return w}for(w=h(w);w;){if((0,e.containsId)(w.id,w.span,b))return!w.del&&_(w,0,b.time-w.id.time+1),w;if(!w.del&&_(w,0,w.span))return w;w=h(w)}return w}}first(){let f=this.root;for(;f;){const m=f.l;if(m)f=m;else return f}return f}last(){let f=this.root;for(;f;){const m=f.r;if(m)f=m;else return f}return f}lastId(){const f=this.last();if(!f)return;const m=f.id,b=f.span;return b===1?m:new e.Timestamp(m.sid,m.time+b-1)}next(f){return h(f)}prev(f){return v(f)}length(){const f=this.root;return f?f.len:0}size(){return this.count}pos(f){const m=f.p,b=f.l;if(!m)return b?b.len:0;const _=this.pos(m);if(m.r===f)return _+(m.del?0:m.span)+(b?b.len:0);const C=f.r;return _-(f.del?0:f.span)-(C?C.len:0)}setRoot(f){this.root=f,this.insertId(f),this.onChange()}insertBefore(f,m){const b=m.l;m.l=f,f.l=b,f.p=m;let _=0;b&&(b.p=f,_=b.len),f.len=f.span+_,p(m,f.span),this.insertId(f),this.onChange()}insertAfter(f,m){const b=m.r;m.r=f,f.r=b,f.p=m;let _=0;b&&(b.p=f,_=b.len),f.len=f.span+_,p(m,f.span),this.insertId(f),this.onChange()}insertAfterRef(f,m,b){const _=f.id,w=_.sid,C=_.time;let E=!1;for(;;){const O=b.id,S=O.time+b.span;b.s||(E=O.sid===w&&S===C&&S-1===m.time,E&&(b.s=f));const x=h(b);if(!x)break;const I=x.id,N=I.time,R=I.sid;if(N<C)break;if(N===C){if(R===w)return;if(R<w)break}b=x}E&&!b.del?(this.mergeContent(b,f.data),b.s=void 0):this.insertAfter(f,b)}mergeContent(f,m){const b=f.span;f.merge(m),p(f,f.span-b),this.onChange()}insertInside(f,m,b){const _=m.p,w=m.l,C=m.r,E=m.s,O=m.len,S=m.split(b);if(m.s=S,S.s=E,m.l=m.r=S.l=S.r=void 0,S.l=void 0,f.p=_,!w)f.l=m,m.p=f;else{f.l=w,w.p=f;const N=w.r;w.r=m,m.p=w,m.l=N,N&&(N.p=m)}if(!C)f.r=S,S.p=f;else{f.r=C,C.p=f;const N=C.l;C.l=S,S.p=C,S.r=N,N&&(N.p=S)}_?_.l===m?_.l=f:_.r=f:this.root=f,i(m),i(S),w&&(w.len=(w.l?w.l.len:0)+m.len+(w.del?0:w.span)),C&&(C.len=(C.r?C.r.len:0)+S.len+(C.del?0:C.span)),f.len=O+f.span;const x=f.span;let I=f.p;for(;I;)I.len+=x,I=I.p;this.insertId(S),this.insertIdFast(f),this.onChange()}split(f,m){const b=f.s,_=f.split(m),w=f.r;return f.s=_,_.r=w,_.s=b,f.r=_,_.p=f,this.insertId(_),w&&(w.p=_),_}mergeTombstones(f,m){if(!f.del||!m.del)return!1;const b=f.id,_=m.id;return b.sid!==_.sid||b.time+f.span!==_.time?!1:(f.s=m.s,f.span+=m.span,this.deleteChunk(m),!0)}mergeTombstones2(f,m){let b=f;for(;b;){const w=h(b);if(!w)break;if(!this.mergeTombstones(b,w)){if(w===m){if(w){const E=h(w);E&&this.mergeTombstones(w,E)}break}b=b.s}}const _=v(f);_&&this.mergeTombstones(_,f)}removeTombstones(){let f=this.first();const m=[];for(;f;)f.del&&m.push(f),f=h(f);for(let b=0;b<m.length;b++)this.deleteChunk(m[b])}deleteChunk(f){this.deleteId(f);const m=f.p,b=f.l,_=f.r;if(f.id=c.ORIGIN,!b&&!_)m?m.l===f?m.l=void 0:m.r=void 0:this.root=void 0;else if(b&&_){let w=b;for(;w.r;)w=w.r;w.r=_,_.p=w;const C=_.len;let E;for(E=w,m?(m.l===f?m.l=b:m.r=b,b.p=m):(this.root=b,b.p=void 0);E&&E!==m;)E.len+=C,E=E.p}else{const w=b||_;w.p=m,m?m.l===f?m.l=w:m.r=w:this.root=w}}insertId(f){this.ids=(0,r.insert2)(this.ids,f,o),this.count++,this.ids=(0,d.splay2)(this.ids,f)}insertIdFast(f){this.ids=(0,r.insert2)(this.ids,f,o),this.count++}deleteId(f){this.ids=(0,r.remove2)(this.ids,f),this.count--}findById(f){const m=f.sid,b=f.time;let _=this.ids,w=_;for(;_;){const I=_.id,N=I.sid;if(N>m)_=_.l2;else if(N<m)w=_,_=_.r2;else{const R=I.time;if(R>b)_=_.l2;else if(R<b)w=_,_=_.r2;else{w=_;break}}}if(!w)return;const C=w.id,E=C.time,O=C.sid,S=w.span;if(!(O!==m||b<E||b-E>=S))return w}prevId(f){let m=this.findById(f);if(!m)return;const b=f.time;if(m.id.time<b)return new e.Timestamp(f.sid,b-1);if(m=v(m),!m)return;const _=m.id;return m.span>1?new e.Timestamp(_.sid,_.time+m.span-1):_}spanView(f){const m=[];let b=f.span;const _=f.time;let w=this.findById(f);if(!w)return m;if(!w.del)if(w.span>=b+_-w.id.time){const C=_-w.id.time,E=C+b,O=w.view().slice(C,E);return m.push(O),m}else{const C=_-w.id.time,E=w.view().slice(C,f.span);b-=w.span-C,m.push(E)}for(;w=w.s;){const C=w.span;if(!w.del){if(C>b){const E=w.view().slice(0,b);m.push(E);break}m.push(w.data)}if(b-=C,b<=0)break}return m}splay(f){const m=f.p;if(!m)return;const b=m.p,_=m.l===f;if(!b){_?(0,u.rSplay)(f,m):(0,u.lSplay)(f,m),this.root=f,i(m),l(f);return}b.l===m?_?this.root=(0,u.llSplay)(this.root,f,m,b):this.root=(0,u.lrSplay)(this.root,f,m,b):_?this.root=(0,u.rlSplay)(this.root,f,m,b):this.root=(0,u.rrSplay)(this.root,f,m,b),i(b),i(m),l(f),this.splay(f)}iterator(){let f=this.first();return()=>{const m=f;return f&&(f=h(f)),m}}ingest(f,m){if(f<1)return;const b=new Map;this.root=this._ingest(f,()=>{const _=m(),w=_.id,C=w.sid+"."+w.time,E=b.get(C);E&&(E.s=_,b.delete(C));const O=(0,e.tick)(w,_.span);return b.set(O.sid+"."+O.time,_),_})}_ingest(f,m){const b=f>>1,_=f-b-1,w=b>0?this._ingest(b,m):void 0,C=m();w&&(C.l=w,w.p=C);const E=_>0?this._ingest(_,m):void 0;return E&&(C.r=E,E.p=C),i(C),this.insertId(C),C}toStringName(){return"AbstractRga"}toString(f=""){const m=this.view();let b="";return(0,a.isUint8Array)(m)?b+=` { ${(0,n.printOctets)(m)||"∅"} }`:typeof m=="string"&&(b+=`{ ${m.length>32?JSON.stringify(m.substring(0,32))+" …":JSON.stringify(m)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${b}`+(0,t.printTree)(f,[w=>this.root?this.printChunk(w,this.root):"∅"])}printChunk(f,m){return this.formatChunk(m)+(0,s.printBinary)(f,[m.l?b=>this.printChunk(b,m.l):null,m.r?b=>this.printChunk(b,m.r):null])}formatChunk(f){let b=`chunk ${(0,e.printTs)(f.id)}:${f.span} .${f.len}.`;if(f.del)b+=` [${f.span}]`;else if((0,a.isUint8Array)(f.data))b+=` { ${(0,n.printOctets)(f.data)||"∅"} }`;else if(typeof f.data=="string"){const _=f.data.length>32?JSON.stringify(f.data.substring(0,32))+" …":JSON.stringify(f.data);b+=` { ${_} }`}return b}};return Jr.AbstractRga=y,Jr}var ad;function B1(){if(ad)return $t;ad=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.ArrNode=$t.ArrChunk=void 0;const e=Ja(),a=me(),u=$a(),d=st();class r{constructor(s,n,o){this.id=s,this.span=n,this.len=o?n:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(s){this.data.push(...s),this.span=this.data.length}split(s){const n=this.span;if(this.span=s,!this.del){const i=this.data.splice(s);return new r((0,a.tick)(this.id,s),n-s,i)}return new r((0,a.tick)(this.id,s),n-s,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new r(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}$t.ArrChunk=r;let c=class extends e.AbstractRga{constructor(s,n){super(n),this.doc=s,this._tick=0,this._view=[],this.api=void 0}get(s){const n=this.findChunk(s);if(n)return n[0].data[n[1]]}getNode(s){const n=this.get(s);if(n)return this.doc.index.get(n)}getId(s){const n=this.findChunk(s);if(!n)return;const[o,i]=n,l=o.id;return i?(0,a.tick)(l,i):l}getById(s){const n=this.findById(s);if(!n||n.del)return;const o=s.time-n.id.time;return n.data[o]}upd(s,n){const o=this.findById(s);if(!o)return;const i=o.data;if(!i)return;const l=s.time-o.id.time,p=i[l];if(!(p&&(0,a.compare)(p,n)>=0))return i[l]=n,this.onChange(),p}createChunk(s,n){return new r(s,n?n.length:0,n)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const s=this.doc,n=s.clock.time+s.tick,o=this._view;if(this._tick===n)return o;const i=[],l=s.index;let p=!0;for(let v=this.first();v;v=this.next(v))if(!v.del)for(const y of v.data){const g=l.get(y);if(!g){p=!1;continue}const f=g.view();o[i.length]!==f&&(p=!1),i.push(f)}return o.length!==i.length&&(p=!1),p?o:(this._tick=n,this._view=i)}children(s){const n=this.doc.index;for(let o=this.first();o;o=this.next(o)){const i=o.data;if(!i)continue;const l=i.length;for(let p=0;p<l;p++)s(n.get(i[p]))}}name(){return"arr"}printChunk(s,n){const o=this.pos(n);let i="";if(!n.del){const l=this.doc.index;i=(0,d.printTree)(s,n.data.map(p=>l.get(p)).filter(p=>!!p).map((p,h)=>v=>`[${o+h}]: ${p.toString(v+"    "+" ".repeat(String(h).length))}`))}return this.formatChunk(n)+i+(0,u.printBinary)(s,[n.l?l=>this.printChunk(l,n.l):null,n.r?l=>this.printChunk(l,n.r):null])}};return $t.ArrNode=c,$t}var Ft={},cd;function L1(){if(cd)return Ft;cd=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.BinNode=Ft.BinChunk=void 0;const e=me(),a=Ja();class u{constructor(c,t,s){this.id=c,this.span=t,this.len=s?t:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=s}merge(c){const t=this.data.length,s=new Uint8Array(t+c.length);s.set(this.data),s.set(c,t),this.data=s,this.span=s.length}split(c){if(!this.del){const s=this.data,n=s.subarray(c),o=new u((0,e.tick)(this.id,c),this.span-c,n);return this.data=s.subarray(0,c),this.span=c,o}const t=new u((0,e.tick)(this.id,c),this.span-c,void 0);return this.span=c,t}delete(){this.del=!0,this.data=void 0}clone(){return new u(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Ft.BinChunk=u;let d=class extends a.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const c=new Uint8Array(this.length());let t=0,s=this.first();for(;s;){if(!s.del){const n=s.data;c.set(n,t),t+=n.length}s=this.next(s)}return this._view=c}children(){}child(){}container(){}name(){return"bin"}createChunk(c,t){return new u(c,t?t.length:0,t)}onChange(){this._view=null}toStringName(){return this.name()}};return Ft.BinNode=d,Ft}var Jt={},ld;function $1(){if(ld)return Jt;ld=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.StrNode=Jt.StrChunk=void 0;const e=me(),a=Ja(),u=zh();class d{constructor(t,s,n){this.id=t,this.span=s,this.len=n?s:0,this.del=!n,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=n}merge(t){this.data+=t,this.span=this.data.length}split(t){if(!this.del){const n=new d((0,e.tick)(this.id,t),this.span-t,this.data.slice(t));return this.data=this.data.slice(0,t),this.span=t,n}const s=new d((0,e.tick)(this.id,t),this.span-t,"");return this.span=t,s}delete(){this.del=!0,this.data=""}clone(){return new d(this.id,this.span,this.data)}view(){return this.data}}Jt.StrChunk=d;let r=class extends a.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let t="";for(let s=this.first();s;s=(0,u.next)(s))t+=s.data;return this._view=t}name(){return"str"}createChunk(t,s){return new d(t,s?s.length:0,s||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Jt.StrNode=r,Jt}var ud;function F1(){return ud||(ud=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var a=_s();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return a.ConNode}});var u=Gh();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return u.ValNode}});var d=A1();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return d.RootNode}});var r=j1();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return r.VecNode}});var c=P1();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return c.ObjNode}});var t=B1();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return t.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return t.ArrChunk}});var s=L1();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return s.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return s.BinChunk}});var n=$1();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return n.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return n.StrChunk}})}(go)),go}var dd;function It(){return dd||(dd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(Vm(),e),a.__exportStar(F1(),e)}(bo)),bo}var Wo={},fd;function J1(){return fd||(fd=1,Object.defineProperty(Wo,"__esModule",{value:!0})),Wo}var Ho={},hd;function U1(){return hd||(hd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const a=ne;var u=Fa();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return u.Model}}),a.__exportStar(Fh(),e)}(Ho)),Ho}var pd;function Xi(){return pd||(pd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(It(),e),a.__exportStar(J1(),e),a.__exportStar(U1(),e),a.__exportStar(Ss(),e)}(mo)),mo}var zr={},Gr={},Wr={},md;function z1(){if(md)return Wr;md=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.PropertyLayout=void 0;const e=F(),a=_e(),u=we(),d=({property:r,formal:c,focused:t})=>{const s=(0,a.useTheme)(),n={color:s.g(.1)};return t&&(n.background=s.bg,n.border=`1px solid ${s.g(.9)}`,n.fontWeight="bold",n.margin="-3px",n.padding="2px"),(!r||r.indexOf(" ")!==-1)&&(n.background=s.blue(.1)),e.createElement(e.Fragment,null,e.createElement("span",{className:u.property,style:n},c?JSON.stringify(r):r),e.createElement("span",{className:u.colon,style:{color:s.g(.5)}},e.createElement("span",null,":")))};return Wr.PropertyLayout=d,Wr}var bd;function gt(){if(bd)return Gr;bd=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.JsonCrdtProperty=void 0;const e=F(),a=z1(),u=({node:d})=>!d.parent||d.parent.node.name()!=="obj"?null:e.createElement(a.PropertyLayout,{property:d.step});return Gr.JsonCrdtProperty=u,Gr}var Hr={},Kr={},vd;function G1(){if(vd)return Kr;vd=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.TypeAndId=void 0;const e=F(),a=_e(),u=Xi(),d=(0,a.rule)(Object.assign(Object.assign({},a.theme.font.mono),{fz:"10px",lh:"9px",us:"none",pe:"none"}));return Kr.TypeAndId=e.memo(({node:r,active:c,negative:t,extension:s})=>{const n=(0,a.useTheme)(),o=r.node;let i=o.name();s&&o instanceof u.VecNode&&o.isExt()&&(i=e.createElement("span",{style:{whiteSpace:"nowrap"}},"ext ",e.createElement("span",{style:{color:n.color.sem.brand[1]}},o.ext().name())));const{sid:l,time:p}=o.id;return e.createElement("span",{className:d,style:{color:c?t?n.color.sem.negative[0]:n.color.sem.blue[0]:n.g(0,.5)}},i,e.createElement("span",{style:{color:c?n.g(0,.45):n.g(0,.2),display:"block"}},c?(l>999?"...":"")+String(l).slice(String(l).length-4):null,e.createElement("span",{style:{color:c?n.g(0,.7):n.g(0,.3)}},"."+p)))}),Kr}var ht={},gd;function yt(){if(gd)return ht;gd=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.isContainer=ht.createValue=ht.id=void 0;const e=d=>{const r=d.node.id;return r.sid+"."+r.time};ht.id=e;const a=(d,r,c,t)=>{let s=r;try{s=JSON.parse(r)}catch{}const n=d.api,o=n.builder,i=c==="any"?t?o.constOrJson(s):o.json(s):c==="con"?n.builder.const(s):c==="vec"?n.builder.vec():c==="val"?n.builder.val():n.builder.const(void 0);if(c==="vec"){if(r){const l=Array.isArray(s)?s:[s];o.insVec(i,l.map((p,h)=>[h,n.builder.maybeConst(p)]))}}else c==="val"&&o.setVal(i,r?n.builder.maybeConst(s):n.builder.const(void 0));return i};ht.createValue=a;const u=d=>!!d&&typeof d=="object";return ht.isContainer=u,ht}var Xr={},yd;function W1(){if(yd)return Xr;yd=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.JsonCrdtRegionEdit=void 0;const e=F(),a=gt(),u=Pa(),d=ys(),r=ja(),c=xe(),t=yt(),s=Xe(),n=({node:o,onCancel:i})=>{const{compact:l}=(0,c.useStyles)(),{model:p}=(0,s.useJsonCrdt)(),h=(g,f)=>{const m=o.parent;if(m&&m.node.name()==="obj"){const b=(0,t.createValue)(p,g,f,!0);p.api.wrap(m.node).set({[o.step]:b})}else if(m&&(m.node.name()==="val"||m.node.name()==="root")){const b=(0,t.createValue)(p,g,f,!0);p.api.wrap(m.node).set(b)}else if(m&&m.node.name()==="vec"){const b=(0,t.createValue)(p,g,f,!0);p.api.wrap(m.node).set([[+o.step,b]])}i&&i()},v=o.node.view(),y=(0,t.isContainer)(v)?"":JSON.stringify(v);return e.createElement(r.FocusRegion,{compact:l},e.createElement(a.JsonCrdtProperty,{node:o}),e.createElement("span",{style:{display:"inline-block",margin:"-3px 0",position:"relative"}},e.createElement(u.ValueInput,{focus:!0,withType:!0,visible:!0,initialType:o.node.name()==="con"&&o.node.view()!==void 0?"con":"any",initialValue:y,onSubmit:h,onCancel:i}),!!i&&e.createElement(d.CancelAction,{onClick:()=>i()})))};return Xr.JsonCrdtRegionEdit=n,Xr}var _d;function Nt(){if(_d)return Hr;_d=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.JsonCrdtRegion=void 0;const e=F(),a=ja(),u=Ke(),d=xe(),r=Xe(),c=G1(),t=yt(),s=W1(),n=i=>!i.parent||i.node.name()!=="con"?!1:i.node.val===void 0,o=({node:i,editing:l,extension:p,toolbar:h,children:v})=>{var y;const{model:g}=(0,r.useJsonCrdt)(),{compact:f,readonly:m}=(0,d.useStyles)(),{focused:b,focus:_,pointed:w,point:C}=(0,u.useFocus)(),E=(0,t.id)(i),[O,S]=e.useState(!1),x=U=>{U.stopPropagation(),w!==E&&C(E)},I=U=>{U.preventDefault(),U.stopPropagation(),C(E)},N=()=>{C("")},R=U=>{U.preventDefault(),U.stopPropagation(),_(E)},M=b===E,T=w===E,j=(y=i.parent)===null||y===void 0?void 0:y.node.name(),D=n(i),G=j==="obj",z=j==="arr",W=j==="vec",Z=M?e.createElement("span",{style:{display:"inline-block",margin:"-4px 0 0"}},e.createElement(c.TypeAndId,{node:i,active:M,negative:D,extension:p})):void 0;return O?e.createElement(s.JsonCrdtRegionEdit,{node:i,onCancel:()=>S(!1)}):e.createElement(a.FocusRegion,{pointed:T,focused:M,compact:f,negative:D,aside:Z,toolbar:h,onClick:R,onMouseMove:x,onMouseEnter:I,onMouseLeave:N,onDelete:l||m||!M||D?void 0:G?()=>{g.api.wrap(i.parent.node).del([i.step])}:z?()=>{g.api.wrap(i.parent.node).del(+i.step,1)}:W?()=>{g.api.wrap(i.parent.node).set([[+i.step,void 0]])}:j==="val"&&!D?()=>{g.api.wrap(i.parent.node).set(void 0)}:void 0,onEdit:l||m?void 0:M&&(j==="obj"||j==="val"||j==="root"||j==="vec")?()=>S(!0):void 0},v)};return Hr.JsonCrdtRegion=o,Hr}var Yr={},wd;function Wh(){if(wd)return Yr;wd=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.JsonCrdtConstant=void 0;const e=F(),a=pn(),u=Oh(),d=Ke(),r=({id:c,view:t})=>{const{focus:s}=(0,d.useFocus)(),[n,o]=e.useState(!1),i=()=>{t&&typeof t=="object"&&o(!n)};return n?e.createElement("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"}},e.createElement(u.ClickableJson,{readonly:!0,compact:!0,noCollapseToggles:!0,pfx:c,doc:t,onFocus:l=>{l!==null&&s(c)}})):e.createElement(a.JsonAtom,{value:t,onClick:i})};return Yr.JsonCrdtConstant=r,Yr}var Cd;function H1(){if(Cd)return zr;Cd=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.JsonCrdtConNode=void 0;const e=F(),a=gt(),u=Nt(),d=xe(),r=yt(),c=Wh(),t=({node:s})=>{const{formal:n}=(0,d.useStyles)();return e.createElement(u.JsonCrdtRegion,{node:s},e.createElement(a.JsonCrdtProperty,{node:s}),e.createElement(c.JsonCrdtConstant,{id:(0,r.id)(s),view:s.node.view()}),!!n&&",")};return zr.JsonCrdtConNode=t,zr}var Qr={},Zr={},Sd;function Yi(){if(Sd)return Zr;Sd=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.JsonCrdtObjectLayout=void 0;const e=ne,a=F(),u=Sh(),d=xe(),r=Ke(),c=yt(),t=s=>{var{node:n}=s,o=e.__rest(s,["node"]);const{collapsed:i}=(0,d.useStyles)(),{focused:l}=(0,r.useFocus)(),[p,h]=a.useState(i),v=()=>{!p&&(0,c.id)(n)===l&&h(!0)};return a.createElement(u.ObjectLayout,Object.assign({collapsed:p,onCollapserClick:()=>h(!p),onBracketClick:v,onCollapsedClick:()=>{p&&h(!1)}},o))};return Zr.JsonCrdtObjectLayout=t,Zr}var Ko={},Ed;function Qi(){return Ed||(Ed=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useRerenderModel=e.useRerender=e.useNodeApi=void 0;const a=F(),u=Xe(),d=t=>{const{model:s}=(0,u.useJsonCrdt)();return s.api.wrap(t.node)};e.useNodeApi=d;const r=t=>{const s=(0,e.useNodeApi)(t).events;return a.useSyncExternalStore(s.subscribe,s.getSnapshot)};e.useRerender=r;const c=()=>{const{model:t}=(0,u.useJsonCrdt)(),s=t.api;a.useSyncExternalStore(s.subscribe,()=>t.tick)};e.useRerenderModel=c}(Ko)),Ko}var Od;function K1(){if(Od)return Qr;Od=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.JsonCrdtValNode=void 0;const e=F(),a=we(),u=Ki(),d=Xe(),r=Nt(),c=gt(),t=Yi(),s=pn(),n=Qi(),o=({node:i})=>{const{render:l}=(0,d.useJsonCrdt)();(0,n.useRerenderModel)();const p=i.node.node();if(!p)return null;const h=(0,u.nodeRef)(p,i,"");if(!h)return null;const v=e.createElement("span",{className:a.line},l(h));let y="…";if(p.name()==="con"){const g=p.view();y=e.createElement(s.JsonAtom,{value:g})}return e.createElement(r.JsonCrdtRegion,{node:i},e.createElement(t.JsonCrdtObjectLayout,{node:i,property:e.createElement(c.JsonCrdtProperty,{node:i}),collapsedView:y,brackets:["(",")"]},v))};return Qr.JsonCrdtValNode=o,Qr}var ei={},ti={},xd;function X1(){if(xd)return ti;xd=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.AddKey=void 0;const e=F(),a=Ch(),u=Ke(),d=yt(),r=Xe(),c=({node:t})=>{const{model:s}=(0,r.useJsonCrdt)(),n=(0,u.useIsFocused)((0,d.id)(t)),o=e.useCallback((i,l,p)=>{const h=(0,d.createValue)(s,l,p,!0);s.api.wrap(t.node).set({[i]:h})},[t.node]);return e.createElement(a.ObjectInsert,{withType:!0,visible:n,onSubmit:o})};return ti.AddKey=c,ti}var ni={},ri={},Rd;function Y1(){if(Rd)return ri;Rd=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.MiniTitle=void 0;const e=F(),a=_e(),u=(0,a.rule)({...a.theme.font.sans.bold,fz:"10px",textTransform:"uppercase",col:a.theme.g(.5),pad:0,mar:0}),d=({component:r="span",style:c,onClick:t,children:s})=>e.createElement(r,{className:u,style:c,onClick:t,children:s});return ri.MiniTitle=d,ri}var Id;function Q1(){if(Id)return ni;Id=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.Tombstones=void 0;const e=F(),a=_e(),u=Rt(),d=Y1(),r=(0,a.rule)({d:"block",bxz:"border-box",pd:"0 4px 4px 16px",bdrad:"8px",mr:"4px 0 0 -16px",w:"calc(100% + 16px)",bg:a.theme.red(.05)}),c=(0,a.rule)({d:"block",w:"100%",bxz:"border-box",pd:"4px 8px 3px 3px",cur:"default",us:"none"}),t=({tombstones:s})=>{const[n,o]=e.useState(!1),[i]=(0,u.useT)();return s.length?e.createElement("span",{className:r},e.createElement("style",{className:c,onClick:()=>o(l=>!l)},e.createElement(d.MiniTitle,{style:{fontSize:"0.65em",color:a.theme.red(.75)}},s.length+" "+(s.length===1?i("tombstone"):i("tombstones")))),n&&s):null};return ni.Tombstones=t,ni}var Nd;function Z1(){if(Nd)return ei;Nd=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.JsonCrdtObjNode=void 0;const e=F(),a=Xi(),u=we(),d=Xe(),r=Ki(),c=Nt(),t=gt(),s=Yi(),n=Qi(),o=X1(),i=Q1(),l=xe(),p=v=>v instanceof a.ConNode&&v.val===void 0,h=({node:v})=>{const{readonly:y}=(0,l.useStyles)(),{render:g}=(0,d.useJsonCrdt)();(0,n.useRerender)(v);const f=[],m=[];return v.node.nodes((b,_)=>{if(!b)return;const w=(0,r.nodeRef)(b,v,_);if(!w)return;const C=e.createElement("span",{key:_,className:u.line},g(w));p(b)?m.push(C):f.push(C)}),e.createElement(c.JsonCrdtRegion,{node:v},e.createElement(s.JsonCrdtObjectLayout,{node:v,property:e.createElement(t.JsonCrdtProperty,{node:v}),collapsedView:!!f.length&&f.length},f,!y&&e.createElement(o.AddKey,{node:v}),!!m.length&&e.createElement(i.Tombstones,{tombstones:m})))};return ei.JsonCrdtObjNode=h,ei}var ii={},si={},kd;function eb(){if(kd)return si;kd=1,Object.defineProperty(si,"__esModule",{value:!0}),si.PushElement=void 0;const e=F(),a=Ma(),u=Ke(),d=yt(),r=Xe(),c=({node:t})=>{const{model:s}=(0,r.useJsonCrdt)(),n=(0,u.useIsFocused)((0,d.id)(t)),o=e.useCallback((i,l)=>{const p=(0,d.createValue)(s,i,l,!0),h=s.api.wrap(t.node);h.set([[h.view().length,p]])},[t.node]);return e.createElement(a.ArrayInsert,{withType:!0,visible:n,onSubmit:o})};return si.PushElement=c,si}var oi={},ai={},Ad;function Hh(){if(Ad)return ai;Ad=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.SwitchAction=void 0;const e=F(),a=_e(),u=we(),d=Hi(),r=(0,a.drule)({w:"20px",h:"20px",bdrad:"50%",svg:{fill:u.blue}}),c=t=>e.createElement(d.Action,Object.assign({},t,{className:r()}),"~");return ai.SwitchAction=c,ai}var Td;function tb(){if(Td)return oi;Td=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.JsonCrdtExtNode=void 0;const e=F(),a=Rt(),u=Nt(),d=gt(),r=Yi(),c=Qi(),t=Wh(),s=yt(),n=pn(),o=Hh(),i=({node:l,onViewChange:p})=>{const[h]=(0,a.useT)();(0,c.useRerenderModel)();const y=l.node.view();return e.createElement(u.JsonCrdtRegion,{node:l,extension:!0,toolbar:e.createElement(o.SwitchAction,{onClick:p,tooltip:h('Show "vec" node')})},e.createElement(r.JsonCrdtObjectLayout,{node:l,property:e.createElement(d.JsonCrdtProperty,{node:l}),collapsedView:e.createElement(n.JsonAtom,{value:y}),brackets:["(",")"]},e.createElement(t.JsonCrdtConstant,{id:(0,s.id)(l),view:y})))};return oi.JsonCrdtExtNode=i,oi}var jd;function nb(){if(jd)return ii;jd=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.JsonCrdtVecNode=void 0;const e=F(),a=Rt(),u=we(),d=Xe(),r=Ki(),c=Nt(),t=gt(),s=Yi(),n=Qi(),o=eb(),i=xe(),l=tb(),p=Hh(),h=({node:v})=>{const[y]=(0,a.useT)(),[g,f]=e.useState(!1),{readonly:m}=(0,i.useStyles)(),{render:b}=(0,d.useJsonCrdt)();(0,n.useRerenderModel)();const _=v.node.isExt();if(_&&!g)return e.createElement(l.JsonCrdtExtNode,{node:v,onViewChange:()=>f(!0)});const w=[];let C=0;return v.node.children(E=>{if(!E)return;const O=(0,r.nodeRef)(E,v,String(C));O&&(w.push(e.createElement("span",{key:E.id.sid+"."+E.id.time,className:u.line},b(O))),C++)}),e.createElement(c.JsonCrdtRegion,{node:v,toolbar:_?e.createElement(p.SwitchAction,{onClick:()=>f(!1),tooltip:y('Show "ext" view')}):void 0},e.createElement(s.JsonCrdtObjectLayout,{node:v,property:e.createElement(t.JsonCrdtProperty,{node:v}),collapsedView:!!w.length&&w.length,brackets:["[","]"],header:e.createElement("span",{style:{opacity:.5,display:"inline-block",margin:"0.25em 0 0 -0.3em"}},"→")},w,!m&&e.createElement(o.PushElement,{node:v})))};return ii.JsonCrdtVecNode=h,ii}var ci={},li={},Pd;function rb(){if(Pd)return li;Pd=1,Object.defineProperty(li,"__esModule",{value:!0}),li.InsertElement=void 0;const e=F(),a=Ma(),u=Ke(),d=yt(),r=Xe(),c=({node:t,index:s})=>{const{model:n}=(0,r.useJsonCrdt)(),o=(0,u.useIsFocused)((0,d.id)(t)),i=e.useCallback((l,p)=>{const h=(0,d.createValue)(n,l,p);n.api.wrap(t.node).ins(s,[h])},[t.node]);return e.createElement(a.ArrayInsert,{withType:!0,visible:o,onSubmit:i})};return li.InsertElement=c,li}var Md;function ib(){if(Md)return ci;Md=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.JsonCrdtArrNode=void 0;const e=F(),a=we(),u=Xe(),d=Ki(),r=Nt(),c=gt(),t=Yi(),s=Qi(),n=rb(),o=xe(),i=({node:l})=>{const{readonly:p}=(0,o.useStyles)(),{render:h}=(0,u.useJsonCrdt)();(0,s.useRerender)(l);const v=[];let y=0;return l.node.children(g=>{if(!g)return;const f=(0,d.nodeRef)(g,l,String(y));if(!f)return;f.step=String(y);const m=g.id.sid+"."+g.id.time+"."+y;v.push(e.createElement(e.Fragment,{key:m},!p&&e.createElement(n.InsertElement,{key:m,node:l,index:y}),e.createElement("span",{className:a.line},h(f)))),y++}),e.createElement(r.JsonCrdtRegion,{node:l},e.createElement(t.JsonCrdtObjectLayout,{node:l,property:e.createElement(c.JsonCrdtProperty,{node:l}),collapsedView:!!v.length&&v.length,brackets:["[","]"]},v,!p&&e.createElement(n.InsertElement,{key:l.node.length(),node:l,index:l.node.length()})))};return ci.JsonCrdtArrNode=i,ci}var ui={},di={},fi={},Xo={},Yo={},qd;function sb(){return qd||(qd=1,Object.defineProperty(Yo,"__esModule",{value:!0})),Yo}var hi={},Dd;function Kh(){if(Dd)return hi;Dd=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.Selection=void 0;let e=class{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}};return hi.Selection=e,hi}var pi={},Ut={},Vd;function Bd(){if(Vd)return Ut;Vd=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.invokeFirstOnly=Ut.applyChange=void 0;const e=(u,d,r,c)=>u.slice(0,d)+c+u.slice(d+r);Ut.applyChange=e;const a=()=>{let u=!1;return d=>{if(!u){u=!0;try{d()}finally{u=!1}}}};return Ut.invokeFirstOnly=a,Ut}var Ld;function ob(){if(Ld)return pi;Ld=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.StrBinding=void 0;const e=Bd(),a=Kh(),u=Bd(),d=Es();let r=class{constructor(t,s){this.str=t,this.editor=s,this.race=(0,e.invokeFirstOnly)(),this.onModelChange=()=>{this.race(()=>{this.syncFromModel(),this.saveSelection()})},this.onchange=(n,o)=>{this.race(()=>{if(n instanceof Array&&n.length>0){const i=this.str();if(!i)return;let l=!0;if(o){let p=this.view;for(let v=0;v<length;v++){const y=n[v],[g,f,m]=y;p=(0,u.applyChange)(p,g,f,m)}const h=this.editor;h.getLength&&p.length!==h.getLength()||p!==h.get()?l=!1:this.view=p}if(l){const p=n.length;try{i.api.transaction(()=>{let h=this.view;for(let v=0;v<p;v++){const y=n[v],[g,f,m]=y;h=(0,u.applyChange)(h,g,f,m),f&&i.del(g,f),m&&i.ins(g,m)}this.view=h}),this.saveSelection();return}catch{}}}this.syncFromEditor()})},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout(()=>{this.race(()=>{try{const n=this.view,o=this.editor;((o.getLength?n.length!==o.getLength():!1)||n!==o.get())&&this.syncFromEditor()}catch{}this._p&&this.pollChanges()})},this.pollingInterval)},this._s=null,this.bind=n=>{this.syncFromModel();const o=this.editor;o.onchange=this.onchange,o.onselection=()=>this.saveSelection(),n&&this.pollChanges(),this._s=this.str().api.onChange.listen(this.onModelChange)},this.unbind=()=>{var n,o,i;this.stopPolling(),(n=this._s)===null||n===void 0||n.call(this),(i=(o=this.editor).dispose)===null||i===void 0||i.call(o)},this.view=t().view(),s.selection=this.selection=new a.Selection}saveSelection(){var t,s,n;const{editor:o,selection:i}=this,l=this.str();if(!l)return;const[p,h,v]=((t=o.getSelection)===null||t===void 0?void 0:t.call(o))||[-1,-1,0],{start:y,end:g}=i,f=Date.now(),m=l.api.model.tick;y===p&&g===h&&(m===i.tick||f-i.ts<3e3)||(i.start=p,i.end=h,i.dir=v,i.ts=f,i.tick=m,i.startId=typeof p=="number"&&(s=l.findId((p??0)-1))!==null&&s!==void 0?s:null,i.endId=typeof h=="number"&&(n=l.findId((h??0)-1))!==null&&n!==void 0?n:null)}syncFromModel(){const t=this.editor,s=this.str();if(!s)return;const n=(this.view=s.view())||"";if(t.ins&&t.del){const o=t.get();if(n===o)return;const i=(0,d.diff)(o,n),l=i.length;let p=0;for(let h=0;h<l;h++){const v=i[h],[y,g]=v,f=g.length;switch(y){case-1:t.del(p,f);break;case 0:p+=f;break;case 1:t.ins(p,g),p+=f;break}}}else{t.set(n);const{selection:o}=this;if(t.setSelection){const i=o.startId?s.findPos(o.startId)+1:-1,l=o.endId?s.findPos(o.endId)+1:-1;t.setSelection(i,l,o.dir)}}}syncFromEditor(){var t;let s=this.view;const n=this.editor.get();if(n===s)return;const o=this.selection,i=o.start===o.end&&(t=o.start)!==null&&t!==void 0?t:void 0,l=(0,d.diffEdit)(s,n,i||0),p=l.length,h=this.str();h&&(h.api.transaction(()=>{let v=0;for(let y=0;y<p;y++){const g=l[y],[f,m]=g;switch(f){case-1:{s=(0,u.applyChange)(s,v,m.length,""),h.del(v,m.length);break}case 0:{v+=m.length;break}case 1:{s=(0,u.applyChange)(s,v,0,m),h.ins(v,m),v+=m.length;break}}}}),this.view=s,this.saveSelection())}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}};return pi.StrBinding=r,r.bind=(c,t,s)=>{const n=new r(c,t);return n.syncFromModel(),n.bind(s),n.unbind},pi}var $d;function ab(){return $d||($d=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(sb(),e),a.__exportStar(Kh(),e),a.__exportStar(ob(),e)}(Xo)),Xo}var mi={},Fd;function cb(){if(Fd)return mi;Fd=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.InputEditor=void 0;let e=class{constructor(u,d){this.str=u,this.input=d,this.onInput=r=>{this.emitChange(r)},this.onSelectionChange=()=>{this.onselection()},d.addEventListener("input",this.onInput),document.addEventListener("selectionchange",this.onSelectionChange)}get(){return this.input.value}getLength(){return this.input.value.length}set(u){this.input.value=u}ins(u,d){const r=this.getSelection(),c=this.get(),t=c.slice(0,u)+d+c.slice(u);if(this.set(t),r){let[s,n]=r;const o=d.length;s>=u&&(s+=o),n>u&&(n+=o),this.setSelection(s,n,r[2])}}del(u,d){const r=this.getSelection(),c=this.get(),t=c.slice(0,u)+c.slice(u+d);if(this.set(t),r){let[s,n]=r;s>=u&&(s=Math.max(u,s-d)),n>=u&&(n=Math.max(u,n-d)),this.setSelection(s,n,r[2])}}getSelection(){const u=this.input,{selectionStart:d,selectionEnd:r,selectionDirection:c}=u;return[typeof d=="number"?d:-1,typeof r=="number"?r:-1,c==="backward"?-1:c==="forward"?1:0]}setSelection(u,d,r){const c=this.input;c.selectionStart=u>-1?u:null,c.selectionEnd=d>-1?d:null,c.selectionDirection=r===-1?"backward":r===1?"forward":"none"}emitChange(u){var d,r;if(!u.isComposing){switch(u.inputType){case"insertText":{const c=u.data;if(!c||c.length!==1)break;const{selectionStart:t,selectionEnd:s}=this.input;if(t===null||s===null||t!==s||t<=0)break;const n=this.selection;if(t-c.length!==n.start||typeof n.end!="number"||typeof n.end!="number")break;const o=n.end-n.start,i=[n.start,o,c];this.onchange([i]);return}case"deleteContentBackward":{const{start:c,end:t}=this.selection;if(typeof c!="number"||typeof t!="number")break;const s=c===t?[c-1,1,""]:[c,t-c,""];this.onchange([s]);return}case"deleteContentForward":{const{start:c,end:t}=this.selection;if(typeof c!="number"||typeof t!="number")break;const s=c===t?[c,1,""]:[c,t-c,""];this.onchange([s]);return}case"deleteByCut":{const{start:c,end:t}=this.selection;if(typeof c!="number"||typeof t!="number"||c===t)break;const s=Math.min(c,t),n=Math.max(c,t),o=this.str().view(),l=this.input.value;if(o.length-l.length!==n-s)break;const p=[s,n-s,""];this.onchange([p]);return}case"insertFromPaste":{const{start:c,end:t}=this.selection;if(typeof c!="number"||typeof t!="number")break;const s=Math.min(c,t),n=Math.max(c,t),o=this.str().view(),i=this.input,l=i.value,p=Math.max((d=i.selectionStart)!==null&&d!==void 0?d:0,(r=i.selectionEnd)!==null&&r!==void 0?r:0);if(p<=s)break;const h=n-s,v=l.slice(s,p);if(l.length!==o.length-h+v.length)return;const y=[s,h,v];this.onchange([y]);return}}this.onchange()}}dispose(){this.input.removeEventListener("input",this.onInput),document.removeEventListener("selectionchange",this.onSelectionChange)}};return mi.InputEditor=e,mi}var Jd;function lb(){if(Jd)return fi;Jd=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.bind=void 0;const e=ab(),a=cb(),u=(d,r,c)=>{const t=new a.InputEditor(d,r),s=new e.StrBinding(d,t);return s.syncFromModel(),s.bind(c),s.unbind};return fi.bind=u,fi}var bi={},Ud;function ub(){if(Ud)return bi;Ud=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.SubmitAction=void 0;const e=F(),a=Hi(),u=d=>e.createElement(a.Action,Object.assign({},d),"→");return bi.SubmitAction=u,bi}var zd;function db(){if(zd)return di;zd=1,Object.defineProperty(di,"__esModule",{value:!0}),di.StrEdit=void 0;const e=F(),a=_e(),u=lb(),d=Wi(),r=Rt(),c=we(),t=Ta(),s=gs(),n=ys(),o=ub(),i=Xe(),l=({node:p,onCancel:h,onDone:v})=>{const[y]=(0,r.useT)(),g=e.useRef(),{model:f}=(0,i.useJsonCrdt)(),[m,b]=e.useMemo(()=>{const E=f.clone();E.api.flush();const O=E.index.get(p.node.id),S=E.api.wrap(O);return[E,S]},[]),_=e.useSyncExternalStore(b.events.subscribe,b.events.getSnapshot);e.useEffect(()=>{if(!g.current)return;const E=(0,u.bind)(()=>b,g.current);return()=>{E()}},[f]);const w=()=>{if(!!m.api.builder.patch.ops.length){const O=m.api.flush();f.applyLocalPatch(O)}v()},C=(0,s.inputStyle)(a.theme,!a.theme.isLight,'""');return C.margin="-3px -3px -3px -5px",C.padding="2px 4px",C.border=`1px solid ${a.theme.g(.85)}`,e.createElement("span",{className:c.input,style:C},e.createElement(d.FlexibleInput,{focus:!0,inp:E=>{g.current=E},value:_,multiline:!0,uncontrolled:!0,typebefore:'"',typeahead:'"',maxWidth:800,onSubmit:w,onFocus:E=>(0,t.selectOnFocus)(E.target),onCancel:()=>{h&&h()}}),e.createElement(n.CancelAction,{onClick:h,tooltip:y("Cancel")}),e.createElement("span",{className:c.bottomRightActionPos},e.createElement(o.SubmitAction,{onClick:w,tooltip:y("Done (Ctrl + Enter)")})))};return di.StrEdit=l,di}var Gd;function fb(){if(Gd)return ui;Gd=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.JsonCrdtStrNode=void 0;const e=F(),a=_e(),u=Rt(),d=Nt(),r=gt(),c=pn(),t=xe(),s=Ke(),n=yt(),o=we(),i=db(),l=(0,a.rule)({d:"inline-block",pos:"relative",cur:"pointer",bdrad:"2px"}),p=(0,a.rule)({out:"1px dotted transparent","&:hover":{out:`1px dotted ${a.theme.color.sem.blue[0]}`},[`&:hover .${o.tooltip.trim()}`]:{d:"inline-block"}}),h=({node:v})=>{const[y]=(0,u.useT)(),{formal:g,readonly:f}=(0,t.useStyles)(),{focused:m}=(0,s.useFocus)(),[b,_]=e.useState(!1),w=m===(0,n.id)(v);return e.createElement(d.JsonCrdtRegion,{node:v,editing:b},e.createElement(r.JsonCrdtProperty,{node:v}),b?e.createElement(i.StrEdit,{node:v,onCancel:()=>_(!1),onDone:()=>_(!1)}):e.createElement("span",{className:l+(w&&!f?p:""),onClick:w&&!f?()=>_(!0):void 0},e.createElement(c.JsonAtom,{value:v.node.view()}),!f&&e.createElement("span",{className:o.tooltip},y("Edit"))),!!g&&",")};return ui.JsonCrdtStrNode=h,ui}var vi={},Wd;function hb(){if(Wd)return vi;Wd=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.JsonCrdtBinNode=void 0;const e=F(),a=Nt(),u=gt(),d=pn(),r=xe(),c=({node:t})=>{const{formal:s}=(0,r.useStyles)();return e.createElement(a.JsonCrdtRegion,{node:t},e.createElement(u.JsonCrdtProperty,{node:t}),e.createElement(d.JsonAtom,{value:t.node.view()}),!!s&&",")};return vi.JsonCrdtBinNode=c,vi}var Hd;function pb(){if(Hd)return Qn;Hd=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.ClickableJsonCrdt=void 0;const e=F(),a=Xe(),u=xe(),d=Ki(),r=Eh(),c=Ke(),t=Xi(),s=H1(),n=K1(),o=Z1(),i=nb(),l=ib(),p=fb(),h=hb(),v=g=>g.node instanceof t.ConNode?e.createElement(s.JsonCrdtConNode,{node:g}):g.node instanceof t.ValNode?e.createElement(n.JsonCrdtValNode,{node:g}):g.node instanceof t.ObjNode?e.createElement(o.JsonCrdtObjNode,{node:g}):g.node instanceof t.StrNode?e.createElement(p.JsonCrdtStrNode,{node:g}):g.node instanceof t.VecNode?e.createElement(i.JsonCrdtVecNode,{node:g}):g.node instanceof t.ArrNode?e.createElement(l.JsonCrdtArrNode,{node:g}):g.node instanceof t.BinNode?e.createElement(h.JsonCrdtBinNode,{node:g}):"∅",y=g=>{const{model:f,compact:m,readonly:b,showRoot:_,onFocus:w}=g,[C,E]=e.useState(0);e.useEffect(()=>{const S=f.api.onReset.listen(()=>E(x=>x+1));return()=>S()},[f]);const O=e.useMemo(()=>(0,d.nodeRef)(_?f.root:f.root.node(),null,""),[f,C]);return e.createElement(u.context.Provider,{value:{compact:m,readonly:b}},e.createElement(a.context.Provider,{value:{model:f,render:v}},e.createElement(c.FocusProvider,{onFocus:w},!!O&&e.createElement(r.Root,{key:C},v(O)))))};return Qn.ClickableJsonCrdt=y,Qn}var Kd;function mb(){return Kd||(Kd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(Oh(),e),a.__exportStar(pb(),e)}(Ps)),Ps}var bb=mb(),Qo={},Be={},Zo={},Xd;function vb(){return Xd||(Xd=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useColumnWidths=e.getColumnWidths=void 0;const a=F(),u=(r,c)=>{const t=c.map(({basis:n,minWidth:o,maxWidth:i})=>({basis:n,minWidth:o,maxWidth:i,size:n,violation:0,frozen:!1,factor:0}));let s=t.reduce((n,o)=>n-o.size,r);s>0?c.forEach(({grow:n},o)=>{t[o].factor=n}):s<0&&c.forEach(({shrink:n},o)=>{t[o].factor=n});for(const n of t)n.factor===0&&(n.frozen=!0);for(;t.some(({frozen:n})=>!n);){const n=t.reduce((i,l)=>i+(l.frozen?0:l.factor),0);let o=0;for(const i of t)i.frozen||(i.size+=s*i.factor/n,i.size<i.minWidth?i.violation=i.minWidth-i.size:i.maxWidth!==void 0&&i.size>i.maxWidth?i.violation=i.maxWidth-i.size:i.violation=0,i.size+=i.violation,o+=i.violation);if(o>0)for(const i of t)i.violation>0&&(i.frozen=!0);else if(o<0)for(const i of t)i.violation<0&&(i.frozen=!0);else break;s=t.reduce((i,l)=>i-l.size,r)}return t.map(({size:n})=>n)};e.getColumnWidths=u;const d=(r,c)=>{const t=r.map(({basis:s,minWidth:n,maxWidth:o,grow:i,shrink:l})=>[s,n,o,i,l].join(",")).join("|");return(0,a.useMemo)(()=>{if(c===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const s=(0,e.getColumnWidths)(c,r);let n=0;const o=s.map((i,l)=>(n+=i,l===s.length-1?1/0:n));return{fullWidth:Math.abs(c-n)<.1,columnWidths:s,columnRights:o,totalWidth:n}},[c,t])};e.useColumnWidths=d}(Zo)),Zo}var ha=function(e,a){return ha=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var r in d)Object.prototype.hasOwnProperty.call(d,r)&&(u[r]=d[r])},ha(e,a)};function Xh(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");ha(e,a);function u(){this.constructor=e}e.prototype=a===null?Object.create(a):(u.prototype=a.prototype,new u)}var un=function(){return un=Object.assign||function(a){for(var u,d=1,r=arguments.length;d<r;d++){u=arguments[d];for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(a[c]=u[c])}return a},un.apply(this,arguments)};function Yh(e,a){var u={};for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&a.indexOf(d)<0&&(u[d]=e[d]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,d=Object.getOwnPropertySymbols(e);r<d.length;r++)a.indexOf(d[r])<0&&Object.prototype.propertyIsEnumerable.call(e,d[r])&&(u[d[r]]=e[d[r]]);return u}var us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Te.global<"u"?Te.global:typeof self<"u"?self:{};function gb(e){var a=typeof e;return e!=null&&(a=="object"||a=="function")}var Ua=gb,yb=typeof us=="object"&&us&&us.Object===Object&&us,_b=yb,wb=_b,Cb=typeof self=="object"&&self&&self.Object===Object&&self,Sb=wb||Cb||Function("return this")(),Qh=Sb,Eb=Qh,Ob=function(){return Eb.Date.now()},xb=Ob,Rb=/\s/;function Ib(e){for(var a=e.length;a--&&Rb.test(e.charAt(a)););return a}var Nb=Ib,kb=Nb,Ab=/^\s+/;function Tb(e){return e&&e.slice(0,kb(e)+1).replace(Ab,"")}var jb=Tb,Pb=Qh,Mb=Pb.Symbol,Zh=Mb,Yd=Zh,ep=Object.prototype,qb=ep.hasOwnProperty,Db=ep.toString,gi=Yd?Yd.toStringTag:void 0;function Vb(e){var a=qb.call(e,gi),u=e[gi];try{e[gi]=void 0;var d=!0}catch{}var r=Db.call(e);return d&&(a?e[gi]=u:delete e[gi]),r}var Bb=Vb,Lb=Object.prototype,$b=Lb.toString;function Fb(e){return $b.call(e)}var Jb=Fb,Qd=Zh,Ub=Bb,zb=Jb,Gb="[object Null]",Wb="[object Undefined]",Zd=Qd?Qd.toStringTag:void 0;function Hb(e){return e==null?e===void 0?Wb:Gb:Zd&&Zd in Object(e)?Ub(e):zb(e)}var Kb=Hb;function Xb(e){return e!=null&&typeof e=="object"}var Yb=Xb,Qb=Kb,Zb=Yb,ev="[object Symbol]";function tv(e){return typeof e=="symbol"||Zb(e)&&Qb(e)==ev}var nv=tv,rv=jb,ef=Ua,iv=nv,tf=NaN,sv=/^[-+]0x[0-9a-f]+$/i,ov=/^0b[01]+$/i,av=/^0o[0-7]+$/i,cv=parseInt;function lv(e){if(typeof e=="number")return e;if(iv(e))return tf;if(ef(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=ef(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=rv(e);var u=ov.test(e);return u||av.test(e)?cv(e.slice(2),u?2:8):sv.test(e)?tf:+e}var uv=lv,dv=Ua,ea=xb,nf=uv,fv="Expected a function",hv=Math.max,pv=Math.min;function mv(e,a,u){var d,r,c,t,s,n,o=0,i=!1,l=!1,p=!0;if(typeof e!="function")throw new TypeError(fv);a=nf(a)||0,dv(u)&&(i=!!u.leading,l="maxWait"in u,c=l?hv(nf(u.maxWait)||0,a):c,p="trailing"in u?!!u.trailing:p);function h(C){var E=d,O=r;return d=r=void 0,o=C,t=e.apply(O,E),t}function v(C){return o=C,s=setTimeout(f,a),i?h(C):t}function y(C){var E=C-n,O=C-o,S=a-E;return l?pv(S,c-O):S}function g(C){var E=C-n,O=C-o;return n===void 0||E>=a||E<0||l&&O>=c}function f(){var C=ea();if(g(C))return m(C);s=setTimeout(f,y(C))}function m(C){return s=void 0,p&&d?h(C):(d=r=void 0,t)}function b(){s!==void 0&&clearTimeout(s),o=0,d=n=r=s=void 0}function _(){return s===void 0?t:m(ea())}function w(){var C=ea(),E=g(C);if(d=arguments,r=this,n=C,E){if(s===void 0)return v(n);if(l)return clearTimeout(s),s=setTimeout(f,a),h(n)}return s===void 0&&(s=setTimeout(f,a)),t}return w.cancel=b,w.flush=_,w}var tp=mv,bv=tp,vv=Ua,gv="Expected a function";function yv(e,a,u){var d=!0,r=!0;if(typeof e!="function")throw new TypeError(gv);return vv(u)&&(d="leading"in u?!!u.leading:d,r="trailing"in u?!!u.trailing:r),bv(e,a,{leading:d,maxWait:a,trailing:r})}var _v=yv,np=function(e,a,u,d){switch(a){case"debounce":return tp(e,u,d);case"throttle":return _v(e,u,d);default:return e}},pa=function(e){return typeof e=="function"},Ot=function(){return typeof window>"u"},rf=function(e){return e instanceof Element||e instanceof HTMLDocument},rp=function(e,a,u,d){return function(r){var c=r.width,t=r.height;a(function(s){return s.width===c&&s.height===t||s.width===c&&!d||s.height===t&&!u?s:(e&&pa(e)&&e(c,t),{width:c,height:t})})}},ip=function(e){Xh(a,e);function a(u){var d=e.call(this,u)||this;d.cancelHandler=function(){d.resizeHandler&&d.resizeHandler.cancel&&(d.resizeHandler.cancel(),d.resizeHandler=null)},d.attachObserver=function(){var o=d.props,i=o.targetRef,l=o.observerOptions;if(!Ot()){i&&i.current&&(d.targetRef.current=i.current);var p=d.getElement();p&&(d.observableElement&&d.observableElement===p||(d.observableElement=p,d.resizeObserver.observe(p,l)))}},d.getElement=function(){var o=d.props,i=o.querySelector,l=o.targetDomEl;if(Ot())return null;if(i)return document.querySelector(i);if(l&&rf(l))return l;if(d.targetRef&&rf(d.targetRef.current))return d.targetRef.current;var p=Zp.findDOMNode(d);if(!p)return null;var h=d.getRenderType();switch(h){case"renderProp":return p;case"childFunction":return p;case"child":return p;case"childArray":return p;default:return p.parentElement}},d.createResizeHandler=function(o){var i=d.props,l=i.handleWidth,p=l===void 0?!0:l,h=i.handleHeight,v=h===void 0?!0:h,y=i.onResize;if(!(!p&&!v)){var g=rp(y,d.setState.bind(d),p,v);o.forEach(function(f){var m=f&&f.contentRect||{},b=m.width,_=m.height,w=!d.skipOnMount&&!Ot();w&&g({width:b,height:_}),d.skipOnMount=!1})}},d.getRenderType=function(){var o=d.props,i=o.render,l=o.children;return pa(i)?"renderProp":pa(l)?"childFunction":L.isValidElement(l)?"child":Array.isArray(l)?"childArray":"parent"};var r=u.skipOnMount,c=u.refreshMode,t=u.refreshRate,s=t===void 0?1e3:t,n=u.refreshOptions;return d.state={width:void 0,height:void 0},d.skipOnMount=r,d.targetRef=L.createRef(),d.observableElement=null,Ot()||(d.resizeHandler=np(d.createResizeHandler,c,s,n),d.resizeObserver=new window.ResizeObserver(d.resizeHandler)),d}return a.prototype.componentDidMount=function(){this.attachObserver()},a.prototype.componentDidUpdate=function(){this.attachObserver()},a.prototype.componentWillUnmount=function(){Ot()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},a.prototype.render=function(){var u=this.props,d=u.render,r=u.children,c=u.nodeType,t=c===void 0?"div":c,s=this.state,n=s.width,o=s.height,i={width:n,height:o,targetRef:this.targetRef},l=this.getRenderType(),p;switch(l){case"renderProp":return d&&d(i);case"childFunction":return p=r,p(i);case"child":if(p=r,p.type&&typeof p.type=="string"){i.targetRef;var h=Yh(i,["targetRef"]);return L.cloneElement(p,h)}return L.cloneElement(p,i);case"childArray":return p=r,p.map(function(v){return!!v&&L.cloneElement(v,i)});default:return L.createElement(t,null)}},a}(L.PureComponent);function wv(e,a){a===void 0&&(a={});var u=function(c){Xh(t,c);function t(){var s=c!==null&&c.apply(this,arguments)||this;return s.ref=L.createRef(),s}return t.prototype.render=function(){var s=this.props,n=s.forwardedRef,o=Yh(s,["forwardedRef"]),i=n??this.ref;return L.createElement(ip,un({},a,{targetRef:i}),L.createElement(e,un({targetRef:i},o)))},t}(L.Component);function d(c,t){return L.createElement(u,un({},c,{forwardedRef:t}))}var r=e.displayName||e.name;return d.displayName="withResizeDetector(".concat(r,")"),L.forwardRef(d)}var Cv=Ot()?L.useEffect:L.useLayoutEffect;function Sv(e){e===void 0&&(e={});var a=e.skipOnMount,u=a===void 0?!1:a,d=e.refreshMode,r=e.refreshRate,c=r===void 0?1e3:r,t=e.refreshOptions,s=e.handleWidth,n=s===void 0?!0:s,o=e.handleHeight,i=o===void 0?!0:o,l=e.targetRef,p=e.observerOptions,h=e.onResize,v=L.useRef(u),y=L.useRef(null),g=l??y,f=L.useRef(),m=L.useState({width:void 0,height:void 0}),b=m[0],_=m[1];return Cv(function(){if(!Ot()){var w=rp(h,_,n,i),C=function(O){!n&&!i||O.forEach(function(S){var x=S&&S.contentRect||{},I=x.width,N=x.height,R=!v.current&&!Ot();R&&w({width:I,height:N}),v.current=!1})};f.current=np(C,d,c,t);var E=new window.ResizeObserver(f.current);return g.current&&E.observe(g.current,p),function(){E.disconnect();var O=f.current;O&&O.cancel&&O.cancel()}}},[d,c,t,n,i,h,p,g.current]),un({ref:g},b)}const Ev=Object.freeze(Object.defineProperty({__proto__:null,default:ip,useResizeDetector:Sv,withResizeDetector:wv},Symbol.toStringTag,{value:"Module"})),Ov=ah(Ev);var pt={},sf;function xv(){return sf||(sf=1,function(e){var a=pt&&pt.__createBinding||(Object.create?function(v,y,g,f){f===void 0&&(f=g);var m=Object.getOwnPropertyDescriptor(y,g);(!m||("get"in m?!y.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return y[g]}}),Object.defineProperty(v,f,m)}:function(v,y,g,f){f===void 0&&(f=g),v[f]=y[g]}),u=pt&&pt.__setModuleDefault||(Object.create?function(v,y){Object.defineProperty(v,"default",{enumerable:!0,value:y})}:function(v,y){v.default=y}),d=pt&&pt.__importStar||function(v){if(v&&v.__esModule)return v;var y={};if(v!=null)for(var g in v)g!=="default"&&Object.prototype.hasOwnProperty.call(v,g)&&a(y,v,g);return u(y,v),y};Object.defineProperty(e,"__esModule",{value:!0}),e.useColumns=e.parseFlexValue=void 0;const r=d(F()),c=()=>r.default.createElement(r.default.Fragment,null),t=()=>!1,s=({rowData:v})=>v,n=()=>null,o=({rowIndex:v})=>r.default.createElement(r.default.Fragment,null,v+1),i=()=>!0,l=v=>v,p=v=>{if(typeof v=="number")return{basis:0,grow:v,shrink:1};if(v.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(v.trim()),shrink:1};if(v.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(v.trim()),grow:1,shrink:1};if(v.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[y,g]=v.trim().split(" ");return{basis:0,grow:parseFloat(y),shrink:parseFloat(g)}}if(v.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,g]=v.trim().split(" ");return{basis:parseFloat(g),grow:parseFloat(y),shrink:1}}if(v.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,g,f]=v.trim().split(" ");return{basis:parseFloat(f),grow:parseFloat(y),shrink:parseFloat(g)}}return{basis:0,grow:1,shrink:1}};e.parseFlexValue=p;const h=(v,y,g)=>(0,r.useMemo)(()=>{var f,m,b,_,w,C,E,O,S,x;const I=[y===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>r.default.createElement(r.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:i}:Object.assign(Object.assign({},y),{basis:(f=y==null?void 0:y.basis)!==null&&f!==void 0?f:40,grow:(m=y==null?void 0:y.grow)!==null&&m!==void 0?m:0,shrink:(b=y==null?void 0:y.shrink)!==null&&b!==void 0?b:0,minWidth:(_=y==null?void 0:y.minWidth)!==null&&_!==void 0?_:0,title:(w=y==null?void 0:y.title)!==null&&w!==void 0?w:r.default.createElement("div",{className:"dsg-corner-indicator"}),component:(C=y==null?void 0:y.component)!==null&&C!==void 0?C:o,isCellEmpty:i}),...v];return g&&I.push(Object.assign(Object.assign({},g),{basis:(E=g==null?void 0:g.basis)!==null&&E!==void 0?E:40,grow:(O=g==null?void 0:g.grow)!==null&&O!==void 0?O:0,shrink:(S=g==null?void 0:g.shrink)!==null&&S!==void 0?S:0,minWidth:(x=g.minWidth)!==null&&x!==void 0?x:0,isCellEmpty:i})),I.map(N=>{var R,M,T,j,D,G,z,W,Z,U,ee,ge,X,ie,se,Re;const Ce=N.width!==void 0?(0,e.parseFlexValue)(N.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},N),{basis:(M=(R=N.basis)!==null&&R!==void 0?R:Ce.basis)!==null&&M!==void 0?M:0,grow:(j=(T=N.grow)!==null&&T!==void 0?T:Ce.grow)!==null&&j!==void 0?j:1,shrink:(G=(D=N.shrink)!==null&&D!==void 0?D:Ce.shrink)!==null&&G!==void 0?G:1,minWidth:(z=N.minWidth)!==null&&z!==void 0?z:100,component:(W=N.component)!==null&&W!==void 0?W:c,disableKeys:(Z=N.disableKeys)!==null&&Z!==void 0?Z:!1,disabled:(U=N.disabled)!==null&&U!==void 0?U:!1,keepFocus:(ee=N.keepFocus)!==null&&ee!==void 0?ee:!1,deleteValue:(ge=N.deleteValue)!==null&&ge!==void 0?ge:s,copyValue:(X=N.copyValue)!==null&&X!==void 0?X:n,pasteValue:(ie=N.pasteValue)!==null&&ie!==void 0?ie:s,prePasteValues:(se=N.prePasteValues)!==null&&se!==void 0?se:l,isCellEmpty:(Re=N.isCellEmpty)!==null&&Re!==void 0?Re:t})})},[y,g,v]);e.useColumns=h}(pt)),pt}var yi={},_i={},of;function za(){if(of)return _i;of=1,Object.defineProperty(_i,"__esModule",{value:!0});function e(u,d,r,c){var t,s=!1,n=0;function o(){t&&clearTimeout(t)}function i(){o(),s=!0}typeof d!="boolean"&&(c=r,r=d,d=void 0);function l(){for(var p=arguments.length,h=new Array(p),v=0;v<p;v++)h[v]=arguments[v];var y=this,g=Date.now()-n;if(s)return;function f(){n=Date.now(),r.apply(y,h)}function m(){t=void 0}c&&!t&&f(),o(),c===void 0&&g>u?f():d!==!0&&(t=setTimeout(c?m:f,c===void 0?u-g:u))}return l.cancel=i,l}function a(u,d,r){return r===void 0?e(u,d,!1):e(u,r,d!==!1)}return _i.debounce=a,_i.throttle=e,_i}var zt={},af;function sp(){if(af)return zt;af=1;var e=zt&&zt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(zt,"__esModule",{value:!0}),zt.useDeepEqualState=void 0;const a=F(),u=e(lh()),d=r=>{const[c,t]=(0,a.useState)(r),s=(0,a.useCallback)(n=>{t(o=>{const i=typeof n=="function"?n(o):n;return(0,u.default)(i,o)?o:i})},[t]);return[c,s]};return zt.useDeepEqualState=d,zt}var cf;function Rv(){if(cf)return yi;cf=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.useEdges=void 0;const e=F(),a=za(),u=sp(),d=(r,c,t)=>{const[s,n]=(0,u.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,e.useEffect)(()=>{const o=(0,a.throttle)(100,()=>{var l,p,h,v,y,g,f,m,b,_;n({top:((l=r.current)===null||l===void 0?void 0:l.scrollTop)===0,right:((h=(p=r.current)===null||p===void 0?void 0:p.scrollLeft)!==null&&h!==void 0?h:0)>=((y=(v=r.current)===null||v===void 0?void 0:v.scrollWidth)!==null&&y!==void 0?y:0)-(c??0)-1,bottom:((f=(g=r.current)===null||g===void 0?void 0:g.scrollTop)!==null&&f!==void 0?f:0)>=((b=(m=r.current)===null||m===void 0?void 0:m.scrollHeight)!==null&&b!==void 0?b:0)-(t??0)-1,left:((_=r.current)===null||_===void 0?void 0:_.scrollLeft)===0})}),i=r.current;return i==null||i.addEventListener("scroll",o),setTimeout(o,100),()=>{i==null||i.removeEventListener("scroll",o),o.cancel()}},[t,c,r,n]),s};return yi.useEdges=d,yi}var wi={},lf;function op(){if(lf)return wi;lf=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.useDocumentEventListener=void 0;const e=F(),a=(u,d)=>{(0,e.useEffect)(()=>(document.addEventListener(u,d),()=>{document.removeEventListener(u,d)}),[d,u])};return wi.useDocumentEventListener=a,wi}var Ci={},uf;function Iv(){if(uf)return Ci;uf=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.useGetBoundingClientRect=void 0;const e=F(),a=za(),u=(d,r=200)=>{const c=(0,e.useRef)(null),t=(0,e.useMemo)(()=>(0,a.throttle)(r,!0,()=>{setTimeout(()=>{var s;return c.current=((s=d.current)===null||s===void 0?void 0:s.getBoundingClientRect())||null},0)}),[d,r]);return(0,e.useCallback)((s=!1)=>{var n;return s?c.current=((n=d.current)===null||n===void 0?void 0:n.getBoundingClientRect())||null:t(),c.current},[d,t])};return Ci.useGetBoundingClientRect=u,Ci}var mt={},df;function ap(){return df||(df=1,function(e){var a=mt&&mt.__createBinding||(Object.create?function(t,s,n,o){o===void 0&&(o=n);var i=Object.getOwnPropertyDescriptor(s,n);(!i||("get"in i?!s.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(t,o,i)}:function(t,s,n,o){o===void 0&&(o=n),t[o]=s[n]}),u=mt&&mt.__setModuleDefault||(Object.create?function(t,s){Object.defineProperty(t,"default",{enumerable:!0,value:s})}:function(t,s){t.default=s}),d=mt&&mt.__importStar||function(t){if(t&&t.__esModule)return t;var s={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&a(s,t,n);return u(s,t),s};Object.defineProperty(e,"__esModule",{value:!0}),e.AddRows=e.createAddRowsComponent=void 0;const r=d(F()),c=(t={})=>({addRows:s})=>{var n,o;const[i,l]=(0,r.useState)(1),[p,h]=(0,r.useState)(String(i));return r.default.createElement("div",{className:"dsg-add-row"},r.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>s(i)},(n=t.button)!==null&&n!==void 0?n:"Add")," ",r.default.createElement("input",{className:"dsg-add-row-input",value:p,onBlur:()=>h(String(i)),type:"number",min:1,onChange:v=>{h(v.target.value),l(Math.max(1,Math.round(parseInt(v.target.value)||0)))},onKeyDown:v=>{v.key==="Enter"&&s(i)}})," ",(o=t.unit)!==null&&o!==void 0?o:"rows")};e.createAddRowsComponent=c,e.AddRows=(0,e.createAddRowsComponent)(),e.AddRows.displayName="AddRows"}(mt)),mt}var Si={},ff;function Nv(){if(ff)return Si;ff=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.useDebounceState=void 0;const e=F(),a=za(),u=(d,r)=>{const[c,t]=(0,e.useState)(d),s=(0,e.useRef)();(0,e.useEffect)(()=>()=>{var o;return(o=s.current)===null||o===void 0?void 0:o.cancel()},[]);const n=(0,e.useMemo)(()=>s.current=(0,a.debounce)(r,o=>{t(o)}),[r]);return[c,n]};return Si.useDebounceState=u,Si}var bt={},hf;function cp(){return hf||(hf=1,function(e){var a=bt&&bt.__createBinding||(Object.create?function(o,i,l,p){p===void 0&&(p=l);var h=Object.getOwnPropertyDescriptor(i,l);(!h||("get"in h?!i.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return i[l]}}),Object.defineProperty(o,p,h)}:function(o,i,l,p){p===void 0&&(p=l),o[p]=i[l]}),u=bt&&bt.__setModuleDefault||(Object.create?function(o,i){Object.defineProperty(o,"default",{enumerable:!0,value:i})}:function(o,i){o.default=i}),d=bt&&bt.__importStar||function(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&a(i,o,l);return u(i,o),i};Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=e.createContextMenuComponent=e.defaultRenderItem=void 0;const r=d(F()),c=F(),t=op(),s=o=>o.type==="CUT"?r.createElement(r.Fragment,null,"Cut"):o.type==="COPY"?r.createElement(r.Fragment,null,"Copy"):o.type==="PASTE"?r.createElement(r.Fragment,null,"Paste"):o.type==="DELETE_ROW"?r.createElement(r.Fragment,null,"Delete row"):o.type==="DELETE_ROWS"?r.createElement(r.Fragment,null,"Delete rows ",r.createElement("b",null,o.fromRow)," to ",r.createElement("b",null,o.toRow)):o.type==="INSERT_ROW_BELLOW"?r.createElement(r.Fragment,null,"Insert row below"):o.type==="DUPLICATE_ROW"?r.createElement(r.Fragment,null,"Duplicate row"):o.type==="DUPLICATE_ROWS"?r.createElement(r.Fragment,null,"Duplicate rows ",r.createElement("b",null,o.fromRow)," to ",r.createElement("b",null,o.toRow)):o.type;e.defaultRenderItem=s;const n=(o=e.defaultRenderItem)=>({clientX:i,clientY:l,items:p,close:h})=>{const v=(0,c.useRef)(null),y=(0,c.useCallback)(g=>{var f;((f=v.current)===null||f===void 0?void 0:f.contains(g.target))||h()},[h]);return(0,t.useDocumentEventListener)("mousedown",y),r.createElement("div",{className:"dsg-context-menu",style:{left:i+"px",top:l+"px"},ref:v},p.map(g=>r.createElement("div",{key:g.type,onClick:g.action,className:"dsg-context-menu-item"},o(g))))};e.createContextMenuComponent=n,e.ContextMenu=(0,e.createContextMenuComponent)(e.defaultRenderItem),e.ContextMenu.displayName="ContextMenu"}(bt)),bt}var nt={},Ei={},pf;function kv(){if(pf)return Ei;pf=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.parseDom=void 0;const e=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},a=u=>e.parseFromString(u,"text/html");return Ei.parseDom=a,Ei}var mf;function Av(){if(mf)return nt;mf=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.isPrintableUnicode=nt.encodeHtml=nt.parseTextPlainData=nt.parseTextHtmlData=void 0;const e=kv(),a=c=>{var t,s;const n=(0,e.parseDom)(c.replace(/<br\/?>/g,`
`)),o=n.getElementsByTagName("table")[0];if(o){const l=[];for(let p=0;p<o.rows.length;p++){const h=[];l.push(h);for(let v=0;v<o.rows[p].cells.length;v++)h.push((t=o.rows[p].cells[v].textContent)!==null&&t!==void 0?t:"")}return l}const i=n.getElementsByTagName("span")[0];return i?[[(s=i.textContent)!==null&&s!==void 0?s:""]]:[[""]]};nt.parseTextHtmlData=a;const u=c=>{const t=c.replace(/\r|\n$/g,""),s=[[]];let n=0,o=0,i=!1,l=0;const p=()=>{let h=t.slice(o,n);h[0]==='"'&&h[h.length-1]==='"'&&(i=!0),i&&h[h.length-1]==='"'&&h.includes(`
`)&&(h=h.slice(1,h.length-1).replace(/""/g,'"'),i=!1),i&&h[h.length-1]!=='"'?h.split(`
`).forEach((v,y,{length:g})=>{s[l].push(v),y<g-1&&(s.push([]),l++)}):s[l].push(h)};for(;n<t.length;)i&&t[n]==='"'&&![void 0,"	",'"'].includes(t[n+1])&&(i=!1),i&&t[n]==='"'&&t[n+1]==='"'&&n++,n===o&&t[n]==='"'&&(i=!0),t[n]==="	"&&(p(),o=n+1,i=!1),t[n]===`
`&&!i&&(p(),s.push([]),o=n+1,l++),n++;return p(),s};nt.parseTextPlainData=u;const d=c=>c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");nt.encodeHtml=d;const r=c=>c.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return nt.isPrintableUnicode=r,nt}var ta={},bf;function Tv(){return bf||(bf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSelectionWithId=e.getSelection=e.getCellWithId=e.getCell=void 0;const a=(c,t,s,n)=>{if(c===null||!t||!s)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const o=n.findIndex(l=>l.id===c.col),i={col:Math.max(0,Math.min(t-1,o===-1?Number(c.col):o-1)),row:Math.max(0,Math.min(s-1,Number(c.row)))};if(isNaN(i.col)||isNaN(i.row))throw new Error("col or cell are not valid positive numbers");return i};e.getCell=a;const u=(c,t)=>{var s;return c?{col:c.col,row:c.row,colId:(s=t[c.col+1])===null||s===void 0?void 0:s.id}:null};e.getCellWithId=u;const d=(c,t,s,n)=>{if(c===null||!t||!s)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const o={min:(0,e.getCell)(c.min,t,s,n),max:(0,e.getCell)(c.max,t,s,n)};if(!o.min||!o.max)throw new Error("min and max must be defined");return o};e.getSelection=d;const r=(c,t)=>c?{min:(0,e.getCellWithId)(c.min,t),max:(0,e.getCellWithId)(c.max,t)}:null;e.getSelectionWithId=r}(ta)),ta}var Oi={},vf;function jv(){if(vf)return Oi;vf=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.getAllTabbableElements=void 0;const e=()=>Array.from(document.querySelectorAll("*")).filter(a=>a instanceof HTMLElement&&typeof a.tabIndex=="number"&&a.tabIndex>=0&&!a.disabled&&(!(a instanceof HTMLAnchorElement)||!!a.href||a.getAttribute("tabIndex")!==null)&&getComputedStyle(a).visibility!=="collapse");return Oi.getAllTabbableElements=e,Oi}var Le={},na={},ra={},ia={},gf;function Pv(){return gf||(gf=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function a(c,t,s){let n=s.initialDeps??[],o;function i(){var l,p,h,v;let y;s.key&&((l=s.debug)!=null&&l.call(s))&&(y=Date.now());const g=c();if(!(g.length!==n.length||g.some((b,_)=>n[_]!==b)))return o;n=g;let m;if(s.key&&((p=s.debug)!=null&&p.call(s))&&(m=Date.now()),o=t(...g),s.key&&((h=s.debug)!=null&&h.call(s))){const b=Math.round((Date.now()-y)*100)/100,_=Math.round((Date.now()-m)*100)/100,w=_/16,C=(E,O)=>{for(E=String(E);E.length<O;)E=" "+E;return E};console.info(`%c⏱ ${C(_,5)} /${C(b,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*w,120))}deg 100% 31%);`,s==null?void 0:s.key)}return(v=s==null?void 0:s.onChange)==null||v.call(s,o),o}return i.updateDeps=l=>{n=l},i}function u(c,t){if(c===void 0)throw new Error(`Unexpected undefined${t?`: ${t}`:""}`);return c}const d=(c,t)=>Math.abs(c-t)<=1,r=(c,t,s)=>{let n;return function(...o){c.clearTimeout(n),n=c.setTimeout(()=>t.apply(this,o),s)}};e.approxEqual=d,e.debounce=r,e.memo=a,e.notUndefined=u}(ia)),ia}var yf;function Mv(){return yf||(yf=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const a=Pv(),u=f=>{const{offsetWidth:m,offsetHeight:b}=f;return{width:m,height:b}},d=f=>f,r=f=>{const m=Math.max(f.startIndex-f.overscan,0),b=Math.min(f.endIndex+f.overscan,f.count-1),_=[];for(let w=m;w<=b;w++)_.push(w);return _},c=(f,m)=>{const b=f.scrollElement;if(!b)return;const _=f.targetWindow;if(!_)return;const w=E=>{const{width:O,height:S}=E;m({width:Math.round(O),height:Math.round(S)})};if(w(u(b)),!_.ResizeObserver)return()=>{};const C=new _.ResizeObserver(E=>{const O=()=>{const S=E[0];if(S!=null&&S.borderBoxSize){const x=S.borderBoxSize[0];if(x){w({width:x.inlineSize,height:x.blockSize});return}}w(u(b))};f.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(O):O()});return C.observe(b,{box:"border-box"}),()=>{C.unobserve(b)}},t={passive:!0},s=(f,m)=>{const b=f.scrollElement;if(!b)return;const _=()=>{m({width:b.innerWidth,height:b.innerHeight})};return _(),b.addEventListener("resize",_,t),()=>{b.removeEventListener("resize",_)}},n=typeof window>"u"?!0:"onscrollend"in window,o=(f,m)=>{const b=f.scrollElement;if(!b)return;const _=f.targetWindow;if(!_)return;let w=0;const C=f.options.useScrollendEvent&&n?()=>{}:a.debounce(_,()=>{m(w,!1)},f.options.isScrollingResetDelay),E=I=>()=>{const{horizontal:N,isRtl:R}=f.options;w=N?b.scrollLeft*(R&&-1||1):b.scrollTop,C(),m(w,I)},O=E(!0),S=E(!1);S(),b.addEventListener("scroll",O,t);const x=f.options.useScrollendEvent&&n;return x&&b.addEventListener("scrollend",S,t),()=>{b.removeEventListener("scroll",O),x&&b.removeEventListener("scrollend",S)}},i=(f,m)=>{const b=f.scrollElement;if(!b)return;const _=f.targetWindow;if(!_)return;let w=0;const C=f.options.useScrollendEvent&&n?()=>{}:a.debounce(_,()=>{m(w,!1)},f.options.isScrollingResetDelay),E=I=>()=>{w=b[f.options.horizontal?"scrollX":"scrollY"],C(),m(w,I)},O=E(!0),S=E(!1);S(),b.addEventListener("scroll",O,t);const x=f.options.useScrollendEvent&&n;return x&&b.addEventListener("scrollend",S,t),()=>{b.removeEventListener("scroll",O),x&&b.removeEventListener("scrollend",S)}},l=(f,m,b)=>{if(m!=null&&m.borderBoxSize){const _=m.borderBoxSize[0];if(_)return Math.round(_[b.options.horizontal?"inlineSize":"blockSize"])}return f[b.options.horizontal?"offsetWidth":"offsetHeight"]},p=(f,{adjustments:m=0,behavior:b},_)=>{var w,C;const E=f+m;(C=(w=_.scrollElement)==null?void 0:w.scrollTo)==null||C.call(w,{[_.options.horizontal?"left":"top"]:E,behavior:b})},h=(f,{adjustments:m=0,behavior:b},_)=>{var w,C;const E=f+m;(C=(w=_.scrollElement)==null?void 0:w.scrollTo)==null||C.call(w,{[_.options.horizontal?"left":"top"]:E,behavior:b})};class v{constructor(m){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let b=null;const _=()=>b||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:b=new this.targetWindow.ResizeObserver(w=>{w.forEach(C=>{const E=()=>{this._measureElement(C.target,C)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(E):E()})}));return{disconnect:()=>{var w;(w=_())==null||w.disconnect(),b=null},observe:w=>{var C;return(C=_())==null?void 0:C.observe(w,{box:"border-box"})},unobserve:w=>{var C;return(C=_())==null?void 0:C.unobserve(w)}}})(),this.range=null,this.setOptions=b=>{Object.entries(b).forEach(([_,w])=>{typeof w>"u"&&delete b[_]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:d,rangeExtractor:r,onChange:()=>{},measureElement:l,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...b}},this.notify=b=>{var _,w;(w=(_=this.options).onChange)==null||w.call(_,this,b)},this.maybeNotify=a.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),b=>{this.notify(b)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(b=>b()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var b;const _=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==_){if(this.cleanup(),!_){this.maybeNotify();return}this.scrollElement=_,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((b=this.scrollElement)==null?void 0:b.window)??null,this.elementsCache.forEach(w=>{this.observer.observe(w)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,w=>{this.scrollRect=w,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(w,C)=>{this.scrollAdjustments=0,this.scrollDirection=C?this.getScrollOffset()<w?"forward":"backward":null,this.scrollOffset=w,this.isScrolling=C,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(b,_)=>{const w=new Map,C=new Map;for(let E=_-1;E>=0;E--){const O=b[E];if(w.has(O.lane))continue;const S=C.get(O.lane);if(S==null||O.end>S.end?C.set(O.lane,O):O.end<S.end&&w.set(O.lane,!0),w.size===this.options.lanes)break}return C.size===this.options.lanes?Array.from(C.values()).sort((E,O)=>E.end===O.end?E.index-O.index:E.end-O.end)[0]:void 0},this.getMeasurementOptions=a.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(b,_,w,C,E)=>(this.pendingMeasuredCacheIndexes=[],{count:b,paddingStart:_,scrollMargin:w,getItemKey:C,enabled:E}),{key:!1}),this.getMeasurements=a.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:b,paddingStart:_,scrollMargin:w,getItemKey:C,enabled:E},O)=>{if(!E)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(I=>{this.itemSizeCache.set(I.key,I.size)}));const S=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const x=this.measurementsCache.slice(0,S);for(let I=S;I<b;I++){const N=C(I),R=this.options.lanes===1?x[I-1]:this.getFurthestMeasurement(x,I),M=R?R.end+this.options.gap:_+w,T=O.get(N),j=typeof T=="number"?T:this.options.estimateSize(I),D=M+j,G=R?R.lane:I%this.options.lanes;x[I]={index:I,start:M,size:j,end:D,key:N,lane:G}}return this.measurementsCache=x,x},{key:!1,debug:()=>this.options.debug}),this.calculateRange=a.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(b,_,w,C)=>this.range=b.length>0&&_>0?g({measurements:b,outerSize:_,scrollOffset:w,lanes:C}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=a.memo(()=>{let b=null,_=null;const w=this.calculateRange();return w&&(b=w.startIndex,_=w.endIndex),this.maybeNotify.updateDeps([this.isScrolling,b,_]),[this.options.rangeExtractor,this.options.overscan,this.options.count,b,_]},(b,_,w,C,E)=>C===null||E===null?[]:b({startIndex:C,endIndex:E,overscan:_,count:w}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=b=>{const _=this.options.indexAttribute,w=b.getAttribute(_);return w?parseInt(w,10):(console.warn(`Missing attribute name '${_}={index}' on measured element.`),-1)},this._measureElement=(b,_)=>{const w=this.indexFromElement(b),C=this.measurementsCache[w];if(!C)return;const E=C.key,O=this.elementsCache.get(E);O!==b&&(O&&this.observer.unobserve(O),this.observer.observe(b),this.elementsCache.set(E,b)),b.isConnected&&this.resizeItem(w,this.options.measureElement(b,_,this))},this.resizeItem=(b,_)=>{const w=this.measurementsCache[b];if(!w)return;const C=this.itemSizeCache.get(w.key)??w.size,E=_-C;E!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(w,E,this):w.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=E,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(w.index),this.itemSizeCache=new Map(this.itemSizeCache.set(w.key,_)),this.notify(!1))},this.measureElement=b=>{if(!b){this.elementsCache.forEach((_,w)=>{_.isConnected||(this.observer.unobserve(_),this.elementsCache.delete(w))});return}this._measureElement(b,void 0)},this.getVirtualItems=a.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(b,_)=>{const w=[];for(let C=0,E=b.length;C<E;C++){const O=b[C],S=_[O];w.push(S)}return w},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=b=>{const _=this.getMeasurements();if(_.length!==0)return a.notUndefined(_[y(0,_.length-1,w=>a.notUndefined(_[w]).start,b)])},this.getOffsetForAlignment=(b,_,w=0)=>{const C=this.getSize(),E=this.getScrollOffset();_==="auto"&&(_=b>=E+C?"end":"start"),_==="center"?b+=(w-C)/2:_==="end"&&(b-=C);const O=this.getTotalSize()-C;return Math.max(Math.min(O,b),0)},this.getOffsetForIndex=(b,_="auto")=>{b=Math.max(0,Math.min(b,this.options.count-1));const w=this.measurementsCache[b];if(!w)return;const C=this.getSize(),E=this.getScrollOffset();if(_==="auto")if(w.end>=E+C-this.options.scrollPaddingEnd)_="end";else if(w.start<=E+this.options.scrollPaddingStart)_="start";else return[E,_];const O=_==="end"?w.end+this.options.scrollPaddingEnd:w.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(O,_,w.size),_]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(b,{align:_="start",behavior:w}={})=>{this.cancelScrollToIndex(),w==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(b,_),{adjustments:void 0,behavior:w})},this.scrollToIndex=(b,{align:_="auto",behavior:w}={})=>{b=Math.max(0,Math.min(b,this.options.count-1)),this.cancelScrollToIndex(),w==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const C=this.getOffsetForIndex(b,_);if(!C)return;const[E,O]=C;this._scrollToOffset(E,{adjustments:void 0,behavior:w}),w!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(b))){const[x]=a.notUndefined(this.getOffsetForIndex(b,O)),I=this.getScrollOffset();a.approxEqual(x,I)||this.scrollToIndex(b,{align:O,behavior:w})}else this.scrollToIndex(b,{align:O,behavior:w})}))},this.scrollBy=(b,{behavior:_}={})=>{this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+b,{adjustments:void 0,behavior:_})},this.getTotalSize=()=>{var b;const _=this.getMeasurements();let w;if(_.length===0)w=this.options.paddingStart;else if(this.options.lanes===1)w=((b=_[_.length-1])==null?void 0:b.end)??0;else{const C=Array(this.options.lanes).fill(null);let E=_.length-1;for(;E>=0&&C.some(O=>O===null);){const O=_[E];C[O.lane]===null&&(C[O.lane]=O.end),E--}w=Math.max(...C.filter(O=>O!==null))}return Math.max(w-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(b,{adjustments:_,behavior:w})=>{this.options.scrollToFn(b,{behavior:w,adjustments:_},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(m)}}const y=(f,m,b,_)=>{for(;f<=m;){const w=(f+m)/2|0,C=b(w);if(C<_)f=w+1;else if(C>_)m=w-1;else return w}return f>0?f-1:0};function g({measurements:f,outerSize:m,scrollOffset:b,lanes:_}){const w=f.length-1,C=S=>f[S].start;if(f.length<=_)return{startIndex:0,endIndex:w};let E=y(0,w,C,b),O=E;if(_===1)for(;O<w&&f[O].end<b+m;)O++;else if(_>1){const S=Array(_).fill(0);for(;O<w&&S.some(I=>I<b+m);){const I=f[O];S[I.lane]=I.end,O++}const x=Array(_).fill(b+m);for(;E>=0&&x.some(I=>I>=b);){const I=f[E];x[I.lane]=I.start,E--}E=Math.max(0,E-E%_),O=Math.min(w,O+(_-1-O%_))}return{startIndex:E,endIndex:O}}e.approxEqual=a.approxEqual,e.debounce=a.debounce,e.memo=a.memo,e.notUndefined=a.notUndefined,e.Virtualizer=v,e.defaultKeyExtractor=d,e.defaultRangeExtractor=r,e.elementScroll=h,e.measureElement=l,e.observeElementOffset=o,e.observeElementRect=c,e.observeWindowOffset=i,e.observeWindowRect=s,e.windowScroll=p}(ra)),ra}var _f;function qv(){return _f||(_f=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const a=F(),u=e0(),d=Mv();function r(i){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const p in i)if(p!=="default"){const h=Object.getOwnPropertyDescriptor(i,p);Object.defineProperty(l,p,h.get?h:{enumerable:!0,get:()=>i[p]})}}return l.default=i,Object.freeze(l)}const c=r(a),t=typeof document<"u"?c.useLayoutEffect:c.useEffect;function s(i){const l=c.useReducer(()=>({}),{})[1],p={...i,onChange:(v,y)=>{var g;y?u.flushSync(l):l(),(g=i.onChange)==null||g.call(i,v,y)}},[h]=c.useState(()=>new d.Virtualizer(p));return h.setOptions(p),t(()=>h._didMount(),[]),t(()=>h._willUpdate()),h}function n(i){return s({observeElementRect:d.observeElementRect,observeElementOffset:d.observeElementOffset,scrollToFn:d.elementScroll,...i})}function o(i){return s({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:d.observeWindowRect,observeElementOffset:d.observeWindowOffset,scrollToFn:d.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...i})}e.useVirtualizer=n,e.useWindowVirtualizer=o,Object.keys(d).forEach(i=>{i!=="default"&&!Object.prototype.hasOwnProperty.call(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:()=>d[i]})})}(na)),na}var Gt={},wf;function Dv(){if(wf)return Gt;wf=1;var e=Gt&&Gt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.Cell=void 0;const a=e(F()),u=e(hn()),d=({children:r,gutter:c,stickyRight:t,active:s,disabled:n,className:o,width:i,left:l})=>a.default.createElement("div",{className:(0,u.default)("dsg-cell",c&&"dsg-cell-gutter",n&&"dsg-cell-disabled",c&&s&&"dsg-cell-gutter-active",t&&"dsg-cell-sticky-right",o),style:{width:i,left:t?void 0:l}},r);return Gt.Cell=d,Gt}var xi={},Cf;function Vv(){if(Cf)return xi;Cf=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.useMemoizedIndexCallback=void 0;const e=F(),a=(u,d)=>(0,e.useMemo)(()=>{const r=new Map;return c=>(r.has(c)||r.set(c,(...t)=>{u(c,...t.slice(0,d))}),r.get(c))},[d,u]);return xi.useMemoizedIndexCallback=a,xi}var Sf;function Bv(){if(Sf)return Le;Sf=1;var e=Le&&Le.__createBinding||(Object.create?function(i,l,p,h){h===void 0&&(h=p);var v=Object.getOwnPropertyDescriptor(l,p);(!v||("get"in v?!l.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return l[p]}}),Object.defineProperty(i,h,v)}:function(i,l,p,h){h===void 0&&(h=p),i[h]=l[p]}),a=Le&&Le.__setModuleDefault||(Object.create?function(i,l){Object.defineProperty(i,"default",{enumerable:!0,value:l})}:function(i,l){i.default=l}),u=Le&&Le.__importStar||function(i){if(i&&i.__esModule)return i;var l={};if(i!=null)for(var p in i)p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)&&e(l,i,p);return a(l,i),l},d=Le&&Le.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Le,"__esModule",{value:!0}),Le.Grid=void 0;const r=qv(),c=u(F()),t=d(hn()),s=Dv(),n=Vv(),o=({data:i,columns:l,outerRef:p,innerRef:h,columnWidths:v,hasStickyRightColumn:y,displayHeight:g,headerRowHeight:f,rowHeight:m,rowKey:b,fullWidth:_,selection:w,activeCell:C,rowClassName:E,cellClassName:O,children:S,editing:x,getContextMenuItems:I,setRowData:N,deleteRows:R,duplicateRows:M,insertRowAfter:T,stopEditing:j,onScroll:D})=>{var G,z,W,Z;const U=(0,r.useVirtualizer)({count:i.length,getScrollElement:()=>p.current,paddingStart:f,estimateSize:K=>m(K).height,getItemKey:K=>{if(b&&K>0){const de=i[K-1];if(typeof b=="function")return b({rowData:de,rowIndex:K});if(typeof b=="string"&&de instanceof Object&&b in de){const ve=de[b];if(typeof ve=="string"||typeof ve=="number")return ve}}return K},overscan:5}),ee=(0,r.useVirtualizer)({count:l.length,getScrollElement:()=>p.current,estimateSize:K=>{var de;return(de=v==null?void 0:v[K])!==null&&de!==void 0?de:100},horizontal:!0,getItemKey:K=>{var de;return(de=l[K].id)!==null&&de!==void 0?de:K},overscan:1,rangeExtractor:K=>{const de=(0,r.defaultRangeExtractor)(K);return de[0]!==0&&de.unshift(0),y&&de[de.length-1]!==l.length-1&&de.push(l.length-1),de}});(0,c.useEffect)(()=>{ee.measure()},[ee,v]);const ge=(0,n.useMemoizedIndexCallback)(N,1),X=(0,n.useMemoizedIndexCallback)(R,0),ie=(0,n.useMemoizedIndexCallback)(M,0),se=(0,n.useMemoizedIndexCallback)(T,0),Re=(G=w==null?void 0:w.min.col)!==null&&G!==void 0?G:C==null?void 0:C.col,Ce=(z=w==null?void 0:w.max.col)!==null&&z!==void 0?z:C==null?void 0:C.col,_t=(W=w==null?void 0:w.min.row)!==null&&W!==void 0?W:C==null?void 0:C.row,ct=(Z=w==null?void 0:w.max.row)!==null&&Z!==void 0?Z:C==null?void 0:C.row;return c.default.createElement("div",{ref:p,className:"dsg-container",onScroll:D,style:{height:g}},c.default.createElement("div",{ref:h,style:{width:_?"100%":ee.getTotalSize(),height:U.getTotalSize()}},f>0&&c.default.createElement("div",{className:(0,t.default)("dsg-row","dsg-row-header"),style:{width:_?"100%":ee.getTotalSize(),height:f}},ee.getVirtualItems().map(K=>c.default.createElement(s.Cell,{key:K.key,gutter:K.index===0,stickyRight:y&&K.index===l.length-1,width:K.size,left:K.start,className:(0,t.default)("dsg-cell-header",Re!==void 0&&Ce!==void 0&&Re<=K.index-1&&Ce>=K.index-1&&"dsg-cell-header-active",l[K.index].headerClassName)},c.default.createElement("div",{className:"dsg-cell-header-container"},l[K.index].title)))),U.getVirtualItems().map(K=>{const de=K.index>=(_t??1/0)&&K.index<=(ct??-1/0);return c.default.createElement("div",{key:K.key,className:(0,t.default)("dsg-row",typeof E=="string"?E:null,typeof E=="function"?E({rowData:i[K.index],rowIndex:K.index}):null),style:{height:K.size,top:K.start,width:_?"100%":ee.getTotalSize()}},ee.getVirtualItems().map(ve=>{const wt=l[ve.index].cellClassName,Ct=l[ve.index].disabled,lt=l[ve.index].component,Yt=Ct===!0||typeof Ct=="function"&&Ct({rowData:i[K.index],rowIndex:K.index}),Qt=(C==null?void 0:C.row)===K.index&&C.col===ve.index-1;return c.default.createElement(s.Cell,{key:ve.key,gutter:ve.index===0,stickyRight:y&&ve.index===l.length-1,active:ve.index===0&&de,disabled:Yt,className:(0,t.default)(typeof wt=="function"?wt({rowData:i[K.index],rowIndex:K.index,columnId:l[ve.index].id}):wt,typeof O=="function"?O({rowData:i[K.index],rowIndex:K.index,columnId:l[ve.index].id}):O),width:ve.size,left:ve.start},c.default.createElement(lt,{rowData:i[K.index],getContextMenuItems:I,disabled:Yt,active:Qt,columnIndex:ve.index-1,rowIndex:K.index,focus:Qt&&x,deleteRow:X(K.index),duplicateRow:ie(K.index),stopEditing:j,insertRowBelow:se(K.index),setRowData:ge(K.index),columnData:l[ve.index].columnData}))}))}),S))};return Le.Grid=o,Le}var rt={},Ef;function Lv(){return Ef||(Ef=1,function(e){var a=rt&&rt.__createBinding||(Object.create?function(o,i,l,p){p===void 0&&(p=l);var h=Object.getOwnPropertyDescriptor(i,l);(!h||("get"in h?!i.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return i[l]}}),Object.defineProperty(o,p,h)}:function(o,i,l,p){p===void 0&&(p=l),o[p]=i[l]}),u=rt&&rt.__setModuleDefault||(Object.create?function(o,i){Object.defineProperty(o,"default",{enumerable:!0,value:i})}:function(o,i){o.default=i}),d=rt&&rt.__importStar||function(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&a(i,o,l);return u(i,o),i},r=rt&&rt.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRect=void 0;const c=d(F()),t=r(hn()),s=(o,i,l,p)=>[[p,o],[i,o],[i,l],[p,l],[p,o]],n=(o,i,l,p)=>`polygon(evenodd, ${[...s(0,"100%","100%",0),...s(o,i,l,p)].map(v=>v.map(y=>typeof y=="number"&&y!==0?y+"px":y).join(" ")).join(",")})`;e.SelectionRect=c.default.memo(({columnWidths:o,columnRights:i,headerRowHeight:l,selection:p,rowHeight:h,activeCell:v,hasStickyRightColumn:y,dataLength:g,viewWidth:f,viewHeight:m,contentWidth:b,edges:_,isCellDisabled:w,editing:C,expandSelection:E})=>{var O,S,x,I;const N=v?w(v):!1,R=(0,c.useMemo)(()=>{if(!p)return N;for(let U=p.min.col;U<=p.max.col;++U)for(let ee=p.min.row;ee<=p.max.row;++ee)if(!w({col:U,row:ee}))return!1;return!0},[N,w,p]);if(!o||!i)return null;const M=U=>U<g-1?1:0,T=U=>U<o.length-(y?3:2)?1:0,j=v&&{width:o[v.col+1]+T(v.col),height:h(v.row).height+M(v.row),left:i[v.col],top:h(v.row).top+l},D=p&&{width:o.slice(p.min.col+1,p.max.col+2).reduce((U,ee)=>U+ee)+T(p.max.col),height:h(p.max.row).top+h(p.max.row).height-h(p.min.row).top+M(p.max.row),left:i[p.min.col],top:h(p.min.row).top+l},G=(p==null?void 0:p.min)||v,z=(p==null?void 0:p.max)||v,W=z&&E!==null&&{left:i[z.col]+o[z.col+1],top:h(z.row).top+h(z.row).height+l,transform:`translate(-${z.col<o.length-(y?3:2)?50:100}%, -${z.row<g-1?50:100}%)`},Z=G&&z&&E!==null&&{width:o.slice(G.col+1,z.col+2).reduce((U,ee)=>U+ee)+T(z.col),height:h(z.row+E).top+h(z.row+E).height-h(z.row+1).top+M(z.row+E)-1,left:i[G.col],top:h(z.row).top+h(z.row).height+l+1};return c.default.createElement(c.default.Fragment,null,c.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:h(g-1).top+h(g-1).height+l,width:b||"100%"}},c.default.createElement("div",{className:(0,t.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!_.top,"dsg-scrollable-view-r":!_.right,"dsg-scrollable-view-b":!_.bottom,"dsg-scrollable-view-l":!_.left}),style:{top:l,left:o[0],height:m?m-l:0,width:b&&f?f-o[0]-(y?o[o.length-1]:0):`calc(100% - ${o[0]+(y?o[o.length-1]:0)}px)`}})),(D||j)&&c.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(O=D==null?void 0:D.left)!==null&&O!==void 0?O:j==null?void 0:j.left,width:(S=D==null?void 0:D.width)!==null&&S!==void 0?S:j==null?void 0:j.width,height:h(g-1).top+h(g-1).height+l}},c.default.createElement("div",{className:(0,t.default)("dsg-selection-col-marker",R&&"dsg-selection-col-marker-disabled"),style:{top:l}})),(D||j)&&c.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(x=D==null?void 0:D.top)!==null&&x!==void 0?x:j==null?void 0:j.top,height:(I=D==null?void 0:D.height)!==null&&I!==void 0?I:j==null?void 0:j.height,width:b||"100%"}},c.default.createElement("div",{className:(0,t.default)("dsg-selection-row-marker",R&&"dsg-selection-row-marker-disabled"),style:{left:o[0]}})),j&&v&&c.default.createElement("div",{className:(0,t.default)("dsg-active-cell",{"dsg-active-cell-focus":C,"dsg-active-cell-disabled":N}),style:j}),D&&j&&c.default.createElement("div",{className:(0,t.default)("dsg-selection-rect",R&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},D),{clipPath:n(j.top-D.top,j.left-D.left,j.top+j.height-D.top,j.left+j.width-D.left)})}),Z&&c.default.createElement("div",{className:(0,t.default)("dsg-expand-rows-rect"),style:Z}),W&&c.default.createElement("div",{className:(0,t.default)("dsg-expand-rows-indicator",R&&"dsg-expand-rows-indicator-disabled"),style:W}))}),e.SelectionRect.displayName="SelectionRect"}(rt)),rt}var Ri={},Of;function $v(){if(Of)return Ri;Of=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.useRowHeights=void 0;const e=F(),a=({value:u,rowHeight:d})=>{const r=(0,e.useRef)([]),[,c]=(0,e.useState)(0);return(0,e.useMemo)(()=>{const t=s=>{if(typeof d=="number")return Math.min(u.length-1,Math.max(-1,Math.floor(s/d)));let n=0,o=r.current.length-1;for(;n<=o;){const i=Math.floor((n+o)/2);if(r.current[i].top<s)n=i+1;else if(r.current[i].top>s)o=i-1;else return i}if(o===r.current.length-1&&u.length>r.current.length&&(!r.current.length||s>=r.current[o].top+r.current[o].height)){let i=o===-1?0:r.current[o].top+r.current[o].height;do{o++;const l=d({rowIndex:o,rowData:u[o]});r.current.push({height:l,top:i}),i+=l}while(i<=s&&o<r.current.length-1)}return o};return{resetAfter:s=>{r.current=r.current.slice(0,s),c(n=>n+1)},getRowSize:s=>{if(typeof d=="number")return{height:d,top:d*s};if(s>=u.length)return{height:0,top:0};if(s<r.current.length)return r.current[s];let n=r.current[r.current.length-1].top+r.current[r.current.length-1].height;for(let o=r.current.length;o<=s;o++){const i=d({rowIndex:o,rowData:u[o]});r.current.push({height:i,top:n}),n+=i}return r.current[s]},getRowIndex:t,totalSize:s=>{if(typeof d=="number")return u.length*d;const n=t(s);return r.current[n].top+r.current[n].height}}},[d,u])};return Ri.useRowHeights=a,Ri}var xf;function lp(){return xf||(xf=1,function(e){var a=Be&&Be.__createBinding||(Object.create?function(R,M,T,j){j===void 0&&(j=T);var D=Object.getOwnPropertyDescriptor(M,T);(!D||("get"in D?!M.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return M[T]}}),Object.defineProperty(R,j,D)}:function(R,M,T,j){j===void 0&&(j=T),R[j]=M[T]}),u=Be&&Be.__setModuleDefault||(Object.create?function(R,M){Object.defineProperty(R,"default",{enumerable:!0,value:M})}:function(R,M){R.default=M}),d=Be&&Be.__importStar||function(R){if(R&&R.__esModule)return R;var M={};if(R!=null)for(var T in R)T!=="default"&&Object.prototype.hasOwnProperty.call(R,T)&&a(M,R,T);return u(M,R),M},r=Be&&Be.__awaiter||function(R,M,T,j){function D(G){return G instanceof T?G:new T(function(z){z(G)})}return new(T||(T=Promise))(function(G,z){function W(ee){try{U(j.next(ee))}catch(ge){z(ge)}}function Z(ee){try{U(j.throw(ee))}catch(ge){z(ge)}}function U(ee){ee.done?G(ee.value):D(ee.value).then(W,Z)}U((j=j.apply(R,M||[])).next())})},c=Be&&Be.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(e,"__esModule",{value:!0}),e.DataSheetGrid=void 0;const t=d(F()),s=vb(),n=Ov,o=xv(),i=Rv(),l=sp(),p=op(),h=Iv(),v=ap(),y=Nv(),g=c(lh()),f=cp(),m=Av(),b=Tv(),_=jv(),w=Bv(),C=Lv(),E=$v(),O=[],S=[],x=()=>({}),I=()=>null,N=({rowData:R})=>Object.assign({},R);e.DataSheetGrid=t.default.memo(t.default.forwardRef(({value:R=O,className:M,style:T,height:j=400,onChange:D=I,columns:G=S,rowHeight:z=40,headerRowHeight:W=typeof z=="number"?z:40,gutterColumn:Z,stickyRightColumn:U,rowKey:ee,addRowsComponent:ge=v.AddRows,createRow:X=x,autoAddRow:ie=!1,lockRows:se=!1,disableExpandSelection:Re=!1,disableSmartDelete:Ce=!1,duplicateRow:_t=N,contextMenuComponent:ct=f.ContextMenu,disableContextMenu:K=!1,onFocus:de=I,onBlur:ve=I,onActiveCellChange:wt=I,onSelectionChange:Ct=I,rowClassName:lt,cellClassName:Yt,onScroll:Qt},Rs)=>{var bn,vn,kt,gn,yn,Ye;const St=(0,t.useRef)(null),es=K||se,H=(0,o.useColumns)(G,Z,U),ue=!!U,At=(0,t.useRef)(null),je=(0,t.useRef)(null),Is=(0,t.useRef)(null),Ns=(0,t.useRef)(null),[_p,wp]=(0,y.useDebounceState)(1,100),{getRowSize:Zt,totalSize:Cp,getRowIndex:Ga}=(0,E.useRowHeights)({value:R,rowHeight:z}),Wa=Math.min(j,W+Cp(j)+_p),{width:en,height:Tt}=(0,n.useResizeDetector)({targetRef:je,refreshMode:"throttle",refreshRate:100});wp(Tt?Wa-Tt:0);const Sp=(0,i.useEdges)(je,en,Tt),{fullWidth:Ha,totalWidth:Ep,columnWidths:Ue,columnRights:Qe}=(0,s.useColumnWidths)(H,en),[tn,ze]=(0,t.useState)(null),[nn,Op]=(0,t.useState)([]),[fe,Se]=(0,t.useState)(!1),[rn,Ka]=(0,t.useState)(0),[sn,Xa]=(0,t.useState)(null),[A,ce]=(0,l.useDeepEqualState)(null),[Ee,oe]=(0,l.useDeepEqualState)(null),P=(0,t.useMemo)(()=>A&&Ee&&{min:{col:Math.min(A.col,Ee.col),row:Math.min(A.row,Ee.row)},max:{col:Math.max(A.col,Ee.col),row:Math.max(A.row,Ee.row)}},[A,Ee]),[ut,on]=(0,l.useDeepEqualState)({columns:!1,rows:!1,active:!1}),xp=Re||fe||ut.active||(A==null?void 0:A.row)===(R==null?void 0:R.length)-1||(P==null?void 0:P.max.row)===(R==null?void 0:R.length)-1||A&&H.slice(((bn=P==null?void 0:P.min.col)!==null&&bn!==void 0?bn:A.col)+1,((vn=P==null?void 0:P.max.col)!==null&&vn!==void 0?vn:A.col)+2).every(k=>k.disabled===!0)?null:rn,Ya=(0,h.useGetBoundingClientRect)(At),Qa=(0,h.useGetBoundingClientRect)(je);(0,t.useEffect)(()=>{var k;A!==null&&(document.activeElement.blur(),(k=window.getSelection())===null||k===void 0||k.removeAllRanges())},[A!==null]);const jt=(0,t.useCallback)((k,B=!1,$=!1)=>{const V=Ya(B),Y=$&&Qa(B);if(V&&Qe&&Ue){let ae=k.clientX-V.left,J=k.clientY-V.top;return Y&&(k.clientY-Y.top<=W&&(J=0),k.clientX-Y.left<=Ue[0]&&(ae=0),ue&&Y.right-k.clientX<=Ue[Ue.length-1]&&(ae=Qe[Qe.length-2]+1)),{col:Qe.findIndex(te=>ae<te)-1,row:Ga(J-W)}}return null},[Qe,Ue,R.length,Ya,Qa,W,ue,Ga]),Pe=(0,t.useRef)(R);Pe.current=R;const Me=(0,t.useCallback)(k=>{const B=H[k.col+1].disabled;return!!(typeof B=="function"?B({rowData:Pe.current[k.row],rowIndex:k.row}):B)},[H]),dt=(0,t.useCallback)((k,B=1)=>{se||(oe(null),Se(!1),D([...Pe.current.slice(0,k+1),...new Array(B).fill(0).map(X),...Pe.current.slice(k+1)],[{type:"CREATE",fromRowIndex:k+1,toRowIndex:k+1+B}]),ce($=>({col:($==null?void 0:$.col)||0,row:k+B,doNotScrollX:!0})))},[X,se,D,ce,oe]),an=(0,t.useCallback)((k,B=k)=>{se||(D([...Pe.current.slice(0,B+1),...Pe.current.slice(k,B+1).map(($,V)=>_t({rowData:$,rowIndex:V+k})),...Pe.current.slice(B+1)],[{type:"CREATE",fromRowIndex:B+1,toRowIndex:B+2+B-k}]),ce({col:0,row:B+1,doNotScrollX:!0}),oe({col:H.length-(ue?3:2),row:2*B-k+1,doNotScrollX:!0}),Se(!1))},[H.length,_t,se,D,ce,oe,ue]),ft=(0,t.useCallback)(k=>{if(!(!Tt||!en)){if(!k.doNotScrollY){const B=Zt(k.row).top,$=Zt(k.row).top+Zt(k.row).height+W-Tt+1,V=je.current.scrollTop;V>B?je.current.scrollTop=B:V<$&&(je.current.scrollTop=$)}if(Qe&&Ue&&je.current&&!k.doNotScrollX){const B=Qe[k.col]-Qe[0],$=Qe[k.col]+Ue[k.col+1]+(ue?Ue[Ue.length-1]:0)-en+1,V=je.current.scrollLeft;V>B?je.current.scrollLeft=B:V<$&&(je.current.scrollLeft=$)}}},[Tt,en,W,Qe,Ue,Zt,ue]);(0,t.useEffect)(()=>{Ee&&ft(Ee)},[Ee,ft]),(0,t.useEffect)(()=>{A&&ft(A)},[A,ft]);const Rp=(0,t.useCallback)((k,B)=>{var $,V;D([...($=Pe.current)===null||$===void 0?void 0:$.slice(0,k),B,...(V=Pe.current)===null||V===void 0?void 0:V.slice(k+1)],[{type:"UPDATE",fromRowIndex:k,toRowIndex:k+1}])},[D]),cn=(0,t.useCallback)((k,B=k)=>{se||(Se(!1),ce($=>{const V=Math.min(Pe.current.length-2-B+k,k);return V<0?null:$&&{col:$.col,row:V}}),oe(null),D([...Pe.current.slice(0,k),...Pe.current.slice(B+1)],[{type:"DELETE",fromRowIndex:k,toRowIndex:B+1}]))},[se,D,ce,oe]),ts=(0,t.useCallback)((k=!0)=>{const B=k&&!Ce;if(!A)return;const $=(P==null?void 0:P.min)||A,V=(P==null?void 0:P.max)||A;if(R.slice($.row,V.row+1).every((ae,J)=>H.every(te=>te.isCellEmpty({rowData:ae,rowIndex:J+$.row})))){B&&cn($.row,V.row);return}const Y=[...R];for(let ae=$.row;ae<=V.row;++ae)for(let J=$.col;J<=V.col;++J)if(!Me({col:J,row:ae})){const{deleteValue:te=({rowData:le})=>le}=H[J+1];Y[ae]=te({rowData:Y[ae],rowIndex:ae})}if(B&&(0,g.default)(Y,R)){ce({col:0,row:$.row,doNotScrollX:!0}),oe({col:H.length-(ue?3:2),row:V.row,doNotScrollX:!0});return}D(Y,[{type:"UPDATE",fromRowIndex:$.row,toRowIndex:V.row+1}])},[A,H,R,cn,Me,D,P==null?void 0:P.max,P==null?void 0:P.min,ce,oe,ue]),ks=(0,t.useCallback)(({nextRow:k=!0}={})=>{(A==null?void 0:A.row)===Pe.current.length-1?k&&ie?dt(A.row):Se(!1):(Se(!1),k&&ce(B=>B&&{col:B.col,row:B.row+1}))},[A==null?void 0:A.row,ie,dt,ce]),_n=(0,t.useCallback)(k=>r(void 0,void 0,void 0,function*(){var B,$;if(!fe&&A){const V=[],Y=(P==null?void 0:P.min)||A,ae=(P==null?void 0:P.max)||A;for(let Q=Y.row;Q<=ae.row;++Q){V.push([]);for(let he=Y.col;he<=ae.col;++he){const{copyValue:be=()=>null}=H[he+1];V[Q-Y.row].push(be({rowData:R[Q],rowIndex:Q}))}}const J=V.map(Q=>Q.join("	")).join(`
`),te=`<table>${V.map(Q=>`<tr>${Q.map(he=>`<td>${(0,m.encodeHtml)(String(he??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(k!==void 0){(B=k.clipboardData)===null||B===void 0||B.setData("text/plain",J),($=k.clipboardData)===null||$===void 0||$.setData("text/html",te),k.preventDefault();return}let le=!1;if(navigator.clipboard.write!==void 0){const Q=new Blob([J],{type:"text/plain"}),he=new Blob([te],{type:"text/html"}),be=[new ClipboardItem({"text/plain":Q,"text/html":he})];yield navigator.clipboard.write(be).then(()=>{le=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(J).then(()=>{le=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(le=!0);le||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[A,H,R,fe,P]);(0,p.useDocumentEventListener)("copy",_n);const As=(0,t.useCallback)(k=>{!fe&&A&&(_n(k),ts(!1))},[A,ts,fe,_n]);(0,p.useDocumentEventListener)("cut",As);const wn=(0,t.useCallback)(k=>r(void 0,void 0,void 0,function*(){var B,$;if(!fe&&A){const V=(P==null?void 0:P.min)||A,Y=(P==null?void 0:P.max)||A,ae=yield Promise.all(k[0].map((J,te)=>{var le,Q;const he=(le=H[V.col+te+1])===null||le===void 0?void 0:le.prePasteValues,be=k.map(qe=>qe[te]);return(Q=he==null?void 0:he(be))!==null&&Q!==void 0?Q:be}));if(k=k.map((J,te)=>ae.map(le=>le[te])),k.length===1){const J=[...R];for(let te=0;te<k[0].length;te++){const le=(B=H[V.col+te+1])===null||B===void 0?void 0:B.pasteValue;if(le)for(let Q=V.row;Q<=Y.row;Q++)Me({col:te+V.col,row:Q})||(J[Q]=yield le({rowData:J[Q],value:k[0][te],rowIndex:Q}))}D(J,[{type:"UPDATE",fromRowIndex:V.row,toRowIndex:Y.row+1}]),ce({col:V.col,row:V.row}),oe({col:Math.min(V.col+k[0].length-1,H.length-(ue?3:2)),row:Y.row})}else{let J=[...R];const te=V.row+k.length-R.length;te>0&&(se?k.splice(k.length-te,te):J=[...J,...new Array(te).fill(0).map(()=>X())]);for(let Q=0;Q<k[0].length&&V.col+Q<H.length-(ue?2:1);Q++){const he=($=H[V.col+Q+1])===null||$===void 0?void 0:$.pasteValue;if(he)for(let be=0;be<k.length;be++)Me({col:V.col+Q,row:V.row+be})||(J[V.row+be]=yield he({rowData:J[V.row+be],value:k[be][Q],rowIndex:V.row+be}))}const le=[{type:"UPDATE",fromRowIndex:V.row,toRowIndex:V.row+k.length-(!se&&te>0?te:0)}];te>0&&!se&&le.push({type:"CREATE",fromRowIndex:V.row+k.length-te,toRowIndex:V.row+k.length}),D(J,le),ce({col:V.col,row:V.row}),oe({col:Math.min(V.col+k[0].length-1,H.length-(ue?3:2)),row:V.row+k.length-1})}}}),[A,H,X,R,fe,ue,Me,se,D,P==null?void 0:P.max,P==null?void 0:P.min,ce,oe]),Ip=(0,t.useCallback)(k=>{var B,$,V,Y,ae,J;if(A&&!fe){let te=[[""]];!((B=k.clipboardData)===null||B===void 0)&&B.types.includes("text/html")?te=(0,m.parseTextHtmlData)(($=k.clipboardData)===null||$===void 0?void 0:$.getData("text/html")):!((V=k.clipboardData)===null||V===void 0)&&V.types.includes("text/plain")?te=(0,m.parseTextPlainData)((Y=k.clipboardData)===null||Y===void 0?void 0:Y.getData("text/plain")):!((ae=k.clipboardData)===null||ae===void 0)&&ae.types.includes("text")&&(te=(0,m.parseTextPlainData)((J=k.clipboardData)===null||J===void 0?void 0:J.getData("text"))),wn(te),k.preventDefault()}},[A,wn,fe]);(0,p.useDocumentEventListener)("paste",Ip);const Np=(0,t.useCallback)(k=>{var B,$,V;if(tn&&nn.length)return;const Y=k.button===2||k.button===0&&k.ctrlKey,ae=((B=At.current)===null||B===void 0?void 0:B.contains(k.target))||!1,J=ae?jt(k,!0,!0):null;if(!ae&&fe&&A&&H[A.col+1].keepFocus)return;if(k.target instanceof HTMLElement&&k.target.className.includes("dsg-expand-rows-indicator")){Xa(Math.max(($=A==null?void 0:A.row)!==null&&$!==void 0?$:0,(V=P==null?void 0:P.max.row)!==null&&V!==void 0?V:0));return}const te=J&&A&&A.col===J.col&&A.row===J.row&&!Me(A);if(te&&fe)return;const le=(J==null?void 0:J.col)===H.length-2&&ue,Q=Y&&P&&J&&J.row>=P.min.row&&J.row<=P.max.row&&J.col>=P.min.col&&J.col<=P.max.col,he=Y&&P&&J&&J.row===-1&&J.col>=P.min.col&&J.col<=P.max.col,be=Y&&P&&J&&J.row>=P.min.row&&J.row<=P.max.row&&J.col===-1,qe=le&&P&&J&&J.row>=P.min.row&&J.row<=P.max.row;if(Y&&!es&&ze({x:k.clientX,y:k.clientY,cursorIndex:J}),(!(k.shiftKey&&A)||Y)&&R.length>0&&ce(J&&{col:(Q||he)&&A?A.col:Math.max(0,le?0:J.col),row:(Q||be||qe)&&A?A.row:Math.max(0,J.row),doNotScrollX:!!(Q&&A||le||J.col===-1),doNotScrollY:!!(Q&&A||J.row===-1)}),te&&!Y&&(St.current=A),Se(!!(te&&!Y)),on(J&&!Y?{columns:J.col!==-1&&!le||!!(k.shiftKey&&A),rows:J.row!==-1||!!(k.shiftKey&&A),active:!0}:{columns:!1,rows:!1,active:!1}),k.shiftKey&&A&&!Y)oe(J&&{col:Math.max(0,J.col-(le?1:0)),row:Math.max(0,J.row)});else if(!Q){if(J&&((J==null?void 0:J.col)===-1||(J==null?void 0:J.row)===-1||le)){let ke=J.col,De=J.row,Ae=!1,Ge=!1;(J.col===-1||le)&&(ke=H.length-(ue?3:2),Ae=!0),J.row===-1&&(De=R.length-1,Ge=!0),he&&Ee&&(ke=Ee.col,Ge=!0),(be||qe)&&Ee&&(De=Ee.row,Ae=!0),oe({col:ke,row:De,doNotScrollX:Ae,doNotScrollY:Ge})}else oe(null);ae&&k.preventDefault()}},[tn,nn.length,jt,fe,A,H,Me,P,ue,es,on,ce,oe,Ee,R.length]);(0,p.useDocumentEventListener)("mousedown",Np);const kp=(0,t.useCallback)(()=>{var k,B,$,V,Y,ae,J,te,le;if(sn!==null){if(rn>0&&A){let Q=[];const he=(P==null?void 0:P.min)||A,be=(P==null?void 0:P.max)||A;for(let qe=he.row;qe<=be.row;++qe){Q.push([]);for(let ke=he.col;ke<=be.col;++ke){const{copyValue:De=()=>null}=H[ke+1];Q[qe-he.row].push(String((k=De({rowData:R[qe],rowIndex:qe}))!==null&&k!==void 0?k:""))}}Promise.all(Q[0].map((qe,ke)=>{var De,Ae;const Ge=(De=H[he.col+ke+1])===null||De===void 0?void 0:De.prePasteValues,We=Q.map(Mp=>Mp[ke]);return(Ae=Ge==null?void 0:Ge(We))!==null&&Ae!==void 0?Ae:We})).then(qe=>{var ke;Q=Q.map((Ae,Ge)=>qe.map(We=>We[Ge]));const De=[...R];for(let Ae=0;Ae<Q[0].length;Ae++){const Ge=(ke=H[he.col+Ae+1])===null||ke===void 0?void 0:ke.pasteValue;if(Ge)for(let We=be.row+1;We<=be.row+rn;We++)Me({col:Ae+he.col,row:We})||(De[We]=Ge({rowData:De[We],value:Q[(We-be.row-1)%Q.length][Ae],rowIndex:We}))}D(De,[{type:"UPDATE",fromRowIndex:be.row+1,toRowIndex:be.row+1+rn}])}),Ka(0),ce({col:Math.min((B=A==null?void 0:A.col)!==null&&B!==void 0?B:1/0,($=P==null?void 0:P.min.col)!==null&&$!==void 0?$:1/0),row:Math.min((V=A==null?void 0:A.row)!==null&&V!==void 0?V:1/0,(Y=P==null?void 0:P.min.row)!==null&&Y!==void 0?Y:1/0),doNotScrollX:!0,doNotScrollY:!0}),oe({col:Math.max((ae=A==null?void 0:A.col)!==null&&ae!==void 0?ae:0,(J=P==null?void 0:P.max.col)!==null&&J!==void 0?J:0),row:Math.max((te=A==null?void 0:A.row)!==null&&te!==void 0?te:0,(le=P==null?void 0:P.max.row)!==null&&le!==void 0?le:0)+rn})}Xa(null)}on({columns:!1,rows:!1,active:!1})},[sn,on,rn,A,P==null?void 0:P.min,P==null?void 0:P.max,R,D,ce,oe,H,Me]);(0,p.useDocumentEventListener)("mouseup",kp);const Ap=(0,t.useCallback)(k=>{if(sn!==null){const B=jt(k);B&&(Ka(Math.max(0,B.row-sn)),ft({col:B.col,row:Math.max(B.row,sn)}))}if(ut.active){const B=jt(k),$=H.length-(ue?3:2);oe(B&&{col:ut.columns?Math.max(0,Math.min($,B.col)):$,row:ut.rows?Math.max(0,B.row):R.length-1,doNotScrollX:!ut.columns,doNotScrollY:!ut.rows}),Se(!1)}},[ft,ut.active,ut.columns,ut.rows,jt,H.length,ue,oe,R.length,sn]);(0,p.useDocumentEventListener)("mousemove",Ap);const Tp=(0,t.useCallback)(k=>{var B;if(A&&!k.isComposing){if(k.key==="Tab"&&!k.shiftKey&&A.col===H.length-(ue?3:2)&&!H[A.col+1].disableKeys)if(A.row===R.length-1){if(Ns.current){k.preventDefault(),ce(null),oe(null),Se(!1);const $=(0,_.getAllTabbableElements)(),V=$.indexOf(Ns.current);$[(V+1)%$.length].focus();return}}else{ce($=>{var V;return{col:0,row:((V=$==null?void 0:$.row)!==null&&V!==void 0?V:0)+1}}),oe(null),Se(!1),k.preventDefault();return}if(k.key==="Tab"&&k.shiftKey&&A.col===0&&!H[A.col+1].disableKeys)if(A.row===0){if(Is.current){k.preventDefault(),ce(null),oe(null),Se(!1);const $=(0,_.getAllTabbableElements)(),V=$.indexOf(Is.current);$[(V-1+$.length)%$.length].focus();return}}else{ce($=>{var V;return{col:H.length-(ue?3:2),row:((V=$==null?void 0:$.row)!==null&&V!==void 0?V:1)-1}}),oe(null),Se(!1),k.preventDefault();return}if(!((B=k.key)===null||B===void 0)&&B.startsWith("Arrow")||k.key==="Tab"){if(fe&&H[A.col+1].disableKeys||fe&&["ArrowLeft","ArrowRight"].includes(k.key))return;const $=([V,Y],ae)=>ae&&{col:Math.max(0,Math.min(H.length-(ue?3:2),ae.col+V)),row:Math.max(0,Math.min(R.length-1,ae.row+Y))};if(k.key==="Tab"&&k.shiftKey)ce(V=>$([-1,0],V)),oe(null);else{const V={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[k.key];(k.ctrlKey||k.metaKey)&&(V[0]*=H.length,V[1]*=R.length),k.shiftKey?oe(Y=>$(V,Y||A)):(ce(Y=>$(V,Y)),oe(null))}Se(!1),k.preventDefault()}else k.key==="Escape"?(!fe&&!Ee&&ce(null),oe(null),Se(!1)):(k.key==="Enter"||k.key==="F2")&&!k.ctrlKey&&!k.metaKey&&!k.altKey&&!k.shiftKey?(oe(null),fe?H[A.col+1].disableKeys||(ks(),k.preventDefault()):Me(A)||(St.current=A,Se(!0),ft(A),k.preventDefault())):k.key==="Enter"&&!k.ctrlKey&&!k.metaKey&&!k.altKey&&k.shiftKey?dt((P==null?void 0:P.max.row)||A.row):k.key==="d"&&(k.ctrlKey||k.metaKey)&&!k.altKey&&!k.shiftKey?(an((P==null?void 0:P.min.row)||A.row,P==null?void 0:P.max.row),k.preventDefault()):((0,m.isPrintableUnicode)(k.key)||k.code.match(/Key[A-Z]$/))&&!k.ctrlKey&&!k.metaKey&&!k.altKey?!fe&&!Me(A)&&(St.current=A,oe(null),Se(!0),ft(A)):["Backspace","Delete"].includes(k.key)?fe||(ts(),k.preventDefault()):k.key==="a"&&(k.ctrlKey||k.metaKey)&&(fe||(ce({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),oe({col:H.length-(ue?3:2),row:R.length-1,doNotScrollY:!0,doNotScrollX:!0}),k.preventDefault()))}},[A,H,R.length,ts,an,fe,dt,Me,ft,P==null?void 0:P.max.row,P==null?void 0:P.min.row,Ee,ce,oe,ks,ue]);(0,p.useDocumentEventListener)("keydown",Tp);const jp=(0,t.useCallback)(k=>{var B;const $=((B=At.current)===null||B===void 0?void 0:B.contains(k.target))||!1,V=$?jt(k,!0,!0):null,Y=V&&A&&A.col===V.col&&A.row===V.row&&fe;$&&!Y&&k.preventDefault()},[jt,A,fe]);(0,p.useDocumentEventListener)("contextmenu",jp),(0,t.useEffect)(()=>{const k=[];(A==null?void 0:A.row)!==void 0&&k.push({type:"COPY",action:()=>{_n(),ze(null)}},{type:"CUT",action:()=>{As(),ze(null)}},{type:"PASTE",action:()=>r(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach($=>r(void 0,void 0,void 0,function*(){let V=[[""]];if($.types.includes("text/html")){const Y=yield $.getType("text/html");V=(0,m.parseTextHtmlData)(yield Y.text())}else if($.types.includes("text/plain")){const Y=yield $.getType("text/plain");V=(0,m.parseTextPlainData)(yield Y.text())}else if($.types.includes("text")){const Y=yield $.getType("text");V=(0,m.parseTextHtmlData)(yield Y.text())}wn(V)}));else if(navigator.clipboard.readText!==void 0){const B=yield navigator.clipboard.readText();wn((0,m.parseTextPlainData)(B))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");ze(null)})}),(P==null?void 0:P.max.row)!==void 0?k.push({type:"INSERT_ROW_BELLOW",action:()=>{ze(null),dt(P.max.row)}}):(A==null?void 0:A.row)!==void 0&&k.push({type:"INSERT_ROW_BELLOW",action:()=>{ze(null),dt(A.row)}}),(P==null?void 0:P.min.row)!==void 0&&P.min.row!==P.max.row?k.push({type:"DUPLICATE_ROWS",fromRow:P.min.row+1,toRow:P.max.row+1,action:()=>{ze(null),an(P.min.row,P.max.row)}}):(A==null?void 0:A.row)!==void 0&&k.push({type:"DUPLICATE_ROW",action:()=>{ze(null),an(A.row)}}),(P==null?void 0:P.min.row)!==void 0&&P.min.row!==P.max.row?k.push({type:"DELETE_ROWS",fromRow:P.min.row+1,toRow:P.max.row+1,action:()=>{ze(null),cn(P.min.row,P.max.row)}}):(A==null?void 0:A.row)!==void 0&&k.push({type:"DELETE_ROW",action:()=>{ze(null),cn(A.row)}}),Op(k),k.length||ze(null)},[P,A,cn,an,dt,As,_n,wn]);const Za=(0,t.useRef)(nn);Za.current=nn;const Pp=(0,t.useCallback)(()=>Za.current,[]);(0,t.useImperativeHandle)(Rs,()=>({activeCell:(0,b.getCellWithId)(A,H),selection:(0,b.getSelectionWithId)(P??(A?{min:A,max:A}:null),H),setSelection:k=>{const B=(0,b.getSelection)(k,H.length-(ue?2:1),R.length,H);ce((B==null?void 0:B.min)||null),Se(!1),on({columns:!1,active:!1,rows:!1}),oe((B==null?void 0:B.max)||null)},setActiveCell:k=>{const B=(0,b.getCell)(k,H.length-(ue?2:1),R.length,H);ce(B),Se(!1),on({columns:!1,active:!1,rows:!1}),oe(null)}}));const Et=(0,t.useRef)({onFocus:de,onBlur:ve,onActiveCellChange:wt,onSelectionChange:Ct});return Et.current.onFocus=de,Et.current.onBlur=ve,Et.current.onActiveCellChange=wt,Et.current.onSelectionChange=Ct,(0,t.useEffect)(()=>{St.current&&(fe?Et.current.onFocus({cell:(0,b.getCellWithId)(St.current,H)}):Et.current.onBlur({cell:(0,b.getCellWithId)(St.current,H)}))},[fe,H]),(0,t.useEffect)(()=>{Et.current.onActiveCellChange({cell:(0,b.getCellWithId)(A,H)})},[A==null?void 0:A.col,A==null?void 0:A.row,H]),(0,t.useEffect)(()=>{Et.current.onSelectionChange({selection:(0,b.getSelectionWithId)(P??(A?{min:A,max:A}:null),H)})},[(kt=P==null?void 0:P.min.col)!==null&&kt!==void 0?kt:A==null?void 0:A.col,(gn=P==null?void 0:P.min.row)!==null&&gn!==void 0?gn:A==null?void 0:A.row,(yn=P==null?void 0:P.max.col)!==null&&yn!==void 0?yn:A==null?void 0:A.col,(Ye=P==null?void 0:P.max.row)!==null&&Ye!==void 0?Ye:A==null?void 0:A.row,A==null?void 0:A.col,A==null?void 0:A.row,H]),t.default.createElement("div",{className:M,style:T},t.default.createElement("div",{ref:Is,tabIndex:G.length&&R.length?0:void 0,onFocus:k=>{k.target.blur(),ce({col:0,row:0})}}),t.default.createElement(w.Grid,{columns:H,outerRef:je,columnWidths:Ue,hasStickyRightColumn:ue,displayHeight:Wa,data:R,fullWidth:Ha,headerRowHeight:W,activeCell:A,innerRef:At,rowHeight:Zt,rowKey:ee,selection:P,rowClassName:lt,editing:fe,getContextMenuItems:Pp,setRowData:Rp,deleteRows:cn,insertRowAfter:dt,duplicateRows:an,stopEditing:ks,cellClassName:Yt,onScroll:Qt},t.default.createElement(C.SelectionRect,{columnRights:Qe,columnWidths:Ue,activeCell:A,selection:P,headerRowHeight:W,rowHeight:Zt,hasStickyRightColumn:ue,dataLength:R.length,viewHeight:Tt,viewWidth:en,contentWidth:Ha?void 0:Ep,edges:Sp,editing:fe,isCellDisabled:Me,expandSelection:xp})),t.default.createElement("div",{ref:Ns,tabIndex:G.length&&R.length?0:void 0,onFocus:k=>{k.target.blur(),ce({col:H.length-(ue?3:2),row:R.length-1})}}),!se&&ge&&t.default.createElement(ge,{addRows:k=>dt(R.length-1,k)}),tn&&nn.length>0&&t.default.createElement(ct,{clientX:tn.x,clientY:tn.y,cursorIndex:tn.cursorIndex,items:nn,close:()=>ze(null)}))})),e.DataSheetGrid.displayName="DataSheetGrid"}(Be)),Be}var vt={},Rf;function Fv(){if(Rf)return vt;Rf=1;var e=vt&&vt.__rest||function(c,t){var s={};for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&t.indexOf(n)<0&&(s[n]=c[n]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(c);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(c,n[o])&&(s[n[o]]=c[n[o]]);return s},a=vt&&vt.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(vt,"__esModule",{value:!0}),vt.StaticDataSheetGrid=void 0;const u=F(),d=lp(),r=a(F());return vt.StaticDataSheetGrid=r.default.forwardRef((c,t)=>{var{columns:s,gutterColumn:n,stickyRightColumn:o,addRowsComponent:i,createRow:l,duplicateRow:p,style:h,rowKey:v,onFocus:y,onBlur:g,onActiveCellChange:f,onSelectionChange:m,rowClassName:b,rowHeight:_}=c,w=e(c,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[C]=(0,u.useState)({columns:s,gutterColumn:n,stickyRightColumn:o,addRowsComponent:i,createRow:l,duplicateRow:p,style:h,rowKey:v,onFocus:y,onBlur:g,onActiveCellChange:f,onSelectionChange:m,rowClassName:b,rowHeight:_});return r.default.createElement(d.DataSheetGrid,Object.assign({},C,w,{rowHeight:typeof _=="number"?_:C.rowHeight,ref:t}))}),vt}var Ne={},Ii={},If;function Jv(){if(If)return Ii;If=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.useFirstRender=void 0;const e=F(),a=()=>{const u=(0,e.useRef)(!0),d=u.current;return u.current=!1,d};return Ii.useFirstRender=a,Ii}var Nf;function Os(){if(Nf)return Ne;Nf=1;var e=Ne&&Ne.__createBinding||(Object.create?function(o,i,l,p){p===void 0&&(p=l);var h=Object.getOwnPropertyDescriptor(i,l);(!h||("get"in h?!i.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return i[l]}}),Object.defineProperty(o,p,h)}:function(o,i,l,p){p===void 0&&(p=l),o[p]=i[l]}),a=Ne&&Ne.__setModuleDefault||(Object.create?function(o,i){Object.defineProperty(o,"default",{enumerable:!0,value:i})}:function(o,i){o.default=i}),u=Ne&&Ne.__importStar||function(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&e(i,o,l);return a(i,o),i},d=Ne&&Ne.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.createTextColumn=Ne.textColumn=void 0;const r=u(F()),c=d(hn()),t=Jv(),s=r.default.memo(({active:o,focus:i,rowData:l,setRowData:p,columnData:{placeholder:h,alignRight:v,formatInputOnFocus:y,formatBlurredInput:g,parseUserInput:f,continuousUpdates:m}})=>{const b=(0,r.useRef)(null),_=(0,t.useFirstRender)(),w=(0,r.useRef)({rowData:l,formatInputOnFocus:y,formatBlurredInput:g,setRowData:p,parseUserInput:f,continuousUpdates:m,firstRender:_,focusedAt:0,changedAt:0,escPressed:!1});return w.current={rowData:l,formatInputOnFocus:y,formatBlurredInput:g,setRowData:p,parseUserInput:f,continuousUpdates:m,firstRender:_,focusedAt:w.current.focusedAt,changedAt:w.current.changedAt,escPressed:w.current.escPressed},(0,r.useLayoutEffect)(()=>{i?(b.current&&(b.current.value=w.current.formatInputOnFocus(w.current.rowData),b.current.focus(),b.current.select()),w.current.escPressed=!1,w.current.focusedAt=Date.now()):b.current&&(!w.current.escPressed&&!w.current.continuousUpdates&&!w.current.firstRender&&w.current.changedAt>=w.current.focusedAt&&w.current.setRowData(w.current.parseUserInput(b.current.value)),b.current.blur())},[i]),(0,r.useEffect)(()=>{!i&&b.current&&(b.current.value=w.current.formatBlurredInput(l))},[i,l]),r.default.createElement("input",{defaultValue:g(l),className:(0,c.default)("dsg-input",v&&"dsg-input-align-right"),placeholder:o?h:void 0,tabIndex:-1,ref:b,style:{pointerEvents:i?"auto":"none"},onChange:C=>{w.current.changedAt=Date.now(),m&&p(f(C.target.value))},onKeyDown:C=>{C.key==="Escape"&&(w.current.escPressed=!0)}})});s.displayName="TextComponent",Ne.textColumn=n();function n({placeholder:o,alignRight:i=!1,continuousUpdates:l=!0,deletedValue:p=null,parseUserInput:h=m=>m.trim()||null,formatBlurredInput:v=m=>String(m??""),formatInputOnFocus:y=m=>String(m??""),formatForCopy:g=m=>String(m??""),parsePastedValue:f=m=>m.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:s,columnData:{placeholder:o,alignRight:i,continuousUpdates:l,formatInputOnFocus:y,formatBlurredInput:v,parseUserInput:h},deleteValue:()=>p,copyValue:({rowData:m})=>g(m),pasteValue:({value:m})=>f(m),isCellEmpty:({rowData:m})=>m==null}}return Ne.createTextColumn=n,Ne}var it={},kf;function Uv(){if(kf)return it;kf=1;var e=it&&it.__createBinding||(Object.create?function(t,s,n,o){o===void 0&&(o=n);var i=Object.getOwnPropertyDescriptor(s,n);(!i||("get"in i?!s.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(t,o,i)}:function(t,s,n,o){o===void 0&&(o=n),t[o]=s[n]}),a=it&&it.__setModuleDefault||(Object.create?function(t,s){Object.defineProperty(t,"default",{enumerable:!0,value:s})}:function(t,s){t.default=s}),u=it&&it.__importStar||function(t){if(t&&t.__esModule)return t;var s={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&e(s,t,n);return a(s,t),s};Object.defineProperty(it,"__esModule",{value:!0}),it.checkboxColumn=void 0;const d=u(F()),r=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],c=d.default.memo(({focus:t,rowData:s,setRowData:n,active:o,stopEditing:i,disabled:l})=>{const p=(0,d.useRef)(null);return(0,d.useLayoutEffect)(()=>{t&&(n(!s),i({nextRow:!1}))},[t,i]),d.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:p,disabled:l,checked:!!s,onMouseDown:()=>!o&&n(!s),onChange:()=>null})});return c.displayName="CheckboxComponent",it.checkboxColumn={component:c,deleteValue:()=>!1,copyValue:({rowData:t})=>t?"YES":"NO",pasteValue:({value:t})=>!r.includes(t.toLowerCase()),isCellEmpty:({rowData:t})=>!t},it}var Ni={},Af;function zv(){if(Af)return Ni;Af=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.floatColumn=void 0;const e=Os();return Ni.floatColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:a=>typeof a=="number"?new Intl.NumberFormat().format(a):"",parseUserInput:a=>{const u=parseFloat(a);return isNaN(u)?null:u},parsePastedValue:a=>{const u=parseFloat(a);return isNaN(u)?null:u}}),Ni}var ki={},Tf;function Gv(){if(Tf)return ki;Tf=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.intColumn=void 0;const e=Os();return ki.intColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:a=>typeof a=="number"?new Intl.NumberFormat().format(a):"",parseUserInput:a=>{const u=parseFloat(a);return isNaN(u)?null:Math.round(u)},parsePastedValue:a=>{const u=parseFloat(a);return isNaN(u)?null:Math.round(u)}}),ki}var Ai={},jf;function Wv(){if(jf)return Ai;jf=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.percentColumn=void 0;const e=Os(),a=1e12,u=1e10;return Ai.percentColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(d):"",formatInputOnFocus:d=>typeof d=="number"&&!isNaN(d)?String(Math.round(d*a)/u):"",parseUserInput:d=>{const r=parseFloat(d);return isNaN(r)?null:r/100},parsePastedValue:d=>{const r=parseFloat(d);return isNaN(r)?null:r}}),Ai}var $e={},Pf;function Hv(){if(Pf)return $e;Pf=1;var e=$e&&$e.__createBinding||(Object.create?function(s,n,o,i){i===void 0&&(i=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(s,i,l)}:function(s,n,o,i){i===void 0&&(i=o),s[i]=n[o]}),a=$e&&$e.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),u=$e&&$e.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var o in s)o!=="default"&&Object.prototype.hasOwnProperty.call(s,o)&&e(n,s,o);return a(n,s),n},d=$e&&$e.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty($e,"__esModule",{value:!0}),$e.dateColumn=void 0;const r=u(F()),c=d(hn()),t=r.default.memo(({focus:s,active:n,rowData:o,setRowData:i})=>{var l;const p=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{var h,v;s?(h=p.current)===null||h===void 0||h.select():(v=p.current)===null||v===void 0||v.blur()},[s]),r.default.createElement("input",{className:(0,c.default)("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:p,style:{pointerEvents:s?"auto":"none",opacity:o||n?void 0:0},value:(l=o==null?void 0:o.toISOString().substr(0,10))!==null&&l!==void 0?l:"",onChange:h=>{const v=new Date(h.target.value);i(isNaN(v.getTime())?null:v)}})});return t.displayName="DateComponent",$e.dateColumn={component:t,deleteValue:()=>null,copyValue:({rowData:s})=>s?s.toISOString().substr(0,10):null,pasteValue:({value:s})=>{const n=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(n.getTime())?null:n},minWidth:170,isCellEmpty:({rowData:s})=>!s},$e}var Fe={},Mf;function Kv(){if(Mf)return Fe;Mf=1;var e=Fe&&Fe.__createBinding||(Object.create?function(s,n,o,i){i===void 0&&(i=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(s,i,l)}:function(s,n,o,i){i===void 0&&(i=o),s[i]=n[o]}),a=Fe&&Fe.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),u=Fe&&Fe.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var o in s)o!=="default"&&Object.prototype.hasOwnProperty.call(s,o)&&e(n,s,o);return a(n,s),n},d=Fe&&Fe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.isoDateColumn=void 0;const r=u(F()),c=d(hn()),t=r.default.memo(({focus:s,active:n,rowData:o,setRowData:i})=>{const l=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{var p,h;s?(p=l.current)===null||p===void 0||p.select():(h=l.current)===null||h===void 0||h.blur()},[s]),r.default.createElement("input",{className:(0,c.default)("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:l,style:{pointerEvents:s?"auto":"none",opacity:o||n?void 0:0},value:o??"",onChange:p=>{const h=new Date(p.target.value);i(isNaN(h.getTime())?null:h.toISOString().substr(0,10))}})});return t.displayName="IsoDateComponent",Fe.isoDateColumn={component:t,deleteValue:()=>null,copyValue:({rowData:s})=>s,pasteValue:({value:s})=>{const n=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(n.getTime())?null:n.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:s})=>!s},Fe}var Je={},qf;function Xv(){if(qf)return Je;qf=1;var e=Je&&Je.__createBinding||(Object.create?function(s,n,o,i){i===void 0&&(i=o);var l=Object.getOwnPropertyDescriptor(n,o);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(s,i,l)}:function(s,n,o,i){i===void 0&&(i=o),s[i]=n[o]}),a=Je&&Je.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),u=Je&&Je.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var o in s)o!=="default"&&Object.prototype.hasOwnProperty.call(s,o)&&e(n,s,o);return a(n,s),n},d=Je&&Je.__rest||function(s,n){var o={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.indexOf(i)<0&&(o[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(s);l<i.length;l++)n.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(s,i[l])&&(o[i[l]]=s[i[l]]);return o};Object.defineProperty(Je,"__esModule",{value:!0}),Je.keyColumn=void 0;const r=u(F()),c=s=>{var{columnData:{key:n,original:o},rowData:i,setRowData:l}=s,p=d(s,["columnData","rowData","setRowData"]);const h=(0,r.useRef)(i);h.current=i;const v=(0,r.useCallback)(g=>{l(Object.assign(Object.assign({},h.current),{[n]:g}))},[n,l]);if(!o.component)return r.default.createElement(r.default.Fragment,null);const y=o.component;return r.default.createElement(y,Object.assign({columnData:o.columnData,setRowData:v,rowData:i[n]},p))},t=(s,n)=>Object.assign(Object.assign({id:s},n),{columnData:{key:s,original:n},component:c,copyValue:({rowData:o,rowIndex:i})=>{var l,p;return(p=(l=n.copyValue)===null||l===void 0?void 0:l.call(n,{rowData:o[s],rowIndex:i}))!==null&&p!==void 0?p:null},deleteValue:({rowData:o,rowIndex:i})=>{var l,p;return Object.assign(Object.assign({},o),{[s]:(p=(l=n.deleteValue)===null||l===void 0?void 0:l.call(n,{rowData:o[s],rowIndex:i}))!==null&&p!==void 0?p:null})},pasteValue:({rowData:o,value:i,rowIndex:l})=>{var p,h;return Object.assign(Object.assign({},o),{[s]:(h=(p=n.pasteValue)===null||p===void 0?void 0:p.call(n,{rowData:o[s],value:i,rowIndex:l}))!==null&&h!==void 0?h:null})},disabled:typeof n.disabled=="function"?({rowData:o,rowIndex:i})=>{var l;return typeof n.disabled=="function"?n.disabled({rowData:o[s],rowIndex:i}):(l=n.disabled)!==null&&l!==void 0?l:!1}:n.disabled,cellClassName:typeof n.cellClassName=="function"?({rowData:o,rowIndex:i,columnId:l})=>{var p;return typeof n.cellClassName=="function"?n.cellClassName({rowData:o[s],rowIndex:i,columnId:l}):(p=n.cellClassName)!==null&&p!==void 0?p:void 0}:n.cellClassName,isCellEmpty:({rowData:o,rowIndex:i})=>{var l,p;return(p=(l=n.isCellEmpty)===null||l===void 0?void 0:l.call(n,{rowData:o[s],rowIndex:i}))!==null&&p!==void 0?p:!1}});return Je.keyColumn=t,Je}var Df;function Yv(){return Df||(Df=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.renderContextMenuItem=e.createContextMenuComponent=e.createAddRowsComponent=e.keyColumn=e.isoDateColumn=e.dateColumn=e.percentColumn=e.intColumn=e.floatColumn=e.checkboxColumn=e.createTextColumn=e.textColumn=e.DataSheetGrid=e.DynamicDataSheetGrid=void 0;const a=lp(),u=Fv();e.DynamicDataSheetGrid=a.DataSheetGrid,e.DataSheetGrid=u.StaticDataSheetGrid;var d=Os();Object.defineProperty(e,"textColumn",{enumerable:!0,get:function(){return d.textColumn}}),Object.defineProperty(e,"createTextColumn",{enumerable:!0,get:function(){return d.createTextColumn}});var r=Uv();Object.defineProperty(e,"checkboxColumn",{enumerable:!0,get:function(){return r.checkboxColumn}});var c=zv();Object.defineProperty(e,"floatColumn",{enumerable:!0,get:function(){return c.floatColumn}});var t=Gv();Object.defineProperty(e,"intColumn",{enumerable:!0,get:function(){return t.intColumn}});var s=Wv();Object.defineProperty(e,"percentColumn",{enumerable:!0,get:function(){return s.percentColumn}});var n=Hv();Object.defineProperty(e,"dateColumn",{enumerable:!0,get:function(){return n.dateColumn}});var o=Kv();Object.defineProperty(e,"isoDateColumn",{enumerable:!0,get:function(){return o.isoDateColumn}});var i=Xv();Object.defineProperty(e,"keyColumn",{enumerable:!0,get:function(){return i.keyColumn}});var l=ap();Object.defineProperty(e,"createAddRowsComponent",{enumerable:!0,get:function(){return l.createAddRowsComponent}});var p=cp();Object.defineProperty(e,"createContextMenuComponent",{enumerable:!0,get:function(){return p.createContextMenuComponent}}),Object.defineProperty(e,"renderContextMenuItem",{enumerable:!0,get:function(){return p.defaultRenderItem}})}(Qo)),Qo}var He=Yv();function Vf(e,a){switch(e.type){case"CREATE":return a==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const u=a==="undo"?e.previousValue:e.newValue;return u?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:u}:null}case"DELETE":return a==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function hs(e=[],a){const[u,d]=L.useState(e),r=L.useCallback(o=>{d(i=>{const l=[...i,o];return a&&l.length>a&&l.shift(),l})},[a]),c=L.useCallback(()=>{if(u.length===0)return;const o=u[u.length-1];return d(i=>i.slice(0,-1)),o},[u]),t=L.useCallback(()=>u[u.length-1],[u]),s=L.useCallback(()=>{d([])},[]),n=L.useCallback(()=>u.length===0,[u]);return{stack:u,push:r,pop:c,clear:s,peek:t,size:u.length,isEmpty:n}}try{hs.displayName="useStack",hs.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}const Qv=100,Zv=100;function ma(e){const a=hs([],Qv),u=hs([],Zv),[d,r]=L.useState(null),[c,t]=L.useState(null),s=!!d,n=!!c,o=S=>{r(S.currentTarget)},i=S=>{t(S.currentTarget)},l=()=>r(null),p=()=>t(null),h=L.useCallback(()=>{if(a.isEmpty())return null;const x=a.peek().type;let I=0;for(let N=a.stack.length-1;N>=0&&a.stack[N].type===x;N--)I++;return{lastType:x,sameTypeCount:I,totalActions:a.size}},[a.stack.length,a]),v=L.useCallback(()=>{if(u.isEmpty())return null;const x=u.peek().type;let I=0;for(let N=u.stack.length-1;N>=0&&u.stack[N].type===x;N--)I++;return{lastType:x,sameTypeCount:I,totalActions:u.size}},[u.stack.length,u]),y=h(),g=v(),f=L.useCallback(()=>{if(a.isEmpty())return;const S=a.pop();if(S){const x=Vf(S,"undo");if(!x)return;u.push(S),e(x)}l()},[e,a,u]),m=L.useCallback(()=>{if(u.isEmpty())return;const S=u.pop();if(S){const x=Vf(S,"redo");if(!x)return;a.push(S),e(x)}p()},[u,a,e]);L.useEffect(()=>{const S=x=>{x.ctrlKey&&x.key==="z"&&!x.shiftKey||x.metaKey&&x.key==="z"&&!x.shiftKey?(x.preventDefault(),f()):(x.ctrlKey&&x.key==="y"||x.ctrlKey&&x.shiftKey&&x.key==="z"||x.metaKey&&x.shiftKey&&x.key==="z")&&(x.preventDefault(),m())};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[f,m]);const b=S=>a.push(S),_=()=>a.clear(),w=()=>u.clear(),C=(S,x,I)=>{w();for(const N of S){const R=N.fromRowIndex,M=N.toRowIndex;if(N.type==="CREATE")for(let T=R;T<M;T++){const j=I[T];b({type:"CREATE",rowIndex:T,newValue:j})}if(N.type==="UPDATE"){const T=x.slice(R,M);I.slice(R,M).forEach((D,G)=>{const z=T[G],W=R+G;b({type:"UPDATE",rowIndex:W,previousValue:z,newValue:D})})}N.type==="DELETE"&&x.slice(R,M).forEach((j,D)=>{b({type:"DELETE",rowIndex:R+D,previousValue:j})})}},E=q.jsxs(q.Fragment,{children:[q.jsxs(Xt,{variant:"outlined","aria-controls":s?"undo-menu":void 0,"aria-haspopup":"true",onClick:o,disabled:!y,endIcon:q.jsx(ic,{}),children:["Undo ",y&&`(${y.totalActions})`]}),q.jsx(nc,{id:"undo-menu",anchorEl:d,open:s,onClose:l,children:y?q.jsxs(Ji,{onClick:f,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):q.jsx(Ji,{disabled:!0,children:"No actions to undo"})})]}),O=q.jsxs(q.Fragment,{children:[q.jsxs(Xt,{variant:"outlined","aria-controls":n?"redo-menu":void 0,"aria-haspopup":"true",onClick:i,disabled:!g,endIcon:q.jsx(ic,{}),children:["Redo ",g&&`(${g.totalActions})`]}),q.jsx(nc,{id:"redo-menu",anchorEl:c,open:n,onClose:p,children:g?q.jsxs(Ji,{onClick:m,children:["Redo last ",g.lastType.toLowerCase()," action"]},"lastAction"):q.jsx(Ji,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:f,addToUndoStack:b,clearUndoStack:_,addOperationsToUndoStack:C,undoUI:E,undoTotalActions:y?y.totalActions:0,redoPreview:g,redoUI:O,redoTotalActions:g?g.totalActions:0,handleRedo:m,clearRedoStack:w}}try{ma.displayName="useGridUndoRedo",ma.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}function eg(){const{mutateAsync:e}=v0(),{synapseClient:a}=fn();return at({mutationFn:async({createGridRequest:u,sessionId:d})=>{if(!(u||d))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(u){const r=await e(u);return console.log("Grid session started:",r),r.gridSession}return console.log(`Joining existing session ID: ${d}`),await a.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:d})}})}function tg(e){const{mutateAsync:a}=eg(),{mutateAsync:u}=b0();return at({...e,mutationFn:async({createGridRequest:d,sessionId:r})=>{if(!(d||r))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const c=await a({createGridRequest:d,sessionId:r}),t=c.sessionId;try{const s=await u(t);console.log("Replica created:",s);const n=s.replica;return{session:c,replica:n}}catch(s){throw new Error("Error starting session:",{cause:s})}}})}const ba=L.forwardRef((e,a)=>{const{show:u=!1,onSessionChange:d=ln,onReplicaChange:r=ln}=e,[c,t]=L.useState(""),{mutate:s}=tg({onMutate(p){console.debug("Starting grid session with args:",p)},onSuccess({session:p,replica:h}){d(p),r(h.replicaId)}}),{mutate:n}=g0({onSuccess:(p,h)=>{xt(`Successfully deleted grid session ${h}`,"success"),d(null),r(null)},onError:p=>{xt(p.reason,"danger")}}),{data:o}=y0({}),i=L.useMemo(()=>(o==null?void 0:o.pages.flatMap(p=>p.page||[]))||[],[o]),l=function(){s(ng(c))};return L.useImperativeHandle(a,()=>({handleStartSession:p=>{s({createGridRequest:p})},handleLoadSession:p=>{s({sessionId:p})}}),[s]),u?q.jsxs(Oe,{container:!0,spacing:2,sx:{mb:2},children:[q.jsx(Oe,{size:{xs:12},sx:{position:"relative"},children:q.jsx(Ia,{freeSolo:!0,fullWidth:!0,renderInput:p=>q.jsx(xa,{...p,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:i,getOptionLabel:p=>typeof p=="string"?p:p.sessionId||"",value:c,onInputChange:(p,h)=>{t(h)},onChange:(p,h)=>{h&&typeof h=="object"?(t(h.sessionId||""),s({sessionId:h.sessionId})):t(h||"")},onKeyDown:p=>{p.key==="Enter"&&l()},renderOption:(p,h)=>L.createElement(Ji,{...p,key:h.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},q.jsxs(Oe,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[q.jsx(Oe,{size:{xs:6,md:2},children:h.sessionId}),q.jsx(Oe,{size:{xs:5,md:2},children:h.sourceEntityId}),q.jsx(Oe,{size:{xs:0,md:6},children:h.gridJsonSchema$Id??"No schema"}),q.jsx(Oe,{size:{xs:1},children:q.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:v=>{v.stopPropagation(),n(h.sessionId)},children:"🗑️"})})]}))})}),q.jsx(Oe,{container:!0,size:12,justifyContent:"flex-end",children:q.jsx(Oa,{color:"primary",variant:"contained",onClick:()=>{l()},children:"Start Grid Session"})})]}):null});function ng(e){const a=U0(e);if(a.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query, Synapse ID, or session ID.");switch(a.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:a.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:a.input};case"recordSetId":return{createGridRequest:{recordSetId:a.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{ba.displayName="StartGridSession",ba.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function rg(e){const a=L.useMemo(()=>e?e.api.subscribe:()=>ln,[e]),u=L.useCallback(()=>e?e.api.getSnapshot():null,[e]);return L.useSyncExternalStore(a,u)}function ig(){const{synapseClient:e}=fn();return at({mutationFn:async({sessionId:a,replicaId:u})=>{const{presignedUrl:d}=await e.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:a,createGridPresignedUrlRequest:{gridSessionId:a,replicaId:u}});return d}})}class Zi{constructor(a){pe(this,"typeCode");this.typeCode=a}getJson(){throw new Error("Method should be implemented by subclass.")}}const up=8;class dp extends Zi{constructor(u,d){super(up);pe(this,"methodName");pe(this,"payload");this.methodName=u,this.payload=d}getMethodName(){return this.methodName}getPayload(){return this.payload}getJson(){const u=[this.typeCode,this.methodName];return this.payload!==void 0&&u.push(this.payload),u}}const fp=0;class sg extends Zi{constructor(u,d,r){super(fp);pe(this,"requestId");pe(this,"methodName");pe(this,"payload");this.requestId=u,this.methodName=d,this.payload=r}getJson(){const u=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&u.push(this.payload),u}}const hp=4;class pp extends Zi{constructor(u,d){super(hp);pe(this,"subscriptionId");pe(this,"payload");this.subscriptionId=u,this.payload=d}getPayload(){return this.payload}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const mp=5;class bp extends Zi{constructor(u,d){super(mp);pe(this,"subscriptionId");pe(this,"payload");this.subscriptionId=u,this.payload=d}getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}getJson(){const u=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&u.push(this.payload),u}}const vp=1;class Ui extends Zi{constructor(u,d,r){super(vp);pe(this,"requestId");pe(this,"methodName");pe(this,"payload");this.requestId=u,this.methodName=d,this.payload=r}setRequestId(u){this.requestId=u}getJson(){const u=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&u.push(this.payload),u}}class og{static fromJson(a){if(!Array.isArray(a))throw new Error("Invalid JSON-Rx message: not an array");const u=a[0];if(typeof u!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${u}`);switch(u){case fp:{const[d,r,c,t]=a;return new sg(r,c,t)}case vp:{const[d,r,c,t]=a;return new Ui(r,c,t)}case hp:{const[d,r,c]=a;return new pp(r,c)}case mp:{const[d,r,c]=a;return new bp(r,c)}case up:{const[d,r,c]=a;return new dp(r,c)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${u}`)}}}const ag=Math.pow(2,31)-1;class cg{constructor(){pe(this,"counter");this.counter=1}getNext(){const a=this.counter;return this.counter+=1,this.counter>ag&&(this.counter=1),a}}var sa={},oa={},Bf;function lg(){return Bf||(Bf=1,Object.defineProperty(oa,"__esModule",{value:!0})),oa}var Ti={},ji={},Wt={},Lf;function xs(){return Lf||(Lf=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.hasBuffer=Wt.alphabet=void 0,Wt.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wt.hasBuffer=typeof Te.Buffer=="function"&&typeof Te.Buffer.from=="function"),Wt}var Pi={},Mi={},$f;function ug(){if($f)return Mi;$f=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.flatstr=void 0;const e=a=>a;return Mi.flatstr=e,Mi}var Ff;function dg(){if(Ff)return Pi;Ff=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.createToBase64=void 0;const e=ug(),a=xs(),u=(d=a.alphabet,r="=")=>{if(d.length!==64)throw new Error("chars must be 64 characters long");const c=d.split(""),t=[];for(const o of c)for(const i of c){const l=(0,e.flatstr)(o+i);t.push(l)}const s=r,n=(0,e.flatstr)(r+r);return(o,i)=>{let l="";const p=i%3,h=i-p;for(let v=0;v<h;v+=3){const y=o[v],g=o[v+1],f=o[v+2],m=y<<4|g>>4,b=(g&15)<<8|f;l+=t[m]+t[b]}if(!p)return l;if(p===1){const v=o[h];l+=t[v<<4]+n}else{const v=o[h],y=o[h+1],g=v<<4|y>>4,f=(y&15)<<2;l+=t[g]+c[f]+s}return l}};return Pi.createToBase64=u,Pi}var Jf;function gp(){if(Jf)return ji;Jf=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.toBase64=void 0;const e=xs(),u=(0,dg().createToBase64)();return ji.toBase64=e.hasBuffer?d=>{const r=d.length;return r<=48?u(d,r):Te.Buffer.from(d).toString("base64")}:d=>u(d,d.length),ji}var Uf;function fg(){if(Uf)return Ti;Uf=1,Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.encode=void 0;const a=ne.__importStar(mn()),u=me(),d=gp(),r=(s,n)=>{const o=n.sid;return o===s?n.time:[o,n.time]},c=(s,n)=>{const o=r(s,n);return Array.isArray(o)?(o.push(n.span),o):[o,n.span]},t=s=>{const n=s.getId();if(!n)throw new Error("PATCH_EMPTY");const o=n.sid,i=n.time,l=o===1?[i]:[[o,i]],p=s.meta;p!==void 0&&l.push(p);const h=[l];for(const v of s.ops)if(v instanceof a.NewConOp){const y=v.val;y instanceof u.Timestamp?h.push([0,r(o,y),!0]):y===void 0?h.push([0]):h.push([0,y])}else if(v instanceof a.NewValOp)h.push([1]);else if(v instanceof a.NewObjOp)h.push([2]);else if(v instanceof a.NewVecOp)h.push([3]);else if(v instanceof a.NewStrOp)h.push([4]);else if(v instanceof a.NewBinOp)h.push([5]);else if(v instanceof a.NewArrOp)h.push([6]);else if(v instanceof a.InsValOp)h.push([9,r(o,v.obj),r(o,v.val)]);else if(v instanceof a.InsObjOp){const y=[];for(const[f,m]of v.data)y.push([f,r(o,m)]);const g=[10,r(o,v.obj),y];h.push(g)}else if(v instanceof a.InsVecOp){const y=[];for(const[f,m]of v.data)y.push([f,r(o,m)]);const g=[11,r(o,v.obj),y];h.push(g)}else if(v instanceof a.InsStrOp){const y=[12,r(o,v.obj),r(o,v.ref),v.data];h.push(y)}else if(v instanceof a.InsBinOp){const y=[13,r(o,v.obj),r(o,v.ref),(0,d.toBase64)(v.data)];h.push(y)}else if(v instanceof a.InsArrOp){const y=[];for(const f of v.data)y.push(r(o,f));const g=[14,r(o,v.obj),r(o,v.ref),y];h.push(g)}else if(v instanceof a.UpdArrOp){const y=[15,r(o,v.obj),r(o,v.ref),r(o,v.val)];h.push(y)}else if(v instanceof a.DelOp){const y=[16,r(o,v.obj),v.what.map(g=>c(o,g))];h.push(y)}else if(v instanceof a.NopOp){const y=[17],g=v.len;g>1&&y.push(g),h.push(y)}return h};return Ti.encode=t,Ti}var qi={},Di={},Vi={},zf;function hg(){if(zf)return Vi;zf=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.bufferToUint8Array=void 0;const e=a=>new Uint8Array(a.buffer,a.byteOffset,a.length);return Vi.bufferToUint8Array=e,Vi}var Bi={},Gf;function pg(){if(Gf)return Bi;Gf=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.createFromBase64=void 0;const e=xs(),a="=",u=(d=e.alphabet,r=!1)=>{if(d.length!==64)throw new Error("chars must be 64 characters long");let c=0;for(let s=0;s<d.length;s++)c=Math.max(c,d.charCodeAt(s));const t=[];for(let s=0;s<=c;s+=1)t[s]=-1;for(let s=0;s<d.length;s++)t[d.charCodeAt(s)]=s;return s=>{if(!s)return new Uint8Array(0);let n=s.length;if(r){const y=n%4;y===2?(s+="==",n+=2):y===3&&(s+="=",n+=1)}if(n%4!==0)throw new Error("Base64 string length must be a multiple of 4");const o=s[n-1]!==a?n:n-4;let i=(n>>2)*3,l=0;s[n-2]===a?(l=2,i-=2):s[n-1]===a&&(l=1,i-=1);const p=new Uint8Array(i);let h=0,v=0;for(;v<o;v+=4){const y=t[s.charCodeAt(v)],g=t[s.charCodeAt(v+1)],f=t[s.charCodeAt(v+2)],m=t[s.charCodeAt(v+3)];if(y<0||g<0||f<0||m<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|g>>4,p[h+1]=g<<4|f>>2,p[h+2]=f<<6|m,h+=3}if(l===2){const y=t[s.charCodeAt(o)],g=t[s.charCodeAt(o+1)];if(y<0||g<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|g>>4}else if(l===1){const y=t[s.charCodeAt(o)],g=t[s.charCodeAt(o+1)],f=t[s.charCodeAt(o+2)];if(y<0||g<0||f<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|g>>4,p[h+1]=g<<4|f>>2}return p}};return Bi.createFromBase64=u,Bi}var Wf;function mg(){if(Wf)return Di;Wf=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.fromBase64=void 0;const e=hg(),a=xs(),u=pg(),d=a.hasBuffer?c=>(0,e.bufferToUint8Array)(Te.Buffer.from(c,"base64")):null,r=(0,u.createFromBase64)();return Di.fromBase64=d?c=>c.length>48?d(c):r(c):r,Di}var Hf;function bg(){if(Hf)return qi;Hf=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.decode=void 0;const e=mg(),a=me(),u=Cs(),d=(t,s)=>Array.isArray(s)?new a.Timestamp(s[0],s[1]):new a.Timestamp(t,s),r=(t,s)=>s.length===3?new a.Timespan(s[0],s[1],s[2]):new a.Timespan(t,s[0],s[1]),c=t=>{const s=t[0],n=s[0],o=Array.isArray(n)?new a.ClockVector(n[0],n[1]):new a.ServerClockVector(1,n),i=o.sid;o.time;const l=new u.PatchBuilder(o),p=t.length;for(let v=1;v<p;v++){const y=t[v];switch(y[0]){case 0:{const[,g,f]=y;l.con(f?d(i,g):g);break}case 1:{l.val();break}case 2:{l.obj();break}case 3:{l.vec();break}case 4:{l.str();break}case 5:{l.bin();break}case 6:{l.arr();break}case 9:{l.setVal(d(i,y[1]),d(i,y[2]));break}case 10:{const g=d(i,y[1]),f=[],m=y[2],b=m.length;for(let _=0;_<b;_++){const[w,C]=m[_];f.push([w,d(i,C)])}l.insObj(g,f);break}case 11:{const g=d(i,y[1]),f=[],m=y[2],b=m.length;for(let _=0;_<b;_++){const[w,C]=m[_];f.push([w,d(i,C)])}l.insVec(g,f);break}case 12:{l.insStr(d(i,y[1]),d(i,y[2]),y[3]);break}case 13:{l.insBin(d(i,y[1]),d(i,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const g=d(i,y[1]),f=d(i,y[2]),m=y[3],b=[],_=m.length;for(let w=0;w<_;w++)b.push(d(i,m[w]));l.insArr(g,f,b);break}case 15:{const g=d(i,y[1]),f=d(i,y[2]),m=d(i,y[3]);l.updArr(g,f,m);break}case 16:{const g=d(i,y[1]),f=y[2],m=[],b=f.length;for(let _=0;_<b;_++)m.push(r(i,f[_]));l.del(g,m);break}case 17:{l.nop(y[1]||1);break}}}const h=l.patch;return h.meta=s[1],h};return qi.decode=c,qi}var Kf;function vg(){return Kf||(Kf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const a=ne;a.__exportStar(lg(),e),a.__exportStar(fg(),e),a.__exportStar(bg(),e)}(sa)),sa}var ps=vg();function Xf(e){return new TextEncoder().encode(JSON.stringify(e)).length}function gg(e){const a=ps.decode(e),u=a.getId(),d=a.span();return[[u==null?void 0:u.sid,u.time+d]]}function yg(e,a){if(!e.ops||e.ops.length===0)return[];const u=ps.encode(e),d=Xf(u);if(d<=a)return[u];if(e.ops.length==1)return console.warn(`Patch is too large (${d} B) but cannot be split further since it only contains one operation.`),[u];const r=u[0],c=[];let t=[r];for(let s=1;s<u.length;s+=1){const n=t.length-1;Xf([...t,u[s]])>a&&n>0&&(c.push(t),t=[gg(t)]),t.push(u[s])}return t.length>1&&c.push(t),c}var _g=Xi(),Li={},Yf;function wg(){if(Yf)return Li;Yf=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.Encoder=void 0;const a=ne.__importStar(It()),u=gp(),d=me();let r=class{encode(t){this.model=t;const s=t.clock;return{time:s.sid===1?s.time:this.cClock(t.clock),root:this.cVal(t.root)}}cClock(t){const s=[],n=t.sid;t.peers.get(n)||s.push([n,t.time]);for(const i of t.peers.values())s.push([i.sid,i.time]);return s}cTs(t){return t.sid===1?t.time:[t.sid,t.time]}cNode(t){if(t instanceof a.ObjNode)return this.cObj(t);if(t instanceof a.ArrNode)return this.cArr(t);if(t instanceof a.StrNode)return this.cStr(t);if(t instanceof a.ValNode)return this.cVal(t);if(t instanceof a.ConNode)return this.cCon(t);if(t instanceof a.BinNode)return this.cBin(t);if(t instanceof a.VecNode)return this.cVec(t);throw new Error("UNKNOWN_NODE")}cObj(t){const s={};return t.nodes((n,o)=>{s[o]=this.cNode(n)}),{type:"obj",id:this.cTs(t.id),map:s}}cVec(t){const s=[],n=t.elements,o=n.length,i=this.model.index;for(let l=0;l<o;l++){const p=n[l];p===void 0?s.push(null):s.push(this.cNode(i.get(p)))}return{type:"vec",id:this.cTs(t.id),map:s}}cArr(t){const s=[],n=t.iterator();let o;for(;o=n();)s.push(this.cArrChunk(o));return{type:"arr",id:this.cTs(t.id),chunks:s}}cArrChunk(t){if(t.del)return{id:this.cTs(t.id),span:t.span};const s=this.model.index;return{id:this.cTs(t.id),value:t.data.map(o=>this.cNode(s.get(o)))}}cStr(t){const s=[],n=t.iterator();let o;for(;o=n();)s.push(this.cStrChunk(o));return{type:"str",id:this.cTs(t.id),chunks:s}}cStrChunk(t){return t.del?{id:this.cTs(t.id),span:t.span}:{id:this.cTs(t.id),value:t.data}}cBin(t){const s=[],n=t.iterator();let o;for(;o=n();)s.push(this.cBinChunk(o));return{type:"bin",id:this.cTs(t.id),chunks:s}}cBinChunk(t){return t.del?{id:this.cTs(t.id),span:t.span}:{id:this.cTs(t.id),value:(0,u.toBase64)(t.data)}}cVal(t){return{type:"val",id:this.cTs(t.id),value:this.cNode(t.node())}}cCon(t){const s={type:"con",id:this.cTs(t.id)},n=t.val;return n instanceof d.Timestamp?(s.timestamp=!0,s.value=this.cTs(n)):n!==void 0&&(s.value=n),s}};return Li.Encoder=r,Li}var Cg=wg();const Sg=30*1024,Eg=250;class Og{constructor(a){pe(this,"socket");pe(this,"model",null);pe(this,"messageCounter");pe(this,"replicaId");pe(this,"verboseEncoder",new Cg.Encoder);pe(this,"maxPayloadSizeBytes");pe(this,"throttledSendPatch");pe(this,"onModelCreate",ln);pe(this,"onGridReady",ln);pe(this,"onStatusChange",ln);pe(this,"messageHandler",a=>{var u,d;if(a instanceof pp){const r=a.getPayload();try{const c=ps.decode(r);this.model?(console.debug("Applying patch from server:",c),(u=this.model)==null||u.applyPatch(c)):(console.debug("Initializing new model from patch:"),console.debug(c.toString()),this.model=_g.Model.fromPatches([c]).fork(this.replicaId),this.onModelCreate(this.model));const t=(d=this.model)==null?void 0:d.api.flush();let s;if((t==null?void 0:t.ops.length)!==0&&(s=ps.encode(t)),s){const n=new Ui(this.messageCounter.getNext(),"patch",s);console.debug("Responding with patch:",n),this.sendMessage(n)}else{const n=this.verboseEncoder.encode(this.model);this.sendSyncMessage(n.time)}}catch(c){console.error("Failed to apply patch or send clock:",c)}}else if(a instanceof bp)this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(a instanceof dp){const r=a.getMethodName();if(console.debug("Message received from server:",r),r==="ping"&&console.debug("Received ping response from server"),r==="connected"){console.debug("Server ready to receive patches");const c=this.model?this.verboseEncoder.encode(this.model):null;this.sendSyncMessage(c==null?void 0:c.time)}if(r==="error"){console.warn("Error from server:",a.getPayload());return}if(r==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const c=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",c.time);const t=new Ui(this.messageCounter.getNext(),"synchronize-clock",c.time);this.sendMessage(t)}}else console.warn("Unexpected WebSocket message format:",a)});const{replicaId:u,url:d,onGridReady:r,onStatusChange:c,onModelCreate:t,maxPayloadSizeBytes:s,socket:n,model:o,patchThrottleMs:i}=a;this.messageCounter=new cg,this.replicaId=u,this.maxPayloadSizeBytes=s??Sg,this.socket=n??new WebSocket(d),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=l=>{typeof l.data=="string"?this.handleMessage(l.data):console.error("Received non-string message data:",l.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=l=>{console.error("WebSocket error:",l)},t&&(this.onModelCreate=t),r&&(this.onGridReady=r),c&&(this.onStatusChange=c),this.model=o||null,this.throttledSendPatch=R0(()=>this.sendPatchImmediate(),i??Eg,{leading:!1,trailing:!0})}disconnect(){this.throttledSendPatch.flush(),this.throttledSendPatch.cancel(),this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(a){this.messageHandler(og.fromJson(JSON.parse(a)))}sendMessage(a){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",a),this.socket.send(JSON.stringify(a.getJson()))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){this.throttledSendPatch()}sendPatchImmediate(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const a=this.model.api.flush();a&&yg(a,this.maxPayloadSizeBytes).forEach(d=>{console.debug("Sending patch to server:",d);const r=new Ui(this.messageCounter.getNext(),"patch",d);this.sendMessage(r)})}sendSyncMessage(a=[]){const u=new Ui(this.messageCounter.getNext(),"synchronize-clock",a);this.sendMessage(u)}}function xg(e){const{mutateAsync:a}=ig(),[u,d]=L.useState(null),r=L.useCallback(()=>{d(null)},[]);return{...at({retry:5,retryDelay:t=>Math.min(t>1?2**t*1e3:1e3,30*1e3),mutationFn:async({replicaId:t,sessionId:s,websocketOptions:n})=>{if(!t)throw new Error("replicaId is required");const o=await a({replicaId:t,sessionId:s});return d(o),new Og({replicaId:t,url:o,...n||{}})},...e}),presignedUrl:u,clearPresignedUrl:r}}function Rg(e,a){switch(a.type){case"CONNECT_REQUESTED":{const u=e.connectionParams&&e.connectionParams.replicaId===a.payload.replicaId&&e.connectionParams.sessionId===a.payload.sessionId;return{...e,connectionParams:{replicaId:a.payload.replicaId,sessionId:a.payload.sessionId},isGridReady:u?e.isGridReady:!1,model:u?e.model:null,isConnected:!1,isConnecting:!1,connectionAttemptId:a.payload.attemptId,connectionError:null}}case"CONNECTION_ESTABLISHED":return{...e,websocketInstance:a.payload,isConnecting:!0};case"CONNECTION_OPENED":return{...e,isConnected:!0,isConnecting:!1};case"CONNECTION_CLOSED":return{...e,isConnected:!1,isConnecting:!1};case"GRID_READY":return{...e,isGridReady:!0};case"MODEL_CREATED":return{...e,model:a.payload};case"CONNECTION_ERROR":return{...e,connectionError:a.payload,isConnecting:!1};default:return e}}const Ig={model:null,isGridReady:!1,isConnected:!1,isConnecting:!1,connectionParams:null,websocketInstance:null,connectionAttemptId:null,connectionError:null};function Ng(){const[e,a]=L.useReducer(Rg,Ig),u=L.useRef(0),d=L.useRef(null),r=rg(e.model),c=T0(),{mutateAsync:t,isPending:s,error:n,presignedUrl:o,reset:i,clearPresignedUrl:l}=xg(),p=L.useCallback(g=>{a({type:"MODEL_CREATED",payload:g})},[a]),h=L.useMemo(()=>({onGridReady:()=>a({type:"GRID_READY"}),onStatusChange:g=>a({type:g?"CONNECTION_OPENED":"CONNECTION_CLOSED"}),onModelCreate:p}),[p]),v=L.useCallback((g,f)=>{i(),(!e.connectionParams||e.connectionParams.replicaId!==g||e.connectionParams.sessionId!==f)&&l(),u.current+=1;const b=u.current;a({type:"CONNECT_REQUESTED",payload:{replicaId:g,sessionId:f,attemptId:b}})},[a,e.connectionParams,i,l,u]);L.useEffect(()=>{const{connectionParams:g,connectionAttemptId:f}=e;!g||f===null||e.isConnected||e.isConnecting||s||n||e.connectionError||!c||(d.current=f,t({replicaId:g.replicaId,sessionId:g.sessionId,websocketOptions:{...h,model:e.model}}).then(m=>{if(d.current!==f){m.disconnect();return}a({type:"CONNECTION_ESTABLISHED",payload:m})}).catch(m=>{a({type:"CONNECTION_ERROR",payload:m}),console.error("Failed to establish WebSocket",m)}))},[e,e.connectionParams,e.connectionAttemptId,e.isConnected,e.isConnecting,s,n,c,t,h]);const y=L.useRef(null);return L.useEffect(()=>{var m;const g=y.current,f=e.connectionParams;g&&f&&(g.replicaId!==f.replicaId||g.sessionId!==f.sessionId)&&((m=e.websocketInstance)==null||m.disconnect()),y.current=f},[e.connectionParams,e.websocketInstance]),L.useEffect(()=>()=>{var g;(g=e.websocketInstance)==null||g.disconnect(),d.current=null},[e.websocketInstance]),{isConnected:e.isConnected,websocketInstance:e.websocketInstance,isGridReady:e.isGridReady,model:e.model,modelSnapshot:r,connect:v,presignedUrl:o,errorEstablishingWebsocketConnection:e.connectionError??n}}var Ht=Ss();function kg(e,a){const u=e.api.arr(["rows"]),{columnNames:d}=e.api.getSnapshot();switch(a.type){case"CREATE":{const r=d.map(c=>Ht.s.con(a.rowData[c]??null));u==null||u.ins(a.rowIndex,[Ht.s.obj({data:Ht.s.vec(...r),metadata:Ht.s.obj({})})]);break}case"DELETE":u==null||u.del(a.rowIndex,a.count??1);break;case"UPDATE":{Object.entries(a.updatedData).forEach(([r,c])=>{if(r.startsWith("_"))return;const t=d.indexOf(r);if(t!==-1){const s=e.api.vec(["rows",String(a.rowIndex),"data"]);s==null||s.set([[t,Ht.s.con(c)]])}});break}case"SET_SELECTION":{e.api.obj().has("selection")||e.api.obj().add(["selection"],Ht.s.obj({})),e.api.obj(["selection"]).set({[a.replicaId]:Ht.s.con(a.selection)});break}}}function Ag(e){const{rowData:a,rowIndex:u,columnId:d,selectedRowIndex:r,lastSelection:c,colValues:t}=e,s=r===u,n=a.__cellValidationResults,o=n&&d&&n.has(d),i=[];s&&i.push("cell-row-selected");let l=!1;return c&&d&&t&&(l=u>=c.min.row&&u<=c.max.row&&t.findIndex(p=>p.id===d)>=c.min.col&&t.findIndex(p=>p.id===d)<=c.max.col,l&&i.push("cell-selected")),o&&i.push("cell-invalid"),i.length?ch(i):void 0}function Tg(e,a,u){const d=[];return e.forEach(r=>{if(r.type==="CREATE")for(let c=r.fromRowIndex;c<r.toRowIndex;c++)d.push({type:"CREATE",rowIndex:c,rowData:a[c]});if(r.type==="UPDATE")for(let c=r.fromRowIndex;c<r.toRowIndex;c++)d.push({type:"UPDATE",rowIndex:c,updatedData:a[c]});r.type==="DELETE"&&d.push({type:"DELETE",rowIndex:r.fromRowIndex,count:r.toRowIndex-r.fromRowIndex})}),d}function zi(e,a){if(!a||a==="string")return String(e);if(a==="number"||a==="integer"){if(e.trim()==="")return e;let u;return a==="integer"?u=parseInt(e,10):u=Number(e),isNaN(u)?e:u}else{if(a==="boolean")return e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e;if(a==="object"||a==="array")try{return JSON.parse(e)}catch{return e}else return a==="null"&&(e.toLowerCase()==="null"||e.trim()==="")?null:e}}function ot(e){return typeof e=="object"?JSON.stringify(e):String(e)}function va({rowData:e,setRowData:a,choices:u,colType:d}){const[r,c]=L.useState(ot(e));return q.jsx(Ia,{freeSolo:!0,disablePortal:!1,options:u,getOptionLabel:t=>ot(t),value:e,onInputChange:(t,s)=>{c(s)},onChange:(t,s,n)=>{a(n==="createOption"?zi(s,d):s),c(ot(s))},blurOnSelect:!1,onBlur:t=>{r!==ot(e)&&a(zi(r,d))},renderInput:t=>q.jsx(xa,{...t,slotProps:{input:{...t.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}}})}function ga({choices:e,colType:a}){return{component:u=>q.jsx(va,{...u,choices:e,colType:a}),copyValue:({rowData:u})=>u,pasteValue:({value:u})=>u,disableKeys:!0,keepFocus:!0}}try{ot.displayName="castCellValueToString",ot.__docgenInfo={description:"",displayName:"castCellValueToString",props:{}}}catch{}try{va.displayName="AutocompleteCell",va.__docgenInfo={description:"",displayName:"AutocompleteCell",props:{rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"any"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean"}},focus:{defaultValue:null,description:"",name:"focus",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},columnData:{defaultValue:null,description:"",name:"columnData",required:!0,type:{name:"any"}},setRowData:{defaultValue:null,description:"",name:"setRowData",required:!0,type:{name:"((rowData: any) => void) & ((value: AutocompleteOption) => void)"}},stopEditing:{defaultValue:null,description:"",name:"stopEditing",required:!0,type:{name:"(opts?: { nextRow?: boolean; }) => void"}},insertRowBelow:{defaultValue:null,description:"",name:"insertRowBelow",required:!0,type:{name:"() => void"}},duplicateRow:{defaultValue:null,description:"",name:"duplicateRow",required:!0,type:{name:"() => void"}},deleteRow:{defaultValue:null,description:"",name:"deleteRow",required:!0,type:{name:"() => void"}},getContextMenuItems:{defaultValue:null,description:"",name:"getContextMenuItems",required:!0,type:{name:"() => ContextMenuItem[]"}},choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}try{ga.displayName="autocompleteColumn",ga.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}function ya({option:e,active:a=!1,...u}){return q.jsx(_0,{...u,label:ot(e),sx:{maxWidth:a?"none":"120px",fontSize:"0.75rem",height:"24px",margin:"1px",flexShrink:0,...u.sx}})}try{ya.displayName="GridAutocompleteChip",ya.__docgenInfo={description:"",displayName:"GridAutocompleteChip",props:{option:{defaultValue:null,description:"",name:"option",required:!0,type:{name:"unknown"}},active:{defaultValue:{value:"false"},description:"",name:"active",required:!1,type:{name:"boolean"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}},slots:{defaultValue:{value:"{}"},description:"The components used for each slot inside.",name:"slots",required:!1,type:{name:"Partial<ChipSlots>"}},slotProps:{defaultValue:{value:"{}"},description:"The props used for each slot inside.",name:"slotProps",required:!1,type:{name:'{ root?: SlotProps<"div", {}, ChipOwnerState>; label?: SlotProps<"span", {}, ChipOwnerState>; }'}}}}}catch{}function Qf(e){return{label:ot(e),value:e}}function _a(e){return Array.isArray(e)?e:t0(e)?[]:[e]}function jg({rowData:e,setRowData:a,choices:u,colType:d,limitTags:r=2,active:c}){const[t,s]=L.useState(""),n=_a(e),o=u.map(Qf),i=n.map(Qf),l=c?-1:r,p=n.length>0?n.map(h=>ot(h)).join(","):"";return q.jsx(n0,{title:p,placement:"top-start",arrow:!0,enterDelay:500,disableHoverListener:c||n.length<=r,children:q.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:q.jsx(Ia,{multiple:!0,freeSolo:!0,disablePortal:!1,limitTags:l,options:o,getOptionLabel:h=>typeof h=="string"?h:h.label,isOptionEqualToValue:(h,v)=>{const y=typeof h=="string"?h:h.value,g=typeof v=="string"?v:v.value;return oh(y,g)},value:i,inputValue:t,onInputChange:(h,v)=>{s(v)},onChange:(h,v,y)=>{const g=(v||[]).map(f=>typeof f=="string"?zi(f,d):f.value);a(g),s("")},onBlur:()=>{if(t.trim()){const h=zi(t,d);a([...n,h]),s("")}},renderValue:(h,v)=>h.map((y,g)=>{const{key:f,...m}=v({index:g}),b=typeof y=="string"?y:y.value;return q.jsx(ya,{option:b,active:c,...m},f)}),renderInput:h=>q.jsx(xa,{...h,slotProps:{input:{...h.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit",flexWrap:c?"wrap":"nowrap",minHeight:"100%",maxHeight:"100%",overflowY:c?"auto":"hidden",overflowX:"hidden","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"3px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555"}},"& .MuiFormControl-root":{height:"100%"},"& .MuiAutocomplete-tag":{margin:"1px"}}})})})}function wa({choices:e,colType:a,limitTags:u=2,dynamicHeight:d=!1}){return{component:r=>q.jsx(jg,{...r,choices:e,colType:a,limitTags:u}),copyValue:({rowData:r})=>_a(r).map(t=>ot(t)).join(","),pasteValue:({value:r})=>{if(typeof r!="string")return r;const c=/[,\t]/,t=r.split(c).map(s=>s.trim()).filter(s=>s.length>0).map(s=>zi(s,a)).filter(s=>s!=null);return t.length>0?t:[]},disableKeys:!0,keepFocus:!0,...d&&{cellClassName:({rowData:r})=>_a(r).length>3?"multi-value-cell-large":"multi-value-cell"}}}try{wa.displayName="autocompleteMultipleEnumColumn",wa.__docgenInfo={description:"",displayName:"autocompleteMultipleEnumColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"unknown[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},limitTags:{defaultValue:{value:"2"},description:"",name:"limitTags",required:!1,type:{name:"number"}},dynamicHeight:{defaultValue:{value:"false"},description:"",name:"dynamicHeight",required:!1,type:{name:"boolean"}}}}}catch{}function $i(e){return e?"header-cell-required":"header-cell"}const Pg={multipleEnum:e=>{var a;return{...He.keyColumn(e.columnName,wa({choices:e.enumeratedValues??[],colType:((a=e.typeInfo)==null?void 0:a.type)||null,limitTags:3})),title:e.columnName,headerClassName:$i(e.isRequired),minWidth:Fi(e.columnName)}},boolean:e=>({...He.keyColumn(e.columnName,He.checkboxColumn),title:e.columnName,headerClassName:$i(e.isRequired),minWidth:Fi(e.columnName)}),number:e=>({...He.keyColumn(e.columnName,He.floatColumn),title:e.columnName,headerClassName:$i(e.isRequired),minWidth:Fi(e.columnName)}),enumerated:e=>{var a;return{...He.keyColumn(e.columnName,ga({choices:e.enumeratedValues??[],colType:((a=e.typeInfo)==null?void 0:a.type)||null})),title:e.columnName,headerClassName:$i(e.isRequired),minWidth:Fi(e.columnName)}},text:e=>({...He.keyColumn(e.columnName,He.createTextColumn({continuousUpdates:!1})),title:e.columnName,headerClassName:$i(e.isRequired),minWidth:Fi(e.columnName)})};function Fi(e){return Math.max(175,e.length*10)}function Mg(e,a){return e?e.type==="array"?"multipleEnum":e.type==="boolean"?"boolean":e.type==="number"||e.type==="integer"?"number":a&&a.length>0?"enumerated":"text":a&&a.length>0?"enumerated":"text"}function qg(e){const a=Mg(e.typeInfo,e.enumeratedValues);return Pg[a](e)}function Dg(e,a){if(!e)return[];const{columnNames:u,columnOrder:d}=e;return d.map(r=>{const c=u[r],t=a[c];return qg({columnName:c,typeInfo:(t==null?void 0:t.type)||null,enumeratedValues:(t==null?void 0:t.enumeratedValues)||[],isRequired:(t==null?void 0:t.isRequired)||!1})})}function Ca({gridSessionId:e,usersReplicaId:a,chatbotName:u="Grid Assistant",initialMessage:d,open:r,onClose:c}){const[t,s]=L.useState(),[n,o]=L.useState([]),i={concreteType:"org.sagebionetworks.repo.model.agent.GridAgentSessionContext",gridSessionId:e,usersReplicaId:a};return q.jsx(w0,{open:r,onClose:c,title:u,children:q.jsx(c0,{chatbotName:u,initialMessage:d,sessionContext:i,textboxPositionOffset:"16px",hideTitle:!0,showAccessLevelMenu:!1,defaultAgentAccessLevel:r0.WRITE_YOUR_PRIVATE_DATA,externalSession:t,setExternalSession:s,externalInteractions:n,setExternalInteractions:o})})}try{Ca.displayName="GridAgentChat",Ca.__docgenInfo={description:"",displayName:"GridAgentChat",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},usersReplicaId:{defaultValue:null,description:"",name:"usersReplicaId",required:!0,type:{name:"number"}},chatbotName:{defaultValue:{value:"Grid Assistant"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}const Vg=["COPY","PASTE","CUT"],Bg=He.createAddRowsComponent(),yp=e=>{if(e.type==="COPY")return q.jsx(q.Fragment,{children:"Copy"});if(e.type==="PASTE")return q.jsx(q.Fragment,{children:"Paste"});if(e.type==="CUT")return q.jsx(q.Fragment,{children:"Cut"});if(e.type==="INSERT_ROW_BELLOW")return q.jsx(q.Fragment,{children:"Insert row below"});if(e.type==="DELETE_ROW")return q.jsx(q.Fragment,{children:"Delete row"});if(e.type==="DUPLICATE_ROW")return q.jsx(q.Fragment,{children:"Duplicate row"});if(e.type==="DELETE_ROWS")return q.jsx(q.Fragment,{children:"Delete rows"});if(e.type==="DUPLICATE_ROWS")return q.jsx(q.Fragment,{children:"Duplicate rows"})},Lg=He.createContextMenuComponent(yp),$g=He.createContextMenuComponent(yp),Fg=e=>{const a=e.items.filter(u=>Vg.includes(u.type));return q.jsx(Lg,{...e,items:a})},Jg=e=>q.jsx(Bg,{...e}),Sa=e=>q.jsx(Fg,{...e}),Ea=e=>q.jsx($g,{...e});try{Sa.displayName="renderViewContextMenu",Sa.__docgenInfo={description:"",displayName:"renderViewContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}try{Ea.displayName="renderRecordSetContextMenu",Ea.__docgenInfo={description:"",displayName:"renderRecordSetContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}const ms=L.forwardRef(({showDebugInfo:e=!1},a)=>{var ee,ge;const[u,d]=L.useState(null),[r,c]=L.useState(null),[t,s]=L.useState(!1),[n,o]=L.useState(null),i=L.useRef(null);L.useImperativeHandle(a,()=>({initializeGrid:X=>{i.current&&i.current.handleStartSession(X)},loadExistingSession:X=>{i.current&&i.current.handleLoadSession(X)}}),[]);const{isConnected:l,websocketInstance:p,isGridReady:h,model:v,modelSnapshot:y,connect:g,presignedUrl:f}=Ng(),m=L.useRef(null);L.useEffect(()=>{m.current=p},[p]);const b=L.useRef(null);L.useEffect(()=>{if(r==null||!(u!=null&&u.sessionId)){b.current=null;return}const X={replicaId:r,sessionId:u.sessionId},ie=b.current;ie&&ie.replicaId===X.replicaId&&ie.sessionId===X.sessionId||(b.current=X,g(r,u.sessionId))},[r,u==null?void 0:u.sessionId,g]),L.useEffect(()=>{v===null&&(o(null),Z(null),U.current&&U.current.setActiveCell(null))},[v]);const{data:_}=u0((u==null?void 0:u.gridJsonSchema$Id)??"",{enabled:!!(u!=null&&u.gridJsonSchema$Id)}),{data:w}=Ra(u==null?void 0:u.sourceEntityId,void 0,{enabled:!!(u!=null&&u.sourceEntityId)}),C=(w==null?void 0:w.concreteType)==="org.sagebionetworks.repo.model.table.EntityView",E=L.useMemo(()=>nm(_),[_]),O=l?"Connected":"Disconnected",S=L.useMemo(()=>y?K0(v,y):[],[v,y]),x=L.useMemo(()=>y?Dg(y,E):[],[y,E]),I=L.useCallback(()=>{!l||!m.current||m.current.sendPatch()},[l,m]);L.useEffect(()=>{l&&I()},[l,I]);const N=L.useCallback((X,ie)=>{ie.forEach(se=>{kg(X,se)}),I()},[I]),R=(X,ie)=>{if(!v){console.error("Model is not initialized");return}if(ie=G0(X,S,ie),ie.length>0){z(),G(ie,S,X);const se=Tg(ie,X);N(v,se)}},M=L.useCallback(X=>{const{selection:ie}=X;if(ie!=null&&(o(ie),v!=null&&r!=null)){const se=J0(ie,v);N(v,[{type:"SET_SELECTION",replicaId:r.toString(),selection:se}])}},[N,v,r]),T=L.useCallback(X=>{if(!v){console.error("Model is not initialized");return}X.type==="DELETE"&&U.current&&U.current.setActiveCell(null),N(v,[X])},[v,N]),{undoUI:j,redoUI:D,addOperationsToUndoStack:G,clearRedoStack:z}=ma(T),[W,Z]=L.useState(null),U=L.useRef(null);return q.jsx("div",{children:q.jsxs(Oe,{container:!0,spacing:2,children:[q.jsx(Oe,{size:{xs:12,xl:8},children:q.jsx(ba,{ref:i,onSessionChange:d,onReplicaChange:c,show:e})}),q.jsx(Oe,{size:{xs:12,xl:4},children:e&&q.jsxs("div",{children:[q.jsxs("p",{children:["Session ID: ",(u==null?void 0:u.sessionId)||"No session created"]}),q.jsxs("p",{children:["Replica ID: ",r||"No replica created"]}),q.jsxs("p",{children:["JSON Schema $id:"," ",(u==null?void 0:u.gridJsonSchema$Id)||"No schema attached to session"]}),q.jsxs("p",{children:["Presigned URL:"," ",f?f.substring(0,30)+(f.length>30?" ... "+f.substring(f.length-10):""):"No URL generated"]}),q.jsxs("p",{children:["WebSocket Status:"," ",q.jsx("span",{style:{color:l?"green":"red"},children:O})]})]})}),u&&q.jsxs(q.Fragment,{children:[!h&&q.jsxs(Oe,{size:12,children:[q.jsx("h3",{children:"Setting up grid..."}),q.jsxs("div",{style:{marginBottom:"10px"},children:[!u&&q.jsx("p",{children:"Creating grid session..."}),u&&!r&&q.jsx("p",{children:"Setting up real-time sync..."}),u&&r&&!f&&q.jsx("p",{children:"Establishing secure connection..."}),u&&r&&f&&!l&&q.jsx("p",{children:"Connecting to server..."}),l&&!h&&q.jsx("p",{children:"Loading table data..."}),q.jsx(a0,{numRows:4,numCols:1})]})]}),h&&q.jsxs(q.Fragment,{children:[q.jsx(Oe,{size:12,children:q.jsxs(i0,{direction:"row",spacing:1,sx:{justifyContent:"flex-end"},children:[j,D,q.jsx(Xt,{variant:"outlined",onClick:()=>s(!0),startIcon:q.jsx(l0,{}),children:"Open chat"}),q.jsx(Ca,{open:t,onClose:()=>s(!1),gridSessionId:u.sessionId,usersReplicaId:r,chatbotName:"Grid Assistant"}),u.sourceEntityId&&q.jsx(ua,{sourceEntityId:u.sourceEntityId,gridSessionId:u.sessionId}),u.sourceEntityId&&q.jsx(aa,{sourceEntityId:u.sourceEntityId,gridSessionId:u.sessionId})]})}),q.jsx(Oe,{size:12,children:q.jsx(He.DataSheetGrid,{ref:U,value:S,columns:x,autoAddRow:!C,addRowsComponent:C?!1:Jg,contextMenuComponent:C?Sa:Ea,rowKey:uh,rowClassName:({rowData:X,rowIndex:ie})=>{var se,Re,Ce;return ch({"row-valid":((se=X.__validationResults)==null?void 0:se.isValid)===!0,"row-invalid":((Re=X.__validationResults)==null?void 0:Re.isValid)===!1,"row-unknown":!!_&&((Ce=X.__validationResults)==null?void 0:Ce.isValid)==null,"row-selected":W===ie})},cellClassName:({rowData:X,rowIndex:ie,columnId:se})=>Ag({rowData:X,rowIndex:ie,columnId:se,selectedRowIndex:W,lastSelection:n,colValues:x}),duplicateRow:({rowData:X})=>({...X}),onChange:R,onActiveCellChange:({cell:X})=>{X&&Z(X.row)},onSelectionChange:M})}),q.jsx(Oe,{size:12,children:W!==null&&S[W]&&Array.isArray((ee=S[W].__validationResults)==null?void 0:ee.allValidationMessages)&&((ge=S[W].__validationResults)==null?void 0:ge.allValidationMessages.length)>0&&q.jsx(s0,{variant:"warning",title:"Validation Messages For Selected Row:",isGlobal:!1,description:q.jsx("ul",{children:S[W].__validationResults.allValidationMessages.map(X=>q.jsx("li",{children:X},X))}),sx:{marginTop:"12px"}})})]}),e&&q.jsxs(Oe,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[q.jsx("h3",{children:"Model"}),v?q.jsx(bb.ClickableJsonCrdt,{model:v}):"No model available"]})]})]})})});try{ms.displayName="SynapseGrid",ms.__docgenInfo={description:"",displayName:"SynapseGrid",props:{showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}const SO={title:"Components/SynapseGrid",component:ms,parameters:{stack:"staging",requireLogin:!0},argTypes:{query:{control:"text"},showDebugInfo:{control:"boolean",description:"Show debug information including session details and model snapshot"}}},ds={args:{query:"SELECT * FROM syn35295069"},render:function({query:a,...u}){const d=L.useRef(null);return q.jsxs("div",{children:[q.jsx(Oa,{variant:"outlined",onClick:()=>{var r;return(r=d.current)==null?void 0:r.initializeGrid({initialQuery:{sql:a||"SELECT * FROM syn35295069"},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"})},sx:{color:"inherit",margin:"10px 0"},children:"Start Grid Session"}),q.jsx(ms,{ref:d,...u})]})}},fs={args:{showDebugInfo:!0}};var Zf,eh,th;ds.parameters={...ds.parameters,docs:{...(Zf=ds.parameters)==null?void 0:Zf.docs,source:{originalSource:`{
  args: {
    query: 'SELECT * FROM syn35295069'
  },
  render: function GridWithButton({
    query,
    ...args
  }) {
    const gridRef = useRef<SynapseGridHandle>(null);
    return <div>
        <Button variant="outlined" onClick={() => gridRef.current?.initializeGrid({
        initialQuery: {
          sql: query || 'SELECT * FROM syn35295069'
        },
        concreteType: 'org.sagebionetworks.repo.model.grid.CreateGridRequest'
      })} sx={{
        color: 'inherit',
        margin: '10px 0'
      }}>
          Start Grid Session
        </Button>
        <SynapseGrid ref={gridRef} {...args} />
      </div>;
  }
} satisfies Story`,...(th=(eh=ds.parameters)==null?void 0:eh.docs)==null?void 0:th.source}}};var nh,rh,ih;fs.parameters={...fs.parameters,docs:{...(nh=fs.parameters)==null?void 0:nh.docs,source:{originalSource:`{
  args: {
    showDebugInfo: true
  }
}`,...(ih=(rh=fs.parameters)==null?void 0:rh.docs)==null?void 0:ih.source}}};const EO=["GridWithQuery","GridWithUserInputAndDebugInfo"];export{ds as GridWithQuery,fs as GridWithUserInputAndDebugInfo,EO as __namedExportsOrder,SO as default};
