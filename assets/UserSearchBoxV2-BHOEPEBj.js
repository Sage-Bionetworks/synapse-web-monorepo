import{j as w}from"./jsx-runtime-CmUBiTSS.js";import{r as i}from"./index-B2mmVxOD.js";import{l as V,aS as b,aT as k,aU as F}from"./useFiles-CvqXu3qP.js";import{T as O}from"./VerificationSubmission-B0kBNeMy.js";import"./StringUtils-CzgJJW-6.js";import"./OrientationBanner-2QI37Wfz.js";import{u as A}from"./useDebouncedEffect-Btu49Ie2.js";import{a as H}from"./use-deep-compare-effect.esm-B8stsYBw.js";import{t as x,C as L,H as C,U as D}from"./SynapseConstants-BlsqOTHC.js";import{u as G}from"./uniq-COrGhLMJ.js";import{w as P}from"./without-C7Y1ukFL.js";import{c as Y}from"./chunk-Ca4-WdHa.js";import{d as M}from"./UserBadge-guYvAWcG.js";import{u as q,S as j,c as _}from"./Select-aab027f3.esm-DqT12irs.js";import{a as B}from"./createTheme-BYqAVevx.js";import"./index-DILzB3oy.js";import{U as T}from"./UserOrTeamBadge-CrQODHxS.js";import{u as K}from"./useTheme-DODxR0TP.js";import{S as J}from"./Skeleton--p_DRxXi.js";const $={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},Q={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},z={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},W=async(t,e)=>{const n=await k(t,e),s=t.filter(a=>n.results.map(l=>l.id).indexOf(a.targetId)===-1).map(a=>({...Q,id:a.targetId,name:`${a.targetId}`}));return[...n.results,...s]},X=async t=>{const e=(await F(t)).children,m=t.filter(s=>e.map(a=>a.ownerId).indexOf(s)===-1).map(s=>({...$,ownerId:s,name:`Unknown User (${s})`}));return[...e,...m]},Z=async(t,e)=>{const n=await b({evaluationIds:t},e),s=t.filter(a=>n.results.map(l=>l.id).indexOf(a)===-1).map(a=>({...z,id:a,name:a}));return[...n.results,...s]};function ee(t){const{ids:e,type:n}=t,{accessToken:m}=V(),[s,a]=i.useState([]),l=n==="USER_PROFILE"?"ownerId":"id",g=(o=>{switch(o){case"USER_PROFILE":return D;case"ENTITY_HEADER":return C;case"EVALUATION_QUEUE":return L;default:return""}})(n),U=s.map(o=>o[l]),p=e.filter(o=>o!==x),I=G(P(p,...U));return i.useEffect(()=>{(S=>{if(!S.length)return;const c=sessionStorage.getItem(g);try{const f=c?JSON.parse(c):[],h=f.map(u=>u[l]);for(const u of S)h.includes(u[l])||f.push(u);sessionStorage.setItem(g,JSON.stringify(f))}catch{sessionStorage.setItem(g,JSON.stringify(S))}})(s)},[s,l,g]),H(()=>{let o=!1;return(async()=>{if(I.length>0)try{const c=Array.from(I),f=n==="ENTITY_HEADER"?c.map(d=>({targetId:d})):c,h=Y(f,45),u=[];for(const d of h){let E=[];switch(n){case"USER_PROFILE":E=await X(d);break;case"ENTITY_HEADER":E=await W(d,m);break;case"EVALUATION_QUEUE":E=await Z(d,m);break}u.push(...E)}o||a(d=>d.concat(...u))}catch(c){console.error("Error on data retrieval",c)}})(),()=>{o=!0}},[m,n,I]),s}var te=i.forwardRef(function(t,e){var n=q(t);return i.createElement(j,B({ref:e},n))}),ne=te;const ae={SingleValue:t=>{const{data:e}=t;return i.createElement(_.SingleValue,{...t,key:e==null?void 0:e.id},w.jsx(T,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return i.createElement(_.Option,{...t,key:e==null?void 0:e.id},w.jsx(T,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}};function v(t){const{inputId:e,defaultValue:n=null,onChange:m,filterPredicate:s,typeFilter:a,placeholder:l,focusOnSelect:y=!1,value:g}=t,{palette:U}=K(),[p,I]=i.useState(""),[o,S]=i.useState("");A(()=>{S(p)},[p],500);const[c=void 0]=ee({ids:n?[n]:[],type:"USER_PROFILE"}),f=!!o,{data:h,isLoading:u}=M(o,a,{enabled:f}),d=i.useRef(null);i.useEffect(()=>{y&&d.current&&d.current.focus()});const E=i.useMemo(()=>u||p!==o?()=>"Loadingâ€¦":void 0,[u,o,p]),N=(h??[]).filter(s??(()=>!0)).map(r=>({id:r.ownerId.toString(),value:r.ownerId.toString(),label:r.userName,header:r})),R=i.useMemo(()=>l!==void 0?l:a==O.USERS_ONLY?"Name (first and last)":a==O.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[l,a]);return n&&c==null?w.jsx(J,{width:"100%"}):w.jsx(ne,{className:"UserSearchBoxV2",ref:d,inputValue:p,onInputChange:I,filterOption:()=>!0,isLoading:u,options:!u&&N||[],noOptionsMessage:E,openMenuOnClick:!1,placeholder:R,defaultValue:n?{id:n,value:n,label:c.userName,header:c}:void 0,inputId:e,isClearable:!0,value:g,styles:{control:r=>({...r,backgroundColor:U.grey[200]}),input:r=>({...r,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:r=>({...r,zIndex:2})},components:ae,onChange:r=>{m&&m((r==null?void 0:r.id)??null,(r==null?void 0:r.header)??null)}})}try{v.displayName="UserSearchBoxV2",v.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"(principalId: string, header: UserGroupHeader) => void"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"(item: UserGroupHeader) => boolean"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<{ id: string; value: string; label: string; header: UserGroupHeader; }>"}}}}}catch{}export{ne as S,v as U,ee as u};
