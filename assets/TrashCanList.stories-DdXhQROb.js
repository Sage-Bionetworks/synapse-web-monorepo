import{aH as I,an as x,aI as R,aa as C,r as c,j as t,hg as D,X as f,dZ as L,c4 as P,V as N,B as p,di as Q,dH as q,dG as K}from"./iframe-CaOcC-hf.js";import{u as V}from"./useInfiniteQuery-DsHtYM7m.js";import{g as z}from"./InfiniteQueryUtils-CKlRW-xB.js";import{u as H,S as O,c as A,g as Y}from"./StyledTanStackTable-DFuAXi4T.js";import{C as G,a as W}from"./EntityHeaderTableCellRenderers-Cj6PBYcg.js";import{E as _}from"./EntityLink-WjLoApPJ.js";import{W as X}from"./WarningDialog-B1z_iYnj.js";import"./index-Chi_LkuB.js";import"./StyledTableContainer-BVED_icB.js";import"./ExpandCollapseButton-CNqWlzK9.js";import"./index-E5FZWk4U.js";import"./Checkbox-wHAkxbLY.js";import"./SwitchBase-19wbeUii.js";import"./useEntity-BdQEsk8n.js";import"./pickBy-8SjG7ER4.js";import"./isString-BgQb4HBW.js";import"./_baseIteratee-CnGLSoYc.js";import"./useQueries-DwQcF1rT.js";import"./useSuspenseQuery-D6gXheFj.js";import"./useEntityBundle-CNIm-M4T.js";import"./useGetEntityHeaders-DIFG2Xdd.js";import"./EntityIcon-CDcpa4HC.js";import"./ErrorChip-IKXBAE43.js";import"./Chip-B_m5Zg1D.js";import"./ConfirmationDialog-D38gahaL.js";import"./DialogBase-Dn94ypHd.js";import"./Close-7gN2buzZ.js";import"./HelpPopover-DtGoLtv4.js";import"./MarkdownPopover-pxj3Gfsw.js";import"./LightTooltip-DLMcdQ8O.js";import"./MarkdownSynapse-Bu_iQFQg.js";import"./SkeletonButton-C1Ne2e4S.js";import"./SkeletonInlineBlock-CXC8p12o.js";import"./SkeletonTable-BGTjeLmw.js";import"./SkeletonParagraph-DlGa_aoP.js";function Z(r){const{accessToken:e,keyFactory:i}=x();return V({...r,queryKey:i.getTrashCanItemsQueryKey(),queryFn:l=>C.getItemsInTrashCan(e,l.pageParam),initialPageParam:void 0,getNextPageParam:z})}function J(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.restoreFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function U(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.purgeFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function $(r){return r.filter(e=>e.status==="rejected").map(e=>e.reason)}const m=A();function ee(r){return[{id:"select",header:W,cell:G,maxSize:50},m.accessor("entityId",{header:"ID"}),m.accessor("entityName",{header:"Name"}),m.accessor("entityType",{header:"Entity Type",cell:e=>Q(e.getValue())}),m.accessor("originalParentId",{header:"Location",cell:e=>t.jsxs(t.Fragment,{children:[e.getValue()&&t.jsx(_,{entity:e.getValue()})," (",e.getValue(),")"]}),size:200}),m.accessor("deletedOn",{header:"Deleted On",cell:e=>q(K(e.getValue()))}),{id:"restoreButton",header:"",cell:({row:e})=>t.jsx(p,{size:"small",variant:"outlined",onClick:()=>{r(e.original.entityId),e.toggleSelected(!1)},children:"Restore"}),maxSize:100}]}function te(){const[r,e]=c.useState(!1),[i,l]=c.useState([]),[a,s]=c.useState({});function o(n,w){n?l($(n)):w&&l([w]),s({})}const{mutate:y,isPending:k}=J({onSettled:o}),{mutate:b,isPending:S}=U({onSettled:o}),v=k||S,{data:T,isLoading:g,hasNextPage:F,fetchNextPage:E,isFetchingNextPage:M}=Z({throwOnError:!0}),h=c.useMemo(()=>T?.pages.flatMap(n=>n.results)??[],[T]),B=c.useMemo(()=>ee(n=>{y(n)}),[y]),j=H({data:h,columns:B,state:{rowSelection:a},getRowId:n=>n.entityId,enableRowSelection:!0,onRowSelectionChange:s,getCoreRowModel:Y(),columnResizeMode:"onChange"}),u=j.getSelectedRowModel().rows.map(n=>n.original.entityId);return t.jsxs("div",{children:[t.jsx(D,{show:v,headlineText:S?"Deleting...":"Restoring..."}),t.jsx(f,{variant:"body1",children:'The trash can contains items that were recently deleted. You can recover deleted items in the trash can by clicking "Restore". Items will remain in the trash can for 30 days before being automatically purged.'}),t.jsx(X,{title:"Delete selected items from your Trash?",content:t.jsx(f,{variant:"body1",children:"You can't undo this action."}),confirmButtonText:"Delete",confirmButtonColor:"error",onConfirm:()=>{b(u),e(!1)},onCancel:()=>{e(!1)},open:r}),g&&t.jsx(L,{}),!g&&h.length===0&&t.jsx(P,{severity:"info",sx:{my:2},children:t.jsx(f,{variant:"body1",children:"Your trash can is currently empty."})}),!g&&h.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(O,{table:j,styledTableContainerProps:{sx:{my:4}}}),i.length>0&&t.jsxs(P,{severity:"error",sx:{mb:1},children:["The following errors were encountered:",t.jsx("ul",{style:{marginBottom:0},children:i.map(n=>t.jsx("li",{children:n.message},n.message))})]}),t.jsxs(N,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[F&&t.jsx(p,{variant:"contained",disabled:M,onClick:()=>{E()},children:"Load More"}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(p,{variant:"contained",color:"error",disabled:u.length===0,onClick:()=>{e(!0)},children:"Delete Selected"}),t.jsx(p,{variant:"outlined",disabled:u.length===0,onClick:()=>{y(u)},children:"Restore Selected"})]})]})]})}const Qe={title:"Synapse/TrashCanList",component:te},d={};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:"{}",...d.parameters?.docs?.source}}};const qe=["TrashCan"];export{d as TrashCan,qe as __namedExportsOrder,Qe as default};
