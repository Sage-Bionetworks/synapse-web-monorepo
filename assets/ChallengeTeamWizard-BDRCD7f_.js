import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{l as Y,S as ne,m as R,g as pe,B as he,as as ge,v as fe}from"./useFiles-GseVYpjW.js";import"./VerificationSubmission-CDh9xETu.js";import"./StringUtils-CsrYFBZo.js";import"./OrientationBanner-CMmM2nyC.js";import{r as c}from"./index-DUnR2wGU.js";import{u as Te}from"./useGetEntityChallenge-BNDDtTaT.js";import{e as xe,b as re,f as se,a as Ie}from"./useTeamMembers-CGcIEcx2.js";import{u as Ce}from"./useGetUserTeams-B696ZsYC.js";import{D as ye}from"./DialogBase-CBqhU3qD.js";import{S as N}from"./LoadingScreen-3ziU1vNV.js";import{C as be}from"./CreateChallengeTeam-5k8qjqFO.js";import{u as Q}from"./useTeam-Cpp2koLt.js";import{u as ie,n as z}from"./useQuery-BoJvFqc3.js";import{B as y}from"./Box-DdkmxDon.js";import{A as v}from"./Alert-OcKEIYp6.js";import{T as C}from"./Typography-D4ivI4uJ.js";import{T as Se}from"./TextField-CsMrkMkK.js";import{U as _e}from"./UserBadge-D2q_qUCi.js";import{U as je}from"./UserOrTeamBadge-DZCZgkMk.js";import{B as j}from"./Button-B3GtIfhR.js";import{c as ve,S as Ee}from"./Stack-DiJhusha.js";import{f as Me}from"./DateFormatter-CtGmjHfk.js";import{d as Ne}from"./dayjs.min-DjHfNNqw.js";import{S as Re}from"./Search-CTzk1TOn.js";import{B as te}from"./Box-yHVl7it-.js";import{I as we}from"./InputBase-B2ehYiNW.js";import{R as qe}from"./Radio-DuL07VLS.js";import{L as Ae}from"./Link-BLcNJuX4.js";import{T as oe}from"./Tooltip-D3bJvEAc.js";import{c as Le}from"./createSvgIcon-BP5oj4Nx.js";import{D as Fe}from"./DataGrid-DPD3wJG3.js";import{A as Oe}from"./IconSvg-CBE5D244.js";const ke=ve(),Be=Le([e.jsx("path",{d:"m20 8-8 5-8-5v10h16zm0-2H4l8 4.99z",opacity:".3"},"0"),e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2M20 6l-8 4.99L4 6zM4 8l8 5 8-5v10H4z"},"1")]);function Ve(t,s){const{accessToken:i,keyFactory:r}=Y();return ie({...s,queryKey:r.getTeamListQueryKey(t.sort().join()),queryFn:()=>ne.getTeamList(t,i)})}function Ue(t,s){const{accessToken:i,keyFactory:r}=Y();return ie({...s,queryKey:r.getChallengeTeamListQueryKey(t),queryFn:()=>ne.getAllChallengeTeams(i,t)})}const V=c.forwardRef(function(s,i){const{teamId:r,onRequestSubmitted:o=z}=s,[u,d]=c.useState(""),{data:a}=R(),{data:l,status:f,error:b}=Q(r,{enabled:!!r}),{mutate:h}=xe({onSuccess:()=>{o()}}),E=S=>{const T=S.target.value;d(T)};return c.useImperativeHandle(i,()=>({submit(){a&&h({teamId:r,userId:a.ownerId,message:u,expiresOn:void 0})}}),[u,h,r,a]),f==="pending"?e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):f==="error"?e.jsx(v,{severity:"error",children:b.message}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e.jsx("strong",{children:l.name})," team."]}),e.jsx(y,{children:e.jsx(Se,{label:"Your Message to Team Managers(s)",id:"membershipRequestMessage",value:u,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:E})})]})});try{V.displayName="MembershipRequestForm",V.__docgenInfo={description:"Component that provides a form that a user can use to create a MembershipRequest for a Team.\n\nTo submit the form, pass a ref and call the `submit` handle on the ref.",displayName:"MembershipRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onRequestSubmitted:{defaultValue:null,description:"",name:"onRequestSubmitted",required:!0,type:{name:"() => void"}}}}}catch{}function U(t){const{teamId:s,onSuccess:i=z,...r}=t,{data:o}=R(),{mutate:u,isPending:d}=re({onSuccess:()=>{i()}}),a=!o||d,l=c.useCallback(()=>{o!=null&&o.ownerId&&u({teamId:s,userId:o.ownerId})},[o==null?void 0:o.ownerId,u,s]);return e.jsx(j,{variant:"contained",disabled:a,startIcon:d?e.jsx(N,{}):void 0,...r,onClick:l,children:"Accept Invitation"})}function G(t){const{teamId:s}=t,{data:i}=R(),{data:r,status:o,error:u}=se(i==null?void 0:i.ownerId,{enabled:!!(i!=null&&i.ownerId)}),{data:d}=Q(s,{enabled:!!s});if(o==="pending")return e.jsx(N,{});if(o==="error")return e.jsx(v,{severity:"error",children:u.message});const a=r.find(l=>l.teamId===s);return a==null?e.jsxs(v,{severity:"error",children:["No matching invitation for team ",d?d.name:`ID: ${s}`]}):e.jsxs(Ee,{sx:{gap:2},children:[e.jsxs(C,{variant:"body1",children:[e.jsx(_e,{userId:a.createdBy})," has invited you to join"," ",e.jsx("span",{children:e.jsx(je,{principalId:s})}),a.message?" with the following message:":"."]}),a.message&&e.jsx(C,{variant:"body1",component:"blockquote",children:a.message}),e.jsx(C,{variant:"body1",children:"Do you want to accept this invitation?"})]})}try{U.displayName="AcceptMembershipInvitationButton",U.__docgenInfo={description:"",displayName:"AcceptMembershipInvitationButton",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}try{G.displayName="OpenMembershipInvitation",G.__docgenInfo={description:`For the current, authenticated user, displays the details of an open MembershipInvitation for the provided team ID.

This component requires
  1. The current user is logged-in
  2. The current user has an open invitation to join the teamId passed in via props

To prompt the user to accept the invitation, use the {@link AcceptMembershipInvitationButton} component.`,displayName:"OpenMembershipInvitation",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}}}}}catch{}const D=({createdNewTeam:t,teamId:s})=>{const{data:i,status:r,error:o}=Q(s,{enabled:!!s});return s?r==="pending"?e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):r==="error"?e.jsx(v,{severity:"error",children:o.message}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",t?"created":"joined"," team"," ",e.jsx("b",{children:i.name})," and have been added to this challenge."]}),t&&e.jsx(y,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{D.displayName="RegistrationSuccessful",D.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}}}}}catch{}function H(t){const{value:s,rowCount:i,onChange:r}=t,o=i>5?"calc(100% - 8px)":"100%";return e.jsxs(te,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:o,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e.jsx(te,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e.jsx(Re,{sx:{color:"#878E95"}})}),e.jsx(we,{value:s,onChange:r,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})}try{H.displayName="ChallengeTeamSearch",H.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function J(t){const{challengeId:s,onSelectTeam:i,selectedTeamId:r}=t,{data:o,isLoading:u}=Ue(s),{data:d}=R(),{data:a}=se(d==null?void 0:d.ownerId,{enabled:!!(d!=null&&d.ownerId)}),[l,f]=c.useState(""),b=(o==null?void 0:o.map(n=>n.teamId))??[],{data:h,isLoading:E}=Ve(b,{enabled:!!b.length}),S=c.useMemo(()=>{const n=l.toLowerCase(),w=(h==null?void 0:h.list.filter(g=>g.canPublicJoin||g.canRequestMembership!==!1||(a==null?void 0:a.some(x=>x.teamId===g.id))))??[];let p=w;return n.length&&(p=w.filter(g=>{var x;return g.name.toLowerCase().includes(n)||((x=g.description)==null?void 0:x.toLowerCase().includes(n))})),p.map(g=>({...g,hasInvitation:!!(a!=null&&a.some(x=>x.teamId===g.id))}))},[a,l,h==null?void 0:h.list]),T=u||E,M=c.useMemo(()=>[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:n})=>e.jsx(qe,{value:n.id,checked:String(n.id)===r,onClick:()=>{i(String(n.id))},inputProps:{"aria-label":`Select ${n.name}`}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:n})=>e.jsx(Ae,{href:`${pe(he.PORTAL_ENDPOINT)}/Team:${n.id}`,target:"_blank",underline:"hover",children:n.name})},{field:"hasInvitation",headerName:"",width:15,filterable:!1,hideable:!1,disableColumnMenu:!0,align:"center",renderCell:({value:n})=>n?e.jsx(oe,{title:"You have been invited to join this team",children:e.jsx(Be,{fontSize:"small",sx:{color:"grey.700"}})}):null},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({value:n})=>Me(Ne(n),"MM/DD/YY")},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}],[i,r]);return e.jsxs(y,{sx:{height:220},children:[!T&&e.jsx(H,{value:l,onChange:n=>f(n.target.value),rowCount:S.length}),e.jsx(Fe,{initialState:{sorting:{sortModel:[{field:"hasInvitation",sort:"desc"}]}},loading:T,rows:S,columns:M,rowCount:5,hideFooter:!0,density:"compact",rowBufferPx:500,sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:n=>n.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]})}try{J.displayName="ChallengeTeamTable",J.__docgenInfo={description:`Table component that displays teams that
 1. are registered for the challenge specified by the challengeId prop
 2. the current user is able to join, create a request to join, or accept an invitation to join`,displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}const Ge='To participate in a challenge, you need to create a new Team or join an existing one.   By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.   All team members will need a Synapse account so that they can login and accept the team invitation.',P=({challengeId:t,onCreateTeam:s,selectedTeamId:i,onSelectTeam:r})=>e.jsxs(ke,{spacing:2,children:[e.jsx(C,{variant:"body1",sx:{lineHeight:"20px"},children:Ge}),e.jsx(y,{sx:{height:270},children:e.jsx(J,{challengeId:t,selectedTeamId:i,onSelectTeam:r})}),e.jsx(y,{children:e.jsx(j,{color:"primary",variant:"contained",onClick:s,startIcon:e.jsx(Oe,{}),children:"Create New Team"})})]});try{P.displayName="SelectChallengeTeam",P.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}function De(t){switch(t){case"SELECT_YOUR_CHALLENGE_TEAM":return"Select Your Challenge Team";case"ACCEPT_INVITATION":return"Invitation to Join Team";case"JOIN_REQUEST_FORM":return"Request Team Membership";case"JOIN_REQUEST_SENT":return"Request Sent";case"CREATE_NEW_TEAM":return"Create Team";case"REGISTRATION_SUCCESSFUL":return"Registration Successful!"}}function ae(t){const{projectId:s,isShowingModal:i=!1,onClose:r}=t,{accessToken:o}=Y(),u=!!o,[d,a]=c.useState("SELECT_YOUR_CHALLENGE_TEAM"),[l,f]=c.useState(),[b,h]=c.useState(!1),[E,S]=c.useState(!1),T=c.useRef(null),M=c.useRef(null),{data:n,isLoading:w}=R({enabled:u}),{data:p,isLoading:g}=Te(s),{mutateAsync:x,isPending:A,error:L}=re(),{data:W,error:F}=Ce(p==null?void 0:p.id,1,0,{enabled:!!(u&&p)}),O=W&&W.results.length>0,{data:I,isLoading:$,error:k}=Ie(l,String(n==null?void 0:n.ownerId),{enabled:u&&!!l&&!!n}),K=c.useCallback(async()=>{!l||!n||(await x({teamId:l,userId:n.ownerId}),a("REGISTRATION_SUCCESSFUL"))},[x,a,l,n]),le=c.useCallback(()=>{S(!1),f(void 0),r()},[r]),de=w||g,_=c.useMemo(()=>{switch(d){case"SELECT_YOUR_CHALLENGE_TEAM":case"JOIN_REQUEST_SENT":case"REGISTRATION_SUCCESSFUL":return e.jsx(e.Fragment,{});case"ACCEPT_INVITATION":case"JOIN_REQUEST_FORM":case"CREATE_NEW_TEAM":default:return e.jsx(j,{variant:"outlined",onClick:()=>{a("SELECT_YOUR_CHALLENGE_TEAM"),f(void 0)},children:"Back"})}},[d]),B=c.useMemo(()=>e.jsx(j,{variant:"contained",onClick:()=>{r()},children:"Close"}),[r]),{actions:ce=e.jsx(e.Fragment,{}),content:ue=e.jsx(e.Fragment,{})}=c.useMemo(()=>{if(!u)return{content:e.jsx(v,{severity:"error",children:e.jsx(ge,{})})};if(O)return{content:e.jsx(v,{severity:"error",children:e.jsx(C,{children:"You are already a member of a registered submission team for this Challenge."})})};switch(d){case"SELECT_YOUR_CHALLENGE_TEAM":{let m="Join Team",Z=!1,q=z,ee="";return I&&I.hasOpenInvitation?(m="View Invitation to Join Team",q=()=>{a("ACCEPT_INVITATION")}):I&&I.hasOpenRequest?(m="Join Request Pending",Z=!0,ee="You have already submitted a request to join this team."):I&&I.membershipApprovalRequired?(m="Request to Join Team",q=()=>{a("JOIN_REQUEST_FORM")}):I&&I.canJoin&&(m="Join Team",q=()=>{K()}),{content:p&&!O&&e.jsx(P,{challengeId:p.id,onCreateTeam:()=>a("CREATE_NEW_TEAM"),selectedTeamId:l,onSelectTeam:me=>f(me)}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(oe,{title:ee,children:e.jsx("span",{children:e.jsx(j,{onClick:q,startIcon:A?e.jsx(N,{}):void 0,disabled:!l||$||A||Z,variant:"contained",children:m})})})]})}}case"ACCEPT_INVITATION":return{content:e.jsx(G,{teamId:l}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(U,{teamId:l,onSuccess:()=>{a("REGISTRATION_SUCCESSFUL")}})]})};case"JOIN_REQUEST_FORM":return{content:e.jsx(V,{ref:T,teamId:l,onRequestSubmitted:()=>{a("JOIN_REQUEST_SENT")}}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(j,{variant:"contained",onClick:()=>{var m;(m=T==null?void 0:T.current)==null||m.submit()},children:"Send Request"})]})};case"JOIN_REQUEST_SENT":return{content:e.jsx(C,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."}),actions:e.jsxs(e.Fragment,{children:[_,B]})};case"REGISTRATION_SUCCESSFUL":return{content:e.jsx(D,{createdNewTeam:E,teamId:l}),actions:e.jsxs(e.Fragment,{children:[_,B]})};case"CREATE_NEW_TEAM":return{content:e.jsx(be,{ref:M,challengeId:p==null?void 0:p.id,onCanSubmitChange:m=>h(m),onFinished:m=>{S(!0),f(m),a("REGISTRATION_SUCCESSFUL")}}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(j,{variant:"contained",disabled:!b,onClick:()=>{var m;(m=M==null?void 0:M.current)==null||m.submit()},children:"Create Team"})]})}}},[u,O,d,l,_,B,E,I,p,A,$,K,b]),X=(L==null?void 0:L.message)||(k==null?void 0:k.message)||(F==null?void 0:F.message);return e.jsx(ye,{onCancel:le,open:i,actions:ce,title:De(d),content:e.jsx(fe,{children:e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:de?e.jsx(N,{size:40}):e.jsxs(e.Fragment,{children:[ue,X&&e.jsx(v,{severity:"error",children:X})]})})})})}try{ae.displayName="ChallengeTeamWizard",ae.__docgenInfo={description:`The ChallengeTeamWizard is used to guide a user through the process of joining or creating a team for a challenge.

A required precondition is that the user is NOT on any registered submission team for the challenge.`,displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:null,description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{ae as C};
