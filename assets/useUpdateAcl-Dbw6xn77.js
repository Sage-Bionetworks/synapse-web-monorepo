import{aJ as h}from"./useFiles-CQdMNpwn.js";import{r as s}from"./index-CzvTTXra.js";import{d as H}from"./VerificationSubmission-OWkqLMYZ.js";import"./StringUtils-C5rFena9.js";import"./OrientationBanner-VS5H_DpA.js";import"./jsx-runtime-D_zvdyIk.js";import{c as T}from"./UserBadge-BejtLLv7.js";import{a as I,P as m}from"./SynapseConstants-BKOIVSJ4.js";import{n as C}from"./useQuery-Zz63RtHv.js";function y(r,c){let i;(t=>{t[t.A_FIRST=-1]="A_FIRST",t[t.B_FIRST=1]="B_FIRST"})(i||(i={}));const a=r.resourceAccess.accessType.includes(H.CHANGE_PERMISSIONS),o=c.resourceAccess.accessType.includes(H.CHANGE_PERMISSIONS);return a&&!o?-1:!a&&o?1:r.resourceAccess.principalId===I&&c.resourceAccess.principalId!==I?-1:r.resourceAccess.principalId!==I&&c.resourceAccess.principalId===I?1:r.resourceAccess.principalId===m&&c.resourceAccess.principalId!==m?-1:r.resourceAccess.principalId!==m&&c.resourceAccess.principalId===m?1:r.userGroupHeader.userName.localeCompare(c.userGroupHeader.userName)}function D(r){const c=s.useMemo(()=>r.map(n=>n.principalId),[r]),{data:i,isLoading:a,error:o}=T(c.map(String),{enabled:c.length>0});return s.useEffect(()=>{o&&console.error("Error fetching user group headers: ",o)},[o]),{sortedResourceAccessList:s.useMemo(()=>{if(!i)return null;const n=r.map(e=>({resourceAccess:e,userGroupHeader:i.find(A=>String(A.ownerId)===String(e.principalId))}));return n.every(e=>!!e.userGroupHeader)?n.toSorted(y).map(e=>e.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",n.filter(e=>!e.userGroupHeader)),null)},[r,i]),isLoading:a}}const N="User or team already has permissions.",U=[];function b(r={}){const{initialResourceAccessList:c=U,onChange:i=C,onError:a=C}=r,[o,t]=s.useState(!1),{setIsEditing:n}=h();s.useEffect(()=>(n(o),()=>{n(!1)}),[o,n]);const[d,e]=s.useState(c),[A,G]=s.useState(!1),{sortedResourceAccessList:R,isLoading:E}=D(d);s.useEffect(()=>{!o&&!E&&!A&&R!=null&&(e(R),G(!0))},[A,o,E,R]),s.useEffect(()=>{i(d)},[d]);const g=s.useCallback((u,l)=>{t(!0),u&&e(p=>{if(p.some(S=>S.principalId===u))a(N);else{const S={principalId:u,accessType:l};return[...p,S]}return p})},[a]),_=s.useCallback((u,l)=>{t(!0),e(p=>p.map(f=>f.principalId===u?{...f,accessType:l}:f))},[]),L=s.useCallback(u=>{t(!0),e(l=>l.filter(p=>p.principalId!==u))},[]),P=s.useCallback(()=>{t(!1)},[]);return{resourceAccessList:d,setResourceAccessList:e,addResourceAccessItem:g,updateResourceAccessItem:_,removeResourceAccessItem:L,resetDirtyState:P}}export{b as u};
