import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as P}from"./index-F3OlDRPU.js";import{u as q,d as k,Q as H,a as K,N as Y,b as $}from"./QueryWrapper-C8PTutvp.js";import{aW as G,w as z}from"./useFiles-DAUKQIuz.js";import{b as J,g as Z}from"./SqlFunctions-B6aZ8mL4.js";import{o as X}from"./StringUtils-NPb0VexC.js";import{u as ee}from"./useQuery-DdyJtvdB.js";import{g as te,d as ae,f as oe,B as ne,Q as se,i as re,h as le,N as ie,j as ue}from"./SynapseConstants-ptYewzyF.js";import"./VerificationSubmission-BDh1zA9f.js";import"./OrientationBanner-_kC-PSdY.js";import{u as de}from"./useEntity-CKv5xDHJ.js";import"./DownloadConfirmationUI-BlGKMheq.js";import{a as ce,T as me,R as pe}from"./RowSetView-D5_yDu0e.js";import{F as ye,S as fe,T as he}from"./TopLevelControls-Oc0rh1wQ.js";import{M as Pe}from"./ModalDownload-CPuOQ2fG.js";import{u as D}from"./QueryContext-tR-gwp-8.js";import{a as ve}from"./TableRowSelectionState-C4WLd2u8.js";import{Q as Se,S as xe}from"./QueryWrapperErrorBoundary-BlWrk_nd.js";import"./ThemesPlot-5ShYhah4.js";import"./UpsetPlot-iio1ClfG.js";import{S as _e}from"./SynapsePlot-CMOHNwQo.js";import{P as ge,u as Ce,g as Ee,F as Te,a as we}from"./useFacetPlots-DHlPAMed.js";import{B as w}from"./Box-BW-aRCkO.js";import{S as x}from"./Skeleton-C-zuVtl_.js";import{S as je}from"./Stack-BnkLG2u3.js";import{B as Ne}from"./Button-dxqTEXs9.js";import{u as Fe}from"./react-CQiWL19i.js";function A(e){const o=D(),{currentQueryRequest:l}=o,{title:i,onCustomPlotClick:d,onHide:_}=e,{showPlots:c}=q(),f=P.useMemo(()=>({...e,title:void 0,showlegend:!1,displayModebar:!1}),[e]),p=P.useMemo(()=>{const{selectedFacets:S,additionalFilters:g}=l.query;return{selectedFacets:S,additionalFilters:g,onCustomPlotClick:d,queryContext:o}},[l.query,d,o]);return t.jsx("div",{role:"figure",className:"SynapsePlot",children:c&&t.jsxs(t.Fragment,{children:[i&&t.jsx(ge,{title:i,onHide:_}),t.jsx(_e,{synapsePlotWidgetParams:f,customPlotParams:p})]})})}try{A.displayName="QueryWrapperSynapsePlot",A.__docgenInfo={description:`This component wraps a SynapsePlot.  It passes in the current query context, and has a custom
"title" style so that it looks like it belongs in the QueryWrapperPlotNav plots.`,displayName:"QueryWrapperSynapsePlot",props:{onCustomPlotClick:{defaultValue:null,description:"",name:"onCustomPlotClick",required:!1,type:{name:"(event: QueryWrapperSynapsePlotRowClickEvent) => void"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"table"'},{value:'"image"'},{value:'"box"'},{value:'"volume"'},{value:'"bar"'},{value:'"barpolar"'},{value:'"candlestick"'},{value:'"carpet"'},{value:'"choropleth"'},{value:'"choroplethmapbox"'},{value:'"cone"'},{value:'"contour"'},{value:'"contourcarpet"'},{value:'"densitymapbox"'},{value:'"funnel"'},{value:'"funnelarea"'},{value:'"heatmap"'},{value:'"heatmapgl"'},{value:'"histogram"'},{value:'"histogram2d"'},{value:'"histogram2dcontour"'},{value:'"indicator"'},{value:'"isosurface"'},{value:'"mesh3d"'},{value:'"ohlc"'},{value:'"parcats"'},{value:'"parcoords"'},{value:'"pie"'},{value:'"pointcloud"'},{value:'"sankey"'},{value:'"scatter"'},{value:'"scatter3d"'},{value:'"scattercarpet"'},{value:'"scattergeo"'},{value:'"scattergl"'},{value:'"scattermapbox"'},{value:'"scatterpolar"'},{value:'"scatterpolargl"'},{value:'"scatterternary"'},{value:'"splom"'},{value:'"streamtube"'},{value:'"sunburst"'},{value:'"surface"'},{value:'"treemap"'},{value:'"violin"'},{value:'"waterfall"'}]}},horizontal:{defaultValue:null,description:"",name:"horizontal",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},xtitle:{defaultValue:null,description:"",name:"xtitle",required:!1,type:{name:"Plotly.LayoutAxis"}},ytitle:{defaultValue:null,description:"",name:"ytitle",required:!1,type:{name:"Plotly.LayoutAxis"}},xaxistype:{defaultValue:null,description:"",name:"xaxistype",required:!1,type:{name:"enum",value:[{value:'"log"'},{value:'"date"'},{value:'"linear"'},{value:'"-"'},{value:'"category"'},{value:'"multicategory"'}]}},showlegend:{defaultValue:null,description:"",name:"showlegend",required:!1,type:{name:"Plotly.Layout"}},barmode:{defaultValue:null,description:"",name:"barmode",required:!1,type:{name:"Plotly.Layout"}},displayModeBar:{defaultValue:null,description:"",name:"displayModeBar",required:!1,type:{name:"Plotly.Config"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function R(){return t.jsxs(w,{className:"FacetNavPanel",sx:{flexGrow:1},children:[t.jsxs(w,{className:"FacetNavPanel__title",children:[t.jsx(x,{variant:"rectangular",height:20,width:170}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(x,{variant:"rectangular",height:20,width:20}),t.jsx(x,{variant:"rectangular",height:20,width:20,sx:{ml:1}})]}),t.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",height:200,px:2,minWidth:"435px",flexGrow:1},children:[t.jsx(x,{variant:"circular",width:140,height:140}),t.jsxs(je,{sx:{gap:1},children:[t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220})]})]})]})}function Ie(){return t.jsxs(w,{className:"PlotsContainer",sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:4},children:[t.jsx(R,{}),t.jsx(R,{})]})}const b=2,v=(e,o)=>"__custom"in o&&"__custom"in e?e.title==o.title:!("__custom"in o)&&!("__custom"in e)?G(e,o):!1;function be(e){return e==="bar"?"BAR":"PIE"}const Ae=e=>"__custom"in e.plotId?`custom-${e.plotId.title}`:`facet-${e.plotId.columnName}-${e.plotId.jsonPath}`,Le=(e,o)=>!!o.find(l=>v(l.plotId,e)),M=e=>({__custom:!0,title:e.title??""}),Qe=(e=[],o=[],l=L)=>[...e.map((i,d)=>({plotId:M(i),isHidden:d>=b,plotType:be(i.type)})),...o.map((i,d)=>({plotId:i.facetToPlot,isHidden:d+e.length>=b,plotType:l}))],qe=(e,o,l)=>o.some(i=>v(M(i),e.plotId))||l.some(i=>v(i.facetToPlot,e.plotId)),L="PIE",Me=[],Re=[];function Q(e){const{facetsToPlot:o=Me,customPlots:l=Re,initialPlotType:i=L}=e,{data:d}=k(),{showPlots:_}=q(),[c,f]=P.useState([]),p=Ce(o),S=a=>{var r;return((r=c.find(n=>v(a,n.plotId)))==null?void 0:r.plotType)??L};P.useEffect(()=>{const a=Qe(l,p,i);f(s=>{const r=a.filter(u=>!Le(u.plotId,s));return[...s.filter(u=>qe(u,l,p)),...r]})},[l,p]);const g=a=>{f(s=>s.map((r,n)=>a?{...r,isHidden:!1}:{...r,isHidden:n>=b}))},j=a=>c.find(n=>v(a,n.plotId)&&n.isHidden===!0)!==void 0,m=P.useMemo(()=>c.find(a=>a.isHidden===!0)?"MORE":c.length<=b?"NONE":"LESS",[c]),E=a=>{C(a,"isHidden",!0)},N=(a,s)=>{C(a,"plotType",s)},C=(a,s,r)=>{f(n=>n.map(y=>v(a,y.plotId)?{...y,[s]:r}:y))},F=Ee(d,o).map((a,s)=>({facet:{columnName:a.columnName,jsonPath:a.jsonPath},colorIndex:s}));return t.jsx(t.Fragment,{children:c.length>0&&t.jsxs("div",{className:`PlotsContainer ${_?"":"hidden"} ${m==="LESS"?"less":""}`,children:[t.jsx("div",{className:"PlotsContainer__row",role:"list",children:c.map(a=>{var y;const s="__custom"in a.plotId,r=l.find(u=>v(M(u),a.plotId)),n=p.find(u=>v(u.facetToPlot,a.plotId));return t.jsxs("div",{style:{minWidth:"435px",display:j(a.plotId)?"none":"block"},children:[s&&r&&t.jsx(A,{...r,onHide:()=>E(a.plotId)}),!s&&n&&t.jsx(Te,{index:(y=F.find(u=>v(u.facet,a.plotId)))==null?void 0:y.colorIndex,onHide:()=>E(a.plotId),plotType:S(a.plotId),onSetPlotType:u=>N(a.plotId,u),isModalView:!1,...n})]},Ae(a))})}),m!=="NONE"&&t.jsx(w,{sx:{display:"flex",justifyContent:"center",backgroundColor:"grey.100",p:2,mt:2},children:t.jsx(Ne,{variant:"contained",color:"secondary",onClick:()=>g(m==="MORE"),sx:{width:"150px"},children:m==="LESS"?"Hide Charts":"View All Charts"})})]})})}function Be(e){const{showPlots:o}=q();return t.jsx(P.Suspense,{fallback:o?t.jsx(Ie,{}):null,children:t.jsx(Q,{...e})})}try{Q.displayName="PlotsContainer",Q.__docgenInfo={description:"",displayName:"PlotsContainer",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}},customPlots:{defaultValue:null,description:"",name:"customPlots",required:!1,type:{name:"QueryWrapperSynapsePlotProps[]"}},initialPlotType:{defaultValue:null,description:"",name:"initialPlotType",required:!1,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'},{value:'"STACKED_HORIZONTAL_BAR"'}]}}}}}catch{}const De="isShowingFacetFilters",Ve="isHidingFacetFilters",Oe="hasSelectedRows";function We(e){const{tableConfiguration:o,name:l,cardConfiguration:i,facetsToPlot:d,availableFacets:_,facetValueSortConfigs:c,initialExpandedFacetControls:f,hideDownload:p,hideQueryCount:S,hideSqlEditorControl:g,hideVisualizationsControl:j,searchConfiguration:m,cavaticaConnectAccountURL:E,customControls:N,remount:C,isFullTextSearchEnabled:F,customPlots:a,initialLimit:s,initialPlotType:r}=e,n=D(),[y,u]=P.useState(!1),{hasFacetedSelectColumn:T,queryMetadataQueryOptions:V}=n,{isLoading:O}=ee(V),W=Fe(ve),h=n.currentQueryRequest,U=(h==null?void 0:h.query.selectedFacets)!==void 0&&h.query.selectedFacets.length>0||(h==null?void 0:h.query.additionalFilters)!==void 0&&(h==null?void 0:h.query.additionalFilters.length)>0;return t.jsx($,{children:I=>{if(I===void 0)throw new Error("No queryVisualizationContext found when using QueryVisualizationContextConsumer");return t.jsx(w,{className:`QueryWrapperPlotNav ${I.showFacetFilter?De:Ve} ${W?Oe:""}`,sx:{"*":{cursor:O?"wait":void 0}},children:t.jsxs(Se,{children:[F?t.jsx(ye,{ftsConfig:m==null?void 0:m.ftsConfig}):t.jsx(fe,{...m,queryContext:n,queryVisualizationContext:I}),t.jsx(xe,{}),I.showDownloadConfirmation&&t.jsx(ce,{onClose:()=>I.setShowDownloadConfirmation(!1)}),t.jsx(z,{children:t.jsx(he,{showColumnSelection:o!==void 0,name:l,hideDownload:p,hideQueryCount:S,hideFacetFilterControl:!T,hideVisualizationsControl:!T||j,hideSqlEditorControl:g,cavaticaConnectAccountURL:E,customControls:N,remount:C})}),T&&t.jsx(t.Fragment,{children:t.jsx(we,{availableFacets:_,facetValueSortConfigs:c,initialExpandedFacetControls:f})}),t.jsx(me,{frontText:"",endText:U?"filtered by":"",hideIfUnfiltered:!0}),t.jsx(Be,{facetsToPlot:d,customPlots:a,initialPlotType:r}),t.jsx(pe,{tableConfiguration:o,hideDownload:p,cardConfiguration:i,initialLimit:s}),y&&t.jsx(Pe,{getLastQueryRequest:n==null?void 0:n.getCurrentQueryRequest,onClose:()=>u(!1)})]})})}})}function B(e){var u;const{sql:o,tableConfiguration:l,isInfinite:i=!l,limit:d=te,showLastUpdatedOn:_,unitDescription:c,additionalFiltersSessionStorageKey:f,helpConfiguration:p,customPlots:S,enabledExternalAnalysisPlatforms:g}=e,j=((u=e.query)==null?void 0:u.sql)??o??"",{entityId:m,versionNumber:E}=J(j),N=P.useMemo(()=>{if(e.query)return e.query;if(e.initQueryJson)return JSON.parse(e.initQueryJson);{const T=Z(e.searchParams,e.sqlOperator,f);return{sql:o,additionalFilters:T,limit:d,offset:0}}},[e.query,e.initQueryJson,e.searchParams,e.sqlOperator,f,o,d]),[C,F]=P.useState(1),a=()=>{F(C+1)},{data:s}=de(m,E),r={entityId:m??"",concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:ae|oe|ne|se|re|le|ie|ue,query:N},n=(s&&X(s)&&s.isSearchEnabled)??!1,y=`${JSON.stringify(r)}-${C}`;return P.createElement(H,{...e,initQueryRequest:r,key:y,isInfinite:i},t.jsx(K,{unitDescription:c,rgbIndex:e.rgbIndex,columnAliases:e.columnAliases,helpConfiguration:p,visibleColumnCount:e.visibleColumnCount,defaultShowPlots:e.defaultShowPlots,hideCopyToClipboard:e.hideCopyToClipboard,defaultShowSearchBar:(e.defaultShowSearchBox||n)&&!e.hideSearchBarControl,hideSearchBarControl:e.hideSearchBarControl,showLastUpdatedOn:_,noContentPlaceholderType:Y.INTERACTIVE,hasCustomPlots:Array.isArray(S)&&S.length>0,enabledExternalAnalysisPlatforms:g,children:t.jsx(We,{...e,isFullTextSearchEnabled:n,remount:a})}))}try{B.displayName="QueryWrapperPlotNav",B.__docgenInfo={description:"",displayName:"QueryWrapperPlotNav",props:{}}}catch{}export{B as Q};
