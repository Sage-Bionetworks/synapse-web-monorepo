import{j as c}from"./jsx-runtime-DNP5ZHPF.js";import{l as v,bi as Ie,bp as E,H as Se,as as Te}from"./useFiles-DxEFRl-N.js";import{g as D,R as De,F as W}from"./VerificationSubmission-B0kBNeMy.js";import{f as xe}from"./StringUtils-CzgJJW-6.js";import"./OrientationBanner-lGnlzz1n.js";import{r as p}from"./index-C9LqO53Z.js";import{u as A}from"./useEntity-DqG3EDzd.js";import{c as ne,u as Ee,g as Ne,S as Re}from"./StyledTanStackTable-fdH_iri2.js";import{M as ve}from"./ModalDownload-gqRGhleY.js";import{u as x}from"./QueryContext-DfvEq5GV.js";import{c as N,u as te,g as Ae,e as Le}from"./QueryWrapper-DutBOCKd.js";import{b as Ve,s as _e,a as je}from"./TableRowSelectionState-DJuPbdhA.js";import{u as He,a as Fe}from"./useGetEntityHeaders-DxbsW9a0.js";import{b as qe}from"./useDownloadList-Dc0wldCd.js";import{I as ke}from"./IconSvg-DVy36fcc.js";import{d as R}from"./ToastMessage-C3sj4-_Q.js";import{T as Pe}from"./Tooltip--gcNUJrW.js";import{L as Oe}from"./Link-BP8bljuP.js";import{F as Qe}from"./FileEntityDirectDownload-B__qy_Kl.js";import{H as Be,u as ze}from"./HasAccessV2-Bn93lbiv.js";import{C as Ue}from"./ColumnHeader-BkDSJpOf.js";import{E as $e}from"./EnumFacetFilter-C0HlhAfE.js";import{i as Ge}from"./SynapseConstants-x7wBmLwm.js";import{b as Me}from"./SqlFunctions-DnxC6kpb.js";import{I as We}from"./InteractiveCopyIdsIcon-CFC02ZEH.js";import{S as Ye}from"./LoadingScreen-60maNtYR.js";import{S as Je}from"./SynapseTableCell-CZOL8iv7.js";import{u as Ke}from"./index-D0TM4b_V.js";import{C as Xe}from"./Checkbox-BRH9nGgz.js";import{i as Ze}from"./isEqual-CyOrkakg.js";import{u as oe,b as en}from"./react-LeG2f8XJ.js";import{i as F,a as se,b as nn}from"./SynapseTableUtils-DSUAM55b.js";import{u as tn}from"./utils-Dge9E0v5.js";import{c as on}from"./UserBadge-UtVQL_Wk.js";import{c as sn}from"./cloneDeep-DGtsa-PL.js";import{b as an}from"./use-deep-compare-effect.esm-CGTFEkO2.js";const ae=p.createContext(void 0);function ie(){const n=p.useContext(ae);if(n===void 0)throw new Error("useSynapseTableContext must be used within a SynapseTableContext");return n}function q(n){const{entityId:e,entityVersionNumber:s}=n,{accessToken:t}=v(),o=!!t,{data:i}=A(e,s),{mutate:a}=qe({onSuccess:()=>{R(`${(i==null?void 0:i.name)??e} was successfully added to your Download Cart.`,"success")},onError:l=>{R(`Unable to add the file to your Download Cart. ${l.reason}`,"danger")}});return o?c.jsx(c.Fragment,{children:c.jsx(Pe,{title:"Add this file to your Download Cart",placement:"right",enterNextDelay:300,children:c.jsx(Oe,{"data-testid":"AddToDownloadListV2",onClick:()=>{a({entityId:e,entityVersionNumber:s})},className:"ignoreLink",children:c.jsx(ke,{icon:"addToCart"})})})}):c.jsx(c.Fragment,{})}try{q.displayName="AddToDownloadListV2",q.__docgenInfo={description:"",displayName:"AddToDownloadListV2",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},entityVersionNumber:{defaultValue:null,description:"",name:"entityVersionNumber",required:!1,type:{name:"number"}}}}}catch{}const k=n=>{const e=v(),{getCurrentQueryRequest:s}=x(),t=p.useMemo(()=>s(),[s]),[o,i]=p.useState(!1),[a,l]=p.useState(),[r,m]=p.useState();p.useEffect(()=>(r||m(new AbortController),()=>{r&&r.abort()}),[r]);const d=()=>{i(!0);const{sql:u}=t.query,{entityId:y,versionNumber:f}=Me(u),w=f?`.${f}`:"";t.partMask=Ge;const C=`${y}${w}`,g=u.indexOf(C);t.query.sql=`select id from ${C}${u.substring(g+C.length)}`,Ie(t,e.accessToken,r==null?void 0:r.signal).then(h=>{l(h)}).catch(h=>{console.error(h),R("Unable to query for all Synapse IDs to copy","danger")}).finally(()=>{i(!1)})};return p.useEffect(()=>{if(a){const{rows:u}=a.queryResult.queryResults,y=u.map(f=>`${f.values[0]}`).join(`
`);xe(y).then(()=>{R("Successfully copied to clipboard"),l(void 0)})}},[a]),o?c.jsx(Ye,{size:25}):c.jsx(We,{...n,onCopy:()=>{d()}})};try{k.displayName="EntityIDColumnCopyIcon",k.__docgenInfo={description:"",displayName:"EntityIDColumnCopyIcon",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"Ref<HTMLButtonElement>"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const L="org.sagebionetworks.web.client.SynapseTablePredefinedColumn",V=ne();function rn(n){var l;const{row:e,table:s}=n,t=(l=s.options.meta)==null?void 0:l.rowSet,o=oe(Ve),[i,a]=en(_e);return c.jsx("div",{children:c.jsx(Xe,{inputProps:{"aria-label":"Select row"},checked:o(e.original,t.headers),onChange:(r,m)=>{const d=[...i];if(m)d.push(e.original);else{const u=d.findIndex(y=>Ze(y,e.original));u>-1&&d.splice(u,1)}a(d)}})})}const Y=V.display({id:`${L}.RowSelectionColumn`,enableResizing:!1,cell:rn,maxSize:36,meta:{textAlign:"center"}});function ln(n){const e=_(n),s=Q(n),t=s?parseInt(s):void 0,{data:o}=He(e);return c.jsx("div",{"data-testid":"AddToDownloadListCell",children:(o==null?void 0:o.type)==="org.sagebionetworks.repo.model.FileEntity"&&c.jsx(q,{entityId:e,entityVersionNumber:t})})}const J=V.display({id:`${L}.AddToDownloadListColumn`,enableResizing:!1,cell:ln,maxSize:50,meta:{textAlign:"center"}});function cn(n){const e=_(n),s=Q(n);return c.jsx("div",{"data-testid":"DirectDownloadCell",children:c.jsx(Qe,{entityId:e,entityVersionNumber:s,iconSvgPropOverrides:{sx:{color:"primary.main"}}})})}const K=V.display({id:`${L}.DirectDownload`,enableResizing:!1,cell:cn,maxSize:50,meta:{textAlign:"center"}}),_=n=>{var i,a;const{row:e,table:s}=n,t=(i=s.options.meta)==null?void 0:i.rowEntityIDColumnIndex;return t!==void 0?e.original.values[t]:(a=e.original.rowId)==null?void 0:a.toString()},dn=n=>{var s;const{table:e}=n;return((s=e.options.meta)==null?void 0:s.rowEntityVersionColumnIndex)!==void 0},Q=n=>{var i,a;const{row:e,table:s}=n,t=(i=s.options.meta)==null?void 0:i.rowEntityVersionColumnIndex;return t!==void 0?e.original.values[t]:(a=e.original.versionNumber)==null?void 0:a.toString()};function un(n){const{showExternalAccessIcon:e}=ie(),{ref:s,inView:t}=Ke({triggerOnce:!0}),o=_(n),i=!e||e&&t;return c.jsx("div",{ref:s,"data-testid":"AccessCell",children:i&&c.jsx(Be,{entityId:o,showButtonText:!1,showExternalAccessIcon:e},o)})}const X=V.display({id:`${L}.Access`,enableResizing:!1,cell:un,maxSize:50,meta:{textAlign:"center"}});function P(n){var S;const{column:e}=n,{lockedColumn:s}=x(),{data:t}=N(),o=(t==null?void 0:t.columnModels)??[],a=((t==null?void 0:t.selectColumns)??[]).find(I=>I.name===e.id),l=o.find(I=>I.name===e.id),r=(t==null?void 0:t.facets)??[],{getColumnDisplayName:m,getHelpText:d}=te(),u=a?m(a.name):e.id,y=a?d(a.name):void 0,f=r.findIndex(I=>I.columnName===(l==null?void 0:l.name)&&I.jsonPath==null),w=f!==-1&&r[f].facetType==="enumeration",C=r[f],g=a&&a.name.toLowerCase()===((S=s==null?void 0:s.columnName)==null?void 0:S.toLowerCase()),h=a&&a.name=="id"&&a.columnType==D.ENTITYID;return n.column.getCanFilter=p.useCallback(()=>!!(w&&!g&&l),[w,g,l]),c.jsx(Ue,{...n,title:u,helpText:y,filterControl:c.jsx("span",{children:c.jsx($e,{containerAs:"Dropdown",facet:C,defaultShowAllValues:!0})}),additionalButtons:c.jsx(c.Fragment,{children:h&&c.jsx(k,{size:"small"})})})}function O(n){var u,y;const{cell:e,table:s}=n,{data:t}=N(),o=_(n),i=Q(n),a=i!==void 0?parseInt(i):void 0,l=((y=(u=s.options.meta)==null?void 0:u.rowSet)==null?void 0:y.headers)??[],r=l.find(f=>f.name===e.column.id),m=(t==null?void 0:t.columnModels)??[],{columnLinks:d}=ie();if(r){const f=(d??[]).find(g=>g.matchColumnName===r.name),w=r.columnType,C=e.column.getIsSorted()?"SRC-boldText":"";return c.jsx(Je,{columnType:w,columnValue:e.getValue(),isBold:C,columnLinkConfig:f,columnName:r.name,rowData:e.row.original.values,selectColumns:l,columnModels:m,rowId:o,rowVersionNumber:a,isRowEntityColumn:dn(n)},e.id)}else return c.jsx("td",{},e.id)}try{P.displayName="TableDataColumnHeader",P.__docgenInfo={description:"",displayName:"TableDataColumnHeader",props:{}}}catch{}try{O.displayName="TableDataCell",O.__docgenInfo={description:"",displayName:"TableDataCell",props:{}}}catch{}function mn(n){const{entityId:e,versionNumber:s}=x(),{data:t}=A(e,s),{data:o}=N(),i=E(D.FILEHANDLEID,o==null?void 0:o.selectColumns);let a=[];return t&&n&&o&&o.selectColumns&&(a=n.rows.reduce((l,r)=>(i.forEach(m=>{const d=r.values[m];if(d){const u=o==null?void 0:o.selectColumns[m];se(t)&&u.name==="dataFileHandleId"?l.push({fileHandleId:d,associateObjectId:String(r.rowId),associateObjectType:W.FileEntity}):l.push({fileHandleId:d,associateObjectId:t.id,associateObjectType:W.TableEntity})}}),l),a)),Te({requestedFiles:a,includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},{enabled:a.length>0})}function fn(n){const{entityId:e,versionNumber:s}=x(),{data:t}=A(e,s),{data:o}=N();let i=[];t&&F(t)&&(i=n.rows.reduce((r,m)=>{const{rowId:d,versionNumber:u}=m;return d&&r.push({targetId:`syn${d}`,targetVersionNumber:u}),r},i));let a=E(D.ENTITYID,o==null?void 0:o.selectColumns);if(t&&F(t)){const r=Se("id",o);a=a.filter(m=>m!==r)}const l=E(D.ENTITYID_LIST,o==null?void 0:o.selectColumns);return i=n.rows.reduce((r,m)=>(a.forEach(d=>{const u=m.values[d];u&&!r.find(y=>y.targetId===u&&y.targetVersionNumber==null)&&r.push({targetId:u})}),l.forEach(d=>{const u=m.values[d];u&&JSON.parse(u).forEach(f=>{f&&!r.find(w=>w.targetId===f&&w.targetVersionNumber==null)&&r.push({targetId:f})})}),r),i),i}function pn(n){return Fe(n,{enabled:n.length>0})}function yn(n){const{data:e}=N(),s=E(D.USERID,e==null?void 0:e.selectColumns),t=E(D.USERID_LIST,e==null?void 0:e.selectColumns),o=n.rows.reduce((i,a)=>(s.forEach(l=>{const r=a.values[l];r&&!i.includes(r)&&i.push(r)}),t.forEach(l=>{const r=a.values[l];r&&JSON.parse(r).forEach(d=>{i.includes(String(d))||i.push(String(d))})}),i),[]);return on(o,{enabled:o.length>0})}function wn(n){const e=p.useMemo(()=>{const s=n.map(t=>t.targetId);return Array.from(new Set(s))},[n]);return ze({objectIds:e,restrictableObjectType:De.ENTITY},{enabled:n.length>0})}function hn(n){const e=fn(n),{isLoading:s}=pn(e),{isLoading:t}=wn(e),{isLoading:o}=mn(n),{isLoading:i}=yn(n);return{dataHasBeenPrefetched:!s&&!t&&!o&&!i}}function at(){const{keyFactory:n,accessToken:e}=v(),{currentQueryRequest:s}=x(),t=tn(),o=void 0;return p.useCallback(i=>{const a=Ae({pageNumber:i},sn(s)),{rowDataQueryOptions:l}=Le(a,o,n,e);return t.prefetchQuery(l)},[e,s,n,o,t])}function Cn(n){return n.map(e=>({id:e.column,desc:e.direction==="DESC"}))}function gn(n){return n.map(e=>({column:e.id,direction:e.desc?"DESC":"ASC"}))}function bn(){var o,i;const n=x(),e=an((i=(o=n.nextQueryRequest)==null?void 0:o.query)==null?void 0:i.sort),s=p.useMemo(()=>e?Cn(e):[],[e]);return{sort:s,setSort:a=>{let l;typeof a=="function"?l=a(s):l=a;const r=gn(l);n.executeQueryRequest(m=>({...m,query:{...m.query,sort:r,offset:0}}))}}}const In=ne();function Z(n){var M;const{showDownloadColumn:e,hideDownload:s}=n,{rowSet:t,isLoadingNewPage:o,showAccessColumn:i,showExternalAccessIcon:a,showAccessColumnHeader:l,showDirectDownloadColumn:r=e,hideAddToDownloadListColumn:m=s,columnLinks:d}=n,{entityId:u,versionNumber:y,getCurrentQueryRequest:f,fileIdColumnName:w,fileVersionColumnName:C}=x(),g=p.useMemo(()=>f(),[f]),h=t.headers,{data:S}=A(u,y),{columnsToShowInTable:I,NoContentPlaceholder:re}=te(),le=p.useMemo(()=>({columnLinks:d,showExternalAccessIcon:a}),[d,a]),ce=!!v().accessToken,[de,ue]=p.useState(!1),{sort:me,setSort:fe}=bn(),j=oe(je),B=!!(i&&S&&(F(S)&&ee(t)||w)),z=S&&ce&&(se(S)&&ee(t)||w),U=!!(z&&r),$=!!(z&&!m&&!j),pe=w?t.headers.findIndex(b=>b.name==w):void 0,ye=C?t.headers.findIndex(b=>b.name==C):void 0,we=p.useMemo(()=>[Y,J,K,{...X,header:i&&l?"Access":""},...h.map((b,T)=>In.accessor(H=>H.values[T],{id:b.name,enableSorting:nn(b.columnType),enableResizing:!0,size:200,header:P,cell:O}))??[]],[h,i]),G=p.useMemo(()=>({[Y.id]:j,[J.id]:$,[K.id]:U,[X.id]:B}),[j,B,$,U]),he=p.useMemo(()=>h.reduce((b,T)=>({...b,[T.name]:I.includes(T.name)}),G),[I,h,G]),{dataHasBeenPrefetched:Ce}=hn(t),ge=o||!Ce,be=Ee({data:t.rows,columns:we,getCoreRowModel:Ne(),manualSorting:!0,manualFiltering:!0,onSortingChange:fe,enableMultiSort:!0,columnResizeMode:"onChange",state:{sorting:me,columnVisibility:he},meta:{rowSet:t,rowEntityIDColumnIndex:pe,rowEntityVersionColumnIndex:ye,renderPlaceholderData:ge,getWrapInExpandableTd:b=>{const T=h.find(H=>H.name===b.column.id);return!!(T&&T.columnType!==D.JSON)}}});return t?!((((M=t.rows)==null?void 0:M.length)??0)>0)&&(g.query.offset===0||g.query.offset==null)?c.jsx(re,{}):c.jsx(ae.Provider,{value:le,children:c.jsxs("div",{children:[de&&c.jsx(ve,{onClose:()=>{ue(!1)},queryBundleRequest:g}),c.jsx(Re,{styledTableContainerProps:{className:"SynapseTable","data-testid":"SynapseTable",density:"default"},table:be,fullWidth:!1})]})}):c.jsx(c.Fragment,{})}function ee(n){var e;return!!((e=n.rows)!=null&&e.every(s=>!!s.rowId))}try{Z.displayName="SynapseTable",Z.__docgenInfo={description:"",displayName:"SynapseTable",props:{rowSet:{defaultValue:null,description:"The row data shown in the table.",name:"rowSet",required:!0,type:{name:"RowSet"}},isLoadingNewPage:{defaultValue:null,description:"Whether a new page of data is being loaded",name:"isLoadingNewPage",required:!0,type:{name:"boolean"}},showAccessColumn:{defaultValue:null,description:"If true and entity is a view or dataset, renders a column that represents if the caller has permission to download the entity represented by the row",name:"showAccessColumn",required:!1,type:{name:"boolean"}},showExternalAccessIcon:{defaultValue:{value:"false"},description:`If true, the component will show enhanced UI for the case where
- the entity is a FileEntity, AND
- the caller has permission to fetch the dataFileHandle, AND
- the dataFileHandle is an instance of ExternalFileHandleInterface (i.e. the file is not controlled by Synapse)
Note that this requires an additional API call that cannot be batched, so it should be avoided in bulk  contexts if possible.`,name:"showExternalAccessIcon",required:!1,type:{name:"boolean"}},showAccessColumnHeader:{defaultValue:null,description:"",name:"showAccessColumnHeader",required:!1,type:{name:"boolean"}},showDownloadColumn:{defaultValue:null,description:"@deprecated use showDirectDownloadColumn",name:"showDownloadColumn",required:!1,type:{name:"boolean"}},hideDownload:{defaultValue:null,description:"@deprecated use hideAddToDownloadListColumn",name:"hideDownload",required:!1,type:{name:"boolean"}},showDirectDownloadColumn:{defaultValue:null,description:"If true and entity is a file view or dataset, renders a column that allows the logged-in user to directly download the file, if they have permission",name:"showDirectDownloadColumn",required:!1,type:{name:"boolean"}},hideAddToDownloadListColumn:{defaultValue:null,description:"If true, the add to download list column will be hidden",name:"hideAddToDownloadListColumn",required:!1,type:{name:"boolean"}},columnLinks:{defaultValue:null,description:"Configuration to override cell renderers with e.g. a link to a portals detail page",name:"columnLinks",required:!1,type:{name:"LabelLinkConfig"}}}}}catch{}export{Z as S,at as u};
