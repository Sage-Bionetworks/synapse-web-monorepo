import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{r as o}from"./index-Cu9bd8lq.js";import{M as ne}from"./ConfirmationDialog-CYZ1zN3z.js";import{u as G}from"./utils-Dbx_liB_.js";import{L as H}from"./ListItem-DpA-jtqV.js";import{L as ae}from"./ListItemText-DOcl5EX5.js";import{B as d}from"./Box-BXEUN41W.js";import{c as oe}from"./createSvgIcon-WkAWHJz7.js";import{A as J}from"./Alert-B_MCCiJI.js";import"./SkeletonButton-OK12EGd9.js";import"./SkeletonInlineBlock-CI9NukPL.js";import"./SkeletonTable-CBlGXcmw.js";import{S as ce}from"./SkeletonParagraph-2aiTEpj0.js";import{u as ie}from"./useQuery-BEUP4ZKU.js";import{u as w}from"./useMutation-BUHlmdy0.js";import{l as f,S as T}from"./useFiles-DemGcTQW.js";import"./RegularExpressions-B4RNwTAQ.js";import"./OrientationBanner-CtCcd4b5.js";import{J as h}from"./index-BNbykmw2.js";import{D as le}from"./DropdownSelect-kG8NZpEl.js";import{T as y}from"./Typography-BmBIKDjf.js";import{d as ue}from"./ToastMessage-B5PhHTSL.js";import{S as de}from"./LoadingScreen-C7dbrVc-.js";import{L as pe}from"./List-juhkPtLg.js";import{T as me}from"./ButtonBase-BH4d2aSg.js";import{F as xe}from"./Fade-DsJosqMx.js";import{T as fe}from"./TextField-cHNg-UFf.js";import{I as ge}from"./IconButton-CLlNv19f.js";import{A as he}from"./ArrowUpward-CGgMC0sw.js";const ye=oe([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")],"SmartToyTwoTone"),S=({userMessage:s,chatResponseText:i,chatErrorReason:r,scrollIntoView:n=!1})=>{const c=G(),l=o.useRef(null);return o.useEffect(()=>{n&&l.current&&l.current.scrollIntoView({behavior:"smooth"})},[l]),e.jsxs(e.Fragment,{children:[e.jsx(H,{ref:l,sx:{alignSelf:"flex-end",backgroundColor:c.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(ae,{primary:s})}),i&&e.jsxs(H,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(d,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(ye,{sx:{color:"secondary.main"}})}),e.jsx(d,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"},children:e.jsx(ne,{markdown:i})})]}),r&&e.jsx(J,{severity:"error",sx:{my:2},children:r})]})};try{S.displayName="SynapseChatInteraction",S.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function Se(s){const{accessToken:i}=f();return w({mutationFn:r=>T.createAgentSession(r,i),onSuccess:async(r,n,c)=>{s!=null&&s.onSuccess&&await s.onSuccess(r,n,c)}})}function Te(s){const{accessToken:i}=f();return w({mutationFn:r=>T.updateAgentSession(r,i),onSuccess:async(r,n,c)=>{s!=null&&s.onSuccess&&await s.onSuccess(r,n,c)},onError:async(r,n,c)=>{s!=null&&s.onError&&await s.onError(r,n,c)}})}function Ae(s,i){const{accessToken:r}=f();return w({mutationFn:n=>T.getAgentChatAsyncJobResults(n,r,i),onSuccess:(n,c,l)=>{s!=null&&s.onSuccess&&n.responseBody&&s.onSuccess(n.responseBody,c,l)},onError:(n,c,l)=>{s!=null&&s.onError&&s.onError(n,c,l)}})}function Ie(s,i){const{accessToken:r,keyFactory:n}=f();return ie({...i,queryKey:n.getChatAgentTraceKey(s),queryFn:()=>T.getChatAgentTraceEvents(s,r)})}const R=[{value:h.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:h.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:h.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}],_=({onChange:s,initAccessLevel:i})=>{const r=R.findIndex(a=>a.value==i),n=R.map(a=>a.label),[c,l]=o.useState(r);return e.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[e.jsx(y,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),e.jsx(le,{variant:"outlined",options:n,selectedIndex:c,setSelectedIndex:a=>{c!==a&&(l(a),s(R[a].value))}})]})};try{_.displayName="AccessLevelMenu",_.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}const K=({initialMessage:s,agentRegistrationId:i,chatbotName:r="SynapseChat",hideTitle:n=!1,textboxPositionOffset:c="0px"})=>{const{accessToken:l}=f(),[a,M]=o.useState(),{mutate:A,error:L}=Se({onSuccess:t=>M(t)}),{mutate:$}=Te({onSuccess:t=>M(t),onError:t=>ue(`Unable to update the agent session: ${t.message}`,"danger")}),Q=G(),[k,X]=o.useState(h.PUBLICLY_ACCESSIBLE),[V,Z]=o.useState([]),[u,I]=o.useState(),[v,D]=o.useState(),[C,P]=o.useState(""),[b,B]=o.useState(""),[x,q]=o.useState(""),[F,ee]=o.useState(!1),[p,U]=o.useState(),{mutate:Y}=Ae({onSuccess:t=>{P(t.responseText)},onError:t=>{B(t.reason)}},t=>{D(t.jobId)}),{data:m}=Ie({jobId:v,newerThanTimestamp:p==null?void 0:p.timestamp},{enabled:!!v,refetchInterval:v?1e3:!1,refetchIntervalInBackground:!0});o.useEffect(()=>{if(m&&m.page.length>0){const t=m.page[m.page.length-1],te=new DOMParser().parseFromString(t.message,"text/html").getElementsByTagName("thinking"),re=Array.from(te).map(E=>{var z;return(z=E==null?void 0:E.textContent)==null?void 0:z.trim()}).join(`
`);t.friendlyMessage=re??t.message,U(t),console.debug(m.page)}},[m]),o.useEffect(()=>{u&&(C||b)&&(u.chatResponseText=C,u.chatErrorReason=b,Z([...V,u]),P(""),B(""),I(void 0),D(void 0),U(void 0))},[C,b,u]),o.useEffect(()=>{A&&!a&&A({agentAccessLevel:k,agentRegistrationId:i})},[A,a,l]),o.useEffect(()=>{a&&s&&!F&&(I({userMessage:s}),Y({chatText:s,sessionId:a.sessionId,enableTrace:!0}),ee(!0))},[a,s,F]);const j=()=>{x.trim()&&(I({userMessage:x}),q(""),Y({chatText:x,sessionId:a.sessionId,enableTrace:!0}))},g=!a||!x||!!u,se=t=>{!g&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),j())},O=Q.palette.secondary[300];if(L)return e.jsx(J,{severity:"error",sx:{my:2},children:L.reason});const W=(p==null?void 0:p.friendlyMessage)??"Processing...";return e.jsxs(d,{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",children:[!n&&e.jsx(y,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:r}),e.jsx(_,{initAccessLevel:k,onChange:t=>{X(t),$({agentAccessLevel:t,sessionId:a.sessionId})}}),!a&&e.jsx(ce,{numRows:10}),a&&e.jsx(d,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(pe,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[V.map((t,N)=>e.jsx(S,{userMessage:t.userMessage,chatResponseText:t.chatResponseText,chatErrorReason:t.chatErrorReason},N)),u&&e.jsxs(e.Fragment,{children:[e.jsx(S,{userMessage:u.userMessage,chatResponseText:u.chatResponseText,chatErrorReason:u.chatErrorReason,scrollIntoView:!0}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"5px"},children:[e.jsx(de,{size:40}),e.jsx(d,{sx:{position:"relative",pt:"130px"},children:e.jsx(me,{children:e.jsx(xe,{timeout:500,children:e.jsx(y,{sx:{textAlign:"center",position:"absolute",width:"100%",top:0},variant:"body1Italic",children:W})},W)})})]})]})]})}),e.jsx(d,{sx:{position:"sticky",bottom:c,backgroundColor:"white"},children:e.jsxs(d,{component:"form",sx:{pb:"10px",position:"sticky"},onSubmit:j,children:[e.jsx(fe,{fullWidth:!0,value:x,onChange:t=>q(t.target.value),onKeyDown:se,placeholder:`Message ${r}`,InputProps:{sx:{borderRadius:96.6},endAdornment:e.jsx(ge,{disabled:g,onClick:j,sx:{ml:"7px",mr:"-8px",color:O,borderStyle:"solid",borderWidth:g?"1px":"2px",borderColor:g?"gray":O},children:e.jsx(he,{})})}}),e.jsxs(y,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[r," can make mistakes."]})]})})]})};try{K.displayName="SynapseChat",K.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}}}}}catch{}export{K as S};
