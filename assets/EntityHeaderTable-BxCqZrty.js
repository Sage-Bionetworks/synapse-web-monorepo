import{j as e,r as s,c7 as ee,f0 as W,ca as re,eP as Z,dk as oe,d3 as le,dj as Y,W as x,Y as J,B as P,bs as X,am as de,dG as ce,c0 as ue,dZ as pe,c5 as me,i0 as ye}from"./iframe-D5Jb4H7-.js";import{S as ge}from"./StyledTableContainer-DATOZbmb.js";import{a as fe}from"./useGetEntityHeaders-DvIcjdbt.js";import{u as xe,a as he,b as Ce,d as be,e as we,f as Se,g as je,h as K}from"./StyledTanStackTable-DN18jPfe.js";import{p as Ee}from"./papaparse.min-B5u3t1TT.js";import{p as Ie}from"./pluralize-DvqWrKl4.js";import{E as Fe}from"./EntityFinderModal-Bx1Kipyf.js";import{F as Ve}from"./EntityFinder-CwDWHhkc.js";import{V as Re}from"./useEntitySelection-sIPnEDbF.js";import"./SkeletonButton-C8q9GuK7.js";import"./SkeletonInlineBlock-B1J-x5sp.js";import{S as _e}from"./SkeletonTable-CWnnOC4O.js";import"./SkeletonParagraph-1IqDxZQP.js";import{C as De,a as Te,E as ve,b as He,c as ke}from"./EntityHeaderTableCellRenderers-FuIdUn44.js";import{u as Me}from"./useDebouncedEffect-CVHaDEbp.js";import{A as Ae}from"./Autocomplete-hHIuN4rs.js";import{u as Ne}from"./upperFirst-BUh1CLsz.js";const v=a=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_6722_37828)",children:e.jsx("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{v.displayName="AddAd",v.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function B({initialValue:a,onChange:c,options:r,delay:d=250,...m}){const[u,h]=s.useState(a);return Me(()=>{c(u)},[c,u],d),e.jsx(Ae,{freeSolo:!0,disablePortal:!0,isOptionEqualToValue:(y,o)=>o.length==0||y===o,options:r,value:u,onChange:(y,o)=>{h(o??"")},sx:{marginRight:"10px"},renderInput:y=>e.jsx(ee,{...y,...m,value:u,onChange:o=>h(o.target.value)})})}try{B.displayName="DebouncedInput",B.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function U({column:a,table:c}){const r=c.getPreFilteredRowModel().flatRows[0]?.getValue(a.id),d=a.getFilterValue()??"",m=s.useMemo(()=>typeof r=="number"?[]:Array.from(a.getFacetedUniqueValues().keys()).sort(),[a.getFacetedUniqueValues()]);return e.jsx(B,{type:"text",options:m,initialValue:d,onChange:u=>a.setFilterValue(u),label:`Filter by ${a.columnDef.header} (${a.getFacetedUniqueValues().size})`})}try{U.displayName="Filter",U.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function qe(a,c,r){const[d,m]=s.useState({}),[u,h]=s.useState(W(a)),[y,o]=s.useState(""),[H,I]=s.useState([]);s.useEffect(()=>{h(W(a))},[a]);const S=s.useCallback(p=>{o(p),c&&c(p)},[c]),k=s.useCallback(p=>{m({}),h(p),r&&r(p),I([]),S("")},[r,S]);return{rowSelection:d,setRowSelection:m,refsInState:u,setRefsInState:k,newEntityIDs:y,setNewEntityIDs:S,parseErrors:H,setParseErrors:I}}const Pe={selectMultiple:!0,versionSelection:Re.DISALLOWED,initialScope:Ve.ALL_PROJECTS,initialContainer:"root"},Be=10,Q=a=>{const{references:c,isEditable:r,disabled:d,onUpdate:m=re,removeSelectedRowsButtonText:u="Remove Selected Rows",onUpdateEntityIDsTextbox:h,objectNameCopy:y="entity",hideTextFieldToPasteValue:o=!1,entityFinderConfiguration:H=Pe}=a,[I,S]=s.useState([]),[k,p]=s.useState(!1),{rowSelection:F,setRowSelection:te,refsInState:g,setRefsInState:j,newEntityIDs:l,setNewEntityIDs:V,parseErrors:R,setParseErrors:E}=qe(c,h,m),M=s.useCallback(n=>{E([`Invalid Synapse ID(s): ${n.join(",")}`])},[E]),A=s.useCallback(n=>{const t=n.map(i=>({targetId:i.trim()}));j([...g,...t])},[g,j]),ne=s.useCallback(()=>{l?l.includes(",")?Ee.parse(l,{complete:n=>{if(n.errors.length>0){const t=n.errors.map(i=>i.message);E(t)}else{const t=n.data[0],i=t.filter(b=>!b.trim().match(Z));i.length>0?M(i):A(t)}}}):l.trim().match(Z)?A([l]):M([l]):(E([]),V(""))},[A,l,M,V,E]),w=Ne(Ie(y)),z=s.useMemo(()=>[{id:"select",header:Te,cell:De}],[]),N=s.useMemo(()=>[{accessorFn:n=>n.name,id:"name",cell:ve,header:"Name"},{accessorFn:n=>n.id,id:"id",cell:He,header:"SynID"},{accessorFn:n=>n.isDummy?"-":oe(le(n)),id:"type",header:"Type",cell:ke,filterFn:"includesString"}],[]),se=s.useMemo(()=>r?z.concat(N):N,[N,r,z]),L=Object.keys(F).length,{data:q,isSuccess:ae,isLoading:O}=fe(g,{throwOnError:!0}),_=s.useMemo(()=>{const n=q?q?.results:[],t=new Set;n.forEach(f=>t.add(Y(f.id)));const b=g.filter(f=>!t.has(Y(f.targetId))).map(f=>({id:f.targetId,name:f.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return n.concat(b)},[g,q]),C=xe({data:_,columns:se,state:{rowSelection:F,columnFilters:I},enableRowSelection:r,onRowSelectionChange:te,onColumnFiltersChange:S,getCoreRowModel:je(),getFilteredRowModel:Se(),getSortedRowModel:we(),getFacetedRowModel:be(),getFacetedUniqueValues:Ce(),getFacetedMinMaxValues:he(),columnResizeMode:"onChange"}),ie=s.useCallback(()=>{const t=_.filter((i,b)=>F[b]!==!0).map(i=>({targetId:i.id}));j(t)},[_,F,j]),$=L>0,D=_.length,G=C.getPrePaginationRowModel().rows.length,T=D>Be;return s.useEffect(function(){T||C.setColumnFilters([])},[C,T]),O?e.jsx(_e,{numCols:3,numRows:Math.min(10,g.length)}):ae?e.jsxs("div",{children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",p:"12px 10px 10px 5px"},children:[T&&e.jsxs(J,{variant:"body1",sx:{marginBottom:"10px"},children:[D," ",w," ",G<D?`(${G} visible)`:"",$&&e.jsx("span",{children:` (${L} selected)`})]}),r&&g.length>0&&e.jsx(P,{variant:"contained",disabled:!$||d,onClick:ie,children:u})]}),e.jsx(x,{sx:{display:"flex",pb:2},children:C.getHeaderGroups().map(n=>n.headers.map(t=>t.isPlaceholder?null:e.jsx(s.Fragment,{children:t.column.getCanFilter()&&T?e.jsx(x,{sx:{flexGrow:1},children:e.jsx(U,{column:t.column,table:C})}):null},t.column.id)))}),D>0&&e.jsx(ge,{sx:{th:{zIndex:100,maxHeight:"250px"}},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:C.getHeaderGroups().map(n=>e.jsx("tr",{children:n.headers.map(t=>{let i="5%";switch(t.id){case"name":i="50%";break;case"id":i="22%";break;case"type":i="22%";break}return e.jsxs("th",{colSpan:t.colSpan,style:{width:i,position:"sticky",top:"0px"},children:[t.isPlaceholder?null:e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[K(t.column.columnDef.header,t.getContext()),e.jsx(x,{sx:{mx:"auto"}}),t.column.getCanSort()&&e.jsx(X,{onClick:t.column.getToggleSortingHandler(),size:"small",sx:{marginLeft:"auto",marginRight:"16px"},children:e.jsx(de,{icon:t.column.getIsSorted()==="asc"?"sortUp":"sortDown",wrap:!1,fontSize:"inherit",sx:{color:t.column.getIsSorted()?"primary.main":"grey.700",backgroundColor:"none"}})})]}),t.column.getCanResize()&&e.jsx("div",{className:`resizer ${t.column.getIsResizing()?"isResizing":""}`,onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler()})]},t.id)})},n.id))}),e.jsx("tbody",{children:C.getRowModel().rows.map(n=>e.jsx("tr",{style:{height:"30px"},children:n.getVisibleCells().map(t=>e.jsx("td",{style:{width:t.column.getSize()},children:K(t.column.columnDef.cell,t.getContext())},t.id))},n.id))})]})}),e.jsx(Fe,{configuration:H,promptCopy:`Select ${w} to add to the Synapse ID list`,show:k,title:`Select ${w}`,confirmButtonCopy:`Add ${w}`,onConfirm:n=>{if(o){const t=[...g,...n];j(t),m(t)}else{const t=n.map(f=>f.targetId),b=(l.trim().length>0?l.concat(","):l).concat(t.join(","));V(b)}p(!1)},onCancel:()=>p(!1)}),r&&e.jsxs(x,{sx:{marginTop:"10px"},children:[o&&e.jsxs(P,{variant:"outlined",onClick:()=>{p(!0)},startIcon:e.jsx(v,{}),disabled:d,children:["Add ",w]}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{htmlFor:"synIDs",children:"Add Synapse IDs"}),e.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[e.jsx(ee,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:n=>{V(n.target.value)},value:l,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')",disabled:d}),e.jsx(x,{sx:{padding:"5px 0px 0px 5px"},children:e.jsx(ue,{title:"Add a Synapse ID to the list via the Entity Finder",children:e.jsx(X,{disabled:d,onClick:()=>{p(!0)},children:e.jsx(v,{})})})}),e.jsxs(P,{variant:"outlined",onClick:ne,disabled:O||l.trim().length==0||d,startIcon:e.jsx(pe,{}),children:["Add ",w]})]})]}),R&&R.length>0&&e.jsxs(me,{severity:"error",sx:{my:2},children:[e.jsx(ye,{children:"Parsing errors encountered:"}),e.jsx("ul",{children:R.map((n,t)=>e.jsx(J,{component:R.length>1?"li":"span",variant:"smallText1",sx:{lineHeight:1.5},children:n},t))})]})]})]}):e.jsx(e.Fragment,{})};try{Q.displayName="EntityHeaderTable",Q.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"(updatedRefs: ReferenceList) => void"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"(value: string) => void"}},objectNameCopy:{defaultValue:null,description:"",name:"objectNameCopy",required:!1,type:{name:"string"}},hideTextFieldToPasteValue:{defaultValue:null,description:"",name:"hideTextFieldToPasteValue",required:!1,type:{name:"boolean"}},entityFinderConfiguration:{defaultValue:null,description:"",name:"entityFinderConfiguration",required:!1,type:{name:'Omit<EntityFinderProps, "onSelectedChange">'}}}}}catch{}export{Q as E};
