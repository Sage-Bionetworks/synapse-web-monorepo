import{S as N,aQ as S,n as V,aR as W,aS as U}from"./useFiles-CoPTJU2m.js";import{q as H}from"./VerificationSubmission-CMrrYimb.js";import{l as I}from"./index-CMK2qtuI.js";import{j as o}from"./jsx-runtime-BEwiZqqY.js";import"./StringUtils-Bdqa-HwM.js";import{u as v}from"./useMutation-CIDB2zHb.js";import"./OrientationBanner-CPbkKQek.js";import{r as a}from"./index-ChFhW-Al.js";import"./LastLoginInfo-DfKwjKBd.js";import{T as Y,R as B,O as G}from"./StandaloneLoginForm-DNkhTDP6.js";import"./TwoFactorAuthSettingsPanel-C2-f9NCi.js";import"./TwoFactorEnrollmentForm-Dj6W7o_n.js";import"./TwoFactorBackupCodes-CXaXYqDy.js";import{T as _}from"./Typography-Cf3i3BnW.js";import{A as y}from"./Alert-CP_ZH_t2.js";function M(e){return v({...e,mutationFn:u=>N.changePassword(u)})}function ce(e){return I.rest.post(e+S,(u,c,d)=>c(d.status(204)))}function de(e,u,c){return I.rest.post(e+S,async(d,w,i)=>{if("twoFaToken"in await d.json())return w(i.status(204));const t={concreteType:"org.sagebionetworks.repo.model.auth.TwoFactorAuthErrorResponse",reason:"Two factor authentication required.",errorCode:H.TWO_FA_REQUIRED,userId:u,twoFaToken:c};return w(i.status(401),i.json(t))})}const L="Two-factor authentication is required to change your password. Your password has not yet been changed.";function O(e){const u=V("/reset2FA"),c=W(u,"twoFAResetToken"),[d,w]=a.useState(""),[i,g]=a.useState(""),[t,T]=a.useState(),[n,m]=a.useState("VERIFICATION_CODE"),[k,b]=a.useState(!1),{mutate:h,isPending:C,error:q}=M({onSuccess:s=>{s?T(s):(b(!0),T(void 0),e!=null&&e.onChangePasswordSuccess&&e.onChangePasswordSuccess())}}),x=a.useCallback((s,r,l)=>{w(r),g(l),h({username:s,currentPassword:r,newPassword:l,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithCurrentPassword"})},[h]),D=a.useCallback((s,r)=>{g(s),h({newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithToken",passwordChangeToken:r})},[h]),P=a.useCallback((s,r,l)=>{if(t){const f={newPassword:s,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithTwoFactorAuthToken",userId:t.userId,twoFaToken:t.twoFaToken,otpType:l,otpCode:r};h(f)}},[h,t]),p=!!t,{mutate:A,isSuccess:R,isPending:F}=U(),E=a.useCallback(s=>{if(t){const r={userId:t.userId,twoFaResetEndpoint:s,password:d};A(r)}},[d,A,t]),j=a.useCallback(()=>p?o.jsxs(o.Fragment,{children:[n==="VERIFICATION_CODE"&&o.jsx(_,{variant:"body1",sx:{my:2},align:"center",children:Y}),n==="RECOVERY_CODE"&&o.jsx(_,{variant:"body1",sx:{my:2},align:"center",children:B}),o.jsx(G,{step:n,onClickUseTOTP:()=>{m("VERIFICATION_CODE")},onClickUseBackupCode:()=>{m("RECOVERY_CODE")},loginIsPending:C,onSubmit:(s,r)=>P(i,s,r),hideReset2FA:e==null?void 0:e.hideReset2FA,onClickPromptReset2FA:()=>{m("DISABLE_2FA_PROMPT")},onClickReset2FA:()=>{E(c)},twoFactorAuthResetIsPending:F,twoFactorAuthResetIsSuccess:R}),(n==="RECOVERY_CODE"||n==="VERIFICATION_CODE")&&o.jsx(y,{severity:"info",sx:{my:2},children:L}),n==="DISABLE_2FA_PROMPT"&&R&&o.jsxs(y,{severity:"warning",sx:{my:2},children:[o.jsx("strong",{children:"Your password has not been changed."})," To disable two-factor authentication, you may be required to enter your current password after clicking the link sent to your email address."]})]}):o.jsx(o.Fragment,{}),[E,P,C,i,e==null?void 0:e.hideReset2FA,n,p,F,R,c]);return{successfullyChangedPassword:k,isPending:C,error:q,promptForTwoFactorAuth:p,TwoFactorAuthPrompt:j,handleChangePasswordWithCurrentPassword:x,handleChangePasswordWithResetToken:D}}try{O.displayName="useChangePasswordFormState",O.__docgenInfo={description:"Hook that handles submitting a change password request and prompting the user for 2FA if necessary.",displayName:"useChangePasswordFormState",props:{hideReset2FA:{defaultValue:null,description:"",name:"hideReset2FA",required:!1,type:{name:"boolean"}},onChangePasswordSuccess:{defaultValue:null,description:"",name:"onChangePasswordSuccess",required:!1,type:{name:"() => void"}}}}}catch{}export{de as a,ce as g,O as u};
