var z=t=>{throw TypeError(t)};var S=(t,e,s)=>e.has(t)||z("Cannot "+s);var a=(t,e,s)=>(S(t,e,"read from private field"),s?s.call(t):e.get(t)),Q=(t,e,s)=>e.has(t)?z("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),b=(t,e,s,r)=>(S(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(S(t,e,"access private method"),s);import{r as H}from"./index-Cu9bd8lq.js";import{aE as K,aF as B,aG as N,aH as J,l as _,aI as j,aJ as T,aK as V,aL as X,aM as Y,aN as F,aO as U,aP as Z,aQ as $}from"./SynapseClient-CZkcD3lR.js";function D(t,e){return t.filter(s=>!e.includes(s))}function W(t,e,s){const r=t.slice(0);return r[e]=s,r}var R,E,w,f,M,C,c,x,P,L,k,A,G,ee=(G=class extends K{constructor(e,s,r){super();Q(this,c);Q(this,R);Q(this,E);Q(this,w);Q(this,f);Q(this,M);Q(this,C);b(this,R,e),b(this,w,[]),b(this,f,[]),p(this,c,x).call(this,[]),this.setQueries(s,r)}onSubscribe(){this.listeners.size===1&&a(this,f).forEach(e=>{e.subscribe(s=>{p(this,c,k).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,f).forEach(e=>{e.destroy()})}setQueries(e,s,r){b(this,w,e),b(this,M,s),B.batch(()=>{const n=a(this,f),i=p(this,c,L).call(this,a(this,w));i.forEach(h=>h.observer.setOptions(h.defaultedQueryOptions,r));const u=i.map(h=>h.observer),d=u.map(h=>h.getCurrentResult()),v=u.some((h,g)=>h!==n[g]);n.length===u.length&&!v||(b(this,f,u),p(this,c,x).call(this,d),this.hasListeners()&&(D(n,u).forEach(h=>{h.destroy()}),D(u,n).forEach(h=>{h.subscribe(g=>{p(this,c,k).call(this,h,g)})}),p(this,c,A).call(this)))})}getCurrentResult(){return a(this,C)}getQueries(){return a(this,f).map(e=>e.getCurrentQuery())}getObservers(){return a(this,f)}getOptimisticResult(e,s){const r=p(this,c,L).call(this,e),n=r.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[n,i=>p(this,c,P).call(this,i??n,s),()=>r.map((i,u)=>{const d=n[u];return i.defaultedQueryOptions.notifyOnChangeProps?d:i.observer.trackResult(d)})]}},R=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,M=new WeakMap,C=new WeakMap,c=new WeakSet,x=function(e){var s;b(this,E,e),b(this,C,p(this,c,P).call(this,e,(s=a(this,M))==null?void 0:s.combine))},P=function(e,s){return s?N(a(this,C),s(e)):e},L=function(e){const s=a(this,f),r=new Map(s.map(o=>[o.options.queryHash,o])),n=e.map(o=>a(this,R).defaultQueryOptions(o)),i=n.flatMap(o=>{const O=r.get(o.queryHash);return O!=null?[{defaultedQueryOptions:o,observer:O}]:[]}),u=new Set(i.map(o=>o.defaultedQueryOptions.queryHash)),d=n.filter(o=>!u.has(o.queryHash)),v=o=>{const O=a(this,R).defaultQueryOptions(o);return a(this,f).find(l=>l.options.queryHash===O.queryHash)??new J(a(this,R),O)},h=d.map(o=>({defaultedQueryOptions:o,observer:v(o)})),g=(o,O)=>n.indexOf(o.defaultedQueryOptions)-n.indexOf(O.defaultedQueryOptions);return i.concat(h).sort(g)},k=function(e,s){const r=a(this,f).indexOf(e);r!==-1&&(p(this,c,x).call(this,W(a(this,E),r,s)),p(this,c,A).call(this))},A=function(){B.batch(()=>{this.listeners.forEach(e=>{e(a(this,E))})})},G);function ne({queries:t,...e},s){const r=_(),n=j(),i=T(),u=H.useMemo(()=>t.map(l=>{const m=r.defaultQueryOptions(l);return m._optimisticResults=n?"isRestoring":"optimistic",m}),[t,r,n]);u.forEach(l=>{V(l),X(l,i)}),Y(i);const[d]=H.useState(()=>new ee(r,u,e)),[v,h,g]=d.getOptimisticResult(u,e.combine);H.useSyncExternalStore(H.useCallback(l=>n?()=>{}:d.subscribe(B.batchCalls(l)),[d,n]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),H.useEffect(()=>{d.setQueries(u,e,{listeners:!1})},[u,e,d]);const O=v.some((l,m)=>F(u[m],l))?v.flatMap((l,m)=>{const y=u[m];if(y){const I=new J(r,y);if(F(y,l))return U(y,I,i);Z(l,n)&&U(y,I,i)}return[]}):[];if(O.length>0)throw Promise.all(O);const q=v.find((l,m)=>{const y=u[m];return y&&$({result:l,errorResetBoundary:i,throwOnError:y.throwOnError,query:r.getQueryCache().get(y.queryHash)})});if(q!=null&&q.error)throw q.error;return h(g())}export{ne as u};
