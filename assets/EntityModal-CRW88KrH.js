import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{d as z,u as C}from"./useEntity-1Gq7_5yg.js";import{e as N,j as w,u as Q,w as X,x as Y}from"./StringUtils-CCbjCejM.js";import{g as O,B as D,v as ee}from"./useFiles-BNw6mVE-.js";import{r as _}from"./index-Dl6G-zuu.js";import{a as te,C as ae}from"./ConfirmationDialog-BoGyzx8S.js";import{u as ne,a as se,S as oe}from"./SchemaDrivenAnnotationEditor-Cg_fWR2h.js";import{d as ie}from"./ToastMessage-CBhzPong.js";import"./VerificationSubmission-BUSqAuLu.js";import"./OrientationBanner-BOCf4qOE.js";import{f as E}from"./DateFormatter-JGZGQaUU.js";import{d as j}from"./dayjs.min-d18Up55D.js";import{F as re}from"./FullWidthAlert-B_rXn9qX.js";import"./SkeletonButton-uq1QPER1.js";import"./SkeletonInlineBlock-DwjGa4Hr.js";import{S as le}from"./SkeletonTable-Bw4dIPRq.js";import"./SkeletonParagraph-CapqqUy7.js";import{i as de}from"./isNil-c8QyzjdH.js";import{g as ce,u as me,a as ue}from"./FileHandleUtils-B8cm6mHI.js";import{U as I}from"./UserBadge-D0gWu8mY.js";import{B as A}from"./Button-BkKUhIiJ.js";import{S as pe}from"./Skeleton-DiWSb2YA.js";import{n as _e}from"./noop-DX6rZLP_.js";import{T as ye}from"./Tooltip-CbFhYBpv.js";function he(a){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(a))return!1;const i=new Date(a);return i instanceof Date&&!isNaN(i.getTime())&&i.toISOString()===a}function g(a){return typeof a=="number"||typeof a=="boolean"?a.toString():he(a)?E(j(a)):a}function M(a){const{entityId:i,versionNumber:t}=a,[b,l]=_.useState(!1),{data:d,isLoading:f,refetch:y}=z(i,t,!0),r=d==null?void 0:d.entityMetadata,n=d==null?void 0:d.annotations,{data:p}=ne(i),{data:h,refetch:m}=se(i,{enabled:!!p}),o=!!p,c=!!r&&!!h&&j(r.modifiedOn).diff(j(h.validatedOn))>0,T=_.useCallback(async()=>{l(!0);const u=[y(),m()];await Promise.allSettled(u),l(!1)},[y,m]);return f||b?e.jsx(le,{numRows:3,numCols:2}):e.jsxs(e.Fragment,{children:[r&&n&&de(n)?e.jsxs("div",{className:"placeholder",children:["This"," ",N(w(r.concreteType))," ","has no annotations."]}):null,e.jsx("table",{className:"AnnotationsTable",children:e.jsxs("tbody",{children:[n&&Object.keys(n).map(u=>e.jsxs("tr",{className:"AnnotationsTable__Row",children:[e.jsx("td",{className:"AnnotationsTable__Row__Key",children:u}),e.jsx("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(n[u])?n[u].map(g).join(", "):g(n[u])})]},u)),o?e.jsxs("tr",{className:"AnnotationsTable__Row",children:[e.jsx("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e.jsx("td",{className:"AnnotationsTable__Row__Value",children:e.jsx("a",{href:`${O(D.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${p.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:p.jsonSchemaVersionInfo.schemaName})})]}):null]})}),r&&o&&c&&e.jsx(re,{variant:"warning",description:`This ${N(w(r.concreteType))} has changed since it has been last validated. If this ${N(w(r.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{T()}},isGlobal:!1})]})}try{g.displayName="getDisplayedAnnotation",g.__docgenInfo={description:"",displayName:"getDisplayedAnnotation",props:{}}}catch{}try{M.displayName="AnnotationsTable",M.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const R=({entityId:a,versionNumber:i})=>{var n,p,h,m,o,c,T;const{data:t}=C(a,i),b=t&&Q(t.entity),l=t?ce(t):void 0,d=(n=t==null?void 0:t.entity)==null?void 0:n.parentId,f=l==null?void 0:l.storageLocationId,{data:y}=me(d,f,{enabled:d!==void 0&&f!=null});let r;return l&&(r=ue(l,y)),t?e.jsx("table",{className:"MetadataTable",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Name"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(p=t.entity)==null?void 0:p.name})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Type"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:N(t.entityType)})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(h=t.entity)==null?void 0:h.id})]}),b&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Version"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:X(t.entity)})]}),r&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:r})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(I,{userId:(m=t.entity)==null?void 0:m.modifiedBy})," at"," ",E(j((o=t.entity)==null?void 0:o.modifiedOn))]})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Created By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(I,{userId:(c=t.entity)==null?void 0:c.createdBy})," at"," ",E(j((T=t.entity)==null?void 0:T.createdOn))]})]})]})}):null};try{R.displayName="MetadataTable",R.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const fe=["METADATA","ANNOTATIONS"];function V(a){const{entityId:i,versionNumber:t,show:b,onClose:l,initialTab:d="METADATA",showTabs:f=!0,onEditModeChanged:y=_e}=a,r=_.useRef(null),[n,p]=_.useState(d),[h,m]=_.useState(!1),[o,c]=_.useState(!1),[T,u]=_.useState(()=>c(!1));_.useEffect(()=>(y(o),()=>{y(!1)}),[o,y]);const{data:s}=C(i,t),B=s&&s.permissions.canEdit,S=s&&Y(s.entityType),q=S&&s.entity.isLatestVersion,L=n==="METADATA"&&s&&!window.location.href.includes(i),k=e.jsxs(A,{variant:"contained",onClick:()=>window.open(`${O(D.PORTAL_ENDPOINT)}Synapse:${i}`,"_blank","noopener"),children:["Open"," ",s?N(s==null?void 0:s.entityType):""]}),K=n==="ANNOTATIONS"&&o,$=e.jsx(A,{variant:"contained",onClick:()=>{r.current.formElement.current.requestSubmit()},children:"Save Annotations"}),F=n==="ANNOTATIONS"&&o,P=e.jsx(A,{variant:"outlined",onClick:()=>{u(()=>()=>c(!1)),m(!0)},children:"Cancel"}),G=B&&n==="ANNOTATIONS"&&!o,v=S&&!q,U=e.jsx(ye,{title:v?"Annotations can only be edited on the latest version":void 0,children:e.jsx("span",{children:e.jsx(A,{variant:"contained",disabled:v,onClick:()=>{c(!0)},children:"Edit"})})}),W=e.jsxs(e.Fragment,{children:[f&&!o?e.jsx("div",{className:"Tabs",children:fe.map(x=>e.jsx("div",{className:"Tab",role:"tab",onClick:Z=>{Z.stopPropagation(),p(x)},"aria-selected":x===n,children:x},x))}):null,e.jsx("div",{style:n==="ANNOTATIONS"?{}:{display:"none"},children:o?e.jsx(ee,{children:e.jsx(oe,{entityId:i,formRef:r,hideActions:!0,onSuccess:()=>{ie("Annotations successfully updated.","success"),c(!1)},onCancel:()=>c(!1)})}):e.jsx(M,{entityId:i,versionNumber:t})}),e.jsx("div",{style:n==="METADATA"?{}:{display:"none"},children:e.jsx(R,{entityId:i,versionNumber:t})})]}),H=e.jsx(ae,{open:h,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{m(!1)},onConfirm:()=>{m(!1),T()}}),J=_.useMemo(()=>{if(s!=null&&s.entity.name){if(n==="ANNOTATIONS")return`${o?"Edit ":""}Annotations for ${s.entity.name}`}else return e.jsx(pe,{width:"40%"});return s.entity.name},[n,s==null?void 0:s.entity.name,o]);return e.jsx(te,{className:"EntityMetadata",open:b,onCancel:()=>{o?(m(!0),u(()=>()=>{c(!1),l()})):l()},maxWidth:o?"md":"sm",title:J,content:W,actions:e.jsxs(e.Fragment,{children:[H,F&&P,K&&$,G&&U,L&&k]})})}try{V.displayName="EntityModal",V.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"((isInEditMode: boolean) => void)"}}}}}catch{}export{V as E,g};
