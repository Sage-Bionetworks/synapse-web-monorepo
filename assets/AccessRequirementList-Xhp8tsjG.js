import{j as e}from"./jsx-runtime-TM5gBVMz.js";import{l as H,S as Z}from"./useFiles-Dx4nqkrZ.js";import{R as q}from"./VerificationSubmission-CMrrYimb.js";import{A as J}from"./ACTAccessRequirement-WDpE4gfi.js";import{M as C,S as w}from"./SelfSignAccessRequirement-C_01XAIc.js";import{T as ee}from"./StringUtils-Bdqa-HwM.js";import"./OrientationBanner-BxanlOCo.js";import{r as f}from"./index-DcrLmmvh.js";import{h as Ae,g as ge,t as he,r as Te,j as je,o as Ie,v as be,w as xe}from"./useAccessRequirements-BIncSXCS.js";import{u as te,n as G}from"./useQuery-DWcuFtFn.js";import{g as Se}from"./groupBy-CNnYUCAU.js";import{S as Ce}from"./StandaloneLoginForm-7AUKyr5B.js";import{a as K}from"./DialogBase-CbHfarLX.js";import{E as _e}from"./EntityLink-VFrbcbcN.js";import{I as Y}from"./IconSvg-BQu9rZPV.js";import{U as Ee}from"./UserOrTeamBadge-Bz92qcZT.js";import{U as ve}from"./UnmanagedACTAccessRequirementItem-BBPKkHbY.js";import{u as we}from"./utils-BSLg82VF.js";import{c as ke}from"./chunk-DrfxUea4.js";import{M as Fe}from"./MarkdownSynapse-DR3WtFnH.js";import{M as De}from"./ManagedACTAccessRequirementItemView-CrSFzUZB.js";import{A as se}from"./Alert-CBYuJjUz.js";import{S as Ne}from"./SelfSignAccessRequirementItem-DOhtPw4I.js";import{D as ne}from"./DialogTitle-BYSzGrpO.js";import{S as re}from"./Stack-Y-KdTpE4.js";import{B as W}from"./Box-CMo5M51H.js";import{I as ae}from"./IconButton-BEEZ6tpT.js";import{D as k,a as Q}from"./DialogContent-B78HwALb.js";import{T as F}from"./Typography-CgSuXiyf.js";import{B as _}from"./Button-CeywVuQa.js";import{D as Pe}from"./DataAccessRequestAccessorsFilesForm-BMiYVpVf.js";import{R as Ve}from"./ResearchProjectForm-D1JrfKYX.js";import{A as Me}from"./AuthenticatedRequirement-Dmbz5xIA.js";import{C as Le}from"./CertificationRequirement-BIDB2rlD.js";import{T as Oe}from"./TwoFactorAuthEnabledRequirement-CmSm60fs.js";import{V as Ue}from"./ValidationRequirement-lL2dtcS8.js";import{s as Be}from"./DefaultPropsProvider-BNasm-Ou.js";import{D as He}from"./Dialog-DYsxJ3aP.js";const Ye=50;function We(t,s){const{accessToken:r,keyFactory:a}=H();return te({...s,queryKey:a.getRestrictionInformationQueryKey(t),queryFn:()=>Z.getRestrictionInformation(t,r)})}function Qe(t){return t.reduce((s,r)=>({restrictionInformation:s.restrictionInformation.concat(r.restrictionInformation)}),{restrictionInformation:[]})}function Dt(t,s){const{accessToken:r,keyFactory:a}=H(),u=we(),l=async()=>{const y=ke(t.objectIds,Ye).map(i=>{const o={...t,objectIds:i};return Z.getRestrictionInformationBatch(o,r)}),m=await Promise.all(y),d=Qe(m);return d.restrictionInformation.forEach(i=>{u.setQueryData(a.getRestrictionInformationQueryKey({objectId:String(i.objectId),restrictableObjectType:t.restrictableObjectType}),i)}),d};return te({...s,queryKey:a.getRestrictionInformationBatchQueryKey(t),queryFn:l})}function L(t){const{accessRequirement:s,subjectId:r,subjectType:a,onRejectTerms:u,onRequestAccess:l}=t,{data:p,isLoading:y,error:m}=Ae(s.id.toString()),{data:d,isLoading:i,error:o}=ge(String(s.id)),{data:g,isLoading:D,error:h}=We({objectId:r,restrictableObjectType:a},{enabled:!!r&&!!a}),{mutate:T,error:j,isPending:I}=he(),N=f.useCallback(()=>{d&&T({submissionId:d.currentSubmissionStatus.submissionId,accessRequirementId:String(s.id)})},[s.id,d,T]),P=y||i||D;let E=null;return(m||o||h||j)&&(E=e.jsxs(se,{className:"access-requirement-list-alert",severity:"error",children:[m&&m.reason,o&&o.reason,h&&h.reason,j&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error canceling your data access request:"}),e.jsx("br",{}),j.reason]})]})),e.jsx(De,{isLoading:P,accessRequirement:s,accessRequirementStatus:d,restrictionInformation:g,wikiPage:p&&e.jsx(Fe,{wikiId:p.wikiPageId,ownerId:p.ownerObjectId,objectType:p.ownerObjectType}),error:E,onCancelDataAccessRequest:N,onRejectTerms:u,onRequestAccess:l,cancelRequestIsPending:I})}try{L.displayName="ManagedACTAccessRequirementItem",L.__docgenInfo={description:`Renders a {@link RequirementItem} for a ManagedACTAccessRequirement, which allows a user to see if they have met the
requirement, and if not, complete a data access request to apply for access.`,displayName:"ManagedACTAccessRequirementItem",props:{accessRequirement:{defaultValue:null,description:"The ManagedACTAccessRequirement to be displayed.",name:"accessRequirement",required:!0,type:{name:"ManagedACTAccessRequirement"}},subjectId:{defaultValue:null,description:"If available, the ID of the object that this access requirement is being displayed for.",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"If available, the type of the object that this access requirement is being displayed for.",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}},onRejectTerms:{defaultValue:null,description:'Invoked when the user clicks the "I do not accept" button.',name:"onRejectTerms",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:'Invoked when the user clicks the "Request access" button.',name:"onRequestAccess",required:!0,type:{name:"() => void"}}}}}catch{}function O(t){const{accessRequirement:s,subjectId:r,subjectType:a,onHide:u,onRequestAccess:l}=t;switch(s.concreteType){case w:case ee:return e.jsx(Ne,{accessRequirement:s,onHide:u});case J:return e.jsx(ve,{accessRequirement:s,onHide:u,subjectId:r,subjectType:a});case C:return e.jsx(L,{accessRequirement:s,subjectId:r,subjectType:a,onRejectTerms:u,onRequestAccess:()=>{l(s)}});default:return console.warn("Unsupported access requirement type:",s.concreteType),e.jsx(e.Fragment,{})}}try{O.displayName="AccessRequirementListItem",O.__docgenInfo={description:"Renders an individual AR item for the AccessRequirementList",displayName:"AccessRequirementListItem",props:{accessRequirement:{defaultValue:null,description:"",name:"accessRequirement",required:!0,type:{name:"AccessRequirement"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:"",name:"onRequestAccess",required:!0,type:{name:"(accessRequirement: ManagedACTAccessRequirement) => void"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}function U(t){const{modifiedDataAccessRequest:s,onHide:r}=t,[a,u]=f.useState(),[l,p]=f.useState(!1),{mutate:y}=Te({onSuccess:()=>{r()},onError:d=>{u({key:"error",message:`Sorry, there is an error in submitting your request. ${d.reason?d.reason+".":" "}Please close this dialog and try again later.`}),p(!0)}});function m(){s&&y(s)}return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(re,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Save Changes",e.jsx(W,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:r,children:e.jsx(Y,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsxs(k,{children:[e.jsx(F,{variant:"body1",children:"Would you like to save your recent changes?"}),a&&e.jsx(se,{severity:a.key,children:a.message})]}),e.jsxs(Q,{children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outlined",onClick:r,children:"Cancel"}),e.jsx(_,{variant:"contained",onClick:()=>{m()},children:"Save changes"})]}),l&&e.jsx(_,{variant:"contained",onClick:r,children:"Close"})]})]})}try{U.displayName="CancelRequestDataAccess",U.__docgenInfo={description:"",displayName:"CancelRequestDataAccess",props:{modifiedDataAccessRequest:{defaultValue:null,description:"",name:"modifiedDataAccessRequest",required:!0,type:{name:"Request | Renewal"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function B(t){const{onHide:s}=t;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(re,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Your Data Access Request Has Been Submitted",e.jsx(W,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:s,children:e.jsx(Y,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsx(k,{children:e.jsx(F,{variant:"body1",children:"Your data access request been submitted and is currently being reviewed. Please allow for up to 2 weeks for your request to be reviewed and approved."})}),e.jsx(Q,{children:e.jsx(_,{variant:"contained",onClick:s,children:"Finish"})})]})}try{B.displayName="RequestDataAccessSuccess",B.__docgenInfo={description:"",displayName:"RequestDataAccessSuccess",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}const ie=[w,ee,C,J],Ge=new Set(ie),z=Be(F,{label:"DialogSubsectionHeader"})(({theme:t})=>({marginTop:t.spacing(4),marginBottom:t.spacing(2),paddingBottom:t.spacing(1),fontSize:"18px",fontWeight:"bold",borderBottom:"1px solid",borderColor:t.palette.grey[200]})),$=t=>t.some(Ke),Ke=t=>!Ge.has(t.concreteType);function X(t){const{onHide:s=G,renderAsModal:r=!1,numberOfFilesAffected:a,requestObjectName:u,customDialogActions:l,onSubmissionCreated:p=G}=t,y="entityId"in t,m="teamId"in t,d="accessRequirementFromProps"in t,i="subjectId"in t?t.subjectId:y?t.entityId:m?t.teamId:void 0,o="subjectType"in t?t.subjectType:y?q.ENTITY:m?q.TEAM:void 0;let{dialogTitle:g="Data Access Request"}=t;const{accessToken:D}=H(),h=!!D,[T,j]=f.useState(0),[I,N]=f.useState(),[P,E]=f.useState(""),[oe,ce]=f.useState(),ue=je(),{data:de}=Ie(i,{enabled:i!==void 0&&o===q.TEAM}),{data:le}=be(i,{enabled:i!==void 0&&o===q.ENTITY}),c=(d?t.accessRequirementFromProps:void 0)??le??de,{data:V}=xe((c??[]).map(n=>String(n.id)),{enabled:!!c,staleTime:1/0}),M=f.useMemo(()=>{if(c&&V){const n=Se(c,"concreteType");return ie.map(A=>{const S=n[A];return S?V.map(v=>S.find(qe=>v===String(qe.id))):[]}).flat().filter(A=>A!==void 0)}},[c,V]),b=n=>{const{managedACTAccessRequirement:x,step:A,researchProjectId:S,dataAccessRequest:v}=n;x&&N(x),S&&E(S),v&&ce(v),j(A)},me=c==null?void 0:c.some(n=>n.concreteType===C&&n.isTwoFaRequired),pe=c==null?void 0:c.some(n=>(n.concreteType===C||n.concreteType===w)&&n.isCertifiedUserRequired),fe=c==null?void 0:c.some(n=>(n.concreteType===C||n.concreteType===w)&&n.isValidatedProfileRequired),ye=f.useMemo(()=>u||(a?e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:"file",sx:{width:"30px"}})," ",a," ","File(s)"]}):i!==void 0&&o===q.ENTITY?e.jsx(_e,{entity:i}):o===q.TEAM?e.jsx(Ee,{principalId:i}):(console.warn(`Unhandled case for AccessRequirementList requestDetails: ${o}: ${i}`),e.jsx(e.Fragment,{}))),[a,u,i,o]),Re=[2,1].includes(T)&&ue?"xl":"md";let R=e.jsx(e.Fragment,{});switch(T){case 1:R=e.jsx(Ve,{managedACTAccessRequirement:I,onSave:n=>{b({managedACTAccessRequirement:I,step:2,researchProjectId:n.id})},onHide:s});break;case 2:R=e.jsx(Pe,{researchProjectId:P,managedACTAccessRequirement:I,subjectId:i??"",subjectType:o??q.ENTITY,onHide:s,onCancel:n=>{b({step:3,dataAccessRequest:n})},onSubmissionCreated:n=>{b({step:5}),p(n)},onBackClicked:()=>{b({step:1})}});break;case 3:R=e.jsx(U,{modifiedDataAccessRequest:oe,onHide:s});break;case 4:g="Please Log In",R=e.jsxs(e.Fragment,{children:[e.jsx(K,{title:g,onCancel:s}),e.jsx(k,{className:"AccessRequirementList login-modal ",children:e.jsx(Ce,{sessionCallback:()=>{window.location.reload()}})})]});break;case 5:R=e.jsx(B,{onHide:s});break;case 0:default:R=e.jsxs(e.Fragment,{children:[e.jsx(K,{title:g,onCancel:s}),e.jsxs(k,{children:[e.jsx(z,{variant:"h4",sx:{mt:0},children:"What is this request for?"}),e.jsx(F,{variant:"body1",component:"span",children:ye}),e.jsx(z,{variant:"h4",children:"What do I need to do?"}),e.jsx(Me,{}),pe&&e.jsx(Le,{}),fe&&e.jsx(Ue,{}),me&&e.jsx(Oe,{}),M==null?void 0:M.map(n=>e.jsx(O,{accessRequirement:n,subjectId:i,subjectType:o,onHide:s,onRequestAccess:x=>{b({managedACTAccessRequirement:x,step:h?1:4})}},n.id))]}),e.jsx(Q,{children:l||e.jsx(_,{variant:"contained",onClick:s,children:"Close"})})]})}return r?e.jsx(He,{maxWidth:Re,fullWidth:!0,open:!0,onClose:s,children:R}):e.jsx(W,{children:R})}try{X.displayName="AccessRequirementList",X.__docgenInfo={description:`The AccessRequirementListV2 component renders a set of {@link AccessRequirement}s (either pre-defined, or those applied
to an entity, based on provided props).

The component shows the user the approval status of each AR and provides a workflow for accepting the terms of or
creating a submission for any of the Access Requirements.`,displayName:"AccessRequirementList",props:{numberOfFilesAffected:{defaultValue:null,description:"",name:"numberOfFilesAffected",required:!1,type:{name:"number"}},requestObjectName:{defaultValue:null,description:"",name:"requestObjectName",required:!1,type:{name:"string"}},renderAsModal:{defaultValue:null,description:"",name:"renderAsModal",required:!1,type:{name:"boolean"}},dialogTitle:{defaultValue:null,description:"",name:"dialogTitle",required:!1,type:{name:"string"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},accessRequirementFromProps:{defaultValue:null,description:"",name:"accessRequirementFromProps",required:!1,type:{name:"AccessRequirement[]"}},customDialogActions:{defaultValue:null,description:"",name:"customDialogActions",required:!1,type:{name:"ReactNode"}},onSubmissionCreated:{defaultValue:null,description:"",name:"onSubmissionCreated",required:!1,type:{name:"(submissionId: string) => void"}},entityId:{defaultValue:null,description:"Fetches the access requirements associated with an entity\n@deprecated Please use `subjectId` and `subjectType`",name:"entityId",required:!0,type:{name:"string"}},teamId:{defaultValue:null,description:"Fetches the access requirements associated with a team\n@deprecated Please use `subjectId` and `subjectType`",name:"teamId",required:!0,type:{name:"string"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}try{$.displayName="checkHasUnsupportedRequirement",$.__docgenInfo={description:"",displayName:"checkHasUnsupportedRequirement",props:{}}}catch{}export{X as A,Dt as a,$ as c,We as u};
