import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{R as l,d as L,M as V,b as Y}from"./index-Jpdv6DNM.js";import{p as J}from"./pluralize-CVwSCrA2.js";import{R as Q,r as i}from"./index-Dl6G-zuu.js";import"./SynapseClient-CnzPBfaf.js";import"./OrientationBanner-BBh8JRgP.js";import"./getEndpoint-CjoHA800.js";import{b as W,c as z,d as X}from"./useAccessRequirements-BIWfGEAB.js";import{E as K}from"./EntitySubjectsSelector-DU3ErayH.js";import{T as Z}from"./TeamSubjectsSelector-K6JXDpMN.js";import{R as ee}from"./RadioGroup-AMpK4AOs.js";import{C as te}from"./Checkbox-DXnzVU0D.js";import{S as E}from"./Skeleton-DgVklRTa.js";import{T as x}from"./TextField-x8Micm4J.js";import{A as b}from"./Alert-C43IQeyU.js";import{T as _}from"./Typography-CxCAiHvb.js";import{S as se}from"./Stack-CqpovyXN.js";import{T as re}from"./Tooltip-Drs5efNb.js";import{H as ne}from"./IconSvg-BPgDKXL0.js";const oe="Please select at least one resource for this Access Requirement to be associated with.",g=c=>{const S=c===l.ENTITY?"Synapse":"Team",T=c[0].toUpperCase()+c.slice(1).toLowerCase();return`${S} IDs were specified but not added to the subjects list. Please either clear out the Add ${S} IDs textbox or click the Add ${J(T)} button.`},ae="Enter access requirement name. This will also be used when sending notifications for expiring or revoked approval. For example, 'The approval for the name access requirement was revoked...'",y={variant:"body1",fontWeight:700};function ie(c){switch(c){case l.ENTITY:return Y.DOWNLOAD;case l.TEAM:return Y.PARTICIPATE;default:throw new Error(`RestrictableObjectType ${c} does not have an access type specified.`)}}const k=Q.forwardRef(function(S,T){const{subject:n,accessRequirementId:C,onSave:B,onError:h}=S,d=!n,[u,j]=i.useState(n?[n]:[]),[A,G]=i.useState(!1),[I,m]=i.useState(null),[f,N]=i.useState(""),[o,q]=i.useState(!1),[R,w]=i.useState((n==null?void 0:n.type)===l.TEAM?L:V),[v,U]=i.useState(null),M=t=>{U(null),B(t.id.toString(),t.concreteType)},D=t=>{U(t.reason),h()},{mutate:F}=W({onSuccess:t=>M(t),onError:t=>D(t)}),{mutate:O}=z({onSuccess:t=>M(t),onError:t=>D(t)}),{data:s,isLoading:H,error:P}=X(C,{enabled:!!C});i.useEffect(()=>{s&&(w(s.concreteType),N(s.name),j(s.subjectIds),q(s.subjectsDefinedByAnnotations))},[s]);const a=i.useMemo(()=>{if(n)return n.type;if(s){const t=s.subjectIds;if(t.length>0)return t[0].type}return o?l.ENTITY:null},[n,s,o]),$=i.useMemo(()=>{if(!a)return e.jsx(e.Fragment,{});function t(r){m(null),j(r)}function p(r){m(null),G(r.trim()!=="")}if(o)return e.jsx(e.Fragment,{});switch(a){case l.TEAM:return e.jsx(Z,{subjects:u,onUpdate:r=>t(r),onUpdateTeamIDsTextbox:r=>p(r)});case l.ENTITY:return e.jsx(K,{subjects:u,onUpdate:r=>t(r),onUpdateEntityIDsTextbox:r=>p(r)});default:return console.error(`RestrictableObjectType ${a} does not have a selector implemented.`),e.jsx(e.Fragment,{})}},[a,u,o]);return i.useImperativeHandle(T,()=>({save(){const t=d&&!s||!a,p=!o&&(A||u.length===0);if(t||p){p&&!t&&(A?m(g(a)):u.length===0&&m(oe)),h();return}const r=ie(a);d||F({concreteType:R,subjectIds:u,name:f,accessType:r,subjectsDefinedByAnnotations:o}),d&&s&&O({...s,subjectIds:u,name:f,accessType:r,subjectsDefinedByAnnotations:o})}}),[A,a,u,f,R,s,d,h,F,O,o]),H||!a?e.jsxs(e.Fragment,{children:[e.jsx(E,{width:100,height:30}),e.jsx(E,{width:125,height:30}),e.jsx(E,{width:"100%",children:e.jsx(x,{})}),e.jsx(E,{width:100,height:30}),e.jsx(E,{width:"100%",children:e.jsx(x,{})})]}):P?e.jsx(b,{severity:"error",children:P.reason}):e.jsxs(e.Fragment,{children:[e.jsx(_,{...y,children:"Resources"}),a!==l.TEAM&&e.jsx(e.Fragment,{children:e.jsx(te,{label:"Associated entities should be defined by annotations (DUO)",checked:o,onChange:()=>{m(null);let t=[];o&&(s?t=s.subjectIds:n&&(t=[n])),j(t),q(!o)}})}),$,I&&e.jsx(b,{severity:"error",children:I}),e.jsxs(se,{direction:"row",gap:1,alignItems:"center",mb:1,mt:2,children:[e.jsx(_,{component:"label",htmlFor:"arName",...y,children:"Name"}),e.jsx(re,{title:ae,placement:"right",children:e.jsx(ne,{sx:{color:"grey.600"}})})]}),e.jsx(x,{id:"arName",name:"arName",value:f,placeholder:"Access requirement name",fullWidth:!0,onChange:t=>N(t.target.value)}),!d&&a!==l.TEAM&&e.jsxs(e.Fragment,{children:[e.jsx(_,{...y,mt:2,children:"Access requirement type"}),e.jsx(ee,{value:R,options:[{label:"Controlled - requests are in Synapse",value:V},{label:"Click wrap",value:L}],onChange:t=>w(t)})]}),v&&e.jsx(b,{severity:"error",sx:{marginTop:2},children:v})]})});try{g.displayName="UNSAVED_SUBJECTS_ERROR_MESSAGE",g.__docgenInfo={description:"",displayName:"UNSAVED_SUBJECTS_ERROR_MESSAGE",props:{}}}catch{}try{k.displayName="SetAccessRequirementCommonFields",k.__docgenInfo={description:"",displayName:"SetAccessRequirementCommonFields",props:{subject:{defaultValue:null,description:"",name:"subject",required:!1,type:{name:"RestrictableObjectDescriptor"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(accessRequirementId: string, accessRequirementConreteType: ACCESS_REQUIREMENT_CONCRETE_TYPE) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{k as S};
