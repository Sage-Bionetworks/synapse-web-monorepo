import{ao as B,an as z,aI as he,ab as X,r as p,j as e,c5 as Z,Y as q,cW as J,cX as E,cY as ee,cZ as te,c_ as w,br as se,ah as ne,W as re,bs as ae,am as H,bp as Y,bq as W,B as C,ca as Q,R as A,c$ as ge,b1 as Te,d0 as je,bo as Ie}from"./iframe-Es1qDbGP.js";import{e as be,f as _e,g as xe,h as Ee,i as Ce,j as Se,k as ve,l as ke}from"./useAccessRequirements-DYTw_Pge.js";import{g as we}from"./groupBy-DqdcHCdf.js";import{a as Fe}from"./DialogBase-CnbWvOma.js";import{E as Ne}from"./EntityLink-BaStRQpA.js";import{U as De}from"./UserOrTeamBadge-CCprrEwc.js";import{U as Le}from"./UnmanagedACTAccessRequirementItem-teFzzZvU.js";import{c as Pe}from"./UserSearchBoxV2-B1Ry4DpT.js";import{M as Ve}from"./MarkdownSynapse-Bc_1YooS.js";import{M as Me}from"./ManagedACTAccessRequirementItemView-qjVPwzbo.js";import{S as Ue}from"./SelfSignAccessRequirementItem-OYlnVwYc.js";import{R as Oe,a as Be}from"./RequirementItem-e_c4kNOz.js";import{D as He}from"./DataAccessRequestAccessorsFilesForm-Brueglnq.js";import{R as Ye}from"./ResearchProjectForm-DilQE0H6.js";import{A as We}from"./AuthenticatedRequirement-DOshzogT.js";import{C as Qe}from"./CertificationRequirement-8Vr56DBJ.js";import{T as Ge}from"./TwoFactorAuthEnabledRequirement-Csiryb86.js";import{V as Ke}from"./ValidationRequirement-9VM_oUNr.js";const $e=50;function ze(t,s){const{accessToken:r,keyFactory:a}=B();return z({...s,queryKey:a.getRestrictionInformationQueryKey(t),queryFn:()=>X.getRestrictionInformation(t,r)})}function Xe(t){return t.reduce((s,r)=>({restrictionInformation:s.restrictionInformation.concat(r.restrictionInformation)}),{restrictionInformation:[]})}function ht(t,s){const{accessToken:r,keyFactory:a}=B(),o=he(),d=async()=>{const R=Pe(t.objectIds,$e).map(i=>{const c={...t,objectIds:i};return X.getRestrictionInformationBatch(c,r)}),l=await Promise.all(R),u=Xe(l);return u.restrictionInformation.forEach(i=>{o.setQueryData(a.getRestrictionInformationQueryKey({objectId:String(i.objectId),restrictableObjectType:t.restrictableObjectType}),i)}),u};return z({...s,queryKey:a.getRestrictionInformationBatchQueryKey(t),queryFn:d})}function P(t){const{accessRequirement:s,subjectId:r,subjectType:a,onRejectTerms:o,onRequestAccess:d}=t,{data:m,isLoading:R,error:l}=be(s.id.toString()),{data:u,isLoading:i,error:c}=_e(String(s.id)),{data:T,isLoading:F,error:h}=ze({objectId:r,restrictableObjectType:a},{enabled:!!r&&!!a}),{mutate:S,error:j,isPending:I}=xe(),N=p.useCallback(()=>{u&&S({submissionId:u.currentSubmissionStatus.submissionId,accessRequirementId:String(s.id)})},[s.id,u,S]),D=R||i||F;let v=null;return(l||c||h||j)&&(v=e.jsxs(Z,{className:"access-requirement-list-alert",severity:"error",children:[l&&l.reason,c&&c.reason,h&&h.reason,j&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error canceling your data access request:"}),e.jsx("br",{}),j.reason]})]})),e.jsx(Me,{isLoading:D,accessRequirement:s,accessRequirementStatus:u,restrictionInformation:T,wikiPage:m&&e.jsx(Ve,{wikiId:m.wikiPageId,ownerId:m.ownerObjectId,objectType:m.ownerObjectType}),error:v,onCancelDataAccessRequest:N,onRejectTerms:o,onRequestAccess:d,cancelRequestIsPending:I})}try{P.displayName="ManagedACTAccessRequirementItem",P.__docgenInfo={description:`Renders a {@link RequirementItem} for a ManagedACTAccessRequirement, which allows a user to see if they have met the
requirement, and if not, complete a data access request to apply for access.`,displayName:"ManagedACTAccessRequirementItem",props:{accessRequirement:{defaultValue:null,description:"The ManagedACTAccessRequirement to be displayed.",name:"accessRequirement",required:!0,type:{name:"ManagedACTAccessRequirement"}},subjectId:{defaultValue:null,description:"If available, the ID of the object that this access requirement is being displayed for.",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"If available, the type of the object that this access requirement is being displayed for.",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}},onRejectTerms:{defaultValue:null,description:'Invoked when the user clicks the "I do not accept" button.',name:"onRejectTerms",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:'Invoked when the user clicks the "Request access" button.',name:"onRequestAccess",required:!0,type:{name:"() => void"}}}}}catch{}function V(){return e.jsxs(Oe,{"data-testid":"LockAccessRequirementItem",status:Be.LOCKED,children:[e.jsx(q,{variant:"body1",sx:{fontWeight:"bold"},children:"This asset is not accessible to the public."}),e.jsx(q,{variant:"body1",children:"Contributor has not completed access conditions for this asset."}),e.jsx(q,{variant:"body1",children:"Sage Bionetworks cannot grant access without contributor approval."})]})}try{V.displayName="LockAccessRequirementItem",V.__docgenInfo={description:`Renders a {@link RequirementItem} for a {@link LockAccessRequirement }.
Lock Access Requirements are used to lock down an entity while waiting for ACT to review.
These requirements cannot be fulfilled by the user.`,displayName:"LockAccessRequirementItem",props:{}}}catch{}function M(t){const{accessRequirement:s,subjectId:r,subjectType:a,onHide:o,onRequestAccess:d}=t;switch(s.concreteType){case w:case te:return e.jsx(Ue,{accessRequirement:s,onHide:o});case ee:return e.jsx(Le,{accessRequirement:s,onHide:o,subjectId:r,subjectType:a});case E:return e.jsx(P,{accessRequirement:s,subjectId:r,subjectType:a,onRejectTerms:o,onRequestAccess:()=>{d(s)}});case J:return e.jsx(V,{});default:return console.warn("Unsupported access requirement type:",s.concreteType),e.jsx(e.Fragment,{})}}try{M.displayName="AccessRequirementListItem",M.__docgenInfo={description:"Renders an individual AR item for the AccessRequirementList",displayName:"AccessRequirementListItem",props:{accessRequirement:{defaultValue:null,description:"",name:"accessRequirement",required:!0,type:{name:"AccessRequirement"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:"",name:"onRequestAccess",required:!0,type:{name:"(accessRequirement: ManagedACTAccessRequirement) => void"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}function U(t){const{modifiedDataAccessRequest:s,onHide:r}=t,[a,o]=p.useState(),[d,m]=p.useState(!1),{mutate:R}=Ee({onSuccess:()=>{r()},onError:u=>{o({key:"error",message:`Sorry, there is an error in submitting your request. ${u.reason?u.reason+".":" "}Please close this dialog and try again later.`}),m(!0)}});function l(){s&&R(s)}return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs(ne,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Save Changes",e.jsx(re,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:r,children:e.jsx(H,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsxs(Y,{children:[e.jsx(q,{variant:"body1",children:"Would you like to save your recent changes?"}),a&&e.jsx(Z,{severity:a.key,children:a.message})]}),e.jsxs(W,{children:[!d&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outlined",onClick:r,children:"Cancel"}),e.jsx(C,{variant:"contained",onClick:()=>{l()},children:"Save changes"})]}),d&&e.jsx(C,{variant:"contained",onClick:r,children:"Close"})]})]})}try{U.displayName="CancelRequestDataAccess",U.__docgenInfo={description:"",displayName:"CancelRequestDataAccess",props:{modifiedDataAccessRequest:{defaultValue:null,description:"",name:"modifiedDataAccessRequest",required:!0,type:{name:"Request | Renewal"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function O(t){const{onHide:s}=t;return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs(ne,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Your Data Access Request Has Been Submitted",e.jsx(re,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:s,children:e.jsx(H,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsx(Y,{children:e.jsx(q,{variant:"body1",children:"Your data access request been submitted and is currently being reviewed. Please allow for up to 2 weeks for your request to be reviewed and approved."})}),e.jsx(W,{children:e.jsx(C,{variant:"contained",onClick:s,children:"Finish"})})]})}try{O.displayName="RequestDataAccessSuccess",O.__docgenInfo={description:"",displayName:"RequestDataAccessSuccess",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}const ie=[w,te,E,ee,J],Ze=new Set(ie),G=Te(q,{label:"DialogSubsectionHeader"})(({theme:t})=>({marginTop:t.spacing(4),marginBottom:t.spacing(2),paddingBottom:t.spacing(1),fontSize:"18px",fontWeight:"bold",borderBottom:"1px solid",borderColor:t.palette.grey[200]})),K=t=>t.some(Je),Je=t=>!Ze.has(t.concreteType);function $(t){const{onHide:s=Q,renderAsModal:r=!1,numberOfFilesAffected:a,requestObjectName:o,customDialogActions:d,onSubmissionCreated:m=Q}=t,R="entityId"in t,l="teamId"in t,u="accessRequirementFromProps"in t,i="subjectId"in t?t.subjectId:R?t.entityId:l?t.teamId:void 0,c="subjectType"in t?t.subjectType:R?A.ENTITY:l?A.TEAM:void 0;let{dialogTitle:T="Data Access Request"}=t;const{isAuthenticated:F}=B(),[h,S]=p.useState(0),j=ge(),[I,N]=p.useState(),[D,v]=p.useState(""),[ce,oe]=p.useState(),ue=Ce(),{data:de}=Se(i,{enabled:i!==void 0&&c===A.TEAM}),{data:le}=ve(i,{enabled:i!==void 0&&c===A.ENTITY}),f=(u?t.accessRequirementFromProps:void 0)??le??de,{data:L}=ke((f??[]).map(n=>String(n.id)),{enabled:!!f,staleTime:1/0}),me=p.useMemo(()=>{if(f&&L){const n=we(f,"concreteType");return ie.map(g=>{const x=n[g];return x?L.map(k=>x.find(Ae=>k===String(Ae.id))):[]}).flat().filter(g=>g!==void 0)}},[f,L]),b=n=>{const{managedACTAccessRequirement:_,step:g,researchProjectId:x,dataAccessRequest:k}=n;_&&N(_),x&&v(x),k&&oe(k),S(g)},pe=f?.some(n=>n.concreteType===E&&n.isTwoFaRequired),Re=f?.some(n=>(n.concreteType===E||n.concreteType===w)&&n.isCertifiedUserRequired),fe=f?.some(n=>(n.concreteType===E||n.concreteType===w)&&n.isValidatedProfileRequired),ye=p.useMemo(()=>o||(a?e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:"file",sx:{width:"30px"}})," ",a," ","File(s)"]}):i!==void 0&&c===A.ENTITY?e.jsx(Ne,{entity:i}):c===A.TEAM?e.jsx(De,{principalId:i}):(console.warn(`Unhandled case for AccessRequirementList requestDetails: ${c}: ${i}`),e.jsx(e.Fragment,{}))),[a,o,i,c]),qe=[2,1].includes(h)&&ue?"xl":"md";let y=e.jsx(e.Fragment,{});switch(h){case 1:y=e.jsx(Ye,{managedACTAccessRequirement:I,onSave:n=>{b({managedACTAccessRequirement:I,step:2,researchProjectId:n.id})},onHide:s});break;case 2:y=e.jsx(He,{researchProjectId:D,managedACTAccessRequirement:I,subjectId:i??"",subjectType:c??A.ENTITY,onHide:s,onCancel:n=>{b({step:3,dataAccessRequest:n})},onSubmissionCreated:n=>{b({step:5}),m(n)},onBackClicked:()=>{b({step:1})}});break;case 3:y=e.jsx(U,{modifiedDataAccessRequest:ce,onHide:s});break;case 4:je(j.toString()),T="Please Log In",y=e.jsx(e.Fragment,{});break;case 5:y=e.jsx(O,{onHide:s});break;default:y=e.jsxs(e.Fragment,{children:[r?e.jsx(Fe,{title:T,onCancel:s}):e.jsx(q,{variant:"h5",sx:{mb:2},children:T}),e.jsxs(Y,{children:[e.jsx(G,{variant:"h4",sx:{mt:0},children:"What is this request for?"}),e.jsx(q,{variant:"body1",component:"span",children:ye}),e.jsx(G,{variant:"h4",children:"What do I need to do?"}),e.jsx(We,{}),Re&&e.jsx(Qe,{}),fe&&e.jsx(Ke,{}),pe&&e.jsx(Ge,{}),me?.map(n=>e.jsx(M,{accessRequirement:n,subjectId:i,subjectType:c,onHide:s,onRequestAccess:_=>{b({managedACTAccessRequirement:_,step:F?1:4})}},n.id))]}),e.jsx(W,{children:d||e.jsx(e.Fragment,{children:r&&e.jsx(C,{variant:"contained",onClick:s,children:"Close"})})})]})}return r?e.jsx(Ie,{maxWidth:qe,fullWidth:!0,open:!0,onClose:s,children:y}):e.jsx(e.Fragment,{children:y})}try{$.displayName="AccessRequirementList",$.__docgenInfo={description:`The AccessRequirementListV2 component renders a set of {@link AccessRequirement}s (either pre-defined, or those applied
to an entity, based on provided props).

The component shows the user the approval status of each AR and provides a workflow for accepting the terms of or
creating a submission for any of the Access Requirements.`,displayName:"AccessRequirementList",props:{numberOfFilesAffected:{defaultValue:null,description:"",name:"numberOfFilesAffected",required:!1,type:{name:"number"}},requestObjectName:{defaultValue:null,description:"",name:"requestObjectName",required:!1,type:{name:"string"}},renderAsModal:{defaultValue:null,description:"",name:"renderAsModal",required:!1,type:{name:"boolean"}},dialogTitle:{defaultValue:null,description:"",name:"dialogTitle",required:!1,type:{name:"string"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},accessRequirementFromProps:{defaultValue:null,description:"",name:"accessRequirementFromProps",required:!1,type:{name:"AccessRequirement[]"}},customDialogActions:{defaultValue:null,description:"",name:"customDialogActions",required:!1,type:{name:"ReactNode"}},onSubmissionCreated:{defaultValue:null,description:"",name:"onSubmissionCreated",required:!1,type:{name:"(submissionId: string) => void"}},entityId:{defaultValue:null,description:"Fetches the access requirements associated with an entity\n@deprecated Please use `subjectId` and `subjectType`",name:"entityId",required:!0,type:{name:"string"}},teamId:{defaultValue:null,description:"Fetches the access requirements associated with a team\n@deprecated Please use `subjectId` and `subjectType`",name:"teamId",required:!0,type:{name:"string"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}try{K.displayName="checkHasUnsupportedRequirement",K.__docgenInfo={description:"",displayName:"checkHasUnsupportedRequirement",props:{}}}catch{}export{$ as A,ze as a,K as c,ht as u};
