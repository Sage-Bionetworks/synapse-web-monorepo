import{j as e}from"./jsx-runtime-CUNTCE37.js";import{m as O}from"./useFiles-CXziUBBk.js";import{O as Y,q as A}from"./VerificationSubmission-dxY1kvC5.js";import{u as G,A as ie}from"./useEntityBundle-s0x57E4V.js";import"./StringUtils-Df7AZImX.js";import{S as ae}from"./SynapseConstants-Cjwg7_uO.js";import{r}from"./index-iwduSq60.js";import"./OrientationBanner-DVC-9Eoc.js";import{u as le,a as de,F as b,b as ce}from"./ForumThreadEditor-DBNBiGBn.js";import{u as ue,a as me,b as pe}from"./useThread-CLDZKUmf.js";import{a as he}from"./useSubscription-DnGe8gHd.js";import{f as q}from"./DateFormatter-DjzBsdK9.js";import{d as W}from"./dayjs.min-C4wwLUbt.js";import{C as fe}from"./ConfirmationDialog-BB5lIy4g.js";import{I as i}from"./IconSvg-BEEWk700.js";import{M as H}from"./MarkdownSynapse-Bf3Hfj-d.js";import{W as _}from"./WarningDialog-D8C7O3N_.js";import{d as C}from"./ToastMessage-8KUS1XiG.js";import{U as P}from"./UserBadge-BFB9ryHJ.js";import{S as xe}from"./SkeletonTable-XVwOdhwB.js";import{B as u}from"./Box-iBYOIJJh.js";import{S as ye}from"./SubscribersModal-ux7BHdli.js";import{u as je}from"./useForum-CIK2Pj7K.js";import{B as D}from"./Button-Cew0p3xf.js";import{T as ge}from"./Typography-iNw74tXo.js";import{T as v}from"./TextField-NLumrCBm.js";const be=()=>alert("This functionality has not been implemented yet");function B(m){const{reply:s,onClickLink:w=be,isReplyAuthorModerator:a=!1}=m,[p,h]=r.useState(!1),[S,l]=r.useState(!1),{data:f}=O(),{data:d}=G(s.projectId),{data:x,isLoading:g}=le(s),{mutate:T}=de({onSuccess:()=>{l(!1),C("A reply has been deleted.","info")}}),y=s.createdBy==(f==null?void 0:f.ownerId);return e.jsx("div",{className:"reply-container",children:g?e.jsx(xe,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(P,{userId:s.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:a}),e.jsxs("div",{className:"message-body",children:[e.jsx(H,{markdown:x,objectType:Y.REPLY}),e.jsxs("span",{children:["posted ",q(W(s.createdOn),"M/D/YYYY")]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[e.jsx("button",{onClick:()=>w(),children:e.jsx(i,{icon:"link"})}),y&&e.jsx("button",{onClick:()=>h(!0),children:e.jsx(i,{icon:"edit"})}),(d==null?void 0:d.permissions.canModerate)&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(i,{icon:"delete"})})]})]})]}),e.jsx(b,{isReply:!0,initialText:x,onClose:()=>h(!1),id:s.id,isDialog:!0,openDialog:p}),e.jsx(_,{open:S,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{l(!1)},onConfirm:()=>T({forumId:s.forumId,threadId:s.threadId,replyId:s.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{B.displayName="DiscussionReply",B.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const Ce="You are following this topic. Click to stop following.",we="You are not following this topic. Click to follow.",Se="You will need to sign in for access to that resource",L="Write a reply...";function F(m){const{threadId:s,limit:w}=m,a="16px",[p,h]=r.useState(!0),[S,l]=r.useState(!1),[f,d]=r.useState(!1),[x,g]=r.useState(!1),[T,y]=r.useState(!1),[U,j]=r.useState(!1),[V,M]=r.useState(!1),[X,z]=r.useState(!1),{threadData:o,threadBody:R,togglePin:K}=ue(s),{data:n}=O(),{data:I}=G((o==null?void 0:o.projectId)??"",void 0,ie,{enabled:!!o}),{subscription:N,toggleSubscribed:J,isLoading:Q}=he(s,A.THREAD),{mutate:Z}=me({onSuccess:()=>{y(!1),C("A thread has been deleted.","info")}}),{mutate:$}=pe({onSuccess:()=>{M(!1),C("A thread has been restored.","info")}}),ee=(o==null?void 0:o.createdBy)==(n==null?void 0:n.ownerId);function oe(){if((n==null?void 0:n.userName)=="anonymous")j(!0);else try{J()}catch(t){C(t.reason,"danger")}}const{data:k,hasNextPage:se,fetchNextPage:te}=ce(s,p,w),E=(k==null?void 0:k.pages.flatMap(t=>t.results))??[],{data:c}=je((o==null?void 0:o.forumId)??""),ne=c==null?void 0:c.results.includes((o==null?void 0:o.createdBy)??"");return e.jsxs("div",{className:"DiscussionThread",children:[o&&R?e.jsxs(e.Fragment,{children:[e.jsxs(u,{sx:t=>({textAlign:"center",[t.breakpoints.down("sm")]:{display:"flex",marginBottom:a,button:{whiteSpace:"nowrap"}}}),children:[e.jsx(D,{variant:p?"contained":"outlined",onClick:()=>h(!0),children:"Date Posted"}),e.jsx(D,{variant:p?"outlined":"contained",onClick:()=>h(!1),children:"Most Recent"})]}),e.jsx(P,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:ne}),e.jsxs(u,{sx:t=>({[t.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:a,marginTop:a,".SubscribersModal":{justifyContent:"flex-start",marginBottom:a}}}),children:[e.jsx(ge,{sx:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(ye,{id:s,objectType:A.THREAD,showModal:X,handleModal:z})]}),e.jsx("div",{children:e.jsx(H,{markdown:R,objectType:Y.THREAD})}),e.jsxs("span",{children:["posted ",q(W(o.createdOn),"M/D/YYYY")]}),e.jsx(b,{isReply:!1,initialText:R,onClose:()=>l(!1),initialTitle:o==null?void 0:o.title,id:s,isDialog:!0,openDialog:S})]}):e.jsx(e.Fragment,{}),e.jsx(u,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>M(!0),children:e.jsx(i,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":N?"Unfollow thread":"Follow thread",disabled:Q,onClick:()=>oe(),children:N?e.jsx(i,{icon:"visibility",label:Ce}):e.jsx(i,{icon:"visibilityOff",label:we})})}),ee&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(i,{icon:"edit",label:"Edit thread"})}),I!=null&&I.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>y(!0),children:e.jsx(i,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>K(),children:o!=null&&o.isPinned?e.jsx(i,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(i,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(u,{sx:{mt:2,mb:3},children:f?e.jsx(b,{id:s,isReply:!0,onClose:()=>d(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(n==null?void 0:n.userName)=="anonymous"?j(!0):d(!0)}})}),e.jsx("div",{children:E.map(t=>{const re=c==null?void 0:c.results.includes(t.createdBy);return e.jsx(B,{reply:t,isReplyAuthorModerator:re},t.id)})}),E.length>0&&e.jsx(u,{sx:t=>({mt:2,mb:3,[t.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:x?e.jsx(b,{id:s,isReply:!0,onClose:()=>g(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(n==null?void 0:n.userName)=="anonymous"?j(!0):g(!0)}})}),se?e.jsx(D,{variant:"outlined",onClick:()=>{te()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(_,{open:T,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>y(!1),onConfirm:()=>o&&Z(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(_,{open:V,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>M(!1),onConfirm:()=>o&&$(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(fe,{open:U,title:"Sign In Required",content:Se,onCancel:()=>j(!1),hasCancelButton:!1,onConfirm:()=>j(!1),confirmButtonProps:{children:"Sign In",className:ae}})]})}try{F.displayName="DiscussionThread",F.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{F as D};
