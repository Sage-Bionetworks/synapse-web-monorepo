var Tc=Object.defineProperty;var Ic=(e,u,f)=>u in e?Tc(e,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):e[u]=f;var Z=(e,u,f)=>Ic(e,typeof u!="symbol"?u+"":u,f);import{j}from"./jsx-runtime-D_zvdyIk.js";import{r as $,b as fe}from"./index-D48SXRoA.js";import{l as st,bn as kc,co as jc,an as Vc,S as Ne,bb as Vs,aB as Ac,aq as Pc,as as Mc,s as ou,t as ct,cp as qc,cq as Dc}from"./useFiles-BRC0e057.js";import{w as os}from"./useDOI-8cRh2qBu.js";import{u as ft}from"./useMutation-B3cc0E9Q.js";import{t as Bc}from"./useEntity-Dq-DhnJR.js";import{F as au,C as As,z as Ps}from"./VerificationSubmission-BDh1zA9f.js";import{l as Lc,Y as Fc,S as Uc}from"./StringUtils-NPb0VexC.js";import{u as Br}from"./QueryClientProvider-B024YWxc.js";import{u as $c}from"./OrientationBanner-BWVrubWR.js";import"./ErrorPage-DdcL7EM3.js";import"./AccessTokenPage-FuVL9QeW.js";import"./AccountLevelBadges-CLxyBgFz.js";import"./LastLoginInfo-DIXEztAj.js";import"./StandaloneLoginForm-HdTuc2Q0.js";import"./TwoFactorAuthSettingsPanel-B9uteza3.js";import"./TwoFactorEnrollmentForm-KAzbdiOO.js";import"./TwoFactorBackupCodes-DtXv3Zli.js";import"./RowSetView-BI4qPmvK.js";import"./CardContainerLogic-D6j1glAE.js";import{C as Ms}from"./CardGridWithLinks-CIOl25h0.js";import"./RowDataTable-BsY4sq1p.js";import"./RowDataTableWithQuery-DtYXAyHb.js";import{f as zc}from"./DateFormatter-DX_ZIUQh.js";import{d as Gc}from"./dayjs.min-DhyUtXUb.js";import"./MarkdownPopover-weArzVo9.js";import"./SkeletonButton-CB9lIvZ0.js";import"./SkeletonInlineBlock-C46L86dm.js";import{S as Wc}from"./SkeletonTable-CPL8E6uA.js";import"./SkeletonParagraph-CMz_T7vJ.js";import{d as Et}from"./ToastMessage--TnH3sXY.js";import"./CertificationAnswer-ztA9dz_V.js";import"./ChallengeDetailPage-Bk7nLoTr.js";import"./index-CHau64dA.js";import"./AvailableEvaluationQueueList-BNn1vGGT.js";import"./ChallengeSubmission-CpJHzEa4.js";import"./ChangePassword-ItFSV7oy.js";import"./ChangePasswordWithToken-DYS1db2M.js";import{C as Hc}from"./ConfirmationDialog-BvEWL8Rf.js";import"./CookiesNotification-CLnfG1tp.js";import{C as qs}from"./CTASectionWrapper-BIUji8yc.js";import"./DownloadCartPage-DfCzKT6h.js";import"./ShowDownloadV2-BnO4iZU2.js";import{D as Jc}from"./DynamicForm-6LOFrZrW.js";import{W as Kc}from"./WideButton-BPYaLtqy.js";import{B as Ce}from"./Box-BPM5q58Y.js";import"./EntityBadgeIcons-S08Y7g__.js";import"./EntityFinder-DZammxvZ.js";import{F as Yc,v as Xc,r as lu}from"./index-DsVEUx3Q.js";import{B as Ds,P as Qc}from"./enums-D464nXUZ.js";import{d as Ee,a as uu}from"./iframe-CGMSSV3a.js";import"./EvaluationCard-CH1SXUtR.js";import"./EvaluationEditorPage-CHuKHdCy.js";import"./ExperimentalMode-iMfPpOov.js";import{O as Zc}from"./IconSvg-bzGw1rbR.js";import"./FileUpload-0J2r9XQD.js";import"./FeaturedDataTabs-IrpJv5Jr.js";import"./FeaturedToolsList-DDW_ZQ4K.js";import"./DiscussionThread-FGq7DPO4.js";import"./ForumPage-FZkavKsQ.js";import{F as ed}from"./FullWidthAlert-B5UKJIYG.js";import"./SynapseCardLabel-hVQJLn6a.js";import"./GenericCard-BnD2rhB9.js";import"./HeaderCardV2-C3I4Ztiv.js";import"./CardUtils-DWdx1Mbg.js";import"./Goals-CmNsWHfJ.js";import"./GoalsV2-D_lBpAgz.js";import{G as Bs}from"./GoalsV3-DBw5Nk00.js";import"./GoogleMap-CwvcwL6Z.js";import"./HasAccessV2-BiLJFTJb.js";import"./Icon-Xmb3LVs8.js";import"./MarkdownCollapse-CUFVG7iu.js";import"./MarkdownEditor-BnxSLZZy.js";import"./MarkdownGithub-DZs-sj-b.js";import"./ModalDownload-BHdz8Cw1.js";import"./CopyToClipboardInput-D9-2q2Tz.js";import"./DialogBase-C6k-RapE.js";import"./WarningDialog-CB-BILoA.js";import"./ColumnHeader-D-584oU9.js";import"./StyledTanStackTable-dA_150gv.js";import"./OAuthAclEditorModal-BI7hg5qB.js";import"./ThemesPlot-CQtZgorz.js";import"./UpsetPlot-97DWxIvX.js";import"./SynapsePlot-CS7POs6I.js";import"./Programs-DWCH_4Q_.js";import"./TopLevelControls-B186zkB4.js";import"./ProvenanceGraph-CTXhylRY.js";import"./ProjectDataAvailability-CeUaS7Py.js";import"./QueryContext-DPLDTa6J.js";import"./QueryCount-BSSTDNvS.js";import"./QueryWrapper-DA7m1qhf.js";import"./QueryWrapperPlotNav-DK6c_FFb.js";import"./RegisterPageLogoutPrompt-CzP_Dr-Q.js";import"./RenderIfInView-BwspEbPf.js";import"./Resources-CvB69BZk.js";import"./AccessRequirementAclEditor-DriEQvwm.js";import"./RssFeedCards-CKkyIIGh.js";import"./ShowMore-CAnRqEYl.js";import"./StandaloneQueryWrapper-BMcyPMug.js";import"./LeftRightPanel-Bi5YxEgH.js";import"./LightTooltip-CcxY2aI9.js";import"./StyledFormControl-Cy6xgJMA.js";import"./InputSizedButton-lrQw8DgR.js";import"./DropdownSelect-C7cdlbv7.js";import"./SubscriptionItem-CUmcfsO8.js";import"./SubsectionRowRenderer-BB5sA6LR.js";import"./SynapseFormWrapper-DoZ_BKLE.js";import"./SynapseFormSubmissionGrid-BvHxNjR8.js";import"./SynapseTable-CciqBR3K.js";import"./SynapseChat-DVHbeASE.js";import{T as Xe}from"./Typography-CWBVLAyW.js";import"./TableFeedCards-CbPO5IOW.js";import"./TermsAndConditions-CaZQe_qU.js";import"./TextField-DWVbIzaT.js";import"./TimelinePlot-B-dsYlbR.js";import"./UserBadge-BBWgO8bW.js";import"./UserCardList-CqjF-v2F.js";import"./UserCardListRotate-CGLrDpbe.js";import"./UserCardListGroups-gEnejWjh.js";import"./UserOrTeamBadge-Bdl8VfqQ.js";import"./UserProfileLinks-D2uVDt2m.js";import"./EntityHeaderTable-CjNcx_xf.js";import"./AccessRequirementRelatedProjectsList-C7sEPmu6.js";import"./HelpPopover-hWcy9haS.js";import{s as td}from"./DefaultPropsProvider-DPRhv_AP.js";import{d as as,B as cu}from"./SynapseConstants-CfvgkpB4.js";import"./SharePageLinkButton-BQuzk22l.js";import"./SageResourcesPopover-BnafVg2Q.js";import"./RecentPublicationsGrid-BnIzwtHN.js";import"./ImageCardGridWithLinks-DYppiFSS.js";import"./PortalFeatureHighlights-Clc_b6DL.js";import{p as du}from"./SqlFunctions-B6aZ8mL4.js";import{u as nd}from"./index-D-n8iezk.js";import{P as fu}from"./PortalSectionHeader-z9MfmDPJ.js";import{S as wr}from"./Stack-BMkmBXpw.js";import{S as ls}from"./Skeleton-BgVXRcxp.js";import{F as rd}from"./Fade-DAchz5lR.js";import{C as us}from"./CardMedia-Dl0w-f_e.js";import{L as Ar}from"./Link-DB1ue7Mo.js";import{B as Gt}from"./Button-DixPWBu_.js";import{b as id}from"./SchemaDrivenAnnotationEditor-m6RjcDOC.js";import{C as sd}from"./SynapseTableCell-BBjJaEZG.js";import{r as od,a as Wt}from"./isArray-CQWoh040.js";import{i as ad}from"./isEqual-DYS1ityr.js";import{i as It}from"./_Uint8Array-DKRij8Pm.js";import{g as ld}from"./_baseIteratee-C2CVdxlZ.js";import{r as Ht,c as hu}from"./index-CxPnffNK.js";import{a as Ls}from"./toInteger-CAEUe5q1.js";import{r as ud}from"./index-zG4oEPGU.js";import{r as cd}from"./index-BJiYowkb.js";import{A as pu}from"./Autocomplete-DQ3yxz7m.js";import{T as mu}from"./TextField-BwMiOl05.js";import{u as dd}from"./useInfiniteQuery-Cv3RIkKE.js";import{n as Tt}from"./useQuery-BFYapwyn.js";import{G as xe}from"./Grid-ZXIWsjIV.js";import{M as yr}from"./MenuItem-CyOffbkq.js";import{t as fd}from"./tslib.es6-Bipx4pcW.js";import{K as Fs}from"./CitationPopoverContent-B952wrAM.js";import{M as Us}from"./Menu-CAWPXNcD.js";import"./fetchWithExponentialTimeout-UV9FrpR8.js";import"./useTimeout-DCletuKH.js";import"./Collapse-DtLKmRWa.js";import"./createTheme-CwyfHowY.js";import"./useTheme-BGjL3p3E.js";import"./useTheme-CYR3sgEx.js";import"./getReactElementRef-WUekJjzf.js";import"./useForkRef-ISS65Dbm.js";import"./_baseUniq-NLHVw4Us.js";import"./_getTag-B_fA-_8S.js";import"./merge-BAPM3reP.js";import"./_initCloneObject-DlkwyIPz.js";import"./identity-DKeuBCMA.js";import"./createSvgIcon-BdhbaoYx.js";import"./tinycolor-Begke6kS.js";import"./inputBaseClasses-De2T74iN.js";import"./calculateFriendlyFileSize-CZVs-iSb.js";import"./CheckCircleTwoTone-CmaQzaow.js";import"./InfoTwoTone-BJLTUP-0.js";import"./index-DfdAMDFO.js";import"./index-MSg-8E6y.js";import"./extendSxProp-B8hz4pXV.js";import"./createSimplePaletteValueFilter-D-ylNyMT.js";import"./chunk-AYJ5UCUI-B-7RGnHT.js";import"./cloneDeep-BixVh9mJ.js";import"./pickBy-B8WHNec8.js";import"./isString-B8jJoTlg.js";import"./toString-CyzfARIG.js";import"./isSymbol-DHrtueJL.js";import"./pick-BnMfXz7a.js";import"./_baseGet-B8_0gsdx.js";import"./_baseSet-WmEAA2L0.js";import"./hasIn-BZgftwCH.js";import"./omit-ZmP3bObM.js";import"./_baseSlice-F8doVSIJ.js";import"./useQueries-DEJxj6zq.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-DhiRJDgX.js";import"./index-D_cRBOD6.js";import"./spreadSx-CwcO6WA9.js";import"./react-D986rM5G.js";import"./useMessage-BP-TkEfU.js";import"./LoadingScreen-q_Yj9Klh.js";import"./Backdrop-CxdBv-5w.js";import"./useSlot-C8xh2t7a.js";import"./LinearProgress-CG_fA3fh.js";import"./DeleteTwoTone-CusB8W-G.js";import"./relativeTime-CUgeHHG5.js";import"./Card-D1cWmn1s.js";import"./Paper-zc-lrNFo.js";import"./Tooltip-CFQP7Dzi.js";import"./useControlled-DWNCs13l.js";import"./Grow-Bt4rr9VO.js";import"./Popper-Do8nfD9j.js";import"./ownerDocument-DW-IO8s5.js";import"./isFocusVisible-B8k4qzLc.js";import"./IconButton-CNghFUuS.js";import"./ButtonBase-BBTsQTx6.js";import"./CircularProgress-CBtKmTpr.js";import"./FormControlLabel-Cn2KZGdx.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-CbOoPTpA.js";import"./Checkbox-gsKsVgJe.js";import"./SwitchBase-CHnIdCeE.js";import"./mergeSlotProps-DqWQRB6E.js";import"./AccountLevelBadge-CvhMyQuj.js";import"./index-C0yOfeuY.js";import"./const-BP60AzNb.js";import"./index-BGBI9VrG.js";import"./LoginMethodButton-Dyl0AdjR.js";import"./Alert-bz4bj5M3.js";import"./Close-BDxJ-CL7.js";import"./Dialog-BQl8TsRt.js";import"./DialogContent-BzxvXYnN.js";import"./Modal-FfK0UwV7.js";import"./getScrollbarSize-CaCM53D3.js";import"./ownerWindow-HkKU3E4x.js";import"./createChainedFunction-BO_9K8Jh.js";import"./DialogTitle-_d-sQd0l.js";import"./Divider-y5muj-sM.js";import"./dividerClasses-CZMugyi1.js";import"./ConditionalWrapper-CpBCX7_r.js";import"./Avatar-CT6XCVfy.js";import"./GenericCardIcon-Dw7Nh4yL.js";import"./index-B34HP0Lj.js";import"./ImageFileHandle-CV_qP7ag.js";import"./CopyToClipboardIcon-Dj9NeqZl.js";import"./CreateOrUpdateDoiModal-oFpCDW3U.js";import"./ConfirmCloseWithoutSavingDialog-2Rzx88ad.js";import"./JsonSchemaForm-6SSp1rZh.js";import"./GridLegacy-D-kn-Gwe.js";import"./HelpTwoTone-Do5feMfx.js";import"./InputLabel-C0SoRmqZ.js";import"./FormLabel-CiSZhXNb.js";import"./ContentCopy-JwCpKaiq.js";import"./Close-D_ZHdX10.js";import"./ArrowUpward-Bc-_T1x7.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./groupBy-BO7_Af95.js";import"./_createAggregator-JGy5Hm-d.js";import"./_baseEach-BvsvOx70.js";import"./_baseMap-bTgjrkcm.js";import"./List-BrHXMMzK.js";import"./ListItem-Yh6OR46M.js";import"./isHostComponent-DVu5iVWx.js";import"./isMuiElement-CnDXui-i.js";import"./listItemButtonClasses-GJpZZtBZ.js";import"./FormHelperText-DjrxvLSn.js";import"./DateTimePicker-BP-3l02T.js";import"./localizedFormat-Bc_MpEkv.js";import"./utc-HHYMF62e.js";import"./useMobilePicker-DLEiEsy5.js";import"./index-Btd0tKh9.js";import"./index-Chjiymov.js";import"./CSSTransition-BAnX6ndO.js";import"./visuallyHidden-Dan1xhjv.js";import"./FormControl-DPq4A_5F.js";import"./InputAdornment-3puVzERd.js";import"./index-Dt72UKAo.js";import"./getThemeProps-DdHk9pvF.js";import"./Chip-DSUfMbbz.js";import"./Tabs-CxPa3-oE.js";import"./debounce-Be36O1Ab.js";import"./KeyboardArrowRight-Bm8rOIzu.js";import"./MenuList-wSgS7NTu.js";import"./Select-BxInxY5d.js";import"./InputBase-B6q3N12v.js";import"./Input-Czjh1dnM.js";import"./SynapseTableUtils-B7ozSo9a.js";import"./useDownloadList-BWqWticy.js";import"./useGetEntityChildren-JkScdS1v.js";import"./DownloadConfirmationUI-D-neZC_O.js";import"./duration-Cr_eZzEK.js";import"./SynapseTableConstants-2qH3fDlQ.js";import"./LayersTwoTone-Bn3BczHl.js";import"./DownloadConfirmationUtils-Dr-dOJ5m.js";import"./QueryFilterUtils-Brr9ADNv.js";import"./TableRowSelectionState-DYN9HTHi.js";import"./QueryWrapperErrorBoundary-CQOhcfTK.js";import"./ActionRequiredListItem-lRSf9gs9.js";import"./differenceWith-Dq3giP1l.js";import"./MeetAccessRequirementCard-1cw3IGBj.js";import"./ACTAccessRequirement-WDpE4gfi.js";import"./LockAccessRequirement-B_A_PCc_.js";import"./SelfSignAccessRequirement-C_01XAIc.js";import"./useAccessRequirements-BDoJku7Z.js";import"./_baseOrderBy-mTT1U1tD.js";import"./AccessRequirementList-CpO9fUoq.js";import"./EntityLink-DBAxg644.js";import"./useGetEntityHeaders-WH6KyPE5.js";import"./EntityIcon-Zv3mKzqr.js";import"./ErrorChip-oaegyT3j.js";import"./ErrorOutlined-BhbsFteE.js";import"./UnmanagedACTAccessRequirementItem-Zc-4sq_q.js";import"./MarkdownSynapse-BaD52Rjr.js";import"./RequirementItem-BpW6oKfi.js";import"./LockTwoTone-KY3XZMHI.js";import"./UserSearchBoxV2-CwPBnZlz.js";import"./useDebouncedEffect-CkTjDWw8.js";import"./use-deep-compare-effect.esm-JvWyVgCg.js";import"./uniq-CgM7zxDZ.js";import"./without-t5BkQIto.js";import"./Select-aab027f3.esm-V5XZBzju.js";import"./defineProperty-CegpTSss.js";import"./ManagedACTAccessRequirementItemView-CfapVoyx.js";import"./SelfSignAccessRequirementItem-DQukIENd.js";import"./DataAccessRequestAccessorsFilesForm-BAv-VE49.js";import"./useDataAccessSubmission-bOvy9xWN.js";import"./RadioGroup-Bs1BaQUl.js";import"./Radio-B4KYtfnQ.js";import"./FormGroup-C0vv0UnU.js";import"./UploadDocumentField-3cEVERVW.js";import"./ManagedACTAccessRequirementFormWikiWrapper-BslSIcO_.js";import"./ResearchProjectForm-BtxmWY57.js";import"./TextFieldWithWordLimit-BWAwveJF.js";import"./AuthenticatedRequirement-CMOsp7tu.js";import"./CertificationRequirement-DLdXZUfj.js";import"./TwoFactorAuthEnabledRequirement-CP6xca0K.js";import"./ValidationRequirement-BkNRnPY0.js";import"./ActionRequiredCard-boImE_ak.js";import"./RequestDownloadCard-DQA6enRb.js";import"./useGetFeatureFlag-CYLtpfxs.js";import"./EntityAclEditorModal-CI6rGASI.js";import"./AccessControlListUtils-BjuRs6QH.js";import"./AclEditor-M4dW_KLO.js";import"./IconSvgButton-DgfIRkCh.js";import"./useUpdateAcl-CdG7f0-O.js";import"./OpenData-DK7KCG6v.js";import"./EnableTwoFaRequirementCard-xjEzi5dZ.js";import"./IconList-C2EJIAem.js";import"./GetAppTwoTone-B2B7fPHY.js";import"./pluralize-CM81v9LR.js";import"./SelectionCriteriaPill-DctwtsH5.js";import"./LastPage-DlgXe8l2.js";import"./StyledTableContainer-CFH14PKf.js";import"./times-TpSMvO50.js";import"./uniqueId-6OFsmHMl.js";import"./useGetEntityChallenge-CT0x1gho.js";import"./useTeamMembers-CaaPKx0g.js";import"./useGetUserTeams-0wehxAla.js";import"./ChallengeRegisterButton-B1MK5DI6.js";import"./ExitToApp-BoX12vVQ.js";import"./SpinnerButton-DGdp3xEp.js";import"./LoginAwareButton-Oly4FnEA.js";import"./ChallengeTeamWizard-BL6hbkGV.js";import"./CreateChallengeTeam-QDc8WdX6.js";import"./useTeam-i_CmD7rq.js";import"./papaparse.min-D1KxGBLm.js";import"./Search-CgzesvVZ.js";import"./Box-BFL2PhzN.js";import"./DataGrid-BJDEKzKc.js";import"./index-DNOSLGbB.js";import"./Switch-BBsL4CqI.js";import"./ListItemIcon-Cq1pSkLx.js";import"./Badge-D3q634xh.js";import"./usePreviousProps-BTozepBu.js";import"./ListItemText-C86OyckS.js";import"./ClickAwayListener-Bp9Ns1it.js";import"./useEntitySelection-roGC9Mpu.js";import"./FileEntityDirectDownload-Cu873PVq.js";import"./DirectDownload-DFes-FrW.js";import"./immutable.es-BJjDfH8f.js";import"./HelpOutlineTwoTone-DKCTr-6F.js";import"./StepperDialog-CUSupSeh.js";import"./useEvaluation-CZ46L8zy.js";import"./useChangePasswordFormState-BnbWZRNb.js";import"./ProgrammaticInstructionsModal-C61Y736S.js";import"./InteractiveCopyIdsIcon-D5YWykOh.js";import"./DirectProgrammaticDownload-CQY1BCVr.js";import"./EntityModal-2gSI7tKH.js";import"./FileHandleUtils-GJui-zC-.js";import"./useFavorites-D0svf149.js";import"./NoSearchResults-DfRUtz4d.js";import"./useSearch-D-qnLfCa.js";import"./index.esm-MZmaK8SS.js";import"./Slider-DR83jbSn.js";import"./_arrayReduce-CrxnWFSq.js";import"./forEach-BcnoVDae.js";import"./CreatedOnByUserDiv-BnV-zApf.js";import"./CardContent-B5tNNVd9.js";import"./upperFirst-CRMjbGRy.js";import"./_stringToArray-N8cAV6t0.js";import"./index.prod-BqIU7gbs.js";import"./InfoOutlined-DimmihnM.js";import"./ContentCopyTwoTone-CDRpjWfn.js";import"./PhoneTwoTone-BLx0O3qr.js";import"./Plot-BBH2kB2q.js";import"./useFacetPlots-COTowlY8.js";import"./ColorGradient-Zy7TAKxK.js";import"./colorPalette-BALeOMsp.js";import"./EnumFacetFilter-DiahGcWL.js";import"./EnumFacetFilterSkeleton-Cy5G4K49.js";import"./EnumFacetFilterUI-CyrZtrvb.js";import"./FacetFilterHeader-CIVt78NY.js";import"./index-BALzEfL6.js";import"./index-DBJ_jORv.js";import"./index-BzxmxmBt.js";import"./RangeFacetFilterUI-CrZftlHF.js";import"./RangeSlider-hkTNT-_x.js";import"./NoContentAvailable-CrmWlq7l.js";import"./ForumThreadEditor-BYN7IvIn.js";import"./useThread-Ch64vYNo.js";import"./useSubscription-BpFXRF9H.js";import"./SubscribersModal-cXZtmIk9.js";import"./useForum-aC_ewE0n.js";import"./getValidReactChildren-C0QsK_tG.js";import"./AlertTitle-BCr-iYO8.js";import"./HeaderCard-B4CDADcX.js";import"./SustainabilityScorecard-D0skTrJC.js";import"./Dial-Cyv0g2nT.js";import"./CheckIcon-B_O1fZMw.js";import"./FileHandleLink-6RcKVN3-.js";import"./ExpandableContent-Cs8avM8X.js";import"./useGetGoalData-DYEkcMyu.js";import"./NavigateNext-CW3mhtky.js";import"./CardActionArea-BwNkL57t.js";import"./mouse-Dm22Umm5.js";import"./SortDown-CK_cT0lL.js";import"./Container-T6qAjgiT.js";import"./SynapseFormRadioWidget-fgEehbGb.js";import"./ExpandCollapseButton-1lEotPHS.js";import"./OAuthClientAclEditor-W3MO2vQJ.js";import"./unCamelCase-ZiU_emRy.js";import"./head-aneRfQQJ.js";import"./LargeButton-D8L24iRt.js";import"./ExportToAnalysisPlatformDialog-BaGiDqH0.js";import"./WizardChoiceButton-B25HSDNi.js";import"./RowSelectionUI-GvNZ-grX.js";import"./DownloadLoginModal-Xx9EfiHu.js";import"./NoData-BFkdVlRf.js";import"./index-R6nwl4YL.js";import"./index-_NVd4e-8.js";import"./SageFullLogo-A9c2kFrh.js";import"./index-DF7cmvqB.js";import"./events-DQ172AOg.js";import"./Topic-BKoEta2s.js";import"./types-CP9zjM1W.js";import"./Popover-B1_2ieV-.js";import"./TeamBadge-Dj-UilGc.js";import"./EntityFinderModal-BH-sDevW.js";import"./EntityHeaderTableCellRenderers-C_2VhBU0.js";import"./Slide-DxsZkIuB.js";import"./TextWidget-sz_z1ynu.js";var ri=function(){return od.Date.now()},hd="Expected a function",pd=Math.max,md=Math.min;function gd(e,u,f){var d,i,c,t,o,s,r=0,n=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(hd);u=Ls(u)||0,It(f)&&(n=!!f.leading,a="maxWait"in f,c=a?pd(Ls(f.maxWait)||0,u):c,p="trailing"in f?!!f.trailing:p);function h(S){var C=d,O=i;return d=i=void 0,r=S,t=e.apply(O,C),t}function w(S){return r=S,o=setTimeout(l,u),n?h(S):t}function y(S){var C=S-s,O=S-r,x=u-C;return a?md(x,c-O):x}function b(S){var C=S-s,O=S-r;return s===void 0||C>=u||C<0||a&&O>=c}function l(){var S=ri();if(b(S))return m(S);o=setTimeout(l,y(S))}function m(S){return o=void 0,p&&d?h(S):(d=i=void 0,t)}function g(){o!==void 0&&clearTimeout(o),r=0,d=s=i=o=void 0}function v(){return o===void 0?t:m(ri())}function _(){var S=ri(),C=b(S);if(d=arguments,i=this,s=S,C){if(o===void 0)return w(s);if(a)return clearTimeout(o),o=setTimeout(l,u),h(s)}return o===void 0&&(o=setTimeout(l,u)),t}return _.cancel=g,_.flush=v,_}var bd="Expected a function";function yd(e,u,f){var d=!0,i=!0;if(typeof e!="function")throw new TypeError(bd);return It(f)&&(d="leading"in f?!!f.leading:d,i="trailing"in f?!!f.trailing:i),gd(e,u,{leading:d,maxWait:u,trailing:i})}let ii=!1;const vd=(e="GTM-KPW4KS62")=>{const[u]=$c();return $.useEffect(()=>{var f;if(u.analyticsAllowed&&!ii){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":new Date().getTime(),event:"gtm.js"});const d=document.getElementsByTagName("script")[0],i=document.createElement("script"),c="&l=dataLayer";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+e+c,(f=d.parentNode)==null||f.insertBefore(i,d),ii=!0}},[u,e]),ii};function wd(e){const{synapseClient:u}=st();return ft({...e,mutationFn:async f=>{const d=await u.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:f});return(await os(()=>u.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:d.token}))).responseBody}})}function _d(e){const{keyFactory:u,synapseClient:f}=st(),d=Br();return ft({...e,mutationFn:async i=>{const c=await f.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:i.entityId,tableUpdateTransactionRequest:i});return(await os(()=>f.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:c.token}))).responseBody},onSuccess:async(i,c,t)=>{await kc(d,u,c.entityId)}})}function Sd(e){const u=Br(),{mutateAsync:f}=wd(),{mutateAsync:d}=_d(),i=Bc();return ft({...e,mutationFn:async({gridSessionId:c,sourceEntityId:t})=>{const o=await u.fetchQuery(i(t)),s={...xd(o),sessionId:c},r=await f(s),n={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:t,changes:[{uploadFileHandleId:r.resultsFileHandleId,tableId:t,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return d(n)}})}function xd(e){return jc(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}try{Ms.displayName="CardGridWithLinks",Ms.__docgenInfo={description:"",displayName:"CardGridWithLinks",props:{linkText:{defaultValue:null,description:"",name:"linkText",required:!0,type:{name:"string"}},cards:{defaultValue:null,description:"",name:"cards",required:!0,type:{name:"CardGridWithLinksConfig[]"}}}}}catch{}try{qs.displayName="CTASectionWrapper",qs.__docgenInfo={description:"",displayName:"CTASectionWrapper",props:{themeMode:{defaultValue:null,description:"",name:"themeMode",required:!0,type:{name:"enum",value:[{value:'"dark"'},{value:'"light"'}]}},showBlobs:{defaultValue:{value:"true"},description:"",name:"showBlobs",required:!1,type:{name:"boolean"}},content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"ReactNode"}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps"}}}}}catch{}const $s=({schemaUrl:e,uiSchemaUrl:u,postUrl:f,submitButtonText:d})=>{const[i,c]=$.useState(!1),t=()=>{c(!0)},o=()=>{c(!1)},s=j.jsx(Jc,{schemaUrl:e,uiSchemaUrl:u,postUrl:f,onSubmit:()=>{o()}});return j.jsx("div",{className:"browse-tools-page",children:j.jsxs(Ce,{sx:{margin:"10px 0px 50px 0px"},children:[j.jsx(Kc,{className:"highlightSubmitToolButton",variant:"contained",onClick:t,children:d}),j.jsx(Hc,{open:i,title:"",content:s,onCancel:o,onConfirm:()=>{},confirmButtonProps:{sx:{display:"none"}},cancelButtonProps:{children:"cancel"}})]})})};try{$s.displayName="DynamicFormModal",$s.__docgenInfo={description:"",displayName:"DynamicFormModal",props:{schemaUrl:{defaultValue:null,description:"",name:"schemaUrl",required:!0,type:{name:"string"}},uiSchemaUrl:{defaultValue:null,description:"",name:"uiSchemaUrl",required:!0,type:{name:"string"}},postUrl:{defaultValue:null,description:"",name:"postUrl",required:!0,type:{name:"string"}},mutateFormDataBeforePost:{defaultValue:null,description:"",name:"mutateFormDataBeforePost",required:!1,type:{name:"(formData: any) => any"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!1,type:{name:"() => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"() => void"}},submitButtonText:{defaultValue:null,description:"",name:"submitButtonText",required:!1,type:{name:"string"}}}}}catch{}class _r extends $.Component{constructor(f){super(f);Z(this,"formRef");Z(this,"submitForm",()=>{this.formRef.current.submit()});Z(this,"refresh",()=>{if(this.context.accessToken){const f=[Ne.getUserProfile(this.context.accessToken),Ne.getEntity(this.context.accessToken,this.props.formSchemaEntityId),Ne.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(f).then(d=>{const i=d[0];this.getTargetContainer(i,this.context.accessToken).then(c=>{const t=d[1],o=d[2];this.getSchemaFileContent(c,t,o)})}).catch(d=>{this.onError(d)})}});Z(this,"getSchemaFileContent",(f,d,i)=>{const c=[Ne.getFileResult(d,this.context.accessToken,!0,!0),Ne.getFileResult(i,this.context.accessToken,!0,!0)];Promise.all(c).then(t=>{try{const o=t.map(s=>Vs(s.fileHandle,s.preSignedURL));Promise.all(o).then(s=>{const r=JSON.parse(s[0]),n=JSON.parse(s[1]);this.getExistingFileData(f,r,n)}).catch(s=>{console.log("getSchemaFileContent: Error getting form content",s)})}catch(o){console.log("getSchemaFileContent: Error getting schema content",o)}}).catch(t=>{this.onError(t)})});Z(this,"getExistingFileData",(f,d,i)=>{const t={entityName:`${d.title}.json`,parentId:f};let o,s;Ne.lookupChildEntity(t,this.context.accessToken).then(r=>Ne.getEntity(this.context.accessToken,r.id).then(n=>(s=n,this.props.initFormData?Ne.getFileResult(s,this.context.accessToken,!0,!0).then(async a=>{try{const p=await Vs(a.fileHandle,a.preSignedURL);o=JSON.parse(p)}catch(p){console.log("getExistingFileData: Error setting form data",p)}}):Promise.resolve()))).finally(()=>{this.setState({formData:o,currentFileEntity:s,formSchema:d,formUiSchema:i})})});Z(this,"getTargetContainer",async(f,d)=>{const i={entityName:f.ownerId,parentId:this.props.parentContainerId};try{const c=await Ne.lookupChildEntity(i,d);return console.log(`EntityForm uploading to https://www.synapse.org/Synapse:${c.id}`),this.setState({userprofile:f,containerId:c.id,isLoading:!1}),c.id}catch(c){return c.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(c)}});Z(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});Z(this,"onError",f=>{this.setState({error:f,isLoading:!1,successfullyUploaded:!1})});Z(this,"onSubmit",({formData:f})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const d=new Blob([JSON.stringify(f)],{type:"text/json"});this.createEntityFile(d)});Z(this,"createEntityFile",f=>{const d=`${this.state.formSchema.title}.json`;Ne.uploadFile(this.context.accessToken,d,f).then(i=>{const c=i.fileHandleId;if(this.state.currentFileEntity){const o={...this.state.currentFileEntity,dataFileHandleId:c};return this.setState({currentFileEntity:o}),Ne.updateEntity(o,this.context.accessToken)}const t={parentId:this.state.containerId,name:d,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:c};return Ne.createEntity(t,this.context.accessToken)}).then(i=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(i.id)}).catch(i=>{this.onError(i)})});this.formRef=$.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return j.jsxs("div",{children:[this.state.error&&j.jsxs("div",{className:"panel panel-danger errors",children:[j.jsx("div",{className:"panel-heading",children:j.jsx("h3",{className:"panel-title",children:"Error"})}),j.jsx("ul",{className:"list-group",children:j.jsxs("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&j.jsx(Yc,{validator:Xc,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:j.jsx("div",{style:{display:"none"},children:j.jsx("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&j.jsxs(j.Fragment,{children:[j.jsx("span",{children:"Savingâ€¦"}),j.jsx("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}Z(_r,"contextType",Vc);try{_r.displayName="EntityForm",_r.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}try{_r.contextType.displayName="EntityForm.contextType",_r.contextType.__docgenInfo={description:"If set, `this.context` will be set at runtime to the current value of the given Context.",displayName:"EntityForm.contextType",props:{}}}catch{}const zs=e=>{const{accessToken:u}=st(),{synId:f,className:d}=e,[i,c]=$.useState(void 0);$.useEffect(()=>{(async()=>{try{const r=await Ne.getEntity(u,f);if(!Lc(r))throw new Error(`File Entity expected but found ${r}`);const n={requestedFiles:[{associateObjectId:f,associateObjectType:au.FileEntity,fileHandleId:r.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},p=(await Ne.getFiles(n,u)).requestedFiles[0].fileHandle;if(p&&Fc(p))c({externalFileHandle:p,fileEntity:r});else throw new Error(`Not an external file handle: ${p==null?void 0:p.id}`)}catch(r){console.error("Error on getting external file handle = ",r)}})()},[f,u]);const t=i==null?void 0:i.externalFileHandle,o=i==null?void 0:i.fileEntity;return t?j.jsx("a",{href:t.externalURL,className:d,target:"_blank",rel:"noopener noreferrer",children:j.jsxs("span",{children:[o==null?void 0:o.name,j.jsx(Zc,{style:{marginLeft:5}})]})}):j.jsx(j.Fragment,{})};try{zs.displayName="ExternalFileHandleLink",zs.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Bs.displayName="GoalsV3",Bs.__docgenInfo={description:"",displayName:"GoalsV3",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},svgComponentMap:{defaultValue:null,description:"",name:"svgComponentMap",required:!0,type:{name:"Record<string, FC<SVGProps<SVGSVGElement>>>"}}}}}catch{}function Gs(e){const{measurementId:u}=e;return vd(u),j.jsx(j.Fragment,{})}try{Gs.displayName="GoogleAnalytics",Gs.__docgenInfo={description:`GoogleAnalytics is a component wrapper for the useGoogleAnalytics() hook.
This is exported for use in the Synapse.org GWT codebase.`,displayName:"GoogleAnalytics",props:{measurementId:{defaultValue:null,description:"",name:"measurementId",required:!1,type:{name:"string"}}}}}catch{}function Ws(){return j.jsxs(Ce,{sx:{color:"grey.700",maxHeight:{xs:"170px",md:"110px"},overflow:"auto",margin:"20px 0px"},children:[j.jsx(Xe,{variant:"smallText1",sx:{fontWeight:700,marginBottom:"5px"},children:"System Use Notice"}),j.jsx(Xe,{variant:"smallText1",sx:{lineHeight:"21px"},children:"Sage Bionetworks actively monitors this system and activity to maintain system security and availability and to ensure appropriate and legitimate usage. Any individual who intentionally accesses a computer or system without authorization, and who alters, damages, makes unauthorized modifications to, or destroys information, or exceeds authorized access, is in violation of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance. Any evidence of possible violations of proper use or applicable laws found as a result of this monitoring may be turned over to law enforcement. Any individual found to be in violation of the system's proper use rules or law could be punished with loss of system access, fines, and/or imprisonment. By proceeding, you hereby acknowledge your agreement with these terms and the system's rules of behavior and consent to such monitoring and information retrieval for law enforcement and other official purposes."})]})}try{Ws.displayName="SystemUseNotification",Ws.__docgenInfo={description:"FISMA SAR V1-AC-8 System Use Notification, see https://sagebionetworks.jira.com/browse/SWC-6430",displayName:"SystemUseNotification",props:{}}}catch{}const Hs=td(Ce,{label:"MuiContainer"})(({theme:e})=>({paddingRight:15,paddingLeft:15,marginRight:"auto",marginLeft:"auto",[e.breakpoints.up("md")]:{width:920},[e.breakpoints.up("lg")]:{width:1170},[e.breakpoints.up("xl")]:{width:1366}}));try{Hs.displayName="MuiContainer",Hs.__docgenInfo={description:"Drop in MUI substitute class for Bootstrap Container component",displayName:"MuiContainer",props:{border:{defaultValue:null,description:"",name:"border",required:!1,type:{name:'ResponsiveStyleValue<number | (string & {}) | "inset" | "inherit" | "medium" | "none" | "initial" | "hidden" | "-moz-initial" | "revert" | "unset" | "revert-layer" | "thick" | "thin" | "dashed" | ... 183 more ... | "currentcolor"> | ((theme: Theme) => ResponsiveStyleValue<...>)'}},boxShadow:{defaultValue:null,description:"",name:"boxShadow",required:!1,type:{name:"ResponsiveStyleValue<number | BoxShadow> | ((theme: Theme) => ResponsiveStyleValue<number | BoxShadow>)"}},fontWeight:{defaultValue:null,description:"",name:"fontWeight",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},zIndex:{defaultValue:null,description:"",name:"zIndex",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignContent>)"}},alignItems:{defaultValue:null,description:"",name:"alignItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignItems>)"}},alignSelf:{defaultValue:null,description:"",name:"alignSelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignSelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignSelf>)"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"ResponsiveStyleValue<Bottom<string | number> | readonly NonNullable<Bottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},boxSizing:{defaultValue:null,description:"",name:"boxSizing",required:!1,type:{name:"ResponsiveStyleValue<BoxSizing | readonly NonNullable<BoxSizing>[]> | ((theme: Theme) => ResponsiveStyleValue<BoxSizing | readonly NonNullable<...>[]>)"}},color:{defaultValue:null,description:"",name:"color",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Color> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Color>)"}},columnGap:{defaultValue:null,description:"",name:"columnGap",required:!1,type:{name:"ResponsiveStyleValue<ColumnGap<string | number> | readonly NonNullable<ColumnGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},display:{defaultValue:null,description:"",name:"display",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},flexBasis:{defaultValue:null,description:"",name:"flexBasis",required:!1,type:{name:"ResponsiveStyleValue<FlexBasis<string | number> | readonly NonNullable<FlexBasis<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flexDirection:{defaultValue:null,description:"",name:"flexDirection",required:!1,type:{name:"ResponsiveStyleValue<FlexDirection | readonly NonNullable<FlexDirection>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexDirection | readonly NonNullable<...>[]>)"}},flexGrow:{defaultValue:null,description:"",name:"flexGrow",required:!1,type:{name:"ResponsiveStyleValue<FlexGrow | readonly NonNullable<FlexGrow>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexGrow | readonly NonNullable<...>[]>)"}},flexShrink:{defaultValue:null,description:"",name:"flexShrink",required:!1,type:{name:"ResponsiveStyleValue<FlexShrink | readonly NonNullable<FlexShrink>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexShrink | readonly NonNullable<...>[]>)"}},flexWrap:{defaultValue:null,description:"",name:"flexWrap",required:!1,type:{name:"ResponsiveStyleValue<FlexWrap | readonly NonNullable<FlexWrap>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexWrap | readonly NonNullable<...>[]>)"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontFamily> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontFamily>)"}},fontSize:{defaultValue:null,description:"",name:"fontSize",required:!1,type:{name:"ResponsiveStyleValue<FontSize<string | number> | readonly NonNullable<FontSize<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},fontStyle:{defaultValue:null,description:"",name:"fontStyle",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontStyle> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontStyle>)"}},gridAutoColumns:{defaultValue:null,description:"",name:"gridAutoColumns",required:!1,type:{name:"ResponsiveStyleValue<GridAutoColumns<string | number> | readonly NonNullable<GridAutoColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridAutoFlow:{defaultValue:null,description:"",name:"gridAutoFlow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridAutoFlow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridAutoFlow>)"}},gridAutoRows:{defaultValue:null,description:"",name:"gridAutoRows",required:!1,type:{name:"ResponsiveStyleValue<GridAutoRows<string | number> | readonly NonNullable<GridAutoRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateAreas:{defaultValue:null,description:"",name:"gridTemplateAreas",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridTemplateAreas> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridTemplateAreas>)"}},gridTemplateColumns:{defaultValue:null,description:"",name:"gridTemplateColumns",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateColumns<string | number> | readonly NonNullable<GridTemplateColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateRows:{defaultValue:null,description:"",name:"gridTemplateRows",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateRows<string | number> | readonly NonNullable<GridTemplateRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"ResponsiveStyleValue<Height<string | number> | readonly NonNullable<Height<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},justifyContent:{defaultValue:null,description:"",name:"justifyContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyContent>)"}},justifyItems:{defaultValue:null,description:"",name:"justifyItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyItems>)"}},justifySelf:{defaultValue:null,description:"",name:"justifySelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifySelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifySelf>)"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"ResponsiveStyleValue<Left<string | number> | readonly NonNullable<Left<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Left<...> | readonly NonNullable<...>[]>)"}},letterSpacing:{defaultValue:null,description:"",name:"letterSpacing",required:!1,type:{name:"ResponsiveStyleValue<LetterSpacing<string | number> | readonly NonNullable<LetterSpacing<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},lineHeight:{defaultValue:null,description:"",name:"lineHeight",required:!1,type:{name:"ResponsiveStyleValue<LineHeight<string | number> | readonly NonNullable<LineHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockEnd:{defaultValue:null,description:"",name:"marginBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockEnd<string | number> | readonly NonNullable<MarginBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockStart:{defaultValue:null,description:"",name:"marginBlockStart",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockStart<string | number> | readonly NonNullable<MarginBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBottom:{defaultValue:null,description:"",name:"marginBottom",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineEnd:{defaultValue:null,description:"",name:"marginInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineEnd<string | number> | readonly NonNullable<MarginInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineStart:{defaultValue:null,description:"",name:"marginInlineStart",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineStart<string | number> | readonly NonNullable<MarginInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginLeft:{defaultValue:null,description:"",name:"marginLeft",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginRight:{defaultValue:null,description:"",name:"marginRight",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginTop:{defaultValue:null,description:"",name:"marginTop",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"ResponsiveStyleValue<MaxHeight<string | number> | readonly NonNullable<MaxHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxWidth:{defaultValue:null,description:"",name:"maxWidth",required:!1,type:{name:"ResponsiveStyleValue<MaxWidth<string | number> | readonly NonNullable<MaxWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minHeight:{defaultValue:null,description:"",name:"minHeight",required:!1,type:{name:"ResponsiveStyleValue<MinHeight<string | number> | readonly NonNullable<MinHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minWidth:{defaultValue:null,description:"",name:"minWidth",required:!1,type:{name:"ResponsiveStyleValue<MinWidth<string | number> | readonly NonNullable<MinWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},order:{defaultValue:null,description:"",name:"order",required:!1,type:{name:"ResponsiveStyleValue<Order | readonly NonNullable<Order>[]> | ((theme: Theme) => ResponsiveStyleValue<Order | readonly NonNullable<Order>[]>)"}},paddingBlockEnd:{defaultValue:null,description:"",name:"paddingBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockEnd<string | number> | readonly NonNullable<PaddingBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlockStart:{defaultValue:null,description:"",name:"paddingBlockStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockStart<string | number> | readonly NonNullable<PaddingBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBottom:{defaultValue:null,description:"",name:"paddingBottom",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineEnd:{defaultValue:null,description:"",name:"paddingInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineEnd<string | number> | readonly NonNullable<PaddingInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineStart:{defaultValue:null,description:"",name:"paddingInlineStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineStart<string | number> | readonly NonNullable<PaddingInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingLeft:{defaultValue:null,description:"",name:"paddingLeft",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingRight:{defaultValue:null,description:"",name:"paddingRight",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingTop:{defaultValue:null,description:"",name:"paddingTop",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"ResponsiveStyleValue<Position | readonly NonNullable<Position>[]> | ((theme: Theme) => ResponsiveStyleValue<Position | readonly NonNullable<...>[]>)"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"ResponsiveStyleValue<Right<string | number> | readonly NonNullable<Right<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},rowGap:{defaultValue:null,description:"",name:"rowGap",required:!1,type:{name:"ResponsiveStyleValue<RowGap<string | number> | readonly NonNullable<RowGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},textAlign:{defaultValue:null,description:"",name:"textAlign",required:!1,type:{name:"ResponsiveStyleValue<TextAlign | readonly NonNullable<TextAlign>[]> | ((theme: Theme) => ResponsiveStyleValue<TextAlign | readonly NonNullable<...>[]>)"}},textOverflow:{defaultValue:null,description:"",name:"textOverflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | TextOverflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | TextOverflow>)"}},textTransform:{defaultValue:null,description:"",name:"textTransform",required:!1,type:{name:"ResponsiveStyleValue<TextTransform | readonly NonNullable<TextTransform>[]> | ((theme: Theme) => ResponsiveStyleValue<TextTransform | readonly NonNullable<...>[]>)"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"ResponsiveStyleValue<Top<string | number> | readonly NonNullable<Top<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Top<string | number> | readonly NonNullable<...>[]>)"}},visibility:{defaultValue:null,description:"",name:"visibility",required:!1,type:{name:"ResponsiveStyleValue<Visibility | readonly NonNullable<Visibility>[]> | ((theme: Theme) => ResponsiveStyleValue<Visibility | readonly NonNullable<...>[]>)"}},whiteSpace:{defaultValue:null,description:"",name:"whiteSpace",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | WhiteSpace> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | WhiteSpace>)"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"ResponsiveStyleValue<Width<string | number> | readonly NonNullable<Width<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderBottom:{defaultValue:null,description:"",name:"borderBottom",required:!1,type:{name:"ResponsiveStyleValue<BorderBottom<string | number> | readonly NonNullable<BorderBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderColor:{defaultValue:null,description:"",name:"borderColor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BorderColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BorderColor>)"}},borderLeft:{defaultValue:null,description:"",name:"borderLeft",required:!1,type:{name:"ResponsiveStyleValue<BorderLeft<string | number> | readonly NonNullable<BorderLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRadius:{defaultValue:null,description:"",name:"borderRadius",required:!1,type:{name:"ResponsiveStyleValue<BorderRadius<string | number> | readonly NonNullable<BorderRadius<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRight:{defaultValue:null,description:"",name:"borderRight",required:!1,type:{name:"ResponsiveStyleValue<BorderRight<string | number> | readonly NonNullable<BorderRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderTop:{defaultValue:null,description:"",name:"borderTop",required:!1,type:{name:"ResponsiveStyleValue<BorderTop<string | number> | readonly NonNullable<BorderTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flex:{defaultValue:null,description:"",name:"flex",required:!1,type:{name:"ResponsiveStyleValue<Flex<string | number> | readonly NonNullable<Flex<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Flex<...> | readonly NonNullable<...>[]>)"}},gap:{defaultValue:null,description:"",name:"gap",required:!1,type:{name:"ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<Gap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<...>[]>)"}},gridArea:{defaultValue:null,description:"",name:"gridArea",required:!1,type:{name:"ResponsiveStyleValue<GridArea | readonly NonNullable<GridArea>[]> | ((theme: Theme) => ResponsiveStyleValue<GridArea | readonly NonNullable<...>[]>)"}},gridColumn:{defaultValue:null,description:"",name:"gridColumn",required:!1,type:{name:"ResponsiveStyleValue<GridColumn | readonly NonNullable<GridColumn>[]> | ((theme: Theme) => ResponsiveStyleValue<GridColumn | readonly NonNullable<...>[]>)"}},gridRow:{defaultValue:null,description:"",name:"gridRow",required:!1,type:{name:"ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]> | ((theme: Theme) => ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]>)"}},margin:{defaultValue:null,description:"",name:"margin",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlock:{defaultValue:null,description:"",name:"marginBlock",required:!1,type:{name:"ResponsiveStyleValue<MarginBlock<string | number> | readonly NonNullable<MarginBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInline:{defaultValue:null,description:"",name:"marginInline",required:!1,type:{name:"ResponsiveStyleValue<MarginInline<string | number> | readonly NonNullable<MarginInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},overflow:{defaultValue:null,description:"",name:"overflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Overflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Overflow>)"}},padding:{defaultValue:null,description:"",name:"padding",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlock:{defaultValue:null,description:"",name:"paddingBlock",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlock<string | number> | readonly NonNullable<PaddingBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInline:{defaultValue:null,description:"",name:"paddingInline",required:!1,type:{name:"ResponsiveStyleValue<PaddingInline<string | number> | readonly NonNullable<PaddingInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},bgcolor:{defaultValue:null,description:"",name:"bgcolor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BackgroundColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BackgroundColor>)"}},m:{defaultValue:null,description:"",name:"m",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mt:{defaultValue:null,description:"",name:"mt",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mr:{defaultValue:null,description:"",name:"mr",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mb:{defaultValue:null,description:"",name:"mb",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},ml:{defaultValue:null,description:"",name:"ml",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mx:{defaultValue:null,description:"",name:"mx",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginX:{defaultValue:null,description:"",name:"marginX",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},my:{defaultValue:null,description:"",name:"my",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginY:{defaultValue:null,description:"",name:"marginY",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},p:{defaultValue:null,description:"",name:"p",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pt:{defaultValue:null,description:"",name:"pt",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pr:{defaultValue:null,description:"",name:"pr",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pb:{defaultValue:null,description:"",name:"pb",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pl:{defaultValue:null,description:"",name:"pl",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},px:{defaultValue:null,description:"",name:"px",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingX:{defaultValue:null,description:"",name:"paddingX",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},py:{defaultValue:null,description:"",name:"py",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingY:{defaultValue:null,description:"",name:"paddingY",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},typography:{defaultValue:null,description:"",name:"typography",required:!1,type:{name:"ResponsiveStyleValue<string> | ((theme: Theme) => ResponsiveStyleValue<string>)"}},displayPrint:{defaultValue:null,description:"",name:"displayPrint",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const gu=e=>{$.useEffect(()=>{if(e){const u=document.querySelector("head"),f=document.createElement("script");f.setAttribute("type","application/ld+json");const d=document.createTextNode(e);return f.appendChild(d),u==null||u.appendChild(f),()=>{u==null||u.removeChild(f)}}},[e])};function Js({thing:e}){return gu(JSON.stringify(e)),j.jsx(j.Fragment,{})}try{Js.displayName="JsonLdScript",Js.__docgenInfo={description:"This component will add a json ld script tag to the page when rendered.",displayName:"JsonLdScript",props:{thing:{defaultValue:null,description:"",name:"thing",required:!0,type:{name:"WithContext<Thing>"}}}}}catch{}function Ks({entityId:e,version:u,searchParams:f}){var a,p,h;let d,i;e?(d=e,i=u):f&&(d=f.id,f.version&&(i=parseInt(f.version)));const c={sql:"select croissant_file_s3_object from syn65903895",additionalFilters:[{concreteType:Ps,columnName:"dataset",operator:As.EQUAL,values:[d]}]};i&&c.additionalFilters.push({concreteType:Ps,columnName:"dataset_version",operator:As.EQUAL,values:[`${i}`]});const{data:t}=Ac({entityId:d,query:c,partMask:as,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),o=(h=(p=(a=t==null?void 0:t.responseBody)==null?void 0:a.queryResult)==null?void 0:p.queryResults)==null?void 0:h.rows,s=o&&o.length>0?o[0]:void 0,r=s==null?void 0:s.values[0],{data:n}=Pc(r,{enabled:!!r});return gu(n),j.jsx(j.Fragment,{})}try{Ks.displayName="DatasetJsonLdScript",Ks.__docgenInfo={description:"This component will add a Dataset json ld script tag to the page when rendered.",displayName:"DatasetJsonLdScript",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!1,type:{name:"string"}},version:{defaultValue:null,description:"",name:"version",required:!1,type:{name:"number"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"{ [key: string]: string; }"}}}}}catch{}const cs=(e,u)=>{const f={associateObjectId:u,associateObjectType:au.TableEntity,fileHandleId:e||""},d=Mc(f,!1,{enabled:!!e});return d==null?void 0:d.dataUrl},Cd=400,Od=({research:e,entityId:u,publicationDateColIndex:f,titleColIndex:d,linkColIndex:i,imageColIndex:c,isLoading:t})=>{const o=e.values[c]??"",s=cs(o??"",u);return t?j.jsx(ls,{variant:"rectangular",height:142,width:"100%"}):j.jsxs(Ce,{sx:{display:"flex",gap:"30px",borderBottom:"1px solid",padding:"24px 0",borderColor:"grey.300",flexDirection:{xs:"column",sm:"row"}},children:[j.jsxs(wr,{useFlexGap:!0,sx:{gap:"10px"},children:[j.jsx(Xe,{variant:"headline2",sx:{color:"gray.1000",fontSize:"21px"},children:j.jsx(Ar,{href:e.values[i]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[d]})}),j.jsx(Xe,{sx:{lineHeight:"normal",color:"grey.600"},children:e.values[f]&&zc(Gc(Number(e.values[f])),"MMMM, YYYY")})]}),j.jsx(us,{component:"img",image:s,"aria-hidden":"true",sx:{flexShrink:0,width:"140px",height:"93.8px",borderRadius:"6px",objectFit:"cover",marginLeft:{xs:"initial",sm:"auto"}}})]})},Rd=({research:e,entityId:u,titleColIndex:f,descriptionColIndex:d,linkColIndex:i,imageColIndex:c,isLoading:t})=>{const[o,s]=nd({threshold:.3,triggerOnce:!0}),r=e.values[c]??"",n=cs(r||"",u);return t?j.jsx(ls,{variant:"rectangular",width:"100%",sx:{height:{xs:"250px",sm:"500px",md:"600px",lg:"800px"}}}):j.jsxs(Ce,{ref:o,children:[j.jsx(rd,{in:s,timeout:Cd,children:j.jsx(us,{component:"img",image:n,"aria-hidden":"true",sx:{objectFit:"cover",borderRadius:"10px",marginBottom:"30px"}})}),j.jsxs(wr,{useFlexGap:!0,sx:{gap:"16px"},children:[j.jsx(Xe,{variant:"headline2",sx:{color:"grey.1000",fontSize:{xs:"24px",md:"36px"}},children:j.jsx(Ar,{href:e.values[i]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[f]})}),j.jsx(Xe,{sx:{fontSize:"18px",lineHeight:"22.4px"},children:e.values[d]??""}),j.jsx(Ar,{href:e.values[i]??"",target:"_blank",children:"Read more"})]})]})};function Ys(e){const{sql:u}=e,f=du(u),d={partMask:cu|as,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:f,query:{sql:u}},{data:i,isLoading:c}=ou(d),t=(i==null?void 0:i.queryResult.queryResults.rows)??[];let o;(b=>{b.TITLE="title",b.DESCRIPTION="description",b.PUBLICATION_DATE="publicationDate",b.IMAGE="image",b.LINK="link"})(o||(o={}));const s=ct("title",i),r=ct("description",i),n=ct("publicationDate",i),a=ct("image",i),p=ct("link",i),h=t[0],w=t.slice(1),y=j.jsx(fu,{title:"Featured Research",sx:{h2:{fontSize:"24px",paddingBottom:0,width:"100%"}}});return j.jsxs(Ce,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:{xs:"30px",md:"40px"},padding:{xs:"40px",lg:"80px"}},children:[j.jsx(Ce,{sx:{display:{md:"none"}},children:y}),j.jsx(Ce,{children:h&&j.jsx(Rd,{entityId:f,research:h,titleColIndex:s,isLoading:c,descriptionColIndex:r,publicationDateColIndex:n,imageColIndex:a,linkColIndex:p})}),j.jsxs(wr,{children:[j.jsx(Ce,{sx:{display:{xs:"none",md:"block"}},children:y}),j.jsx(wr,{sx:{gap:"16px"},children:w.map((b,l)=>j.jsx(Od,{entityId:f,research:b,isLoading:c,titleColIndex:s,descriptionColIndex:r,publicationDateColIndex:n,imageColIndex:a,linkColIndex:p},l))})]})]})}try{Ys.displayName="FeaturedResearch",Ys.__docgenInfo={description:"",displayName:"FeaturedResearch",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const Pr=({backgroundCss:e,buttonLink:u,title:f,subTitle:d,description:i,backgroundMp4:c,backgroundMp4Css:t})=>j.jsxs(Ce,{"data-testid":"HeaderContainer",sx:{background:e,padding:{xs:0,md:"50px 80px"},position:"relative"},children:[c&&j.jsxs(Ce,{component:"video",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"fill",zIndex:-1,background:t},children:[j.jsx("source",{src:c,type:"video/mp4"}),"Your browser does not support the video tag."]}),j.jsxs(wr,{sx:{alignItems:"flex-start",padding:{xs:"40px",md:"40px 0"},gap:"24px",width:{sm:"100%",md:"746px"}},children:[j.jsx(Xe,{variant:"headline2",sx:{fontWeight:300,lineHeight:"130%",fontSize:{xs:"36px",md:"42px"},color:"grey.1000"},children:f}),j.jsx(Xe,{variant:"headline3",sx:{fontSize:"24px",fontWeight:"400",lineHeight:"160%",color:"grey.1000"},children:d}),j.jsx(Xe,{sx:{fontSize:"18px",lineHeight:"140%",color:"grey.900"},children:i}),u&&j.jsx(Gt,{href:u,target:"_blank",variant:"contained",role:"button",sx:o=>({whiteSpace:"nowrap",alignSelf:"flex-start",padding:"6px 24px",fontWeight:600,boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)","&:hover":{boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)"},[o.breakpoints.down("sm")]:{width:"100%"}}),children:"Learn more"})]})]});try{Pr.displayName="PortalHomePageHeader",Pr.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}try{Pr.displayName="PortalHomePageHeader",Pr.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}const Nd=({partner:e,imageColIndex:u,organizationNameColIndex:f,websiteColIndex:d,entityId:i,isLoading:c})=>{const t=e.values[u]??"",o=cs(t??"",i);if(!(!o&&!(e!=null&&e.values[f])))return c?j.jsx(ls,{variant:"rectangular",height:101,width:156}):j.jsx(Ar,{href:e.values[d]??"",target:"_blank",sx:{display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none !important"},children:o?j.jsx(us,{component:"img",image:o,"aria-hidden":"true",sx:{width:"156px",height:"101px",objectFit:"contain",borderRadius:"10px"}}):j.jsx(Ce,{sx:{display:"flex",width:"165px",padding:"3px",flexDirection:"column",gap:"10px",border:"2px solid",borderColor:"grey.900",backgroundColor:"#FFF",textAlign:"center"},children:j.jsx(Ce,{sx:{display:"flex",padding:"10px",justifyContent:"center",alignItems:"center",gap:"10px",border:"1px solid",borderColor:"grey.900"},children:j.jsx(Xe,{variant:"headline3",sx:{fontSize:"14px",fontWeight:400,lineHeight:"130%",color:"grey.900"},children:e==null?void 0:e.values[f??-1]})})})})},Xs=({sql:e,titleText:u="Our Partners"})=>{const f=du(e),d={partMask:cu|as,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:f,query:{sql:e}},{data:i,isLoading:c}=ou(d),t=(i==null?void 0:i.queryResult.queryResults.rows)??[];let o;(a=>{a.CARDLOGO="cardLogo",a.ORGANIZATION_NAME="organizationName",a.WEBSITE="website"})(o||(o={}));const s=ct("cardLogo",i),r=ct("organizationName",i),n=ct("website",i);return j.jsxs(Ce,{sx:{display:"grid",padding:{xs:"40px",lg:"20px 80px"},gridTemplateColumns:{xs:"1fr",md:"1fr 3fr"},gap:"50px"},children:[j.jsx(fu,{title:u,sx:{h2:{fontSize:"24px",paddingTop:"26px",width:"100%"}}}),j.jsx(Ce,{sx:a=>({display:"flex",flexWrap:"wrap",gap:"64px",flex:"1 1 0",[a.breakpoints.down("sm")]:{justifyContent:"center"}}),children:t==null?void 0:t.map((a,p)=>j.jsx(Nd,{partner:a,imageColIndex:s,organizationNameColIndex:r,websiteColIndex:n,entityId:f,isLoading:c},`partner-${p}`))})]})};try{Xs.displayName="PortalFeaturedPartners",Xs.__docgenInfo={description:"",displayName:"PortalFeaturedPartners",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},titleText:{defaultValue:{value:"Our Partners"},description:"",name:"titleText",required:!1,type:{name:"string"}}}}}catch{}function Zi(e){const{sourceEntityId:u,gridSessionId:f}=e,{mutate:d,isPending:i}=Sd({onSuccess:c=>{Ed(c)},onError:c=>{Et(c.message,"danger")}});return j.jsx(Gt,{loading:i,onClick:()=>{d({gridSessionId:f,sourceEntityId:u})},variant:"contained",children:"Update table with changes"})}function Ed(e){var u,f;if((u=e.results)!=null&&u.length){const d=e.results[0];if(qc(d)){const i=Td(d).join(`
`);i?Et(`Some changes could not be applied:
${i}`,"danger"):Et("Changes applied successfully","success")}else if(Dc(d)){const i=(f=d.rowsProcessed)==null?void 0:f.toLocaleString();Et(`Successfully updated ${i} rows.`,"success")}}}function Td(e){var u;return((u=e.updateResults)==null?void 0:u.filter(f=>!!f.failureCode).map(f=>`${f.entityId}: ${f.failureMessage} (code: ${f.failureCode})`))??[]}try{Zi.displayName="MergeGridWithSourceTableButton",Zi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}const bu="__rowKey",Id=e=>{const u=e.trim();if(u){if(u.toUpperCase().startsWith("SELECT"))return{type:"sql",input:u};if(Uc.test(u))return{type:"recordSetId",input:u};if(/^[A-Za-z]\w*=+$/.test(u))return{type:"sessionId",input:u}}else return{type:"empty",input:""};return{type:"unknown",input:u}};function kd(e,u){const f=Object.keys(e),d=Object.keys(u);if(f.length!==d.length)return!1;for(const i of f){const c=e[i],t=u[i],o=s=>s==null||s==="";if(!(o(c)&&o(t))&&String(c)!==String(t))return!1}return!0}function jd(e,u,f){function d(i){if(i.type==="UPDATE"){const c=u.slice(i.fromRowIndex,i.toRowIndex),t=e.slice(i.fromRowIndex,i.toRowIndex);return c.map((s,r)=>kd(s,t[r])).every(Boolean)}return!1}return f.filter(i=>!d(i))}function Vd(e){return`[${e.sid},${e.time}]`}function Ad(e){const u=new Map,f=/^#\/([^:]+):\s*(.*)$/;for(const d of e){if(typeof d!="string")continue;const c=d.trimStart().match(f);if(c){const t=c[1].trim(),o=c[2].trim();u.has(t)||u.set(t,[]),u.get(t).push(o)}}return u}function Pd(e,u){if(!e||!u)return[];const{columnNames:f,columnOrder:d,rows:i}=u;return i.map(t=>{var s,r;const o={};return d.forEach(n=>{const a=f[n];a&&(o[a]=t.data[n])}),o[bu]=Vd(e.api.obj(["rows",String(i.indexOf(t))]).node.id),o.__validationResults=(s=t.metadata)==null?void 0:s.rowValidation,(r=o.__validationResults)!=null&&r.allValidationMessages&&(o.__cellValidationResults=Ad(o.__validationResults.allValidationMessages)),o})}function Md(e){return It(e)&&"type"in e&&(e.type=="null"||ad(e.type,["null"]))}function yu(e){if(e!=null&&e.oneOf&&Wt(e.oneOf)){const u=e.oneOf.filter(f=>!Md(f));if(u.length==1&&It(u[0]))return u[0]}}function qd(e){return{value:e.value}}function Dd(e){return Wt(e)&&e.every(u=>It(u)&&"const"in u)}function Bd(e){let u=[];if(e!=null&&e.oneOf&&Wt(e.oneOf)&&!Dd(e.oneOf)){const f=yu(e);f&&Object.hasOwn(f,"enum")&&(u=Ds(f)||[])}else u=Ds(e)||[];return u.map(qd)}function Qs(e,u){return ld(e,[Qc,u],{})}function Ld(e){if(!e||!It(e))return[];const u=new Set,f=new Set;function d(i){if(!(!It(i)||f.has(i))){if(f.add(i),Wt(i.required))for(const c of i.required)typeof c=="string"&&u.add(c);["allOf"].forEach(c=>{const t=i[c];Wt(t)&&t.forEach(o=>d(o))})}}return d(e),Array.from(u)}function vu(e){if(e.type)return e.type;if(e!=null&&e.oneOf&&Wt(e.oneOf)){const u=yu(e);if(u)return vu(u)}}var si={},Ve={},oi={},Zs;function Fd(){return Zs||(Zs=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useColumnWidths=e.getColumnWidths=void 0;const u=fe(),f=(i,c)=>{const t=c.map(({basis:s,minWidth:r,maxWidth:n})=>({basis:s,minWidth:r,maxWidth:n,size:s,violation:0,frozen:!1,factor:0}));let o=t.reduce((s,r)=>s-r.size,i);o>0?c.forEach(({grow:s},r)=>{t[r].factor=s}):o<0&&c.forEach(({shrink:s},r)=>{t[r].factor=s});for(const s of t)s.factor===0&&(s.frozen=!0);for(;t.some(({frozen:s})=>!s);){const s=t.reduce((n,a)=>n+(a.frozen?0:a.factor),0);let r=0;for(const n of t)n.frozen||(n.size+=o*n.factor/s,n.size<n.minWidth?n.violation=n.minWidth-n.size:n.maxWidth!==void 0&&n.size>n.maxWidth?n.violation=n.maxWidth-n.size:n.violation=0,n.size+=n.violation,r+=n.violation);if(r>0)for(const n of t)n.violation>0&&(n.frozen=!0);else if(r<0)for(const n of t)n.violation<0&&(n.frozen=!0);else break;o=t.reduce((n,a)=>n-a.size,i)}return t.map(({size:s})=>s)};e.getColumnWidths=f;const d=(i,c)=>{const t=i.map(({basis:o,minWidth:s,maxWidth:r,grow:n,shrink:a})=>[o,s,r,n,a].join(",")).join("|");return(0,u.useMemo)(()=>{if(c===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const o=(0,e.getColumnWidths)(c,i);let s=0;const r=o.map((n,a)=>(s+=n,a===o.length-1?1/0:s));return{fullWidth:Math.abs(c-s)<.1,columnWidths:o,columnRights:r,totalWidth:s}},[c,t])};e.useColumnWidths=d}(oi)),oi}var es=function(e,u){return es=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,d){f.__proto__=d}||function(f,d){for(var i in d)Object.prototype.hasOwnProperty.call(d,i)&&(f[i]=d[i])},es(e,u)};function wu(e,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");es(e,u);function f(){this.constructor=e}e.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)}var zt=function(){return zt=Object.assign||function(u){for(var f,d=1,i=arguments.length;d<i;d++){f=arguments[d];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(u[c]=f[c])}return u},zt.apply(this,arguments)};function _u(e,u){var f={};for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&u.indexOf(d)<0&&(f[d]=e[d]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,d=Object.getOwnPropertySymbols(e);i<d.length;i++)u.indexOf(d[i])<0&&Object.prototype.propertyIsEnumerable.call(e,d[i])&&(f[d[i]]=e[d[i]]);return f}var Nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ee.global<"u"?Ee.global:typeof self<"u"?self:{};function Ud(e){var u=typeof e;return e!=null&&(u=="object"||u=="function")}var ds=Ud,$d=typeof Nr=="object"&&Nr&&Nr.Object===Object&&Nr,zd=$d,Gd=zd,Wd=typeof self=="object"&&self&&self.Object===Object&&self,Hd=Gd||Wd||Function("return this")(),Su=Hd,Jd=Su,Kd=function(){return Jd.Date.now()},Yd=Kd,Xd=/\s/;function Qd(e){for(var u=e.length;u--&&Xd.test(e.charAt(u)););return u}var Zd=Qd,ef=Zd,tf=/^\s+/;function nf(e){return e&&e.slice(0,ef(e)+1).replace(tf,"")}var rf=nf,sf=Su,of=sf.Symbol,xu=of,eo=xu,Cu=Object.prototype,af=Cu.hasOwnProperty,lf=Cu.toString,Qt=eo?eo.toStringTag:void 0;function uf(e){var u=af.call(e,Qt),f=e[Qt];try{e[Qt]=void 0;var d=!0}catch{}var i=lf.call(e);return d&&(u?e[Qt]=f:delete e[Qt]),i}var cf=uf,df=Object.prototype,ff=df.toString;function hf(e){return ff.call(e)}var pf=hf,to=xu,mf=cf,gf=pf,bf="[object Null]",yf="[object Undefined]",no=to?to.toStringTag:void 0;function vf(e){return e==null?e===void 0?yf:bf:no&&no in Object(e)?mf(e):gf(e)}var wf=vf;function _f(e){return e!=null&&typeof e=="object"}var Sf=_f,xf=wf,Cf=Sf,Of="[object Symbol]";function Rf(e){return typeof e=="symbol"||Cf(e)&&xf(e)==Of}var Nf=Rf,Ef=rf,ro=ds,Tf=Nf,io=NaN,If=/^[-+]0x[0-9a-f]+$/i,kf=/^0b[01]+$/i,jf=/^0o[0-7]+$/i,Vf=parseInt;function Af(e){if(typeof e=="number")return e;if(Tf(e))return io;if(ro(e)){var u=typeof e.valueOf=="function"?e.valueOf():e;e=ro(u)?u+"":u}if(typeof e!="string")return e===0?e:+e;e=Ef(e);var f=kf.test(e);return f||jf.test(e)?Vf(e.slice(2),f?2:8):If.test(e)?io:+e}var Pf=Af,Mf=ds,ai=Yd,so=Pf,qf="Expected a function",Df=Math.max,Bf=Math.min;function Lf(e,u,f){var d,i,c,t,o,s,r=0,n=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(qf);u=so(u)||0,Mf(f)&&(n=!!f.leading,a="maxWait"in f,c=a?Df(so(f.maxWait)||0,u):c,p="trailing"in f?!!f.trailing:p);function h(S){var C=d,O=i;return d=i=void 0,r=S,t=e.apply(O,C),t}function w(S){return r=S,o=setTimeout(l,u),n?h(S):t}function y(S){var C=S-s,O=S-r,x=u-C;return a?Bf(x,c-O):x}function b(S){var C=S-s,O=S-r;return s===void 0||C>=u||C<0||a&&O>=c}function l(){var S=ai();if(b(S))return m(S);o=setTimeout(l,y(S))}function m(S){return o=void 0,p&&d?h(S):(d=i=void 0,t)}function g(){o!==void 0&&clearTimeout(o),r=0,d=s=i=o=void 0}function v(){return o===void 0?t:m(ai())}function _(){var S=ai(),C=b(S);if(d=arguments,i=this,s=S,C){if(o===void 0)return w(s);if(a)return clearTimeout(o),o=setTimeout(l,u),h(s)}return o===void 0&&(o=setTimeout(l,u)),t}return _.cancel=g,_.flush=v,_}var Ou=Lf,Ff=Ou,Uf=ds,$f="Expected a function";function zf(e,u,f){var d=!0,i=!0;if(typeof e!="function")throw new TypeError($f);return Uf(f)&&(d="leading"in f?!!f.leading:d,i="trailing"in f?!!f.trailing:i),Ff(e,u,{leading:d,maxWait:u,trailing:i})}var Gf=zf,Ru=function(e,u,f,d){switch(u){case"debounce":return Ou(e,f,d);case"throttle":return Gf(e,f,d);default:return e}},ts=function(e){return typeof e=="function"},dt=function(){return typeof window>"u"},oo=function(e){return e instanceof Element||e instanceof HTMLDocument},Nu=function(e,u,f,d){return function(i){var c=i.width,t=i.height;u(function(o){return o.width===c&&o.height===t||o.width===c&&!d||o.height===t&&!f?o:(e&&ts(e)&&e(c,t),{width:c,height:t})})}},Eu=function(e){wu(u,e);function u(f){var d=e.call(this,f)||this;d.cancelHandler=function(){d.resizeHandler&&d.resizeHandler.cancel&&(d.resizeHandler.cancel(),d.resizeHandler=null)},d.attachObserver=function(){var r=d.props,n=r.targetRef,a=r.observerOptions;if(!dt()){n&&n.current&&(d.targetRef.current=n.current);var p=d.getElement();p&&(d.observableElement&&d.observableElement===p||(d.observableElement=p,d.resizeObserver.observe(p,a)))}},d.getElement=function(){var r=d.props,n=r.querySelector,a=r.targetDomEl;if(dt())return null;if(n)return document.querySelector(n);if(a&&oo(a))return a;if(d.targetRef&&oo(d.targetRef.current))return d.targetRef.current;var p=ud.findDOMNode(d);if(!p)return null;var h=d.getRenderType();switch(h){case"renderProp":return p;case"childFunction":return p;case"child":return p;case"childArray":return p;default:return p.parentElement}},d.createResizeHandler=function(r){var n=d.props,a=n.handleWidth,p=a===void 0?!0:a,h=n.handleHeight,w=h===void 0?!0:h,y=n.onResize;if(!(!p&&!w)){var b=Nu(y,d.setState.bind(d),p,w);r.forEach(function(l){var m=l&&l.contentRect||{},g=m.width,v=m.height,_=!d.skipOnMount&&!dt();_&&b({width:g,height:v}),d.skipOnMount=!1})}},d.getRenderType=function(){var r=d.props,n=r.render,a=r.children;return ts(n)?"renderProp":ts(a)?"childFunction":$.isValidElement(a)?"child":Array.isArray(a)?"childArray":"parent"};var i=f.skipOnMount,c=f.refreshMode,t=f.refreshRate,o=t===void 0?1e3:t,s=f.refreshOptions;return d.state={width:void 0,height:void 0},d.skipOnMount=i,d.targetRef=$.createRef(),d.observableElement=null,dt()||(d.resizeHandler=Ru(d.createResizeHandler,c,o,s),d.resizeObserver=new window.ResizeObserver(d.resizeHandler)),d}return u.prototype.componentDidMount=function(){this.attachObserver()},u.prototype.componentDidUpdate=function(){this.attachObserver()},u.prototype.componentWillUnmount=function(){dt()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},u.prototype.render=function(){var f=this.props,d=f.render,i=f.children,c=f.nodeType,t=c===void 0?"div":c,o=this.state,s=o.width,r=o.height,n={width:s,height:r,targetRef:this.targetRef},a=this.getRenderType(),p;switch(a){case"renderProp":return d&&d(n);case"childFunction":return p=i,p(n);case"child":if(p=i,p.type&&typeof p.type=="string"){n.targetRef;var h=_u(n,["targetRef"]);return $.cloneElement(p,h)}return $.cloneElement(p,n);case"childArray":return p=i,p.map(function(w){return!!w&&$.cloneElement(w,n)});default:return $.createElement(t,null)}},u}($.PureComponent);function Wf(e,u){u===void 0&&(u={});var f=function(c){wu(t,c);function t(){var o=c!==null&&c.apply(this,arguments)||this;return o.ref=$.createRef(),o}return t.prototype.render=function(){var o=this.props,s=o.forwardedRef,r=_u(o,["forwardedRef"]),n=s??this.ref;return $.createElement(Eu,zt({},u,{targetRef:n}),$.createElement(e,zt({targetRef:n},r)))},t}($.Component);function d(c,t){return $.createElement(f,zt({},c,{forwardedRef:t}))}var i=e.displayName||e.name;return d.displayName="withResizeDetector(".concat(i,")"),$.forwardRef(d)}var Hf=dt()?$.useEffect:$.useLayoutEffect;function Jf(e){e===void 0&&(e={});var u=e.skipOnMount,f=u===void 0?!1:u,d=e.refreshMode,i=e.refreshRate,c=i===void 0?1e3:i,t=e.refreshOptions,o=e.handleWidth,s=o===void 0?!0:o,r=e.handleHeight,n=r===void 0?!0:r,a=e.targetRef,p=e.observerOptions,h=e.onResize,w=$.useRef(f),y=$.useRef(null),b=a??y,l=$.useRef(),m=$.useState({width:void 0,height:void 0}),g=m[0],v=m[1];return Hf(function(){if(!dt()){var _=Nu(h,v,s,n),S=function(O){!s&&!n||O.forEach(function(x){var R=x&&x.contentRect||{},E=R.width,T=R.height,N=!w.current&&!dt();N&&_({width:E,height:T}),w.current=!1})};l.current=Ru(S,d,c,t);var C=new window.ResizeObserver(l.current);return b.current&&C.observe(b.current,p),function(){C.disconnect();var O=l.current;O&&O.cancel&&O.cancel()}}},[d,c,t,s,n,h,p,b.current]),zt({ref:b},g)}const Kf=Object.freeze(Object.defineProperty({__proto__:null,default:Eu,useResizeDetector:Jf,withResizeDetector:Wf},Symbol.toStringTag,{value:"Module"})),Yf=uu(Kf);var tt={},ao;function Xf(){return ao||(ao=1,function(e){var u=tt&&tt.__createBinding||(Object.create?function(w,y,b,l){l===void 0&&(l=b);var m=Object.getOwnPropertyDescriptor(y,b);(!m||("get"in m?!y.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return y[b]}}),Object.defineProperty(w,l,m)}:function(w,y,b,l){l===void 0&&(l=b),w[l]=y[b]}),f=tt&&tt.__setModuleDefault||(Object.create?function(w,y){Object.defineProperty(w,"default",{enumerable:!0,value:y})}:function(w,y){w.default=y}),d=tt&&tt.__importStar||function(w){if(w&&w.__esModule)return w;var y={};if(w!=null)for(var b in w)b!=="default"&&Object.prototype.hasOwnProperty.call(w,b)&&u(y,w,b);return f(y,w),y};Object.defineProperty(e,"__esModule",{value:!0}),e.useColumns=e.parseFlexValue=void 0;const i=d(fe()),c=()=>i.default.createElement(i.default.Fragment,null),t=()=>!1,o=({rowData:w})=>w,s=()=>null,r=({rowIndex:w})=>i.default.createElement(i.default.Fragment,null,w+1),n=()=>!0,a=w=>w,p=w=>{if(typeof w=="number")return{basis:0,grow:w,shrink:1};if(w.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(w.trim()),shrink:1};if(w.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(w.trim()),grow:1,shrink:1};if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[y,b]=w.trim().split(" ");return{basis:0,grow:parseFloat(y),shrink:parseFloat(b)}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,b]=w.trim().split(" ");return{basis:parseFloat(b),grow:parseFloat(y),shrink:1}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,b,l]=w.trim().split(" ");return{basis:parseFloat(l),grow:parseFloat(y),shrink:parseFloat(b)}}return{basis:0,grow:1,shrink:1}};e.parseFlexValue=p;const h=(w,y,b)=>(0,i.useMemo)(()=>{var l,m,g,v,_,S,C,O,x,R;const E=[y===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>i.default.createElement(i.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:n}:Object.assign(Object.assign({},y),{basis:(l=y==null?void 0:y.basis)!==null&&l!==void 0?l:40,grow:(m=y==null?void 0:y.grow)!==null&&m!==void 0?m:0,shrink:(g=y==null?void 0:y.shrink)!==null&&g!==void 0?g:0,minWidth:(v=y==null?void 0:y.minWidth)!==null&&v!==void 0?v:0,title:(_=y==null?void 0:y.title)!==null&&_!==void 0?_:i.default.createElement("div",{className:"dsg-corner-indicator"}),component:(S=y==null?void 0:y.component)!==null&&S!==void 0?S:r,isCellEmpty:n}),...w];return b&&E.push(Object.assign(Object.assign({},b),{basis:(C=b==null?void 0:b.basis)!==null&&C!==void 0?C:40,grow:(O=b==null?void 0:b.grow)!==null&&O!==void 0?O:0,shrink:(x=b==null?void 0:b.shrink)!==null&&x!==void 0?x:0,minWidth:(R=b.minWidth)!==null&&R!==void 0?R:0,isCellEmpty:n})),E.map(T=>{var N,M,A,q,P,z,U,Y,re,X,W,ge,we,Ye,be,ot;const at=T.width!==void 0?(0,e.parseFlexValue)(T.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},T),{basis:(M=(N=T.basis)!==null&&N!==void 0?N:at.basis)!==null&&M!==void 0?M:0,grow:(q=(A=T.grow)!==null&&A!==void 0?A:at.grow)!==null&&q!==void 0?q:1,shrink:(z=(P=T.shrink)!==null&&P!==void 0?P:at.shrink)!==null&&z!==void 0?z:1,minWidth:(U=T.minWidth)!==null&&U!==void 0?U:100,component:(Y=T.component)!==null&&Y!==void 0?Y:c,disableKeys:(re=T.disableKeys)!==null&&re!==void 0?re:!1,disabled:(X=T.disabled)!==null&&X!==void 0?X:!1,keepFocus:(W=T.keepFocus)!==null&&W!==void 0?W:!1,deleteValue:(ge=T.deleteValue)!==null&&ge!==void 0?ge:o,copyValue:(we=T.copyValue)!==null&&we!==void 0?we:s,pasteValue:(Ye=T.pasteValue)!==null&&Ye!==void 0?Ye:o,prePasteValues:(be=T.prePasteValues)!==null&&be!==void 0?be:a,isCellEmpty:(ot=T.isCellEmpty)!==null&&ot!==void 0?ot:t})})},[y,b,w]);e.useColumns=h}(tt)),tt}var Zt={},en={},lo;function fs(){if(lo)return en;lo=1,Object.defineProperty(en,"__esModule",{value:!0});function e(f,d,i,c){var t,o=!1,s=0;function r(){t&&clearTimeout(t)}function n(){r(),o=!0}typeof d!="boolean"&&(c=i,i=d,d=void 0);function a(){for(var p=arguments.length,h=new Array(p),w=0;w<p;w++)h[w]=arguments[w];var y=this,b=Date.now()-s;if(o)return;function l(){s=Date.now(),i.apply(y,h)}function m(){t=void 0}c&&!t&&l(),r(),c===void 0&&b>f?l():d!==!0&&(t=setTimeout(c?m:l,c===void 0?f-b:f))}return a.cancel=n,a}function u(f,d,i){return i===void 0?e(f,d,!1):e(f,i,d!==!1)}return en.debounce=u,en.throttle=e,en}var gt={},uo;function Tu(){if(uo)return gt;uo=1;var e=gt&&gt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(gt,"__esModule",{value:!0}),gt.useDeepEqualState=void 0;const u=fe(),f=e(lu()),d=i=>{const[c,t]=(0,u.useState)(i),o=(0,u.useCallback)(s=>{t(r=>{const n=typeof s=="function"?s(r):s;return(0,f.default)(n,r)?r:n})},[t]);return[c,o]};return gt.useDeepEqualState=d,gt}var co;function Qf(){if(co)return Zt;co=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.useEdges=void 0;const e=fe(),u=fs(),f=Tu(),d=(i,c,t)=>{const[o,s]=(0,f.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,e.useEffect)(()=>{const r=(0,u.throttle)(100,()=>{var a,p,h,w,y,b,l,m,g,v;s({top:((a=i.current)===null||a===void 0?void 0:a.scrollTop)===0,right:((h=(p=i.current)===null||p===void 0?void 0:p.scrollLeft)!==null&&h!==void 0?h:0)>=((y=(w=i.current)===null||w===void 0?void 0:w.scrollWidth)!==null&&y!==void 0?y:0)-(c??0)-1,bottom:((l=(b=i.current)===null||b===void 0?void 0:b.scrollTop)!==null&&l!==void 0?l:0)>=((g=(m=i.current)===null||m===void 0?void 0:m.scrollHeight)!==null&&g!==void 0?g:0)-(t??0)-1,left:((v=i.current)===null||v===void 0?void 0:v.scrollLeft)===0})}),n=i.current;return n==null||n.addEventListener("scroll",r),setTimeout(r,100),()=>{n==null||n.removeEventListener("scroll",r),r.cancel()}},[t,c,i,s]),o};return Zt.useEdges=d,Zt}var tn={},fo;function Iu(){if(fo)return tn;fo=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.useDocumentEventListener=void 0;const e=fe(),u=(f,d)=>{(0,e.useEffect)(()=>(document.addEventListener(f,d),()=>{document.removeEventListener(f,d)}),[d,f])};return tn.useDocumentEventListener=u,tn}var nn={},ho;function Zf(){if(ho)return nn;ho=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.useGetBoundingClientRect=void 0;const e=fe(),u=fs(),f=(d,i=200)=>{const c=(0,e.useRef)(null),t=(0,e.useMemo)(()=>(0,u.throttle)(i,!0,()=>{setTimeout(()=>{var o;return c.current=((o=d.current)===null||o===void 0?void 0:o.getBoundingClientRect())||null},0)}),[d,i]);return(0,e.useCallback)((o=!1)=>{var s;return o?c.current=((s=d.current)===null||s===void 0?void 0:s.getBoundingClientRect())||null:t(),c.current},[d,t])};return nn.useGetBoundingClientRect=f,nn}var nt={},po;function ku(){return po||(po=1,function(e){var u=nt&&nt.__createBinding||(Object.create?function(t,o,s,r){r===void 0&&(r=s);var n=Object.getOwnPropertyDescriptor(o,s);(!n||("get"in n?!o.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(t,r,n)}:function(t,o,s,r){r===void 0&&(r=s),t[r]=o[s]}),f=nt&&nt.__setModuleDefault||(Object.create?function(t,o){Object.defineProperty(t,"default",{enumerable:!0,value:o})}:function(t,o){t.default=o}),d=nt&&nt.__importStar||function(t){if(t&&t.__esModule)return t;var o={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&u(o,t,s);return f(o,t),o};Object.defineProperty(e,"__esModule",{value:!0}),e.AddRows=e.createAddRowsComponent=void 0;const i=d(fe()),c=(t={})=>({addRows:o})=>{var s,r;const[n,a]=(0,i.useState)(1),[p,h]=(0,i.useState)(String(n));return i.default.createElement("div",{className:"dsg-add-row"},i.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>o(n)},(s=t.button)!==null&&s!==void 0?s:"Add")," ",i.default.createElement("input",{className:"dsg-add-row-input",value:p,onBlur:()=>h(String(n)),type:"number",min:1,onChange:w=>{h(w.target.value),a(Math.max(1,Math.round(parseInt(w.target.value)||0)))},onKeyDown:w=>{w.key==="Enter"&&o(n)}})," ",(r=t.unit)!==null&&r!==void 0?r:"rows")};e.createAddRowsComponent=c,e.AddRows=(0,e.createAddRowsComponent)(),e.AddRows.displayName="AddRows"}(nt)),nt}var rn={},mo;function eh(){if(mo)return rn;mo=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.useDebounceState=void 0;const e=fe(),u=fs(),f=(d,i)=>{const[c,t]=(0,e.useState)(d),o=(0,e.useRef)();(0,e.useEffect)(()=>()=>{var r;return(r=o.current)===null||r===void 0?void 0:r.cancel()},[]);const s=(0,e.useMemo)(()=>o.current=(0,u.debounce)(i,r=>{t(r)}),[i]);return[c,s]};return rn.useDebounceState=f,rn}var rt={},go;function ju(){return go||(go=1,function(e){var u=rt&&rt.__createBinding||(Object.create?function(r,n,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(n,a);(!h||("get"in h?!n.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return n[a]}}),Object.defineProperty(r,p,h)}:function(r,n,a,p){p===void 0&&(p=a),r[p]=n[a]}),f=rt&&rt.__setModuleDefault||(Object.create?function(r,n){Object.defineProperty(r,"default",{enumerable:!0,value:n})}:function(r,n){r.default=n}),d=rt&&rt.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&u(n,r,a);return f(n,r),n};Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=e.createContextMenuComponent=e.defaultRenderItem=void 0;const i=d(fe()),c=fe(),t=Iu(),o=r=>r.type==="CUT"?i.createElement(i.Fragment,null,"Cut"):r.type==="COPY"?i.createElement(i.Fragment,null,"Copy"):r.type==="PASTE"?i.createElement(i.Fragment,null,"Paste"):r.type==="DELETE_ROW"?i.createElement(i.Fragment,null,"Delete row"):r.type==="DELETE_ROWS"?i.createElement(i.Fragment,null,"Delete rows ",i.createElement("b",null,r.fromRow)," to ",i.createElement("b",null,r.toRow)):r.type==="INSERT_ROW_BELLOW"?i.createElement(i.Fragment,null,"Insert row below"):r.type==="DUPLICATE_ROW"?i.createElement(i.Fragment,null,"Duplicate row"):r.type==="DUPLICATE_ROWS"?i.createElement(i.Fragment,null,"Duplicate rows ",i.createElement("b",null,r.fromRow)," to ",i.createElement("b",null,r.toRow)):r.type;e.defaultRenderItem=o;const s=(r=e.defaultRenderItem)=>({clientX:n,clientY:a,items:p,close:h})=>{const w=(0,c.useRef)(null),y=(0,c.useCallback)(b=>{var l;((l=w.current)===null||l===void 0?void 0:l.contains(b.target))||h()},[h]);return(0,t.useDocumentEventListener)("mousedown",y),i.createElement("div",{className:"dsg-context-menu",style:{left:n+"px",top:a+"px"},ref:w},p.map(b=>i.createElement("div",{key:b.type,onClick:b.action,className:"dsg-context-menu-item"},r(b))))};e.createContextMenuComponent=s,e.ContextMenu=(0,e.createContextMenuComponent)(e.defaultRenderItem),e.ContextMenu.displayName="ContextMenu"}(rt)),rt}var ze={},sn={},bo;function th(){if(bo)return sn;bo=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.parseDom=void 0;const e=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},u=f=>e.parseFromString(f,"text/html");return sn.parseDom=u,sn}var yo;function nh(){if(yo)return ze;yo=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.isPrintableUnicode=ze.encodeHtml=ze.parseTextPlainData=ze.parseTextHtmlData=void 0;const e=th(),u=c=>{var t,o;const s=(0,e.parseDom)(c.replace(/<br\/?>/g,`
`)),r=s.getElementsByTagName("table")[0];if(r){const a=[];for(let p=0;p<r.rows.length;p++){const h=[];a.push(h);for(let w=0;w<r.rows[p].cells.length;w++)h.push((t=r.rows[p].cells[w].textContent)!==null&&t!==void 0?t:"")}return a}const n=s.getElementsByTagName("span")[0];return n?[[(o=n.textContent)!==null&&o!==void 0?o:""]]:[[""]]};ze.parseTextHtmlData=u;const f=c=>{const t=c.replace(/\r|\n$/g,""),o=[[]];let s=0,r=0,n=!1,a=0;const p=()=>{let h=t.slice(r,s);h[0]==='"'&&h[h.length-1]==='"'&&(n=!0),n&&h[h.length-1]==='"'&&h.includes(`
`)&&(h=h.slice(1,h.length-1).replace(/""/g,'"'),n=!1),n&&h[h.length-1]!=='"'?h.split(`
`).forEach((w,y,{length:b})=>{o[a].push(w),y<b-1&&(o.push([]),a++)}):o[a].push(h)};for(;s<t.length;)n&&t[s]==='"'&&![void 0,"	",'"'].includes(t[s+1])&&(n=!1),n&&t[s]==='"'&&t[s+1]==='"'&&s++,s===r&&t[s]==='"'&&(n=!0),t[s]==="	"&&(p(),r=s+1,n=!1),t[s]===`
`&&!n&&(p(),o.push([]),r=s+1,a++),s++;return p(),o};ze.parseTextPlainData=f;const d=c=>c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");ze.encodeHtml=d;const i=c=>c.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return ze.isPrintableUnicode=i,ze}var li={},vo;function rh(){return vo||(vo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSelectionWithId=e.getSelection=e.getCellWithId=e.getCell=void 0;const u=(c,t,o,s)=>{if(c===null||!t||!o)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const r=s.findIndex(a=>a.id===c.col),n={col:Math.max(0,Math.min(t-1,r===-1?Number(c.col):r-1)),row:Math.max(0,Math.min(o-1,Number(c.row)))};if(isNaN(n.col)||isNaN(n.row))throw new Error("col or cell are not valid positive numbers");return n};e.getCell=u;const f=(c,t)=>{var o;return c?{col:c.col,row:c.row,colId:(o=t[c.col+1])===null||o===void 0?void 0:o.id}:null};e.getCellWithId=f;const d=(c,t,o,s)=>{if(c===null||!t||!o)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const r={min:(0,e.getCell)(c.min,t,o,s),max:(0,e.getCell)(c.max,t,o,s)};if(!r.min||!r.max)throw new Error("min and max must be defined");return r};e.getSelection=d;const i=(c,t)=>c?{min:(0,e.getCellWithId)(c.min,t),max:(0,e.getCellWithId)(c.max,t)}:null;e.getSelectionWithId=i}(li)),li}var on={},wo;function ih(){if(wo)return on;wo=1,Object.defineProperty(on,"__esModule",{value:!0}),on.getAllTabbableElements=void 0;const e=()=>Array.from(document.querySelectorAll("*")).filter(u=>u instanceof HTMLElement&&typeof u.tabIndex=="number"&&u.tabIndex>=0&&!u.disabled&&(!(u instanceof HTMLAnchorElement)||!!u.href||u.getAttribute("tabIndex")!==null)&&getComputedStyle(u).visibility!=="collapse");return on.getAllTabbableElements=e,on}var Ae={},ui={},ci={},di={},_o;function sh(){return _o||(_o=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function u(c,t,o){let s=o.initialDeps??[],r;function n(){var a,p,h,w;let y;o.key&&((a=o.debug)!=null&&a.call(o))&&(y=Date.now());const b=c();if(!(b.length!==s.length||b.some((g,v)=>s[v]!==g)))return r;s=b;let m;if(o.key&&((p=o.debug)!=null&&p.call(o))&&(m=Date.now()),r=t(...b),o.key&&((h=o.debug)!=null&&h.call(o))){const g=Math.round((Date.now()-y)*100)/100,v=Math.round((Date.now()-m)*100)/100,_=v/16,S=(C,O)=>{for(C=String(C);C.length<O;)C=" "+C;return C};console.info(`%câ± ${S(v,5)} /${S(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*_,120))}deg 100% 31%);`,o==null?void 0:o.key)}return(w=o==null?void 0:o.onChange)==null||w.call(o,r),r}return n.updateDeps=a=>{s=a},n}function f(c,t){if(c===void 0)throw new Error(`Unexpected undefined${t?`: ${t}`:""}`);return c}const d=(c,t)=>Math.abs(c-t)<=1,i=(c,t,o)=>{let s;return function(...r){c.clearTimeout(s),s=c.setTimeout(()=>t.apply(this,r),o)}};e.approxEqual=d,e.debounce=i,e.memo=u,e.notUndefined=f}(di)),di}var So;function oh(){return So||(So=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const u=sh(),f=l=>{const{offsetWidth:m,offsetHeight:g}=l;return{width:m,height:g}},d=l=>l,i=l=>{const m=Math.max(l.startIndex-l.overscan,0),g=Math.min(l.endIndex+l.overscan,l.count-1),v=[];for(let _=m;_<=g;_++)v.push(_);return v},c=(l,m)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;const _=C=>{const{width:O,height:x}=C;m({width:Math.round(O),height:Math.round(x)})};if(_(f(g)),!v.ResizeObserver)return()=>{};const S=new v.ResizeObserver(C=>{const O=()=>{const x=C[0];if(x!=null&&x.borderBoxSize){const R=x.borderBoxSize[0];if(R){_({width:R.inlineSize,height:R.blockSize});return}}_(f(g))};l.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(O):O()});return S.observe(g,{box:"border-box"}),()=>{S.unobserve(g)}},t={passive:!0},o=(l,m)=>{const g=l.scrollElement;if(!g)return;const v=()=>{m({width:g.innerWidth,height:g.innerHeight})};return v(),g.addEventListener("resize",v,t),()=>{g.removeEventListener("resize",v)}},s=typeof window>"u"?!0:"onscrollend"in window,r=(l,m)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&s?()=>{}:u.debounce(v,()=>{m(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{const{horizontal:T,isRtl:N}=l.options;_=T?g.scrollLeft*(N&&-1||1):g.scrollTop,S(),m(_,E)},O=C(!0),x=C(!1);x(),g.addEventListener("scroll",O,t);const R=l.options.useScrollendEvent&&s;return R&&g.addEventListener("scrollend",x,t),()=>{g.removeEventListener("scroll",O),R&&g.removeEventListener("scrollend",x)}},n=(l,m)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&s?()=>{}:u.debounce(v,()=>{m(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{_=g[l.options.horizontal?"scrollX":"scrollY"],S(),m(_,E)},O=C(!0),x=C(!1);x(),g.addEventListener("scroll",O,t);const R=l.options.useScrollendEvent&&s;return R&&g.addEventListener("scrollend",x,t),()=>{g.removeEventListener("scroll",O),R&&g.removeEventListener("scrollend",x)}},a=(l,m,g)=>{if(m!=null&&m.borderBoxSize){const v=m.borderBoxSize[0];if(v)return Math.round(v[g.options.horizontal?"inlineSize":"blockSize"])}return l[g.options.horizontal?"offsetWidth":"offsetHeight"]},p=(l,{adjustments:m=0,behavior:g},v)=>{var _,S;const C=l+m;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:g})},h=(l,{adjustments:m=0,behavior:g},v)=>{var _,S;const C=l+m;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:g})};class w{constructor(m){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let g=null;const v=()=>g||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:g=new this.targetWindow.ResizeObserver(_=>{_.forEach(S=>{const C=()=>{this._measureElement(S.target,S)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(C):C()})}));return{disconnect:()=>{var _;(_=v())==null||_.disconnect(),g=null},observe:_=>{var S;return(S=v())==null?void 0:S.observe(_,{box:"border-box"})},unobserve:_=>{var S;return(S=v())==null?void 0:S.unobserve(_)}}})(),this.range=null,this.setOptions=g=>{Object.entries(g).forEach(([v,_])=>{typeof _>"u"&&delete g[v]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:d,rangeExtractor:i,onChange:()=>{},measureElement:a,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...g}},this.notify=g=>{var v,_;(_=(v=this.options).onChange)==null||_.call(v,this,g)},this.maybeNotify=u.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),g=>{this.notify(g)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(g=>g()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var g;const v=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==v){if(this.cleanup(),!v){this.maybeNotify();return}this.scrollElement=v,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((g=this.scrollElement)==null?void 0:g.window)??null,this.elementsCache.forEach(_=>{this.observer.observe(_)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,_=>{this.scrollRect=_,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(_,S)=>{this.scrollAdjustments=0,this.scrollDirection=S?this.getScrollOffset()<_?"forward":"backward":null,this.scrollOffset=_,this.isScrolling=S,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(g,v)=>{const _=new Map,S=new Map;for(let C=v-1;C>=0;C--){const O=g[C];if(_.has(O.lane))continue;const x=S.get(O.lane);if(x==null||O.end>x.end?S.set(O.lane,O):O.end<x.end&&_.set(O.lane,!0),_.size===this.options.lanes)break}return S.size===this.options.lanes?Array.from(S.values()).sort((C,O)=>C.end===O.end?C.index-O.index:C.end-O.end)[0]:void 0},this.getMeasurementOptions=u.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(g,v,_,S,C)=>(this.pendingMeasuredCacheIndexes=[],{count:g,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C}),{key:!1}),this.getMeasurements=u.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:g,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C},O)=>{if(!C)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(E=>{this.itemSizeCache.set(E.key,E.size)}));const x=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const R=this.measurementsCache.slice(0,x);for(let E=x;E<g;E++){const T=S(E),N=this.options.lanes===1?R[E-1]:this.getFurthestMeasurement(R,E),M=N?N.end+this.options.gap:v+_,A=O.get(T),q=typeof A=="number"?A:this.options.estimateSize(E),P=M+q,z=N?N.lane:E%this.options.lanes;R[E]={index:E,start:M,size:q,end:P,key:T,lane:z}}return this.measurementsCache=R,R},{key:!1,debug:()=>this.options.debug}),this.calculateRange=u.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(g,v,_,S)=>this.range=g.length>0&&v>0?b({measurements:g,outerSize:v,scrollOffset:_,lanes:S}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=u.memo(()=>{let g=null,v=null;const _=this.calculateRange();return _&&(g=_.startIndex,v=_.endIndex),this.maybeNotify.updateDeps([this.isScrolling,g,v]),[this.options.rangeExtractor,this.options.overscan,this.options.count,g,v]},(g,v,_,S,C)=>S===null||C===null?[]:g({startIndex:S,endIndex:C,overscan:v,count:_}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=g=>{const v=this.options.indexAttribute,_=g.getAttribute(v);return _?parseInt(_,10):(console.warn(`Missing attribute name '${v}={index}' on measured element.`),-1)},this._measureElement=(g,v)=>{const _=this.indexFromElement(g),S=this.measurementsCache[_];if(!S)return;const C=S.key,O=this.elementsCache.get(C);O!==g&&(O&&this.observer.unobserve(O),this.observer.observe(g),this.elementsCache.set(C,g)),g.isConnected&&this.resizeItem(_,this.options.measureElement(g,v,this))},this.resizeItem=(g,v)=>{const _=this.measurementsCache[g];if(!_)return;const S=this.itemSizeCache.get(_.key)??_.size,C=v-S;C!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(_,C,this):_.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=C,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(_.index),this.itemSizeCache=new Map(this.itemSizeCache.set(_.key,v)),this.notify(!1))},this.measureElement=g=>{if(!g){this.elementsCache.forEach((v,_)=>{v.isConnected||(this.observer.unobserve(v),this.elementsCache.delete(_))});return}this._measureElement(g,void 0)},this.getVirtualItems=u.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(g,v)=>{const _=[];for(let S=0,C=g.length;S<C;S++){const O=g[S],x=v[O];_.push(x)}return _},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=g=>{const v=this.getMeasurements();if(v.length!==0)return u.notUndefined(v[y(0,v.length-1,_=>u.notUndefined(v[_]).start,g)])},this.getOffsetForAlignment=(g,v,_=0)=>{const S=this.getSize(),C=this.getScrollOffset();v==="auto"&&(v=g>=C+S?"end":"start"),v==="center"?g+=(_-S)/2:v==="end"&&(g-=S);const O=this.getTotalSize()-S;return Math.max(Math.min(O,g),0)},this.getOffsetForIndex=(g,v="auto")=>{g=Math.max(0,Math.min(g,this.options.count-1));const _=this.measurementsCache[g];if(!_)return;const S=this.getSize(),C=this.getScrollOffset();if(v==="auto")if(_.end>=C+S-this.options.scrollPaddingEnd)v="end";else if(_.start<=C+this.options.scrollPaddingStart)v="start";else return[C,v];const O=v==="end"?_.end+this.options.scrollPaddingEnd:_.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(O,v,_.size),v]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(g,{align:v="start",behavior:_}={})=>{this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(g,v),{adjustments:void 0,behavior:_})},this.scrollToIndex=(g,{align:v="auto",behavior:_}={})=>{g=Math.max(0,Math.min(g,this.options.count-1)),this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const S=this.getOffsetForIndex(g,v);if(!S)return;const[C,O]=S;this._scrollToOffset(C,{adjustments:void 0,behavior:_}),_!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(g))){const[R]=u.notUndefined(this.getOffsetForIndex(g,O)),E=this.getScrollOffset();u.approxEqual(R,E)||this.scrollToIndex(g,{align:O,behavior:_})}else this.scrollToIndex(g,{align:O,behavior:_})}))},this.scrollBy=(g,{behavior:v}={})=>{this.cancelScrollToIndex(),v==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+g,{adjustments:void 0,behavior:v})},this.getTotalSize=()=>{var g;const v=this.getMeasurements();let _;if(v.length===0)_=this.options.paddingStart;else if(this.options.lanes===1)_=((g=v[v.length-1])==null?void 0:g.end)??0;else{const S=Array(this.options.lanes).fill(null);let C=v.length-1;for(;C>=0&&S.some(O=>O===null);){const O=v[C];S[O.lane]===null&&(S[O.lane]=O.end),C--}_=Math.max(...S.filter(O=>O!==null))}return Math.max(_-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(g,{adjustments:v,behavior:_})=>{this.options.scrollToFn(g,{behavior:_,adjustments:v},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(m)}}const y=(l,m,g,v)=>{for(;l<=m;){const _=(l+m)/2|0,S=g(_);if(S<v)l=_+1;else if(S>v)m=_-1;else return _}return l>0?l-1:0};function b({measurements:l,outerSize:m,scrollOffset:g,lanes:v}){const _=l.length-1,S=x=>l[x].start;if(l.length<=v)return{startIndex:0,endIndex:_};let C=y(0,_,S,g),O=C;if(v===1)for(;O<_&&l[O].end<g+m;)O++;else if(v>1){const x=Array(v).fill(0);for(;O<_&&x.some(E=>E<g+m);){const E=l[O];x[E.lane]=E.end,O++}const R=Array(v).fill(g+m);for(;C>=0&&R.some(E=>E>=g);){const E=l[C];R[E.lane]=E.start,C--}C=Math.max(0,C-C%v),O=Math.min(_,O+(v-1-O%v))}return{startIndex:C,endIndex:O}}e.approxEqual=u.approxEqual,e.debounce=u.debounce,e.memo=u.memo,e.notUndefined=u.notUndefined,e.Virtualizer=w,e.defaultKeyExtractor=d,e.defaultRangeExtractor=i,e.elementScroll=h,e.measureElement=a,e.observeElementOffset=r,e.observeElementRect=c,e.observeWindowOffset=n,e.observeWindowRect=o,e.windowScroll=p}(ci)),ci}var xo;function ah(){return xo||(xo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const u=fe(),f=cd(),d=oh();function i(n){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const p in n)if(p!=="default"){const h=Object.getOwnPropertyDescriptor(n,p);Object.defineProperty(a,p,h.get?h:{enumerable:!0,get:()=>n[p]})}}return a.default=n,Object.freeze(a)}const c=i(u),t=typeof document<"u"?c.useLayoutEffect:c.useEffect;function o(n){const a=c.useReducer(()=>({}),{})[1],p={...n,onChange:(w,y)=>{var b;y?f.flushSync(a):a(),(b=n.onChange)==null||b.call(n,w,y)}},[h]=c.useState(()=>new d.Virtualizer(p));return h.setOptions(p),t(()=>h._didMount(),[]),t(()=>h._willUpdate()),h}function s(n){return o({observeElementRect:d.observeElementRect,observeElementOffset:d.observeElementOffset,scrollToFn:d.elementScroll,...n})}function r(n){return o({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:d.observeWindowRect,observeElementOffset:d.observeWindowOffset,scrollToFn:d.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...n})}e.useVirtualizer=s,e.useWindowVirtualizer=r,Object.keys(d).forEach(n=>{n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:()=>d[n]})})}(ui)),ui}var bt={},Co;function lh(){if(Co)return bt;Co=1;var e=bt&&bt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bt,"__esModule",{value:!0}),bt.Cell=void 0;const u=e(fe()),f=e(Ht()),d=({children:i,gutter:c,stickyRight:t,active:o,disabled:s,className:r,width:n,left:a})=>u.default.createElement("div",{className:(0,f.default)("dsg-cell",c&&"dsg-cell-gutter",s&&"dsg-cell-disabled",c&&o&&"dsg-cell-gutter-active",t&&"dsg-cell-sticky-right",r),style:{width:n,left:t?void 0:a}},i);return bt.Cell=d,bt}var an={},Oo;function uh(){if(Oo)return an;Oo=1,Object.defineProperty(an,"__esModule",{value:!0}),an.useMemoizedIndexCallback=void 0;const e=fe(),u=(f,d)=>(0,e.useMemo)(()=>{const i=new Map;return c=>(i.has(c)||i.set(c,(...t)=>{f(c,...t.slice(0,d))}),i.get(c))},[d,f]);return an.useMemoizedIndexCallback=u,an}var Ro;function ch(){if(Ro)return Ae;Ro=1;var e=Ae&&Ae.__createBinding||(Object.create?function(n,a,p,h){h===void 0&&(h=p);var w=Object.getOwnPropertyDescriptor(a,p);(!w||("get"in w?!a.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return a[p]}}),Object.defineProperty(n,h,w)}:function(n,a,p,h){h===void 0&&(h=p),n[h]=a[p]}),u=Ae&&Ae.__setModuleDefault||(Object.create?function(n,a){Object.defineProperty(n,"default",{enumerable:!0,value:a})}:function(n,a){n.default=a}),f=Ae&&Ae.__importStar||function(n){if(n&&n.__esModule)return n;var a={};if(n!=null)for(var p in n)p!=="default"&&Object.prototype.hasOwnProperty.call(n,p)&&e(a,n,p);return u(a,n),a},d=Ae&&Ae.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Grid=void 0;const i=ah(),c=f(fe()),t=d(Ht()),o=lh(),s=uh(),r=({data:n,columns:a,outerRef:p,innerRef:h,columnWidths:w,hasStickyRightColumn:y,displayHeight:b,headerRowHeight:l,rowHeight:m,rowKey:g,fullWidth:v,selection:_,activeCell:S,rowClassName:C,cellClassName:O,children:x,editing:R,getContextMenuItems:E,setRowData:T,deleteRows:N,duplicateRows:M,insertRowAfter:A,stopEditing:q,onScroll:P})=>{var z,U,Y,re;const X=(0,i.useVirtualizer)({count:n.length,getScrollElement:()=>p.current,paddingStart:l,estimateSize:J=>m(J).height,getItemKey:J=>{if(g&&J>0){const he=n[J-1];if(typeof g=="function")return g({rowData:he,rowIndex:J});if(typeof g=="string"&&he instanceof Object&&g in he){const pe=he[g];if(typeof pe=="string"||typeof pe=="number")return pe}}return J},overscan:5}),W=(0,i.useVirtualizer)({count:a.length,getScrollElement:()=>p.current,estimateSize:J=>{var he;return(he=w==null?void 0:w[J])!==null&&he!==void 0?he:100},horizontal:!0,getItemKey:J=>{var he;return(he=a[J].id)!==null&&he!==void 0?he:J},overscan:1,rangeExtractor:J=>{const he=(0,i.defaultRangeExtractor)(J);return he[0]!==0&&he.unshift(0),y&&he[he.length-1]!==a.length-1&&he.push(a.length-1),he}});(0,c.useEffect)(()=>{W.measure()},[W,w]);const ge=(0,s.useMemoizedIndexCallback)(T,1),we=(0,s.useMemoizedIndexCallback)(N,0),Ye=(0,s.useMemoizedIndexCallback)(M,0),be=(0,s.useMemoizedIndexCallback)(A,0),ot=(z=_==null?void 0:_.min.col)!==null&&z!==void 0?z:S==null?void 0:S.col,at=(U=_==null?void 0:_.max.col)!==null&&U!==void 0?U:S==null?void 0:S.col,kt=(Y=_==null?void 0:_.min.row)!==null&&Y!==void 0?Y:S==null?void 0:S.row,Kt=(re=_==null?void 0:_.max.row)!==null&&re!==void 0?re:S==null?void 0:S.row;return c.default.createElement("div",{ref:p,className:"dsg-container",onScroll:P,style:{height:b}},c.default.createElement("div",{ref:h,style:{width:v?"100%":W.getTotalSize(),height:X.getTotalSize()}},l>0&&c.default.createElement("div",{className:(0,t.default)("dsg-row","dsg-row-header"),style:{width:v?"100%":W.getTotalSize(),height:l}},W.getVirtualItems().map(J=>c.default.createElement(o.Cell,{key:J.key,gutter:J.index===0,stickyRight:y&&J.index===a.length-1,width:J.size,left:J.start,className:(0,t.default)("dsg-cell-header",ot!==void 0&&at!==void 0&&ot<=J.index-1&&at>=J.index-1&&"dsg-cell-header-active",a[J.index].headerClassName)},c.default.createElement("div",{className:"dsg-cell-header-container"},a[J.index].title)))),X.getVirtualItems().map(J=>{const he=J.index>=(kt??1/0)&&J.index<=(Kt??-1/0);return c.default.createElement("div",{key:J.key,className:(0,t.default)("dsg-row",typeof C=="string"?C:null,typeof C=="function"?C({rowData:n[J.index],rowIndex:J.index}):null),style:{height:J.size,top:J.start,width:v?"100%":W.getTotalSize()}},W.getVirtualItems().map(pe=>{const jt=a[pe.index].cellClassName,Vt=a[pe.index].disabled,Wr=a[pe.index].component,xr=Vt===!0||typeof Vt=="function"&&Vt({rowData:n[J.index],rowIndex:J.index}),Cr=(S==null?void 0:S.row)===J.index&&S.col===pe.index-1;return c.default.createElement(o.Cell,{key:pe.key,gutter:pe.index===0,stickyRight:y&&pe.index===a.length-1,active:pe.index===0&&he,disabled:xr,className:(0,t.default)(typeof jt=="function"?jt({rowData:n[J.index],rowIndex:J.index,columnId:a[pe.index].id}):jt,typeof O=="function"?O({rowData:n[J.index],rowIndex:J.index,columnId:a[pe.index].id}):O),width:pe.size,left:pe.start},c.default.createElement(Wr,{rowData:n[J.index],getContextMenuItems:E,disabled:xr,active:Cr,columnIndex:pe.index-1,rowIndex:J.index,focus:Cr&&R,deleteRow:we(J.index),duplicateRow:Ye(J.index),stopEditing:q,insertRowBelow:be(J.index),setRowData:ge(J.index),columnData:a[pe.index].columnData}))}))}),x))};return Ae.Grid=r,Ae}var Ge={},No;function dh(){return No||(No=1,function(e){var u=Ge&&Ge.__createBinding||(Object.create?function(r,n,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(n,a);(!h||("get"in h?!n.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return n[a]}}),Object.defineProperty(r,p,h)}:function(r,n,a,p){p===void 0&&(p=a),r[p]=n[a]}),f=Ge&&Ge.__setModuleDefault||(Object.create?function(r,n){Object.defineProperty(r,"default",{enumerable:!0,value:n})}:function(r,n){r.default=n}),d=Ge&&Ge.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&u(n,r,a);return f(n,r),n},i=Ge&&Ge.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRect=void 0;const c=d(fe()),t=i(Ht()),o=(r,n,a,p)=>[[p,r],[n,r],[n,a],[p,a],[p,r]],s=(r,n,a,p)=>`polygon(evenodd, ${[...o(0,"100%","100%",0),...o(r,n,a,p)].map(w=>w.map(y=>typeof y=="number"&&y!==0?y+"px":y).join(" ")).join(",")})`;e.SelectionRect=c.default.memo(({columnWidths:r,columnRights:n,headerRowHeight:a,selection:p,rowHeight:h,activeCell:w,hasStickyRightColumn:y,dataLength:b,viewWidth:l,viewHeight:m,contentWidth:g,edges:v,isCellDisabled:_,editing:S,expandSelection:C})=>{var O,x,R,E;const T=w?_(w):!1,N=(0,c.useMemo)(()=>{if(!p)return T;for(let X=p.min.col;X<=p.max.col;++X)for(let W=p.min.row;W<=p.max.row;++W)if(!_({col:X,row:W}))return!1;return!0},[T,_,p]);if(!r||!n)return null;const M=X=>X<b-1?1:0,A=X=>X<r.length-(y?3:2)?1:0,q=w&&{width:r[w.col+1]+A(w.col),height:h(w.row).height+M(w.row),left:n[w.col],top:h(w.row).top+a},P=p&&{width:r.slice(p.min.col+1,p.max.col+2).reduce((X,W)=>X+W)+A(p.max.col),height:h(p.max.row).top+h(p.max.row).height-h(p.min.row).top+M(p.max.row),left:n[p.min.col],top:h(p.min.row).top+a},z=(p==null?void 0:p.min)||w,U=(p==null?void 0:p.max)||w,Y=U&&C!==null&&{left:n[U.col]+r[U.col+1],top:h(U.row).top+h(U.row).height+a,transform:`translate(-${U.col<r.length-(y?3:2)?50:100}%, -${U.row<b-1?50:100}%)`},re=z&&U&&C!==null&&{width:r.slice(z.col+1,U.col+2).reduce((X,W)=>X+W)+A(U.col),height:h(U.row+C).top+h(U.row+C).height-h(U.row+1).top+M(U.row+C)-1,left:n[z.col],top:h(U.row).top+h(U.row).height+a+1};return c.default.createElement(c.default.Fragment,null,c.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:h(b-1).top+h(b-1).height+a,width:g||"100%"}},c.default.createElement("div",{className:(0,t.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!v.top,"dsg-scrollable-view-r":!v.right,"dsg-scrollable-view-b":!v.bottom,"dsg-scrollable-view-l":!v.left}),style:{top:a,left:r[0],height:m?m-a:0,width:g&&l?l-r[0]-(y?r[r.length-1]:0):`calc(100% - ${r[0]+(y?r[r.length-1]:0)}px)`}})),(P||q)&&c.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(O=P==null?void 0:P.left)!==null&&O!==void 0?O:q==null?void 0:q.left,width:(x=P==null?void 0:P.width)!==null&&x!==void 0?x:q==null?void 0:q.width,height:h(b-1).top+h(b-1).height+a}},c.default.createElement("div",{className:(0,t.default)("dsg-selection-col-marker",N&&"dsg-selection-col-marker-disabled"),style:{top:a}})),(P||q)&&c.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(R=P==null?void 0:P.top)!==null&&R!==void 0?R:q==null?void 0:q.top,height:(E=P==null?void 0:P.height)!==null&&E!==void 0?E:q==null?void 0:q.height,width:g||"100%"}},c.default.createElement("div",{className:(0,t.default)("dsg-selection-row-marker",N&&"dsg-selection-row-marker-disabled"),style:{left:r[0]}})),q&&w&&c.default.createElement("div",{className:(0,t.default)("dsg-active-cell",{"dsg-active-cell-focus":S,"dsg-active-cell-disabled":T}),style:q}),P&&q&&c.default.createElement("div",{className:(0,t.default)("dsg-selection-rect",N&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},P),{clipPath:s(q.top-P.top,q.left-P.left,q.top+q.height-P.top,q.left+q.width-P.left)})}),re&&c.default.createElement("div",{className:(0,t.default)("dsg-expand-rows-rect"),style:re}),Y&&c.default.createElement("div",{className:(0,t.default)("dsg-expand-rows-indicator",N&&"dsg-expand-rows-indicator-disabled"),style:Y}))}),e.SelectionRect.displayName="SelectionRect"}(Ge)),Ge}var ln={},Eo;function fh(){if(Eo)return ln;Eo=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.useRowHeights=void 0;const e=fe(),u=({value:f,rowHeight:d})=>{const i=(0,e.useRef)([]),[,c]=(0,e.useState)(0);return(0,e.useMemo)(()=>{const t=o=>{if(typeof d=="number")return Math.min(f.length-1,Math.max(-1,Math.floor(o/d)));let s=0,r=i.current.length-1;for(;s<=r;){const n=Math.floor((s+r)/2);if(i.current[n].top<o)s=n+1;else if(i.current[n].top>o)r=n-1;else return n}if(r===i.current.length-1&&f.length>i.current.length&&(!i.current.length||o>=i.current[r].top+i.current[r].height)){let n=r===-1?0:i.current[r].top+i.current[r].height;do{r++;const a=d({rowIndex:r,rowData:f[r]});i.current.push({height:a,top:n}),n+=a}while(n<=o&&r<i.current.length-1)}return r};return{resetAfter:o=>{i.current=i.current.slice(0,o),c(s=>s+1)},getRowSize:o=>{if(typeof d=="number")return{height:d,top:d*o};if(o>=f.length)return{height:0,top:0};if(o<i.current.length)return i.current[o];let s=i.current[i.current.length-1].top+i.current[i.current.length-1].height;for(let r=i.current.length;r<=o;r++){const n=d({rowIndex:r,rowData:f[r]});i.current.push({height:n,top:s}),s+=n}return i.current[o]},getRowIndex:t,totalSize:o=>{if(typeof d=="number")return f.length*d;const s=t(o);return i.current[s].top+i.current[s].height}}},[d,f])};return ln.useRowHeights=u,ln}var To;function Vu(){return To||(To=1,function(e){var u=Ve&&Ve.__createBinding||(Object.create?function(N,M,A,q){q===void 0&&(q=A);var P=Object.getOwnPropertyDescriptor(M,A);(!P||("get"in P?!M.__esModule:P.writable||P.configurable))&&(P={enumerable:!0,get:function(){return M[A]}}),Object.defineProperty(N,q,P)}:function(N,M,A,q){q===void 0&&(q=A),N[q]=M[A]}),f=Ve&&Ve.__setModuleDefault||(Object.create?function(N,M){Object.defineProperty(N,"default",{enumerable:!0,value:M})}:function(N,M){N.default=M}),d=Ve&&Ve.__importStar||function(N){if(N&&N.__esModule)return N;var M={};if(N!=null)for(var A in N)A!=="default"&&Object.prototype.hasOwnProperty.call(N,A)&&u(M,N,A);return f(M,N),M},i=Ve&&Ve.__awaiter||function(N,M,A,q){function P(z){return z instanceof A?z:new A(function(U){U(z)})}return new(A||(A=Promise))(function(z,U){function Y(W){try{X(q.next(W))}catch(ge){U(ge)}}function re(W){try{X(q.throw(W))}catch(ge){U(ge)}}function X(W){W.done?z(W.value):P(W.value).then(Y,re)}X((q=q.apply(N,M||[])).next())})},c=Ve&&Ve.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(e,"__esModule",{value:!0}),e.DataSheetGrid=void 0;const t=d(fe()),o=Fd(),s=Yf,r=Xf(),n=Qf(),a=Tu(),p=Iu(),h=Zf(),w=ku(),y=eh(),b=c(lu()),l=ju(),m=nh(),g=rh(),v=ih(),_=ch(),S=dh(),C=fh(),O=[],x=[],R=()=>({}),E=()=>null,T=({rowData:N})=>Object.assign({},N);e.DataSheetGrid=t.default.memo(t.default.forwardRef(({value:N=O,className:M,style:A,height:q=400,onChange:P=E,columns:z=x,rowHeight:U=40,headerRowHeight:Y=typeof U=="number"?U:40,gutterColumn:re,stickyRightColumn:X,rowKey:W,addRowsComponent:ge=w.AddRows,createRow:we=R,autoAddRow:Ye=!1,lockRows:be=!1,disableExpandSelection:ot=!1,disableSmartDelete:at=!1,duplicateRow:kt=T,contextMenuComponent:Kt=l.ContextMenu,disableContextMenu:J=!1,onFocus:he=E,onBlur:pe=E,onActiveCellChange:jt=E,onSelectionChange:Vt=E,rowClassName:Wr,cellClassName:xr,onScroll:Cr},fc)=>{var Hr,Jr,Kr,Yr,Xr,Qr;const At=(0,t.useRef)(null),Cs=J||be,G=(0,r.useColumns)(z,re,X),ae=!!X,Or=(0,t.useRef)(null),Ue=(0,t.useRef)(null),Zr=(0,t.useRef)(null),ei=(0,t.useRef)(null),[hc,pc]=(0,y.useDebounceState)(1,100),{getRowSize:Pt,totalSize:mc,getRowIndex:Os}=(0,C.useRowHeights)({value:N,rowHeight:U}),Rs=Math.min(q,Y+mc(q)+hc),{width:Mt,height:pt}=(0,s.useResizeDetector)({targetRef:Ue,refreshMode:"throttle",refreshRate:100});pc(pt?Rs-pt:0);const gc=(0,n.useEdges)(Ue,Mt,pt),{fullWidth:Ns,totalWidth:bc,columnWidths:De,columnRights:$e}=(0,o.useColumnWidths)(G,Mt),[qt,Be]=(0,t.useState)(null),[Dt,yc]=(0,t.useState)([]),[le,ye]=(0,t.useState)(!1),[Bt,Es]=(0,t.useState)(0),[Lt,Ts]=(0,t.useState)(null),[k,se]=(0,a.useDeepEqualState)(null),[ve,te]=(0,a.useDeepEqualState)(null),V=(0,t.useMemo)(()=>k&&ve&&{min:{col:Math.min(k.col,ve.col),row:Math.min(k.row,ve.row)},max:{col:Math.max(k.col,ve.col),row:Math.max(k.row,ve.row)}},[k,ve]),[Qe,Ft]=(0,a.useDeepEqualState)({columns:!1,rows:!1,active:!1}),vc=ot||le||Qe.active||(k==null?void 0:k.row)===(N==null?void 0:N.length)-1||(V==null?void 0:V.max.row)===(N==null?void 0:N.length)-1||k&&G.slice(((Hr=V==null?void 0:V.min.col)!==null&&Hr!==void 0?Hr:k.col)+1,((Jr=V==null?void 0:V.max.col)!==null&&Jr!==void 0?Jr:k.col)+2).every(I=>I.disabled===!0)?null:Bt,Is=(0,h.useGetBoundingClientRect)(Or),ks=(0,h.useGetBoundingClientRect)(Ue);(0,t.useEffect)(()=>{var I;k!==null&&(document.activeElement.blur(),(I=window.getSelection())===null||I===void 0||I.removeAllRanges())},[k!==null]);const mt=(0,t.useCallback)((I,B=!1,L=!1)=>{const D=Is(B),H=L&&ks(B);if(D&&$e&&De){let ne=I.clientX-D.left,F=I.clientY-D.top;return H&&(I.clientY-H.top<=Y&&(F=0),I.clientX-H.left<=De[0]&&(ne=0),ae&&H.right-I.clientX<=De[De.length-1]&&(ne=$e[$e.length-2]+1)),{col:$e.findIndex(Q=>ne<Q)-1,row:Os(F-Y)}}return null},[$e,De,N.length,Is,ks,Y,ae,Os]),Te=(0,t.useRef)(N);Te.current=N;const Ie=(0,t.useCallback)(I=>{const B=G[I.col+1].disabled;return!!(typeof B=="function"?B({rowData:Te.current[I.row],rowIndex:I.row}):B)},[G]),Ze=(0,t.useCallback)((I,B=1)=>{be||(te(null),ye(!1),P([...Te.current.slice(0,I+1),...new Array(B).fill(0).map(we),...Te.current.slice(I+1)],[{type:"CREATE",fromRowIndex:I+1,toRowIndex:I+1+B}]),se(L=>({col:(L==null?void 0:L.col)||0,row:I+B,doNotScrollX:!0})))},[we,be,P,se,te]),Ut=(0,t.useCallback)((I,B=I)=>{be||(P([...Te.current.slice(0,B+1),...Te.current.slice(I,B+1).map((L,D)=>kt({rowData:L,rowIndex:D+I})),...Te.current.slice(B+1)],[{type:"CREATE",fromRowIndex:B+1,toRowIndex:B+2+B-I}]),se({col:0,row:B+1,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:2*B-I+1,doNotScrollX:!0}),ye(!1))},[G.length,kt,be,P,se,te,ae]),et=(0,t.useCallback)(I=>{if(!(!pt||!Mt)){if(!I.doNotScrollY){const B=Pt(I.row).top,L=Pt(I.row).top+Pt(I.row).height+Y-pt+1,D=Ue.current.scrollTop;D>B?Ue.current.scrollTop=B:D<L&&(Ue.current.scrollTop=L)}if($e&&De&&Ue.current&&!I.doNotScrollX){const B=$e[I.col]-$e[0],L=$e[I.col]+De[I.col+1]+(ae?De[De.length-1]:0)-Mt+1,D=Ue.current.scrollLeft;D>B?Ue.current.scrollLeft=B:D<L&&(Ue.current.scrollLeft=L)}}},[pt,Mt,Y,$e,De,Pt,ae]);(0,t.useEffect)(()=>{ve&&et(ve)},[ve,et]),(0,t.useEffect)(()=>{k&&et(k)},[k,et]);const wc=(0,t.useCallback)((I,B)=>{var L,D;P([...(L=Te.current)===null||L===void 0?void 0:L.slice(0,I),B,...(D=Te.current)===null||D===void 0?void 0:D.slice(I+1)],[{type:"UPDATE",fromRowIndex:I,toRowIndex:I+1}])},[P]),$t=(0,t.useCallback)((I,B=I)=>{be||(ye(!1),se(L=>{const D=Math.min(Te.current.length-2-B+I,I);return D<0?null:L&&{col:L.col,row:D}}),te(null),P([...Te.current.slice(0,I),...Te.current.slice(B+1)],[{type:"DELETE",fromRowIndex:I,toRowIndex:B+1}]))},[be,P,se,te]),Rr=(0,t.useCallback)((I=!0)=>{const B=I&&!at;if(!k)return;const L=(V==null?void 0:V.min)||k,D=(V==null?void 0:V.max)||k;if(N.slice(L.row,D.row+1).every((ne,F)=>G.every(Q=>Q.isCellEmpty({rowData:ne,rowIndex:F+L.row})))){B&&$t(L.row,D.row);return}const H=[...N];for(let ne=L.row;ne<=D.row;++ne)for(let F=L.col;F<=D.col;++F)if(!Ie({col:F,row:ne})){const{deleteValue:Q=({rowData:oe})=>oe}=G[F+1];H[ne]=Q({rowData:H[ne],rowIndex:ne})}if(B&&(0,b.default)(H,N)){se({col:0,row:L.row,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:D.row,doNotScrollX:!0});return}P(H,[{type:"UPDATE",fromRowIndex:L.row,toRowIndex:D.row+1}])},[k,G,N,$t,Ie,P,V==null?void 0:V.max,V==null?void 0:V.min,se,te,ae]),ti=(0,t.useCallback)(({nextRow:I=!0}={})=>{(k==null?void 0:k.row)===Te.current.length-1?I&&Ye?Ze(k.row):ye(!1):(ye(!1),I&&se(B=>B&&{col:B.col,row:B.row+1}))},[k==null?void 0:k.row,Ye,Ze,se]),Yt=(0,t.useCallback)(I=>i(void 0,void 0,void 0,function*(){var B,L;if(!le&&k){const D=[],H=(V==null?void 0:V.min)||k,ne=(V==null?void 0:V.max)||k;for(let K=H.row;K<=ne.row;++K){D.push([]);for(let ue=H.col;ue<=ne.col;++ue){const{copyValue:de=()=>null}=G[ue+1];D[K-H.row].push(de({rowData:N[K],rowIndex:K}))}}const F=D.map(K=>K.join("	")).join(`
`),Q=`<table>${D.map(K=>`<tr>${K.map(ue=>`<td>${(0,m.encodeHtml)(String(ue??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(I!==void 0){(B=I.clipboardData)===null||B===void 0||B.setData("text/plain",F),(L=I.clipboardData)===null||L===void 0||L.setData("text/html",Q),I.preventDefault();return}let oe=!1;if(navigator.clipboard.write!==void 0){const K=new Blob([F],{type:"text/plain"}),ue=new Blob([Q],{type:"text/html"}),de=[new ClipboardItem({"text/plain":K,"text/html":ue})];yield navigator.clipboard.write(de).then(()=>{oe=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(F).then(()=>{oe=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(oe=!0);oe||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[k,G,N,le,V]);(0,p.useDocumentEventListener)("copy",Yt);const ni=(0,t.useCallback)(I=>{!le&&k&&(Yt(I),Rr(!1))},[k,Rr,le,Yt]);(0,p.useDocumentEventListener)("cut",ni);const Xt=(0,t.useCallback)(I=>i(void 0,void 0,void 0,function*(){var B,L;if(!le&&k){const D=(V==null?void 0:V.min)||k,H=(V==null?void 0:V.max)||k,ne=yield Promise.all(I[0].map((F,Q)=>{var oe,K;const ue=(oe=G[D.col+Q+1])===null||oe===void 0?void 0:oe.prePasteValues,de=I.map(ke=>ke[Q]);return(K=ue==null?void 0:ue(de))!==null&&K!==void 0?K:de}));if(I=I.map((F,Q)=>ne.map(oe=>oe[Q])),I.length===1){const F=[...N];for(let Q=0;Q<I[0].length;Q++){const oe=(B=G[D.col+Q+1])===null||B===void 0?void 0:B.pasteValue;if(oe)for(let K=D.row;K<=H.row;K++)Ie({col:Q+D.col,row:K})||(F[K]=yield oe({rowData:F[K],value:I[0][Q],rowIndex:K}))}P(F,[{type:"UPDATE",fromRowIndex:D.row,toRowIndex:H.row+1}]),se({col:D.col,row:D.row}),te({col:Math.min(D.col+I[0].length-1,G.length-(ae?3:2)),row:H.row})}else{let F=[...N];const Q=D.row+I.length-N.length;Q>0&&(be?I.splice(I.length-Q,Q):F=[...F,...new Array(Q).fill(0).map(()=>we())]);for(let K=0;K<I[0].length&&D.col+K<G.length-(ae?2:1);K++){const ue=(L=G[D.col+K+1])===null||L===void 0?void 0:L.pasteValue;if(ue)for(let de=0;de<I.length;de++)Ie({col:D.col+K,row:D.row+de})||(F[D.row+de]=yield ue({rowData:F[D.row+de],value:I[de][K],rowIndex:D.row+de}))}const oe=[{type:"UPDATE",fromRowIndex:D.row,toRowIndex:D.row+I.length-(!be&&Q>0?Q:0)}];Q>0&&!be&&oe.push({type:"CREATE",fromRowIndex:D.row+I.length-Q,toRowIndex:D.row+I.length}),P(F,oe),se({col:D.col,row:D.row}),te({col:Math.min(D.col+I[0].length-1,G.length-(ae?3:2)),row:D.row+I.length-1})}}}),[k,G,we,N,le,ae,Ie,be,P,V==null?void 0:V.max,V==null?void 0:V.min,se,te]),_c=(0,t.useCallback)(I=>{var B,L,D,H,ne,F;if(k&&!le){let Q=[[""]];!((B=I.clipboardData)===null||B===void 0)&&B.types.includes("text/html")?Q=(0,m.parseTextHtmlData)((L=I.clipboardData)===null||L===void 0?void 0:L.getData("text/html")):!((D=I.clipboardData)===null||D===void 0)&&D.types.includes("text/plain")?Q=(0,m.parseTextPlainData)((H=I.clipboardData)===null||H===void 0?void 0:H.getData("text/plain")):!((ne=I.clipboardData)===null||ne===void 0)&&ne.types.includes("text")&&(Q=(0,m.parseTextPlainData)((F=I.clipboardData)===null||F===void 0?void 0:F.getData("text"))),Xt(Q),I.preventDefault()}},[k,Xt,le]);(0,p.useDocumentEventListener)("paste",_c);const Sc=(0,t.useCallback)(I=>{var B,L,D;if(qt&&Dt.length)return;const H=I.button===2||I.button===0&&I.ctrlKey,ne=((B=Or.current)===null||B===void 0?void 0:B.contains(I.target))||!1,F=ne?mt(I,!0,!0):null;if(!ne&&le&&k&&G[k.col+1].keepFocus)return;if(I.target instanceof HTMLElement&&I.target.className.includes("dsg-expand-rows-indicator")){Ts(Math.max((L=k==null?void 0:k.row)!==null&&L!==void 0?L:0,(D=V==null?void 0:V.max.row)!==null&&D!==void 0?D:0));return}const Q=F&&k&&k.col===F.col&&k.row===F.row&&!Ie(k);if(Q&&le)return;const oe=(F==null?void 0:F.col)===G.length-2&&ae,K=H&&V&&F&&F.row>=V.min.row&&F.row<=V.max.row&&F.col>=V.min.col&&F.col<=V.max.col,ue=H&&V&&F&&F.row===-1&&F.col>=V.min.col&&F.col<=V.max.col,de=H&&V&&F&&F.row>=V.min.row&&F.row<=V.max.row&&F.col===-1,ke=oe&&V&&F&&F.row>=V.min.row&&F.row<=V.max.row;if(H&&!Cs&&Be({x:I.clientX,y:I.clientY,cursorIndex:F}),(!(I.shiftKey&&k)||H)&&N.length>0&&se(F&&{col:(K||ue)&&k?k.col:Math.max(0,oe?0:F.col),row:(K||de||ke)&&k?k.row:Math.max(0,F.row),doNotScrollX:!!(K&&k||oe||F.col===-1),doNotScrollY:!!(K&&k||F.row===-1)}),Q&&!H&&(At.current=k),ye(!!(Q&&!H)),Ft(F&&!H?{columns:F.col!==-1&&!oe||!!(I.shiftKey&&k),rows:F.row!==-1||!!(I.shiftKey&&k),active:!0}:{columns:!1,rows:!1,active:!1}),I.shiftKey&&k&&!H)te(F&&{col:Math.max(0,F.col-(oe?1:0)),row:Math.max(0,F.row)});else if(!K){if(F&&((F==null?void 0:F.col)===-1||(F==null?void 0:F.row)===-1||oe)){let Oe=F.col,je=F.row,Re=!1,Le=!1;(F.col===-1||oe)&&(Oe=G.length-(ae?3:2),Re=!0),F.row===-1&&(je=N.length-1,Le=!0),ue&&ve&&(Oe=ve.col,Le=!0),(de||ke)&&ve&&(je=ve.row,Re=!0),te({col:Oe,row:je,doNotScrollX:Re,doNotScrollY:Le})}else te(null);ne&&I.preventDefault()}},[qt,Dt.length,mt,le,k,G,Ie,V,ae,Cs,Ft,se,te,ve,N.length]);(0,p.useDocumentEventListener)("mousedown",Sc);const xc=(0,t.useCallback)(()=>{var I,B,L,D,H,ne,F,Q,oe;if(Lt!==null){if(Bt>0&&k){let K=[];const ue=(V==null?void 0:V.min)||k,de=(V==null?void 0:V.max)||k;for(let ke=ue.row;ke<=de.row;++ke){K.push([]);for(let Oe=ue.col;Oe<=de.col;++Oe){const{copyValue:je=()=>null}=G[Oe+1];K[ke-ue.row].push(String((I=je({rowData:N[ke],rowIndex:ke}))!==null&&I!==void 0?I:""))}}Promise.all(K[0].map((ke,Oe)=>{var je,Re;const Le=(je=G[ue.col+Oe+1])===null||je===void 0?void 0:je.prePasteValues,Fe=K.map(Ec=>Ec[Oe]);return(Re=Le==null?void 0:Le(Fe))!==null&&Re!==void 0?Re:Fe})).then(ke=>{var Oe;K=K.map((Re,Le)=>ke.map(Fe=>Fe[Le]));const je=[...N];for(let Re=0;Re<K[0].length;Re++){const Le=(Oe=G[ue.col+Re+1])===null||Oe===void 0?void 0:Oe.pasteValue;if(Le)for(let Fe=de.row+1;Fe<=de.row+Bt;Fe++)Ie({col:Re+ue.col,row:Fe})||(je[Fe]=Le({rowData:je[Fe],value:K[(Fe-de.row-1)%K.length][Re],rowIndex:Fe}))}P(je,[{type:"UPDATE",fromRowIndex:de.row+1,toRowIndex:de.row+1+Bt}])}),Es(0),se({col:Math.min((B=k==null?void 0:k.col)!==null&&B!==void 0?B:1/0,(L=V==null?void 0:V.min.col)!==null&&L!==void 0?L:1/0),row:Math.min((D=k==null?void 0:k.row)!==null&&D!==void 0?D:1/0,(H=V==null?void 0:V.min.row)!==null&&H!==void 0?H:1/0),doNotScrollX:!0,doNotScrollY:!0}),te({col:Math.max((ne=k==null?void 0:k.col)!==null&&ne!==void 0?ne:0,(F=V==null?void 0:V.max.col)!==null&&F!==void 0?F:0),row:Math.max((Q=k==null?void 0:k.row)!==null&&Q!==void 0?Q:0,(oe=V==null?void 0:V.max.row)!==null&&oe!==void 0?oe:0)+Bt})}Ts(null)}Ft({columns:!1,rows:!1,active:!1})},[Lt,Ft,Bt,k,V==null?void 0:V.min,V==null?void 0:V.max,N,P,se,te,G,Ie]);(0,p.useDocumentEventListener)("mouseup",xc);const Cc=(0,t.useCallback)(I=>{if(Lt!==null){const B=mt(I);B&&(Es(Math.max(0,B.row-Lt)),et({col:B.col,row:Math.max(B.row,Lt)}))}if(Qe.active){const B=mt(I),L=G.length-(ae?3:2);te(B&&{col:Qe.columns?Math.max(0,Math.min(L,B.col)):L,row:Qe.rows?Math.max(0,B.row):N.length-1,doNotScrollX:!Qe.columns,doNotScrollY:!Qe.rows}),ye(!1)}},[et,Qe.active,Qe.columns,Qe.rows,mt,G.length,ae,te,N.length,Lt]);(0,p.useDocumentEventListener)("mousemove",Cc);const Oc=(0,t.useCallback)(I=>{var B;if(k&&!I.isComposing){if(I.key==="Tab"&&!I.shiftKey&&k.col===G.length-(ae?3:2)&&!G[k.col+1].disableKeys)if(k.row===N.length-1){if(ei.current){I.preventDefault(),se(null),te(null),ye(!1);const L=(0,v.getAllTabbableElements)(),D=L.indexOf(ei.current);L[(D+1)%L.length].focus();return}}else{se(L=>{var D;return{col:0,row:((D=L==null?void 0:L.row)!==null&&D!==void 0?D:0)+1}}),te(null),ye(!1),I.preventDefault();return}if(I.key==="Tab"&&I.shiftKey&&k.col===0&&!G[k.col+1].disableKeys)if(k.row===0){if(Zr.current){I.preventDefault(),se(null),te(null),ye(!1);const L=(0,v.getAllTabbableElements)(),D=L.indexOf(Zr.current);L[(D-1+L.length)%L.length].focus();return}}else{se(L=>{var D;return{col:G.length-(ae?3:2),row:((D=L==null?void 0:L.row)!==null&&D!==void 0?D:1)-1}}),te(null),ye(!1),I.preventDefault();return}if(!((B=I.key)===null||B===void 0)&&B.startsWith("Arrow")||I.key==="Tab"){if(le&&G[k.col+1].disableKeys||le&&["ArrowLeft","ArrowRight"].includes(I.key))return;const L=([D,H],ne)=>ne&&{col:Math.max(0,Math.min(G.length-(ae?3:2),ne.col+D)),row:Math.max(0,Math.min(N.length-1,ne.row+H))};if(I.key==="Tab"&&I.shiftKey)se(D=>L([-1,0],D)),te(null);else{const D={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[I.key];(I.ctrlKey||I.metaKey)&&(D[0]*=G.length,D[1]*=N.length),I.shiftKey?te(H=>L(D,H||k)):(se(H=>L(D,H)),te(null))}ye(!1),I.preventDefault()}else I.key==="Escape"?(!le&&!ve&&se(null),te(null),ye(!1)):(I.key==="Enter"||I.key==="F2")&&!I.ctrlKey&&!I.metaKey&&!I.altKey&&!I.shiftKey?(te(null),le?G[k.col+1].disableKeys||(ti(),I.preventDefault()):Ie(k)||(At.current=k,ye(!0),et(k),I.preventDefault())):I.key==="Enter"&&!I.ctrlKey&&!I.metaKey&&!I.altKey&&I.shiftKey?Ze((V==null?void 0:V.max.row)||k.row):I.key==="d"&&(I.ctrlKey||I.metaKey)&&!I.altKey&&!I.shiftKey?(Ut((V==null?void 0:V.min.row)||k.row,V==null?void 0:V.max.row),I.preventDefault()):((0,m.isPrintableUnicode)(I.key)||I.code.match(/Key[A-Z]$/))&&!I.ctrlKey&&!I.metaKey&&!I.altKey?!le&&!Ie(k)&&(At.current=k,te(null),ye(!0),et(k)):["Backspace","Delete"].includes(I.key)?le||(Rr(),I.preventDefault()):I.key==="a"&&(I.ctrlKey||I.metaKey)&&(le||(se({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:N.length-1,doNotScrollY:!0,doNotScrollX:!0}),I.preventDefault()))}},[k,G,N.length,Rr,Ut,le,Ze,Ie,et,V==null?void 0:V.max.row,V==null?void 0:V.min.row,ve,se,te,ti,ae]);(0,p.useDocumentEventListener)("keydown",Oc);const Rc=(0,t.useCallback)(I=>{var B;const L=((B=Or.current)===null||B===void 0?void 0:B.contains(I.target))||!1,D=L?mt(I,!0,!0):null,H=D&&k&&k.col===D.col&&k.row===D.row&&le;L&&!H&&I.preventDefault()},[mt,k,le]);(0,p.useDocumentEventListener)("contextmenu",Rc),(0,t.useEffect)(()=>{const I=[];(k==null?void 0:k.row)!==void 0&&I.push({type:"COPY",action:()=>{Yt(),Be(null)}},{type:"CUT",action:()=>{ni(),Be(null)}},{type:"PASTE",action:()=>i(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(L=>i(void 0,void 0,void 0,function*(){let D=[[""]];if(L.types.includes("text/html")){const H=yield L.getType("text/html");D=(0,m.parseTextHtmlData)(yield H.text())}else if(L.types.includes("text/plain")){const H=yield L.getType("text/plain");D=(0,m.parseTextPlainData)(yield H.text())}else if(L.types.includes("text")){const H=yield L.getType("text");D=(0,m.parseTextHtmlData)(yield H.text())}Xt(D)}));else if(navigator.clipboard.readText!==void 0){const B=yield navigator.clipboard.readText();Xt((0,m.parseTextPlainData)(B))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");Be(null)})}),(V==null?void 0:V.max.row)!==void 0?I.push({type:"INSERT_ROW_BELLOW",action:()=>{Be(null),Ze(V.max.row)}}):(k==null?void 0:k.row)!==void 0&&I.push({type:"INSERT_ROW_BELLOW",action:()=>{Be(null),Ze(k.row)}}),(V==null?void 0:V.min.row)!==void 0&&V.min.row!==V.max.row?I.push({type:"DUPLICATE_ROWS",fromRow:V.min.row+1,toRow:V.max.row+1,action:()=>{Be(null),Ut(V.min.row,V.max.row)}}):(k==null?void 0:k.row)!==void 0&&I.push({type:"DUPLICATE_ROW",action:()=>{Be(null),Ut(k.row)}}),(V==null?void 0:V.min.row)!==void 0&&V.min.row!==V.max.row?I.push({type:"DELETE_ROWS",fromRow:V.min.row+1,toRow:V.max.row+1,action:()=>{Be(null),$t(V.min.row,V.max.row)}}):(k==null?void 0:k.row)!==void 0&&I.push({type:"DELETE_ROW",action:()=>{Be(null),$t(k.row)}}),yc(I),I.length||Be(null)},[V,k,$t,Ut,Ze,ni,Yt,Xt]);const js=(0,t.useRef)(Dt);js.current=Dt;const Nc=(0,t.useCallback)(()=>js.current,[]);(0,t.useImperativeHandle)(fc,()=>({activeCell:(0,g.getCellWithId)(k,G),selection:(0,g.getSelectionWithId)(V??(k?{min:k,max:k}:null),G),setSelection:I=>{const B=(0,g.getSelection)(I,G.length-(ae?2:1),N.length,G);se((B==null?void 0:B.min)||null),ye(!1),Ft({columns:!1,active:!1,rows:!1}),te((B==null?void 0:B.max)||null)},setActiveCell:I=>{const B=(0,g.getCell)(I,G.length-(ae?2:1),N.length,G);se(B),ye(!1),Ft({columns:!1,active:!1,rows:!1}),te(null)}}));const lt=(0,t.useRef)({onFocus:he,onBlur:pe,onActiveCellChange:jt,onSelectionChange:Vt});return lt.current.onFocus=he,lt.current.onBlur=pe,lt.current.onActiveCellChange=jt,lt.current.onSelectionChange=Vt,(0,t.useEffect)(()=>{At.current&&(le?lt.current.onFocus({cell:(0,g.getCellWithId)(At.current,G)}):lt.current.onBlur({cell:(0,g.getCellWithId)(At.current,G)}))},[le,G]),(0,t.useEffect)(()=>{lt.current.onActiveCellChange({cell:(0,g.getCellWithId)(k,G)})},[k==null?void 0:k.col,k==null?void 0:k.row,G]),(0,t.useEffect)(()=>{lt.current.onSelectionChange({selection:(0,g.getSelectionWithId)(V??(k?{min:k,max:k}:null),G)})},[(Kr=V==null?void 0:V.min.col)!==null&&Kr!==void 0?Kr:k==null?void 0:k.col,(Yr=V==null?void 0:V.min.row)!==null&&Yr!==void 0?Yr:k==null?void 0:k.row,(Xr=V==null?void 0:V.max.col)!==null&&Xr!==void 0?Xr:k==null?void 0:k.col,(Qr=V==null?void 0:V.max.row)!==null&&Qr!==void 0?Qr:k==null?void 0:k.row,k==null?void 0:k.col,k==null?void 0:k.row,G]),t.default.createElement("div",{className:M,style:A},t.default.createElement("div",{ref:Zr,tabIndex:z.length&&N.length?0:void 0,onFocus:I=>{I.target.blur(),se({col:0,row:0})}}),t.default.createElement(_.Grid,{columns:G,outerRef:Ue,columnWidths:De,hasStickyRightColumn:ae,displayHeight:Rs,data:N,fullWidth:Ns,headerRowHeight:Y,activeCell:k,innerRef:Or,rowHeight:Pt,rowKey:W,selection:V,rowClassName:Wr,editing:le,getContextMenuItems:Nc,setRowData:wc,deleteRows:$t,insertRowAfter:Ze,duplicateRows:Ut,stopEditing:ti,cellClassName:xr,onScroll:Cr},t.default.createElement(S.SelectionRect,{columnRights:$e,columnWidths:De,activeCell:k,selection:V,headerRowHeight:Y,rowHeight:Pt,hasStickyRightColumn:ae,dataLength:N.length,viewHeight:pt,viewWidth:Mt,contentWidth:Ns?void 0:bc,edges:gc,editing:le,isCellDisabled:Ie,expandSelection:vc})),t.default.createElement("div",{ref:ei,tabIndex:z.length&&N.length?0:void 0,onFocus:I=>{I.target.blur(),se({col:G.length-(ae?3:2),row:N.length-1})}}),!be&&ge&&t.default.createElement(ge,{addRows:I=>Ze(N.length-1,I)}),qt&&Dt.length>0&&t.default.createElement(Kt,{clientX:qt.x,clientY:qt.y,cursorIndex:qt.cursorIndex,items:Dt,close:()=>Be(null)}))})),e.DataSheetGrid.displayName="DataSheetGrid"}(Ve)),Ve}var it={},Io;function hh(){if(Io)return it;Io=1;var e=it&&it.__rest||function(c,t){var o={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&t.indexOf(s)<0&&(o[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(c);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(c,s[r])&&(o[s[r]]=c[s[r]]);return o},u=it&&it.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(it,"__esModule",{value:!0}),it.StaticDataSheetGrid=void 0;const f=fe(),d=Vu(),i=u(fe());return it.StaticDataSheetGrid=i.default.forwardRef((c,t)=>{var{columns:o,gutterColumn:s,stickyRightColumn:r,addRowsComponent:n,createRow:a,duplicateRow:p,style:h,rowKey:w,onFocus:y,onBlur:b,onActiveCellChange:l,onSelectionChange:m,rowClassName:g,rowHeight:v}=c,_=e(c,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[S]=(0,f.useState)({columns:o,gutterColumn:s,stickyRightColumn:r,addRowsComponent:n,createRow:a,duplicateRow:p,style:h,rowKey:w,onFocus:y,onBlur:b,onActiveCellChange:l,onSelectionChange:m,rowClassName:g,rowHeight:v});return i.default.createElement(d.DataSheetGrid,Object.assign({},S,_,{rowHeight:typeof v=="number"?v:S.rowHeight,ref:t}))}),it}var _e={},un={},ko;function ph(){if(ko)return un;ko=1,Object.defineProperty(un,"__esModule",{value:!0}),un.useFirstRender=void 0;const e=fe(),u=()=>{const f=(0,e.useRef)(!0),d=f.current;return f.current=!1,d};return un.useFirstRender=u,un}var jo;function Lr(){if(jo)return _e;jo=1;var e=_e&&_e.__createBinding||(Object.create?function(r,n,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(n,a);(!h||("get"in h?!n.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return n[a]}}),Object.defineProperty(r,p,h)}:function(r,n,a,p){p===void 0&&(p=a),r[p]=n[a]}),u=_e&&_e.__setModuleDefault||(Object.create?function(r,n){Object.defineProperty(r,"default",{enumerable:!0,value:n})}:function(r,n){r.default=n}),f=_e&&_e.__importStar||function(r){if(r&&r.__esModule)return r;var n={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&e(n,r,a);return u(n,r),n},d=_e&&_e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.createTextColumn=_e.textColumn=void 0;const i=f(fe()),c=d(Ht()),t=ph(),o=i.default.memo(({active:r,focus:n,rowData:a,setRowData:p,columnData:{placeholder:h,alignRight:w,formatInputOnFocus:y,formatBlurredInput:b,parseUserInput:l,continuousUpdates:m}})=>{const g=(0,i.useRef)(null),v=(0,t.useFirstRender)(),_=(0,i.useRef)({rowData:a,formatInputOnFocus:y,formatBlurredInput:b,setRowData:p,parseUserInput:l,continuousUpdates:m,firstRender:v,focusedAt:0,changedAt:0,escPressed:!1});return _.current={rowData:a,formatInputOnFocus:y,formatBlurredInput:b,setRowData:p,parseUserInput:l,continuousUpdates:m,firstRender:v,focusedAt:_.current.focusedAt,changedAt:_.current.changedAt,escPressed:_.current.escPressed},(0,i.useLayoutEffect)(()=>{n?(g.current&&(g.current.value=_.current.formatInputOnFocus(_.current.rowData),g.current.focus(),g.current.select()),_.current.escPressed=!1,_.current.focusedAt=Date.now()):g.current&&(!_.current.escPressed&&!_.current.continuousUpdates&&!_.current.firstRender&&_.current.changedAt>=_.current.focusedAt&&_.current.setRowData(_.current.parseUserInput(g.current.value)),g.current.blur())},[n]),(0,i.useEffect)(()=>{!n&&g.current&&(g.current.value=_.current.formatBlurredInput(a))},[n,a]),i.default.createElement("input",{defaultValue:b(a),className:(0,c.default)("dsg-input",w&&"dsg-input-align-right"),placeholder:r?h:void 0,tabIndex:-1,ref:g,style:{pointerEvents:n?"auto":"none"},onChange:S=>{_.current.changedAt=Date.now(),m&&p(l(S.target.value))},onKeyDown:S=>{S.key==="Escape"&&(_.current.escPressed=!0)}})});o.displayName="TextComponent",_e.textColumn=s();function s({placeholder:r,alignRight:n=!1,continuousUpdates:a=!0,deletedValue:p=null,parseUserInput:h=m=>m.trim()||null,formatBlurredInput:w=m=>String(m??""),formatInputOnFocus:y=m=>String(m??""),formatForCopy:b=m=>String(m??""),parsePastedValue:l=m=>m.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:o,columnData:{placeholder:r,alignRight:n,continuousUpdates:a,formatInputOnFocus:y,formatBlurredInput:w,parseUserInput:h},deleteValue:()=>p,copyValue:({rowData:m})=>b(m),pasteValue:({value:m})=>l(m),isCellEmpty:({rowData:m})=>m==null}}return _e.createTextColumn=s,_e}var We={},Vo;function mh(){if(Vo)return We;Vo=1;var e=We&&We.__createBinding||(Object.create?function(t,o,s,r){r===void 0&&(r=s);var n=Object.getOwnPropertyDescriptor(o,s);(!n||("get"in n?!o.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(t,r,n)}:function(t,o,s,r){r===void 0&&(r=s),t[r]=o[s]}),u=We&&We.__setModuleDefault||(Object.create?function(t,o){Object.defineProperty(t,"default",{enumerable:!0,value:o})}:function(t,o){t.default=o}),f=We&&We.__importStar||function(t){if(t&&t.__esModule)return t;var o={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&e(o,t,s);return u(o,t),o};Object.defineProperty(We,"__esModule",{value:!0}),We.checkboxColumn=void 0;const d=f(fe()),i=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],c=d.default.memo(({focus:t,rowData:o,setRowData:s,active:r,stopEditing:n,disabled:a})=>{const p=(0,d.useRef)(null);return(0,d.useLayoutEffect)(()=>{t&&(s(!o),n({nextRow:!1}))},[t,n]),d.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:p,disabled:a,checked:!!o,onMouseDown:()=>!r&&s(!o),onChange:()=>null})});return c.displayName="CheckboxComponent",We.checkboxColumn={component:c,deleteValue:()=>!1,copyValue:({rowData:t})=>t?"YES":"NO",pasteValue:({value:t})=>!i.includes(t.toLowerCase()),isCellEmpty:({rowData:t})=>!t},We}var cn={},Ao;function gh(){if(Ao)return cn;Ao=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.floatColumn=void 0;const e=Lr();return cn.floatColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:u=>typeof u=="number"?new Intl.NumberFormat().format(u):"",parseUserInput:u=>{const f=parseFloat(u);return isNaN(f)?null:f},parsePastedValue:u=>{const f=parseFloat(u);return isNaN(f)?null:f}}),cn}var dn={},Po;function bh(){if(Po)return dn;Po=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.intColumn=void 0;const e=Lr();return dn.intColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:u=>typeof u=="number"?new Intl.NumberFormat().format(u):"",parseUserInput:u=>{const f=parseFloat(u);return isNaN(f)?null:Math.round(f)},parsePastedValue:u=>{const f=parseFloat(u);return isNaN(f)?null:Math.round(f)}}),dn}var fn={},Mo;function yh(){if(Mo)return fn;Mo=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.percentColumn=void 0;const e=Lr(),u=1e12,f=1e10;return fn.percentColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(d):"",formatInputOnFocus:d=>typeof d=="number"&&!isNaN(d)?String(Math.round(d*u)/f):"",parseUserInput:d=>{const i=parseFloat(d);return isNaN(i)?null:i/100},parsePastedValue:d=>{const i=parseFloat(d);return isNaN(i)?null:i}}),fn}var Pe={},qo;function vh(){if(qo)return Pe;qo=1;var e=Pe&&Pe.__createBinding||(Object.create?function(o,s,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,n,a)}:function(o,s,r,n){n===void 0&&(n=r),o[n]=s[r]}),u=Pe&&Pe.__setModuleDefault||(Object.create?function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}:function(o,s){o.default=s}),f=Pe&&Pe.__importStar||function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var r in o)r!=="default"&&Object.prototype.hasOwnProperty.call(o,r)&&e(s,o,r);return u(s,o),s},d=Pe&&Pe.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.dateColumn=void 0;const i=f(fe()),c=d(Ht()),t=i.default.memo(({focus:o,active:s,rowData:r,setRowData:n})=>{var a;const p=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{var h,w;o?(h=p.current)===null||h===void 0||h.select():(w=p.current)===null||w===void 0||w.blur()},[o]),i.default.createElement("input",{className:(0,c.default)("dsg-input",!s&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:p,style:{pointerEvents:o?"auto":"none",opacity:r||s?void 0:0},value:(a=r==null?void 0:r.toISOString().substr(0,10))!==null&&a!==void 0?a:"",onChange:h=>{const w=new Date(h.target.value);n(isNaN(w.getTime())?null:w)}})});return t.displayName="DateComponent",Pe.dateColumn={component:t,deleteValue:()=>null,copyValue:({rowData:o})=>o?o.toISOString().substr(0,10):null,pasteValue:({value:o})=>{const s=new Date(o.replace(/\.\s?|\//g,"-"));return isNaN(s.getTime())?null:s},minWidth:170,isCellEmpty:({rowData:o})=>!o},Pe}var Me={},Do;function wh(){if(Do)return Me;Do=1;var e=Me&&Me.__createBinding||(Object.create?function(o,s,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,n,a)}:function(o,s,r,n){n===void 0&&(n=r),o[n]=s[r]}),u=Me&&Me.__setModuleDefault||(Object.create?function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}:function(o,s){o.default=s}),f=Me&&Me.__importStar||function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var r in o)r!=="default"&&Object.prototype.hasOwnProperty.call(o,r)&&e(s,o,r);return u(s,o),s},d=Me&&Me.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Me,"__esModule",{value:!0}),Me.isoDateColumn=void 0;const i=f(fe()),c=d(Ht()),t=i.default.memo(({focus:o,active:s,rowData:r,setRowData:n})=>{const a=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{var p,h;o?(p=a.current)===null||p===void 0||p.select():(h=a.current)===null||h===void 0||h.blur()},[o]),i.default.createElement("input",{className:(0,c.default)("dsg-input",!s&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:a,style:{pointerEvents:o?"auto":"none",opacity:r||s?void 0:0},value:r??"",onChange:p=>{const h=new Date(p.target.value);n(isNaN(h.getTime())?null:h.toISOString().substr(0,10))}})});return t.displayName="IsoDateComponent",Me.isoDateColumn={component:t,deleteValue:()=>null,copyValue:({rowData:o})=>o,pasteValue:({value:o})=>{const s=new Date(o.replace(/\.\s?|\//g,"-"));return isNaN(s.getTime())?null:s.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:o})=>!o},Me}var qe={},Bo;function _h(){if(Bo)return qe;Bo=1;var e=qe&&qe.__createBinding||(Object.create?function(o,s,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,n,a)}:function(o,s,r,n){n===void 0&&(n=r),o[n]=s[r]}),u=qe&&qe.__setModuleDefault||(Object.create?function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}:function(o,s){o.default=s}),f=qe&&qe.__importStar||function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var r in o)r!=="default"&&Object.prototype.hasOwnProperty.call(o,r)&&e(s,o,r);return u(s,o),s},d=qe&&qe.__rest||function(o,s){var r={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&s.indexOf(n)<0&&(r[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)s.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(r[n[a]]=o[n[a]]);return r};Object.defineProperty(qe,"__esModule",{value:!0}),qe.keyColumn=void 0;const i=f(fe()),c=o=>{var{columnData:{key:s,original:r},rowData:n,setRowData:a}=o,p=d(o,["columnData","rowData","setRowData"]);const h=(0,i.useRef)(n);h.current=n;const w=(0,i.useCallback)(b=>{a(Object.assign(Object.assign({},h.current),{[s]:b}))},[s,a]);if(!r.component)return i.default.createElement(i.default.Fragment,null);const y=r.component;return i.default.createElement(y,Object.assign({columnData:r.columnData,setRowData:w,rowData:n[s]},p))},t=(o,s)=>Object.assign(Object.assign({id:o},s),{columnData:{key:o,original:s},component:c,copyValue:({rowData:r,rowIndex:n})=>{var a,p;return(p=(a=s.copyValue)===null||a===void 0?void 0:a.call(s,{rowData:r[o],rowIndex:n}))!==null&&p!==void 0?p:null},deleteValue:({rowData:r,rowIndex:n})=>{var a,p;return Object.assign(Object.assign({},r),{[o]:(p=(a=s.deleteValue)===null||a===void 0?void 0:a.call(s,{rowData:r[o],rowIndex:n}))!==null&&p!==void 0?p:null})},pasteValue:({rowData:r,value:n,rowIndex:a})=>{var p,h;return Object.assign(Object.assign({},r),{[o]:(h=(p=s.pasteValue)===null||p===void 0?void 0:p.call(s,{rowData:r[o],value:n,rowIndex:a}))!==null&&h!==void 0?h:null})},disabled:typeof s.disabled=="function"?({rowData:r,rowIndex:n})=>{var a;return typeof s.disabled=="function"?s.disabled({rowData:r[o],rowIndex:n}):(a=s.disabled)!==null&&a!==void 0?a:!1}:s.disabled,cellClassName:typeof s.cellClassName=="function"?({rowData:r,rowIndex:n,columnId:a})=>{var p;return typeof s.cellClassName=="function"?s.cellClassName({rowData:r[o],rowIndex:n,columnId:a}):(p=s.cellClassName)!==null&&p!==void 0?p:void 0}:s.cellClassName,isCellEmpty:({rowData:r,rowIndex:n})=>{var a,p;return(p=(a=s.isCellEmpty)===null||a===void 0?void 0:a.call(s,{rowData:r[o],rowIndex:n}))!==null&&p!==void 0?p:!1}});return qe.keyColumn=t,qe}var Lo;function Sh(){return Lo||(Lo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.renderContextMenuItem=e.createContextMenuComponent=e.createAddRowsComponent=e.keyColumn=e.isoDateColumn=e.dateColumn=e.percentColumn=e.intColumn=e.floatColumn=e.checkboxColumn=e.createTextColumn=e.textColumn=e.DataSheetGrid=e.DynamicDataSheetGrid=void 0;const u=Vu(),f=hh();e.DynamicDataSheetGrid=u.DataSheetGrid,e.DataSheetGrid=f.StaticDataSheetGrid;var d=Lr();Object.defineProperty(e,"textColumn",{enumerable:!0,get:function(){return d.textColumn}}),Object.defineProperty(e,"createTextColumn",{enumerable:!0,get:function(){return d.createTextColumn}});var i=mh();Object.defineProperty(e,"checkboxColumn",{enumerable:!0,get:function(){return i.checkboxColumn}});var c=gh();Object.defineProperty(e,"floatColumn",{enumerable:!0,get:function(){return c.floatColumn}});var t=bh();Object.defineProperty(e,"intColumn",{enumerable:!0,get:function(){return t.intColumn}});var o=yh();Object.defineProperty(e,"percentColumn",{enumerable:!0,get:function(){return o.percentColumn}});var s=vh();Object.defineProperty(e,"dateColumn",{enumerable:!0,get:function(){return s.dateColumn}});var r=wh();Object.defineProperty(e,"isoDateColumn",{enumerable:!0,get:function(){return r.isoDateColumn}});var n=_h();Object.defineProperty(e,"keyColumn",{enumerable:!0,get:function(){return n.keyColumn}});var a=ku();Object.defineProperty(e,"createAddRowsComponent",{enumerable:!0,get:function(){return a.createAddRowsComponent}});var p=ju();Object.defineProperty(e,"createContextMenuComponent",{enumerable:!0,get:function(){return p.createContextMenuComponent}}),Object.defineProperty(e,"renderContextMenuItem",{enumerable:!0,get:function(){return p.defaultRenderItem}})}(si)),si}var ut=Sh();function xh(e,u){if(!u||u==="string")return String(e);if(u==="number"){if(e.trim()==="")return e;const f=Number(e);return isNaN(f)?e:f}else{if(u==="boolean")return e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e;if(u==="object"||u==="array")try{return JSON.parse(e)}catch{return e}else return e}}function Fo(e){return typeof e=="object"?JSON.stringify(e):String(e)}function Ch({rowData:e,setRowData:u,choices:f,colType:d}){const[i,c]=$.useState(Fo(e));return j.jsx(pu,{freeSolo:!0,disablePortal:!1,options:f,getOptionLabel:t=>Fo(t),value:e,onInputChange:(t,o)=>{c(o)},onChange:(t,o,s)=>{u(s==="createOption"?xh(o,d):o)},blurOnSelect:!0,onBlur:()=>u(i),renderInput:t=>j.jsx(mu,{...t,slotProps:{input:{...t.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}}})}function ns({choices:e,colType:u}){return{component:f=>j.jsx(Ch,{...f,choices:e,colType:u}),copyValue:({rowData:f})=>f,pasteValue:({value:f})=>f,disableKeys:!0,keepFocus:!0}}try{ns.displayName="autocompleteColumn",ns.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}async function Oh(e,u){const f=await e.gridServicesClient.postRepoV1GridSessionAsyncStart({createGridRequest:u});if(!f.token)throw new Error("No async job token returned from startGridSession");return(await os(()=>e.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:f.token}))).responseBody}function Rh(e){const u=Br(),{keyFactory:f,synapseClient:d}=st();return ft({...e,mutationFn:i=>d.gridServicesClient.postRepoV1GridSessionSessionIdReplica({sessionId:i,createReplicaRequest:{gridSessionId:i}}),onSuccess:async(i,c,t)=>{await u.invalidateQueries({queryKey:f.getGridSessionListKey()})}})}function Nh(e){const u=Br(),{keyFactory:f,synapseClient:d}=st();return ft({...e,mutationFn:i=>d.gridServicesClient.deleteRepoV1GridSessionSessionId({sessionId:i}),onSuccess:async(i,c,t)=>{await u.invalidateQueries({queryKey:f.getGridSessionListKey()}),e!=null&&e.onSuccess&&await e.onSuccess(i,c,t)}})}function Eh(e){const{keyFactory:u,synapseClient:f}=st();return dd({...e,queryKey:u.getGridSessionListKey(),queryFn:async d=>await f.gridServicesClient.postRepoV1GridSessionList({listGridSessionsRequest:{nextPageToken:d.pageParam}}),initialPageParam:void 0,getNextPageParam:d=>d.nextPageToken})}const Th=e=>{const{synapseClient:u}=st();return ft({...e,mutationFn:async f=>await Oh(u,f)})};function Ih(){const{mutateAsync:e}=Th(),{synapseClient:u}=st();return ft({mutationFn:async({createGridRequest:f,sessionId:d})=>{if(!(f||d))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(f){const i=await e(f);return console.log("Grid session started:",i),i.gridSession}return console.log(`Joining existing session ID: ${d}`),await u.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:d})}})}function kh(e){const{mutateAsync:u}=Ih(),{mutateAsync:f}=Rh(),{synapseClient:d}=st();return ft({...e,mutationFn:async({createGridRequest:i,sessionId:c})=>{if(!(i||c))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const t=await u({createGridRequest:i,sessionId:c}),o=t.sessionId;try{const s=await f(o);console.log("Replica created:",s);const r=s.replica,{presignedUrl:n}=await d.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:o,createGridPresignedUrlRequest:{gridSessionId:o,replicaId:r.replicaId}});return{session:t,replica:r,presignedUrl:n}}catch(s){throw new Error("Error starting session:",{cause:s})}}})}const rs=$.forwardRef((e,u)=>{const{show:f=!1,onSessionChange:d=Tt,onReplicaChange:i=Tt,onPresignedUrlChange:c=Tt}=e,[t,o]=$.useState(""),{mutate:s}=kh({onMutate(h){console.log("Starting grid session with args:",h)},onSuccess({session:h,replica:w,presignedUrl:y}){Et("Grid session started successfully","success"),d(h),i(w.replicaId),c(y)}}),{mutate:r}=Nh({onSuccess:()=>{Et("Successfully deleted grid session","success"),d(null),i(null),c("")},onError:h=>{Et(h.reason,"danger")}}),{data:n}=Eh(),a=$.useMemo(()=>(n==null?void 0:n.pages.flatMap(h=>h.page||[]))||[],[n]),p=function(){s(jh(t))};return $.useImperativeHandle(u,()=>({handleStartSession:h=>{s({createGridRequest:h})},handleLoadSession:h=>{s({sessionId:h})}}),[s]),f?j.jsxs(xe,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx(xe,{size:{xs:12},sx:{position:"relative"},children:j.jsx(pu,{freeSolo:!0,fullWidth:!0,renderInput:h=>j.jsx(mu,{...h,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:a,getOptionLabel:h=>typeof h=="string"?h:h.sessionId||"",value:t,onInputChange:(h,w)=>{o(w)},onChange:(h,w)=>{w&&typeof w=="object"?(o(w.sessionId||""),s({sessionId:w.sessionId})):o(w||"")},onKeyDown:h=>{h.key==="Enter"&&p()},renderOption:(h,w)=>$.createElement(yr,{...h,key:w.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs(xe,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx(xe,{size:{xs:6,md:2},children:w.sessionId}),j.jsx(xe,{size:{xs:5,md:2},children:w.sourceEntityId}),j.jsx(xe,{size:{xs:0,md:6},children:w.gridJsonSchema$Id??"No schema"}),j.jsx(xe,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:y=>{y.stopPropagation(),r(w.sessionId)},children:"ðŸ—‘ï¸"})})]}))})}),j.jsx(xe,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(Gt,{color:"primary",variant:"contained",onClick:()=>{p()},children:"Start Grid Session"})})]}):null});function jh(e){const u=Id(e);if(u.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query or session ID.");switch(u.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:u.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:u.input};case"recordSetId":return{createGridRequest:{recordSetId:u.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{rs.displayName="StartGridSession",rs.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},onPresignedUrlChange:{defaultValue:null,description:"",name:"onPresignedUrlChange",required:!1,type:{name:"(url: string) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function Vh(e){const u=$.useMemo(()=>e?e.api.subscribe:()=>Tt,[e]),f=$.useCallback(()=>e?e.api.getSnapshot():null,[e]);return $.useSyncExternalStore(u,f)}class Sr{constructor(u){Z(this,"typeCode");this.typeCode=u}getJson(){throw new Error("Method should be implemented by subclass.")}}const Au=8;class Pu extends Sr{constructor(f,d){super(Au);Z(this,"methodName");Z(this,"payload");this.methodName=f,this.payload=d}getMethodName(){return this.methodName}getPayload(){return this.payload}getJson(){const f=[this.typeCode,this.methodName];return this.payload!==void 0&&f.push(this.payload),f}}const Mu=0;class Ah extends Sr{constructor(f,d,i){super(Mu);Z(this,"requestId");Z(this,"methodName");Z(this,"payload");this.requestId=f,this.methodName=d,this.payload=i}getJson(){const f=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&f.push(this.payload),f}}const qu=4;class Du extends Sr{constructor(f,d){super(qu);Z(this,"subscriptionId");Z(this,"payload");this.subscriptionId=f,this.payload=d}getPayload(){return this.payload}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const Bu=5;class Lu extends Sr{constructor(f,d){super(Bu);Z(this,"subscriptionId");Z(this,"payload");this.subscriptionId=f,this.payload=d}getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}getJson(){const f=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&f.push(this.payload),f}}const Fu=1;class vr extends Sr{constructor(f,d,i){super(Fu);Z(this,"requestId");Z(this,"methodName");Z(this,"payload");this.requestId=f,this.methodName=d,this.payload=i}setRequestId(f){this.requestId=f}getJson(){const f=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&f.push(this.payload),f}}class Ph{static fromJson(u){if(!Array.isArray(u))throw new Error("Invalid JSON-Rx message: not an array");const f=u[0];if(typeof f!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${f}`);switch(f){case Mu:{const[d,i,c,t]=u;return new Ah(i,c,t)}case Fu:{const[d,i,c,t]=u;return new vr(i,c,t)}case qu:{const[d,i,c]=u;return new Du(i,c)}case Bu:{const[d,i,c]=u;return new Lu(i,c)}case Au:{const[d,i,c]=u;return new Pu(i,c)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${f}`)}}}const Mh=Math.pow(2,31)-1;class qh{constructor(){Z(this,"counter");this.counter=1}getNext(){const u=this.counter;return this.counter+=1,this.counter>Mh&&(this.counter=1),u}}var fi={};const ie=uu(fd);var hi={},Uo;function Dh(){return Uo||(Uo=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var hn={},ee={},pn={},$o;function Ke(){if($o)return pn;$o=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.printTree=void 0;const e=(u="",f)=>{let d="",i=f.length-1;for(;i>=0&&!f[i];i--);for(let c=0;c<=i;c++){const t=f[c];if(!t)continue;const o=c===i,s=t(u+(o?" ":"â”‚")+"  "),r=s?o?"â””â”€":"â”œâ”€":"â”‚";d+=`
`+u+r+(s?" "+s:"")}return d};return pn.printTree=e,pn}var pi={},mi={},zo;function Bh(){return zo||(zo=1,Object.defineProperty(mi,"__esModule",{value:!0})),mi}var gi={},Go;function Lh(){return Go||(Go=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class u{constructor(b,l){this.sid=b,this.time=l}}e.Timestamp=u;class f{constructor(b,l,m){this.sid=b,this.time=l,this.span=m}}e.Timespan=f;const d=(y,b)=>new u(y,b);e.ts=d;const i=(y,b,l)=>new f(y,b,l);e.tss=i;const c=(y,b)=>(0,e.ts)(y.sid,y.time+b);e.tick=c;const t=(y,b)=>y.time===b.time&&y.sid===b.sid;e.equal=t;const o=(y,b)=>{const l=y.time,m=b.time;if(l>m)return 1;if(l<m)return-1;const g=y.sid,v=b.sid;return g>v?1:g<v?-1:0};e.compare=o;const s=(y,b,l,m)=>{if(y.sid!==l.sid)return!1;const g=y.time,v=l.time;return!(g>v||g+b<v+m)};e.contains=s;const r=(y,b,l)=>{if(y.sid!==l.sid)return!1;const m=y.time,g=l.time;return!(m>g||m+b<g+1)};e.containsId=r;const n=y=>{if(y.sid===1)return"."+y.time;let b=""+y.sid;return b.length>4&&(b=".."+b.slice(b.length-4)),b+"."+y.time};e.printTs=n;const a=(y,b,l)=>new f(y.sid,y.time+b,l);e.interval=a;class p extends u{tick(b){const l=new u(this.sid,this.time);return this.time+=b,l}}e.LogicalClock=p;class h extends p{constructor(){super(...arguments),this.peers=new Map}observe(b,l){const m=b.time+l-1,g=b.sid;if(g!==this.sid){const v=this.peers.get(b.sid);v?m>v.time&&(v.time=m):this.peers.set(b.sid,(0,e.ts)(g,m))}m>=this.time&&(this.time=m+1)}clone(){return this.fork(this.sid)}fork(b){const l=new h(b,this.time);return b!==this.sid&&l.observe((0,e.tick)(this,-1),1),this.peers.forEach(m=>{l.observe(m,1)}),l}toString(b=""){const l=this.peers.size;let m=1,g="";return this.peers.forEach(v=>{g+=`
${b}${m===l?"â””â”€":"â”œâ”€"} ${v.sid}.${v.time}`,m++}),`clock ${this.sid}.${this.time}${g}`}}e.ClockVector=h;class w extends p{constructor(){super(...arguments),this.peers=new Map}observe(b,l){if(b.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<b.time)throw new Error("TIME_TRAVEL");const m=b.time+l;m>this.time&&(this.time=m)}clone(){return this.fork()}fork(){return new w(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=w}(gi)),gi}var Wo;function ce(){return Wo||(Wo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(Bh(),e),u.__exportStar(Lh(),e)}(pi)),pi}var Ho;function Jt(){if(Ho)return ee;Ho=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.NopOp=ee.DelOp=ee.UpdArrOp=ee.InsArrOp=ee.InsBinOp=ee.InsStrOp=ee.InsVecOp=ee.InsObjOp=ee.InsValOp=ee.NewArrOp=ee.NewBinOp=ee.NewStrOp=ee.NewVecOp=ee.NewObjOp=ee.NewValOp=ee.NewConOp=void 0;const e=Ke(),u=ce();class f{constructor(v){this.id=v}span(){return 1}toString(){let v=this.name()+" "+(0,u.printTs)(this.id);const _=this.span();return _>1&&(v+="!"+_),v}}class d extends f{constructor(v,_){super(v),this.id=v,this.val=_}name(){return"new_con"}toString(){const v=this.val,_="Uint8Array",S=v instanceof u.Timestamp?`{ ${(0,u.printTs)(v)} }`:v instanceof Uint8Array?v.length<13?`${_} { ${(""+v).replaceAll(",",", ")} }`:`${_}(${v.length})`:`{ ${JSON.stringify(v)} }`;return super.toString()+" "+S}}ee.NewConOp=d;class i extends f{name(){return"new_val"}}ee.NewValOp=i;class c extends f{name(){return"new_obj"}}ee.NewObjOp=c;class t extends f{name(){return"new_vec"}}ee.NewVecOp=t;class o extends f{name(){return"new_str"}}ee.NewStrOp=o;class s extends f{name(){return"new_bin"}}ee.NewBinOp=s;class r extends f{name(){return"new_arr"}}ee.NewArrOp=r;class n extends f{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.val=S}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}, val = ${(0,u.printTs)(this.val)}`}}ee.InsValOp=n;class a extends f{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_obj"}toString(v=""){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${JSON.stringify(S[0])}: ${(0,u.printTs)(S[1])}`))}}ee.InsObjOp=a;class p extends f{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_vec"}toString(v=""){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${S[0]}: ${(0,u.printTs)(S[1])}`))}}ee.InsVecOp=p;class h extends f{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${(0,u.printTs)(this.ref)} â† ${JSON.stringify(this.data)} }`}}ee.InsStrOp=h;class w extends f{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_bin"}toString(){const v=(0,u.printTs)(this.ref);return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${v} â† ${this.data} }`}}ee.InsBinOp=w;class y extends f{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_arr"}toString(){const v=(0,u.printTs)(this.obj),_=(0,u.printTs)(this.ref),S=this.data.map(u.printTs).join(", ");return super.toString()+", obj = "+v+" { "+_+" â† "+S+" }"}}ee.InsArrOp=y;class b extends f{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.val=C}name(){return"upd_arr"}toString(){const v=(0,u.printTs)(this.obj),_=(0,u.printTs)(this.ref),S=(0,u.printTs)(this.val);return super.toString()+", obj = "+v+" { "+_+": "+S+" }"}}ee.UpdArrOp=b;class l extends f{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.what=S}name(){return"del"}toString(){const v=this.what.map(_=>(0,u.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${v} }`}}ee.DelOp=l;class m extends f{constructor(v,_){super(v),this.id=v,this.len=_}span(){return this.len}name(){return"nop"}}return ee.NopOp=m,ee}var mn={},yt={},Jo;function Fr(){return Jo||(Jo=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.hasBuffer=yt.alphabet=void 0,yt.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yt.hasBuffer=typeof Ee.Buffer=="function"&&typeof Ee.Buffer.from=="function"),yt}var gn={},bn={},Ko;function Fh(){if(Ko)return bn;Ko=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.flatstr=void 0;const e=u=>u;return bn.flatstr=e,bn}var Yo;function Uh(){if(Yo)return gn;Yo=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.createToBase64=void 0;const e=Fh(),u=Fr(),f=(d=u.alphabet,i="=")=>{if(d.length!==64)throw new Error("chars must be 64 characters long");const c=d.split(""),t=[];for(const r of c)for(const n of c){const a=(0,e.flatstr)(r+n);t.push(a)}const o=i,s=(0,e.flatstr)(i+i);return(r,n)=>{let a="";const p=n%3,h=n-p;for(let w=0;w<h;w+=3){const y=r[w],b=r[w+1],l=r[w+2],m=y<<4|b>>4,g=(b&15)<<8|l;a+=t[m]+t[g]}if(!p)return a;if(p===1){const w=r[h];a+=t[w<<4]+s}else{const w=r[h],y=r[h+1],b=w<<4|y>>4,l=(y&15)<<2;a+=t[b]+c[l]+o}return a}};return gn.createToBase64=f,gn}var Xo;function Uu(){if(Xo)return mn;Xo=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.toBase64=void 0;const e=Fr(),f=(0,Uh().createToBase64)();return mn.toBase64=e.hasBuffer?d=>{const i=d.length;return i<=48?f(d,i):Ee.Buffer.from(d).toString("base64")}:d=>f(d,d.length),mn}var Qo;function $h(){if(Qo)return hn;Qo=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.encode=void 0;const u=ie.__importStar(Jt()),f=ce(),d=Uu(),i=(o,s)=>{const r=s.sid;return r===o?s.time:[r,s.time]},c=(o,s)=>{const r=i(o,s);return Array.isArray(r)?(r.push(s.span),r):[r,s.span]},t=o=>{const s=o.getId();if(!s)throw new Error("PATCH_EMPTY");const r=s.sid,n=s.time,a=r===1?[n]:[[r,n]],p=o.meta;p!==void 0&&a.push(p);const h=[a];for(const w of o.ops)if(w instanceof u.NewConOp){const y=w.val;y instanceof f.Timestamp?h.push([0,i(r,y),!0]):y===void 0?h.push([0]):h.push([0,y])}else if(w instanceof u.NewValOp)h.push([1]);else if(w instanceof u.NewObjOp)h.push([2]);else if(w instanceof u.NewVecOp)h.push([3]);else if(w instanceof u.NewStrOp)h.push([4]);else if(w instanceof u.NewBinOp)h.push([5]);else if(w instanceof u.NewArrOp)h.push([6]);else if(w instanceof u.InsValOp)h.push([9,i(r,w.obj),i(r,w.val)]);else if(w instanceof u.InsObjOp){const y=[];for(const[l,m]of w.data)y.push([l,i(r,m)]);const b=[10,i(r,w.obj),y];h.push(b)}else if(w instanceof u.InsVecOp){const y=[];for(const[l,m]of w.data)y.push([l,i(r,m)]);const b=[11,i(r,w.obj),y];h.push(b)}else if(w instanceof u.InsStrOp){const y=[12,i(r,w.obj),i(r,w.ref),w.data];h.push(y)}else if(w instanceof u.InsBinOp){const y=[13,i(r,w.obj),i(r,w.ref),(0,d.toBase64)(w.data)];h.push(y)}else if(w instanceof u.InsArrOp){const y=[];for(const l of w.data)y.push(i(r,l));const b=[14,i(r,w.obj),i(r,w.ref),y];h.push(b)}else if(w instanceof u.UpdArrOp){const y=[15,i(r,w.obj),i(r,w.ref),i(r,w.val)];h.push(y)}else if(w instanceof u.DelOp){const y=[16,i(r,w.obj),w.what.map(b=>c(r,b))];h.push(y)}else if(w instanceof u.NopOp){const y=[17],b=w.len;b>1&&y.push(b),h.push(y)}return h};return hn.encode=t,hn}var yn={},vn={},wn={},Zo;function zh(){if(Zo)return wn;Zo=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.bufferToUint8Array=void 0;const e=u=>new Uint8Array(u.buffer,u.byteOffset,u.length);return wn.bufferToUint8Array=e,wn}var _n={},ea;function Gh(){if(ea)return _n;ea=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.createFromBase64=void 0;const e=Fr(),u="=",f=(d=e.alphabet,i=!1)=>{if(d.length!==64)throw new Error("chars must be 64 characters long");let c=0;for(let o=0;o<d.length;o++)c=Math.max(c,d.charCodeAt(o));const t=[];for(let o=0;o<=c;o+=1)t[o]=-1;for(let o=0;o<d.length;o++)t[d.charCodeAt(o)]=o;return o=>{if(!o)return new Uint8Array(0);let s=o.length;if(i){const y=s%4;y===2?(o+="==",s+=2):y===3&&(o+="=",s+=1)}if(s%4!==0)throw new Error("Base64 string length must be a multiple of 4");const r=o[s-1]!==u?s:s-4;let n=(s>>2)*3,a=0;o[s-2]===u?(a=2,n-=2):o[s-1]===u&&(a=1,n-=1);const p=new Uint8Array(n);let h=0,w=0;for(;w<r;w+=4){const y=t[o.charCodeAt(w)],b=t[o.charCodeAt(w+1)],l=t[o.charCodeAt(w+2)],m=t[o.charCodeAt(w+3)];if(y<0||b<0||l<0||m<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|b>>4,p[h+1]=b<<4|l>>2,p[h+2]=l<<6|m,h+=3}if(a===2){const y=t[o.charCodeAt(r)],b=t[o.charCodeAt(r+1)];if(y<0||b<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|b>>4}else if(a===1){const y=t[o.charCodeAt(r)],b=t[o.charCodeAt(r+1)],l=t[o.charCodeAt(r+2)];if(y<0||b<0||l<0)throw new Error("INVALID_BASE64_STRING");p[h]=y<<2|b>>4,p[h+1]=b<<4|l>>2}return p}};return _n.createFromBase64=f,_n}var ta;function Wh(){if(ta)return vn;ta=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.fromBase64=void 0;const e=zh(),u=Fr(),f=Gh(),d=u.hasBuffer?c=>(0,e.bufferToUint8Array)(Ee.Buffer.from(c,"base64")):null,i=(0,f.createFromBase64)();return vn.fromBase64=d?c=>c.length>48?d(c):i(c):i,vn}var Sn={},xn={},na;function hs(){return na||(na=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.isUint8Array=void 0,xn.isUint8Array=typeof Ee.Buffer=="function"?e=>e instanceof Uint8Array||Ee.Buffer.isBuffer(e):e=>e instanceof Uint8Array),xn}var Cn={},bi={},On={},Rn={},Nn={},En={},ra;function Hh(){if(ra)return En;ra=1,Object.defineProperty(En,"__esModule",{value:!0}),En.Slice=void 0;let e=class{constructor(f,d,i,c){this.uint8=f,this.view=d,this.start=i,this.end=c}subarray(){return this.uint8.subarray(this.start,this.end)}};return En.Slice=e,En}var ia;function $u(){if(ia)return Nn;ia=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.Writer=void 0;const e=Hh(),u=new Uint8Array([]),f=new DataView(u.buffer),d=typeof Ee.Buffer=="function",i=d?Ee.Buffer.prototype.utf8Write:null,c=d?Ee.Buffer.from:null,t=typeof TextEncoder<"u"?new TextEncoder:null;let o=class{constructor(r=64*1024){this.allocSize=r,this.view=f,this.x0=0,this.x=0,this.uint8=new Uint8Array(r),this.size=r,this.view=new DataView(this.uint8.buffer)}grow(r){const n=this.x0,a=this.x,p=this.uint8,h=new Uint8Array(r),w=new DataView(h.buffer),y=p.subarray(n,a);h.set(y,0),this.x=a-n,this.x0=0,this.uint8=h,this.size=r,this.view=w}ensureCapacity(r){const n=this.size,a=n-this.x;if(a<r){const p=n-this.x0,h=r-a,w=p+h;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(r){this.ensureCapacity(r),this.x+=r}reset(){this.x0=this.x}newBuffer(r){const n=this.uint8=new Uint8Array(r);this.size=r,this.view=new DataView(n.buffer),this.x=this.x0=0}flush(){const r=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,r}flushSlice(){const r=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,r}u8(r){this.ensureCapacity(1),this.uint8[this.x++]=r}u16(r){this.ensureCapacity(2),this.view.setUint16(this.x,r),this.x+=2}u32(r){this.ensureCapacity(4),this.view.setUint32(this.x,r),this.x+=4}i32(r){this.ensureCapacity(4),this.view.setInt32(this.x,r),this.x+=4}u64(r){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(r)),this.x+=8}f64(r){this.ensureCapacity(8),this.view.setFloat64(this.x,r),this.x+=8}u8u16(r,n){this.ensureCapacity(3);let a=this.x;this.uint8[a++]=r,this.uint8[a++]=n>>>8,this.uint8[a++]=n&255,this.x=a}u8u32(r,n){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=r,this.view.setUint32(a,n),this.x=a+4}u8u64(r,n){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=r,this.view.setBigUint64(a,BigInt(n)),this.x=a+8}u8f32(r,n){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=r,this.view.setFloat32(a,n),this.x=a+4}u8f64(r,n){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=r,this.view.setFloat64(a,n),this.x=a+8}buf(r,n){this.ensureCapacity(n);const a=this.x;this.uint8.set(r,a),this.x=a+n}utf8(r){const n=r.length*4;if(n<168)return this.utf8Native(r);if(i){const a=i.call(this.uint8,r,this.x,n);return this.x+=a,a}else if(c){const a=this.uint8,p=a.byteOffset+this.x,w=c(a.buffer).subarray(p,p+n).write(r,0,n,"utf8");return this.x+=w,w}else if(n>1024&&t){const a=t.encodeInto(r,this.uint8.subarray(this.x,this.x+n)).written;return this.x+=a,a}return this.utf8Native(r)}utf8Native(r){const n=r.length,a=this.uint8;let p=this.x,h=0;for(;h<n;){let y=r.charCodeAt(h++);if((y&4294967168)===0){a[p++]=y;continue}else if((y&4294965248)===0)a[p++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&h<n){const b=r.charCodeAt(h);(b&64512)===56320&&(h++,y=((y&1023)<<10)+(b&1023)+65536)}(y&4294901760)===0?(a[p++]=y>>12&15|224,a[p++]=y>>6&63|128):(a[p++]=y>>18&7|240,a[p++]=y>>12&63|128,a[p++]=y>>6&63|128)}a[p++]=y&63|128}const w=p-this.x;return this.x=p,w}ascii(r){const n=r.length;this.ensureCapacity(n);const a=this.uint8;let p=this.x,h=0;for(;h<n;)a[p++]=r.charCodeAt(h++);this.x=p}};return Nn.Writer=o,Nn}var sa;function ps(){if(sa)return Rn;sa=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.CrdtWriter=void 0;const e=$u();let u=class extends e.Writer{id(d,i){d<=7&&i<=15?this.u8(d<<4|i):(this.b1vu56(1,d),this.vu57(i))}vu57(d){if(d<=127)this.u8(d);else if(d<=16383){this.ensureCapacity(2);const i=this.uint8;i[this.x++]=128|d&127,i[this.x++]=d>>>7}else if(d<=2097151){this.ensureCapacity(3);const i=this.uint8;i[this.x++]=128|d&127,i[this.x++]=128|d>>>7&127,i[this.x++]=d>>>14}else if(d<=268435455){this.ensureCapacity(4);const i=this.uint8;i[this.x++]=128|d&127,i[this.x++]=128|d>>>7&127,i[this.x++]=128|d>>>14&127,i[this.x++]=d>>>21}else{let i=d|0;i<0&&(i+=4294967296);const c=(d-i)/4294967296;if(d<=34359738367){this.ensureCapacity(5);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=c<<4|d>>>28}else if(d<=4398046511103){this.ensureCapacity(6);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=c>>>3}else if(d<=562949953421311){this.ensureCapacity(7);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=128|(c&1016)>>>3,t[this.x++]=c>>>10}else{this.ensureCapacity(8);const t=this.uint8;t[this.x++]=128|d&127,t[this.x++]=128|d>>>7&127,t[this.x++]=128|d>>>14&127,t[this.x++]=128|d>>>21&127,t[this.x++]=128|(c&7)<<4|d>>>28,t[this.x++]=128|(c&1016)>>>3,t[this.x++]=128|(c&130048)>>>10,t[this.x++]=c>>>17}}}b1vu56(d,i){if(i<=63)this.u8(d<<7|i);else{const c=d<<7|64;if(i<=8191){this.ensureCapacity(2);const t=this.uint8;t[this.x++]=c|i&63,t[this.x++]=i>>>6}else if(i<=1048575){this.ensureCapacity(3);const t=this.uint8;t[this.x++]=c|i&63,t[this.x++]=128|i>>>6&127,t[this.x++]=i>>>13}else if(i<=134217727){this.ensureCapacity(4);const t=this.uint8;t[this.x++]=c|i&63,t[this.x++]=128|i>>>6&127,t[this.x++]=128|i>>>13&127,t[this.x++]=i>>>20}else{let t=i|0;t<0&&(t+=4294967296);const o=(i-t)/4294967296;if(i<=17179869183){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=c|i&63,s[this.x++]=128|i>>>6&127,s[this.x++]=128|i>>>13&127,s[this.x++]=128|i>>>20&127,s[this.x++]=o<<5|i>>>27}else if(i<=2199023255551){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=c|i&63,s[this.x++]=128|i>>>6&127,s[this.x++]=128|i>>>13&127,s[this.x++]=128|i>>>20&127,s[this.x++]=128|(o&3)<<5|i>>>27,s[this.x++]=o>>>2}else if(i<=0xffffffffffff){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=c|i&63,s[this.x++]=128|i>>>6&127,s[this.x++]=128|i>>>13&127,s[this.x++]=128|i>>>20&127,s[this.x++]=128|(o&3)<<5|i>>>27,s[this.x++]=128|(o&508)>>>2,s[this.x++]=o>>>9}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=c|i&63,s[this.x++]=128|i>>>6&127,s[this.x++]=128|i>>>13&127,s[this.x++]=128|i>>>20&127,s[this.x++]=128|(o&3)<<5|i>>>27,s[this.x++]=128|(o&508)>>>2,s[this.x++]=128|(o&65024)>>>9,s[this.x++]=o>>>16}}}}};return Rn.CrdtWriter=u,Rn}var Tn={},In={},oa;function Jh(){if(oa)return In;oa=1,Object.defineProperty(In,"__esModule",{value:!0}),In.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),u=f=>(e.setFloat32(0,f),f===e.getFloat32(0));return In.isFloat32=u,In}var kn={},aa;function zu(){if(aa)return kn;aa=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.JsonPackExtension=void 0;let e=class{constructor(f,d){this.tag=f,this.val=d}};return kn.JsonPackExtension=e,kn}var jn={},la;function Kh(){if(la)return jn;la=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.CborEncoderFast=void 0;const e=$u(),u=Number.isSafeInteger;let f=class{constructor(i=new e.Writer){this.writer=i}encode(i){return this.writeAny(i),this.writer.flush()}encodeToSlice(i){return this.writeAny(i),this.writer.flushSlice()}writeAny(i){switch(typeof i){case"number":return this.writeNumber(i);case"string":return this.writeStr(i);case"boolean":return this.writer.u8(244+ +i);case"object":{if(!i)return this.writer.u8(246);switch(i.constructor){case Array:return this.writeArr(i);default:return this.writeObj(i)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(i){i?this.writer.u8(245):this.writer.u8(244)}writeNumber(i){u(i)?this.writeInteger(i):typeof i=="bigint"?this.writeBigInt(i):this.writeFloat(i)}writeBigInt(i){i>=0?this.writeBigUint(i):this.writeBigSint(i)}writeBigUint(i){if(i<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(i));this.writer.u8u64(27,i)}writeBigSint(i){if(i>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(i));const c=-BigInt(1)-i;this.writer.u8u64(59,c)}writeInteger(i){i>=0?this.writeUInteger(i):this.encodeNint(i)}writeUInteger(i){const c=this.writer;c.ensureCapacity(9);const t=c.uint8;let o=c.x;i<=23?t[o++]=0+i:i<=255?(t[o++]=24,t[o++]=i):i<=65535?(t[o++]=25,c.view.setUint16(o,i),o+=2):i<=4294967295?(t[o++]=26,c.view.setUint32(o,i),o+=4):(t[o++]=27,c.view.setBigUint64(o,BigInt(i)),o+=8),c.x=o}encodeNumber(i){this.writeNumber(i)}encodeInteger(i){this.writeInteger(i)}encodeUint(i){this.writeUInteger(i)}encodeNint(i){const c=-1-i,t=this.writer;t.ensureCapacity(9);const o=t.uint8;let s=t.x;c<24?o[s++]=32+c:c<=255?(o[s++]=56,o[s++]=c):c<=65535?(o[s++]=57,t.view.setUint16(s,c),s+=2):c<=4294967295?(o[s++]=58,t.view.setUint32(s,c),s+=4):(o[s++]=59,t.view.setBigUint64(s,BigInt(c)),s+=8),t.x=s}writeFloat(i){this.writer.u8f64(251,i)}writeBin(i){const c=i.length;this.writeBinHdr(c),this.writer.buf(i,c)}writeBinHdr(i){const c=this.writer;i<=23?c.u8(64+i):i<=255?c.u16(22528+i):i<=65535?c.u8u16(89,i):i<=4294967295?c.u8u32(90,i):c.u8u64(91,i)}writeStr(i){const c=this.writer,o=i.length*4;c.ensureCapacity(5+o);const s=c.uint8;let r=c.x;o<=23?c.x++:o<=255?(s[c.x++]=120,r=c.x,c.x++):o<=65535?(s[c.x++]=121,r=c.x,c.x+=2):(s[c.x++]=122,r=c.x,c.x+=4);const n=c.utf8(i);o<=23?s[r]=96+n:o<=255?s[r]=n:o<=65535?c.view.setUint16(r,n):c.view.setUint32(r,n)}writeStrHdr(i){const c=this.writer;i<=23?c.u8(96+i):i<=255?c.u16(30720+i):i<=65535?c.u8u16(121,i):c.u8u32(122,i)}writeAsciiStr(i){this.writeStrHdr(i.length),this.writer.ascii(i)}writeArr(i){const c=i.length;this.writeArrHdr(c);for(let t=0;t<c;t++)this.writeAny(i[t])}writeArrHdr(i){const c=this.writer;i<=23?c.u8(128+i):i<=255?c.u16(38912+i):i<=65535?c.u8u16(153,i):i<=4294967295?c.u8u32(154,i):c.u8u64(155,i)}writeObj(i){const c=Object.keys(i),t=c.length;this.writeObjHdr(t);for(let o=0;o<t;o++){const s=c[o];this.writeStr(s),this.writeAny(i[s])}}writeObjHdr(i){const c=this.writer;i<=23?c.u8(160+i):i<=255?c.u16(47104+i):i<=65535?c.u8u16(185,i):i<=4294967295?c.u8u32(186,i):c.u8u64(187,i)}writeMapHdr(i){this.writeObjHdr(i)}writeStartMap(){this.writer.u8(191)}writeTag(i,c){this.writeTagHdr(i),this.writeAny(c)}writeTagHdr(i){const c=this.writer;i<=23?c.u8(192+i):i<=255?c.u16(55296+i):i<=65535?c.u8u16(217,i):i<=4294967295?c.u8u32(218,i):c.u8u64(219,i)}writeTkn(i){const c=this.writer;i<=23?c.u8(224+i):i<=255&&c.u16(63488+i)}writeStartStr(){this.writer.u8(127)}writeStrChunk(i){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(i){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(i){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(i,c){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return jn.CborEncoderFast=f,jn}var Vn={},ua;function ms(){if(ua)return Vn;ua=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.JsonPackValue=void 0;let e=class{constructor(f){this.val=f}};return Vn.JsonPackValue=e,Vn}var ca;function Gu(){if(ca)return Tn;ca=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.CborEncoder=void 0;const e=Jh(),u=zu(),f=Kh(),d=ms();let i=class extends f.CborEncoderFast{writeUnknown(t){this.writeNull()}writeAny(t){switch(typeof t){case"number":return this.writeNumber(t);case"string":return this.writeStr(t);case"boolean":return this.writer.u8(244+ +t);case"object":{if(!t)return this.writer.u8(246);switch(t.constructor){case Object:return this.writeObj(t);case Array:return this.writeArr(t);case Uint8Array:return this.writeBin(t);case Map:return this.writeMap(t);case u.JsonPackExtension:return this.writeTag(t.tag,t.val);case d.JsonPackValue:const s=t.val;return this.writer.buf(s,s.length);default:return t instanceof Uint8Array?this.writeBin(t):Array.isArray(t)?this.writeArr(t):t instanceof Map?this.writeMap(t):this.writeUnknown(t)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(t);default:return this.writeUnknown(t)}}writeFloat(t){(0,e.isFloat32)(t)?this.writer.u8f32(250,t):this.writer.u8f64(251,t)}writeMap(t){this.writeMapHdr(t.size),t.forEach((o,s)=>{this.writeAny(s),this.writeAny(o)})}writeUndef(){this.writer.u8(247)}};return Tn.CborEncoder=i,Tn}var da;function Wu(){if(da)return On;da=1,Object.defineProperty(On,"__esModule",{value:!0}),On.Encoder=void 0;const u=ie.__importStar(Jt()),f=ps(),d=ce(),i=Gu();class c extends i.CborEncoder{constructor(o=new f.CrdtWriter){super(o),this.writer=o,this.patchSid=0}encode(o){this.writer.reset();const s=o.getId(),r=this.patchSid=s.sid,n=this.writer;n.vu57(r),n.vu57(s.time);const a=o.meta;return a===void 0?this.writeUndef():this.writeArr([a]),this.encodeOperations(o),n.flush()}encodeOperations(o){const s=o.ops,r=s.length;this.writer.vu57(r);for(let n=0;n<r;n++)this.encodeOperation(s[n])}encodeId(o){const s=o.sid,r=o.time,n=this.writer;s===this.patchSid?n.b1vu56(0,r):(n.b1vu56(1,r),n.vu57(s))}encodeTss(o){this.encodeId(o),this.writer.vu57(o.span)}writeInsStr(o,s,r,n){const a=this.writer;return o<=7?a.u8(96+o):(a.u8(96),a.vu57(o)),this.encodeId(s),this.encodeId(r),a.utf8(n)}encodeOperation(o){const s=this.writer;switch(o.constructor){case u.NewConOp:{const a=o.val;a instanceof d.Timestamp?(s.u8(1),this.encodeId(a)):(s.u8(0),this.writeAny(a));break}case u.NewValOp:{s.u8(8);break}case u.NewObjOp:{s.u8(16);break}case u.NewVecOp:{s.u8(24);break}case u.NewStrOp:{s.u8(32);break}case u.NewBinOp:{s.u8(40);break}case u.NewArrOp:{s.u8(48);break}case u.InsValOp:{const n=o;s.u8(72),this.encodeId(n.obj),this.encodeId(n.val);break}case u.InsObjOp:{const n=o,a=n.data,p=a.length;p<=7?s.u8(80+p):(s.u8(80),s.vu57(p)),this.encodeId(n.obj);for(let h=0;h<p;h++){const w=a[h];this.writeStr(w[0]),this.encodeId(w[1])}break}case u.InsVecOp:{const n=o,a=n.data,p=a.length;p<=7?s.u8(88+p):(s.u8(88),s.vu57(p)),this.encodeId(n.obj);for(let h=0;h<p;h++){const w=a[h];s.u8(w[0]),this.encodeId(w[1])}break}case u.InsStrOp:{const n=o,a=n.obj,p=n.ref,h=n.data,w=h.length;s.ensureCapacity(24+w*4);const y=s.x,b=this.writeInsStr(w,a,p,h);w!==b&&(s.x=y,this.writeInsStr(b,a,p,h));break}case u.InsBinOp:{const n=o,a=n.data,p=a.length;p<=7?s.u8(104+p):(s.u8(104),s.vu57(p)),this.encodeId(n.obj),this.encodeId(n.ref),s.buf(a,p);break}case u.InsArrOp:{const n=o,a=n.data,p=a.length;p<=7?s.u8(112+p):(s.u8(112),s.vu57(p)),this.encodeId(n.obj),this.encodeId(n.ref);for(let h=0;h<p;h++)this.encodeId(a[h]);break}case u.UpdArrOp:{const n=o;s.u8(120),this.encodeId(n.obj),this.encodeId(n.ref),this.encodeId(n.val);break}case u.DelOp:{const n=o,a=n.what,p=a.length;p<=7?s.u8(128+p):(s.u8(128),s.vu57(p)),this.encodeId(n.obj);for(let h=0;h<p;h++)this.encodeTss(a[h]);break}case u.NopOp:{const a=o.len;a<=7?s.u8(136+a):(s.u8(136),s.vu57(a));break}default:throw new Error("UNKNOWN_OP")}}}return On.Encoder=c,On}var An={},Pn={},Mn={},qn={},Er={},vt={},fa;function Yh(){if(fa)return vt;fa=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.decodeAsciiMax15=vt.decodeAscii=void 0;const e=String.fromCharCode,u=(d,i,c)=>{const t=[];for(let o=0;o<c;o++){const s=d[i++];if(s&128)return;t.push(s)}return e.apply(String,t)};vt.decodeAscii=u;const f=(d,i,c)=>{if(c<4)if(c<2){if(c===0)return"";{const t=d[i++];if((t&128)>1){i-=1;return}return e(t)}}else{const t=d[i++],o=d[i++];if((t&128)>0||(o&128)>0){i-=2;return}if(c<3)return e(t,o);const s=d[i++];if((s&128)>0){i-=3;return}return e(t,o,s)}else{const t=d[i++],o=d[i++],s=d[i++],r=d[i++];if((t&128)>0||(o&128)>0||(s&128)>0||(r&128)>0){i-=4;return}if(c<6){if(c===4)return e(t,o,s,r);{const n=d[i++];if((n&128)>0){i-=5;return}return e(t,o,s,r,n)}}else if(c<8){const n=d[i++],a=d[i++];if((n&128)>0||(a&128)>0){i-=6;return}if(c<7)return e(t,o,s,r,n,a);const p=d[i++];if((p&128)>0){i-=7;return}return e(t,o,s,r,n,a,p)}else{const n=d[i++],a=d[i++],p=d[i++],h=d[i++];if((n&128)>0||(a&128)>0||(p&128)>0||(h&128)>0){i-=8;return}if(c<10){if(c===8)return e(t,o,s,r,n,a,p,h);{const w=d[i++];if((w&128)>0){i-=9;return}return e(t,o,s,r,n,a,p,h,w)}}else if(c<12){const w=d[i++],y=d[i++];if((w&128)>0||(y&128)>0){i-=10;return}if(c<11)return e(t,o,s,r,n,a,p,h,w,y);const b=d[i++];if((b&128)>0){i-=11;return}return e(t,o,s,r,n,a,p,h,w,y,b)}else{const w=d[i++],y=d[i++],b=d[i++],l=d[i++];if((w&128)>0||(y&128)>0||(b&128)>0||(l&128)>0){i-=12;return}if(c<14){if(c===12)return e(t,o,s,r,n,a,p,h,w,y,b,l);{const m=d[i++];if((m&128)>0){i-=13;return}return e(t,o,s,r,n,a,p,h,w,y,b,l,m)}}else{const m=d[i++],g=d[i++];if((m&128)>0||(g&128)>0){i-=14;return}if(c<15)return e(t,o,s,r,n,a,p,h,w,y,b,l,m,g);const v=d[i++];if((v&128)>0){i-=15;return}return e(t,o,s,r,n,a,p,h,w,y,b,l,m,g,v)}}}}};return vt.decodeAsciiMax15=f,vt}var Tr={},ha;function Xh(){if(ha)return Tr;ha=1,Object.defineProperty(Tr,"__esModule",{value:!0});const e=String.fromCharCode;return Tr.default=(u,f,d)=>{let i=f;const c=i+d,t=[];for(;i<c;){let o=u[i++];if((o&128)!==0){const s=u[i++]&63;if((o&224)===192)o=(o&31)<<6|s;else{const r=u[i++]&63;if((o&240)===224)o=(o&31)<<12|s<<6|r;else if((o&248)===240){const n=u[i++]&63;let a=(o&7)<<18|s<<12|r<<6|n;if(a>65535){a-=65536;const p=a>>>10&1023|55296;o=56320|a&1023,t.push(p)}else o=a}}}t.push(o)}return e.apply(String,t)},Tr}var pa;function Qh(){if(pa)return Er;pa=1,Object.defineProperty(Er,"__esModule",{value:!0});const e=ie,u=Yh(),f=e.__importDefault(Xh()),d=typeof Ee.Buffer<"u",i=d?Ee.Buffer.prototype.utf8Slice:null,c=d?Ee.Buffer.from:null,t=(n,a,p)=>(0,u.decodeAsciiMax15)(n,a,p)??(0,f.default)(n,a,p),o=(n,a,p)=>(0,u.decodeAscii)(n,a,p)??(0,f.default)(n,a,p),s=i?(n,a,p)=>i.call(n,a,a+p):c?(n,a,p)=>c(n).subarray(a,a+p).toString("utf8"):f.default,r=(n,a,p)=>p<16?t(n,a,p):p<32?o(n,a,p):s(n,a,p);return Er.default=r,Er}var ma;function Zh(){if(ma)return qn;ma=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.decodeUtf8=void 0;const u=ie.__importDefault(Qh());return qn.decodeUtf8=u.default,qn}var ga;function Hu(){if(ga)return Mn;ga=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.Reader=void 0;const e=Zh();let u=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(d){this.x=0,this.uint8=d,this.view=new DataView(d.buffer,d.byteOffset,d.length)}peak(){return this.view.getUint8(this.x)}skip(d){this.x+=d}buf(d){const i=this.x+d,c=this.uint8.subarray(this.x,i);return this.x=i,c}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let d=this.x;const i=(this.uint8[d++]<<8)+this.uint8[d++];return this.x=d,i}i16(){const d=this.view.getInt16(this.x);return this.x+=2,d}u32(){const d=this.view.getUint32(this.x);return this.x+=4,d}i32(){const d=this.view.getInt32(this.x);return this.x+=4,d}u64(){const d=this.view.getBigUint64(this.x);return this.x+=8,d}i64(){const d=this.view.getBigInt64(this.x);return this.x+=8,d}f32(){const d=this.x;return this.x+=4,this.view.getFloat32(d)}f64(){const d=this.x;return this.x+=8,this.view.getFloat64(d)}utf8(d){const i=this.x;return this.x+=d,(0,e.decodeUtf8)(this.uint8,i,d)}ascii(d){const i=this.uint8;let c="";const t=this.x+d;for(let o=this.x;o<t;o++)c+=String.fromCharCode(i[o]);return this.x=t,c}};return Mn.Reader=u,Mn}var ba;function Ju(){if(ba)return Pn;ba=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.CrdtReader=void 0;const e=Hu();let u=class extends e.Reader{id(){const d=this.u8();return d<=127?[d>>>4,d&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const d=this.u8();if(d<=127)return d;const i=this.u8();if(i<=127)return i<<7|d&127;const c=this.u8();if(c<=127)return c<<14|(i&127)<<7|d&127;const t=this.u8();if(t<=127)return t<<21|(c&127)<<14|(i&127)<<7|d&127;const o=this.u8();if(o<=127)return o*268435456+((t&127)<<21|(c&127)<<14|(i&127)<<7|d&127);const s=this.u8();if(s<=127)return s*34359738368+((o&127)*268435456+((t&127)<<21|(c&127)<<14|(i&127)<<7|d&127));const r=this.u8();return r<=127?r*4398046511104+((s&127)*34359738368+((o&127)*268435456+((t&127)<<21|(c&127)<<14|(i&127)<<7|d&127))):this.u8()*562949953421312+((r&127)*4398046511104+((s&127)*34359738368+((o&127)*268435456+((t&127)<<21|(c&127)<<14|(i&127)<<7|d&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const d=this.u8(),i=d&128?1:0,c=127&d;if(c<=63)return[i,c];const t=this.u8();if(t<=127)return[i,t<<6|c&63];const o=this.u8();if(o<=127)return[i,o<<13|(t&127)<<6|c&63];const s=this.u8();if(s<=127)return[i,s<<20|(o&127)<<13|(t&127)<<6|c&63];const r=this.u8();if(r<=127)return[i,r*134217728+((s&127)<<20|(o&127)<<13|(t&127)<<6|c&63)];const n=this.u8();if(n<=127)return[i,n*17179869184+((r&127)*134217728+((s&127)<<20|(o&127)<<13|(t&127)<<6|c&63))];const a=this.u8();if(a<=127)return[i,a*2199023255552+((n&127)*17179869184+((r&127)*134217728+((s&127)<<20|(o&127)<<13|(t&127)<<6|c&63)))];const p=this.u8();return[i,p*281474976710656+((a&127)*2199023255552+((n&127)*17179869184+((r&127)*134217728+((s&127)<<20|(o&127)<<13|(t&127)<<6|c&63))))]}};return Pn.CrdtReader=u,Pn}var Dn={},Bn={},Ln={},ya;function ep(){if(ya)return Ln;ya=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.decodeF16=void 0;const e=Math.pow,u=f=>{const d=(f&31744)>>10,i=f&1023;return(f>>15?-1:1)*(d?d===31?i?NaN:1/0:e(2,d-15)*(1+i/1024):6103515625e-14*(i/1024))};return Ln.decodeF16=u,Ln}var Ir={},Fn={},kr={},va;function tp(){if(va)return kr;va=1,Object.defineProperty(kr,"__esModule",{value:!0});const e=String.fromCharCode;return kr.default=(u,f,d)=>{let i=f;const c=i+d;let t="";for(;i<c;){const o=u[i++];if((o&128)===0){t+=e(o);continue}const s=u[i++]&63;if((o&224)===192){t+=e((o&31)<<6|s);continue}const r=u[i++]&63;if((o&240)===224){t+=e((o&31)<<12|s<<6|r);continue}if((o&248)===240){const n=u[i++]&63;let a=(o&7)<<18|s<<12|r<<6|n;if(a>65535){a-=65536;const p=a>>>10&1023|55296;a=56320|a&1023,t+=e(p,a)}else t+=e(a)}else t+=e(o)}return t},kr}var wa;function np(){if(wa)return Fn;wa=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.CachedUtf8Decoder=void 0;const u=ie.__importDefault(tp());let f=1+Math.round(Math.random()*((-1>>>0)-1));function d(t,o){return f^=f<<13,f^=f>>>17,f^=f<<5,(f>>>0)%(o-t+1)+t}class i{constructor(o,s){this.bytes=o,this.value=s}}let c=class{constructor(){this.caches=[];for(let o=0;o<31;o++)this.caches.push([])}get(o,s,r){const n=this.caches[r-1],a=n.length;e:for(let p=0;p<a;p++){const h=n[p],w=h.bytes;for(let y=0;y<r;y++)if(w[y]!==o[s+y])continue e;return h.value}return null}store(o,s){const r=this.caches[o.length-1],n=new i(o,s);r.length>=16?r[d(0,15)]=n:r.push(n)}decode(o,s,r){if(!r)return"";const n=this.get(o,s,r);if(n!==null)return n;const a=(0,u.default)(o,s,r),p=Uint8Array.prototype.slice.call(o,s,s+r);return this.store(p,a),a}};return Fn.CachedUtf8Decoder=c,Fn}var _a;function rp(){if(_a)return Ir;_a=1,Object.defineProperty(Ir,"__esModule",{value:!0});const e=np();return Ir.default=new e.CachedUtf8Decoder,Ir}var Sa;function Ku(){if(Sa)return Bn;Sa=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.CborDecoderBase=void 0;const e=ie,u=ep(),f=zu(),d=ms(),i=Hu(),c=e.__importDefault(rp());let t=class{constructor(s=new i.Reader,r=c.default){this.reader=s,this.keyDecoder=r}read(s){return this.reader.reset(s),this.val()}decode(s){return this.reader.reset(s),this.val()}val(){const r=this.reader.u8(),n=r>>5,a=r&31;return n<4?n<2?n===0?this.readUint(a):this.readNint(a):n===2?this.readBin(a):this.readStr(a):n<6?n===4?this.readArr(a):this.readObj(a):n===6?this.readTag(a):this.readTkn(a)}readAnyRaw(s){const r=s>>5,n=s&31;return r<4?r<2?r===0?this.readUint(n):this.readNint(n):r===2?this.readBin(n):this.readStr(n):r<6?r===4?this.readArr(n):this.readObj(n):r===6?this.readTag(n):this.readTkn(n)}readMinorLen(s){if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(s){if(s<25)return s===24?this.reader.u8():s;if(s<27)return s===25?this.reader.u16():this.reader.u32();{const r=this.reader.u64();return r>9007199254740991?r:Number(r)}}readNint(s){if(s<25)return s===24?-this.reader.u8()-1:-s-1;if(s<27)return s===25?-this.reader.u16()-1:-this.reader.u32()-1;{const r=this.reader.u64();return r>9007199254740991-1?-r-BigInt(1):-Number(r)-1}}readBin(s){const r=this.reader;if(s<=23)return r.buf(s);switch(s){case 24:return r.buf(r.u8());case 25:return r.buf(r.u16());case 26:return r.buf(r.u32());case 27:return r.buf(Number(r.u64()));case 31:{let n=0;const a=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();n+=y.length,a.push(y)}this.reader.x++;const p=new Uint8Array(n);let h=0;const w=a.length;for(let y=0;y<w;y++){const b=a[y];p.set(b,h),h+=b.length}return p}default:throw 1}}readBinChunk(){const s=this.reader.u8(),r=s>>5,n=s&31;if(r!==2)throw 2;if(n>27)throw 3;return this.readBin(n)}readAsStr(){const r=this.reader.u8(),n=r>>5,a=r&31;if(n!==3)throw 11;return this.readStr(a)}readStr(s){const r=this.reader;if(s<=23)return r.utf8(s);switch(s){case 24:return r.utf8(r.u8());case 25:return r.utf8(r.u16());case 26:return r.utf8(r.u32());case 27:return r.utf8(Number(r.u64()));case 31:{let n="";for(;r.peak()!==255;)n+=this.readStrChunk();return this.reader.x++,n}default:throw 1}}readStrLen(s){if(s<=23)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const s=this.reader.u8(),r=s>>5,n=s&31;if(r!==3)throw 4;if(n>27)throw 5;return this.readStr(n)}readArr(s){const r=this.readMinorLen(s);return r>=0?this.readArrRaw(r):this.readArrIndef()}readArrRaw(s){const r=[];for(let n=0;n<s;n++)r.push(this.val());return r}readArrIndef(){const s=[];for(;this.reader.peak()!==255;)s.push(this.val());return this.reader.x++,s}readObj(s){if(s<28){let r=s;switch(s){case 24:r=this.reader.u8();break;case 25:r=this.reader.u16();break;case 26:r=this.reader.u32();break;case 27:r=Number(this.reader.u64());break}const n={};for(let a=0;a<r;a++){const p=this.key();if(p==="__proto__")throw 6;const h=this.val();n[p]=h}return n}else{if(s===31)return this.readObjIndef();throw 1}}readObjRaw(s){const r={};for(let n=0;n<s;n++){const a=this.key(),p=this.val();r[a]=p}return r}readObjIndef(){const s={};for(;this.reader.peak()!==255;){const r=this.key();if(this.reader.peak()===255)throw 7;const n=this.val();s[r]=n}return this.reader.x++,s}key(){const s=this.reader.u8(),r=s>>5,n=s&31;if(r!==3)return String(this.readAnyRaw(s));const a=this.readStrLen(n);if(a>31)return this.reader.utf8(a);const p=this.keyDecoder.decode(this.reader.uint8,this.reader.x,a);return this.reader.skip(a),p}readTag(s){if(s<=23)return this.readTagRaw(s);switch(s){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(s){return new f.JsonPackExtension(s,this.val())}readTkn(s){switch(s){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new d.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(s<=23)return new d.JsonPackValue(s);throw 1}f16(){return(0,u.decodeF16)(this.reader.u16())}};return Bn.CborDecoderBase=t,Bn}var xa;function ip(){if(xa)return Dn;xa=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.CborDecoder=void 0;const e=Ku(),u=ms();let f=class extends e.CborDecoderBase{readAsMap(){const i=this.reader.u8(),c=i>>5,t=i&31;switch(c){case 5:return this.readMap(t);default:throw 0}}readMap(i){const c=this.readMinorLen(i);return c>=0?this.readMapRaw(c):this.readMapIndef()}readMapRaw(i){const c=new Map;for(let t=0;t<i;t++){const o=this.val(),s=this.val();c.set(o,s)}return c}readMapIndef(){const i=new Map;for(;this.reader.peak()!==255;){const c=this.val();if(this.reader.peak()===255)throw 7;const t=this.val();i.set(c,t)}return this.reader.x++,i}skipN(i){for(let c=0;c<i;c++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(i){const c=i>>5,t=i&31;switch(c){case 0:case 1:this.skipUNint(t);break;case 2:this.skipBin(t);break;case 3:this.skipStr(t);break;case 4:this.skipArr(t);break;case 5:this.skipObj(t);break;case 7:this.skipTkn(t);break;case 6:this.skipTag(t);break}}skipMinorLen(i){if(i<=23)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(i){if(!(i<=23))switch(i){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(i){const c=this.skipMinorLen(i);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const i=this.reader.u8(),c=i>>5,t=i&31;if(c!==2)throw 2;if(t>27)throw 3;this.skipBin(t)}skipStr(i){const c=this.skipMinorLen(i);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const i=this.reader.u8(),c=i>>5,t=i&31;if(c!==3)throw 4;if(t>27)throw 5;this.skipStr(t)}skipArr(i){const c=this.skipMinorLen(i);if(c>=0)this.skipN(c);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(i){const c=this.readMinorLen(i);if(c>=0)return this.skipN(c*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(i){if(this.skipMinorLen(i)<0)throw 1;this.skipAny()}skipTkn(i){switch(i){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(i<=23))throw 1}validate(i,c=0,t=i.length){this.reader.reset(i),this.reader.x=c;const o=c;if(this.skipAny(),this.reader.x-o!==t)throw 8}decodeLevel(i){return this.reader.reset(i),this.readLevel()}readLevel(){const i=this.reader.u8(),c=i>>5,t=i&31;switch(c){case 4:return this.readArrLevel(t);case 5:return this.readObjLevel(t);default:return super.readAnyRaw(i)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const i=this.reader,c=i.x;this.skipAny();const t=i.x;return new u.JsonPackValue(i.uint8.subarray(c,t))}readObjLevel(i){const c=this.readMinorLen(i);return c>=0?this.readObjRawLevel(c):this.readObjIndefLevel()}readObjRawLevel(i){const c={};for(let t=0;t<i;t++){const o=this.key(),s=this.readPrimitiveOrVal();c[o]=s}return c}readObjIndefLevel(){const i={};for(;this.reader.peak()!==255;){const c=this.key();if(this.reader.peak()===255)throw 7;const t=this.readPrimitiveOrVal();i[c]=t}return this.reader.x++,i}readArrLevel(i){const c=this.readMinorLen(i);return c>=0?this.readArrRawLevel(c):this.readArrIndefLevel()}readArrRawLevel(i){const c=[];for(let t=0;t<i;t++)c.push(this.readPrimitiveOrVal());return c}readArrIndefLevel(){const i=[];for(;this.reader.peak()!==255;)i.push(this.readPrimitiveOrVal());return this.reader.x++,i}readHdr(i){const c=this.reader.u8();if(c>>5!==i)throw 0;const o=c&31;if(o<24)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(i){const c=this.readObjHdr();for(let t=0;t<c;t++){if(this.key()===i)return this;this.skipAny()}throw 9}findIndex(i){const c=this.readArrHdr();if(i>=c)throw 10;for(let t=0;t<i;t++)this.skipAny();return this}find(i){for(let c=0;c<i.length;c++){const t=i[c];typeof t=="string"?this.findKey(t):this.findIndex(t)}return this}};return Dn.CborDecoder=f,Dn}var Ca;function Yu(){if(Ca)return An;Ca=1,Object.defineProperty(An,"__esModule",{value:!0}),An.Decoder=void 0;const e=Ju(),u=ce(),f=$r(),d=ip();class i extends d.CborDecoder{constructor(t=new e.CrdtReader){super(t)}decode(t){return this.reader.reset(t),this.readPatch()}readPatch(){const t=this.reader,o=t.vu57(),s=t.vu57(),n=o===1?new u.ServerClockVector(1,s):new u.ClockVector(o,s);this.patchSid=n.sid;const a=this.builder=new f.PatchBuilder(n),p=this.val();return Array.isArray(p)&&(a.patch.meta=p[0]),this.decodeOperations(),a.patch}decodeId(){const t=this.reader,[o,s]=t.b1vu56();return o?new u.Timestamp(t.vu57(),s):new u.Timestamp(this.patchSid,s)}decodeTss(){const t=this.decodeId(),o=this.reader.vu57();return(0,u.interval)(t,0,o)}decodeOperations(){const o=this.reader.vu57();for(let s=0;s<o;s++)this.decodeOperation()}decodeOperation(){const t=this.builder,o=this.reader,s=o.u8();switch(s>>3){case 0:{const n=s&7;t.con(n?this.decodeId():this.val());break}case 1:{t.val();break}case 2:{t.obj();break}case 3:{t.vec();break}case 4:{t.str();break}case 5:{t.bin();break}case 6:{t.arr();break}case 9:{const n=this.decodeId(),a=this.decodeId();t.setVal(n,a);break}case 10:{const n=s&7||o.vu57(),a=this.decodeId(),p=[];for(let h=0;h<n;h++){const w=this.val();if(typeof w!="string")continue;const y=this.decodeId();p.push([w,y])}t.insObj(a,p);break}case 11:{const n=s&7||o.vu57(),a=this.decodeId(),p=[];for(let h=0;h<n;h++){const w=this.val();if(typeof w!="number")continue;const y=this.decodeId();p.push([w,y])}t.insVec(a,p);break}case 12:{const n=s&7||o.vu57(),a=this.decodeId(),p=this.decodeId(),h=o.utf8(n);t.insStr(a,p,h);break}case 13:{const n=s&7||o.vu57(),a=this.decodeId(),p=this.decodeId(),h=o.buf(n);if(!(h instanceof Uint8Array))return;t.insBin(a,p,h);break}case 14:{const n=s&7||o.vu57(),a=this.decodeId(),p=this.decodeId(),h=[];for(let w=0;w<n;w++)h.push(this.decodeId());t.insArr(a,p,h);break}case 15:{const n=this.decodeId(),a=this.decodeId(),p=this.decodeId();t.updArr(n,a,p);break}case 16:{const n=s&7||o.vu57(),a=this.decodeId(),p=[];for(let h=0;h<n;h++)p.push(this.decodeTss());t.del(a,p);break}case 17:{const n=s&7||o.vu57();t.nop(n);break}default:throw new Error("UNKNOWN_OP")}}}return An.Decoder=i,An}var yi={},Oa;function sp(){return Oa||(Oa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const u=Wu(),f=Yu(),d=ps(),i=new d.CrdtWriter(1024*4);e.encoder=new u.Encoder(i);const c=o=>e.encoder.encode(o);e.encode=c,e.decoder=new f.Decoder;const t=o=>e.decoder.decode(o);e.decode=t}(yi)),yi}var Ra;function op(){return Ra||(Ra=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(Wu(),e),u.__exportStar(Yu(),e),u.__exportStar(sp(),e)}(bi)),bi}var Na;function Qu(){if(Na)return Cn;Na=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.Patch=void 0;const u=ie.__importStar(Jt()),f=ce(),d=Ke(),i=op();let c=class Xu{constructor(){this.ops=[],this.meta=void 0}static fromBinary(o){return(0,i.decode)(o)}getId(){const o=this.ops[0];if(o)return o.id}span(){let o=0;for(const s of this.ops)o+=s.span();return o}nextTime(){const o=this.ops,s=o.length;if(!s)return 0;const r=o[s-1];return r.id.time+r.span()}rewriteTime(o){const s=new Xu,r=this.ops,n=r.length,a=s.ops;for(let p=0;p<n;p++){const h=r[p];h instanceof u.DelOp?a.push(new u.DelOp(o(h.id),o(h.obj),h.what)):h instanceof u.NewConOp?a.push(new u.NewConOp(o(h.id),h.val instanceof f.Timestamp?o(h.val):h.val)):h instanceof u.NewVecOp?a.push(new u.NewVecOp(o(h.id))):h instanceof u.NewValOp?a.push(new u.NewValOp(o(h.id))):h instanceof u.NewObjOp?a.push(new u.NewObjOp(o(h.id))):h instanceof u.NewStrOp?a.push(new u.NewStrOp(o(h.id))):h instanceof u.NewBinOp?a.push(new u.NewBinOp(o(h.id))):h instanceof u.NewArrOp?a.push(new u.NewArrOp(o(h.id))):h instanceof u.InsArrOp?a.push(new u.InsArrOp(o(h.id),o(h.obj),o(h.ref),h.data.map(o))):h instanceof u.UpdArrOp?a.push(new u.UpdArrOp(o(h.id),o(h.obj),o(h.ref),o(h.val))):h instanceof u.InsStrOp?a.push(new u.InsStrOp(o(h.id),o(h.obj),o(h.ref),h.data)):h instanceof u.InsBinOp?a.push(new u.InsBinOp(o(h.id),o(h.obj),o(h.ref),h.data)):h instanceof u.InsValOp?a.push(new u.InsValOp(o(h.id),o(h.obj),o(h.val))):h instanceof u.InsObjOp?a.push(new u.InsObjOp(o(h.id),o(h.obj),h.data.map(([w,y])=>[w,o(y)]))):h instanceof u.InsVecOp?a.push(new u.InsVecOp(o(h.id),o(h.obj),h.data.map(([w,y])=>[w,o(y)]))):h instanceof u.NopOp&&a.push(new u.NopOp(o(h.id),h.len))}return s}rebase(o,s){const r=this.getId();if(!r)throw new Error("EMPTY_PATCH");const n=r.sid,a=r.time;if(s??(s=a),a===o)return this;const p=o-a;return this.rewriteTime(h=>{if(h.sid!==n)return h;const w=h.time;return w<s?h:(0,f.ts)(n,w+p)})}clone(){return this.rewriteTime(o=>o)}toBinary(){return(0,i.encode)(this)}toString(o=""){const s=this.getId();return`Patch ${s?(0,f.printTs)(s):"(nil)"}!${this.span()}`+(0,d.printTree)(o,this.ops.map(n=>a=>n.toString(a)))}};return Cn.Patch=c,Cn}var vi={},wi={},Ea;function ap(){return Ea||(Ea=1,Object.defineProperty(wi,"__esModule",{value:!0})),wi}var Ta;function Ur(){return Ta||(Ta=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const u=ie,f=ce();u.__exportStar(ap(),e),e.ORIGIN=(0,f.ts)(0,0)}(vi)),vi}var _i={},Ia;function Zu(){return Ia||(Ia=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const u=hs(),f=ce(),d=t=>{switch(typeof t){case"number":case"boolean":case"undefined":return!0;case"object":return t===null||t instanceof f.Timestamp;default:return!1}};class i{constructor(o){this.build=o}}e.NodeBuilder=i;var c;(function(t){class o extends i{constructor(b){super(l=>l.con(b)),this.raw=b,this.type="con"}}t.con=o;class s extends i{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="str"}}t.str=s;class r extends i{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="bin"}}t.bin=r;class n extends i{constructor(b){super(l=>{const m=l.val(),g=b.build(l);return l.setVal(m,g),m}),this.value=b,this.type="val"}}t.val=n;class a extends i{constructor(b){super(l=>{const m=l.vec(),g=b.length;if(g){const v=[];for(let _=0;_<g;_++){const C=b[_].build(l);v.push([_,C])}l.insVec(m,v)}return m}),this.value=b,this.type="vec"}}t.vec=a;class p extends i{constructor(b,l){super(m=>{const g=m.obj(),v=[],_={...b,...l},S=Object.keys(_),C=S.length;if(C){for(let O=0;O<C;O++){const x=S[O],R=_[x].build(m);v.push([x,R])}m.insObj(g,v)}return g}),this.obj=b,this.opt=l,this.type="obj"}optional(){return this}}t.obj=p;class h extends i{constructor(b){super(l=>{const m=l.arr(),g=b.length;if(g){const v=[];for(let _=0;_<g;_++)v.push(b[_].build(l));l.insArr(m,m,v)}return m}),this.arr=b,this.type="arr"}}t.arr=h;class w extends i{constructor(b,l){super(m=>{const g=new Uint8Array([b,0,0]),v=m.vec();return g[1]=v.sid%256,g[2]=v.time%256,m.insVec(v,[[0,m.constOrJson(e.s.con(g))],[1,l.build(m)]]),v}),this.id=b,this.data=l,this.type="ext"}}t.ext=w})(c||(e.nodes=c={})),e.schema={con:t=>new c.con(t),str:t=>new c.str(t||""),bin:t=>new c.bin(t),val:t=>new c.val(t),vec:(...t)=>new c.vec(t),obj:(t,o)=>new c.obj(t,o),map:t=>e.schema.obj(t),arr:t=>new c.arr(t),json:t=>{switch(typeof t){case"object":{if(!t)return e.s.val(e.s.con(t));if(t instanceof i)return t;if(Array.isArray(t))return e.s.arr(t.map(o=>e.s.json(o)));if((0,u.isUint8Array)(t))return e.s.bin(t);if(t instanceof f.Timestamp)return e.s.val(e.s.con(t));{const o={},s=Object.keys(t);for(const r of s)o[r]=e.s.jsonCon(t[r]);return e.s.obj(o)}}case"string":return e.s.str(t);default:return e.s.val(e.s.con(t))}},jsonCon:t=>d(t)?e.s.con(t):e.s.json(t),ext:(t,o)=>new c.ext(t,o)},e.s=e.schema}(_i)),_i}var ka;function $r(){if(ka)return Sn;ka=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.PatchBuilder=void 0;const u=ie.__importStar(Jt()),f=ce(),d=hs(),i=Qu(),c=Ur(),t=Zu(),o=r=>{switch(typeof r){case"number":case"boolean":return!0;default:return r===null}};let s=class{constructor(n){this.clock=n,this.patch=new i.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const n=this.patch;return this.patch=new i.Patch,n}obj(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewObjOp(n)),n}arr(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewArrOp(n)),n}vec(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewVecOp(n)),n}str(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewStrOp(n)),n}bin(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewBinOp(n)),n}con(n){this.pad();const a=this.clock.tick(1);return this.patch.ops.push(new u.NewConOp(a,n)),a}val(){this.pad();const n=this.clock.tick(1);return this.patch.ops.push(new u.NewValOp(n)),n}root(n){return this.setVal(c.ORIGIN,n)}insObj(n,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new u.InsObjOp(p,n,a),w=h.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(h),p}insVec(n,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new u.InsVecOp(p,n,a),w=h.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(h),p}setVal(n,a){this.pad();const p=this.clock.tick(1),h=new u.InsValOp(p,n,a);return this.patch.ops.push(h),p}insStr(n,a,p){if(!p.length)throw new Error("EMPTY_STRING");this.pad();const h=this.clock.tick(1),w=new u.InsStrOp(h,n,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),h}insBin(n,a,p){if(!p.length)throw new Error("EMPTY_BINARY");this.pad();const h=this.clock.tick(1),w=new u.InsBinOp(h,n,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),h}insArr(n,a,p){this.pad();const h=this.clock.tick(1),w=new u.InsArrOp(h,n,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),h}updArr(n,a,p){this.pad();const h=this.clock.tick(1),w=new u.UpdArrOp(h,n,a,p);return this.patch.ops.push(w),h}del(n,a){this.pad();const p=this.clock.tick(1);return this.patch.ops.push(new u.DelOp(p,n,a)),p}nop(n){this.pad();const a=this.clock.tick(n);return this.patch.ops.push(new u.NopOp(a,n)),a}jsonObj(n){const a=this.obj(),p=Object.keys(n);if(p.length){const h=[];for(const w of p){const y=n[w],b=y instanceof f.Timestamp?y:o(y)?this.con(y):this.json(y);h.push([w,b])}this.insObj(a,h)}return a}jsonArr(n){const a=this.arr();if(n.length){const p=[];for(const h of n)p.push(this.json(h));this.insArr(a,a,p)}return a}jsonStr(n){const a=this.str();return n&&this.insStr(a,a,n),a}jsonBin(n){const a=this.bin();return n.length&&this.insBin(a,a,n),a}jsonVal(n){const a=this.val(),p=this.con(n);return this.setVal(a,p),a}json(n){if(n instanceof f.Timestamp)return n;if(n===void 0)return this.con(n);if(n instanceof Array)return this.jsonArr(n);if((0,d.isUint8Array)(n))return this.jsonBin(n);if(n instanceof t.NodeBuilder)return n.build(this);switch(typeof n){case"object":return n===null?this.jsonVal(n):this.jsonObj(n);case"string":return this.jsonStr(n);case"number":case"boolean":return this.jsonVal(n)}throw new Error("INVALID_JSON")}constOrJson(n){return n instanceof f.Timestamp?n:o(n)?this.con(n):this.json(n)}maybeConst(n){return n instanceof f.Timestamp?n:this.con(n)}pad(){const n=this.patch.nextTime();if(!n)return;const a=this.clock.time-n;if(a>0){const p=(0,f.ts)(this.clock.sid,n),h=new u.NopOp(p,a);this.patch.ops.push(h)}}};return Sn.PatchBuilder=s,Sn}var ja;function lp(){if(ja)return yn;ja=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.decode=void 0;const e=Wh(),u=ce(),f=$r(),d=(t,o)=>Array.isArray(o)?new u.Timestamp(o[0],o[1]):new u.Timestamp(t,o),i=(t,o)=>o.length===3?new u.Timespan(o[0],o[1],o[2]):new u.Timespan(t,o[0],o[1]),c=t=>{const o=t[0],s=o[0],r=Array.isArray(s)?new u.ClockVector(s[0],s[1]):new u.ServerClockVector(1,s),n=r.sid;r.time;const a=new f.PatchBuilder(r),p=t.length;for(let w=1;w<p;w++){const y=t[w];switch(y[0]){case 0:{const[,b,l]=y;a.con(l?d(n,b):b);break}case 1:{a.val();break}case 2:{a.obj();break}case 3:{a.vec();break}case 4:{a.str();break}case 5:{a.bin();break}case 6:{a.arr();break}case 9:{a.setVal(d(n,y[1]),d(n,y[2]));break}case 10:{const b=d(n,y[1]),l=[],m=y[2],g=m.length;for(let v=0;v<g;v++){const[_,S]=m[v];l.push([_,d(n,S)])}a.insObj(b,l);break}case 11:{const b=d(n,y[1]),l=[],m=y[2],g=m.length;for(let v=0;v<g;v++){const[_,S]=m[v];l.push([_,d(n,S)])}a.insVec(b,l);break}case 12:{a.insStr(d(n,y[1]),d(n,y[2]),y[3]);break}case 13:{a.insBin(d(n,y[1]),d(n,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const b=d(n,y[1]),l=d(n,y[2]),m=y[3],g=[],v=m.length;for(let _=0;_<v;_++)g.push(d(n,m[_]));a.insArr(b,l,g);break}case 15:{const b=d(n,y[1]),l=d(n,y[2]),m=d(n,y[3]);a.updArr(b,l,m);break}case 16:{const b=d(n,y[1]),l=y[2],m=[],g=l.length;for(let v=0;v<g;v++)m.push(i(n,l[v]));a.del(b,m);break}case 17:{a.nop(y[1]||1);break}}}const h=a.patch;return h.meta=o[1],h};return yn.decode=c,yn}var Va;function up(){return Va||(Va=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(Dh(),e),u.__exportStar($h(),e),u.__exportStar(lp(),e)}(fi)),fi}var Mr=up();function Aa(e){return new TextEncoder().encode(JSON.stringify(e)).length}function cp(e){const u=Mr.decode(e),f=u.getId(),d=u.span();return[[f==null?void 0:f.sid,f.time+d]]}function dp(e,u){if(!e.ops||e.ops.length===0)return[];const f=Mr.encode(e),d=Aa(f);if(d<=u)return[f];if(e.ops.length==1)return console.warn(`Patch is too large (${d} B) but cannot be split further since it only contains one operation.`),[f];const i=f[0],c=[];let t=[i];for(let o=1;o<f.length;o+=1){const s=t.length-1;Aa([...t,f[o]])>u&&s>0&&(c.push(t),t=[cp(t)]),t.push(f[o])}return t.length>1&&c.push(t),c}var Si={},xi={},Ci={},Pa;function fp(){return Pa||(Pa=1,Object.defineProperty(Ci,"__esModule",{value:!0})),Ci}var Oi={},Un={},Ma;function zr(){if(Ma)return Un;Ma=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.ConNode=void 0;const e=ce();let u=class{constructor(d,i){this.id=d,this.val=i,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(d){const i=this.val,c=i instanceof Uint8Array?`Uint8Array { ${(""+i).replaceAll(",",", ")} }`:`{ ${i instanceof e.Timestamp?(0,e.printTs)(i):JSON.stringify(i)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${c}`}};return Un.ConNode=u,Un}var $n={},wt={},_t={},zn={},Gn={},Wn={},qa;function hp(){if(qa)return Wn;qa=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.RelativeTimestamp=void 0;let e=class{constructor(f,d){this.sessionIndex=f,this.timeDiff=d}};return Wn.RelativeTimestamp=e,Wn}var Da;function pp(){if(Da)return Gn;Da=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.ClockEncoder=void 0;const e=ce(),u=hp();class f{constructor(c,t){this.index=c,this.clock=t}}let d=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(c){this.index=1,this.clock=c;const t=new f(this.index++,(0,e.tick)(c,-1));this.table.clear(),this.table.set(c.sid,t)}append(c){const t=c.time,o=c.sid;let s=this.table.get(o);if(!s){let a=this.clock.peers.get(o);a||(a=new e.Timestamp(o,this.clock.time-1)),s=new f(this.index++,a),this.table.set(o,s)}const n=s.clock.time-t;if(n<0)throw new Error("TIME_TRAVEL");return new u.RelativeTimestamp(s.index,n)}toJson(){const c=[];return this.table.forEach(t=>{const o=t.clock;c.push(o.sid,o.time)}),c}};return Gn.ClockEncoder=d,Gn}var St={},Ba;function ec(){if(Ba)return St;Ba=1,Object.defineProperty(St,"__esModule",{value:!0}),St.CRDT_MAJOR_OVERLAY=St.CRDT_MAJOR=void 0;var e;(function(f){f[f.CON=0]="CON",f[f.VAL=1]="VAL",f[f.OBJ=2]="OBJ",f[f.VEC=3]="VEC",f[f.STR=4]="STR",f[f.BIN=5]="BIN",f[f.ARR=6]="ARR"})(e||(St.CRDT_MAJOR=e={}));var u;return function(f){f[f.CON=0]="CON",f[f.VAL=32]="VAL",f[f.VEC=96]="VEC",f[f.OBJ=64]="OBJ",f[f.STR=128]="STR",f[f.BIN=160]="BIN",f[f.ARR=192]="ARR"}(u||(St.CRDT_MAJOR_OVERLAY=u={})),St}var La;function mp(){if(La)return zn;La=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.Encoder=void 0;const u=ie.__importStar(ht()),f=pp(),d=ps(),i=ce(),c=Gu(),t=ec();class o extends c.CborEncoder{constructor(r){super(r||new d.CrdtWriter),this.clockEncoder=new f.ClockEncoder,this.time=0,this.cTableEntry=n=>{const a=n.clock,p=this.writer;p.vu57(a.sid),p.vu57(a.time)},this.tsLogical=n=>{const a=this.clockEncoder.append(n);this.writer.id(a.sessionIndex,a.timeDiff)},this.tsServer=n=>{this.writer.vu57(n.time)},this.ts=this.tsLogical,this.cKey=(n,a)=>{this.writeStr(a),this.cNode(this.doc.index.get(n))}}encode(r){this.doc=r;const n=this.writer;return n.reset(),r.clock.sid===1?this.encodeServer(r):this.encodeLogical(r),n.flush()}encodeLogical(r){const n=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(r.clock),n.ensureCapacity(4);const a=n.x0,p=n.x;n.x+=4,this.cRoot(r.root),this.encodeClockTable(a,p)}encodeServer(r){this.ts=this.tsServer;const n=this.writer;n.u8(128),n.vu57(this.time=r.clock.time),this.cRoot(r.root)}encodeClockTable(r,n){const a=this.writer,p=a.x0-r;a.view.setUint32(a.x0+(n-r),a.x-n-p-4);const w=this.clockEncoder.table,y=w.size;a.vu57(y),w.forEach(this.cTableEntry)}cRoot(r){r.val.sid===0?this.writer.u8(0):this.cNode(r.node())}writeTL(r,n){const a=this.writer;n<31?a.u8(r|n):(a.u8(r|31),a.vu57(n))}cNode(r){r instanceof u.ConNode?this.cCon(r):r instanceof u.ValNode?this.cVal(r):r instanceof u.StrNode?this.cStr(r):r instanceof u.ObjNode?this.cObj(r):r instanceof u.VecNode?this.cVec(r):r instanceof u.ArrNode?this.cArr(r):r instanceof u.BinNode&&this.cBin(r)}cCon(r){const n=r.val;this.ts(r.id),n instanceof i.Timestamp?(this.writer.u8(1),this.ts(n)):(this.writer.u8(0),this.writeAny(n))}cVal(r){this.ts(r.id),this.writer.u8(32),this.cNode(r.node())}cObj(r){this.ts(r.id);const n=r.keys;this.writeTL(t.CRDT_MAJOR_OVERLAY.OBJ,n.size),n.forEach(this.cKey)}cVec(r){const n=r.elements,a=n.length;this.ts(r.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.VEC,a);const p=this.doc.index;for(let h=0;h<a;h++){const w=n[h];w?this.cNode(p.get(w)):this.writer.u8(0)}}cStr(r){const n=this.ts;n(r.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.STR,r.count);for(let a=r.first();a;a=r.next(a))n(a.id),a.del?this.writeUInteger(a.span):this.writeStr(a.data)}cBin(r){const n=this.ts,a=this.writer;n(r.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.BIN,r.count);for(let p=r.first();p;p=r.next(p)){n(p.id);const h=p.span,w=p.del;a.b1vu56(~~w,h),!w&&a.buf(p.data,h)}}cArr(r){const n=this.ts,a=this.writer;n(r.id),this.writeTL(t.CRDT_MAJOR_OVERLAY.ARR,r.count);const p=this.doc.index;for(let h=r.first();h;h=r.next(h)){n(h.id);const w=h.span,y=h.del;if(a.b1vu56(~~y,w),y)continue;const b=h.data;for(let l=0;l<w;l++)this.cNode(p.get(b[l]))}}}return zn.Encoder=o,zn}var Hn={},Jn={},Fa;function gp(){if(Fa)return Jn;Fa=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.ClockDecoder=void 0;const e=ce();let u=class tc{static fromArr(d){const i=new tc(d[0],d[1]),c=d.length;for(let t=2;t<c;t+=2)i.pushTuple(d[t],d[t+1]);return i}constructor(d,i){this.table=[],this.clock=new e.ClockVector(d,i+1),this.table.push((0,e.ts)(d,i))}pushTuple(d,i){const c=(0,e.ts)(d,i);this.clock.observe(c,1),this.table.push(c)}decodeId(d,i){if(!d)return(0,e.ts)(0,i);const c=this.table[d-1];if(!c)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(c.sid,c.time-i)}};return Jn.ClockDecoder=u,Jn}var Ua;function bp(){if(Ua)return Hn;Ua=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.Decoder=void 0;const u=ie.__importStar(ht()),f=gp(),d=Ju(),i=ce(),c=Ss(),t=Ku(),o=ec();let s=class extends t.CborDecoderBase{constructor(){super(new d.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const n=this.ts(),a=this.val();return typeof a=="string"?new u.StrChunk(n,a.length,a):new u.StrChunk(n,~~a,"")},this.cBinChunk=()=>{const n=this.ts(),a=this.reader,[p,h]=a.b1vu56();return p?new u.BinChunk(n,h,void 0):new u.BinChunk(n,h,a.buf(h))},this.cArrChunk=()=>{const n=this.ts(),[a,p]=this.reader.b1vu56();if(a)return new u.ArrChunk(n,p,void 0);const h=[];for(let w=0;w<p;w++)h.push(this.cNode().id);return new u.ArrChunk(n,p,h)}}decode(n,a){this.clockDecoder=void 0,this.time=-1;const p=this.reader;if(p.reset(n),p.peak()&128){p.x++;const w=this.time=p.vu57();a||(a=c.Model.withServerClock(void 0,w))}else if(this.decodeClockTable(),!a){const w=this.clockDecoder.clock;a=c.Model.create(void 0,w)}return this.doc=a,a.root=new u.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,a}decodeClockTable(){const n=this.reader,a=n.u32(),p=n.x;n.x+=a;const h=n.vu57(),w=n.vu57(),y=n.vu57();this.clockDecoder=new f.ClockDecoder(w,y);for(let b=1;b<h;b++){const l=n.vu57(),m=n.vu57();this.clockDecoder.pushTuple(l,m)}n.x=p}ts(){if(this.time<0){const[p,h]=this.reader.id();return this.clockDecoder.decodeId(p,h)}else return new i.Timestamp(1,this.reader.vu57())}cRoot(){const n=this.reader;return n.uint8[n.x]?this.cNode():c.UNDEFINED}cNode(){const n=this.reader,a=this.ts(),p=n.u8(),h=p>>5,w=p&31;switch(h){case o.CRDT_MAJOR.CON:return this.cCon(a,w);case o.CRDT_MAJOR.VAL:return this.cVal(a);case o.CRDT_MAJOR.OBJ:return this.cObj(a,w!==31?w:n.vu57());case o.CRDT_MAJOR.VEC:return this.cVec(a,w!==31?w:n.vu57());case o.CRDT_MAJOR.STR:return this.cStr(a,w!==31?w:n.vu57());case o.CRDT_MAJOR.BIN:return this.cBin(a,w!==31?w:n.vu57());case o.CRDT_MAJOR.ARR:return this.cArr(a,w!==31?w:n.vu57())}throw new Error("UNKNOWN_NODE")}cCon(n,a){const p=this.doc,h=a?this.ts():this.val(),w=new u.ConNode(n,h);return p.index.set(n,w),w}cVal(n){const a=this.cNode(),p=this.doc,h=new u.ValNode(p,n,a.id);return p.index.set(n,h),h}cObj(n,a){const p=new u.ObjNode(this.doc,n);for(let h=0;h<a;h++)this.cObjChunk(p);return this.doc.index.set(n,p),p}cObjChunk(n){const a=this.key();n.keys.set(a,this.cNode().id)}cVec(n,a){const p=this.reader,h=new u.VecNode(this.doc,n),w=h.elements;for(let y=0;y<a;y++)p.peak()?w.push(this.cNode().id):(p.x++,w.push(void 0));return this.doc.index.set(n,h),h}cStr(n,a){const p=new u.StrNode(n);return a&&p.ingest(a,this.cStrChunk),this.doc.index.set(n,p),p}cBin(n,a){const p=new u.BinNode(n);return a&&p.ingest(a,this.cBinChunk),this.doc.index.set(n,p),p}cArr(n,a){const p=new u.ArrNode(this.doc,n);return a&&p.ingest(a,this.cArrChunk),this.doc.index.set(n,p),p}};return Hn.Decoder=s,Hn}var $a;function yp(){if($a)return _t;$a=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.decoder=_t.encoder=void 0;const e=mp(),u=bp();return _t.encoder=new e.Encoder,_t.decoder=new u.Decoder,_t}var Ri={},me={},Kn={},Yn={},za;function gs(){if(za)return Yn;za=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function u(f,d){return e.call(f,d)}return Yn.hasOwnProperty=u,Yn}var Ga;function nc(){if(Ga)return Kn;Ga=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.get=void 0;const e=gs(),u=(f,d)=>{const i=d.length;let c;if(!i)return f;for(let t=0;t<i;t++)if(c=d[t],f instanceof Array){if(typeof c!="number"){if(c==="-")return;const o=~~c;if(""+o!==c)return;c=o}f=f[c]}else if(typeof f=="object"){if(!f||!(0,e.hasOwnProperty)(f,c))return;f=f[c]}else return;return f};return Kn.get=u,Kn}var Ni={},Wa;function bs(){return Wa||(Wa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=c,e.escapeComponent=t,e.parseJsonPointer=o,e.formatJsonPointer=s,e.isChild=n,e.isPathEqual=a,e.parent=h,e.isValidIndex=w;const u=/~1/g,f=/~0/g,d=/~/g,i=/\//g;function c(b){return b.indexOf("~")===-1?b:b.replace(u,"/").replace(f,"~")}function t(b){return b.indexOf("/")===-1&&b.indexOf("~")===-1?b:b.replace(d,"~0").replace(i,"~1")}function o(b){return b?b.slice(1).split("/").map(c):[]}function s(b){return(0,e.isRoot)(b)?"":"/"+b.map(l=>t(String(l))).join("/")}const r=b=>typeof b=="string"?o(b):b;e.toPath=r;function n(b,l){if(b.length>=l.length)return!1;for(let m=0;m<b.length;m++)if(b[m]!==l[m])return!1;return!0}function a(b,l){if(b.length!==l.length)return!1;for(let m=0;m<b.length;m++)if(b[m]!==l[m])return!1;return!0}const p=b=>!b.length;e.isRoot=p;function h(b){if(b.length<1)throw new Error("NO_PARENT");return b.slice(0,b.length-1)}function w(b){if(typeof b=="number")return!0;const l=Number.parseInt(b,10);return String(l)===b&&l>=0}const y=b=>{const l=b.length;let m=0,g;for(;m<l;){if(g=b.charCodeAt(m),g>=48&&g<=57){m++;continue}return!1}return!0};e.isInteger=y}(Ni)),Ni}var Xn={},Ei={},Ti={},Ha;function vp(){return Ha||(Ha=1,Object.defineProperty(Ti,"__esModule",{value:!0})),Ti}var Ii={},Ja;function wp(){return Ja||(Ja=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const u=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(i)};e.validateJsonPointer=u;const{isArray:f}=Array,d=i=>{if(!f(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const c of i)switch(typeof c){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=d}(Ii)),Ii}var He={},Ka;function _p(){if(Ka)return He;Ka=1,Object.defineProperty(He,"__esModule",{value:!0}),He.isObjectReference=He.isArrayEnd=He.isArrayReference=He.find=void 0;const e=gs(),{isArray:u}=Array,f=(t,o)=>{const s=o.length;if(!s)return{val:t};let r,n;for(let p=0;p<s;p++)if(r=t,n=o[p],u(r)){const h=r.length;if(n==="-")n=h;else if(typeof n=="string"){const w=~~n;if(""+w!==n)throw new Error("INVALID_INDEX");if(n=w,n<0)throw new Error("INVALID_INDEX")}t=r[n]}else if(typeof r=="object"&&r)t=(0,e.hasOwnProperty)(r,n)?r[n]:void 0;else throw new Error("NOT_FOUND");return{val:t,obj:r,key:n}};He.find=f;const d=t=>u(t.obj)&&typeof t.key=="number";He.isArrayReference=d;const i=t=>t.obj.length===t.key;He.isArrayEnd=i;const c=t=>typeof t.obj=="object"&&typeof t.key=="string";return He.isObjectReference=c,He}var ki={},Qn={},Ya;function Sp(){if(Ya)return Qn;Ya=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.findByPointer=void 0;const e=gs(),u=bs(),{isArray:f}=Array,d=(i,c)=>{if(!i)return{val:c};let t,o,s=0,r=1;for(;s>-1;)if(s=i.indexOf("/",r),o=s>-1?i.substring(r,s):i.substring(r),r=s+1,t=c,f(t)){const n=t.length;if(o==="-")o=n;else{const a=~~o;if(""+a!==o)throw new Error("INVALID_INDEX");if(o=a,o<0)throw"INVALID_INDEX"}c=t[o]}else if(typeof t=="object"&&t)o=(0,u.unescapeComponent)(o),c=(0,e.hasOwnProperty)(t,o)?t[o]:void 0;else throw"NOT_FOUND";return{val:c,obj:t,key:o}};return Qn.findByPointer=d,Qn}var Xa;function xp(){return Xa||(Xa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ie.__exportStar(Sp(),e)}(ki)),ki}var Qa;function Cp(){return Qa||(Qa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(vp(),e),u.__exportStar(bs(),e),u.__exportStar(wp(),e),u.__exportStar(nc(),e),u.__exportStar(_p(),e),u.__exportStar(xp(),e)}(Ei)),Ei}var Za;function Op(){if(Za)return Xn;Za=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.find=void 0;const e=Cp(),u=ht(),f=(d,i)=>{const c=(0,e.toPath)(i);let t=d;const o=c.length;if(!o)return t;let s=0;for(;s<o&&t;){const r=c[s++];if(t=t.container(),!t)throw new Error("NOT_CONTAINER");if(t instanceof u.ObjNode){const n=t.get(String(r));if(!n)throw new Error("NOT_FOUND");t=n}else if(t instanceof u.ArrNode){const n=t.getNode(Number(r));if(!n)throw new Error("NOT_FOUND");t=n}else if(t instanceof u.VecNode){const n=t.get(Number(r));if(!n)throw new Error("NOT_FOUND");t=n}}return t};return Xn.find=f,Xn}var Zn={},Je={},er={},el;function rc(){if(el)return er;el=1,Object.defineProperty(er,"__esModule",{value:!0}),er.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(f){this.listeners.forEach(d=>d(f))}listen(f){const d=this.listeners;return d.add(f),()=>d.delete(f)}}return er.FanOut=e,er}var tl;function ic(){if(tl)return Je;tl=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.OnNewFanOut=Je.MapFanOut=Je.MicrotaskBufferFanOut=Je.MergeFanOut=void 0;const e=rc();class u extends e.FanOut{constructor(t){super(),this.fanouts=t,this.unsubs=[]}listen(t){this.listeners.size||(this.unsubs=this.fanouts.map(s=>s.listen(r=>this.emit(r))));const o=super.listen(t);return()=>{if(o(),!this.listeners.size){for(const s of this.unsubs)s();this.unsubs=[]}}}}Je.MergeFanOut=u;class f extends e.FanOut{constructor(t){super(),this.source=t,this.buffer=[],this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(s=>{const r=this.buffer;r.length||queueMicrotask(()=>{this.emit(r),this.buffer=[]}),r.push(s)}));const o=super.listen(t);return()=>{o(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),this.buffer=[],(t=this.unsub)==null||t.call(this),this.unsub=void 0}}Je.MicrotaskBufferFanOut=f;class d extends e.FanOut{constructor(t,o){super(),this.source=t,this.mapper=o,this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(s=>this.emit(this.mapper(s))));const o=super.listen(t);return()=>{o(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),(t=this.unsub)==null||t.call(this),this.unsub=void 0}}Je.MapFanOut=d;class i extends e.FanOut{constructor(t,o=void 0){super(),this.source=t,this.last=o,this.unsub=void 0}listen(t){this.unsub||(this.unsub=this.source.listen(s=>{this.last!==s&&this.emit(this.last=s)}));const o=super.listen(t);return()=>{o(),this.listeners.size||this.clear()}}clear(){var t;this.listeners.clear(),this.last=void 0,(t=this.unsub)==null||t.call(this),this.unsub=void 0}}return Je.OnNewFanOut=i,Je}var nl;function Rp(){if(nl)return Zn;nl=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.NodeEvents=void 0;const e=ic();let u=class{constructor(d){this.api=d,this.subscribe=i=>this.onViewChanges.listen(()=>i()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Zn.NodeEvents=u,Zn}var tr={},rl;function Np(){if(rl)return tr;rl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.ExtNode=void 0;const e=ce();let u=class{constructor(d){this.data=d,this.api=void 0,this.id=d.id}children(d){}child(){return this.data}container(){return this.data.container()}toString(d,i){return this.name()+(i?" "+(0,e.printTs)(i):"")+" "+this.data.toString(d)}};return tr.ExtNode=u,tr}var ji={},xt={},Vi={},Ai={},il;function Ep(){return il||(il=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const u=Array.isArray,f=Object.prototype,d=(i,c)=>{if(i===c)return!0;let t=0,o=0;if(u(i)){if(!u(c)||(t=i.length,t!==c.length))return!1;for(o=t;o--!==0;)if(!(0,e.deepEqual)(i[o],c[o]))return!1;return!0}if(i&&c&&typeof i=="object"&&typeof c=="object"){e:{if(i.__proto__===f)break e;if(i instanceof Uint8Array){if(!(c instanceof Uint8Array))return!1;const r=i.length;if(r!==c.length)return!1;for(let n=0;n<r;n++)if(i[n]!==c[n])return!1;return!0}}const s=Object.keys(i);if(t=s.length,t!==Object.keys(c).length||u(c))return!1;for(o=t;o--!==0;){const r=s[o];if(!(0,e.deepEqual)(i[r],c[r]))return!1}return!0}return!1};e.deepEqual=d}(Ai)),Ai}var sl;function Tp(){return sl||(sl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ie.__exportStar(Ep(),e)}(Vi)),Vi}var nr={},ol;function Ip(){if(ol)return nr;ol=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.cmpUint8Array=void 0;const e=(u,f)=>{const d=u.length;if(d!==f.length)return!1;for(let i=0;i<d;i++)if(u[i]!==f[i])return!1;return!0};return nr.cmpUint8Array=e,nr}var Pi={},Mi={},al;function kp(){return al||(al=1,Object.defineProperty(Mi,"__esModule",{value:!0})),Mi}var ll;function Gr(){return ll||(ll=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(kp(),e),u.__exportStar(ce(),e),u.__exportStar(Jt(),e),u.__exportStar(Qu(),e),u.__exportStar($r(),e),u.__exportStar(Zu(),e)}(Pi)),Pi}var qi={},ul;function ys(){return ul||(ul=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const u=l=>{const m=l.charCodeAt(0);return m>=56320&&m<=57343},f=l=>{const m=l.charCodeAt(l.length-1);return m>=55296&&m<=56319},d=(l,m)=>{l.push([0,""]);let g=0,v=0,_=0,S="",C="",O=0;for(;g<l.length;){if(g<l.length-1&&!l[g][1]){l.splice(g,1);continue}const R=l[g];switch(R[0]){case 1:_++,g++,C+=R[1];break;case-1:v++,g++,S+=R[1];break;case 0:{let E=g-_-v-1;if(m){const A=l[E];if(E>=0){let z=A[1];if(f(z)){const U=z.slice(-1);if(A[1]=z=z.slice(0,-1),S=U+S,C=U+C,!z){l.splice(E,1),g--;let Y=E-1;const re=l[Y];if(re){const X=re[0];X===1?(_++,Y--,C=re[1]+C):X===-1&&(v++,Y--,S=re[1]+S)}E=Y}}}const q=l[g],P=q[1];if(u(P)){const z=P.charAt(0);q[1]=P.slice(1),S+=z,C+=z}}if(g<l.length-1&&!l[g][1]){l.splice(g,1);break}const T=S.length>0,N=C.length>0;if(T||N){T&&N&&(O=(0,e.pfx)(C,S),O!==0&&(E>=0?l[E][1]+=C.slice(0,O):(l.splice(0,0,[0,C.slice(0,O)]),g++),C=C.slice(O),S=S.slice(O)),O=(0,e.sfx)(C,S),O!==0&&(l[g][1]=C.slice(C.length-O)+l[g][1],C=C.slice(0,C.length-O),S=S.slice(0,S.length-O)));const A=_+v,q=S.length,P=C.length;q===0&&P===0?(l.splice(g-A,A),g=g-A):q===0?(l.splice(g-A,A,[1,C]),g=g-A+1):P===0?(l.splice(g-A,A,[-1,S]),g=g-A+1):(l.splice(g-A,A,[-1,S],[1,C]),g=g-A+2)}const M=l[g-1];g!==0&&M[0]===0?(M[1]+=l[g][1],l.splice(g,1)):g++,_=0,v=0,S="",C="";break}}}l[l.length-1][1]===""&&l.pop();let x=!1;for(g=1;g<l.length-1;){const R=l[g-1],E=l[g+1];if(R[0]===0&&E[0]===0){const T=R[1],N=l[g],M=N[1],A=E[1];M.slice(M.length-T.length)===T?(l[g][1]=T+M.slice(0,M.length-T.length),E[1]=T+A,l.splice(g-1,1),x=!0):M.slice(0,A.length)===A&&(R[1]+=E[1],N[1]=M.slice(A.length)+A,l.splice(g+1,1),x=!0)}g++}x&&d(l,m)},i=(l,m,g,v)=>{const _=r(l.slice(0,g),m.slice(0,v),!1),S=r(l.slice(g),m.slice(v),!1);return _.concat(S)},c=(l,m)=>{const g=l.length,v=m.length,_=Math.ceil((g+v)/2),S=_,C=2*_,O=new Array(C),x=new Array(C);for(let q=0;q<C;q++)O[q]=-1,x[q]=-1;O[S+1]=0,x[S+1]=0;const R=g-v,E=R%2!==0;let T=0,N=0,M=0,A=0;for(let q=0;q<_;q++){for(let P=-q+T;P<=q-N;P+=2){const z=S+P;let U=0;const Y=O[z-1],re=O[z+1];P===-q||P!==q&&Y<re?U=re:U=Y+1;let X=U-P;for(;U<g&&X<v&&l.charAt(U)===m.charAt(X);)U++,X++;if(O[z]=U,U>g)N+=2;else if(X>v)T+=2;else if(E){const W=S+R-P,ge=x[W];if(W>=0&&W<C&&ge!==-1&&U>=g-ge)return i(l,m,U,X)}}for(let P=-q+M;P<=q-A;P+=2){const z=S+P;let U=P===-q||P!==q&&x[z-1]<x[z+1]?x[z+1]:x[z-1]+1,Y=U-P;for(;U<g&&Y<v&&l.charAt(g-U-1)===m.charAt(v-Y-1);)U++,Y++;if(x[z]=U,U>g)A+=2;else if(Y>v)M+=2;else if(!E){const re=S+R-P,X=O[re];if(re>=0&&re<C&&X!==-1){const W=S+X-re;if(U=g-U,X>=U)return i(l,m,X,W)}}}}return[[-1,l],[1,m]]},t=(l,m)=>{if(!l)return[[1,m]];if(!m)return[[-1,l]];const g=l.length,v=m.length,_=g>v?l:m,S=g>v?m:l,C=S.length,O=_.indexOf(S);if(O>=0){const x=_.slice(0,O),R=_.slice(O+C);return g>v?[[-1,x],[0,S],[-1,R]]:[[1,x],[0,S],[1,R]]}return C===1?[[-1,l],[1,m]]:c(l,m)},o=(l,m)=>{if(!l||!m||l.charAt(0)!==m.charAt(0))return 0;let g=0,v=Math.min(l.length,m.length),_=v,S=0;for(;g<_;)l.slice(S,_)===m.slice(S,_)?(g=_,S=g):v=_,_=Math.floor((v-g)/2+g);const C=l.charCodeAt(_-1);return C>=55296&&C<=56319&&_--,_};e.pfx=o;const s=(l,m)=>{if(!l||!m||l.slice(-1)!==m.slice(-1))return 0;let g=0,v=Math.min(l.length,m.length),_=v,S=0;for(;g<_;)l.slice(l.length-_,l.length-S)===m.slice(m.length-_,m.length-S)?(g=_,S=g):v=_,_=Math.floor((v-g)/2+g);const C=l.charCodeAt(l.length-_);return C>=55296&&C<=56319&&_--,_};e.sfx=s;const r=(l,m,g)=>{if(l===m)return l?[[0,l]]:[];const v=(0,e.pfx)(l,m),_=l.slice(0,v);l=l.slice(v),m=m.slice(v);const S=(0,e.sfx)(l,m),C=l.slice(l.length-S);l=l.slice(0,l.length-S),m=m.slice(0,m.length-S);const O=t(l,m);return _&&O.unshift([0,_]),C&&O.push([0,C]),d(O,g),O},n=(l,m)=>r(l,m,!0);e.diff=n;const a=(l,m,g)=>{e:{if(g<0)break e;const v=l.length,_=m.length;if(v===_)break e;const S=m.slice(g),C=S.length;if(C>v||l.slice(v-C)!==S)break e;if(_>v){const R=v-C,E=l.slice(0,R),T=m.slice(0,R);if(E!==T)break e;const N=m.slice(R,g),M=[];return E&&M.push([0,E]),N&&M.push([1,N]),S&&M.push([0,S]),M}else{const R=_-C,E=m.slice(0,R),T=l.slice(0,R);if(T!==E)break e;const N=l.slice(R,v-C),M=[];return T&&M.push([0,T]),N&&M.push([-1,N]),S&&M.push([0,S]),M}}return(0,e.diff)(l,m)};e.diffEdit=a;const p=l=>{let m="";const g=l.length;for(let v=0;v<g;v++){const _=l[v];_[0]!==1&&(m+=_[1])}return m};e.src=p;const h=l=>{let m="";const g=l.length;for(let v=0;v<g;v++){const _=l[v];_[0]!==-1&&(m+=_[1])}return m};e.dst=h;const w=l=>{const m=l[0];return m===0?l:m===1?[-1,l[1]]:[1,l[1]]},y=l=>l.map(w);e.invert=y;const b=(l,m,g,v)=>{const _=l.length;let S=m;for(let C=_-1;C>=0;C--){const[O,x]=l[C];if(O===0)S-=x.length;else if(O===1)g(S,x);else{const R=x.length;S-=R,v(S,R,x)}}};e.apply=b}(qi)),qi}var Di={},cl;function jp(){return cl||(cl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const f=ie.__importStar(ys()),d=r=>{let n="";const a=r.length;for(let p=0;p<a;p++)n+=String.fromCharCode(r[p]);return n};e.toStr=d;const i=r=>{const n=r.length,a=new Uint8Array(n);for(let p=0;p<n;p++)a[p]=r.charCodeAt(p);return a};e.toBin=i;const c=(r,n)=>{const a=(0,e.toStr)(r),p=(0,e.toStr)(n);return f.diff(a,p)};e.diff=c;const t=(r,n,a,p)=>f.apply(r,n,(h,w)=>a(h,(0,e.toBin)(w)),p);e.apply=t;const o=r=>(0,e.toBin)(f.src(r));e.src=o;const s=r=>(0,e.toBin)(f.dst(r));e.dst=s}(Di)),Di}var Bi={},dl;function Vp(){return dl||(dl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const f=ie.__importStar(ys()),d=c=>{const t=[],o=c.length;let s=[];const r=(n,a)=>{if(!a.length)return;const p=s.length;if(p){const h=s[p-1];if(h[0]===n){h[1]+=a;return}}s.push([n,a])};e:for(let n=0;n<o;n++){const a=c[n],p=a[0],h=a[1],w=h.indexOf(`
`);if(w<0){r(p,h);continue e}else r(p,h.slice(0,w+1)),s.length&&t.push(s),s=[];let y=w;const b=h.length;t:for(;y<b;){const l=h.indexOf(`
`,y+1);if(l<0){r(p,h.slice(y+1));break t}t.push([[p,h.slice(y+1,l+1)]]),y=l}}s.length&&t.push(s);{const n=t.length;for(let a=0;a<n;a++){const p=t[a];let h=p.length;e:{if(h<2)break e;const w=p[0],y=p[1],b=y[0];if(w[0]===0&&(b===-1||b===1)){for(let l=2;l<h;l++)if(p[l][0]!==b)break e;for(let l=a+1;l<n;l++){const m=t[l],g=m.length,v=w[1];let _,S;if(m.length>1&&(_=m[0])[0]===b&&(S=m[1])[0]===0&&v===_[1])p.splice(0,1),y[1]=v+y[1],S[1]=v+S[1],m.splice(0,1);else for(let C=0;C<g;C++)if(m[C][0]!==b)break e}}}h=p.length;e:{if(h<2)break e;const w=p[p.length-1],y=w[1],b=p[p.length-2];if(w[0]===-1)for(let l=a+1;l<n;l++){const m=t[l],g=m.length;if(g<=1){if(m[0][0]!==-1)break e}else{const v=m[m.length-1];if(v[0]!==0)break e;for(let x=0;x<m.length-1;x++)if(m[x][0]!==-1)break e;let _=v[1];const S=_.endsWith(`
`);if(S||(_+=`
`),_.length>y.length||!y.endsWith(_))break e;const C=y.length-_.length;C<0?(w[0]=0,b[0]===0&&(b[1]+=y,p.splice(h-1,1))):C===0?(p.splice(h-1,1),b[0]===0?b[1]+=_:p.push([0,_])):(w[1]=y.slice(0,C),p.push([0,_]));const O=m[m.length-2];O[0]===-1?(O[1]+=S?_:_.slice(0,-1),m.splice(g-1,1)):v[0]=-1}}}}}return t};e.agg=d;const i=(c,t)=>{const o=c.join(`
`)+`
`,s=t.join(`
`)+`
`;if(o===s)return[];const r=f.diff(o,s),n=(0,e.agg)(r),a=n.length,p=[];let h=-1,w=-1;const y=c.length,b=t.length;for(let l=0;l<a;l++){const m=n[l];let g=m.length;if(!g)continue;const v=m[g-1],_=v[0],S=v[1];if(S===`
`)m.splice(g-1,1);else{const O=S.length;S[O-1]===`
`&&(O===1?m.splice(g-1,1):v[1]=S.slice(0,O-1))}let C=0;if(g=m.length,l+1===a)h+1<y?w+1<b?(C=g===1&&m[0][0]===0?0:2,h++,w++):(C=-1,h++):(C=1,w++);else{const x=m[0][0];g===1&&x===_&&x===0?(h++,w++):_===0?(C=2,h++,w++):_===1?(C=1,w++):_===-1&&(C=-1,h++)}p.push([C,h,w,m])}return p};e.diff=i}(Bi)),Bi}var Li={},rr={},fl;function vs(){if(fl)return rr;fl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.sort=void 0;const e=u=>{const f=u.length;for(let d=1;d<f;d++){const i=u[d];let c=d;for(;c!==0&&u[c-1]>i;)u[c]=u[c-1],c--;u[c]=i}return u};return rr.sort=e,rr}var Fi={},hl;function ws(){return hl||(hl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const u=vs();var f;(function(s){s[s.START_STATE=5381]="START_STATE",s[s.NULL=982452847]="NULL",s[s.TRUE=982453247]="TRUE",s[s.FALSE=982454243]="FALSE",s[s.ARRAY=982452259]="ARRAY",s[s.STRING=982453601]="STRING",s[s.OBJECT=982454533]="OBJECT",s[s.BINARY=982454837]="BINARY"})(f||(e.CONST=f={}));const d=(s,r)=>(s<<5)+s+r;e.updateNum=d;const i=(s,r)=>{const n=r.length;s=(0,e.updateNum)(s,f.STRING),s=(0,e.updateNum)(s,n);let a=n;for(;a;)s=(s<<5)+s+r.charCodeAt(--a);return s};e.updateStr=i;const c=(s,r)=>{const n=r.length;s=(0,e.updateNum)(s,f.BINARY),s=(0,e.updateNum)(s,n);let a=n;for(;a;)s=(s<<5)+s+r[--a];return s};e.updateBin=c;const t=(s,r)=>{switch(typeof r){case"number":return(0,e.updateNum)(s,r);case"string":return s=(0,e.updateNum)(s,f.STRING),(0,e.updateStr)(s,r);case"object":{if(r===null)return(0,e.updateNum)(s,f.NULL);if(Array.isArray(r)){const p=r.length;s=(0,e.updateNum)(s,f.ARRAY);for(let h=0;h<p;h++)s=(0,e.updateJson)(s,r[h]);return s}if(r instanceof Uint8Array)return(0,e.updateBin)(s,r);s=(0,e.updateNum)(s,f.OBJECT);const n=(0,u.sort)(Object.keys(r)),a=n.length;for(let p=0;p<a;p++){const h=n[p];s=(0,e.updateStr)(s,h),s=(0,e.updateJson)(s,r[h])}return s}case"boolean":return(0,e.updateNum)(s,r?f.TRUE:f.FALSE)}return s};e.updateJson=t;const o=s=>(0,e.updateJson)(f.START_STATE,s)>>>0;e.hash=o}(Fi)),Fi}var Ui={},pl;function sc(){return pl||(pl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const u=vs(),f=ws(),d=i=>{switch(typeof i){case"string":return(0,f.hash)(i).toString(36);case"number":case"bigint":return i.toString(36);case"boolean":return i?"T":"F";case"object":if(i===null)return"N";if(Array.isArray(i)){const c=i.length;let t="[";for(let o=0;o<c;o++)t+=(0,e.structHash)(i[o])+",";return t+"]"}else{if(i instanceof Uint8Array)return(0,f.hash)(i).toString(36);{const c=Object.keys(i);(0,u.sort)(c);let t="{";const o=c.length;for(let s=0;s<o;s++){const r=c[s];t+=(0,f.hash)(r).toString(36)+":"+(0,e.structHash)(i[r])+","}return t+"}"}}default:return"U"}};e.structHash=d}(Ui)),Ui}var ml;function Ap(){return ml||(ml=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const u=vs(),f=dc(),d=ws(),i=sc(),c=t=>{if(t instanceof f.ConNode)return(0,i.structHash)(t.val);if(t instanceof f.ValNode)return(0,e.structHashCrdt)(t.node());if(t instanceof f.StrNode)return(0,d.hash)(t.view()).toString(36);if(t instanceof f.ObjNode){let o="{";const s=Array.from(t.keys.keys());(0,u.sort)(s);const r=s.length;for(let n=0;n<r;n++){const a=s[n],p=t.get(a);o+=(0,d.hash)(a).toString(36)+":"+(0,e.structHashCrdt)(p)+","}return o+"}"}else if(t instanceof f.ArrNode||t instanceof f.VecNode){let o="[";return t.children(s=>{o+=(0,e.structHashCrdt)(s)+","}),o+"]"}else if(t instanceof f.BinNode)return(0,d.hash)(t.view()).toString(36);return"U"};e.structHashCrdt=c}(Li)),Li}var $i={},gl;function Pp(){return gl||(gl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(ws(),e),u.__exportStar(sc(),e)}($i)),$i}var bl;function Mp(){if(bl)return xt;bl=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.JsonCrdtDiff=xt.DiffError=void 0;const e=ie,u=Tp(),f=Ip(),d=Gr(),i=ht(),c=e.__importStar(ys()),t=e.__importStar(jp()),o=e.__importStar(Vp()),s=Ap(),r=Pp();class n extends Error{constructor(h="DIFF"){super(h)}}xt.DiffError=n;let a=class{constructor(h){this.model=h,this.builder=new d.PatchBuilder(h.clock.clone())}diffStr(h,w){const y=h.view();if(y===w)return;const b=this.builder;c.apply(c.diff(y,w),y.length,(l,m)=>b.insStr(h.id,l?h.find(l-1):h.id,m),(l,m)=>b.del(h.id,h.findInterval(l,m)))}diffBin(h,w){const y=h.view();if((0,f.cmpUint8Array)(y,w))return;const b=this.builder;t.apply(t.diff(y,w),y.length,(l,m)=>b.insBin(h.id,l?h.find(l-1):h.id,m),(l,m)=>b.del(h.id,h.findInterval(l,m)))}diffArr(h,w){const y=[];h.children(O=>{y.push((0,s.structHashCrdt)(O))});const b=[],l=w.length;for(let O=0;O<l;O++)b.push((0,r.structHash)(w[O]));const m=o.diff(y,b);if(!m.length)return;const g=[],v=[],_=m.length;for(let O=_-1;O>=0;O--){const[x,R,E]=m[O];switch(x){case 0:break;case 1:{const T=w[E],N=R>=0?h.find(R):h.id;if(!N)throw new n;g.push([N,[T]]);break}case-1:{const T=h.findInterval(R,1);if(!T||!T.length)throw new n;v.push(...T);break}case 2:{const T=w[E];try{this.diffAny(h.getNode(R),T)}catch(N){if(N instanceof n){const M=h.findInterval(R,1);v.push(...M);const A=R?h.find(R-1):h.id;if(!A)throw new n;g.push([A,[T]])}else throw N}}}}const S=this.builder,C=g.length;for(let O=0;O<C;O++){const[x,R]=g[O];S.insArr(h.id,x,R.map(E=>S.json(E)))}v.length&&S.del(h.id,v)}diffObj(h,w){const y=this.builder,b=[],l=new Set;h.forEach(v=>{l.add(v),w[v]===void 0&&b.push([v,y.con(void 0)])});const m=Object.keys(w),g=m.length;for(let v=0;v<g;v++){const _=m[v],S=w[_];if(l.has(_)){const C=h.get(_);if(C)try{this.diffAny(C,S);continue}catch(O){if(!(O instanceof n))throw O}}b.push([_,h.get(_)instanceof i.ConNode?y.con(S):y.constOrJson(S)])}b.length&&y.insObj(h.id,b)}diffVec(h,w){const y=this.builder,b=[],l=h.elements,m=l.length,g=w.length,v=h.doc.index,_=Math.min(m,g);for(let S=g;S<m;S++){const C=l[S];if(C){const O=v.get(C);if(!O||O instanceof i.ConNode&&O.val===void 0)return;b.push([S,y.con(void 0)])}}for(let S=0;S<_;S++){const C=w[S],O=h.get(S);if(O)try{this.diffAny(O,C);continue}catch(x){if(!(x instanceof n))throw x}b.push([S,y.constOrJson(C)])}for(let S=m;S<g;S++)b.push([S,y.constOrJson(w[S])]);b.length&&y.insVec(h.id,b)}diffVal(h,w){try{this.diffAny(h.node(),w)}catch(y){if(y instanceof n){const b=this.builder;b.setVal(h.id,b.constOrJson(w))}else throw y}}diffAny(h,w){if(h instanceof i.ConNode){if(h.val!==w&&!(0,u.deepEqual)(h.val,w))throw new n}else if(h instanceof i.StrNode){if(typeof w!="string")throw new n;this.diffStr(h,w)}else if(h instanceof i.ObjNode){if(!w||typeof w!="object"||Array.isArray(w))throw new n;this.diffObj(h,w)}else if(h instanceof i.ValNode)this.diffVal(h,w);else if(h instanceof i.ArrNode){if(!Array.isArray(w))throw new n;this.diffArr(h,w)}else if(h instanceof i.VecNode){if(!Array.isArray(w))throw new n;this.diffVec(h,w)}else if(h instanceof i.BinNode){if(!(w instanceof Uint8Array))throw new n;this.diffBin(h,w)}else throw new n}diff(h,w){return this.diffAny(h,w),this.builder.flush()}};return xt.JsonCrdtDiff=a,xt}var yl;function qp(){return yl||(yl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const u=Mp(),f=(i,c)=>{const o=new u.JsonCrdtDiff(i.api.model).diff(i.node,c);return o.ops.length?o:void 0};e.diff=f;const d=(i,c)=>{const t=(0,e.diff)(i,c);return t&&i.api.model.applyPatch(t),t};e.merge=d}(ji)),ji}var zi={},vl;function Dp(){return vl||(vl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const u=(d,i=[])=>new Proxy(()=>{},{get:(c,t,o)=>(i.push(String(t)),(0,e.proxy)(d,i)),apply:(c,t,o)=>d(i,...o)});e.proxy=u;const f=(d,i,c=[])=>new Proxy({},{get:(t,o,s)=>o===i?d(c):(c.push(String(o)),(0,e.proxy$)(d,i,c))});e.proxy$=f}(zi)),zi}var wl;function Bp(){if(wl)return me;wl=1,Object.defineProperty(me,"__esModule",{value:!0}),me.ModelApi=me.ArrApi=me.BinApi=me.StrApi=me.ObjApi=me.VecApi=me.ValApi=me.ConApi=me.NodeApi=void 0;const e=ie,u=Ke(),f=nc(),d=bs(),i=Op(),c=ce(),t=ht(),o=Rp(),s=rc(),r=$r(),n=ic(),a=Np(),p=e.__importStar(qp()),h=Dp(),w=O=>{if(!O)return[void 0,""];if(typeof O=="number")return[void 0,O];switch(typeof O=="string"&&(O=(0,d.toPath)(O)),O.length){case 0:return[void 0,""];case 1:return[void 0,O[0]];default:{const x=O[O.length-1];return[O.slice(0,-1),x]}}};class y{constructor(x,R){this.node=x,this.api=R,this.ev=void 0}get events(){return this.ev||(this.ev=new o.NodeEvents(this))}find(x){let R=this.node;if(x===void 0){if(typeof R.child=="function"){const E=R.child();if(!E){if(R instanceof t.RootNode)return R;throw new Error("NO_CHILD")}return E}throw new Error("CANNOT_IN")}for(typeof x=="string"&&x&&x[0]!=="/"&&(x="/"+x),typeof x=="number"&&(x=[x]);R instanceof t.ValNode;)R=R.child();return(0,i.find)(R,x)}in(x){const R=this.find(x);return this.api.wrap(R)}asVal(){if(this.node instanceof t.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof t.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof t.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof t.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof t.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof t.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof t.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(x){let R;const E=this.node;if(E instanceof a.ExtNode&&(R=E),E instanceof t.VecNode&&(R=E.ext()),!R)throw new Error("NOT_EXT");const T=this.api.wrap(R);if(!x||T instanceof x.Api)return T;throw new Error("NOT_EXT")}val(x){return this.in(x).asVal()}str(x){return this.in(x).asStr()}bin(x){return this.in(x).asBin()}arr(x){return this.in(x).asArr()}vec(x){return this.in(x).asVec()}obj(x){return this.in(x).asObj()}con(x){return this.in(x).asCon()}view(){return this.node.view()}select(x,R){try{let E=x!==void 0?this.find(x):this.node;if(R)for(;E instanceof t.ValNode;)E=E.child();return this.api.wrap(E)}catch{return}}read(x){const R=this.view();if(Array.isArray(x))return(0,f.get)(R,x);if(!x)return R;let E=x+"";return x&&E[0]!=="/"&&(E="/"+E),(0,f.get)(R,(0,d.toPath)(E))}add(x,R){const[E,T]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g)N.set({[T]:R});else if(N instanceof S||N instanceof v||N instanceof _){const M=N.length();let A=0;if(typeof T=="number")A=T;else if(T==="-")A=M;else if(A=~~T,A+""!==T)break e;if(A!==A)break e;if(A<0&&(A=0),A>M&&(A=M),N instanceof S)N.ins(A,Array.isArray(R)?R:[R]);else if(N instanceof v)N.ins(A,R+"");else if(N instanceof _){if(!(R instanceof Uint8Array))break e;N.ins(A,R)}}else if(N instanceof m)N.set([[~~T,R]]);else break e;return!0}catch{}return!1}replace(x,R){const[E,T]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g){const M=T+"";if(!N.has(M))break e;N.set({[T]:R})}else if(N instanceof S){const M=N.length();let A=0;if(typeof T=="number")A=T;else if(A=~~T,A+""!==T)break e;if(A!==A||A<0||A>M)break e;A===M?N.ins(A,[R]):N.upd(A,R)}else if(N instanceof m)N.set([[~~T,R]]);else break e;return!0}catch{}return!1}remove(x,R=1){const[E,T]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g){const M=T+"";if(!N.has(M))break e;N.del([M])}else if(N instanceof S||N instanceof v||N instanceof _){const M=N.length();let A=0;if(typeof T=="number")A=T;else if(T==="-")A=R;else if(A=~~T,A+""!==T)break e;if(A!==A||A<0||A>M)break e;N.del(A,Math.min(R,M-A))}else if(N instanceof m)N.set([[~~T,void 0]]);else break e;return!0}catch{}return!1}diff(x){return p.diff(this,x)}merge(x){return p.merge(this,x)}op(x){var N;if(!Array.isArray(x))return!1;const[R,E,T]=x;switch(R){case"add":return this.add(E,T);case"replace":return this.replace(E,T);case"merge":return!!((N=this.select(E))!=null&&N.merge(T));case"remove":return this.remove(E,T)}}get s(){return{$:this}}get $(){return(0,h.proxy$)(x=>{try{return this.api.wrap(this.find(x))}catch{return}},"$")}toString(x=""){return"api("+(this.constructor===y?"*":this.node.name())+")"+(0,u.printTree)(x,[E=>this.node.toString(E)])}}me.NodeApi=y;class b extends y{get s(){return{$:this}}}me.ConApi=b;class l extends y{get(){return this.in()}set(x){const{api:R,node:E}=this,N=R.builder.constOrJson(x);R.builder.setVal(E.id,N),R.apply()}get s(){const x=this;return{$:this,get _(){const E=x.node.node();return x.api.wrap(E).s}}}}me.ValApi=l;class m extends y{get(x){return this.in(x)}set(x){const{api:R,node:E}=this,{builder:T}=R;T.insVec(E.id,x.map(([N,M])=>[N,T.constOrJson(M)])),R.apply()}push(...x){const R=this.length();this.set(x.map((E,T)=>[R+T,E]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(R,E,T)=>{if(E==="$")return this;if(E==="toExt")return()=>this.asExt();const N=Number(E);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const M=this.node.get(N);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}me.VecApi=m;class g extends y{get(x){return this.in(x)}set(x){const{api:R,node:E}=this,{builder:T}=R;T.insObj(E.id,Object.entries(x).map(([N,M])=>[N,T.constOrJson(M)])),R.apply()}del(x){const{api:R,node:E}=this,{builder:T}=R;R.builder.insObj(E.id,x.map(N=>[N,T.con(void 0)])),R.apply()}has(x){return this.node.keys.has(x)}get s(){return new Proxy({},{get:(R,E,T)=>{if(E==="$")return this;const N=String(E),M=this.node.get(N);if(!M)throw new Error("NO_SUCH_KEY");return this.api.wrap(M).s}})}}me.ObjApi=g;class v extends y{ins(x,R){const{api:E,node:T}=this;E.onBeforeLocalChange.emit(E.next);const N=E.builder;N.pad();const M=E.builder.nextTime(),A=new c.Timestamp(N.clock.sid,M),q=T.insAt(x,A,R);if(!q)throw new Error("OUT_OF_BOUNDS");N.insStr(T.id,q,R),E.advance()}del(x,R){const{api:E,node:T}=this;E.onBeforeLocalChange.emit(E.next);const N=E.builder;N.pad();const M=T.findInterval(x,R);if(!M)throw new Error("OUT_OF_BOUNDS");T.delete(M),N.del(T.id,M),E.advance()}findId(x){const R=this.node,T=R.length()-1;return x>T&&(x=T),x<0?R.id:R.find(x)||R.id}findPos(x){const R=this.node,E=R.id;if(E.sid===x.sid&&E.time===x.time)return-1;const T=R.findById(x);return T?R.pos(T)+(T.del?0:x.time-T.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}me.StrApi=v;class _ extends y{ins(x,R){const{api:E,node:T}=this,N=x?T.find(x-1):T.id;if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.insBin(T.id,N,R),E.apply()}del(x,R){const{api:E,node:T}=this,N=T.findInterval(x,R);if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.del(T.id,N),E.apply()}length(){return this.node.length()}get s(){return{$:this}}}me.BinApi=_;class S extends y{get(x){return this.in(x)}ins(x,R){const{api:E,node:T}=this,{builder:N}=E,M=x?T.find(x-1):T.id;if(!M)throw new Error("OUT_OF_BOUNDS");const A=[];for(let q=0;q<R.length;q++)A.push(N.json(R[q]));N.insArr(T.id,M,A),E.apply()}push(...x){const R=this.length();this.ins(R,x)}upd(x,R){const{api:E,node:T}=this,N=T.getId(x);if(!N)throw new Error("OUT_OF_BOUNDS");const{builder:M}=E;M.updArr(T.id,N,M.constOrJson(R)),E.apply()}del(x,R){const{api:E,node:T}=this,N=T.findInterval(x,R);if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.del(T.id,N),E.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(R,E,T)=>{if(E==="$")return this;const N=Number(E);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const M=this.node.getNode(N);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}me.ArrApi=S;class C extends l{constructor(x){super(x.root,void 0),this.model=x,this.next=0,this.onBeforeReset=new s.FanOut,this.onReset=new s.FanOut,this.onBeforePatch=new s.FanOut,this.onPatch=new s.FanOut,this.onBeforeLocalChange=new s.FanOut,this.onLocalChange=new s.FanOut,this.onLocalChanges=new n.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new s.FanOut,this.onTransaction=new s.FanOut,this.onChange=new n.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new n.MicrotaskBufferFanOut(this.onChange),this.onFlush=new s.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=R=>this.onChanges.listen(()=>R()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new r.PatchBuilder(x.clock),x.onbeforereset=()=>this.onBeforeReset.emit(),x.onreset=()=>this.onReset.emit(),x.onbeforepatch=R=>this.onBeforePatch.emit(R),x.onpatch=R=>this.onPatch.emit(R)}wrap(x){if(x instanceof t.ValNode)return x.api||(x.api=new l(x,this));if(x instanceof t.StrNode)return x.api||(x.api=new v(x,this));if(x instanceof t.BinNode)return x.api||(x.api=new _(x,this));if(x instanceof t.ArrNode)return x.api||(x.api=new S(x,this));if(x instanceof t.ObjNode)return x.api||(x.api=new g(x,this));if(x instanceof t.ConNode)return x.api||(x.api=new b(x,this));if(x instanceof t.VecNode)return x.api||(x.api=new m(x,this));if(x instanceof a.ExtNode){if(x.api)return x.api;const R=this.model.ext.get(x.extId);return x.api=new R.Api(x,this)}else throw new Error("UNKNOWN_NODE")}root(x){return this.set(x)}set(x){return super.set(x),this}apply(){const x=this.builder.patch.ops,R=x.length,E=this.model,T=this.next;this.onBeforeLocalChange.emit(T);for(let N=this.next;N<R;N++)E.applyOperation(x[N]);this.next=R,E.tick++,this.onLocalChange.emit(T)}advance(){const x=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(x)}transaction(x){if(this.inTx)x();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),x(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const x=this.builder.flush();return this.next=0,x.ops.length&&this.onFlush.emit(x),x}autoFlush(x=!1){const R=()=>this.builder.patch.ops.length&&this.flush(),E=this.onLocalChanges.listen(R),T=this.onBeforeTransaction.listen(R),N=this.onTransaction.listen(R);return x&&R(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,E(),T(),N()}}}return me.ModelApi=C,me}var _l;function oc(){return _l||(_l=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ie.__exportStar(Bp(),e)}(Ri)),Ri}var ir={},Sl;function Lp(){if(Sl)return ir;Sl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.randomSessionId=void 0;const e=65535,u=9007199254740991-e,f=()=>Math.floor(u*Math.random()+e);return ir.randomSessionId=f,ir}var sr={},xl;function Fp(){if(xl)return sr;xl=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.Extensions=void 0;const e=Ke();let u=class ac{constructor(){this.ext={}}register(d){this.ext[d.id]=d}get(d){return this.ext[d]}size(){return Object.keys(this.ext).length}clone(){const d=new ac;for(const i of Object.values(this.ext))d.register(i);return d}toString(d=""){const i=Object.keys(this.ext).map(c=>+c).sort();return"extensions"+(0,e.printTree)(d,i.map(c=>t=>`${c}: ${this.ext[c].name}`))}};return sr.Extensions=u,sr}var Ct={},Gi={},Wi={},or={},Cl;function _s(){if(Cl)return or;Cl=1,Object.defineProperty(or,"__esModule",{value:!0}),or.printBinary=void 0;const e=(u="",f)=>{const d=f[0],i=f[1];let c="";return d&&(c+=`
`+u+"â† "+d(u+"  ")),i&&(c+=`
`+u+"â†’ "+i(u+"  ")),c};return or.printBinary=e,or}var Ol;function Up(){return Ol||(Ol=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ie.__exportStar(_s(),e)}(Wi)),Wi}var Rl;function $p(){return Rl||(Rl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const u=Up(),f=JSON.stringify,d=(y,b,l)=>{const m=b.p;if(!m)return y;const g=b===m.l;let v=m.bf|0;switch(g?m.bf=++v:m.bf=--v,v){case 0:return y;case 1:case-1:return d(y,m,b);default:{const _=l===b.l;return g?_?(i(m,b),b.p?y:b):(t(m,b,l),l.p?y:l):_?(o(m,b,l),l.p?y:l):(c(m,b),b.p?y:b)}}},i=(y,b)=>{const l=y.p,m=b.r;b.p=l,b.r=y,y.p=b,y.l=m,m&&(m.p=y),l&&(l.l===y?l.l=b:l.r=b);let g=y.bf,v=b.bf;g+=-1-(v>0?v:0),v+=-1+(g<0?g:0),y.bf=g,b.bf=v},c=(y,b)=>{const l=y.p,m=b.l;b.p=l,b.l=y,y.p=b,y.r=m,m&&(m.p=y),l&&(l.l===y?l.l=b:l.r=b);let g=y.bf,v=b.bf;g+=1-(v<0?v:0),v+=1+(g>0?g:0),y.bf=g,b.bf=v},t=(y,b,l)=>{c(b,l),i(y,l)},o=(y,b,l)=>{i(b,l),c(y,l)},s=(y,b,l)=>(l.r=b,b.p=l,l.bf--,l.l?y:d(y,l,b));e.insertRight=s;const r=(y,b,l)=>(l.l=b,b.p=l,l.bf++,l.r?y:d(y,l,b));e.insertLeft=r;const n=(y,b,l)=>{if(!y)return b;const m=b.k;let g=y,v,_=0;for(;v=(_=l(m,g.k))<0?g.l:g.r;)g=v;return _<0?(0,e.insertLeft)(y,b,g):(0,e.insertRight)(y,b,g)};e.insert=n;const a=(y,b)=>{if(!y)return b;const l=b.p,m=b.l,g=b.r;if(b.p=b.l=b.r=void 0,m&&g)if(m.r){let S=m,C=S;for(;C=S.r;)S=C;const O=S.l,x=S.p,R=O;return l&&(l.l===b?l.l=S:l.r=S),S.p=l,S.r=g,S.bf=b.bf,m!==S&&(S.l=m,m.p=S),g.p=S,x&&(x.l===S?x.l=R:x.r=R),R&&(R.p=x),h(l?y:S,x,1)}else{l&&(l.l===b?l.l=m:l.r=m),m.p=l,m.r=g,g.p=m;const S=b.bf;if(l)return m.bf=S,p(y,m,1);const C=S-1;if(m.bf=C,C>=-1)return m;const O=g.l;return g.bf>0?(o(m,g,O),O):(c(m,g),g)}const v=m||g;return v&&(v.p=l),l?l.l===b?(l.l=v,p(y,l,1)):(l.r=v,h(y,l,1)):v};e.remove=a;const p=(y,b,l)=>{let m=b.bf|0;m-=l,b.bf=m;let g=l;if(m===-1)return y;if(m<-1){const _=b.r;if(_.bf<=0)_.l&&_.bf===0&&(g=0),c(b,_),b=_;else{const S=_.l;o(b,_,S),b=S}}const v=b.p;return v?v.l===b?p(y,v,g):h(y,v,g):b},h=(y,b,l)=>{let m=b.bf|0;m+=l,b.bf=m;let g=l;if(m===1)return y;if(m>1){const _=b.l;if(_.bf>=0)_.r&&_.bf===0&&(g=0),i(b,_),b=_;else{const S=_.r;t(b,_,S),b=S}}const v=b.p;return v?v.l===b?p(y,v,g):h(y,v,g):b},w=(y,b="")=>{if(!y)return"âˆ…";const{bf:l,l:m,r:g,k:v,v:_}=y,S=_&&typeof _=="object"&&_.constructor===Object?f(_):_&&typeof _=="object"?_.toString(b):f(_),C=v!==void 0?` { ${f(v)} = ${S} }`:"",O=l?` [${l}]`:"";return y.constructor.name+`${O}`+C+(0,u.printBinary)(b,[m?x=>(0,e.print)(m,x):null,g?x=>(0,e.print)(g,x):null])};e.print=w}(Gi)),Gi}var ar={},Hi={},lr={},Nl;function lc(){if(Nl)return lr;Nl=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.first=void 0;const e=u=>{let f=u;for(;f;)if(f.l)f=f.l;else return f;return f};return lr.first=e,lr}var ur={},El;function zp(){if(El)return ur;El=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.next=void 0;const e=lc(),u=f=>{const d=f.r;if(d)return(0,e.first)(d);let i=f.p;for(;i&&i.r===f;)f=i,i=i.p;return i};return ur.next=u,ur}var Tl;function uc(){return Tl||(Tl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const u=lc();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return u.first}});const f=zp();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return f.next}});const d=h=>{let w=h;for(;w;)if(w.r)w=w.r;else return w;return w};e.last=d;const i=h=>{if(h.l){for(h=h.l;h.r;)h=h.r;return h}let w=h.p;for(;w&&w.l===h;)h=w,w=w.p;return w};e.prev=i;const c=h=>{const w=h.l,y=h.r;return 1+(w?c(w):0)+(y?c(y):0)},t=h=>h?c(h):0;e.size=t;const o=(h,w,y)=>{let b=h;for(;b;){const l=y(w,b.k);if(l===0)return b;b=l<0?b.l:b.r}return b};e.find=o;const s=(h,w,y)=>{let b=h,l;for(;b;){const m=y(b.k,w);if(m===0)return b;if(m>0)b=b.l;else{const g=b.r;if(l=b,!g)return l;b=g}}return l};e.findOrNextLower=s;const r=(h,w)=>{const y=h.r=w.r;w.r=h,h.p=w,y&&(y.p=h)};e.insertRight=r;const n=(h,w)=>{const y=h.l=w.l;w.l=h,h.p=w,y&&(y.p=h)};e.insertLeft=n;const a=(h,w,y)=>{if(!h)return w;const b=w.k;let l=h;for(;l;){const m=y(b,l.k),g=m<0?l.l:l.r;if(g)l=g;else{m<0?(0,e.insertLeft)(w,l):(0,e.insertRight)(w,l);break}}return h};e.insert=a;const p=(h,w)=>{const y=w.p,b=w.l,l=w.r;if(w.p=w.l=w.r=void 0,!b&&!l){if(y)y.l===w?y.l=void 0:y.r=void 0;else return;return h}else if(b&&l){let g=b;for(;g.r;)g=g.r;return g.r=l,l.p=g,y?(y.l===w?y.l=b:y.r=b,b.p=y,h):(b.p=void 0,b)}const m=b||l;if(m.p=y,y)y.l===w?y.l=m:y.r=m;else return m;return h};e.remove=p}(Hi)),Hi}var Ji={},Il;function Gp(){return Il||(Il=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ie.__exportStar(Ke(),e)}(Ji)),Ji}var kl;function Wp(){if(kl)return ar;kl=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.createMap=void 0;const e=uc(),u=Gp(),f=(i,c)=>i===c?0:i<c?-1:1,d=(i,c,t,o,s,r)=>{class n{constructor(p){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=p||f}set(p,h){const w=this.root;if(w===void 0){this._size=1;const v=new i(p,h);return this.root=this.min=this.max=c(void 0,v,this.comparator)}const y=this.comparator;let b;const l=this.max;if(b=y(p,l.k),b===0)return l.v=h,l;if(b>0){const v=this.max=new i(p,h);return this.root=o(w,v,l),this._size++,v}const m=this.min;if(b=y(p,m.k),b===0)return m.v=h,m;if(b<0){const v=this.min=new i(p,h);return this.root=t(w,v,m),this._size++,v}let g=w;do{if(b=y(p,g.k),b===0)return g.v=h,g;if(b>0){const v=g.r;if(v===void 0){const _=new i(p,h);return this.root=o(w,_,g),this._size++,_}g=v}else if(b<0){const v=g.l;if(v===void 0){const _=new i(p,h);return this.root=t(w,_,g),this._size++,_}g=v}}while(!0)}find(p){const h=this.comparator;let w=this.root;for(;w;){const y=+h(p,w.k);if(y===0)return w;w=y<0?w.l:w.r}}get(p){var h;return(h=this.find(p))==null?void 0:h.v}del(p){const h=this.find(p);return h?(h===this.max&&(this.max=(0,e.prev)(h)),h===this.min&&(this.min=(0,e.next)(h)),this.root=s(this.root,h),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(p){return!!this.find(p)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(p){return(0,e.findOrNextLower)(this.root,p,this.comparator)||void 0}forEach(p){let h=this.first();if(h)do p(h);while(h=(0,e.next)(h))}first(){return this.min}last(){return this.max}iterator0(){let p=this.first();return()=>{if(!p)return;const h=p;return p=(0,e.next)(p),h}}iterator(){const p=this.iterator0();return{next:()=>{const h=p();return{value:h,done:!h}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(p){return this.constructor.name+(0,u.printTree)(p,[h=>r(this.root,h)])}}return n};return ar.createMap=d,ar}var jl;function Hp(){if(jl)return Ct;jl=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.AvlMap=Ct.AvlNode=void 0;const e=$p(),u=Wp();class f{constructor(i,c){this.k=i,this.v=c,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Ct.AvlNode=f,Ct.AvlMap=(0,u.createMap)(f,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),Ct}var Vl;function Ss(){if(Vl)return wt;Vl=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.Model=wt.UNDEFINED=void 0;const e=ie,u=e.__importStar(Jt()),f=e.__importStar(ce()),d=yp(),i=oc(),c=Ur(),t=Lp(),o=ht(),s=zr(),r=Ke(),n=Fp(),a=Hp(),p=Gr();wt.UNDEFINED=new s.ConNode(c.ORIGIN,void 0);let h=class is{rndSid(){const y=this.clock,b=y.sid,l=y.peers;for(;;){const m=(0,t.randomSessionId)();if(b!==m&&!l.has(m))return m}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const m=y[0].getId().sid;if(!m)throw new Error("NO_SID");const g=is.create(void 0,m);return g.applyBatch(y),g}constructor(y){this.root=new o.RootNode(this,c.ORIGIN),this.index=new a.AvlMap(f.compare),this.ext=new n.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new i.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const b=y.length;for(let l=0;l<b;l++)this.applyPatch(y[l])}applyLocalPatch(y){const b=y.getId();if(b){const l=this.clock;if(l.sid===b.sid){const m=l.time;m>b.time&&(y=y.rebase(m))}}this.applyPatch(y)}applyPatch(y){var m,g;(m=this.onbeforepatch)==null||m.call(this,y);const b=y.ops,{length:l}=b;for(let v=0;v<l;v++)this.applyOperation(b[v]);this.tick++,(g=this.onpatch)==null||g.call(this,y)}applyOperation(y){this.clock.observe(y.id,y.span());const b=this.index;if(y instanceof u.InsStrOp){const l=b.get(y.obj);l instanceof o.StrNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof u.NewObjOp){const l=y.id;b.get(l)||b.set(l,new o.ObjNode(this,l))}else if(y instanceof u.NewArrOp){const l=y.id;b.get(l)||b.set(l,new o.ArrNode(this,l))}else if(y instanceof u.NewStrOp){const l=y.id;b.get(l)||b.set(l,new o.StrNode(l))}else if(y instanceof u.NewValOp){const l=y.id;b.get(l)||b.set(l,new o.ValNode(this,l,c.ORIGIN))}else if(y instanceof u.NewConOp){const l=y.id;b.get(l)||b.set(l,new s.ConNode(l,y.val))}else if(y instanceof u.InsObjOp){const l=b.get(y.obj),m=y.data,g=m.length;if(l instanceof o.ObjNode)for(let v=0;v<g;v++){const _=m[v],S=b.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(_[0]+"",S.id);C&&this._gcTree(C)}}else if(y instanceof u.InsVecOp){const l=b.get(y.obj),m=y.data,g=m.length;if(l instanceof o.VecNode)for(let v=0;v<g;v++){const _=m[v],S=b.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(Number(_[0]),S.id);C&&this._gcTree(C)}}else if(y instanceof u.InsValOp){const l=y.obj,m=l.sid===0&&l.time===0?this.root:b.get(l);if(m instanceof o.ValNode&&b.get(y.val)){const v=m.set(y.val);v&&this._gcTree(v)}}else if(y instanceof u.InsArrOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const m=[],g=y.data,v=g.length;for(let _=0;_<v;_++){const S=g[_];b.get(S)&&(l.id.time>=S.time||m.push(S))}m.length&&l.ins(y.ref,y.id,m)}}else if(y instanceof u.UpdArrOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const m=y.val;if(b.get(m)){const g=l.upd(y.ref,m);g&&this._gcTree(g)}}}else if(y instanceof u.DelOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const m=y.what.length;for(let g=0;g<m;g++){const v=y.what[g];for(let _=0;_<v.span;_++){const S=l.getById(new f.Timestamp(v.sid,v.time+_));S&&this._gcTree(S)}}l.delete(y.what)}else(l instanceof o.StrNode||l instanceof o.BinNode)&&l.delete(y.what)}else if(y instanceof u.NewBinOp){const l=y.id;b.get(l)||b.set(l,new o.BinNode(l))}else if(y instanceof u.InsBinOp){const l=b.get(y.obj);l instanceof o.BinNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof u.NewVecOp){const l=y.id;b.get(l)||b.set(l,new o.VecNode(this,l))}}_gcTree(y){if(y.sid===0)return;const l=this.index.get(y);if(!l)return;const m=l.api;m&&m.events.handleDelete(),l.children(g=>this._gcTree(g.id)),this.index.del(y)}fork(y=this.rndSid()){const b=is.fromBinary(this.toBinary());return b.clock.sid!==y&&b.clock instanceof f.ClockVector&&(b.clock=b.clock.fork(y)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(y){var g,v;(g=this.onbeforereset)==null||g.call(this);const b=this.index;this.index=new a.AvlMap(f.compare);const l=y.toBinary();d.decoder.decode(l,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const m=this._api;m&&(m.flush(),m.builder.clock=this.clock,m.node=this.root),b.forEach(({v:_})=>{const S=_.api;if(!S)return;const C=this.index.get(_.id);if(!C){S.events.handleDelete();return}S.node=C,C.api=S}),this.tick++,(v=this.onreset)==null||v.call(this)}view(){return this.root.view()}toBinary(){return d.encoder.encode(this)}setSchema(y,b=!0){const l=this.clock;if(l.time===1){const g=l.sid;b&&(l.sid=2),this.api.set(y),b&&this.setSid(g)}return this}setSid(y){const b=this.clock,l=b.sid;l!==y&&(b.sid=y,b.observe(new f.Timestamp(l,b.time-1),1))}toString(y=""){const b=()=>"",l=this.ext.size()>0;return"model"+(0,r.printTree)(y,[m=>this.root.toString(m),b,m=>{const g=[];return this.index.forEach(v=>g.push(v.v)),`index (${g.length} nodes)`+(g.length?(0,r.printTree)(m,g.map(v=>_=>`${v.name()} ${f.printTs(v.id)}`)):"")},b,m=>`view${(0,r.printTree)(m,[g=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+g)])}`,b,m=>this.clock.toString(m),l?b:null,l?m=>this.ext.toString(m):null])}};return wt.Model=h,h.sid=t.randomSessionId,h.create=(w,y=h.sid())=>{const b=typeof y=="number"?y===1?new f.ServerClockVector(1,1):new f.ClockVector(y,1):y,l=new h(b);return w!==void 0&&l.setSchema(w instanceof p.NodeBuilder?w:p.s.json(w),!0),l},h.withServerClock=(w,y=1)=>h.create(w,new f.ServerClockVector(1,y)),h.fromBinary=w=>d.decoder.decode(w),h.load=(w,y,b)=>{const l=d.decoder.decode(w);return b&&l.setSchema(b,!0),typeof y=="number"&&l.setSid(y),l},wt}var Al;function cc(){if(Al)return $n;Al=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.ValNode=void 0;const e=ce(),u=Ke(),f=Ss();let d=class{constructor(c,t,o){this.doc=c,this.id=t,this.val=o,this.api=void 0}set(c){if((0,e.compare)(c,this.val)<=0&&this.val.sid!==0||(0,e.compare)(c,this.id)<=0)return;const t=this.val;return this.val=c,t}node(){return this.val.sid===0?f.UNDEFINED:this.child()}view(){var c;return(c=this.node())==null?void 0:c.view()}children(c){c(this.node())}child(){return this.doc.index.get(this.val)}container(){const c=this.node();return c?c.container():void 0}name(){return"val"}toString(c=""){const t=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,u.printTree)(c,[s=>t?t.toString(s):(0,e.printTs)(this.val)])}};return $n.ValNode=d,$n}var cr={},Pl;function Jp(){if(Pl)return cr;Pl=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.RootNode=void 0;const e=Ur(),u=cc();let f=class extends u.ValNode{constructor(i,c){super(i,e.ORIGIN,c)}name(){return"root"}};return cr.RootNode=f,cr}var dr={},fr={},Ml;function Kp(){if(Ml)return fr;Ml=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.CRDT_CONSTANTS=void 0;var e;return function(u){u[u.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(e||(fr.CRDT_CONSTANTS=e={})),fr}var ql;function Yp(){if(ql)return dr;ql=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.VecNode=void 0;const e=zr(),u=Kp(),f=Ke(),d=ce();let i=class{constructor(t,o){this.doc=t,this.id=o,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(t){return this.elements[t]}get(t){const o=this.elements[t];if(o)return this.doc.index.get(o)}put(t,o){if(t>u.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const s=this.val(t);if(!(s&&(0,d.compare)(s,o)>=0)){if(t>this.elements.length)for(let r=this.elements.length;r<t;r++)this.elements.push(void 0);return t<this.elements.length?this.elements[t]=o:this.elements.push(o),s}}ext(){if(this.__extNode)return this.__extNode;const t=this.getExtId();if(!(t>=0))return;const s=this.doc.ext.get(t);if(s)return this.__extNode=new s.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const t=this.get(0);if(!(t instanceof e.ConNode))return-1;const o=t.val,s=this.id;return!(o instanceof Uint8Array)||o.length!==3||o[1]!==s.sid%256||o[2]!==s.time%256?-1:o[0]}child(){return this.ext()}container(){return this}children(t){const o=this.elements,s=o.length,r=this.doc.index;for(let n=0;n<s;n++){const a=o[n];if(!a)continue;const p=r.get(a);p&&t(p)}}view(){const t=this.ext();if(t)return t.view();let o=!0;const s=this._view,r=[],n=this.doc.index,a=this.elements,p=a.length;for(let h=0;h<p;h++){const w=a[h],y=w?n.get(w):void 0,b=y?y.view():void 0;s[h]!==b&&(o=!1),r.push(b)}return o?s:this._view=r}name(){return"vec"}toString(t=""){const o=this.ext(),s=this.name()+" "+(0,d.printTs)(this.id)+(o?` { extension = ${this.getExtId()} }`:"");if(o)return this.child().toString(t,this.id);const r=this.doc.index;return s+(0,f.printTree)(t,[...this.elements.map((n,a)=>p=>`${a}: ${n&&r.get(n)?r.get(n).toString(p+"  "+" ".repeat((""+a).length)):"nil"}`),...o?[n=>`${this.child().toString(n)}`]:[]])}};return dr.VecNode=i,dr}var hr={},Dl;function Xp(){if(Dl)return hr;Dl=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.ObjNode=void 0;const e=Ke(),u=ce(),f=zr();let d=class{constructor(c,t){this.doc=c,this.id=t,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(c){const t=this.keys.get(c);if(t)return this.doc.index.get(t)}put(c,t){const o=this.keys.get(c);if(!(o&&(0,u.compare)(o,t)>=0))return this.keys.set(c,t),o}nodes(c){const t=this.doc.index;this.keys.forEach((o,s)=>c(t.get(o),s))}forEach(c){const t=this.doc.index;this.keys.forEach((o,s)=>{const r=t.get(o);!r||r instanceof f.ConNode&&r.val===void 0||c(s,r)})}children(c){const t=this.doc.index;this.keys.forEach((o,s)=>c(t.get(o)))}child(){}container(){return this}view(){const c=this.doc,t=c.clock.time+c.tick,o=this._view;if(this._tick===t)return o;const s={},r=c.index;let n=!0;return this.keys.forEach((a,p)=>{const h=r.get(a);if(!h){n=!1;return}const w=h.view();w!==void 0?(o[p]!==w&&(n=!1),s[p]=w):o[p]!==void 0&&(n=!1)}),n?o:(this._tick=t,this._view=s)}name(){return"obj"}toString(c=""){return this.name()+" "+(0,u.printTs)(this.id)+(0,e.printTree)(c,[...this.keys.entries()].filter(([,o])=>!!this.doc.index.get(o)).map(([o,s])=>r=>JSON.stringify(o)+(0,e.printTree)(r+" ",[n=>this.doc.index.get(s).toString(n)])))}};return hr.ObjNode=d,hr}var Ot={},pr={},Ki={},Bl;function Qp(){return Bl||(Bl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const u=(s,r,n)=>{const a=r.p;if(!a)return s;const p=a.p,h=a.l===r;return p?(p.l===a?h?s=(0,e.llSplay)(s,r,a,p):s=(0,e.lrSplay)(s,r,a,p):h?s=(0,e.rlSplay)(s,r,a,p):s=(0,e.rrSplay)(s,r,a,p),n>1?(0,e.splay)(s,r,n-1):s):(h?(0,e.rSplay)(r,a):(0,e.lSplay)(r,a),r)};e.splay=u;const f=(s,r)=>{const n=s.r;s.p=void 0,s.r=r,r.p=s,r.l=n,n&&(n.p=r)};e.rSplay=f;const d=(s,r)=>{const n=s.l;s.p=void 0,s.l=r,r.p=s,r.r=n,n&&(n.p=r)};e.lSplay=d;const i=(s,r,n,a)=>{const p=n.l,h=r.l,w=a.p;return r.p=w,r.l=n,n.p=r,n.l=a,n.r=h,a.p=n,a.r=p,p&&(p.p=a),h&&(h.p=n),w?w.l===a?w.l=r:w.r=r:s=r,s};e.rrSplay=i;const c=(s,r,n,a)=>{const p=n.r,h=r.r,w=a.p;return r.p=w,r.r=n,n.p=r,n.l=h,n.r=a,a.p=n,a.l=p,p&&(p.p=a),h&&(h.p=n),w?w.l===a?w.l=r:w.r=r:s=r,s};e.llSplay=c;const t=(s,r,n,a)=>{const p=r.l,h=r.r,w=a.p;return r.p=w,r.l=n,r.r=a,n.p=r,n.r=p,a.p=r,a.l=h,p&&(p.p=n),h&&(h.p=a),w?w.l===a?w.l=r:w.r=r:s=r,s};e.lrSplay=t;const o=(s,r,n,a)=>{const p=r.r,h=r.l,w=a.p;return r.p=w,r.l=a,r.r=n,n.p=r,n.l=p,a.p=r,a.r=h,p&&(p.p=n),h&&(h.p=a),w?w.l===a?w.l=r:w.r=r:s=r,s};e.rlSplay=o}(Ki)),Ki}var Yi={},Ll;function Zp(){return Ll||(Ll=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const u=(s,r)=>{const n=r.p2;if(!n)return s;const a=n.p2,p=n.l2===r;return a?(a.l2===n?p?s=c(s,r,n,a):s=t(s,r,n,a):p?s=o(s,r,n,a):s=i(s,r,n,a),(0,e.splay2)(s,r)):(p?f(r,n):d(r,n),r)};e.splay2=u;const f=(s,r)=>{const n=s.r2;s.p2=void 0,s.r2=r,r.p2=s,r.l2=n,n&&(n.p2=r)},d=(s,r)=>{const n=s.l2;s.p2=void 0,s.l2=r,r.p2=s,r.r2=n,n&&(n.p2=r)},i=(s,r,n,a)=>{const p=n.l2,h=r.l2,w=a.p2;return r.p2=w,r.l2=n,n.p2=r,n.l2=a,n.r2=h,a.p2=n,a.r2=p,p&&(p.p2=a),h&&(h.p2=n),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},c=(s,r,n,a)=>{const p=n.r2,h=r.r2,w=a.p2;return r.p2=w,r.r2=n,n.p2=r,n.l2=h,n.r2=a,a.p2=n,a.l2=p,p&&(p.p2=a),h&&(h.p2=n),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},t=(s,r,n,a)=>{const p=r.l2,h=r.r2,w=a.p2;return r.p2=w,r.l2=n,r.r2=a,n.p2=r,n.r2=p,a.p2=r,a.l2=h,p&&(p.p2=n),h&&(h.p2=a),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},o=(s,r,n,a)=>{const p=r.r2,h=r.l2,w=a.p2;return r.p2=w,r.l2=a,r.r2=n,n.p2=r,n.l2=p,a.p2=r,a.r2=h,p&&(p.p2=n),h&&(h.p2=a),w?w.l2===a?w.l2=r:w.r2=r:s=r,s}}(Yi)),Yi}var Se={},Fl;function e0(){if(Fl)return Se;Fl=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.remove2=Se.insert2=Se.prev2=Se.next2=Se.last2=Se.first2=void 0;const e=s=>{let r=s;for(;r;)if(r.l2)r=r.l2;else return r;return r};Se.first2=e;const u=s=>{let r=s;for(;r;)if(r.r2)r=r.r2;else return r;return r};Se.last2=u;const f=s=>{if(s.r2){for(s=s.r2;s.l2;)s=s.l2;return s}let r=s.p2;for(;r&&r.r2===s;)s=r,r=r.p2;return r};Se.next2=f;const d=s=>{if(s.l2){for(s=s.l2;s.r2;)s=s.r2;return s}let r=s.p2;for(;r&&r.l2===s;)s=r,r=r.p2;return r};Se.prev2=d;const i=(s,r)=>{const n=s.r2=r.r2;r.r2=s,s.p2=r,n&&(n.p2=s)},c=(s,r)=>{const n=s.l2=r.l2;r.l2=s,s.p2=r,n&&(n.p2=s)},t=(s,r,n)=>{if(!s)return r;let a=s;for(;a;){const p=n(r,a),h=p<0?a.l2:a.r2;if(h)a=h;else{p<0?c(r,a):i(r,a);break}}return s};Se.insert2=t;const o=(s,r)=>{const n=r.p2,a=r.l2,p=r.r2;if(r.p2=r.l2=r.r2=void 0,!a&&!p){if(n)n.l2===r?n.l2=void 0:n.r2=void 0;else return;return s}else if(a&&p){let w=a;for(;w.r2;)w=w.r2;return w.r2=p,p.p2=w,n?(n.l2===r?n.l2=a:n.r2=a,a.p2=n,s):(a.p2=void 0,a)}const h=a||p;if(h.p2=n,n)n.l2===r?n.l2=h:n.r2=h;else return h;return s};return Se.remove2=o,Se}var mr={},Ul;function t0(){if(Ul)return mr;Ul=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.printOctets=void 0;const e=(u,f=16)=>{let d="";if(!u.length)return d;u[0]<16&&(d+="0"),d+=u[0].toString(16);for(let i=1;i<u.length&&i<f;i++){const c=u[i];d+=" ",c<16&&(d+="0"),d+=c.toString(16)}return u.length>f&&(d+=`â€¦ (${u.length-f} more)`),d};return mr.printOctets=e,mr}var $l;function xs(){if($l)return pr;$l=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.AbstractRga=void 0;const e=ce(),u=hs(),f=Qp(),d=Zp(),i=e0(),c=Ur(),t=Ke(),o=_s(),s=t0(),r=(b,l)=>{const m=b.id,g=l.id;return m.sid-g.sid||m.time-g.time},n=b=>{const l=b.l,m=b.r;b.len=(b.del?0:b.span)+(l?l.len:0)+(m?m.len:0)},a=b=>{const l=b.l,m=b.r;b.len=b.span+(l?l.len:0)+(m?m.len:0)},p=(b,l)=>{for(;b;)b.len+=l,b=b.p},h=b=>{const l=b.r;if(l){b=l;let g;for(;g=b.l;)b=g;return b}let m=b.p;for(;m&&m.r===b;)b=m,m=m.p;return m},w=b=>{const l=b.l;if(l){b=l;let g;for(;g=b.r;)b=g;return b}let m=b.p;for(;m&&m.l===b;)b=m,m=m.p;return m};let y=class{constructor(l){this.id=l,this.root=void 0,this.ids=void 0,this.count=0}ins(l,m,g){const v=this.id,_=l.time,S=l.sid;if(v.time===_&&v.sid===S){this.insAfterRoot(l,m,g);return}let O=this.ids,x=O;for(;O;){const q=O.id,P=q.sid;if(P>S)O=O.l2;else if(P<S)x=O,O=O.r2;else{const z=q.time;if(z>_)O=O.l2;else if(z<_)x=O,O=O.r2;else{x=O;break}}}if(!x)return;const R=x.id,E=R.time,T=R.sid,N=x.span;if(T!==S||_-E>=N)return;const A=_-E;this.insAfterChunk(l,x,A,m,g)}insAt(l,m,g){if(!l){const x=this.id;return this.insAfterRoot(x,m,g),x}const v=this.findChunk(l-1);if(!v)return;const[_,S]=v,C=_.id,O=S===0?C:new e.Timestamp(C.sid,C.time+S);return this.insAfterChunk(O,_,S,m,g),O}insAfterRoot(l,m,g){const v=this.createChunk(m,g),_=this.first();if(!_)this.setRoot(v);else if((0,e.compare)(_.id,m)<0)this.insertBefore(v,_);else{if((0,e.containsId)(_.id,_.span,m))return;this.insertAfterRef(v,l,_)}}insAfterChunk(l,m,g,v,_){const S=m.id,C=S.time,O=S.sid,x=m.span,R=this.createChunk(v,_);if(g+1<x){const T=v.sid,N=v.time;if(O===T&&C<=N&&C+x-1>=N)return;if(N>l.time+1||T>l.sid){this.insertInside(R,m,g+1),this.splay(R);return}}this.insertAfterRef(R,l,m),this.splay(R)}delete(l){const m=l.length;for(let g=0;g<m;g++)this.deleteSpan(l[g]);this.onChange()}deleteSpan(l){const m=l.span,g=l.time,v=g+m-1,_=this.findById(l);if(!_)return;let S=_,C=S;for(;S;){C=S;const O=S.id,x=S.span,R=O.time,E=R+x-1;if(S.del){if(E>=v)break;S=S.s;continue}const T=g<=R,N=g<=E;if(T)if(v>=E){if(S.delete(),p(S,-S.span),v<=E)break}else{const A=v-R+1,q=this.split(S,A);S.delete(),n(q),p(S,-S.span);break}else if(N)if(v>=E){const A=g-R,q=this.split(S,A);if(q.delete(),q.len=q.r?q.r.len:0,p(S,-q.span),v<=E)break}else{const A=this.split(S,v-R+1),q=this.split(S,g-R);q.delete(),n(A),n(q),p(S,-q.span);break}S=S.s}C&&this.mergeTombstones2(_,C)}find(l){let m=this.root;for(;m;){const g=m.l,v=g?g.len:0;let _;if(l<v)m=g;else if(m.del)l-=v,m=m.r;else if(l<v+(_=m.span)){const S=l-v,C=m.id;return S?new e.Timestamp(C.sid,C.time+S):C}else l-=v+_,m=m.r}}findChunk(l){let m=this.root;for(;m;){const g=m.l,v=g?g.len:0;let _;if(l<v)m=g;else if(m.del)l-=v,m=m.r;else{if(l<v+(_=m.span))return[m,l-v];l-=v+_,m=m.r}}}findInterval(l,m){const g=[];if(!m)return g;let v=this.root,_=0;for(;v;){const O=v.l?v.l.len:0;if(l<O)v=v.l;else if(v.del)l-=O,v=v.r;else if(l<O+v.span){_=l-O;break}else l-=O+v.span,v=v.r}if(!v)return g;if(v.span>=m+_){const O=v.id;return g.push((0,e.tss)(O.sid,O.time+_,m)),g}const S=v.span-_,C=v.id;if(g.push((0,e.tss)(C.sid,C.time+_,S)),m-=S,v=h(v),!v)return g;do{if(v.del)continue;const O=v.id,x=v.span;if(m<=x)return g.push((0,e.tss)(O.sid,O.time,m)),g;g.push((0,e.tss)(O.sid,O.time,x)),m-=x}while((v=h(v))&&m>0);return g}findInterval2(l,m){const g=[];return this.range0(void 0,l,m,(v,_,S)=>{const C=v.id;g.push((0,e.tss)(C.sid,C.time+_,S))}),g}range0(l,m,g,v){let _=l||this.findById(m);if(l)for(;_&&!(0,e.containsId)(_.id,_.span,m);)_=h(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,g))return}else{const S=m.time-_.id.time;if((0,e.containsId)(_.id,_.span,g)){const x=g.time-m.time+1;return v(_,S,x),_}const O=_.span-S;if(v(_,S,O))return _}for(_=h(_);_;){if((0,e.containsId)(_.id,_.span,g))return!_.del&&v(_,0,g.time-_.id.time+1),_;if(!_.del&&v(_,0,_.span))return _;_=h(_)}return _}}first(){let l=this.root;for(;l;){const m=l.l;if(m)l=m;else return l}return l}last(){let l=this.root;for(;l;){const m=l.r;if(m)l=m;else return l}return l}lastId(){const l=this.last();if(!l)return;const m=l.id,g=l.span;return g===1?m:new e.Timestamp(m.sid,m.time+g-1)}next(l){return h(l)}prev(l){return w(l)}length(){const l=this.root;return l?l.len:0}size(){return this.count}pos(l){const m=l.p,g=l.l;if(!m)return g?g.len:0;const v=this.pos(m);if(m.r===l)return v+(m.del?0:m.span)+(g?g.len:0);const S=l.r;return v-(l.del?0:l.span)-(S?S.len:0)}setRoot(l){this.root=l,this.insertId(l),this.onChange()}insertBefore(l,m){const g=m.l;m.l=l,l.l=g,l.p=m;let v=0;g&&(g.p=l,v=g.len),l.len=l.span+v,p(m,l.span),this.insertId(l),this.onChange()}insertAfter(l,m){const g=m.r;m.r=l,l.r=g,l.p=m;let v=0;g&&(g.p=l,v=g.len),l.len=l.span+v,p(m,l.span),this.insertId(l),this.onChange()}insertAfterRef(l,m,g){const v=l.id,_=v.sid,S=v.time;let C=!1;for(;;){const O=g.id,x=O.time+g.span;g.s||(C=O.sid===_&&x===S&&x-1===m.time,C&&(g.s=l));const R=h(g);if(!R)break;const E=R.id,T=E.time,N=E.sid;if(T<S)break;if(T===S){if(N===_)return;if(N<_)break}g=R}C&&!g.del?(this.mergeContent(g,l.data),g.s=void 0):this.insertAfter(l,g)}mergeContent(l,m){const g=l.span;l.merge(m),p(l,l.span-g),this.onChange()}insertInside(l,m,g){const v=m.p,_=m.l,S=m.r,C=m.s,O=m.len,x=m.split(g);if(m.s=x,x.s=C,m.l=m.r=x.l=x.r=void 0,x.l=void 0,l.p=v,!_)l.l=m,m.p=l;else{l.l=_,_.p=l;const T=_.r;_.r=m,m.p=_,m.l=T,T&&(T.p=m)}if(!S)l.r=x,x.p=l;else{l.r=S,S.p=l;const T=S.l;S.l=x,x.p=S,x.r=T,T&&(T.p=x)}v?v.l===m?v.l=l:v.r=l:this.root=l,n(m),n(x),_&&(_.len=(_.l?_.l.len:0)+m.len+(_.del?0:_.span)),S&&(S.len=(S.r?S.r.len:0)+x.len+(S.del?0:S.span)),l.len=O+l.span;const R=l.span;let E=l.p;for(;E;)E.len+=R,E=E.p;this.insertId(x),this.insertIdFast(l),this.onChange()}split(l,m){const g=l.s,v=l.split(m),_=l.r;return l.s=v,v.r=_,v.s=g,l.r=v,v.p=l,this.insertId(v),_&&(_.p=v),v}mergeTombstones(l,m){if(!l.del||!m.del)return!1;const g=l.id,v=m.id;return g.sid!==v.sid||g.time+l.span!==v.time?!1:(l.s=m.s,l.span+=m.span,this.deleteChunk(m),!0)}mergeTombstones2(l,m){let g=l;for(;g;){const _=h(g);if(!_)break;if(!this.mergeTombstones(g,_)){if(_===m){if(_){const C=h(_);C&&this.mergeTombstones(_,C)}break}g=g.s}}const v=w(l);v&&this.mergeTombstones(v,l)}removeTombstones(){let l=this.first();const m=[];for(;l;)l.del&&m.push(l),l=h(l);for(let g=0;g<m.length;g++)this.deleteChunk(m[g])}deleteChunk(l){this.deleteId(l);const m=l.p,g=l.l,v=l.r;if(l.id=c.ORIGIN,!g&&!v)m?m.l===l?m.l=void 0:m.r=void 0:this.root=void 0;else if(g&&v){let _=g;for(;_.r;)_=_.r;_.r=v,v.p=_;const S=v.len;let C;for(C=_,m?(m.l===l?m.l=g:m.r=g,g.p=m):(this.root=g,g.p=void 0);C&&C!==m;)C.len+=S,C=C.p}else{const _=g||v;_.p=m,m?m.l===l?m.l=_:m.r=_:this.root=_}}insertId(l){this.ids=(0,i.insert2)(this.ids,l,r),this.count++,this.ids=(0,d.splay2)(this.ids,l)}insertIdFast(l){this.ids=(0,i.insert2)(this.ids,l,r),this.count++}deleteId(l){this.ids=(0,i.remove2)(this.ids,l),this.count--}findById(l){const m=l.sid,g=l.time;let v=this.ids,_=v;for(;v;){const E=v.id,T=E.sid;if(T>m)v=v.l2;else if(T<m)_=v,v=v.r2;else{const N=E.time;if(N>g)v=v.l2;else if(N<g)_=v,v=v.r2;else{_=v;break}}}if(!_)return;const S=_.id,C=S.time,O=S.sid,x=_.span;if(!(O!==m||g<C||g-C>=x))return _}prevId(l){let m=this.findById(l);if(!m)return;const g=l.time;if(m.id.time<g)return new e.Timestamp(l.sid,g-1);if(m=w(m),!m)return;const v=m.id;return m.span>1?new e.Timestamp(v.sid,v.time+m.span-1):v}spanView(l){const m=[];let g=l.span;const v=l.time;let _=this.findById(l);if(!_)return m;if(!_.del)if(_.span>=g+v-_.id.time){const S=v-_.id.time,C=S+g,O=_.view().slice(S,C);return m.push(O),m}else{const S=v-_.id.time,C=_.view().slice(S,l.span);g-=_.span-S,m.push(C)}for(;_=_.s;){const S=_.span;if(!_.del){if(S>g){const C=_.view().slice(0,g);m.push(C);break}m.push(_.data)}if(g-=S,g<=0)break}return m}splay(l){const m=l.p;if(!m)return;const g=m.p,v=m.l===l;if(!g){v?(0,f.rSplay)(l,m):(0,f.lSplay)(l,m),this.root=l,n(m),a(l);return}g.l===m?v?this.root=(0,f.llSplay)(this.root,l,m,g):this.root=(0,f.lrSplay)(this.root,l,m,g):v?this.root=(0,f.rlSplay)(this.root,l,m,g):this.root=(0,f.rrSplay)(this.root,l,m,g),n(g),n(m),a(l),this.splay(l)}iterator(){let l=this.first();return()=>{const m=l;return l&&(l=h(l)),m}}ingest(l,m){if(l<1)return;const g=new Map;this.root=this._ingest(l,()=>{const v=m(),_=v.id,S=_.sid+"."+_.time,C=g.get(S);C&&(C.s=v,g.delete(S));const O=(0,e.tick)(_,v.span);return g.set(O.sid+"."+O.time,v),v})}_ingest(l,m){const g=l>>1,v=l-g-1,_=g>0?this._ingest(g,m):void 0,S=m();_&&(S.l=_,_.p=S);const C=v>0?this._ingest(v,m):void 0;return C&&(S.r=C,C.p=S),n(S),this.insertId(S),S}toStringName(){return"AbstractRga"}toString(l=""){const m=this.view();let g="";return(0,u.isUint8Array)(m)?g+=` { ${(0,s.printOctets)(m)||"âˆ…"} }`:typeof m=="string"&&(g+=`{ ${m.length>32?JSON.stringify(m.substring(0,32))+" â€¦":JSON.stringify(m)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${g}`+(0,t.printTree)(l,[_=>this.root?this.printChunk(_,this.root):"âˆ…"])}printChunk(l,m){return this.formatChunk(m)+(0,o.printBinary)(l,[m.l?g=>this.printChunk(g,m.l):null,m.r?g=>this.printChunk(g,m.r):null])}formatChunk(l){let g=`chunk ${(0,e.printTs)(l.id)}:${l.span} .${l.len}.`;if(l.del)g+=` [${l.span}]`;else if((0,u.isUint8Array)(l.data))g+=` { ${(0,s.printOctets)(l.data)||"âˆ…"} }`;else if(typeof l.data=="string"){const v=l.data.length>32?JSON.stringify(l.data.substring(0,32))+" â€¦":JSON.stringify(l.data);g+=` { ${v} }`}return g}};return pr.AbstractRga=y,pr}var zl;function n0(){if(zl)return Ot;zl=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.ArrNode=Ot.ArrChunk=void 0;const e=xs(),u=ce(),f=_s(),d=Ke();class i{constructor(o,s,r){this.id=o,this.span=s,this.len=r?s:0,this.del=!r,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=r}merge(o){this.data.push(...o),this.span=this.data.length}split(o){const s=this.span;if(this.span=o,!this.del){const n=this.data.splice(o);return new i((0,u.tick)(this.id,o),s-o,n)}return new i((0,u.tick)(this.id,o),s-o,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new i(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ot.ArrChunk=i;let c=class extends e.AbstractRga{constructor(o,s){super(s),this.doc=o,this._tick=0,this._view=[],this.api=void 0}get(o){const s=this.findChunk(o);if(s)return s[0].data[s[1]]}getNode(o){const s=this.get(o);if(s)return this.doc.index.get(s)}getId(o){const s=this.findChunk(o);if(!s)return;const[r,n]=s,a=r.id;return n?(0,u.tick)(a,n):a}getById(o){const s=this.findById(o);if(!s||s.del)return;const r=o.time-s.id.time;return s.data[r]}upd(o,s){const r=this.findById(o);if(!r)return;const n=r.data;if(!n)return;const a=o.time-r.id.time,p=n[a];if(!(p&&(0,u.compare)(p,s)>=0))return n[a]=s,this.onChange(),p}createChunk(o,s){return new i(o,s?s.length:0,s)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const o=this.doc,s=o.clock.time+o.tick,r=this._view;if(this._tick===s)return r;const n=[],a=o.index;let p=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const y of w.data){const b=a.get(y);if(!b){p=!1;continue}const l=b.view();r[n.length]!==l&&(p=!1),n.push(l)}return r.length!==n.length&&(p=!1),p?r:(this._tick=s,this._view=n)}children(o){const s=this.doc.index;for(let r=this.first();r;r=this.next(r)){const n=r.data;if(!n)continue;const a=n.length;for(let p=0;p<a;p++)o(s.get(n[p]))}}name(){return"arr"}printChunk(o,s){const r=this.pos(s);let n="";if(!s.del){const a=this.doc.index;n=(0,d.printTree)(o,s.data.map(p=>a.get(p)).filter(p=>!!p).map((p,h)=>w=>`[${r+h}]: ${p.toString(w+"    "+" ".repeat(String(h).length))}`))}return this.formatChunk(s)+n+(0,f.printBinary)(o,[s.l?a=>this.printChunk(a,s.l):null,s.r?a=>this.printChunk(a,s.r):null])}};return Ot.ArrNode=c,Ot}var Rt={},Gl;function r0(){if(Gl)return Rt;Gl=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.BinNode=Rt.BinChunk=void 0;const e=ce(),u=xs();class f{constructor(c,t,o){this.id=c,this.span=t,this.len=o?t:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(c){const t=this.data.length,o=new Uint8Array(t+c.length);o.set(this.data),o.set(c,t),this.data=o,this.span=o.length}split(c){if(!this.del){const o=this.data,s=o.subarray(c),r=new f((0,e.tick)(this.id,c),this.span-c,s);return this.data=o.subarray(0,c),this.span=c,r}const t=new f((0,e.tick)(this.id,c),this.span-c,void 0);return this.span=c,t}delete(){this.del=!0,this.data=void 0}clone(){return new f(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Rt.BinChunk=f;let d=class extends u.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const c=new Uint8Array(this.length());let t=0,o=this.first();for(;o;){if(!o.del){const s=o.data;c.set(s,t),t+=s.length}o=this.next(o)}return this._view=c}children(){}child(){}container(){}name(){return"bin"}createChunk(c,t){return new f(c,t?t.length:0,t)}onChange(){this._view=null}toStringName(){return this.name()}};return Rt.BinNode=d,Rt}var Nt={},Wl;function i0(){if(Wl)return Nt;Wl=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.StrNode=Nt.StrChunk=void 0;const e=ce(),u=xs(),f=uc();class d{constructor(t,o,s){this.id=t,this.span=o,this.len=s?o:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=s}merge(t){this.data+=t,this.span=this.data.length}split(t){if(!this.del){const s=new d((0,e.tick)(this.id,t),this.span-t,this.data.slice(t));return this.data=this.data.slice(0,t),this.span=t,s}const o=new d((0,e.tick)(this.id,t),this.span-t,"");return this.span=t,o}delete(){this.del=!0,this.data=""}clone(){return new d(this.id,this.span,this.data)}view(){return this.data}}Nt.StrChunk=d;let i=class extends u.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let t="";for(let o=this.first();o;o=(0,f.next)(o))t+=o.data;return this._view=t}name(){return"str"}createChunk(t,o){return new d(t,o?o.length:0,o||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Nt.StrNode=i,Nt}var Hl;function s0(){return Hl||(Hl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var u=zr();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return u.ConNode}});var f=cc();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return f.ValNode}});var d=Jp();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return d.RootNode}});var i=Yp();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return i.VecNode}});var c=Xp();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return c.ObjNode}});var t=n0();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return t.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return t.ArrChunk}});var o=r0();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return o.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return o.BinChunk}});var s=i0();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return s.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return s.StrChunk}})}(Oi)),Oi}var Jl;function ht(){return Jl||(Jl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(fp(),e),u.__exportStar(s0(),e)}(xi)),xi}var Xi={},Kl;function o0(){return Kl||(Kl=1,Object.defineProperty(Xi,"__esModule",{value:!0})),Xi}var Qi={},Yl;function a0(){return Yl||(Yl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const u=ie;var f=Ss();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return f.Model}}),u.__exportStar(oc(),e)}(Qi)),Qi}var Xl;function dc(){return Xl||(Xl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const u=ie;u.__exportStar(ht(),e),u.__exportStar(o0(),e),u.__exportStar(a0(),e),u.__exportStar(Gr(),e)}(Si)),Si}var l0=dc(),gr={},Ql;function u0(){if(Ql)return gr;Ql=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.Encoder=void 0;const u=ie.__importStar(ht()),f=Uu(),d=ce();let i=class{encode(t){this.model=t;const o=t.clock;return{time:o.sid===1?o.time:this.cClock(t.clock),root:this.cVal(t.root)}}cClock(t){const o=[],s=t.sid;t.peers.get(s)||o.push([s,t.time]);for(const n of t.peers.values())o.push([n.sid,n.time]);return o}cTs(t){return t.sid===1?t.time:[t.sid,t.time]}cNode(t){if(t instanceof u.ObjNode)return this.cObj(t);if(t instanceof u.ArrNode)return this.cArr(t);if(t instanceof u.StrNode)return this.cStr(t);if(t instanceof u.ValNode)return this.cVal(t);if(t instanceof u.ConNode)return this.cCon(t);if(t instanceof u.BinNode)return this.cBin(t);if(t instanceof u.VecNode)return this.cVec(t);throw new Error("UNKNOWN_NODE")}cObj(t){const o={};return t.nodes((s,r)=>{o[r]=this.cNode(s)}),{type:"obj",id:this.cTs(t.id),map:o}}cVec(t){const o=[],s=t.elements,r=s.length,n=this.model.index;for(let a=0;a<r;a++){const p=s[a];p===void 0?o.push(null):o.push(this.cNode(n.get(p)))}return{type:"vec",id:this.cTs(t.id),map:o}}cArr(t){const o=[],s=t.iterator();let r;for(;r=s();)o.push(this.cArrChunk(r));return{type:"arr",id:this.cTs(t.id),chunks:o}}cArrChunk(t){if(t.del)return{id:this.cTs(t.id),span:t.span};const o=this.model.index;return{id:this.cTs(t.id),value:t.data.map(r=>this.cNode(o.get(r)))}}cStr(t){const o=[],s=t.iterator();let r;for(;r=s();)o.push(this.cStrChunk(r));return{type:"str",id:this.cTs(t.id),chunks:o}}cStrChunk(t){return t.del?{id:this.cTs(t.id),span:t.span}:{id:this.cTs(t.id),value:t.data}}cBin(t){const o=[],s=t.iterator();let r;for(;r=s();)o.push(this.cBinChunk(r));return{type:"bin",id:this.cTs(t.id),chunks:o}}cBinChunk(t){return t.del?{id:this.cTs(t.id),span:t.span}:{id:this.cTs(t.id),value:(0,f.toBase64)(t.data)}}cVal(t){return{type:"val",id:this.cTs(t.id),value:this.cNode(t.node())}}cCon(t){const o={type:"con",id:this.cTs(t.id)},s=t.val;return s instanceof d.Timestamp?(o.timestamp=!0,o.value=this.cTs(s)):s!==void 0&&(o.value=s),o}};return gr.Encoder=i,gr}var c0=u0();const d0=30*1024;class f0{constructor(u){Z(this,"socket");Z(this,"model",null);Z(this,"messageCounter");Z(this,"replicaId");Z(this,"verboseEncoder",new c0.Encoder);Z(this,"maxPayloadSizeBytes");Z(this,"onModelCreate",Tt);Z(this,"onGridReady",Tt);Z(this,"onStatusChange",Tt);Z(this,"messageHandler",u=>{var f,d;if(u instanceof Du){const i=u.getPayload();try{const c=Mr.decode(i);this.model?(console.debug("Applying patch from server:",c),(f=this.model)==null||f.applyPatch(c)):(console.debug("Initializing new model from patch:"),console.debug(c.toString()),this.model=l0.Model.fromPatches([c]).fork(this.replicaId),this.onModelCreate(this.model));const t=(d=this.model)==null?void 0:d.api.flush();let o;if((t==null?void 0:t.ops.length)!==0&&(o=Mr.encode(t)),o){const s=new vr(this.messageCounter.getNext(),"patch",o);console.debug("Responding with patch:",s),this.sendMessage(s)}else{const s=this.verboseEncoder.encode(this.model);this.sendSyncMessage(s.time)}}catch(c){console.error("Failed to apply patch or send clock:",c)}}else if(u instanceof Lu)this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(u instanceof Pu){const i=u.getMethodName();if(console.debug("Message received from server:",i),i==="ping"&&console.debug("Received ping response from server"),i==="connected"&&(console.debug("Server ready to receive patches"),this.sendSyncMessage()),i==="error"){console.warn("Error from server:",u.getPayload());return}if(i==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const c=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",c.time);const t=new vr(this.messageCounter.getNext(),"synchronize-clock",c.time);this.sendMessage(t)}}else console.warn("Unexpected WebSocket message format:",u)});const{replicaId:f,url:d,onGridReady:i,onStatusChange:c,onModelCreate:t,maxPayloadSizeBytes:o,socket:s}=u;this.messageCounter=new qh,this.replicaId=f,this.maxPayloadSizeBytes=o??d0,this.socket=s??new WebSocket(d),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=r=>{this.handleMessage(r.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=r=>{console.error("WebSocket error:",r)},t&&(this.onModelCreate=t),i&&(this.onGridReady=i),c&&(this.onStatusChange=c)}disconnect(){this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(u){this.messageHandler(Ph.fromJson(JSON.parse(u)))}sendMessage(u){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",u),this.socket.send(JSON.stringify(u.getJson()))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const u=this.model.api.flush();u&&dp(u,this.maxPayloadSizeBytes).forEach(d=>{console.debug("Sending patch to server:",d);const i=new vr(this.messageCounter.getNext(),"patch",d);this.sendMessage(i)})}sendSyncMessage(u=[]){const f=new vr(this.messageCounter.getNext(),"synchronize-clock",u);this.sendMessage(f)}}function h0(){const[e,u]=$.useState(null),[f,d]=$.useState(null),[i,c]=$.useState(!1),[t,o]=$.useState(!1),s=Vh(e),r=$.useCallback((n,a)=>{if(a&&!f){const p=new f0({replicaId:n,url:a,onGridReady:()=>{c(!0)},onStatusChange:(h,w)=>{o(h)},onModelCreate:h=>{u(h)}});d(p)}},[]);return $.useEffect(()=>()=>{f&&f.disconnect(),u(null),c(!1)},[f]),{isConnected:t,createWebsocket:r,websocketInstance:f,isGridReady:i,model:e,modelSnapshot:s}}function Zl(e,u){switch(e.type){case"CREATE":return u==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const f=u==="undo"?e.previousValue:e.newValue;return f?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:f}:null}case"DELETE":return u==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function qr(e=[],u){const[f,d]=$.useState(e),i=$.useCallback(r=>{d(n=>{const a=[...n,r];return u&&a.length>u&&a.shift(),a})},[u]),c=$.useCallback(()=>{if(f.length===0)return;const r=f[f.length-1];return d(n=>n.slice(0,-1)),r},[f]),t=$.useCallback(()=>f[f.length-1],[f]),o=$.useCallback(()=>{d([])},[]),s=$.useCallback(()=>f.length===0,[f]);return{stack:f,push:i,pop:c,clear:o,peek:t,size:f.length,isEmpty:s}}try{qr.displayName="useStack",qr.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}const p0=100,m0=100;function ss(e){const u=qr([],p0),f=qr([],m0),[d,i]=$.useState(null),[c,t]=$.useState(null),o=!!d,s=!!c,r=x=>{i(x.currentTarget)},n=x=>{t(x.currentTarget)},a=()=>i(null),p=()=>t(null),h=$.useCallback(()=>{if(u.isEmpty())return null;const R=u.peek().type;let E=0;for(let T=u.stack.length-1;T>=0&&u.stack[T].type===R;T--)E++;return{lastType:R,sameTypeCount:E,totalActions:u.size}},[u.stack.length,u]),w=$.useCallback(()=>{if(f.isEmpty())return null;const R=f.peek().type;let E=0;for(let T=f.stack.length-1;T>=0&&f.stack[T].type===R;T--)E++;return{lastType:R,sameTypeCount:E,totalActions:f.size}},[f.stack.length,f]),y=h(),b=w(),l=$.useCallback(()=>{if(u.isEmpty())return;const x=u.pop();if(x){const R=Zl(x,"undo");if(!R)return;f.push(x),e(R)}a()},[e,u,f]),m=$.useCallback(()=>{if(f.isEmpty())return;const x=f.pop();if(x){const R=Zl(x,"redo");if(!R)return;u.push(x),e(R)}p()},[f,u,e]);$.useEffect(()=>{const x=R=>{R.ctrlKey&&R.key==="z"&&!R.shiftKey||R.metaKey&&R.key==="z"&&!R.shiftKey?(R.preventDefault(),l()):(R.ctrlKey&&R.key==="y"||R.ctrlKey&&R.shiftKey&&R.key==="z"||R.metaKey&&R.shiftKey&&R.key==="z")&&(R.preventDefault(),m())};return window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}},[l,m]);const g=x=>u.push(x),v=()=>u.clear(),_=()=>f.clear(),S=(x,R,E)=>{_();for(const T of x){const N=T.fromRowIndex,M=T.toRowIndex;if(T.type==="CREATE")for(let A=N;A<M;A++){const q=E[A];g({type:"CREATE",rowIndex:A,newValue:q})}if(T.type==="UPDATE"){const A=R.slice(N,M);E.slice(N,M).forEach((P,z)=>{const U=A[z],Y=N+z;g({type:"UPDATE",rowIndex:Y,previousValue:U,newValue:P})})}T.type==="DELETE"&&R.slice(N,M).forEach((q,P)=>{g({type:"DELETE",rowIndex:N+P,previousValue:q})})}},C=j.jsxs(j.Fragment,{children:[j.jsxs(Gt,{"aria-controls":o?"undo-menu":void 0,"aria-haspopup":"true",onClick:r,disabled:!y,endIcon:j.jsx(Fs,{}),children:["Undo ",y&&`(${y.totalActions})`]}),j.jsx(Us,{id:"undo-menu",anchorEl:d,open:o,onClose:a,children:y?j.jsxs(yr,{onClick:l,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(yr,{disabled:!0,children:"No actions to undo"})})]}),O=j.jsxs(j.Fragment,{children:[j.jsxs(Gt,{"aria-controls":s?"redo-menu":void 0,"aria-haspopup":"true",onClick:n,disabled:!b,endIcon:j.jsx(Fs,{}),children:["Redo ",b&&`(${b.totalActions})`]}),j.jsx(Us,{id:"redo-menu",anchorEl:c,open:s,onClose:p,children:b?j.jsxs(yr,{onClick:m,children:["Redo last ",b.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(yr,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:l,addToUndoStack:g,clearUndoStack:v,addOperationsToUndoStack:S,undoUI:C,undoTotalActions:y?y.totalActions:0,redoPreview:b,redoUI:O,redoTotalActions:b?b.totalActions:0,handleRedo:m,clearRedoStack:_}}try{ss.displayName="useGridUndoRedo",ss.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}var br=Gr();function g0(e,u){const f=e.api.arr(["rows"]),{columnNames:d}=e.api.getSnapshot();switch(u.type){case"CREATE":{const i=d.map(c=>br.s.con(u.rowData[c]??null));f==null||f.ins(u.rowIndex,[br.s.obj({data:br.s.vec(...i),metadata:br.s.obj({})})]);break}case"DELETE":f==null||f.del(u.rowIndex,u.count??1);break;case"UPDATE":{Object.entries(u.updatedData).forEach(([i,c])=>{if(i.startsWith("_"))return;const t=d.indexOf(i);if(t!==-1){const o=e.api.vec(["rows",String(u.rowIndex),"data"]);o==null||o.set([[t,br.s.con(c)]])}});break}}}function b0(e,u,f){const d=[];return e.forEach(i=>{if(i.type==="CREATE")for(let c=i.fromRowIndex;c<i.toRowIndex;c++)d.push({type:"CREATE",rowIndex:c,rowData:u[c]});if(i.type==="UPDATE")for(let c=i.fromRowIndex;c<i.toRowIndex;c++)d.push({type:"UPDATE",rowIndex:c,updatedData:u[c]});i.type==="DELETE"&&d.push({type:"DELETE",rowIndex:i.fromRowIndex,count:i.toRowIndex-i.fromRowIndex})}),d}function y0(e){const{rowData:u,rowIndex:f,columnId:d,selectedRowIndex:i}=e,c=i===f,t=u.__cellValidationResults,o=[];return c&&o.push("cell-row-selected"),t&&d&&t.has(d)&&o.push("cell-invalid"),o.length?hu(o):void 0}const Dr=$.forwardRef(({showDebugInfo:e=!1},u)=>{var A,q;const[f,d]=$.useState(null),[i,c]=$.useState(null),[t,o]=$.useState(""),s=$.useRef(null);$.useImperativeHandle(u,()=>({initializeGrid:P=>{s.current&&s.current.handleStartSession(P)},loadExistingSession:P=>{s.current&&s.current.handleLoadSession(P)}}),[]);const{isConnected:r,websocketInstance:n,createWebsocket:a,isGridReady:p,model:h,modelSnapshot:w}=h0();$.useEffect(()=>{i&&t&&a(i,t)},[i,t,a]);const{data:y}=id((f==null?void 0:f.gridJsonSchema$Id)??"",{enabled:!!(f!=null&&f.gridJsonSchema$Id)}),b=r?"Connected":"Disconnected",l=$.useMemo(()=>w?Pd(h,w):[],[h,w]),m=w?g(w):[];function g(P){if(!P)return[];const{columnNames:z,columnOrder:U}=P,Y=y?Ld(y):[];return U.map(X=>{const W=z[X],ge=y?Bd(Qs(y,W)).map(Ye=>Ye.value):null,we=y?vu(Qs(y,W)):null;return we==="boolean"?{...ut.keyColumn(W,ut.checkboxColumn),title:W,headerClassName:Y.includes(W)?"header-cell-required":"header-cell"}:we==="number"||we==="integer"?{...ut.keyColumn(W,ut.floatColumn),title:W,headerClassName:Y.includes(W)?"header-cell-required":"header-cell"}:ge&&ge.length>0?{...ut.keyColumn(W,ns({choices:ge,colType:we})),title:W,headerClassName:Y.includes(W)?"header-cell-required":"header-cell"}:{...ut.keyColumn(W,ut.createTextColumn({continuousUpdates:!1})),title:W,headerClassName:Y.includes(W)?"header-cell-required":"header-cell"}})}const v=$.useCallback(yd(()=>{console.log("Auto-committing changes"),n==null||n.sendPatch()},500),[n]),_=$.useCallback((P,z)=>{z.forEach(U=>{g0(P,U)}),v()},[v]),S=(P,z)=>{if(!h){console.error("Model is not initialized");return}if(z=jd(P,l,z),z.length>0){E(),R(z,l,P);const U=b0(z,P);_(h,U)}},C=$.useCallback(P=>{if(!h){console.error("Model is not initialized");return}P.type==="DELETE"&&M.current&&M.current.setActiveCell(null),_(h,[P])},[h,_]),{undoUI:O,redoUI:x,addOperationsToUndoStack:R,clearRedoStack:E}=ss(C),[T,N]=$.useState(null),M=$.useRef(null);return j.jsx("div",{children:j.jsxs(xe,{container:!0,spacing:2,children:[j.jsx(xe,{size:{xs:12,xl:8},children:j.jsx(rs,{ref:s,onSessionChange:d,onReplicaChange:c,onPresignedUrlChange:o,show:e})}),j.jsx(xe,{size:{xs:12,xl:4},children:e&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",(f==null?void 0:f.sessionId)||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",i||"No replica created"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",(f==null?void 0:f.gridJsonSchema$Id)||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",t.substring(0,30)+(t.length>30?" ... "+t.substring(t.length-10,t.length):"")||"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:r?"green":"red"},children:b})]})]})}),f&&j.jsxs(j.Fragment,{children:[!p&&j.jsxs(xe,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!f&&j.jsx("p",{children:"Creating grid session..."}),f&&!i&&j.jsx("p",{children:"Setting up real-time sync..."}),f&&i&&!t&&j.jsx("p",{children:"Establishing secure connection..."}),f&&i&&t&&!r&&j.jsx("p",{children:"Connecting to server..."}),r&&!p&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Wc,{numRows:4,numCols:1})]})]}),p&&j.jsxs(xe,{size:12,children:[O,x,j.jsx(ut.DataSheetGrid,{ref:M,value:l,columns:m,rowKey:bu,rowClassName:({rowData:P,rowIndex:z})=>{var U,Y,re;return hu({"row-valid":((U=P.__validationResults)==null?void 0:U.isValid)===!0,"row-invalid":((Y=P.__validationResults)==null?void 0:Y.isValid)===!1,"row-unknown":!!y&&((re=P.__validationResults)==null?void 0:re.isValid)==null,"row-selected":T===z})},cellClassName:({rowData:P,rowIndex:z,columnId:U})=>y0({rowData:P,rowIndex:z,columnId:U,selectedRowIndex:T}),duplicateRow:({rowData:P})=>({...P}),onChange:S,onActiveCellChange:({cell:P})=>{N(P?P.row:null)}}),T!==null&&l[T]&&Array.isArray((A=l[T].__validationResults)==null?void 0:A.allValidationMessages)&&((q=l[T].__validationResults)==null?void 0:q.allValidationMessages.length)>0&&j.jsx(ed,{variant:"warning",title:"Validation Messages:",isGlobal:!1,description:j.jsx("ul",{children:l[T].__validationResults.allValidationMessages.map(P=>j.jsx("li",{children:P},P))}),sx:{marginTop:"12px"}})]}),p&&f.sourceEntityId&&j.jsx(xe,{container:!0,size:12,sx:{justifyContent:"flex-end"},children:j.jsx(Zi,{sourceEntityId:f.sourceEntityId,gridSessionId:f.sessionId})}),e&&j.jsxs(xe,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model snapshot"}),w?j.jsx(sd,{value:w}):"No model available"]})]})]})})});try{Dr.displayName="SynapseGrid",Dr.__docgenInfo={description:"",displayName:"SynapseGrid",props:{showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}const OS={title:"Components/SynapseGrid",component:Dr,parameters:{stack:"staging"},argTypes:{query:{control:"text"},showDebugInfo:{control:"boolean",description:"Show debug information including session details and model snapshot"}}},jr={args:{query:"SELECT * FROM syn35295069"},render:function({query:u,...f}){const d=$.useRef(null);return j.jsxs("div",{children:[j.jsx(Gt,{variant:"outlined",onClick:()=>{var i;return(i=d.current)==null?void 0:i.initializeGrid({initialQuery:{sql:u||"SELECT * FROM syn35295069"},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"})},sx:{color:"inherit",margin:"10px 0"},children:"Start Grid Session"}),j.jsx(Dr,{ref:d,...f})]})}},Vr={args:{showDebugInfo:!0}};var eu,tu,nu;jr.parameters={...jr.parameters,docs:{...(eu=jr.parameters)==null?void 0:eu.docs,source:{originalSource:`{
  args: {
    query: 'SELECT * FROM syn35295069'
  },
  render: function GridWithButton({
    query,
    ...args
  }) {
    const gridRef = useRef<SynapseGridHandle>(null);
    return <div>
        <Button variant="outlined" onClick={() => gridRef.current?.initializeGrid({
        initialQuery: {
          sql: query || 'SELECT * FROM syn35295069'
        },
        concreteType: 'org.sagebionetworks.repo.model.grid.CreateGridRequest'
      })} sx={{
        color: 'inherit',
        margin: '10px 0'
      }}>
          Start Grid Session
        </Button>
        <SynapseGrid ref={gridRef} {...args} />
      </div>;
  }
} satisfies Story`,...(nu=(tu=jr.parameters)==null?void 0:tu.docs)==null?void 0:nu.source}}};var ru,iu,su;Vr.parameters={...Vr.parameters,docs:{...(ru=Vr.parameters)==null?void 0:ru.docs,source:{originalSource:`{
  args: {
    showDebugInfo: true
  }
}`,...(su=(iu=Vr.parameters)==null?void 0:iu.docs)==null?void 0:su.source}}};const RS=["GridWithQuery","GridWithUserInputAndDebugInfo"];export{jr as GridWithQuery,Vr as GridWithUserInputAndDebugInfo,RS as __namedExportsOrder,OS as default};
