import{r as p,eQ as L,cG as j,j as d,an as v,cF as M,$ as T,f4 as b,aa as F,a1 as k}from"./iframe-C0ErQzQQ.js";import{L as A}from"./LargeButton-CW3-AGy0.js";import{b as Q}from"./use-deep-compare-effect.esm-DqKHiehK.js";import{g as z,c as _,L as J}from"./UserBadge-BHfpUK-d.js";import{w as B}from"./without-BujwWr7j.js";class h extends p.Component{constructor(e){super(e),this.state={userProfileMap:{}},this.update=this.update.bind(this)}componentDidMount(){const{list:e}=this.props;this.update(e)}componentDidUpdate(e){const t=e.list,a=B(this.props.list.filter(r=>r),...t);a.length>0&&this.update(a)}update(e){z(e.filter(t=>!!t)).then(t=>{const a={};t.list.forEach(r=>{const{ownerId:i}=r;a[i]=r}),this.setState({userProfileMap:{...this.state.userProfileMap,...a}})}).catch(t=>{console.error("Error on batch call =",t)})}manuallyExtractData(e){const t=e.headers.findIndex(s=>s.name==="firstName"),a=e.headers.findIndex(s=>s.name==="lastName"),r=e.headers.findIndex(s=>s.name==="institution"),i=e.headers.findIndex(s=>s.columnType===L.USERID);return e.rows.filter(s=>!s.values[i]).map(s=>{const n=s.values;return{firstName:n[t]??"",lastName:n[a]??"",company:n[r]??void 0,ownerId:null,userName:n[t]?n[t][0]??"":""}})}render(){const{size:e=j,rowSet:t,list:a}=this.props,{userProfileMap:r={}}=this.state,i=t&&this.manuallyExtractData(t);let l=0;return d.jsx("div",{className:"SRC-card-grid-row",children:a.map(s=>{const n=s!=null?r[s]:null;if(n)return d.jsx("div",{className:"SRC-grid-item SRC-narrow-grid-item",children:d.jsx(_,{size:e,preSignedURL:n.clientPreSignedURL,userProfile:n})},JSON.stringify(n));const c=i&&i[l];return c?(l+=1,d.jsx("div",{className:"SRC-grid-item SRC-narrow-grid-item",children:d.jsx(_,{disableLink:!0,hideEmail:!0,size:e,userProfile:c})},JSON.stringify(c))):!1})})}}try{h.displayName="UserCardList",h.__docgenInfo={description:"",displayName:"UserCardList",props:{list:{defaultValue:null,description:"",name:"list",required:!0,type:{name:"string[]"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"UserCardSize"}},rowSet:{defaultValue:null,description:"",name:"rowSet",required:!1,type:{name:"RowSet"}}}}}catch{}const $="sage_rotate_uids",Y=3,G=(o=[],e=Y,t)=>{let a=[],r=[];const i=localStorage.getItem(t);if(i!=null&&(a=JSON.parse(i)),a.length){const l=o.filter(s=>!a.includes(s));if(l.length>=e)return r=l.slice(0,e),localStorage.setItem(t,JSON.stringify(a.concat(r))),r;{localStorage.removeItem(t);const s=o.slice(0,e-l.length);return localStorage.setItem(t,JSON.stringify(s)),l.concat(s)}}else return r=o.slice(0,e),localStorage.setItem(t,JSON.stringify(r)),r};function C({sql:o,count:e,useQueryResultUserData:t=!1,size:a=M,summaryLink:r,summaryLinkText:i,selectedFacets:l,searchParams:s,sqlOperator:n,additionalFiltersSessionStorageKey:c}){var x;const{accessToken:S}=v(),[f,N]=p.useState([]),[y,E]=p.useState(),[g,I]=p.useState();let R=!0;const w=`${$}-${o}-${JSON.stringify(l)}`;return Q(()=>(async function(){I(!0);const q=T(o),D=b(s,n,c),P={partMask:k,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:q,query:{sql:o,additionalFilters:D,selectedFacets:l}},U=await F.getFullQueryTableResults(P,S),{queryResult:m}=U;if(m!=null&&m.queryResults.rows){const O=m.queryResults.headers.findIndex(u=>u.columnType===L.USERID),V=m.queryResults.rows.map(u=>u.values[O]).filter(u=>u!==null);if(R){const u=G(V,e,w);N(u),t&&E(U),I(!1)}}else console.log("UserCardListRotate: Error getting data")}(),()=>{R=!1}),[o,l,e,S,s,n]),d.jsxs("div",{className:"UserCardListRotate",children:[g&&d.jsx(J,{}),!g&&f.length===0&&d.jsx("p",{className:"font-italic",children:"No one was found."}),!g&&f.length>0&&d.jsx(h,{list:f,size:a,rowSet:(x=y==null?void 0:y.queryResult)==null?void 0:x.queryResults}),r&&i&&d.jsx("div",{className:"UserCardListRotate__summary",children:d.jsx(A,{color:"secondary",variant:"contained",href:r,children:i})})]})}try{C.displayName="UserCardListRotate",C.__docgenInfo={description:"",displayName:"UserCardListRotate",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},count:{defaultValue:null,description:"",name:"count",required:!0,type:{name:"number"}},useQueryResultUserData:{defaultValue:{value:"false"},description:"",name:"useQueryResultUserData",required:!1,type:{name:"boolean"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"UserCardSize"}},summaryLink:{defaultValue:null,description:"",name:"summaryLink",required:!1,type:{name:"string"}},summaryLinkText:{defaultValue:null,description:"",name:"summaryLinkText",required:!1,type:{name:"string"}},selectedFacets:{defaultValue:null,description:"",name:"selectedFacets",required:!1,type:{name:"FacetColumnRequest[]"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"SQLOperator"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},additionalFiltersSessionStorageKey:{defaultValue:null,description:"",name:"additionalFiltersSessionStorageKey",required:!1,type:{name:"string"}}}}}catch{}export{h as U,C as a};
