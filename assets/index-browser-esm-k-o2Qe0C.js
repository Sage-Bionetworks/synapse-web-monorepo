class _{add(e,r,n){if(typeof arguments[0]!="string")for(let i in arguments[0])this.add(i,arguments[0][i],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(i){this[i]=this[i]||[],r&&this[i][n?"unshift":"push"](r)},this)}run(e,r){this[e]=this[e]||[],this[e].forEach(function(n){n.call(r&&r.context?r.context:r,r)})}}class D{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach(i=>{if(typeof i!="object"||!i.name||!i.init)throw new Error("Invalid JSEP plugin format");this.registered[i.name]||(i.init(this.jsep),this.registered[i.name]=i)})}}class s{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+s.version}static addUnaryOp(e){return s.max_unop_len=Math.max(e.length,s.max_unop_len),s.unary_ops[e]=1,s}static addBinaryOp(e,r,n){return s.max_binop_len=Math.max(e.length,s.max_binop_len),s.binary_ops[e]=r,n?s.right_associative.add(e):s.right_associative.delete(e),s}static addIdentifierChar(e){return s.additional_identifier_chars.add(e),s}static addLiteral(e,r){return s.literals[e]=r,s}static removeUnaryOp(e){return delete s.unary_ops[e],e.length===s.max_unop_len&&(s.max_unop_len=s.getMaxKeyLen(s.unary_ops)),s}static removeAllUnaryOps(){return s.unary_ops={},s.max_unop_len=0,s}static removeIdentifierChar(e){return s.additional_identifier_chars.delete(e),s}static removeBinaryOp(e){return delete s.binary_ops[e],e.length===s.max_binop_len&&(s.max_binop_len=s.getMaxKeyLen(s.binary_ops)),s.right_associative.delete(e),s}static removeAllBinaryOps(){return s.binary_ops={},s.max_binop_len=0,s}static removeLiteral(e){return delete s.literals[e],s}static removeAllLiterals(){return s.literals={},s}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new s(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(r=>r.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return s.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!s.binary_ops[String.fromCharCode(e)]||s.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return s.isIdentifierStart(e)||s.isDecimalDigit(e)}throwError(e){const r=new Error(e+" at character "+this.index);throw r.index=this.index,r.description=e,r}runHook(e,r){if(s.hooks[e]){const n={context:this,node:r};return s.hooks.run(e,n),n.node}return r}searchHook(e){if(s.hooks[e]){const r={context:this};return s.hooks[e].find(function(n){return n.call(r.context,r),r.node}),r.node}}gobbleSpaces(){let e=this.code;for(;e===s.SPACE_CODE||e===s.TAB_CODE||e===s.LF_CODE||e===s.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),r=e.length===1?e[0]:{type:s.COMPOUND,body:e};return this.runHook("after-all",r)}gobbleExpressions(e){let r=[],n,i;for(;this.index<this.expr.length;)if(n=this.code,n===s.SEMCOL_CODE||n===s.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())r.push(i);else if(this.index<this.expr.length){if(n===e)break;this.throwError('Unexpected "'+this.char+'"')}return r}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,s.max_binop_len),r=e.length;for(;r>0;){if(s.binary_ops.hasOwnProperty(e)&&(!s.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!s.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=r,e;e=e.substr(0,--r)}return!1}gobbleBinaryExpression(){let e,r,n,i,o,a,u,l,h;if(a=this.gobbleToken(),!a||(r=this.gobbleBinaryOp(),!r))return a;for(o={value:r,prec:s.binaryPrecedence(r),right_a:s.right_associative.has(r)},u=this.gobbleToken(),u||this.throwError("Expected expression after "+r),i=[a,o,u];r=this.gobbleBinaryOp();){if(n=s.binaryPrecedence(r),n===0){this.index-=r.length;break}o={value:r,prec:n,right_a:s.right_associative.has(r)},h=r;const d=E=>o.right_a&&E.right_a?n>E.prec:n<=E.prec;for(;i.length>2&&d(i[i.length-2]);)u=i.pop(),r=i.pop().value,a=i.pop(),e={type:s.BINARY_EXP,operator:r,left:a,right:u},i.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+h),i.push(o,e)}for(l=i.length-1,e=i[l];l>1;)e={type:s.BINARY_EXP,operator:i[l-1].value,left:i[l-2],right:e},l-=2;return e}gobbleToken(){let e,r,n,i;if(this.gobbleSpaces(),i=this.searchHook("gobble-token"),i)return this.runHook("after-token",i);if(e=this.code,s.isDecimalDigit(e)||e===s.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===s.SQUOTE_CODE||e===s.DQUOTE_CODE)i=this.gobbleStringLiteral();else if(e===s.OBRACK_CODE)i=this.gobbleArray();else{for(r=this.expr.substr(this.index,s.max_unop_len),n=r.length;n>0;){if(s.unary_ops.hasOwnProperty(r)&&(!s.isIdentifierStart(this.code)||this.index+r.length<this.expr.length&&!s.isIdentifierPart(this.expr.charCodeAt(this.index+r.length)))){this.index+=n;const o=this.gobbleToken();return o||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:s.UNARY_EXP,operator:r,argument:o,prefix:!0})}r=r.substr(0,--n)}s.isIdentifierStart(e)?(i=this.gobbleIdentifier(),s.literals.hasOwnProperty(i.name)?i={type:s.LITERAL,value:s.literals[i.name],raw:i.name}:i.name===s.this_str&&(i={type:s.THIS_EXP})):e===s.OPAREN_CODE&&(i=this.gobbleGroup())}return i?(i=this.gobbleTokenProperty(i),this.runHook("after-token",i)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let r=this.code;for(;r===s.PERIOD_CODE||r===s.OBRACK_CODE||r===s.OPAREN_CODE||r===s.QUMARK_CODE;){let n;if(r===s.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==s.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),r=this.code}this.index++,r===s.OBRACK_CODE?(e={type:s.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},e.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),r=this.code,r!==s.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):r===s.OPAREN_CODE?e={type:s.CALL_EXP,arguments:this.gobbleArguments(s.CPAREN_CODE),callee:e}:(r===s.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),e={type:s.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),n&&(e.optional=!0),this.gobbleSpaces(),r=this.code}return e}gobbleNumericLiteral(){let e="",r,n;for(;s.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===s.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);s.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(r=this.char,r==="e"||r==="E"){for(e+=this.expr.charAt(this.index++),r=this.char,(r==="+"||r==="-")&&(e+=this.expr.charAt(this.index++));s.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);s.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return n=this.code,s.isIdentifierStart(n)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(n===s.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===s.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:s.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="";const r=this.index,n=this.expr.charAt(this.index++);let i=!1;for(;this.index<this.expr.length;){let o=this.expr.charAt(this.index++);if(o===n){i=!0;break}else if(o==="\\")switch(o=this.expr.charAt(this.index++),o){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=o}else e+=o}return i||this.throwError('Unclosed quote after "'+e+'"'),{type:s.LITERAL,value:e,raw:this.expr.substring(r,this.index)}}gobbleIdentifier(){let e=this.code,r=this.index;for(s.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,s.isIdentifierPart(e));)this.index++;return{type:s.IDENTIFIER,name:this.expr.slice(r,this.index)}}gobbleArguments(e){const r=[];let n=!1,i=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let o=this.code;if(o===e){n=!0,this.index++,e===s.CPAREN_CODE&&i&&i>=r.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(o===s.COMMA_CODE){if(this.index++,i++,i!==r.length){if(e===s.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===s.CBRACK_CODE)for(let a=r.length;a<i;a++)r.push(null)}}else if(r.length!==i&&i!==0)this.throwError("Expected comma");else{const a=this.gobbleExpression();(!a||a.type===s.COMPOUND)&&this.throwError("Expected comma"),r.push(a)}}return n||this.throwError("Expected "+String.fromCharCode(e)),r}gobbleGroup(){this.index++;let e=this.gobbleExpressions(s.CPAREN_CODE);if(this.code===s.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:s.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:s.ARRAY_EXP,elements:this.gobbleArguments(s.CBRACK_CODE)}}}const k=new _;Object.assign(s,{hooks:k,plugins:new D(s),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});s.max_unop_len=s.getMaxKeyLen(s.unary_ops);s.max_binop_len=s.getMaxKeyLen(s.binary_ops);const x=t=>new s(t).parse(),I=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(s).filter(t=>!I.includes(t)&&x[t]===void 0).forEach(t=>{x[t]=s[t]});x.Jsep=s;const v="ConditionalExpression";var R={name:"ternary",init(t){t.hooks.add("after-expression",function(r){if(r.node&&this.code===t.QUMARK_CODE){this.index++;const n=r.node,i=this.gobbleExpression();if(i||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;const o=this.gobbleExpression();if(o||this.throwError("Expected expression"),r.node={type:v,test:n,consequent:i,alternate:o},n.operator&&t.binary_ops[n.operator]<=.9){let a=n;for(;a.right.operator&&t.binary_ops[a.right.operator]<=.9;)a=a.right;r.node.test=a.right,a.right=r.node,r.node=n}}else this.throwError("Expected :")}})}};x.plugins.register(R);const S=47,T=92;var L={name:"regex",init(t){t.hooks.add("gobble-token",function(r){if(this.code===S){const n=++this.index;let i=!1;for(;this.index<this.expr.length;){if(this.code===S&&!i){const o=this.expr.slice(n,this.index);let a="";for(;++this.index<this.expr.length;){const l=this.code;if(l>=97&&l<=122||l>=65&&l<=90||l>=48&&l<=57)a+=this.char;else break}let u;try{u=new RegExp(o,a)}catch(l){this.throwError(l.message)}return r.node={type:t.LITERAL,value:u,raw:this.expr.slice(n-1,this.index)},r.node=this.gobbleTokenProperty(r.node),r.node}this.code===t.OBRACK_CODE?i=!0:i&&this.code===t.CBRACK_CODE&&(i=!1),this.index+=this.code===T?2:1}this.throwError("Unclosed Regex")}})}};const m=43,U=45,C={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[m,U],assignmentPrecedence:.9,init(t){const e=[t.IDENTIFIER,t.MEMBER_EXP];C.assignmentOperators.forEach(n=>t.addBinaryOp(n,C.assignmentPrecedence,!0)),t.hooks.add("gobble-token",function(i){const o=this.code;C.updateOperators.some(a=>a===o&&a===this.expr.charCodeAt(this.index+1))&&(this.index+=2,i.node={type:"UpdateExpression",operator:o===m?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},(!i.node.argument||!e.includes(i.node.argument.type))&&this.throwError(`Unexpected ${i.node.operator}`))}),t.hooks.add("after-token",function(i){if(i.node){const o=this.code;C.updateOperators.some(a=>a===o&&a===this.expr.charCodeAt(this.index+1))&&(e.includes(i.node.type)||this.throwError(`Unexpected ${i.node.operator}`),this.index+=2,i.node={type:"UpdateExpression",operator:o===m?"++":"--",argument:i.node,prefix:!1})}}),t.hooks.add("after-expression",function(i){i.node&&r(i.node)});function r(n){C.assignmentOperators.has(n.operator)?(n.type="AssignmentExpression",r(n.left),r(n.right)):n.operator||Object.values(n).forEach(i=>{i&&typeof i=="object"&&r(i)})}}};x.plugins.register(L,C);x.addUnaryOp("typeof");x.addLiteral("null",null);x.addLiteral("undefined",void 0);const N=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),p={evalAst(t,e){switch(t.type){case"BinaryExpression":case"LogicalExpression":return p.evalBinaryExpression(t,e);case"Compound":return p.evalCompound(t,e);case"ConditionalExpression":return p.evalConditionalExpression(t,e);case"Identifier":return p.evalIdentifier(t,e);case"Literal":return p.evalLiteral(t,e);case"MemberExpression":return p.evalMemberExpression(t,e);case"UnaryExpression":return p.evalUnaryExpression(t,e);case"ArrayExpression":return p.evalArrayExpression(t,e);case"CallExpression":return p.evalCallExpression(t,e);case"AssignmentExpression":return p.evalAssignmentExpression(t,e);default:throw SyntaxError("Unexpected expression",t)}},evalBinaryExpression(t,e){return{"||":(n,i)=>n||i(),"&&":(n,i)=>n&&i(),"|":(n,i)=>n|i(),"^":(n,i)=>n^i(),"&":(n,i)=>n&i(),"==":(n,i)=>n==i(),"!=":(n,i)=>n!=i(),"===":(n,i)=>n===i(),"!==":(n,i)=>n!==i(),"<":(n,i)=>n<i(),">":(n,i)=>n>i(),"<=":(n,i)=>n<=i(),">=":(n,i)=>n>=i(),"<<":(n,i)=>n<<i(),">>":(n,i)=>n>>i(),">>>":(n,i)=>n>>>i(),"+":(n,i)=>n+i(),"-":(n,i)=>n-i(),"*":(n,i)=>n*i(),"/":(n,i)=>n/i(),"%":(n,i)=>n%i()}[t.operator](p.evalAst(t.left,e),()=>p.evalAst(t.right,e))},evalCompound(t,e){let r;for(let n=0;n<t.body.length;n++){t.body[n].type==="Identifier"&&["var","let","const"].includes(t.body[n].name)&&t.body[n+1]&&t.body[n+1].type==="AssignmentExpression"&&(n+=1);const i=t.body[n];r=p.evalAst(i,e)}return r},evalConditionalExpression(t,e){return p.evalAst(t.test,e)?p.evalAst(t.consequent,e):p.evalAst(t.alternate,e)},evalIdentifier(t,e){if(Object.hasOwn(e,t.name))return e[t.name];throw ReferenceError(`${t.name} is not defined`)},evalLiteral(t){return t.value},evalMemberExpression(t,e){const r=String(t.computed?p.evalAst(t.property):t.property.name),n=p.evalAst(t.object,e);if(n==null)throw TypeError(`Cannot read properties of ${n} (reading '${r}')`);if(!Object.hasOwn(n,r)&&N.has(r))throw TypeError(`Cannot read properties of ${n} (reading '${r}')`);const i=n[r];return typeof i=="function"?i.bind(n):i},evalUnaryExpression(t,e){return{"-":n=>-p.evalAst(n,e),"!":n=>!p.evalAst(n,e),"~":n=>~p.evalAst(n,e),"+":n=>+p.evalAst(n,e),typeof:n=>typeof p.evalAst(n,e)}[t.operator](t.argument)},evalArrayExpression(t,e){return t.elements.map(r=>p.evalAst(r,e))},evalCallExpression(t,e){const r=t.arguments.map(i=>p.evalAst(i,e));return p.evalAst(t.callee,e)(...r)},evalAssignmentExpression(t,e){if(t.left.type!=="Identifier")throw SyntaxError("Invalid left-hand side in assignment");const r=t.left.name,n=p.evalAst(t.right,e);return e[r]=n,e[r]}};class M{constructor(e){this.code=e,this.ast=x(this.code)}runInNewContext(e){const r=Object.assign(Object.create(null),e);return p.evalAst(this.ast,r)}}function O(t,e){return t=t.slice(),t.push(e),t}function P(t,e){return e=e.slice(),e.unshift(t),e}class $ extends Error{constructor(e){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name="NewError"}}function f(t,e,r,n,i){if(!(this instanceof f))try{return new f(t,e,r,n,i)}catch(a){if(!a.avoidNew)throw a;return a.value}typeof t=="string"&&(i=n,n=r,r=e,e=t,t=null);const o=t&&typeof t=="object";if(t=t||{},this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=Object.hasOwn(t,"wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.eval=t.eval===void 0?"safe":t.eval,this.ignoreEvalErrors=typeof t.ignoreEvalErrors>"u"?!1:t.ignoreEvalErrors,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||n||null,this.otherTypeCallback=t.otherTypeCallback||i||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){const a={path:o?t.path:e};o?"json"in t&&(a.json=t.json):a.json=r;const u=this.evaluate(a);if(!u||typeof u!="object")throw new $(u);return u}}f.prototype.evaluate=function(t,e,r,n){let i=this.parent,o=this.parentProperty,{flatten:a,wrap:u}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&typeof t=="object"&&!Array.isArray(t)){if(!t.path&&t.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=t),a=Object.hasOwn(t,"flatten")?t.flatten:a,this.currResultType=Object.hasOwn(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=Object.hasOwn(t,"sandbox")?t.sandbox:this.currSandbox,u=Object.hasOwn(t,"wrap")?t.wrap:u,this.currEval=Object.hasOwn(t,"eval")?t.eval:this.currEval,r=Object.hasOwn(t,"callback")?t.callback:r,this.currOtherTypeCallback=Object.hasOwn(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,i=Object.hasOwn(t,"parent")?t.parent:i,o=Object.hasOwn(t,"parentProperty")?t.parentProperty:o,t=t.path}if(i=i||null,o=o||null,Array.isArray(t)&&(t=f.toPathString(t)),!t&&t!==""||!e)return;const l=f.toPathArray(t);l[0]==="$"&&l.length>1&&l.shift(),this._hasParentSelector=null;const h=this._trace(l,e,["$"],i,o,r).filter(function(d){return d&&!d.isParentSelector});return h.length?!u&&h.length===1&&!h[0].hasArrExpr?this._getPreferredOutput(h[0]):h.reduce((d,E)=>{const g=this._getPreferredOutput(E);return a&&Array.isArray(g)?d=d.concat(g):d.push(g),d},[]):u?[]:void 0};f.prototype._getPreferredOutput=function(t){const e=this.currResultType;switch(e){case"all":{const r=Array.isArray(t.path)?t.path:f.toPathArray(t.path);return t.pointer=f.toPointer(r),t.path=typeof t.path=="string"?t.path:f.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return f.toPathString(t[e]);case"pointer":return f.toPointer(t.path);default:throw new TypeError("Unknown result type")}};f.prototype._handleCallback=function(t,e,r){if(e){const n=this._getPreferredOutput(t);t.path=typeof t.path=="string"?t.path:f.toPathString(t.path),e(n,r,t)}};f.prototype._trace=function(t,e,r,n,i,o,a,u){let l;if(!t.length)return l={path:r,value:e,parent:n,parentProperty:i,hasArrExpr:a},this._handleCallback(l,o,"value"),l;const h=t[0],d=t.slice(1),E=[];function g(c){Array.isArray(c)?c.forEach(y=>{E.push(y)}):E.push(c)}if((typeof h!="string"||u)&&e&&Object.hasOwn(e,h))g(this._trace(d,e[h],O(r,h),e,h,o,a));else if(h==="*")this._walk(e,c=>{g(this._trace(d,e[c],O(r,c),e,c,o,!0,!0))});else if(h==="..")g(this._trace(d,e,r,n,i,o,a)),this._walk(e,c=>{typeof e[c]=="object"&&g(this._trace(t.slice(),e[c],O(r,c),e,c,o,!0))});else{if(h==="^")return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:d,isParentSelector:!0};if(h==="~")return l={path:O(r,h),value:i,parent:n,parentProperty:null},this._handleCallback(l,o,"property"),l;if(h==="$")g(this._trace(d,e,r,null,null,o,a));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(h))g(this._slice(h,d,e,r,n,i,o));else if(h.indexOf("?(")===0){if(this.currEval===!1)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const c=h.replace(/^\?\((.*?)\)$/u,"$1"),y=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(c);y?this._walk(e,b=>{const A=[y[2]],w=y[1]?e[b][y[1]]:e[b];this._trace(A,w,r,n,i,o,!0).length>0&&g(this._trace(d,e[b],O(r,b),e,b,o,!0))}):this._walk(e,b=>{this._eval(c,e[b],b,r,n,i)&&g(this._trace(d,e[b],O(r,b),e,b,o,!0))})}else if(h[0]==="("){if(this.currEval===!1)throw new Error("Eval [(expr)] prevented in JSONPath expression.");g(this._trace(P(this._eval(h,e,r.at(-1),r.slice(0,-1),n,i),d),e,r,n,i,o,a))}else if(h[0]==="@"){let c=!1;const y=h.slice(1,-2);switch(y){case"scalar":(!e||!["object","function"].includes(typeof e))&&(c=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===y&&(c=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(c=!0);break;case"number":Number.isFinite(e)&&(c=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(c=!0);break;case"object":e&&typeof e===y&&(c=!0);break;case"array":Array.isArray(e)&&(c=!0);break;case"other":c=this.currOtherTypeCallback(e,r,n,i);break;case"null":e===null&&(c=!0);break;default:throw new TypeError("Unknown value type "+y)}if(c)return l={path:r,value:e,parent:n,parentProperty:i},this._handleCallback(l,o,"value"),l}else if(h[0]==="`"&&e&&Object.hasOwn(e,h.slice(1))){const c=h.slice(1);g(this._trace(d,e[c],O(r,c),e,c,o,a,!0))}else if(h.includes(",")){const c=h.split(",");for(const y of c)g(this._trace(P(y,d),e,r,n,i,o,!0))}else!u&&e&&Object.hasOwn(e,h)&&g(this._trace(d,e[h],O(r,h),e,h,o,a,!0))}if(this._hasParentSelector)for(let c=0;c<E.length;c++){const y=E[c];if(y&&y.isParentSelector){const b=this._trace(y.expr,e,y.path,n,i,o,a);if(Array.isArray(b)){E[c]=b[0];const A=b.length;for(let w=1;w<A;w++)c++,E.splice(c,0,b[w])}else E[c]=b}}return E};f.prototype._walk=function(t,e){if(Array.isArray(t)){const r=t.length;for(let n=0;n<r;n++)e(n)}else t&&typeof t=="object"&&Object.keys(t).forEach(r=>{e(r)})};f.prototype._slice=function(t,e,r,n,i,o,a){if(!Array.isArray(r))return;const u=r.length,l=t.split(":"),h=l[2]&&Number.parseInt(l[2])||1;let d=l[0]&&Number.parseInt(l[0])||0,E=l[1]&&Number.parseInt(l[1])||u;d=d<0?Math.max(0,d+u):Math.min(u,d),E=E<0?Math.max(0,E+u):Math.min(u,E);const g=[];for(let c=d;c<E;c+=h)this._trace(P(c,e),r,n,i,o,a,!0).forEach(b=>{g.push(b)});return g};f.prototype._eval=function(t,e,r,n,i,o){this.currSandbox._$_parentProperty=o,this.currSandbox._$_parent=i,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const a=t.includes("@path");a&&(this.currSandbox._$_path=f.toPathString(n.concat([r])));const u=this.currEval+"Script:"+t;if(!f.cache[u]){let l=t.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(a&&(l=l.replaceAll("@path","_$_path")),this.currEval==="safe"||this.currEval===!0||this.currEval===void 0)f.cache[u]=new this.safeVm.Script(l);else if(this.currEval==="native")f.cache[u]=new this.vm.Script(l);else if(typeof this.currEval=="function"&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const h=this.currEval;f.cache[u]=new h(l)}else if(typeof this.currEval=="function")f.cache[u]={runInNewContext:h=>this.currEval(l,h)};else throw new TypeError(`Unknown "eval" property "${this.currEval}"`)}try{return f.cache[u].runInNewContext(this.currSandbox)}catch(l){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+l.message+": "+t)}};f.cache={};f.toPathString=function(t){const e=t,r=e.length;let n="$";for(let i=1;i<r;i++)/^(~|\^|@.*?\(\))$/u.test(e[i])||(n+=/^[0-9*]+$/u.test(e[i])?"["+e[i]+"]":"['"+e[i]+"']");return n};f.toPointer=function(t){const e=t,r=e.length;let n="";for(let i=1;i<r;i++)/^(~|\^|@.*?\(\))$/u.test(e[i])||(n+="/"+e[i].toString().replaceAll("~","~0").replaceAll("/","~1"));return n};f.toPathArray=function(t){const{cache:e}=f;if(e[t])return e[t].concat();const r=[],i=t.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,function(o,a){return"[#"+(r.push(a)-1)+"]"}).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,function(o,a){return"['"+a.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"}).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,function(o,a){return";"+a.split("").join(";")+";"}).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map(function(o){const a=o.match(/#(\d+)/u);return!a||!a[1]?o:r[a[1]]});return e[t]=i,e[t].concat()};f.prototype.safeVm={Script:M};const B=function(t,e,r){const n=t.length;for(let i=0;i<n;i++){const o=t[i];r(o)&&e.push(t.splice(i--,1)[0])}};class j{constructor(e){this.code=e}runInNewContext(e){let r=this.code;const n=Object.keys(e),i=[];B(n,i,h=>typeof e[h]=="function");const o=n.map(h=>e[h]);r=i.reduce((h,d)=>{let E=e[d].toString();return/function/u.test(E)||(E="function "+E),"var "+d+"="+E+";"+h},"")+r,!/(['"])use strict\1/u.test(r)&&!n.includes("arguments")&&(r="var arguments = undefined;"+r),r=r.replace(/;\s*$/u,"");const u=r.lastIndexOf(";"),l=u!==-1?r.slice(0,u+1)+" return "+r.slice(u+1):" return "+r;return new Function(...n,l)(...o)}}f.prototype.vm={Script:j};export{f as J};
