import{aT as Q,aS as ee,r as a,gV as Te,aZ as te,j as t,b1 as oe,aX as se,b2 as A,aY as re,bt as we,b3 as ae,b6 as M,b7 as Se,bX as ne,dJ as le,dI as ie,W as I,am as B,K as _,_ as $e,hG as H,hH as Me,Y as G,c7 as q,B as X,d8 as De}from"./iframe-T7oLJ25f.js";import{u as de,A as ke}from"./useEntityBundle-BV62bEP6.js";import{d as ce}from"./useUserBundle-DLS_5O5Y.js";import{u as Ie,a as Ne,F as P,b as Ee}from"./ForumThreadEditor-Bo1v6an_.js";import{u as Oe,a as _e,b as Le}from"./useThread-DbiwFPqU.js";import{u as Pe}from"./useSubscription-CVcNU2pH.js";import{C as Ae}from"./ConfirmationDialog-CRRWyf25.js";import{M as ue}from"./MarkdownSynapse-BEmtf9mM.js";import{W as U}from"./WarningDialog-C6LyDb11.js";import{U as pe}from"./UserBadge-BGdm1g_K.js";import{S as Ge}from"./SkeletonTable-Iucvd8oY.js";import{S as Ue}from"./SubscribersModal-DaOnEwV0.js";import{u as ze}from"./useForum-BPWFxxfy.js";import{g as We}from"./getValidReactChildren-CRRdHy8f.js";function Fe(e){return ee("MuiToggleButton",e)}const D=Q("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),fe=a.createContext({}),ge=a.createContext(void 0);function Ye(e,o){return o===void 0||e===void 0?!1:Array.isArray(o)?o.includes(e):e===o}const Ve=e=>{const{classes:o,fullWidth:n,selected:u,disabled:p,size:m,color:x}=e,g={root:["root",u&&"selected",p&&"disabled",n&&"fullWidth",`size${A(m)}`,x]};return re(g,Fe,o)},He=oe(we,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[o.root,o[`size${A(n.size)}`]]}})(ae(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${D.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:M(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${D.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(Se()).map(([o])=>({props:{color:o},style:{[`&.${D.selected}`]:{color:(e.vars||e).palette[o].main,backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette[o].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),K=a.forwardRef(function(o,n){const{value:u,...p}=a.useContext(fe),m=a.useContext(ge),x=Te({...p,selected:Ye(o.value,u)},o),g=te({props:x,name:"MuiToggleButton"}),{children:j,className:y,color:b="standard",disabled:d=!1,disableFocusRipple:v=!1,fullWidth:l=!1,onChange:R,onClick:h,selected:f,size:T="medium",value:w,...N}=g,r={...g,color:b,disabled:d,disableFocusRipple:v,fullWidth:l,size:T},$=Ve(r),E=i=>{h&&(h(i,w),i.defaultPrevented)||R&&R(i,w)},c=m||"";return t.jsx(He,{className:se(p.className,$.root,y,c),disabled:d,focusRipple:!v,ref:n,onClick:E,onChange:R,value:w,ownerState:r,"aria-pressed":f,...N,children:j})});function qe(e){return ee("MuiToggleButtonGroup",e)}const s=Q("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Xe=e=>{const{classes:o,orientation:n,fullWidth:u,disabled:p}=e,m={root:["root",n,u&&"fullWidth"],grouped:["grouped",`grouped${A(n)}`,p&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return re(m,qe,o)},Ke=oe("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[{[`& .${s.grouped}`]:o.grouped},{[`& .${s.grouped}`]:o[`grouped${A(n.orientation)}`]},{[`& .${s.firstButton}`]:o.firstButton},{[`& .${s.lastButton}`]:o.lastButton},{[`& .${s.middleButton}`]:o.middleButton},o.root,n.orientation==="vertical"&&o.vertical,n.fullWidth&&o.fullWidth]}})(ae(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${s.grouped}`]:{[`&.${s.selected} + .${s.grouped}.${s.selected}`]:{borderTop:0,marginTop:0}},[`& .${s.firstButton},& .${s.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${s.lastButton},& .${s.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${s.lastButton}.${D.disabled},& .${s.middleButton}.${D.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${s.grouped}`]:{[`&.${s.selected} + .${s.grouped}.${s.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${s.firstButton},& .${s.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${s.lastButton},& .${s.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${s.lastButton}.${D.disabled},& .${s.middleButton}.${D.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Je=a.forwardRef(function(o,n){const u=te({props:o,name:"MuiToggleButtonGroup"}),{children:p,className:m,color:x="standard",disabled:g=!1,exclusive:j=!1,fullWidth:y=!1,onChange:b,orientation:d="horizontal",size:v="medium",value:l,...R}=u,h={...u,disabled:g,fullWidth:y,orientation:d,size:v},f=Xe(h),T=a.useCallback((c,i)=>{if(!b)return;const S=l&&l.indexOf(i);let k;l&&S>=0?(k=l.slice(),k.splice(S,1)):k=l?l.concat(i):[i],b(c,k)},[b,l]),w=a.useCallback((c,i)=>{b&&b(c,l===i?null:i)},[b,l]),N=a.useMemo(()=>({className:f.grouped,onChange:j?w:T,value:l,size:v,fullWidth:y,color:x,disabled:g}),[f.grouped,j,w,T,l,v,y,x,g]),r=We(p),$=r.length,E=c=>{const i=c===0,S=c===$-1;return i&&S?"":i?f.firstButton:S?f.lastButton:f.middleButton};return t.jsx(Ke,{role:"group",className:se(f.root,m),ref:n,ownerState:h,...R,children:t.jsx(fe.Provider,{value:N,children:r.map((c,i)=>t.jsx(ge.Provider,{value:E(i),children:c},i))})})}),W="replyid",Ze=e=>{const n=`${`${window.location.origin}${window.location.pathname}`}?${W}=${e}`;$e(n).then(()=>_("Reply link copied to clipboard","info"))};function z(e){const{reply:o,isReplyAuthorModerator:n=!1}=e,[u,p]=a.useState(!1),[m,x]=a.useState(!1),{data:g}=ce(),{data:j}=de(o.projectId),{data:y,isLoading:b}=Ie(o),d=a.useRef(null),{mutate:v}=Ne({onSuccess:()=>{x(!1),_("A reply has been deleted.","info")}}),l=o.createdBy==g?.ownerId;return a.useEffect(()=>{const h=new URLSearchParams(window.location.search).get(W);let f;return h===o.id&&d.current&&(d.current.style.transition="background-color 1s ease",d.current.style.backgroundColor="#fbf4e0",d.current.style.borderColor="#f4dda3",f=setTimeout(()=>{d.current&&(d.current.style.backgroundColor="#f9f9f9",d.current.style.borderColor="#ccc")},2e3)),()=>{f&&clearTimeout(f)}},[o.id]),t.jsx("div",{className:"reply-container",id:`reply._${o.id}`,ref:d,role:"article",children:b?t.jsx(Ge,{numCols:1,numRows:4}):t.jsx(t.Fragment,{children:y&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx(pe,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:n}),t.jsxs("div",{className:"message-body",children:[t.jsx(ue,{markdown:y,objectType:ne.REPLY}),t.jsxs("span",{children:["posted ",le(ie(o.createdOn),"M/D/YYYY"),o.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsxs(I,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[t.jsx("button",{onClick:()=>Ze(o.id),children:t.jsx(B,{icon:"link",label:"Copy link to this reply"})}),l&&t.jsx("button",{onClick:()=>p(!0),children:t.jsx(B,{icon:"edit",label:"Edit reply"})}),j?.permissions.canModerate&&t.jsx("button",{onClick:()=>x(!0),children:t.jsx(B,{icon:"delete",label:"Delete reply"})})]})]})]}),t.jsx(P,{isReply:!0,initialText:y,onClose:()=>p(!1),id:o.id,isDialog:!0,openDialog:u}),t.jsx(U,{open:m,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{x(!1)},onConfirm:()=>v({forumId:o.forumId,threadId:o.threadId,replyId:o.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{z.displayName="DiscussionReply",z.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const Qe="You are following this topic. Click to stop following.",et="You are not following this topic. Click to follow.",tt="You will need to sign in for access to that resource",J="Write a reply...";function Z(e){const{threadId:o,limit:n}=e,u="16px",[p,m]=a.useState(!0),[x,g]=a.useState(!1),[j,y]=a.useState(!1),[b,d]=a.useState(!1),[v,l]=a.useState(!1),[R,h]=a.useState(!1),[f,T]=a.useState(!1),[w,N]=a.useState(!1),{threadData:r,threadBody:$,togglePin:E}=Oe(o),{data:c}=ce(),{data:i}=de(r?.projectId??"",void 0,ke,{enabled:!!r}),{subscription:S,toggleSubscribed:k,isLoading:he}=Pe(o,H.THREAD),{mutate:me}=_e({onSuccess:()=>{l(!1),_("A thread has been deleted.","info")}}),{mutate:xe}=Le({onSuccess:()=>{T(!1),_("A thread has been restored.","info")}}),ye=r?.createdBy==c?.ownerId;function be(){if(c?.userName=="anonymous")h(!0);else try{k()}catch(C){_(C.reason,"danger")}}const{data:F,hasNextPage:Ce,fetchNextPage:Be}=Ee(o,p,n),{data:Y}=ze(r?.forumId??"",{enabled:!!r?.forumId}),ve=Y?.includes(r?.createdBy??""),[L,je]=Me(W),V=a.useMemo(()=>{const C=F?.pages.flatMap(O=>O.results)??[];return L?C.filter(O=>O.id===L):C},[F,L]),Re=()=>{je(null)};return t.jsxs("div",{className:"DiscussionThread",role:"article",children:[r&&$?t.jsxs(t.Fragment,{children:[t.jsxs(I,{sx:{mb:2,textAlign:"right"},children:[t.jsx(G,{component:"span",sx:{mr:1},children:"Sort:"}),t.jsxs(Je,{color:"primary",exclusive:!0,value:p?"datePosted":"mostRecent",children:[t.jsx(K,{value:"datePosted",onClick:()=>m(!0),children:"Date Posted"}),t.jsx(K,{value:"mostRecent",onClick:()=>m(!1),children:"Most Recent"})]})]}),t.jsx(pe,{userId:r.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:ve}),t.jsxs(I,{sx:C=>({[C.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:u,marginTop:u,".SubscribersModal":{justifyContent:"flex-start",marginBottom:u}}}),children:[t.jsx(G,{sx:{marginTop:"4px"},variant:"headline2",children:r.title}),t.jsx(Ue,{id:o,objectType:H.THREAD,showModal:w,handleModal:N})]}),t.jsx("div",{children:t.jsx(ue,{markdown:$,objectType:ne.THREAD})}),t.jsxs("span",{children:["posted ",le(ie(r.createdOn),"M/D/YYYY"),r.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsx(P,{isReply:!1,initialText:$,onClose:()=>g(!1),initialTitle:r?.title,id:o,isDialog:!0,openDialog:x})]}):t.jsx(t.Fragment,{}),t.jsx(I,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:r?.isDeleted?t.jsx("button",{onClick:()=>T(!0),children:t.jsx(B,{icon:"restore",label:"Restore deleted thread"})}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:t.jsx("button",{className:"follow-button","aria-label":S?"Unfollow thread":"Follow thread",disabled:he,onClick:()=>be(),children:S?t.jsx(B,{icon:"visibility",label:Qe}):t.jsx(B,{icon:"visibilityOff",label:et})})}),ye&&t.jsx("button",{onClick:()=>g(!0),children:t.jsx(B,{icon:"edit",label:"Edit thread"})}),i?.permissions.canModerate?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>l(!0),children:t.jsx(B,{icon:"delete",label:"Delete thread"})}),t.jsx("button",{onClick:()=>E(),children:r?.isPinned?t.jsx(B,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):t.jsx(B,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),t.jsx(I,{sx:{mt:2,mb:3},children:j?t.jsx(P,{id:o,isReply:!0,onClose:()=>y(!1),isDialog:!1}):t.jsx(q,{fullWidth:!0,placeholder:J,onClick:()=>{c?.userName=="anonymous"?h(!0):y(!0)}})}),L&&t.jsxs(X,{variant:"outlined",onClick:Re,sx:{display:"flex",alignItems:"center",padding:"2px 8px",marginBottom:"12px",gap:"4px"},children:[t.jsx(B,{icon:"arrowBack",sx:{width:"16px"}}),t.jsx(G,{variant:"smallText2",children:"Show all replies"})]}),t.jsx("div",{children:V.map(C=>{const O=Y?.includes(C.createdBy);return t.jsx(z,{reply:C,isReplyAuthorModerator:O},C.id)})}),V.length>0&&t.jsx(I,{sx:C=>({mt:2,mb:3,[C.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:b?t.jsx(P,{id:o,isReply:!0,onClose:()=>d(!1),isDialog:!1}):t.jsx(q,{fullWidth:!0,placeholder:J,onClick:()=>{c?.userName=="anonymous"?h(!0):d(!0)}})}),Ce?t.jsx(X,{variant:"outlined",onClick:()=>{Be()},children:"Show more results"}):t.jsx(t.Fragment,{}),t.jsx(U,{open:v,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>l(!1),onConfirm:()=>r&&me(r),confirmButtonColor:"error",confirmButtonText:"Delete"}),t.jsx(U,{open:f,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>r&&xe(r),confirmButtonColor:"info",confirmButtonText:"Restore"}),t.jsx(Ae,{open:R,title:"Sign In Required",content:tt,onCancel:()=>h(!1),hasCancelButton:!1,onConfirm:()=>h(!1),confirmButtonProps:{children:"Sign In",className:De}})]})}try{Z.displayName="DiscussionThread",Z.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{Z as D};
