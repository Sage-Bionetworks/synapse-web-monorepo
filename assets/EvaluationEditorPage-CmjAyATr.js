import{j as t}from"./jsx-runtime-DoxjgJx5.js";import{r as d,g as pe,c as Ie}from"./index-Cu9bd8lq.js";import{l as Z,S as V,J as ee,b_ as Te,b$ as Re,c0 as De,c1 as _e}from"./useFiles-BjoZVKQ-.js";import"./VerificationSubmission-DL9jxYsQ.js";import"./RegularExpressions-SKYrON-T.js";import{R as E,a as Ae,C as oe}from"./CreatedOnByUserDiv-CDc5vCMP.js";import{W as ve}from"./WarningDialog-Bfy7WuQt.js";import{I as te,c as ke}from"./IconSvg-DTs68c-Q.js";import{f,a1 as v,af as U,x as G}from"./ConfirmationDialog-kjimNxh9.js";import{A as ne}from"./Alert-B6PGsAkP.js";import{B as T}from"./Button-j3jTttn9.js";import{D as x}from"./Dropdown-C1nIIVAr.js";import{d as S}from"./dayjs.min-D1RcYm3-.js";import{I as le}from"./IconButton-DhHKwBf8.js";import{c as Oe}from"./createSvgIcon-Dn0UJ7ef.js";import{u as Ve}from"./timezone-ClTQq11v.js";import{D as de}from"./DateTimePicker-B76sIaaI.js";import{a as Me}from"./ThemesPlot-l2x9OobB.js";const qe=Oe(t.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox"),fe=e=>{const[n,s]=d.useState(e);return{list:n,handleListChange:o=>l=>{const c=[...n];c[o]=l,s(c)},handleListRemove:o=>()=>{const l=n.filter((c,m)=>o!==m);s(l)},appendToList:(...o)=>{const l=[...n];l.push(...o),s(l)},setList:s}};function $({evaluationId:e,entityId:n,onDeleteSuccess:s,onSaveSuccess:a}){if(e&&n)throw new Error("please use either evaluationId or entityId but not both");const{accessToken:i}=Z(),[r,o]=d.useState(),[l,c]=d.useState(!1);d.useEffect(()=>{r&&c(!1)},[r]);const[m,g]=d.useState(""),[R,L]=d.useState(""),[D,N]=d.useState(""),[C,_]=d.useState(""),[h,A]=d.useState({contentSource:n});d.useEffect(()=>{g(h.name??""),L(h.description??""),N(h.submissionInstructionsMessage??""),_(h.submissionReceiptMessage??"")},[h]),d.useEffect(()=>{e&&(o(void 0),V.getEvaluation(e,i).then(u=>{A(u)}).catch(u=>o(u)))},[e,i]);const k=()=>{o(void 0),c(!1);const u={...h,name:m,description:R,submissionInstructionsMessage:D,submissionReceiptMessage:C};(u.id?V.updateEvaluation(u,i):V.createEvaluation(u,i)).then(b=>{A(b),c(!0),a&&a(b.id)}).catch(b=>o(b))},w=h!=null&&h.id?()=>{o(void 0),V.deleteEvaluation(h.id,i).then(s).catch(u=>o(u))}:void 0;return t.jsx("div",{className:"bootstrap-4-backport",children:t.jsxs("div",{className:"evaluation-editor",children:[t.jsxs(E,{children:[t.jsx(f,{children:t.jsxs("h4",{children:[h.id?"Edit":"Create"," Evaluation Queue"]})}),t.jsx(f,{children:t.jsx(Be,{onClick:k,onDelete:w})})]}),t.jsxs(v,{children:[t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-name",children:"Name"}),t.jsx(v.Control,{id:"evaluation-name",type:"text",value:m,onChange:u=>g(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-description",children:"Description"}),t.jsx(v.Control,{id:"evaluation-description",as:"textarea",value:R,rows:2,onChange:u=>L(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-submissioninstructions",children:"Submission Instructions"}),t.jsx(v.Control,{as:"textarea",id:"evaluation-submissioninstructions",value:D,rows:2,onChange:u=>N(u.target.value)})]}),t.jsxs(v.Group,{children:[t.jsx(v.Label,{htmlFor:"evaluation-receiptmessage",children:"Submission Receipt Message"}),t.jsx(v.Control,{id:"evaluation-receiptmessage",type:"text",value:C,onChange:u=>_(u.target.value)})]}),(h==null?void 0:h.createdOn)&&t.jsx(Ae,{userId:h.ownerId,date:new Date(h.createdOn)}),r&&t.jsx(ee,{error:r}),l&&t.jsx(ne,{className:"save-success-alert",severity:"success",onClose:()=>c(!1),sx:{marginBottom:"20px"},children:"Successfully saved."}),t.jsx("div",{className:"d-flex justify-content-end",children:t.jsx(T,{variant:"contained",color:"primary",className:"save-button",onClick:k,children:"Save"})})]})]})})}function Be({onClick:e,onDelete:n}){const[s,a]=d.useState(!1);return t.jsxs(t.Fragment,{children:[n&&t.jsx(ve,{title:"Delete Evaluation Queue",content:"Are you sure you want to delete this Evaluation Queue?",open:s,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),t.jsxs(x,{className:"float-right",children:[t.jsx(x.Toggle,{variant:"link",className:"dropdown-no-caret",children:t.jsx(te,{icon:"verticalEllipsis"})}),t.jsxs(x.Menu,{alignRight:!0,children:[t.jsx(x.Item,{role:"menuitem",onClick:e,children:"Save"}),n&&t.jsxs(t.Fragment,{children:[t.jsx(x.Divider,{}),t.jsx(x.Item,{role:"menuitem",onClick:()=>a(!0),children:"Delete"})]})]})]})]})}try{$.displayName="EvaluationEditor",$.__docgenInfo={description:"Edits basic properties of an Evaluation",displayName:"EvaluationEditor",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}},onSaveSuccess:{defaultValue:null,description:"Callback after successful save of the Evaluation",name:"onSaveSuccess",required:!1,type:{name:"((evaluationId: string) => void)"}}}}}catch{}const xe={DAILY:"Daily Limit",WEEKLY:"Weekly Limit",MONTHLY:"Monthly Limit"};function W({limitInput:e,allSelectedTypes:n,onChange:s}){return t.jsxs(t.Fragment,{children:[t.jsxs(U,{className:"limit-type",children:[t.jsx("label",{children:"Limit Type"}),t.jsx(G,{as:"select",custom:!0,value:e.type,onChange:a=>{s({type:a.target.value,maxSubmissionString:e.maxSubmissionString})},children:Object.entries(xe).map(([a,i])=>t.jsx("option",{value:a,disabled:n.has(a)&&a!==e.type,children:i},a))})]}),t.jsxs(U,{className:"limit-input",children:[t.jsx("label",{children:"Maximum Submissions"}),t.jsx(G,{type:"text",pattern:"[0-9]*",value:e.maxSubmissionString,onChange:a=>{s({type:e.type,maxSubmissionString:a.target.value})}})]})]})}try{W.displayName="EvaluationRoundLimitOptions",W.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptions",props:{limitInput:{defaultValue:null,description:"",name:"limitInput",required:!0,type:{name:"EvaluationRoundLimitInput"}},allSelectedTypes:{defaultValue:null,description:"",name:"allSelectedTypes",required:!0,type:{name:"Set<EvaluationRoundLimitType>"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(limitInput: EvaluationRoundLimitInput) => void"}}}}}catch{}const Ee=Object.keys(xe),Fe=e=>Ee.find(n=>!e.has(n));function Y({limitInputs:e,handleChange:n,handleDeleteLimit:s,onAddNewLimit:a}){const i=new Set(e.map(o=>o.type)),r=d.useCallback(()=>{a({type:Fe(i),maxSubmissionString:""})},[a,i]);return d.useEffect(()=>{e.length===0&&r()},[e,r]),t.jsx("div",{"data-testid":"EvaluationRoundLimitOptionsList",className:"advanced-limits-grid",children:e.map((o,l)=>t.jsxs(d.Fragment,{children:[t.jsx(W,{limitInput:o,allSelectedTypes:i,onChange:n(l)}),t.jsx(le,{color:"primary","aria-label":"Remove",className:"remove-button",onClick:s(l),children:t.jsx(ke,{})}),l===e.length-1&&e.length<Ee.length&&t.jsx(le,{color:"primary","aria-label":"Add",onClick:r,className:"add-button",children:t.jsx(qe,{})})]},o.type))})}try{Y.displayName="EvaluationRoundLimitOptionsList",Y.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptionsList",props:{limitInputs:{defaultValue:null,description:"",name:"limitInputs",required:!0,type:{name:"EvaluationRoundLimitInput[]"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(index: number) => (limitInput: EvaluationRoundLimitInput) => void"}},handleDeleteLimit:{defaultValue:null,description:"",name:"handleDeleteLimit",required:!0,type:{name:"(index: number) => () => void"}},onAddNewLimit:{defaultValue:null,description:"",name:"onAddNewLimit",required:!0,type:{name:"(limit: EvaluationRoundLimitInput) => void"}}}}}catch{}var ge={exports:{}},B=1;function Pe(){return B=(B*9301+49297)%233280,B/233280}function Ue(e){B=e}var Ge={nextValue:Pe,seed:Ue},K=Ge,y="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",j,ue,I;function J(){I=!1}function Se(e){if(!e){j!==y&&(j=y,J());return}if(e!==j){if(e.length!==y.length)throw new Error("Custom alphabet for shortid must be "+y.length+" unique characters. You submitted "+e.length+" characters: "+e);var n=e.split("").filter(function(s,a,i){return a!==i.lastIndexOf(s)});if(n.length)throw new Error("Custom alphabet for shortid must be "+y.length+" unique characters. These characters were not unique: "+n.join(", "));j=e,J()}}function $e(e){return Se(e),j}function We(e){K.seed(e),ue!==e&&(J(),ue=e)}function Ye(){j||Se(y);for(var e=j.split(""),n=[],s=K.nextValue(),a;e.length>0;)s=K.nextValue(),a=Math.floor(s*e.length),n.push(e.splice(a,1)[0]);return n.join("")}function je(){return I||(I=Ye(),I)}function Ke(e){var n=je();return n[e]}function Je(){return j||y}var ae={get:Je,characters:$e,seed:We,lookup:Ke,shuffled:je},P=typeof window=="object"&&(window.crypto||window.msCrypto),Q;!P||!P.getRandomValues?Q=function(e){for(var n=[],s=0;s<e;s++)n.push(Math.floor(Math.random()*256));return n}:Q=function(e){return P.getRandomValues(new Uint8Array(e))};var Qe=Q,He=function(e,n,s){for(var a=(2<<Math.log(n.length-1)/Math.LN2)-1,i=-~(1.6*a*s/n.length),r="";;)for(var o=e(i),l=i;l--;)if(r+=n[o[l]&a]||"",r.length===+s)return r},ze=ae,Xe=Qe,Ze=He;function et(e){for(var n=0,s,a="";!s;)a=a+Ze(Xe,ze.get(),1),s=e<Math.pow(16,n+1),n++;return a}var tt=et,M=tt,nt=1567752802062,at=7,q,ce;function st(e){var n="",s=Math.floor((Date.now()-nt)*.001);return s===ce?q++:(q=0,ce=s),n=n+M(at),n=n+M(e),q>0&&(n=n+M(q)),n=n+M(s),n}var it=st,rt=ae;function ot(e){if(!e||typeof e!="string"||e.length<6)return!1;var n=new RegExp("[^"+rt.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!n.test(e)}var lt=ot;(function(e){var n=ae,s=it,a=lt,i=0;function r(m){return n.seed(m),e.exports}function o(m){return i=m,e.exports}function l(m){return m!==void 0&&n.characters(m),n.shuffled()}function c(){return s(i)}e.exports=c,e.exports.generate=c,e.exports.seed=r,e.exports.worker=o,e.exports.characters=l,e.exports.isValid=a})(ge);var dt=ge.exports,ut=dt;const ye=pe(ut),be=(e,n)=>({reactListKey:n??ye.generate(),evaluationId:e.evaluationId,id:e.id,etag:e.etag,roundStart:e.roundStart,roundEnd:e.roundEnd,totalSubmissionLimit:ct(e.limits),otherLimits:mt(e.limits)}),ct=e=>(e||[]).filter(n=>n.limitType==="TOTAL").reduce((n,s)=>s.maximumSubmissions.toString(),""),mt=e=>(e||[]).filter(n=>n.limitType!=="TOTAL").reduce((n,s)=>(n.push({type:s.limitType,maxSubmissionString:s.maximumSubmissions.toString()}),n),[]);function H({onSave:e,onDelete:n}){const[s,a]=d.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(ve,{title:"Delete Evaluation Round",content:"Are you sure you want to delete this Evaluation Round?",open:s,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),t.jsxs(x,{className:"float-right",children:[t.jsx(x.Toggle,{"aria-label":"Round Options",variant:"link",className:"dropdown-no-caret evaluation-round-editor-dropdown",children:t.jsx(te,{icon:"verticalEllipsis"})}),t.jsxs(x.Menu,{alignRight:!0,children:[t.jsx(x.Item,{onClick:e,children:"Save"}),t.jsx(x.Divider,{}),t.jsx(x.Item,{onClick:()=>a(!0),children:"Delete"})]})]})]})}try{H.displayName="EvaluationRoundEditorDropdown",H.__docgenInfo={description:"",displayName:"EvaluationRoundEditorDropdown",props:{onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"() => void"}}}}}catch{}var Le={exports:{}};(function(e,n){(function(s,a){e.exports=a()})(Ie,function(){return function(s,a){a.prototype.isSameOrAfter=function(i,r){return this.isSame(i,r)||this.isAfter(i,r)}}})})(Le);var ht=Le.exports;const pt=pe(ht);S.extend(Ve);S.extend(pt);const vt=(e,n)=>{let s,a,i;const r=S();return r.isSameOrAfter(e)?r.isBefore(n)?(s="status-in-progress",a={icon:"sync"},i="IN PROGRESS"):(s="status-completed",a={icon:"clipboardCheck"},i="COMPLETED"):(s="status-not-yet-started",a=void 0,i="NOT YET STARTED"),t.jsx("div",{className:s,children:t.jsxs("div",{className:"status",children:[a&&t.jsx(te,{...a}),t.jsx("span",{children:i})]})})},ft=(e,n,s,a,i)=>{const r=[];if(a){const o=Number(a);if(Number.isNaN(o))throw TypeError("Total Submission is not an integer");r.push({limitType:"TOTAL",maximumSubmissions:o})}return i.forEach(o=>{if(o.maxSubmissionString){const l=Number(o.maxSubmissionString);if(Number.isNaN(l))throw TypeError(o.type+" Limit is not an integer");r.push({limitType:o.type,maximumSubmissions:l})}}),{id:e.id,etag:e.etag,evaluationId:e.evaluationId,roundStart:S.utc(n).toJSON(),roundEnd:S.utc(s).toJSON(),limits:r}};function me(e,n){if(n==null)return null;switch(n){case"disablePast":return`${Me(e)} date cannot be in the past`;case"invalidDate":default:return"Invalid date"}}function z({evaluationRoundInput:e,onSave:n,onDelete:s}){const{accessToken:a}=Z(),[i,r]=d.useState(),[o,l]=d.useState(!1);d.useEffect(()=>{i&&l(!1)},[i]);const[c,m]=d.useState(e.roundStart?S(e.roundStart):null),[g,R]=d.useState(e.roundEnd?S(e.roundEnd):null),[L,D]=d.useState(e.totalSubmissionLimit),[N,C]=d.useState(!1),[_,h]=d.useState(null),[A,k]=d.useState(null),{list:w,handleListRemove:u,handleListChange:se,appendToList:b}=fe(e.otherLimits),Ne=p=>{const O=u(p);return()=>{O(),w.length===1&&C(!1)}},ie=()=>{l(!1);let p;try{p=ft(e,c,g,L,w)}catch(O){r(O)}p&&(p.id?Te(p,a):Re(p,a)).then(F=>{const we=be(F,e.reactListKey);r(void 0),l(!0),n(we)}).catch(F=>r(F))},Ce=()=>{e.id?De(e.evaluationId,e.id,a).then(()=>s()).catch(p=>r(p)):s()},re=S().isSameOrAfter(e.roundStart);return t.jsx("div",{className:"evaluation-round-editor",children:t.jsx(oe,{children:t.jsx(oe.Body,{children:t.jsxs(v,{role:"form",children:[t.jsxs(E,{children:[t.jsx(f,{children:t.jsxs("h5",{children:["ROUND STATUS",e.id&&" ("+e.id+")"]})}),t.jsx(f,{children:t.jsx(H,{onDelete:Ce,onSave:ie})})]}),t.jsx(E,{className:"mb-3",children:t.jsx(f,{children:t.jsx("div",{className:"round-status",children:vt(e.roundStart,e.roundEnd)})})}),t.jsx(E,{children:t.jsx(f,{children:t.jsx("h5",{children:"DURATION"})})}),t.jsxs(E,{children:[t.jsx(f,{children:t.jsx(de,{label:"Round Start",value:c,onChange:m,onError:p=>h(p),disabled:re,disablePast:!re,slotProps:{textField:{helperText:me("start",_)}}})}),t.jsx(f,{children:t.jsx(de,{label:"Round End",value:g,onChange:R,onError:p=>k(p),disablePast:!S(g).isSame(e.roundEnd),slotProps:{textField:{helperText:me("end",A)}}})})]}),t.jsx(E,{children:t.jsx(f,{children:t.jsx("h5",{style:{marginTop:"20px"},children:"SUBMISSION LIMITS"})})}),t.jsx(E,{children:t.jsx(f,{children:t.jsxs(U,{children:[t.jsx("label",{children:"Total Submissions / Round"}),t.jsx(G,{value:L,type:"text",pattern:"[0-9]*",onChange:p=>D(p.target.value),autoComplete:"new-password"})]})})}),t.jsx(E,{className:"mb-3",children:t.jsx(f,{children:t.jsx(T,{variant:"text",color:"primary",sx:{fontSize:"16px !important"},className:"advanced-limits-link",onClick:()=>C(!N),children:"Advanced Limits"})})}),N&&t.jsx(Y,{limitInputs:w,handleChange:se,handleDeleteLimit:Ne,onAddNewLimit:b}),i&&t.jsx(E,{className:"my-3",children:t.jsx(f,{children:t.jsx(ee,{error:i})})}),o&&t.jsx(E,{className:"my-3",children:t.jsx(f,{children:t.jsx(ne,{className:"save-success-alert",severity:"success",onClose:()=>l(!1),sx:{mb:"20px"},children:"Successfully saved."})})}),t.jsx(E,{className:"mt-3",children:t.jsx(f,{children:t.jsx(T,{variant:"contained",color:"primary",className:"save-button float-right border-0",onClick:ie,children:"Save"})})})]})})})})}try{z.displayName="EvaluationRoundEditor",z.__docgenInfo={description:"",displayName:"EvaluationRoundEditor",props:{evaluationRoundInput:{defaultValue:null,description:"",name:"evaluationRoundInput",required:!0,type:{name:"EvaluationRoundInput"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(evaluationRound: EvaluationRoundInput) => void"}}}}}catch{}const xt=(e,n,s,a)=>{const i=[],r=o=>{_e(e,{nextPageToken:o},n).then(l=>{const c=l.page.map(m=>be(m));i.push(...c),a(void 0),l.nextPageToken?r(l.nextPageToken):s(i)}).catch(l=>{a(l)})};r(void 0)};function X({evaluationId:e}){const{accessToken:n}=Z(),[s,a]=d.useState(),{list:i,appendToList:r,handleListChange:o,handleListRemove:l,setList:c}=fe([]);return d.useEffect(()=>{xt(e,n,c,a)},[n,e]),s?t.jsx(ee,{error:s}):t.jsxs("div",{className:"evaluation-round-editor-list bootstrap-4-backport",children:[t.jsx("div",{className:"evaluation-rounds",children:i.map((m,g)=>t.jsx(z,{evaluationRoundInput:m,onSave:o(g),onDelete:l(g)},m.reactListKey))}),t.jsx("div",{children:t.jsx(T,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{r({reactListKey:ye(),evaluationId:e,roundStart:"",roundEnd:"",totalSubmissionLimit:"",otherLimits:[]})},children:"Add Round"})})]})}try{X.displayName="EvaluationRoundEditorList",X.__docgenInfo={description:"Edits EvaluationsRounds for an Evaluation.",displayName:"EvaluationRoundEditorList",props:{evaluationId:{defaultValue:null,description:"id of the Evaluation containing EvaluationRounds to edit",name:"evaluationId",required:!0,type:{name:"string"}}}}}catch{}function he({evaluationId:e,entityId:n,onDeleteSuccess:s}){const[a,i]=d.useState(e);return t.jsxs("div",{className:"bootstrap-4-backport",children:[t.jsx($,{evaluationId:a,entityId:a?void 0:n,onDeleteSuccess:s,onSaveSuccess:i}),t.jsx("div",{className:"my-4",children:a?t.jsx(X,{evaluationId:a}):t.jsx(Et,{})})]})}function Et(){const[e,n]=d.useState(!1);return t.jsx("div",{"data-testid":"FakeEvaluationRoundEditorList",children:e?t.jsx(ne,{severity:"info",children:"Evaluation Rounds can be edited once the Evaluation has been created."}):t.jsx(T,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{n(!0)},children:"Add Round"})})}try{he.displayName="EvaluationEditorPage",he.__docgenInfo={description:"Combined editor that allows editing an Evaluation's data and also it's associated rounds (once the Evaluation exists on Synapse)",displayName:"EvaluationEditorPage",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}}}}}catch{}export{he as E};
