import{j as l}from"./jsx-runtime-DBMcmXCa.js";import{l as X,bi as H}from"./useFiles-BCC9o9bm.js";import{r as D}from"./SqlFunctions-DnxC6kpb.js";import"./StringUtils-CzgJJW-6.js";import{i as J}from"./SynapseConstants-D6yJoWPV.js";import{r as _}from"./index-DBlnVwD8.js";import"./VerificationSubmission-B0kBNeMy.js";import"./OrientationBanner-D1D6xyRZ.js";import{u as K}from"./unCamelCase-ZiU_emRy.js";import{l as W}from"./LoadingScreen-IgONV2yh.js";import{c as N}from"./cloneDeep-DmxrBXJm.js";import{n as Y}from"./noop-DX6rZLP_.js";import{u as O}from"./uniq-cqOTC2K6.js";import{P as U}from"./Plot-DNuWS543.js";import{b as Z}from"./_initCloneObject-DxaU8L-P.js";import{c as ee}from"./_createAggregator-DijB-IMi.js";import{b as te}from"./_baseOrderBy-CzTbLej1.js";import{i as M}from"./isArray-Dxzbedgu.js";import{T as ae}from"./Tooltip-DtNzDJHf.js";import{h as oe}from"./head-aneRfQQJ.js";var re=Object.prototype,le=re.hasOwnProperty,se=ee(function(a,t,e){le.call(a,e)?++a[e]:Z(a,e,1)});function F(a,t,e,o){return a==null?[]:(M(t)||(t=t==null?[]:[t]),e=e,M(e)||(e=e==null?[]:[e]),te(a,t,e))}function ne(a,t,e){t&&(a=a.filter(n=>n.y===t));const o=O(a.map(n=>n.group)).sort(),r=[],s=["(28,118,175,1)","rgba(91,176,181,1)"];return o.forEach((n,d)=>{const p=a.filter(i=>i.group===n);r.push({x:p.map(i=>i.x),y:p.map(i=>i.y),name:n,orientation:"h",marker:{color:e?e[n]:s[d],width:1},text:[n],hovertemplate:"%{x} %{text}<extra></extra>",textposition:"none",type:"bar"})}),r}function ie(a,{isTop:t,maxValue:e,backgroundColor:o}){const r=N(a);return r.xaxis={visible:!1,range:[0,e]},o&&(r.plot_bgcolor=o,r.paper_bgcolor=o),t||(r.hoverlabel={font:{size:10}}),r.showlegend=!1,r.height=t?40:20,r}const ue={backgroundColor:"transparent"},de={width:"100%",height:"100%"};function C({plotData:a,optionsConfig:t,isTop:e,layoutConfig:o,label:r,xMax:s,colors:n,plotStyle:d=ue,style:p=de,onClick:i}){return l.jsx(U,{style:p,layout:ie(o,{isTop:e,maxValue:s,backgroundColor:d.backgroundColor}),config:t,data:ne(a,r,n),onClick:c=>i?i(c):Y})}try{C.displayName="BarPlot",C.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(event: Plotly.PlotMouseEvent) => void"}}}}}catch{}function ce(a,t){const e=N(a);if(!t)return e;t.backgroundColor&&(e.plot_bgcolor=t.backgroundColor),e.yaxis.showgrid=!1,e.yaxis.zeroline=!0,e.yaxis.zerolinecolor="#aeb5bc",e.yaxis.showticklabels=!1,e.xaxis.type==="log"?(e.xaxis.tickformat="f",e.xaxis.range=[-.1,Math.log10(t.maxValue)+.1]):e.xaxis.range=[t.maxValue/50*-1,t.maxValue+30],e.xaxis.visible=t.isXAxis,e.showlegend=t.isLegend,e.margin={t:0,b:t.isXAxis?50:0,l:0,r:0,pad:15};let o=40;return t.isLegend&&(o=35,e.margin.pad=0,e.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},e.yaxis={visible:!1,showline:!1}),t.isXAxis&&(e.yaxis={visible:!1,showgrid:!1,showline:!1},o=50),e.height=o,e}function pe(a,t){const e=new Array(a.length);return t.forEach(o=>{const r=a.indexOf(o.y);r!==-1&&(e[r]=o.x)}),e}function j(a){const t=[],e=(a-1)/2;for(let o=0;o<a;o++)t.push(o-e);return t}function w(a){const t=se(a,r=>r[0]),e={},o={};return Object.keys(a).forEach(r=>{const s=a[r][0];if(t[s]===1)e[r]=[0];else{o[s]==null&&(o[s]=0);const d=j(t[s])[o[s]];e[r]=[d],o[s]=o[s]+1}}),e}function me(a,t,e,o){const r=e===void 0,s=O(a.map(c=>c.group)),n=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"],d=s.reduce((c,y)=>{const g=r?[-100]:pe(e,a.filter(h=>h.group===y));return{...c,[y]:g}},{}),p=w(d);return s.map((c,y)=>{const g=d[c],h=p[c];return{type:"scatter",x:g,y:h,text:[c],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:c,marker:{color:t.markerFill,line:{color:t.markerLine,width:1},symbol:o?o[c]:n[y],size:t.markerSize}}})}const fe={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},ye={width:"100%",height:"100%"};function b({plotData:a,optionsConfig:t,layoutConfig:e,label:o,id:r,xMax:s,style:n=ye,markerSymbols:d,plotStyle:p=fe,onClick:i,isLegend:c=!1,isXAxis:y=!1}){const g=o?[o]:void 0;return l.jsx(U,{layout:ce(e,{isLegend:c,isXAxis:y,maxValue:s,backgroundColor:p.backgroundColor}),style:n,data:me(a,p,g,d),config:t,onClick:h=>i?i(h):Y},`dotPlot_${r}`)}try{j.displayName="generateCenteredSequence",j.__docgenInfo={description:`Generates a sequence of n numbers centered around 0

Examples:
if n is 4, the result would be [-1.5, -0.5, 0.5, 1.5]
if n is 5 the result would be [-2, -1, 0, 1, 2]`,displayName:"generateCenteredSequence",props:{}}}catch{}try{w.displayName="getYDataForDotPlotOffset",w.__docgenInfo={description:`Returns a set of y values where
 - if an x value is unique, the y value is 0
 - if an x value is repeated, the y value is an offset from 0

This has the effect of preventing overlapping points in a dot plot`,displayName:"getYDataForDotPlotOffset",props:{}}}catch{}try{b.displayName="DotPlot",b.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
  markerFill: '#515359',
  markerLine: '#515359',
  markerSize: 9,
  backgroundColor: 'transparent',
}`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: Plotly.PlotMouseEvent) => void"}}}}}catch{}const P={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},L={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd",type:"log"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},R={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function q(a,{xField:t,yField:e,groupField:o,entityId:r,whereClause:s,infoField:n}){const d=`SELECT ${t} as "x", ${e} as "y", ${n?n+' as "info", ':""} ${o} as "group"
                 FROM ${r} ${s?" WHERE "+s:""}`;return H({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:J,entityId:r,query:{sql:d}},a).then(i=>i.queryResult.queryResults)}function S(a,t){const e=a.reduce((r,s)=>(r[s[t]]=(s[t]in r?Number(r[s[t]]):0)+Number(s.x),r),{}),o=[];for(const r in e)o.push({[t]:r,count:e[r]});return o}const V=(a,t)=>{const e=a.points[0].data;let o=e.y[0],r=e.name;return t&&([o,r]=[r,o]),{facetValue:o,type:r,event:a.event}},he=(a,t)=>l.jsx("div",{className:"ThemesPlot__barPlotLegend",children:t.map((e,o)=>l.jsxs("div",{style:{float:"left"},children:[l.jsx("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${a?a[e]:"transparent"}`}},"topBar_label"),l.jsx("div",{className:"ThemesPlot__barPlotLegend__graph",children:e},"topBar_graph")," "]},`topBar_${o}`))}),$=(a,t)=>{for(const e in a)a[e]=a[e].replace(",1)",`, ${t})`).replace(",1.0)",`, ${t})`);return a},ge=(a,t)=>oe(a.filter(e=>e.y===t).map(e=>e.info));function z({dotPlot:a,topBarPlot:t,sideBarPlot:e,onPointClick:o,onIndividualThemeBarPlotPointClick:r,dotPlotYAxisLabel:s="Research Themes"}){const{accessToken:n}=X(),[d,p]=_.useState(!1),[i,c]=_.useState([]),[y,g]=_.useState([]),[h,I]=_.useState([]);_.useEffect(()=>{const u=q(n,a),m=q(n,t),x=q(n,e);return Promise.all([u,m,x]).then(f=>{c(D(f[0].headers,f[0].rows)),g(D(f[1].headers,f[1].rows)),I(D(f[2].headers,f[2].rows)),p(!0)}).catch(f=>{throw f}),()=>{}},[n,a,t,e]);let B=[],E=[],T=0,A=[],v=[];return d&&(v=S(h,"y"),B=v.sort((u,m)=>m.count-u.count).map(u=>u.y),T=Math.max(...i.map(u=>Number(u.x))),A=F(S(y,"y"),["y"]),E=F(S(y,"group"),["group"]).map(u=>u.group)),l.jsxs(l.Fragment,{children:[!d&&W,d&&l.jsxs("div",{className:"ThemesPlot",children:[l.jsx("div",{className:"ThemesPlot__dotPlotLegend",children:l.jsx(b,{id:"head",plotData:i,isLegend:!0,markerSymbols:a.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:L,optionsConfig:{...P,responsive:!0,staticPlot:!0},plotStyle:{...a.plotStyle,backgroundColor:"transparent"}})}),t.colors&&he(t.colors,E),A.map((u,m)=>l.jsxs("div",{className:"ThemesPlot__topBarPlot",children:[l.jsxs("div",{className:"ThemesPlot__topBarPlot__label",children:[u.count," ",K(u.y)]}),l.jsx("div",{className:"ThemesPlot__topBarPlot__plot",children:l.jsx(C,{style:{width:"100%",height:"100%"},layoutConfig:N(R),optionsConfig:{...P},plotData:y,isTop:!0,label:u.y,xMax:u.count,onClick:x=>o(V(x,!0)),colors:m%2===0?t.colors:$({...t.colors},"1")})})]},`topBarDiv_${m}`)),l.jsxs("div",{style:{display:"flex",position:"relative"},children:[l.jsx("div",{className:"ThemesPlot__dotPlotYLabel",children:s}),l.jsxs("div",{className:"ThemesPlot__dotPlot",children:[B.map((u,m)=>{var x,f;return l.jsxs("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:(x=a.plotStyle)==null?void 0:x.backgroundColor},children:[l.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",children:l.jsx(ae,{title:`${ge(i,u)} `,placement:"right",children:l.jsxs("div",{children:[l.jsx("span",{className:"ThemesPlot__dotPlot__themeLabel",children:u}),l.jsx("br",{}),l.jsxs("span",{className:"ThemesPlot__dotPlot__countLabel",children:[v[m].count," ",e.countLabel]}),l.jsx("br",{}),l.jsx(C,{style:{width:"100%"},layoutConfig:R,optionsConfig:P,plotData:h,isTop:!1,xMax:v[m].count,label:u,colors:$({...t.colors},"1"),onClick:k=>{r&&r(V(k,!1))}})]})})}),l.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:l.jsx("div",{style:{width:"100%",backgroundColor:(f=a.plotStyle)==null?void 0:f.backgroundColor},children:l.jsx(b,{id:`${m}`,onClick:k=>{const{type:Q,event:G}=V(k,!1);o({facetValue:u,type:Q,event:G})},plotData:i,plotStyle:a.plotStyle,markerSymbols:a.markerSymbols,xMax:T,label:u,layoutConfig:L,optionsConfig:{...P,responsive:!1}})})})]},`plotDiv_${+m}`)}),l.jsxs("div",{className:"ThemesPlot__dotPlot__row",children:[l.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),l.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:l.jsx(b,{id:"footer",plotData:i,isXAxis:!0,xMax:T,layoutConfig:L,optionsConfig:{...P,responsive:!1}})})]})]})]}),l.jsx("div",{})]})]})}try{z.displayName="ThemesPlot",z.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},onIndividualThemeBarPlotPointClick:{defaultValue:null,description:"",name:"onIndividualThemeBarPlotPointClick",required:!1,type:{name:"({ facetValue, type, event, }: ClickCallbackParams) => void"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}export{z as T};
