var R=Object.defineProperty;var T=(o,s,e)=>s in o?R(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var a=(o,s,e)=>T(o,typeof s!="symbol"?s+"":s,e);import{j as t}from"./jsx-runtime-Du8NFWEI.js";import{at as D,S as h}from"./useFiles-D6Pybmbn.js";import{p as j}from"./SqlFunctions-BfgxHr4o.js";import"./StringUtils-DrtZBNIY.js";import{F as _,v as I}from"./index-B4msL5O1.js";import{r as y}from"./index-Dl6G-zuu.js";import"./enums-DQPmi6vp.js";import"./styled-BMGIoXl7.js";import{D as V}from"./DialogBase-KCLJB30U.js";import{S as v,a as k,b as B}from"./SynapseFormRadioWidget-DaolslXs.js";import{B as f}from"./Button-CgNBwHku.js";const c="First line is the columns names.",p="Include row metadata (Row Id and Row Version).",i="Comma Separated Values (CSV)",g="Tab Separated Values (TSV)",L={type:"object",properties:{"File Type":{type:"string",oneOf:[{const:i,title:i},{const:g,title:g}]},Contents:{type:"array",title:"Contents",items:{type:"string",enum:[c,p]},uniqueItems:!0}}},E={"File Type":{"ui:widget":"radio"},Contents:{"ui:widget":"checkboxes"}},N={description:"File is ready for download. Select the download button to download the file.",type:"object"},O={},W=[L,N],A=[E,O];class r extends y.Component{constructor(e){super(e);a(this,"handleSubmit",e=>{this.state.step===0?this.handleDownloadSetup(e):this.onDownload()});a(this,"handleDownloadSetup",e=>{this.setState({isLoading:!0});const{formData:n}=e,w=n["File Type"],m=n.Contents,{queryBundleRequest:x,getLastQueryRequest:S}=this.props,C=w===i?",":"	",q=m.includes(c),F=m.includes(p),l=x??S(),u=l.query.sql,b={sql:u,entityId:j(u),selectedFacets:l.query.selectedFacets,concreteType:"org.sagebionetworks.repo.model.table.DownloadFromTableRequest",writeHeader:q,includeRowIdAndRowVersion:F,csvTableDescriptor:{separator:C},additionalFilters:l.query.additionalFilters};h.createTableCsvForDownload(b,this.context.accessToken).then(d=>{this.setState({isLoading:!1,step:1,data:d})}).catch(d=>{console.log("Error getDownloadFromTableRequest: ",d)})});a(this,"onDownload",()=>{const{data:e}=this.state;h.getFileHandleByIdURL(e.resultsFileHandleId,this.context.accessToken).then(n=>{window.location.href=n,this.props.onClose()})});a(this,"handleChange",e=>{const{formData:n}=e;this.setState({formData:n})});this.state={isLoading:!1,step:0,formData:{"File Type":i,Contents:[c,p]}}}render(){const e={height:50,width:50,backgroundSize:50};return t.jsx(V,{open:!0,onCancel:this.props.onClose,title:"Download query results",content:t.jsx(t.Fragment,{children:t.jsxs(_,{validator:I,id:"modal-download-form",schema:W[this.state.step],uiSchema:A[this.state.step],onChange:this.handleChange,formData:this.state.formData,onSubmit:this.handleSubmit,widgets:{CheckboxWidget:v,CheckboxesWidget:k,RadioWidget:B},children:[this.state.isLoading&&t.jsx("div",{className:"SRC-centerAndJustifyContent",children:t.jsxs("div",{className:"SRC-center-text",children:[t.jsx("p",{children:" Creating the File "}),t.jsx("div",{style:e,className:"spinner"}),t.jsx("p",{children:" Loading... "})]})}),t.jsx(y.Fragment,{})]})}),actions:t.jsxs(t.Fragment,{children:[t.jsx(f,{variant:"outlined",color:"primary",onClick:this.props.onClose,children:"Cancel"}),t.jsx(f,{form:"modal-download-form",type:"submit",variant:"contained",color:"primary",children:this.state.step===0?"Next":"Download"})]})})}}a(r,"contextType",D);try{r.displayName="ModalDownload",r.__docgenInfo={description:"",displayName:"ModalDownload",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(...args: any[]) => void"}},includeEntityEtag:{defaultValue:null,description:"",name:"includeEntityEtag",required:!1,type:{name:"boolean"}},queryBundleRequest:{defaultValue:null,description:"",name:"queryBundleRequest",required:!1,type:{name:"QueryBundleRequest"}},getLastQueryRequest:{defaultValue:null,description:"",name:"getLastQueryRequest",required:!1,type:{name:"(() => QueryBundleRequest)"}},offset:{defaultValue:null,description:"",name:"offset",required:!1,type:{name:"number"}},limit:{defaultValue:null,description:"",name:"limit",required:!1,type:{name:"number"}},sort:{defaultValue:null,description:"",name:"sort",required:!1,type:{name:"SortItem[]"}}}}}catch{}try{r.contextType.displayName="ModalDownload.contextType",r.contextType.__docgenInfo={description:`Context lets components pass information deep down without explicitly
passing props.

Created from {@link createContext}`,displayName:"ModalDownload.contextType",props:{}}}catch{}export{r as M};
