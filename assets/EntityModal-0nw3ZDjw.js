import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{r as _}from"./index-Cu9bd8lq.js";import{e as b,f as E,r as z,s as Q,q as X}from"./RegularExpressions-SKYrON-T.js";import{a6 as Y,j as C,B as O,W as ee}from"./useFiles-VFnS8GPd.js";import{e as te,u as D}from"./useEntity-BNH_YcEb.js";import{d as ae}from"./ToastMessage-CPW-dqej.js";import{u as ne,a as se,S as oe}from"./SchemaDrivenAnnotationEditor-Bmx3g5We.js";import{a as ie}from"./VerificationSubmission-DL9jxYsQ.js";import"./OrientationBanner-6BqxDXOp.js";import{O as re,b as le,C as de}from"./ConfirmationDialog-Cz4h3IRB.js";import"./SkeletonButton-DY6KFqw4.js";import"./SkeletonInlineBlock-C0_HtXr5.js";import{S as ce}from"./SkeletonTable-cnLNNfKt.js";import"./SkeletonParagraph-D3TKACKi.js";import{d as N}from"./dayjs.min-D1RcYm3-.js";import{F as me}from"./FullWidthAlert-7vG6655N.js";import{f as w}from"./DateFormatter-ROPAEx3G.js";import{g as ue,u as pe,a as _e}from"./FileHandleUtils-C4lPs_LI.js";import{U as v}from"./UserBadge-eUCFkN3e.js";import{B as x}from"./Button-j3jTttn9.js";import{S as ye}from"./Skeleton-DxEJ6_Wp.js";import{n as fe}from"./noop-DX6rZLP_.js";import{T as he}from"./Tooltip-CTVx2uGI.js";function Te(n){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(n))return!1;const i=new Date(n);return i instanceof Date&&!isNaN(i.getTime())&&i.toISOString()===n}function g(n){return typeof n=="number"||typeof n=="boolean"?n.toString():Te(n)?w(N(n)):n}function M(n){const{entityId:i,versionNumber:a}=n,[T,d]=_.useState(!1),y=re(ie.JSONSCHEMA_VALIDATION_STATUS),{data:c,isLoading:f,refetch:u}=te(i,a,!0),s=c==null?void 0:c.entityMetadata,r=c==null?void 0:c.annotations,{data:p}=ne(i,{enabled:y}),{data:m,refetch:o}=se(i,{enabled:y&&!!p}),l=y&&!!p,h=!!s&&!!m&&N(s.modifiedOn).diff(N(m.validatedOn))>0,j=_.useCallback(async()=>{d(!0);const t=[u(),o()];await Promise.allSettled(t),d(!1)},[u,o]);return f||T?e.jsx(ce,{numRows:3,numCols:2}):e.jsxs(e.Fragment,{children:[s&&r&&Y(r)?e.jsxs("div",{className:"placeholder",children:["This"," ",b(E(s.concreteType))," ","has no annotations."]}):null,e.jsx("table",{className:"AnnotationsTable",children:e.jsxs("tbody",{children:[r&&Object.keys(r).map(t=>e.jsxs("tr",{className:"AnnotationsTable__Row",children:[e.jsx("td",{className:"AnnotationsTable__Row__Key",children:t}),e.jsx("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(r[t])?r[t].map(g).join(", "):g(r[t])})]},t)),l?e.jsxs("tr",{className:"AnnotationsTable__Row",children:[e.jsx("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e.jsx("td",{className:"AnnotationsTable__Row__Value",children:e.jsx("a",{href:`${C(O.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${p.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:p.jsonSchemaVersionInfo.schemaName})})]}):null]})}),s&&l&&h&&e.jsx(me,{variant:"warning",description:`This ${b(E(s.concreteType))} has changed since it has been last validated. If this ${b(E(s.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{j()}},isGlobal:!1})]})}try{g.displayName="getDisplayedAnnotation",g.__docgenInfo={description:"",displayName:"getDisplayedAnnotation",props:{}}}catch{}try{M.displayName="AnnotationsTable",M.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const S=({entityId:n,versionNumber:i})=>{var s,r,p,m,o,l,h;const{data:a}=D(n,i),T=a&&z(a.entity),d=a?ue(a):void 0,y=(s=a==null?void 0:a.entity)==null?void 0:s.parentId,c=d==null?void 0:d.storageLocationId,{data:f}=pe(y,c,{enabled:y!==void 0&&c!=null});let u;return d&&(u=_e(d,f)),a?e.jsx("table",{className:"MetadataTable",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Name"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(r=a.entity)==null?void 0:r.name})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Type"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:b(a.entityType)})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:(p=a.entity)==null?void 0:p.id})]}),T&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Version"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:Q(a.entity)})]}),u&&e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e.jsx("td",{className:"MetadataTable__Row__Value",children:u})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(v,{userId:(m=a.entity)==null?void 0:m.modifiedBy})," at"," ",w(N((o=a.entity)==null?void 0:o.modifiedOn))]})]}),e.jsxs("tr",{className:"MetadataTable__Row",children:[e.jsx("td",{className:"MetadataTable__Row__Key",children:"Created By"}),e.jsxs("td",{className:"MetadataTable__Row__Value",children:[e.jsx(v,{userId:(l=a.entity)==null?void 0:l.createdBy})," at"," ",w(N((h=a.entity)==null?void 0:h.createdOn))]})]})]})}):null};try{S.displayName="MetadataTable",S.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const be=["METADATA","ANNOTATIONS"];function V(n){const{entityId:i,versionNumber:a,show:T,onClose:d,initialTab:y="METADATA",showTabs:c=!0,onEditModeChanged:f=fe}=n,u=_.useRef(null),[s,r]=_.useState(y),[p,m]=_.useState(!1),[o,l]=_.useState(!1),[h,j]=_.useState(()=>l(!1));_.useEffect(()=>(f(o),()=>{f(!1)}),[o,f]);const{data:t}=D(i,a),B=t&&t.permissions.canEdit,I=t&&X(t.entityType),q=I&&t.entity.isLatestVersion,F=s==="METADATA"&&t&&!window.location.href.includes(i),L=e.jsxs(x,{variant:"contained",onClick:()=>window.open(`${C(O.PORTAL_ENDPOINT)}Synapse:${i}`,"_blank","noopener"),children:["Open"," ",t?b(t==null?void 0:t.entityType):""]}),k=s==="ANNOTATIONS"&&o,K=e.jsx(x,{variant:"contained",onClick:()=>{u.current.formElement.current.requestSubmit()},children:"Save Annotations"}),$=s==="ANNOTATIONS"&&o,P=e.jsx(x,{variant:"outlined",onClick:()=>{j(()=>()=>l(!1)),m(!0)},children:"Cancel"}),G=B&&s==="ANNOTATIONS"&&!o,R=I&&!q,U=e.jsx(he,{title:R?"Annotations can only be edited on the latest version":void 0,children:e.jsx("span",{children:e.jsx(x,{variant:"contained",disabled:R,onClick:()=>{l(!0)},children:"Edit"})})}),W=e.jsxs(e.Fragment,{children:[c&&!o?e.jsx("div",{className:"Tabs",children:be.map(A=>e.jsx("div",{className:"Tab",role:"tab",onClick:Z=>{Z.stopPropagation(),r(A)},"aria-selected":A===s,children:A},A))}):null,e.jsx("div",{style:s==="ANNOTATIONS"?{}:{display:"none"},children:o?e.jsx(ee,{children:e.jsx(oe,{entityId:i,formRef:u,hideActions:!0,onSuccess:()=>{ae("Annotations successfully updated.","success"),l(!1)},onCancel:()=>l(!1)})}):e.jsx(M,{entityId:i,versionNumber:a})}),e.jsx("div",{style:s==="METADATA"?{}:{display:"none"},children:e.jsx(S,{entityId:i,versionNumber:a})})]}),H=e.jsx(de,{open:p,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{m(!1)},onConfirm:()=>{m(!1),h()}}),J=_.useMemo(()=>{if(t!=null&&t.entity.name){if(s==="ANNOTATIONS")return`${o?"Edit ":""}Annotations for ${t.entity.name}`}else return e.jsx(ye,{width:"40%"});return t.entity.name},[s,t==null?void 0:t.entity.name,o]);return e.jsx(le,{className:"EntityMetadata",open:T,onCancel:()=>{o?(m(!0),j(()=>()=>{l(!1),d()})):d()},maxWidth:o?"md":"sm",title:J,content:W,actions:e.jsxs(e.Fragment,{children:[H,$&&P,k&&K,G&&U,F&&L]})})}try{V.displayName="EntityModal",V.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"((isInEditMode: boolean) => void)"}}}}}catch{}export{V as E,g};
