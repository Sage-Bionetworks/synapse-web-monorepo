import{j as r}from"./jsx-runtime-DoxjgJx5.js";import{d as xe}from"./DeleteTwoTone-Dtqgjh91.js";import{b as R,y as ke,n as Se,f as Ce,_ as Ee,d as je,a as _e,i as we}from"./createTheme-BIBP8v0l.js";import{r as We}from"./createSvgIcon-n5rVXizw.js";import{l as O,bT as Oe}from"./useFiles-DBLO8X1H.js";import{W as Pe}from"./WebhookVerificationStatus-CaCjD9x8.js";import{r as c}from"./index-Cu9bd8lq.js";import{C as Z,g as $e}from"./ConfirmationDialog-5TYM-AiD.js";import{E as Te}from"./EntityFinderModal-BwPHkkx2.js";import{F as qe}from"./EntityTree-B3ZstmbW.js";import{V as Ie}from"./Renderers-BXQqoqGZ.js";import{d as G}from"./ToastMessage-DY87F5Ez.js";import{s as Re}from"./Stack-BbdlCzXz.js";import{i as Ge}from"./isMuiElement-yx-QWTmT.js";import{a as Ne,c as De,s as Fe,u as Ve}from"./styled-DKRXvDfM.js";import{T as N}from"./Typography-D6GCV-CB.js";import{T as X}from"./TextField-BM400Yg9.js";import{I as Be}from"./IconButton-DhHKwBf8.js";import{F as le}from"./FormControlLabel-CARkfAdu.js";import{S as Ae}from"./Switch-SQoC4RCk.js";import{I as ce}from"./InputLabel-RHZu0c3g.js";import{F as Me}from"./FormGroup-FbDq9HHm.js";import{C as Le}from"./Checkbox-BnrBea29.js";import{a as Ue}from"./ThemesPlot-DxPlpj8X.js";import{B as Qe}from"./Button-j3jTttn9.js";import{A as ee}from"./Alert-B6PGsAkP.js";import{L as ue}from"./Link-DPsc3TBb.js";import{B as Ke}from"./Box-Bt_N9PQN.js";import{u as D}from"./utils-BECe8vEQ.js";import{u as F}from"./useMutation-BUHlmdy0.js";import{u as ze}from"./useInfiniteQuery-ciU81HfL.js";const Ye=(e,o)=>e.filter(t=>o.includes(t)),P=(e,o,t)=>{const n=e.keys[0];Array.isArray(o)?o.forEach((s,i)=>{t((a,l)=>{i<=e.keys.length-1&&(i===0?Object.assign(a,l):a[e.up(e.keys[i])]=l)},s)}):o&&typeof o=="object"?(Object.keys(o).length>e.keys.length?e.keys:Ye(e.keys,Object.keys(o))).forEach(i=>{if(e.keys.indexOf(i)!==-1){const a=o[i];a!==void 0&&t((l,f)=>{n===i?Object.assign(l,f):l[e.up(i)]=f},a)}}):(typeof o=="number"||typeof o=="string")&&t((s,i)=>{Object.assign(s,i)},o)};function h(e){return e?`Level${e}`:""}function V(e){return e.unstable_level>0&&e.container}function pe(e){return function(t){return`var(--Grid-${t}Spacing${h(e.unstable_level)})`}}function oe(e){return function(t){return e.unstable_level===0?`var(--Grid-${t}Spacing)`:`var(--Grid-${t}Spacing${h(e.unstable_level-1)})`}}function te(e){return e.unstable_level===0?"var(--Grid-columns)":`var(--Grid-columns${h(e.unstable_level-1)})`}const He=({theme:e,ownerState:o})=>{const t=pe(o),n={};return P(e.breakpoints,o.gridSize,(s,i)=>{let a={};i===!0&&(a={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(a={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / ${te(o)}${V(o)?` + ${t("column")}`:""})`}),s(n,a)}),n},Je=({theme:e,ownerState:o})=>{const t={};return P(e.breakpoints,o.gridOffset,(n,s)=>{let i={};s==="auto"&&(i={marginLeft:"auto"}),typeof s=="number"&&(i={marginLeft:s===0?"0px":`calc(100% * ${s} / ${te(o)})`}),n(t,i)}),t},Ze=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=V(o)?{[`--Grid-columns${h(o.unstable_level)}`]:te(o)}:{"--Grid-columns":12};return P(e.breakpoints,o.columns,(n,s)=>{n(t,{[`--Grid-columns${h(o.unstable_level)}`]:s})}),t},Xe=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=oe(o),n=V(o)?{[`--Grid-rowSpacing${h(o.unstable_level)}`]:t("row")}:{};return P(e.breakpoints,o.rowSpacing,(s,i)=>{var a;s(n,{[`--Grid-rowSpacing${h(o.unstable_level)}`]:typeof i=="string"?i:(a=e.spacing)==null?void 0:a.call(e,i)})}),n},eo=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=oe(o),n=V(o)?{[`--Grid-columnSpacing${h(o.unstable_level)}`]:t("column")}:{};return P(e.breakpoints,o.columnSpacing,(s,i)=>{var a;s(n,{[`--Grid-columnSpacing${h(o.unstable_level)}`]:typeof i=="string"?i:(a=e.spacing)==null?void 0:a.call(e,i)})}),n},oo=({theme:e,ownerState:o})=>{if(!o.container)return{};const t={};return P(e.breakpoints,o.direction,(n,s)=>{n(t,{flexDirection:s})}),t},to=({ownerState:e})=>{const o=pe(e),t=oe(e);return R({minWidth:0,boxSizing:"border-box"},e.container&&R({display:"flex",flexWrap:"wrap"},e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},{margin:`calc(${o("row")} / -2) calc(${o("column")} / -2)`},e.disableEqualOverflow&&{margin:`calc(${o("row")} * -1) 0px 0px calc(${o("column")} * -1)`}),(!e.container||V(e))&&R({padding:`calc(${t("row")} / 2) calc(${t("column")} / 2)`},(e.disableEqualOverflow||e.parentDisableEqualOverflow)&&{padding:`${t("row")} 0px 0px ${t("column")}`}))},no=e=>{const o=[];return Object.entries(e).forEach(([t,n])=>{n!==!1&&n!==void 0&&o.push(`grid-${t}-${String(n)}`)}),o},ro=(e,o="xs")=>{function t(n){return n===void 0?!1:typeof n=="string"&&!Number.isNaN(Number(n))||typeof n=="number"&&n>0}if(t(e))return[`spacing-${o}-${String(e)}`];if(typeof e=="object"&&!Array.isArray(e)){const n=[];return Object.entries(e).forEach(([s,i])=>{t(i)&&n.push(`spacing-${s}-${String(i)}`)}),n}return[]},so=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([o,t])=>`direction-${o}-${t}`):[`direction-xs-${String(e)}`],io=["className","children","columns","container","component","direction","wrap","spacing","rowSpacing","columnSpacing","disableEqualOverflow","unstable_level"],ao=ke(),lo=Re("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,o)=>o.root});function co(e){return Ne({props:e,name:"MuiGrid",defaultTheme:ao})}function uo(e={}){const{createStyledComponent:o=lo,useThemeProps:t=co,componentName:n="MuiGrid"}=e,s=c.createContext(void 0),i=(f,u)=>{const{container:k,direction:y,spacing:S,wrap:C,gridSize:b}=f,E={root:["root",k&&"container",C!=="wrap"&&`wrap-xs-${String(C)}`,...so(y),...no(b),...k?ro(S,u.breakpoints.keys[0]):[]]};return De(E,g=>_e(n,g),{})},a=o(Ze,eo,Xe,He,oo,to,Je),l=c.forwardRef(function(u,k){var y,S,C,b,E,g,B,A;const $=Se(),Q=t(u),T=Ce(Q),j=c.useContext(s),{className:K,children:M,columns:L=12,container:U=!1,component:v="div",direction:z="row",wrap:Y="wrap",spacing:_=0,rowSpacing:H=_,columnSpacing:d=_,disableEqualOverflow:q,unstable_level:m=0}=T,I=Ee(T,io);let x=q;m&&q!==void 0&&(x=u.disableEqualOverflow);const re={},se={},ie={};Object.entries(I).forEach(([p,w])=>{$.breakpoints.values[p]!==void 0?re[p]=w:$.breakpoints.values[p.replace("Offset","")]!==void 0?se[p.replace("Offset","")]=w:ie[p]=w});const he=(y=u.columns)!=null?y:m?void 0:L,ye=(S=u.spacing)!=null?S:m?void 0:_,be=(C=(b=u.rowSpacing)!=null?b:u.spacing)!=null?C:m?void 0:H,ge=(E=(g=u.columnSpacing)!=null?g:u.spacing)!=null?E:m?void 0:d,ae=R({},T,{level:m,columns:he,container:U,direction:z,wrap:Y,spacing:ye,rowSpacing:be,columnSpacing:ge,gridSize:re,gridOffset:se,disableEqualOverflow:(B=(A=x)!=null?A:j)!=null?B:!1,parentDisableEqualOverflow:j}),ve=i(ae,$);let J=r.jsx(a,R({ref:k,as:v,ownerState:ae,className:je(ve.root,K)},ie,{children:c.Children.map(M,p=>{if(c.isValidElement(p)&&Ge(p,["Grid"])){var w;return c.cloneElement(p,{unstable_level:(w=p.props.unstable_level)!=null?w:m+1})}return p})}));return x!==void 0&&x!==(j??!1)&&(J=r.jsx(s.Provider,{value:x,children:J})),J});return l.muiName="Grid",l}const W=uo({createStyledComponent:Fe("div",{name:"MuiGrid2",slot:"Root",overridesResolver:(e,o)=>o.root}),componentName:"MuiGrid2",useThemeProps:e=>Ve({props:e,name:"MuiGrid2"})}),fo={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE"},po={ENTITY:"ENTITY"};function tt(e){const{synapseClient:o,keyFactory:t}=O();return ze({...e,initialPageParam:void 0,queryKey:t.getWebhooksQueryKey(),queryFn:async n=>o.webhookServicesClient.postRepoV1WebhookList({listUserWebhooksRequest:{nextPageToken:n.pageParam}}),getNextPageParam:n=>n.nextPageToken})}function mo(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.postRepoV1Webhook({createOrUpdateWebhookRequest:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function ho(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.putRepoV1WebhookWebhookId(s),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function yo(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.deleteRepoV1WebhookWebhookId({webhookId:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function bo(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.postRepoV1WebhookWebhookIdVerify(s),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function nt(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.putRepoV1WebhookWebhookIdVerificationCode({webhookId:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()})}})}var ne={},go=we;Object.defineProperty(ne,"__esModule",{value:!0});var me=ne.default=void 0,vo=go(We()),xo=r;me=ne.default=(0,vo.default)((0,xo.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"SearchOutlined");const ko=encodeURIComponent("Request to add new domain for webhook verification"),So=encodeURIComponent("<Please provide the domain(s) you wish to use and any additional details related to your request.>"),Co=`https://sagebionetworks.jira.com/servicedesk/customer/portal/9/group/16/create/85?summary=${ko}&description=${So}`;function Eo(e){return r.jsxs(Ke,{sx:{backgroundColor:"rgb(178, 36, 42, 0.03)"},mt:"10px",py:2,px:4,children:[r.jsx(N,{sx:{my:1},color:"error",variant:"headline3",gutterBottom:!0,children:"DANGER ZONE"}),r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Editing the following information will require you to re-verify the webhook."}),e.children]})}function de(e){const{initialData:o,open:t,onClose:n}=e,s=po.ENTITY,[i,a]=c.useState(""),[l,f]=c.useState(new Set),[u,k]=c.useState(""),[y,S]=c.useState(!0);c.useEffect(()=>{a((o==null?void 0:o.objectId)||""),f(new Set((o==null?void 0:o.eventTypes)||[])),k((o==null?void 0:o.invokeEndpoint)||""),S((o==null?void 0:o.isEnabled)??!0)},[o]);const[C,b]=c.useState(!1),[E,g]=c.useState(!1),{mutate:B,isPending:A,error:$}=mo({onSuccess:()=>{G("Webhook created","success"),n()}}),{mutate:Q,isPending:T,error:j}=ho({onSuccess:()=>{G("Webhook updated","success"),n()}}),{mutate:K,isPending:M,error:L}=yo({onSuccess:()=>{G("Webhook deleted","info"),g(!1),n()}}),U=A||T,v=$||j;function z(){o?Q({webhookId:o.id,createOrUpdateWebhookRequest:{objectType:s,objectId:i,eventTypes:l,invokeEndpoint:u,isEnabled:y}}):B({objectType:s,objectId:i,eventTypes:l,invokeEndpoint:u,isEnabled:y})}function Y(){o&&K(o.id)}const _=v&&v.errorResponse&&"errorCode"in v.errorResponse&&v.errorResponse.errorCode===Oe.UNSUPPORTED_WEBHOOK_DOMAIN,H=o&&o.verificationStatus===Pe.VERIFIED?Eo:c.Fragment;return r.jsx(Z,{open:t,title:"Create New Webhook",maxWidth:"md",onCancel:n,onConfirm:()=>{z()},confirmButtonProps:{children:`${o?"Update":"Create"} Webhook`,disabled:U},cancelButtonProps:{disabled:U},content:r.jsxs(r.Fragment,{children:[r.jsxs(W,{container:!0,spacing:2,children:[r.jsx(W,{xs:12,children:r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Specify the ID of the entity and the types of events you would like to receive. Once you complete this step, Synapse will send a verification code to the endpoint you specify. After you verify your webhook, Synapse will send your chosen events to the verified endpoint."})}),r.jsxs(W,{xs:12,md:6,children:[r.jsx(Te,{configuration:{initialScope:qe.ALL_PROJECTS,initialContainer:"root",selectMultiple:!1,treeOnly:!1,versionSelection:Ie.DISALLOWED},show:C,onCancel:()=>{b(!1)},title:"Select item for Webhook",promptCopy:"Select an item to associate with the webhook. The webhook can be used to receive programmatic alerts when the item is updated.",onConfirm:d=>{a(d[0].targetId),b(!1)},confirmButtonCopy:"Select"}),r.jsx(X,{required:!0,label:r.jsxs(r.Fragment,{children:["Entity ID",r.jsx($e,{containerSx:{position:"fixed",ml:"15px",fontSize:"12px"},markdownText:"The ID of a Synapse entity for which to receive events. For folders and projects, matching events are published to the webhook endpoint for any entity in their hierarchy."})]}),type:"text",fullWidth:!0,value:i,onChange:d=>{a(d.target.value)},InputProps:{endAdornment:r.jsx(Be,{onClick:()=>b(!0),children:r.jsx(me,{})})}})]}),r.jsx(W,{xs:6,children:r.jsx(le,{control:r.jsx(Ae,{}),labelPlacement:"top",label:r.jsx(ce,{children:"Enabled"}),checked:y,onChange:(d,q)=>{S(q)}})}),r.jsx(W,{xs:12,md:6,children:r.jsxs(Me,{children:[r.jsx(ce,{required:!0,children:"Events"}),Object.values(fo).map(d=>r.jsx(le,{control:r.jsx(Le,{}),label:Ue(d.toLowerCase()),checked:l.has(d),onChange:(q,m)=>{f(I=>{if(m){const x=new Set(I);return x.add(d),x}else return I.delete(d),new Set(I)})}},d))]})}),r.jsx(W,{xs:12,children:r.jsxs(H,{children:[r.jsx(X,{label:"Endpoint",fullWidth:!0,value:u,onChange:d=>k(d.target.value),required:!0,placeholder:"https://"}),o&&r.jsxs(r.Fragment,{children:[r.jsx(Qe,{onClick:()=>{g(!0)},color:"error",variant:"outlined",startIcon:r.jsx(xe,{}),sx:{my:2},children:"Delete Webhook"}),r.jsx(Z,{title:"Confirm Delete Webhook?",onCancel:()=>g(!1),open:E,content:r.jsxs(r.Fragment,{children:[r.jsx(N,{variant:"body1",children:"Are you sure you want to delete this webhook? This action cannot be undone."}),L&&r.jsx(ee,{severity:"error",sx:{mt:2},children:L.reason})]}),onConfirm:()=>{Y()},confirmButtonProps:{children:"Delete",color:"error",disabled:M},cancelButtonProps:{disabled:M}})]})]})})]}),v&&r.jsxs(ee,{severity:"error",sx:{my:2},children:[_&&r.jsxs(r.Fragment,{children:["Synapse only permits configuring webhooks on verified domains, which are specified in the"," ",r.jsx(ue,{href:"https://rest-docs.synapse.org/rest/index.html#org.sagebionetworks.repo.web.controller.WebhookController",target:"_blank",children:"REST documentation"}),". You have entered a domain that has not been verified."," ",r.jsx(ue,{href:Co,target:"_blank",children:"Please fill out this form to request verification for your webhook domain"}),"."]}),!_&&v.reason]})]})})}try{de.displayName="CreateWebhookModal",de.__docgenInfo={description:"",displayName:"CreateWebhookModal",props:{initialData:{defaultValue:null,description:"",name:"initialData",required:!1,type:{name:"Webhook"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}function fe(e){const{open:o,onClose:t}=e,[n,s]=c.useState(""),{mutate:i,isPending:a,error:l}=bo({onSuccess:f=>{f.isValid?G("Webhook verified","success"):G(`Webhook was not verified: ${f.invalidReason}`,"danger"),t()}});return r.jsx(Z,{title:"Verify Webhook",onCancel:()=>{a||t()},open:o,content:r.jsxs(r.Fragment,{children:[r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Enter the code sent to your webhook to verify it. Once the webhook has been verified, Synapse will start sending the events you chose to your webhook endpoint."}),r.jsx(X,{label:"Verification code",value:n,onChange:f=>s(f.target.value),sx:{mt:1}}),l&&r.jsx(ee,{severity:"error",sx:{mt:2},children:l.reason})]}),onConfirm:()=>{i({webhookId:e.webhookId,verifyWebhookRequest:{verificationCode:n}})},confirmButtonProps:{children:"Verify",disabled:a},cancelButtonProps:{disabled:a}})}try{fe.displayName="WebhookVerificationDialog",fe.__docgenInfo={description:"",displayName:"WebhookVerificationDialog",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},webhookId:{defaultValue:null,description:"",name:"webhookId",required:!0,type:{name:"string"}}}}}catch{}export{de as C,po as S,fe as W,nt as a,tt as u};
