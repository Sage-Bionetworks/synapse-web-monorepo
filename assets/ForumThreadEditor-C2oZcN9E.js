import{aH as m,an as c,aI as g,aa as d,hF as V,am as _,r as R,j as o,V as b,c6 as U}from"./iframe-CmoSAPSB.js";import{u as A}from"./useInfiniteQuery-apdbL5yC.js";import{g as B}from"./InfiniteQueryUtils-CKlRW-xB.js";import{c as N,d as G,e as H}from"./useThread-DkTtkY5K.js";import{C as W,a as z}from"./ConfirmationDialog-DzbbPL6e.js";import{M as O}from"./MarkdownEditor-DwykSZwA.js";function se(t,n,i,a,e,s){const{accessToken:r,keyFactory:y}=c();return A({...s,queryKey:y.getRepliesQueryKey(t,n,i,a,e),queryFn:async l=>d.getReplies(r,t,i,l.pageParam,a,n,e),initialPageParam:void 0,getNextPageParam:B})}function ne(t,n){const{accessToken:i,keyFactory:a}=c(),e=async()=>{const s=await d.getReplyMessageUrl(t.messageKey,i);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return _({...n,queryKey:a.getReplyQueryKey(t.threadId,t.id,t.messageKey),queryFn:e})}function J(t){const n=m(),{accessToken:i,keyFactory:a}=c();return g({...t,mutationFn:e=>d.postReply(e,i),onSuccess:async(e,s,r)=>{await Promise.all([n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(e.threadId)}),n.invalidateQueries({queryKey:a.getSubscribersQueryKey(e.threadId,V.THREAD)})]),t?.onSuccess&&await t.onSuccess(e,s,r)}})}function L(t){const n=m(),{accessToken:i,keyFactory:a}=c();return g({...t,mutationFn:e=>d.putReply(e,i),onSuccess:async(e,s,r)=>{await n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(e.threadId)}),t?.onSuccess&&await t.onSuccess(e,s,r)}})}function ie(t){const n=m(),{accessToken:i,keyFactory:a}=c();return g({...t,mutationFn:e=>d.deleteReply(i,e.replyId),onSuccess:async(e,s,r)=>{await n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(s.threadId)}),t?.onSuccess&&await t.onSuccess(e,s,r)}})}function C(t){const{initialText:n,initialTitle:i,id:a,onClose:e,isReply:s,isDialog:r,openDialog:y}=t,[l,S]=R.useState(i??""),[p,q]=R.useState(n??""),{mutate:I,isPending:F}=N({onSuccess:()=>e()}),{mutate:k,isPending:K}=G({onSuccess:()=>e()}),{mutate:Q,isPending:j}=H({onSuccess:()=>e()}),{mutate:w,isPending:E}=J({onSuccess:()=>e()}),{mutate:v,isPending:M}=L({onSuccess:()=>e()}),D=K||E||j||F||M,f=!s&&i,h=(u,P)=>{s?n?v({replyId:a,messageMarkdown:u}):w({threadId:a,messageMarkdown:u}):f?(I({title:P,threadId:a}),k({messageMarkdown:u,threadId:a})):Q({forumId:a,title:P,messageMarkdown:u})},T=o.jsxs("div",{children:[!s&&o.jsx(U,{fullWidth:!0,sx:{my:1},placeholder:"Title",value:l,onChange:u=>S(u.target.value)}),o.jsx(O,{placeholder:"Write a reply...",text:p,setText:q})]}),x=D?"Saving":"Post";return o.jsx(o.Fragment,{children:r?o.jsx(W,{maxWidth:"md",open:y,onCancel:e,title:s?"Edit Reply":f?"Edit Thread":"New Thread",content:T,onConfirm:()=>h(p,l),confirmButtonProps:{children:x}}):o.jsxs(o.Fragment,{children:[T,o.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",gap:1,my:1},children:o.jsx(z,{onCancel:e,onConfirm:()=>h(p,l),confirmButtonProps:{children:x}})})]})})}try{C.displayName="ForumThreadEditor",C.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{C as F,ie as a,se as b,ne as u};
