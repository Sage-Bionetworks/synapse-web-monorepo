import{an as T,am as K,aH as $,aI as Y,aa as S,as as H,hf as V,r as h,j as e,c4 as w,hZ as C,X as o,_ as v,dH as J,dG as X,B as z,V as _,by as E,c1 as Z,J as P}from"./iframe-BUOdsTSh.js";import{d as W,e as ee}from"./useUserBundle-CTHXD_uI.js";import{M as se}from"./MarkdownPopover-Di4SlQgS.js";import"./SkeletonButton-ByACKKgg.js";import"./SkeletonInlineBlock-BZZZqUCg.js";import{S as te}from"./SkeletonTable-CSizy4er.js";import{S as ne}from"./SkeletonParagraph-DiZBwklZ.js";import{C as q}from"./CertificationAnswer-D_DpWiLd.js";import"./index-r8ZA1smB.js";import"./useSuspenseQuery-BjDE67iy.js";import"./LightTooltip-Da_PEhJu.js";import"./MarkdownSynapse-DqCsA8Jf.js";const re="org.sagebionetworks.repo.model.quiz.MultichoiceResponse";function ie(t="",i){const{accessToken:r,keyFactory:l}=T();return K({...i,queryKey:l.getPassingRecordQueryKey(t),queryFn:()=>S.getPassingRecord(t,r)})}function ae(t){const i=$(),{accessToken:r,keyFactory:l}=T(),{data:m}=W();return Y({...t,mutationFn:d=>S.postCertifiedUserTestResponse(r,d),onSuccess:async(d,x,g)=>{await Promise.all([i.invalidateQueries({queryKey:l.getPassingRecordQueryKey(m==null?void 0:m.ownerId)}),i.invalidateQueries({queryKey:l.getUserBundleQueryKey("current",H)})]),t!=null&&t.onSuccess&&await t.onSuccess(d,x,g)}})}function oe(){var b;const{accessToken:t}=T(),i=V(),[r,l]=h.useState(),[m,d]=h.useState(!1),[x,g]=h.useState([]),{data:u}=ee(H),f=u==null?void 0:u.isCertified,k=u==null?void 0:u.userId,{data:n,isLoading:L}=ie(k,{enabled:k!==void 0}),R=h.useRef(null),D="https://help.synapse.org/docs/Getting-Started.2055471150.html",Q=async()=>{try{l(await S.getCertifyQuiz(t))}catch(s){i(s)}},{mutate:M,isPending:O}=ae({onSuccess:()=>{d(!1),window.scrollTo(0,0)},throwOnError:!0}),j=!f&&(n==null||m);if(h.useEffect(()=>{t&&Q()},[t]),L||r==null)return e.jsx(ce,{});const U=(s,a)=>{const p=[...x.filter(c=>c.questionIndex!==s),{questionIndex:s,answerIndex:[a],concreteType:re}];g(p)},I=()=>{var s;(s=R.current)==null||s.reset(),d(!0),g([]),Q()},A=()=>{try{if(r&&r.questions.length===x.length){const s={quizId:r.id,questionResponses:x};M(s)}else P("Please answer all of the questions and try again.","warning")}catch(s){P(s.reason,"danger")}},G=s=>s?{content:e.jsx(e.Fragment,{children:"More info"}),closePopoverOnClick:!0,onClick:()=>window.open(s,"_blank"),color:"primary"}:void 0;return e.jsxs("div",{children:[n&&!j&&e.jsxs(e.Fragment,{children:[(n.revokedOn||n.passed)&&!f&&e.jsxs(w,{severity:"error",children:[!n.passed&&e.jsx(C,{children:"Certification Revoked"}),e.jsxs(o,{variant:"body1",sx:{marginTop:"5px"},children:["Your certification was revoked. To become certified, you must"," ",e.jsx(v,{href:"#",onClick:s=>{s.preventDefault(),I()},children:"retake the quiz"}),"."]})]}),!n.passed&&!f&&e.jsxs(w,{severity:"error",children:[!n.passed&&e.jsx(C,{children:"Quiz Failed"}),e.jsxs(o,{variant:"body1",sx:{marginTop:"5px"},children:["Please review the results from the previous attempt, and"," ",e.jsx(v,{href:"#",onClick:s=>{s.preventDefault(),I()},children:"retake the quiz"}),"."]})]}),n.passed&&f&&e.jsxs(w,{severity:"success",children:[e.jsx(C,{children:"Quiz Passed"}),e.jsx(o,{variant:"body1",sx:{marginTop:"5px"},children:`You passed the Synapse Certification Quiz on ${J(X(n.passedOn))}`})]}),e.jsxs(o,{variant:"sectionTitle",sx:{marginTop:"20px",marginBottom:"20px"},children:["Score: ",n.score," / ",(b=n.corrections)==null?void 0:b.length]})]}),e.jsxs("div",{className:"CertificationQuiz__container",children:[r&&j&&e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>window.open(D,"_blank"),className:"help-button",color:"primary",variant:"contained",children:e.jsxs(_,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px",color:"white"}}),e.jsx(e.Fragment,{children:"Help"})]})}),e.jsx(o,{variant:"headline1",sx:{marginBottom:"25px"},children:"Certified User Quiz"}),e.jsx(o,{variant:"body1",sx:{marginBottom:"15px"},children:"Certified users are authorized to use the full Synapse functionality. In order to ensure that users who create content in the system and/or wish to interact more freely within Synapse are familiar with the governance process and Synapse operating procedures when dealing with possibly sensitive data, users must pass a short quiz (approximately 15 minutes) to become Synapse certified."}),e.jsx(o,{variant:"body1",sx:{marginBottom:"15px"},children:"Please answer the following questions to become certified."}),e.jsx("form",{ref:R,onSubmit:s=>s.preventDefault(),children:e.jsx("ol",{children:r==null?void 0:r.questions.map(s=>{const a=s.helpText||s.docLink;return e.jsxs("li",{role:s.exclusive?"radiogroup":void 0,children:[e.jsx(o,{variant:"headline3",dangerouslySetInnerHTML:{__html:s.prompt},sx:{marginTop:"40px",marginBottom:"10px"}}),s.answers.map(p=>e.jsx(q,{question:s,answer:p,onClick:c=>U(s.questionIndex,Number(c.currentTarget.value))},`${s.questionIndex}-${p.answerIndex}`)),a&&e.jsx(se,{contentProps:{markdown:s.helpText},placement:"right",sx:{table:{textAlign:"center",th:{padding:"5px"}}},actionButton:G(s.docLink),showCloseButton:!0,children:e.jsxs(_,{sx:{display:"flex",alignItems:"center",marginTop:"10px"},children:[e.jsx(E,{className:"HelpButton",style:{marginRight:"4px"}}),e.jsx(v,{children:"Need help answering this question?"})]})})]},s.questionIndex)})})}),e.jsx(z,{className:"help-button",color:"primary",variant:"contained",size:"large",disabled:O,onClick:()=>{A()},children:"Submit"})]}),!j&&(n==null?void 0:n.corrections)&&e.jsx("ol",{children:n.corrections.map(s=>{const a=s.question,p=s.response;return e.jsxs("li",{children:[e.jsx(o,{variant:"headline3",dangerouslySetInnerHTML:{__html:a.prompt},className:s.isCorrect?"":"incorrectQuestion",sx:{marginTop:"40px",marginBottom:"10px"}}),a.answers.map(c=>e.jsx(q,{question:a,answer:c,disabled:!0,checked:p.answerIndex.includes(c.answerIndex)},`${a.questionIndex}-${c.answerIndex}`))]},a.questionIndex)})})]})]})}function ce(){const t=[];for(let i=0;i<20;i++)t.push(e.jsx("li",{children:e.jsx(te,{numCols:1,numRows:5})},i));return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(Z,{height:"80px",width:"460px"})}),e.jsx(ne,{numRows:5}),e.jsx("div",{className:"CertificationQuiz__container",children:e.jsx("ol",{style:{marginTop:"20px"},children:t})})]})}const Ce={title:"Synapse/CertificationQuiz",component:oe},y={};var B,N,F;y.parameters={...y.parameters,docs:{...(B=y.parameters)==null?void 0:B.docs,source:{originalSource:"{}",...(F=(N=y.parameters)==null?void 0:N.docs)==null?void 0:F.source}}};const ve=["CertificationQuizDemo"];export{y as CertificationQuizDemo,ve as __namedExportsOrder,Ce as default};
