import{j as w}from"./jsx-runtime-D_zvdyIk.js";import{r as c}from"./index-BD8T7zq6.js";import{l as R,b8 as V,b9 as x,ba as k}from"./useFiles-BMNFt-8g.js";import{T as O}from"./VerificationSubmission-BDh1zA9f.js";import"./StringUtils-C95LMFI-.js";import"./OrientationBanner-DeOiH3yd.js";import{u as A}from"./useDebouncedEffect-DsgkYBe3.js";import{a as F}from"./use-deep-compare-effect.esm-CpsLIGm7.js";import{s as H,Z as L,_ as C,$ as D}from"./SynapseConstants-ruF53FsM.js";import{u as G}from"./uniq-6sjEsxlk.js";import{w as M}from"./without-CNpLK4yz.js";import{b as P}from"./_baseSlice-F8doVSIJ.js";import{t as Y}from"./toInteger-_gmo1qyA.js";import{d as q}from"./UserBadge-D8BZ6Vcd.js";import{u as j,S as B,c as _}from"./Select-aab027f3.esm-B0HpJZqt.js";import{_ as K}from"./createTheme-CTBtZ_cy.js";import"./index-C6FD6fLo.js";import{U as v}from"./UserOrTeamBadge-DrlPJAG-.js";import{u as $}from"./useTheme-CQSNJTUG.js";import{S as J}from"./Skeleton-whSO5RLo.js";var Q=Math.ceil,Z=Math.max;function W(t,e,n){e===void 0?e=1:e=Z(Y(e),0);var l=t==null?0:t.length;if(!l||e<1)return[];for(var a=0,r=0,o=Array(Q(l/e));a<l;)o[r++]=P(t,a,a+=e);return o}const X={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},z={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},ee={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},te=async(t,e)=>{const n=await x(t,e),a=t.filter(r=>n.results.map(o=>o.id).indexOf(r.targetId)===-1).map(r=>({...z,id:r.targetId,name:`${r.targetId}`}));return[...n.results,...a]},ne=async t=>{const e=(await k(t)).children,l=t.filter(a=>e.map(r=>r.ownerId).indexOf(a)===-1).map(a=>({...X,ownerId:a,name:`Unknown User (${a})`}));return[...e,...l]},re=async(t,e)=>{const n=await V({evaluationIds:t},e),a=t.filter(r=>n.results.map(o=>o.id).indexOf(r)===-1).map(r=>({...ee,id:r,name:r}));return[...n.results,...a]};function ae(t){const{ids:e,type:n}=t,{accessToken:l}=R(),[a,r]=c.useState([]),o=n==="USER_PROFILE"?"ownerId":"id",g=(u=>{switch(u){case"USER_PROFILE":return D;case"ENTITY_HEADER":return C;case"EVALUATION_QUEUE":return L;default:return""}})(n),y=a.map(u=>u[o]),p=e.filter(u=>u!==H),h=G(M(p,...y));return c.useEffect(()=>{(S=>{if(!S.length)return;const d=sessionStorage.getItem(g);try{const f=d?JSON.parse(d):[],I=f.map(i=>i[o]);for(const i of S)I.includes(i[o])||f.push(i);sessionStorage.setItem(g,JSON.stringify(f))}catch{sessionStorage.setItem(g,JSON.stringify(S))}})(a)},[a,o,g]),F(()=>{let u=!1;return(async()=>{if(h.length>0)try{const d=Array.from(h),f=n==="ENTITY_HEADER"?d.map(m=>({targetId:m})):d,I=W(f,45),i=[];for(const m of I){let E=[];switch(n){case"USER_PROFILE":E=await ne(m);break;case"ENTITY_HEADER":E=await te(m,l);break;case"EVALUATION_QUEUE":E=await re(m,l);break}i.push(...E)}u||r(m=>m.concat(...i))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{u=!0}},[l,n,h]),a}var se=c.forwardRef(function(t,e){var n=j(t);return c.createElement(B,K({ref:e},n))}),oe=se;const le={SingleValue:t=>{const{data:e}=t;return c.createElement(_.SingleValue,{...t,key:e==null?void 0:e.id},w.jsx(v,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return c.createElement(_.Option,{...t,key:e==null?void 0:e.id},w.jsx(v,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}};function b(t){const{inputId:e,defaultValue:n=null,onChange:l,filterPredicate:a,typeFilter:r,placeholder:o,focusOnSelect:U=!1,value:g}=t,{palette:y}=$(),[p,h]=c.useState(""),[u,S]=c.useState("");A(()=>{S(p)},[p],500);const[d=void 0]=ae({ids:n?[n]:[],type:"USER_PROFILE"}),f=!!u,{data:I,isLoading:i}=q(u,r,{enabled:f}),m=c.useRef(null);c.useEffect(()=>{U&&m.current&&m.current.focus()});const E=c.useMemo(()=>i||p!==u?()=>"Loadingâ€¦":void 0,[i,u,p]),T=(I??[]).filter(a??(()=>!0)).map(s=>({id:s.ownerId.toString(),value:s.ownerId.toString(),label:s.userName,header:s})),N=c.useMemo(()=>o!==void 0?o:r==O.USERS_ONLY?"Name (first and last)":r==O.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[o,r]);return n&&d==null?w.jsx(J,{width:"100%"}):w.jsx(oe,{className:"UserSearchBoxV2",ref:m,inputValue:p,onInputChange:h,filterOption:()=>!0,isLoading:i,options:!i&&T||[],noOptionsMessage:E,openMenuOnClick:!1,placeholder:N,defaultValue:n?{id:n,value:n,label:d.userName,header:d}:void 0,inputId:e,isClearable:!0,value:g,styles:{control:s=>({...s,backgroundColor:y.grey[200]}),input:s=>({...s,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:s=>({...s,zIndex:2})},components:le,onChange:s=>{l&&l((s==null?void 0:s.id)??null,(s==null?void 0:s.header)??null)}})}try{b.displayName="UserSearchBoxV2",b.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"(principalId: string, header: UserGroupHeader) => void"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"(item: UserGroupHeader) => boolean"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<{ id: string; value: string; label: string; header: UserGroupHeader; }>"}}}}}catch{}export{oe as S,b as U,W as c,ae as u};
