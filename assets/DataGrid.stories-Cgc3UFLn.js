var $l=Object.defineProperty;var Ul=(n,d,g)=>d in n?$l(n,d,{enumerable:!0,configurable:!0,writable:!0,value:g}):n[d]=g;var et=(n,d,g)=>Ul(n,typeof d!="symbol"?d+"":d,g);import{j as me}from"./jsx-runtime-D_zvdyIk.js";import{b as he,r as K}from"./index-BYTlLpU9.js";import{d as je,a as ka}from"./iframe-BKid-lRK.js";import{r as Ll}from"./index-BAySunq4.js";import{r as Ma}from"./index-C148XJoK.js";import{r as Fl}from"./index-BHvWQWGH.js";import{r as Vt}from"./index-LvzHWtTh.js";import{l as Aa}from"./useFiles-BvyRTXkx.js";import{u as zl}from"./useMutation-7NzcGZE3.js";import{w as Wl}from"./waitForAsyncResult-P7HUkBTt.js";import{t as Gl}from"./tslib.es6-Bipx4pcW.js";import{i as Pa}from"./_Uint8Array-xFXqFFYz.js";import{r as Jl}from"./isArray-Dim04xSh.js";import{t as $i}from"./toNumber-CZfILk0R.js";import{n as Tr}from"./useQuery-xk0So2qB.js";import"./VerificationSubmission-NmfK1W18.js";import"./SynapseConstants-pVgLh2WD.js";import"./OrientationBanner-DqCjCNEW.js";import"./index-DlQmQoJz.js";import"./spreadSx-CwcO6WA9.js";import"./react-DEUk6uJr.js";import"./FullWidthAlert-DLLPpbcN.js";import"./Alert-DN5hf0MM.js";import"./createTheme-C2WVS9AW.js";import"./DefaultPropsProvider-Dze3MY1J.js";import"./useSlot-DhXDWeRj.js";import"./useForkRef-I4T1u_0p.js";import"./createSimplePaletteValueFilter-BClAKmko.js";import"./createSvgIcon-BMvZ7oXn.js";import"./Close-B4WzIeG2.js";import"./IconButton-3lKaiqot.js";import"./useTimeout-5QYkjsCW.js";import"./ButtonBase-B3L_VbRY.js";import"./isFocusVisible-B8k4qzLc.js";import"./CircularProgress-C2on9yNq.js";import"./Paper-C5KijNv9.js";import"./useTheme-B3ETyTW4.js";import"./useTheme-BXs8ghRm.js";import"./Stack-lGKypZky.js";import"./extendSxProp-hAnljuIT.js";import"./getThemeProps-CmsihZNb.js";import"./Box-C4s19pAM.js";import"./AlertTitle-BBLd9HvD.js";import"./Typography-CNMx-WpY.js";import"./index-DNfsT4bF.js";import"./ClickAwayListener-KNw01Chz.js";import"./getReactElementRef-DL4umzvE.js";import"./ownerDocument-DW-IO8s5.js";import"./Grow-S4wEu2q4.js";import"./Tooltip-BfCBVAo0.js";import"./index-r6UZXaqk.js";import"./useControlled-CVqp7PLm.js";import"./Popper-CcW7sw4B.js";import"./Button-ClULhOKL.js";import"./fetchWithExponentialTimeout-CXmnpl-T.js";import"./StringUtils-Dsx1COFf.js";import"./Link-DpIdHsj4.js";import"./Collapse-CwN0BiGZ.js";import"./_baseUniq-BV2fBIfC.js";import"./_getTag-DT5pSQEx.js";import"./isEqual-B3UZDxYF.js";import"./merge--HaAKor2.js";import"./_initCloneObject-BHhvY9wg.js";import"./identity-DKeuBCMA.js";import"./tinycolor-Begke6kS.js";import"./Fade-DHTUk004.js";import"./inputBaseClasses-Bs_Q9F2g.js";import"./calculateFriendlyFileSize-DzlXv0C9.js";import"./CheckCircleTwoTone-Ifw1IDko.js";import"./InfoTwoTone-puvntKUh.js";import"./QueryClientProvider-BtqaYAAi.js";import"./dayjs.min-Bc1Mhefl.js";import"./chunk-AYJ5UCUI-CBzP6w0d.js";import"./cloneDeep-DD3Zj_Oy.js";import"./Skeleton-MT-LmfX5.js";import"./isSymbol-BgwjKJag.js";var kr=function(){return Jl.Date.now()},Kl="Expected a function",Hl=Math.max,Xl=Math.min;function Yl(n,d,g){var f,i,a,l,o,e,t=0,r=!1,s=!1,u=!0;if(typeof n!="function")throw new TypeError(Kl);d=$i(d)||0,Pa(g)&&(r=!!g.leading,s="maxWait"in g,a=s?Hl($i(g.maxWait)||0,d):a,u="trailing"in g?!!g.trailing:u);function v(O){var x=f,C=i;return f=i=void 0,t=O,l=n.apply(C,x),l}function w(O){return t=O,o=setTimeout(c,d),r?v(O):l}function b(O){var x=O-e,C=O-t,R=d-x;return s?Xl(R,a-C):R}function h(O){var x=O-e,C=O-t;return e===void 0||x>=d||x<0||s&&C>=a}function c(){var O=kr();if(h(O))return p(O);o=setTimeout(c,b(O))}function p(O){return o=void 0,u&&f?v(O):(f=i=void 0,l)}function m(){o!==void 0&&clearTimeout(o),t=0,f=e=i=o=void 0}function _(){return o===void 0?l:p(kr())}function y(){var O=kr(),x=h(O);if(f=arguments,i=this,e=O,x){if(o===void 0)return w(e);if(s)return clearTimeout(o),o=setTimeout(c,d),v(e)}return o===void 0&&(o=setTimeout(c,d)),l}return y.cancel=m,y.flush=_,y}var Ql="Expected a function";function Zl(n,d,g){var f=!0,i=!0;if(typeof n!="function")throw new TypeError(Ql);return Pa(g)&&(f="leading"in g?!!g.leading:f,i="trailing"in g?!!g.trailing:i),Yl(n,d,{leading:f,maxWait:d,trailing:i})}var Mr={},Pe={},Ar={},Ui;function ec(){return Ui||(Ui=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useColumnWidths=n.getColumnWidths=void 0;const d=he(),g=(i,a)=>{const l=a.map(({basis:e,minWidth:t,maxWidth:r})=>({basis:e,minWidth:t,maxWidth:r,size:e,violation:0,frozen:!1,factor:0}));let o=l.reduce((e,t)=>e-t.size,i);o>0?a.forEach(({grow:e},t)=>{l[t].factor=e}):o<0&&a.forEach(({shrink:e},t)=>{l[t].factor=e});for(const e of l)e.factor===0&&(e.frozen=!0);for(;l.some(({frozen:e})=>!e);){const e=l.reduce((r,s)=>r+(s.frozen?0:s.factor),0);let t=0;for(const r of l)r.frozen||(r.size+=o*r.factor/e,r.size<r.minWidth?r.violation=r.minWidth-r.size:r.maxWidth!==void 0&&r.size>r.maxWidth?r.violation=r.maxWidth-r.size:r.violation=0,r.size+=r.violation,t+=r.violation);if(t>0)for(const r of l)r.violation>0&&(r.frozen=!0);else if(t<0)for(const r of l)r.violation<0&&(r.frozen=!0);else break;o=l.reduce((r,s)=>r-s.size,i)}return l.map(({size:e})=>e)};n.getColumnWidths=g;const f=(i,a)=>{const l=i.map(({basis:o,minWidth:e,maxWidth:t,grow:r,shrink:s})=>[o,e,t,r,s].join(",")).join("|");return(0,d.useMemo)(()=>{if(a===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const o=(0,n.getColumnWidths)(a,i);let e=0;const t=o.map((r,s)=>(e+=r,s===o.length-1?1/0:e));return{fullWidth:Math.abs(a-e)<.1,columnWidths:o,columnRights:t,totalWidth:e}},[a,l])};n.useColumnWidths=f}(Ar)),Ar}var mi=function(n,d){return mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,f){g.__proto__=f}||function(g,f){for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(g[i]=f[i])},mi(n,d)};function Da(n,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");mi(n,d);function g(){this.constructor=n}n.prototype=d===null?Object.create(d):(g.prototype=d.prototype,new g)}var qt=function(){return qt=Object.assign||function(d){for(var g,f=1,i=arguments.length;f<i;f++){g=arguments[f];for(var a in g)Object.prototype.hasOwnProperty.call(g,a)&&(d[a]=g[a])}return d},qt.apply(this,arguments)};function Ba(n,d){var g={};for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&d.indexOf(f)<0&&(g[f]=n[f]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,f=Object.getOwnPropertySymbols(n);i<f.length;i++)d.indexOf(f[i])<0&&Object.prototype.propertyIsEnumerable.call(n,f[i])&&(g[f[i]]=n[f[i]]);return g}var dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof je.global<"u"?je.global:typeof self<"u"?self:{};function tc(n){var d=typeof n;return n!=null&&(d=="object"||d=="function")}var yi=tc,nc=typeof dr=="object"&&dr&&dr.Object===Object&&dr,rc=nc,ic=rc,sc=typeof self=="object"&&self&&self.Object===Object&&self,oc=ic||sc||Function("return this")(),qa=oc,ac=qa,lc=function(){return ac.Date.now()},cc=lc,uc=/\s/;function dc(n){for(var d=n.length;d--&&uc.test(n.charAt(d)););return d}var fc=dc,hc=fc,pc=/^\s+/;function vc(n){return n&&n.slice(0,hc(n)+1).replace(pc,"")}var bc=vc,mc=qa,wc=mc.Symbol,Va=wc,Li=Va,$a=Object.prototype,gc=$a.hasOwnProperty,_c=$a.toString,Ft=Li?Li.toStringTag:void 0;function yc(n){var d=gc.call(n,Ft),g=n[Ft];try{n[Ft]=void 0;var f=!0}catch{}var i=_c.call(n);return f&&(d?n[Ft]=g:delete n[Ft]),i}var Oc=yc,xc=Object.prototype,Sc=xc.toString;function Cc(n){return Sc.call(n)}var Ec=Cc,Fi=Va,Nc=Oc,Rc=Ec,Ic="[object Null]",jc="[object Undefined]",zi=Fi?Fi.toStringTag:void 0;function Tc(n){return n==null?n===void 0?jc:Ic:zi&&zi in Object(n)?Nc(n):Rc(n)}var kc=Tc;function Mc(n){return n!=null&&typeof n=="object"}var Ac=Mc,Pc=kc,Dc=Ac,Bc="[object Symbol]";function qc(n){return typeof n=="symbol"||Dc(n)&&Pc(n)==Bc}var Vc=qc,$c=bc,Wi=yi,Uc=Vc,Gi=NaN,Lc=/^[-+]0x[0-9a-f]+$/i,Fc=/^0b[01]+$/i,zc=/^0o[0-7]+$/i,Wc=parseInt;function Gc(n){if(typeof n=="number")return n;if(Uc(n))return Gi;if(Wi(n)){var d=typeof n.valueOf=="function"?n.valueOf():n;n=Wi(d)?d+"":d}if(typeof n!="string")return n===0?n:+n;n=$c(n);var g=Fc.test(n);return g||zc.test(n)?Wc(n.slice(2),g?2:8):Lc.test(n)?Gi:+n}var Jc=Gc,Kc=yi,Pr=cc,Ji=Jc,Hc="Expected a function",Xc=Math.max,Yc=Math.min;function Qc(n,d,g){var f,i,a,l,o,e,t=0,r=!1,s=!1,u=!0;if(typeof n!="function")throw new TypeError(Hc);d=Ji(d)||0,Kc(g)&&(r=!!g.leading,s="maxWait"in g,a=s?Xc(Ji(g.maxWait)||0,d):a,u="trailing"in g?!!g.trailing:u);function v(O){var x=f,C=i;return f=i=void 0,t=O,l=n.apply(C,x),l}function w(O){return t=O,o=setTimeout(c,d),r?v(O):l}function b(O){var x=O-e,C=O-t,R=d-x;return s?Yc(R,a-C):R}function h(O){var x=O-e,C=O-t;return e===void 0||x>=d||x<0||s&&C>=a}function c(){var O=Pr();if(h(O))return p(O);o=setTimeout(c,b(O))}function p(O){return o=void 0,u&&f?v(O):(f=i=void 0,l)}function m(){o!==void 0&&clearTimeout(o),t=0,f=e=i=o=void 0}function _(){return o===void 0?l:p(Pr())}function y(){var O=Pr(),x=h(O);if(f=arguments,i=this,e=O,x){if(o===void 0)return w(e);if(s)return clearTimeout(o),o=setTimeout(c,d),v(e)}return o===void 0&&(o=setTimeout(c,d)),l}return y.cancel=m,y.flush=_,y}var Ua=Qc,Zc=Ua,eu=yi,tu="Expected a function";function nu(n,d,g){var f=!0,i=!0;if(typeof n!="function")throw new TypeError(tu);return eu(g)&&(f="leading"in g?!!g.leading:f,i="trailing"in g?!!g.trailing:i),Zc(n,d,{leading:f,maxWait:d,trailing:i})}var ru=nu,La=function(n,d,g,f){switch(d){case"debounce":return Ua(n,g,f);case"throttle":return ru(n,g,f);default:return n}},wi=function(n){return typeof n=="function"},ut=function(){return typeof window>"u"},Ki=function(n){return n instanceof Element||n instanceof HTMLDocument},Fa=function(n,d,g,f){return function(i){var a=i.width,l=i.height;d(function(o){return o.width===a&&o.height===l||o.width===a&&!f||o.height===l&&!g?o:(n&&wi(n)&&n(a,l),{width:a,height:l})})}},za=function(n){Da(d,n);function d(g){var f=n.call(this,g)||this;f.cancelHandler=function(){f.resizeHandler&&f.resizeHandler.cancel&&(f.resizeHandler.cancel(),f.resizeHandler=null)},f.attachObserver=function(){var t=f.props,r=t.targetRef,s=t.observerOptions;if(!ut()){r&&r.current&&(f.targetRef.current=r.current);var u=f.getElement();u&&(f.observableElement&&f.observableElement===u||(f.observableElement=u,f.resizeObserver.observe(u,s)))}},f.getElement=function(){var t=f.props,r=t.querySelector,s=t.targetDomEl;if(ut())return null;if(r)return document.querySelector(r);if(s&&Ki(s))return s;if(f.targetRef&&Ki(f.targetRef.current))return f.targetRef.current;var u=Ll.findDOMNode(f);if(!u)return null;var v=f.getRenderType();switch(v){case"renderProp":return u;case"childFunction":return u;case"child":return u;case"childArray":return u;default:return u.parentElement}},f.createResizeHandler=function(t){var r=f.props,s=r.handleWidth,u=s===void 0?!0:s,v=r.handleHeight,w=v===void 0?!0:v,b=r.onResize;if(!(!u&&!w)){var h=Fa(b,f.setState.bind(f),u,w);t.forEach(function(c){var p=c&&c.contentRect||{},m=p.width,_=p.height,y=!f.skipOnMount&&!ut();y&&h({width:m,height:_}),f.skipOnMount=!1})}},f.getRenderType=function(){var t=f.props,r=t.render,s=t.children;return wi(r)?"renderProp":wi(s)?"childFunction":K.isValidElement(s)?"child":Array.isArray(s)?"childArray":"parent"};var i=g.skipOnMount,a=g.refreshMode,l=g.refreshRate,o=l===void 0?1e3:l,e=g.refreshOptions;return f.state={width:void 0,height:void 0},f.skipOnMount=i,f.targetRef=K.createRef(),f.observableElement=null,ut()||(f.resizeHandler=La(f.createResizeHandler,a,o,e),f.resizeObserver=new window.ResizeObserver(f.resizeHandler)),f}return d.prototype.componentDidMount=function(){this.attachObserver()},d.prototype.componentDidUpdate=function(){this.attachObserver()},d.prototype.componentWillUnmount=function(){ut()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},d.prototype.render=function(){var g=this.props,f=g.render,i=g.children,a=g.nodeType,l=a===void 0?"div":a,o=this.state,e=o.width,t=o.height,r={width:e,height:t,targetRef:this.targetRef},s=this.getRenderType(),u;switch(s){case"renderProp":return f&&f(r);case"childFunction":return u=i,u(r);case"child":if(u=i,u.type&&typeof u.type=="string"){r.targetRef;var v=Ba(r,["targetRef"]);return K.cloneElement(u,v)}return K.cloneElement(u,r);case"childArray":return u=i,u.map(function(w){return!!w&&K.cloneElement(w,r)});default:return K.createElement(l,null)}},d}(K.PureComponent);function iu(n,d){d===void 0&&(d={});var g=function(a){Da(l,a);function l(){var o=a!==null&&a.apply(this,arguments)||this;return o.ref=K.createRef(),o}return l.prototype.render=function(){var o=this.props,e=o.forwardedRef,t=Ba(o,["forwardedRef"]),r=e??this.ref;return K.createElement(za,qt({},d,{targetRef:r}),K.createElement(n,qt({targetRef:r},t)))},l}(K.Component);function f(a,l){return K.createElement(g,qt({},a,{forwardedRef:l}))}var i=n.displayName||n.name;return f.displayName="withResizeDetector(".concat(i,")"),K.forwardRef(f)}var su=ut()?K.useEffect:K.useLayoutEffect;function ou(n){n===void 0&&(n={});var d=n.skipOnMount,g=d===void 0?!1:d,f=n.refreshMode,i=n.refreshRate,a=i===void 0?1e3:i,l=n.refreshOptions,o=n.handleWidth,e=o===void 0?!0:o,t=n.handleHeight,r=t===void 0?!0:t,s=n.targetRef,u=n.observerOptions,v=n.onResize,w=K.useRef(g),b=K.useRef(null),h=s??b,c=K.useRef(),p=K.useState({width:void 0,height:void 0}),m=p[0],_=p[1];return su(function(){if(!ut()){var y=Fa(v,_,e,r),O=function(C){!e&&!r||C.forEach(function(R){var D=R&&R.contentRect||{},P=D.width,V=D.height,I=!w.current&&!ut();I&&y({width:P,height:V}),w.current=!1})};c.current=La(O,f,a,l);var x=new window.ResizeObserver(c.current);return h.current&&x.observe(h.current,u),function(){x.disconnect();var C=c.current;C&&C.cancel&&C.cancel()}}},[f,a,l,e,r,v,u,h.current]),qt({ref:h},m)}const au=Object.freeze(Object.defineProperty({__proto__:null,default:za,useResizeDetector:ou,withResizeDetector:iu},Symbol.toStringTag,{value:"Module"})),lu=ka(au);var it={},Hi;function cu(){return Hi||(Hi=1,function(n){var d=it&&it.__createBinding||(Object.create?function(w,b,h,c){c===void 0&&(c=h);var p=Object.getOwnPropertyDescriptor(b,h);(!p||("get"in p?!b.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return b[h]}}),Object.defineProperty(w,c,p)}:function(w,b,h,c){c===void 0&&(c=h),w[c]=b[h]}),g=it&&it.__setModuleDefault||(Object.create?function(w,b){Object.defineProperty(w,"default",{enumerable:!0,value:b})}:function(w,b){w.default=b}),f=it&&it.__importStar||function(w){if(w&&w.__esModule)return w;var b={};if(w!=null)for(var h in w)h!=="default"&&Object.prototype.hasOwnProperty.call(w,h)&&d(b,w,h);return g(b,w),b};Object.defineProperty(n,"__esModule",{value:!0}),n.useColumns=n.parseFlexValue=void 0;const i=f(he()),a=()=>i.default.createElement(i.default.Fragment,null),l=()=>!1,o=({rowData:w})=>w,e=()=>null,t=({rowIndex:w})=>i.default.createElement(i.default.Fragment,null,w+1),r=()=>!0,s=w=>w,u=w=>{if(typeof w=="number")return{basis:0,grow:w,shrink:1};if(w.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(w.trim()),shrink:1};if(w.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(w.trim()),grow:1,shrink:1};if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[b,h]=w.trim().split(" ");return{basis:0,grow:parseFloat(b),shrink:parseFloat(h)}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,h]=w.trim().split(" ");return{basis:parseFloat(h),grow:parseFloat(b),shrink:1}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,h,c]=w.trim().split(" ");return{basis:parseFloat(c),grow:parseFloat(b),shrink:parseFloat(h)}}return{basis:0,grow:1,shrink:1}};n.parseFlexValue=u;const v=(w,b,h)=>(0,i.useMemo)(()=>{var c,p,m,_,y,O,x,C,R,D;const P=[b===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>i.default.createElement(i.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:r}:Object.assign(Object.assign({},b),{basis:(c=b==null?void 0:b.basis)!==null&&c!==void 0?c:40,grow:(p=b==null?void 0:b.grow)!==null&&p!==void 0?p:0,shrink:(m=b==null?void 0:b.shrink)!==null&&m!==void 0?m:0,minWidth:(_=b==null?void 0:b.minWidth)!==null&&_!==void 0?_:0,title:(y=b==null?void 0:b.title)!==null&&y!==void 0?y:i.default.createElement("div",{className:"dsg-corner-indicator"}),component:(O=b==null?void 0:b.component)!==null&&O!==void 0?O:t,isCellEmpty:r}),...w];return h&&P.push(Object.assign(Object.assign({},h),{basis:(x=h==null?void 0:h.basis)!==null&&x!==void 0?x:40,grow:(C=h==null?void 0:h.grow)!==null&&C!==void 0?C:0,shrink:(R=h==null?void 0:h.shrink)!==null&&R!==void 0?R:0,minWidth:(D=h.minWidth)!==null&&D!==void 0?D:0,isCellEmpty:r})),P.map(V=>{var I,Y,G,A,q,ne,Q,de,ye,oe,re,Ee,Ue,W,$,le;const we=V.width!==void 0?(0,n.parseFlexValue)(V.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},V),{basis:(Y=(I=V.basis)!==null&&I!==void 0?I:we.basis)!==null&&Y!==void 0?Y:0,grow:(A=(G=V.grow)!==null&&G!==void 0?G:we.grow)!==null&&A!==void 0?A:1,shrink:(ne=(q=V.shrink)!==null&&q!==void 0?q:we.shrink)!==null&&ne!==void 0?ne:1,minWidth:(Q=V.minWidth)!==null&&Q!==void 0?Q:100,component:(de=V.component)!==null&&de!==void 0?de:a,disableKeys:(ye=V.disableKeys)!==null&&ye!==void 0?ye:!1,disabled:(oe=V.disabled)!==null&&oe!==void 0?oe:!1,keepFocus:(re=V.keepFocus)!==null&&re!==void 0?re:!1,deleteValue:(Ee=V.deleteValue)!==null&&Ee!==void 0?Ee:o,copyValue:(Ue=V.copyValue)!==null&&Ue!==void 0?Ue:e,pasteValue:(W=V.pasteValue)!==null&&W!==void 0?W:o,prePasteValues:($=V.prePasteValues)!==null&&$!==void 0?$:s,isCellEmpty:(le=V.isCellEmpty)!==null&&le!==void 0?le:l})})},[b,h,w]);n.useColumns=v}(it)),it}var zt={},Wt={},Xi;function Oi(){if(Xi)return Wt;Xi=1,Object.defineProperty(Wt,"__esModule",{value:!0});function n(g,f,i,a){var l,o=!1,e=0;function t(){l&&clearTimeout(l)}function r(){t(),o=!0}typeof f!="boolean"&&(a=i,i=f,f=void 0);function s(){for(var u=arguments.length,v=new Array(u),w=0;w<u;w++)v[w]=arguments[w];var b=this,h=Date.now()-e;if(o)return;function c(){e=Date.now(),i.apply(b,v)}function p(){l=void 0}a&&!l&&c(),t(),a===void 0&&h>g?c():f!==!0&&(l=setTimeout(a?p:c,a===void 0?g-h:g))}return s.cancel=r,s}function d(g,f,i){return i===void 0?n(g,f,!1):n(g,i,f!==!1)}return Wt.debounce=d,Wt.throttle=n,Wt}var pt={},Yi;function Wa(){if(Yi)return pt;Yi=1;var n=pt&&pt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(pt,"__esModule",{value:!0}),pt.useDeepEqualState=void 0;const d=he(),g=n(Ma()),f=i=>{const[a,l]=(0,d.useState)(i),o=(0,d.useCallback)(e=>{l(t=>{const r=typeof e=="function"?e(t):e;return(0,g.default)(r,t)?t:r})},[l]);return[a,o]};return pt.useDeepEqualState=f,pt}var Qi;function uu(){if(Qi)return zt;Qi=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.useEdges=void 0;const n=he(),d=Oi(),g=Wa(),f=(i,a,l)=>{const[o,e]=(0,g.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,n.useEffect)(()=>{const t=(0,d.throttle)(100,()=>{var s,u,v,w,b,h,c,p,m,_;e({top:((s=i.current)===null||s===void 0?void 0:s.scrollTop)===0,right:((v=(u=i.current)===null||u===void 0?void 0:u.scrollLeft)!==null&&v!==void 0?v:0)>=((b=(w=i.current)===null||w===void 0?void 0:w.scrollWidth)!==null&&b!==void 0?b:0)-(a??0)-1,bottom:((c=(h=i.current)===null||h===void 0?void 0:h.scrollTop)!==null&&c!==void 0?c:0)>=((m=(p=i.current)===null||p===void 0?void 0:p.scrollHeight)!==null&&m!==void 0?m:0)-(l??0)-1,left:((_=i.current)===null||_===void 0?void 0:_.scrollLeft)===0})}),r=i.current;return r==null||r.addEventListener("scroll",t),setTimeout(t,100),()=>{r==null||r.removeEventListener("scroll",t),t.cancel()}},[l,a,i,e]),o};return zt.useEdges=f,zt}var Gt={},Zi;function Ga(){if(Zi)return Gt;Zi=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.useDocumentEventListener=void 0;const n=he(),d=(g,f)=>{(0,n.useEffect)(()=>(document.addEventListener(g,f),()=>{document.removeEventListener(g,f)}),[f,g])};return Gt.useDocumentEventListener=d,Gt}var Jt={},es;function du(){if(es)return Jt;es=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.useGetBoundingClientRect=void 0;const n=he(),d=Oi(),g=(f,i=200)=>{const a=(0,n.useRef)(null),l=(0,n.useMemo)(()=>(0,d.throttle)(i,!0,()=>{setTimeout(()=>{var o;return a.current=((o=f.current)===null||o===void 0?void 0:o.getBoundingClientRect())||null},0)}),[f,i]);return(0,n.useCallback)((o=!1)=>{var e;return o?a.current=((e=f.current)===null||e===void 0?void 0:e.getBoundingClientRect())||null:l(),a.current},[f,l])};return Jt.useGetBoundingClientRect=g,Jt}var st={},ts;function Ja(){return ts||(ts=1,function(n){var d=st&&st.__createBinding||(Object.create?function(l,o,e,t){t===void 0&&(t=e);var r=Object.getOwnPropertyDescriptor(o,e);(!r||("get"in r?!o.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return o[e]}}),Object.defineProperty(l,t,r)}:function(l,o,e,t){t===void 0&&(t=e),l[t]=o[e]}),g=st&&st.__setModuleDefault||(Object.create?function(l,o){Object.defineProperty(l,"default",{enumerable:!0,value:o})}:function(l,o){l.default=o}),f=st&&st.__importStar||function(l){if(l&&l.__esModule)return l;var o={};if(l!=null)for(var e in l)e!=="default"&&Object.prototype.hasOwnProperty.call(l,e)&&d(o,l,e);return g(o,l),o};Object.defineProperty(n,"__esModule",{value:!0}),n.AddRows=n.createAddRowsComponent=void 0;const i=f(he()),a=(l={})=>({addRows:o})=>{var e,t;const[r,s]=(0,i.useState)(1),[u,v]=(0,i.useState)(String(r));return i.default.createElement("div",{className:"dsg-add-row"},i.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>o(r)},(e=l.button)!==null&&e!==void 0?e:"Add")," ",i.default.createElement("input",{className:"dsg-add-row-input",value:u,onBlur:()=>v(String(r)),type:"number",min:1,onChange:w=>{v(w.target.value),s(Math.max(1,Math.round(parseInt(w.target.value)||0)))},onKeyDown:w=>{w.key==="Enter"&&o(r)}})," ",(t=l.unit)!==null&&t!==void 0?t:"rows")};n.createAddRowsComponent=a,n.AddRows=(0,n.createAddRowsComponent)(),n.AddRows.displayName="AddRows"}(st)),st}var Kt={},ns;function fu(){if(ns)return Kt;ns=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.useDebounceState=void 0;const n=he(),d=Oi(),g=(f,i)=>{const[a,l]=(0,n.useState)(f),o=(0,n.useRef)();(0,n.useEffect)(()=>()=>{var t;return(t=o.current)===null||t===void 0?void 0:t.cancel()},[]);const e=(0,n.useMemo)(()=>o.current=(0,d.debounce)(i,t=>{l(t)}),[i]);return[a,e]};return Kt.useDebounceState=g,Kt}var ot={},rs;function Ka(){return rs||(rs=1,function(n){var d=ot&&ot.__createBinding||(Object.create?function(t,r,s,u){u===void 0&&(u=s);var v=Object.getOwnPropertyDescriptor(r,s);(!v||("get"in v?!r.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(t,u,v)}:function(t,r,s,u){u===void 0&&(u=s),t[u]=r[s]}),g=ot&&ot.__setModuleDefault||(Object.create?function(t,r){Object.defineProperty(t,"default",{enumerable:!0,value:r})}:function(t,r){t.default=r}),f=ot&&ot.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&d(r,t,s);return g(r,t),r};Object.defineProperty(n,"__esModule",{value:!0}),n.ContextMenu=n.createContextMenuComponent=n.defaultRenderItem=void 0;const i=f(he()),a=he(),l=Ga(),o=t=>t.type==="CUT"?i.createElement(i.Fragment,null,"Cut"):t.type==="COPY"?i.createElement(i.Fragment,null,"Copy"):t.type==="PASTE"?i.createElement(i.Fragment,null,"Paste"):t.type==="DELETE_ROW"?i.createElement(i.Fragment,null,"Delete row"):t.type==="DELETE_ROWS"?i.createElement(i.Fragment,null,"Delete rows ",i.createElement("b",null,t.fromRow)," to ",i.createElement("b",null,t.toRow)):t.type==="INSERT_ROW_BELLOW"?i.createElement(i.Fragment,null,"Insert row below"):t.type==="DUPLICATE_ROW"?i.createElement(i.Fragment,null,"Duplicate row"):t.type==="DUPLICATE_ROWS"?i.createElement(i.Fragment,null,"Duplicate rows ",i.createElement("b",null,t.fromRow)," to ",i.createElement("b",null,t.toRow)):t.type;n.defaultRenderItem=o;const e=(t=n.defaultRenderItem)=>({clientX:r,clientY:s,items:u,close:v})=>{const w=(0,a.useRef)(null),b=(0,a.useCallback)(h=>{var c;((c=w.current)===null||c===void 0?void 0:c.contains(h.target))||v()},[v]);return(0,l.useDocumentEventListener)("mousedown",b),i.createElement("div",{className:"dsg-context-menu",style:{left:r+"px",top:s+"px"},ref:w},u.map(h=>i.createElement("div",{key:h.type,onClick:h.action,className:"dsg-context-menu-item"},t(h))))};n.createContextMenuComponent=e,n.ContextMenu=(0,n.createContextMenuComponent)(n.defaultRenderItem),n.ContextMenu.displayName="ContextMenu"}(ot)),ot}var Ke={},Ht={},is;function hu(){if(is)return Ht;is=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.parseDom=void 0;const n=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},d=g=>n.parseFromString(g,"text/html");return Ht.parseDom=d,Ht}var ss;function pu(){if(ss)return Ke;ss=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.isPrintableUnicode=Ke.encodeHtml=Ke.parseTextPlainData=Ke.parseTextHtmlData=void 0;const n=hu(),d=a=>{var l,o;const e=(0,n.parseDom)(a.replace(/<br\/?>/g,`
`)),t=e.getElementsByTagName("table")[0];if(t){const s=[];for(let u=0;u<t.rows.length;u++){const v=[];s.push(v);for(let w=0;w<t.rows[u].cells.length;w++)v.push((l=t.rows[u].cells[w].textContent)!==null&&l!==void 0?l:"")}return s}const r=e.getElementsByTagName("span")[0];return r?[[(o=r.textContent)!==null&&o!==void 0?o:""]]:[[""]]};Ke.parseTextHtmlData=d;const g=a=>{const l=a.replace(/\r|\n$/g,""),o=[[]];let e=0,t=0,r=!1,s=0;const u=()=>{let v=l.slice(t,e);v[0]==='"'&&v[v.length-1]==='"'&&(r=!0),r&&v[v.length-1]==='"'&&v.includes(`
`)&&(v=v.slice(1,v.length-1).replace(/""/g,'"'),r=!1),r&&v[v.length-1]!=='"'?v.split(`
`).forEach((w,b,{length:h})=>{o[s].push(w),b<h-1&&(o.push([]),s++)}):o[s].push(v)};for(;e<l.length;)r&&l[e]==='"'&&![void 0,"	",'"'].includes(l[e+1])&&(r=!1),r&&l[e]==='"'&&l[e+1]==='"'&&e++,e===t&&l[e]==='"'&&(r=!0),l[e]==="	"&&(u(),t=e+1,r=!1),l[e]===`
`&&!r&&(u(),o.push([]),t=e+1,s++),e++;return u(),o};Ke.parseTextPlainData=g;const f=a=>a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");Ke.encodeHtml=f;const i=a=>a.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return Ke.isPrintableUnicode=i,Ke}var Dr={},os;function vu(){return os||(os=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSelectionWithId=n.getSelection=n.getCellWithId=n.getCell=void 0;const d=(a,l,o,e)=>{if(a===null||!l||!o)return null;if(typeof a!="object")throw new Error("Value must be an object or null");const t=e.findIndex(s=>s.id===a.col),r={col:Math.max(0,Math.min(l-1,t===-1?Number(a.col):t-1)),row:Math.max(0,Math.min(o-1,Number(a.row)))};if(isNaN(r.col)||isNaN(r.row))throw new Error("col or cell are not valid positive numbers");return r};n.getCell=d;const g=(a,l)=>{var o;return a?{col:a.col,row:a.row,colId:(o=l[a.col+1])===null||o===void 0?void 0:o.id}:null};n.getCellWithId=g;const f=(a,l,o,e)=>{if(a===null||!l||!o)return null;if(typeof a!="object")throw new Error("Value must be an object or null");const t={min:(0,n.getCell)(a.min,l,o,e),max:(0,n.getCell)(a.max,l,o,e)};if(!t.min||!t.max)throw new Error("min and max must be defined");return t};n.getSelection=f;const i=(a,l)=>a?{min:(0,n.getCellWithId)(a.min,l),max:(0,n.getCellWithId)(a.max,l)}:null;n.getSelectionWithId=i}(Dr)),Dr}var Xt={},as;function bu(){if(as)return Xt;as=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.getAllTabbableElements=void 0;const n=()=>Array.from(document.querySelectorAll("*")).filter(d=>d instanceof HTMLElement&&typeof d.tabIndex=="number"&&d.tabIndex>=0&&!d.disabled&&(!(d instanceof HTMLAnchorElement)||!!d.href||d.getAttribute("tabIndex")!==null)&&getComputedStyle(d).visibility!=="collapse");return Xt.getAllTabbableElements=n,Xt}var De={},Br={},qr={},Vr={},ls;function mu(){return ls||(ls=1,function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});function d(a,l,o){let e=o.initialDeps??[],t;function r(){var s,u,v,w;let b;o.key&&((s=o.debug)!=null&&s.call(o))&&(b=Date.now());const h=a();if(!(h.length!==e.length||h.some((m,_)=>e[_]!==m)))return t;e=h;let p;if(o.key&&((u=o.debug)!=null&&u.call(o))&&(p=Date.now()),t=l(...h),o.key&&((v=o.debug)!=null&&v.call(o))){const m=Math.round((Date.now()-b)*100)/100,_=Math.round((Date.now()-p)*100)/100,y=_/16,O=(x,C)=>{for(x=String(x);x.length<C;)x=" "+x;return x};console.info(`%c⏱ ${O(_,5)} /${O(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,o==null?void 0:o.key)}return(w=o==null?void 0:o.onChange)==null||w.call(o,t),t}return r.updateDeps=s=>{e=s},r}function g(a,l){if(a===void 0)throw new Error(`Unexpected undefined${l?`: ${l}`:""}`);return a}const f=(a,l)=>Math.abs(a-l)<=1,i=(a,l,o)=>{let e;return function(...t){a.clearTimeout(e),e=a.setTimeout(()=>l.apply(this,t),o)}};n.approxEqual=f,n.debounce=i,n.memo=d,n.notUndefined=g}(Vr)),Vr}var cs;function wu(){return cs||(cs=1,function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const d=mu(),g=c=>{const{offsetWidth:p,offsetHeight:m}=c;return{width:p,height:m}},f=c=>c,i=c=>{const p=Math.max(c.startIndex-c.overscan,0),m=Math.min(c.endIndex+c.overscan,c.count-1),_=[];for(let y=p;y<=m;y++)_.push(y);return _},a=(c,p)=>{const m=c.scrollElement;if(!m)return;const _=c.targetWindow;if(!_)return;const y=x=>{const{width:C,height:R}=x;p({width:Math.round(C),height:Math.round(R)})};if(y(g(m)),!_.ResizeObserver)return()=>{};const O=new _.ResizeObserver(x=>{const C=()=>{const R=x[0];if(R!=null&&R.borderBoxSize){const D=R.borderBoxSize[0];if(D){y({width:D.inlineSize,height:D.blockSize});return}}y(g(m))};c.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(C):C()});return O.observe(m,{box:"border-box"}),()=>{O.unobserve(m)}},l={passive:!0},o=(c,p)=>{const m=c.scrollElement;if(!m)return;const _=()=>{p({width:m.innerWidth,height:m.innerHeight})};return _(),m.addEventListener("resize",_,l),()=>{m.removeEventListener("resize",_)}},e=typeof window>"u"?!0:"onscrollend"in window,t=(c,p)=>{const m=c.scrollElement;if(!m)return;const _=c.targetWindow;if(!_)return;let y=0;const O=c.options.useScrollendEvent&&e?()=>{}:d.debounce(_,()=>{p(y,!1)},c.options.isScrollingResetDelay),x=P=>()=>{const{horizontal:V,isRtl:I}=c.options;y=V?m.scrollLeft*(I&&-1||1):m.scrollTop,O(),p(y,P)},C=x(!0),R=x(!1);R(),m.addEventListener("scroll",C,l);const D=c.options.useScrollendEvent&&e;return D&&m.addEventListener("scrollend",R,l),()=>{m.removeEventListener("scroll",C),D&&m.removeEventListener("scrollend",R)}},r=(c,p)=>{const m=c.scrollElement;if(!m)return;const _=c.targetWindow;if(!_)return;let y=0;const O=c.options.useScrollendEvent&&e?()=>{}:d.debounce(_,()=>{p(y,!1)},c.options.isScrollingResetDelay),x=P=>()=>{y=m[c.options.horizontal?"scrollX":"scrollY"],O(),p(y,P)},C=x(!0),R=x(!1);R(),m.addEventListener("scroll",C,l);const D=c.options.useScrollendEvent&&e;return D&&m.addEventListener("scrollend",R,l),()=>{m.removeEventListener("scroll",C),D&&m.removeEventListener("scrollend",R)}},s=(c,p,m)=>{if(p!=null&&p.borderBoxSize){const _=p.borderBoxSize[0];if(_)return Math.round(_[m.options.horizontal?"inlineSize":"blockSize"])}return c[m.options.horizontal?"offsetWidth":"offsetHeight"]},u=(c,{adjustments:p=0,behavior:m},_)=>{var y,O;const x=c+p;(O=(y=_.scrollElement)==null?void 0:y.scrollTo)==null||O.call(y,{[_.options.horizontal?"left":"top"]:x,behavior:m})},v=(c,{adjustments:p=0,behavior:m},_)=>{var y,O;const x=c+p;(O=(y=_.scrollElement)==null?void 0:y.scrollTo)==null||O.call(y,{[_.options.horizontal?"left":"top"]:x,behavior:m})};class w{constructor(p){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let m=null;const _=()=>m||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:m=new this.targetWindow.ResizeObserver(y=>{y.forEach(O=>{const x=()=>{this._measureElement(O.target,O)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()})}));return{disconnect:()=>{var y;(y=_())==null||y.disconnect(),m=null},observe:y=>{var O;return(O=_())==null?void 0:O.observe(y,{box:"border-box"})},unobserve:y=>{var O;return(O=_())==null?void 0:O.unobserve(y)}}})(),this.range=null,this.setOptions=m=>{Object.entries(m).forEach(([_,y])=>{typeof y>"u"&&delete m[_]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:f,rangeExtractor:i,onChange:()=>{},measureElement:s,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...m}},this.notify=m=>{var _,y;(y=(_=this.options).onChange)==null||y.call(_,this,m)},this.maybeNotify=d.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),m=>{this.notify(m)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(m=>m()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var m;const _=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==_){if(this.cleanup(),!_){this.maybeNotify();return}this.scrollElement=_,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((m=this.scrollElement)==null?void 0:m.window)??null,this.elementsCache.forEach(y=>{this.observer.observe(y)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,y=>{this.scrollRect=y,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(y,O)=>{this.scrollAdjustments=0,this.scrollDirection=O?this.getScrollOffset()<y?"forward":"backward":null,this.scrollOffset=y,this.isScrolling=O,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(m,_)=>{const y=new Map,O=new Map;for(let x=_-1;x>=0;x--){const C=m[x];if(y.has(C.lane))continue;const R=O.get(C.lane);if(R==null||C.end>R.end?O.set(C.lane,C):C.end<R.end&&y.set(C.lane,!0),y.size===this.options.lanes)break}return O.size===this.options.lanes?Array.from(O.values()).sort((x,C)=>x.end===C.end?x.index-C.index:x.end-C.end)[0]:void 0},this.getMeasurementOptions=d.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(m,_,y,O,x)=>(this.pendingMeasuredCacheIndexes=[],{count:m,paddingStart:_,scrollMargin:y,getItemKey:O,enabled:x}),{key:!1}),this.getMeasurements=d.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:m,paddingStart:_,scrollMargin:y,getItemKey:O,enabled:x},C)=>{if(!x)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(P=>{this.itemSizeCache.set(P.key,P.size)}));const R=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const D=this.measurementsCache.slice(0,R);for(let P=R;P<m;P++){const V=O(P),I=this.options.lanes===1?D[P-1]:this.getFurthestMeasurement(D,P),Y=I?I.end+this.options.gap:_+y,G=C.get(V),A=typeof G=="number"?G:this.options.estimateSize(P),q=Y+A,ne=I?I.lane:P%this.options.lanes;D[P]={index:P,start:Y,size:A,end:q,key:V,lane:ne}}return this.measurementsCache=D,D},{key:!1,debug:()=>this.options.debug}),this.calculateRange=d.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(m,_,y,O)=>this.range=m.length>0&&_>0?h({measurements:m,outerSize:_,scrollOffset:y,lanes:O}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=d.memo(()=>{let m=null,_=null;const y=this.calculateRange();return y&&(m=y.startIndex,_=y.endIndex),this.maybeNotify.updateDeps([this.isScrolling,m,_]),[this.options.rangeExtractor,this.options.overscan,this.options.count,m,_]},(m,_,y,O,x)=>O===null||x===null?[]:m({startIndex:O,endIndex:x,overscan:_,count:y}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=m=>{const _=this.options.indexAttribute,y=m.getAttribute(_);return y?parseInt(y,10):(console.warn(`Missing attribute name '${_}={index}' on measured element.`),-1)},this._measureElement=(m,_)=>{const y=this.indexFromElement(m),O=this.measurementsCache[y];if(!O)return;const x=O.key,C=this.elementsCache.get(x);C!==m&&(C&&this.observer.unobserve(C),this.observer.observe(m),this.elementsCache.set(x,m)),m.isConnected&&this.resizeItem(y,this.options.measureElement(m,_,this))},this.resizeItem=(m,_)=>{const y=this.measurementsCache[m];if(!y)return;const O=this.itemSizeCache.get(y.key)??y.size,x=_-O;x!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(y,x,this):y.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=x,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(y.index),this.itemSizeCache=new Map(this.itemSizeCache.set(y.key,_)),this.notify(!1))},this.measureElement=m=>{if(!m){this.elementsCache.forEach((_,y)=>{_.isConnected||(this.observer.unobserve(_),this.elementsCache.delete(y))});return}this._measureElement(m,void 0)},this.getVirtualItems=d.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(m,_)=>{const y=[];for(let O=0,x=m.length;O<x;O++){const C=m[O],R=_[C];y.push(R)}return y},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=m=>{const _=this.getMeasurements();if(_.length!==0)return d.notUndefined(_[b(0,_.length-1,y=>d.notUndefined(_[y]).start,m)])},this.getOffsetForAlignment=(m,_,y=0)=>{const O=this.getSize(),x=this.getScrollOffset();_==="auto"&&(_=m>=x+O?"end":"start"),_==="center"?m+=(y-O)/2:_==="end"&&(m-=O);const C=this.getTotalSize()-O;return Math.max(Math.min(C,m),0)},this.getOffsetForIndex=(m,_="auto")=>{m=Math.max(0,Math.min(m,this.options.count-1));const y=this.measurementsCache[m];if(!y)return;const O=this.getSize(),x=this.getScrollOffset();if(_==="auto")if(y.end>=x+O-this.options.scrollPaddingEnd)_="end";else if(y.start<=x+this.options.scrollPaddingStart)_="start";else return[x,_];const C=_==="end"?y.end+this.options.scrollPaddingEnd:y.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(C,_,y.size),_]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(m,{align:_="start",behavior:y}={})=>{this.cancelScrollToIndex(),y==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(m,_),{adjustments:void 0,behavior:y})},this.scrollToIndex=(m,{align:_="auto",behavior:y}={})=>{m=Math.max(0,Math.min(m,this.options.count-1)),this.cancelScrollToIndex(),y==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const O=this.getOffsetForIndex(m,_);if(!O)return;const[x,C]=O;this._scrollToOffset(x,{adjustments:void 0,behavior:y}),y!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(m))){const[D]=d.notUndefined(this.getOffsetForIndex(m,C)),P=this.getScrollOffset();d.approxEqual(D,P)||this.scrollToIndex(m,{align:C,behavior:y})}else this.scrollToIndex(m,{align:C,behavior:y})}))},this.scrollBy=(m,{behavior:_}={})=>{this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+m,{adjustments:void 0,behavior:_})},this.getTotalSize=()=>{var m;const _=this.getMeasurements();let y;if(_.length===0)y=this.options.paddingStart;else if(this.options.lanes===1)y=((m=_[_.length-1])==null?void 0:m.end)??0;else{const O=Array(this.options.lanes).fill(null);let x=_.length-1;for(;x>=0&&O.some(C=>C===null);){const C=_[x];O[C.lane]===null&&(O[C.lane]=C.end),x--}y=Math.max(...O.filter(C=>C!==null))}return Math.max(y-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(m,{adjustments:_,behavior:y})=>{this.options.scrollToFn(m,{behavior:y,adjustments:_},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(p)}}const b=(c,p,m,_)=>{for(;c<=p;){const y=(c+p)/2|0,O=m(y);if(O<_)c=y+1;else if(O>_)p=y-1;else return y}return c>0?c-1:0};function h({measurements:c,outerSize:p,scrollOffset:m,lanes:_}){const y=c.length-1,O=R=>c[R].start;if(c.length<=_)return{startIndex:0,endIndex:y};let x=b(0,y,O,m),C=x;if(_===1)for(;C<y&&c[C].end<m+p;)C++;else if(_>1){const R=Array(_).fill(0);for(;C<y&&R.some(P=>P<m+p);){const P=c[C];R[P.lane]=P.end,C++}const D=Array(_).fill(m+p);for(;x>=0&&D.some(P=>P>=m);){const P=c[x];D[P.lane]=P.start,x--}x=Math.max(0,x-x%_),C=Math.min(y,C+(_-1-C%_))}return{startIndex:x,endIndex:C}}n.approxEqual=d.approxEqual,n.debounce=d.debounce,n.memo=d.memo,n.notUndefined=d.notUndefined,n.Virtualizer=w,n.defaultKeyExtractor=f,n.defaultRangeExtractor=i,n.elementScroll=v,n.measureElement=s,n.observeElementOffset=t,n.observeElementRect=a,n.observeWindowOffset=r,n.observeWindowRect=o,n.windowScroll=u}(qr)),qr}var us;function gu(){return us||(us=1,function(n){Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});const d=he(),g=Fl(),f=wu();function i(r){const s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const u in r)if(u!=="default"){const v=Object.getOwnPropertyDescriptor(r,u);Object.defineProperty(s,u,v.get?v:{enumerable:!0,get:()=>r[u]})}}return s.default=r,Object.freeze(s)}const a=i(d),l=typeof document<"u"?a.useLayoutEffect:a.useEffect;function o(r){const s=a.useReducer(()=>({}),{})[1],u={...r,onChange:(w,b)=>{var h;b?g.flushSync(s):s(),(h=r.onChange)==null||h.call(r,w,b)}},[v]=a.useState(()=>new f.Virtualizer(u));return v.setOptions(u),l(()=>v._didMount(),[]),l(()=>v._willUpdate()),v}function e(r){return o({observeElementRect:f.observeElementRect,observeElementOffset:f.observeElementOffset,scrollToFn:f.elementScroll,...r})}function t(r){return o({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:f.observeWindowRect,observeElementOffset:f.observeWindowOffset,scrollToFn:f.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...r})}n.useVirtualizer=e,n.useWindowVirtualizer=t,Object.keys(f).forEach(r=>{r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:()=>f[r]})})}(Br)),Br}var vt={},ds;function _u(){if(ds)return vt;ds=1;var n=vt&&vt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vt,"__esModule",{value:!0}),vt.Cell=void 0;const d=n(he()),g=n(Vt()),f=({children:i,gutter:a,stickyRight:l,active:o,disabled:e,className:t,width:r,left:s})=>d.default.createElement("div",{className:(0,g.default)("dsg-cell",a&&"dsg-cell-gutter",e&&"dsg-cell-disabled",a&&o&&"dsg-cell-gutter-active",l&&"dsg-cell-sticky-right",t),style:{width:r,left:l?void 0:s}},i);return vt.Cell=f,vt}var Yt={},fs;function yu(){if(fs)return Yt;fs=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.useMemoizedIndexCallback=void 0;const n=he(),d=(g,f)=>(0,n.useMemo)(()=>{const i=new Map;return a=>(i.has(a)||i.set(a,(...l)=>{g(a,...l.slice(0,f))}),i.get(a))},[f,g]);return Yt.useMemoizedIndexCallback=d,Yt}var hs;function Ou(){if(hs)return De;hs=1;var n=De&&De.__createBinding||(Object.create?function(r,s,u,v){v===void 0&&(v=u);var w=Object.getOwnPropertyDescriptor(s,u);(!w||("get"in w?!s.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return s[u]}}),Object.defineProperty(r,v,w)}:function(r,s,u,v){v===void 0&&(v=u),r[v]=s[u]}),d=De&&De.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),g=De&&De.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var u in r)u!=="default"&&Object.prototype.hasOwnProperty.call(r,u)&&n(s,r,u);return d(s,r),s},f=De&&De.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(De,"__esModule",{value:!0}),De.Grid=void 0;const i=gu(),a=g(he()),l=f(Vt()),o=_u(),e=yu(),t=({data:r,columns:s,outerRef:u,innerRef:v,columnWidths:w,hasStickyRightColumn:b,displayHeight:h,headerRowHeight:c,rowHeight:p,rowKey:m,fullWidth:_,selection:y,activeCell:O,rowClassName:x,cellClassName:C,children:R,editing:D,getContextMenuItems:P,setRowData:V,deleteRows:I,duplicateRows:Y,insertRowAfter:G,stopEditing:A,onScroll:q})=>{var ne,Q,de,ye;const oe=(0,i.useVirtualizer)({count:r.length,getScrollElement:()=>u.current,paddingStart:c,estimateSize:B=>p(B).height,getItemKey:B=>{if(m&&B>0){const F=r[B-1];if(typeof m=="function")return m({rowData:F,rowIndex:B});if(typeof m=="string"&&F instanceof Object&&m in F){const X=F[m];if(typeof X=="string"||typeof X=="number")return X}}return B},overscan:5}),re=(0,i.useVirtualizer)({count:s.length,getScrollElement:()=>u.current,estimateSize:B=>{var F;return(F=w==null?void 0:w[B])!==null&&F!==void 0?F:100},horizontal:!0,getItemKey:B=>{var F;return(F=s[B].id)!==null&&F!==void 0?F:B},overscan:1,rangeExtractor:B=>{const F=(0,i.defaultRangeExtractor)(B);return F[0]!==0&&F.unshift(0),b&&F[F.length-1]!==s.length-1&&F.push(s.length-1),F}});(0,a.useEffect)(()=>{re.measure()},[re,w]);const Ee=(0,e.useMemoizedIndexCallback)(V,1),Ue=(0,e.useMemoizedIndexCallback)(I,0),W=(0,e.useMemoizedIndexCallback)(Y,0),$=(0,e.useMemoizedIndexCallback)(G,0),le=(ne=y==null?void 0:y.min.col)!==null&&ne!==void 0?ne:O==null?void 0:O.col,we=(Q=y==null?void 0:y.max.col)!==null&&Q!==void 0?Q:O==null?void 0:O.col,be=(de=y==null?void 0:y.min.row)!==null&&de!==void 0?de:O==null?void 0:O.row,H=(ye=y==null?void 0:y.max.row)!==null&&ye!==void 0?ye:O==null?void 0:O.row;return a.default.createElement("div",{ref:u,className:"dsg-container",onScroll:q,style:{height:h}},a.default.createElement("div",{ref:v,style:{width:_?"100%":re.getTotalSize(),height:oe.getTotalSize()}},c>0&&a.default.createElement("div",{className:(0,l.default)("dsg-row","dsg-row-header"),style:{width:_?"100%":re.getTotalSize(),height:c}},re.getVirtualItems().map(B=>a.default.createElement(o.Cell,{key:B.key,gutter:B.index===0,stickyRight:b&&B.index===s.length-1,width:B.size,left:B.start,className:(0,l.default)("dsg-cell-header",le!==void 0&&we!==void 0&&le<=B.index-1&&we>=B.index-1&&"dsg-cell-header-active",s[B.index].headerClassName)},a.default.createElement("div",{className:"dsg-cell-header-container"},s[B.index].title)))),oe.getVirtualItems().map(B=>{const F=B.index>=(be??1/0)&&B.index<=(H??-1/0);return a.default.createElement("div",{key:B.key,className:(0,l.default)("dsg-row",typeof x=="string"?x:null,typeof x=="function"?x({rowData:r[B.index],rowIndex:B.index}):null),style:{height:B.size,top:B.start,width:_?"100%":re.getTotalSize()}},re.getVirtualItems().map(X=>{const Ne=s[X.index].cellClassName,lt=s[X.index].disabled,_r=s[X.index].component,ar=lt===!0||typeof lt=="function"&&lt({rowData:r[B.index],rowIndex:B.index}),lr=(O==null?void 0:O.row)===B.index&&O.col===X.index-1;return a.default.createElement(o.Cell,{key:X.key,gutter:X.index===0,stickyRight:b&&X.index===s.length-1,active:X.index===0&&F,disabled:ar,className:(0,l.default)(typeof Ne=="function"?Ne({rowData:r[B.index],rowIndex:B.index,columnId:s[X.index].id}):Ne,typeof C=="function"?C({rowData:r[B.index],rowIndex:B.index,columnId:s[X.index].id}):C),width:X.size,left:X.start},a.default.createElement(_r,{rowData:r[B.index],getContextMenuItems:P,disabled:ar,active:lr,columnIndex:X.index-1,rowIndex:B.index,focus:lr&&D,deleteRow:Ue(B.index),duplicateRow:W(B.index),stopEditing:A,insertRowBelow:$(B.index),setRowData:Ee(B.index),columnData:s[X.index].columnData}))}))}),R))};return De.Grid=t,De}var He={},ps;function xu(){return ps||(ps=1,function(n){var d=He&&He.__createBinding||(Object.create?function(t,r,s,u){u===void 0&&(u=s);var v=Object.getOwnPropertyDescriptor(r,s);(!v||("get"in v?!r.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(t,u,v)}:function(t,r,s,u){u===void 0&&(u=s),t[u]=r[s]}),g=He&&He.__setModuleDefault||(Object.create?function(t,r){Object.defineProperty(t,"default",{enumerable:!0,value:r})}:function(t,r){t.default=r}),f=He&&He.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&d(r,t,s);return g(r,t),r},i=He&&He.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.SelectionRect=void 0;const a=f(he()),l=i(Vt()),o=(t,r,s,u)=>[[u,t],[r,t],[r,s],[u,s],[u,t]],e=(t,r,s,u)=>`polygon(evenodd, ${[...o(0,"100%","100%",0),...o(t,r,s,u)].map(w=>w.map(b=>typeof b=="number"&&b!==0?b+"px":b).join(" ")).join(",")})`;n.SelectionRect=a.default.memo(({columnWidths:t,columnRights:r,headerRowHeight:s,selection:u,rowHeight:v,activeCell:w,hasStickyRightColumn:b,dataLength:h,viewWidth:c,viewHeight:p,contentWidth:m,edges:_,isCellDisabled:y,editing:O,expandSelection:x})=>{var C,R,D,P;const V=w?y(w):!1,I=(0,a.useMemo)(()=>{if(!u)return V;for(let oe=u.min.col;oe<=u.max.col;++oe)for(let re=u.min.row;re<=u.max.row;++re)if(!y({col:oe,row:re}))return!1;return!0},[V,y,u]);if(!t||!r)return null;const Y=oe=>oe<h-1?1:0,G=oe=>oe<t.length-(b?3:2)?1:0,A=w&&{width:t[w.col+1]+G(w.col),height:v(w.row).height+Y(w.row),left:r[w.col],top:v(w.row).top+s},q=u&&{width:t.slice(u.min.col+1,u.max.col+2).reduce((oe,re)=>oe+re)+G(u.max.col),height:v(u.max.row).top+v(u.max.row).height-v(u.min.row).top+Y(u.max.row),left:r[u.min.col],top:v(u.min.row).top+s},ne=(u==null?void 0:u.min)||w,Q=(u==null?void 0:u.max)||w,de=Q&&x!==null&&{left:r[Q.col]+t[Q.col+1],top:v(Q.row).top+v(Q.row).height+s,transform:`translate(-${Q.col<t.length-(b?3:2)?50:100}%, -${Q.row<h-1?50:100}%)`},ye=ne&&Q&&x!==null&&{width:t.slice(ne.col+1,Q.col+2).reduce((oe,re)=>oe+re)+G(Q.col),height:v(Q.row+x).top+v(Q.row+x).height-v(Q.row+1).top+Y(Q.row+x)-1,left:r[ne.col],top:v(Q.row).top+v(Q.row).height+s+1};return a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:v(h-1).top+v(h-1).height+s,width:m||"100%"}},a.default.createElement("div",{className:(0,l.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!_.top,"dsg-scrollable-view-r":!_.right,"dsg-scrollable-view-b":!_.bottom,"dsg-scrollable-view-l":!_.left}),style:{top:s,left:t[0],height:p?p-s:0,width:m&&c?c-t[0]-(b?t[t.length-1]:0):`calc(100% - ${t[0]+(b?t[t.length-1]:0)}px)`}})),(q||A)&&a.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(C=q==null?void 0:q.left)!==null&&C!==void 0?C:A==null?void 0:A.left,width:(R=q==null?void 0:q.width)!==null&&R!==void 0?R:A==null?void 0:A.width,height:v(h-1).top+v(h-1).height+s}},a.default.createElement("div",{className:(0,l.default)("dsg-selection-col-marker",I&&"dsg-selection-col-marker-disabled"),style:{top:s}})),(q||A)&&a.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(D=q==null?void 0:q.top)!==null&&D!==void 0?D:A==null?void 0:A.top,height:(P=q==null?void 0:q.height)!==null&&P!==void 0?P:A==null?void 0:A.height,width:m||"100%"}},a.default.createElement("div",{className:(0,l.default)("dsg-selection-row-marker",I&&"dsg-selection-row-marker-disabled"),style:{left:t[0]}})),A&&w&&a.default.createElement("div",{className:(0,l.default)("dsg-active-cell",{"dsg-active-cell-focus":O,"dsg-active-cell-disabled":V}),style:A}),q&&A&&a.default.createElement("div",{className:(0,l.default)("dsg-selection-rect",I&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},q),{clipPath:e(A.top-q.top,A.left-q.left,A.top+A.height-q.top,A.left+A.width-q.left)})}),ye&&a.default.createElement("div",{className:(0,l.default)("dsg-expand-rows-rect"),style:ye}),de&&a.default.createElement("div",{className:(0,l.default)("dsg-expand-rows-indicator",I&&"dsg-expand-rows-indicator-disabled"),style:de}))}),n.SelectionRect.displayName="SelectionRect"}(He)),He}var Qt={},vs;function Su(){if(vs)return Qt;vs=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.useRowHeights=void 0;const n=he(),d=({value:g,rowHeight:f})=>{const i=(0,n.useRef)([]),[,a]=(0,n.useState)(0);return(0,n.useMemo)(()=>{const l=o=>{if(typeof f=="number")return Math.min(g.length-1,Math.max(-1,Math.floor(o/f)));let e=0,t=i.current.length-1;for(;e<=t;){const r=Math.floor((e+t)/2);if(i.current[r].top<o)e=r+1;else if(i.current[r].top>o)t=r-1;else return r}if(t===i.current.length-1&&g.length>i.current.length&&(!i.current.length||o>=i.current[t].top+i.current[t].height)){let r=t===-1?0:i.current[t].top+i.current[t].height;do{t++;const s=f({rowIndex:t,rowData:g[t]});i.current.push({height:s,top:r}),r+=s}while(r<=o&&t<i.current.length-1)}return t};return{resetAfter:o=>{i.current=i.current.slice(0,o),a(e=>e+1)},getRowSize:o=>{if(typeof f=="number")return{height:f,top:f*o};if(o>=g.length)return{height:0,top:0};if(o<i.current.length)return i.current[o];let e=i.current[i.current.length-1].top+i.current[i.current.length-1].height;for(let t=i.current.length;t<=o;t++){const r=f({rowIndex:t,rowData:g[t]});i.current.push({height:r,top:e}),e+=r}return i.current[o]},getRowIndex:l,totalSize:o=>{if(typeof f=="number")return g.length*f;const e=l(o);return i.current[e].top+i.current[e].height}}},[f,g])};return Qt.useRowHeights=d,Qt}var bs;function Ha(){return bs||(bs=1,function(n){var d=Pe&&Pe.__createBinding||(Object.create?function(I,Y,G,A){A===void 0&&(A=G);var q=Object.getOwnPropertyDescriptor(Y,G);(!q||("get"in q?!Y.__esModule:q.writable||q.configurable))&&(q={enumerable:!0,get:function(){return Y[G]}}),Object.defineProperty(I,A,q)}:function(I,Y,G,A){A===void 0&&(A=G),I[A]=Y[G]}),g=Pe&&Pe.__setModuleDefault||(Object.create?function(I,Y){Object.defineProperty(I,"default",{enumerable:!0,value:Y})}:function(I,Y){I.default=Y}),f=Pe&&Pe.__importStar||function(I){if(I&&I.__esModule)return I;var Y={};if(I!=null)for(var G in I)G!=="default"&&Object.prototype.hasOwnProperty.call(I,G)&&d(Y,I,G);return g(Y,I),Y},i=Pe&&Pe.__awaiter||function(I,Y,G,A){function q(ne){return ne instanceof G?ne:new G(function(Q){Q(ne)})}return new(G||(G=Promise))(function(ne,Q){function de(re){try{oe(A.next(re))}catch(Ee){Q(Ee)}}function ye(re){try{oe(A.throw(re))}catch(Ee){Q(Ee)}}function oe(re){re.done?ne(re.value):q(re.value).then(de,ye)}oe((A=A.apply(I,Y||[])).next())})},a=Pe&&Pe.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(n,"__esModule",{value:!0}),n.DataSheetGrid=void 0;const l=f(he()),o=ec(),e=lu,t=cu(),r=uu(),s=Wa(),u=Ga(),v=du(),w=Ja(),b=fu(),h=a(Ma()),c=Ka(),p=pu(),m=vu(),_=bu(),y=Ou(),O=xu(),x=Su(),C=[],R=[],D=()=>({}),P=()=>null,V=({rowData:I})=>Object.assign({},I);n.DataSheetGrid=l.default.memo(l.default.forwardRef(({value:I=C,className:Y,style:G,height:A=400,onChange:q=P,columns:ne=R,rowHeight:Q=40,headerRowHeight:de=typeof Q=="number"?Q:40,gutterColumn:ye,stickyRightColumn:oe,rowKey:re,addRowsComponent:Ee=w.AddRows,createRow:Ue=D,autoAddRow:W=!1,lockRows:$=!1,disableExpandSelection:le=!1,disableSmartDelete:we=!1,duplicateRow:be=V,contextMenuComponent:H=c.ContextMenu,disableContextMenu:B=!1,onFocus:F=P,onBlur:X=P,onActiveCellChange:Ne=P,onSelectionChange:lt=P,rowClassName:_r,cellClassName:ar,onScroll:lr},xl)=>{var yr,Or,xr,Sr,Cr,Er;const Rt=(0,l.useRef)(null),Ti=B||$,U=(0,t.useColumns)(ne,ye,oe),ae=!!oe,cr=(0,l.useRef)(null),Ge=(0,l.useRef)(null),Nr=(0,l.useRef)(null),Rr=(0,l.useRef)(null),[Sl,Cl]=(0,b.useDebounceState)(1,100),{getRowSize:It,totalSize:El,getRowIndex:ki}=(0,x.useRowHeights)({value:I,rowHeight:Q}),Mi=Math.min(A,de+El(A)+Sl),{width:jt,height:ft}=(0,e.useResizeDetector)({targetRef:Ge,refreshMode:"throttle",refreshRate:100});Cl(ft?Mi-ft:0);const Nl=(0,r.useEdges)(Ge,jt,ft),{fullWidth:Ai,totalWidth:Rl,columnWidths:Le,columnRights:Je}=(0,o.useColumnWidths)(U,jt),[Tt,Fe]=(0,l.useState)(null),[kt,Il]=(0,l.useState)([]),[ce,_e]=(0,l.useState)(!1),[Mt,Pi]=(0,l.useState)(0),[At,Di]=(0,l.useState)(null),[E,ie]=(0,s.useDeepEqualState)(null),[Oe,Z]=(0,s.useDeepEqualState)(null),N=(0,l.useMemo)(()=>E&&Oe&&{min:{col:Math.min(E.col,Oe.col),row:Math.min(E.row,Oe.row)},max:{col:Math.max(E.col,Oe.col),row:Math.max(E.row,Oe.row)}},[E,Oe]),[tt,Pt]=(0,s.useDeepEqualState)({columns:!1,rows:!1,active:!1}),jl=le||ce||tt.active||(E==null?void 0:E.row)===(I==null?void 0:I.length)-1||(N==null?void 0:N.max.row)===(I==null?void 0:I.length)-1||E&&U.slice(((yr=N==null?void 0:N.min.col)!==null&&yr!==void 0?yr:E.col)+1,((Or=N==null?void 0:N.max.col)!==null&&Or!==void 0?Or:E.col)+2).every(S=>S.disabled===!0)?null:Mt,Bi=(0,v.useGetBoundingClientRect)(cr),qi=(0,v.useGetBoundingClientRect)(Ge);(0,l.useEffect)(()=>{var S;E!==null&&(document.activeElement.blur(),(S=window.getSelection())===null||S===void 0||S.removeAllRanges())},[E!==null]);const ht=(0,l.useCallback)((S,T=!1,k=!1)=>{const j=Bi(T),L=k&&qi(T);if(j&&Je&&Le){let ee=S.clientX-j.left,M=S.clientY-j.top;return L&&(S.clientY-L.top<=de&&(M=0),S.clientX-L.left<=Le[0]&&(ee=0),ae&&L.right-S.clientX<=Le[Le.length-1]&&(ee=Je[Je.length-2]+1)),{col:Je.findIndex(J=>ee<J)-1,row:ki(M-de)}}return null},[Je,Le,I.length,Bi,qi,de,ae,ki]),Te=(0,l.useRef)(I);Te.current=I;const ke=(0,l.useCallback)(S=>{const T=U[S.col+1].disabled;return!!(typeof T=="function"?T({rowData:Te.current[S.row],rowIndex:S.row}):T)},[U]),nt=(0,l.useCallback)((S,T=1)=>{$||(Z(null),_e(!1),q([...Te.current.slice(0,S+1),...new Array(T).fill(0).map(Ue),...Te.current.slice(S+1)],[{type:"CREATE",fromRowIndex:S+1,toRowIndex:S+1+T}]),ie(k=>({col:(k==null?void 0:k.col)||0,row:S+T,doNotScrollX:!0})))},[Ue,$,q,ie,Z]),Dt=(0,l.useCallback)((S,T=S)=>{$||(q([...Te.current.slice(0,T+1),...Te.current.slice(S,T+1).map((k,j)=>be({rowData:k,rowIndex:j+S})),...Te.current.slice(T+1)],[{type:"CREATE",fromRowIndex:T+1,toRowIndex:T+2+T-S}]),ie({col:0,row:T+1,doNotScrollX:!0}),Z({col:U.length-(ae?3:2),row:2*T-S+1,doNotScrollX:!0}),_e(!1))},[U.length,be,$,q,ie,Z,ae]),rt=(0,l.useCallback)(S=>{if(!(!ft||!jt)){if(!S.doNotScrollY){const T=It(S.row).top,k=It(S.row).top+It(S.row).height+de-ft+1,j=Ge.current.scrollTop;j>T?Ge.current.scrollTop=T:j<k&&(Ge.current.scrollTop=k)}if(Je&&Le&&Ge.current&&!S.doNotScrollX){const T=Je[S.col]-Je[0],k=Je[S.col]+Le[S.col+1]+(ae?Le[Le.length-1]:0)-jt+1,j=Ge.current.scrollLeft;j>T?Ge.current.scrollLeft=T:j<k&&(Ge.current.scrollLeft=k)}}},[ft,jt,de,Je,Le,It,ae]);(0,l.useEffect)(()=>{Oe&&rt(Oe)},[Oe,rt]),(0,l.useEffect)(()=>{E&&rt(E)},[E,rt]);const Tl=(0,l.useCallback)((S,T)=>{var k,j;q([...(k=Te.current)===null||k===void 0?void 0:k.slice(0,S),T,...(j=Te.current)===null||j===void 0?void 0:j.slice(S+1)],[{type:"UPDATE",fromRowIndex:S,toRowIndex:S+1}])},[q]),Bt=(0,l.useCallback)((S,T=S)=>{$||(_e(!1),ie(k=>{const j=Math.min(Te.current.length-2-T+S,S);return j<0?null:k&&{col:k.col,row:j}}),Z(null),q([...Te.current.slice(0,S),...Te.current.slice(T+1)],[{type:"DELETE",fromRowIndex:S,toRowIndex:T+1}]))},[$,q,ie,Z]),ur=(0,l.useCallback)((S=!0)=>{const T=S&&!we;if(!E)return;const k=(N==null?void 0:N.min)||E,j=(N==null?void 0:N.max)||E;if(I.slice(k.row,j.row+1).every((ee,M)=>U.every(J=>J.isCellEmpty({rowData:ee,rowIndex:M+k.row})))){T&&Bt(k.row,j.row);return}const L=[...I];for(let ee=k.row;ee<=j.row;++ee)for(let M=k.col;M<=j.col;++M)if(!ke({col:M,row:ee})){const{deleteValue:J=({rowData:se})=>se}=U[M+1];L[ee]=J({rowData:L[ee],rowIndex:ee})}if(T&&(0,h.default)(L,I)){ie({col:0,row:k.row,doNotScrollX:!0}),Z({col:U.length-(ae?3:2),row:j.row,doNotScrollX:!0});return}q(L,[{type:"UPDATE",fromRowIndex:k.row,toRowIndex:j.row+1}])},[E,U,I,Bt,ke,q,N==null?void 0:N.max,N==null?void 0:N.min,ie,Z,ae]),Ir=(0,l.useCallback)(({nextRow:S=!0}={})=>{(E==null?void 0:E.row)===Te.current.length-1?S&&W?nt(E.row):_e(!1):(_e(!1),S&&ie(T=>T&&{col:T.col,row:T.row+1}))},[E==null?void 0:E.row,W,nt,ie]),Ut=(0,l.useCallback)(S=>i(void 0,void 0,void 0,function*(){var T,k;if(!ce&&E){const j=[],L=(N==null?void 0:N.min)||E,ee=(N==null?void 0:N.max)||E;for(let z=L.row;z<=ee.row;++z){j.push([]);for(let ue=L.col;ue<=ee.col;++ue){const{copyValue:fe=()=>null}=U[ue+1];j[z-L.row].push(fe({rowData:I[z],rowIndex:z}))}}const M=j.map(z=>z.join("	")).join(`
`),J=`<table>${j.map(z=>`<tr>${z.map(ue=>`<td>${(0,p.encodeHtml)(String(ue??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(S!==void 0){(T=S.clipboardData)===null||T===void 0||T.setData("text/plain",M),(k=S.clipboardData)===null||k===void 0||k.setData("text/html",J),S.preventDefault();return}let se=!1;if(navigator.clipboard.write!==void 0){const z=new Blob([M],{type:"text/plain"}),ue=new Blob([J],{type:"text/html"}),fe=[new ClipboardItem({"text/plain":z,"text/html":ue})];yield navigator.clipboard.write(fe).then(()=>{se=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(M).then(()=>{se=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(se=!0);se||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[E,U,I,ce,N]);(0,u.useDocumentEventListener)("copy",Ut);const jr=(0,l.useCallback)(S=>{!ce&&E&&(Ut(S),ur(!1))},[E,ur,ce,Ut]);(0,u.useDocumentEventListener)("cut",jr);const Lt=(0,l.useCallback)(S=>i(void 0,void 0,void 0,function*(){var T,k;if(!ce&&E){const j=(N==null?void 0:N.min)||E,L=(N==null?void 0:N.max)||E,ee=yield Promise.all(S[0].map((M,J)=>{var se,z;const ue=(se=U[j.col+J+1])===null||se===void 0?void 0:se.prePasteValues,fe=S.map(Me=>Me[J]);return(z=ue==null?void 0:ue(fe))!==null&&z!==void 0?z:fe}));if(S=S.map((M,J)=>ee.map(se=>se[J])),S.length===1){const M=[...I];for(let J=0;J<S[0].length;J++){const se=(T=U[j.col+J+1])===null||T===void 0?void 0:T.pasteValue;if(se)for(let z=j.row;z<=L.row;z++)ke({col:J+j.col,row:z})||(M[z]=yield se({rowData:M[z],value:S[0][J],rowIndex:z}))}q(M,[{type:"UPDATE",fromRowIndex:j.row,toRowIndex:L.row+1}]),ie({col:j.col,row:j.row}),Z({col:Math.min(j.col+S[0].length-1,U.length-(ae?3:2)),row:L.row})}else{let M=[...I];const J=j.row+S.length-I.length;J>0&&($?S.splice(S.length-J,J):M=[...M,...new Array(J).fill(0).map(()=>Ue())]);for(let z=0;z<S[0].length&&j.col+z<U.length-(ae?2:1);z++){const ue=(k=U[j.col+z+1])===null||k===void 0?void 0:k.pasteValue;if(ue)for(let fe=0;fe<S.length;fe++)ke({col:j.col+z,row:j.row+fe})||(M[j.row+fe]=yield ue({rowData:M[j.row+fe],value:S[fe][z],rowIndex:j.row+fe}))}const se=[{type:"UPDATE",fromRowIndex:j.row,toRowIndex:j.row+S.length-(!$&&J>0?J:0)}];J>0&&!$&&se.push({type:"CREATE",fromRowIndex:j.row+S.length-J,toRowIndex:j.row+S.length}),q(M,se),ie({col:j.col,row:j.row}),Z({col:Math.min(j.col+S[0].length-1,U.length-(ae?3:2)),row:j.row+S.length-1})}}}),[E,U,Ue,I,ce,ae,ke,$,q,N==null?void 0:N.max,N==null?void 0:N.min,ie,Z]),kl=(0,l.useCallback)(S=>{var T,k,j,L,ee,M;if(E&&!ce){let J=[[""]];!((T=S.clipboardData)===null||T===void 0)&&T.types.includes("text/html")?J=(0,p.parseTextHtmlData)((k=S.clipboardData)===null||k===void 0?void 0:k.getData("text/html")):!((j=S.clipboardData)===null||j===void 0)&&j.types.includes("text/plain")?J=(0,p.parseTextPlainData)((L=S.clipboardData)===null||L===void 0?void 0:L.getData("text/plain")):!((ee=S.clipboardData)===null||ee===void 0)&&ee.types.includes("text")&&(J=(0,p.parseTextPlainData)((M=S.clipboardData)===null||M===void 0?void 0:M.getData("text"))),Lt(J),S.preventDefault()}},[E,Lt,ce]);(0,u.useDocumentEventListener)("paste",kl);const Ml=(0,l.useCallback)(S=>{var T,k,j;if(Tt&&kt.length)return;const L=S.button===2||S.button===0&&S.ctrlKey,ee=((T=cr.current)===null||T===void 0?void 0:T.contains(S.target))||!1,M=ee?ht(S,!0,!0):null;if(!ee&&ce&&E&&U[E.col+1].keepFocus)return;if(S.target instanceof HTMLElement&&S.target.className.includes("dsg-expand-rows-indicator")){Di(Math.max((k=E==null?void 0:E.row)!==null&&k!==void 0?k:0,(j=N==null?void 0:N.max.row)!==null&&j!==void 0?j:0));return}const J=M&&E&&E.col===M.col&&E.row===M.row&&!ke(E);if(J&&ce)return;const se=(M==null?void 0:M.col)===U.length-2&&ae,z=L&&N&&M&&M.row>=N.min.row&&M.row<=N.max.row&&M.col>=N.min.col&&M.col<=N.max.col,ue=L&&N&&M&&M.row===-1&&M.col>=N.min.col&&M.col<=N.max.col,fe=L&&N&&M&&M.row>=N.min.row&&M.row<=N.max.row&&M.col===-1,Me=se&&N&&M&&M.row>=N.min.row&&M.row<=N.max.row;if(L&&!Ti&&Fe({x:S.clientX,y:S.clientY,cursorIndex:M}),(!(S.shiftKey&&E)||L)&&I.length>0&&ie(M&&{col:(z||ue)&&E?E.col:Math.max(0,se?0:M.col),row:(z||fe||Me)&&E?E.row:Math.max(0,M.row),doNotScrollX:!!(z&&E||se||M.col===-1),doNotScrollY:!!(z&&E||M.row===-1)}),J&&!L&&(Rt.current=E),_e(!!(J&&!L)),Pt(M&&!L?{columns:M.col!==-1&&!se||!!(S.shiftKey&&E),rows:M.row!==-1||!!(S.shiftKey&&E),active:!0}:{columns:!1,rows:!1,active:!1}),S.shiftKey&&E&&!L)Z(M&&{col:Math.max(0,M.col-(se?1:0)),row:Math.max(0,M.row)});else if(!z){if(M&&((M==null?void 0:M.col)===-1||(M==null?void 0:M.row)===-1||se)){let Re=M.col,Ae=M.row,Ie=!1,ze=!1;(M.col===-1||se)&&(Re=U.length-(ae?3:2),Ie=!0),M.row===-1&&(Ae=I.length-1,ze=!0),ue&&Oe&&(Re=Oe.col,ze=!0),(fe||Me)&&Oe&&(Ae=Oe.row,Ie=!0),Z({col:Re,row:Ae,doNotScrollX:Ie,doNotScrollY:ze})}else Z(null);ee&&S.preventDefault()}},[Tt,kt.length,ht,ce,E,U,ke,N,ae,Ti,Pt,ie,Z,Oe,I.length]);(0,u.useDocumentEventListener)("mousedown",Ml);const Al=(0,l.useCallback)(()=>{var S,T,k,j,L,ee,M,J,se;if(At!==null){if(Mt>0&&E){let z=[];const ue=(N==null?void 0:N.min)||E,fe=(N==null?void 0:N.max)||E;for(let Me=ue.row;Me<=fe.row;++Me){z.push([]);for(let Re=ue.col;Re<=fe.col;++Re){const{copyValue:Ae=()=>null}=U[Re+1];z[Me-ue.row].push(String((S=Ae({rowData:I[Me],rowIndex:Me}))!==null&&S!==void 0?S:""))}}Promise.all(z[0].map((Me,Re)=>{var Ae,Ie;const ze=(Ae=U[ue.col+Re+1])===null||Ae===void 0?void 0:Ae.prePasteValues,We=z.map(Vl=>Vl[Re]);return(Ie=ze==null?void 0:ze(We))!==null&&Ie!==void 0?Ie:We})).then(Me=>{var Re;z=z.map((Ie,ze)=>Me.map(We=>We[ze]));const Ae=[...I];for(let Ie=0;Ie<z[0].length;Ie++){const ze=(Re=U[ue.col+Ie+1])===null||Re===void 0?void 0:Re.pasteValue;if(ze)for(let We=fe.row+1;We<=fe.row+Mt;We++)ke({col:Ie+ue.col,row:We})||(Ae[We]=ze({rowData:Ae[We],value:z[(We-fe.row-1)%z.length][Ie],rowIndex:We}))}q(Ae,[{type:"UPDATE",fromRowIndex:fe.row+1,toRowIndex:fe.row+1+Mt}])}),Pi(0),ie({col:Math.min((T=E==null?void 0:E.col)!==null&&T!==void 0?T:1/0,(k=N==null?void 0:N.min.col)!==null&&k!==void 0?k:1/0),row:Math.min((j=E==null?void 0:E.row)!==null&&j!==void 0?j:1/0,(L=N==null?void 0:N.min.row)!==null&&L!==void 0?L:1/0),doNotScrollX:!0,doNotScrollY:!0}),Z({col:Math.max((ee=E==null?void 0:E.col)!==null&&ee!==void 0?ee:0,(M=N==null?void 0:N.max.col)!==null&&M!==void 0?M:0),row:Math.max((J=E==null?void 0:E.row)!==null&&J!==void 0?J:0,(se=N==null?void 0:N.max.row)!==null&&se!==void 0?se:0)+Mt})}Di(null)}Pt({columns:!1,rows:!1,active:!1})},[At,Pt,Mt,E,N==null?void 0:N.min,N==null?void 0:N.max,I,q,ie,Z,U,ke]);(0,u.useDocumentEventListener)("mouseup",Al);const Pl=(0,l.useCallback)(S=>{if(At!==null){const T=ht(S);T&&(Pi(Math.max(0,T.row-At)),rt({col:T.col,row:Math.max(T.row,At)}))}if(tt.active){const T=ht(S),k=U.length-(ae?3:2);Z(T&&{col:tt.columns?Math.max(0,Math.min(k,T.col)):k,row:tt.rows?Math.max(0,T.row):I.length-1,doNotScrollX:!tt.columns,doNotScrollY:!tt.rows}),_e(!1)}},[rt,tt.active,tt.columns,tt.rows,ht,U.length,ae,Z,I.length,At]);(0,u.useDocumentEventListener)("mousemove",Pl);const Dl=(0,l.useCallback)(S=>{var T;if(E&&!S.isComposing){if(S.key==="Tab"&&!S.shiftKey&&E.col===U.length-(ae?3:2)&&!U[E.col+1].disableKeys)if(E.row===I.length-1){if(Rr.current){S.preventDefault(),ie(null),Z(null),_e(!1);const k=(0,_.getAllTabbableElements)(),j=k.indexOf(Rr.current);k[(j+1)%k.length].focus();return}}else{ie(k=>{var j;return{col:0,row:((j=k==null?void 0:k.row)!==null&&j!==void 0?j:0)+1}}),Z(null),_e(!1),S.preventDefault();return}if(S.key==="Tab"&&S.shiftKey&&E.col===0&&!U[E.col+1].disableKeys)if(E.row===0){if(Nr.current){S.preventDefault(),ie(null),Z(null),_e(!1);const k=(0,_.getAllTabbableElements)(),j=k.indexOf(Nr.current);k[(j-1+k.length)%k.length].focus();return}}else{ie(k=>{var j;return{col:U.length-(ae?3:2),row:((j=k==null?void 0:k.row)!==null&&j!==void 0?j:1)-1}}),Z(null),_e(!1),S.preventDefault();return}if(!((T=S.key)===null||T===void 0)&&T.startsWith("Arrow")||S.key==="Tab"){if(ce&&U[E.col+1].disableKeys||ce&&["ArrowLeft","ArrowRight"].includes(S.key))return;const k=([j,L],ee)=>ee&&{col:Math.max(0,Math.min(U.length-(ae?3:2),ee.col+j)),row:Math.max(0,Math.min(I.length-1,ee.row+L))};if(S.key==="Tab"&&S.shiftKey)ie(j=>k([-1,0],j)),Z(null);else{const j={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[S.key];(S.ctrlKey||S.metaKey)&&(j[0]*=U.length,j[1]*=I.length),S.shiftKey?Z(L=>k(j,L||E)):(ie(L=>k(j,L)),Z(null))}_e(!1),S.preventDefault()}else S.key==="Escape"?(!ce&&!Oe&&ie(null),Z(null),_e(!1)):(S.key==="Enter"||S.key==="F2")&&!S.ctrlKey&&!S.metaKey&&!S.altKey&&!S.shiftKey?(Z(null),ce?U[E.col+1].disableKeys||(Ir(),S.preventDefault()):ke(E)||(Rt.current=E,_e(!0),rt(E),S.preventDefault())):S.key==="Enter"&&!S.ctrlKey&&!S.metaKey&&!S.altKey&&S.shiftKey?nt((N==null?void 0:N.max.row)||E.row):S.key==="d"&&(S.ctrlKey||S.metaKey)&&!S.altKey&&!S.shiftKey?(Dt((N==null?void 0:N.min.row)||E.row,N==null?void 0:N.max.row),S.preventDefault()):((0,p.isPrintableUnicode)(S.key)||S.code.match(/Key[A-Z]$/))&&!S.ctrlKey&&!S.metaKey&&!S.altKey?!ce&&!ke(E)&&(Rt.current=E,Z(null),_e(!0),rt(E)):["Backspace","Delete"].includes(S.key)?ce||(ur(),S.preventDefault()):S.key==="a"&&(S.ctrlKey||S.metaKey)&&(ce||(ie({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),Z({col:U.length-(ae?3:2),row:I.length-1,doNotScrollY:!0,doNotScrollX:!0}),S.preventDefault()))}},[E,U,I.length,ur,Dt,ce,nt,ke,rt,N==null?void 0:N.max.row,N==null?void 0:N.min.row,Oe,ie,Z,Ir,ae]);(0,u.useDocumentEventListener)("keydown",Dl);const Bl=(0,l.useCallback)(S=>{var T;const k=((T=cr.current)===null||T===void 0?void 0:T.contains(S.target))||!1,j=k?ht(S,!0,!0):null,L=j&&E&&E.col===j.col&&E.row===j.row&&ce;k&&!L&&S.preventDefault()},[ht,E,ce]);(0,u.useDocumentEventListener)("contextmenu",Bl),(0,l.useEffect)(()=>{const S=[];(E==null?void 0:E.row)!==void 0&&S.push({type:"COPY",action:()=>{Ut(),Fe(null)}},{type:"CUT",action:()=>{jr(),Fe(null)}},{type:"PASTE",action:()=>i(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(k=>i(void 0,void 0,void 0,function*(){let j=[[""]];if(k.types.includes("text/html")){const L=yield k.getType("text/html");j=(0,p.parseTextHtmlData)(yield L.text())}else if(k.types.includes("text/plain")){const L=yield k.getType("text/plain");j=(0,p.parseTextPlainData)(yield L.text())}else if(k.types.includes("text")){const L=yield k.getType("text");j=(0,p.parseTextHtmlData)(yield L.text())}Lt(j)}));else if(navigator.clipboard.readText!==void 0){const T=yield navigator.clipboard.readText();Lt((0,p.parseTextPlainData)(T))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");Fe(null)})}),(N==null?void 0:N.max.row)!==void 0?S.push({type:"INSERT_ROW_BELLOW",action:()=>{Fe(null),nt(N.max.row)}}):(E==null?void 0:E.row)!==void 0&&S.push({type:"INSERT_ROW_BELLOW",action:()=>{Fe(null),nt(E.row)}}),(N==null?void 0:N.min.row)!==void 0&&N.min.row!==N.max.row?S.push({type:"DUPLICATE_ROWS",fromRow:N.min.row+1,toRow:N.max.row+1,action:()=>{Fe(null),Dt(N.min.row,N.max.row)}}):(E==null?void 0:E.row)!==void 0&&S.push({type:"DUPLICATE_ROW",action:()=>{Fe(null),Dt(E.row)}}),(N==null?void 0:N.min.row)!==void 0&&N.min.row!==N.max.row?S.push({type:"DELETE_ROWS",fromRow:N.min.row+1,toRow:N.max.row+1,action:()=>{Fe(null),Bt(N.min.row,N.max.row)}}):(E==null?void 0:E.row)!==void 0&&S.push({type:"DELETE_ROW",action:()=>{Fe(null),Bt(E.row)}}),Il(S),S.length||Fe(null)},[N,E,Bt,Dt,nt,jr,Ut,Lt]);const Vi=(0,l.useRef)(kt);Vi.current=kt;const ql=(0,l.useCallback)(()=>Vi.current,[]);(0,l.useImperativeHandle)(xl,()=>({activeCell:(0,m.getCellWithId)(E,U),selection:(0,m.getSelectionWithId)(N??(E?{min:E,max:E}:null),U),setSelection:S=>{const T=(0,m.getSelection)(S,U.length-(ae?2:1),I.length,U);ie((T==null?void 0:T.min)||null),_e(!1),Pt({columns:!1,active:!1,rows:!1}),Z((T==null?void 0:T.max)||null)},setActiveCell:S=>{const T=(0,m.getCell)(S,U.length-(ae?2:1),I.length,U);ie(T),_e(!1),Pt({columns:!1,active:!1,rows:!1}),Z(null)}}));const ct=(0,l.useRef)({onFocus:F,onBlur:X,onActiveCellChange:Ne,onSelectionChange:lt});return ct.current.onFocus=F,ct.current.onBlur=X,ct.current.onActiveCellChange=Ne,ct.current.onSelectionChange=lt,(0,l.useEffect)(()=>{Rt.current&&(ce?ct.current.onFocus({cell:(0,m.getCellWithId)(Rt.current,U)}):ct.current.onBlur({cell:(0,m.getCellWithId)(Rt.current,U)}))},[ce,U]),(0,l.useEffect)(()=>{ct.current.onActiveCellChange({cell:(0,m.getCellWithId)(E,U)})},[E==null?void 0:E.col,E==null?void 0:E.row,U]),(0,l.useEffect)(()=>{ct.current.onSelectionChange({selection:(0,m.getSelectionWithId)(N??(E?{min:E,max:E}:null),U)})},[(xr=N==null?void 0:N.min.col)!==null&&xr!==void 0?xr:E==null?void 0:E.col,(Sr=N==null?void 0:N.min.row)!==null&&Sr!==void 0?Sr:E==null?void 0:E.row,(Cr=N==null?void 0:N.max.col)!==null&&Cr!==void 0?Cr:E==null?void 0:E.col,(Er=N==null?void 0:N.max.row)!==null&&Er!==void 0?Er:E==null?void 0:E.row,E==null?void 0:E.col,E==null?void 0:E.row,U]),l.default.createElement("div",{className:Y,style:G},l.default.createElement("div",{ref:Nr,tabIndex:ne.length&&I.length?0:void 0,onFocus:S=>{S.target.blur(),ie({col:0,row:0})}}),l.default.createElement(y.Grid,{columns:U,outerRef:Ge,columnWidths:Le,hasStickyRightColumn:ae,displayHeight:Mi,data:I,fullWidth:Ai,headerRowHeight:de,activeCell:E,innerRef:cr,rowHeight:It,rowKey:re,selection:N,rowClassName:_r,editing:ce,getContextMenuItems:ql,setRowData:Tl,deleteRows:Bt,insertRowAfter:nt,duplicateRows:Dt,stopEditing:Ir,cellClassName:ar,onScroll:lr},l.default.createElement(O.SelectionRect,{columnRights:Je,columnWidths:Le,activeCell:E,selection:N,headerRowHeight:de,rowHeight:It,hasStickyRightColumn:ae,dataLength:I.length,viewHeight:ft,viewWidth:jt,contentWidth:Ai?void 0:Rl,edges:Nl,editing:ce,isCellDisabled:ke,expandSelection:jl})),l.default.createElement("div",{ref:Rr,tabIndex:ne.length&&I.length?0:void 0,onFocus:S=>{S.target.blur(),ie({col:U.length-(ae?3:2),row:I.length-1})}}),!$&&Ee&&l.default.createElement(Ee,{addRows:S=>nt(I.length-1,S)}),Tt&&kt.length>0&&l.default.createElement(H,{clientX:Tt.x,clientY:Tt.y,cursorIndex:Tt.cursorIndex,items:kt,close:()=>Fe(null)}))})),n.DataSheetGrid.displayName="DataSheetGrid"}(Pe)),Pe}var at={},ms;function Cu(){if(ms)return at;ms=1;var n=at&&at.__rest||function(a,l){var o={};for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&l.indexOf(e)<0&&(o[e]=a[e]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,e=Object.getOwnPropertySymbols(a);t<e.length;t++)l.indexOf(e[t])<0&&Object.prototype.propertyIsEnumerable.call(a,e[t])&&(o[e[t]]=a[e[t]]);return o},d=at&&at.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(at,"__esModule",{value:!0}),at.StaticDataSheetGrid=void 0;const g=he(),f=Ha(),i=d(he());return at.StaticDataSheetGrid=i.default.forwardRef((a,l)=>{var{columns:o,gutterColumn:e,stickyRightColumn:t,addRowsComponent:r,createRow:s,duplicateRow:u,style:v,rowKey:w,onFocus:b,onBlur:h,onActiveCellChange:c,onSelectionChange:p,rowClassName:m,rowHeight:_}=a,y=n(a,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[O]=(0,g.useState)({columns:o,gutterColumn:e,stickyRightColumn:t,addRowsComponent:r,createRow:s,duplicateRow:u,style:v,rowKey:w,onFocus:b,onBlur:h,onActiveCellChange:c,onSelectionChange:p,rowClassName:m,rowHeight:_});return i.default.createElement(f.DataSheetGrid,Object.assign({},O,y,{rowHeight:typeof _=="number"?_:O.rowHeight,ref:l}))}),at}var Se={},Zt={},ws;function Eu(){if(ws)return Zt;ws=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.useFirstRender=void 0;const n=he(),d=()=>{const g=(0,n.useRef)(!0),f=g.current;return g.current=!1,f};return Zt.useFirstRender=d,Zt}var gs;function mr(){if(gs)return Se;gs=1;var n=Se&&Se.__createBinding||(Object.create?function(t,r,s,u){u===void 0&&(u=s);var v=Object.getOwnPropertyDescriptor(r,s);(!v||("get"in v?!r.__esModule:v.writable||v.configurable))&&(v={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(t,u,v)}:function(t,r,s,u){u===void 0&&(u=s),t[u]=r[s]}),d=Se&&Se.__setModuleDefault||(Object.create?function(t,r){Object.defineProperty(t,"default",{enumerable:!0,value:r})}:function(t,r){t.default=r}),g=Se&&Se.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&n(r,t,s);return d(r,t),r},f=Se&&Se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Se,"__esModule",{value:!0}),Se.createTextColumn=Se.textColumn=void 0;const i=g(he()),a=f(Vt()),l=Eu(),o=i.default.memo(({active:t,focus:r,rowData:s,setRowData:u,columnData:{placeholder:v,alignRight:w,formatInputOnFocus:b,formatBlurredInput:h,parseUserInput:c,continuousUpdates:p}})=>{const m=(0,i.useRef)(null),_=(0,l.useFirstRender)(),y=(0,i.useRef)({rowData:s,formatInputOnFocus:b,formatBlurredInput:h,setRowData:u,parseUserInput:c,continuousUpdates:p,firstRender:_,focusedAt:0,changedAt:0,escPressed:!1});return y.current={rowData:s,formatInputOnFocus:b,formatBlurredInput:h,setRowData:u,parseUserInput:c,continuousUpdates:p,firstRender:_,focusedAt:y.current.focusedAt,changedAt:y.current.changedAt,escPressed:y.current.escPressed},(0,i.useLayoutEffect)(()=>{r?(m.current&&(m.current.value=y.current.formatInputOnFocus(y.current.rowData),m.current.focus(),m.current.select()),y.current.escPressed=!1,y.current.focusedAt=Date.now()):m.current&&(!y.current.escPressed&&!y.current.continuousUpdates&&!y.current.firstRender&&y.current.changedAt>=y.current.focusedAt&&y.current.setRowData(y.current.parseUserInput(m.current.value)),m.current.blur())},[r]),(0,i.useEffect)(()=>{!r&&m.current&&(m.current.value=y.current.formatBlurredInput(s))},[r,s]),i.default.createElement("input",{defaultValue:h(s),className:(0,a.default)("dsg-input",w&&"dsg-input-align-right"),placeholder:t?v:void 0,tabIndex:-1,ref:m,style:{pointerEvents:r?"auto":"none"},onChange:O=>{y.current.changedAt=Date.now(),p&&u(c(O.target.value))},onKeyDown:O=>{O.key==="Escape"&&(y.current.escPressed=!0)}})});o.displayName="TextComponent",Se.textColumn=e();function e({placeholder:t,alignRight:r=!1,continuousUpdates:s=!0,deletedValue:u=null,parseUserInput:v=p=>p.trim()||null,formatBlurredInput:w=p=>String(p??""),formatInputOnFocus:b=p=>String(p??""),formatForCopy:h=p=>String(p??""),parsePastedValue:c=p=>p.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:o,columnData:{placeholder:t,alignRight:r,continuousUpdates:s,formatInputOnFocus:b,formatBlurredInput:w,parseUserInput:v},deleteValue:()=>u,copyValue:({rowData:p})=>h(p),pasteValue:({value:p})=>c(p),isCellEmpty:({rowData:p})=>p==null}}return Se.createTextColumn=e,Se}var Xe={},_s;function Nu(){if(_s)return Xe;_s=1;var n=Xe&&Xe.__createBinding||(Object.create?function(l,o,e,t){t===void 0&&(t=e);var r=Object.getOwnPropertyDescriptor(o,e);(!r||("get"in r?!o.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return o[e]}}),Object.defineProperty(l,t,r)}:function(l,o,e,t){t===void 0&&(t=e),l[t]=o[e]}),d=Xe&&Xe.__setModuleDefault||(Object.create?function(l,o){Object.defineProperty(l,"default",{enumerable:!0,value:o})}:function(l,o){l.default=o}),g=Xe&&Xe.__importStar||function(l){if(l&&l.__esModule)return l;var o={};if(l!=null)for(var e in l)e!=="default"&&Object.prototype.hasOwnProperty.call(l,e)&&n(o,l,e);return d(o,l),o};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.checkboxColumn=void 0;const f=g(he()),i=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],a=f.default.memo(({focus:l,rowData:o,setRowData:e,active:t,stopEditing:r,disabled:s})=>{const u=(0,f.useRef)(null);return(0,f.useLayoutEffect)(()=>{l&&(e(!o),r({nextRow:!1}))},[l,r]),f.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:u,disabled:s,checked:!!o,onMouseDown:()=>!t&&e(!o),onChange:()=>null})});return a.displayName="CheckboxComponent",Xe.checkboxColumn={component:a,deleteValue:()=>!1,copyValue:({rowData:l})=>l?"YES":"NO",pasteValue:({value:l})=>!i.includes(l.toLowerCase()),isCellEmpty:({rowData:l})=>!l},Xe}var en={},ys;function Ru(){if(ys)return en;ys=1,Object.defineProperty(en,"__esModule",{value:!0}),en.floatColumn=void 0;const n=mr();return en.floatColumn=(0,n.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat().format(d):"",parseUserInput:d=>{const g=parseFloat(d);return isNaN(g)?null:g},parsePastedValue:d=>{const g=parseFloat(d);return isNaN(g)?null:g}}),en}var tn={},Os;function Iu(){if(Os)return tn;Os=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.intColumn=void 0;const n=mr();return tn.intColumn=(0,n.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat().format(d):"",parseUserInput:d=>{const g=parseFloat(d);return isNaN(g)?null:Math.round(g)},parsePastedValue:d=>{const g=parseFloat(d);return isNaN(g)?null:Math.round(g)}}),tn}var nn={},xs;function ju(){if(xs)return nn;xs=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.percentColumn=void 0;const n=mr(),d=1e12,g=1e10;return nn.percentColumn=(0,n.createTextColumn)({alignRight:!0,formatBlurredInput:f=>typeof f=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(f):"",formatInputOnFocus:f=>typeof f=="number"&&!isNaN(f)?String(Math.round(f*d)/g):"",parseUserInput:f=>{const i=parseFloat(f);return isNaN(i)?null:i/100},parsePastedValue:f=>{const i=parseFloat(f);return isNaN(i)?null:i}}),nn}var Be={},Ss;function Tu(){if(Ss)return Be;Ss=1;var n=Be&&Be.__createBinding||(Object.create?function(o,e,t,r){r===void 0&&(r=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(o,r,s)}:function(o,e,t,r){r===void 0&&(r=t),o[r]=e[t]}),d=Be&&Be.__setModuleDefault||(Object.create?function(o,e){Object.defineProperty(o,"default",{enumerable:!0,value:e})}:function(o,e){o.default=e}),g=Be&&Be.__importStar||function(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var t in o)t!=="default"&&Object.prototype.hasOwnProperty.call(o,t)&&n(e,o,t);return d(e,o),e},f=Be&&Be.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Be,"__esModule",{value:!0}),Be.dateColumn=void 0;const i=g(he()),a=f(Vt()),l=i.default.memo(({focus:o,active:e,rowData:t,setRowData:r})=>{var s;const u=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{var v,w;o?(v=u.current)===null||v===void 0||v.select():(w=u.current)===null||w===void 0||w.blur()},[o]),i.default.createElement("input",{className:(0,a.default)("dsg-input",!e&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:u,style:{pointerEvents:o?"auto":"none",opacity:t||e?void 0:0},value:(s=t==null?void 0:t.toISOString().substr(0,10))!==null&&s!==void 0?s:"",onChange:v=>{const w=new Date(v.target.value);r(isNaN(w.getTime())?null:w)}})});return l.displayName="DateComponent",Be.dateColumn={component:l,deleteValue:()=>null,copyValue:({rowData:o})=>o?o.toISOString().substr(0,10):null,pasteValue:({value:o})=>{const e=new Date(o.replace(/\.\s?|\//g,"-"));return isNaN(e.getTime())?null:e},minWidth:170,isCellEmpty:({rowData:o})=>!o},Be}var qe={},Cs;function ku(){if(Cs)return qe;Cs=1;var n=qe&&qe.__createBinding||(Object.create?function(o,e,t,r){r===void 0&&(r=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(o,r,s)}:function(o,e,t,r){r===void 0&&(r=t),o[r]=e[t]}),d=qe&&qe.__setModuleDefault||(Object.create?function(o,e){Object.defineProperty(o,"default",{enumerable:!0,value:e})}:function(o,e){o.default=e}),g=qe&&qe.__importStar||function(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var t in o)t!=="default"&&Object.prototype.hasOwnProperty.call(o,t)&&n(e,o,t);return d(e,o),e},f=qe&&qe.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(qe,"__esModule",{value:!0}),qe.isoDateColumn=void 0;const i=g(he()),a=f(Vt()),l=i.default.memo(({focus:o,active:e,rowData:t,setRowData:r})=>{const s=(0,i.useRef)(null);return(0,i.useLayoutEffect)(()=>{var u,v;o?(u=s.current)===null||u===void 0||u.select():(v=s.current)===null||v===void 0||v.blur()},[o]),i.default.createElement("input",{className:(0,a.default)("dsg-input",!e&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:s,style:{pointerEvents:o?"auto":"none",opacity:t||e?void 0:0},value:t??"",onChange:u=>{const v=new Date(u.target.value);r(isNaN(v.getTime())?null:v.toISOString().substr(0,10))}})});return l.displayName="IsoDateComponent",qe.isoDateColumn={component:l,deleteValue:()=>null,copyValue:({rowData:o})=>o,pasteValue:({value:o})=>{const e=new Date(o.replace(/\.\s?|\//g,"-"));return isNaN(e.getTime())?null:e.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:o})=>!o},qe}var Ve={},Es;function Mu(){if(Es)return Ve;Es=1;var n=Ve&&Ve.__createBinding||(Object.create?function(o,e,t,r){r===void 0&&(r=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(o,r,s)}:function(o,e,t,r){r===void 0&&(r=t),o[r]=e[t]}),d=Ve&&Ve.__setModuleDefault||(Object.create?function(o,e){Object.defineProperty(o,"default",{enumerable:!0,value:e})}:function(o,e){o.default=e}),g=Ve&&Ve.__importStar||function(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var t in o)t!=="default"&&Object.prototype.hasOwnProperty.call(o,t)&&n(e,o,t);return d(e,o),e},f=Ve&&Ve.__rest||function(o,e){var t={};for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&e.indexOf(r)<0&&(t[r]=o[r]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(o);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(o,r[s])&&(t[r[s]]=o[r[s]]);return t};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.keyColumn=void 0;const i=g(he()),a=o=>{var{columnData:{key:e,original:t},rowData:r,setRowData:s}=o,u=f(o,["columnData","rowData","setRowData"]);const v=(0,i.useRef)(r);v.current=r;const w=(0,i.useCallback)(h=>{s(Object.assign(Object.assign({},v.current),{[e]:h}))},[e,s]);if(!t.component)return i.default.createElement(i.default.Fragment,null);const b=t.component;return i.default.createElement(b,Object.assign({columnData:t.columnData,setRowData:w,rowData:r[e]},u))},l=(o,e)=>Object.assign(Object.assign({id:o},e),{columnData:{key:o,original:e},component:a,copyValue:({rowData:t,rowIndex:r})=>{var s,u;return(u=(s=e.copyValue)===null||s===void 0?void 0:s.call(e,{rowData:t[o],rowIndex:r}))!==null&&u!==void 0?u:null},deleteValue:({rowData:t,rowIndex:r})=>{var s,u;return Object.assign(Object.assign({},t),{[o]:(u=(s=e.deleteValue)===null||s===void 0?void 0:s.call(e,{rowData:t[o],rowIndex:r}))!==null&&u!==void 0?u:null})},pasteValue:({rowData:t,value:r,rowIndex:s})=>{var u,v;return Object.assign(Object.assign({},t),{[o]:(v=(u=e.pasteValue)===null||u===void 0?void 0:u.call(e,{rowData:t[o],value:r,rowIndex:s}))!==null&&v!==void 0?v:null})},disabled:typeof e.disabled=="function"?({rowData:t,rowIndex:r})=>{var s;return typeof e.disabled=="function"?e.disabled({rowData:t[o],rowIndex:r}):(s=e.disabled)!==null&&s!==void 0?s:!1}:e.disabled,cellClassName:typeof e.cellClassName=="function"?({rowData:t,rowIndex:r,columnId:s})=>{var u;return typeof e.cellClassName=="function"?e.cellClassName({rowData:t[o],rowIndex:r,columnId:s}):(u=e.cellClassName)!==null&&u!==void 0?u:void 0}:e.cellClassName,isCellEmpty:({rowData:t,rowIndex:r})=>{var s,u;return(u=(s=e.isCellEmpty)===null||s===void 0?void 0:s.call(e,{rowData:t[o],rowIndex:r}))!==null&&u!==void 0?u:!1}});return Ve.keyColumn=l,Ve}var Ns;function Au(){return Ns||(Ns=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.renderContextMenuItem=n.createContextMenuComponent=n.createAddRowsComponent=n.keyColumn=n.isoDateColumn=n.dateColumn=n.percentColumn=n.intColumn=n.floatColumn=n.checkboxColumn=n.createTextColumn=n.textColumn=n.DataSheetGrid=n.DynamicDataSheetGrid=void 0;const d=Ha(),g=Cu();n.DynamicDataSheetGrid=d.DataSheetGrid,n.DataSheetGrid=g.StaticDataSheetGrid;var f=mr();Object.defineProperty(n,"textColumn",{enumerable:!0,get:function(){return f.textColumn}}),Object.defineProperty(n,"createTextColumn",{enumerable:!0,get:function(){return f.createTextColumn}});var i=Nu();Object.defineProperty(n,"checkboxColumn",{enumerable:!0,get:function(){return i.checkboxColumn}});var a=Ru();Object.defineProperty(n,"floatColumn",{enumerable:!0,get:function(){return a.floatColumn}});var l=Iu();Object.defineProperty(n,"intColumn",{enumerable:!0,get:function(){return l.intColumn}});var o=ju();Object.defineProperty(n,"percentColumn",{enumerable:!0,get:function(){return o.percentColumn}});var e=Tu();Object.defineProperty(n,"dateColumn",{enumerable:!0,get:function(){return e.dateColumn}});var t=ku();Object.defineProperty(n,"isoDateColumn",{enumerable:!0,get:function(){return t.isoDateColumn}});var r=Mu();Object.defineProperty(n,"keyColumn",{enumerable:!0,get:function(){return r.keyColumn}});var s=Ja();Object.defineProperty(n,"createAddRowsComponent",{enumerable:!0,get:function(){return s.createAddRowsComponent}});var u=Ka();Object.defineProperty(n,"createContextMenuComponent",{enumerable:!0,get:function(){return u.createContextMenuComponent}}),Object.defineProperty(n,"renderContextMenuItem",{enumerable:!0,get:function(){return u.defaultRenderItem}})}(Mr)),Mr}var $r=Au();async function Pu(n,d){const g=await n.gridServicesClient.postRepoV1GridSessionAsyncStart({createGridRequest:d});if(!g.token)throw new Error("No async job token returned from startGridSession");return(await Wl(()=>n.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:g.token}))).responseBody}const Du=n=>{const{synapseClient:d}=Aa();return zl({...n,mutationFn:async g=>await Pu(d,g)})};var Ur={};const ve=ka(Gl);var Lr={},Rs;function Bu(){return Rs||(Rs=1,Object.defineProperty(Lr,"__esModule",{value:!0})),Lr}var Fr={},zr={},Is;function qu(){return Is||(Is=1,Object.defineProperty(zr,"__esModule",{value:!0})),zr}var Wr={},$e={},js;function gi(){if(js)return $e;js=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.JsonCrdtPatchOpcodeOverlay=$e.JsonCrdtPatchOpcode=$e.JsonCrdtDataType=$e.SYSTEM_SESSION_TIME=$e.SESSION=void 0;var n;(function(a){a[a.SYSTEM=0]="SYSTEM",a[a.SERVER=1]="SERVER",a[a.GLOBAL=2]="GLOBAL",a[a.LOCAL=3]="LOCAL",a[a.MAX=9007199254740991]="MAX"})(n||($e.SESSION=n={}));var d;(function(a){a[a.ORIGIN=0]="ORIGIN",a[a.UNDEFINED=1]="UNDEFINED"})(d||($e.SYSTEM_SESSION_TIME=d={}));var g;(function(a){a[a.con=0]="con",a[a.val=1]="val",a[a.obj=2]="obj",a[a.vec=3]="vec",a[a.str=4]="str",a[a.bin=5]="bin",a[a.arr=6]="arr"})(g||($e.JsonCrdtDataType=g={}));var f;(function(a){a[a.new_con=0]="new_con",a[a.new_val=1]="new_val",a[a.new_obj=2]="new_obj",a[a.new_vec=3]="new_vec",a[a.new_str=4]="new_str",a[a.new_bin=5]="new_bin",a[a.new_arr=6]="new_arr",a[a.ins_val=9]="ins_val",a[a.ins_obj=10]="ins_obj",a[a.ins_vec=11]="ins_vec",a[a.ins_str=12]="ins_str",a[a.ins_bin=13]="ins_bin",a[a.ins_arr=14]="ins_arr",a[a.del=16]="del",a[a.nop=17]="nop"})(f||($e.JsonCrdtPatchOpcode=f={}));var i;return function(a){a[a.new_con=0]="new_con",a[a.new_val=8]="new_val",a[a.new_obj=16]="new_obj",a[a.new_vec=24]="new_vec",a[a.new_str=32]="new_str",a[a.new_bin=40]="new_bin",a[a.new_arr=48]="new_arr",a[a.ins_val=72]="ins_val",a[a.ins_obj=80]="ins_obj",a[a.ins_vec=88]="ins_vec",a[a.ins_str=96]="ins_str",a[a.ins_bin=104]="ins_bin",a[a.ins_arr=112]="ins_arr",a[a.del=128]="del",a[a.nop=136]="nop"}(i||($e.JsonCrdtPatchOpcodeOverlay=i={})),$e}var Ts;function Vu(){return Ts||(Ts=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ServerClockVector=n.ClockVector=n.LogicalClock=n.interval=n.printTs=n.containsId=n.contains=n.compare=n.equal=n.tick=n.tss=n.ts=n.Timespan=n.Timestamp=void 0;const d=gi();class g{constructor(c,p){this.sid=c,this.time=p}}n.Timestamp=g;class f{constructor(c,p,m){this.sid=c,this.time=p,this.span=m}}n.Timespan=f;const i=(h,c)=>new g(h,c);n.ts=i;const a=(h,c,p)=>new f(h,c,p);n.tss=a;const l=(h,c)=>(0,n.ts)(h.sid,h.time+c);n.tick=l;const o=(h,c)=>h.time===c.time&&h.sid===c.sid;n.equal=o;const e=(h,c)=>{const p=h.time,m=c.time;if(p>m)return 1;if(p<m)return-1;const _=h.sid,y=c.sid;return _>y?1:_<y?-1:0};n.compare=e;const t=(h,c,p,m)=>{if(h.sid!==p.sid)return!1;const _=h.time,y=p.time;return!(_>y||_+c<y+m)};n.contains=t;const r=(h,c,p)=>{if(h.sid!==p.sid)return!1;const m=h.time,_=p.time;return!(m>_||m+c<_+1)};n.containsId=r;const s=h=>{if(h.sid===d.SESSION.SERVER)return"."+h.time;let c=""+h.sid;return c.length>4&&(c=".."+c.slice(c.length-4)),c+"."+h.time};n.printTs=s;const u=(h,c,p)=>new f(h.sid,h.time+c,p);n.interval=u;class v extends g{tick(c){const p=new g(this.sid,this.time);return this.time+=c,p}}n.LogicalClock=v;class w extends v{constructor(){super(...arguments),this.peers=new Map}observe(c,p){const m=c.time+p-1,_=c.sid;if(_!==this.sid){const y=this.peers.get(c.sid);y?m>y.time&&(y.time=m):this.peers.set(c.sid,(0,n.ts)(_,m))}m>=this.time&&(this.time=m+1)}clone(){return this.fork(this.sid)}fork(c){const p=new w(c,this.time);return c!==this.sid&&p.observe((0,n.tick)(this,-1),1),this.peers.forEach(m=>{p.observe(m,1)}),p}toString(c=""){const p=this.peers.size;let m=1,_="";return this.peers.forEach(y=>{_+=`
${c}${m===p?"└─":"├─"} ${y.sid}.${y.time}`,m++}),`clock ${this.sid}.${this.time}${_}`}}n.ClockVector=w;class b extends v{constructor(){super(...arguments),this.peers=new Map}observe(c,p){if(c.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<c.time)throw new Error("TIME_TRAVEL");const m=c.time+p;m>this.time&&(this.time=m)}clone(){return this.fork()}fork(){return new b(d.SESSION.SERVER,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}n.ServerClockVector=b}(Wr)),Wr}var ks;function pe(){return ks||(ks=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(qu(),n),d.__exportStar(Vu(),n)}(Fr)),Fr}var te={},rn={},Ms;function Ze(){if(Ms)return rn;Ms=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.printTree=void 0;const n=(d="",g)=>{let f="",i=g.length-1;for(;i>=0&&!g[i];i--);for(let a=0;a<=i;a++){const l=g[a];if(!l)continue;const o=a===i,e=l(d+(o?" ":"│")+"  "),t=e?o?"└─":"├─":"│";f+=`
`+d+t+(e?" "+e:"")}return f};return rn.printTree=n,rn}var As;function $t(){if(As)return te;As=1,Object.defineProperty(te,"__esModule",{value:!0}),te.NopOp=te.DelOp=te.InsArrOp=te.InsBinOp=te.InsStrOp=te.InsVecOp=te.InsObjOp=te.InsValOp=te.NewArrOp=te.NewBinOp=te.NewStrOp=te.NewVecOp=te.NewObjOp=te.NewValOp=te.NewConOp=void 0;const n=Ze(),d=pe();class g{constructor(p,m){this.id=p,this.val=m}span(){return 1}name(){return"new_con"}toString(p=""){const m=this.val,_="Uint8Array",y=m instanceof d.Timestamp?`{ ${(0,d.printTs)(m)} }`:m instanceof Uint8Array?m.length<13?`${_} { ${(""+m).replaceAll(",",", ")} }`:`${_}(${m.length})`:`{ ${JSON.stringify(m)} }`;return`${this.name()} ${(0,d.printTs)(this.id)} ${y}`}}te.NewConOp=g;class f{constructor(p){this.id=p}span(){return 1}name(){return"new_val"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewValOp=f;class i{constructor(p){this.id=p}span(){return 1}name(){return"new_obj"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewObjOp=i;class a{constructor(p){this.id=p}span(){return 1}name(){return"new_vec"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewVecOp=a;class l{constructor(p){this.id=p}span(){return 1}name(){return"new_str"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewStrOp=l;class o{constructor(p){this.id=p}span(){return 1}name(){return"new_bin"}toString(p=""){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewBinOp=o;class e{constructor(p){this.id=p}span(){return 1}name(){return"new_arr"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}`}}te.NewArrOp=e;class t{constructor(p,m,_){this.id=p,this.obj=m,this.val=_}span(){return 1}name(){return"ins_val"}toString(p=""){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)}, val = ${(0,d.printTs)(this.val)}`}}te.InsValOp=t;class r{constructor(p,m,_){this.id=p,this.obj=m,this.data=_}span(){return 1}name(){return"ins_obj"}toString(p=""){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)}`+(0,n.printTree)(p,this.data.map(_=>y=>`${JSON.stringify(_[0])}: ${(0,d.printTs)(_[1])}`))}}te.InsObjOp=r;class s{constructor(p,m,_){this.id=p,this.obj=m,this.data=_}span(){return 1}name(){return"ins_vec"}toString(p=""){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)}`+(0,n.printTree)(p,this.data.map(_=>y=>`${_[0]}: ${(0,d.printTs)(_[1])}`))}}te.InsVecOp=s;class u{constructor(p,m,_,y){this.id=p,this.obj=m,this.ref=_,this.data=y}span(){return this.data.length}name(){return"ins_str"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)} { ${(0,d.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}te.InsStrOp=u;class v{constructor(p,m,_,y){this.id=p,this.obj=m,this.ref=_,this.data=y}span(){return this.data.length}name(){return"ins_bin"}toString(p=""){const m=(0,d.printTs)(this.ref);return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)} { ${m} ← ${this.data} }`}}te.InsBinOp=v;class w{constructor(p,m,_,y){this.id=p,this.obj=m,this.ref=_,this.data=y}span(){return this.data.length}name(){return"ins_arr"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.span()}, obj = ${(0,d.printTs)(this.obj)} { ${(0,d.printTs)(this.ref)} ← ${this.data.map(d.printTs).join(", ")} }`}}te.InsArrOp=w;class b{constructor(p,m,_){this.id=p,this.obj=m,this.what=_}span(){return 1}name(){return"del"}toString(){const p=this.what.map(m=>(0,d.printTs)(m)+"!"+m.span).join(", ");return`${this.name()} ${(0,d.printTs)(this.id)}, obj = ${(0,d.printTs)(this.obj)} { ${p} }`}}te.DelOp=b;class h{constructor(p,m){this.id=p,this.len=m}span(){return this.len}name(){return"nop"}toString(){return`${this.name()} ${(0,d.printTs)(this.id)}!${this.len}`}}return te.NopOp=h,te}var sn={},Gr={},on={},Jr={},Ps;function xe(){return Ps||(Ps=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ORIGIN=void 0;const d=ve,g=pe(),f=gi();d.__exportStar(gi(),n),n.ORIGIN=(0,g.ts)(f.SESSION.SYSTEM,f.SYSTEM_SESSION_TIME.ORIGIN)}(Jr)),Jr}var an={},ln={},cn={},Ds;function $u(){if(Ds)return cn;Ds=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.Slice=void 0;let n=class{constructor(g,f,i,a){this.uint8=g,this.view=f,this.start=i,this.end=a}subarray(){return this.uint8.subarray(this.start,this.end)}};return cn.Slice=n,cn}var Bs;function Xa(){if(Bs)return ln;Bs=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.Writer=void 0;const n=$u(),d=new Uint8Array([]),g=new DataView(d.buffer),f=typeof je.Buffer=="function",i=f?je.Buffer.prototype.utf8Write:null,a=f?je.Buffer.from:null,l=typeof TextEncoder<"u"?new TextEncoder:null;let o=class{constructor(t=64*1024){this.allocSize=t,this.view=g,this.x0=0,this.x=0,this.uint8=new Uint8Array(t),this.size=t,this.view=new DataView(this.uint8.buffer)}grow(t){const r=this.x0,s=this.x,u=this.uint8,v=new Uint8Array(t),w=new DataView(v.buffer),b=u.subarray(r,s);v.set(b,0),this.x=s-r,this.x0=0,this.uint8=v,this.size=t,this.view=w}ensureCapacity(t){const r=this.size,s=r-this.x;if(s<t){const u=r-this.x0,v=t-s,w=u+v;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(t){this.ensureCapacity(t),this.x+=t}reset(){this.x0=this.x}newBuffer(t){const r=this.uint8=new Uint8Array(t);this.size=t,this.view=new DataView(r.buffer),this.x=this.x0=0}flush(){const t=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,t}flushSlice(){const t=new n.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,t}u8(t){this.ensureCapacity(1),this.uint8[this.x++]=t}u16(t){this.ensureCapacity(2),this.view.setUint16(this.x,t),this.x+=2}u32(t){this.ensureCapacity(4),this.view.setUint32(this.x,t),this.x+=4}i32(t){this.ensureCapacity(4),this.view.setInt32(this.x,t),this.x+=4}u64(t){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(t)),this.x+=8}f64(t){this.ensureCapacity(8),this.view.setFloat64(this.x,t),this.x+=8}u8u16(t,r){this.ensureCapacity(3);let s=this.x;this.uint8[s++]=t,this.uint8[s++]=r>>>8,this.uint8[s++]=r&255,this.x=s}u8u32(t,r){this.ensureCapacity(5);let s=this.x;this.uint8[s++]=t,this.view.setUint32(s,r),this.x=s+4}u8u64(t,r){this.ensureCapacity(9);let s=this.x;this.uint8[s++]=t,this.view.setBigUint64(s,BigInt(r)),this.x=s+8}u8f32(t,r){this.ensureCapacity(5);let s=this.x;this.uint8[s++]=t,this.view.setFloat32(s,r),this.x=s+4}u8f64(t,r){this.ensureCapacity(9);let s=this.x;this.uint8[s++]=t,this.view.setFloat64(s,r),this.x=s+8}buf(t,r){this.ensureCapacity(r);const s=this.x;this.uint8.set(t,s),this.x=s+r}utf8(t){const r=t.length*4;if(r<168)return this.utf8Native(t);if(i){const s=i.call(this.uint8,t,this.x,r);return this.x+=s,s}else if(a){const s=this.uint8,u=s.byteOffset+this.x,w=a(s.buffer).subarray(u,u+r).write(t,0,r,"utf8");return this.x+=w,w}else if(r>1024&&l){const s=l.encodeInto(t,this.uint8.subarray(this.x,this.x+r)).written;return this.x+=s,s}return this.utf8Native(t)}utf8Native(t){const r=t.length,s=this.uint8;let u=this.x,v=0;for(;v<r;){let b=t.charCodeAt(v++);if((b&4294967168)===0){s[u++]=b;continue}else if((b&4294965248)===0)s[u++]=b>>6&31|192;else{if(b>=55296&&b<=56319&&v<r){const h=t.charCodeAt(v);(h&64512)===56320&&(v++,b=((b&1023)<<10)+(h&1023)+65536)}(b&4294901760)===0?(s[u++]=b>>12&15|224,s[u++]=b>>6&63|128):(s[u++]=b>>18&7|240,s[u++]=b>>12&63|128,s[u++]=b>>6&63|128)}s[u++]=b&63|128}const w=u-this.x;return this.x=u,w}ascii(t){const r=t.length;this.ensureCapacity(r);const s=this.uint8;let u=this.x,v=0;for(;v<r;)s[u++]=t.charCodeAt(v++);this.x=u}};return ln.Writer=o,ln}var qs;function xi(){if(qs)return an;qs=1,Object.defineProperty(an,"__esModule",{value:!0}),an.CrdtWriter=void 0;const n=Xa();let d=class extends n.Writer{id(f,i){f<=7&&i<=15?this.u8(f<<4|i):(this.b1vu56(1,f),this.vu57(i))}vu57(f){if(f<=127)this.u8(f);else if(f<=16383){this.ensureCapacity(2);const i=this.uint8;i[this.x++]=128|f&127,i[this.x++]=f>>>7}else if(f<=2097151){this.ensureCapacity(3);const i=this.uint8;i[this.x++]=128|f&127,i[this.x++]=128|f>>>7&127,i[this.x++]=f>>>14}else if(f<=268435455){this.ensureCapacity(4);const i=this.uint8;i[this.x++]=128|f&127,i[this.x++]=128|f>>>7&127,i[this.x++]=128|f>>>14&127,i[this.x++]=f>>>21}else{let i=f|0;i<0&&(i+=4294967296);const a=(f-i)/4294967296;if(f<=34359738367){this.ensureCapacity(5);const l=this.uint8;l[this.x++]=128|f&127,l[this.x++]=128|f>>>7&127,l[this.x++]=128|f>>>14&127,l[this.x++]=128|f>>>21&127,l[this.x++]=a<<4|f>>>28}else if(f<=4398046511103){this.ensureCapacity(6);const l=this.uint8;l[this.x++]=128|f&127,l[this.x++]=128|f>>>7&127,l[this.x++]=128|f>>>14&127,l[this.x++]=128|f>>>21&127,l[this.x++]=128|(a&7)<<4|f>>>28,l[this.x++]=a>>>3}else if(f<=562949953421311){this.ensureCapacity(7);const l=this.uint8;l[this.x++]=128|f&127,l[this.x++]=128|f>>>7&127,l[this.x++]=128|f>>>14&127,l[this.x++]=128|f>>>21&127,l[this.x++]=128|(a&7)<<4|f>>>28,l[this.x++]=128|(a&1016)>>>3,l[this.x++]=a>>>10}else{this.ensureCapacity(8);const l=this.uint8;l[this.x++]=128|f&127,l[this.x++]=128|f>>>7&127,l[this.x++]=128|f>>>14&127,l[this.x++]=128|f>>>21&127,l[this.x++]=128|(a&7)<<4|f>>>28,l[this.x++]=128|(a&1016)>>>3,l[this.x++]=128|(a&130048)>>>10,l[this.x++]=a>>>17}}}b1vu56(f,i){if(i<=63)this.u8(f<<7|i);else{const a=f<<7|64;if(i<=8191){this.ensureCapacity(2);const l=this.uint8;l[this.x++]=a|i&63,l[this.x++]=i>>>6}else if(i<=1048575){this.ensureCapacity(3);const l=this.uint8;l[this.x++]=a|i&63,l[this.x++]=128|i>>>6&127,l[this.x++]=i>>>13}else if(i<=134217727){this.ensureCapacity(4);const l=this.uint8;l[this.x++]=a|i&63,l[this.x++]=128|i>>>6&127,l[this.x++]=128|i>>>13&127,l[this.x++]=i>>>20}else{let l=i|0;l<0&&(l+=4294967296);const o=(i-l)/4294967296;if(i<=17179869183){this.ensureCapacity(5);const e=this.uint8;e[this.x++]=a|i&63,e[this.x++]=128|i>>>6&127,e[this.x++]=128|i>>>13&127,e[this.x++]=128|i>>>20&127,e[this.x++]=o<<5|i>>>27}else if(i<=2199023255551){this.ensureCapacity(6);const e=this.uint8;e[this.x++]=a|i&63,e[this.x++]=128|i>>>6&127,e[this.x++]=128|i>>>13&127,e[this.x++]=128|i>>>20&127,e[this.x++]=128|(o&3)<<5|i>>>27,e[this.x++]=o>>>2}else if(i<=0xffffffffffff){this.ensureCapacity(7);const e=this.uint8;e[this.x++]=a|i&63,e[this.x++]=128|i>>>6&127,e[this.x++]=128|i>>>13&127,e[this.x++]=128|i>>>20&127,e[this.x++]=128|(o&3)<<5|i>>>27,e[this.x++]=128|(o&508)>>>2,e[this.x++]=o>>>9}else{this.ensureCapacity(8);const e=this.uint8;e[this.x++]=a|i&63,e[this.x++]=128|i>>>6&127,e[this.x++]=128|i>>>13&127,e[this.x++]=128|i>>>20&127,e[this.x++]=128|(o&3)<<5|i>>>27,e[this.x++]=128|(o&508)>>>2,e[this.x++]=128|(o&65024)>>>9,e[this.x++]=o>>>16}}}}};return an.CrdtWriter=d,an}var un={},dn={},Vs;function Uu(){if(Vs)return dn;Vs=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.isFloat32=void 0;const n=new DataView(new ArrayBuffer(4)),d=g=>(n.setFloat32(0,g),g===n.getFloat32(0));return dn.isFloat32=d,dn}var fn={},$s;function Ya(){if($s)return fn;$s=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.JsonPackExtension=void 0;let n=class{constructor(g,f){this.tag=g,this.val=f}};return fn.JsonPackExtension=n,fn}var hn={},Us;function Lu(){if(Us)return hn;Us=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.CborEncoderFast=void 0;const n=Xa(),d=Number.isSafeInteger;let g=class{constructor(i=new n.Writer){this.writer=i}encode(i){return this.writeAny(i),this.writer.flush()}encodeToSlice(i){return this.writeAny(i),this.writer.flushSlice()}writeAny(i){switch(typeof i){case"number":return this.writeNumber(i);case"string":return this.writeStr(i);case"boolean":return this.writer.u8(244+ +i);case"object":{if(!i)return this.writer.u8(246);switch(i.constructor){case Array:return this.writeArr(i);default:return this.writeObj(i)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(i){i?this.writer.u8(245):this.writer.u8(244)}writeNumber(i){d(i)?this.writeInteger(i):typeof i=="bigint"?this.writeBigInt(i):this.writeFloat(i)}writeBigInt(i){i>=0?this.writeBigUint(i):this.writeBigSint(i)}writeBigUint(i){if(i<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(i));this.writer.u8u64(27,i)}writeBigSint(i){if(i>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(i));const a=-BigInt(1)-i;this.writer.u8u64(59,a)}writeInteger(i){i>=0?this.writeUInteger(i):this.encodeNint(i)}writeUInteger(i){const a=this.writer;a.ensureCapacity(9);const l=a.uint8;let o=a.x;i<=23?l[o++]=0+i:i<=255?(l[o++]=24,l[o++]=i):i<=65535?(l[o++]=25,a.view.setUint16(o,i),o+=2):i<=4294967295?(l[o++]=26,a.view.setUint32(o,i),o+=4):(l[o++]=27,a.view.setBigUint64(o,BigInt(i)),o+=8),a.x=o}encodeNumber(i){this.writeNumber(i)}encodeInteger(i){this.writeInteger(i)}encodeUint(i){this.writeUInteger(i)}encodeNint(i){const a=-1-i,l=this.writer;l.ensureCapacity(9);const o=l.uint8;let e=l.x;a<24?o[e++]=32+a:a<=255?(o[e++]=56,o[e++]=a):a<=65535?(o[e++]=57,l.view.setUint16(e,a),e+=2):a<=4294967295?(o[e++]=58,l.view.setUint32(e,a),e+=4):(o[e++]=59,l.view.setBigUint64(e,BigInt(a)),e+=8),l.x=e}writeFloat(i){this.writer.u8f64(251,i)}writeBin(i){const a=i.length;this.writeBinHdr(a),this.writer.buf(i,a)}writeBinHdr(i){const a=this.writer;i<=23?a.u8(64+i):i<=255?a.u16(22528+i):i<=65535?a.u8u16(89,i):i<=4294967295?a.u8u32(90,i):a.u8u64(91,i)}writeStr(i){const a=this.writer,o=i.length*4;a.ensureCapacity(5+o);const e=a.uint8;let t=a.x;o<=23?a.x++:o<=255?(e[a.x++]=120,t=a.x,a.x++):o<=65535?(e[a.x++]=121,t=a.x,a.x+=2):(e[a.x++]=122,t=a.x,a.x+=4);const r=a.utf8(i);o<=23?e[t]=96+r:o<=255?e[t]=r:o<=65535?a.view.setUint16(t,r):a.view.setUint32(t,r)}writeStrHdr(i){const a=this.writer;i<=23?a.u8(96+i):i<=255?a.u16(30720+i):i<=65535?a.u8u16(121,i):a.u8u32(122,i)}writeAsciiStr(i){this.writeStrHdr(i.length),this.writer.ascii(i)}writeArr(i){const a=i.length;this.writeArrHdr(a);for(let l=0;l<a;l++)this.writeAny(i[l])}writeArrHdr(i){const a=this.writer;i<=23?a.u8(128+i):i<=255?a.u16(38912+i):i<=65535?a.u8u16(153,i):i<=4294967295?a.u8u32(154,i):a.u8u64(155,i)}writeObj(i){const a=Object.keys(i),l=a.length;this.writeObjHdr(l);for(let o=0;o<l;o++){const e=a[o];this.writeStr(e),this.writeAny(i[e])}}writeObjHdr(i){const a=this.writer;i<=23?a.u8(160+i):i<=255?a.u16(47104+i):i<=65535?a.u8u16(185,i):i<=4294967295?a.u8u32(186,i):a.u8u64(187,i)}writeMapHdr(i){this.writeObjHdr(i)}writeStartMap(){this.writer.u8(191)}writeTag(i,a){this.writeTagHdr(i),this.writeAny(a)}writeTagHdr(i){const a=this.writer;i<=23?a.u8(192+i):i<=255?a.u16(55296+i):i<=65535?a.u8u16(217,i):i<=4294967295?a.u8u32(218,i):a.u8u64(219,i)}writeTkn(i){const a=this.writer;i<=23?a.u8(224+i):i<=255&&a.u16(63488+i)}writeStartStr(){this.writer.u8(127)}writeStrChunk(i){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(i){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(i){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(i,a){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return hn.CborEncoderFast=g,hn}var pn={},Ls;function Si(){if(Ls)return pn;Ls=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.JsonPackValue=void 0;let n=class{constructor(g){this.val=g}};return pn.JsonPackValue=n,pn}var Fs;function Qa(){if(Fs)return un;Fs=1,Object.defineProperty(un,"__esModule",{value:!0}),un.CborEncoder=void 0;const n=Uu(),d=Ya(),g=Lu(),f=Si();let i=class extends g.CborEncoderFast{writeUnknown(l){this.writeNull()}writeAny(l){switch(typeof l){case"number":return this.writeNumber(l);case"string":return this.writeStr(l);case"boolean":return this.writer.u8(244+ +l);case"object":{if(!l)return this.writer.u8(246);switch(l.constructor){case Object:return this.writeObj(l);case Array:return this.writeArr(l);case Uint8Array:return this.writeBin(l);case Map:return this.writeMap(l);case d.JsonPackExtension:return this.writeTag(l.tag,l.val);case f.JsonPackValue:const e=l.val;return this.writer.buf(e,e.length);default:return l instanceof Uint8Array?this.writeBin(l):Array.isArray(l)?this.writeArr(l):l instanceof Map?this.writeMap(l):this.writeUnknown(l)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(l);default:return this.writeUnknown(l)}}writeFloat(l){(0,n.isFloat32)(l)?this.writer.u8f32(250,l):this.writer.u8f64(251,l)}writeMap(l){this.writeMapHdr(l.size),l.forEach((o,e)=>{this.writeAny(e),this.writeAny(o)})}writeUndef(){this.writer.u8(247)}};return un.CborEncoder=i,un}var zs;function Za(){if(zs)return on;zs=1,Object.defineProperty(on,"__esModule",{value:!0}),on.Encoder=void 0;const d=ve.__importStar($t()),g=xe(),f=xi(),i=pe(),a=Qa();class l extends a.CborEncoder{constructor(e=new f.CrdtWriter){super(e),this.writer=e,this.patchSid=0}encode(e){this.writer.reset();const t=e.getId(),r=this.patchSid=t.sid,s=this.writer;s.vu57(r),s.vu57(t.time);const u=e.meta;return u===void 0?this.writeUndef():this.writeArr([u]),this.encodeOperations(e),s.flush()}encodeOperations(e){const t=e.ops,r=t.length;this.writer.vu57(r);for(let s=0;s<r;s++)this.encodeOperation(t[s])}encodeId(e){const t=e.sid,r=e.time,s=this.writer;t===this.patchSid?s.b1vu56(0,r):(s.b1vu56(1,r),s.vu57(t))}encodeTss(e){this.encodeId(e),this.writer.vu57(e.span)}writeInsStr(e,t,r,s){const u=this.writer;return e<=7?u.u8(g.JsonCrdtPatchOpcodeOverlay.ins_str+e):(u.u8(g.JsonCrdtPatchOpcodeOverlay.ins_str),u.vu57(e)),this.encodeId(t),this.encodeId(r),u.utf8(s)}encodeOperation(e){const t=this.writer;switch(e.constructor){case d.NewConOp:{const u=e.val;u instanceof i.Timestamp?(t.u8(g.JsonCrdtPatchOpcodeOverlay.new_con+1),this.encodeId(u)):(t.u8(g.JsonCrdtPatchOpcodeOverlay.new_con),this.writeAny(u));break}case d.NewValOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_val);break}case d.NewObjOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_obj);break}case d.NewVecOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_vec);break}case d.NewStrOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_str);break}case d.NewBinOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_bin);break}case d.NewArrOp:{t.u8(g.JsonCrdtPatchOpcodeOverlay.new_arr);break}case d.InsValOp:{const s=e;t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_val),this.encodeId(s.obj),this.encodeId(s.val);break}case d.InsObjOp:{const s=e,u=s.data,v=u.length;v<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_obj+v):(t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_obj),t.vu57(v)),this.encodeId(s.obj);for(let w=0;w<v;w++){const b=u[w];this.writeStr(b[0]),this.encodeId(b[1])}break}case d.InsVecOp:{const s=e,u=s.data,v=u.length;v<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_vec+v):(t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_vec),t.vu57(v)),this.encodeId(s.obj);for(let w=0;w<v;w++){const b=u[w];t.u8(b[0]),this.encodeId(b[1])}break}case d.InsStrOp:{const s=e,u=s.obj,v=s.ref,w=s.data,b=w.length;t.ensureCapacity(24+b*4);const h=t.x,c=this.writeInsStr(b,u,v,w);b!==c&&(t.x=h,this.writeInsStr(c,u,v,w));break}case d.InsBinOp:{const s=e,u=s.data,v=u.length;v<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_bin+v):(t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_bin),t.vu57(v)),this.encodeId(s.obj),this.encodeId(s.ref),t.buf(u,v);break}case d.InsArrOp:{const s=e,u=s.data,v=u.length;v<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_arr+v):(t.u8(g.JsonCrdtPatchOpcodeOverlay.ins_arr),t.vu57(v)),this.encodeId(s.obj),this.encodeId(s.ref);for(let w=0;w<v;w++)this.encodeId(u[w]);break}case d.DelOp:{const s=e,u=s.what,v=u.length;v<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.del+v):(t.u8(g.JsonCrdtPatchOpcodeOverlay.del),t.vu57(v)),this.encodeId(s.obj);for(let w=0;w<v;w++)this.encodeTss(u[w]);break}case d.NopOp:{const u=e.len;u<=7?t.u8(g.JsonCrdtPatchOpcodeOverlay.nop+u):(t.u8(g.JsonCrdtPatchOpcodeOverlay.nop),t.vu57(u));break}default:throw new Error("UNKNOWN_OP")}}}return on.Encoder=l,on}var vn={},bn={},mn={},wn={},fr={},bt={},Ws;function Fu(){if(Ws)return bt;Ws=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.decodeAsciiMax15=bt.decodeAscii=void 0;const n=String.fromCharCode,d=(f,i,a)=>{const l=[];for(let o=0;o<a;o++){const e=f[i++];if(e&128)return;l.push(e)}return n.apply(String,l)};bt.decodeAscii=d;const g=(f,i,a)=>{if(a<4)if(a<2){if(a===0)return"";{const l=f[i++];if((l&128)>1){i-=1;return}return n(l)}}else{const l=f[i++],o=f[i++];if((l&128)>0||(o&128)>0){i-=2;return}if(a<3)return n(l,o);const e=f[i++];if((e&128)>0){i-=3;return}return n(l,o,e)}else{const l=f[i++],o=f[i++],e=f[i++],t=f[i++];if((l&128)>0||(o&128)>0||(e&128)>0||(t&128)>0){i-=4;return}if(a<6){if(a===4)return n(l,o,e,t);{const r=f[i++];if((r&128)>0){i-=5;return}return n(l,o,e,t,r)}}else if(a<8){const r=f[i++],s=f[i++];if((r&128)>0||(s&128)>0){i-=6;return}if(a<7)return n(l,o,e,t,r,s);const u=f[i++];if((u&128)>0){i-=7;return}return n(l,o,e,t,r,s,u)}else{const r=f[i++],s=f[i++],u=f[i++],v=f[i++];if((r&128)>0||(s&128)>0||(u&128)>0||(v&128)>0){i-=8;return}if(a<10){if(a===8)return n(l,o,e,t,r,s,u,v);{const w=f[i++];if((w&128)>0){i-=9;return}return n(l,o,e,t,r,s,u,v,w)}}else if(a<12){const w=f[i++],b=f[i++];if((w&128)>0||(b&128)>0){i-=10;return}if(a<11)return n(l,o,e,t,r,s,u,v,w,b);const h=f[i++];if((h&128)>0){i-=11;return}return n(l,o,e,t,r,s,u,v,w,b,h)}else{const w=f[i++],b=f[i++],h=f[i++],c=f[i++];if((w&128)>0||(b&128)>0||(h&128)>0||(c&128)>0){i-=12;return}if(a<14){if(a===12)return n(l,o,e,t,r,s,u,v,w,b,h,c);{const p=f[i++];if((p&128)>0){i-=13;return}return n(l,o,e,t,r,s,u,v,w,b,h,c,p)}}else{const p=f[i++],m=f[i++];if((p&128)>0||(m&128)>0){i-=14;return}if(a<15)return n(l,o,e,t,r,s,u,v,w,b,h,c,p,m);const _=f[i++];if((_&128)>0){i-=15;return}return n(l,o,e,t,r,s,u,v,w,b,h,c,p,m,_)}}}}};return bt.decodeAsciiMax15=g,bt}var hr={},Gs;function zu(){if(Gs)return hr;Gs=1,Object.defineProperty(hr,"__esModule",{value:!0});const n=String.fromCharCode;return hr.default=(d,g,f)=>{let i=g;const a=i+f,l=[];for(;i<a;){let o=d[i++];if((o&128)!==0){const e=d[i++]&63;if((o&224)===192)o=(o&31)<<6|e;else{const t=d[i++]&63;if((o&240)===224)o=(o&31)<<12|e<<6|t;else if((o&248)===240){const r=d[i++]&63;let s=(o&7)<<18|e<<12|t<<6|r;if(s>65535){s-=65536;const u=s>>>10&1023|55296;o=56320|s&1023,l.push(u)}else o=s}}}l.push(o)}return n.apply(String,l)},hr}var Js;function Wu(){if(Js)return fr;Js=1,Object.defineProperty(fr,"__esModule",{value:!0});const n=ve,d=Fu(),g=n.__importDefault(zu()),f=typeof je.Buffer<"u",i=f?je.Buffer.prototype.utf8Slice:null,a=f?je.Buffer.from:null,l=(r,s,u)=>(0,d.decodeAsciiMax15)(r,s,u)??(0,g.default)(r,s,u),o=(r,s,u)=>(0,d.decodeAscii)(r,s,u)??(0,g.default)(r,s,u),e=i?(r,s,u)=>i.call(r,s,s+u):a?(r,s,u)=>a(r).subarray(s,s+u).toString("utf8"):g.default,t=(r,s,u)=>u<16?l(r,s,u):u<32?o(r,s,u):e(r,s,u);return fr.default=t,fr}var Ks;function Gu(){if(Ks)return wn;Ks=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.decodeUtf8=void 0;const d=ve.__importDefault(Wu());return wn.decodeUtf8=d.default,wn}var Hs;function el(){if(Hs)return mn;Hs=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.Reader=void 0;const n=Gu();let d=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(f){this.x=0,this.uint8=f,this.view=new DataView(f.buffer,f.byteOffset,f.length)}peak(){return this.view.getUint8(this.x)}skip(f){this.x+=f}buf(f){const i=this.x+f,a=this.uint8.subarray(this.x,i);return this.x=i,a}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let f=this.x;const i=(this.uint8[f++]<<8)+this.uint8[f++];return this.x=f,i}i16(){const f=this.view.getInt16(this.x);return this.x+=2,f}u32(){const f=this.view.getUint32(this.x);return this.x+=4,f}i32(){const f=this.view.getInt32(this.x);return this.x+=4,f}u64(){const f=this.view.getBigUint64(this.x);return this.x+=8,f}i64(){const f=this.view.getBigInt64(this.x);return this.x+=8,f}f32(){const f=this.x;return this.x+=4,this.view.getFloat32(f)}f64(){const f=this.x;return this.x+=8,this.view.getFloat64(f)}utf8(f){const i=this.x;return this.x+=f,(0,n.decodeUtf8)(this.uint8,i,f)}ascii(f){const i=this.uint8;let a="";const l=this.x+f;for(let o=this.x;o<l;o++)a+=String.fromCharCode(i[o]);return this.x=l,a}};return mn.Reader=d,mn}var Xs;function tl(){if(Xs)return bn;Xs=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.CrdtReader=void 0;const n=el();let d=class extends n.Reader{id(){const f=this.u8();return f<=127?[f>>>4,f&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const f=this.u8();if(f<=127)return f;const i=this.u8();if(i<=127)return i<<7|f&127;const a=this.u8();if(a<=127)return a<<14|(i&127)<<7|f&127;const l=this.u8();if(l<=127)return l<<21|(a&127)<<14|(i&127)<<7|f&127;const o=this.u8();if(o<=127)return o*268435456+((l&127)<<21|(a&127)<<14|(i&127)<<7|f&127);const e=this.u8();if(e<=127)return e*34359738368+((o&127)*268435456+((l&127)<<21|(a&127)<<14|(i&127)<<7|f&127));const t=this.u8();return t<=127?t*4398046511104+((e&127)*34359738368+((o&127)*268435456+((l&127)<<21|(a&127)<<14|(i&127)<<7|f&127))):this.u8()*562949953421312+((t&127)*4398046511104+((e&127)*34359738368+((o&127)*268435456+((l&127)<<21|(a&127)<<14|(i&127)<<7|f&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const f=this.u8(),i=f&128?1:0,a=127&f;if(a<=63)return[i,a];const l=this.u8();if(l<=127)return[i,l<<6|a&63];const o=this.u8();if(o<=127)return[i,o<<13|(l&127)<<6|a&63];const e=this.u8();if(e<=127)return[i,e<<20|(o&127)<<13|(l&127)<<6|a&63];const t=this.u8();if(t<=127)return[i,t*134217728+((e&127)<<20|(o&127)<<13|(l&127)<<6|a&63)];const r=this.u8();if(r<=127)return[i,r*17179869184+((t&127)*134217728+((e&127)<<20|(o&127)<<13|(l&127)<<6|a&63))];const s=this.u8();if(s<=127)return[i,s*2199023255552+((r&127)*17179869184+((t&127)*134217728+((e&127)<<20|(o&127)<<13|(l&127)<<6|a&63)))];const u=this.u8();return[i,u*281474976710656+((s&127)*2199023255552+((r&127)*17179869184+((t&127)*134217728+((e&127)<<20|(o&127)<<13|(l&127)<<6|a&63))))]}};return bn.CrdtReader=d,bn}var gn={},_n={},Ys;function nl(){return Ys||(Ys=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.isUint8Array=void 0,_n.isUint8Array=typeof je.Buffer=="function"?n=>n instanceof Uint8Array||je.Buffer.isBuffer(n):n=>n instanceof Uint8Array),_n}var mt={},Qs;function rl(){if(Qs)return mt;Qs=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.vec=mt.VectorDelayedValue=void 0;class n{constructor(f){this.slots=f}}mt.VectorDelayedValue=n;const d=(...g)=>new n(g);return mt.vec=d,mt}var wt={},Zs;function il(){if(Zs)return wt;Zs=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.konst=wt.Konst=void 0;let n=class{constructor(f){this.val=f}};wt.Konst=n;const d=g=>new n(g);return wt.konst=d,wt}var gt={},eo;function Ci(){if(eo)return gt;eo=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.delayed=gt.NodeBuilder=void 0;class n{constructor(f){this.build=f}}gt.NodeBuilder=n;const d=g=>new n(g);return gt.delayed=d,gt}var to;function wr(){if(to)return gn;to=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.PatchBuilder=void 0;const n=$t(),d=pe(),g=nl(),f=ll(),i=xe(),a=rl(),l=il(),o=Ci(),e=r=>{switch(typeof r){case"number":case"boolean":return!0;default:return r===null}};let t=class{constructor(s){this.clock=s,this.patch=new f.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const s=this.patch;return this.patch=new f.Patch,s}obj(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewObjOp(s)),s}arr(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewArrOp(s)),s}vec(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewVecOp(s)),s}str(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewStrOp(s)),s}bin(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewBinOp(s)),s}const(s){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new n.NewConOp(u,s)),u}val(){this.pad();const s=this.clock.tick(1);return this.patch.ops.push(new n.NewValOp(s)),s}root(s){this.pad();const u=this.clock.tick(1);return this.patch.ops.push(new n.InsValOp(u,i.ORIGIN,s)),u}insObj(s,u){if(this.pad(),!u.length)throw new Error("EMPTY_TUPLES");const v=this.clock.tick(1),w=new n.InsObjOp(v,s,u),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),v}insVec(s,u){if(this.pad(),!u.length)throw new Error("EMPTY_TUPLES");const v=this.clock.tick(1),w=new n.InsVecOp(v,s,u),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),v}setVal(s,u){this.pad();const v=this.clock.tick(1),w=new n.InsValOp(v,s,u);return this.patch.ops.push(w),v}insStr(s,u,v){if(this.pad(),!v.length)throw new Error("EMPTY_STRING");const w=this.clock.tick(1),b=new n.InsStrOp(w,s,u,v),h=b.span();return h>1&&this.clock.tick(h-1),this.patch.ops.push(b),w}insBin(s,u,v){if(this.pad(),!v.length)throw new Error("EMPTY_BINARY");const w=this.clock.tick(1),b=new n.InsBinOp(w,s,u,v),h=b.span();return h>1&&this.clock.tick(h-1),this.patch.ops.push(b),w}insArr(s,u,v){this.pad();const w=this.clock.tick(1),b=new n.InsArrOp(w,s,u,v),h=b.span();return h>1&&this.clock.tick(h-1),this.patch.ops.push(b),w}del(s,u){this.pad();const v=this.clock.tick(1);return this.patch.ops.push(new n.DelOp(v,s,u)),v}nop(s){this.pad();const u=this.clock.tick(s);return this.patch.ops.push(new n.NopOp(u,s)),u}jsonObj(s){const u=this.obj(),v=Object.keys(s);if(v.length){const w=[];for(const b of v){const h=s[b],c=h instanceof d.Timestamp?h:e(h)?this.const(h):this.json(h);w.push([b,c])}this.insObj(u,w)}return u}jsonArr(s){const u=this.arr();if(s.length){const v=[];for(const w of s)v.push(this.json(w));this.insArr(u,u,v)}return u}jsonStr(s){const u=this.str();return s&&this.insStr(u,u,s),u}jsonBin(s){const u=this.bin();return s.length&&this.insBin(u,u,s),u}jsonVal(s){const u=this.val(),v=this.const(s);return this.setVal(u,v),u}jsonVec(s){const u=this.vec(),v=s.length;if(v){const w=[];for(let b=0;b<v;b++)w.push([b,this.constOrJson(s[b])]);this.insVec(u,w)}return u}json(s){if(s instanceof d.Timestamp)return s;if(s===void 0)return this.const(s);if(s instanceof Array)return this.jsonArr(s);if((0,g.isUint8Array)(s))return this.jsonBin(s);if(s instanceof a.VectorDelayedValue)return this.jsonVec(s.slots);if(s instanceof l.Konst)return this.const(s.val);if(s instanceof o.NodeBuilder)return s.build(this);switch(typeof s){case"object":return s===null?this.jsonVal(s):this.jsonObj(s);case"string":return this.jsonStr(s);case"number":case"boolean":return this.jsonVal(s)}throw new Error("INVALID_JSON")}constOrJson(s){return s instanceof d.Timestamp?s:e(s)?this.const(s):this.json(s)}maybeConst(s){return s instanceof d.Timestamp?s:this.const(s)}pad(){const s=this.patch.nextTime();if(!s)return;const u=this.clock.time-s;if(u>0){const v=(0,d.ts)(this.clock.sid,s),w=new n.NopOp(v,u);this.patch.ops.push(w)}}};return gn.PatchBuilder=t,gn}var yn={},On={},xn={},no;function Ju(){if(no)return xn;no=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.decodeF16=void 0;const n=Math.pow,d=g=>{const f=(g&31744)>>10,i=g&1023;return(g>>15?-1:1)*(f?f===31?i?NaN:1/0:n(2,f-15)*(1+i/1024):6103515625e-14*(i/1024))};return xn.decodeF16=d,xn}var pr={},Sn={},vr={},ro;function Ku(){if(ro)return vr;ro=1,Object.defineProperty(vr,"__esModule",{value:!0});const n=String.fromCharCode;return vr.default=(d,g,f)=>{let i=g;const a=i+f;let l="";for(;i<a;){const o=d[i++];if((o&128)===0){l+=n(o);continue}const e=d[i++]&63;if((o&224)===192){l+=n((o&31)<<6|e);continue}const t=d[i++]&63;if((o&240)===224){l+=n((o&31)<<12|e<<6|t);continue}if((o&248)===240){const r=d[i++]&63;let s=(o&7)<<18|e<<12|t<<6|r;if(s>65535){s-=65536;const u=s>>>10&1023|55296;s=56320|s&1023,l+=n(u,s)}else l+=n(s)}else l+=n(o)}return l},vr}var io;function Hu(){if(io)return Sn;io=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.CachedUtf8Decoder=void 0;const d=ve.__importDefault(Ku());let g=1+Math.round(Math.random()*((-1>>>0)-1));function f(l,o){return g^=g<<13,g^=g>>>17,g^=g<<5,(g>>>0)%(o-l+1)+l}class i{constructor(o,e){this.bytes=o,this.value=e}}let a=class{constructor(){this.caches=[];for(let o=0;o<31;o++)this.caches.push([])}get(o,e,t){const r=this.caches[t-1],s=r.length;e:for(let u=0;u<s;u++){const v=r[u],w=v.bytes;for(let b=0;b<t;b++)if(w[b]!==o[e+b])continue e;return v.value}return null}store(o,e){const t=this.caches[o.length-1],r=new i(o,e);t.length>=16?t[f(0,15)]=r:t.push(r)}decode(o,e,t){if(!t)return"";const r=this.get(o,e,t);if(r!==null)return r;const s=(0,d.default)(o,e,t),u=Uint8Array.prototype.slice.call(o,e,e+t);return this.store(u,s),s}};return Sn.CachedUtf8Decoder=a,Sn}var so;function Xu(){if(so)return pr;so=1,Object.defineProperty(pr,"__esModule",{value:!0});const n=Hu();return pr.default=new n.CachedUtf8Decoder,pr}var oo;function sl(){if(oo)return On;oo=1,Object.defineProperty(On,"__esModule",{value:!0}),On.CborDecoderBase=void 0;const n=ve,d=Ju(),g=Ya(),f=Si(),i=el(),a=n.__importDefault(Xu());let l=class{constructor(e=new i.Reader,t=a.default){this.reader=e,this.keyDecoder=t}read(e){return this.reader.reset(e),this.val()}decode(e){return this.reader.reset(e),this.val()}val(){const t=this.reader.u8(),r=t>>5,s=t&31;return r<4?r<2?r===0?this.readUint(s):this.readNint(s):r===2?this.readBin(s):this.readStr(s):r<6?r===4?this.readArr(s):this.readObj(s):r===6?this.readTag(s):this.readTkn(s)}readAnyRaw(e){const t=e>>5,r=e&31;return t<4?t<2?t===0?this.readUint(r):this.readNint(r):t===2?this.readBin(r):this.readStr(r):t<6?t===4?this.readArr(r):this.readObj(r):t===6?this.readTag(r):this.readTkn(r)}readMinorLen(e){if(e<24)return e;switch(e){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(e){if(e<25)return e===24?this.reader.u8():e;if(e<27)return e===25?this.reader.u16():this.reader.u32();{const t=this.reader.u64();return t>9007199254740991?t:Number(t)}}readNint(e){if(e<25)return e===24?-this.reader.u8()-1:-e-1;if(e<27)return e===25?-this.reader.u16()-1:-this.reader.u32()-1;{const t=this.reader.u64();return t>9007199254740991-1?-t-BigInt(1):-Number(t)-1}}readBin(e){const t=this.reader;if(e<=23)return t.buf(e);switch(e){case 24:return t.buf(t.u8());case 25:return t.buf(t.u16());case 26:return t.buf(t.u32());case 27:return t.buf(Number(t.u64()));case 31:{let r=0;const s=[];for(;this.reader.peak()!==255;){const b=this.readBinChunk();r+=b.length,s.push(b)}this.reader.x++;const u=new Uint8Array(r);let v=0;const w=s.length;for(let b=0;b<w;b++){const h=s[b];u.set(h,v),v+=h.length}return u}default:throw 1}}readBinChunk(){const e=this.reader.u8(),t=e>>5,r=e&31;if(t!==2)throw 2;if(r>27)throw 3;return this.readBin(r)}readAsStr(){const t=this.reader.u8(),r=t>>5,s=t&31;if(r!==3)throw 11;return this.readStr(s)}readStr(e){const t=this.reader;if(e<=23)return t.utf8(e);switch(e){case 24:return t.utf8(t.u8());case 25:return t.utf8(t.u16());case 26:return t.utf8(t.u32());case 27:return t.utf8(Number(t.u64()));case 31:{let r="";for(;t.peak()!==255;)r+=this.readStrChunk();return this.reader.x++,r}default:throw 1}}readStrLen(e){if(e<=23)return e;switch(e){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const e=this.reader.u8(),t=e>>5,r=e&31;if(t!==3)throw 4;if(r>27)throw 5;return this.readStr(r)}readArr(e){const t=this.readMinorLen(e);return t>=0?this.readArrRaw(t):this.readArrIndef()}readArrRaw(e){const t=[];for(let r=0;r<e;r++)t.push(this.val());return t}readArrIndef(){const e=[];for(;this.reader.peak()!==255;)e.push(this.val());return this.reader.x++,e}readObj(e){if(e<28){let t=e;switch(e){case 24:t=this.reader.u8();break;case 25:t=this.reader.u16();break;case 26:t=this.reader.u32();break;case 27:t=Number(this.reader.u64());break}const r={};for(let s=0;s<t;s++){const u=this.key();if(u==="__proto__")throw 6;const v=this.val();r[u]=v}return r}else{if(e===31)return this.readObjIndef();throw 1}}readObjRaw(e){const t={};for(let r=0;r<e;r++){const s=this.key(),u=this.val();t[s]=u}return t}readObjIndef(){const e={};for(;this.reader.peak()!==255;){const t=this.key();if(this.reader.peak()===255)throw 7;const r=this.val();e[t]=r}return this.reader.x++,e}key(){const e=this.reader.u8(),t=e>>5,r=e&31;if(t!==3)return String(this.readAnyRaw(e));const s=this.readStrLen(r);if(s>31)return this.reader.utf8(s);const u=this.keyDecoder.decode(this.reader.uint8,this.reader.x,s);return this.reader.skip(s),u}readTag(e){if(e<=23)return this.readTagRaw(e);switch(e){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(e){return new g.JsonPackExtension(e,this.val())}readTkn(e){switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new f.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(e<=23)return new f.JsonPackValue(e);throw 1}f16(){return(0,d.decodeF16)(this.reader.u16())}};return On.CborDecoderBase=l,On}var ao;function Yu(){if(ao)return yn;ao=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.CborDecoder=void 0;const n=sl(),d=Si();let g=class extends n.CborDecoderBase{readAsMap(){const i=this.reader.u8(),a=i>>5,l=i&31;switch(a){case 5:return this.readMap(l);default:throw 0}}readMap(i){const a=this.readMinorLen(i);return a>=0?this.readMapRaw(a):this.readMapIndef()}readMapRaw(i){const a=new Map;for(let l=0;l<i;l++){const o=this.val(),e=this.val();a.set(o,e)}return a}readMapIndef(){const i=new Map;for(;this.reader.peak()!==255;){const a=this.val();if(this.reader.peak()===255)throw 7;const l=this.val();i.set(a,l)}return this.reader.x++,i}skipN(i){for(let a=0;a<i;a++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(i){const a=i>>5,l=i&31;switch(a){case 0:case 1:this.skipUNint(l);break;case 2:this.skipBin(l);break;case 3:this.skipStr(l);break;case 4:this.skipArr(l);break;case 5:this.skipObj(l);break;case 7:this.skipTkn(l);break;case 6:this.skipTag(l);break}}skipMinorLen(i){if(i<=23)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(i){if(!(i<=23))switch(i){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(i){const a=this.skipMinorLen(i);if(a>=0)this.reader.skip(a);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const i=this.reader.u8(),a=i>>5,l=i&31;if(a!==2)throw 2;if(l>27)throw 3;this.skipBin(l)}skipStr(i){const a=this.skipMinorLen(i);if(a>=0)this.reader.skip(a);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const i=this.reader.u8(),a=i>>5,l=i&31;if(a!==3)throw 4;if(l>27)throw 5;this.skipStr(l)}skipArr(i){const a=this.skipMinorLen(i);if(a>=0)this.skipN(a);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(i){const a=this.readMinorLen(i);if(a>=0)return this.skipN(a*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(i){if(this.skipMinorLen(i)<0)throw 1;this.skipAny()}skipTkn(i){switch(i){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(i<=23))throw 1}validate(i,a=0,l=i.length){this.reader.reset(i),this.reader.x=a;const o=a;if(this.skipAny(),this.reader.x-o!==l)throw 8}decodeLevel(i){return this.reader.reset(i),this.readLevel()}readLevel(){const i=this.reader.u8(),a=i>>5,l=i&31;switch(a){case 4:return this.readArrLevel(l);case 5:return this.readObjLevel(l);default:return super.readAnyRaw(i)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const i=this.reader,a=i.x;this.skipAny();const l=i.x;return new d.JsonPackValue(i.uint8.subarray(a,l))}readObjLevel(i){const a=this.readMinorLen(i);return a>=0?this.readObjRawLevel(a):this.readObjIndefLevel()}readObjRawLevel(i){const a={};for(let l=0;l<i;l++){const o=this.key(),e=this.readPrimitiveOrVal();a[o]=e}return a}readObjIndefLevel(){const i={};for(;this.reader.peak()!==255;){const a=this.key();if(this.reader.peak()===255)throw 7;const l=this.readPrimitiveOrVal();i[a]=l}return this.reader.x++,i}readArrLevel(i){const a=this.readMinorLen(i);return a>=0?this.readArrRawLevel(a):this.readArrIndefLevel()}readArrRawLevel(i){const a=[];for(let l=0;l<i;l++)a.push(this.readPrimitiveOrVal());return a}readArrIndefLevel(){const i=[];for(;this.reader.peak()!==255;)i.push(this.readPrimitiveOrVal());return this.reader.x++,i}readHdr(i){const a=this.reader.u8();if(a>>5!==i)throw 0;const o=a&31;if(o<24)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(i){const a=this.readObjHdr();for(let l=0;l<a;l++){if(this.key()===i)return this;this.skipAny()}throw 9}findIndex(i){const a=this.readArrHdr();if(i>=a)throw 10;for(let l=0;l<i;l++)this.skipAny();return this}find(i){for(let a=0;a<i.length;a++){const l=i[a];typeof l=="string"?this.findKey(l):this.findIndex(l)}return this}};return yn.CborDecoder=g,yn}var lo;function ol(){if(lo)return vn;lo=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.Decoder=void 0;const n=tl(),d=pe(),g=wr(),f=xe(),i=Yu(),a=xe();class l extends i.CborDecoder{constructor(e=new n.CrdtReader){super(e)}decode(e){return this.reader.reset(e),this.readPatch()}readPatch(){const e=this.reader,t=e.vu57(),r=e.vu57(),u=t===f.SESSION.SERVER?new d.ServerClockVector(f.SESSION.SERVER,r):new d.ClockVector(t,r);this.patchSid=u.sid;const v=this.builder=new g.PatchBuilder(u),w=this.val();return w instanceof Array&&(v.patch.meta=w[0]),this.decodeOperations(),v.patch}decodeId(){const e=this.reader,[t,r]=e.b1vu56();return t?new d.Timestamp(e.vu57(),r):new d.Timestamp(this.patchSid,r)}decodeTss(){const e=this.decodeId(),t=this.reader.vu57();return(0,d.interval)(e,0,t)}decodeOperations(){const t=this.reader.vu57();for(let r=0;r<t;r++)this.decodeOperation()}decodeOperation(){const e=this.builder,t=this.reader,r=t.u8();switch(r>>3){case a.JsonCrdtPatchOpcode.new_con:{const u=r&7;e.const(u?this.decodeId():this.val());break}case a.JsonCrdtPatchOpcode.new_val:{e.val();break}case a.JsonCrdtPatchOpcode.new_obj:{e.obj();break}case a.JsonCrdtPatchOpcode.new_vec:{e.vec();break}case a.JsonCrdtPatchOpcode.new_str:{e.str();break}case a.JsonCrdtPatchOpcode.new_bin:{e.bin();break}case a.JsonCrdtPatchOpcode.new_arr:{e.arr();break}case a.JsonCrdtPatchOpcode.ins_val:{const u=this.decodeId(),v=this.decodeId();e.setVal(u,v);break}case a.JsonCrdtPatchOpcode.ins_obj:{const u=r&7||t.vu57(),v=this.decodeId(),w=[];for(let b=0;b<u;b++){const h=this.val();if(typeof h!="string")continue;const c=this.decodeId();w.push([h,c])}e.insObj(v,w);break}case a.JsonCrdtPatchOpcode.ins_vec:{const u=r&7||t.vu57(),v=this.decodeId(),w=[];for(let b=0;b<u;b++){const h=this.val();if(typeof h!="number")continue;const c=this.decodeId();w.push([h,c])}e.insVec(v,w);break}case a.JsonCrdtPatchOpcode.ins_str:{const u=r&7||t.vu57(),v=this.decodeId(),w=this.decodeId(),b=t.utf8(u);e.insStr(v,w,b);break}case a.JsonCrdtPatchOpcode.ins_bin:{const u=r&7||t.vu57(),v=this.decodeId(),w=this.decodeId(),b=t.buf(u);if(!(b instanceof Uint8Array))return;e.insBin(v,w,b);break}case a.JsonCrdtPatchOpcode.ins_arr:{const u=r&7||t.vu57(),v=this.decodeId(),w=this.decodeId(),b=[];for(let h=0;h<u;h++)b.push(this.decodeId());e.insArr(v,w,b);break}case a.JsonCrdtPatchOpcode.del:{const u=r&7||t.vu57(),v=this.decodeId(),w=[];for(let b=0;b<u;b++)w.push(this.decodeTss());e.del(v,w);break}case a.JsonCrdtPatchOpcode.nop:{const u=r&7||t.vu57();e.nop(u);break}default:throw new Error("UNKNOWN_OP")}}}return vn.Decoder=l,vn}var Kr={},co;function Qu(){return co||(co=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.decode=n.decoder=n.encode=n.encoder=void 0;const d=Za(),g=ol(),f=xi(),i=new f.CrdtWriter(1024*4);n.encoder=new d.Encoder(i);const a=o=>n.encoder.encode(o);n.encode=a,n.decoder=new g.Decoder;const l=o=>n.decoder.decode(o);n.decode=l}(Kr)),Kr}var uo;function Zu(){return uo||(uo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(Za(),n),d.__exportStar(ol(),n),d.__exportStar(Qu(),n)}(Gr)),Gr}var fo;function ll(){if(fo)return sn;fo=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.Patch=void 0;const d=ve.__importStar($t()),g=pe(),f=Ze(),i=Zu();let a=class al{constructor(){this.ops=[],this.meta=void 0}static fromBinary(o){return(0,i.decode)(o)}getId(){const o=this.ops[0];if(o)return o.id}span(){let o=0;for(const e of this.ops)o+=e.span();return o}nextTime(){const o=this.ops,e=o.length;if(!e)return 0;const t=o[e-1];return t.id.time+t.span()}rewriteTime(o){const e=new al,t=this.ops,r=t.length,s=e.ops;for(let u=0;u<r;u++){const v=t[u];v instanceof d.DelOp?s.push(new d.DelOp(o(v.id),o(v.obj),v.what)):v instanceof d.NewConOp?s.push(new d.NewConOp(o(v.id),v.val instanceof g.Timestamp?o(v.val):v.val)):v instanceof d.NewVecOp?s.push(new d.NewVecOp(o(v.id))):v instanceof d.NewValOp?s.push(new d.NewValOp(o(v.id))):v instanceof d.NewObjOp?s.push(new d.NewObjOp(o(v.id))):v instanceof d.NewStrOp?s.push(new d.NewStrOp(o(v.id))):v instanceof d.NewBinOp?s.push(new d.NewBinOp(o(v.id))):v instanceof d.NewArrOp?s.push(new d.NewArrOp(o(v.id))):v instanceof d.InsArrOp?s.push(new d.InsArrOp(o(v.id),o(v.obj),o(v.ref),v.data.map(o))):v instanceof d.InsStrOp?s.push(new d.InsStrOp(o(v.id),o(v.obj),o(v.ref),v.data)):v instanceof d.InsBinOp?s.push(new d.InsBinOp(o(v.id),o(v.obj),o(v.ref),v.data)):v instanceof d.InsValOp?s.push(new d.InsValOp(o(v.id),o(v.obj),o(v.val))):v instanceof d.InsObjOp?s.push(new d.InsObjOp(o(v.id),o(v.obj),v.data.map(([w,b])=>[w,o(b)]))):v instanceof d.InsVecOp?s.push(new d.InsVecOp(o(v.id),o(v.obj),v.data.map(([w,b])=>[w,o(b)]))):v instanceof d.NopOp&&s.push(new d.NopOp(o(v.id),v.len))}return e}rebase(o,e){const t=this.getId();if(!t)throw new Error("EMPTY_PATCH");const r=t.sid,s=t.time;if(e??(e=s),s===o)return this;const u=o-s;return this.rewriteTime(v=>{if(v.sid!==r)return v;const w=v.time;return w<e?v:(0,g.ts)(r,w+u)})}clone(){return this.rewriteTime(o=>o)}toBinary(){return(0,i.encode)(this)}toString(o=""){const e=this.getId();return`Patch ${e?(0,g.printTs)(e):"(nil)"}!${this.span()}`+(0,f.printTree)(o,this.ops.map(r=>s=>r.toString(s)))}};return sn.Patch=a,sn}var Hr={},ho;function ed(){return ho||(ho=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.s=n.schema=n.nodes=void 0;const d=Ci();var g;(function(f){class i extends d.NodeBuilder{constructor(b){super(h=>h.const(b)),this.raw=b,this.type="con"}}f.con=i;class a extends d.NodeBuilder{constructor(b){super(h=>h.json(b)),this.raw=b,this.type="str"}}f.str=a;class l extends d.NodeBuilder{constructor(b){super(h=>h.json(b)),this.raw=b,this.type="bin"}}f.bin=l;class o extends d.NodeBuilder{constructor(b){super(h=>{const c=h.val(),p=b.build(h);return h.setVal(c,p),c}),this.value=b,this.type="val"}}f.val=o;class e extends d.NodeBuilder{constructor(b){super(h=>{const c=h.vec(),p=b.length;if(p){const m=[];for(let _=0;_<p;_++){const O=b[_].build(h);m.push([_,O])}h.insVec(c,m)}return c}),this.value=b,this.type="vec"}}f.vec=e;class t extends d.NodeBuilder{constructor(b,h){super(c=>{const p=c.obj(),m=[],_={...b,...h},y=Object.keys(_),O=y.length;if(O){for(let x=0;x<O;x++){const C=y[x],R=_[C].build(c);m.push([C,R])}c.insObj(p,m)}return p}),this.obj=b,this.opt=h,this.type="obj"}optional(){return this}}f.obj=t;class r extends d.NodeBuilder{constructor(b){super(h=>{const c=h.arr(),p=b.length;if(p){const m=[];for(let _=0;_<p;_++)m.push(b[_].build(h));h.insArr(c,c,m)}return c}),this.arr=b,this.type="arr"}}f.arr=r;class s extends d.NodeBuilder{constructor(b){super(h=>h.json(b)),this.value=b,this.type="json"}}f.json=s;class u extends d.NodeBuilder{constructor(b){super(h=>h.constOrJson(b)),this.value=b,this.type="jsonCon"}}f.jsonCon=u;class v extends d.NodeBuilder{constructor(b,h){super(c=>{const p=new Uint8Array([b,0,0]),m=c.vec();return p[1]=m.sid%256,p[2]=m.time%256,c.insVec(m,[[0,c.constOrJson(n.s.con(p))],[1,h.build(c)]]),m}),this.id=b,this.data=h,this.type="ext"}}f.ext=v})(g||(n.nodes=g={})),n.schema={con:f=>new g.con(f),str:f=>new g.str(f||""),bin:f=>new g.bin(f),val:f=>new g.val(f),vec:(...f)=>new g.vec(f),obj:(f,i)=>new g.obj(f,i),map:f=>n.schema.obj(f),arr:f=>new g.arr(f),json:f=>new g.json(f),jsonCon:f=>new g.jsonCon(f),ext:(f,i)=>new g.ext(f,i)},n.s=n.schema}(Hr)),Hr}var po;function cl(){return po||(po=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(Bu(),n),d.__exportStar(pe(),n),d.__exportStar($t(),n),d.__exportStar(ll(),n),d.__exportStar(wr(),n),d.__exportStar(ed(),n),d.__exportStar(il(),n),d.__exportStar(rl(),n),d.__exportStar(Ci(),n)}(Ur)),Ur}var td=cl();const nd=n=>{const d=n.trim();if(d){if(d.toUpperCase().startsWith("SELECT"))return{type:"sql",input:d};if(/^N\w*=$/.test(d))return{type:"sessionId",input:d}}else return{type:"empty",input:""};return{type:"unknown",input:d}};var Xr={},Yr={},vo;function rd(){return vo||(vo=1,Object.defineProperty(Yr,"__esModule",{value:!0})),Yr}var Cn={},En={},_t={},bo;function gr(){return bo||(bo=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.hasBuffer=_t.alphabet=void 0,_t.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_t.hasBuffer=typeof je.Buffer=="function"&&typeof je.Buffer.from=="function"),_t}var Nn={},Rn={},mo;function id(){if(mo)return Rn;mo=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.flatstr=void 0;const n=d=>d;return Rn.flatstr=n,Rn}var wo;function sd(){if(wo)return Nn;wo=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.createToBase64=void 0;const n=id(),d=gr(),g=(f=d.alphabet,i="=")=>{if(f.length!==64)throw new Error("chars must be 64 characters long");const a=f.split(""),l=[];for(const t of a)for(const r of a){const s=(0,n.flatstr)(t+r);l.push(s)}const o=i,e=(0,n.flatstr)(i+i);return(t,r)=>{let s="";const u=r%3,v=r-u;for(let w=0;w<v;w+=3){const b=t[w],h=t[w+1],c=t[w+2],p=b<<4|h>>4,m=(h&15)<<8|c;s+=l[p]+l[m]}if(!u)return s;if(u===1){const w=t[v];s+=l[w<<4]+e}else{const w=t[v],b=t[v+1],h=w<<4|b>>4,c=(b&15)<<2;s+=l[h]+a[c]+o}return s}};return Nn.createToBase64=g,Nn}var go;function ul(){if(go)return En;go=1,Object.defineProperty(En,"__esModule",{value:!0}),En.toBase64=void 0;const n=gr(),g=(0,sd().createToBase64)();return En.toBase64=n.hasBuffer?f=>{const i=f.length;return i<=48?g(f,i):je.Buffer.from(f).toString("base64")}:f=>g(f,f.length),En}var _o;function od(){if(_o)return Cn;_o=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.encode=void 0;const d=ve.__importStar($t()),g=pe(),f=xe(),i=ul(),a=(e,t)=>{const r=t.sid;return r===e?t.time:[r,t.time]},l=(e,t)=>{const r=a(e,t);return r instanceof Array?(r.push(t.span),r):[r,t.span]},o=e=>{const t=e.getId();if(!t)throw new Error("PATCH_EMPTY");const r=t.sid,s=t.time,u=r===f.SESSION.SERVER?[s]:[[r,s]],v=e.meta;v!==void 0&&u.push(v);const w=[u];for(const b of e.ops)if(b instanceof d.NewConOp){const h=b.val;h instanceof g.Timestamp?w.push([f.JsonCrdtPatchOpcode.new_con,a(r,h),!0]):h===void 0?w.push([f.JsonCrdtPatchOpcode.new_con]):w.push([f.JsonCrdtPatchOpcode.new_con,h])}else if(b instanceof d.NewValOp)w.push([f.JsonCrdtPatchOpcode.new_val]);else if(b instanceof d.NewObjOp)w.push([f.JsonCrdtPatchOpcode.new_obj]);else if(b instanceof d.NewVecOp)w.push([f.JsonCrdtPatchOpcode.new_vec]);else if(b instanceof d.NewStrOp)w.push([f.JsonCrdtPatchOpcode.new_str]);else if(b instanceof d.NewBinOp)w.push([f.JsonCrdtPatchOpcode.new_bin]);else if(b instanceof d.NewArrOp)w.push([f.JsonCrdtPatchOpcode.new_arr]);else if(b instanceof d.InsValOp)w.push([f.JsonCrdtPatchOpcode.ins_val,a(r,b.obj),a(r,b.val)]);else if(b instanceof d.InsObjOp){const h=[];for(const[p,m]of b.data)h.push([p,a(r,m)]);const c=[f.JsonCrdtPatchOpcode.ins_obj,a(r,b.obj),h];w.push(c)}else if(b instanceof d.InsVecOp){const h=[];for(const[p,m]of b.data)h.push([p,a(r,m)]);const c=[f.JsonCrdtPatchOpcode.ins_vec,a(r,b.obj),h];w.push(c)}else if(b instanceof d.InsStrOp){const h=[f.JsonCrdtPatchOpcode.ins_str,a(r,b.obj),a(r,b.ref),b.data];w.push(h)}else if(b instanceof d.InsBinOp){const h=[f.JsonCrdtPatchOpcode.ins_bin,a(r,b.obj),a(r,b.ref),(0,i.toBase64)(b.data)];w.push(h)}else if(b instanceof d.InsArrOp){const h=[];for(const p of b.data)h.push(a(r,p));const c=[f.JsonCrdtPatchOpcode.ins_arr,a(r,b.obj),a(r,b.ref),h];w.push(c)}else if(b instanceof d.DelOp){const h=[f.JsonCrdtPatchOpcode.del,a(r,b.obj),b.what.map(c=>l(r,c))];w.push(h)}else if(b instanceof d.NopOp){const h=[f.JsonCrdtPatchOpcode.nop],c=b.len;c>1&&h.push(c),w.push(h)}return w};return Cn.encode=o,Cn}var In={},jn={},Tn={},yo;function ad(){if(yo)return Tn;yo=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.bufferToUint8Array=void 0;const n=d=>new Uint8Array(d.buffer,d.byteOffset,d.length);return Tn.bufferToUint8Array=n,Tn}var kn={},Oo;function ld(){if(Oo)return kn;Oo=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.createFromBase64=void 0;const n=gr(),d="=",g=(f=n.alphabet,i=!1)=>{if(f.length!==64)throw new Error("chars must be 64 characters long");let a=0;for(let o=0;o<f.length;o++)a=Math.max(a,f.charCodeAt(o));const l=[];for(let o=0;o<=a;o+=1)l[o]=-1;for(let o=0;o<f.length;o++)l[f.charCodeAt(o)]=o;return o=>{if(!o)return new Uint8Array(0);let e=o.length;if(i){const b=e%4;b===2?(o+="==",e+=2):b===3&&(o+="=",e+=1)}if(e%4!==0)throw new Error("Base64 string length must be a multiple of 4");const t=o[e-1]!==d?e:e-4;let r=(e>>2)*3,s=0;o[e-2]===d?(s=2,r-=2):o[e-1]===d&&(s=1,r-=1);const u=new Uint8Array(r);let v=0,w=0;for(;w<t;w+=4){const b=l[o.charCodeAt(w)],h=l[o.charCodeAt(w+1)],c=l[o.charCodeAt(w+2)],p=l[o.charCodeAt(w+3)];if(b<0||h<0||c<0||p<0)throw new Error("INVALID_BASE64_STRING");u[v]=b<<2|h>>4,u[v+1]=h<<4|c>>2,u[v+2]=c<<6|p,v+=3}if(s===2){const b=l[o.charCodeAt(t)],h=l[o.charCodeAt(t+1)];if(b<0||h<0)throw new Error("INVALID_BASE64_STRING");u[v]=b<<2|h>>4}else if(s===1){const b=l[o.charCodeAt(t)],h=l[o.charCodeAt(t+1)],c=l[o.charCodeAt(t+2)];if(b<0||h<0||c<0)throw new Error("INVALID_BASE64_STRING");u[v]=b<<2|h>>4,u[v+1]=h<<4|c>>2}return u}};return kn.createFromBase64=g,kn}var xo;function cd(){if(xo)return jn;xo=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.fromBase64=void 0;const n=ad(),d=gr(),g=ld(),f=d.hasBuffer?a=>(0,n.bufferToUint8Array)(je.Buffer.from(a,"base64")):null,i=(0,g.createFromBase64)();return jn.fromBase64=f?a=>a.length>48?f(a):i(a):i,jn}var So;function ud(){if(So)return In;So=1,Object.defineProperty(In,"__esModule",{value:!0}),In.decode=void 0;const n=xe(),d=cd(),g=pe(),f=wr(),i=xe(),a=(e,t)=>Array.isArray(t)?new g.Timestamp(t[0],t[1]):new g.Timestamp(e,t),l=(e,t)=>t.length===3?new g.Timespan(t[0],t[1],t[2]):new g.Timespan(e,t[0],t[1]),o=e=>{const t=e[0],r=t[0],s=Array.isArray(r)?new g.ClockVector(r[0],r[1]):new g.ServerClockVector(i.SESSION.SERVER,r),u=s.sid;s.time;const v=new f.PatchBuilder(s),w=e.length;for(let h=1;h<w;h++){const c=e[h];switch(c[0]){case n.JsonCrdtPatchOpcode.new_con:{const[,p,m]=c;v.const(m?a(u,p):p);break}case n.JsonCrdtPatchOpcode.new_val:{v.val();break}case n.JsonCrdtPatchOpcode.new_obj:{v.obj();break}case n.JsonCrdtPatchOpcode.new_vec:{v.vec();break}case n.JsonCrdtPatchOpcode.new_str:{v.str();break}case n.JsonCrdtPatchOpcode.new_bin:{v.bin();break}case n.JsonCrdtPatchOpcode.new_arr:{v.arr();break}case n.JsonCrdtPatchOpcode.ins_val:{v.setVal(a(u,c[1]),a(u,c[2]));break}case n.JsonCrdtPatchOpcode.ins_obj:{const p=a(u,c[1]),m=[],_=c[2],y=_.length;for(let O=0;O<y;O++){const[x,C]=_[O];m.push([x,a(u,C)])}v.insObj(p,m);break}case n.JsonCrdtPatchOpcode.ins_vec:{const p=a(u,c[1]),m=[],_=c[2],y=_.length;for(let O=0;O<y;O++){const[x,C]=_[O];m.push([x,a(u,C)])}v.insVec(p,m);break}case n.JsonCrdtPatchOpcode.ins_str:{v.insStr(a(u,c[1]),a(u,c[2]),c[3]);break}case n.JsonCrdtPatchOpcode.ins_bin:{v.insBin(a(u,c[1]),a(u,c[2]),(0,d.fromBase64)(c[3]));break}case n.JsonCrdtPatchOpcode.ins_arr:{const p=a(u,c[1]),m=a(u,c[2]),_=c[3],y=[],O=_.length;for(let x=0;x<O;x++)y.push(a(u,_[x]));v.insArr(p,m,y);break}case n.JsonCrdtPatchOpcode.del:{const p=a(u,c[1]),m=c[2],_=[],y=m.length;for(let O=0;O<y;O++)_.push(l(u,m[O]));v.del(p,_);break}case n.JsonCrdtPatchOpcode.nop:{v.nop(c[1]||1);break}}}const b=v.patch;return b.meta=t[1],b};return In.decode=o,In}var Co;function dd(){return Co||(Co=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(rd(),n),d.__exportStar(od(),n),d.__exportStar(ud(),n)}(Xr)),Xr}var Qr=dd(),Zr={},ei={},ti={},Eo;function fd(){return Eo||(Eo=1,Object.defineProperty(ti,"__esModule",{value:!0})),ti}var ni={},Mn={},No;function Ei(){if(No)return Mn;No=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.ConNode=void 0;const n=pe();let d=class{constructor(f,i){this.id=f,this.val=i,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(f){const i=this.val,a=i instanceof Uint8Array?`Uint8Array { ${(""+i).replaceAll(",",", ")} }`:`{ ${i instanceof n.Timestamp?(0,n.printTs)(i):JSON.stringify(i)} }`;return`${this.name()} ${(0,n.printTs)(this.id)} ${a}`}};return Mn.ConNode=d,Mn}var An={},yt={},Ot={},Pn={},Dn={},Bn={},Ro;function hd(){if(Ro)return Bn;Ro=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.RelativeTimestamp=void 0;let n=class{constructor(g,f){this.sessionIndex=g,this.timeDiff=f}};return Bn.RelativeTimestamp=n,Bn}var Io;function pd(){if(Io)return Dn;Io=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.ClockEncoder=void 0;const n=pe(),d=hd();class g{constructor(a,l){this.index=a,this.clock=l}}let f=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(a){this.index=1,this.clock=a;const l=new g(this.index++,(0,n.tick)(a,-1));this.table.clear(),this.table.set(a.sid,l)}append(a){const l=a.time,o=a.sid;let e=this.table.get(o);if(!e){let s=this.clock.peers.get(o);s||(s=new n.Timestamp(o,this.clock.time-1)),e=new g(this.index++,s),this.table.set(o,e)}const r=e.clock.time-l;if(r<0)throw new Error("TIME_TRAVEL");return new d.RelativeTimestamp(e.index,r)}toJson(){const a=[];return this.table.forEach(l=>{const o=l.clock;a.push(o.sid,o.time)}),a}};return Dn.ClockEncoder=f,Dn}var xt={},jo;function dl(){if(jo)return xt;jo=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.CRDT_MAJOR_OVERLAY=xt.CRDT_MAJOR=void 0,xe();var n;(function(g){g[g.CON=0]="CON",g[g.VAL=1]="VAL",g[g.OBJ=2]="OBJ",g[g.VEC=3]="VEC",g[g.STR=4]="STR",g[g.BIN=5]="BIN",g[g.ARR=6]="ARR"})(n||(xt.CRDT_MAJOR=n={}));var d;return function(g){g[g.CON=0]="CON",g[g.VAL=32]="VAL",g[g.VEC=96]="VEC",g[g.OBJ=64]="OBJ",g[g.STR=128]="STR",g[g.BIN=160]="BIN",g[g.ARR=192]="ARR"}(d||(xt.CRDT_MAJOR_OVERLAY=d={})),xt}var To;function vd(){if(To)return Pn;To=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.Encoder=void 0;const d=ve.__importStar(dt()),g=pd(),f=xi(),i=pe(),a=Qa(),l=xe(),o=dl();class e extends a.CborEncoder{constructor(r){super(r||new f.CrdtWriter),this.clockEncoder=new g.ClockEncoder,this.time=0,this.cTableEntry=s=>{const u=s.clock,v=this.writer;v.vu57(u.sid),v.vu57(u.time)},this.tsLogical=s=>{const u=this.clockEncoder.append(s);this.writer.id(u.sessionIndex,u.timeDiff)},this.tsServer=s=>{this.writer.vu57(s.time)},this.ts=this.tsLogical,this.cKey=(s,u)=>{this.writeStr(u),this.cNode(this.doc.index.get(s))}}encode(r){this.doc=r;const s=this.writer;return s.reset(),r.clock.sid===l.SESSION.SERVER?this.encodeServer(r):this.encodeLogical(r),s.flush()}encodeLogical(r){const s=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(r.clock),s.ensureCapacity(4);const u=s.x0,v=s.x;s.x+=4,this.cRoot(r.root),this.encodeClockTable(u,v)}encodeServer(r){this.ts=this.tsServer;const s=this.writer;s.u8(128),s.vu57(this.time=r.clock.time),this.cRoot(r.root)}encodeClockTable(r,s){const u=this.writer,v=u.x0-r;u.view.setUint32(u.x0+(s-r),u.x-s-v-4);const b=this.clockEncoder.table,h=b.size;u.vu57(h),b.forEach(this.cTableEntry)}cRoot(r){r.val.sid===l.SESSION.SYSTEM?this.writer.u8(0):this.cNode(r.node())}writeTL(r,s){const u=this.writer;s<31?u.u8(r|s):(u.u8(r|31),u.vu57(s))}cNode(r){r instanceof d.ConNode?this.cCon(r):r instanceof d.ValNode?this.cVal(r):r instanceof d.StrNode?this.cStr(r):r instanceof d.ObjNode?this.cObj(r):r instanceof d.VecNode?this.cVec(r):r instanceof d.ArrNode?this.cArr(r):r instanceof d.BinNode&&this.cBin(r)}cCon(r){const s=r.val;this.ts(r.id),s instanceof i.Timestamp?(this.writer.u8(1),this.ts(s)):(this.writer.u8(0),this.writeAny(s))}cVal(r){this.ts(r.id),this.writer.u8(32),this.cNode(r.node())}cObj(r){this.ts(r.id);const s=r.keys;this.writeTL(o.CRDT_MAJOR_OVERLAY.OBJ,s.size),s.forEach(this.cKey)}cVec(r){const s=r.elements,u=s.length;this.ts(r.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.VEC,u);const v=this.doc.index;for(let w=0;w<u;w++){const b=s[w];b?this.cNode(v.get(b)):this.writer.u8(0)}}cStr(r){const s=this.ts;s(r.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.STR,r.count);for(let u=r.first();u;u=r.next(u))s(u.id),u.del?this.writeUInteger(u.span):this.writeStr(u.data)}cBin(r){const s=this.ts,u=this.writer;s(r.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.BIN,r.count);for(let v=r.first();v;v=r.next(v)){s(v.id);const w=v.span,b=v.del;u.b1vu56(~~b,w),!b&&u.buf(v.data,w)}}cArr(r){const s=this.ts,u=this.writer;s(r.id),this.writeTL(o.CRDT_MAJOR_OVERLAY.ARR,r.count);const v=this.doc.index;for(let w=r.first();w;w=r.next(w)){s(w.id);const b=w.span,h=w.del;if(u.b1vu56(~~h,b),h)continue;const c=w.data;for(let p=0;p<b;p++)this.cNode(v.get(c[p]))}}}return Pn.Encoder=e,Pn}var qn={},Vn={},ko;function bd(){if(ko)return Vn;ko=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.ClockDecoder=void 0;const n=pe();let d=class fl{static fromArr(f){const i=new fl(f[0],f[1]),a=f.length;for(let l=2;l<a;l+=2)i.pushTuple(f[l],f[l+1]);return i}constructor(f,i){this.table=[],this.clock=new n.ClockVector(f,i+1),this.table.push((0,n.ts)(f,i))}pushTuple(f,i){const a=(0,n.ts)(f,i);this.clock.observe(a,1),this.table.push(a)}decodeId(f,i){if(!f)return(0,n.ts)(0,i);const a=this.table[f-1];if(!a)throw new Error("INVALID_CLOCK_TABLE");return(0,n.ts)(a.sid,a.time-i)}};return Vn.ClockDecoder=d,Vn}var Mo;function md(){if(Mo)return qn;Mo=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.Decoder=void 0;const d=ve.__importStar(dt()),g=bd(),f=tl(),i=pe(),a=Ii(),l=sl(),o=xe(),e=dl();let t=class extends l.CborDecoderBase{constructor(){super(new f.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const s=this.ts(),u=this.val();return typeof u=="string"?new d.StrChunk(s,u.length,u):new d.StrChunk(s,~~u,"")},this.cBinChunk=()=>{const s=this.ts(),u=this.reader,[v,w]=u.b1vu56();return v?new d.BinChunk(s,w,void 0):new d.BinChunk(s,w,u.buf(w))},this.cArrChunk=()=>{const s=this.ts(),[u,v]=this.reader.b1vu56();if(u)return new d.ArrChunk(s,v,void 0);const w=[];for(let b=0;b<v;b++)w.push(this.cNode().id);return new d.ArrChunk(s,v,w)}}decode(s,u){this.clockDecoder=void 0,this.time=-1;const v=this.reader;if(v.reset(s),v.peak()&128){v.x++;const b=this.time=v.vu57();u||(u=a.Model.withServerClock(b))}else if(this.decodeClockTable(),!u){const b=this.clockDecoder.clock;u=a.Model.withLogicalClock(b)}return this.doc=u,u.root=new d.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,u}decodeClockTable(){const s=this.reader,u=s.u32(),v=s.x;s.x+=u;const w=s.vu57(),b=s.vu57(),h=s.vu57();this.clockDecoder=new g.ClockDecoder(b,h);for(let c=1;c<w;c++){const p=s.vu57(),m=s.vu57();this.clockDecoder.pushTuple(p,m)}s.x=v}ts(){if(this.time<0){const[v,w]=this.reader.id();return this.clockDecoder.decodeId(v,w)}else return new i.Timestamp(o.SESSION.SERVER,this.reader.vu57())}cRoot(){const s=this.reader;return s.uint8[s.x]?this.cNode():a.UNDEFINED}cNode(){const s=this.reader,u=this.ts(),v=s.u8(),w=v>>5,b=v&31;switch(w){case e.CRDT_MAJOR.CON:return this.cCon(u,b);case e.CRDT_MAJOR.VAL:return this.cVal(u);case e.CRDT_MAJOR.OBJ:return this.cObj(u,b!==31?b:s.vu57());case e.CRDT_MAJOR.VEC:return this.cVec(u,b!==31?b:s.vu57());case e.CRDT_MAJOR.STR:return this.cStr(u,b!==31?b:s.vu57());case e.CRDT_MAJOR.BIN:return this.cBin(u,b!==31?b:s.vu57());case e.CRDT_MAJOR.ARR:return this.cArr(u,b!==31?b:s.vu57())}throw new Error("UNKNOWN_NODE")}cCon(s,u){const v=this.doc,w=u?this.ts():this.val(),b=new d.ConNode(s,w);return v.index.set(s,b),b}cVal(s){const u=this.cNode(),v=this.doc,w=new d.ValNode(v,s,u.id);return v.index.set(s,w),w}cObj(s,u){const v=new d.ObjNode(this.doc,s);for(let w=0;w<u;w++)this.cObjChunk(v);return this.doc.index.set(s,v),v}cObjChunk(s){const u=this.key();s.keys.set(u,this.cNode().id)}cVec(s,u){const v=this.reader,w=new d.VecNode(this.doc,s),b=w.elements;for(let h=0;h<u;h++)v.peak()?b.push(this.cNode().id):(v.x++,b.push(void 0));return this.doc.index.set(s,w),w}cStr(s,u){const v=new d.StrNode(s);return u&&v.ingest(u,this.cStrChunk),this.doc.index.set(s,v),v}cBin(s,u){const v=new d.BinNode(s);return u&&v.ingest(u,this.cBinChunk),this.doc.index.set(s,v),v}cArr(s,u){const v=new d.ArrNode(this.doc,s);return u&&v.ingest(u,this.cArrChunk),this.doc.index.set(s,v),v}};return qn.Decoder=t,qn}var Ao;function wd(){if(Ao)return Ot;Ao=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.decoder=Ot.encoder=void 0;const n=vd(),d=md();return Ot.encoder=new n.Encoder,Ot.decoder=new d.Decoder,Ot}var $n={},Un={},Po;function hl(){if(Po)return Un;Po=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.FanOut=void 0;class n{constructor(){this.listeners=new Set}emit(g){this.listeners.forEach(f=>f(g))}listen(g){const f=this.listeners;return f.add(g),()=>f.delete(g)}}return Un.FanOut=n,Un}var ge={},Ln={},ri={},ii={},Do;function gd(){return Do||(Do=1,Object.defineProperty(ii,"__esModule",{value:!0})),ii}var si={},Bo;function pl(){return Bo||(Bo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isInteger=n.isRoot=n.toPath=void 0,n.unescapeComponent=a,n.escapeComponent=l,n.parseJsonPointer=o,n.formatJsonPointer=e,n.isChild=r,n.isPathEqual=s,n.parent=v,n.isValidIndex=w;const d=/~1/g,g=/~0/g,f=/~/g,i=/\//g;function a(h){return h.indexOf("~")===-1?h:h.replace(d,"/").replace(g,"~")}function l(h){return h.indexOf("/")===-1&&h.indexOf("~")===-1?h:h.replace(f,"~0").replace(i,"~1")}function o(h){return h?h.slice(1).split("/").map(a):[]}function e(h){return(0,n.isRoot)(h)?"":"/"+h.map(c=>l(String(c))).join("/")}const t=h=>typeof h=="string"?o(h):h;n.toPath=t;function r(h,c){if(h.length>=c.length)return!1;for(let p=0;p<h.length;p++)if(h[p]!==c[p])return!1;return!0}function s(h,c){if(h.length!==c.length)return!1;for(let p=0;p<h.length;p++)if(h[p]!==c[p])return!1;return!0}const u=h=>!h.length;n.isRoot=u;function v(h){if(h.length<1)throw new Error("NO_PARENT");return h.slice(0,h.length-1)}function w(h){if(typeof h=="number")return!0;const c=Number.parseInt(h,10);return String(c)===h&&c>=0}const b=h=>{const c=h.length;let p=0,m;for(;p<c;){if(m=h.charCodeAt(p),m>=48&&m<=57){p++;continue}return!1}return!0};n.isInteger=b}(si)),si}var oi={},qo;function _d(){return qo||(qo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.validatePath=n.validateJsonPointer=void 0;const d=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,n.validatePath)(i)};n.validateJsonPointer=d;const{isArray:g}=Array,f=i=>{if(!g(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const a of i)switch(typeof a){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};n.validatePath=f}(oi)),oi}var Fn={},zn={},Vo;function Ni(){if(Vo)return zn;Vo=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.hasOwnProperty=void 0;const n=Object.prototype.hasOwnProperty;function d(g,f){return n.call(g,f)}return zn.hasOwnProperty=d,zn}var $o;function yd(){if($o)return Fn;$o=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.get=void 0;const n=Ni(),d=(g,f)=>{const i=f.length;let a;if(!i)return g;for(let l=0;l<i;l++)if(a=f[l],g instanceof Array){if(typeof a!="number"){if(a==="-")return;const o=~~a;if(""+o!==a)return;a=o}g=g[a]}else if(typeof g=="object"){if(!g||!(0,n.hasOwnProperty)(g,a))return;g=g[a]}else return;return g};return Fn.get=d,Fn}var Ye={},Uo;function Od(){if(Uo)return Ye;Uo=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.isObjectReference=Ye.isArrayEnd=Ye.isArrayReference=Ye.find=void 0;const n=Ni(),{isArray:d}=Array,g=(l,o)=>{const e=o.length;if(!e)return{val:l};let t,r;for(let u=0;u<e;u++)if(t=l,r=o[u],d(t)){const v=t.length;if(r==="-")r=v;else if(typeof r=="string"){const w=~~r;if(""+w!==r)throw new Error("INVALID_INDEX");if(r=w,r<0)throw new Error("INVALID_INDEX")}l=t[r]}else if(typeof t=="object"&&t)l=(0,n.hasOwnProperty)(t,r)?t[r]:void 0;else throw new Error("NOT_FOUND");return{val:l,obj:t,key:r}};Ye.find=g;const f=l=>d(l.obj)&&typeof l.key=="number";Ye.isArrayReference=f;const i=l=>l.obj.length===l.key;Ye.isArrayEnd=i;const a=l=>typeof l.obj=="object"&&typeof l.key=="string";return Ye.isObjectReference=a,Ye}var ai={},Wn={},Lo;function xd(){if(Lo)return Wn;Lo=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.findByPointer=void 0;const n=Ni(),d=pl(),{isArray:g}=Array,f=(i,a)=>{if(!i)return{val:a};let l,o,e=0,t=1;for(;e>-1;)if(e=i.indexOf("/",t),o=e>-1?i.substring(t,e):i.substring(t),t=e+1,l=a,g(l)){const r=l.length;if(o==="-")o=r;else{const s=~~o;if(""+s!==o)throw new Error("INVALID_INDEX");if(o=s,o<0)throw"INVALID_INDEX"}a=l[o]}else if(typeof l=="object"&&l)o=(0,d.unescapeComponent)(o),a=(0,n.hasOwnProperty)(l,o)?l[o]:void 0;else throw"NOT_FOUND";return{val:a,obj:l,key:o}};return Wn.findByPointer=f,Wn}var Fo;function Sd(){return Fo||(Fo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),ve.__exportStar(xd(),n)}(ai)),ai}var zo;function Cd(){return zo||(zo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(gd(),n),d.__exportStar(pl(),n),d.__exportStar(_d(),n),d.__exportStar(yd(),n),d.__exportStar(Od(),n),d.__exportStar(Sd(),n)}(ri)),ri}var Wo;function Ed(){if(Wo)return Ln;Wo=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.find=void 0;const n=Cd(),d=dt(),g=(f,i)=>{const a=(0,n.toPath)(i);let l=f;const o=a.length;if(!o)return l;let e=0;for(;e<o&&l;){const t=a[e++];if(l=l.container(),!l)throw new Error("NOT_CONTAINER");if(l instanceof d.ObjNode){const r=l.get(String(t));if(!r)throw new Error("NOT_FOUND");l=r}else if(l instanceof d.ArrNode){const r=l.getNode(Number(t));if(!r)throw new Error("NOT_FOUND");l=r}else if(l instanceof d.VecNode){const r=l.get(Number(t));if(!r)throw new Error("NOT_FOUND");l=r}}return l};return Ln.find=g,Ln}var Gn={},Qe={},Go;function vl(){if(Go)return Qe;Go=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.OnNewFanOut=Qe.MapFanOut=Qe.MicrotaskBufferFanOut=Qe.MergeFanOut=void 0;const n=hl();class d extends n.FanOut{constructor(l){super(),this.fanouts=l,this.unsubs=[]}listen(l){this.listeners.size||(this.unsubs=this.fanouts.map(e=>e.listen(t=>this.emit(t))));const o=super.listen(l);return()=>{if(o(),!this.listeners.size){for(const e of this.unsubs)e();this.unsubs=[]}}}}Qe.MergeFanOut=d;class g extends n.FanOut{constructor(l){super(),this.source=l,this.buffer=[],this.unsub=void 0}listen(l){this.unsub||(this.unsub=this.source.listen(e=>{const t=this.buffer;t.length||queueMicrotask(()=>{this.emit(t),this.buffer=[]}),t.push(e)}));const o=super.listen(l);return()=>{o(),this.listeners.size||this.clear()}}clear(){var l;this.listeners.clear(),this.buffer=[],(l=this.unsub)==null||l.call(this),this.unsub=void 0}}Qe.MicrotaskBufferFanOut=g;class f extends n.FanOut{constructor(l,o){super(),this.source=l,this.mapper=o,this.unsub=void 0}listen(l){this.unsub||(this.unsub=this.source.listen(e=>this.emit(this.mapper(e))));const o=super.listen(l);return()=>{o(),this.listeners.size||this.clear()}}clear(){var l;this.listeners.clear(),(l=this.unsub)==null||l.call(this),this.unsub=void 0}}Qe.MapFanOut=f;class i extends n.FanOut{constructor(l,o=void 0){super(),this.source=l,this.last=o,this.unsub=void 0}listen(l){this.unsub||(this.unsub=this.source.listen(e=>{this.last!==e&&this.emit(this.last=e)}));const o=super.listen(l);return()=>{o(),this.listeners.size||this.clear()}}clear(){var l;this.listeners.clear(),this.last=void 0,(l=this.unsub)==null||l.call(this),this.unsub=void 0}}return Qe.OnNewFanOut=i,Qe}var Jo;function Nd(){if(Jo)return Gn;Jo=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.NodeEvents=void 0;const n=vl();let d=class{constructor(f){this.api=f,this.subscribe=i=>this.onViewChanges.listen(()=>i()),this.getSnapshot=()=>this.api.view(),this.onChanges=new n.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new n.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Gn.NodeEvents=d,Gn}var Jn={},Ko;function bl(){if(Ko)return Jn;Ko=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.ExtNode=void 0;const n=pe();let d=class{constructor(f){this.data=f,this.api=void 0,this.id=f.id}children(f){}child(){return this.data}container(){return this.data.container()}toString(f,i){return this.name()+(i?" "+(0,n.printTs)(i):"")+" "+this.data.toString(f)}};return Jn.ExtNode=d,Jn}var Ho;function ml(){if(Ho)return ge;Ho=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.ArrApi=ge.BinApi=ge.StrApi=ge.ObjApi=ge.VecApi=ge.ValApi=ge.ConApi=ge.NodeApi=void 0;const n=Ze(),d=Ed(),g=pe(),f=dt(),i=Nd(),a=bl();class l{constructor(b,h){this.node=b,this.api=h,this.ev=void 0}get events(){return this.ev||(this.ev=new i.NodeEvents(this))}find(b){const h=this.node;if(b===void 0){if(typeof h.child=="function"){const c=h.child();if(!c){if(h instanceof f.RootNode)return h;throw new Error("NO_CHILD")}return c}throw new Error("CANNOT_IN")}return typeof b=="string"&&b&&b[0]!=="/"&&(b="/"+b),typeof b=="number"&&(b=[b]),(0,d.find)(this.node,b)}in(b){const h=this.find(b);return this.api.wrap(h)}asVal(){if(this.node instanceof f.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof f.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof f.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof f.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof f.VecNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asObj(){if(this.node instanceof f.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof f.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CONST")}asExt(b){let h;const c=this.node;if(c instanceof a.ExtNode&&(h=c),c instanceof f.VecNode&&(h=c.ext()),!h)throw new Error("NOT_EXT");const p=this.api.wrap(h);if(!b||p instanceof b.Api)return p;throw new Error("NOT_EXT")}val(b){return this.in(b).asVal()}str(b){return this.in(b).asStr()}bin(b){return this.in(b).asBin()}arr(b){return this.in(b).asArr()}vec(b){return this.in(b).asVec()}obj(b){return this.in(b).asObj()}con(b){return this.in(b).asCon()}view(){return this.node.view()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}toString(b=""){return"api"+(0,n.printTree)(b,[h=>this.node.toString(h)])}}ge.NodeApi=l;class o extends l{proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}}ge.ConApi=o;class e extends l{get(){return this.in()}set(b){const{api:h,node:c}=this,m=h.builder.constOrJson(b);h.builder.setVal(c.id,m),h.apply()}proxy(){const b=this;return{toApi:()=>this,toView:()=>this.node.view(),get val(){const c=b.node.node();return b.api.wrap(c).proxy()}}}}ge.ValApi=e;class t extends l{get(b){return this.in(b)}set(b){const{api:h,node:c}=this,{builder:p}=h;p.insVec(c.id,b.map(([m,_])=>[m,p.constOrJson(_)])),h.apply()}push(...b){const h=this.length();this.set(b.map((c,p)=>[h+p,c]))}length(){return this.node.elements.length}proxy(){return new Proxy({},{get:(h,c,p)=>{if(c==="toApi")return()=>this;if(c==="toView")return()=>this.view();if(c==="toExt")return()=>this.asExt();const m=Number(c);if(Number.isNaN(m))throw new Error("INVALID_INDEX");const _=this.node.get(m);if(!_)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(_).proxy()}})}}ge.VecApi=t;class r extends l{get(b){return this.in(b)}set(b){const{api:h,node:c}=this,{builder:p}=h;p.insObj(c.id,Object.entries(b).map(([m,_])=>[m,p.constOrJson(_)])),h.apply()}del(b){const{api:h,node:c}=this,{builder:p}=h;h.builder.insObj(c.id,b.map(m=>[m,p.const(void 0)])),h.apply()}proxy(){return new Proxy({},{get:(h,c,p)=>{if(c==="toApi")return()=>this;if(c==="toView")return()=>this.view();const m=String(c),_=this.node.get(m);if(!_)throw new Error("NO_SUCH_KEY");return this.api.wrap(_).proxy()}})}}ge.ObjApi=r;class s extends l{ins(b,h){const{api:c,node:p}=this;c.onBeforeLocalChange.emit(c.next);const m=c.builder;m.pad();const _=c.builder.nextTime(),y=new g.Timestamp(m.clock.sid,_),O=p.insAt(b,y,h);if(!O)throw new Error("OUT_OF_BOUNDS");m.insStr(p.id,O,h),c.advance()}del(b,h){const{api:c,node:p}=this;c.onBeforeLocalChange.emit(c.next);const m=c.builder;m.pad();const _=p.findInterval(b,h);if(!_)throw new Error("OUT_OF_BOUNDS");p.delete(_),m.del(p.id,_),c.advance()}findId(b){const h=this.node,p=h.length()-1;return b>p&&(b=p),b<0?h.id:h.find(b)||h.id}findPos(b){const h=this.node,c=h.id;if(c.sid===b.sid&&c.time===b.time)return-1;const p=h.findById(b);return p?h.pos(p)+(p.del?0:b.time-p.id.time):-1}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}}ge.StrApi=s;class u extends l{ins(b,h){const{api:c,node:p}=this,m=b?p.find(b-1):p.id;if(!m)throw new Error("OUT_OF_BOUNDS");c.builder.insBin(p.id,m,h),c.apply()}del(b,h){const{api:c,node:p}=this,m=p.findInterval(b,h);if(!m)throw new Error("OUT_OF_BOUNDS");c.builder.del(p.id,m),c.apply()}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}}ge.BinApi=u;class v extends l{get(b){return this.in(b)}ins(b,h){const{api:c,node:p}=this,{builder:m}=c,_=b?p.find(b-1):p.id;if(!_)throw new Error("OUT_OF_BOUNDS");const y=[];for(let O=0;O<h.length;O++)y.push(m.json(h[O]));m.insArr(p.id,_,y),c.apply()}del(b,h){const{api:c,node:p}=this,m=p.findInterval(b,h);if(!m)throw new Error("OUT_OF_BOUNDS");c.builder.del(p.id,m),c.apply()}length(){return this.node.length()}proxy(){return new Proxy({},{get:(h,c,p)=>{if(c==="toApi")return()=>this;if(c==="toView")return()=>this.view();const m=Number(c);if(Number.isNaN(m))throw new Error("INVALID_INDEX");const _=this.node.getNode(m);if(!_)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(_).proxy()}})}}return ge.ArrApi=v,ge}var Xo;function wl(){if(Xo)return $n;Xo=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.ModelApi=void 0;const n=hl(),d=dt(),g=ml(),f=wr(),i=vl(),a=bl();let l=class{constructor(e){this.model=e,this.next=0,this.onBeforeReset=new n.FanOut,this.onReset=new n.FanOut,this.onBeforePatch=new n.FanOut,this.onPatch=new n.FanOut,this.onBeforeLocalChange=new n.FanOut,this.onLocalChange=new n.FanOut,this.onLocalChanges=new i.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new n.FanOut,this.onTransaction=new n.FanOut,this.onChange=new i.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new i.MicrotaskBufferFanOut(this.onChange),this.onFlush=new n.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=t=>this.onChanges.listen(()=>t()),this.getSnapshot=()=>this.view(),this.builder=new f.PatchBuilder(e.clock),e.onbeforereset=()=>this.onBeforeReset.emit(),e.onreset=()=>this.onReset.emit(),e.onbeforepatch=t=>this.onBeforePatch.emit(t),e.onpatch=t=>this.onPatch.emit(t)}wrap(e){if(e instanceof d.ValNode)return e.api||(e.api=new g.ValApi(e,this));if(e instanceof d.StrNode)return e.api||(e.api=new g.StrApi(e,this));if(e instanceof d.BinNode)return e.api||(e.api=new g.BinApi(e,this));if(e instanceof d.ArrNode)return e.api||(e.api=new g.ArrApi(e,this));if(e instanceof d.ObjNode)return e.api||(e.api=new g.ObjApi(e,this));if(e instanceof d.ConNode)return e.api||(e.api=new g.ConApi(e,this));if(e instanceof d.VecNode)return e.api||(e.api=new g.VecApi(e,this));if(e instanceof a.ExtNode){if(e.api)return e.api;const t=this.model.ext.get(e.extId);return e.api=new t.Api(e,this)}else throw new Error("UNKNOWN_NODE")}get r(){return new g.ValApi(this.model.root,this)}get node(){return this.r.get()}in(e){return this.r.in(e)}find(e){return this.node.find(e)}con(e){return this.node.con(e)}val(e){return this.node.val(e)}vec(e){return this.node.vec(e)}obj(e){return this.node.obj(e)}str(e){return this.node.str(e)}bin(e){return this.node.bin(e)}arr(e){return this.node.arr(e)}root(e){const t=this.builder;return t.root(t.json(e)),this.apply(),this}apply(){const e=this.builder.patch.ops,t=e.length,r=this.model,s=this.next;this.onBeforeLocalChange.emit(s);for(let u=this.next;u<t;u++)r.applyOperation(e[u]);this.next=t,r.tick++,this.onLocalChange.emit(s)}advance(){const e=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(e)}view(){return this.model.view()}transaction(e){if(this.inTx)e();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),e(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const e=this.builder.flush();return this.next=0,e.ops.length&&this.onFlush.emit(e),e}autoFlush(e=!1){const t=()=>this.builder.patch.ops.length&&this.flush(),r=this.onLocalChanges.listen(t),s=this.onBeforeTransaction.listen(t),u=this.onTransaction.listen(t);return e&&t(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,r(),s(),u()}}};return $n.ModelApi=l,$n}var Kn={},Yo;function Rd(){if(Yo)return Kn;Yo=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.randomSessionId=void 0;const n=xe(),d=65535,g=n.SESSION.MAX-d,f=()=>Math.floor(g*Math.random()+d);return Kn.randomSessionId=f,Kn}var Hn={},Qo;function Id(){if(Qo)return Hn;Qo=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.Extensions=void 0;const n=Ze();let d=class gl{constructor(){this.ext={}}register(f){this.ext[f.id]=f}get(f){return this.ext[f]}size(){return Object.keys(this.ext).length}clone(){const f=new gl;for(const i of Object.values(this.ext))f.register(i);return f}toString(f=""){const i=Object.keys(this.ext).map(a=>+a).sort();return"extensions"+(0,n.printTree)(f,i.map(a=>l=>`${a}: ${this.ext[a].name}`))}};return Hn.Extensions=d,Hn}var St={},li={},ci={},Xn={},Zo;function Ri(){if(Zo)return Xn;Zo=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.printBinary=void 0;const n=(d="",g)=>{const f=g[0],i=g[1];let a="";return f&&(a+=`
`+d+"← "+f(d+"  ")),i&&(a+=`
`+d+"→ "+i(d+"  ")),a};return Xn.printBinary=n,Xn}var ea;function jd(){return ea||(ea=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),ve.__exportStar(Ri(),n)}(ci)),ci}var ta;function Td(){return ta||(ta=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.print=n.remove=n.insert=n.insertLeft=n.insertRight=void 0;const d=jd(),g=JSON.stringify,f=(b,h,c)=>{const p=h.p;if(!p)return b;const m=h===p.l;let _=p.bf|0;switch(m?p.bf=++_:p.bf=--_,_){case 0:return b;case 1:case-1:return f(b,p,h);default:{const y=c===h.l;return m?y?(i(p,h),h.p?b:h):(l(p,h,c),c.p?b:c):y?(o(p,h,c),c.p?b:c):(a(p,h),h.p?b:h)}}},i=(b,h)=>{const c=b.p,p=h.r;h.p=c,h.r=b,b.p=h,b.l=p,p&&(p.p=b),c&&(c.l===b?c.l=h:c.r=h);let m=b.bf,_=h.bf;m+=-1-(_>0?_:0),_+=-1+(m<0?m:0),b.bf=m,h.bf=_},a=(b,h)=>{const c=b.p,p=h.l;h.p=c,h.l=b,b.p=h,b.r=p,p&&(p.p=b),c&&(c.l===b?c.l=h:c.r=h);let m=b.bf,_=h.bf;m+=1-(_<0?_:0),_+=1+(m>0?m:0),b.bf=m,h.bf=_},l=(b,h,c)=>{a(h,c),i(b,c)},o=(b,h,c)=>{i(h,c),a(b,c)},e=(b,h,c)=>(c.r=h,h.p=c,c.bf--,c.l?b:f(b,c,h));n.insertRight=e;const t=(b,h,c)=>(c.l=h,h.p=c,c.bf++,c.r?b:f(b,c,h));n.insertLeft=t;const r=(b,h,c)=>{if(!b)return h;const p=h.k;let m=b,_,y=0;for(;_=(y=c(p,m.k))<0?m.l:m.r;)m=_;return y<0?(0,n.insertLeft)(b,h,m):(0,n.insertRight)(b,h,m)};n.insert=r;const s=(b,h)=>{if(!b)return h;const c=h.p,p=h.l,m=h.r;if(h.p=h.l=h.r=void 0,p&&m)if(p.r){let O=p,x=O;for(;x=O.r;)O=x;const C=O.l,R=O.p,D=C;return c&&(c.l===h?c.l=O:c.r=O),O.p=c,O.r=m,O.bf=h.bf,p!==O&&(O.l=p,p.p=O),m.p=O,R&&(R.l===O?R.l=D:R.r=D),D&&(D.p=R),v(c?b:O,R,1)}else{c&&(c.l===h?c.l=p:c.r=p),p.p=c,p.r=m,m.p=p;const O=h.bf;if(c)return p.bf=O,u(b,p,1);const x=O-1;if(p.bf=x,x>=-1)return p;const C=m.l;return m.bf>0?(o(p,m,C),C):(a(p,m),m)}const _=p||m;return _&&(_.p=c),c?c.l===h?(c.l=_,u(b,c,1)):(c.r=_,v(b,c,1)):_};n.remove=s;const u=(b,h,c)=>{let p=h.bf|0;p-=c,h.bf=p;let m=c;if(p===-1)return b;if(p<-1){const y=h.r;if(y.bf<=0)y.l&&y.bf===0&&(m=0),a(h,y),h=y;else{const O=y.l;o(h,y,O),h=O}}const _=h.p;return _?_.l===h?u(b,_,m):v(b,_,m):h},v=(b,h,c)=>{let p=h.bf|0;p+=c,h.bf=p;let m=c;if(p===1)return b;if(p>1){const y=h.l;if(y.bf>=0)y.r&&y.bf===0&&(m=0),i(h,y),h=y;else{const O=y.r;l(h,y,O),h=O}}const _=h.p;return _?_.l===h?u(b,_,m):v(b,_,m):h},w=(b,h="")=>{if(!b)return"∅";const{bf:c,l:p,r:m,k:_,v:y}=b,O=y&&typeof y=="object"&&y.constructor===Object?g(y):y&&typeof y=="object"?y.toString(h):g(y),x=_!==void 0?` { ${g(_)} = ${O} }`:"",C=c?` [${c}]`:"";return b.constructor.name+`${C}`+x+(0,d.printBinary)(h,[p?R=>(0,n.print)(p,R):null,m?R=>(0,n.print)(m,R):null])};n.print=w}(li)),li}var Yn={},ui={},Qn={},na;function _l(){if(na)return Qn;na=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.first=void 0;const n=d=>{let g=d;for(;g;)if(g.l)g=g.l;else return g;return g};return Qn.first=n,Qn}var Zn={},ra;function kd(){if(ra)return Zn;ra=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.next=void 0;const n=_l(),d=g=>{const f=g.r;if(f)return(0,n.first)(f);let i=g.p;for(;i&&i.r===g;)g=i,i=i.p;return i};return Zn.next=d,Zn}var ia;function yl(){return ia||(ia=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.remove=n.insert=n.insertLeft=n.insertRight=n.findOrNextLower=n.find=n.size=n.prev=n.last=n.next=n.first=void 0;const d=_l();Object.defineProperty(n,"first",{enumerable:!0,get:function(){return d.first}});const g=kd();Object.defineProperty(n,"next",{enumerable:!0,get:function(){return g.next}});const f=v=>{let w=v;for(;w;)if(w.r)w=w.r;else return w;return w};n.last=f;const i=v=>{if(v.l){for(v=v.l;v.r;)v=v.r;return v}let w=v.p;for(;w&&w.l===v;)v=w,w=w.p;return w};n.prev=i;const a=v=>{const w=v.l,b=v.r;return 1+(w?a(w):0)+(b?a(b):0)},l=v=>v?a(v):0;n.size=l;const o=(v,w,b)=>{let h=v;for(;h;){const c=b(w,h.k);if(c===0)return h;h=c<0?h.l:h.r}return h};n.find=o;const e=(v,w,b)=>{let h=v,c;for(;h;){const p=b(h.k,w);if(p===0)return h;if(p>0)h=h.l;else{const m=h.r;if(c=h,!m)return c;h=m}}return c};n.findOrNextLower=e;const t=(v,w)=>{const b=v.r=w.r;w.r=v,v.p=w,b&&(b.p=v)};n.insertRight=t;const r=(v,w)=>{const b=v.l=w.l;w.l=v,v.p=w,b&&(b.p=v)};n.insertLeft=r;const s=(v,w,b)=>{if(!v)return w;const h=w.k;let c=v;for(;c;){const p=b(h,c.k),m=p<0?c.l:c.r;if(m)c=m;else{p<0?(0,n.insertLeft)(w,c):(0,n.insertRight)(w,c);break}}return v};n.insert=s;const u=(v,w)=>{const b=w.p,h=w.l,c=w.r;if(w.p=w.l=w.r=void 0,!h&&!c){if(b)b.l===w?b.l=void 0:b.r=void 0;else return;return v}else if(h&&c){let m=h;for(;m.r;)m=m.r;return m.r=c,c.p=m,b?(b.l===w?b.l=h:b.r=h,h.p=b,v):(h.p=void 0,h)}const p=h||c;if(p.p=b,b)b.l===w?b.l=p:b.r=p;else return p;return v};n.remove=u}(ui)),ui}var di={},sa;function Md(){return sa||(sa=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),ve.__exportStar(Ze(),n)}(di)),di}var oa;function Ad(){if(oa)return Yn;oa=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.createMap=void 0;const n=yl(),d=Md(),g=(i,a)=>i===a?0:i<a?-1:1,f=(i,a,l,o,e,t)=>{class r{constructor(u){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=n.next,this.comparator=u||g}set(u,v){const w=this.root;if(w===void 0){this._size=1;const _=new i(u,v);return this.root=this.min=this.max=a(void 0,_,this.comparator)}const b=this.comparator;let h;const c=this.max;if(h=b(u,c.k),h===0)return c.v=v,c;if(h>0){const _=this.max=new i(u,v);return this.root=o(w,_,c),this._size++,_}const p=this.min;if(h=b(u,p.k),h===0)return p.v=v,p;if(h<0){const _=this.min=new i(u,v);return this.root=l(w,_,p),this._size++,_}let m=w;do{if(h=b(u,m.k),h===0)return m.v=v,m;if(h>0){const _=m.r;if(_===void 0){const y=new i(u,v);return this.root=o(w,y,m),this._size++,y}m=_}else if(h<0){const _=m.l;if(_===void 0){const y=new i(u,v);return this.root=l(w,y,m),this._size++,y}m=_}}while(!0)}find(u){const v=this.comparator;let w=this.root;for(;w;){const b=+v(u,w.k);if(b===0)return w;w=b<0?w.l:w.r}}get(u){var v;return(v=this.find(u))==null?void 0:v.v}del(u){const v=this.find(u);return v?(v===this.max&&(this.max=(0,n.prev)(v)),v===this.min&&(this.min=(0,n.next)(v)),this.root=e(this.root,v),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(u){return!!this.find(u)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(u){return(0,n.findOrNextLower)(this.root,u,this.comparator)||void 0}forEach(u){let v=this.first();if(v)do u(v);while(v=(0,n.next)(v))}first(){return this.min}last(){return this.max}iterator0(){let u=this.first();return()=>{if(!u)return;const v=u;return u=(0,n.next)(u),v}}iterator(){const u=this.iterator0();return{next:()=>{const v=u();return{value:v,done:!v}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(u){return this.constructor.name+(0,d.printTree)(u,[v=>t(this.root,v)])}}return r};return Yn.createMap=f,Yn}var aa;function Pd(){if(aa)return St;aa=1,Object.defineProperty(St,"__esModule",{value:!0}),St.AvlMap=St.AvlNode=void 0;const n=Td(),d=Ad();class g{constructor(i,a){this.k=i,this.v=a,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return St.AvlNode=g,St.AvlMap=(0,d.createMap)(g,n.insert,n.insertLeft,n.insertRight,n.remove,n.print),St}var la;function Ii(){if(la)return yt;la=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.Model=yt.UNDEFINED=void 0;const n=ve,d=n.__importStar($t()),g=n.__importStar(pe()),f=Ei(),i=wd(),a=wl(),l=xe(),o=Rd(),e=dt(),t=Ze(),r=Id(),s=Pd();yt.UNDEFINED=new f.ConNode(l.ORIGIN,void 0);let u=class _i{rndSid(){const w=this.clock,b=w.sid,h=w.peers;for(;;){const c=(0,o.randomSessionId)();if(b!==c&&!h.has(c))return c}}static fromPatches(w){if(!w.length)throw new Error("NO_PATCHES");const c=w[0].getId().sid;if(!c)throw new Error("NO_SID");const p=_i.create(void 0,c);return p.applyBatch(w),p}constructor(w){this.root=new e.RootNode(this,l.ORIGIN),this.index=new s.AvlMap(g.compare),this.ext=new r.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=w,w.time||(w.time=1)}get api(){return this._api||(this._api=new a.ModelApi(this)),this._api}get find(){return this.api.r.proxy()}get s(){return this.api.r.proxy().val}applyBatch(w){const b=w.length;for(let h=0;h<b;h++)this.applyPatch(w[h])}applyLocalPatch(w){const b=w.getId();if(b){const h=this.clock;if(h.sid===b.sid){const c=h.time;c>b.time&&(w=w.rebase(c))}}this.applyPatch(w)}applyPatch(w){var c,p;(c=this.onbeforepatch)==null||c.call(this,w);const b=w.ops,{length:h}=b;for(let m=0;m<h;m++)this.applyOperation(b[m]);this.tick++,(p=this.onpatch)==null||p.call(this,w)}applyOperation(w){this.clock.observe(w.id,w.span());const b=this.index;if(w instanceof d.InsStrOp){const h=b.get(w.obj);h instanceof e.StrNode&&h.ins(w.ref,w.id,w.data)}else if(w instanceof d.NewObjOp){const h=w.id;b.get(h)||b.set(h,new e.ObjNode(this,h))}else if(w instanceof d.NewArrOp){const h=w.id;b.get(h)||b.set(h,new e.ArrNode(this,h))}else if(w instanceof d.NewStrOp){const h=w.id;b.get(h)||b.set(h,new e.StrNode(h))}else if(w instanceof d.NewValOp){const h=w.id;b.get(h)||b.set(h,new e.ValNode(this,h,l.ORIGIN))}else if(w instanceof d.NewConOp){const h=w.id;b.get(h)||b.set(h,new f.ConNode(h,w.val))}else if(w instanceof d.InsObjOp){const h=b.get(w.obj),c=w.data,p=c.length;if(h instanceof e.ObjNode)for(let m=0;m<p;m++){const _=c[m],y=b.get(_[1]);if(!y||h.id.time>=_[1].time)continue;const O=h.put(_[0]+"",y.id);O&&this.deleteNodeTree(O)}}else if(w instanceof d.InsVecOp){const h=b.get(w.obj),c=w.data,p=c.length;if(h instanceof e.VecNode)for(let m=0;m<p;m++){const _=c[m],y=b.get(_[1]);if(!y||h.id.time>=_[1].time)continue;const O=h.put(Number(_[0]),y.id);O&&this.deleteNodeTree(O)}}else if(w instanceof d.InsValOp){const h=w.obj,c=h.sid===l.SESSION.SYSTEM&&h.time===l.SYSTEM_SESSION_TIME.ORIGIN?this.root:b.get(h);if(c instanceof e.ValNode&&b.get(w.val)){const m=c.set(w.val);m&&this.deleteNodeTree(m)}}else if(w instanceof d.InsArrOp){const h=b.get(w.obj);if(h instanceof e.ArrNode){const c=[],p=w.data,m=p.length;for(let _=0;_<m;_++){const y=p[_];b.get(y)&&(h.id.time>=y.time||c.push(y))}c.length&&h.ins(w.ref,w.id,c)}}else if(w instanceof d.DelOp){const h=b.get(w.obj);if(h instanceof e.ArrNode){const c=w.what.length;for(let p=0;p<c;p++){const m=w.what[p];for(let _=0;_<m.span;_++){const y=h.getById(new g.Timestamp(m.sid,m.time+_));y&&this.deleteNodeTree(y)}}h.delete(w.what)}else(h instanceof e.StrNode||h instanceof e.BinNode)&&h.delete(w.what)}else if(w instanceof d.NewBinOp){const h=w.id;b.get(h)||b.set(h,new e.BinNode(h))}else if(w instanceof d.InsBinOp){const h=b.get(w.obj);h instanceof e.BinNode&&h.ins(w.ref,w.id,w.data)}else if(w instanceof d.NewVecOp){const h=w.id;b.get(h)||b.set(h,new e.VecNode(this,h))}}deleteNodeTree(w){if(w.sid===l.SESSION.SYSTEM)return;const h=this.index.get(w);if(!h)return;const c=h.api;c&&c.events.handleDelete(),h.children(p=>this.deleteNodeTree(p.id)),this.index.del(w)}fork(w=this.rndSid()){const b=_i.fromBinary(this.toBinary());return b.clock.sid!==w&&b.clock instanceof g.ClockVector&&(b.clock=b.clock.fork(w)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(w){var p,m;(p=this.onbeforereset)==null||p.call(this);const b=this.index;this.index=new s.AvlMap(g.compare);const h=w.toBinary();i.decoder.decode(h,this),this.clock=w.clock.clone(),this.ext=w.ext.clone();const c=this._api;c&&(c.flush(),c.builder.clock=this.clock),b.forEach(({v:_})=>{const y=_.api;if(!y)return;const O=this.index.get(_.id);if(!O){y.events.handleDelete();return}y.node=O,O.api=y}),this.tick++,(m=this.onreset)==null||m.call(this)}view(){return this.root.view()}toBinary(){return i.encoder.encode(this)}setSchema(w,b=!0){const h=this.clock;if(h.time===1){const p=h.sid;b&&(h.sid=l.SESSION.GLOBAL),this.api.root(w),b&&this.setSid(p)}return this}setSid(w){const b=this.clock,h=b.sid;h!==w&&(b.sid=w,b.observe(new g.Timestamp(h,b.time-1),1))}toString(w=""){const b=()=>"",h=this.ext.size()>0;return"model"+(0,t.printTree)(w,[c=>this.root.toString(c),b,c=>{const p=[];return this.index.forEach(m=>p.push(m.v)),`index (${p.length} nodes)`+(p.length?(0,t.printTree)(c,p.map(m=>_=>`${m.name()} ${g.printTs(m.id)}`)):"")},b,c=>`view${(0,t.printTree)(c,[p=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+p)])}`,b,c=>this.clock.toString(c),h?b:null,h?c=>this.ext.toString(c):null])}};return yt.Model=u,u.sid=o.randomSessionId,u.withLogicalClock=v=>u.create(void 0,v),u.withServerClock=(v=1)=>u.create(void 0,new g.ServerClockVector(l.SESSION.SERVER,v)),u.create=(v,w=u.sid())=>{const b=typeof w=="number"?w===l.SESSION.SERVER?new g.ServerClockVector(l.SESSION.SERVER,1):new g.ClockVector(w,1):w,h=new u(b);return v&&h.setSchema(v,!0),h},u.fromBinary=v=>i.decoder.decode(v),u.load=(v,w,b)=>{const h=i.decoder.decode(v);return b&&h.setSchema(b,!0),typeof w=="number"&&h.setSid(w),h},yt}var ca;function Ol(){if(ca)return An;ca=1,Object.defineProperty(An,"__esModule",{value:!0}),An.ValNode=void 0;const n=pe(),d=xe(),g=Ze(),f=Ii();let i=class{constructor(l,o,e){this.doc=l,this.id=o,this.val=e,this.api=void 0}set(l){if((0,n.compare)(l,this.val)<=0&&this.val.sid!==d.SESSION.SYSTEM||(0,n.compare)(l,this.id)<=0)return;const o=this.val;return this.val=l,o}node(){return this.val.sid===d.SESSION.SYSTEM?f.UNDEFINED:this.child()}view(){var l;return(l=this.node())==null?void 0:l.view()}children(l){l(this.node())}child(){return this.doc.index.get(this.val)}container(){const l=this.node();return l?l.container():void 0}name(){return"val"}toString(l=""){const o=this.node();return this.name()+" "+(0,n.printTs)(this.id)+(0,g.printTree)(l,[t=>o?o.toString(t):(0,n.printTs)(this.val)])}};return An.ValNode=i,An}var er={},ua;function Dd(){if(ua)return er;ua=1,Object.defineProperty(er,"__esModule",{value:!0}),er.RootNode=void 0;const n=xe(),d=Ol();let g=class extends d.ValNode{constructor(i,a){super(i,n.ORIGIN,a)}name(){return"root"}};return er.RootNode=g,er}var tr={},nr={},da;function Bd(){if(da)return nr;da=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.CRDT_CONSTANTS=void 0;var n;return function(d){d[d.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(n||(nr.CRDT_CONSTANTS=n={})),nr}var fa;function qd(){if(fa)return tr;fa=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.VecNode=void 0;const n=Ei(),d=Bd(),g=Ze(),f=pe();let i=class{constructor(l,o){this.doc=l,this.id=o,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}val(l){return this.elements[l]}get(l){const o=this.elements[l];if(o)return this.doc.index.get(o)}put(l,o){if(l>d.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const e=this.val(l);if(!(e&&(0,f.compare)(e,o)>=0)){if(l>this.elements.length)for(let t=this.elements.length;t<l;t++)this.elements.push(void 0);return l<this.elements.length?this.elements[l]=o:this.elements.push(o),e}}ext(){if(this.__extNode)return this.__extNode;const l=this.getExtId();if(!(l>=0))return;const e=this.doc.ext.get(l);if(e)return this.__extNode=new e.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const l=this.get(0);if(!(l instanceof n.ConNode))return-1;const o=l.val,e=this.id;return!(o instanceof Uint8Array)||o.length!==3||o[1]!==e.sid%256||o[2]!==e.time%256?-1:o[0]}child(){return this.ext()}container(){return this}children(l){const o=this.elements,e=o.length,t=this.doc.index;for(let r=0;r<e;r++){const s=o[r];if(!s)continue;const u=t.get(s);u&&l(u)}}view(){const l=this.ext();if(l)return l.view();let o=!0;const e=this._view,t=[],r=this.doc.index,s=this.elements,u=s.length;for(let v=0;v<u;v++){const w=s[v],b=w?r.get(w):void 0,h=b?b.view():void 0;e[v]!==h&&(o=!1),t.push(h)}return o?e:this._view=t}name(){return"vec"}toString(l=""){const o=this.ext(),e=this.name()+" "+(0,f.printTs)(this.id)+(o?` { extension = ${this.getExtId()} }`:"");if(o)return this.child().toString(l,this.id);const t=this.doc.index;return e+(0,g.printTree)(l,[...this.elements.map((r,s)=>u=>`${s}: ${r&&t.get(r)?t.get(r).toString(u+"  "+" ".repeat((""+s).length)):"nil"}`),...o?[r=>`${this.child().toString(r)}`]:[]])}};return tr.VecNode=i,tr}var rr={},ha;function Vd(){if(ha)return rr;ha=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.ObjNode=void 0;const n=Ze(),d=pe();let g=class{constructor(i,a){this.doc=i,this.id=a,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(i){const a=this.keys.get(i);if(a)return this.doc.index.get(a)}put(i,a){const l=this.keys.get(i);if(!(l&&(0,d.compare)(l,a)>=0))return this.keys.set(i,a),l}nodes(i){const a=this.doc.index;this.keys.forEach((l,o)=>i(a.get(l),o))}children(i){const a=this.doc.index;this.keys.forEach((l,o)=>i(a.get(l)))}child(){}container(){return this}view(){const i=this.doc,a=i.clock.time+i.tick,l=this._view;if(this._tick===a)return l;const o={},e=i.index;let t=!0;return this.keys.forEach((r,s)=>{const u=e.get(r);if(!u){t=!1;return}const v=u.view();v!==void 0?(l[s]!==v&&(t=!1),o[s]=v):l[s]!==void 0&&(t=!1)}),t?l:(this._tick=a,this._view=o)}name(){return"obj"}toString(i=""){return this.name()+" "+(0,d.printTs)(this.id)+(0,n.printTree)(i,[...this.keys.entries()].filter(([,l])=>!!this.doc.index.get(l)).map(([l,o])=>e=>JSON.stringify(l)+(0,n.printTree)(e+" ",[t=>this.doc.index.get(o).toString(t)])))}};return rr.ObjNode=g,rr}var Ct={},ir={},fi={},pa;function $d(){return pa||(pa=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.rlSplay=n.lrSplay=n.llSplay=n.rrSplay=n.lSplay=n.rSplay=n.splay=void 0;const d=(e,t,r)=>{const s=t.p;if(!s)return e;const u=s.p,v=s.l===t;return u?(u.l===s?v?e=(0,n.llSplay)(e,t,s,u):e=(0,n.lrSplay)(e,t,s,u):v?e=(0,n.rlSplay)(e,t,s,u):e=(0,n.rrSplay)(e,t,s,u),r>1?(0,n.splay)(e,t,r-1):e):(v?(0,n.rSplay)(t,s):(0,n.lSplay)(t,s),t)};n.splay=d;const g=(e,t)=>{const r=e.r;e.p=void 0,e.r=t,t.p=e,t.l=r,r&&(r.p=t)};n.rSplay=g;const f=(e,t)=>{const r=e.l;e.p=void 0,e.l=t,t.p=e,t.r=r,r&&(r.p=t)};n.lSplay=f;const i=(e,t,r,s)=>{const u=r.l,v=t.l,w=s.p;return t.p=w,t.l=r,r.p=t,r.l=s,r.r=v,s.p=r,s.r=u,u&&(u.p=s),v&&(v.p=r),w?w.l===s?w.l=t:w.r=t:e=t,e};n.rrSplay=i;const a=(e,t,r,s)=>{const u=r.r,v=t.r,w=s.p;return t.p=w,t.r=r,r.p=t,r.l=v,r.r=s,s.p=r,s.l=u,u&&(u.p=s),v&&(v.p=r),w?w.l===s?w.l=t:w.r=t:e=t,e};n.llSplay=a;const l=(e,t,r,s)=>{const u=t.l,v=t.r,w=s.p;return t.p=w,t.l=r,t.r=s,r.p=t,r.r=u,s.p=t,s.l=v,u&&(u.p=r),v&&(v.p=s),w?w.l===s?w.l=t:w.r=t:e=t,e};n.lrSplay=l;const o=(e,t,r,s)=>{const u=t.r,v=t.l,w=s.p;return t.p=w,t.l=s,t.r=r,r.p=t,r.l=u,s.p=t,s.r=v,u&&(u.p=r),v&&(v.p=s),w?w.l===s?w.l=t:w.r=t:e=t,e};n.rlSplay=o}(fi)),fi}var hi={},va;function Ud(){return va||(va=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.splay2=void 0;const d=(e,t)=>{const r=t.p2;if(!r)return e;const s=r.p2,u=r.l2===t;return s?(s.l2===r?u?e=a(e,t,r,s):e=l(e,t,r,s):u?e=o(e,t,r,s):e=i(e,t,r,s),(0,n.splay2)(e,t)):(u?g(t,r):f(t,r),t)};n.splay2=d;const g=(e,t)=>{const r=e.r2;e.p2=void 0,e.r2=t,t.p2=e,t.l2=r,r&&(r.p2=t)},f=(e,t)=>{const r=e.l2;e.p2=void 0,e.l2=t,t.p2=e,t.r2=r,r&&(r.p2=t)},i=(e,t,r,s)=>{const u=r.l2,v=t.l2,w=s.p2;return t.p2=w,t.l2=r,r.p2=t,r.l2=s,r.r2=v,s.p2=r,s.r2=u,u&&(u.p2=s),v&&(v.p2=r),w?w.l2===s?w.l2=t:w.r2=t:e=t,e},a=(e,t,r,s)=>{const u=r.r2,v=t.r2,w=s.p2;return t.p2=w,t.r2=r,r.p2=t,r.l2=v,r.r2=s,s.p2=r,s.l2=u,u&&(u.p2=s),v&&(v.p2=r),w?w.l2===s?w.l2=t:w.r2=t:e=t,e},l=(e,t,r,s)=>{const u=t.l2,v=t.r2,w=s.p2;return t.p2=w,t.l2=r,t.r2=s,r.p2=t,r.r2=u,s.p2=t,s.l2=v,u&&(u.p2=r),v&&(v.p2=s),w?w.l2===s?w.l2=t:w.r2=t:e=t,e},o=(e,t,r,s)=>{const u=t.r2,v=t.l2,w=s.p2;return t.p2=w,t.l2=s,t.r2=r,r.p2=t,r.l2=u,s.p2=t,s.r2=v,u&&(u.p2=r),v&&(v.p2=s),w?w.l2===s?w.l2=t:w.r2=t:e=t,e}}(hi)),hi}var Ce={},ba;function Ld(){if(ba)return Ce;ba=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.remove2=Ce.insert2=Ce.prev2=Ce.next2=Ce.last2=Ce.first2=void 0;const n=e=>{let t=e;for(;t;)if(t.l2)t=t.l2;else return t;return t};Ce.first2=n;const d=e=>{let t=e;for(;t;)if(t.r2)t=t.r2;else return t;return t};Ce.last2=d;const g=e=>{if(e.r2){for(e=e.r2;e.l2;)e=e.l2;return e}let t=e.p2;for(;t&&t.r2===e;)e=t,t=t.p2;return t};Ce.next2=g;const f=e=>{if(e.l2){for(e=e.l2;e.r2;)e=e.r2;return e}let t=e.p2;for(;t&&t.l2===e;)e=t,t=t.p2;return t};Ce.prev2=f;const i=(e,t)=>{const r=e.r2=t.r2;t.r2=e,e.p2=t,r&&(r.p2=e)},a=(e,t)=>{const r=e.l2=t.l2;t.l2=e,e.p2=t,r&&(r.p2=e)},l=(e,t,r)=>{if(!e)return t;let s=e;for(;s;){const u=r(t,s),v=u<0?s.l2:s.r2;if(v)s=v;else{u<0?a(t,s):i(t,s);break}}return e};Ce.insert2=l;const o=(e,t)=>{const r=t.p2,s=t.l2,u=t.r2;if(t.p2=t.l2=t.r2=void 0,!s&&!u){if(r)r.l2===t?r.l2=void 0:r.r2=void 0;else return;return e}else if(s&&u){let w=s;for(;w.r2;)w=w.r2;return w.r2=u,u.p2=w,r?(r.l2===t?r.l2=s:r.r2=s,s.p2=r,e):(s.p2=void 0,s)}const v=s||u;if(v.p2=r,r)r.l2===t?r.l2=v:r.r2=v;else return v;return e};return Ce.remove2=o,Ce}var sr={},ma;function Fd(){if(ma)return sr;ma=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.printOctets=void 0;const n=(d,g=16)=>{let f="";if(!d.length)return f;d[0]<16&&(f+="0"),f+=d[0].toString(16);for(let i=1;i<d.length&&i<g;i++){const a=d[i];f+=" ",a<16&&(f+="0"),f+=a.toString(16)}return d.length>g&&(f+=`… (${d.length-g} more)`),f};return sr.printOctets=n,sr}var wa;function ji(){if(wa)return ir;wa=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.AbstractRga=void 0;const n=pe(),d=nl(),g=$d(),f=Ud(),i=Ld(),a=xe(),l=Ze(),o=Ri(),e=Fd(),t=(h,c)=>{const p=h.id,m=c.id;return p.sid-m.sid||p.time-m.time},r=h=>{const c=h.l,p=h.r;h.len=(h.del?0:h.span)+(c?c.len:0)+(p?p.len:0)},s=h=>{const c=h.l,p=h.r;h.len=h.span+(c?c.len:0)+(p?p.len:0)},u=(h,c)=>{for(;h;)h.len+=c,h=h.p},v=h=>{const c=h.r;if(c){h=c;let m;for(;m=h.l;)h=m;return h}let p=h.p;for(;p&&p.r===h;)h=p,p=p.p;return p},w=h=>{const c=h.l;if(c){h=c;let m;for(;m=h.r;)h=m;return h}let p=h.p;for(;p&&p.l===h;)h=p,p=p.p;return p};let b=class{constructor(c){this.id=c,this.root=void 0,this.ids=void 0,this.count=0}ins(c,p,m){const _=this.id,y=c.time,O=c.sid;if(_.time===y&&_.sid===O){this.insAfterRoot(c,p,m);return}let C=this.ids,R=C;for(;C;){const A=C.id,q=A.sid;if(q>O)C=C.l2;else if(q<O)R=C,C=C.r2;else{const ne=A.time;if(ne>y)C=C.l2;else if(ne<y)R=C,C=C.r2;else{R=C;break}}}if(!R)return;const D=R.id,P=D.time,V=D.sid,I=R.span;if(V!==O||y-P>=I)return;const G=y-P;this.insAfterChunk(c,R,G,p,m)}insAt(c,p,m){if(!c){const R=this.id;return this.insAfterRoot(R,p,m),R}const _=this.findChunk(c-1);if(!_)return;const[y,O]=_,x=y.id,C=O===0?x:new n.Timestamp(x.sid,x.time+O);return this.insAfterChunk(C,y,O,p,m),C}insAfterRoot(c,p,m){const _=this.createChunk(p,m),y=this.first();if(!y)this.setRoot(_);else if((0,n.compare)(y.id,p)<0)this.insertBefore(_,y);else{if((0,n.containsId)(y.id,y.span,p))return;this.insertAfterRef(_,c,y)}}insAfterChunk(c,p,m,_,y){const O=p.id,x=O.time,C=O.sid,R=p.span,D=this.createChunk(_,y);if(m+1<R){const V=_.sid,I=_.time;if(C===V&&x<=I&&x+R-1>=I)return;if(I>c.time+1||V>c.sid){this.insertInside(D,p,m+1),this.splay(D);return}}this.insertAfterRef(D,c,p),this.splay(D)}delete(c){const p=c.length;for(let m=0;m<p;m++)this.deleteSpan(c[m]);this.onChange()}deleteSpan(c){const p=c.span,m=c.time,_=m+p-1,y=this.findById(c);if(!y)return;let O=y,x=O;for(;O;){x=O;const C=O.id,R=O.span,D=C.time,P=D+R-1;if(O.del){if(P>=_)break;O=O.s;continue}const V=m<=D,I=m<=P;if(V)if(_>=P){if(O.delete(),u(O,-O.span),_<=P)break}else{const G=_-D+1,A=this.split(O,G);O.delete(),r(A),u(O,-O.span);break}else if(I)if(_>=P){const G=m-D,A=this.split(O,G);if(A.delete(),A.len=A.r?A.r.len:0,u(O,-A.span),_<=P)break}else{const G=this.split(O,_-D+1),A=this.split(O,m-D);A.delete(),r(G),r(A),u(O,-A.span);break}O=O.s}x&&this.mergeTombstones2(y,x)}find(c){let p=this.root;for(;p;){const m=p.l,_=m?m.len:0;let y;if(c<_)p=m;else if(p.del)c-=_,p=p.r;else if(c<_+(y=p.span)){const O=c-_,x=p.id;return O?new n.Timestamp(x.sid,x.time+O):x}else c-=_+y,p=p.r}}findChunk(c){let p=this.root;for(;p;){const m=p.l,_=m?m.len:0;let y;if(c<_)p=m;else if(p.del)c-=_,p=p.r;else{if(c<_+(y=p.span))return[p,c-_];c-=_+y,p=p.r}}}findInterval(c,p){const m=[];if(!p)return m;let _=this.root,y=0;for(;_;){const C=_.l?_.l.len:0;if(c<C)_=_.l;else if(_.del)c-=C,_=_.r;else if(c<C+_.span){y=c-C;break}else c-=C+_.span,_=_.r}if(!_)return m;if(_.span>=p+y){const C=_.id;return m.push((0,n.tss)(C.sid,C.time+y,p)),m}const O=_.span-y,x=_.id;if(m.push((0,n.tss)(x.sid,x.time+y,O)),p-=O,_=v(_),!_)return m;do{if(_.del)continue;const C=_.id,R=_.span;if(p<=R)return m.push((0,n.tss)(C.sid,C.time,p)),m;m.push((0,n.tss)(C.sid,C.time,R)),p-=R}while((_=v(_))&&p>0);return m}findInterval2(c,p){const m=[];return this.range0(void 0,c,p,(_,y,O)=>{const x=_.id;m.push((0,n.tss)(x.sid,x.time+y,O))}),m}range0(c,p,m,_){let y=c||this.findById(p);if(c)for(;y&&!(0,n.containsId)(y.id,y.span,p);)y=v(y);if(y){if(y.del){if((0,n.containsId)(y.id,y.span,m))return}else{const O=p.time-y.id.time;if((0,n.containsId)(y.id,y.span,m)){const R=m.time-p.time+1;return _(y,O,R),y}const C=y.span-O;if(_(y,O,C))return y}for(y=v(y);y;){if((0,n.containsId)(y.id,y.span,m))return!y.del&&_(y,0,m.time-y.id.time+1),y;if(!y.del&&_(y,0,y.span))return y;y=v(y)}return y}}first(){let c=this.root;for(;c;){const p=c.l;if(p)c=p;else return c}return c}last(){let c=this.root;for(;c;){const p=c.r;if(p)c=p;else return c}return c}lastId(){const c=this.last();if(!c)return;const p=c.id,m=c.span;return m===1?p:new n.Timestamp(p.sid,p.time+m-1)}next(c){return v(c)}prev(c){return w(c)}length(){const c=this.root;return c?c.len:0}size(){return this.count}pos(c){const p=c.p,m=c.l;if(!p)return m?m.len:0;const _=this.pos(p);if(p.r===c)return _+(p.del?0:p.span)+(m?m.len:0);const O=c.r;return _-(c.del?0:c.span)-(O?O.len:0)}setRoot(c){this.root=c,this.insertId(c),this.onChange()}insertBefore(c,p){const m=p.l;p.l=c,c.l=m,c.p=p;let _=0;m&&(m.p=c,_=m.len),c.len=c.span+_,u(p,c.span),this.insertId(c),this.onChange()}insertAfter(c,p){const m=p.r;p.r=c,c.r=m,c.p=p;let _=0;m&&(m.p=c,_=m.len),c.len=c.span+_,u(p,c.span),this.insertId(c),this.onChange()}insertAfterRef(c,p,m){const _=c.id,y=_.sid,O=_.time;let x=!1;for(;;){const C=m.id,R=C.time+m.span;m.s||(x=C.sid===y&&R===O&&R-1===p.time,x&&(m.s=c));const D=v(m);if(!D)break;const P=D.id,V=P.time,I=P.sid;if(V<O)break;if(V===O){if(I===y)return;if(I<y)break}m=D}x&&!m.del?(this.mergeContent(m,c.data),m.s=void 0):this.insertAfter(c,m)}mergeContent(c,p){const m=c.span;c.merge(p),u(c,c.span-m),this.onChange()}insertInside(c,p,m){const _=p.p,y=p.l,O=p.r,x=p.s,C=p.len,R=p.split(m);if(p.s=R,R.s=x,p.l=p.r=R.l=R.r=void 0,R.l=void 0,c.p=_,!y)c.l=p,p.p=c;else{c.l=y,y.p=c;const V=y.r;y.r=p,p.p=y,p.l=V,V&&(V.p=p)}if(!O)c.r=R,R.p=c;else{c.r=O,O.p=c;const V=O.l;O.l=R,R.p=O,R.r=V,V&&(V.p=R)}_?_.l===p?_.l=c:_.r=c:this.root=c,r(p),r(R),y&&(y.len=(y.l?y.l.len:0)+p.len+(y.del?0:y.span)),O&&(O.len=(O.r?O.r.len:0)+R.len+(O.del?0:O.span)),c.len=C+c.span;const D=c.span;let P=c.p;for(;P;)P.len+=D,P=P.p;this.insertId(R),this.insertIdFast(c),this.onChange()}split(c,p){const m=c.s,_=c.split(p),y=c.r;return c.s=_,_.r=y,_.s=m,c.r=_,_.p=c,this.insertId(_),y&&(y.p=_),_}mergeTombstones(c,p){if(!c.del||!p.del)return!1;const m=c.id,_=p.id;return m.sid!==_.sid||m.time+c.span!==_.time?!1:(c.s=p.s,c.span+=p.span,this.deleteChunk(p),!0)}mergeTombstones2(c,p){let m=c;for(;m;){const y=v(m);if(!y)break;if(!this.mergeTombstones(m,y)){if(y===p){if(y){const x=v(y);x&&this.mergeTombstones(y,x)}break}m=m.s}}const _=w(c);_&&this.mergeTombstones(_,c)}removeTombstones(){let c=this.first();const p=[];for(;c;)c.del&&p.push(c),c=v(c);for(let m=0;m<p.length;m++)this.deleteChunk(p[m])}deleteChunk(c){this.deleteId(c);const p=c.p,m=c.l,_=c.r;if(c.id=a.ORIGIN,!m&&!_)p?p.l===c?p.l=void 0:p.r=void 0:this.root=void 0;else if(m&&_){let y=m;for(;y.r;)y=y.r;y.r=_,_.p=y;const O=_.len;let x;for(x=y,p?(p.l===c?p.l=m:p.r=m,m.p=p):(this.root=m,m.p=void 0);x&&x!==p;)x.len+=O,x=x.p}else{const y=m||_;y.p=p,p?p.l===c?p.l=y:p.r=y:this.root=y}}insertId(c){this.ids=(0,i.insert2)(this.ids,c,t),this.count++,this.ids=(0,f.splay2)(this.ids,c)}insertIdFast(c){this.ids=(0,i.insert2)(this.ids,c,t),this.count++}deleteId(c){this.ids=(0,i.remove2)(this.ids,c),this.count--}findById(c){const p=c.sid,m=c.time;let _=this.ids,y=_;for(;_;){const P=_.id,V=P.sid;if(V>p)_=_.l2;else if(V<p)y=_,_=_.r2;else{const I=P.time;if(I>m)_=_.l2;else if(I<m)y=_,_=_.r2;else{y=_;break}}}if(!y)return;const O=y.id,x=O.time,C=O.sid,R=y.span;if(!(C!==p||m<x||m-x>=R))return y}prevId(c){let p=this.findById(c);if(!p)return;const m=c.time;if(p.id.time<m)return new n.Timestamp(c.sid,m-1);if(p=w(p),!p)return;const _=p.id;return p.span>1?new n.Timestamp(_.sid,_.time+p.span-1):_}spanView(c){const p=[];let m=c.span;const _=c.time;let y=this.findById(c);if(!y)return p;if(!y.del)if(y.span>=m+_-y.id.time){const O=_-y.id.time,x=O+m,C=y.view().slice(O,x);return p.push(C),p}else{const O=_-y.id.time,x=y.view().slice(O,c.span);m-=y.span-O,p.push(x)}for(;y=y.s;){const O=y.span;if(!y.del){if(O>m){const x=y.view().slice(0,m);p.push(x);break}p.push(y.data)}if(m-=O,m<=0)break}return p}splay(c){const p=c.p;if(!p)return;const m=p.p,_=p.l===c;if(!m){_?(0,g.rSplay)(c,p):(0,g.lSplay)(c,p),this.root=c,r(p),s(c);return}m.l===p?_?this.root=(0,g.llSplay)(this.root,c,p,m):this.root=(0,g.lrSplay)(this.root,c,p,m):_?this.root=(0,g.rlSplay)(this.root,c,p,m):this.root=(0,g.rrSplay)(this.root,c,p,m),r(m),r(p),s(c),this.splay(c)}iterator(){let c=this.first();return()=>{const p=c;return c&&(c=v(c)),p}}ingest(c,p){if(c<1)return;const m=new Map;this.root=this._ingest(c,()=>{const _=p(),y=_.id,O=y.sid+"."+y.time,x=m.get(O);x&&(x.s=_,m.delete(O));const C=(0,n.tick)(y,_.span);return m.set(C.sid+"."+C.time,_),_})}_ingest(c,p){const m=c>>1,_=c-m-1,y=m>0?this._ingest(m,p):void 0,O=p();y&&(O.l=y,y.p=O);const x=_>0?this._ingest(_,p):void 0;return x&&(O.r=x,x.p=O),r(O),this.insertId(O),O}toStringName(){return"AbstractRga"}toString(c=""){const p=this.view();let m="";return(0,d.isUint8Array)(p)?m+=` { ${(0,e.printOctets)(p)||"∅"} }`:typeof p=="string"&&(m+=`{ ${p.length>32?JSON.stringify(p.substring(0,32))+" …":JSON.stringify(p)} }`),`${this.toStringName()} ${(0,n.printTs)(this.id)} ${m}`+(0,l.printTree)(c,[y=>this.root?this.printChunk(y,this.root):"∅"])}printChunk(c,p){return this.formatChunk(p)+(0,o.printBinary)(c,[p.l?m=>this.printChunk(m,p.l):null,p.r?m=>this.printChunk(m,p.r):null])}formatChunk(c){let m=`chunk ${(0,n.printTs)(c.id)}:${c.span} .${c.len}.`;if(c.del)m+=` [${c.span}]`;else if((0,d.isUint8Array)(c.data))m+=` { ${(0,e.printOctets)(c.data)||"∅"} }`;else if(typeof c.data=="string"){const _=c.data.length>32?JSON.stringify(c.data.substring(0,32))+" …":JSON.stringify(c.data);m+=` { ${_} }`}return m}};return ir.AbstractRga=b,ir}var ga;function zd(){if(ga)return Ct;ga=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.ArrNode=Ct.ArrChunk=void 0;const n=ji(),d=pe(),g=Ri(),f=Ze();class i{constructor(o,e,t){this.id=o,this.span=e,this.len=t?e:0,this.del=!t,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=t}merge(o){this.data.push(...o),this.span=this.data.length}split(o){const e=this.span;if(this.span=o,!this.del){const r=this.data.splice(o);return new i((0,d.tick)(this.id,o),e-o,r)}return new i((0,d.tick)(this.id,o),e-o,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new i(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ct.ArrChunk=i;let a=class extends n.AbstractRga{constructor(o,e){super(e),this.doc=o,this._tick=0,this._view=[],this.api=void 0}get(o){const e=this.findChunk(o);if(e)return e[0].data[e[1]]}getNode(o){const e=this.get(o);if(e)return this.doc.index.get(e)}getById(o){const e=this.findById(o);if(!e||e.del)return;const t=o.time-e.id.time;return e.data[t]}createChunk(o,e){return new i(o,e?e.length:0,e)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const o=this.doc,e=o.clock.time+o.tick,t=this._view;if(this._tick===e)return t;const r=[],s=o.index;let u=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const b of w.data){const h=s.get(b);if(!h){u=!1;continue}const c=h.view();t[r.length]!==c&&(u=!1),r.push(c)}return t.length!==r.length&&(u=!1),u?t:(this._tick=e,this._view=r)}children(o){const e=this.doc.index;for(let t=this.first();t;t=this.next(t))if(!t.del)for(const r of t.data)o(e.get(r))}name(){return"arr"}printChunk(o,e){const t=this.pos(e);let r="";if(!e.del){const s=this.doc.index;r=(0,f.printTree)(o,e.data.map(u=>s.get(u)).filter(u=>!!u).map((u,v)=>w=>`[${t+v}]: ${u.toString(w+"    "+" ".repeat(String(v).length))}`))}return this.formatChunk(e)+r+(0,g.printBinary)(o,[e.l?s=>this.printChunk(s,e.l):null,e.r?s=>this.printChunk(s,e.r):null])}};return Ct.ArrNode=a,Ct}var Et={},_a;function Wd(){if(_a)return Et;_a=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.BinNode=Et.BinChunk=void 0;const n=pe(),d=ji();class g{constructor(a,l,o){this.id=a,this.span=l,this.len=o?l:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(a){const l=this.data.length,o=new Uint8Array(l+a.length);o.set(this.data),o.set(a,l),this.data=o,this.span=o.length}split(a){if(!this.del){const o=this.data,e=o.subarray(a),t=new g((0,n.tick)(this.id,a),this.span-a,e);return this.data=o.subarray(0,a),this.span=a,t}const l=new g((0,n.tick)(this.id,a),this.span-a,void 0);return this.span=a,l}delete(){this.del=!0,this.data=void 0}clone(){return new g(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Et.BinChunk=g;let f=class extends d.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const a=new Uint8Array(this.length());let l=0,o=this.first();for(;o;){if(!o.del){const e=o.data;a.set(e,l),l+=e.length}o=this.next(o)}return this._view=a}children(){}child(){}container(){}name(){return"bin"}createChunk(a,l){return new g(a,l?l.length:0,l)}onChange(){this._view=null}toStringName(){return this.name()}};return Et.BinNode=f,Et}var Nt={},ya;function Gd(){if(ya)return Nt;ya=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.StrNode=Nt.StrChunk=void 0;const n=pe(),d=ji(),g=yl();class f{constructor(l,o,e){this.id=l,this.span=o,this.len=e?o:0,this.del=!e,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=e}merge(l){this.data+=l,this.span=this.data.length}split(l){if(!this.del){const e=new f((0,n.tick)(this.id,l),this.span-l,this.data.slice(l));return this.data=this.data.slice(0,l),this.span=l,e}const o=new f((0,n.tick)(this.id,l),this.span-l,"");return this.span=l,o}delete(){this.del=!0,this.data=""}clone(){return new f(this.id,this.span,this.data)}view(){return this.data}}Nt.StrChunk=f;let i=class extends d.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let l="";for(let o=this.first();o;o=(0,g.next)(o))l+=o.data;return this._view=l}name(){return"str"}createChunk(l,o){return new f(l,o?o.length:0,o||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Nt.StrNode=i,Nt}var Oa;function Jd(){return Oa||(Oa=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.StrChunk=n.StrNode=n.BinChunk=n.BinNode=n.ArrChunk=n.ArrNode=n.ObjNode=n.VecNode=n.RootNode=n.ValNode=n.ConNode=void 0;var d=Ei();Object.defineProperty(n,"ConNode",{enumerable:!0,get:function(){return d.ConNode}});var g=Ol();Object.defineProperty(n,"ValNode",{enumerable:!0,get:function(){return g.ValNode}});var f=Dd();Object.defineProperty(n,"RootNode",{enumerable:!0,get:function(){return f.RootNode}});var i=qd();Object.defineProperty(n,"VecNode",{enumerable:!0,get:function(){return i.VecNode}});var a=Vd();Object.defineProperty(n,"ObjNode",{enumerable:!0,get:function(){return a.ObjNode}});var l=zd();Object.defineProperty(n,"ArrNode",{enumerable:!0,get:function(){return l.ArrNode}}),Object.defineProperty(n,"ArrChunk",{enumerable:!0,get:function(){return l.ArrChunk}});var o=Wd();Object.defineProperty(n,"BinNode",{enumerable:!0,get:function(){return o.BinNode}}),Object.defineProperty(n,"BinChunk",{enumerable:!0,get:function(){return o.BinChunk}});var e=Gd();Object.defineProperty(n,"StrNode",{enumerable:!0,get:function(){return e.StrNode}}),Object.defineProperty(n,"StrChunk",{enumerable:!0,get:function(){return e.StrChunk}})}(ni)),ni}var xa;function dt(){return xa||(xa=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(fd(),n),d.__exportStar(Jd(),n)}(ei)),ei}var pi={},Sa;function Kd(){return Sa||(Sa=1,Object.defineProperty(pi,"__esModule",{value:!0})),pi}var vi={},bi={},Ca;function Hd(){return Ca||(Ca=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ModelApi=void 0;const d=ve;var g=wl();Object.defineProperty(n,"ModelApi",{enumerable:!0,get:function(){return g.ModelApi}}),d.__exportStar(ml(),n)}(bi)),bi}var Ea;function Xd(){return Ea||(Ea=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Model=void 0;const d=ve;var g=Ii();Object.defineProperty(n,"Model",{enumerable:!0,get:function(){return g.Model}}),d.__exportStar(Hd(),n)}(vi)),vi}var Na;function Yd(){return Na||(Na=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const d=ve;d.__exportStar(dt(),n),d.__exportStar(Kd(),n),d.__exportStar(Xd(),n),d.__exportStar(cl(),n)}(Zr)),Zr}var Qd=Yd(),or={},Ra;function Zd(){if(Ra)return or;Ra=1,Object.defineProperty(or,"__esModule",{value:!0}),or.Encoder=void 0;const d=ve.__importStar(dt()),g=ul(),f=xe(),i=pe();let a=class{encode(o){this.model=o;const e=o.clock;return{time:e.sid===f.SESSION.SERVER?e.time:this.cClock(o.clock),root:this.cVal(o.root)}}cClock(o){const e=[],t=o.sid;o.peers.get(t)||e.push([t,o.time]);for(const s of o.peers.values())e.push([s.sid,s.time]);return e}cTs(o){return o.sid===f.SESSION.SERVER?o.time:[o.sid,o.time]}cNode(o){if(o instanceof d.ObjNode)return this.cObj(o);if(o instanceof d.ArrNode)return this.cArr(o);if(o instanceof d.StrNode)return this.cStr(o);if(o instanceof d.ValNode)return this.cVal(o);if(o instanceof d.ConNode)return this.cCon(o);if(o instanceof d.BinNode)return this.cBin(o);if(o instanceof d.VecNode)return this.cVec(o);throw new Error("UNKNOWN_NODE")}cObj(o){const e={};return o.nodes((t,r)=>{e[r]=this.cNode(t)}),{type:"obj",id:this.cTs(o.id),map:e}}cVec(o){const e=[],t=o.elements,r=t.length,s=this.model.index;for(let u=0;u<r;u++){const v=t[u];v===void 0?e.push(null):e.push(this.cNode(s.get(v)))}return{type:"vec",id:this.cTs(o.id),map:e}}cArr(o){const e=[],t=o.iterator();let r;for(;r=t();)e.push(this.cArrChunk(r));return{type:"arr",id:this.cTs(o.id),chunks:e}}cArrChunk(o){if(o.del)return{id:this.cTs(o.id),span:o.span};const e=this.model.index;return{id:this.cTs(o.id),value:o.data.map(r=>this.cNode(e.get(r)))}}cStr(o){const e=[],t=o.iterator();let r;for(;r=t();)e.push(this.cStrChunk(r));return{type:"str",id:this.cTs(o.id),chunks:e}}cStrChunk(o){return o.del?{id:this.cTs(o.id),span:o.span}:{id:this.cTs(o.id),value:o.data}}cBin(o){const e=[],t=o.iterator();let r;for(;r=t();)e.push(this.cBinChunk(r));return{type:"bin",id:this.cTs(o.id),chunks:e}}cBinChunk(o){return o.del?{id:this.cTs(o.id),span:o.span}:{id:this.cTs(o.id),value:(0,g.toBase64)(o.data)}}cVal(o){return{type:"val",id:this.cTs(o.id),value:this.cNode(o.node())}}cCon(o){const e={type:"con",id:this.cTs(o.id)},t=o.val;return t instanceof i.Timestamp?(e.timestamp=!0,e.value=this.cTs(t)):t!==void 0&&(e.value=t),e}};return or.Encoder=a,or}var ef=Zd();class tf{constructor(d){et(this,"socket");et(this,"model",null);et(this,"sequenceNumber",0);et(this,"replicaId");et(this,"verboseEncoder",new ef.Encoder);et(this,"onModelChange",Tr);et(this,"onGridReady",Tr);et(this,"onStatusChange",Tr);et(this,"messageHandler",d=>{var g,f;if(d=JSON.parse(d),Array.isArray(d)&&d.length===3&&d[0]===4){const[,,i]=d;try{const a=Qr.decode(i);this.model?(console.log("Applying patch from server:",a),(g=this.model)==null||g.applyPatch(a),this.onModelChange(this.model)):(console.log("Initializing new model from patch:",a),this.model=Qd.Model.fromPatches([a]).fork(this.replicaId),this.onModelChange(this.model));const l=(f=this.model)==null?void 0:f.api.flush();let o;if((l==null?void 0:l.ops.length)!==0&&(o=Qr.encode(l)),o){const e=[1,this.sequenceNumber,"patch",o];console.log("Responding with patch:",e),this.sendMessage(e)}else{const e=this.verboseEncoder.encode(this.model);this.sendSyncMessage(e.time)}}catch(a){console.error("Failed to apply patch or send clock:",a)}}else if(Array.isArray(d)&&d.length===2&&d[0]===5)this.sequenceNumber+=1,this.onGridReady(),console.log("Clocks synchronized with server. Incrementing sequence number.");else if(Array.isArray(d)&&d[0]===8){if(console.log("Message received from server:",d[1]),d[1]==="ping"&&console.log("Received ping response from server"),d[1]==="connected"&&(console.log("Server ready to receive patches"),this.sendSyncMessage()),d[1]==="error"){console.warn("Error from server:",d[2]);return}if(d[1]==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const i=this.verboseEncoder.encode(this.model);console.log("New patch received, syncing data:",i.time);const a=[1,this.sequenceNumber,"synchronize-clock",i.time];this.sendMessage(a)}}else console.warn("Unexpected WebSocket message format:",d)});const{url:g,onGridReady:f,onStatusChange:i,onModelChange:a}=d;this.socket=new WebSocket(g),this.socket.onopen=()=>{console.log("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=l=>{this.handleMessage(l.data)},this.socket.onclose=()=>{console.log("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=l=>{console.error("WebSocket error:",l)},a&&(this.onModelChange=a),f&&(this.onGridReady=f),i&&(this.onStatusChange=i)}disconnect(){this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.log("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(d){this.messageHandler(d)}sendMessage(d){this.socket.readyState===WebSocket.OPEN?(console.log("Sending message:",d),this.socket.send(JSON.stringify(d))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}this.onModelChange(this.model);const d=this.model.api.flush();if(d){console.log("Sending patch to server:",d);const g=Qr.encode(d),f=[1,this.sequenceNumber,"patch",g];this.sendMessage(f)}}sendSyncMessage(d=[]){const g=[1,this.sequenceNumber,"synchronize-clock",d];this.sendMessage(g)}}function nf(){const n=K.useRef(null),[d,g]=K.useState({columnNames:[],columnOrder:[],rows:[]});return{modelRef:n,modelSnapshot:d,getModel:()=>n.current,setModel:a=>{n.current=a,g(n.current.api.getSnapshot())}}}function rf(){const[n,d]=K.useState(null),[g,f]=K.useState(!1),[i,a]=K.useState(!1),{modelRef:l,modelSnapshot:o,getModel:e,setModel:t}=nf(),r=K.useCallback(s=>{if(s&&!n){const u=new tf({url:s,onGridReady:()=>{a(!0)},onStatusChange:(v,w)=>{f(v)},onModelChange:v=>{t(v)}});d(u)}},[]);return{isConnected:g,createWebsocket:r,websocketInstance:n,isGridReady:i,modelRef:l,modelSnapshot:o,getModel:e,setModel:t}}const sf=()=>{const n=Aa().synapseClient,[d,g]=K.useState(""),[f,i]=K.useState(null),[a,l]=K.useState(""),[o,e]=K.useState(""),t=K.useRef(null),{isConnected:r,websocketInstance:s,createWebsocket:u,isGridReady:v,modelRef:w,modelSnapshot:b,getModel:h}=rf();K.useEffect(()=>{a&&u(a)},[a,u]);const c=r?"Connected":"Disconnected",[p,m]=K.useState([]);K.useEffect(()=>{(d||f)&&(w.current=null,y([]),x([]),m([]))},[d,f,s]);const[_,y]=K.useState(P(b)),[O,x]=K.useState(V(b)),[C,R]=K.useState(_);K.useEffect(()=>{y(P(b)),x(V(b))},[b]);const D=async(W,$)=>{try{return console.log("Creating replica for session ID:",$),await W.gridServicesClient.postRepoV1GridSessionSessionIdReplica({sessionId:$,createReplicaRequest:{gridSessionId:$}})}catch(le){console.error("Failed to create replica:",le);return}};function P(W){if(!W)return[];const{columnNames:$,columnOrder:le,rows:we}=W;return we.map(H=>{const B={};return le.forEach(F=>{const X=$[F];X&&(B[X]=H[F])}),B})}function V(W){if(!W)return[];const{columnNames:$,columnOrder:le}=W;return le.map(be=>({...$r.keyColumn($[be],$r.createTextColumn({continuousUpdates:!1})),title:$[be]}))}function I(W,$){if(!$)return $;const le=$.api.arr(["rows"]),{columnNames:we}=$.api.getSnapshot();for(let be=0;be<W.length;be++){const H=W[be],B=le.get(be);Object.entries(H).forEach(([F,X])=>{const Ne=we.indexOf(F);isNaN(Ne)||B.set([[Ne,td.konst(X)]])})}return $}const Y=Du(),G=async W=>{var le,we,be;const $=nd(W);try{if($.type==="empty"||$.type==="sql"){const H={concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",initialQuery:void 0,schema$id:void 0};$.type==="sql"?(H.initialQuery={sql:$.input},e($.input),console.log("Starting grid session with table query: ",o)):(e(""),console.log("Starting a new empty grid session."));const B=await Y.mutateAsync(H);console.log("Grid session started:",B);const F=((le=B.gridSession)==null?void 0:le.sessionId)||"";g(F);const X=await D(n,F);console.log("Replica created:",X);const Ne=((we=X==null?void 0:X.replica)==null?void 0:we.replicaId)||null;i(Ne);const lt=await n.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:F,createGridPresignedUrlRequest:{gridSessionId:F,replicaId:Ne||void 0}});l(lt.presignedUrl||"")}else if($.type==="sessionId"){console.log(`Joining existing session ID: ${$.input}`),g($.input);const H=await D(n,$.input);console.log("Replica created:",H);const B=((be=H==null?void 0:H.replica)==null?void 0:be.replicaId)||null;i(B);const F=await n.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:$.input,createGridPresignedUrlRequest:{gridSessionId:$.input,replicaId:B||void 0}});l(F.presignedUrl||"")}else console.error("Unknown input type, please provide a valid SQL query or session ID.")}catch(H){console.error("Error starting session:",H)}},A=K.useMemo(()=>new Set,[]),q=K.useMemo(()=>new Set,[]),ne=K.useMemo(()=>new Set,[]),Q=()=>{y(C),A.clear(),q.clear(),ne.clear()},de=W=>(I(W,h()),s==null||s.sendPatch(),A.clear(),q.clear(),ne.clear(),W),ye=()=>de(_);function oe(){return Math.floor(Math.random()*1e6)}const re=K.useCallback(Zl(W=>{console.log("Auto-committing changes"),de(W)},500),[de]);function Ee(){return{_rowId:oe()}}const Ue=(W,$)=>{var we,be;for(const H of $){const B=(we=w.current)==null?void 0:we.api.arr(["rows"]);if(H.type==="CREATE"){for(let F=H.fromRowIndex;F<H.toRowIndex;F++)B==null||B.ins(F,[(be=w.current)==null?void 0:be.api.builder.vec()]);W.slice(H.fromRowIndex,H.toRowIndex).forEach(({_rowId:F})=>A.add(F))}if(H.type==="UPDATE"&&W.slice(H.fromRowIndex,H.toRowIndex).forEach(({_rowId:F})=>{!A.has(F)&&!q.has(F)&&ne.add(F)}),H.type==="DELETE"){let F=0;B==null||B.del(H.fromRowIndex,H.toRowIndex-H.fromRowIndex),_.slice(H.fromRowIndex,H.toRowIndex).forEach(({_rowId:X},Ne)=>{ne.delete(X),A.has(X)?A.delete(X):(q.add(X),W.splice(H.fromRowIndex+F++,0,_[H.fromRowIndex+Ne]))})}}const le=W.filter(({_rowId:H})=>!q.has(H));y(le),R(le),re(le)};return me.jsxs("div",{children:[me.jsxs("div",{children:[me.jsx("input",{ref:t,type:"text",placeholder:"(Optional) Enter a SQL query or session ID",style:{width:"300px"},onKeyDown:W=>{var $;if(W.key==="Enter"){const le=(($=t.current)==null?void 0:$.value)||"";G(le)}}}),me.jsx("button",{onClick:()=>{var $;const W=(($=t.current)==null?void 0:$.value)||"";G(W)},style:{backgroundColor:"#4CAF50",color:"white"},children:"Start Grid Session"})]}),me.jsxs("div",{children:[me.jsxs("p",{children:["Session ID: ",d||"No session created"]}),me.jsxs("p",{children:["Replica ID: ",f||"No replica created"]}),me.jsxs("p",{children:["Presigned URL:"," ",a.substring(0,30)+(a.length>30?" ... "+a.substring(a.length-10,a.length):"")||"No URL generated"]}),me.jsxs("p",{children:["WebSocket Status:"," ",me.jsx("span",{style:{color:r?"green":"red"},children:c})]})]}),me.jsxs("div",{style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"200px",overflowY:"auto"},children:[me.jsx("h4",{children:"Server Message Log"}),p.map((W,$)=>me.jsx("div",{style:{fontSize:"12px",marginBottom:"5px"},children:W},$))]}),!v&&me.jsx("h3",{children:"Loading grid..."}),v&&me.jsxs("div",{children:[me.jsx("button",{onClick:ye,children:"Commit"}),me.jsx("button",{onClick:Q,children:"Cancel"}),me.jsx($r.DataSheetGrid,{value:_,columns:O,rowKey:"_rowId",rowClassName:({rowData:W})=>q.has(W._rowId)?"row-deleted":A.has(W._rowId)?"row-created":ne.has(W._rowId)?"row-updated":"",createRow:Ee,duplicateRow:({rowData:W})=>({...W,_rowId:oe()}),onChange:Ue})]}),me.jsxs("div",{style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"200px",overflowY:"auto"},children:[me.jsx("h3",{children:"Model snapshot"}),me.jsx("p",{children:b?JSON.stringify(b):"No model available"})]})]})},s0={title:"Components/DataGrid",component:sf},br={parameters:{stack:"staging",msw:{handlers:[]}}};var Ia,ja,Ta;br.parameters={...br.parameters,docs:{...(Ia=br.parameters)==null?void 0:Ia.docs,source:{originalSource:`{
  parameters: {
    stack: 'staging',
    msw: {
      handlers: []
    }
  }
}`,...(Ta=(ja=br.parameters)==null?void 0:ja.docs)==null?void 0:Ta.source}}};const o0=["Default"];export{br as Default,o0 as __namedExportsOrder,s0 as default};
