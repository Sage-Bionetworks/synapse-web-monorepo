import{aD as p,as as c,aE as g,a9 as d,iH as V,ar as _,r as R,j as u,V as b,c5 as U}from"./iframe-SFoYirDz.js";import{u as A}from"./useInfiniteQuery-BXG3TdfN.js";import{g as B}from"./InfiniteQueryUtils-CKlRW-xB.js";import{c as N,d as G,e as H}from"./useThread-C8FNAuUK.js";import{C as W,a as z}from"./ConfirmationDialog-Sxdwb5-l.js";import{M as O}from"./MarkdownEditor-DG0z-Iip.js";function se(e,n,r,a,t,s){const{accessToken:i,keyFactory:y}=c();return A({...s,queryKey:y.getRepliesQueryKey(e,n,r,a,t),queryFn:async o=>d.getReplies(i,e,r,o.pageParam,a,n,t),initialPageParam:void 0,getNextPageParam:B})}function ne(e,n){const{accessToken:r,keyFactory:a}=c(),t=async()=>{const s=await d.getReplyMessageUrl(e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return _({...n,queryKey:a.getReplyQueryKey(e.threadId,e.id,e.messageKey),queryFn:t})}function J(e){const n=p(),{accessToken:r,keyFactory:a}=c();return g({...e,mutationFn:t=>d.postReply(t,r),onSuccess:async(t,s,i)=>{await Promise.all([n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(t.threadId)}),n.invalidateQueries({queryKey:a.getSubscribersQueryKey(t.threadId,V.THREAD)})]),e!=null&&e.onSuccess&&await e.onSuccess(t,s,i)}})}function L(e){const n=p(),{accessToken:r,keyFactory:a}=c();return g({...e,mutationFn:t=>d.putReply(t,r),onSuccess:async(t,s,i)=>{await n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(t.threadId)}),e!=null&&e.onSuccess&&await e.onSuccess(t,s,i)}})}function re(e){const n=p(),{accessToken:r,keyFactory:a}=c();return g({...e,mutationFn:t=>d.deleteReply(r,t.replyId),onSuccess:async(t,s,i)=>{await n.invalidateQueries({queryKey:a.getAllRepliesQueryKey(s.threadId)}),e!=null&&e.onSuccess&&await e.onSuccess(t,s,i)}})}function C(e){const{initialText:n,initialTitle:r,id:a,onClose:t,isReply:s,isDialog:i,openDialog:y}=e,[o,S]=R.useState(r??""),[m,q]=R.useState(n??""),{mutate:I,isPending:F}=N({onSuccess:()=>t()}),{mutate:k,isPending:K}=G({onSuccess:()=>t()}),{mutate:Q,isPending:j}=H({onSuccess:()=>t()}),{mutate:E,isPending:w}=J({onSuccess:()=>t()}),{mutate:v,isPending:D}=L({onSuccess:()=>t()}),M=K||w||j||F||D,f=!s&&r,h=(l,P)=>{s?n?v({replyId:a,messageMarkdown:l}):E({threadId:a,messageMarkdown:l}):f?(I({title:P,threadId:a}),k({messageMarkdown:l,threadId:a})):Q({forumId:a,title:P,messageMarkdown:l})},T=u.jsxs("div",{children:[!s&&u.jsx(U,{fullWidth:!0,sx:{my:1},placeholder:"Title",value:o,onChange:l=>S(l.target.value)}),u.jsx(O,{placeholder:"Write a reply...",text:m,setText:q})]}),x=M?"Saving":"Post";return u.jsx(u.Fragment,{children:i?u.jsx(W,{maxWidth:"md",open:y,onCancel:t,title:s?"Edit Reply":f?"Edit Thread":"New Thread",content:T,onConfirm:()=>h(m,o),confirmButtonProps:{children:x}}):u.jsxs(u.Fragment,{children:[T,u.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",gap:1,my:1},children:u.jsx(z,{onCancel:t,onConfirm:()=>h(m,o),confirmButtonProps:{children:x}})})]})})}try{C.displayName="ForumThreadEditor",C.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{C as F,re as a,se as b,ne as u};
