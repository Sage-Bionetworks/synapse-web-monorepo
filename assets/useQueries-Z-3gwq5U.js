var U=i=>{throw TypeError(i)};var q=(i,e,s)=>e.has(i)||U("Cannot "+s);var n=(i,e,s)=>(q(i,e,"read from private field"),s?s.call(i):e.get(i)),d=(i,e,s)=>e.has(i)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),c=(i,e,s,t)=>(q(i,e,"write to private field"),t?t.call(i,s):e.set(i,s),s),y=(i,e,s)=>(q(i,e,"access private method"),s);import{b3 as K,b4 as k,b5 as N,b6 as G,aD as V,b7 as X,b8 as Y,r as w,b9 as Z,ba as $,bb as W,bc as ee,bd as F,be as T,bf as se,bg as te}from"./iframe-DkJtXMGY.js";function _(i,e){const s=new Set(e);return i.filter(t=>!s.has(t))}function re(i,e,s){const t=i.slice(0);return t[e]=s,t}var v,b,m,E,f,g,C,S,x,a,P,B,H,L,A,j,ie=(j=class extends K{constructor(e,s,t){super();d(this,a);d(this,v);d(this,b);d(this,m);d(this,E);d(this,f);d(this,g);d(this,C);d(this,S);d(this,x,[]);c(this,v,e),c(this,E,t),c(this,m,[]),c(this,f,[]),c(this,b,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,f).forEach(e=>{e.subscribe(s=>{y(this,a,L).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,f).forEach(e=>{e.destroy()})}setQueries(e,s){c(this,m,e),c(this,E,s),k.batch(()=>{const t=n(this,f),u=y(this,a,H).call(this,n(this,m));c(this,x,u),u.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const r=u.map(o=>o.observer),h=r.map(o=>o.getCurrentResult()),p=r.some((o,Q)=>o!==t[Q]);t.length===r.length&&!p||(c(this,f,r),c(this,b,h),this.hasListeners()&&(_(t,r).forEach(o=>{o.destroy()}),_(r,t).forEach(o=>{o.subscribe(Q=>{y(this,a,L).call(this,o,Q)})}),y(this,a,A).call(this)))})}getCurrentResult(){return n(this,b)}getQueries(){return n(this,f).map(e=>e.getCurrentQuery())}getObservers(){return n(this,f)}getOptimisticResult(e,s){const t=y(this,a,H).call(this,e),u=t.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[u,r=>y(this,a,B).call(this,r??u,s),()=>y(this,a,P).call(this,u,t)]}},v=new WeakMap,b=new WeakMap,m=new WeakMap,E=new WeakMap,f=new WeakMap,g=new WeakMap,C=new WeakMap,S=new WeakMap,x=new WeakMap,a=new WeakSet,P=function(e,s){return s.map((t,u)=>{const r=e[u];return t.defaultedQueryOptions.notifyOnChangeProps?r:t.observer.trackResult(r,h=>{s.forEach(p=>{p.observer.trackProp(h)})})})},B=function(e,s){return s?((!n(this,g)||n(this,b)!==n(this,S)||s!==n(this,C))&&(c(this,C,s),c(this,S,n(this,b)),c(this,g,N(n(this,g),s(e)))),n(this,g)):e},H=function(e){const s=new Map(n(this,f).map(u=>[u.options.queryHash,u])),t=[];return e.forEach(u=>{const r=n(this,v).defaultQueryOptions(u),h=s.get(r.queryHash);h?t.push({defaultedQueryOptions:r,observer:h}):t.push({defaultedQueryOptions:r,observer:new G(n(this,v),r)})}),t},L=function(e,s){const t=n(this,f).indexOf(e);t!==-1&&(c(this,b,re(n(this,b),t,s)),y(this,a,A).call(this))},A=function(){var e;if(this.hasListeners()){const s=n(this,g),t=y(this,a,P).call(this,n(this,b),n(this,x)),u=y(this,a,B).call(this,t,(e=n(this,E))==null?void 0:e.combine);s!==u&&k.batch(()=>{this.listeners.forEach(r=>{r(n(this,b))})})}},j);function ae({queries:i,...e},s){const t=V(),u=X(),r=Y(),h=w.useMemo(()=>i.map(l=>{const R=t.defaultQueryOptions(l);return R._optimisticResults=u?"isRestoring":"optimistic",R}),[i,t,u]);h.forEach(l=>{Z(l),$(l,r)}),W(r);const[p]=w.useState(()=>new ie(t,h,e)),[o,Q,J]=p.getOptimisticResult(h,e.combine),z=!u&&e.subscribed!==!1;w.useSyncExternalStore(w.useCallback(l=>z?p.subscribe(k.batchCalls(l)):ee,[p,z]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),w.useEffect(()=>{p.setQueries(h,e)},[h,e,p]);const D=o.some((l,R)=>F(h[R],l))?o.flatMap((l,R)=>{const O=h[R];if(O){const I=new G(t,O);if(F(O,l))return T(O,I,r);se(l,u)&&T(O,I,r)}return[]}):[];if(D.length>0)throw Promise.all(D);const M=o.find((l,R)=>{const O=h[R];return O&&te({result:l,errorResetBoundary:r,throwOnError:O.throwOnError,query:t.getQueryCache().get(O.queryHash),suspense:O.suspense})});if(M!=null&&M.error)throw M.error;return Q(J())}export{ae as u};
