var fc=Object.defineProperty;var hc=(e,c,g)=>c in e?fc(e,c,{enumerable:!0,configurable:!0,writable:!0,value:g}):e[c]=g;var pe=(e,c,g)=>hc(e,typeof c!="symbol"?c+"":c,g);import{j as V}from"./jsx-runtime-D_zvdyIk.js";import{l as it,bo as pc,cp as mc,av as gc,S as Re,bc as ks,aK as bc,aA as yc,aC as vc,s as eu,t as ct,cq as wc,cr as _c}from"./useFiles-CNFcQdml.js";import{w as is}from"./useDOI-i3X3-D4o.js";import{u as ft}from"./useMutation-CaTGYQiO.js";import{t as Sc}from"./useEntity-DGiKw5ZV.js";import{F as tu,C as js,H as Vs}from"./VerificationSubmission-D0sL2gwz.js";import{l as xc,X as Cc}from"./StringUtils-Bt2r5KGg.js";import{u as jr}from"./QueryClientProvider-BL9YT6Vs.js";import{u as Oc}from"./OrientationBanner-B8aBrx6p.js";import{r as U,b as de}from"./index-BHJCzbh3.js";import"./ErrorPage-BwRY9Z8v.js";import"./AccessTokenPage-CogEsr6F.js";import"./AccountLevelBadges-DbinQszO.js";import"./LastLoginInfo-DJFCYMtK.js";import"./StandaloneLoginForm-DI5pwKxh.js";import"./TwoFactorAuthSettingsPanel-Ch0L7ECw.js";import"./TwoFactorEnrollmentForm-HVFiWZu3.js";import"./TwoFactorBackupCodes-CyzX8zTB.js";import"./RowSetView-BvS0Hmmt.js";import"./CardContainerLogic-DAfypucx.js";import{C as As}from"./CardGridWithLinks-B9M0jDsJ.js";import"./RowDataTable-CiDmUQMn.js";import"./RowDataTableWithQuery-rFSGx2LA.js";import{f as Rc}from"./DateFormatter-CWhBuZqm.js";import{d as Nc}from"./dayjs.min-Bjd3NTcv.js";import"./MarkdownPopover-B5E-PsBr.js";import"./SkeletonButton-BIeq27We.js";import"./SkeletonInlineBlock-rp-qcFU6.js";import{S as Ec}from"./SkeletonTable-CGYjuAVG.js";import"./SkeletonParagraph-CZaUYsDH.js";import{d as Et}from"./ToastMessage-CzaMqZgl.js";import"./CertificationAnswer-Cgys8mAP.js";import"./ChallengeDetailPage-COfycVYE.js";import"./index-BI2NaJwb.js";import"./AvailableEvaluationQueueList-Ckgp36fs.js";import"./ChallengeSubmission-uXh8neWj.js";import"./ChangePassword-D_cKqWlj.js";import"./ChangePasswordWithToken-CfyBa8Sc.js";import{C as Tc}from"./ConfirmationDialog-Djz5N0pR.js";import"./CookiesNotification-HFIZidni.js";import{C as Ps}from"./CTASectionWrapper-DlodMRG2.js";import"./DownloadCartPage-DA17PHzN.js";import"./ShowDownloadV2-BhnUnxp7.js";import{D as Ic}from"./DynamicForm-DLjmtb2_.js";import{W as kc}from"./WideButton-DWpPiBbQ.js";import{B as xe}from"./Box-CoN9Xcom.js";import"./EntityBadgeIcons-t_c-okHt.js";import"./EntityFinder-ImO6F0A3.js";import{F as jc,v as Vc,r as nu}from"./index-D1Av34P3.js";import{B as Ms,P as Ac}from"./enums-CbKfZKLB.js";import{d as Ne,a as ru}from"./iframe-dITNj0Hx.js";import"./EvaluationCard-BCHwPped.js";import"./EvaluationEditorPage-DTsLG0Ue.js";import"./ExperimentalMode-CJc4caJR.js";import{O as Pc}from"./IconSvg-C2rG47HI.js";import"./FileUpload-BZe8DrSc.js";import"./FeaturedDataTabs-dJT-Y-fK.js";import"./FeaturedToolsList-CPT-a9oG.js";import"./DiscussionThread-Cgy_gvdQ.js";import"./ForumPage-BCOkegjd.js";import{F as Mc}from"./FullWidthAlert-BeHQTUMX.js";import"./SynapseCardLabel-D2VisYq7.js";import"./GenericCard-D4c8HcAT.js";import"./HeaderCardV2-BNNL58MZ.js";import"./CardUtils-VDrwOmwA.js";import"./Goals-BFt9DtEf.js";import"./GoalsV2-Bu2JM0iy.js";import{G as qs}from"./GoalsV3-qO7fKLmc.js";import"./GoogleMap-DXC88G3j.js";import"./HasAccessV2-mOaJoKFJ.js";import"./Icon-zbqVijtd.js";import"./MarkdownCollapse-zDXfKEuB.js";import"./MarkdownEditor-cRW2fow1.js";import"./MarkdownGithub-D6ExUlJP.js";import"./ModalDownload-DuWgj6uY.js";import"./CopyToClipboardInput-CIHgEtRy.js";import"./DialogBase-C5FtYy9Z.js";import"./WarningDialog-DKt81w7b.js";import"./ColumnHeader-BG1ovdoG.js";import"./StyledTanStackTable-B4jeBaaa.js";import"./CreateOAuthClient-DbBXRZ9x.js";import"./ThemesPlot-Qcnl9wM5.js";import"./UpsetPlot-C1vM73iJ.js";import"./SynapsePlot-c5jQOrvi.js";import"./Programs-Bl6ccQ-I.js";import"./TopLevelControls-C3yRkxoQ.js";import"./ProvenanceGraph-hicIKqrh.js";import"./ProjectDataAvailability-WlgjQOPO.js";import"./QueryContext-ChziZ8rd.js";import"./QueryCount-Cs0PksSb.js";import"./QueryWrapper-V7vsU4BI.js";import"./QueryWrapperPlotNav-BiQ212an.js";import"./RegisterPageLogoutPrompt-Dbi-1Im0.js";import"./RenderIfInView-w7PHERFh.js";import"./Resources-BnvfZ5Zn.js";import"./AccessRequirementAclEditor-Bw5m5CwY.js";import"./RssFeedCards-Ck_S4cOv.js";import"./ShowMore-CWaS7pq_.js";import"./StandaloneQueryWrapper-Wah-jVNU.js";import"./LeftRightPanel-CCeejMQb.js";import"./LightTooltip-BdwefXkg.js";import"./StyledFormControl-Dk_kGaNn.js";import"./InputSizedButton-ej85BR1i.js";import"./DropdownSelect-BfnADAEi.js";import"./SubscriptionItem-DWoMoOA6.js";import"./SubsectionRowRenderer-BdsWpO-G.js";import"./SynapseFormWrapper-lhHQ1IR6.js";import"./SynapseFormSubmissionGrid-hZQyE9G4.js";import"./SynapseTable-DBb0SUp2.js";import"./SynapseChat-e7ihzWc6.js";import{T as Ye}from"./Typography-CWkdFRvd.js";import"./TableFeedCards-BjYPLUzA.js";import"./TermsAndConditions-BLJQW3vl.js";import"./TextField-Cb0t36yl.js";import"./TimelinePlot-DJetpVNd.js";import"./UserBadge-Bcdvi70P.js";import"./UserCardList-mb7Z4400.js";import"./UserCardListRotate-RaX5gXpB.js";import"./UserCardListGroups-DzKq6K2c.js";import"./UserOrTeamBadge-Lqgp1cXd.js";import"./UserProfileLinks-COvWlTOZ.js";import"./EntityHeaderTable-C3YNeqZE.js";import"./AccessRequirementRelatedProjectsList-BRLubSay.js";import"./HelpPopover-BFYc_qrI.js";import{s as qc}from"./DefaultPropsProvider-D5YzZChL.js";import{d as ss,B as iu}from"./SynapseConstants-DBNLKtRP.js";import"./SharePageLinkButton-CGBKM3ht.js";import"./SageResourcesPopover-D9rQ35bg.js";import"./RecentPublicationsGrid-DYPAXQgl.js";import"./ImageCardGridWithLinks-BSERar_i.js";import"./PortalFeatureHighlights-DWe3olnW.js";import{p as su}from"./SqlFunctions-D9jcfCB0.js";import{u as Dc}from"./index-CCYrSgV2.js";import{P as ou}from"./PortalSectionHeader-Bdr0-cF0.js";import{S as pr}from"./Stack-BrOi9MTv.js";import{S as os}from"./Skeleton-DQoBJCRz.js";import{F as Bc}from"./Fade-crWMwZ_Y.js";import{C as as}from"./CardMedia-A7YIBn4g.js";import{L as Tr}from"./Link-Cao8rbg2.js";import{B as gr}from"./Button-A4JrCwSW.js";import{b as Fc}from"./SchemaDrivenAnnotationEditor-BxFRxAXO.js";import{C as Lc}from"./SynapseTableCell-BdKo86Wn.js";import{i as Uc}from"./isEqual-G3jbN0hm.js";import{i as br}from"./_Uint8Array-C5QuASXD.js";import{r as $c,a as au}from"./isArray-Dhffyn_X.js";import{g as zc}from"./_baseIteratee-CTrXRry9.js";import{r as zt,c as Gc}from"./index-ayaWkRDf.js";import{a as Ds}from"./toInteger-DI2xZEx7.js";import{r as Wc}from"./index-Ctb1fTIi.js";import{r as Hc}from"./index-C4JV96Bq.js";import{A as lu}from"./Autocomplete-DHpiMwAs.js";import{T as Ji}from"./TextField-qq8pVbeK.js";import{u as Jc}from"./useInfiniteQuery-wSVSYFd8.js";import{n as Tt}from"./useQuery-DlKbqV7m.js";import{G as we}from"./Grid-C1wfhunR.js";import{M as Ki}from"./MenuItem-CrfTD_ap.js";import{t as Kc}from"./tslib.es6-Bipx4pcW.js";import{K as Yc}from"./CitationPopoverContent-B6894iQH.js";import{M as Xc}from"./Menu-C-W1PhMl.js";import"./fetchWithExponentialTimeout-CXmnpl-T.js";import"./useTimeout-D8YjTpcK.js";import"./Collapse-CsAoI-BE.js";import"./createTheme-CKqkwa7d.js";import"./useTheme-DOVonx1n.js";import"./useTheme-C7jBfA_o.js";import"./getReactElementRef-VVl8u3pk.js";import"./useForkRef-Cl9Rp-dg.js";import"./_baseUniq-C5SXyLOe.js";import"./_getTag-a5To3XUS.js";import"./merge-C9xt5aZs.js";import"./_initCloneObject-Cz0cTzpK.js";import"./identity-DKeuBCMA.js";import"./createSvgIcon-hw5sef7_.js";import"./tinycolor-Begke6kS.js";import"./inputBaseClasses-CJ7Qu9r4.js";import"./calculateFriendlyFileSize-BzH9ntlH.js";import"./CheckCircleTwoTone-Brx8IfwO.js";import"./InfoTwoTone-CQSVX7va.js";import"./index-DoXq1h2I.js";import"./index-DN5FxpE6.js";import"./extendSxProp-DJfIiLD8.js";import"./createSimplePaletteValueFilter-D8THahFF.js";import"./chunk-AYJ5UCUI-DoqxXuGW.js";import"./cloneDeep-CoKPu_b1.js";import"./pickBy-CgGAPadX.js";import"./isString-B0fQLh-1.js";import"./toString-D1VyyLj_.js";import"./isSymbol-GpfXkDnX.js";import"./pick-BtkpxPHN.js";import"./_baseGet-BX3BCr-9.js";import"./_baseSet-DJQtjwv2.js";import"./hasIn-DcnR-lJ1.js";import"./omit-DCdfx3o1.js";import"./_baseSlice-F8doVSIJ.js";import"./useQueries-ClEP3_9b.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-BXfuXGHT.js";import"./index-C9togNJv.js";import"./spreadSx-CwcO6WA9.js";import"./react-DEWDKV7G.js";import"./useMessage-Ci6gbRrD.js";import"./LoadingScreen-Csv9iF7h.js";import"./Backdrop-DhAb3P-D.js";import"./useSlot-BGMO4Ps_.js";import"./LinearProgress-Y04Jz6Gx.js";import"./DeleteTwoTone-DMV0eOQc.js";import"./relativeTime-Bdwkrsd0.js";import"./Card-D4XkscQo.js";import"./Paper-DEWk3Iwm.js";import"./Tooltip-EB8Acvns.js";import"./useControlled-D1PVFx-p.js";import"./Grow-B7LlwP-G.js";import"./Popper-CU6WRkQu.js";import"./ownerDocument-DW-IO8s5.js";import"./isFocusVisible-B8k4qzLc.js";import"./IconButton-D6fg4-JH.js";import"./ButtonBase-B4TRRvGR.js";import"./CircularProgress-2gMhwz2x.js";import"./FormControlLabel-CEJwtkjs.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-CGk_CQ1_.js";import"./Checkbox-DlfNvA2-.js";import"./SwitchBase-B9SSqYP5.js";import"./mergeSlotProps-BkvaKweR.js";import"./AccountLevelBadge-DlccwQqO.js";import"./index-ByfXosvj.js";import"./const-BP60AzNb.js";import"./index-C0NORSjM.js";import"./LoginMethodButton-c3Tl9Pa_.js";import"./Alert-CgIRN3k3.js";import"./Close-Ca1w9KAM.js";import"./Dialog-Bnx7WByI.js";import"./DialogContent-DWpIzNbw.js";import"./Modal-BheeWlc5.js";import"./getScrollbarSize-CaCM53D3.js";import"./ownerWindow-HkKU3E4x.js";import"./createChainedFunction-BO_9K8Jh.js";import"./DialogTitle-C54Od1ab.js";import"./Divider-CwdcdRkx.js";import"./dividerClasses-CSkHtvFd.js";import"./ConditionalWrapper-CpBCX7_r.js";import"./Avatar-6nPXc6hN.js";import"./GenericCardIcon-CHr-WGM-.js";import"./index-C9JX3h0d.js";import"./ImageFileHandle-Vs3tpe6g.js";import"./CopyToClipboardIcon-DUPMFE9e.js";import"./CreateOrUpdateDoiModal-BzJN4xFf.js";import"./ConfirmCloseWithoutSavingDialog-rNV7f7GN.js";import"./JsonSchemaForm-C7buzkUG.js";import"./GridLegacy-D2jGzlXR.js";import"./HelpTwoTone-BEWSVHpY.js";import"./InputLabel-ApWkIy0v.js";import"./FormLabel-CdwmaCPf.js";import"./ContentCopy-CPMq7wr9.js";import"./Close-BWa3HcKo.js";import"./ArrowUpward-D_myrkcH.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./groupBy-d2RJgDL-.js";import"./_createAggregator-BI6_qbAo.js";import"./_baseEach-DW-qXHpL.js";import"./_baseMap-CF3kOp-F.js";import"./List-ZSVl9xgA.js";import"./ListItem-IngpU3TL.js";import"./isHostComponent-DVu5iVWx.js";import"./isMuiElement-C1CE66wz.js";import"./listItemButtonClasses-CVMRiCIM.js";import"./FormHelperText-rB6VOSIx.js";import"./DateTimePicker-BC9dGhr9.js";import"./localizedFormat-CJAzsMhG.js";import"./utc-jIogG2Xq.js";import"./useMobilePicker--KkQh5A3.js";import"./index-Dihsw7sf.js";import"./index-Chjiymov.js";import"./CSSTransition-DHsrS079.js";import"./visuallyHidden-Dan1xhjv.js";import"./FormControl-dURldZu8.js";import"./InputAdornment-sT5X1kfd.js";import"./index-DPk4lvbm.js";import"./getThemeProps-Ca39sDWE.js";import"./Chip-BHApCna4.js";import"./Tabs-9m5drRdp.js";import"./debounce-Be36O1Ab.js";import"./KeyboardArrowRight-BoFxwti9.js";import"./MenuList-uks656yC.js";import"./Select-B7-pp3p6.js";import"./InputBase-B4SHTu1d.js";import"./Input-Bo-xzsX7.js";import"./SynapseTableUtils-BTGawZFe.js";import"./useDownloadList-DA9gou6X.js";import"./useGetEntityChildren-H4QoYRNF.js";import"./DownloadConfirmationUI-Cvb60hKP.js";import"./duration-DG0spsVM.js";import"./SynapseTableConstants-2qH3fDlQ.js";import"./LayersTwoTone-BbxzbSpd.js";import"./DownloadConfirmationUtils-CuKI9qUV.js";import"./QueryFilterUtils-DB12X08H.js";import"./TableRowSelectionState-BpKDQvyE.js";import"./QueryWrapperErrorBoundary-dEjuTXNM.js";import"./ActionRequiredListItem-90LrEQOl.js";import"./differenceWith-CyiSf1av.js";import"./MeetAccessRequirementCard-BjtvPDLV.js";import"./ACTAccessRequirement-WDpE4gfi.js";import"./LockAccessRequirement-B_A_PCc_.js";import"./SelfSignAccessRequirement-C_01XAIc.js";import"./useAccessRequirements-DaJTKWrh.js";import"./_baseOrderBy-uf_pmrmO.js";import"./AccessRequirementList-BIkfcKmv.js";import"./EntityLink-D7ExMTqv.js";import"./useGetEntityHeaders-CW6MIjuR.js";import"./EntityIcon-CWU1CJB_.js";import"./ErrorChip-CSpMpwNr.js";import"./ErrorOutlined-Dkuww1_u.js";import"./UnmanagedACTAccessRequirementItem-Cv6lWkzo.js";import"./MarkdownSynapse-BBczN6Rl.js";import"./RequirementItem-BNq49eDS.js";import"./LockTwoTone-CaIjXjsU.js";import"./UserSearchBoxV2-jYpqukY7.js";import"./useDebouncedEffect-AFEq6TzQ.js";import"./use-deep-compare-effect.esm-B2WuwL51.js";import"./uniq-Ct7-_qQA.js";import"./without-CB3geWu3.js";import"./Select-aab027f3.esm-BP2uhpao.js";import"./defineProperty-CegpTSss.js";import"./ManagedACTAccessRequirementItemView-D6NeeJwQ.js";import"./SelfSignAccessRequirementItem-Q5j8E2nJ.js";import"./DataAccessRequestAccessorsFilesForm-48Ndm-96.js";import"./useDataAccessSubmission-ChHcIUpV.js";import"./RadioGroup-DntbiHAi.js";import"./Radio-BOfDCgEk.js";import"./FormGroup-BZxc_5nB.js";import"./UploadDocumentField-Co9CBP2t.js";import"./ManagedACTAccessRequirementFormWikiWrapper-B5923ssJ.js";import"./ResearchProjectForm-ClcKb7so.js";import"./TextFieldWithWordLimit-DQIBNVlT.js";import"./AuthenticatedRequirement-b4fZzGhz.js";import"./CertificationRequirement-5MkennWW.js";import"./TwoFactorAuthEnabledRequirement-2h1teHCR.js";import"./ValidationRequirement-DZ08oTEP.js";import"./ActionRequiredCard-BtUm0KIM.js";import"./RequestDownloadCard-DdaKFDax.js";import"./useGetFeatureFlag-BiH5Ekta.js";import"./EntityAclEditorModal-C07OLv70.js";import"./AclEditor-CwgX0yJ_.js";import"./IconSvgButton-CTvM5Wq-.js";import"./useUpdateAcl-DuJ3J13I.js";import"./OpenData-C7GGMnUX.js";import"./EnableTwoFaRequirementCard-CuHgWrzb.js";import"./IconList-CvCKYGGC.js";import"./GetAppTwoTone-BvqKVN2j.js";import"./pluralize-D6cMeRkl.js";import"./SelectionCriteriaPill-DW0HvuT2.js";import"./LastPage-BD0RToSz.js";import"./StyledTableContainer-CTZeYjo5.js";import"./times-DBpvTzmB.js";import"./uniqueId-Bm9fC-2t.js";import"./useGetEntityChallenge-2q86jdqf.js";import"./useTeamMembers-DsWNsUgw.js";import"./useGetUserTeams-BWuxvIc8.js";import"./ChallengeRegisterButton-BcSRRMJb.js";import"./ExitToApp-ia1j4tE8.js";import"./SpinnerButton-C4swVJPp.js";import"./LoginAwareButton-CxVaNbIq.js";import"./ChallengeTeamWizard-Cy5Qd_4u.js";import"./CreateChallengeTeam-C_vd16Ay.js";import"./useTeam-CUzUUv_8.js";import"./papaparse.min-D1KxGBLm.js";import"./Search-qneeSzio.js";import"./Box-CO1Bs6wV.js";import"./DataGrid-jSd6bWNU.js";import"./index-Dw2z7LQK.js";import"./Switch-DF6UQ_eo.js";import"./ListItemIcon-DjvGC3O2.js";import"./Badge-BeS2fnEb.js";import"./usePreviousProps--YbRByfV.js";import"./ListItemText-OtB_2Yh8.js";import"./ClickAwayListener-CHohliHo.js";import"./useEntitySelection-B9o4RtB4.js";import"./FileEntityDirectDownload-CFy27ucw.js";import"./DirectDownload-DzG6w6dH.js";import"./immutable.es-BJjDfH8f.js";import"./HelpOutlineTwoTone-CCVx8cLn.js";import"./StepperDialog-BAEfKBWR.js";import"./useEvaluation-B6Ma91YQ.js";import"./useChangePasswordFormState-CMh82ad3.js";import"./ProgrammaticInstructionsModal-BdX_uDdy.js";import"./InteractiveCopyIdsIcon-DMbGxX6M.js";import"./DirectProgrammaticDownload-B_fh6NNt.js";import"./EntityModal-DVaUMT6q.js";import"./FileHandleUtils-Bi0lx30v.js";import"./useFavorites-DltYZzaP.js";import"./NoSearchResults-BCbREK7p.js";import"./useSearch-Jpf8rr7M.js";import"./index.esm-BYSEZ_Iy.js";import"./Slider-COk83vcg.js";import"./_arrayReduce-CrxnWFSq.js";import"./forEach-XPLI08wF.js";import"./CreatedOnByUserDiv-DwlEWRvC.js";import"./CardContent-DJ2GTN_M.js";import"./upperFirst-Dr-kjEbi.js";import"./_stringToArray-N8cAV6t0.js";import"./index.prod-DhgDHgKy.js";import"./InfoOutlined-Dc-lwTRF.js";import"./ContentCopyTwoTone-BIEUYMxv.js";import"./PhoneTwoTone-CT0L7RFi.js";import"./Plot-CzCjM5-I.js";import"./useFacetPlots-ByXa70mG.js";import"./ColorGradient-Zy7TAKxK.js";import"./colorPalette-BALeOMsp.js";import"./EnumFacetFilter-B3JBh4fC.js";import"./EnumFacetFilterSkeleton-B4NeCeqb.js";import"./EnumFacetFilterUI-C8zEW2Zb.js";import"./FacetFilterHeader-DdoKZcp7.js";import"./index-DFeOJrzo.js";import"./index-CCNlsifi.js";import"./index-Beb_iK0l.js";import"./RangeFacetFilterUI-BfzI1NuJ.js";import"./RangeSlider-BwrgKLKn.js";import"./NoContentAvailable-CrmWlq7l.js";import"./ForumThreadEditor-xZFFR8NE.js";import"./useThread-j90aiUXu.js";import"./useSubscription-CBpAOBum.js";import"./SubscribersModal-BR2eqE-7.js";import"./useForum-DJaBjG-u.js";import"./getValidReactChildren-CLHzBfe5.js";import"./AlertTitle-IM4UpBhk.js";import"./HeaderCard-C0iPhD2k.js";import"./SustainabilityScorecard-91-aMJU2.js";import"./Dial-D9C-17ch.js";import"./CheckIcon-CTGFqKDd.js";import"./FileHandleLink-DEpu7Vea.js";import"./ExpandableContent-Ci7f-Jpb.js";import"./useGetGoalData-DwxqkKlm.js";import"./NavigateNext-BhONlO05.js";import"./CardActionArea-CLLHKiIG.js";import"./mouse-BqQiNJht.js";import"./SortDown-CF6eQtzV.js";import"./Container-BaFPJxkN.js";import"./SynapseFormRadioWidget-D5ti0pTf.js";import"./ExpandCollapseButton-upRfgZX9.js";import"./unCamelCase-ZiU_emRy.js";import"./head-aneRfQQJ.js";import"./LargeButton-BSM-GCn_.js";import"./ExportToAnalysisPlatformDialog-CDQR5abd.js";import"./WizardChoiceButton-xkC3Xnis.js";import"./RowSelectionUI-jhYfvLXI.js";import"./DownloadLoginModal-D-Kuad_y.js";import"./NoData-BFkdVlRf.js";import"./index-DhZB_1ZG.js";import"./index-C9AXl3tu.js";import"./SageFullLogo-A9c2kFrh.js";import"./index-wAWNbnFm.js";import"./events-DQ172AOg.js";import"./Topic-DxVS3eVc.js";import"./types-CP9zjM1W.js";import"./Popover-asfaoG14.js";import"./TeamBadge-Bb4Hkhu8.js";import"./EntityFinderModal-Cs3kFLyA.js";import"./EntityHeaderTableCellRenderers-D6DDDld2.js";import"./Slide-CmzsXgdZ.js";import"./TextWidget-sz_z1ynu.js";var Yr=function(){return $c.Date.now()},Qc="Expected a function",Zc=Math.max,ed=Math.min;function td(e,c,g){var d,o,u,r,s,i,n=0,t=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(Qc);c=Ds(c)||0,br(g)&&(t=!!g.leading,a="maxWait"in g,u=a?Zc(Ds(g.maxWait)||0,c):u,p="trailing"in g?!!g.trailing:p);function h(S){var C=d,O=o;return d=o=void 0,n=S,r=e.apply(O,C),r}function w(S){return n=S,s=setTimeout(l,c),t?h(S):r}function b(S){var C=S-i,O=S-n,x=c-C;return a?ed(x,u-O):x}function y(S){var C=S-i,O=S-n;return i===void 0||C>=c||C<0||a&&O>=u}function l(){var S=Yr();if(y(S))return f(S);s=setTimeout(l,b(S))}function f(S){return s=void 0,p&&d?h(S):(d=o=void 0,r)}function m(){s!==void 0&&clearTimeout(s),n=0,d=i=o=s=void 0}function v(){return s===void 0?r:f(Yr())}function _(){var S=Yr(),C=y(S);if(d=arguments,o=this,i=S,C){if(s===void 0)return w(i);if(a)return clearTimeout(s),s=setTimeout(l,c),h(i)}return s===void 0&&(s=setTimeout(l,c)),r}return _.cancel=m,_.flush=v,_}var nd="Expected a function";function rd(e,c,g){var d=!0,o=!0;if(typeof e!="function")throw new TypeError(nd);return br(g)&&(d="leading"in g?!!g.leading:d,o="trailing"in g?!!g.trailing:o),td(e,c,{leading:d,maxWait:c,trailing:o})}let Xr=!1;const id=(e="GTM-KPW4KS62")=>{const[c]=Oc();return U.useEffect(()=>{var g;if(c.analyticsAllowed&&!Xr){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":new Date().getTime(),event:"gtm.js"});const d=document.getElementsByTagName("script")[0],o=document.createElement("script"),u="&l=dataLayer";o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id="+e+u,(g=d.parentNode)==null||g.insertBefore(o,d),Xr=!0}},[c,e]),Xr};function sd(e){const{synapseClient:c}=it();return ft({...e,mutationFn:async g=>{const d=await c.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:g});return(await is(()=>c.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:d.token}))).responseBody}})}function od(e){const{keyFactory:c,synapseClient:g}=it(),d=jr();return ft({...e,mutationFn:async o=>{const u=await g.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:o.entityId,tableUpdateTransactionRequest:o});return(await is(()=>g.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:u.token}))).responseBody},onSuccess:async(o,u,r)=>{await pc(d,c,u.entityId)}})}function ad(e){const c=jr(),{mutateAsync:g}=sd(),{mutateAsync:d}=od(),o=Sc();return ft({...e,mutationFn:async({gridSessionId:u,sourceEntityId:r})=>{const s=await c.fetchQuery(o(r)),i={...ld(s),sessionId:u},n=await g(i),t={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:r,changes:[{uploadFileHandleId:n.resultsFileHandleId,tableId:r,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return d(t)}})}function ld(e){return mc(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}try{As.displayName="CardGridWithLinks",As.__docgenInfo={description:"",displayName:"CardGridWithLinks",props:{linkText:{defaultValue:null,description:"",name:"linkText",required:!0,type:{name:"string"}},cards:{defaultValue:null,description:"",name:"cards",required:!0,type:{name:"CardGridWithLinksConfig[]"}}}}}catch{}try{Ps.displayName="CTASectionWrapper",Ps.__docgenInfo={description:"",displayName:"CTASectionWrapper",props:{themeMode:{defaultValue:null,description:"",name:"themeMode",required:!0,type:{name:"enum",value:[{value:'"dark"'},{value:'"light"'}]}},showBlobs:{defaultValue:{value:"true"},description:"",name:"showBlobs",required:!1,type:{name:"boolean"}},content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"ReactNode"}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps"}}}}}catch{}const Bs=({schemaUrl:e,uiSchemaUrl:c,postUrl:g,submitButtonText:d})=>{const[o,u]=U.useState(!1),r=()=>{u(!0)},s=()=>{u(!1)},i=V.jsx(Ic,{schemaUrl:e,uiSchemaUrl:c,postUrl:g,onSubmit:()=>{s()}});return V.jsx("div",{className:"browse-tools-page",children:V.jsxs(xe,{sx:{margin:"10px 0px 50px 0px"},children:[V.jsx(kc,{className:"highlightSubmitToolButton",variant:"contained",onClick:r,children:d}),V.jsx(Tc,{open:o,title:"",content:i,onCancel:s,onConfirm:()=>{},confirmButtonProps:{sx:{display:"none"}},cancelButtonProps:{children:"cancel"}})]})})};try{Bs.displayName="DynamicFormModal",Bs.__docgenInfo={description:"",displayName:"DynamicFormModal",props:{schemaUrl:{defaultValue:null,description:"",name:"schemaUrl",required:!0,type:{name:"string"}},uiSchemaUrl:{defaultValue:null,description:"",name:"uiSchemaUrl",required:!0,type:{name:"string"}},postUrl:{defaultValue:null,description:"",name:"postUrl",required:!0,type:{name:"string"}},mutateFormDataBeforePost:{defaultValue:null,description:"",name:"mutateFormDataBeforePost",required:!1,type:{name:"(formData: any) => any"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!1,type:{name:"() => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"() => void"}},submitButtonText:{defaultValue:null,description:"",name:"submitButtonText",required:!1,type:{name:"string"}}}}}catch{}class mr extends U.Component{constructor(g){super(g);pe(this,"formRef");pe(this,"submitForm",()=>{this.formRef.current.submit()});pe(this,"refresh",()=>{if(this.context.accessToken){const g=[Re.getUserProfile(this.context.accessToken),Re.getEntity(this.context.accessToken,this.props.formSchemaEntityId),Re.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(g).then(d=>{const o=d[0];this.getTargetContainer(o,this.context.accessToken).then(u=>{const r=d[1],s=d[2];this.getSchemaFileContent(u,r,s)})}).catch(d=>{this.onError(d)})}});pe(this,"getSchemaFileContent",(g,d,o)=>{const u=[Re.getFileResult(d,this.context.accessToken,!0,!0),Re.getFileResult(o,this.context.accessToken,!0,!0)];Promise.all(u).then(r=>{try{const s=r.map(i=>ks(i.fileHandle,i.preSignedURL));Promise.all(s).then(i=>{const n=JSON.parse(i[0]),t=JSON.parse(i[1]);this.getExistingFileData(g,n,t)}).catch(i=>{console.log("getSchemaFileContent: Error getting form content",i)})}catch(s){console.log("getSchemaFileContent: Error getting schema content",s)}}).catch(r=>{this.onError(r)})});pe(this,"getExistingFileData",(g,d,o)=>{const r={entityName:`${d.title}.json`,parentId:g};let s,i;Re.lookupChildEntity(r,this.context.accessToken).then(n=>Re.getEntity(this.context.accessToken,n.id).then(t=>(i=t,this.props.initFormData?Re.getFileResult(i,this.context.accessToken,!0,!0).then(async a=>{try{const p=await ks(a.fileHandle,a.preSignedURL);s=JSON.parse(p)}catch(p){console.log("getExistingFileData: Error setting form data",p)}}):Promise.resolve()))).finally(()=>{this.setState({formData:s,currentFileEntity:i,formSchema:d,formUiSchema:o})})});pe(this,"getTargetContainer",async(g,d)=>{const o={entityName:g.ownerId,parentId:this.props.parentContainerId};try{const u=await Re.lookupChildEntity(o,d);return console.log(`EntityForm uploading to https://www.synapse.org/Synapse:${u.id}`),this.setState({userprofile:g,containerId:u.id,isLoading:!1}),u.id}catch(u){return u.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(u)}});pe(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});pe(this,"onError",g=>{this.setState({error:g,isLoading:!1,successfullyUploaded:!1})});pe(this,"onSubmit",({formData:g})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const d=new Blob([JSON.stringify(g)],{type:"text/json"});this.createEntityFile(d)});pe(this,"createEntityFile",g=>{const d=`${this.state.formSchema.title}.json`;Re.uploadFile(this.context.accessToken,d,g).then(o=>{const u=o.fileHandleId;if(this.state.currentFileEntity){const s={...this.state.currentFileEntity,dataFileHandleId:u};return this.setState({currentFileEntity:s}),Re.updateEntity(s,this.context.accessToken)}const r={parentId:this.state.containerId,name:d,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:u};return Re.createEntity(r,this.context.accessToken)}).then(o=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(o.id)}).catch(o=>{this.onError(o)})});this.formRef=U.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return V.jsxs("div",{children:[this.state.error&&V.jsxs("div",{className:"panel panel-danger errors",children:[V.jsx("div",{className:"panel-heading",children:V.jsx("h3",{className:"panel-title",children:"Error"})}),V.jsx("ul",{className:"list-group",children:V.jsxs("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&V.jsx(jc,{validator:Vc,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:V.jsx("div",{style:{display:"none"},children:V.jsx("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&V.jsxs(V.Fragment,{children:[V.jsx("span",{children:"Saving…"}),V.jsx("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}pe(mr,"contextType",gc);try{mr.displayName="EntityForm",mr.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}try{mr.contextType.displayName="EntityForm.contextType",mr.contextType.__docgenInfo={description:"If set, `this.context` will be set at runtime to the current value of the given Context.",displayName:"EntityForm.contextType",props:{}}}catch{}const Fs=e=>{const{accessToken:c}=it(),{synId:g,className:d}=e,[o,u]=U.useState(void 0);U.useEffect(()=>{(async()=>{try{const n=await Re.getEntity(c,g);if(!xc(n))throw new Error(`File Entity expected but found ${n}`);const t={requestedFiles:[{associateObjectId:g,associateObjectType:tu.FileEntity,fileHandleId:n.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},p=(await Re.getFiles(t,c)).requestedFiles[0].fileHandle;if(p&&Cc(p))u({externalFileHandle:p,fileEntity:n});else throw new Error(`Not an external file handle: ${p==null?void 0:p.id}`)}catch(n){console.error("Error on getting external file handle = ",n)}})()},[g,c]);const r=o==null?void 0:o.externalFileHandle,s=o==null?void 0:o.fileEntity;return r?V.jsx("a",{href:r.externalURL,className:d,target:"_blank",rel:"noopener noreferrer",children:V.jsxs("span",{children:[s==null?void 0:s.name,V.jsx(Pc,{style:{marginLeft:5}})]})}):V.jsx(V.Fragment,{})};try{Fs.displayName="ExternalFileHandleLink",Fs.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{qs.displayName="GoalsV3",qs.__docgenInfo={description:"",displayName:"GoalsV3",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},svgComponentMap:{defaultValue:null,description:"",name:"svgComponentMap",required:!0,type:{name:"Record<string, FC<SVGProps<SVGSVGElement>>>"}}}}}catch{}function Ls(e){const{measurementId:c}=e;return id(c),V.jsx(V.Fragment,{})}try{Ls.displayName="GoogleAnalytics",Ls.__docgenInfo={description:`GoogleAnalytics is a component wrapper for the useGoogleAnalytics() hook.
This is exported for use in the Synapse.org GWT codebase.`,displayName:"GoogleAnalytics",props:{measurementId:{defaultValue:null,description:"",name:"measurementId",required:!1,type:{name:"string"}}}}}catch{}function Us(){return V.jsxs(xe,{sx:{color:"grey.700",maxHeight:{xs:"170px",md:"110px"},overflow:"auto",margin:"20px 0px"},children:[V.jsx(Ye,{variant:"smallText1",sx:{fontWeight:700,marginBottom:"5px"},children:"System Use Notice"}),V.jsx(Ye,{variant:"smallText1",sx:{lineHeight:"21px"},children:"Sage Bionetworks actively monitors this system and activity to maintain system security and availability and to ensure appropriate and legitimate usage. Any individual who intentionally accesses a computer or system without authorization, and who alters, damages, makes unauthorized modifications to, or destroys information, or exceeds authorized access, is in violation of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance. Any evidence of possible violations of proper use or applicable laws found as a result of this monitoring may be turned over to law enforcement. Any individual found to be in violation of the system's proper use rules or law could be punished with loss of system access, fines, and/or imprisonment. By proceeding, you hereby acknowledge your agreement with these terms and the system's rules of behavior and consent to such monitoring and information retrieval for law enforcement and other official purposes."})]})}try{Us.displayName="SystemUseNotification",Us.__docgenInfo={description:"FISMA SAR V1-AC-8 System Use Notification, see https://sagebionetworks.jira.com/browse/SWC-6430",displayName:"SystemUseNotification",props:{}}}catch{}const $s=qc(xe,{label:"MuiContainer"})(({theme:e})=>({paddingRight:15,paddingLeft:15,marginRight:"auto",marginLeft:"auto",[e.breakpoints.up("md")]:{width:920},[e.breakpoints.up("lg")]:{width:1170},[e.breakpoints.up("xl")]:{width:1366}}));try{$s.displayName="MuiContainer",$s.__docgenInfo={description:"Drop in MUI substitute class for Bootstrap Container component",displayName:"MuiContainer",props:{visibility:{defaultValue:null,description:"",name:"visibility",required:!1,type:{name:"ResponsiveStyleValue<Visibility | readonly NonNullable<Visibility>[]> | ((theme: Theme) => ResponsiveStyleValue<Visibility | readonly NonNullable<...>[]>)"}},color:{defaultValue:null,description:"",name:"color",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Color> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Color>)"}},fontSize:{defaultValue:null,description:"",name:"fontSize",required:!1,type:{name:"ResponsiveStyleValue<FontSize<string | number> | readonly NonNullable<FontSize<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},p:{defaultValue:null,description:"",name:"p",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"ResponsiveStyleValue<Height<string | number> | readonly NonNullable<Height<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"ResponsiveStyleValue<Width<string | number> | readonly NonNullable<Width<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},display:{defaultValue:null,description:"",name:"display",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontFamily> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontFamily>)"}},fontStyle:{defaultValue:null,description:"",name:"fontStyle",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontStyle> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontStyle>)"}},fontWeight:{defaultValue:null,description:"",name:"fontWeight",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},letterSpacing:{defaultValue:null,description:"",name:"letterSpacing",required:!1,type:{name:"ResponsiveStyleValue<LetterSpacing<string | number> | readonly NonNullable<LetterSpacing<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},order:{defaultValue:null,description:"",name:"order",required:!1,type:{name:"ResponsiveStyleValue<Order | readonly NonNullable<Order>[]> | ((theme: Theme) => ResponsiveStyleValue<Order | readonly NonNullable<Order>[]>)"}},overflow:{defaultValue:null,description:"",name:"overflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Overflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Overflow>)"}},border:{defaultValue:null,description:"",name:"border",required:!1,type:{name:'ResponsiveStyleValue<number | "inherit" | "medium" | (string & {}) | "inset" | "none" | "initial" | "hidden" | "-moz-initial" | "revert" | "unset" | "revert-layer" | "aliceblue" | "antiquewhite" | ... 184 more ... | "solid"> | ((theme: Theme) => ResponsiveStyleValue<...>)'}},boxShadow:{defaultValue:null,description:"",name:"boxShadow",required:!1,type:{name:"ResponsiveStyleValue<number | BoxShadow> | ((theme: Theme) => ResponsiveStyleValue<number | BoxShadow>)"}},zIndex:{defaultValue:null,description:"",name:"zIndex",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignContent>)"}},alignItems:{defaultValue:null,description:"",name:"alignItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignItems>)"}},alignSelf:{defaultValue:null,description:"",name:"alignSelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignSelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignSelf>)"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"ResponsiveStyleValue<Bottom<string | number> | readonly NonNullable<Bottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},boxSizing:{defaultValue:null,description:"",name:"boxSizing",required:!1,type:{name:"ResponsiveStyleValue<BoxSizing | readonly NonNullable<BoxSizing>[]> | ((theme: Theme) => ResponsiveStyleValue<BoxSizing | readonly NonNullable<...>[]>)"}},columnGap:{defaultValue:null,description:"",name:"columnGap",required:!1,type:{name:"ResponsiveStyleValue<ColumnGap<string | number> | readonly NonNullable<ColumnGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flexBasis:{defaultValue:null,description:"",name:"flexBasis",required:!1,type:{name:"ResponsiveStyleValue<FlexBasis<string | number> | readonly NonNullable<FlexBasis<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flexDirection:{defaultValue:null,description:"",name:"flexDirection",required:!1,type:{name:"ResponsiveStyleValue<FlexDirection | readonly NonNullable<FlexDirection>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexDirection | readonly NonNullable<...>[]>)"}},flexGrow:{defaultValue:null,description:"",name:"flexGrow",required:!1,type:{name:"ResponsiveStyleValue<FlexGrow | readonly NonNullable<FlexGrow>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexGrow | readonly NonNullable<...>[]>)"}},flexShrink:{defaultValue:null,description:"",name:"flexShrink",required:!1,type:{name:"ResponsiveStyleValue<FlexShrink | readonly NonNullable<FlexShrink>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexShrink | readonly NonNullable<...>[]>)"}},flexWrap:{defaultValue:null,description:"",name:"flexWrap",required:!1,type:{name:"ResponsiveStyleValue<FlexWrap | readonly NonNullable<FlexWrap>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexWrap | readonly NonNullable<...>[]>)"}},gridAutoColumns:{defaultValue:null,description:"",name:"gridAutoColumns",required:!1,type:{name:"ResponsiveStyleValue<GridAutoColumns<string | number> | readonly NonNullable<GridAutoColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridAutoFlow:{defaultValue:null,description:"",name:"gridAutoFlow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridAutoFlow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridAutoFlow>)"}},gridAutoRows:{defaultValue:null,description:"",name:"gridAutoRows",required:!1,type:{name:"ResponsiveStyleValue<GridAutoRows<string | number> | readonly NonNullable<GridAutoRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateAreas:{defaultValue:null,description:"",name:"gridTemplateAreas",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridTemplateAreas> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridTemplateAreas>)"}},gridTemplateColumns:{defaultValue:null,description:"",name:"gridTemplateColumns",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateColumns<string | number> | readonly NonNullable<GridTemplateColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateRows:{defaultValue:null,description:"",name:"gridTemplateRows",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateRows<string | number> | readonly NonNullable<GridTemplateRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},justifyContent:{defaultValue:null,description:"",name:"justifyContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyContent>)"}},justifyItems:{defaultValue:null,description:"",name:"justifyItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyItems>)"}},justifySelf:{defaultValue:null,description:"",name:"justifySelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifySelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifySelf>)"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"ResponsiveStyleValue<Left<string | number> | readonly NonNullable<Left<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Left<...> | readonly NonNullable<...>[]>)"}},lineHeight:{defaultValue:null,description:"",name:"lineHeight",required:!1,type:{name:"ResponsiveStyleValue<LineHeight<string | number> | readonly NonNullable<LineHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockEnd:{defaultValue:null,description:"",name:"marginBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockEnd<string | number> | readonly NonNullable<MarginBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockStart:{defaultValue:null,description:"",name:"marginBlockStart",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockStart<string | number> | readonly NonNullable<MarginBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBottom:{defaultValue:null,description:"",name:"marginBottom",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineEnd:{defaultValue:null,description:"",name:"marginInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineEnd<string | number> | readonly NonNullable<MarginInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineStart:{defaultValue:null,description:"",name:"marginInlineStart",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineStart<string | number> | readonly NonNullable<MarginInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginLeft:{defaultValue:null,description:"",name:"marginLeft",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginRight:{defaultValue:null,description:"",name:"marginRight",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginTop:{defaultValue:null,description:"",name:"marginTop",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"ResponsiveStyleValue<MaxHeight<string | number> | readonly NonNullable<MaxHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxWidth:{defaultValue:null,description:"",name:"maxWidth",required:!1,type:{name:"ResponsiveStyleValue<MaxWidth<string | number> | readonly NonNullable<MaxWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minHeight:{defaultValue:null,description:"",name:"minHeight",required:!1,type:{name:"ResponsiveStyleValue<MinHeight<string | number> | readonly NonNullable<MinHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minWidth:{defaultValue:null,description:"",name:"minWidth",required:!1,type:{name:"ResponsiveStyleValue<MinWidth<string | number> | readonly NonNullable<MinWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlockEnd:{defaultValue:null,description:"",name:"paddingBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockEnd<string | number> | readonly NonNullable<PaddingBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlockStart:{defaultValue:null,description:"",name:"paddingBlockStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockStart<string | number> | readonly NonNullable<PaddingBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBottom:{defaultValue:null,description:"",name:"paddingBottom",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineEnd:{defaultValue:null,description:"",name:"paddingInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineEnd<string | number> | readonly NonNullable<PaddingInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineStart:{defaultValue:null,description:"",name:"paddingInlineStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineStart<string | number> | readonly NonNullable<PaddingInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingLeft:{defaultValue:null,description:"",name:"paddingLeft",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingRight:{defaultValue:null,description:"",name:"paddingRight",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingTop:{defaultValue:null,description:"",name:"paddingTop",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"ResponsiveStyleValue<Position | readonly NonNullable<Position>[]> | ((theme: Theme) => ResponsiveStyleValue<Position | readonly NonNullable<...>[]>)"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"ResponsiveStyleValue<Right<string | number> | readonly NonNullable<Right<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},rowGap:{defaultValue:null,description:"",name:"rowGap",required:!1,type:{name:"ResponsiveStyleValue<RowGap<string | number> | readonly NonNullable<RowGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},textAlign:{defaultValue:null,description:"",name:"textAlign",required:!1,type:{name:"ResponsiveStyleValue<TextAlign | readonly NonNullable<TextAlign>[]> | ((theme: Theme) => ResponsiveStyleValue<TextAlign | readonly NonNullable<...>[]>)"}},textOverflow:{defaultValue:null,description:"",name:"textOverflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | TextOverflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | TextOverflow>)"}},textTransform:{defaultValue:null,description:"",name:"textTransform",required:!1,type:{name:"ResponsiveStyleValue<TextTransform | readonly NonNullable<TextTransform>[]> | ((theme: Theme) => ResponsiveStyleValue<TextTransform | readonly NonNullable<...>[]>)"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"ResponsiveStyleValue<Top<string | number> | readonly NonNullable<Top<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Top<string | number> | readonly NonNullable<...>[]>)"}},whiteSpace:{defaultValue:null,description:"",name:"whiteSpace",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | WhiteSpace> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | WhiteSpace>)"}},borderBottom:{defaultValue:null,description:"",name:"borderBottom",required:!1,type:{name:"ResponsiveStyleValue<BorderBottom<string | number> | readonly NonNullable<BorderBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderColor:{defaultValue:null,description:"",name:"borderColor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BorderColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BorderColor>)"}},borderLeft:{defaultValue:null,description:"",name:"borderLeft",required:!1,type:{name:"ResponsiveStyleValue<BorderLeft<string | number> | readonly NonNullable<BorderLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRadius:{defaultValue:null,description:"",name:"borderRadius",required:!1,type:{name:"ResponsiveStyleValue<BorderRadius<string | number> | readonly NonNullable<BorderRadius<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRight:{defaultValue:null,description:"",name:"borderRight",required:!1,type:{name:"ResponsiveStyleValue<BorderRight<string | number> | readonly NonNullable<BorderRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderTop:{defaultValue:null,description:"",name:"borderTop",required:!1,type:{name:"ResponsiveStyleValue<BorderTop<string | number> | readonly NonNullable<BorderTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flex:{defaultValue:null,description:"",name:"flex",required:!1,type:{name:"ResponsiveStyleValue<Flex<string | number> | readonly NonNullable<Flex<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Flex<...> | readonly NonNullable<...>[]>)"}},gap:{defaultValue:null,description:"",name:"gap",required:!1,type:{name:"ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<Gap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<...>[]>)"}},gridArea:{defaultValue:null,description:"",name:"gridArea",required:!1,type:{name:"ResponsiveStyleValue<GridArea | readonly NonNullable<GridArea>[]> | ((theme: Theme) => ResponsiveStyleValue<GridArea | readonly NonNullable<...>[]>)"}},gridColumn:{defaultValue:null,description:"",name:"gridColumn",required:!1,type:{name:"ResponsiveStyleValue<GridColumn | readonly NonNullable<GridColumn>[]> | ((theme: Theme) => ResponsiveStyleValue<GridColumn | readonly NonNullable<...>[]>)"}},gridRow:{defaultValue:null,description:"",name:"gridRow",required:!1,type:{name:"ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]> | ((theme: Theme) => ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]>)"}},margin:{defaultValue:null,description:"",name:"margin",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlock:{defaultValue:null,description:"",name:"marginBlock",required:!1,type:{name:"ResponsiveStyleValue<MarginBlock<string | number> | readonly NonNullable<MarginBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInline:{defaultValue:null,description:"",name:"marginInline",required:!1,type:{name:"ResponsiveStyleValue<MarginInline<string | number> | readonly NonNullable<MarginInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},padding:{defaultValue:null,description:"",name:"padding",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlock:{defaultValue:null,description:"",name:"paddingBlock",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlock<string | number> | readonly NonNullable<PaddingBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInline:{defaultValue:null,description:"",name:"paddingInline",required:!1,type:{name:"ResponsiveStyleValue<PaddingInline<string | number> | readonly NonNullable<PaddingInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},bgcolor:{defaultValue:null,description:"",name:"bgcolor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BackgroundColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BackgroundColor>)"}},m:{defaultValue:null,description:"",name:"m",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mt:{defaultValue:null,description:"",name:"mt",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mr:{defaultValue:null,description:"",name:"mr",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mb:{defaultValue:null,description:"",name:"mb",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},ml:{defaultValue:null,description:"",name:"ml",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mx:{defaultValue:null,description:"",name:"mx",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginX:{defaultValue:null,description:"",name:"marginX",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},my:{defaultValue:null,description:"",name:"my",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginY:{defaultValue:null,description:"",name:"marginY",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pt:{defaultValue:null,description:"",name:"pt",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pr:{defaultValue:null,description:"",name:"pr",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pb:{defaultValue:null,description:"",name:"pb",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pl:{defaultValue:null,description:"",name:"pl",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},px:{defaultValue:null,description:"",name:"px",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingX:{defaultValue:null,description:"",name:"paddingX",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},py:{defaultValue:null,description:"",name:"py",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingY:{defaultValue:null,description:"",name:"paddingY",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},typography:{defaultValue:null,description:"",name:"typography",required:!1,type:{name:"ResponsiveStyleValue<string> | ((theme: Theme) => ResponsiveStyleValue<string>)"}},displayPrint:{defaultValue:null,description:"",name:"displayPrint",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const uu=e=>{U.useEffect(()=>{if(e){const c=document.querySelector("head"),g=document.createElement("script");g.setAttribute("type","application/ld+json");const d=document.createTextNode(e);return g.appendChild(d),c==null||c.appendChild(g),()=>{c==null||c.removeChild(g)}}},[e])};function zs({thing:e}){return uu(JSON.stringify(e)),V.jsx(V.Fragment,{})}try{zs.displayName="JsonLdScript",zs.__docgenInfo={description:"This component will add a json ld script tag to the page when rendered.",displayName:"JsonLdScript",props:{thing:{defaultValue:null,description:"",name:"thing",required:!0,type:{name:"WithContext<Thing>"}}}}}catch{}function Gs({entityId:e,version:c,searchParams:g}){var a,p,h;let d,o;e?(d=e,o=c):g&&(d=g.id,g.version&&(o=parseInt(g.version)));const u={sql:"select croissant_file_s3_object from syn65903895",additionalFilters:[{concreteType:Vs,columnName:"dataset",operator:js.EQUAL,values:[d]}]};o&&u.additionalFilters.push({concreteType:Vs,columnName:"dataset_version",operator:js.EQUAL,values:[`${o}`]});const{data:r}=bc({entityId:d,query:u,partMask:ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),s=(h=(p=(a=r==null?void 0:r.responseBody)==null?void 0:a.queryResult)==null?void 0:p.queryResults)==null?void 0:h.rows,i=s&&s.length>0?s[0]:void 0,n=i==null?void 0:i.values[0],{data:t}=yc(n,{enabled:!!n});return uu(t),V.jsx(V.Fragment,{})}try{Gs.displayName="DatasetJsonLdScript",Gs.__docgenInfo={description:"This component will add a Dataset json ld script tag to the page when rendered.",displayName:"DatasetJsonLdScript",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!1,type:{name:"string"}},version:{defaultValue:null,description:"",name:"version",required:!1,type:{name:"number"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"{ [key: string]: string; }"}}}}}catch{}const ls=(e,c)=>{const g={associateObjectId:c,associateObjectType:tu.TableEntity,fileHandleId:e||""},d=vc(g,!1,{enabled:!!e});return d==null?void 0:d.dataUrl},ud=400,cd=({research:e,entityId:c,publicationDateColIndex:g,titleColIndex:d,linkColIndex:o,imageColIndex:u,isLoading:r})=>{const s=e.values[u]??"",i=ls(s??"",c);return r?V.jsx(os,{variant:"rectangular",height:142,width:"100%"}):V.jsxs(xe,{sx:{display:"flex",gap:"30px",borderBottom:"1px solid",padding:"24px 0",borderColor:"grey.300",flexDirection:{xs:"column",sm:"row"}},children:[V.jsxs(pr,{useFlexGap:!0,sx:{gap:"10px"},children:[V.jsx(Ye,{variant:"headline2",sx:{color:"gray.1000",fontSize:"21px"},children:V.jsx(Tr,{href:e.values[o]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[d]})}),V.jsx(Ye,{sx:{lineHeight:"normal",color:"grey.600"},children:e.values[g]&&Rc(Nc(Number(e.values[g])),"MMMM, YYYY")})]}),V.jsx(as,{component:"img",image:i,"aria-hidden":"true",sx:{flexShrink:0,width:"140px",height:"93.8px",borderRadius:"6px",objectFit:"cover",marginLeft:{xs:"initial",sm:"auto"}}})]})},dd=({research:e,entityId:c,titleColIndex:g,descriptionColIndex:d,linkColIndex:o,imageColIndex:u,isLoading:r})=>{const[s,i]=Dc({threshold:.3,triggerOnce:!0}),n=e.values[u]??"",t=ls(n||"",c);return r?V.jsx(os,{variant:"rectangular",width:"100%",sx:{height:{xs:"250px",sm:"500px",md:"600px",lg:"800px"}}}):V.jsxs(xe,{ref:s,children:[V.jsx(Bc,{in:i,timeout:ud,children:V.jsx(as,{component:"img",image:t,"aria-hidden":"true",sx:{objectFit:"cover",borderRadius:"10px",marginBottom:"30px"}})}),V.jsxs(pr,{useFlexGap:!0,sx:{gap:"16px"},children:[V.jsx(Ye,{variant:"headline2",sx:{color:"grey.1000",fontSize:{xs:"24px",md:"36px"}},children:V.jsx(Tr,{href:e.values[o]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[g]})}),V.jsx(Ye,{sx:{fontSize:"18px",lineHeight:"22.4px"},children:e.values[d]??""}),V.jsx(Tr,{href:e.values[o]??"",target:"_blank",children:"Read more"})]})]})};function Ws(e){const{sql:c}=e,g=su(c),d={partMask:iu|ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:g,query:{sql:c}},{data:o,isLoading:u}=eu(d),r=(o==null?void 0:o.queryResult.queryResults.rows)??[];let s;(y=>{y.TITLE="title",y.DESCRIPTION="description",y.PUBLICATION_DATE="publicationDate",y.IMAGE="image",y.LINK="link"})(s||(s={}));const i=ct("title",o),n=ct("description",o),t=ct("publicationDate",o),a=ct("image",o),p=ct("link",o),h=r[0],w=r.slice(1),b=V.jsx(ou,{title:"Featured Research",sx:{h2:{fontSize:"24px",paddingBottom:0,width:"100%"}}});return V.jsxs(xe,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:{xs:"30px",md:"40px"},padding:{xs:"40px",lg:"80px"}},children:[V.jsx(xe,{sx:{display:{md:"none"}},children:b}),V.jsx(xe,{children:h&&V.jsx(dd,{entityId:g,research:h,titleColIndex:i,isLoading:u,descriptionColIndex:n,publicationDateColIndex:t,imageColIndex:a,linkColIndex:p})}),V.jsxs(pr,{children:[V.jsx(xe,{sx:{display:{xs:"none",md:"block"}},children:b}),V.jsx(pr,{sx:{gap:"16px"},children:w.map((y,l)=>V.jsx(cd,{entityId:g,research:y,isLoading:u,titleColIndex:i,descriptionColIndex:n,publicationDateColIndex:t,imageColIndex:a,linkColIndex:p},l))})]})]})}try{Ws.displayName="FeaturedResearch",Ws.__docgenInfo={description:"",displayName:"FeaturedResearch",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const Ir=({backgroundCss:e,buttonLink:c,title:g,subTitle:d,description:o,backgroundMp4:u,backgroundMp4Css:r})=>V.jsxs(xe,{"data-testid":"HeaderContainer",sx:{background:e,padding:{xs:0,md:"50px 80px"},position:"relative"},children:[u&&V.jsxs(xe,{component:"video",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"fill",zIndex:-1,background:r},children:[V.jsx("source",{src:u,type:"video/mp4"}),"Your browser does not support the video tag."]}),V.jsxs(pr,{sx:{alignItems:"flex-start",padding:{xs:"40px",md:"40px 0"},gap:"24px",width:{sm:"100%",md:"746px"}},children:[V.jsx(Ye,{variant:"headline2",sx:{fontWeight:300,lineHeight:"130%",fontSize:{xs:"36px",md:"42px"},color:"grey.1000"},children:g}),V.jsx(Ye,{variant:"headline3",sx:{fontSize:"24px",fontWeight:"400",lineHeight:"160%",color:"grey.1000"},children:d}),V.jsx(Ye,{sx:{fontSize:"18px",lineHeight:"140%",color:"grey.900"},children:o}),c&&V.jsx(gr,{href:c,target:"_blank",variant:"contained",role:"button",sx:s=>({whiteSpace:"nowrap",alignSelf:"flex-start",padding:"6px 24px",fontWeight:600,boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)","&:hover":{boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)"},[s.breakpoints.down("sm")]:{width:"100%"}}),children:"Learn more"})]})]});try{Ir.displayName="PortalHomePageHeader",Ir.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}try{Ir.displayName="PortalHomePageHeader",Ir.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}const fd=({partner:e,imageColIndex:c,organizationNameColIndex:g,websiteColIndex:d,entityId:o,isLoading:u})=>{const r=e.values[c]??"",s=ls(r??"",o);if(!(!s&&!(e!=null&&e.values[g])))return u?V.jsx(os,{variant:"rectangular",height:101,width:156}):V.jsx(Tr,{href:e.values[d]??"",target:"_blank",sx:{display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none !important"},children:s?V.jsx(as,{component:"img",image:s,"aria-hidden":"true",sx:{width:"156px",height:"101px",objectFit:"contain",borderRadius:"10px"}}):V.jsx(xe,{sx:{display:"flex",width:"165px",padding:"3px",flexDirection:"column",gap:"10px",border:"2px solid",borderColor:"grey.900",backgroundColor:"#FFF",textAlign:"center"},children:V.jsx(xe,{sx:{display:"flex",padding:"10px",justifyContent:"center",alignItems:"center",gap:"10px",border:"1px solid",borderColor:"grey.900"},children:V.jsx(Ye,{variant:"headline3",sx:{fontSize:"14px",fontWeight:400,lineHeight:"130%",color:"grey.900"},children:e==null?void 0:e.values[g??-1]})})})})},Hs=({sql:e,titleText:c="Our Partners"})=>{const g=su(e),d={partMask:iu|ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:g,query:{sql:e}},{data:o,isLoading:u}=eu(d),r=(o==null?void 0:o.queryResult.queryResults.rows)??[];let s;(a=>{a.CARDLOGO="cardLogo",a.ORGANIZATION_NAME="organizationName",a.WEBSITE="website"})(s||(s={}));const i=ct("cardLogo",o),n=ct("organizationName",o),t=ct("website",o);return V.jsxs(xe,{sx:{display:"grid",padding:{xs:"40px",lg:"20px 80px"},gridTemplateColumns:{xs:"1fr",md:"1fr 3fr"},gap:"50px"},children:[V.jsx(ou,{title:c,sx:{h2:{fontSize:"24px",paddingTop:"26px",width:"100%"}}}),V.jsx(xe,{sx:a=>({display:"flex",flexWrap:"wrap",gap:"64px",flex:"1 1 0",[a.breakpoints.down("sm")]:{justifyContent:"center"}}),children:r==null?void 0:r.map((a,p)=>V.jsx(fd,{partner:a,imageColIndex:i,organizationNameColIndex:n,websiteColIndex:t,entityId:g,isLoading:u},`partner-${p}`))})]})};try{Hs.displayName="PortalFeaturedPartners",Hs.__docgenInfo={description:"",displayName:"PortalFeaturedPartners",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},titleText:{defaultValue:{value:"Our Partners"},description:"",name:"titleText",required:!1,type:{name:"string"}}}}}catch{}function Yi(e){const{sourceEntityId:c,gridSessionId:g}=e,{mutate:d,isPending:o}=ad({onSuccess:u=>{hd(u)},onError:u=>{Et(u.message,"danger")}});return V.jsx(gr,{loading:o,onClick:()=>{d({gridSessionId:g,sourceEntityId:c})},variant:"contained",children:"Update table with changes"})}function hd(e){var c,g;if((c=e.results)!=null&&c.length){const d=e.results[0];if(wc(d)){const o=pd(d).join(`
`);o?Et(`Some changes could not be applied:
${o}`,"danger"):Et("Changes applied successfully","success")}else if(_c(d)){const o=(g=d.rowsProcessed)==null?void 0:g.toLocaleString();Et(`Successfully updated ${o} rows.`,"success")}}}function pd(e){var c;return((c=e.updateResults)==null?void 0:c.filter(g=>!!g.failureCode).map(g=>`${g.entityId}: ${g.failureMessage} (code: ${g.failureCode})`))??[]}try{Yi.displayName="MergeGridWithSourceTableButton",Yi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}const cu="__rowKey",md=e=>{const c=e.trim();if(c){if(c.toUpperCase().startsWith("SELECT"))return{type:"sql",input:c};if(/^[A-Za-z]\w*=+$/.test(c))return{type:"sessionId",input:c}}else return{type:"empty",input:""};return{type:"unknown",input:c}};function gd(e,c){const g=Object.keys(e),d=Object.keys(c);if(g.length!==d.length)return!1;for(const o of g){const u=e[o],r=c[o],s=i=>i==null||i==="";if(!(s(u)&&s(r))&&String(u)!==String(r))return!1}return!0}function bd(e,c,g){function d(o){if(o.type==="UPDATE"){const u=c.slice(o.fromRowIndex,o.toRowIndex),r=e.slice(o.fromRowIndex,o.toRowIndex);return u.map((i,n)=>gd(i,r[n])).every(Boolean)}return!1}return g.filter(o=>!d(o))}function yd(e){return`[${e.sid},${e.time}]`}function vd(e,c){if(!e||!c)return[];const{columnNames:g,columnOrder:d,rows:o}=c;return o.map(r=>{var i;const s={};return d.forEach(n=>{const t=g[n];t&&(s[t]=r.data[n])}),s[cu]=yd(e.api.obj(["rows",String(o.indexOf(r))]).node.id),s.__validationResults=(i=r.metadata)==null?void 0:i.rowValidation,s})}function wd(e){return{value:e.value}}function _d(e){return br(e)&&"type"in e&&(e.type=="null"||Uc(e.type,["null"]))}function Sd(e){return au(e)&&e.every(c=>br(c)&&"const"in c)}function xd(e){let c=[];if(e!=null&&e.oneOf&&au(e.oneOf)&&!Sd(e.oneOf)){const g=e.oneOf.filter(d=>!_d(d));g.length==1&&br(g[0])&&Object.hasOwn(g[0],"enum")&&(c=Ms(g[0])||[])}else c=Ms(e)||[];return c.map(wd)}function Js(e,c){return zc(e,[Ac,c],{})}var Qr={},je={},Zr={},Ks;function Cd(){return Ks||(Ks=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useColumnWidths=e.getColumnWidths=void 0;const c=de(),g=(o,u)=>{const r=u.map(({basis:i,minWidth:n,maxWidth:t})=>({basis:i,minWidth:n,maxWidth:t,size:i,violation:0,frozen:!1,factor:0}));let s=r.reduce((i,n)=>i-n.size,o);s>0?u.forEach(({grow:i},n)=>{r[n].factor=i}):s<0&&u.forEach(({shrink:i},n)=>{r[n].factor=i});for(const i of r)i.factor===0&&(i.frozen=!0);for(;r.some(({frozen:i})=>!i);){const i=r.reduce((t,a)=>t+(a.frozen?0:a.factor),0);let n=0;for(const t of r)t.frozen||(t.size+=s*t.factor/i,t.size<t.minWidth?t.violation=t.minWidth-t.size:t.maxWidth!==void 0&&t.size>t.maxWidth?t.violation=t.maxWidth-t.size:t.violation=0,t.size+=t.violation,n+=t.violation);if(n>0)for(const t of r)t.violation>0&&(t.frozen=!0);else if(n<0)for(const t of r)t.violation<0&&(t.frozen=!0);else break;s=r.reduce((t,a)=>t-a.size,o)}return r.map(({size:i})=>i)};e.getColumnWidths=g;const d=(o,u)=>{const r=o.map(({basis:s,minWidth:i,maxWidth:n,grow:t,shrink:a})=>[s,i,n,t,a].join(",")).join("|");return(0,c.useMemo)(()=>{if(u===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const s=(0,e.getColumnWidths)(u,o);let i=0;const n=s.map((t,a)=>(i+=t,a===s.length-1?1/0:i));return{fullWidth:Math.abs(u-i)<.1,columnWidths:s,columnRights:n,totalWidth:i}},[u,r])};e.useColumnWidths=d}(Zr)),Zr}var Xi=function(e,c){return Xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,d){g.__proto__=d}||function(g,d){for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(g[o]=d[o])},Xi(e,c)};function du(e,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");Xi(e,c);function g(){this.constructor=e}e.prototype=c===null?Object.create(c):(g.prototype=c.prototype,new g)}var $t=function(){return $t=Object.assign||function(c){for(var g,d=1,o=arguments.length;d<o;d++){g=arguments[d];for(var u in g)Object.prototype.hasOwnProperty.call(g,u)&&(c[u]=g[u])}return c},$t.apply(this,arguments)};function fu(e,c){var g={};for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&c.indexOf(d)<0&&(g[d]=e[d]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,d=Object.getOwnPropertySymbols(e);o<d.length;o++)c.indexOf(d[o])<0&&Object.prototype.propertyIsEnumerable.call(e,d[o])&&(g[d[o]]=e[d[o]]);return g}var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ne.global<"u"?Ne.global:typeof self<"u"?self:{};function Od(e){var c=typeof e;return e!=null&&(c=="object"||c=="function")}var us=Od,Rd=typeof Sr=="object"&&Sr&&Sr.Object===Object&&Sr,Nd=Rd,Ed=Nd,Td=typeof self=="object"&&self&&self.Object===Object&&self,Id=Ed||Td||Function("return this")(),hu=Id,kd=hu,jd=function(){return kd.Date.now()},Vd=jd,Ad=/\s/;function Pd(e){for(var c=e.length;c--&&Ad.test(e.charAt(c)););return c}var Md=Pd,qd=Md,Dd=/^\s+/;function Bd(e){return e&&e.slice(0,qd(e)+1).replace(Dd,"")}var Fd=Bd,Ld=hu,Ud=Ld.Symbol,pu=Ud,Ys=pu,mu=Object.prototype,$d=mu.hasOwnProperty,zd=mu.toString,Kt=Ys?Ys.toStringTag:void 0;function Gd(e){var c=$d.call(e,Kt),g=e[Kt];try{e[Kt]=void 0;var d=!0}catch{}var o=zd.call(e);return d&&(c?e[Kt]=g:delete e[Kt]),o}var Wd=Gd,Hd=Object.prototype,Jd=Hd.toString;function Kd(e){return Jd.call(e)}var Yd=Kd,Xs=pu,Xd=Wd,Qd=Yd,Zd="[object Null]",ef="[object Undefined]",Qs=Xs?Xs.toStringTag:void 0;function tf(e){return e==null?e===void 0?ef:Zd:Qs&&Qs in Object(e)?Xd(e):Qd(e)}var nf=tf;function rf(e){return e!=null&&typeof e=="object"}var sf=rf,of=nf,af=sf,lf="[object Symbol]";function uf(e){return typeof e=="symbol"||af(e)&&of(e)==lf}var cf=uf,df=Fd,Zs=us,ff=cf,eo=NaN,hf=/^[-+]0x[0-9a-f]+$/i,pf=/^0b[01]+$/i,mf=/^0o[0-7]+$/i,gf=parseInt;function bf(e){if(typeof e=="number")return e;if(ff(e))return eo;if(Zs(e)){var c=typeof e.valueOf=="function"?e.valueOf():e;e=Zs(c)?c+"":c}if(typeof e!="string")return e===0?e:+e;e=df(e);var g=pf.test(e);return g||mf.test(e)?gf(e.slice(2),g?2:8):hf.test(e)?eo:+e}var yf=bf,vf=us,ei=Vd,to=yf,wf="Expected a function",_f=Math.max,Sf=Math.min;function xf(e,c,g){var d,o,u,r,s,i,n=0,t=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(wf);c=to(c)||0,vf(g)&&(t=!!g.leading,a="maxWait"in g,u=a?_f(to(g.maxWait)||0,c):u,p="trailing"in g?!!g.trailing:p);function h(S){var C=d,O=o;return d=o=void 0,n=S,r=e.apply(O,C),r}function w(S){return n=S,s=setTimeout(l,c),t?h(S):r}function b(S){var C=S-i,O=S-n,x=c-C;return a?Sf(x,u-O):x}function y(S){var C=S-i,O=S-n;return i===void 0||C>=c||C<0||a&&O>=u}function l(){var S=ei();if(y(S))return f(S);s=setTimeout(l,b(S))}function f(S){return s=void 0,p&&d?h(S):(d=o=void 0,r)}function m(){s!==void 0&&clearTimeout(s),n=0,d=i=o=s=void 0}function v(){return s===void 0?r:f(ei())}function _(){var S=ei(),C=y(S);if(d=arguments,o=this,i=S,C){if(s===void 0)return w(i);if(a)return clearTimeout(s),s=setTimeout(l,c),h(i)}return s===void 0&&(s=setTimeout(l,c)),r}return _.cancel=m,_.flush=v,_}var gu=xf,Cf=gu,Of=us,Rf="Expected a function";function Nf(e,c,g){var d=!0,o=!0;if(typeof e!="function")throw new TypeError(Rf);return Of(g)&&(d="leading"in g?!!g.leading:d,o="trailing"in g?!!g.trailing:o),Cf(e,c,{leading:d,maxWait:c,trailing:o})}var Ef=Nf,bu=function(e,c,g,d){switch(c){case"debounce":return gu(e,g,d);case"throttle":return Ef(e,g,d);default:return e}},Qi=function(e){return typeof e=="function"},dt=function(){return typeof window>"u"},no=function(e){return e instanceof Element||e instanceof HTMLDocument},yu=function(e,c,g,d){return function(o){var u=o.width,r=o.height;c(function(s){return s.width===u&&s.height===r||s.width===u&&!d||s.height===r&&!g?s:(e&&Qi(e)&&e(u,r),{width:u,height:r})})}},vu=function(e){du(c,e);function c(g){var d=e.call(this,g)||this;d.cancelHandler=function(){d.resizeHandler&&d.resizeHandler.cancel&&(d.resizeHandler.cancel(),d.resizeHandler=null)},d.attachObserver=function(){var n=d.props,t=n.targetRef,a=n.observerOptions;if(!dt()){t&&t.current&&(d.targetRef.current=t.current);var p=d.getElement();p&&(d.observableElement&&d.observableElement===p||(d.observableElement=p,d.resizeObserver.observe(p,a)))}},d.getElement=function(){var n=d.props,t=n.querySelector,a=n.targetDomEl;if(dt())return null;if(t)return document.querySelector(t);if(a&&no(a))return a;if(d.targetRef&&no(d.targetRef.current))return d.targetRef.current;var p=Wc.findDOMNode(d);if(!p)return null;var h=d.getRenderType();switch(h){case"renderProp":return p;case"childFunction":return p;case"child":return p;case"childArray":return p;default:return p.parentElement}},d.createResizeHandler=function(n){var t=d.props,a=t.handleWidth,p=a===void 0?!0:a,h=t.handleHeight,w=h===void 0?!0:h,b=t.onResize;if(!(!p&&!w)){var y=yu(b,d.setState.bind(d),p,w);n.forEach(function(l){var f=l&&l.contentRect||{},m=f.width,v=f.height,_=!d.skipOnMount&&!dt();_&&y({width:m,height:v}),d.skipOnMount=!1})}},d.getRenderType=function(){var n=d.props,t=n.render,a=n.children;return Qi(t)?"renderProp":Qi(a)?"childFunction":U.isValidElement(a)?"child":Array.isArray(a)?"childArray":"parent"};var o=g.skipOnMount,u=g.refreshMode,r=g.refreshRate,s=r===void 0?1e3:r,i=g.refreshOptions;return d.state={width:void 0,height:void 0},d.skipOnMount=o,d.targetRef=U.createRef(),d.observableElement=null,dt()||(d.resizeHandler=bu(d.createResizeHandler,u,s,i),d.resizeObserver=new window.ResizeObserver(d.resizeHandler)),d}return c.prototype.componentDidMount=function(){this.attachObserver()},c.prototype.componentDidUpdate=function(){this.attachObserver()},c.prototype.componentWillUnmount=function(){dt()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},c.prototype.render=function(){var g=this.props,d=g.render,o=g.children,u=g.nodeType,r=u===void 0?"div":u,s=this.state,i=s.width,n=s.height,t={width:i,height:n,targetRef:this.targetRef},a=this.getRenderType(),p;switch(a){case"renderProp":return d&&d(t);case"childFunction":return p=o,p(t);case"child":if(p=o,p.type&&typeof p.type=="string"){t.targetRef;var h=fu(t,["targetRef"]);return U.cloneElement(p,h)}return U.cloneElement(p,t);case"childArray":return p=o,p.map(function(w){return!!w&&U.cloneElement(w,t)});default:return U.createElement(r,null)}},c}(U.PureComponent);function Tf(e,c){c===void 0&&(c={});var g=function(u){du(r,u);function r(){var s=u!==null&&u.apply(this,arguments)||this;return s.ref=U.createRef(),s}return r.prototype.render=function(){var s=this.props,i=s.forwardedRef,n=fu(s,["forwardedRef"]),t=i??this.ref;return U.createElement(vu,$t({},c,{targetRef:t}),U.createElement(e,$t({targetRef:t},n)))},r}(U.Component);function d(u,r){return U.createElement(g,$t({},u,{forwardedRef:r}))}var o=e.displayName||e.name;return d.displayName="withResizeDetector(".concat(o,")"),U.forwardRef(d)}var If=dt()?U.useEffect:U.useLayoutEffect;function kf(e){e===void 0&&(e={});var c=e.skipOnMount,g=c===void 0?!1:c,d=e.refreshMode,o=e.refreshRate,u=o===void 0?1e3:o,r=e.refreshOptions,s=e.handleWidth,i=s===void 0?!0:s,n=e.handleHeight,t=n===void 0?!0:n,a=e.targetRef,p=e.observerOptions,h=e.onResize,w=U.useRef(g),b=U.useRef(null),y=a??b,l=U.useRef(),f=U.useState({width:void 0,height:void 0}),m=f[0],v=f[1];return If(function(){if(!dt()){var _=yu(h,v,i,t),S=function(O){!i&&!t||O.forEach(function(x){var N=x&&x.contentRect||{},E=N.width,I=N.height,R=!w.current&&!dt();R&&_({width:E,height:I}),w.current=!1})};l.current=bu(S,d,u,r);var C=new window.ResizeObserver(l.current);return y.current&&C.observe(y.current,p),function(){C.disconnect();var O=l.current;O&&O.cancel&&O.cancel()}}},[d,u,r,i,t,h,p,y.current]),$t({ref:y},m)}const jf=Object.freeze(Object.defineProperty({__proto__:null,default:vu,useResizeDetector:kf,withResizeDetector:Tf},Symbol.toStringTag,{value:"Module"})),Vf=ru(jf);var et={},ro;function Af(){return ro||(ro=1,function(e){var c=et&&et.__createBinding||(Object.create?function(w,b,y,l){l===void 0&&(l=y);var f=Object.getOwnPropertyDescriptor(b,y);(!f||("get"in f?!b.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return b[y]}}),Object.defineProperty(w,l,f)}:function(w,b,y,l){l===void 0&&(l=y),w[l]=b[y]}),g=et&&et.__setModuleDefault||(Object.create?function(w,b){Object.defineProperty(w,"default",{enumerable:!0,value:b})}:function(w,b){w.default=b}),d=et&&et.__importStar||function(w){if(w&&w.__esModule)return w;var b={};if(w!=null)for(var y in w)y!=="default"&&Object.prototype.hasOwnProperty.call(w,y)&&c(b,w,y);return g(b,w),b};Object.defineProperty(e,"__esModule",{value:!0}),e.useColumns=e.parseFlexValue=void 0;const o=d(de()),u=()=>o.default.createElement(o.default.Fragment,null),r=()=>!1,s=({rowData:w})=>w,i=()=>null,n=({rowIndex:w})=>o.default.createElement(o.default.Fragment,null,w+1),t=()=>!0,a=w=>w,p=w=>{if(typeof w=="number")return{basis:0,grow:w,shrink:1};if(w.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(w.trim()),shrink:1};if(w.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(w.trim()),grow:1,shrink:1};if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[b,y]=w.trim().split(" ");return{basis:0,grow:parseFloat(b),shrink:parseFloat(y)}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,y]=w.trim().split(" ");return{basis:parseFloat(y),grow:parseFloat(b),shrink:1}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,y,l]=w.trim().split(" ");return{basis:parseFloat(l),grow:parseFloat(b),shrink:parseFloat(y)}}return{basis:0,grow:1,shrink:1}};e.parseFlexValue=p;const h=(w,b,y)=>(0,o.useMemo)(()=>{var l,f,m,v,_,S,C,O,x,N;const E=[b===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>o.default.createElement(o.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:t}:Object.assign(Object.assign({},b),{basis:(l=b==null?void 0:b.basis)!==null&&l!==void 0?l:40,grow:(f=b==null?void 0:b.grow)!==null&&f!==void 0?f:0,shrink:(m=b==null?void 0:b.shrink)!==null&&m!==void 0?m:0,minWidth:(v=b==null?void 0:b.minWidth)!==null&&v!==void 0?v:0,title:(_=b==null?void 0:b.title)!==null&&_!==void 0?_:o.default.createElement("div",{className:"dsg-corner-indicator"}),component:(S=b==null?void 0:b.component)!==null&&S!==void 0?S:n,isCellEmpty:t}),...w];return y&&E.push(Object.assign(Object.assign({},y),{basis:(C=y==null?void 0:y.basis)!==null&&C!==void 0?C:40,grow:(O=y==null?void 0:y.grow)!==null&&O!==void 0?O:0,shrink:(x=y==null?void 0:y.shrink)!==null&&x!==void 0?x:0,minWidth:(N=y.minWidth)!==null&&N!==void 0?N:0,isCellEmpty:t})),E.map(I=>{var R,M,P,A,D,z,$,X,Z,K,Q,be,Ke,st,ge,ot;const at=I.width!==void 0?(0,e.parseFlexValue)(I.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},I),{basis:(M=(R=I.basis)!==null&&R!==void 0?R:at.basis)!==null&&M!==void 0?M:0,grow:(A=(P=I.grow)!==null&&P!==void 0?P:at.grow)!==null&&A!==void 0?A:1,shrink:(z=(D=I.shrink)!==null&&D!==void 0?D:at.shrink)!==null&&z!==void 0?z:1,minWidth:($=I.minWidth)!==null&&$!==void 0?$:100,component:(X=I.component)!==null&&X!==void 0?X:u,disableKeys:(Z=I.disableKeys)!==null&&Z!==void 0?Z:!1,disabled:(K=I.disabled)!==null&&K!==void 0?K:!1,keepFocus:(Q=I.keepFocus)!==null&&Q!==void 0?Q:!1,deleteValue:(be=I.deleteValue)!==null&&be!==void 0?be:s,copyValue:(Ke=I.copyValue)!==null&&Ke!==void 0?Ke:i,pasteValue:(st=I.pasteValue)!==null&&st!==void 0?st:s,prePasteValues:(ge=I.prePasteValues)!==null&&ge!==void 0?ge:a,isCellEmpty:(ot=I.isCellEmpty)!==null&&ot!==void 0?ot:r})})},[b,y,w]);e.useColumns=h}(et)),et}var Yt={},Xt={},io;function cs(){if(io)return Xt;io=1,Object.defineProperty(Xt,"__esModule",{value:!0});function e(g,d,o,u){var r,s=!1,i=0;function n(){r&&clearTimeout(r)}function t(){n(),s=!0}typeof d!="boolean"&&(u=o,o=d,d=void 0);function a(){for(var p=arguments.length,h=new Array(p),w=0;w<p;w++)h[w]=arguments[w];var b=this,y=Date.now()-i;if(s)return;function l(){i=Date.now(),o.apply(b,h)}function f(){r=void 0}u&&!r&&l(),n(),u===void 0&&y>g?l():d!==!0&&(r=setTimeout(u?f:l,u===void 0?g-y:g))}return a.cancel=t,a}function c(g,d,o){return o===void 0?e(g,d,!1):e(g,o,d!==!1)}return Xt.debounce=c,Xt.throttle=e,Xt}var gt={},so;function wu(){if(so)return gt;so=1;var e=gt&&gt.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(gt,"__esModule",{value:!0}),gt.useDeepEqualState=void 0;const c=de(),g=e(nu()),d=o=>{const[u,r]=(0,c.useState)(o),s=(0,c.useCallback)(i=>{r(n=>{const t=typeof i=="function"?i(n):i;return(0,g.default)(t,n)?n:t})},[r]);return[u,s]};return gt.useDeepEqualState=d,gt}var oo;function Pf(){if(oo)return Yt;oo=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.useEdges=void 0;const e=de(),c=cs(),g=wu(),d=(o,u,r)=>{const[s,i]=(0,g.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,e.useEffect)(()=>{const n=(0,c.throttle)(100,()=>{var a,p,h,w,b,y,l,f,m,v;i({top:((a=o.current)===null||a===void 0?void 0:a.scrollTop)===0,right:((h=(p=o.current)===null||p===void 0?void 0:p.scrollLeft)!==null&&h!==void 0?h:0)>=((b=(w=o.current)===null||w===void 0?void 0:w.scrollWidth)!==null&&b!==void 0?b:0)-(u??0)-1,bottom:((l=(y=o.current)===null||y===void 0?void 0:y.scrollTop)!==null&&l!==void 0?l:0)>=((m=(f=o.current)===null||f===void 0?void 0:f.scrollHeight)!==null&&m!==void 0?m:0)-(r??0)-1,left:((v=o.current)===null||v===void 0?void 0:v.scrollLeft)===0})}),t=o.current;return t==null||t.addEventListener("scroll",n),setTimeout(n,100),()=>{t==null||t.removeEventListener("scroll",n),n.cancel()}},[r,u,o,i]),s};return Yt.useEdges=d,Yt}var Qt={},ao;function _u(){if(ao)return Qt;ao=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.useDocumentEventListener=void 0;const e=de(),c=(g,d)=>{(0,e.useEffect)(()=>(document.addEventListener(g,d),()=>{document.removeEventListener(g,d)}),[d,g])};return Qt.useDocumentEventListener=c,Qt}var Zt={},lo;function Mf(){if(lo)return Zt;lo=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.useGetBoundingClientRect=void 0;const e=de(),c=cs(),g=(d,o=200)=>{const u=(0,e.useRef)(null),r=(0,e.useMemo)(()=>(0,c.throttle)(o,!0,()=>{setTimeout(()=>{var s;return u.current=((s=d.current)===null||s===void 0?void 0:s.getBoundingClientRect())||null},0)}),[d,o]);return(0,e.useCallback)((s=!1)=>{var i;return s?u.current=((i=d.current)===null||i===void 0?void 0:i.getBoundingClientRect())||null:r(),u.current},[d,r])};return Zt.useGetBoundingClientRect=g,Zt}var tt={},uo;function Su(){return uo||(uo=1,function(e){var c=tt&&tt.__createBinding||(Object.create?function(r,s,i,n){n===void 0&&(n=i);var t=Object.getOwnPropertyDescriptor(s,i);(!t||("get"in t?!s.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,n,t)}:function(r,s,i,n){n===void 0&&(n=i),r[n]=s[i]}),g=tt&&tt.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),d=tt&&tt.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var i in r)i!=="default"&&Object.prototype.hasOwnProperty.call(r,i)&&c(s,r,i);return g(s,r),s};Object.defineProperty(e,"__esModule",{value:!0}),e.AddRows=e.createAddRowsComponent=void 0;const o=d(de()),u=(r={})=>({addRows:s})=>{var i,n;const[t,a]=(0,o.useState)(1),[p,h]=(0,o.useState)(String(t));return o.default.createElement("div",{className:"dsg-add-row"},o.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>s(t)},(i=r.button)!==null&&i!==void 0?i:"Add")," ",o.default.createElement("input",{className:"dsg-add-row-input",value:p,onBlur:()=>h(String(t)),type:"number",min:1,onChange:w=>{h(w.target.value),a(Math.max(1,Math.round(parseInt(w.target.value)||0)))},onKeyDown:w=>{w.key==="Enter"&&s(t)}})," ",(n=r.unit)!==null&&n!==void 0?n:"rows")};e.createAddRowsComponent=u,e.AddRows=(0,e.createAddRowsComponent)(),e.AddRows.displayName="AddRows"}(tt)),tt}var en={},co;function qf(){if(co)return en;co=1,Object.defineProperty(en,"__esModule",{value:!0}),en.useDebounceState=void 0;const e=de(),c=cs(),g=(d,o)=>{const[u,r]=(0,e.useState)(d),s=(0,e.useRef)();(0,e.useEffect)(()=>()=>{var n;return(n=s.current)===null||n===void 0?void 0:n.cancel()},[]);const i=(0,e.useMemo)(()=>s.current=(0,c.debounce)(o,n=>{r(n)}),[o]);return[u,i]};return en.useDebounceState=g,en}var nt={},fo;function xu(){return fo||(fo=1,function(e){var c=nt&&nt.__createBinding||(Object.create?function(n,t,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(t,a);(!h||("get"in h?!t.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(n,p,h)}:function(n,t,a,p){p===void 0&&(p=a),n[p]=t[a]}),g=nt&&nt.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),d=nt&&nt.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var a in n)a!=="default"&&Object.prototype.hasOwnProperty.call(n,a)&&c(t,n,a);return g(t,n),t};Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=e.createContextMenuComponent=e.defaultRenderItem=void 0;const o=d(de()),u=de(),r=_u(),s=n=>n.type==="CUT"?o.createElement(o.Fragment,null,"Cut"):n.type==="COPY"?o.createElement(o.Fragment,null,"Copy"):n.type==="PASTE"?o.createElement(o.Fragment,null,"Paste"):n.type==="DELETE_ROW"?o.createElement(o.Fragment,null,"Delete row"):n.type==="DELETE_ROWS"?o.createElement(o.Fragment,null,"Delete rows ",o.createElement("b",null,n.fromRow)," to ",o.createElement("b",null,n.toRow)):n.type==="INSERT_ROW_BELLOW"?o.createElement(o.Fragment,null,"Insert row below"):n.type==="DUPLICATE_ROW"?o.createElement(o.Fragment,null,"Duplicate row"):n.type==="DUPLICATE_ROWS"?o.createElement(o.Fragment,null,"Duplicate rows ",o.createElement("b",null,n.fromRow)," to ",o.createElement("b",null,n.toRow)):n.type;e.defaultRenderItem=s;const i=(n=e.defaultRenderItem)=>({clientX:t,clientY:a,items:p,close:h})=>{const w=(0,u.useRef)(null),b=(0,u.useCallback)(y=>{var l;((l=w.current)===null||l===void 0?void 0:l.contains(y.target))||h()},[h]);return(0,r.useDocumentEventListener)("mousedown",b),o.createElement("div",{className:"dsg-context-menu",style:{left:t+"px",top:a+"px"},ref:w},p.map(y=>o.createElement("div",{key:y.type,onClick:y.action,className:"dsg-context-menu-item"},n(y))))};e.createContextMenuComponent=i,e.ContextMenu=(0,e.createContextMenuComponent)(e.defaultRenderItem),e.ContextMenu.displayName="ContextMenu"}(nt)),nt}var $e={},tn={},ho;function Df(){if(ho)return tn;ho=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.parseDom=void 0;const e=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},c=g=>e.parseFromString(g,"text/html");return tn.parseDom=c,tn}var po;function Bf(){if(po)return $e;po=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.isPrintableUnicode=$e.encodeHtml=$e.parseTextPlainData=$e.parseTextHtmlData=void 0;const e=Df(),c=u=>{var r,s;const i=(0,e.parseDom)(u.replace(/<br\/?>/g,`
`)),n=i.getElementsByTagName("table")[0];if(n){const a=[];for(let p=0;p<n.rows.length;p++){const h=[];a.push(h);for(let w=0;w<n.rows[p].cells.length;w++)h.push((r=n.rows[p].cells[w].textContent)!==null&&r!==void 0?r:"")}return a}const t=i.getElementsByTagName("span")[0];return t?[[(s=t.textContent)!==null&&s!==void 0?s:""]]:[[""]]};$e.parseTextHtmlData=c;const g=u=>{const r=u.replace(/\r|\n$/g,""),s=[[]];let i=0,n=0,t=!1,a=0;const p=()=>{let h=r.slice(n,i);h[0]==='"'&&h[h.length-1]==='"'&&(t=!0),t&&h[h.length-1]==='"'&&h.includes(`
`)&&(h=h.slice(1,h.length-1).replace(/""/g,'"'),t=!1),t&&h[h.length-1]!=='"'?h.split(`
`).forEach((w,b,{length:y})=>{s[a].push(w),b<y-1&&(s.push([]),a++)}):s[a].push(h)};for(;i<r.length;)t&&r[i]==='"'&&![void 0,"	",'"'].includes(r[i+1])&&(t=!1),t&&r[i]==='"'&&r[i+1]==='"'&&i++,i===n&&r[i]==='"'&&(t=!0),r[i]==="	"&&(p(),n=i+1,t=!1),r[i]===`
`&&!t&&(p(),s.push([]),n=i+1,a++),i++;return p(),s};$e.parseTextPlainData=g;const d=u=>u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");$e.encodeHtml=d;const o=u=>u.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return $e.isPrintableUnicode=o,$e}var ti={},mo;function Ff(){return mo||(mo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSelectionWithId=e.getSelection=e.getCellWithId=e.getCell=void 0;const c=(u,r,s,i)=>{if(u===null||!r||!s)return null;if(typeof u!="object")throw new Error("Value must be an object or null");const n=i.findIndex(a=>a.id===u.col),t={col:Math.max(0,Math.min(r-1,n===-1?Number(u.col):n-1)),row:Math.max(0,Math.min(s-1,Number(u.row)))};if(isNaN(t.col)||isNaN(t.row))throw new Error("col or cell are not valid positive numbers");return t};e.getCell=c;const g=(u,r)=>{var s;return u?{col:u.col,row:u.row,colId:(s=r[u.col+1])===null||s===void 0?void 0:s.id}:null};e.getCellWithId=g;const d=(u,r,s,i)=>{if(u===null||!r||!s)return null;if(typeof u!="object")throw new Error("Value must be an object or null");const n={min:(0,e.getCell)(u.min,r,s,i),max:(0,e.getCell)(u.max,r,s,i)};if(!n.min||!n.max)throw new Error("min and max must be defined");return n};e.getSelection=d;const o=(u,r)=>u?{min:(0,e.getCellWithId)(u.min,r),max:(0,e.getCellWithId)(u.max,r)}:null;e.getSelectionWithId=o}(ti)),ti}var nn={},go;function Lf(){if(go)return nn;go=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.getAllTabbableElements=void 0;const e=()=>Array.from(document.querySelectorAll("*")).filter(c=>c instanceof HTMLElement&&typeof c.tabIndex=="number"&&c.tabIndex>=0&&!c.disabled&&(!(c instanceof HTMLAnchorElement)||!!c.href||c.getAttribute("tabIndex")!==null)&&getComputedStyle(c).visibility!=="collapse");return nn.getAllTabbableElements=e,nn}var Ve={},ni={},ri={},ii={},bo;function Uf(){return bo||(bo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function c(u,r,s){let i=s.initialDeps??[],n;function t(){var a,p,h,w;let b;s.key&&((a=s.debug)!=null&&a.call(s))&&(b=Date.now());const y=u();if(!(y.length!==i.length||y.some((m,v)=>i[v]!==m)))return n;i=y;let f;if(s.key&&((p=s.debug)!=null&&p.call(s))&&(f=Date.now()),n=r(...y),s.key&&((h=s.debug)!=null&&h.call(s))){const m=Math.round((Date.now()-b)*100)/100,v=Math.round((Date.now()-f)*100)/100,_=v/16,S=(C,O)=>{for(C=String(C);C.length<O;)C=" "+C;return C};console.info(`%c⏱ ${S(v,5)} /${S(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*_,120))}deg 100% 31%);`,s==null?void 0:s.key)}return(w=s==null?void 0:s.onChange)==null||w.call(s,n),n}return t.updateDeps=a=>{i=a},t}function g(u,r){if(u===void 0)throw new Error(`Unexpected undefined${r?`: ${r}`:""}`);return u}const d=(u,r)=>Math.abs(u-r)<=1,o=(u,r,s)=>{let i;return function(...n){u.clearTimeout(i),i=u.setTimeout(()=>r.apply(this,n),s)}};e.approxEqual=d,e.debounce=o,e.memo=c,e.notUndefined=g}(ii)),ii}var yo;function $f(){return yo||(yo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const c=Uf(),g=l=>{const{offsetWidth:f,offsetHeight:m}=l;return{width:f,height:m}},d=l=>l,o=l=>{const f=Math.max(l.startIndex-l.overscan,0),m=Math.min(l.endIndex+l.overscan,l.count-1),v=[];for(let _=f;_<=m;_++)v.push(_);return v},u=(l,f)=>{const m=l.scrollElement;if(!m)return;const v=l.targetWindow;if(!v)return;const _=C=>{const{width:O,height:x}=C;f({width:Math.round(O),height:Math.round(x)})};if(_(g(m)),!v.ResizeObserver)return()=>{};const S=new v.ResizeObserver(C=>{const O=()=>{const x=C[0];if(x!=null&&x.borderBoxSize){const N=x.borderBoxSize[0];if(N){_({width:N.inlineSize,height:N.blockSize});return}}_(g(m))};l.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(O):O()});return S.observe(m,{box:"border-box"}),()=>{S.unobserve(m)}},r={passive:!0},s=(l,f)=>{const m=l.scrollElement;if(!m)return;const v=()=>{f({width:m.innerWidth,height:m.innerHeight})};return v(),m.addEventListener("resize",v,r),()=>{m.removeEventListener("resize",v)}},i=typeof window>"u"?!0:"onscrollend"in window,n=(l,f)=>{const m=l.scrollElement;if(!m)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&i?()=>{}:c.debounce(v,()=>{f(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{const{horizontal:I,isRtl:R}=l.options;_=I?m.scrollLeft*(R&&-1||1):m.scrollTop,S(),f(_,E)},O=C(!0),x=C(!1);x(),m.addEventListener("scroll",O,r);const N=l.options.useScrollendEvent&&i;return N&&m.addEventListener("scrollend",x,r),()=>{m.removeEventListener("scroll",O),N&&m.removeEventListener("scrollend",x)}},t=(l,f)=>{const m=l.scrollElement;if(!m)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&i?()=>{}:c.debounce(v,()=>{f(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{_=m[l.options.horizontal?"scrollX":"scrollY"],S(),f(_,E)},O=C(!0),x=C(!1);x(),m.addEventListener("scroll",O,r);const N=l.options.useScrollendEvent&&i;return N&&m.addEventListener("scrollend",x,r),()=>{m.removeEventListener("scroll",O),N&&m.removeEventListener("scrollend",x)}},a=(l,f,m)=>{if(f!=null&&f.borderBoxSize){const v=f.borderBoxSize[0];if(v)return Math.round(v[m.options.horizontal?"inlineSize":"blockSize"])}return l[m.options.horizontal?"offsetWidth":"offsetHeight"]},p=(l,{adjustments:f=0,behavior:m},v)=>{var _,S;const C=l+f;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:m})},h=(l,{adjustments:f=0,behavior:m},v)=>{var _,S;const C=l+f;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:m})};class w{constructor(f){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let m=null;const v=()=>m||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:m=new this.targetWindow.ResizeObserver(_=>{_.forEach(S=>{const C=()=>{this._measureElement(S.target,S)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(C):C()})}));return{disconnect:()=>{var _;(_=v())==null||_.disconnect(),m=null},observe:_=>{var S;return(S=v())==null?void 0:S.observe(_,{box:"border-box"})},unobserve:_=>{var S;return(S=v())==null?void 0:S.unobserve(_)}}})(),this.range=null,this.setOptions=m=>{Object.entries(m).forEach(([v,_])=>{typeof _>"u"&&delete m[v]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:d,rangeExtractor:o,onChange:()=>{},measureElement:a,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...m}},this.notify=m=>{var v,_;(_=(v=this.options).onChange)==null||_.call(v,this,m)},this.maybeNotify=c.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),m=>{this.notify(m)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(m=>m()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var m;const v=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==v){if(this.cleanup(),!v){this.maybeNotify();return}this.scrollElement=v,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((m=this.scrollElement)==null?void 0:m.window)??null,this.elementsCache.forEach(_=>{this.observer.observe(_)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,_=>{this.scrollRect=_,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(_,S)=>{this.scrollAdjustments=0,this.scrollDirection=S?this.getScrollOffset()<_?"forward":"backward":null,this.scrollOffset=_,this.isScrolling=S,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(m,v)=>{const _=new Map,S=new Map;for(let C=v-1;C>=0;C--){const O=m[C];if(_.has(O.lane))continue;const x=S.get(O.lane);if(x==null||O.end>x.end?S.set(O.lane,O):O.end<x.end&&_.set(O.lane,!0),_.size===this.options.lanes)break}return S.size===this.options.lanes?Array.from(S.values()).sort((C,O)=>C.end===O.end?C.index-O.index:C.end-O.end)[0]:void 0},this.getMeasurementOptions=c.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(m,v,_,S,C)=>(this.pendingMeasuredCacheIndexes=[],{count:m,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C}),{key:!1}),this.getMeasurements=c.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:m,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C},O)=>{if(!C)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(E=>{this.itemSizeCache.set(E.key,E.size)}));const x=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const N=this.measurementsCache.slice(0,x);for(let E=x;E<m;E++){const I=S(E),R=this.options.lanes===1?N[E-1]:this.getFurthestMeasurement(N,E),M=R?R.end+this.options.gap:v+_,P=O.get(I),A=typeof P=="number"?P:this.options.estimateSize(E),D=M+A,z=R?R.lane:E%this.options.lanes;N[E]={index:E,start:M,size:A,end:D,key:I,lane:z}}return this.measurementsCache=N,N},{key:!1,debug:()=>this.options.debug}),this.calculateRange=c.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(m,v,_,S)=>this.range=m.length>0&&v>0?y({measurements:m,outerSize:v,scrollOffset:_,lanes:S}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=c.memo(()=>{let m=null,v=null;const _=this.calculateRange();return _&&(m=_.startIndex,v=_.endIndex),this.maybeNotify.updateDeps([this.isScrolling,m,v]),[this.options.rangeExtractor,this.options.overscan,this.options.count,m,v]},(m,v,_,S,C)=>S===null||C===null?[]:m({startIndex:S,endIndex:C,overscan:v,count:_}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=m=>{const v=this.options.indexAttribute,_=m.getAttribute(v);return _?parseInt(_,10):(console.warn(`Missing attribute name '${v}={index}' on measured element.`),-1)},this._measureElement=(m,v)=>{const _=this.indexFromElement(m),S=this.measurementsCache[_];if(!S)return;const C=S.key,O=this.elementsCache.get(C);O!==m&&(O&&this.observer.unobserve(O),this.observer.observe(m),this.elementsCache.set(C,m)),m.isConnected&&this.resizeItem(_,this.options.measureElement(m,v,this))},this.resizeItem=(m,v)=>{const _=this.measurementsCache[m];if(!_)return;const S=this.itemSizeCache.get(_.key)??_.size,C=v-S;C!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(_,C,this):_.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=C,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(_.index),this.itemSizeCache=new Map(this.itemSizeCache.set(_.key,v)),this.notify(!1))},this.measureElement=m=>{if(!m){this.elementsCache.forEach((v,_)=>{v.isConnected||(this.observer.unobserve(v),this.elementsCache.delete(_))});return}this._measureElement(m,void 0)},this.getVirtualItems=c.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(m,v)=>{const _=[];for(let S=0,C=m.length;S<C;S++){const O=m[S],x=v[O];_.push(x)}return _},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=m=>{const v=this.getMeasurements();if(v.length!==0)return c.notUndefined(v[b(0,v.length-1,_=>c.notUndefined(v[_]).start,m)])},this.getOffsetForAlignment=(m,v,_=0)=>{const S=this.getSize(),C=this.getScrollOffset();v==="auto"&&(v=m>=C+S?"end":"start"),v==="center"?m+=(_-S)/2:v==="end"&&(m-=S);const O=this.getTotalSize()-S;return Math.max(Math.min(O,m),0)},this.getOffsetForIndex=(m,v="auto")=>{m=Math.max(0,Math.min(m,this.options.count-1));const _=this.measurementsCache[m];if(!_)return;const S=this.getSize(),C=this.getScrollOffset();if(v==="auto")if(_.end>=C+S-this.options.scrollPaddingEnd)v="end";else if(_.start<=C+this.options.scrollPaddingStart)v="start";else return[C,v];const O=v==="end"?_.end+this.options.scrollPaddingEnd:_.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(O,v,_.size),v]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(m,{align:v="start",behavior:_}={})=>{this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(m,v),{adjustments:void 0,behavior:_})},this.scrollToIndex=(m,{align:v="auto",behavior:_}={})=>{m=Math.max(0,Math.min(m,this.options.count-1)),this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const S=this.getOffsetForIndex(m,v);if(!S)return;const[C,O]=S;this._scrollToOffset(C,{adjustments:void 0,behavior:_}),_!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(m))){const[N]=c.notUndefined(this.getOffsetForIndex(m,O)),E=this.getScrollOffset();c.approxEqual(N,E)||this.scrollToIndex(m,{align:O,behavior:_})}else this.scrollToIndex(m,{align:O,behavior:_})}))},this.scrollBy=(m,{behavior:v}={})=>{this.cancelScrollToIndex(),v==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+m,{adjustments:void 0,behavior:v})},this.getTotalSize=()=>{var m;const v=this.getMeasurements();let _;if(v.length===0)_=this.options.paddingStart;else if(this.options.lanes===1)_=((m=v[v.length-1])==null?void 0:m.end)??0;else{const S=Array(this.options.lanes).fill(null);let C=v.length-1;for(;C>=0&&S.some(O=>O===null);){const O=v[C];S[O.lane]===null&&(S[O.lane]=O.end),C--}_=Math.max(...S.filter(O=>O!==null))}return Math.max(_-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(m,{adjustments:v,behavior:_})=>{this.options.scrollToFn(m,{behavior:_,adjustments:v},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(f)}}const b=(l,f,m,v)=>{for(;l<=f;){const _=(l+f)/2|0,S=m(_);if(S<v)l=_+1;else if(S>v)f=_-1;else return _}return l>0?l-1:0};function y({measurements:l,outerSize:f,scrollOffset:m,lanes:v}){const _=l.length-1,S=x=>l[x].start;if(l.length<=v)return{startIndex:0,endIndex:_};let C=b(0,_,S,m),O=C;if(v===1)for(;O<_&&l[O].end<m+f;)O++;else if(v>1){const x=Array(v).fill(0);for(;O<_&&x.some(E=>E<m+f);){const E=l[O];x[E.lane]=E.end,O++}const N=Array(v).fill(m+f);for(;C>=0&&N.some(E=>E>=m);){const E=l[C];N[E.lane]=E.start,C--}C=Math.max(0,C-C%v),O=Math.min(_,O+(v-1-O%v))}return{startIndex:C,endIndex:O}}e.approxEqual=c.approxEqual,e.debounce=c.debounce,e.memo=c.memo,e.notUndefined=c.notUndefined,e.Virtualizer=w,e.defaultKeyExtractor=d,e.defaultRangeExtractor=o,e.elementScroll=h,e.measureElement=a,e.observeElementOffset=n,e.observeElementRect=u,e.observeWindowOffset=t,e.observeWindowRect=s,e.windowScroll=p}(ri)),ri}var vo;function zf(){return vo||(vo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const c=de(),g=Hc(),d=$f();function o(t){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const p in t)if(p!=="default"){const h=Object.getOwnPropertyDescriptor(t,p);Object.defineProperty(a,p,h.get?h:{enumerable:!0,get:()=>t[p]})}}return a.default=t,Object.freeze(a)}const u=o(c),r=typeof document<"u"?u.useLayoutEffect:u.useEffect;function s(t){const a=u.useReducer(()=>({}),{})[1],p={...t,onChange:(w,b)=>{var y;b?g.flushSync(a):a(),(y=t.onChange)==null||y.call(t,w,b)}},[h]=u.useState(()=>new d.Virtualizer(p));return h.setOptions(p),r(()=>h._didMount(),[]),r(()=>h._willUpdate()),h}function i(t){return s({observeElementRect:d.observeElementRect,observeElementOffset:d.observeElementOffset,scrollToFn:d.elementScroll,...t})}function n(t){return s({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:d.observeWindowRect,observeElementOffset:d.observeWindowOffset,scrollToFn:d.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...t})}e.useVirtualizer=i,e.useWindowVirtualizer=n,Object.keys(d).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:()=>d[t]})})}(ni)),ni}var bt={},wo;function Gf(){if(wo)return bt;wo=1;var e=bt&&bt.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(bt,"__esModule",{value:!0}),bt.Cell=void 0;const c=e(de()),g=e(zt()),d=({children:o,gutter:u,stickyRight:r,active:s,disabled:i,className:n,width:t,left:a})=>c.default.createElement("div",{className:(0,g.default)("dsg-cell",u&&"dsg-cell-gutter",i&&"dsg-cell-disabled",u&&s&&"dsg-cell-gutter-active",r&&"dsg-cell-sticky-right",n),style:{width:t,left:r?void 0:a}},o);return bt.Cell=d,bt}var rn={},_o;function Wf(){if(_o)return rn;_o=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.useMemoizedIndexCallback=void 0;const e=de(),c=(g,d)=>(0,e.useMemo)(()=>{const o=new Map;return u=>(o.has(u)||o.set(u,(...r)=>{g(u,...r.slice(0,d))}),o.get(u))},[d,g]);return rn.useMemoizedIndexCallback=c,rn}var So;function Hf(){if(So)return Ve;So=1;var e=Ve&&Ve.__createBinding||(Object.create?function(t,a,p,h){h===void 0&&(h=p);var w=Object.getOwnPropertyDescriptor(a,p);(!w||("get"in w?!a.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return a[p]}}),Object.defineProperty(t,h,w)}:function(t,a,p,h){h===void 0&&(h=p),t[h]=a[p]}),c=Ve&&Ve.__setModuleDefault||(Object.create?function(t,a){Object.defineProperty(t,"default",{enumerable:!0,value:a})}:function(t,a){t.default=a}),g=Ve&&Ve.__importStar||function(t){if(t&&t.__esModule)return t;var a={};if(t!=null)for(var p in t)p!=="default"&&Object.prototype.hasOwnProperty.call(t,p)&&e(a,t,p);return c(a,t),a},d=Ve&&Ve.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.Grid=void 0;const o=zf(),u=g(de()),r=d(zt()),s=Gf(),i=Wf(),n=({data:t,columns:a,outerRef:p,innerRef:h,columnWidths:w,hasStickyRightColumn:b,displayHeight:y,headerRowHeight:l,rowHeight:f,rowKey:m,fullWidth:v,selection:_,activeCell:S,rowClassName:C,cellClassName:O,children:x,editing:N,getContextMenuItems:E,setRowData:I,deleteRows:R,duplicateRows:M,insertRowAfter:P,stopEditing:A,onScroll:D})=>{var z,$,X,Z;const K=(0,o.useVirtualizer)({count:t.length,getScrollElement:()=>p.current,paddingStart:l,estimateSize:H=>f(H).height,getItemKey:H=>{if(m&&H>0){const fe=t[H-1];if(typeof m=="function")return m({rowData:fe,rowIndex:H});if(typeof m=="string"&&fe instanceof Object&&m in fe){const he=fe[m];if(typeof he=="string"||typeof he=="number")return he}}return H},overscan:5}),Q=(0,o.useVirtualizer)({count:a.length,getScrollElement:()=>p.current,estimateSize:H=>{var fe;return(fe=w==null?void 0:w[H])!==null&&fe!==void 0?fe:100},horizontal:!0,getItemKey:H=>{var fe;return(fe=a[H].id)!==null&&fe!==void 0?fe:H},overscan:1,rangeExtractor:H=>{const fe=(0,o.defaultRangeExtractor)(H);return fe[0]!==0&&fe.unshift(0),b&&fe[fe.length-1]!==a.length-1&&fe.push(a.length-1),fe}});(0,u.useEffect)(()=>{Q.measure()},[Q,w]);const be=(0,i.useMemoizedIndexCallback)(I,1),Ke=(0,i.useMemoizedIndexCallback)(R,0),st=(0,i.useMemoizedIndexCallback)(M,0),ge=(0,i.useMemoizedIndexCallback)(P,0),ot=(z=_==null?void 0:_.min.col)!==null&&z!==void 0?z:S==null?void 0:S.col,at=($=_==null?void 0:_.max.col)!==null&&$!==void 0?$:S==null?void 0:S.col,It=(X=_==null?void 0:_.min.row)!==null&&X!==void 0?X:S==null?void 0:S.row,Wt=(Z=_==null?void 0:_.max.row)!==null&&Z!==void 0?Z:S==null?void 0:S.row;return u.default.createElement("div",{ref:p,className:"dsg-container",onScroll:D,style:{height:y}},u.default.createElement("div",{ref:h,style:{width:v?"100%":Q.getTotalSize(),height:K.getTotalSize()}},l>0&&u.default.createElement("div",{className:(0,r.default)("dsg-row","dsg-row-header"),style:{width:v?"100%":Q.getTotalSize(),height:l}},Q.getVirtualItems().map(H=>u.default.createElement(s.Cell,{key:H.key,gutter:H.index===0,stickyRight:b&&H.index===a.length-1,width:H.size,left:H.start,className:(0,r.default)("dsg-cell-header",ot!==void 0&&at!==void 0&&ot<=H.index-1&&at>=H.index-1&&"dsg-cell-header-active",a[H.index].headerClassName)},u.default.createElement("div",{className:"dsg-cell-header-container"},a[H.index].title)))),K.getVirtualItems().map(H=>{const fe=H.index>=(It??1/0)&&H.index<=(Wt??-1/0);return u.default.createElement("div",{key:H.key,className:(0,r.default)("dsg-row",typeof C=="string"?C:null,typeof C=="function"?C({rowData:t[H.index],rowIndex:H.index}):null),style:{height:H.size,top:H.start,width:v?"100%":Q.getTotalSize()}},Q.getVirtualItems().map(he=>{const kt=a[he.index].cellClassName,jt=a[he.index].disabled,Br=a[he.index].component,yr=jt===!0||typeof jt=="function"&&jt({rowData:t[H.index],rowIndex:H.index}),vr=(S==null?void 0:S.row)===H.index&&S.col===he.index-1;return u.default.createElement(s.Cell,{key:he.key,gutter:he.index===0,stickyRight:b&&he.index===a.length-1,active:he.index===0&&fe,disabled:yr,className:(0,r.default)(typeof kt=="function"?kt({rowData:t[H.index],rowIndex:H.index,columnId:a[he.index].id}):kt,typeof O=="function"?O({rowData:t[H.index],rowIndex:H.index,columnId:a[he.index].id}):O),width:he.size,left:he.start},u.default.createElement(Br,{rowData:t[H.index],getContextMenuItems:E,disabled:yr,active:vr,columnIndex:he.index-1,rowIndex:H.index,focus:vr&&N,deleteRow:Ke(H.index),duplicateRow:st(H.index),stopEditing:A,insertRowBelow:ge(H.index),setRowData:be(H.index),columnData:a[he.index].columnData}))}))}),x))};return Ve.Grid=n,Ve}var ze={},xo;function Jf(){return xo||(xo=1,function(e){var c=ze&&ze.__createBinding||(Object.create?function(n,t,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(t,a);(!h||("get"in h?!t.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(n,p,h)}:function(n,t,a,p){p===void 0&&(p=a),n[p]=t[a]}),g=ze&&ze.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),d=ze&&ze.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var a in n)a!=="default"&&Object.prototype.hasOwnProperty.call(n,a)&&c(t,n,a);return g(t,n),t},o=ze&&ze.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRect=void 0;const u=d(de()),r=o(zt()),s=(n,t,a,p)=>[[p,n],[t,n],[t,a],[p,a],[p,n]],i=(n,t,a,p)=>`polygon(evenodd, ${[...s(0,"100%","100%",0),...s(n,t,a,p)].map(w=>w.map(b=>typeof b=="number"&&b!==0?b+"px":b).join(" ")).join(",")})`;e.SelectionRect=u.default.memo(({columnWidths:n,columnRights:t,headerRowHeight:a,selection:p,rowHeight:h,activeCell:w,hasStickyRightColumn:b,dataLength:y,viewWidth:l,viewHeight:f,contentWidth:m,edges:v,isCellDisabled:_,editing:S,expandSelection:C})=>{var O,x,N,E;const I=w?_(w):!1,R=(0,u.useMemo)(()=>{if(!p)return I;for(let K=p.min.col;K<=p.max.col;++K)for(let Q=p.min.row;Q<=p.max.row;++Q)if(!_({col:K,row:Q}))return!1;return!0},[I,_,p]);if(!n||!t)return null;const M=K=>K<y-1?1:0,P=K=>K<n.length-(b?3:2)?1:0,A=w&&{width:n[w.col+1]+P(w.col),height:h(w.row).height+M(w.row),left:t[w.col],top:h(w.row).top+a},D=p&&{width:n.slice(p.min.col+1,p.max.col+2).reduce((K,Q)=>K+Q)+P(p.max.col),height:h(p.max.row).top+h(p.max.row).height-h(p.min.row).top+M(p.max.row),left:t[p.min.col],top:h(p.min.row).top+a},z=(p==null?void 0:p.min)||w,$=(p==null?void 0:p.max)||w,X=$&&C!==null&&{left:t[$.col]+n[$.col+1],top:h($.row).top+h($.row).height+a,transform:`translate(-${$.col<n.length-(b?3:2)?50:100}%, -${$.row<y-1?50:100}%)`},Z=z&&$&&C!==null&&{width:n.slice(z.col+1,$.col+2).reduce((K,Q)=>K+Q)+P($.col),height:h($.row+C).top+h($.row+C).height-h($.row+1).top+M($.row+C)-1,left:t[z.col],top:h($.row).top+h($.row).height+a+1};return u.default.createElement(u.default.Fragment,null,u.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:h(y-1).top+h(y-1).height+a,width:m||"100%"}},u.default.createElement("div",{className:(0,r.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!v.top,"dsg-scrollable-view-r":!v.right,"dsg-scrollable-view-b":!v.bottom,"dsg-scrollable-view-l":!v.left}),style:{top:a,left:n[0],height:f?f-a:0,width:m&&l?l-n[0]-(b?n[n.length-1]:0):`calc(100% - ${n[0]+(b?n[n.length-1]:0)}px)`}})),(D||A)&&u.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(O=D==null?void 0:D.left)!==null&&O!==void 0?O:A==null?void 0:A.left,width:(x=D==null?void 0:D.width)!==null&&x!==void 0?x:A==null?void 0:A.width,height:h(y-1).top+h(y-1).height+a}},u.default.createElement("div",{className:(0,r.default)("dsg-selection-col-marker",R&&"dsg-selection-col-marker-disabled"),style:{top:a}})),(D||A)&&u.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(N=D==null?void 0:D.top)!==null&&N!==void 0?N:A==null?void 0:A.top,height:(E=D==null?void 0:D.height)!==null&&E!==void 0?E:A==null?void 0:A.height,width:m||"100%"}},u.default.createElement("div",{className:(0,r.default)("dsg-selection-row-marker",R&&"dsg-selection-row-marker-disabled"),style:{left:n[0]}})),A&&w&&u.default.createElement("div",{className:(0,r.default)("dsg-active-cell",{"dsg-active-cell-focus":S,"dsg-active-cell-disabled":I}),style:A}),D&&A&&u.default.createElement("div",{className:(0,r.default)("dsg-selection-rect",R&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},D),{clipPath:i(A.top-D.top,A.left-D.left,A.top+A.height-D.top,A.left+A.width-D.left)})}),Z&&u.default.createElement("div",{className:(0,r.default)("dsg-expand-rows-rect"),style:Z}),X&&u.default.createElement("div",{className:(0,r.default)("dsg-expand-rows-indicator",R&&"dsg-expand-rows-indicator-disabled"),style:X}))}),e.SelectionRect.displayName="SelectionRect"}(ze)),ze}var sn={},Co;function Kf(){if(Co)return sn;Co=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.useRowHeights=void 0;const e=de(),c=({value:g,rowHeight:d})=>{const o=(0,e.useRef)([]),[,u]=(0,e.useState)(0);return(0,e.useMemo)(()=>{const r=s=>{if(typeof d=="number")return Math.min(g.length-1,Math.max(-1,Math.floor(s/d)));let i=0,n=o.current.length-1;for(;i<=n;){const t=Math.floor((i+n)/2);if(o.current[t].top<s)i=t+1;else if(o.current[t].top>s)n=t-1;else return t}if(n===o.current.length-1&&g.length>o.current.length&&(!o.current.length||s>=o.current[n].top+o.current[n].height)){let t=n===-1?0:o.current[n].top+o.current[n].height;do{n++;const a=d({rowIndex:n,rowData:g[n]});o.current.push({height:a,top:t}),t+=a}while(t<=s&&n<o.current.length-1)}return n};return{resetAfter:s=>{o.current=o.current.slice(0,s),u(i=>i+1)},getRowSize:s=>{if(typeof d=="number")return{height:d,top:d*s};if(s>=g.length)return{height:0,top:0};if(s<o.current.length)return o.current[s];let i=o.current[o.current.length-1].top+o.current[o.current.length-1].height;for(let n=o.current.length;n<=s;n++){const t=d({rowIndex:n,rowData:g[n]});o.current.push({height:t,top:i}),i+=t}return o.current[s]},getRowIndex:r,totalSize:s=>{if(typeof d=="number")return g.length*d;const i=r(s);return o.current[i].top+o.current[i].height}}},[d,g])};return sn.useRowHeights=c,sn}var Oo;function Cu(){return Oo||(Oo=1,function(e){var c=je&&je.__createBinding||(Object.create?function(R,M,P,A){A===void 0&&(A=P);var D=Object.getOwnPropertyDescriptor(M,P);(!D||("get"in D?!M.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return M[P]}}),Object.defineProperty(R,A,D)}:function(R,M,P,A){A===void 0&&(A=P),R[A]=M[P]}),g=je&&je.__setModuleDefault||(Object.create?function(R,M){Object.defineProperty(R,"default",{enumerable:!0,value:M})}:function(R,M){R.default=M}),d=je&&je.__importStar||function(R){if(R&&R.__esModule)return R;var M={};if(R!=null)for(var P in R)P!=="default"&&Object.prototype.hasOwnProperty.call(R,P)&&c(M,R,P);return g(M,R),M},o=je&&je.__awaiter||function(R,M,P,A){function D(z){return z instanceof P?z:new P(function($){$(z)})}return new(P||(P=Promise))(function(z,$){function X(Q){try{K(A.next(Q))}catch(be){$(be)}}function Z(Q){try{K(A.throw(Q))}catch(be){$(be)}}function K(Q){Q.done?z(Q.value):D(Q.value).then(X,Z)}K((A=A.apply(R,M||[])).next())})},u=je&&je.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(e,"__esModule",{value:!0}),e.DataSheetGrid=void 0;const r=d(de()),s=Cd(),i=Vf,n=Af(),t=Pf(),a=wu(),p=_u(),h=Mf(),w=Su(),b=qf(),y=u(nu()),l=xu(),f=Bf(),m=Ff(),v=Lf(),_=Hf(),S=Jf(),C=Kf(),O=[],x=[],N=()=>({}),E=()=>null,I=({rowData:R})=>Object.assign({},R);e.DataSheetGrid=r.default.memo(r.default.forwardRef(({value:R=O,className:M,style:P,height:A=400,onChange:D=E,columns:z=x,rowHeight:$=40,headerRowHeight:X=typeof $=="number"?$:40,gutterColumn:Z,stickyRightColumn:K,rowKey:Q,addRowsComponent:be=w.AddRows,createRow:Ke=N,autoAddRow:st=!1,lockRows:ge=!1,disableExpandSelection:ot=!1,disableSmartDelete:at=!1,duplicateRow:It=I,contextMenuComponent:Wt=l.ContextMenu,disableContextMenu:H=!1,onFocus:fe=E,onBlur:he=E,onActiveCellChange:kt=E,onSelectionChange:jt=E,rowClassName:Br,cellClassName:yr,onScroll:vr},Ku)=>{var Fr,Lr,Ur,$r,zr,Gr;const Vt=(0,r.useRef)(null),Ss=H||ge,G=(0,n.useColumns)(z,Z,K),oe=!!K,wr=(0,r.useRef)(null),Le=(0,r.useRef)(null),Wr=(0,r.useRef)(null),Hr=(0,r.useRef)(null),[Yu,Xu]=(0,b.useDebounceState)(1,100),{getRowSize:At,totalSize:Qu,getRowIndex:xs}=(0,C.useRowHeights)({value:R,rowHeight:$}),Cs=Math.min(A,X+Qu(A)+Yu),{width:Pt,height:pt}=(0,i.useResizeDetector)({targetRef:Le,refreshMode:"throttle",refreshRate:100});Xu(pt?Cs-pt:0);const Zu=(0,t.useEdges)(Le,Pt,pt),{fullWidth:Os,totalWidth:ec,columnWidths:qe,columnRights:Ue}=(0,s.useColumnWidths)(G,Pt),[Mt,De]=(0,r.useState)(null),[qt,tc]=(0,r.useState)([]),[ae,ye]=(0,r.useState)(!1),[Dt,Rs]=(0,r.useState)(0),[Bt,Ns]=(0,r.useState)(null),[k,ie]=(0,a.useDeepEqualState)(null),[ve,te]=(0,a.useDeepEqualState)(null),j=(0,r.useMemo)(()=>k&&ve&&{min:{col:Math.min(k.col,ve.col),row:Math.min(k.row,ve.row)},max:{col:Math.max(k.col,ve.col),row:Math.max(k.row,ve.row)}},[k,ve]),[Xe,Ft]=(0,a.useDeepEqualState)({columns:!1,rows:!1,active:!1}),nc=ot||ae||Xe.active||(k==null?void 0:k.row)===(R==null?void 0:R.length)-1||(j==null?void 0:j.max.row)===(R==null?void 0:R.length)-1||k&&G.slice(((Fr=j==null?void 0:j.min.col)!==null&&Fr!==void 0?Fr:k.col)+1,((Lr=j==null?void 0:j.max.col)!==null&&Lr!==void 0?Lr:k.col)+2).every(T=>T.disabled===!0)?null:Dt,Es=(0,h.useGetBoundingClientRect)(wr),Ts=(0,h.useGetBoundingClientRect)(Le);(0,r.useEffect)(()=>{var T;k!==null&&(document.activeElement.blur(),(T=window.getSelection())===null||T===void 0||T.removeAllRanges())},[k!==null]);const mt=(0,r.useCallback)((T,B=!1,F=!1)=>{const q=Es(B),W=F&&Ts(B);if(q&&Ue&&qe){let ne=T.clientX-q.left,L=T.clientY-q.top;return W&&(T.clientY-W.top<=X&&(L=0),T.clientX-W.left<=qe[0]&&(ne=0),oe&&W.right-T.clientX<=qe[qe.length-1]&&(ne=Ue[Ue.length-2]+1)),{col:Ue.findIndex(Y=>ne<Y)-1,row:xs(L-X)}}return null},[Ue,qe,R.length,Es,Ts,X,oe,xs]),Ee=(0,r.useRef)(R);Ee.current=R;const Te=(0,r.useCallback)(T=>{const B=G[T.col+1].disabled;return!!(typeof B=="function"?B({rowData:Ee.current[T.row],rowIndex:T.row}):B)},[G]),Qe=(0,r.useCallback)((T,B=1)=>{ge||(te(null),ye(!1),D([...Ee.current.slice(0,T+1),...new Array(B).fill(0).map(Ke),...Ee.current.slice(T+1)],[{type:"CREATE",fromRowIndex:T+1,toRowIndex:T+1+B}]),ie(F=>({col:(F==null?void 0:F.col)||0,row:T+B,doNotScrollX:!0})))},[Ke,ge,D,ie,te]),Lt=(0,r.useCallback)((T,B=T)=>{ge||(D([...Ee.current.slice(0,B+1),...Ee.current.slice(T,B+1).map((F,q)=>It({rowData:F,rowIndex:q+T})),...Ee.current.slice(B+1)],[{type:"CREATE",fromRowIndex:B+1,toRowIndex:B+2+B-T}]),ie({col:0,row:B+1,doNotScrollX:!0}),te({col:G.length-(oe?3:2),row:2*B-T+1,doNotScrollX:!0}),ye(!1))},[G.length,It,ge,D,ie,te,oe]),Ze=(0,r.useCallback)(T=>{if(!(!pt||!Pt)){if(!T.doNotScrollY){const B=At(T.row).top,F=At(T.row).top+At(T.row).height+X-pt+1,q=Le.current.scrollTop;q>B?Le.current.scrollTop=B:q<F&&(Le.current.scrollTop=F)}if(Ue&&qe&&Le.current&&!T.doNotScrollX){const B=Ue[T.col]-Ue[0],F=Ue[T.col]+qe[T.col+1]+(oe?qe[qe.length-1]:0)-Pt+1,q=Le.current.scrollLeft;q>B?Le.current.scrollLeft=B:q<F&&(Le.current.scrollLeft=F)}}},[pt,Pt,X,Ue,qe,At,oe]);(0,r.useEffect)(()=>{ve&&Ze(ve)},[ve,Ze]),(0,r.useEffect)(()=>{k&&Ze(k)},[k,Ze]);const rc=(0,r.useCallback)((T,B)=>{var F,q;D([...(F=Ee.current)===null||F===void 0?void 0:F.slice(0,T),B,...(q=Ee.current)===null||q===void 0?void 0:q.slice(T+1)],[{type:"UPDATE",fromRowIndex:T,toRowIndex:T+1}])},[D]),Ut=(0,r.useCallback)((T,B=T)=>{ge||(ye(!1),ie(F=>{const q=Math.min(Ee.current.length-2-B+T,T);return q<0?null:F&&{col:F.col,row:q}}),te(null),D([...Ee.current.slice(0,T),...Ee.current.slice(B+1)],[{type:"DELETE",fromRowIndex:T,toRowIndex:B+1}]))},[ge,D,ie,te]),_r=(0,r.useCallback)((T=!0)=>{const B=T&&!at;if(!k)return;const F=(j==null?void 0:j.min)||k,q=(j==null?void 0:j.max)||k;if(R.slice(F.row,q.row+1).every((ne,L)=>G.every(Y=>Y.isCellEmpty({rowData:ne,rowIndex:L+F.row})))){B&&Ut(F.row,q.row);return}const W=[...R];for(let ne=F.row;ne<=q.row;++ne)for(let L=F.col;L<=q.col;++L)if(!Te({col:L,row:ne})){const{deleteValue:Y=({rowData:se})=>se}=G[L+1];W[ne]=Y({rowData:W[ne],rowIndex:ne})}if(B&&(0,y.default)(W,R)){ie({col:0,row:F.row,doNotScrollX:!0}),te({col:G.length-(oe?3:2),row:q.row,doNotScrollX:!0});return}D(W,[{type:"UPDATE",fromRowIndex:F.row,toRowIndex:q.row+1}])},[k,G,R,Ut,Te,D,j==null?void 0:j.max,j==null?void 0:j.min,ie,te,oe]),Jr=(0,r.useCallback)(({nextRow:T=!0}={})=>{(k==null?void 0:k.row)===Ee.current.length-1?T&&st?Qe(k.row):ye(!1):(ye(!1),T&&ie(B=>B&&{col:B.col,row:B.row+1}))},[k==null?void 0:k.row,st,Qe,ie]),Ht=(0,r.useCallback)(T=>o(void 0,void 0,void 0,function*(){var B,F;if(!ae&&k){const q=[],W=(j==null?void 0:j.min)||k,ne=(j==null?void 0:j.max)||k;for(let J=W.row;J<=ne.row;++J){q.push([]);for(let le=W.col;le<=ne.col;++le){const{copyValue:ce=()=>null}=G[le+1];q[J-W.row].push(ce({rowData:R[J],rowIndex:J}))}}const L=q.map(J=>J.join("	")).join(`
`),Y=`<table>${q.map(J=>`<tr>${J.map(le=>`<td>${(0,f.encodeHtml)(String(le??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(T!==void 0){(B=T.clipboardData)===null||B===void 0||B.setData("text/plain",L),(F=T.clipboardData)===null||F===void 0||F.setData("text/html",Y),T.preventDefault();return}let se=!1;if(navigator.clipboard.write!==void 0){const J=new Blob([L],{type:"text/plain"}),le=new Blob([Y],{type:"text/html"}),ce=[new ClipboardItem({"text/plain":J,"text/html":le})];yield navigator.clipboard.write(ce).then(()=>{se=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(L).then(()=>{se=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(se=!0);se||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[k,G,R,ae,j]);(0,p.useDocumentEventListener)("copy",Ht);const Kr=(0,r.useCallback)(T=>{!ae&&k&&(Ht(T),_r(!1))},[k,_r,ae,Ht]);(0,p.useDocumentEventListener)("cut",Kr);const Jt=(0,r.useCallback)(T=>o(void 0,void 0,void 0,function*(){var B,F;if(!ae&&k){const q=(j==null?void 0:j.min)||k,W=(j==null?void 0:j.max)||k,ne=yield Promise.all(T[0].map((L,Y)=>{var se,J;const le=(se=G[q.col+Y+1])===null||se===void 0?void 0:se.prePasteValues,ce=T.map(Ie=>Ie[Y]);return(J=le==null?void 0:le(ce))!==null&&J!==void 0?J:ce}));if(T=T.map((L,Y)=>ne.map(se=>se[Y])),T.length===1){const L=[...R];for(let Y=0;Y<T[0].length;Y++){const se=(B=G[q.col+Y+1])===null||B===void 0?void 0:B.pasteValue;if(se)for(let J=q.row;J<=W.row;J++)Te({col:Y+q.col,row:J})||(L[J]=yield se({rowData:L[J],value:T[0][Y],rowIndex:J}))}D(L,[{type:"UPDATE",fromRowIndex:q.row,toRowIndex:W.row+1}]),ie({col:q.col,row:q.row}),te({col:Math.min(q.col+T[0].length-1,G.length-(oe?3:2)),row:W.row})}else{let L=[...R];const Y=q.row+T.length-R.length;Y>0&&(ge?T.splice(T.length-Y,Y):L=[...L,...new Array(Y).fill(0).map(()=>Ke())]);for(let J=0;J<T[0].length&&q.col+J<G.length-(oe?2:1);J++){const le=(F=G[q.col+J+1])===null||F===void 0?void 0:F.pasteValue;if(le)for(let ce=0;ce<T.length;ce++)Te({col:q.col+J,row:q.row+ce})||(L[q.row+ce]=yield le({rowData:L[q.row+ce],value:T[ce][J],rowIndex:q.row+ce}))}const se=[{type:"UPDATE",fromRowIndex:q.row,toRowIndex:q.row+T.length-(!ge&&Y>0?Y:0)}];Y>0&&!ge&&se.push({type:"CREATE",fromRowIndex:q.row+T.length-Y,toRowIndex:q.row+T.length}),D(L,se),ie({col:q.col,row:q.row}),te({col:Math.min(q.col+T[0].length-1,G.length-(oe?3:2)),row:q.row+T.length-1})}}}),[k,G,Ke,R,ae,oe,Te,ge,D,j==null?void 0:j.max,j==null?void 0:j.min,ie,te]),ic=(0,r.useCallback)(T=>{var B,F,q,W,ne,L;if(k&&!ae){let Y=[[""]];!((B=T.clipboardData)===null||B===void 0)&&B.types.includes("text/html")?Y=(0,f.parseTextHtmlData)((F=T.clipboardData)===null||F===void 0?void 0:F.getData("text/html")):!((q=T.clipboardData)===null||q===void 0)&&q.types.includes("text/plain")?Y=(0,f.parseTextPlainData)((W=T.clipboardData)===null||W===void 0?void 0:W.getData("text/plain")):!((ne=T.clipboardData)===null||ne===void 0)&&ne.types.includes("text")&&(Y=(0,f.parseTextPlainData)((L=T.clipboardData)===null||L===void 0?void 0:L.getData("text"))),Jt(Y),T.preventDefault()}},[k,Jt,ae]);(0,p.useDocumentEventListener)("paste",ic);const sc=(0,r.useCallback)(T=>{var B,F,q;if(Mt&&qt.length)return;const W=T.button===2||T.button===0&&T.ctrlKey,ne=((B=wr.current)===null||B===void 0?void 0:B.contains(T.target))||!1,L=ne?mt(T,!0,!0):null;if(!ne&&ae&&k&&G[k.col+1].keepFocus)return;if(T.target instanceof HTMLElement&&T.target.className.includes("dsg-expand-rows-indicator")){Ns(Math.max((F=k==null?void 0:k.row)!==null&&F!==void 0?F:0,(q=j==null?void 0:j.max.row)!==null&&q!==void 0?q:0));return}const Y=L&&k&&k.col===L.col&&k.row===L.row&&!Te(k);if(Y&&ae)return;const se=(L==null?void 0:L.col)===G.length-2&&oe,J=W&&j&&L&&L.row>=j.min.row&&L.row<=j.max.row&&L.col>=j.min.col&&L.col<=j.max.col,le=W&&j&&L&&L.row===-1&&L.col>=j.min.col&&L.col<=j.max.col,ce=W&&j&&L&&L.row>=j.min.row&&L.row<=j.max.row&&L.col===-1,Ie=se&&j&&L&&L.row>=j.min.row&&L.row<=j.max.row;if(W&&!Ss&&De({x:T.clientX,y:T.clientY,cursorIndex:L}),(!(T.shiftKey&&k)||W)&&R.length>0&&ie(L&&{col:(J||le)&&k?k.col:Math.max(0,se?0:L.col),row:(J||ce||Ie)&&k?k.row:Math.max(0,L.row),doNotScrollX:!!(J&&k||se||L.col===-1),doNotScrollY:!!(J&&k||L.row===-1)}),Y&&!W&&(Vt.current=k),ye(!!(Y&&!W)),Ft(L&&!W?{columns:L.col!==-1&&!se||!!(T.shiftKey&&k),rows:L.row!==-1||!!(T.shiftKey&&k),active:!0}:{columns:!1,rows:!1,active:!1}),T.shiftKey&&k&&!W)te(L&&{col:Math.max(0,L.col-(se?1:0)),row:Math.max(0,L.row)});else if(!J){if(L&&((L==null?void 0:L.col)===-1||(L==null?void 0:L.row)===-1||se)){let Ce=L.col,ke=L.row,Oe=!1,Be=!1;(L.col===-1||se)&&(Ce=G.length-(oe?3:2),Oe=!0),L.row===-1&&(ke=R.length-1,Be=!0),le&&ve&&(Ce=ve.col,Be=!0),(ce||Ie)&&ve&&(ke=ve.row,Oe=!0),te({col:Ce,row:ke,doNotScrollX:Oe,doNotScrollY:Be})}else te(null);ne&&T.preventDefault()}},[Mt,qt.length,mt,ae,k,G,Te,j,oe,Ss,Ft,ie,te,ve,R.length]);(0,p.useDocumentEventListener)("mousedown",sc);const oc=(0,r.useCallback)(()=>{var T,B,F,q,W,ne,L,Y,se;if(Bt!==null){if(Dt>0&&k){let J=[];const le=(j==null?void 0:j.min)||k,ce=(j==null?void 0:j.max)||k;for(let Ie=le.row;Ie<=ce.row;++Ie){J.push([]);for(let Ce=le.col;Ce<=ce.col;++Ce){const{copyValue:ke=()=>null}=G[Ce+1];J[Ie-le.row].push(String((T=ke({rowData:R[Ie],rowIndex:Ie}))!==null&&T!==void 0?T:""))}}Promise.all(J[0].map((Ie,Ce)=>{var ke,Oe;const Be=(ke=G[le.col+Ce+1])===null||ke===void 0?void 0:ke.prePasteValues,Fe=J.map(dc=>dc[Ce]);return(Oe=Be==null?void 0:Be(Fe))!==null&&Oe!==void 0?Oe:Fe})).then(Ie=>{var Ce;J=J.map((Oe,Be)=>Ie.map(Fe=>Fe[Be]));const ke=[...R];for(let Oe=0;Oe<J[0].length;Oe++){const Be=(Ce=G[le.col+Oe+1])===null||Ce===void 0?void 0:Ce.pasteValue;if(Be)for(let Fe=ce.row+1;Fe<=ce.row+Dt;Fe++)Te({col:Oe+le.col,row:Fe})||(ke[Fe]=Be({rowData:ke[Fe],value:J[(Fe-ce.row-1)%J.length][Oe],rowIndex:Fe}))}D(ke,[{type:"UPDATE",fromRowIndex:ce.row+1,toRowIndex:ce.row+1+Dt}])}),Rs(0),ie({col:Math.min((B=k==null?void 0:k.col)!==null&&B!==void 0?B:1/0,(F=j==null?void 0:j.min.col)!==null&&F!==void 0?F:1/0),row:Math.min((q=k==null?void 0:k.row)!==null&&q!==void 0?q:1/0,(W=j==null?void 0:j.min.row)!==null&&W!==void 0?W:1/0),doNotScrollX:!0,doNotScrollY:!0}),te({col:Math.max((ne=k==null?void 0:k.col)!==null&&ne!==void 0?ne:0,(L=j==null?void 0:j.max.col)!==null&&L!==void 0?L:0),row:Math.max((Y=k==null?void 0:k.row)!==null&&Y!==void 0?Y:0,(se=j==null?void 0:j.max.row)!==null&&se!==void 0?se:0)+Dt})}Ns(null)}Ft({columns:!1,rows:!1,active:!1})},[Bt,Ft,Dt,k,j==null?void 0:j.min,j==null?void 0:j.max,R,D,ie,te,G,Te]);(0,p.useDocumentEventListener)("mouseup",oc);const ac=(0,r.useCallback)(T=>{if(Bt!==null){const B=mt(T);B&&(Rs(Math.max(0,B.row-Bt)),Ze({col:B.col,row:Math.max(B.row,Bt)}))}if(Xe.active){const B=mt(T),F=G.length-(oe?3:2);te(B&&{col:Xe.columns?Math.max(0,Math.min(F,B.col)):F,row:Xe.rows?Math.max(0,B.row):R.length-1,doNotScrollX:!Xe.columns,doNotScrollY:!Xe.rows}),ye(!1)}},[Ze,Xe.active,Xe.columns,Xe.rows,mt,G.length,oe,te,R.length,Bt]);(0,p.useDocumentEventListener)("mousemove",ac);const lc=(0,r.useCallback)(T=>{var B;if(k&&!T.isComposing){if(T.key==="Tab"&&!T.shiftKey&&k.col===G.length-(oe?3:2)&&!G[k.col+1].disableKeys)if(k.row===R.length-1){if(Hr.current){T.preventDefault(),ie(null),te(null),ye(!1);const F=(0,v.getAllTabbableElements)(),q=F.indexOf(Hr.current);F[(q+1)%F.length].focus();return}}else{ie(F=>{var q;return{col:0,row:((q=F==null?void 0:F.row)!==null&&q!==void 0?q:0)+1}}),te(null),ye(!1),T.preventDefault();return}if(T.key==="Tab"&&T.shiftKey&&k.col===0&&!G[k.col+1].disableKeys)if(k.row===0){if(Wr.current){T.preventDefault(),ie(null),te(null),ye(!1);const F=(0,v.getAllTabbableElements)(),q=F.indexOf(Wr.current);F[(q-1+F.length)%F.length].focus();return}}else{ie(F=>{var q;return{col:G.length-(oe?3:2),row:((q=F==null?void 0:F.row)!==null&&q!==void 0?q:1)-1}}),te(null),ye(!1),T.preventDefault();return}if(!((B=T.key)===null||B===void 0)&&B.startsWith("Arrow")||T.key==="Tab"){if(ae&&G[k.col+1].disableKeys||ae&&["ArrowLeft","ArrowRight"].includes(T.key))return;const F=([q,W],ne)=>ne&&{col:Math.max(0,Math.min(G.length-(oe?3:2),ne.col+q)),row:Math.max(0,Math.min(R.length-1,ne.row+W))};if(T.key==="Tab"&&T.shiftKey)ie(q=>F([-1,0],q)),te(null);else{const q={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[T.key];(T.ctrlKey||T.metaKey)&&(q[0]*=G.length,q[1]*=R.length),T.shiftKey?te(W=>F(q,W||k)):(ie(W=>F(q,W)),te(null))}ye(!1),T.preventDefault()}else T.key==="Escape"?(!ae&&!ve&&ie(null),te(null),ye(!1)):(T.key==="Enter"||T.key==="F2")&&!T.ctrlKey&&!T.metaKey&&!T.altKey&&!T.shiftKey?(te(null),ae?G[k.col+1].disableKeys||(Jr(),T.preventDefault()):Te(k)||(Vt.current=k,ye(!0),Ze(k),T.preventDefault())):T.key==="Enter"&&!T.ctrlKey&&!T.metaKey&&!T.altKey&&T.shiftKey?Qe((j==null?void 0:j.max.row)||k.row):T.key==="d"&&(T.ctrlKey||T.metaKey)&&!T.altKey&&!T.shiftKey?(Lt((j==null?void 0:j.min.row)||k.row,j==null?void 0:j.max.row),T.preventDefault()):((0,f.isPrintableUnicode)(T.key)||T.code.match(/Key[A-Z]$/))&&!T.ctrlKey&&!T.metaKey&&!T.altKey?!ae&&!Te(k)&&(Vt.current=k,te(null),ye(!0),Ze(k)):["Backspace","Delete"].includes(T.key)?ae||(_r(),T.preventDefault()):T.key==="a"&&(T.ctrlKey||T.metaKey)&&(ae||(ie({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),te({col:G.length-(oe?3:2),row:R.length-1,doNotScrollY:!0,doNotScrollX:!0}),T.preventDefault()))}},[k,G,R.length,_r,Lt,ae,Qe,Te,Ze,j==null?void 0:j.max.row,j==null?void 0:j.min.row,ve,ie,te,Jr,oe]);(0,p.useDocumentEventListener)("keydown",lc);const uc=(0,r.useCallback)(T=>{var B;const F=((B=wr.current)===null||B===void 0?void 0:B.contains(T.target))||!1,q=F?mt(T,!0,!0):null,W=q&&k&&k.col===q.col&&k.row===q.row&&ae;F&&!W&&T.preventDefault()},[mt,k,ae]);(0,p.useDocumentEventListener)("contextmenu",uc),(0,r.useEffect)(()=>{const T=[];(k==null?void 0:k.row)!==void 0&&T.push({type:"COPY",action:()=>{Ht(),De(null)}},{type:"CUT",action:()=>{Kr(),De(null)}},{type:"PASTE",action:()=>o(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(F=>o(void 0,void 0,void 0,function*(){let q=[[""]];if(F.types.includes("text/html")){const W=yield F.getType("text/html");q=(0,f.parseTextHtmlData)(yield W.text())}else if(F.types.includes("text/plain")){const W=yield F.getType("text/plain");q=(0,f.parseTextPlainData)(yield W.text())}else if(F.types.includes("text")){const W=yield F.getType("text");q=(0,f.parseTextHtmlData)(yield W.text())}Jt(q)}));else if(navigator.clipboard.readText!==void 0){const B=yield navigator.clipboard.readText();Jt((0,f.parseTextPlainData)(B))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");De(null)})}),(j==null?void 0:j.max.row)!==void 0?T.push({type:"INSERT_ROW_BELLOW",action:()=>{De(null),Qe(j.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"INSERT_ROW_BELLOW",action:()=>{De(null),Qe(k.row)}}),(j==null?void 0:j.min.row)!==void 0&&j.min.row!==j.max.row?T.push({type:"DUPLICATE_ROWS",fromRow:j.min.row+1,toRow:j.max.row+1,action:()=>{De(null),Lt(j.min.row,j.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"DUPLICATE_ROW",action:()=>{De(null),Lt(k.row)}}),(j==null?void 0:j.min.row)!==void 0&&j.min.row!==j.max.row?T.push({type:"DELETE_ROWS",fromRow:j.min.row+1,toRow:j.max.row+1,action:()=>{De(null),Ut(j.min.row,j.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"DELETE_ROW",action:()=>{De(null),Ut(k.row)}}),tc(T),T.length||De(null)},[j,k,Ut,Lt,Qe,Kr,Ht,Jt]);const Is=(0,r.useRef)(qt);Is.current=qt;const cc=(0,r.useCallback)(()=>Is.current,[]);(0,r.useImperativeHandle)(Ku,()=>({activeCell:(0,m.getCellWithId)(k,G),selection:(0,m.getSelectionWithId)(j??(k?{min:k,max:k}:null),G),setSelection:T=>{const B=(0,m.getSelection)(T,G.length-(oe?2:1),R.length,G);ie((B==null?void 0:B.min)||null),ye(!1),Ft({columns:!1,active:!1,rows:!1}),te((B==null?void 0:B.max)||null)},setActiveCell:T=>{const B=(0,m.getCell)(T,G.length-(oe?2:1),R.length,G);ie(B),ye(!1),Ft({columns:!1,active:!1,rows:!1}),te(null)}}));const lt=(0,r.useRef)({onFocus:fe,onBlur:he,onActiveCellChange:kt,onSelectionChange:jt});return lt.current.onFocus=fe,lt.current.onBlur=he,lt.current.onActiveCellChange=kt,lt.current.onSelectionChange=jt,(0,r.useEffect)(()=>{Vt.current&&(ae?lt.current.onFocus({cell:(0,m.getCellWithId)(Vt.current,G)}):lt.current.onBlur({cell:(0,m.getCellWithId)(Vt.current,G)}))},[ae,G]),(0,r.useEffect)(()=>{lt.current.onActiveCellChange({cell:(0,m.getCellWithId)(k,G)})},[k==null?void 0:k.col,k==null?void 0:k.row,G]),(0,r.useEffect)(()=>{lt.current.onSelectionChange({selection:(0,m.getSelectionWithId)(j??(k?{min:k,max:k}:null),G)})},[(Ur=j==null?void 0:j.min.col)!==null&&Ur!==void 0?Ur:k==null?void 0:k.col,($r=j==null?void 0:j.min.row)!==null&&$r!==void 0?$r:k==null?void 0:k.row,(zr=j==null?void 0:j.max.col)!==null&&zr!==void 0?zr:k==null?void 0:k.col,(Gr=j==null?void 0:j.max.row)!==null&&Gr!==void 0?Gr:k==null?void 0:k.row,k==null?void 0:k.col,k==null?void 0:k.row,G]),r.default.createElement("div",{className:M,style:P},r.default.createElement("div",{ref:Wr,tabIndex:z.length&&R.length?0:void 0,onFocus:T=>{T.target.blur(),ie({col:0,row:0})}}),r.default.createElement(_.Grid,{columns:G,outerRef:Le,columnWidths:qe,hasStickyRightColumn:oe,displayHeight:Cs,data:R,fullWidth:Os,headerRowHeight:X,activeCell:k,innerRef:wr,rowHeight:At,rowKey:Q,selection:j,rowClassName:Br,editing:ae,getContextMenuItems:cc,setRowData:rc,deleteRows:Ut,insertRowAfter:Qe,duplicateRows:Lt,stopEditing:Jr,cellClassName:yr,onScroll:vr},r.default.createElement(S.SelectionRect,{columnRights:Ue,columnWidths:qe,activeCell:k,selection:j,headerRowHeight:X,rowHeight:At,hasStickyRightColumn:oe,dataLength:R.length,viewHeight:pt,viewWidth:Pt,contentWidth:Os?void 0:ec,edges:Zu,editing:ae,isCellDisabled:Te,expandSelection:nc})),r.default.createElement("div",{ref:Hr,tabIndex:z.length&&R.length?0:void 0,onFocus:T=>{T.target.blur(),ie({col:G.length-(oe?3:2),row:R.length-1})}}),!ge&&be&&r.default.createElement(be,{addRows:T=>Qe(R.length-1,T)}),Mt&&qt.length>0&&r.default.createElement(Wt,{clientX:Mt.x,clientY:Mt.y,cursorIndex:Mt.cursorIndex,items:qt,close:()=>De(null)}))})),e.DataSheetGrid.displayName="DataSheetGrid"}(je)),je}var rt={},Ro;function Yf(){if(Ro)return rt;Ro=1;var e=rt&&rt.__rest||function(u,r){var s={};for(var i in u)Object.prototype.hasOwnProperty.call(u,i)&&r.indexOf(i)<0&&(s[i]=u[i]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(u);n<i.length;n++)r.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(u,i[n])&&(s[i[n]]=u[i[n]]);return s},c=rt&&rt.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(rt,"__esModule",{value:!0}),rt.StaticDataSheetGrid=void 0;const g=de(),d=Cu(),o=c(de());return rt.StaticDataSheetGrid=o.default.forwardRef((u,r)=>{var{columns:s,gutterColumn:i,stickyRightColumn:n,addRowsComponent:t,createRow:a,duplicateRow:p,style:h,rowKey:w,onFocus:b,onBlur:y,onActiveCellChange:l,onSelectionChange:f,rowClassName:m,rowHeight:v}=u,_=e(u,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[S]=(0,g.useState)({columns:s,gutterColumn:i,stickyRightColumn:n,addRowsComponent:t,createRow:a,duplicateRow:p,style:h,rowKey:w,onFocus:b,onBlur:y,onActiveCellChange:l,onSelectionChange:f,rowClassName:m,rowHeight:v});return o.default.createElement(d.DataSheetGrid,Object.assign({},S,_,{rowHeight:typeof v=="number"?v:S.rowHeight,ref:r}))}),rt}var _e={},on={},No;function Xf(){if(No)return on;No=1,Object.defineProperty(on,"__esModule",{value:!0}),on.useFirstRender=void 0;const e=de(),c=()=>{const g=(0,e.useRef)(!0),d=g.current;return g.current=!1,d};return on.useFirstRender=c,on}var Eo;function Vr(){if(Eo)return _e;Eo=1;var e=_e&&_e.__createBinding||(Object.create?function(n,t,a,p){p===void 0&&(p=a);var h=Object.getOwnPropertyDescriptor(t,a);(!h||("get"in h?!t.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(n,p,h)}:function(n,t,a,p){p===void 0&&(p=a),n[p]=t[a]}),c=_e&&_e.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),g=_e&&_e.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var a in n)a!=="default"&&Object.prototype.hasOwnProperty.call(n,a)&&e(t,n,a);return c(t,n),t},d=_e&&_e.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.createTextColumn=_e.textColumn=void 0;const o=g(de()),u=d(zt()),r=Xf(),s=o.default.memo(({active:n,focus:t,rowData:a,setRowData:p,columnData:{placeholder:h,alignRight:w,formatInputOnFocus:b,formatBlurredInput:y,parseUserInput:l,continuousUpdates:f}})=>{const m=(0,o.useRef)(null),v=(0,r.useFirstRender)(),_=(0,o.useRef)({rowData:a,formatInputOnFocus:b,formatBlurredInput:y,setRowData:p,parseUserInput:l,continuousUpdates:f,firstRender:v,focusedAt:0,changedAt:0,escPressed:!1});return _.current={rowData:a,formatInputOnFocus:b,formatBlurredInput:y,setRowData:p,parseUserInput:l,continuousUpdates:f,firstRender:v,focusedAt:_.current.focusedAt,changedAt:_.current.changedAt,escPressed:_.current.escPressed},(0,o.useLayoutEffect)(()=>{t?(m.current&&(m.current.value=_.current.formatInputOnFocus(_.current.rowData),m.current.focus(),m.current.select()),_.current.escPressed=!1,_.current.focusedAt=Date.now()):m.current&&(!_.current.escPressed&&!_.current.continuousUpdates&&!_.current.firstRender&&_.current.changedAt>=_.current.focusedAt&&_.current.setRowData(_.current.parseUserInput(m.current.value)),m.current.blur())},[t]),(0,o.useEffect)(()=>{!t&&m.current&&(m.current.value=_.current.formatBlurredInput(a))},[t,a]),o.default.createElement("input",{defaultValue:y(a),className:(0,u.default)("dsg-input",w&&"dsg-input-align-right"),placeholder:n?h:void 0,tabIndex:-1,ref:m,style:{pointerEvents:t?"auto":"none"},onChange:S=>{_.current.changedAt=Date.now(),f&&p(l(S.target.value))},onKeyDown:S=>{S.key==="Escape"&&(_.current.escPressed=!0)}})});s.displayName="TextComponent",_e.textColumn=i();function i({placeholder:n,alignRight:t=!1,continuousUpdates:a=!0,deletedValue:p=null,parseUserInput:h=f=>f.trim()||null,formatBlurredInput:w=f=>String(f??""),formatInputOnFocus:b=f=>String(f??""),formatForCopy:y=f=>String(f??""),parsePastedValue:l=f=>f.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:s,columnData:{placeholder:n,alignRight:t,continuousUpdates:a,formatInputOnFocus:b,formatBlurredInput:w,parseUserInput:h},deleteValue:()=>p,copyValue:({rowData:f})=>y(f),pasteValue:({value:f})=>l(f),isCellEmpty:({rowData:f})=>f==null}}return _e.createTextColumn=i,_e}var Ge={},To;function Qf(){if(To)return Ge;To=1;var e=Ge&&Ge.__createBinding||(Object.create?function(r,s,i,n){n===void 0&&(n=i);var t=Object.getOwnPropertyDescriptor(s,i);(!t||("get"in t?!s.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,n,t)}:function(r,s,i,n){n===void 0&&(n=i),r[n]=s[i]}),c=Ge&&Ge.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),g=Ge&&Ge.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var i in r)i!=="default"&&Object.prototype.hasOwnProperty.call(r,i)&&e(s,r,i);return c(s,r),s};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.checkboxColumn=void 0;const d=g(de()),o=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],u=d.default.memo(({focus:r,rowData:s,setRowData:i,active:n,stopEditing:t,disabled:a})=>{const p=(0,d.useRef)(null);return(0,d.useLayoutEffect)(()=>{r&&(i(!s),t({nextRow:!1}))},[r,t]),d.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:p,disabled:a,checked:!!s,onMouseDown:()=>!n&&i(!s),onChange:()=>null})});return u.displayName="CheckboxComponent",Ge.checkboxColumn={component:u,deleteValue:()=>!1,copyValue:({rowData:r})=>r?"YES":"NO",pasteValue:({value:r})=>!o.includes(r.toLowerCase()),isCellEmpty:({rowData:r})=>!r},Ge}var an={},Io;function Zf(){if(Io)return an;Io=1,Object.defineProperty(an,"__esModule",{value:!0}),an.floatColumn=void 0;const e=Vr();return an.floatColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:c=>typeof c=="number"?new Intl.NumberFormat().format(c):"",parseUserInput:c=>{const g=parseFloat(c);return isNaN(g)?null:g},parsePastedValue:c=>{const g=parseFloat(c);return isNaN(g)?null:g}}),an}var ln={},ko;function eh(){if(ko)return ln;ko=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.intColumn=void 0;const e=Vr();return ln.intColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:c=>typeof c=="number"?new Intl.NumberFormat().format(c):"",parseUserInput:c=>{const g=parseFloat(c);return isNaN(g)?null:Math.round(g)},parsePastedValue:c=>{const g=parseFloat(c);return isNaN(g)?null:Math.round(g)}}),ln}var un={},jo;function th(){if(jo)return un;jo=1,Object.defineProperty(un,"__esModule",{value:!0}),un.percentColumn=void 0;const e=Vr(),c=1e12,g=1e10;return un.percentColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(d):"",formatInputOnFocus:d=>typeof d=="number"&&!isNaN(d)?String(Math.round(d*c)/g):"",parseUserInput:d=>{const o=parseFloat(d);return isNaN(o)?null:o/100},parsePastedValue:d=>{const o=parseFloat(d);return isNaN(o)?null:o}}),un}var Ae={},Vo;function nh(){if(Vo)return Ae;Vo=1;var e=Ae&&Ae.__createBinding||(Object.create?function(s,i,n,t){t===void 0&&(t=n);var a=Object.getOwnPropertyDescriptor(i,n);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[n]}}),Object.defineProperty(s,t,a)}:function(s,i,n,t){t===void 0&&(t=n),s[t]=i[n]}),c=Ae&&Ae.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),g=Ae&&Ae.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var n in s)n!=="default"&&Object.prototype.hasOwnProperty.call(s,n)&&e(i,s,n);return c(i,s),i},d=Ae&&Ae.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.dateColumn=void 0;const o=g(de()),u=d(zt()),r=o.default.memo(({focus:s,active:i,rowData:n,setRowData:t})=>{var a;const p=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var h,w;s?(h=p.current)===null||h===void 0||h.select():(w=p.current)===null||w===void 0||w.blur()},[s]),o.default.createElement("input",{className:(0,u.default)("dsg-input",!i&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:p,style:{pointerEvents:s?"auto":"none",opacity:n||i?void 0:0},value:(a=n==null?void 0:n.toISOString().substr(0,10))!==null&&a!==void 0?a:"",onChange:h=>{const w=new Date(h.target.value);t(isNaN(w.getTime())?null:w)}})});return r.displayName="DateComponent",Ae.dateColumn={component:r,deleteValue:()=>null,copyValue:({rowData:s})=>s?s.toISOString().substr(0,10):null,pasteValue:({value:s})=>{const i=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(i.getTime())?null:i},minWidth:170,isCellEmpty:({rowData:s})=>!s},Ae}var Pe={},Ao;function rh(){if(Ao)return Pe;Ao=1;var e=Pe&&Pe.__createBinding||(Object.create?function(s,i,n,t){t===void 0&&(t=n);var a=Object.getOwnPropertyDescriptor(i,n);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[n]}}),Object.defineProperty(s,t,a)}:function(s,i,n,t){t===void 0&&(t=n),s[t]=i[n]}),c=Pe&&Pe.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),g=Pe&&Pe.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var n in s)n!=="default"&&Object.prototype.hasOwnProperty.call(s,n)&&e(i,s,n);return c(i,s),i},d=Pe&&Pe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.isoDateColumn=void 0;const o=g(de()),u=d(zt()),r=o.default.memo(({focus:s,active:i,rowData:n,setRowData:t})=>{const a=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var p,h;s?(p=a.current)===null||p===void 0||p.select():(h=a.current)===null||h===void 0||h.blur()},[s]),o.default.createElement("input",{className:(0,u.default)("dsg-input",!i&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:a,style:{pointerEvents:s?"auto":"none",opacity:n||i?void 0:0},value:n??"",onChange:p=>{const h=new Date(p.target.value);t(isNaN(h.getTime())?null:h.toISOString().substr(0,10))}})});return r.displayName="IsoDateComponent",Pe.isoDateColumn={component:r,deleteValue:()=>null,copyValue:({rowData:s})=>s,pasteValue:({value:s})=>{const i=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(i.getTime())?null:i.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:s})=>!s},Pe}var Me={},Po;function ih(){if(Po)return Me;Po=1;var e=Me&&Me.__createBinding||(Object.create?function(s,i,n,t){t===void 0&&(t=n);var a=Object.getOwnPropertyDescriptor(i,n);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[n]}}),Object.defineProperty(s,t,a)}:function(s,i,n,t){t===void 0&&(t=n),s[t]=i[n]}),c=Me&&Me.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),g=Me&&Me.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var n in s)n!=="default"&&Object.prototype.hasOwnProperty.call(s,n)&&e(i,s,n);return c(i,s),i},d=Me&&Me.__rest||function(s,i){var n={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&i.indexOf(t)<0&&(n[t]=s[t]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(s);a<t.length;a++)i.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(s,t[a])&&(n[t[a]]=s[t[a]]);return n};Object.defineProperty(Me,"__esModule",{value:!0}),Me.keyColumn=void 0;const o=g(de()),u=s=>{var{columnData:{key:i,original:n},rowData:t,setRowData:a}=s,p=d(s,["columnData","rowData","setRowData"]);const h=(0,o.useRef)(t);h.current=t;const w=(0,o.useCallback)(y=>{a(Object.assign(Object.assign({},h.current),{[i]:y}))},[i,a]);if(!n.component)return o.default.createElement(o.default.Fragment,null);const b=n.component;return o.default.createElement(b,Object.assign({columnData:n.columnData,setRowData:w,rowData:t[i]},p))},r=(s,i)=>Object.assign(Object.assign({id:s},i),{columnData:{key:s,original:i},component:u,copyValue:({rowData:n,rowIndex:t})=>{var a,p;return(p=(a=i.copyValue)===null||a===void 0?void 0:a.call(i,{rowData:n[s],rowIndex:t}))!==null&&p!==void 0?p:null},deleteValue:({rowData:n,rowIndex:t})=>{var a,p;return Object.assign(Object.assign({},n),{[s]:(p=(a=i.deleteValue)===null||a===void 0?void 0:a.call(i,{rowData:n[s],rowIndex:t}))!==null&&p!==void 0?p:null})},pasteValue:({rowData:n,value:t,rowIndex:a})=>{var p,h;return Object.assign(Object.assign({},n),{[s]:(h=(p=i.pasteValue)===null||p===void 0?void 0:p.call(i,{rowData:n[s],value:t,rowIndex:a}))!==null&&h!==void 0?h:null})},disabled:typeof i.disabled=="function"?({rowData:n,rowIndex:t})=>{var a;return typeof i.disabled=="function"?i.disabled({rowData:n[s],rowIndex:t}):(a=i.disabled)!==null&&a!==void 0?a:!1}:i.disabled,cellClassName:typeof i.cellClassName=="function"?({rowData:n,rowIndex:t,columnId:a})=>{var p;return typeof i.cellClassName=="function"?i.cellClassName({rowData:n[s],rowIndex:t,columnId:a}):(p=i.cellClassName)!==null&&p!==void 0?p:void 0}:i.cellClassName,isCellEmpty:({rowData:n,rowIndex:t})=>{var a,p;return(p=(a=i.isCellEmpty)===null||a===void 0?void 0:a.call(i,{rowData:n[s],rowIndex:t}))!==null&&p!==void 0?p:!1}});return Me.keyColumn=r,Me}var Mo;function sh(){return Mo||(Mo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.renderContextMenuItem=e.createContextMenuComponent=e.createAddRowsComponent=e.keyColumn=e.isoDateColumn=e.dateColumn=e.percentColumn=e.intColumn=e.floatColumn=e.checkboxColumn=e.createTextColumn=e.textColumn=e.DataSheetGrid=e.DynamicDataSheetGrid=void 0;const c=Cu(),g=Yf();e.DynamicDataSheetGrid=c.DataSheetGrid,e.DataSheetGrid=g.StaticDataSheetGrid;var d=Vr();Object.defineProperty(e,"textColumn",{enumerable:!0,get:function(){return d.textColumn}}),Object.defineProperty(e,"createTextColumn",{enumerable:!0,get:function(){return d.createTextColumn}});var o=Qf();Object.defineProperty(e,"checkboxColumn",{enumerable:!0,get:function(){return o.checkboxColumn}});var u=Zf();Object.defineProperty(e,"floatColumn",{enumerable:!0,get:function(){return u.floatColumn}});var r=eh();Object.defineProperty(e,"intColumn",{enumerable:!0,get:function(){return r.intColumn}});var s=th();Object.defineProperty(e,"percentColumn",{enumerable:!0,get:function(){return s.percentColumn}});var i=nh();Object.defineProperty(e,"dateColumn",{enumerable:!0,get:function(){return i.dateColumn}});var n=rh();Object.defineProperty(e,"isoDateColumn",{enumerable:!0,get:function(){return n.isoDateColumn}});var t=ih();Object.defineProperty(e,"keyColumn",{enumerable:!0,get:function(){return t.keyColumn}});var a=Su();Object.defineProperty(e,"createAddRowsComponent",{enumerable:!0,get:function(){return a.createAddRowsComponent}});var p=xu();Object.defineProperty(e,"createContextMenuComponent",{enumerable:!0,get:function(){return p.createContextMenuComponent}}),Object.defineProperty(e,"renderContextMenuItem",{enumerable:!0,get:function(){return p.defaultRenderItem}})}(Qr)),Qr}var ut=sh();function qo(e){return typeof e=="object"?JSON.stringify(e):String(e)}function oh({rowData:e,setRowData:c,choices:g}){const d=e||"",[o,u]=U.useState(qo(e));return V.jsx(lu,{freeSolo:!0,disablePortal:!1,options:g,getOptionLabel:r=>qo(r),value:d,onInputChange:(r,s)=>{u(s)},onBlur:()=>c(o),renderInput:r=>V.jsx(Ji,{...r,slotProps:{input:{...r.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}}})}function Zi({choices:e}){return{component:c=>V.jsx(oh,{...c,choices:e}),disableKeys:!0,keepFocus:!0}}try{Zi.displayName="autocompleteColumn",Zi.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}}}}}catch{}async function ah(e,c){const g=await e.gridServicesClient.postRepoV1GridSessionAsyncStart({createGridRequest:c});if(!g.token)throw new Error("No async job token returned from startGridSession");return(await is(()=>e.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:g.token}))).responseBody}function lh(e){const c=jr(),{keyFactory:g,synapseClient:d}=it();return ft({...e,mutationFn:o=>d.gridServicesClient.postRepoV1GridSessionSessionIdReplica({sessionId:o,createReplicaRequest:{gridSessionId:o}}),onSuccess:async(o,u,r)=>{await c.invalidateQueries({queryKey:g.getGridSessionListKey()})}})}function uh(e){const c=jr(),{keyFactory:g,synapseClient:d}=it();return ft({...e,mutationFn:o=>d.gridServicesClient.deleteRepoV1GridSessionSessionId({sessionId:o}),onSuccess:async(o,u,r)=>{await c.invalidateQueries({queryKey:g.getGridSessionListKey()}),e!=null&&e.onSuccess&&await e.onSuccess(o,u,r)}})}function ch(e){const{keyFactory:c,synapseClient:g}=it();return Jc({...e,queryKey:c.getGridSessionListKey(),queryFn:async d=>await g.gridServicesClient.postRepoV1GridSessionList({listGridSessionsRequest:{nextPageToken:d.pageParam}}),initialPageParam:void 0,getNextPageParam:d=>d.nextPageToken})}const dh=e=>{const{synapseClient:c}=it();return ft({...e,mutationFn:async g=>await ah(c,g)})};function fh(){const{mutateAsync:e}=dh(),{synapseClient:c}=it();return ft({mutationFn:async({gridSqlOrSessionId:g,schemaId:d})=>{let o;const u=md(g);if(!["empty","sql","sessionId"].includes(u.type))throw new Error("Unknown input type, please provide a valid SQL query or session ID.");if(u.type==="empty"||u.type==="sql"){const r={concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",initialQuery:void 0,schema$id:d||void 0};u.type==="sql"?(r.initialQuery={sql:u.input},console.log("Starting grid session with table query: ",u.input)):console.log("Starting a new empty grid session.");const s=await e(r);console.log("Grid session started:",s),o=s.gridSession}else console.log(`Joining existing session ID: ${u.input}`),o=await c.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:u.input});return o}})}function hh(e){const{mutateAsync:c}=fh(),{mutateAsync:g}=lh(),{synapseClient:d}=it();return ft({...e,mutationFn:async({gridSqlOrSessionId:o,schemaId:u})=>{const r=await c({gridSqlOrSessionId:o,schemaId:u}),s=r.sessionId;try{const i=await g(s);console.log("Replica created:",i);const n=i.replica,{presignedUrl:t}=await d.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:s,createGridPresignedUrlRequest:{gridSessionId:s,replicaId:n.replicaId}});return{session:r,replica:n,presignedUrl:t}}catch(i){throw new Error("Error starting session:",{cause:i})}}})}const es=U.forwardRef(({onSessionChange:e=Tt,onReplicaChange:c=Tt,onPresignedUrlChange:g=Tt,query:d},o)=>{const[u,r]=U.useState(""),[s,i]=U.useState(""),n=!d,{mutate:t}=hh({onMutate(b){console.log("Starting grid session with args:",b)},onSuccess({session:b,replica:y,presignedUrl:l}){Et("Grid session started successfully","success"),e(b),c(y.replicaId),g(l)}}),{mutate:a}=uh({onSuccess:()=>{Et("Successfully deleted grid session","success"),e(null),c(null),g("")},onError:b=>{Et(b.reason,"danger")}}),{data:p}=ch(),h=U.useMemo(()=>(p==null?void 0:p.pages.flatMap(b=>b.page||[]))||[],[p]),w=function(){t({gridSqlOrSessionId:u,schemaId:s})};return U.useImperativeHandle(o,()=>({handleStartSession:b=>{t({gridSqlOrSessionId:b})}}),[t]),n?V.jsxs(we,{container:!0,spacing:2,sx:{mb:2},children:[V.jsx(we,{size:{xs:12,lg:6},sx:{position:"relative"},children:V.jsx(lu,{freeSolo:!0,fullWidth:!0,renderInput:b=>V.jsx(Ji,{...b,label:"SQL Query or Session ID",placeholder:"(Optional) Enter a SQL query or session ID"}),options:h,getOptionLabel:b=>typeof b=="string"?b:b.sessionId||"",value:u,onInputChange:(b,y)=>{r(y)},onChange:(b,y)=>{y&&typeof y=="object"?(r(y.sessionId||""),i(y.gridJsonSchema$Id||""),t({gridSqlOrSessionId:y.sessionId,schemaId:y.gridJsonSchema$Id})):r(y||"")},onKeyDown:b=>{b.key==="Enter"&&w()},renderOption:(b,y)=>U.createElement(Ki,{...b,key:y.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},V.jsxs(we,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[V.jsx(we,{size:{xs:6,md:2},children:y.sessionId}),V.jsx(we,{size:{xs:5,md:2},children:y.sourceEntityId}),V.jsx(we,{size:{xs:0,md:6},children:y.gridJsonSchema$Id??"No schema"}),V.jsx(we,{size:{xs:1},children:V.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:l=>{l.stopPropagation(),a(y.sessionId)},children:"🗑️"})})]}))})}),V.jsx(we,{size:{xs:12,lg:6},children:V.jsx(Ji,{label:"Schema (optional)",placeholder:"Enter a schema $id e.g. my-org.NameOfMySchema-1.0.0",value:s,fullWidth:!0,onChange:b=>i(b.target.value)})}),V.jsx(we,{container:!0,size:12,justifyContent:"flex-end",children:V.jsx(gr,{color:"primary",variant:"contained",onClick:()=>{w()},children:"Start Grid Session"})})]}):null});try{es.displayName="StartGridSession",es.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},onPresignedUrlChange:{defaultValue:null,description:"",name:"onPresignedUrlChange",required:!1,type:{name:"(url: string) => void"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string"}}}}}catch{}function ph(e){const c=U.useMemo(()=>e?e.api.subscribe:()=>Tt,[e]),g=U.useCallback(()=>e?e.api.getSnapshot():null,[e]);return U.useSyncExternalStore(c,g)}var si={};const re=ru(Kc);var oi={},ai={},Do;function mh(){return Do||(Do=1,Object.defineProperty(ai,"__esModule",{value:!0})),ai}var li={},cn={},ui={},ci={},Bo;function gh(){return Bo||(Bo=1,Object.defineProperty(ci,"__esModule",{value:!0})),ci}var di={},Fo;function bh(){return Fo||(Fo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class c{constructor(y,l){this.sid=y,this.time=l}}e.Timestamp=c;class g{constructor(y,l,f){this.sid=y,this.time=l,this.span=f}}e.Timespan=g;const d=(b,y)=>new c(b,y);e.ts=d;const o=(b,y,l)=>new g(b,y,l);e.tss=o;const u=(b,y)=>(0,e.ts)(b.sid,b.time+y);e.tick=u;const r=(b,y)=>b.time===y.time&&b.sid===y.sid;e.equal=r;const s=(b,y)=>{const l=b.time,f=y.time;if(l>f)return 1;if(l<f)return-1;const m=b.sid,v=y.sid;return m>v?1:m<v?-1:0};e.compare=s;const i=(b,y,l,f)=>{if(b.sid!==l.sid)return!1;const m=b.time,v=l.time;return!(m>v||m+y<v+f)};e.contains=i;const n=(b,y,l)=>{if(b.sid!==l.sid)return!1;const f=b.time,m=l.time;return!(f>m||f+y<m+1)};e.containsId=n;const t=b=>{if(b.sid===1)return"."+b.time;let y=""+b.sid;return y.length>4&&(y=".."+y.slice(y.length-4)),y+"."+b.time};e.printTs=t;const a=(b,y,l)=>new g(b.sid,b.time+y,l);e.interval=a;class p extends c{tick(y){const l=new c(this.sid,this.time);return this.time+=y,l}}e.LogicalClock=p;class h extends p{constructor(){super(...arguments),this.peers=new Map}observe(y,l){const f=y.time+l-1,m=y.sid;if(m!==this.sid){const v=this.peers.get(y.sid);v?f>v.time&&(v.time=f):this.peers.set(y.sid,(0,e.ts)(m,f))}f>=this.time&&(this.time=f+1)}clone(){return this.fork(this.sid)}fork(y){const l=new h(y,this.time);return y!==this.sid&&l.observe((0,e.tick)(this,-1),1),this.peers.forEach(f=>{l.observe(f,1)}),l}toString(y=""){const l=this.peers.size;let f=1,m="";return this.peers.forEach(v=>{m+=`
${y}${f===l?"└─":"├─"} ${v.sid}.${v.time}`,f++}),`clock ${this.sid}.${this.time}${m}`}}e.ClockVector=h;class w extends p{constructor(){super(...arguments),this.peers=new Map}observe(y,l){if(y.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<y.time)throw new Error("TIME_TRAVEL");const f=y.time+l;f>this.time&&(this.time=f)}clone(){return this.fork()}fork(){return new w(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=w}(di)),di}var Lo;function ue(){return Lo||(Lo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(gh(),e),c.__exportStar(bh(),e)}(ui)),ui}var Uo;function Ar(){if(Uo)return cn;Uo=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.ConNode=void 0;const e=ue();let c=class{constructor(d,o){this.id=d,this.val=o,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(d){const o=this.val,u=o instanceof Uint8Array?`Uint8Array { ${(""+o).replaceAll(",",", ")} }`:`{ ${o instanceof e.Timestamp?(0,e.printTs)(o):JSON.stringify(o)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${u}`}};return cn.ConNode=c,cn}var dn={},fn={},$o;function Je(){if($o)return fn;$o=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.printTree=void 0;const e=(c="",g)=>{let d="",o=g.length-1;for(;o>=0&&!g[o];o--);for(let u=0;u<=o;u++){const r=g[u];if(!r)continue;const s=u===o,i=r(c+(s?" ":"│")+"  "),n=i?s?"└─":"├─":"│";d+=`
`+c+n+(i?" "+i:"")}return d};return fn.printTree=e,fn}var yt={},ee={},zo;function Gt(){if(zo)return ee;zo=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.NopOp=ee.DelOp=ee.UpdArrOp=ee.InsArrOp=ee.InsBinOp=ee.InsStrOp=ee.InsVecOp=ee.InsObjOp=ee.InsValOp=ee.NewArrOp=ee.NewBinOp=ee.NewStrOp=ee.NewVecOp=ee.NewObjOp=ee.NewValOp=ee.NewConOp=void 0;const e=Je(),c=ue();class g{constructor(v){this.id=v}span(){return 1}toString(){let v=this.name()+" "+(0,c.printTs)(this.id);const _=this.span();return _>1&&(v+="!"+_),v}}class d extends g{constructor(v,_){super(v),this.id=v,this.val=_}name(){return"new_con"}toString(){const v=this.val,_="Uint8Array",S=v instanceof c.Timestamp?`{ ${(0,c.printTs)(v)} }`:v instanceof Uint8Array?v.length<13?`${_} { ${(""+v).replaceAll(",",", ")} }`:`${_}(${v.length})`:`{ ${JSON.stringify(v)} }`;return super.toString()+" "+S}}ee.NewConOp=d;class o extends g{name(){return"new_val"}}ee.NewValOp=o;class u extends g{name(){return"new_obj"}}ee.NewObjOp=u;class r extends g{name(){return"new_vec"}}ee.NewVecOp=r;class s extends g{name(){return"new_str"}}ee.NewStrOp=s;class i extends g{name(){return"new_bin"}}ee.NewBinOp=i;class n extends g{name(){return"new_arr"}}ee.NewArrOp=n;class t extends g{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.val=S}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}, val = ${(0,c.printTs)(this.val)}`}}ee.InsValOp=t;class a extends g{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_obj"}toString(v=""){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${JSON.stringify(S[0])}: ${(0,c.printTs)(S[1])}`))}}ee.InsObjOp=a;class p extends g{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_vec"}toString(v=""){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${S[0]}: ${(0,c.printTs)(S[1])}`))}}ee.InsVecOp=p;class h extends g{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${(0,c.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}ee.InsStrOp=h;class w extends g{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_bin"}toString(){const v=(0,c.printTs)(this.ref);return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${v} ← ${this.data} }`}}ee.InsBinOp=w;class b extends g{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_arr"}toString(){const v=(0,c.printTs)(this.obj),_=(0,c.printTs)(this.ref),S=this.data.map(c.printTs).join(", ");return super.toString()+", obj = "+v+" { "+_+" ← "+S+" }"}}ee.InsArrOp=b;class y extends g{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.val=C}name(){return"upd_arr"}toString(){const v=(0,c.printTs)(this.obj),_=(0,c.printTs)(this.ref),S=(0,c.printTs)(this.val);return super.toString()+", obj = "+v+" { "+_+": "+S+" }"}}ee.UpdArrOp=y;class l extends g{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.what=S}name(){return"del"}toString(){const v=this.what.map(_=>(0,c.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${v} }`}}ee.DelOp=l;class f extends g{constructor(v,_){super(v),this.id=v,this.len=_}span(){return this.len}name(){return"nop"}}return ee.NopOp=f,ee}var vt={},hn={},pn={},mn={},Go;function yh(){if(Go)return mn;Go=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.RelativeTimestamp=void 0;let e=class{constructor(g,d){this.sessionIndex=g,this.timeDiff=d}};return mn.RelativeTimestamp=e,mn}var Wo;function vh(){if(Wo)return pn;Wo=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.ClockEncoder=void 0;const e=ue(),c=yh();class g{constructor(u,r){this.index=u,this.clock=r}}let d=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(u){this.index=1,this.clock=u;const r=new g(this.index++,(0,e.tick)(u,-1));this.table.clear(),this.table.set(u.sid,r)}append(u){const r=u.time,s=u.sid;let i=this.table.get(s);if(!i){let a=this.clock.peers.get(s);a||(a=new e.Timestamp(s,this.clock.time-1)),i=new g(this.index++,a),this.table.set(s,i)}const t=i.clock.time-r;if(t<0)throw new Error("TIME_TRAVEL");return new c.RelativeTimestamp(i.index,t)}toJson(){const u=[];return this.table.forEach(r=>{const s=r.clock;u.push(s.sid,s.time)}),u}};return pn.ClockEncoder=d,pn}var gn={},bn={},yn={},Ho;function wh(){if(Ho)return yn;Ho=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.Slice=void 0;let e=class{constructor(g,d,o,u){this.uint8=g,this.view=d,this.start=o,this.end=u}subarray(){return this.uint8.subarray(this.start,this.end)}};return yn.Slice=e,yn}var Jo;function Ou(){if(Jo)return bn;Jo=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.Writer=void 0;const e=wh(),c=new Uint8Array([]),g=new DataView(c.buffer),d=typeof Ne.Buffer=="function",o=d?Ne.Buffer.prototype.utf8Write:null,u=d?Ne.Buffer.from:null,r=typeof TextEncoder<"u"?new TextEncoder:null;let s=class{constructor(n=64*1024){this.allocSize=n,this.view=g,this.x0=0,this.x=0,this.uint8=new Uint8Array(n),this.size=n,this.view=new DataView(this.uint8.buffer)}grow(n){const t=this.x0,a=this.x,p=this.uint8,h=new Uint8Array(n),w=new DataView(h.buffer),b=p.subarray(t,a);h.set(b,0),this.x=a-t,this.x0=0,this.uint8=h,this.size=n,this.view=w}ensureCapacity(n){const t=this.size,a=t-this.x;if(a<n){const p=t-this.x0,h=n-a,w=p+h;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(n){this.ensureCapacity(n),this.x+=n}reset(){this.x0=this.x}newBuffer(n){const t=this.uint8=new Uint8Array(n);this.size=n,this.view=new DataView(t.buffer),this.x=this.x0=0}flush(){const n=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,n}flushSlice(){const n=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,n}u8(n){this.ensureCapacity(1),this.uint8[this.x++]=n}u16(n){this.ensureCapacity(2),this.view.setUint16(this.x,n),this.x+=2}u32(n){this.ensureCapacity(4),this.view.setUint32(this.x,n),this.x+=4}i32(n){this.ensureCapacity(4),this.view.setInt32(this.x,n),this.x+=4}u64(n){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(n)),this.x+=8}f64(n){this.ensureCapacity(8),this.view.setFloat64(this.x,n),this.x+=8}u8u16(n,t){this.ensureCapacity(3);let a=this.x;this.uint8[a++]=n,this.uint8[a++]=t>>>8,this.uint8[a++]=t&255,this.x=a}u8u32(n,t){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=n,this.view.setUint32(a,t),this.x=a+4}u8u64(n,t){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=n,this.view.setBigUint64(a,BigInt(t)),this.x=a+8}u8f32(n,t){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=n,this.view.setFloat32(a,t),this.x=a+4}u8f64(n,t){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=n,this.view.setFloat64(a,t),this.x=a+8}buf(n,t){this.ensureCapacity(t);const a=this.x;this.uint8.set(n,a),this.x=a+t}utf8(n){const t=n.length*4;if(t<168)return this.utf8Native(n);if(o){const a=o.call(this.uint8,n,this.x,t);return this.x+=a,a}else if(u){const a=this.uint8,p=a.byteOffset+this.x,w=u(a.buffer).subarray(p,p+t).write(n,0,t,"utf8");return this.x+=w,w}else if(t>1024&&r){const a=r.encodeInto(n,this.uint8.subarray(this.x,this.x+t)).written;return this.x+=a,a}return this.utf8Native(n)}utf8Native(n){const t=n.length,a=this.uint8;let p=this.x,h=0;for(;h<t;){let b=n.charCodeAt(h++);if((b&4294967168)===0){a[p++]=b;continue}else if((b&4294965248)===0)a[p++]=b>>6&31|192;else{if(b>=55296&&b<=56319&&h<t){const y=n.charCodeAt(h);(y&64512)===56320&&(h++,b=((b&1023)<<10)+(y&1023)+65536)}(b&4294901760)===0?(a[p++]=b>>12&15|224,a[p++]=b>>6&63|128):(a[p++]=b>>18&7|240,a[p++]=b>>12&63|128,a[p++]=b>>6&63|128)}a[p++]=b&63|128}const w=p-this.x;return this.x=p,w}ascii(n){const t=n.length;this.ensureCapacity(t);const a=this.uint8;let p=this.x,h=0;for(;h<t;)a[p++]=n.charCodeAt(h++);this.x=p}};return bn.Writer=s,bn}var Ko;function ds(){if(Ko)return gn;Ko=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.CrdtWriter=void 0;const e=Ou();let c=class extends e.Writer{id(d,o){d<=7&&o<=15?this.u8(d<<4|o):(this.b1vu56(1,d),this.vu57(o))}vu57(d){if(d<=127)this.u8(d);else if(d<=16383){this.ensureCapacity(2);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=d>>>7}else if(d<=2097151){this.ensureCapacity(3);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=128|d>>>7&127,o[this.x++]=d>>>14}else if(d<=268435455){this.ensureCapacity(4);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=128|d>>>7&127,o[this.x++]=128|d>>>14&127,o[this.x++]=d>>>21}else{let o=d|0;o<0&&(o+=4294967296);const u=(d-o)/4294967296;if(d<=34359738367){this.ensureCapacity(5);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=128|d>>>14&127,r[this.x++]=128|d>>>21&127,r[this.x++]=u<<4|d>>>28}else if(d<=4398046511103){this.ensureCapacity(6);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=128|d>>>14&127,r[this.x++]=128|d>>>21&127,r[this.x++]=128|(u&7)<<4|d>>>28,r[this.x++]=u>>>3}else if(d<=562949953421311){this.ensureCapacity(7);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=128|d>>>14&127,r[this.x++]=128|d>>>21&127,r[this.x++]=128|(u&7)<<4|d>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=u>>>10}else{this.ensureCapacity(8);const r=this.uint8;r[this.x++]=128|d&127,r[this.x++]=128|d>>>7&127,r[this.x++]=128|d>>>14&127,r[this.x++]=128|d>>>21&127,r[this.x++]=128|(u&7)<<4|d>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=128|(u&130048)>>>10,r[this.x++]=u>>>17}}}b1vu56(d,o){if(o<=63)this.u8(d<<7|o);else{const u=d<<7|64;if(o<=8191){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=u|o&63,r[this.x++]=o>>>6}else if(o<=1048575){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=u|o&63,r[this.x++]=128|o>>>6&127,r[this.x++]=o>>>13}else if(o<=134217727){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=u|o&63,r[this.x++]=128|o>>>6&127,r[this.x++]=128|o>>>13&127,r[this.x++]=o>>>20}else{let r=o|0;r<0&&(r+=4294967296);const s=(o-r)/4294967296;if(o<=17179869183){this.ensureCapacity(5);const i=this.uint8;i[this.x++]=u|o&63,i[this.x++]=128|o>>>6&127,i[this.x++]=128|o>>>13&127,i[this.x++]=128|o>>>20&127,i[this.x++]=s<<5|o>>>27}else if(o<=2199023255551){this.ensureCapacity(6);const i=this.uint8;i[this.x++]=u|o&63,i[this.x++]=128|o>>>6&127,i[this.x++]=128|o>>>13&127,i[this.x++]=128|o>>>20&127,i[this.x++]=128|(s&3)<<5|o>>>27,i[this.x++]=s>>>2}else if(o<=0xffffffffffff){this.ensureCapacity(7);const i=this.uint8;i[this.x++]=u|o&63,i[this.x++]=128|o>>>6&127,i[this.x++]=128|o>>>13&127,i[this.x++]=128|o>>>20&127,i[this.x++]=128|(s&3)<<5|o>>>27,i[this.x++]=128|(s&508)>>>2,i[this.x++]=s>>>9}else{this.ensureCapacity(8);const i=this.uint8;i[this.x++]=u|o&63,i[this.x++]=128|o>>>6&127,i[this.x++]=128|o>>>13&127,i[this.x++]=128|o>>>20&127,i[this.x++]=128|(s&3)<<5|o>>>27,i[this.x++]=128|(s&508)>>>2,i[this.x++]=128|(s&65024)>>>9,i[this.x++]=s>>>16}}}}};return gn.CrdtWriter=c,gn}var vn={},wn={},Yo;function _h(){if(Yo)return wn;Yo=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),c=g=>(e.setFloat32(0,g),g===e.getFloat32(0));return wn.isFloat32=c,wn}var _n={},Xo;function Ru(){if(Xo)return _n;Xo=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.JsonPackExtension=void 0;let e=class{constructor(g,d){this.tag=g,this.val=d}};return _n.JsonPackExtension=e,_n}var Sn={},Qo;function Sh(){if(Qo)return Sn;Qo=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.CborEncoderFast=void 0;const e=Ou(),c=Number.isSafeInteger;let g=class{constructor(o=new e.Writer){this.writer=o}encode(o){return this.writeAny(o),this.writer.flush()}encodeToSlice(o){return this.writeAny(o),this.writer.flushSlice()}writeAny(o){switch(typeof o){case"number":return this.writeNumber(o);case"string":return this.writeStr(o);case"boolean":return this.writer.u8(244+ +o);case"object":{if(!o)return this.writer.u8(246);switch(o.constructor){case Array:return this.writeArr(o);default:return this.writeObj(o)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(o){o?this.writer.u8(245):this.writer.u8(244)}writeNumber(o){c(o)?this.writeInteger(o):typeof o=="bigint"?this.writeBigInt(o):this.writeFloat(o)}writeBigInt(o){o>=0?this.writeBigUint(o):this.writeBigSint(o)}writeBigUint(o){if(o<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(o));this.writer.u8u64(27,o)}writeBigSint(o){if(o>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(o));const u=-BigInt(1)-o;this.writer.u8u64(59,u)}writeInteger(o){o>=0?this.writeUInteger(o):this.encodeNint(o)}writeUInteger(o){const u=this.writer;u.ensureCapacity(9);const r=u.uint8;let s=u.x;o<=23?r[s++]=0+o:o<=255?(r[s++]=24,r[s++]=o):o<=65535?(r[s++]=25,u.view.setUint16(s,o),s+=2):o<=4294967295?(r[s++]=26,u.view.setUint32(s,o),s+=4):(r[s++]=27,u.view.setBigUint64(s,BigInt(o)),s+=8),u.x=s}encodeNumber(o){this.writeNumber(o)}encodeInteger(o){this.writeInteger(o)}encodeUint(o){this.writeUInteger(o)}encodeNint(o){const u=-1-o,r=this.writer;r.ensureCapacity(9);const s=r.uint8;let i=r.x;u<24?s[i++]=32+u:u<=255?(s[i++]=56,s[i++]=u):u<=65535?(s[i++]=57,r.view.setUint16(i,u),i+=2):u<=4294967295?(s[i++]=58,r.view.setUint32(i,u),i+=4):(s[i++]=59,r.view.setBigUint64(i,BigInt(u)),i+=8),r.x=i}writeFloat(o){this.writer.u8f64(251,o)}writeBin(o){const u=o.length;this.writeBinHdr(u),this.writer.buf(o,u)}writeBinHdr(o){const u=this.writer;o<=23?u.u8(64+o):o<=255?u.u16(22528+o):o<=65535?u.u8u16(89,o):o<=4294967295?u.u8u32(90,o):u.u8u64(91,o)}writeStr(o){const u=this.writer,s=o.length*4;u.ensureCapacity(5+s);const i=u.uint8;let n=u.x;s<=23?u.x++:s<=255?(i[u.x++]=120,n=u.x,u.x++):s<=65535?(i[u.x++]=121,n=u.x,u.x+=2):(i[u.x++]=122,n=u.x,u.x+=4);const t=u.utf8(o);s<=23?i[n]=96+t:s<=255?i[n]=t:s<=65535?u.view.setUint16(n,t):u.view.setUint32(n,t)}writeStrHdr(o){const u=this.writer;o<=23?u.u8(96+o):o<=255?u.u16(30720+o):o<=65535?u.u8u16(121,o):u.u8u32(122,o)}writeAsciiStr(o){this.writeStrHdr(o.length),this.writer.ascii(o)}writeArr(o){const u=o.length;this.writeArrHdr(u);for(let r=0;r<u;r++)this.writeAny(o[r])}writeArrHdr(o){const u=this.writer;o<=23?u.u8(128+o):o<=255?u.u16(38912+o):o<=65535?u.u8u16(153,o):o<=4294967295?u.u8u32(154,o):u.u8u64(155,o)}writeObj(o){const u=Object.keys(o),r=u.length;this.writeObjHdr(r);for(let s=0;s<r;s++){const i=u[s];this.writeStr(i),this.writeAny(o[i])}}writeObjHdr(o){const u=this.writer;o<=23?u.u8(160+o):o<=255?u.u16(47104+o):o<=65535?u.u8u16(185,o):o<=4294967295?u.u8u32(186,o):u.u8u64(187,o)}writeMapHdr(o){this.writeObjHdr(o)}writeStartMap(){this.writer.u8(191)}writeTag(o,u){this.writeTagHdr(o),this.writeAny(u)}writeTagHdr(o){const u=this.writer;o<=23?u.u8(192+o):o<=255?u.u16(55296+o):o<=65535?u.u8u16(217,o):o<=4294967295?u.u8u32(218,o):u.u8u64(219,o)}writeTkn(o){const u=this.writer;o<=23?u.u8(224+o):o<=255&&u.u16(63488+o)}writeStartStr(){this.writer.u8(127)}writeStrChunk(o){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(o){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(o){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(o,u){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return Sn.CborEncoderFast=g,Sn}var xn={},Zo;function fs(){if(Zo)return xn;Zo=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.JsonPackValue=void 0;let e=class{constructor(g){this.val=g}};return xn.JsonPackValue=e,xn}var ea;function Nu(){if(ea)return vn;ea=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.CborEncoder=void 0;const e=_h(),c=Ru(),g=Sh(),d=fs();let o=class extends g.CborEncoderFast{writeUnknown(r){this.writeNull()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Object:return this.writeObj(r);case Array:return this.writeArr(r);case Uint8Array:return this.writeBin(r);case Map:return this.writeMap(r);case c.JsonPackExtension:return this.writeTag(r.tag,r.val);case d.JsonPackValue:const i=r.val;return this.writer.buf(i,i.length);default:return r instanceof Uint8Array?this.writeBin(r):Array.isArray(r)?this.writeArr(r):r instanceof Map?this.writeMap(r):this.writeUnknown(r)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(r);default:return this.writeUnknown(r)}}writeFloat(r){(0,e.isFloat32)(r)?this.writer.u8f32(250,r):this.writer.u8f64(251,r)}writeMap(r){this.writeMapHdr(r.size),r.forEach((s,i)=>{this.writeAny(i),this.writeAny(s)})}writeUndef(){this.writer.u8(247)}};return vn.CborEncoder=o,vn}var wt={},ta;function Eu(){if(ta)return wt;ta=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.CRDT_MAJOR_OVERLAY=wt.CRDT_MAJOR=void 0;var e;(function(g){g[g.CON=0]="CON",g[g.VAL=1]="VAL",g[g.OBJ=2]="OBJ",g[g.VEC=3]="VEC",g[g.STR=4]="STR",g[g.BIN=5]="BIN",g[g.ARR=6]="ARR"})(e||(wt.CRDT_MAJOR=e={}));var c;return function(g){g[g.CON=0]="CON",g[g.VAL=32]="VAL",g[g.VEC=96]="VEC",g[g.OBJ=64]="OBJ",g[g.STR=128]="STR",g[g.BIN=160]="BIN",g[g.ARR=192]="ARR"}(c||(wt.CRDT_MAJOR_OVERLAY=c={})),wt}var na;function xh(){if(na)return hn;na=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.Encoder=void 0;const c=re.__importStar(ht()),g=vh(),d=ds(),o=ue(),u=Nu(),r=Eu();class s extends u.CborEncoder{constructor(n){super(n||new d.CrdtWriter),this.clockEncoder=new g.ClockEncoder,this.time=0,this.cTableEntry=t=>{const a=t.clock,p=this.writer;p.vu57(a.sid),p.vu57(a.time)},this.tsLogical=t=>{const a=this.clockEncoder.append(t);this.writer.id(a.sessionIndex,a.timeDiff)},this.tsServer=t=>{this.writer.vu57(t.time)},this.ts=this.tsLogical,this.cKey=(t,a)=>{this.writeStr(a),this.cNode(this.doc.index.get(t))}}encode(n){this.doc=n;const t=this.writer;return t.reset(),n.clock.sid===1?this.encodeServer(n):this.encodeLogical(n),t.flush()}encodeLogical(n){const t=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(n.clock),t.ensureCapacity(4);const a=t.x0,p=t.x;t.x+=4,this.cRoot(n.root),this.encodeClockTable(a,p)}encodeServer(n){this.ts=this.tsServer;const t=this.writer;t.u8(128),t.vu57(this.time=n.clock.time),this.cRoot(n.root)}encodeClockTable(n,t){const a=this.writer,p=a.x0-n;a.view.setUint32(a.x0+(t-n),a.x-t-p-4);const w=this.clockEncoder.table,b=w.size;a.vu57(b),w.forEach(this.cTableEntry)}cRoot(n){n.val.sid===0?this.writer.u8(0):this.cNode(n.node())}writeTL(n,t){const a=this.writer;t<31?a.u8(n|t):(a.u8(n|31),a.vu57(t))}cNode(n){n instanceof c.ConNode?this.cCon(n):n instanceof c.ValNode?this.cVal(n):n instanceof c.StrNode?this.cStr(n):n instanceof c.ObjNode?this.cObj(n):n instanceof c.VecNode?this.cVec(n):n instanceof c.ArrNode?this.cArr(n):n instanceof c.BinNode&&this.cBin(n)}cCon(n){const t=n.val;this.ts(n.id),t instanceof o.Timestamp?(this.writer.u8(1),this.ts(t)):(this.writer.u8(0),this.writeAny(t))}cVal(n){this.ts(n.id),this.writer.u8(32),this.cNode(n.node())}cObj(n){this.ts(n.id);const t=n.keys;this.writeTL(r.CRDT_MAJOR_OVERLAY.OBJ,t.size),t.forEach(this.cKey)}cVec(n){const t=n.elements,a=t.length;this.ts(n.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.VEC,a);const p=this.doc.index;for(let h=0;h<a;h++){const w=t[h];w?this.cNode(p.get(w)):this.writer.u8(0)}}cStr(n){const t=this.ts;t(n.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.STR,n.count);for(let a=n.first();a;a=n.next(a))t(a.id),a.del?this.writeUInteger(a.span):this.writeStr(a.data)}cBin(n){const t=this.ts,a=this.writer;t(n.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.BIN,n.count);for(let p=n.first();p;p=n.next(p)){t(p.id);const h=p.span,w=p.del;a.b1vu56(~~w,h),!w&&a.buf(p.data,h)}}cArr(n){const t=this.ts,a=this.writer;t(n.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.ARR,n.count);const p=this.doc.index;for(let h=n.first();h;h=n.next(h)){t(h.id);const w=h.span,b=h.del;if(a.b1vu56(~~b,w),b)continue;const y=h.data;for(let l=0;l<w;l++)this.cNode(p.get(y[l]))}}}return hn.Encoder=s,hn}var Cn={},On={},ra;function Ch(){if(ra)return On;ra=1,Object.defineProperty(On,"__esModule",{value:!0}),On.ClockDecoder=void 0;const e=ue();let c=class Tu{static fromArr(d){const o=new Tu(d[0],d[1]),u=d.length;for(let r=2;r<u;r+=2)o.pushTuple(d[r],d[r+1]);return o}constructor(d,o){this.table=[],this.clock=new e.ClockVector(d,o+1),this.table.push((0,e.ts)(d,o))}pushTuple(d,o){const u=(0,e.ts)(d,o);this.clock.observe(u,1),this.table.push(u)}decodeId(d,o){if(!d)return(0,e.ts)(0,o);const u=this.table[d-1];if(!u)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(u.sid,u.time-o)}};return On.ClockDecoder=c,On}var Rn={},Nn={},En={},xr={},_t={},ia;function Oh(){if(ia)return _t;ia=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.decodeAsciiMax15=_t.decodeAscii=void 0;const e=String.fromCharCode,c=(d,o,u)=>{const r=[];for(let s=0;s<u;s++){const i=d[o++];if(i&128)return;r.push(i)}return e.apply(String,r)};_t.decodeAscii=c;const g=(d,o,u)=>{if(u<4)if(u<2){if(u===0)return"";{const r=d[o++];if((r&128)>1){o-=1;return}return e(r)}}else{const r=d[o++],s=d[o++];if((r&128)>0||(s&128)>0){o-=2;return}if(u<3)return e(r,s);const i=d[o++];if((i&128)>0){o-=3;return}return e(r,s,i)}else{const r=d[o++],s=d[o++],i=d[o++],n=d[o++];if((r&128)>0||(s&128)>0||(i&128)>0||(n&128)>0){o-=4;return}if(u<6){if(u===4)return e(r,s,i,n);{const t=d[o++];if((t&128)>0){o-=5;return}return e(r,s,i,n,t)}}else if(u<8){const t=d[o++],a=d[o++];if((t&128)>0||(a&128)>0){o-=6;return}if(u<7)return e(r,s,i,n,t,a);const p=d[o++];if((p&128)>0){o-=7;return}return e(r,s,i,n,t,a,p)}else{const t=d[o++],a=d[o++],p=d[o++],h=d[o++];if((t&128)>0||(a&128)>0||(p&128)>0||(h&128)>0){o-=8;return}if(u<10){if(u===8)return e(r,s,i,n,t,a,p,h);{const w=d[o++];if((w&128)>0){o-=9;return}return e(r,s,i,n,t,a,p,h,w)}}else if(u<12){const w=d[o++],b=d[o++];if((w&128)>0||(b&128)>0){o-=10;return}if(u<11)return e(r,s,i,n,t,a,p,h,w,b);const y=d[o++];if((y&128)>0){o-=11;return}return e(r,s,i,n,t,a,p,h,w,b,y)}else{const w=d[o++],b=d[o++],y=d[o++],l=d[o++];if((w&128)>0||(b&128)>0||(y&128)>0||(l&128)>0){o-=12;return}if(u<14){if(u===12)return e(r,s,i,n,t,a,p,h,w,b,y,l);{const f=d[o++];if((f&128)>0){o-=13;return}return e(r,s,i,n,t,a,p,h,w,b,y,l,f)}}else{const f=d[o++],m=d[o++];if((f&128)>0||(m&128)>0){o-=14;return}if(u<15)return e(r,s,i,n,t,a,p,h,w,b,y,l,f,m);const v=d[o++];if((v&128)>0){o-=15;return}return e(r,s,i,n,t,a,p,h,w,b,y,l,f,m,v)}}}}};return _t.decodeAsciiMax15=g,_t}var Cr={},sa;function Rh(){if(sa)return Cr;sa=1,Object.defineProperty(Cr,"__esModule",{value:!0});const e=String.fromCharCode;return Cr.default=(c,g,d)=>{let o=g;const u=o+d,r=[];for(;o<u;){let s=c[o++];if((s&128)!==0){const i=c[o++]&63;if((s&224)===192)s=(s&31)<<6|i;else{const n=c[o++]&63;if((s&240)===224)s=(s&31)<<12|i<<6|n;else if((s&248)===240){const t=c[o++]&63;let a=(s&7)<<18|i<<12|n<<6|t;if(a>65535){a-=65536;const p=a>>>10&1023|55296;s=56320|a&1023,r.push(p)}else s=a}}}r.push(s)}return e.apply(String,r)},Cr}var oa;function Nh(){if(oa)return xr;oa=1,Object.defineProperty(xr,"__esModule",{value:!0});const e=re,c=Oh(),g=e.__importDefault(Rh()),d=typeof Ne.Buffer<"u",o=d?Ne.Buffer.prototype.utf8Slice:null,u=d?Ne.Buffer.from:null,r=(t,a,p)=>(0,c.decodeAsciiMax15)(t,a,p)??(0,g.default)(t,a,p),s=(t,a,p)=>(0,c.decodeAscii)(t,a,p)??(0,g.default)(t,a,p),i=o?(t,a,p)=>o.call(t,a,a+p):u?(t,a,p)=>u(t).subarray(a,a+p).toString("utf8"):g.default,n=(t,a,p)=>p<16?r(t,a,p):p<32?s(t,a,p):i(t,a,p);return xr.default=n,xr}var aa;function Eh(){if(aa)return En;aa=1,Object.defineProperty(En,"__esModule",{value:!0}),En.decodeUtf8=void 0;const c=re.__importDefault(Nh());return En.decodeUtf8=c.default,En}var la;function Iu(){if(la)return Nn;la=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.Reader=void 0;const e=Eh();let c=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(d){this.x=0,this.uint8=d,this.view=new DataView(d.buffer,d.byteOffset,d.length)}peak(){return this.view.getUint8(this.x)}skip(d){this.x+=d}buf(d){const o=this.x+d,u=this.uint8.subarray(this.x,o);return this.x=o,u}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let d=this.x;const o=(this.uint8[d++]<<8)+this.uint8[d++];return this.x=d,o}i16(){const d=this.view.getInt16(this.x);return this.x+=2,d}u32(){const d=this.view.getUint32(this.x);return this.x+=4,d}i32(){const d=this.view.getInt32(this.x);return this.x+=4,d}u64(){const d=this.view.getBigUint64(this.x);return this.x+=8,d}i64(){const d=this.view.getBigInt64(this.x);return this.x+=8,d}f32(){const d=this.x;return this.x+=4,this.view.getFloat32(d)}f64(){const d=this.x;return this.x+=8,this.view.getFloat64(d)}utf8(d){const o=this.x;return this.x+=d,(0,e.decodeUtf8)(this.uint8,o,d)}ascii(d){const o=this.uint8;let u="";const r=this.x+d;for(let s=this.x;s<r;s++)u+=String.fromCharCode(o[s]);return this.x=r,u}};return Nn.Reader=c,Nn}var ua;function ku(){if(ua)return Rn;ua=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.CrdtReader=void 0;const e=Iu();let c=class extends e.Reader{id(){const d=this.u8();return d<=127?[d>>>4,d&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const d=this.u8();if(d<=127)return d;const o=this.u8();if(o<=127)return o<<7|d&127;const u=this.u8();if(u<=127)return u<<14|(o&127)<<7|d&127;const r=this.u8();if(r<=127)return r<<21|(u&127)<<14|(o&127)<<7|d&127;const s=this.u8();if(s<=127)return s*268435456+((r&127)<<21|(u&127)<<14|(o&127)<<7|d&127);const i=this.u8();if(i<=127)return i*34359738368+((s&127)*268435456+((r&127)<<21|(u&127)<<14|(o&127)<<7|d&127));const n=this.u8();return n<=127?n*4398046511104+((i&127)*34359738368+((s&127)*268435456+((r&127)<<21|(u&127)<<14|(o&127)<<7|d&127))):this.u8()*562949953421312+((n&127)*4398046511104+((i&127)*34359738368+((s&127)*268435456+((r&127)<<21|(u&127)<<14|(o&127)<<7|d&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const d=this.u8(),o=d&128?1:0,u=127&d;if(u<=63)return[o,u];const r=this.u8();if(r<=127)return[o,r<<6|u&63];const s=this.u8();if(s<=127)return[o,s<<13|(r&127)<<6|u&63];const i=this.u8();if(i<=127)return[o,i<<20|(s&127)<<13|(r&127)<<6|u&63];const n=this.u8();if(n<=127)return[o,n*134217728+((i&127)<<20|(s&127)<<13|(r&127)<<6|u&63)];const t=this.u8();if(t<=127)return[o,t*17179869184+((n&127)*134217728+((i&127)<<20|(s&127)<<13|(r&127)<<6|u&63))];const a=this.u8();if(a<=127)return[o,a*2199023255552+((t&127)*17179869184+((n&127)*134217728+((i&127)<<20|(s&127)<<13|(r&127)<<6|u&63)))];const p=this.u8();return[o,p*281474976710656+((a&127)*2199023255552+((t&127)*17179869184+((n&127)*134217728+((i&127)<<20|(s&127)<<13|(r&127)<<6|u&63))))]}};return Rn.CrdtReader=c,Rn}var Tn={},In={},ca;function Th(){if(ca)return In;ca=1,Object.defineProperty(In,"__esModule",{value:!0}),In.decodeF16=void 0;const e=Math.pow,c=g=>{const d=(g&31744)>>10,o=g&1023;return(g>>15?-1:1)*(d?d===31?o?NaN:1/0:e(2,d-15)*(1+o/1024):6103515625e-14*(o/1024))};return In.decodeF16=c,In}var Or={},kn={},Rr={},da;function Ih(){if(da)return Rr;da=1,Object.defineProperty(Rr,"__esModule",{value:!0});const e=String.fromCharCode;return Rr.default=(c,g,d)=>{let o=g;const u=o+d;let r="";for(;o<u;){const s=c[o++];if((s&128)===0){r+=e(s);continue}const i=c[o++]&63;if((s&224)===192){r+=e((s&31)<<6|i);continue}const n=c[o++]&63;if((s&240)===224){r+=e((s&31)<<12|i<<6|n);continue}if((s&248)===240){const t=c[o++]&63;let a=(s&7)<<18|i<<12|n<<6|t;if(a>65535){a-=65536;const p=a>>>10&1023|55296;a=56320|a&1023,r+=e(p,a)}else r+=e(a)}else r+=e(s)}return r},Rr}var fa;function kh(){if(fa)return kn;fa=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.CachedUtf8Decoder=void 0;const c=re.__importDefault(Ih());let g=1+Math.round(Math.random()*((-1>>>0)-1));function d(r,s){return g^=g<<13,g^=g>>>17,g^=g<<5,(g>>>0)%(s-r+1)+r}class o{constructor(s,i){this.bytes=s,this.value=i}}let u=class{constructor(){this.caches=[];for(let s=0;s<31;s++)this.caches.push([])}get(s,i,n){const t=this.caches[n-1],a=t.length;e:for(let p=0;p<a;p++){const h=t[p],w=h.bytes;for(let b=0;b<n;b++)if(w[b]!==s[i+b])continue e;return h.value}return null}store(s,i){const n=this.caches[s.length-1],t=new o(s,i);n.length>=16?n[d(0,15)]=t:n.push(t)}decode(s,i,n){if(!n)return"";const t=this.get(s,i,n);if(t!==null)return t;const a=(0,c.default)(s,i,n),p=Uint8Array.prototype.slice.call(s,i,i+n);return this.store(p,a),a}};return kn.CachedUtf8Decoder=u,kn}var ha;function jh(){if(ha)return Or;ha=1,Object.defineProperty(Or,"__esModule",{value:!0});const e=kh();return Or.default=new e.CachedUtf8Decoder,Or}var pa;function ju(){if(pa)return Tn;pa=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.CborDecoderBase=void 0;const e=re,c=Th(),g=Ru(),d=fs(),o=Iu(),u=e.__importDefault(jh());let r=class{constructor(i=new o.Reader,n=u.default){this.reader=i,this.keyDecoder=n}read(i){return this.reader.reset(i),this.val()}decode(i){return this.reader.reset(i),this.val()}val(){const n=this.reader.u8(),t=n>>5,a=n&31;return t<4?t<2?t===0?this.readUint(a):this.readNint(a):t===2?this.readBin(a):this.readStr(a):t<6?t===4?this.readArr(a):this.readObj(a):t===6?this.readTag(a):this.readTkn(a)}readAnyRaw(i){const n=i>>5,t=i&31;return n<4?n<2?n===0?this.readUint(t):this.readNint(t):n===2?this.readBin(t):this.readStr(t):n<6?n===4?this.readArr(t):this.readObj(t):n===6?this.readTag(t):this.readTkn(t)}readMinorLen(i){if(i<24)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(i){if(i<25)return i===24?this.reader.u8():i;if(i<27)return i===25?this.reader.u16():this.reader.u32();{const n=this.reader.u64();return n>9007199254740991?n:Number(n)}}readNint(i){if(i<25)return i===24?-this.reader.u8()-1:-i-1;if(i<27)return i===25?-this.reader.u16()-1:-this.reader.u32()-1;{const n=this.reader.u64();return n>9007199254740991-1?-n-BigInt(1):-Number(n)-1}}readBin(i){const n=this.reader;if(i<=23)return n.buf(i);switch(i){case 24:return n.buf(n.u8());case 25:return n.buf(n.u16());case 26:return n.buf(n.u32());case 27:return n.buf(Number(n.u64()));case 31:{let t=0;const a=[];for(;this.reader.peak()!==255;){const b=this.readBinChunk();t+=b.length,a.push(b)}this.reader.x++;const p=new Uint8Array(t);let h=0;const w=a.length;for(let b=0;b<w;b++){const y=a[b];p.set(y,h),h+=y.length}return p}default:throw 1}}readBinChunk(){const i=this.reader.u8(),n=i>>5,t=i&31;if(n!==2)throw 2;if(t>27)throw 3;return this.readBin(t)}readAsStr(){const n=this.reader.u8(),t=n>>5,a=n&31;if(t!==3)throw 11;return this.readStr(a)}readStr(i){const n=this.reader;if(i<=23)return n.utf8(i);switch(i){case 24:return n.utf8(n.u8());case 25:return n.utf8(n.u16());case 26:return n.utf8(n.u32());case 27:return n.utf8(Number(n.u64()));case 31:{let t="";for(;n.peak()!==255;)t+=this.readStrChunk();return this.reader.x++,t}default:throw 1}}readStrLen(i){if(i<=23)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const i=this.reader.u8(),n=i>>5,t=i&31;if(n!==3)throw 4;if(t>27)throw 5;return this.readStr(t)}readArr(i){const n=this.readMinorLen(i);return n>=0?this.readArrRaw(n):this.readArrIndef()}readArrRaw(i){const n=[];for(let t=0;t<i;t++)n.push(this.val());return n}readArrIndef(){const i=[];for(;this.reader.peak()!==255;)i.push(this.val());return this.reader.x++,i}readObj(i){if(i<28){let n=i;switch(i){case 24:n=this.reader.u8();break;case 25:n=this.reader.u16();break;case 26:n=this.reader.u32();break;case 27:n=Number(this.reader.u64());break}const t={};for(let a=0;a<n;a++){const p=this.key();if(p==="__proto__")throw 6;const h=this.val();t[p]=h}return t}else{if(i===31)return this.readObjIndef();throw 1}}readObjRaw(i){const n={};for(let t=0;t<i;t++){const a=this.key(),p=this.val();n[a]=p}return n}readObjIndef(){const i={};for(;this.reader.peak()!==255;){const n=this.key();if(this.reader.peak()===255)throw 7;const t=this.val();i[n]=t}return this.reader.x++,i}key(){const i=this.reader.u8(),n=i>>5,t=i&31;if(n!==3)return String(this.readAnyRaw(i));const a=this.readStrLen(t);if(a>31)return this.reader.utf8(a);const p=this.keyDecoder.decode(this.reader.uint8,this.reader.x,a);return this.reader.skip(a),p}readTag(i){if(i<=23)return this.readTagRaw(i);switch(i){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(i){return new g.JsonPackExtension(i,this.val())}readTkn(i){switch(i){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new d.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(i<=23)return new d.JsonPackValue(i);throw 1}f16(){return(0,c.decodeF16)(this.reader.u16())}};return Tn.CborDecoderBase=r,Tn}var ma;function Vh(){if(ma)return Cn;ma=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.Decoder=void 0;const c=re.__importStar(ht()),g=Ch(),d=ku(),o=ue(),u=ws(),r=ju(),s=Eu();class i extends r.CborDecoderBase{constructor(){super(new d.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const t=this.ts(),a=this.val();return typeof a=="string"?new c.StrChunk(t,a.length,a):new c.StrChunk(t,~~a,"")},this.cBinChunk=()=>{const t=this.ts(),a=this.reader,[p,h]=a.b1vu56();return p?new c.BinChunk(t,h,void 0):new c.BinChunk(t,h,a.buf(h))},this.cArrChunk=()=>{const t=this.ts(),[a,p]=this.reader.b1vu56();if(a)return new c.ArrChunk(t,p,void 0);const h=[];for(let w=0;w<p;w++)h.push(this.cNode().id);return new c.ArrChunk(t,p,h)}}decode(t,a){this.clockDecoder=void 0,this.time=-1;const p=this.reader;if(p.reset(t),p.peak()&128){p.x++;const w=this.time=p.vu57();a||(a=u.Model.withServerClock(void 0,w))}else if(this.decodeClockTable(),!a){const w=this.clockDecoder.clock;a=u.Model.create(void 0,w)}return this.doc=a,a.root=new c.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,a}decodeClockTable(){const t=this.reader,a=t.u32(),p=t.x;t.x+=a;const h=t.vu57(),w=t.vu57(),b=t.vu57();this.clockDecoder=new g.ClockDecoder(w,b);for(let y=1;y<h;y++){const l=t.vu57(),f=t.vu57();this.clockDecoder.pushTuple(l,f)}t.x=p}ts(){if(this.time<0){const[p,h]=this.reader.id();return this.clockDecoder.decodeId(p,h)}else return new o.Timestamp(1,this.reader.vu57())}cRoot(){const t=this.reader;return t.uint8[t.x]?this.cNode():u.UNDEFINED}cNode(){const t=this.reader,a=this.ts(),p=t.u8(),h=p>>5,w=p&31;switch(h){case s.CRDT_MAJOR.CON:return this.cCon(a,w);case s.CRDT_MAJOR.VAL:return this.cVal(a);case s.CRDT_MAJOR.OBJ:return this.cObj(a,w!==31?w:t.vu57());case s.CRDT_MAJOR.VEC:return this.cVec(a,w!==31?w:t.vu57());case s.CRDT_MAJOR.STR:return this.cStr(a,w!==31?w:t.vu57());case s.CRDT_MAJOR.BIN:return this.cBin(a,w!==31?w:t.vu57());case s.CRDT_MAJOR.ARR:return this.cArr(a,w!==31?w:t.vu57())}throw new Error("UNKNOWN_NODE")}cCon(t,a){const p=this.doc,h=a?this.ts():this.val(),w=new c.ConNode(t,h);return p.index.set(t,w),w}cVal(t){const a=this.cNode(),p=this.doc,h=new c.ValNode(p,t,a.id);return p.index.set(t,h),h}cObj(t,a){const p=new c.ObjNode(this.doc,t);for(let h=0;h<a;h++)this.cObjChunk(p);return this.doc.index.set(t,p),p}cObjChunk(t){const a=this.key();t.keys.set(a,this.cNode().id)}cVec(t,a){const p=this.reader,h=new c.VecNode(this.doc,t),w=h.elements;for(let b=0;b<a;b++)p.peak()?w.push(this.cNode().id):(p.x++,w.push(void 0));return this.doc.index.set(t,h),h}cStr(t,a){const p=new c.StrNode(t);return a&&p.ingest(a,this.cStrChunk),this.doc.index.set(t,p),p}cBin(t,a){const p=new c.BinNode(t);return a&&p.ingest(a,this.cBinChunk),this.doc.index.set(t,p),p}cArr(t,a){const p=new c.ArrNode(this.doc,t);return a&&p.ingest(a,this.cArrChunk),this.doc.index.set(t,p),p}}return Cn.Decoder=i,Cn}var ga;function Ah(){if(ga)return vt;ga=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.decoder=vt.encoder=void 0;const e=xh(),c=Vh();return vt.encoder=new e.Encoder,vt.decoder=new c.Decoder,vt}var fi={},me={},jn={},Vn={},ba;function hs(){if(ba)return Vn;ba=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function c(g,d){return e.call(g,d)}return Vn.hasOwnProperty=c,Vn}var ya;function Vu(){if(ya)return jn;ya=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.get=void 0;const e=hs(),c=(g,d)=>{const o=d.length;let u;if(!o)return g;for(let r=0;r<o;r++)if(u=d[r],g instanceof Array){if(typeof u!="number"){if(u==="-")return;const s=~~u;if(""+s!==u)return;u=s}g=g[u]}else if(typeof g=="object"){if(!g||!(0,e.hasOwnProperty)(g,u))return;g=g[u]}else return;return g};return jn.get=c,jn}var hi={},va;function ps(){return va||(va=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=u,e.escapeComponent=r,e.parseJsonPointer=s,e.formatJsonPointer=i,e.isChild=t,e.isPathEqual=a,e.parent=h,e.isValidIndex=w;const c=/~1/g,g=/~0/g,d=/~/g,o=/\//g;function u(y){return y.indexOf("~")===-1?y:y.replace(c,"/").replace(g,"~")}function r(y){return y.indexOf("/")===-1&&y.indexOf("~")===-1?y:y.replace(d,"~0").replace(o,"~1")}function s(y){return y?y.slice(1).split("/").map(u):[]}function i(y){return(0,e.isRoot)(y)?"":"/"+y.map(l=>r(String(l))).join("/")}const n=y=>typeof y=="string"?s(y):y;e.toPath=n;function t(y,l){if(y.length>=l.length)return!1;for(let f=0;f<y.length;f++)if(y[f]!==l[f])return!1;return!0}function a(y,l){if(y.length!==l.length)return!1;for(let f=0;f<y.length;f++)if(y[f]!==l[f])return!1;return!0}const p=y=>!y.length;e.isRoot=p;function h(y){if(y.length<1)throw new Error("NO_PARENT");return y.slice(0,y.length-1)}function w(y){if(typeof y=="number")return!0;const l=Number.parseInt(y,10);return String(l)===y&&l>=0}const b=y=>{const l=y.length;let f=0,m;for(;f<l;){if(m=y.charCodeAt(f),m>=48&&m<=57){f++;continue}return!1}return!0};e.isInteger=b}(hi)),hi}var An={},pi={},mi={},wa;function Ph(){return wa||(wa=1,Object.defineProperty(mi,"__esModule",{value:!0})),mi}var gi={},_a;function Mh(){return _a||(_a=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const c=o=>{if(typeof o=="string"){if(o){if(o[0]!=="/")throw new Error("POINTER_INVALID");if(o.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(o)};e.validateJsonPointer=c;const{isArray:g}=Array,d=o=>{if(!g(o))throw new Error("Invalid path.");if(o.length>256)throw new Error("Path too long.");for(const u of o)switch(typeof u){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=d}(gi)),gi}var We={},Sa;function qh(){if(Sa)return We;Sa=1,Object.defineProperty(We,"__esModule",{value:!0}),We.isObjectReference=We.isArrayEnd=We.isArrayReference=We.find=void 0;const e=hs(),{isArray:c}=Array,g=(r,s)=>{const i=s.length;if(!i)return{val:r};let n,t;for(let p=0;p<i;p++)if(n=r,t=s[p],c(n)){const h=n.length;if(t==="-")t=h;else if(typeof t=="string"){const w=~~t;if(""+w!==t)throw new Error("INVALID_INDEX");if(t=w,t<0)throw new Error("INVALID_INDEX")}r=n[t]}else if(typeof n=="object"&&n)r=(0,e.hasOwnProperty)(n,t)?n[t]:void 0;else throw new Error("NOT_FOUND");return{val:r,obj:n,key:t}};We.find=g;const d=r=>c(r.obj)&&typeof r.key=="number";We.isArrayReference=d;const o=r=>r.obj.length===r.key;We.isArrayEnd=o;const u=r=>typeof r.obj=="object"&&typeof r.key=="string";return We.isObjectReference=u,We}var bi={},Pn={},xa;function Dh(){if(xa)return Pn;xa=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.findByPointer=void 0;const e=hs(),c=ps(),{isArray:g}=Array,d=(o,u)=>{if(!o)return{val:u};let r,s,i=0,n=1;for(;i>-1;)if(i=o.indexOf("/",n),s=i>-1?o.substring(n,i):o.substring(n),n=i+1,r=u,g(r)){const t=r.length;if(s==="-")s=t;else{const a=~~s;if(""+a!==s)throw new Error("INVALID_INDEX");if(s=a,s<0)throw"INVALID_INDEX"}u=r[s]}else if(typeof r=="object"&&r)s=(0,c.unescapeComponent)(s),u=(0,e.hasOwnProperty)(r,s)?r[s]:void 0;else throw"NOT_FOUND";return{val:u,obj:r,key:s}};return Pn.findByPointer=d,Pn}var Ca;function Bh(){return Ca||(Ca=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(Dh(),e)}(bi)),bi}var Oa;function Fh(){return Oa||(Oa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Ph(),e),c.__exportStar(ps(),e),c.__exportStar(Mh(),e),c.__exportStar(Vu(),e),c.__exportStar(qh(),e),c.__exportStar(Bh(),e)}(pi)),pi}var Ra;function Lh(){if(Ra)return An;Ra=1,Object.defineProperty(An,"__esModule",{value:!0}),An.find=void 0;const e=Fh(),c=ht(),g=(d,o)=>{const u=(0,e.toPath)(o);let r=d;const s=u.length;if(!s)return r;let i=0;for(;i<s&&r;){const n=u[i++];if(r=r.container(),!r)throw new Error("NOT_CONTAINER");if(r instanceof c.ObjNode){const t=r.get(String(n));if(!t)throw new Error("NOT_FOUND");r=t}else if(r instanceof c.ArrNode){const t=r.getNode(Number(n));if(!t)throw new Error("NOT_FOUND");r=t}else if(r instanceof c.VecNode){const t=r.get(Number(n));if(!t)throw new Error("NOT_FOUND");r=t}}return r};return An.find=g,An}var Mn={},He={},qn={},Na;function Au(){if(Na)return qn;Na=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(g){this.listeners.forEach(d=>d(g))}listen(g){const d=this.listeners;return d.add(g),()=>d.delete(g)}}return qn.FanOut=e,qn}var Ea;function Pu(){if(Ea)return He;Ea=1,Object.defineProperty(He,"__esModule",{value:!0}),He.OnNewFanOut=He.MapFanOut=He.MicrotaskBufferFanOut=He.MergeFanOut=void 0;const e=Au();class c extends e.FanOut{constructor(r){super(),this.fanouts=r,this.unsubs=[]}listen(r){this.listeners.size||(this.unsubs=this.fanouts.map(i=>i.listen(n=>this.emit(n))));const s=super.listen(r);return()=>{if(s(),!this.listeners.size){for(const i of this.unsubs)i();this.unsubs=[]}}}}He.MergeFanOut=c;class g extends e.FanOut{constructor(r){super(),this.source=r,this.buffer=[],this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(i=>{const n=this.buffer;n.length||queueMicrotask(()=>{this.emit(n),this.buffer=[]}),n.push(i)}));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.buffer=[],(r=this.unsub)==null||r.call(this),this.unsub=void 0}}He.MicrotaskBufferFanOut=g;class d extends e.FanOut{constructor(r,s){super(),this.source=r,this.mapper=s,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(i=>this.emit(this.mapper(i))));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),(r=this.unsub)==null||r.call(this),this.unsub=void 0}}He.MapFanOut=d;class o extends e.FanOut{constructor(r,s=void 0){super(),this.source=r,this.last=s,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(i=>{this.last!==i&&this.emit(this.last=i)}));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.last=void 0,(r=this.unsub)==null||r.call(this),this.unsub=void 0}}return He.OnNewFanOut=o,He}var Ta;function Uh(){if(Ta)return Mn;Ta=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.NodeEvents=void 0;const e=Pu();let c=class{constructor(d){this.api=d,this.subscribe=o=>this.onViewChanges.listen(()=>o()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Mn.NodeEvents=c,Mn}var Dn={},Bn={},Ia;function ms(){return Ia||(Ia=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.isUint8Array=void 0,Bn.isUint8Array=typeof Ne.Buffer=="function"?e=>e instanceof Uint8Array||Ne.Buffer.isBuffer(e):e=>e instanceof Uint8Array),Bn}var Fn={},yi={},Ln={},ka;function Mu(){if(ka)return Ln;ka=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.Encoder=void 0;const c=re.__importStar(Gt()),g=ds(),d=ue(),o=Nu();class u extends o.CborEncoder{constructor(s=new g.CrdtWriter){super(s),this.writer=s,this.patchSid=0}encode(s){this.writer.reset();const i=s.getId(),n=this.patchSid=i.sid,t=this.writer;t.vu57(n),t.vu57(i.time);const a=s.meta;return a===void 0?this.writeUndef():this.writeArr([a]),this.encodeOperations(s),t.flush()}encodeOperations(s){const i=s.ops,n=i.length;this.writer.vu57(n);for(let t=0;t<n;t++)this.encodeOperation(i[t])}encodeId(s){const i=s.sid,n=s.time,t=this.writer;i===this.patchSid?t.b1vu56(0,n):(t.b1vu56(1,n),t.vu57(i))}encodeTss(s){this.encodeId(s),this.writer.vu57(s.span)}writeInsStr(s,i,n,t){const a=this.writer;return s<=7?a.u8(96+s):(a.u8(96),a.vu57(s)),this.encodeId(i),this.encodeId(n),a.utf8(t)}encodeOperation(s){const i=this.writer;switch(s.constructor){case c.NewConOp:{const a=s.val;a instanceof d.Timestamp?(i.u8(1),this.encodeId(a)):(i.u8(0),this.writeAny(a));break}case c.NewValOp:{i.u8(8);break}case c.NewObjOp:{i.u8(16);break}case c.NewVecOp:{i.u8(24);break}case c.NewStrOp:{i.u8(32);break}case c.NewBinOp:{i.u8(40);break}case c.NewArrOp:{i.u8(48);break}case c.InsValOp:{const t=s;i.u8(72),this.encodeId(t.obj),this.encodeId(t.val);break}case c.InsObjOp:{const t=s,a=t.data,p=a.length;p<=7?i.u8(80+p):(i.u8(80),i.vu57(p)),this.encodeId(t.obj);for(let h=0;h<p;h++){const w=a[h];this.writeStr(w[0]),this.encodeId(w[1])}break}case c.InsVecOp:{const t=s,a=t.data,p=a.length;p<=7?i.u8(88+p):(i.u8(88),i.vu57(p)),this.encodeId(t.obj);for(let h=0;h<p;h++){const w=a[h];i.u8(w[0]),this.encodeId(w[1])}break}case c.InsStrOp:{const t=s,a=t.obj,p=t.ref,h=t.data,w=h.length;i.ensureCapacity(24+w*4);const b=i.x,y=this.writeInsStr(w,a,p,h);w!==y&&(i.x=b,this.writeInsStr(y,a,p,h));break}case c.InsBinOp:{const t=s,a=t.data,p=a.length;p<=7?i.u8(104+p):(i.u8(104),i.vu57(p)),this.encodeId(t.obj),this.encodeId(t.ref),i.buf(a,p);break}case c.InsArrOp:{const t=s,a=t.data,p=a.length;p<=7?i.u8(112+p):(i.u8(112),i.vu57(p)),this.encodeId(t.obj),this.encodeId(t.ref);for(let h=0;h<p;h++)this.encodeId(a[h]);break}case c.UpdArrOp:{const t=s;i.u8(120),this.encodeId(t.obj),this.encodeId(t.ref),this.encodeId(t.val);break}case c.DelOp:{const t=s,a=t.what,p=a.length;p<=7?i.u8(128+p):(i.u8(128),i.vu57(p)),this.encodeId(t.obj);for(let h=0;h<p;h++)this.encodeTss(a[h]);break}case c.NopOp:{const a=s.len;a<=7?i.u8(136+a):(i.u8(136),i.vu57(a));break}default:throw new Error("UNKNOWN_OP")}}}return Ln.Encoder=u,Ln}var Un={},$n={},ja;function $h(){if(ja)return $n;ja=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.CborDecoder=void 0;const e=ju(),c=fs();let g=class extends e.CborDecoderBase{readAsMap(){const o=this.reader.u8(),u=o>>5,r=o&31;switch(u){case 5:return this.readMap(r);default:throw 0}}readMap(o){const u=this.readMinorLen(o);return u>=0?this.readMapRaw(u):this.readMapIndef()}readMapRaw(o){const u=new Map;for(let r=0;r<o;r++){const s=this.val(),i=this.val();u.set(s,i)}return u}readMapIndef(){const o=new Map;for(;this.reader.peak()!==255;){const u=this.val();if(this.reader.peak()===255)throw 7;const r=this.val();o.set(u,r)}return this.reader.x++,o}skipN(o){for(let u=0;u<o;u++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(o){const u=o>>5,r=o&31;switch(u){case 0:case 1:this.skipUNint(r);break;case 2:this.skipBin(r);break;case 3:this.skipStr(r);break;case 4:this.skipArr(r);break;case 5:this.skipObj(r);break;case 7:this.skipTkn(r);break;case 6:this.skipTag(r);break}}skipMinorLen(o){if(o<=23)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(o){if(!(o<=23))switch(o){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(o){const u=this.skipMinorLen(o);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const o=this.reader.u8(),u=o>>5,r=o&31;if(u!==2)throw 2;if(r>27)throw 3;this.skipBin(r)}skipStr(o){const u=this.skipMinorLen(o);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const o=this.reader.u8(),u=o>>5,r=o&31;if(u!==3)throw 4;if(r>27)throw 5;this.skipStr(r)}skipArr(o){const u=this.skipMinorLen(o);if(u>=0)this.skipN(u);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(o){const u=this.readMinorLen(o);if(u>=0)return this.skipN(u*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(o){if(this.skipMinorLen(o)<0)throw 1;this.skipAny()}skipTkn(o){switch(o){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(o<=23))throw 1}validate(o,u=0,r=o.length){this.reader.reset(o),this.reader.x=u;const s=u;if(this.skipAny(),this.reader.x-s!==r)throw 8}decodeLevel(o){return this.reader.reset(o),this.readLevel()}readLevel(){const o=this.reader.u8(),u=o>>5,r=o&31;switch(u){case 4:return this.readArrLevel(r);case 5:return this.readObjLevel(r);default:return super.readAnyRaw(o)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const o=this.reader,u=o.x;this.skipAny();const r=o.x;return new c.JsonPackValue(o.uint8.subarray(u,r))}readObjLevel(o){const u=this.readMinorLen(o);return u>=0?this.readObjRawLevel(u):this.readObjIndefLevel()}readObjRawLevel(o){const u={};for(let r=0;r<o;r++){const s=this.key(),i=this.readPrimitiveOrVal();u[s]=i}return u}readObjIndefLevel(){const o={};for(;this.reader.peak()!==255;){const u=this.key();if(this.reader.peak()===255)throw 7;const r=this.readPrimitiveOrVal();o[u]=r}return this.reader.x++,o}readArrLevel(o){const u=this.readMinorLen(o);return u>=0?this.readArrRawLevel(u):this.readArrIndefLevel()}readArrRawLevel(o){const u=[];for(let r=0;r<o;r++)u.push(this.readPrimitiveOrVal());return u}readArrIndefLevel(){const o=[];for(;this.reader.peak()!==255;)o.push(this.readPrimitiveOrVal());return this.reader.x++,o}readHdr(o){const u=this.reader.u8();if(u>>5!==o)throw 0;const s=u&31;if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(o){const u=this.readObjHdr();for(let r=0;r<u;r++){if(this.key()===o)return this;this.skipAny()}throw 9}findIndex(o){const u=this.readArrHdr();if(o>=u)throw 10;for(let r=0;r<o;r++)this.skipAny();return this}find(o){for(let u=0;u<o.length;u++){const r=o[u];typeof r=="string"?this.findKey(r):this.findIndex(r)}return this}};return $n.CborDecoder=g,$n}var Va;function qu(){if(Va)return Un;Va=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.Decoder=void 0;const e=ku(),c=ue(),g=Mr(),d=$h();let o=class extends d.CborDecoder{constructor(r=new e.CrdtReader){super(r)}decode(r){return this.reader.reset(r),this.readPatch()}readPatch(){const r=this.reader,s=r.vu57(),i=r.vu57(),t=s===1?new c.ServerClockVector(1,i):new c.ClockVector(s,i);this.patchSid=t.sid;const a=this.builder=new g.PatchBuilder(t),p=this.val();return Array.isArray(p)&&(a.patch.meta=p[0]),this.decodeOperations(),a.patch}decodeId(){const r=this.reader,[s,i]=r.b1vu56();return s?new c.Timestamp(r.vu57(),i):new c.Timestamp(this.patchSid,i)}decodeTss(){const r=this.decodeId(),s=this.reader.vu57();return(0,c.interval)(r,0,s)}decodeOperations(){const s=this.reader.vu57();for(let i=0;i<s;i++)this.decodeOperation()}decodeOperation(){const r=this.builder,s=this.reader,i=s.u8();switch(i>>3){case 0:{const t=i&7;r.con(t?this.decodeId():this.val());break}case 1:{r.val();break}case 2:{r.obj();break}case 3:{r.vec();break}case 4:{r.str();break}case 5:{r.bin();break}case 6:{r.arr();break}case 9:{const t=this.decodeId(),a=this.decodeId();r.setVal(t,a);break}case 10:{const t=i&7||s.vu57(),a=this.decodeId(),p=[];for(let h=0;h<t;h++){const w=this.val();if(typeof w!="string")continue;const b=this.decodeId();p.push([w,b])}r.insObj(a,p);break}case 11:{const t=i&7||s.vu57(),a=this.decodeId(),p=[];for(let h=0;h<t;h++){const w=this.val();if(typeof w!="number")continue;const b=this.decodeId();p.push([w,b])}r.insVec(a,p);break}case 12:{const t=i&7||s.vu57(),a=this.decodeId(),p=this.decodeId(),h=s.utf8(t);r.insStr(a,p,h);break}case 13:{const t=i&7||s.vu57(),a=this.decodeId(),p=this.decodeId(),h=s.buf(t);if(!(h instanceof Uint8Array))return;r.insBin(a,p,h);break}case 14:{const t=i&7||s.vu57(),a=this.decodeId(),p=this.decodeId(),h=[];for(let w=0;w<t;w++)h.push(this.decodeId());r.insArr(a,p,h);break}case 15:{const t=this.decodeId(),a=this.decodeId(),p=this.decodeId();r.updArr(t,a,p);break}case 16:{const t=i&7||s.vu57(),a=this.decodeId(),p=[];for(let h=0;h<t;h++)p.push(this.decodeTss());r.del(a,p);break}case 17:{const t=i&7||s.vu57();r.nop(t);break}default:throw new Error("UNKNOWN_OP")}}};return Un.Decoder=o,Un}var vi={},Aa;function zh(){return Aa||(Aa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const c=Mu(),g=qu(),d=ds(),o=new d.CrdtWriter(1024*4);e.encoder=new c.Encoder(o);const u=s=>e.encoder.encode(s);e.encode=u,e.decoder=new g.Decoder;const r=s=>e.decoder.decode(s);e.decode=r}(vi)),vi}var Pa;function Gh(){return Pa||(Pa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Mu(),e),c.__exportStar(qu(),e),c.__exportStar(zh(),e)}(yi)),yi}var Ma;function Bu(){if(Ma)return Fn;Ma=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.Patch=void 0;const c=re.__importStar(Gt()),g=ue(),d=Je(),o=Gh();let u=class Du{constructor(){this.ops=[],this.meta=void 0}static fromBinary(s){return(0,o.decode)(s)}getId(){const s=this.ops[0];if(s)return s.id}span(){let s=0;for(const i of this.ops)s+=i.span();return s}nextTime(){const s=this.ops,i=s.length;if(!i)return 0;const n=s[i-1];return n.id.time+n.span()}rewriteTime(s){const i=new Du,n=this.ops,t=n.length,a=i.ops;for(let p=0;p<t;p++){const h=n[p];h instanceof c.DelOp?a.push(new c.DelOp(s(h.id),s(h.obj),h.what)):h instanceof c.NewConOp?a.push(new c.NewConOp(s(h.id),h.val instanceof g.Timestamp?s(h.val):h.val)):h instanceof c.NewVecOp?a.push(new c.NewVecOp(s(h.id))):h instanceof c.NewValOp?a.push(new c.NewValOp(s(h.id))):h instanceof c.NewObjOp?a.push(new c.NewObjOp(s(h.id))):h instanceof c.NewStrOp?a.push(new c.NewStrOp(s(h.id))):h instanceof c.NewBinOp?a.push(new c.NewBinOp(s(h.id))):h instanceof c.NewArrOp?a.push(new c.NewArrOp(s(h.id))):h instanceof c.InsArrOp?a.push(new c.InsArrOp(s(h.id),s(h.obj),s(h.ref),h.data.map(s))):h instanceof c.UpdArrOp?a.push(new c.UpdArrOp(s(h.id),s(h.obj),s(h.ref),s(h.val))):h instanceof c.InsStrOp?a.push(new c.InsStrOp(s(h.id),s(h.obj),s(h.ref),h.data)):h instanceof c.InsBinOp?a.push(new c.InsBinOp(s(h.id),s(h.obj),s(h.ref),h.data)):h instanceof c.InsValOp?a.push(new c.InsValOp(s(h.id),s(h.obj),s(h.val))):h instanceof c.InsObjOp?a.push(new c.InsObjOp(s(h.id),s(h.obj),h.data.map(([w,b])=>[w,s(b)]))):h instanceof c.InsVecOp?a.push(new c.InsVecOp(s(h.id),s(h.obj),h.data.map(([w,b])=>[w,s(b)]))):h instanceof c.NopOp&&a.push(new c.NopOp(s(h.id),h.len))}return i}rebase(s,i){const n=this.getId();if(!n)throw new Error("EMPTY_PATCH");const t=n.sid,a=n.time;if(i??(i=a),a===s)return this;const p=s-a;return this.rewriteTime(h=>{if(h.sid!==t)return h;const w=h.time;return w<i?h:(0,g.ts)(t,w+p)})}clone(){return this.rewriteTime(s=>s)}toBinary(){return(0,o.encode)(this)}toString(s=""){const i=this.getId();return`Patch ${i?(0,g.printTs)(i):"(nil)"}!${this.span()}`+(0,d.printTree)(s,this.ops.map(t=>a=>t.toString(a)))}};return Fn.Patch=u,Fn}var wi={},_i={},qa;function Wh(){return qa||(qa=1,Object.defineProperty(_i,"__esModule",{value:!0})),_i}var Da;function Pr(){return Da||(Da=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const c=re,g=ue();c.__exportStar(Wh(),e),e.ORIGIN=(0,g.ts)(0,0)}(wi)),wi}var Si={},Ba;function Fu(){return Ba||(Ba=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const c=ms(),g=ue(),d=r=>{switch(typeof r){case"number":case"boolean":case"undefined":return!0;case"object":return r===null||r instanceof g.Timestamp;default:return!1}};class o{constructor(s){this.build=s}}e.NodeBuilder=o;var u;(function(r){class s extends o{constructor(y){super(l=>l.con(y)),this.raw=y,this.type="con"}}r.con=s;class i extends o{constructor(y){super(l=>l.json(y)),this.raw=y,this.type="str"}}r.str=i;class n extends o{constructor(y){super(l=>l.json(y)),this.raw=y,this.type="bin"}}r.bin=n;class t extends o{constructor(y){super(l=>{const f=l.val(),m=y.build(l);return l.setVal(f,m),f}),this.value=y,this.type="val"}}r.val=t;class a extends o{constructor(y){super(l=>{const f=l.vec(),m=y.length;if(m){const v=[];for(let _=0;_<m;_++){const C=y[_].build(l);v.push([_,C])}l.insVec(f,v)}return f}),this.value=y,this.type="vec"}}r.vec=a;class p extends o{constructor(y,l){super(f=>{const m=f.obj(),v=[],_={...y,...l},S=Object.keys(_),C=S.length;if(C){for(let O=0;O<C;O++){const x=S[O],N=_[x].build(f);v.push([x,N])}f.insObj(m,v)}return m}),this.obj=y,this.opt=l,this.type="obj"}optional(){return this}}r.obj=p;class h extends o{constructor(y){super(l=>{const f=l.arr(),m=y.length;if(m){const v=[];for(let _=0;_<m;_++)v.push(y[_].build(l));l.insArr(f,f,v)}return f}),this.arr=y,this.type="arr"}}r.arr=h;class w extends o{constructor(y,l){super(f=>{const m=new Uint8Array([y,0,0]),v=f.vec();return m[1]=v.sid%256,m[2]=v.time%256,f.insVec(v,[[0,f.constOrJson(e.s.con(m))],[1,l.build(f)]]),v}),this.id=y,this.data=l,this.type="ext"}}r.ext=w})(u||(e.nodes=u={})),e.schema={con:r=>new u.con(r),str:r=>new u.str(r||""),bin:r=>new u.bin(r),val:r=>new u.val(r),vec:(...r)=>new u.vec(r),obj:(r,s)=>new u.obj(r,s),map:r=>e.schema.obj(r),arr:r=>new u.arr(r),json:r=>{switch(typeof r){case"object":{if(!r)return e.s.val(e.s.con(r));if(r instanceof o)return r;if(Array.isArray(r))return e.s.arr(r.map(s=>e.s.json(s)));if((0,c.isUint8Array)(r))return e.s.bin(r);if(r instanceof g.Timestamp)return e.s.val(e.s.con(r));{const s={},i=Object.keys(r);for(const n of i)s[n]=e.s.jsonCon(r[n]);return e.s.obj(s)}}case"string":return e.s.str(r);default:return e.s.val(e.s.con(r))}},jsonCon:r=>d(r)?e.s.con(r):e.s.json(r),ext:(r,s)=>new u.ext(r,s)},e.s=e.schema}(Si)),Si}var Fa;function Mr(){if(Fa)return Dn;Fa=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.PatchBuilder=void 0;const c=re.__importStar(Gt()),g=ue(),d=ms(),o=Bu(),u=Pr(),r=Fu(),s=n=>{switch(typeof n){case"number":case"boolean":return!0;default:return n===null}};let i=class{constructor(t){this.clock=t,this.patch=new o.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const t=this.patch;return this.patch=new o.Patch,t}obj(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewObjOp(t)),t}arr(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewArrOp(t)),t}vec(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewVecOp(t)),t}str(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewStrOp(t)),t}bin(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewBinOp(t)),t}con(t){this.pad();const a=this.clock.tick(1);return this.patch.ops.push(new c.NewConOp(a,t)),a}val(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewValOp(t)),t}root(t){return this.setVal(u.ORIGIN,t)}insObj(t,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new c.InsObjOp(p,t,a),w=h.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(h),p}insVec(t,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),h=new c.InsVecOp(p,t,a),w=h.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(h),p}setVal(t,a){this.pad();const p=this.clock.tick(1),h=new c.InsValOp(p,t,a);return this.patch.ops.push(h),p}insStr(t,a,p){if(!p.length)throw new Error("EMPTY_STRING");this.pad();const h=this.clock.tick(1),w=new c.InsStrOp(h,t,a,p),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),h}insBin(t,a,p){if(!p.length)throw new Error("EMPTY_BINARY");this.pad();const h=this.clock.tick(1),w=new c.InsBinOp(h,t,a,p),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),h}insArr(t,a,p){this.pad();const h=this.clock.tick(1),w=new c.InsArrOp(h,t,a,p),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),h}updArr(t,a,p){this.pad();const h=this.clock.tick(1),w=new c.UpdArrOp(h,t,a,p);return this.patch.ops.push(w),h}del(t,a){this.pad();const p=this.clock.tick(1);return this.patch.ops.push(new c.DelOp(p,t,a)),p}nop(t){this.pad();const a=this.clock.tick(t);return this.patch.ops.push(new c.NopOp(a,t)),a}jsonObj(t){const a=this.obj(),p=Object.keys(t);if(p.length){const h=[];for(const w of p){const b=t[w],y=b instanceof g.Timestamp?b:s(b)?this.con(b):this.json(b);h.push([w,y])}this.insObj(a,h)}return a}jsonArr(t){const a=this.arr();if(t.length){const p=[];for(const h of t)p.push(this.json(h));this.insArr(a,a,p)}return a}jsonStr(t){const a=this.str();return t&&this.insStr(a,a,t),a}jsonBin(t){const a=this.bin();return t.length&&this.insBin(a,a,t),a}jsonVal(t){const a=this.val(),p=this.con(t);return this.setVal(a,p),a}json(t){if(t instanceof g.Timestamp)return t;if(t===void 0)return this.con(t);if(t instanceof Array)return this.jsonArr(t);if((0,d.isUint8Array)(t))return this.jsonBin(t);if(t instanceof r.NodeBuilder)return t.build(this);switch(typeof t){case"object":return t===null?this.jsonVal(t):this.jsonObj(t);case"string":return this.jsonStr(t);case"number":case"boolean":return this.jsonVal(t)}throw new Error("INVALID_JSON")}constOrJson(t){return t instanceof g.Timestamp?t:s(t)?this.con(t):this.json(t)}maybeConst(t){return t instanceof g.Timestamp?t:this.con(t)}pad(){const t=this.patch.nextTime();if(!t)return;const a=this.clock.time-t;if(a>0){const p=(0,g.ts)(this.clock.sid,t),h=new c.NopOp(p,a);this.patch.ops.push(h)}}};return Dn.PatchBuilder=i,Dn}var zn={},La;function Hh(){if(La)return zn;La=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.ExtNode=void 0;const e=ue();let c=class{constructor(d){this.data=d,this.api=void 0,this.id=d.id}children(d){}child(){return this.data}container(){return this.data.container()}toString(d,o){return this.name()+(o?" "+(0,e.printTs)(o):"")+" "+this.data.toString(d)}};return zn.ExtNode=c,zn}var xi={},St={},Ci={},Oi={},Ua;function Jh(){return Ua||(Ua=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const c=Array.isArray,g=Object.prototype,d=(o,u)=>{if(o===u)return!0;let r=0,s=0;if(c(o)){if(!c(u)||(r=o.length,r!==u.length))return!1;for(s=r;s--!==0;)if(!(0,e.deepEqual)(o[s],u[s]))return!1;return!0}if(o&&u&&typeof o=="object"&&typeof u=="object"){e:{if(o.__proto__===g)break e;if(o instanceof Uint8Array){if(!(u instanceof Uint8Array))return!1;const n=o.length;if(n!==u.length)return!1;for(let t=0;t<n;t++)if(o[t]!==u[t])return!1;return!0}}const i=Object.keys(o);if(r=i.length,r!==Object.keys(u).length||c(u))return!1;for(s=r;s--!==0;){const n=i[s];if(!(0,e.deepEqual)(o[n],u[n]))return!1}return!0}return!1};e.deepEqual=d}(Oi)),Oi}var $a;function Kh(){return $a||($a=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(Jh(),e)}(Ci)),Ci}var Gn={},za;function Yh(){if(za)return Gn;za=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.cmpUint8Array=void 0;const e=(c,g)=>{const d=c.length;if(d!==g.length)return!1;for(let o=0;o<d;o++)if(c[o]!==g[o])return!1;return!0};return Gn.cmpUint8Array=e,Gn}var Ri={},Ni={},Ga;function Xh(){return Ga||(Ga=1,Object.defineProperty(Ni,"__esModule",{value:!0})),Ni}var Wa;function qr(){return Wa||(Wa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Xh(),e),c.__exportStar(ue(),e),c.__exportStar(Gt(),e),c.__exportStar(Bu(),e),c.__exportStar(Mr(),e),c.__exportStar(Fu(),e)}(Ri)),Ri}var Ei={},Ha;function gs(){return Ha||(Ha=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const c=l=>{const f=l.charCodeAt(0);return f>=56320&&f<=57343},g=l=>{const f=l.charCodeAt(l.length-1);return f>=55296&&f<=56319},d=(l,f)=>{l.push([0,""]);let m=0,v=0,_=0,S="",C="",O=0;for(;m<l.length;){if(m<l.length-1&&!l[m][1]){l.splice(m,1);continue}const N=l[m];switch(N[0]){case 1:_++,m++,C+=N[1];break;case-1:v++,m++,S+=N[1];break;case 0:{let E=m-_-v-1;if(f){const P=l[E];if(E>=0){let z=P[1];if(g(z)){const $=z.slice(-1);if(P[1]=z=z.slice(0,-1),S=$+S,C=$+C,!z){l.splice(E,1),m--;let X=E-1;const Z=l[X];if(Z){const K=Z[0];K===1?(_++,X--,C=Z[1]+C):K===-1&&(v++,X--,S=Z[1]+S)}E=X}}}const A=l[m],D=A[1];if(c(D)){const z=D.charAt(0);A[1]=D.slice(1),S+=z,C+=z}}if(m<l.length-1&&!l[m][1]){l.splice(m,1);break}const I=S.length>0,R=C.length>0;if(I||R){I&&R&&(O=(0,e.pfx)(C,S),O!==0&&(E>=0?l[E][1]+=C.slice(0,O):(l.splice(0,0,[0,C.slice(0,O)]),m++),C=C.slice(O),S=S.slice(O)),O=(0,e.sfx)(C,S),O!==0&&(l[m][1]=C.slice(C.length-O)+l[m][1],C=C.slice(0,C.length-O),S=S.slice(0,S.length-O)));const P=_+v,A=S.length,D=C.length;A===0&&D===0?(l.splice(m-P,P),m=m-P):A===0?(l.splice(m-P,P,[1,C]),m=m-P+1):D===0?(l.splice(m-P,P,[-1,S]),m=m-P+1):(l.splice(m-P,P,[-1,S],[1,C]),m=m-P+2)}const M=l[m-1];m!==0&&M[0]===0?(M[1]+=l[m][1],l.splice(m,1)):m++,_=0,v=0,S="",C="";break}}}l[l.length-1][1]===""&&l.pop();let x=!1;for(m=1;m<l.length-1;){const N=l[m-1],E=l[m+1];if(N[0]===0&&E[0]===0){const I=N[1],R=l[m],M=R[1],P=E[1];M.slice(M.length-I.length)===I?(l[m][1]=I+M.slice(0,M.length-I.length),E[1]=I+P,l.splice(m-1,1),x=!0):M.slice(0,P.length)===P&&(N[1]+=E[1],R[1]=M.slice(P.length)+P,l.splice(m+1,1),x=!0)}m++}x&&d(l,f)},o=(l,f,m,v)=>{const _=n(l.slice(0,m),f.slice(0,v),!1),S=n(l.slice(m),f.slice(v),!1);return _.concat(S)},u=(l,f)=>{const m=l.length,v=f.length,_=Math.ceil((m+v)/2),S=_,C=2*_,O=new Array(C),x=new Array(C);for(let A=0;A<C;A++)O[A]=-1,x[A]=-1;O[S+1]=0,x[S+1]=0;const N=m-v,E=N%2!==0;let I=0,R=0,M=0,P=0;for(let A=0;A<_;A++){for(let D=-A+I;D<=A-R;D+=2){const z=S+D;let $=0;const X=O[z-1],Z=O[z+1];D===-A||D!==A&&X<Z?$=Z:$=X+1;let K=$-D;for(;$<m&&K<v&&l.charAt($)===f.charAt(K);)$++,K++;if(O[z]=$,$>m)R+=2;else if(K>v)I+=2;else if(E){const Q=S+N-D,be=x[Q];if(Q>=0&&Q<C&&be!==-1&&$>=m-be)return o(l,f,$,K)}}for(let D=-A+M;D<=A-P;D+=2){const z=S+D;let $=D===-A||D!==A&&x[z-1]<x[z+1]?x[z+1]:x[z-1]+1,X=$-D;for(;$<m&&X<v&&l.charAt(m-$-1)===f.charAt(v-X-1);)$++,X++;if(x[z]=$,$>m)P+=2;else if(X>v)M+=2;else if(!E){const Z=S+N-D,K=O[Z];if(Z>=0&&Z<C&&K!==-1){const Q=S+K-Z;if($=m-$,K>=$)return o(l,f,K,Q)}}}}return[[-1,l],[1,f]]},r=(l,f)=>{if(!l)return[[1,f]];if(!f)return[[-1,l]];const m=l.length,v=f.length,_=m>v?l:f,S=m>v?f:l,C=S.length,O=_.indexOf(S);if(O>=0){const x=_.slice(0,O),N=_.slice(O+C);return m>v?[[-1,x],[0,S],[-1,N]]:[[1,x],[0,S],[1,N]]}return C===1?[[-1,l],[1,f]]:u(l,f)},s=(l,f)=>{if(!l||!f||l.charAt(0)!==f.charAt(0))return 0;let m=0,v=Math.min(l.length,f.length),_=v,S=0;for(;m<_;)l.slice(S,_)===f.slice(S,_)?(m=_,S=m):v=_,_=Math.floor((v-m)/2+m);const C=l.charCodeAt(_-1);return C>=55296&&C<=56319&&_--,_};e.pfx=s;const i=(l,f)=>{if(!l||!f||l.slice(-1)!==f.slice(-1))return 0;let m=0,v=Math.min(l.length,f.length),_=v,S=0;for(;m<_;)l.slice(l.length-_,l.length-S)===f.slice(f.length-_,f.length-S)?(m=_,S=m):v=_,_=Math.floor((v-m)/2+m);const C=l.charCodeAt(l.length-_);return C>=55296&&C<=56319&&_--,_};e.sfx=i;const n=(l,f,m)=>{if(l===f)return l?[[0,l]]:[];const v=(0,e.pfx)(l,f),_=l.slice(0,v);l=l.slice(v),f=f.slice(v);const S=(0,e.sfx)(l,f),C=l.slice(l.length-S);l=l.slice(0,l.length-S),f=f.slice(0,f.length-S);const O=r(l,f);return _&&O.unshift([0,_]),C&&O.push([0,C]),d(O,m),O},t=(l,f)=>n(l,f,!0);e.diff=t;const a=(l,f,m)=>{e:{if(m<0)break e;const v=l.length,_=f.length;if(v===_)break e;const S=f.slice(m),C=S.length;if(C>v||l.slice(v-C)!==S)break e;if(_>v){const N=v-C,E=l.slice(0,N),I=f.slice(0,N);if(E!==I)break e;const R=f.slice(N,m),M=[];return E&&M.push([0,E]),R&&M.push([1,R]),S&&M.push([0,S]),M}else{const N=_-C,E=f.slice(0,N),I=l.slice(0,N);if(I!==E)break e;const R=l.slice(N,v-C),M=[];return I&&M.push([0,I]),R&&M.push([-1,R]),S&&M.push([0,S]),M}}return(0,e.diff)(l,f)};e.diffEdit=a;const p=l=>{let f="";const m=l.length;for(let v=0;v<m;v++){const _=l[v];_[0]!==1&&(f+=_[1])}return f};e.src=p;const h=l=>{let f="";const m=l.length;for(let v=0;v<m;v++){const _=l[v];_[0]!==-1&&(f+=_[1])}return f};e.dst=h;const w=l=>{const f=l[0];return f===0?l:f===1?[-1,l[1]]:[1,l[1]]},b=l=>l.map(w);e.invert=b;const y=(l,f,m,v)=>{const _=l.length;let S=f;for(let C=_-1;C>=0;C--){const[O,x]=l[C];if(O===0)S-=x.length;else if(O===1)m(S,x);else{const N=x.length;S-=N,v(S,N,x)}}};e.apply=y}(Ei)),Ei}var Ti={},Ja;function Qh(){return Ja||(Ja=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const g=re.__importStar(gs()),d=n=>{let t="";const a=n.length;for(let p=0;p<a;p++)t+=String.fromCharCode(n[p]);return t};e.toStr=d;const o=n=>{const t=n.length,a=new Uint8Array(t);for(let p=0;p<t;p++)a[p]=n.charCodeAt(p);return a};e.toBin=o;const u=(n,t)=>{const a=(0,e.toStr)(n),p=(0,e.toStr)(t);return g.diff(a,p)};e.diff=u;const r=(n,t,a,p)=>g.apply(n,t,(h,w)=>a(h,(0,e.toBin)(w)),p);e.apply=r;const s=n=>(0,e.toBin)(g.src(n));e.src=s;const i=n=>(0,e.toBin)(g.dst(n));e.dst=i}(Ti)),Ti}var Ii={},Ka;function Zh(){return Ka||(Ka=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const g=re.__importStar(gs()),d=u=>{const r=[],s=u.length;let i=[];const n=(t,a)=>{if(!a.length)return;const p=i.length;if(p){const h=i[p-1];if(h[0]===t){h[1]+=a;return}}i.push([t,a])};e:for(let t=0;t<s;t++){const a=u[t],p=a[0],h=a[1],w=h.indexOf(`
`);if(w<0){n(p,h);continue e}else n(p,h.slice(0,w+1)),i.length&&r.push(i),i=[];let b=w;const y=h.length;t:for(;b<y;){const l=h.indexOf(`
`,b+1);if(l<0){n(p,h.slice(b+1));break t}r.push([[p,h.slice(b+1,l+1)]]),b=l}}i.length&&r.push(i);{const t=r.length;for(let a=0;a<t;a++){const p=r[a];let h=p.length;e:{if(h<2)break e;const w=p[0],b=p[1],y=b[0];if(w[0]===0&&(y===-1||y===1)){for(let l=2;l<h;l++)if(p[l][0]!==y)break e;for(let l=a+1;l<t;l++){const f=r[l],m=f.length,v=w[1];let _,S;if(f.length>1&&(_=f[0])[0]===y&&(S=f[1])[0]===0&&v===_[1])p.splice(0,1),b[1]=v+b[1],S[1]=v+S[1],f.splice(0,1);else for(let C=0;C<m;C++)if(f[C][0]!==y)break e}}}h=p.length;e:{if(h<2)break e;const w=p[p.length-1],b=w[1],y=p[p.length-2];if(w[0]===-1)for(let l=a+1;l<t;l++){const f=r[l],m=f.length;if(m<=1){if(f[0][0]!==-1)break e}else{const v=f[f.length-1];if(v[0]!==0)break e;for(let x=0;x<f.length-1;x++)if(f[x][0]!==-1)break e;let _=v[1];const S=_.endsWith(`
`);if(S||(_+=`
`),_.length>b.length||!b.endsWith(_))break e;const C=b.length-_.length;C<0?(w[0]=0,y[0]===0&&(y[1]+=b,p.splice(h-1,1))):C===0?(p.splice(h-1,1),y[0]===0?y[1]+=_:p.push([0,_])):(w[1]=b.slice(0,C),p.push([0,_]));const O=f[f.length-2];O[0]===-1?(O[1]+=S?_:_.slice(0,-1),f.splice(m-1,1)):v[0]=-1}}}}}return r};e.agg=d;const o=(u,r)=>{const s=u.join(`
`)+`
`,i=r.join(`
`)+`
`;if(s===i)return[];const n=g.diff(s,i),t=(0,e.agg)(n),a=t.length,p=[];let h=-1,w=-1;const b=u.length,y=r.length;for(let l=0;l<a;l++){const f=t[l];let m=f.length;if(!m)continue;const v=f[m-1],_=v[0],S=v[1];if(S===`
`)f.splice(m-1,1);else{const O=S.length;S[O-1]===`
`&&(O===1?f.splice(m-1,1):v[1]=S.slice(0,O-1))}let C=0;if(m=f.length,l+1===a)h+1<b?w+1<y?(C=m===1&&f[0][0]===0?0:2,h++,w++):(C=-1,h++):(C=1,w++);else{const x=f[0][0];m===1&&x===_&&x===0?(h++,w++):_===0?(C=2,h++,w++):_===1?(C=1,w++):_===-1&&(C=-1,h++)}p.push([C,h,w,f])}return p};e.diff=o}(Ii)),Ii}var ki={},Wn={},Ya;function bs(){if(Ya)return Wn;Ya=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.sort=void 0;const e=c=>{const g=c.length;for(let d=1;d<g;d++){const o=c[d];let u=d;for(;u!==0&&c[u-1]>o;)c[u]=c[u-1],u--;c[u]=o}return c};return Wn.sort=e,Wn}var ji={},Xa;function ys(){return Xa||(Xa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const c=bs();var g;(function(i){i[i.START_STATE=5381]="START_STATE",i[i.NULL=982452847]="NULL",i[i.TRUE=982453247]="TRUE",i[i.FALSE=982454243]="FALSE",i[i.ARRAY=982452259]="ARRAY",i[i.STRING=982453601]="STRING",i[i.OBJECT=982454533]="OBJECT",i[i.BINARY=982454837]="BINARY"})(g||(e.CONST=g={}));const d=(i,n)=>(i<<5)+i+n;e.updateNum=d;const o=(i,n)=>{const t=n.length;i=(0,e.updateNum)(i,g.STRING),i=(0,e.updateNum)(i,t);let a=t;for(;a;)i=(i<<5)+i+n.charCodeAt(--a);return i};e.updateStr=o;const u=(i,n)=>{const t=n.length;i=(0,e.updateNum)(i,g.BINARY),i=(0,e.updateNum)(i,t);let a=t;for(;a;)i=(i<<5)+i+n[--a];return i};e.updateBin=u;const r=(i,n)=>{switch(typeof n){case"number":return(0,e.updateNum)(i,n);case"string":return i=(0,e.updateNum)(i,g.STRING),(0,e.updateStr)(i,n);case"object":{if(n===null)return(0,e.updateNum)(i,g.NULL);if(Array.isArray(n)){const p=n.length;i=(0,e.updateNum)(i,g.ARRAY);for(let h=0;h<p;h++)i=(0,e.updateJson)(i,n[h]);return i}if(n instanceof Uint8Array)return(0,e.updateBin)(i,n);i=(0,e.updateNum)(i,g.OBJECT);const t=(0,c.sort)(Object.keys(n)),a=t.length;for(let p=0;p<a;p++){const h=t[p];i=(0,e.updateStr)(i,h),i=(0,e.updateJson)(i,n[h])}return i}case"boolean":return(0,e.updateNum)(i,n?g.TRUE:g.FALSE)}return i};e.updateJson=r;const s=i=>(0,e.updateJson)(g.START_STATE,i)>>>0;e.hash=s}(ji)),ji}var Vi={},Qa;function Lu(){return Qa||(Qa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const c=bs(),g=ys(),d=o=>{switch(typeof o){case"string":return(0,g.hash)(o).toString(36);case"number":case"bigint":return o.toString(36);case"boolean":return o?"T":"F";case"object":if(o===null)return"N";if(Array.isArray(o)){const u=o.length;let r="[";for(let s=0;s<u;s++)r+=(0,e.structHash)(o[s])+",";return r+"]"}else{if(o instanceof Uint8Array)return(0,g.hash)(o).toString(36);{const u=Object.keys(o);(0,c.sort)(u);let r="{";const s=u.length;for(let i=0;i<s;i++){const n=u[i];r+=(0,g.hash)(n).toString(36)+":"+(0,e.structHash)(o[n])+","}return r+"}"}}default:return"U"}};e.structHash=d}(Vi)),Vi}var Za;function ep(){return Za||(Za=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const c=bs(),g=Hu(),d=ys(),o=Lu(),u=r=>{if(r instanceof g.ConNode)return(0,o.structHash)(r.val);if(r instanceof g.ValNode)return(0,e.structHashCrdt)(r.node());if(r instanceof g.StrNode)return(0,d.hash)(r.view()).toString(36);if(r instanceof g.ObjNode){let s="{";const i=Array.from(r.keys.keys());(0,c.sort)(i);const n=i.length;for(let t=0;t<n;t++){const a=i[t],p=r.get(a);s+=(0,d.hash)(a).toString(36)+":"+(0,e.structHashCrdt)(p)+","}return s+"}"}else if(r instanceof g.ArrNode||r instanceof g.VecNode){let s="[";return r.children(i=>{s+=(0,e.structHashCrdt)(i)+","}),s+"]"}else if(r instanceof g.BinNode)return(0,d.hash)(r.view()).toString(36);return"U"};e.structHashCrdt=u}(ki)),ki}var Ai={},el;function tp(){return el||(el=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(ys(),e),c.__exportStar(Lu(),e)}(Ai)),Ai}var tl;function np(){if(tl)return St;tl=1,Object.defineProperty(St,"__esModule",{value:!0}),St.JsonCrdtDiff=St.DiffError=void 0;const e=re,c=Kh(),g=Yh(),d=qr(),o=ht(),u=e.__importStar(gs()),r=e.__importStar(Qh()),s=e.__importStar(Zh()),i=ep(),n=tp();class t extends Error{constructor(h="DIFF"){super(h)}}St.DiffError=t;let a=class{constructor(h){this.model=h,this.builder=new d.PatchBuilder(h.clock.clone())}diffStr(h,w){const b=h.view();if(b===w)return;const y=this.builder;u.apply(u.diff(b,w),b.length,(l,f)=>y.insStr(h.id,l?h.find(l-1):h.id,f),(l,f)=>y.del(h.id,h.findInterval(l,f)))}diffBin(h,w){const b=h.view();if((0,g.cmpUint8Array)(b,w))return;const y=this.builder;r.apply(r.diff(b,w),b.length,(l,f)=>y.insBin(h.id,l?h.find(l-1):h.id,f),(l,f)=>y.del(h.id,h.findInterval(l,f)))}diffArr(h,w){const b=[];h.children(O=>{b.push((0,i.structHashCrdt)(O))});const y=[],l=w.length;for(let O=0;O<l;O++)y.push((0,n.structHash)(w[O]));const f=s.diff(b,y);if(!f.length)return;const m=[],v=[],_=f.length;for(let O=_-1;O>=0;O--){const[x,N,E]=f[O];switch(x){case 0:break;case 1:{const I=w[E],R=N>=0?h.find(N):h.id;if(!R)throw new t;m.push([R,[I]]);break}case-1:{const I=h.findInterval(N,1);if(!I||!I.length)throw new t;v.push(...I);break}case 2:{const I=w[E];try{this.diffAny(h.getNode(N),I)}catch(R){if(R instanceof t){const M=h.findInterval(N,1);v.push(...M);const P=N?h.find(N-1):h.id;if(!P)throw new t;m.push([P,[I]])}else throw R}}}}const S=this.builder,C=m.length;for(let O=0;O<C;O++){const[x,N]=m[O];S.insArr(h.id,x,N.map(E=>S.json(E)))}v.length&&S.del(h.id,v)}diffObj(h,w){const b=this.builder,y=[],l=new Set;h.forEach(v=>{l.add(v),w[v]===void 0&&y.push([v,b.con(void 0)])});const f=Object.keys(w),m=f.length;for(let v=0;v<m;v++){const _=f[v],S=w[_];if(l.has(_)){const C=h.get(_);if(C)try{this.diffAny(C,S);continue}catch(O){if(!(O instanceof t))throw O}}y.push([_,h.get(_)instanceof o.ConNode?b.con(S):b.constOrJson(S)])}y.length&&b.insObj(h.id,y)}diffVec(h,w){const b=this.builder,y=[],l=h.elements,f=l.length,m=w.length,v=h.doc.index,_=Math.min(f,m);for(let S=m;S<f;S++){const C=l[S];if(C){const O=v.get(C);if(!O||O instanceof o.ConNode&&O.val===void 0)return;y.push([S,b.con(void 0)])}}for(let S=0;S<_;S++){const C=w[S],O=h.get(S);if(O)try{this.diffAny(O,C);continue}catch(x){if(!(x instanceof t))throw x}y.push([S,b.constOrJson(C)])}for(let S=f;S<m;S++)y.push([S,b.constOrJson(w[S])]);y.length&&b.insVec(h.id,y)}diffVal(h,w){try{this.diffAny(h.node(),w)}catch(b){if(b instanceof t){const y=this.builder;y.setVal(h.id,y.constOrJson(w))}else throw b}}diffAny(h,w){if(h instanceof o.ConNode){if(h.val!==w&&!(0,c.deepEqual)(h.val,w))throw new t}else if(h instanceof o.StrNode){if(typeof w!="string")throw new t;this.diffStr(h,w)}else if(h instanceof o.ObjNode){if(!w||typeof w!="object"||Array.isArray(w))throw new t;this.diffObj(h,w)}else if(h instanceof o.ValNode)this.diffVal(h,w);else if(h instanceof o.ArrNode){if(!Array.isArray(w))throw new t;this.diffArr(h,w)}else if(h instanceof o.VecNode){if(!Array.isArray(w))throw new t;this.diffVec(h,w)}else if(h instanceof o.BinNode){if(!(w instanceof Uint8Array))throw new t;this.diffBin(h,w)}else throw new t}diff(h,w){return this.diffAny(h,w),this.builder.flush()}};return St.JsonCrdtDiff=a,St}var nl;function rp(){return nl||(nl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const c=np(),g=(o,u)=>{const s=new c.JsonCrdtDiff(o.api.model).diff(o.node,u);return s.ops.length?s:void 0};e.diff=g;const d=(o,u)=>{const r=(0,e.diff)(o,u);return r&&o.api.model.applyPatch(r),r};e.merge=d}(xi)),xi}var Pi={},rl;function ip(){return rl||(rl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const c=(d,o=[])=>new Proxy(()=>{},{get:(u,r,s)=>(o.push(String(r)),(0,e.proxy)(d,o)),apply:(u,r,s)=>d(o,...s)});e.proxy=c;const g=(d,o,u=[])=>new Proxy({},{get:(r,s,i)=>s===o?d(u):(u.push(String(s)),(0,e.proxy$)(d,o,u))});e.proxy$=g}(Pi)),Pi}var il;function sp(){if(il)return me;il=1,Object.defineProperty(me,"__esModule",{value:!0}),me.ModelApi=me.ArrApi=me.BinApi=me.StrApi=me.ObjApi=me.VecApi=me.ValApi=me.ConApi=me.NodeApi=void 0;const e=re,c=Je(),g=Vu(),d=ps(),o=Lh(),u=ue(),r=ht(),s=Uh(),i=Au(),n=Mr(),t=Pu(),a=Hh(),p=e.__importStar(rp()),h=ip(),w=O=>{if(!O)return[void 0,""];if(typeof O=="number")return[void 0,O];switch(typeof O=="string"&&(O=(0,d.toPath)(O)),O.length){case 0:return[void 0,""];case 1:return[void 0,O[0]];default:{const x=O[O.length-1];return[O.slice(0,-1),x]}}};class b{constructor(x,N){this.node=x,this.api=N,this.ev=void 0}get events(){return this.ev||(this.ev=new s.NodeEvents(this))}find(x){let N=this.node;if(x===void 0){if(typeof N.child=="function"){const E=N.child();if(!E){if(N instanceof r.RootNode)return N;throw new Error("NO_CHILD")}return E}throw new Error("CANNOT_IN")}for(typeof x=="string"&&x&&x[0]!=="/"&&(x="/"+x),typeof x=="number"&&(x=[x]);N instanceof r.ValNode;)N=N.child();return(0,o.find)(N,x)}in(x){const N=this.find(x);return this.api.wrap(N)}asVal(){if(this.node instanceof r.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof r.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof r.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof r.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof r.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof r.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof r.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(x){let N;const E=this.node;if(E instanceof a.ExtNode&&(N=E),E instanceof r.VecNode&&(N=E.ext()),!N)throw new Error("NOT_EXT");const I=this.api.wrap(N);if(!x||I instanceof x.Api)return I;throw new Error("NOT_EXT")}val(x){return this.in(x).asVal()}str(x){return this.in(x).asStr()}bin(x){return this.in(x).asBin()}arr(x){return this.in(x).asArr()}vec(x){return this.in(x).asVec()}obj(x){return this.in(x).asObj()}con(x){return this.in(x).asCon()}view(){return this.node.view()}select(x,N){try{let E=x!==void 0?this.find(x):this.node;if(N)for(;E instanceof r.ValNode;)E=E.child();return this.api.wrap(E)}catch{return}}read(x){const N=this.view();if(Array.isArray(x))return(0,g.get)(N,x);if(!x)return N;let E=x+"";return x&&E[0]!=="/"&&(E="/"+E),(0,g.get)(N,(0,d.toPath)(E))}add(x,N){const[E,I]=w(x);e:try{const R=this.select(E,!0);if(R instanceof m)R.set({[I]:N});else if(R instanceof S||R instanceof v||R instanceof _){const M=R.length();let P=0;if(typeof I=="number")P=I;else if(I==="-")P=M;else if(P=~~I,P+""!==I)break e;if(P!==P)break e;if(P<0&&(P=0),P>M&&(P=M),R instanceof S)R.ins(P,Array.isArray(N)?N:[N]);else if(R instanceof v)R.ins(P,N+"");else if(R instanceof _){if(!(N instanceof Uint8Array))break e;R.ins(P,N)}}else if(R instanceof f)R.set([[~~I,N]]);else break e;return!0}catch{}return!1}replace(x,N){const[E,I]=w(x);e:try{const R=this.select(E,!0);if(R instanceof m){const M=I+"";if(!R.has(M))break e;R.set({[I]:N})}else if(R instanceof S){const M=R.length();let P=0;if(typeof I=="number")P=I;else if(P=~~I,P+""!==I)break e;if(P!==P||P<0||P>M)break e;P===M?R.ins(P,[N]):R.upd(P,N)}else if(R instanceof f)R.set([[~~I,N]]);else break e;return!0}catch{}return!1}remove(x,N=1){const[E,I]=w(x);e:try{const R=this.select(E,!0);if(R instanceof m){const M=I+"";if(!R.has(M))break e;R.del([M])}else if(R instanceof S||R instanceof v||R instanceof _){const M=R.length();let P=0;if(typeof I=="number")P=I;else if(I==="-")P=N;else if(P=~~I,P+""!==I)break e;if(P!==P||P<0||P>M)break e;R.del(P,Math.min(N,M-P))}else if(R instanceof f)R.set([[~~I,void 0]]);else break e;return!0}catch{}return!1}diff(x){return p.diff(this,x)}merge(x){return p.merge(this,x)}op(x){var R;if(!Array.isArray(x))return!1;const[N,E,I]=x;switch(N){case"add":return this.add(E,I);case"replace":return this.replace(E,I);case"merge":return!!((R=this.select(E))!=null&&R.merge(I));case"remove":return this.remove(E,I)}}get s(){return{$:this}}get $(){return(0,h.proxy$)(x=>{try{return this.api.wrap(this.find(x))}catch{return}},"$")}toString(x=""){return"api("+(this.constructor===b?"*":this.node.name())+")"+(0,c.printTree)(x,[E=>this.node.toString(E)])}}me.NodeApi=b;class y extends b{get s(){return{$:this}}}me.ConApi=y;class l extends b{get(){return this.in()}set(x){const{api:N,node:E}=this,R=N.builder.constOrJson(x);N.builder.setVal(E.id,R),N.apply()}get s(){const x=this;return{$:this,get _(){const E=x.node.node();return x.api.wrap(E).s}}}}me.ValApi=l;class f extends b{get(x){return this.in(x)}set(x){const{api:N,node:E}=this,{builder:I}=N;I.insVec(E.id,x.map(([R,M])=>[R,I.constOrJson(M)])),N.apply()}push(...x){const N=this.length();this.set(x.map((E,I)=>[N+I,E]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(N,E,I)=>{if(E==="$")return this;if(E==="toExt")return()=>this.asExt();const R=Number(E);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const M=this.node.get(R);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}me.VecApi=f;class m extends b{get(x){return this.in(x)}set(x){const{api:N,node:E}=this,{builder:I}=N;I.insObj(E.id,Object.entries(x).map(([R,M])=>[R,I.constOrJson(M)])),N.apply()}del(x){const{api:N,node:E}=this,{builder:I}=N;N.builder.insObj(E.id,x.map(R=>[R,I.con(void 0)])),N.apply()}has(x){return this.node.keys.has(x)}get s(){return new Proxy({},{get:(N,E,I)=>{if(E==="$")return this;const R=String(E),M=this.node.get(R);if(!M)throw new Error("NO_SUCH_KEY");return this.api.wrap(M).s}})}}me.ObjApi=m;class v extends b{ins(x,N){const{api:E,node:I}=this;E.onBeforeLocalChange.emit(E.next);const R=E.builder;R.pad();const M=E.builder.nextTime(),P=new u.Timestamp(R.clock.sid,M),A=I.insAt(x,P,N);if(!A)throw new Error("OUT_OF_BOUNDS");R.insStr(I.id,A,N),E.advance()}del(x,N){const{api:E,node:I}=this;E.onBeforeLocalChange.emit(E.next);const R=E.builder;R.pad();const M=I.findInterval(x,N);if(!M)throw new Error("OUT_OF_BOUNDS");I.delete(M),R.del(I.id,M),E.advance()}findId(x){const N=this.node,I=N.length()-1;return x>I&&(x=I),x<0?N.id:N.find(x)||N.id}findPos(x){const N=this.node,E=N.id;if(E.sid===x.sid&&E.time===x.time)return-1;const I=N.findById(x);return I?N.pos(I)+(I.del?0:x.time-I.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}me.StrApi=v;class _ extends b{ins(x,N){const{api:E,node:I}=this,R=x?I.find(x-1):I.id;if(!R)throw new Error("OUT_OF_BOUNDS");E.builder.insBin(I.id,R,N),E.apply()}del(x,N){const{api:E,node:I}=this,R=I.findInterval(x,N);if(!R)throw new Error("OUT_OF_BOUNDS");E.builder.del(I.id,R),E.apply()}length(){return this.node.length()}get s(){return{$:this}}}me.BinApi=_;class S extends b{get(x){return this.in(x)}ins(x,N){const{api:E,node:I}=this,{builder:R}=E,M=x?I.find(x-1):I.id;if(!M)throw new Error("OUT_OF_BOUNDS");const P=[];for(let A=0;A<N.length;A++)P.push(R.json(N[A]));R.insArr(I.id,M,P),E.apply()}push(...x){const N=this.length();this.ins(N,x)}upd(x,N){const{api:E,node:I}=this,R=I.getId(x);if(!R)throw new Error("OUT_OF_BOUNDS");const{builder:M}=E;M.updArr(I.id,R,M.constOrJson(N)),E.apply()}del(x,N){const{api:E,node:I}=this,R=I.findInterval(x,N);if(!R)throw new Error("OUT_OF_BOUNDS");E.builder.del(I.id,R),E.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(N,E,I)=>{if(E==="$")return this;const R=Number(E);if(Number.isNaN(R))throw new Error("INVALID_INDEX");const M=this.node.getNode(R);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}me.ArrApi=S;class C extends l{constructor(x){super(x.root,void 0),this.model=x,this.next=0,this.onBeforeReset=new i.FanOut,this.onReset=new i.FanOut,this.onBeforePatch=new i.FanOut,this.onPatch=new i.FanOut,this.onBeforeLocalChange=new i.FanOut,this.onLocalChange=new i.FanOut,this.onLocalChanges=new t.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new i.FanOut,this.onTransaction=new i.FanOut,this.onChange=new t.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new t.MicrotaskBufferFanOut(this.onChange),this.onFlush=new i.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=N=>this.onChanges.listen(()=>N()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new n.PatchBuilder(x.clock),x.onbeforereset=()=>this.onBeforeReset.emit(),x.onreset=()=>this.onReset.emit(),x.onbeforepatch=N=>this.onBeforePatch.emit(N),x.onpatch=N=>this.onPatch.emit(N)}wrap(x){if(x instanceof r.ValNode)return x.api||(x.api=new l(x,this));if(x instanceof r.StrNode)return x.api||(x.api=new v(x,this));if(x instanceof r.BinNode)return x.api||(x.api=new _(x,this));if(x instanceof r.ArrNode)return x.api||(x.api=new S(x,this));if(x instanceof r.ObjNode)return x.api||(x.api=new m(x,this));if(x instanceof r.ConNode)return x.api||(x.api=new y(x,this));if(x instanceof r.VecNode)return x.api||(x.api=new f(x,this));if(x instanceof a.ExtNode){if(x.api)return x.api;const N=this.model.ext.get(x.extId);return x.api=new N.Api(x,this)}else throw new Error("UNKNOWN_NODE")}root(x){return this.set(x)}set(x){return super.set(x),this}apply(){const x=this.builder.patch.ops,N=x.length,E=this.model,I=this.next;this.onBeforeLocalChange.emit(I);for(let R=this.next;R<N;R++)E.applyOperation(x[R]);this.next=N,E.tick++,this.onLocalChange.emit(I)}advance(){const x=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(x)}transaction(x){if(this.inTx)x();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),x(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const x=this.builder.flush();return this.next=0,x.ops.length&&this.onFlush.emit(x),x}autoFlush(x=!1){const N=()=>this.builder.patch.ops.length&&this.flush(),E=this.onLocalChanges.listen(N),I=this.onBeforeTransaction.listen(N),R=this.onTransaction.listen(N);return x&&N(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,E(),I(),R()}}}return me.ModelApi=C,me}var sl;function Uu(){return sl||(sl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(sp(),e)}(fi)),fi}var Hn={},ol;function op(){if(ol)return Hn;ol=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.randomSessionId=void 0;const e=65535,c=9007199254740991-e,g=()=>Math.floor(c*Math.random()+e);return Hn.randomSessionId=g,Hn}var Jn={},al;function ap(){if(al)return Jn;al=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.Extensions=void 0;const e=Je();let c=class $u{constructor(){this.ext={}}register(d){this.ext[d.id]=d}get(d){return this.ext[d]}size(){return Object.keys(this.ext).length}clone(){const d=new $u;for(const o of Object.values(this.ext))d.register(o);return d}toString(d=""){const o=Object.keys(this.ext).map(u=>+u).sort();return"extensions"+(0,e.printTree)(d,o.map(u=>r=>`${u}: ${this.ext[u].name}`))}};return Jn.Extensions=c,Jn}var xt={},Mi={},qi={},Kn={},ll;function vs(){if(ll)return Kn;ll=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.printBinary=void 0;const e=(c="",g)=>{const d=g[0],o=g[1];let u="";return d&&(u+=`
`+c+"← "+d(c+"  ")),o&&(u+=`
`+c+"→ "+o(c+"  ")),u};return Kn.printBinary=e,Kn}var ul;function lp(){return ul||(ul=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(vs(),e)}(qi)),qi}var cl;function up(){return cl||(cl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const c=lp(),g=JSON.stringify,d=(b,y,l)=>{const f=y.p;if(!f)return b;const m=y===f.l;let v=f.bf|0;switch(m?f.bf=++v:f.bf=--v,v){case 0:return b;case 1:case-1:return d(b,f,y);default:{const _=l===y.l;return m?_?(o(f,y),y.p?b:y):(r(f,y,l),l.p?b:l):_?(s(f,y,l),l.p?b:l):(u(f,y),y.p?b:y)}}},o=(b,y)=>{const l=b.p,f=y.r;y.p=l,y.r=b,b.p=y,b.l=f,f&&(f.p=b),l&&(l.l===b?l.l=y:l.r=y);let m=b.bf,v=y.bf;m+=-1-(v>0?v:0),v+=-1+(m<0?m:0),b.bf=m,y.bf=v},u=(b,y)=>{const l=b.p,f=y.l;y.p=l,y.l=b,b.p=y,b.r=f,f&&(f.p=b),l&&(l.l===b?l.l=y:l.r=y);let m=b.bf,v=y.bf;m+=1-(v<0?v:0),v+=1+(m>0?m:0),b.bf=m,y.bf=v},r=(b,y,l)=>{u(y,l),o(b,l)},s=(b,y,l)=>{o(y,l),u(b,l)},i=(b,y,l)=>(l.r=y,y.p=l,l.bf--,l.l?b:d(b,l,y));e.insertRight=i;const n=(b,y,l)=>(l.l=y,y.p=l,l.bf++,l.r?b:d(b,l,y));e.insertLeft=n;const t=(b,y,l)=>{if(!b)return y;const f=y.k;let m=b,v,_=0;for(;v=(_=l(f,m.k))<0?m.l:m.r;)m=v;return _<0?(0,e.insertLeft)(b,y,m):(0,e.insertRight)(b,y,m)};e.insert=t;const a=(b,y)=>{if(!b)return y;const l=y.p,f=y.l,m=y.r;if(y.p=y.l=y.r=void 0,f&&m)if(f.r){let S=f,C=S;for(;C=S.r;)S=C;const O=S.l,x=S.p,N=O;return l&&(l.l===y?l.l=S:l.r=S),S.p=l,S.r=m,S.bf=y.bf,f!==S&&(S.l=f,f.p=S),m.p=S,x&&(x.l===S?x.l=N:x.r=N),N&&(N.p=x),h(l?b:S,x,1)}else{l&&(l.l===y?l.l=f:l.r=f),f.p=l,f.r=m,m.p=f;const S=y.bf;if(l)return f.bf=S,p(b,f,1);const C=S-1;if(f.bf=C,C>=-1)return f;const O=m.l;return m.bf>0?(s(f,m,O),O):(u(f,m),m)}const v=f||m;return v&&(v.p=l),l?l.l===y?(l.l=v,p(b,l,1)):(l.r=v,h(b,l,1)):v};e.remove=a;const p=(b,y,l)=>{let f=y.bf|0;f-=l,y.bf=f;let m=l;if(f===-1)return b;if(f<-1){const _=y.r;if(_.bf<=0)_.l&&_.bf===0&&(m=0),u(y,_),y=_;else{const S=_.l;s(y,_,S),y=S}}const v=y.p;return v?v.l===y?p(b,v,m):h(b,v,m):y},h=(b,y,l)=>{let f=y.bf|0;f+=l,y.bf=f;let m=l;if(f===1)return b;if(f>1){const _=y.l;if(_.bf>=0)_.r&&_.bf===0&&(m=0),o(y,_),y=_;else{const S=_.r;r(y,_,S),y=S}}const v=y.p;return v?v.l===y?p(b,v,m):h(b,v,m):y},w=(b,y="")=>{if(!b)return"∅";const{bf:l,l:f,r:m,k:v,v:_}=b,S=_&&typeof _=="object"&&_.constructor===Object?g(_):_&&typeof _=="object"?_.toString(y):g(_),C=v!==void 0?` { ${g(v)} = ${S} }`:"",O=l?` [${l}]`:"";return b.constructor.name+`${O}`+C+(0,c.printBinary)(y,[f?x=>(0,e.print)(f,x):null,m?x=>(0,e.print)(m,x):null])};e.print=w}(Mi)),Mi}var Yn={},Di={},Xn={},dl;function zu(){if(dl)return Xn;dl=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.first=void 0;const e=c=>{let g=c;for(;g;)if(g.l)g=g.l;else return g;return g};return Xn.first=e,Xn}var Qn={},fl;function cp(){if(fl)return Qn;fl=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.next=void 0;const e=zu(),c=g=>{const d=g.r;if(d)return(0,e.first)(d);let o=g.p;for(;o&&o.r===g;)g=o,o=o.p;return o};return Qn.next=c,Qn}var hl;function Gu(){return hl||(hl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const c=zu();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return c.first}});const g=cp();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return g.next}});const d=h=>{let w=h;for(;w;)if(w.r)w=w.r;else return w;return w};e.last=d;const o=h=>{if(h.l){for(h=h.l;h.r;)h=h.r;return h}let w=h.p;for(;w&&w.l===h;)h=w,w=w.p;return w};e.prev=o;const u=h=>{const w=h.l,b=h.r;return 1+(w?u(w):0)+(b?u(b):0)},r=h=>h?u(h):0;e.size=r;const s=(h,w,b)=>{let y=h;for(;y;){const l=b(w,y.k);if(l===0)return y;y=l<0?y.l:y.r}return y};e.find=s;const i=(h,w,b)=>{let y=h,l;for(;y;){const f=b(y.k,w);if(f===0)return y;if(f>0)y=y.l;else{const m=y.r;if(l=y,!m)return l;y=m}}return l};e.findOrNextLower=i;const n=(h,w)=>{const b=h.r=w.r;w.r=h,h.p=w,b&&(b.p=h)};e.insertRight=n;const t=(h,w)=>{const b=h.l=w.l;w.l=h,h.p=w,b&&(b.p=h)};e.insertLeft=t;const a=(h,w,b)=>{if(!h)return w;const y=w.k;let l=h;for(;l;){const f=b(y,l.k),m=f<0?l.l:l.r;if(m)l=m;else{f<0?(0,e.insertLeft)(w,l):(0,e.insertRight)(w,l);break}}return h};e.insert=a;const p=(h,w)=>{const b=w.p,y=w.l,l=w.r;if(w.p=w.l=w.r=void 0,!y&&!l){if(b)b.l===w?b.l=void 0:b.r=void 0;else return;return h}else if(y&&l){let m=y;for(;m.r;)m=m.r;return m.r=l,l.p=m,b?(b.l===w?b.l=y:b.r=y,y.p=b,h):(y.p=void 0,y)}const f=y||l;if(f.p=b,b)b.l===w?b.l=f:b.r=f;else return f;return h};e.remove=p}(Di)),Di}var Bi={},pl;function dp(){return pl||(pl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(Je(),e)}(Bi)),Bi}var ml;function fp(){if(ml)return Yn;ml=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.createMap=void 0;const e=Gu(),c=dp(),g=(o,u)=>o===u?0:o<u?-1:1,d=(o,u,r,s,i,n)=>{class t{constructor(p){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=p||g}set(p,h){const w=this.root;if(w===void 0){this._size=1;const v=new o(p,h);return this.root=this.min=this.max=u(void 0,v,this.comparator)}const b=this.comparator;let y;const l=this.max;if(y=b(p,l.k),y===0)return l.v=h,l;if(y>0){const v=this.max=new o(p,h);return this.root=s(w,v,l),this._size++,v}const f=this.min;if(y=b(p,f.k),y===0)return f.v=h,f;if(y<0){const v=this.min=new o(p,h);return this.root=r(w,v,f),this._size++,v}let m=w;do{if(y=b(p,m.k),y===0)return m.v=h,m;if(y>0){const v=m.r;if(v===void 0){const _=new o(p,h);return this.root=s(w,_,m),this._size++,_}m=v}else if(y<0){const v=m.l;if(v===void 0){const _=new o(p,h);return this.root=r(w,_,m),this._size++,_}m=v}}while(!0)}find(p){const h=this.comparator;let w=this.root;for(;w;){const b=+h(p,w.k);if(b===0)return w;w=b<0?w.l:w.r}}get(p){var h;return(h=this.find(p))==null?void 0:h.v}del(p){const h=this.find(p);return h?(h===this.max&&(this.max=(0,e.prev)(h)),h===this.min&&(this.min=(0,e.next)(h)),this.root=i(this.root,h),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(p){return!!this.find(p)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(p){return(0,e.findOrNextLower)(this.root,p,this.comparator)||void 0}forEach(p){let h=this.first();if(h)do p(h);while(h=(0,e.next)(h))}first(){return this.min}last(){return this.max}iterator0(){let p=this.first();return()=>{if(!p)return;const h=p;return p=(0,e.next)(p),h}}iterator(){const p=this.iterator0();return{next:()=>{const h=p();return{value:h,done:!h}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(p){return this.constructor.name+(0,c.printTree)(p,[h=>n(this.root,h)])}}return t};return Yn.createMap=d,Yn}var gl;function hp(){if(gl)return xt;gl=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.AvlMap=xt.AvlNode=void 0;const e=up(),c=fp();class g{constructor(o,u){this.k=o,this.v=u,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return xt.AvlNode=g,xt.AvlMap=(0,c.createMap)(g,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),xt}var bl;function ws(){if(bl)return yt;bl=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.Model=yt.UNDEFINED=void 0;const e=re,c=e.__importStar(Gt()),g=e.__importStar(ue()),d=Ah(),o=Uu(),u=Pr(),r=op(),s=ht(),i=Ar(),n=Je(),t=ap(),a=hp(),p=qr();yt.UNDEFINED=new i.ConNode(u.ORIGIN,void 0);let h=class ts{rndSid(){const b=this.clock,y=b.sid,l=b.peers;for(;;){const f=(0,r.randomSessionId)();if(y!==f&&!l.has(f))return f}}static fromPatches(b){if(!b.length)throw new Error("NO_PATCHES");const f=b[0].getId().sid;if(!f)throw new Error("NO_SID");const m=ts.create(void 0,f);return m.applyBatch(b),m}constructor(b){this.root=new s.RootNode(this,u.ORIGIN),this.index=new a.AvlMap(g.compare),this.ext=new t.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=b,b.time||(b.time=1)}get api(){return this._api||(this._api=new o.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(b){const y=b.length;for(let l=0;l<y;l++)this.applyPatch(b[l])}applyLocalPatch(b){const y=b.getId();if(y){const l=this.clock;if(l.sid===y.sid){const f=l.time;f>y.time&&(b=b.rebase(f))}}this.applyPatch(b)}applyPatch(b){var f,m;(f=this.onbeforepatch)==null||f.call(this,b);const y=b.ops,{length:l}=y;for(let v=0;v<l;v++)this.applyOperation(y[v]);this.tick++,(m=this.onpatch)==null||m.call(this,b)}applyOperation(b){this.clock.observe(b.id,b.span());const y=this.index;if(b instanceof c.InsStrOp){const l=y.get(b.obj);l instanceof s.StrNode&&l.ins(b.ref,b.id,b.data)}else if(b instanceof c.NewObjOp){const l=b.id;y.get(l)||y.set(l,new s.ObjNode(this,l))}else if(b instanceof c.NewArrOp){const l=b.id;y.get(l)||y.set(l,new s.ArrNode(this,l))}else if(b instanceof c.NewStrOp){const l=b.id;y.get(l)||y.set(l,new s.StrNode(l))}else if(b instanceof c.NewValOp){const l=b.id;y.get(l)||y.set(l,new s.ValNode(this,l,u.ORIGIN))}else if(b instanceof c.NewConOp){const l=b.id;y.get(l)||y.set(l,new i.ConNode(l,b.val))}else if(b instanceof c.InsObjOp){const l=y.get(b.obj),f=b.data,m=f.length;if(l instanceof s.ObjNode)for(let v=0;v<m;v++){const _=f[v],S=y.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(_[0]+"",S.id);C&&this._gcTree(C)}}else if(b instanceof c.InsVecOp){const l=y.get(b.obj),f=b.data,m=f.length;if(l instanceof s.VecNode)for(let v=0;v<m;v++){const _=f[v],S=y.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(Number(_[0]),S.id);C&&this._gcTree(C)}}else if(b instanceof c.InsValOp){const l=b.obj,f=l.sid===0&&l.time===0?this.root:y.get(l);if(f instanceof s.ValNode&&y.get(b.val)){const v=f.set(b.val);v&&this._gcTree(v)}}else if(b instanceof c.InsArrOp){const l=y.get(b.obj);if(l instanceof s.ArrNode){const f=[],m=b.data,v=m.length;for(let _=0;_<v;_++){const S=m[_];y.get(S)&&(l.id.time>=S.time||f.push(S))}f.length&&l.ins(b.ref,b.id,f)}}else if(b instanceof c.UpdArrOp){const l=y.get(b.obj);if(l instanceof s.ArrNode){const f=b.val;if(y.get(f)){const m=l.upd(b.ref,f);m&&this._gcTree(m)}}}else if(b instanceof c.DelOp){const l=y.get(b.obj);if(l instanceof s.ArrNode){const f=b.what.length;for(let m=0;m<f;m++){const v=b.what[m];for(let _=0;_<v.span;_++){const S=l.getById(new g.Timestamp(v.sid,v.time+_));S&&this._gcTree(S)}}l.delete(b.what)}else(l instanceof s.StrNode||l instanceof s.BinNode)&&l.delete(b.what)}else if(b instanceof c.NewBinOp){const l=b.id;y.get(l)||y.set(l,new s.BinNode(l))}else if(b instanceof c.InsBinOp){const l=y.get(b.obj);l instanceof s.BinNode&&l.ins(b.ref,b.id,b.data)}else if(b instanceof c.NewVecOp){const l=b.id;y.get(l)||y.set(l,new s.VecNode(this,l))}}_gcTree(b){if(b.sid===0)return;const l=this.index.get(b);if(!l)return;const f=l.api;f&&f.events.handleDelete(),l.children(m=>this._gcTree(m.id)),this.index.del(b)}fork(b=this.rndSid()){const y=ts.fromBinary(this.toBinary());return y.clock.sid!==b&&y.clock instanceof g.ClockVector&&(y.clock=y.clock.fork(b)),y.ext=this.ext,y}clone(){return this.fork(this.clock.sid)}reset(b){var m,v;(m=this.onbeforereset)==null||m.call(this);const y=this.index;this.index=new a.AvlMap(g.compare);const l=b.toBinary();d.decoder.decode(l,this),this.clock=b.clock.clone(),this.ext=b.ext.clone();const f=this._api;f&&(f.flush(),f.builder.clock=this.clock,f.node=this.root),y.forEach(({v:_})=>{const S=_.api;if(!S)return;const C=this.index.get(_.id);if(!C){S.events.handleDelete();return}S.node=C,C.api=S}),this.tick++,(v=this.onreset)==null||v.call(this)}view(){return this.root.view()}toBinary(){return d.encoder.encode(this)}setSchema(b,y=!0){const l=this.clock;if(l.time===1){const m=l.sid;y&&(l.sid=2),this.api.set(b),y&&this.setSid(m)}return this}setSid(b){const y=this.clock,l=y.sid;l!==b&&(y.sid=b,y.observe(new g.Timestamp(l,y.time-1),1))}toString(b=""){const y=()=>"",l=this.ext.size()>0;return"model"+(0,n.printTree)(b,[f=>this.root.toString(f),y,f=>{const m=[];return this.index.forEach(v=>m.push(v.v)),`index (${m.length} nodes)`+(m.length?(0,n.printTree)(f,m.map(v=>_=>`${v.name()} ${g.printTs(v.id)}`)):"")},y,f=>`view${(0,n.printTree)(f,[m=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+m)])}`,y,f=>this.clock.toString(f),l?y:null,l?f=>this.ext.toString(f):null])}};return yt.Model=h,h.sid=r.randomSessionId,h.create=(w,b=h.sid())=>{const y=typeof b=="number"?b===1?new g.ServerClockVector(1,1):new g.ClockVector(b,1):b,l=new h(y);return w!==void 0&&l.setSchema(w instanceof p.NodeBuilder?w:p.s.json(w),!0),l},h.withServerClock=(w,b=1)=>h.create(w,new g.ServerClockVector(1,b)),h.fromBinary=w=>d.decoder.decode(w),h.load=(w,b,y)=>{const l=d.decoder.decode(w);return y&&l.setSchema(y,!0),typeof b=="number"&&l.setSid(b),l},yt}var yl;function Wu(){if(yl)return dn;yl=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.ValNode=void 0;const e=ue(),c=Je(),g=ws();let d=class{constructor(u,r,s){this.doc=u,this.id=r,this.val=s,this.api=void 0}set(u){if((0,e.compare)(u,this.val)<=0&&this.val.sid!==0||(0,e.compare)(u,this.id)<=0)return;const r=this.val;return this.val=u,r}node(){return this.val.sid===0?g.UNDEFINED:this.child()}view(){var u;return(u=this.node())==null?void 0:u.view()}children(u){u(this.node())}child(){return this.doc.index.get(this.val)}container(){const u=this.node();return u?u.container():void 0}name(){return"val"}toString(u=""){const r=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,c.printTree)(u,[i=>r?r.toString(i):(0,e.printTs)(this.val)])}};return dn.ValNode=d,dn}var Zn={},vl;function pp(){if(vl)return Zn;vl=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.RootNode=void 0;const e=Pr(),c=Wu();let g=class extends c.ValNode{constructor(o,u){super(o,e.ORIGIN,u)}name(){return"root"}};return Zn.RootNode=g,Zn}var er={},tr={},wl;function mp(){if(wl)return tr;wl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.CRDT_CONSTANTS=void 0;var e;return function(c){c[c.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(e||(tr.CRDT_CONSTANTS=e={})),tr}var _l;function gp(){if(_l)return er;_l=1,Object.defineProperty(er,"__esModule",{value:!0}),er.VecNode=void 0;const e=Ar(),c=mp(),g=Je(),d=ue();let o=class{constructor(r,s){this.doc=r,this.id=s,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(r){return this.elements[r]}get(r){const s=this.elements[r];if(s)return this.doc.index.get(s)}put(r,s){if(r>c.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const i=this.val(r);if(!(i&&(0,d.compare)(i,s)>=0)){if(r>this.elements.length)for(let n=this.elements.length;n<r;n++)this.elements.push(void 0);return r<this.elements.length?this.elements[r]=s:this.elements.push(s),i}}ext(){if(this.__extNode)return this.__extNode;const r=this.getExtId();if(!(r>=0))return;const i=this.doc.ext.get(r);if(i)return this.__extNode=new i.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const r=this.get(0);if(!(r instanceof e.ConNode))return-1;const s=r.val,i=this.id;return!(s instanceof Uint8Array)||s.length!==3||s[1]!==i.sid%256||s[2]!==i.time%256?-1:s[0]}child(){return this.ext()}container(){return this}children(r){const s=this.elements,i=s.length,n=this.doc.index;for(let t=0;t<i;t++){const a=s[t];if(!a)continue;const p=n.get(a);p&&r(p)}}view(){const r=this.ext();if(r)return r.view();let s=!0;const i=this._view,n=[],t=this.doc.index,a=this.elements,p=a.length;for(let h=0;h<p;h++){const w=a[h],b=w?t.get(w):void 0,y=b?b.view():void 0;i[h]!==y&&(s=!1),n.push(y)}return s?i:this._view=n}name(){return"vec"}toString(r=""){const s=this.ext(),i=this.name()+" "+(0,d.printTs)(this.id)+(s?` { extension = ${this.getExtId()} }`:"");if(s)return this.child().toString(r,this.id);const n=this.doc.index;return i+(0,g.printTree)(r,[...this.elements.map((t,a)=>p=>`${a}: ${t&&n.get(t)?n.get(t).toString(p+"  "+" ".repeat((""+a).length)):"nil"}`),...s?[t=>`${this.child().toString(t)}`]:[]])}};return er.VecNode=o,er}var nr={},Sl;function bp(){if(Sl)return nr;Sl=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.ObjNode=void 0;const e=Je(),c=ue(),g=Ar();let d=class{constructor(u,r){this.doc=u,this.id=r,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(u){const r=this.keys.get(u);if(r)return this.doc.index.get(r)}put(u,r){const s=this.keys.get(u);if(!(s&&(0,c.compare)(s,r)>=0))return this.keys.set(u,r),s}nodes(u){const r=this.doc.index;this.keys.forEach((s,i)=>u(r.get(s),i))}forEach(u){const r=this.doc.index;this.keys.forEach((s,i)=>{const n=r.get(s);!n||n instanceof g.ConNode&&n.val===void 0||u(i,n)})}children(u){const r=this.doc.index;this.keys.forEach((s,i)=>u(r.get(s)))}child(){}container(){return this}view(){const u=this.doc,r=u.clock.time+u.tick,s=this._view;if(this._tick===r)return s;const i={},n=u.index;let t=!0;return this.keys.forEach((a,p)=>{const h=n.get(a);if(!h){t=!1;return}const w=h.view();w!==void 0?(s[p]!==w&&(t=!1),i[p]=w):s[p]!==void 0&&(t=!1)}),t?s:(this._tick=r,this._view=i)}name(){return"obj"}toString(u=""){return this.name()+" "+(0,c.printTs)(this.id)+(0,e.printTree)(u,[...this.keys.entries()].filter(([,s])=>!!this.doc.index.get(s)).map(([s,i])=>n=>JSON.stringify(s)+(0,e.printTree)(n+" ",[t=>this.doc.index.get(i).toString(t)])))}};return nr.ObjNode=d,nr}var Ct={},rr={},Fi={},xl;function yp(){return xl||(xl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const c=(i,n,t)=>{const a=n.p;if(!a)return i;const p=a.p,h=a.l===n;return p?(p.l===a?h?i=(0,e.llSplay)(i,n,a,p):i=(0,e.lrSplay)(i,n,a,p):h?i=(0,e.rlSplay)(i,n,a,p):i=(0,e.rrSplay)(i,n,a,p),t>1?(0,e.splay)(i,n,t-1):i):(h?(0,e.rSplay)(n,a):(0,e.lSplay)(n,a),n)};e.splay=c;const g=(i,n)=>{const t=i.r;i.p=void 0,i.r=n,n.p=i,n.l=t,t&&(t.p=n)};e.rSplay=g;const d=(i,n)=>{const t=i.l;i.p=void 0,i.l=n,n.p=i,n.r=t,t&&(t.p=n)};e.lSplay=d;const o=(i,n,t,a)=>{const p=t.l,h=n.l,w=a.p;return n.p=w,n.l=t,t.p=n,t.l=a,t.r=h,a.p=t,a.r=p,p&&(p.p=a),h&&(h.p=t),w?w.l===a?w.l=n:w.r=n:i=n,i};e.rrSplay=o;const u=(i,n,t,a)=>{const p=t.r,h=n.r,w=a.p;return n.p=w,n.r=t,t.p=n,t.l=h,t.r=a,a.p=t,a.l=p,p&&(p.p=a),h&&(h.p=t),w?w.l===a?w.l=n:w.r=n:i=n,i};e.llSplay=u;const r=(i,n,t,a)=>{const p=n.l,h=n.r,w=a.p;return n.p=w,n.l=t,n.r=a,t.p=n,t.r=p,a.p=n,a.l=h,p&&(p.p=t),h&&(h.p=a),w?w.l===a?w.l=n:w.r=n:i=n,i};e.lrSplay=r;const s=(i,n,t,a)=>{const p=n.r,h=n.l,w=a.p;return n.p=w,n.l=a,n.r=t,t.p=n,t.l=p,a.p=n,a.r=h,p&&(p.p=t),h&&(h.p=a),w?w.l===a?w.l=n:w.r=n:i=n,i};e.rlSplay=s}(Fi)),Fi}var Li={},Cl;function vp(){return Cl||(Cl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const c=(i,n)=>{const t=n.p2;if(!t)return i;const a=t.p2,p=t.l2===n;return a?(a.l2===t?p?i=u(i,n,t,a):i=r(i,n,t,a):p?i=s(i,n,t,a):i=o(i,n,t,a),(0,e.splay2)(i,n)):(p?g(n,t):d(n,t),n)};e.splay2=c;const g=(i,n)=>{const t=i.r2;i.p2=void 0,i.r2=n,n.p2=i,n.l2=t,t&&(t.p2=n)},d=(i,n)=>{const t=i.l2;i.p2=void 0,i.l2=n,n.p2=i,n.r2=t,t&&(t.p2=n)},o=(i,n,t,a)=>{const p=t.l2,h=n.l2,w=a.p2;return n.p2=w,n.l2=t,t.p2=n,t.l2=a,t.r2=h,a.p2=t,a.r2=p,p&&(p.p2=a),h&&(h.p2=t),w?w.l2===a?w.l2=n:w.r2=n:i=n,i},u=(i,n,t,a)=>{const p=t.r2,h=n.r2,w=a.p2;return n.p2=w,n.r2=t,t.p2=n,t.l2=h,t.r2=a,a.p2=t,a.l2=p,p&&(p.p2=a),h&&(h.p2=t),w?w.l2===a?w.l2=n:w.r2=n:i=n,i},r=(i,n,t,a)=>{const p=n.l2,h=n.r2,w=a.p2;return n.p2=w,n.l2=t,n.r2=a,t.p2=n,t.r2=p,a.p2=n,a.l2=h,p&&(p.p2=t),h&&(h.p2=a),w?w.l2===a?w.l2=n:w.r2=n:i=n,i},s=(i,n,t,a)=>{const p=n.r2,h=n.l2,w=a.p2;return n.p2=w,n.l2=a,n.r2=t,t.p2=n,t.l2=p,a.p2=n,a.r2=h,p&&(p.p2=t),h&&(h.p2=a),w?w.l2===a?w.l2=n:w.r2=n:i=n,i}}(Li)),Li}var Se={},Ol;function wp(){if(Ol)return Se;Ol=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.remove2=Se.insert2=Se.prev2=Se.next2=Se.last2=Se.first2=void 0;const e=i=>{let n=i;for(;n;)if(n.l2)n=n.l2;else return n;return n};Se.first2=e;const c=i=>{let n=i;for(;n;)if(n.r2)n=n.r2;else return n;return n};Se.last2=c;const g=i=>{if(i.r2){for(i=i.r2;i.l2;)i=i.l2;return i}let n=i.p2;for(;n&&n.r2===i;)i=n,n=n.p2;return n};Se.next2=g;const d=i=>{if(i.l2){for(i=i.l2;i.r2;)i=i.r2;return i}let n=i.p2;for(;n&&n.l2===i;)i=n,n=n.p2;return n};Se.prev2=d;const o=(i,n)=>{const t=i.r2=n.r2;n.r2=i,i.p2=n,t&&(t.p2=i)},u=(i,n)=>{const t=i.l2=n.l2;n.l2=i,i.p2=n,t&&(t.p2=i)},r=(i,n,t)=>{if(!i)return n;let a=i;for(;a;){const p=t(n,a),h=p<0?a.l2:a.r2;if(h)a=h;else{p<0?u(n,a):o(n,a);break}}return i};Se.insert2=r;const s=(i,n)=>{const t=n.p2,a=n.l2,p=n.r2;if(n.p2=n.l2=n.r2=void 0,!a&&!p){if(t)t.l2===n?t.l2=void 0:t.r2=void 0;else return;return i}else if(a&&p){let w=a;for(;w.r2;)w=w.r2;return w.r2=p,p.p2=w,t?(t.l2===n?t.l2=a:t.r2=a,a.p2=t,i):(a.p2=void 0,a)}const h=a||p;if(h.p2=t,t)t.l2===n?t.l2=h:t.r2=h;else return h;return i};return Se.remove2=s,Se}var ir={},Rl;function _p(){if(Rl)return ir;Rl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.printOctets=void 0;const e=(c,g=16)=>{let d="";if(!c.length)return d;c[0]<16&&(d+="0"),d+=c[0].toString(16);for(let o=1;o<c.length&&o<g;o++){const u=c[o];d+=" ",u<16&&(d+="0"),d+=u.toString(16)}return c.length>g&&(d+=`… (${c.length-g} more)`),d};return ir.printOctets=e,ir}var Nl;function _s(){if(Nl)return rr;Nl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.AbstractRga=void 0;const e=ue(),c=ms(),g=yp(),d=vp(),o=wp(),u=Pr(),r=Je(),s=vs(),i=_p(),n=(y,l)=>{const f=y.id,m=l.id;return f.sid-m.sid||f.time-m.time},t=y=>{const l=y.l,f=y.r;y.len=(y.del?0:y.span)+(l?l.len:0)+(f?f.len:0)},a=y=>{const l=y.l,f=y.r;y.len=y.span+(l?l.len:0)+(f?f.len:0)},p=(y,l)=>{for(;y;)y.len+=l,y=y.p},h=y=>{const l=y.r;if(l){y=l;let m;for(;m=y.l;)y=m;return y}let f=y.p;for(;f&&f.r===y;)y=f,f=f.p;return f},w=y=>{const l=y.l;if(l){y=l;let m;for(;m=y.r;)y=m;return y}let f=y.p;for(;f&&f.l===y;)y=f,f=f.p;return f};let b=class{constructor(l){this.id=l,this.root=void 0,this.ids=void 0,this.count=0}ins(l,f,m){const v=this.id,_=l.time,S=l.sid;if(v.time===_&&v.sid===S){this.insAfterRoot(l,f,m);return}let O=this.ids,x=O;for(;O;){const A=O.id,D=A.sid;if(D>S)O=O.l2;else if(D<S)x=O,O=O.r2;else{const z=A.time;if(z>_)O=O.l2;else if(z<_)x=O,O=O.r2;else{x=O;break}}}if(!x)return;const N=x.id,E=N.time,I=N.sid,R=x.span;if(I!==S||_-E>=R)return;const P=_-E;this.insAfterChunk(l,x,P,f,m)}insAt(l,f,m){if(!l){const x=this.id;return this.insAfterRoot(x,f,m),x}const v=this.findChunk(l-1);if(!v)return;const[_,S]=v,C=_.id,O=S===0?C:new e.Timestamp(C.sid,C.time+S);return this.insAfterChunk(O,_,S,f,m),O}insAfterRoot(l,f,m){const v=this.createChunk(f,m),_=this.first();if(!_)this.setRoot(v);else if((0,e.compare)(_.id,f)<0)this.insertBefore(v,_);else{if((0,e.containsId)(_.id,_.span,f))return;this.insertAfterRef(v,l,_)}}insAfterChunk(l,f,m,v,_){const S=f.id,C=S.time,O=S.sid,x=f.span,N=this.createChunk(v,_);if(m+1<x){const I=v.sid,R=v.time;if(O===I&&C<=R&&C+x-1>=R)return;if(R>l.time+1||I>l.sid){this.insertInside(N,f,m+1),this.splay(N);return}}this.insertAfterRef(N,l,f),this.splay(N)}delete(l){const f=l.length;for(let m=0;m<f;m++)this.deleteSpan(l[m]);this.onChange()}deleteSpan(l){const f=l.span,m=l.time,v=m+f-1,_=this.findById(l);if(!_)return;let S=_,C=S;for(;S;){C=S;const O=S.id,x=S.span,N=O.time,E=N+x-1;if(S.del){if(E>=v)break;S=S.s;continue}const I=m<=N,R=m<=E;if(I)if(v>=E){if(S.delete(),p(S,-S.span),v<=E)break}else{const P=v-N+1,A=this.split(S,P);S.delete(),t(A),p(S,-S.span);break}else if(R)if(v>=E){const P=m-N,A=this.split(S,P);if(A.delete(),A.len=A.r?A.r.len:0,p(S,-A.span),v<=E)break}else{const P=this.split(S,v-N+1),A=this.split(S,m-N);A.delete(),t(P),t(A),p(S,-A.span);break}S=S.s}C&&this.mergeTombstones2(_,C)}find(l){let f=this.root;for(;f;){const m=f.l,v=m?m.len:0;let _;if(l<v)f=m;else if(f.del)l-=v,f=f.r;else if(l<v+(_=f.span)){const S=l-v,C=f.id;return S?new e.Timestamp(C.sid,C.time+S):C}else l-=v+_,f=f.r}}findChunk(l){let f=this.root;for(;f;){const m=f.l,v=m?m.len:0;let _;if(l<v)f=m;else if(f.del)l-=v,f=f.r;else{if(l<v+(_=f.span))return[f,l-v];l-=v+_,f=f.r}}}findInterval(l,f){const m=[];if(!f)return m;let v=this.root,_=0;for(;v;){const O=v.l?v.l.len:0;if(l<O)v=v.l;else if(v.del)l-=O,v=v.r;else if(l<O+v.span){_=l-O;break}else l-=O+v.span,v=v.r}if(!v)return m;if(v.span>=f+_){const O=v.id;return m.push((0,e.tss)(O.sid,O.time+_,f)),m}const S=v.span-_,C=v.id;if(m.push((0,e.tss)(C.sid,C.time+_,S)),f-=S,v=h(v),!v)return m;do{if(v.del)continue;const O=v.id,x=v.span;if(f<=x)return m.push((0,e.tss)(O.sid,O.time,f)),m;m.push((0,e.tss)(O.sid,O.time,x)),f-=x}while((v=h(v))&&f>0);return m}findInterval2(l,f){const m=[];return this.range0(void 0,l,f,(v,_,S)=>{const C=v.id;m.push((0,e.tss)(C.sid,C.time+_,S))}),m}range0(l,f,m,v){let _=l||this.findById(f);if(l)for(;_&&!(0,e.containsId)(_.id,_.span,f);)_=h(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,m))return}else{const S=f.time-_.id.time;if((0,e.containsId)(_.id,_.span,m)){const x=m.time-f.time+1;return v(_,S,x),_}const O=_.span-S;if(v(_,S,O))return _}for(_=h(_);_;){if((0,e.containsId)(_.id,_.span,m))return!_.del&&v(_,0,m.time-_.id.time+1),_;if(!_.del&&v(_,0,_.span))return _;_=h(_)}return _}}first(){let l=this.root;for(;l;){const f=l.l;if(f)l=f;else return l}return l}last(){let l=this.root;for(;l;){const f=l.r;if(f)l=f;else return l}return l}lastId(){const l=this.last();if(!l)return;const f=l.id,m=l.span;return m===1?f:new e.Timestamp(f.sid,f.time+m-1)}next(l){return h(l)}prev(l){return w(l)}length(){const l=this.root;return l?l.len:0}size(){return this.count}pos(l){const f=l.p,m=l.l;if(!f)return m?m.len:0;const v=this.pos(f);if(f.r===l)return v+(f.del?0:f.span)+(m?m.len:0);const S=l.r;return v-(l.del?0:l.span)-(S?S.len:0)}setRoot(l){this.root=l,this.insertId(l),this.onChange()}insertBefore(l,f){const m=f.l;f.l=l,l.l=m,l.p=f;let v=0;m&&(m.p=l,v=m.len),l.len=l.span+v,p(f,l.span),this.insertId(l),this.onChange()}insertAfter(l,f){const m=f.r;f.r=l,l.r=m,l.p=f;let v=0;m&&(m.p=l,v=m.len),l.len=l.span+v,p(f,l.span),this.insertId(l),this.onChange()}insertAfterRef(l,f,m){const v=l.id,_=v.sid,S=v.time;let C=!1;for(;;){const O=m.id,x=O.time+m.span;m.s||(C=O.sid===_&&x===S&&x-1===f.time,C&&(m.s=l));const N=h(m);if(!N)break;const E=N.id,I=E.time,R=E.sid;if(I<S)break;if(I===S){if(R===_)return;if(R<_)break}m=N}C&&!m.del?(this.mergeContent(m,l.data),m.s=void 0):this.insertAfter(l,m)}mergeContent(l,f){const m=l.span;l.merge(f),p(l,l.span-m),this.onChange()}insertInside(l,f,m){const v=f.p,_=f.l,S=f.r,C=f.s,O=f.len,x=f.split(m);if(f.s=x,x.s=C,f.l=f.r=x.l=x.r=void 0,x.l=void 0,l.p=v,!_)l.l=f,f.p=l;else{l.l=_,_.p=l;const I=_.r;_.r=f,f.p=_,f.l=I,I&&(I.p=f)}if(!S)l.r=x,x.p=l;else{l.r=S,S.p=l;const I=S.l;S.l=x,x.p=S,x.r=I,I&&(I.p=x)}v?v.l===f?v.l=l:v.r=l:this.root=l,t(f),t(x),_&&(_.len=(_.l?_.l.len:0)+f.len+(_.del?0:_.span)),S&&(S.len=(S.r?S.r.len:0)+x.len+(S.del?0:S.span)),l.len=O+l.span;const N=l.span;let E=l.p;for(;E;)E.len+=N,E=E.p;this.insertId(x),this.insertIdFast(l),this.onChange()}split(l,f){const m=l.s,v=l.split(f),_=l.r;return l.s=v,v.r=_,v.s=m,l.r=v,v.p=l,this.insertId(v),_&&(_.p=v),v}mergeTombstones(l,f){if(!l.del||!f.del)return!1;const m=l.id,v=f.id;return m.sid!==v.sid||m.time+l.span!==v.time?!1:(l.s=f.s,l.span+=f.span,this.deleteChunk(f),!0)}mergeTombstones2(l,f){let m=l;for(;m;){const _=h(m);if(!_)break;if(!this.mergeTombstones(m,_)){if(_===f){if(_){const C=h(_);C&&this.mergeTombstones(_,C)}break}m=m.s}}const v=w(l);v&&this.mergeTombstones(v,l)}removeTombstones(){let l=this.first();const f=[];for(;l;)l.del&&f.push(l),l=h(l);for(let m=0;m<f.length;m++)this.deleteChunk(f[m])}deleteChunk(l){this.deleteId(l);const f=l.p,m=l.l,v=l.r;if(l.id=u.ORIGIN,!m&&!v)f?f.l===l?f.l=void 0:f.r=void 0:this.root=void 0;else if(m&&v){let _=m;for(;_.r;)_=_.r;_.r=v,v.p=_;const S=v.len;let C;for(C=_,f?(f.l===l?f.l=m:f.r=m,m.p=f):(this.root=m,m.p=void 0);C&&C!==f;)C.len+=S,C=C.p}else{const _=m||v;_.p=f,f?f.l===l?f.l=_:f.r=_:this.root=_}}insertId(l){this.ids=(0,o.insert2)(this.ids,l,n),this.count++,this.ids=(0,d.splay2)(this.ids,l)}insertIdFast(l){this.ids=(0,o.insert2)(this.ids,l,n),this.count++}deleteId(l){this.ids=(0,o.remove2)(this.ids,l),this.count--}findById(l){const f=l.sid,m=l.time;let v=this.ids,_=v;for(;v;){const E=v.id,I=E.sid;if(I>f)v=v.l2;else if(I<f)_=v,v=v.r2;else{const R=E.time;if(R>m)v=v.l2;else if(R<m)_=v,v=v.r2;else{_=v;break}}}if(!_)return;const S=_.id,C=S.time,O=S.sid,x=_.span;if(!(O!==f||m<C||m-C>=x))return _}prevId(l){let f=this.findById(l);if(!f)return;const m=l.time;if(f.id.time<m)return new e.Timestamp(l.sid,m-1);if(f=w(f),!f)return;const v=f.id;return f.span>1?new e.Timestamp(v.sid,v.time+f.span-1):v}spanView(l){const f=[];let m=l.span;const v=l.time;let _=this.findById(l);if(!_)return f;if(!_.del)if(_.span>=m+v-_.id.time){const S=v-_.id.time,C=S+m,O=_.view().slice(S,C);return f.push(O),f}else{const S=v-_.id.time,C=_.view().slice(S,l.span);m-=_.span-S,f.push(C)}for(;_=_.s;){const S=_.span;if(!_.del){if(S>m){const C=_.view().slice(0,m);f.push(C);break}f.push(_.data)}if(m-=S,m<=0)break}return f}splay(l){const f=l.p;if(!f)return;const m=f.p,v=f.l===l;if(!m){v?(0,g.rSplay)(l,f):(0,g.lSplay)(l,f),this.root=l,t(f),a(l);return}m.l===f?v?this.root=(0,g.llSplay)(this.root,l,f,m):this.root=(0,g.lrSplay)(this.root,l,f,m):v?this.root=(0,g.rlSplay)(this.root,l,f,m):this.root=(0,g.rrSplay)(this.root,l,f,m),t(m),t(f),a(l),this.splay(l)}iterator(){let l=this.first();return()=>{const f=l;return l&&(l=h(l)),f}}ingest(l,f){if(l<1)return;const m=new Map;this.root=this._ingest(l,()=>{const v=f(),_=v.id,S=_.sid+"."+_.time,C=m.get(S);C&&(C.s=v,m.delete(S));const O=(0,e.tick)(_,v.span);return m.set(O.sid+"."+O.time,v),v})}_ingest(l,f){const m=l>>1,v=l-m-1,_=m>0?this._ingest(m,f):void 0,S=f();_&&(S.l=_,_.p=S);const C=v>0?this._ingest(v,f):void 0;return C&&(S.r=C,C.p=S),t(S),this.insertId(S),S}toStringName(){return"AbstractRga"}toString(l=""){const f=this.view();let m="";return(0,c.isUint8Array)(f)?m+=` { ${(0,i.printOctets)(f)||"∅"} }`:typeof f=="string"&&(m+=`{ ${f.length>32?JSON.stringify(f.substring(0,32))+" …":JSON.stringify(f)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${m}`+(0,r.printTree)(l,[_=>this.root?this.printChunk(_,this.root):"∅"])}printChunk(l,f){return this.formatChunk(f)+(0,s.printBinary)(l,[f.l?m=>this.printChunk(m,f.l):null,f.r?m=>this.printChunk(m,f.r):null])}formatChunk(l){let m=`chunk ${(0,e.printTs)(l.id)}:${l.span} .${l.len}.`;if(l.del)m+=` [${l.span}]`;else if((0,c.isUint8Array)(l.data))m+=` { ${(0,i.printOctets)(l.data)||"∅"} }`;else if(typeof l.data=="string"){const v=l.data.length>32?JSON.stringify(l.data.substring(0,32))+" …":JSON.stringify(l.data);m+=` { ${v} }`}return m}};return rr.AbstractRga=b,rr}var El;function Sp(){if(El)return Ct;El=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.ArrNode=Ct.ArrChunk=void 0;const e=_s(),c=ue(),g=vs(),d=Je();class o{constructor(s,i,n){this.id=s,this.span=i,this.len=n?i:0,this.del=!n,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=n}merge(s){this.data.push(...s),this.span=this.data.length}split(s){const i=this.span;if(this.span=s,!this.del){const t=this.data.splice(s);return new o((0,c.tick)(this.id,s),i-s,t)}return new o((0,c.tick)(this.id,s),i-s,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new o(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ct.ArrChunk=o;let u=class extends e.AbstractRga{constructor(s,i){super(i),this.doc=s,this._tick=0,this._view=[],this.api=void 0}get(s){const i=this.findChunk(s);if(i)return i[0].data[i[1]]}getNode(s){const i=this.get(s);if(i)return this.doc.index.get(i)}getId(s){const i=this.findChunk(s);if(!i)return;const[n,t]=i,a=n.id;return t?(0,c.tick)(a,t):a}getById(s){const i=this.findById(s);if(!i||i.del)return;const n=s.time-i.id.time;return i.data[n]}upd(s,i){const n=this.findById(s);if(!n)return;const t=n.data;if(!t)return;const a=s.time-n.id.time,p=t[a];if(!(p&&(0,c.compare)(p,i)>=0))return t[a]=i,this.onChange(),p}createChunk(s,i){return new o(s,i?i.length:0,i)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const s=this.doc,i=s.clock.time+s.tick,n=this._view;if(this._tick===i)return n;const t=[],a=s.index;let p=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const b of w.data){const y=a.get(b);if(!y){p=!1;continue}const l=y.view();n[t.length]!==l&&(p=!1),t.push(l)}return n.length!==t.length&&(p=!1),p?n:(this._tick=i,this._view=t)}children(s){const i=this.doc.index;for(let n=this.first();n;n=this.next(n)){const t=n.data;if(!t)continue;const a=t.length;for(let p=0;p<a;p++)s(i.get(t[p]))}}name(){return"arr"}printChunk(s,i){const n=this.pos(i);let t="";if(!i.del){const a=this.doc.index;t=(0,d.printTree)(s,i.data.map(p=>a.get(p)).filter(p=>!!p).map((p,h)=>w=>`[${n+h}]: ${p.toString(w+"    "+" ".repeat(String(h).length))}`))}return this.formatChunk(i)+t+(0,g.printBinary)(s,[i.l?a=>this.printChunk(a,i.l):null,i.r?a=>this.printChunk(a,i.r):null])}};return Ct.ArrNode=u,Ct}var Ot={},Tl;function xp(){if(Tl)return Ot;Tl=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.BinNode=Ot.BinChunk=void 0;const e=ue(),c=_s();class g{constructor(u,r,s){this.id=u,this.span=r,this.len=s?r:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=s}merge(u){const r=this.data.length,s=new Uint8Array(r+u.length);s.set(this.data),s.set(u,r),this.data=s,this.span=s.length}split(u){if(!this.del){const s=this.data,i=s.subarray(u),n=new g((0,e.tick)(this.id,u),this.span-u,i);return this.data=s.subarray(0,u),this.span=u,n}const r=new g((0,e.tick)(this.id,u),this.span-u,void 0);return this.span=u,r}delete(){this.del=!0,this.data=void 0}clone(){return new g(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Ot.BinChunk=g;let d=class extends c.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const u=new Uint8Array(this.length());let r=0,s=this.first();for(;s;){if(!s.del){const i=s.data;u.set(i,r),r+=i.length}s=this.next(s)}return this._view=u}children(){}child(){}container(){}name(){return"bin"}createChunk(u,r){return new g(u,r?r.length:0,r)}onChange(){this._view=null}toStringName(){return this.name()}};return Ot.BinNode=d,Ot}var Rt={},Il;function Cp(){if(Il)return Rt;Il=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.StrNode=Rt.StrChunk=void 0;const e=ue(),c=_s(),g=Gu();class d{constructor(r,s,i){this.id=r,this.span=s,this.len=i?s:0,this.del=!i,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=i}merge(r){this.data+=r,this.span=this.data.length}split(r){if(!this.del){const i=new d((0,e.tick)(this.id,r),this.span-r,this.data.slice(r));return this.data=this.data.slice(0,r),this.span=r,i}const s=new d((0,e.tick)(this.id,r),this.span-r,"");return this.span=r,s}delete(){this.del=!0,this.data=""}clone(){return new d(this.id,this.span,this.data)}view(){return this.data}}Rt.StrChunk=d;let o=class extends c.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let r="";for(let s=this.first();s;s=(0,g.next)(s))r+=s.data;return this._view=r}name(){return"str"}createChunk(r,s){return new d(r,s?s.length:0,s||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Rt.StrNode=o,Rt}var kl;function Op(){return kl||(kl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var c=Ar();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return c.ConNode}});var g=Wu();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return g.ValNode}});var d=pp();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return d.RootNode}});var o=gp();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return o.VecNode}});var u=bp();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return u.ObjNode}});var r=Sp();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return r.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return r.ArrChunk}});var s=xp();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return s.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return s.BinChunk}});var i=Cp();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return i.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return i.StrChunk}})}(li)),li}var jl;function ht(){return jl||(jl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(mh(),e),c.__exportStar(Op(),e)}(oi)),oi}var Ui={},Vl;function Rp(){return Vl||(Vl=1,Object.defineProperty(Ui,"__esModule",{value:!0})),Ui}var $i={},Al;function Np(){return Al||(Al=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const c=re;var g=ws();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return g.Model}}),c.__exportStar(Uu(),e)}($i)),$i}var Pl;function Hu(){return Pl||(Pl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(ht(),e),c.__exportStar(Rp(),e),c.__exportStar(Np(),e),c.__exportStar(qr(),e)}(si)),si}var Ep=Hu(),zi={},Gi={},Ml;function Tp(){return Ml||(Ml=1,Object.defineProperty(Gi,"__esModule",{value:!0})),Gi}var sr={},or={},Nt={},ql;function Dr(){return ql||(ql=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.hasBuffer=Nt.alphabet=void 0,Nt.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nt.hasBuffer=typeof Ne.Buffer=="function"&&typeof Ne.Buffer.from=="function"),Nt}var ar={},lr={},Dl;function Ip(){if(Dl)return lr;Dl=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.flatstr=void 0;const e=c=>c;return lr.flatstr=e,lr}var Bl;function kp(){if(Bl)return ar;Bl=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.createToBase64=void 0;const e=Ip(),c=Dr(),g=(d=c.alphabet,o="=")=>{if(d.length!==64)throw new Error("chars must be 64 characters long");const u=d.split(""),r=[];for(const n of u)for(const t of u){const a=(0,e.flatstr)(n+t);r.push(a)}const s=o,i=(0,e.flatstr)(o+o);return(n,t)=>{let a="";const p=t%3,h=t-p;for(let w=0;w<h;w+=3){const b=n[w],y=n[w+1],l=n[w+2],f=b<<4|y>>4,m=(y&15)<<8|l;a+=r[f]+r[m]}if(!p)return a;if(p===1){const w=n[h];a+=r[w<<4]+i}else{const w=n[h],b=n[h+1],y=w<<4|b>>4,l=(b&15)<<2;a+=r[y]+u[l]+s}return a}};return ar.createToBase64=g,ar}var Fl;function Ju(){if(Fl)return or;Fl=1,Object.defineProperty(or,"__esModule",{value:!0}),or.toBase64=void 0;const e=Dr(),g=(0,kp().createToBase64)();return or.toBase64=e.hasBuffer?d=>{const o=d.length;return o<=48?g(d,o):Ne.Buffer.from(d).toString("base64")}:d=>g(d,d.length),or}var Ll;function jp(){if(Ll)return sr;Ll=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.encode=void 0;const c=re.__importStar(Gt()),g=ue(),d=Ju(),o=(s,i)=>{const n=i.sid;return n===s?i.time:[n,i.time]},u=(s,i)=>{const n=o(s,i);return Array.isArray(n)?(n.push(i.span),n):[n,i.span]},r=s=>{const i=s.getId();if(!i)throw new Error("PATCH_EMPTY");const n=i.sid,t=i.time,a=n===1?[t]:[[n,t]],p=s.meta;p!==void 0&&a.push(p);const h=[a];for(const w of s.ops)if(w instanceof c.NewConOp){const b=w.val;b instanceof g.Timestamp?h.push([0,o(n,b),!0]):b===void 0?h.push([0]):h.push([0,b])}else if(w instanceof c.NewValOp)h.push([1]);else if(w instanceof c.NewObjOp)h.push([2]);else if(w instanceof c.NewVecOp)h.push([3]);else if(w instanceof c.NewStrOp)h.push([4]);else if(w instanceof c.NewBinOp)h.push([5]);else if(w instanceof c.NewArrOp)h.push([6]);else if(w instanceof c.InsValOp)h.push([9,o(n,w.obj),o(n,w.val)]);else if(w instanceof c.InsObjOp){const b=[];for(const[l,f]of w.data)b.push([l,o(n,f)]);const y=[10,o(n,w.obj),b];h.push(y)}else if(w instanceof c.InsVecOp){const b=[];for(const[l,f]of w.data)b.push([l,o(n,f)]);const y=[11,o(n,w.obj),b];h.push(y)}else if(w instanceof c.InsStrOp){const b=[12,o(n,w.obj),o(n,w.ref),w.data];h.push(b)}else if(w instanceof c.InsBinOp){const b=[13,o(n,w.obj),o(n,w.ref),(0,d.toBase64)(w.data)];h.push(b)}else if(w instanceof c.InsArrOp){const b=[];for(const l of w.data)b.push(o(n,l));const y=[14,o(n,w.obj),o(n,w.ref),b];h.push(y)}else if(w instanceof c.UpdArrOp){const b=[15,o(n,w.obj),o(n,w.ref),o(n,w.val)];h.push(b)}else if(w instanceof c.DelOp){const b=[16,o(n,w.obj),w.what.map(y=>u(n,y))];h.push(b)}else if(w instanceof c.NopOp){const b=[17],y=w.len;y>1&&b.push(y),h.push(b)}return h};return sr.encode=r,sr}var ur={},cr={},dr={},Ul;function Vp(){if(Ul)return dr;Ul=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.bufferToUint8Array=void 0;const e=c=>new Uint8Array(c.buffer,c.byteOffset,c.length);return dr.bufferToUint8Array=e,dr}var fr={},$l;function Ap(){if($l)return fr;$l=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.createFromBase64=void 0;const e=Dr(),c="=",g=(d=e.alphabet,o=!1)=>{if(d.length!==64)throw new Error("chars must be 64 characters long");let u=0;for(let s=0;s<d.length;s++)u=Math.max(u,d.charCodeAt(s));const r=[];for(let s=0;s<=u;s+=1)r[s]=-1;for(let s=0;s<d.length;s++)r[d.charCodeAt(s)]=s;return s=>{if(!s)return new Uint8Array(0);let i=s.length;if(o){const b=i%4;b===2?(s+="==",i+=2):b===3&&(s+="=",i+=1)}if(i%4!==0)throw new Error("Base64 string length must be a multiple of 4");const n=s[i-1]!==c?i:i-4;let t=(i>>2)*3,a=0;s[i-2]===c?(a=2,t-=2):s[i-1]===c&&(a=1,t-=1);const p=new Uint8Array(t);let h=0,w=0;for(;w<n;w+=4){const b=r[s.charCodeAt(w)],y=r[s.charCodeAt(w+1)],l=r[s.charCodeAt(w+2)],f=r[s.charCodeAt(w+3)];if(b<0||y<0||l<0||f<0)throw new Error("INVALID_BASE64_STRING");p[h]=b<<2|y>>4,p[h+1]=y<<4|l>>2,p[h+2]=l<<6|f,h+=3}if(a===2){const b=r[s.charCodeAt(n)],y=r[s.charCodeAt(n+1)];if(b<0||y<0)throw new Error("INVALID_BASE64_STRING");p[h]=b<<2|y>>4}else if(a===1){const b=r[s.charCodeAt(n)],y=r[s.charCodeAt(n+1)],l=r[s.charCodeAt(n+2)];if(b<0||y<0||l<0)throw new Error("INVALID_BASE64_STRING");p[h]=b<<2|y>>4,p[h+1]=y<<4|l>>2}return p}};return fr.createFromBase64=g,fr}var zl;function Pp(){if(zl)return cr;zl=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.fromBase64=void 0;const e=Vp(),c=Dr(),g=Ap(),d=c.hasBuffer?u=>(0,e.bufferToUint8Array)(Ne.Buffer.from(u,"base64")):null,o=(0,g.createFromBase64)();return cr.fromBase64=d?u=>u.length>48?d(u):o(u):o,cr}var Gl;function Mp(){if(Gl)return ur;Gl=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.decode=void 0;const e=Pp(),c=ue(),g=Mr(),d=(r,s)=>Array.isArray(s)?new c.Timestamp(s[0],s[1]):new c.Timestamp(r,s),o=(r,s)=>s.length===3?new c.Timespan(s[0],s[1],s[2]):new c.Timespan(r,s[0],s[1]),u=r=>{const s=r[0],i=s[0],n=Array.isArray(i)?new c.ClockVector(i[0],i[1]):new c.ServerClockVector(1,i),t=n.sid;n.time;const a=new g.PatchBuilder(n),p=r.length;for(let w=1;w<p;w++){const b=r[w];switch(b[0]){case 0:{const[,y,l]=b;a.con(l?d(t,y):y);break}case 1:{a.val();break}case 2:{a.obj();break}case 3:{a.vec();break}case 4:{a.str();break}case 5:{a.bin();break}case 6:{a.arr();break}case 9:{a.setVal(d(t,b[1]),d(t,b[2]));break}case 10:{const y=d(t,b[1]),l=[],f=b[2],m=f.length;for(let v=0;v<m;v++){const[_,S]=f[v];l.push([_,d(t,S)])}a.insObj(y,l);break}case 11:{const y=d(t,b[1]),l=[],f=b[2],m=f.length;for(let v=0;v<m;v++){const[_,S]=f[v];l.push([_,d(t,S)])}a.insVec(y,l);break}case 12:{a.insStr(d(t,b[1]),d(t,b[2]),b[3]);break}case 13:{a.insBin(d(t,b[1]),d(t,b[2]),(0,e.fromBase64)(b[3]));break}case 14:{const y=d(t,b[1]),l=d(t,b[2]),f=b[3],m=[],v=f.length;for(let _=0;_<v;_++)m.push(d(t,f[_]));a.insArr(y,l,m);break}case 15:{const y=d(t,b[1]),l=d(t,b[2]),f=d(t,b[3]);a.updArr(y,l,f);break}case 16:{const y=d(t,b[1]),l=b[2],f=[],m=l.length;for(let v=0;v<m;v++)f.push(o(t,l[v]));a.del(y,f);break}case 17:{a.nop(b[1]||1);break}}}const h=a.patch;return h.meta=s[1],h};return ur.decode=u,ur}var Wl;function qp(){return Wl||(Wl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Tp(),e),c.__exportStar(jp(),e),c.__exportStar(Mp(),e)}(zi)),zi}var Wi=qp(),hr={},Hl;function Dp(){if(Hl)return hr;Hl=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.Encoder=void 0;const c=re.__importStar(ht()),g=Ju(),d=ue();let o=class{encode(r){this.model=r;const s=r.clock;return{time:s.sid===1?s.time:this.cClock(r.clock),root:this.cVal(r.root)}}cClock(r){const s=[],i=r.sid;r.peers.get(i)||s.push([i,r.time]);for(const t of r.peers.values())s.push([t.sid,t.time]);return s}cTs(r){return r.sid===1?r.time:[r.sid,r.time]}cNode(r){if(r instanceof c.ObjNode)return this.cObj(r);if(r instanceof c.ArrNode)return this.cArr(r);if(r instanceof c.StrNode)return this.cStr(r);if(r instanceof c.ValNode)return this.cVal(r);if(r instanceof c.ConNode)return this.cCon(r);if(r instanceof c.BinNode)return this.cBin(r);if(r instanceof c.VecNode)return this.cVec(r);throw new Error("UNKNOWN_NODE")}cObj(r){const s={};return r.nodes((i,n)=>{s[n]=this.cNode(i)}),{type:"obj",id:this.cTs(r.id),map:s}}cVec(r){const s=[],i=r.elements,n=i.length,t=this.model.index;for(let a=0;a<n;a++){const p=i[a];p===void 0?s.push(null):s.push(this.cNode(t.get(p)))}return{type:"vec",id:this.cTs(r.id),map:s}}cArr(r){const s=[],i=r.iterator();let n;for(;n=i();)s.push(this.cArrChunk(n));return{type:"arr",id:this.cTs(r.id),chunks:s}}cArrChunk(r){if(r.del)return{id:this.cTs(r.id),span:r.span};const s=this.model.index;return{id:this.cTs(r.id),value:r.data.map(n=>this.cNode(s.get(n)))}}cStr(r){const s=[],i=r.iterator();let n;for(;n=i();)s.push(this.cStrChunk(n));return{type:"str",id:this.cTs(r.id),chunks:s}}cStrChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:r.data}}cBin(r){const s=[],i=r.iterator();let n;for(;n=i();)s.push(this.cBinChunk(n));return{type:"bin",id:this.cTs(r.id),chunks:s}}cBinChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:(0,g.toBase64)(r.data)}}cVal(r){return{type:"val",id:this.cTs(r.id),value:this.cNode(r.node())}}cCon(r){const s={type:"con",id:this.cTs(r.id)},i=r.val;return i instanceof d.Timestamp?(s.timestamp=!0,s.value=this.cTs(i)):i!==void 0&&(s.value=i),s}};return hr.Encoder=o,hr}var Bp=Dp();class Fp{constructor(c){pe(this,"socket");pe(this,"model",null);pe(this,"sequenceNumber",0);pe(this,"replicaId");pe(this,"verboseEncoder",new Bp.Encoder);pe(this,"onModelCreate",Tt);pe(this,"onGridReady",Tt);pe(this,"onStatusChange",Tt);pe(this,"messageHandler",c=>{var g,d;if(c=JSON.parse(c),Array.isArray(c)&&c.length===3&&c[0]===4){const[,,o]=c;try{const u=Wi.decode(o);this.model?(console.debug("Applying patch from server:",u),(g=this.model)==null||g.applyPatch(u)):(console.debug("Initializing new model from patch:"),console.debug(u.toString()),this.model=Ep.Model.fromPatches([u]).fork(this.replicaId),this.onModelCreate(this.model));const r=(d=this.model)==null?void 0:d.api.flush();let s;if((r==null?void 0:r.ops.length)!==0&&(s=Wi.encode(r)),s){const i=[1,this.sequenceNumber,"patch",s];console.debug("Responding with patch:",i),this.sendMessage(i)}else{const i=this.verboseEncoder.encode(this.model);this.sendSyncMessage(i.time)}}catch(u){console.error("Failed to apply patch or send clock:",u)}}else if(Array.isArray(c)&&c.length===2&&c[0]===5)this.sequenceNumber+=1,this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(Array.isArray(c)&&c[0]===8){if(console.debug("Message received from server:",c[1]),c[1]==="ping"&&console.debug("Received ping response from server"),c[1]==="connected"&&(console.debug("Server ready to receive patches"),this.sendSyncMessage()),c[1]==="error"){console.warn("Error from server:",c[2]);return}if(c[1]==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const o=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",o.time);const u=[1,this.sequenceNumber,"synchronize-clock",o.time];this.sendMessage(u)}}else console.warn("Unexpected WebSocket message format:",c)});const{replicaId:g,url:d,onGridReady:o,onStatusChange:u,onModelCreate:r}=c;this.replicaId=g,this.socket=new WebSocket(d),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=s=>{this.handleMessage(s.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=s=>{console.error("WebSocket error:",s)},r&&(this.onModelCreate=r),o&&(this.onGridReady=o),u&&(this.onStatusChange=u)}disconnect(){this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(c){this.messageHandler(c)}sendMessage(c){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",c),this.socket.send(JSON.stringify(c))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const c=this.model.api.flush();if(c){console.debug("Sending patch to server:",c);const g=Wi.encode(c),d=[1,this.sequenceNumber,"patch",g];this.sendMessage(d)}}sendSyncMessage(c=[]){const g=[1,this.sequenceNumber,"synchronize-clock",c];this.sendMessage(g)}}function Lp(){const[e,c]=U.useState(null),[g,d]=U.useState(null),[o,u]=U.useState(!1),[r,s]=U.useState(!1),i=ph(e),n=U.useCallback((t,a)=>{if(a&&!g){const p=new Fp({replicaId:t,url:a,onGridReady:()=>{u(!0)},onStatusChange:(h,w)=>{s(h)},onModelCreate:h=>{c(h)}});d(p)}},[]);return U.useEffect(()=>()=>{g&&g.disconnect(),c(null),u(!1)},[g]),{isConnected:r,createWebsocket:n,websocketInstance:g,isGridReady:o,model:e,modelSnapshot:i}}function Up(e){switch(e.type){case"CREATE":return{type:"DELETE",rowIndex:e.rowIndex};case"UPDATE":return e.previousValue?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:e.previousValue}:null;case"DELETE":return e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null;default:return null}}function ns(e=[],c){const[g,d]=U.useState(e),o=U.useCallback(n=>{d(t=>{const a=[...t,n];return c&&a.length>c&&a.shift(),a})},[c]),u=U.useCallback(()=>{if(g.length===0)return;const n=g[g.length-1];return d(t=>t.slice(0,-1)),n},[g]),r=U.useCallback(()=>g[g.length-1],[g]),s=U.useCallback(()=>{d([])},[]),i=U.useCallback(()=>g.length===0,[g]);return{stack:g,push:o,pop:u,clear:s,peek:r,size:g.length,isEmpty:i}}try{ns.displayName="useStack",ns.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}const $p=100;function rs(e){const c=ns([],$p),[g,d]=U.useState(null),o=!!g,u=w=>{d(w.currentTarget)},r=()=>d(null),i=(()=>{if(c.isEmpty())return null;const b=c.peek().type;let y=0;for(let l=c.stack.length-1;l>=0&&c.stack[l].type===b;l--)y++;return{lastType:b,sameTypeCount:y,totalActions:c.size}})(),n=U.useCallback(()=>{if(c.isEmpty())return;const w=c.pop();if(w){const b=Up(w);if(!b)return;e(b)}r()},[e,c,r]);U.useEffect(()=>{const w=b=>{(b.ctrlKey&&b.key==="z"||b.metaKey&&b.key==="z")&&(b.preventDefault(),n())};return window.addEventListener("keydown",w),()=>{window.removeEventListener("keydown",w)}},[n,c]);const t=w=>c.push(w),a=()=>c.clear(),p=V.jsxs(V.Fragment,{children:[V.jsxs(gr,{"aria-controls":o?"undo-menu":void 0,"aria-haspopup":"true",onClick:u,disabled:!i,endIcon:V.jsx(Yc,{}),children:["Undo ",i&&`(${i.totalActions})`]}),V.jsx(Xc,{id:"undo-menu",anchorEl:g,open:o,onClose:r,children:i?[V.jsxs(Ki,{onClick:n,children:["Undo last ",i.lastType.toLowerCase()," action"]},"lastAction")]:V.jsx(Ki,{disabled:!0,children:"No actions to undo"})})]});return{undoPreview:i,handleUndo:n,addToUndoStack:t,clearUndoStack:a,addOperationsToUndoStack:(w,b,y)=>{for(const l of w){const f=l.fromRowIndex,m=l.toRowIndex;if(l.type==="CREATE")for(let v=f;v<m;v++){const _=y[v];t({type:"CREATE",rowIndex:v,newValue:_})}if(l.type==="UPDATE"){const v=b.slice(f,m);y.slice(f,m).forEach((S,C)=>{const O=v[C],x=f+C;t({type:"UPDATE",rowIndex:x,previousValue:O,newValue:S})})}l.type==="DELETE"&&b.slice(f,m).forEach((_,S)=>{t({type:"DELETE",rowIndex:f+S,previousValue:_})})}},undoUI:p}}try{rs.displayName="useGridUndo",rs.__docgenInfo={description:"Hook to manage undo functionality for a grid backed by a CRDT model.",displayName:"useGridUndo",props:{}}}catch{}var Hi=qr();function zp(e,c){const g=e.api.arr(["rows"]),{columnNames:d}=e.api.getSnapshot();switch(c.type){case"CREATE":{const o=d.map(u=>Hi.s.con(c.rowData[u]??""));g==null||g.ins(c.rowIndex,[{data:Hi.s.vec(...o)}]);break}case"DELETE":g==null||g.del(c.rowIndex,c.count??1);break;case"UPDATE":{Object.entries(c.updatedData).forEach(([o,u])=>{if(o.startsWith("_"))return;const r=d.indexOf(o);if(r!==-1){const s=e.api.vec(["rows",String(c.rowIndex),"data"]);s==null||s.set([[r,Hi.s.con(u)]])}});break}}}function Gp(e,c,g){const d=[];return e.forEach(o=>{if(o.type==="CREATE")for(let u=o.fromRowIndex;u<o.toRowIndex;u++)d.push({type:"CREATE",rowIndex:u,rowData:c[u]});if(o.type==="UPDATE")for(let u=o.fromRowIndex;u<o.toRowIndex;u++)d.push({type:"UPDATE",rowIndex:u,updatedData:c[u]});o.type==="DELETE"&&d.push({type:"DELETE",rowIndex:o.fromRowIndex,count:o.toRowIndex-o.fromRowIndex})}),d}const kr=U.forwardRef(({query:e,showDebugInfo:c=!1},g)=>{var M,P;const[d,o]=U.useState(null),[u,r]=U.useState(null),[s,i]=U.useState(""),n=U.useRef(null);U.useImperativeHandle(g,()=>({initializeGrid:()=>{n.current&&n.current.handleStartSession(e)}}),[e]);const{isConnected:t,websocketInstance:a,createWebsocket:p,isGridReady:h,model:w,modelSnapshot:b}=Lp();U.useEffect(()=>{u&&s&&p(u,s)},[u,s,p]);const{data:y}=Fc((d==null?void 0:d.gridJsonSchema$Id)??"",{enabled:!!(d!=null&&d.gridJsonSchema$Id)}),l=t?"Connected":"Disconnected",f=U.useMemo(()=>b?vd(w,b):[],[w,b]),m=b?v(b):[];function v(A){if(!A)return[];const{columnNames:D,columnOrder:z}=A;return z.map(X=>{const Z=D[X],K=y?xd(Js(y,Z)).map(be=>be.value):null,Q=y?Js(y,Z).type:null;return Q==="boolean"?{...ut.keyColumn(Z,ut.checkboxColumn),title:Z}:Q==="number"||Q==="integer"?{...ut.keyColumn(Z,ut.floatColumn),title:Z}:K&&K.length>0?{...ut.keyColumn(Z,Zi({choices:K})),title:Z}:{...ut.keyColumn(Z,ut.createTextColumn({continuousUpdates:!1})),title:Z}})}const _=U.useCallback(rd(()=>{console.log("Auto-committing changes"),a==null||a.sendPatch()},500),[a]),S=U.useCallback((A,D)=>{D.forEach(z=>{zp(A,z)}),_()},[_]),C=(A,D)=>{if(!w){console.error("Model is not initialized");return}if(D=bd(A,f,D),D.length>0){N(D,f,A);const z=Gp(D,A);S(w,z)}},O=U.useCallback(A=>{if(!w){console.error("Model is not initialized");return}A.type==="DELETE"&&R.current&&R.current.setActiveCell(null),S(w,[A])},[w,S]),{undoUI:x,addOperationsToUndoStack:N}=rs(O),[E,I]=U.useState(null),R=U.useRef(null);return V.jsx("div",{children:V.jsxs(we,{container:!0,spacing:2,children:[V.jsx(we,{size:{xs:12,xl:8},children:V.jsx(es,{ref:n,onSessionChange:o,onReplicaChange:r,onPresignedUrlChange:i,query:e})}),V.jsx(we,{size:{xs:12,xl:4},children:c&&V.jsxs("div",{children:[V.jsxs("p",{children:["Session ID: ",(d==null?void 0:d.sessionId)||"No session created"]}),V.jsxs("p",{children:["Replica ID: ",u||"No replica created"]}),V.jsxs("p",{children:["JSON Schema $id:"," ",(d==null?void 0:d.gridJsonSchema$Id)||"No schema attached to session"]}),V.jsxs("p",{children:["Presigned URL:"," ",s.substring(0,30)+(s.length>30?" ... "+s.substring(s.length-10,s.length):"")||"No URL generated"]}),V.jsxs("p",{children:["WebSocket Status:"," ",V.jsx("span",{style:{color:t?"green":"red"},children:l})]})]})}),d&&V.jsxs(V.Fragment,{children:[!h&&V.jsxs(we,{size:12,children:[V.jsx("h3",{children:"Setting up grid..."}),V.jsxs("div",{style:{marginBottom:"10px"},children:[!d&&V.jsx("p",{children:"Creating grid session..."}),d&&!u&&V.jsx("p",{children:"Setting up real-time sync..."}),d&&u&&!s&&V.jsx("p",{children:"Establishing secure connection..."}),d&&u&&s&&!t&&V.jsx("p",{children:"Connecting to server..."}),t&&!h&&V.jsx("p",{children:"Loading table data..."}),V.jsx(Ec,{numRows:4,numCols:1})]})]}),h&&V.jsxs(we,{size:12,children:[x,V.jsx(ut.DataSheetGrid,{ref:R,value:f,columns:m,rowKey:cu,rowClassName:({rowData:A,rowIndex:D})=>{var z,$,X;return Gc({"row-valid":((z=A.__validationResults)==null?void 0:z.isValid)===!0,"row-invalid":(($=A.__validationResults)==null?void 0:$.isValid)===!1,"row-unknown":((X=A.__validationResults)==null?void 0:X.isValid)==null,"row-selected":E===D})},duplicateRow:({rowData:A})=>({...A}),onChange:C,onActiveCellChange:({cell:A})=>{I(A?A.row:null)}}),E!==null&&f[E]&&Array.isArray((M=f[E].__validationResults)==null?void 0:M.allValidationMessages)&&((P=f[E].__validationResults)==null?void 0:P.allValidationMessages.length)>0&&V.jsx(Mc,{variant:"warning",title:"Validation Messages:",isGlobal:!1,description:V.jsx("ul",{children:f[E].__validationResults.allValidationMessages.map(A=>V.jsx("li",{children:A},A))}),sx:{marginTop:"12px"}})]}),h&&d.sourceEntityId&&V.jsx(we,{container:!0,size:12,sx:{justifyContent:"flex-end"},children:V.jsx(Yi,{sourceEntityId:d.sourceEntityId,gridSessionId:d.sessionId})}),c&&V.jsxs(we,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[V.jsx("h3",{children:"Model snapshot"}),b?V.jsx(Lc,{value:b}):"No model available"]})]})]})})});try{kr.displayName="SynapseGrid",kr.__docgenInfo={description:"",displayName:"SynapseGrid",props:{query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}const X_={title:"Components/SynapseGrid",component:kr,parameters:{stack:"staging"},argTypes:{showDebugInfo:{control:"boolean",description:"Show debug information including session details and model snapshot"}}},Wp=e=>{const c=U.useRef(null);return V.jsxs("div",{children:[V.jsx(gr,{variant:"outlined",onClick:()=>{var g;return(g=c.current)==null?void 0:g.initializeGrid()},sx:{color:"inherit",margin:"10px 0"},children:"Start Grid Session"}),V.jsx(kr,{ref:c,...e})]})},Nr={render:Wp,args:{query:"SELECT * FROM syn35295069"},parameters:{msw:{handlers:[]}}},Er={args:{query:"",showDebugInfo:!0},parameters:{msw:{handlers:[]}}};var Jl,Kl,Yl;Nr.parameters={...Nr.parameters,docs:{...(Jl=Nr.parameters)==null?void 0:Jl.docs,source:{originalSource:`{
  render: GridWithButton,
  args: {
    query: 'SELECT * FROM syn35295069'
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(Yl=(Kl=Nr.parameters)==null?void 0:Kl.docs)==null?void 0:Yl.source}}};var Xl,Ql,Zl;Er.parameters={...Er.parameters,docs:{...(Xl=Er.parameters)==null?void 0:Xl.docs,source:{originalSource:`{
  args: {
    query: '',
    showDebugInfo: true
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(Zl=(Ql=Er.parameters)==null?void 0:Ql.docs)==null?void 0:Zl.source}}};const Q_=["GridWithQuery","GridWithUserInputAndDebugInfo"];export{Nr as GridWithQuery,Er as GridWithUserInputAndDebugInfo,Q_ as __namedExportsOrder,X_ as default};
