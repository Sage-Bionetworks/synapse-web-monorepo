import{cf as b,cg as V,an as k,r as c,ch as x,ci as F,cj as A,ck as H,cl as L,cm as C,cn as D,co as G,aF as M,cp as O,j as w,c1 as P}from"./iframe-CV5uF1_e.js";import{u as Y}from"./useDebouncedEffect-Cg31oXO1.js";import{u as j}from"./use-deep-compare-effect.esm-BeIpRdZO.js";import{u as q}from"./uniq-L1qv973h.js";import{w as B}from"./without-iK-b8OFb.js";import{a as K}from"./UserBadge-yVhGbWiX.js";import{u as J,S as $,c as v}from"./Select-aab027f3.esm-BlVyaPXS.js";import{U as _}from"./UserOrTeamBadge-DnfNL1e_.js";var Q=Math.ceil,W=Math.max;function X(t,e,n){e===void 0?e=1:e=W(b(e),0);var o=t==null?0:t.length;if(!o||e<1)return[];for(var r=0,a=0,s=Array(Q(o/e));r<o;)s[a++]=V(t,r,r+=e);return s}const Z={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},z={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},ee={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},te=async(t,e)=>{const n=await C(t,e),r=t.filter(a=>n.results.map(s=>s.id).indexOf(a.targetId)===-1).map(a=>({...z,id:a.targetId,name:`${a.targetId}`}));return[...n.results,...r]},ne=async t=>{const e=(await D(t)).children,o=t.filter(r=>e.map(a=>a.ownerId).indexOf(r)===-1).map(r=>({...Z,ownerId:r,name:`Unknown User (${r})`}));return[...e,...o]},ae=async(t,e)=>{const n=await L({evaluationIds:t},e),r=t.filter(a=>n.results.map(s=>s.id).indexOf(a)===-1).map(a=>({...ee,id:a,name:a}));return[...n.results,...r]};function re(t){const{ids:e,type:n}=t,{accessToken:o}=k(),[r,a]=c.useState([]),s=n==="USER_PROFILE"?"ownerId":"id",g=(l=>{switch(l){case"USER_PROFILE":return H;case"ENTITY_HEADER":return A;case"EVALUATION_QUEUE":return F;default:return""}})(n),y=r.map(l=>l[s]),m=e.filter(l=>l!==x),h=q(B(m,...y));return c.useEffect(()=>{(S=>{if(!S.length)return;const d=sessionStorage.getItem(g);try{const p=d?JSON.parse(d):[],I=p.map(i=>i[s]);for(const i of S)I.includes(i[s])||p.push(i);sessionStorage.setItem(g,JSON.stringify(p))}catch{sessionStorage.setItem(g,JSON.stringify(S))}})(r)},[r,s,g]),j(()=>{let l=!1;return(async()=>{if(h.length>0)try{const d=Array.from(h),p=n==="ENTITY_HEADER"?d.map(f=>({targetId:f})):d,I=X(p,45),i=[];for(const f of I){let E=[];switch(n){case"USER_PROFILE":E=await ne(f);break;case"ENTITY_HEADER":E=await te(f,o);break;case"EVALUATION_QUEUE":E=await ae(f,o);break}i.push(...E)}l||a(f=>f.concat(...i))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{l=!0}},[o,n,h]),r}var se=c.forwardRef(function(t,e){var n=J(t);return c.createElement($,G({ref:e},n))}),oe=se;const le={SingleValue:t=>{const{data:e}=t;return c.createElement(v.SingleValue,{...t,key:e?.id},w.jsx(_,{userGroupHeader:e?.header,disableHref:!0,showFullName:!0},e?.header.ownerId))},Option:t=>{const{data:e}=t;return c.createElement(v.Option,{...t,key:e?.id},w.jsx(_,{userGroupHeader:e?.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}};function T(t){const{inputId:e,defaultValue:n=null,onChange:o,filterPredicate:r,typeFilter:a,placeholder:s,focusOnSelect:U=!1,value:g}=t,{palette:y}=M(),[m,h]=c.useState(""),[l,S]=c.useState("");Y(()=>{S(m)},[m],500);const[d=void 0]=re({ids:n?[n]:[],type:"USER_PROFILE"}),p=!!l,{data:I,isLoading:i}=K(l,a,{enabled:p}),f=c.useRef(null);c.useEffect(()=>{U&&f.current&&f.current.focus()});const E=c.useMemo(()=>i||m!==l?()=>"Loadingâ€¦":void 0,[i,l,m]),N=(I??[]).filter(r??(()=>!0)).map(u=>({id:u.ownerId.toString(),value:u.ownerId.toString(),label:u.userName,header:u})),R=c.useMemo(()=>s!==void 0?s:a==O.USERS_ONLY?"Name (first and last)":a==O.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[s,a]);return n&&d==null?w.jsx(P,{width:"100%"}):w.jsx(oe,{className:"UserSearchBoxV2",ref:f,inputValue:m,onInputChange:h,filterOption:()=>!0,isLoading:i,options:!i&&N||[],noOptionsMessage:E,openMenuOnClick:!1,placeholder:R,defaultValue:n?{id:n,value:n,label:d.userName,header:d}:void 0,inputId:e,isClearable:!0,value:g,styles:{control:u=>({...u,backgroundColor:y.grey[200]}),input:u=>({...u,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:u=>({...u,zIndex:2})},components:le,onChange:u=>{o&&o(u?.id??null,u?.header??null)}})}try{T.displayName="UserSearchBoxV2",T.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"(principalId: string, header: UserGroupHeader) => void"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"(item: UserGroupHeader) => boolean"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<{ id: string; value: string; label: string; header: UserGroupHeader; }>"}}}}}catch{}export{oe as S,T as U,X as c,re as u};
