import{as as S,aD as A,aE as F,a9 as N,r as n,c8 as w,j as a,V as g,X as b,e1 as E,da as V,c3 as q}from"./iframe-DkJtXMGY.js";import{a as O}from"./useTeam-_2HgBmOm.js";import{f as k}from"./useTeamMembers-D6CnY3Vp.js";import{p as W}from"./papaparse.min-D1KxGBLm.js";function D(p){const{accessToken:v,keyFactory:l}=S(),d=A();return F({...p,mutationFn:m=>N.registerChallengeTeam(m,v),onSuccess:async(m,i,t)=>{await d.invalidateQueries({queryKey:l.getChallengeTeamListQueryKey(i.challengeId)})}})}function Q(){const{mutateAsync:p,isPending:v,error:l}=O(),{mutateAsync:d,isPending:m,error:i}=k(),{mutateAsync:t,isPending:j,error:c}=D(),C=n.useCallback(async(u,h,s)=>{const y=[];for(const r of h){const o=await d({teamId:u,inviteeEmail:r.trim(),message:s});y.push(o)}return y},[d]),f=n.useCallback(async(u,h,s,y)=>{const r=await p(u),o=t({teamId:r.id,challengeId:h}),I=C(r.id,s,y);return Promise.all([Promise.resolve(r),o,I])},[p,C,t]),P=n.useMemo(()=>l||i||c?[l,i,c].filter(s=>s!=null):void 0,[c,l,i]);return{createAndRegisterTeam:f,isPending:v||m||j,errors:P}}const U=3,B="Please limit the initial number of invited members to three. You may add additional members after the team has been created.",_=n.forwardRef(function(v,l){const{challengeId:d,onCanSubmitChange:m=w,onFinished:i=w}=v,[t,j]=n.useState({name:"",description:""}),[c,C]=n.useState(""),[f,P]=n.useState(""),u=e=>{const x={...t,...e};j(x)},{inviteesParseResult:h,parsedInvitees:s}=n.useMemo(()=>{const e=W.parse(f,{delimiter:",",transform(M){return M.trim()}}),x=e.data[0]||[];return{inviteesParseResult:e,parsedInvitees:x}},[f]),r=s.length>U,o=!!(t&&t.name&&t.name.length>1&&!r);n.useEffect(()=>{m(o)},[o,m]);const{createAndRegisterTeam:I,isPending:T,errors:R}=Q();return n.useImperativeHandle(l,()=>({submit(){if(!o){console.warn("Attempted to submit when form data was not valid. Nothing will happen.");return}I(t,d,s,c).then(([e])=>{i(e.id)}).catch(()=>{})}}),[o,s,I,t,d,c,i]),a.jsxs(g,{children:[a.jsx(b,{variant:"body1",sx:{lineHeight:"20px"},children:"Create a new team for this Challenge!"}),a.jsx(E,{id:"name",label:"Team Name",value:t.name,fullWidth:!0,autoFocus:!0,required:!0,onChange:e=>u({name:e.target.value}),disabled:T}),a.jsx(g,{sx:{display:"flex"},children:a.jsx(E,{id:"description",label:a.jsx(g,{sx:{display:"flex",gap:2},children:a.jsx(g,{children:"Team Description"})}),value:t.description,fullWidth:!0,multiline:!0,rows:4,onChange:e=>u({description:e.target.value}),disabled:T})}),a.jsx(g,{sx:{display:"flex"},children:a.jsx(E,{id:"message",label:a.jsx(g,{sx:{display:"flex",gap:2},children:a.jsx(g,{children:"Recruitment Message"})}),value:c,fullWidth:!0,multiline:!0,rows:4,onChange:e=>C(e.target.value),disabled:T})}),a.jsx(E,{id:"invitees",label:"Emails of Additional Members to Invite (max 3)",placeholder:"Enter emails separated by comma",value:f,fullWidth:!0,onChange:e=>P(e.target.value),disabled:T}),(r||!V(h.errors)||R)&&a.jsxs(q,{severity:"error",children:[r&&a.jsx(b,{variant:"body1",children:B}),h.errors.map((e,x)=>a.jsx(b,{variant:"body1",children:e.message},x)),R&&R.map(e=>a.jsx(b,{variant:"body1",children:e.reason},e.reason))]})]})});try{_.displayName="CreateChallengeTeam",_.__docgenInfo={description:"",displayName:"CreateChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCanSubmitChange:{defaultValue:null,description:"",name:"onCanSubmitChange",required:!1,type:{name:"(canSubmit: boolean) => void"}},onFinished:{defaultValue:null,description:"",name:"onFinished",required:!1,type:{name:"(teamId: string) => void"}}}}}catch{}export{_ as C};
