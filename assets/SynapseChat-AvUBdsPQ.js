import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{l as S,S as C}from"./useFiles-DoM6saS5.js";import{s as y}from"./VerificationSubmission-BDh1zA9f.js";import"./StringUtils-C95LMFI-.js";import"./OrientationBanner-DXHS9Ok7.js";import{r as a}from"./index-C0wX4_D5.js";import{u as xe}from"./useQuery-kiquRXJF.js";import{u as P}from"./useMutation-CdgWCH4U.js";import{S as fe}from"./LoadingScreen-CeYUsrXv.js";import"./SkeletonButton-DlnglF6i.js";import"./SkeletonInlineBlock-5CAqqmxD.js";import"./SkeletonTable-welLau-Y.js";import{S as ge}from"./SkeletonParagraph-C7V-74O4.js";import{d as he}from"./ToastMessage-B5kf2pcc.js";import{D as ye}from"./DropdownSelect-CoSPcPIM.js";import{B as p}from"./Box-BD_ma7_J.js";import{T as v}from"./Typography-z9eLrlT0.js";import{M as Se}from"./MarkdownSynapse-Dmk4Ckus.js";import{u as se}from"./useTheme-xbf2ZGeF.js";import{L as Z}from"./ListItem-NivCFp--.js";import{L as Ae}from"./ListItemText-BFWDr4s5.js";import{c as Ie}from"./createSvgIcon-C1R5uYZR.js";import{A as te}from"./Alert-SAf-HTP7.js";import{L as ve}from"./List-Bgtp5xuW.js";import{T as Te}from"./ButtonBase-BZaAYyhz.js";import{F as Ce}from"./Fade-Be6GbFNo.js";import{T as Ee}from"./TextField-WzCdxSt1.js";import{I as Re}from"./IconButton-DNzDJyyG.js";import{A as _e}from"./ArrowUpward-BpTelzbc.js";const be=Ie([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function je(s){const{accessToken:i}=S();return P({mutationFn:n=>C.createAgentSession(n,i),onSuccess:async(n,r,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,r,o)}})}function Le(s){const{accessToken:i}=S();return P({mutationFn:n=>C.updateAgentSession(n,i),onSuccess:async(n,r,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,r,o)},onError:async(n,r,o)=>{s!=null&&s.onError&&await s.onError(n,r,o)}})}function Me(s,i){const{accessToken:n}=S();return P({mutationFn:r=>C.getAgentChatAsyncJobResults(r,n,i),onSuccess:(r,o,c)=>{s!=null&&s.onSuccess&&r.responseBody&&s.onSuccess(r.responseBody,o,c)},onError:(r,o,c)=>{s!=null&&s.onError&&s.onError(r,o,c)}})}function Ve(s,i){const{accessToken:n,keyFactory:r}=S();return xe({...i,queryKey:r.getChatAgentTraceKey(s),queryFn:()=>C.getChatAgentTraceEvents(s,n)})}const k=[{value:y.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:y.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:y.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function D({onChange:s,initAccessLevel:i}){const n=k.findIndex(l=>l.value==i),r=k.map(l=>l.label),[o,c]=a.useState(n);return e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[e.jsx(v,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),e.jsx(ye,{variant:"outlined",options:r,selectedIndex:o,setSelectedIndex:l=>{o!==l&&(c(l),s(k[l].value))}})]})}try{D.displayName="AccessLevelMenu",D.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function T({userMessage:s,chatResponseText:i,chatErrorReason:n,scrollIntoView:r=!1}){const o=se(),c=a.useRef(null);a.useEffect(()=>{r&&c.current&&c.current.scrollIntoView({behavior:"smooth"})},[c]);const l=a.useMemo(()=>{const A=new DOMParser().parseFromString(i??"","text/html");return A.querySelectorAll("tool_name").forEach(E=>E.remove()),A.body.textContent??""},[i]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{ref:c,sx:{alignSelf:"flex-end",backgroundColor:o.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(Ae,{primary:s})}),l&&e.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(p,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(be,{sx:{color:"secondary.main"}})}),e.jsx(p,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"},children:e.jsx(Se,{markdown:l})})]}),n&&e.jsx(te,{severity:"error",sx:{my:2},children:n})]})}try{T.displayName="SynapseChatInteraction",T.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function ee({initialMessage:s,agentRegistrationId:i,chatbotName:n="SynapseChat",hideTitle:r=!1,textboxPositionOffset:o="0px",sessionContext:c,externalSession:l,setExternalSession:q,externalInteractions:A,setExternalInteractions:B,showAccessLevelMenu:E=!0}){const{accessToken:ne}=S(),[re,ae]=a.useState(),u=l??re,U=q??ae,{mutate:R,error:Y}=je({onSuccess:t=>U(t)}),{mutate:oe}=Le({onSuccess:t=>U(t),onError:t=>he(`Unable to update the agent session: ${t.message}`,"danger")}),ie=se(),[O,ce]=a.useState(c?y.WRITE_YOUR_PRIVATE_DATA:y.PUBLICLY_ACCESSIBLE),[le,ue]=a.useState([]),W=A??le,de=B??ue,[d,_]=a.useState(),[b,F]=a.useState(),[j,N]=a.useState(""),[L,z]=a.useState(""),[f,K]=a.useState(""),[G,pe]=a.useState(!1),[m,H]=a.useState(),{mutate:M}=Me({onSuccess:t=>{N(t.responseText)},onError:t=>{z(t.reason)}},t=>{F(t.jobId)}),{data:x}=Ve({jobId:b,newerThanTimestamp:m==null?void 0:m.timestamp},{enabled:!!b,refetchInterval:b?1e3:!1,refetchIntervalInBackground:!0});a.useEffect(()=>{if(x&&x.page.length>0){const t=x.page[x.page.length-1],w=JSON.parse(t.message);let Q="";const X=g=>{for(const h in g)h==="text"&&typeof g[h]=="string"?Q+=g[h]+`
`:typeof g[h]=="object"&&X(g[h])};X(w),t.friendlyMessage=Q??"Thinking...",H(t),console.debug(x.page)}},[x]),a.useEffect(()=>{d&&(j||L)&&(d.chatResponseText=j,d.chatErrorReason=L,de([...W,d]),N(""),z(""),_(void 0),F(void 0),H(void 0))},[j,L,d]),a.useEffect(()=>{R&&!u&&R({agentAccessLevel:O,agentRegistrationId:i,sessionContext:c})},[R,u,ne,c]),a.useEffect(()=>{u&&s&&!G&&(_({userMessage:s}),M({chatText:s,sessionId:u.sessionId,enableTrace:!0}),pe(!0))},[u,s,G,M]);const V=()=>{f.trim()&&(_({userMessage:f}),K(""),M({chatText:f,sessionId:u.sessionId,enableTrace:!0}))},I=!u||!f||!!d,me=t=>{!I&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),V())},J=ie.palette.secondary[300];if(Y)return e.jsx(te,{severity:"error",sx:{my:2},children:Y.reason});const $=(m==null?void 0:m.friendlyMessage)??"Thinking...";return e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",height:"100%"},children:[!r&&e.jsx(v,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:n}),E&&e.jsx(D,{initAccessLevel:O,onChange:t=>{ce(t),oe({agentAccessLevel:t,sessionId:u.sessionId})}}),!u&&e.jsx(ge,{numRows:10}),u&&e.jsx(p,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(ve,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[W.map((t,w)=>e.jsx(T,{userMessage:t.userMessage,chatResponseText:t.chatResponseText,chatErrorReason:t.chatErrorReason},w)),d&&e.jsxs(e.Fragment,{children:[e.jsx(T,{userMessage:d.userMessage,chatResponseText:d.chatResponseText,chatErrorReason:d.chatErrorReason,scrollIntoView:!0}),e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"5px"},children:[e.jsx(fe,{size:40}),e.jsx(p,{sx:{position:"relative",pt:"130px"},children:e.jsx(Te,{children:e.jsx(Ce,{timeout:500,children:e.jsx(v,{sx:{textAlign:"center",position:"absolute",width:"100%",top:0},variant:"body1Italic",children:$})},$)})})]})]})]})}),e.jsx(p,{sx:{position:"sticky",bottom:o,backgroundColor:"white"},children:e.jsxs(p,{component:"form",sx:{pt:"8px",mt:"5px",pb:"10px",position:"sticky",borderTop:"1px solid",borderColor:"grey.400"},onSubmit:V,children:[e.jsx(Ee,{fullWidth:!0,value:f,onChange:t=>K(t.target.value),onKeyDown:me,placeholder:`Message ${n}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:e.jsx(Re,{disabled:I,onClick:V,sx:{ml:"7px",mr:"-8px",color:J,borderStyle:"solid",borderWidth:I?"1px":"2px",borderColor:I?"gray":J},children:e.jsx(_e,{})})}}}),e.jsxs(v,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[n," can make mistakes."]})]})})]})}try{ee.displayName="SynapseChat",ee.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}},sessionContext:{defaultValue:null,description:"",name:"sessionContext",required:!1,type:{name:"GridAgentSessionContext"}},externalSession:{defaultValue:null,description:"",name:"externalSession",required:!1,type:{name:"AgentSession"}},setExternalSession:{defaultValue:null,description:"",name:"setExternalSession",required:!1,type:{name:"(s: AgentSession) => void"}},externalInteractions:{defaultValue:null,description:"",name:"externalInteractions",required:!1,type:{name:"ChatInteraction[]"}},setExternalInteractions:{defaultValue:null,description:"",name:"setExternalInteractions",required:!1,type:{name:"(i: ChatInteraction[]) => void"}},defaultAgentAccessLevel:{defaultValue:null,description:"",name:"defaultAgentAccessLevel",required:!1,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},showAccessLevelMenu:{defaultValue:{value:"true"},description:"",name:"showAccessLevelMenu",required:!1,type:{name:"boolean"}}}}}catch{}export{ee as S,be as a};
