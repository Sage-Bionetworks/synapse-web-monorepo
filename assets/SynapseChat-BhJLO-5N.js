import{U as J,j as s,an as g,aI as q,aa as j,am as K,r as l,hX as A,V as x,X as k,aF as z,B as te,dZ as se,Y as ne,c4 as $,dR as ae,c6 as re,br as oe,J as ce}from"./iframe-WWZqBZnn.js";import"./SkeletonButton-Ce9jKFb5.js";import"./SkeletonInlineBlock-DLew4KjD.js";import"./SkeletonTable-DehOuMuf.js";import{S as le}from"./SkeletonParagraph-CCoh0O-o.js";import{D as ie}from"./DropdownSelect-D0css46B.js";import{J as L}from"./index-browser-esm-k-o2Qe0C.js";import{M as N}from"./MarkdownSynapse-CXeQLUv7.js";import{L as W}from"./ListItem-DiDXfibq.js";import{L as de}from"./ListItemText-BAgiiXKi.js";import{K as ue}from"./KeyboardArrowDown-CsYaTZK8.js";import{A as pe}from"./ArrowUpward-CUEZU4g1.js";const xe=J(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),me=J([s.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),s.jsx("path",{d:"M8 15h8v2H8z"},"1"),s.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),s.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),s.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function fe(e){const{accessToken:r}=g();return q({mutationFn:t=>j.createAgentSession(t,r),onSuccess:async(t,n,c)=>{e!=null&&e.onSuccess&&await e.onSuccess(t,n,c)}})}function he(e){const{accessToken:r}=g();return q({mutationFn:t=>j.updateAgentSession(t,r),onSuccess:async(t,n,c)=>{e!=null&&e.onSuccess&&await e.onSuccess(t,n,c)},onError:async(t,n,c)=>{e!=null&&e.onError&&await e.onError(t,n,c)}})}function ge(e,r){const{accessToken:t}=g();return q({mutationFn:n=>j.getAgentChatAsyncJobResults(n,t,r),onSuccess:(n,c,a)=>{e!=null&&e.onSuccess&&n.responseBody&&e.onSuccess(n.responseBody,c,a)},onError:(n,c,a)=>{e!=null&&e.onError&&e.onError(n,c,a)}})}function ye(e,r){const{accessToken:t,keyFactory:n}=g();return K({...r,queryKey:n.getChatAgentTraceKey(e),queryFn:()=>j.getChatAgentTraceEvents(e,t)})}function Se(e){const[r,t]=l.useState([]),[n,c]=l.useState(null),{mutate:a}=ge({onMutate:d=>{c(d.chatText)}},d=>{r.includes(d.jobId)||(c(null),t(()=>[...r,d.jobId]))}),o=l.useCallback(d=>{if(!(e!=null&&e.sessionId))throw new Error("No agent session available to send chat message.");a({chatText:d,sessionId:e.sessionId,enableTrace:!0})},[e==null?void 0:e.sessionId,a]);return l.useMemo(()=>({sendChat:o,pendingMessage:n,chatJobIds:r}),[o,n,r])}const V=[{value:A.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:A.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:A.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function P({onChange:e,initAccessLevel:r}){const t=V.findIndex(o=>o.value==r),n=V.map(o=>o.label),[c,a]=l.useState(t);return s.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[s.jsx(k,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),s.jsx(ie,{variant:"outlined",options:n,selectedIndex:c,setSelectedIndex:o=>{c!==o&&(a(o),e(V[o].value))}})]})}try{P.displayName="AccessLevelMenu",P.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function Ae(e){const r=[],t=JSON.parse(e.message);return L({path:"$.output.message.content[*]",json:t}).forEach(c=>{const a=L({path:"$.reasoningContent.reasoningText.text",json:c});a[0]&&r.push({reasoningText:a[0]});const o=L({path:"$.toolUse[name,input]",json:c});o.length>0&&r.push({toolName:o[0],toolInput:o[1]})}),r}function Te(e){return"reasoningText"in e?e.reasoningText:""}function _({userMessage:e,chatResponseText:r,chatErrorReason:t,chatResponseTrace:n,scrollIntoView:c=!1}){const a=z(),o=l.useRef(null),[d,y]=l.useState(!1);l.useEffect(()=>{c&&o.current&&o.current.scrollIntoView({behavior:"smooth"})},[o]);const T=!r&&!t,f=l.useMemo(()=>{var u;return(u=(n??[]).flatMap(m=>Ae(m)))==null?void 0:u.filter(m=>!!m)},[n]),E=f.length>0,v=l.useMemo(()=>f.filter(u=>"reasoningText"in u).at(-1),[f]),p=v==null?"Thinking...":v.reasoningText,C=T?p:`${d?"Hide":"Show"} Trace`,h=l.useMemo(()=>{const m=new DOMParser().parseFromString(r??"","text/html");return m.querySelectorAll("tool_name").forEach(S=>S.remove()),m.body.textContent??""},[r]);return s.jsxs(s.Fragment,{children:[s.jsx(W,{ref:o,sx:{alignSelf:"flex-end",backgroundColor:a.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:s.jsx(de,{primary:e})}),s.jsxs(W,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[s.jsx(x,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:s.jsx(me,{sx:{color:"secondary.main"}})}),s.jsxs(x,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%",overflow:"auto"},children:[s.jsxs(x,{component:"aside",sx:{".markdown":{fontStyle:"italic",borderLeft:`4px solid ${a.palette.grey[300]}`,marginLeft:"4px",paddingLeft:"8px",mt:1,mb:2}},children:[s.jsx(te,{variant:"outlined",size:"small",startIcon:T?s.jsx(se,{size:14}):d?s.jsx(ue,{sx:{width:"14px"}}):s.jsx(xe,{sx:{width:"14px"}}),disabled:!E,onClick:()=>{y(u=>!u)},sx:{height:"20px",fontSize:"12px",fontWeight:600,mb:1,border:"none !important",color:"grey.700",justifyContent:"flex-start",whiteSpace:"nowrap",maxWidth:"325px",textTransform:"none",pl:0,".MuiButton-startIcon":{mr:.5}},children:s.jsx(x,{sx:{overflow:"hidden",textOverflow:"ellipsis"},children:C})}),n&&s.jsx(ne,{in:d,children:s.jsx(N,{markdown:f.map(Te).filter(u=>u.trim().length>0).join("<br/><br/>")})})]}),h&&s.jsx(N,{markdown:h})]})]}),t&&s.jsx($,{severity:"error",sx:{my:2},children:t})]})}try{_.displayName="SynapseChatInteraction",_.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},chatResponseTrace:{defaultValue:null,description:"",name:"chatResponseTrace",required:!1,type:{name:"TraceEvent[]"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function ve(e){var o;const{synapseClient:r,keyFactory:t}=g(),[n,c]=l.useState(1e3),a=K({queryKey:t.getAsyncJobStatusQueryKey(e),refetchInterval:n,queryFn:()=>r.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:e})});return l.useEffect(()=>{(a.error||a.data&&(a==null?void 0:a.data.jobState)!="PROCESSING")&&c(!1)},[a.data,(o=a.data)==null?void 0:o.jobState,a.error]),a}function Ce(e,r){const[t,n]=l.useState([]),c=l.useCallback(d=>{n(y=>[...y,...d])},[]),a=t.at(t.length-1),{data:o}=ye({jobId:e,newerThanTimestamp:a==null?void 0:a.timestamp},{enabled:r,refetchInterval:1e3,refetchIntervalInBackground:!0});return l.useEffect(()=>{o&&o.page.length>0&&(c(o.page),console.debug(o.page))},[c,o]),{traceEvents:t}}function D(e){const{chatJobId:r}=e,{data:t}=ve(r),n=t==null?void 0:t.requestBody,c=t==null?void 0:t.responseBody,a=t==null?void 0:t.errorMessage,o=!!r&&(!(t!=null&&t.jobState)||t.jobState=="PROCESSING"),{traceEvents:d}=Ce(r,o);return s.jsx(_,{userMessage:n==null?void 0:n.chatText,chatResponseText:c==null?void 0:c.responseText,chatResponseTrace:d,chatErrorReason:a})}try{D.displayName="SynapseChatMessage",D.__docgenInfo={description:"",displayName:"SynapseChatMessage",props:{chatJobId:{defaultValue:null,description:"",name:"chatJobId",required:!0,type:{name:"string"}}}}}catch{}function F({initialMessage:e,agentRegistrationId:r,chatbotName:t="SynapseChat",hideTitle:n=!1,textboxPositionOffset:c="0px",sessionContext:a,externalSession:o,setExternalSession:d,externalChatState:y,showAccessLevelMenu:T=!0}){const{accessToken:f}=g(),[E,v]=l.useState(),p=o??E,C=d??v,{mutate:h,error:u}=fe({onSuccess:i=>C(i)}),{mutate:m}=he({onSuccess:i=>C(i),onError:i=>ce(`Unable to update the agent session: ${i.message}`,"danger")}),B=z(),[S,G]=l.useState(a?A.WRITE_YOUR_PRIVATE_DATA:A.PUBLICLY_ACCESSIBLE),H=Se(p),Q=y??H,{pendingMessage:w,chatJobIds:X,sendChat:M}=Q,[I,O]=l.useState(""),[U,Z]=l.useState(!1);l.useEffect(()=>{h&&!p&&h({agentAccessLevel:S,agentRegistrationId:r,sessionContext:a})},[h,p,f,a,S,r]),l.useEffect(()=>{p&&e&&!U&&(M(e),Z(!0))},[p,e,U,M]);const R=()=>{I.trim()&&(M(I.trim()),O(""))},b=!p||!I||!!w,ee=i=>{!b&&i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),R())},Y=B.palette.secondary[300];return u?s.jsx($,{severity:"error",sx:{my:2},children:u.reason}):s.jsxs(x,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",height:"100%"},children:[!n&&s.jsx(k,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:t}),T&&s.jsx(P,{initAccessLevel:S,onChange:i=>{G(i),m({agentAccessLevel:i,sessionId:p.sessionId})}}),!p&&s.jsx(le,{numRows:10}),p&&s.jsx(x,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:s.jsxs(ae,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[X.map(i=>s.jsx(D,{chatJobId:i},i)),w&&s.jsx(_,{userMessage:w,chatResponseText:"",chatErrorReason:"",scrollIntoView:!0})]})}),s.jsx(x,{sx:{position:"sticky",bottom:c,backgroundColor:"white"},children:s.jsxs(x,{component:"form",sx:{pt:"8px",mt:"5px",pb:"10px",position:"sticky",borderTop:"1px solid",borderColor:"grey.400"},onSubmit:R,children:[s.jsx(re,{fullWidth:!0,value:I,onChange:i=>O(i.target.value),onKeyDown:ee,placeholder:`Message ${t}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:s.jsx(oe,{disabled:b,onClick:R,sx:{ml:"7px",mr:"-8px",color:Y,borderStyle:"solid",borderWidth:b?"1px":"2px",borderColor:b?"gray":Y},children:s.jsx(pe,{})})}}}),s.jsxs(k,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[t," can make mistakes."]})]})})]})}try{F.displayName="SynapseChat",F.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}},sessionContext:{defaultValue:null,description:"",name:"sessionContext",required:!1,type:{name:"GridAgentSessionContext"}},externalSession:{defaultValue:null,description:"",name:"externalSession",required:!1,type:{name:"AgentSession"}},setExternalSession:{defaultValue:null,description:"",name:"setExternalSession",required:!1,type:{name:"(s: AgentSession) => void"}},externalChatState:{defaultValue:null,description:"",name:"externalChatState",required:!1,type:{name:"ChatState"}},defaultAgentAccessLevel:{defaultValue:null,description:"",name:"defaultAgentAccessLevel",required:!1,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},showAccessLevelMenu:{defaultValue:{value:"true"},description:"",name:"showAccessLevelMenu",required:!1,type:{name:"boolean"}}}}}catch{}export{F as S,me as a,Se as u};
