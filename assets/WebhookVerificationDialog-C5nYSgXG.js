import{j as r}from"./jsx-runtime-DoxjgJx5.js";import{d as xe}from"./DeleteTwoTone-DC_IkqGz.js";import{b as I,x as ke,n as Se,f as Ce,_ as Ee,d as je,a as _e,j as we}from"./createTheme-BJ_1npSs.js";import{r as We}from"./createSvgIcon-BwZqRa6L.js";import{l as O,bJ as Oe}from"./useFiles-BUe0JE20.js";import{W as Pe}from"./WebhookVerificationStatus-CaCjD9x8.js";import{r as d,a as $e}from"./index-Cu9bd8lq.js";import{C as Z,f as Te}from"./ConfirmationDialog-CyP4Xsfs.js";import{E as Re}from"./EntityFinderModal-CByfG_pP.js";import{F as qe,V as Ie}from"./useEntitySelection-DYs2NqLT.js";import{d as G}from"./ToastMessage-BoAlYEgk.js";import{s as Ge}from"./Stack-ERnuki-b.js";import{i as Ne}from"./isMuiElement-yx-QWTmT.js";import{a as De,c as Fe,s as Ve,u as Be}from"./styled-D9q5EqxT.js";import{T as N}from"./Typography-BmBIKDjf.js";import{T as X}from"./TextField-cHNg-UFf.js";import{I as Ae}from"./IconButton-CLlNv19f.js";import{F as ce}from"./FormControlLabel-Ceo3GfFJ.js";import{S as Me}from"./Switch-BDqCn_tY.js";import{I as le}from"./InputLabel-Yg9ANo8l.js";import{F as Le}from"./FormGroup-DrbvCU_x.js";import{C as Ue}from"./Checkbox-De6Bx9_m.js";import{a as Qe}from"./ThemesPlot-tPzcrmur.js";import{B as Ke}from"./Button-BfexmcsD.js";import{A as ee}from"./Alert-B_MCCiJI.js";import{L as ue}from"./Link-D8sP8KOh.js";import{B as ze}from"./Box-BXEUN41W.js";import{u as D}from"./utils-BECe8vEQ.js";import{u as F}from"./useMutation-BUHlmdy0.js";import{u as Ye}from"./useInfiniteQuery-BgVDtSTK.js";const He=(e,o)=>e.filter(t=>o.includes(t)),P=(e,o,t)=>{const n=e.keys[0];Array.isArray(o)?o.forEach((s,i)=>{t((a,c)=>{i<=e.keys.length-1&&(i===0?Object.assign(a,c):a[e.up(e.keys[i])]=c)},s)}):o&&typeof o=="object"?(Object.keys(o).length>e.keys.length?e.keys:He(e.keys,Object.keys(o))).forEach(i=>{if(e.keys.indexOf(i)!==-1){const a=o[i];a!==void 0&&t((c,f)=>{n===i?Object.assign(c,f):c[e.up(i)]=f},a)}}):(typeof o=="number"||typeof o=="string")&&t((s,i)=>{Object.assign(s,i)},o)};function h(e){return e?`Level${e}`:""}function V(e){return e.unstable_level>0&&e.container}function pe(e){return function(t){return`var(--Grid-${t}Spacing${h(e.unstable_level)})`}}function oe(e){return function(t){return e.unstable_level===0?`var(--Grid-${t}Spacing)`:`var(--Grid-${t}Spacing${h(e.unstable_level-1)})`}}function te(e){return e.unstable_level===0?"var(--Grid-columns)":`var(--Grid-columns${h(e.unstable_level-1)})`}const Je=({theme:e,ownerState:o})=>{const t=pe(o),n={};return P(e.breakpoints,o.gridSize,(s,i)=>{let a={};i===!0&&(a={flexBasis:0,flexGrow:1,maxWidth:"100%"}),i==="auto"&&(a={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof i=="number"&&(a={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${i} / ${te(o)}${V(o)?` + ${t("column")}`:""})`}),s(n,a)}),n},Ze=({theme:e,ownerState:o})=>{const t={};return P(e.breakpoints,o.gridOffset,(n,s)=>{let i={};s==="auto"&&(i={marginLeft:"auto"}),typeof s=="number"&&(i={marginLeft:s===0?"0px":`calc(100% * ${s} / ${te(o)})`}),n(t,i)}),t},Xe=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=V(o)?{[`--Grid-columns${h(o.unstable_level)}`]:te(o)}:{"--Grid-columns":12};return P(e.breakpoints,o.columns,(n,s)=>{n(t,{[`--Grid-columns${h(o.unstable_level)}`]:s})}),t},eo=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=oe(o),n=V(o)?{[`--Grid-rowSpacing${h(o.unstable_level)}`]:t("row")}:{};return P(e.breakpoints,o.rowSpacing,(s,i)=>{var a;s(n,{[`--Grid-rowSpacing${h(o.unstable_level)}`]:typeof i=="string"?i:(a=e.spacing)==null?void 0:a.call(e,i)})}),n},oo=({theme:e,ownerState:o})=>{if(!o.container)return{};const t=oe(o),n=V(o)?{[`--Grid-columnSpacing${h(o.unstable_level)}`]:t("column")}:{};return P(e.breakpoints,o.columnSpacing,(s,i)=>{var a;s(n,{[`--Grid-columnSpacing${h(o.unstable_level)}`]:typeof i=="string"?i:(a=e.spacing)==null?void 0:a.call(e,i)})}),n},to=({theme:e,ownerState:o})=>{if(!o.container)return{};const t={};return P(e.breakpoints,o.direction,(n,s)=>{n(t,{flexDirection:s})}),t},no=({ownerState:e})=>{const o=pe(e),t=oe(e);return I({minWidth:0,boxSizing:"border-box"},e.container&&I({display:"flex",flexWrap:"wrap"},e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},{margin:`calc(${o("row")} / -2) calc(${o("column")} / -2)`},e.disableEqualOverflow&&{margin:`calc(${o("row")} * -1) 0px 0px calc(${o("column")} * -1)`}),(!e.container||V(e))&&I({padding:`calc(${t("row")} / 2) calc(${t("column")} / 2)`},(e.disableEqualOverflow||e.parentDisableEqualOverflow)&&{padding:`${t("row")} 0px 0px ${t("column")}`}))},ro=e=>{const o=[];return Object.entries(e).forEach(([t,n])=>{n!==!1&&n!==void 0&&o.push(`grid-${t}-${String(n)}`)}),o},so=(e,o="xs")=>{function t(n){return n===void 0?!1:typeof n=="string"&&!Number.isNaN(Number(n))||typeof n=="number"&&n>0}if(t(e))return[`spacing-${o}-${String(e)}`];if(typeof e=="object"&&!Array.isArray(e)){const n=[];return Object.entries(e).forEach(([s,i])=>{t(i)&&n.push(`spacing-${s}-${String(i)}`)}),n}return[]},io=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([o,t])=>`direction-${o}-${t}`):[`direction-xs-${String(e)}`],ao=["className","children","columns","container","component","direction","wrap","spacing","rowSpacing","columnSpacing","disableEqualOverflow","unstable_level"],co=ke(),lo=Ge("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,o)=>o.root});function uo(e){return De({props:e,name:"MuiGrid",defaultTheme:co})}function fo(e={}){const{createStyledComponent:o=lo,useThemeProps:t=uo,componentName:n="MuiGrid"}=e,s=d.createContext(void 0),i=(f,l)=>{const{container:k,direction:y,spacing:S,wrap:C,gridSize:b}=f,E={root:["root",k&&"container",C!=="wrap"&&`wrap-xs-${String(C)}`,...io(y),...ro(b),...k?so(S,l.breakpoints.keys[0]):[]]};return Fe(E,g=>_e(n,g),{})},a=o(Xe,oo,eo,Je,to,no,Ze),c=d.forwardRef(function(l,k){var y,S,C,b,E,g,B,A;const $=Se(),Q=t(l),T=Ce(Q),j=d.useContext(s),{className:K,children:M,columns:L=12,container:U=!1,component:v="div",direction:z="row",wrap:Y="wrap",spacing:_=0,rowSpacing:H=_,columnSpacing:u=_,disableEqualOverflow:R,unstable_level:m=0}=T,q=Ee(T,ao);let x=R;m&&R!==void 0&&(x=l.disableEqualOverflow);const re={},se={},ie={};Object.entries(q).forEach(([p,w])=>{$.breakpoints.values[p]!==void 0?re[p]=w:$.breakpoints.values[p.replace("Offset","")]!==void 0?se[p.replace("Offset","")]=w:ie[p]=w});const he=(y=l.columns)!=null?y:m?void 0:L,ye=(S=l.spacing)!=null?S:m?void 0:_,be=(C=(b=l.rowSpacing)!=null?b:l.spacing)!=null?C:m?void 0:H,ge=(E=(g=l.columnSpacing)!=null?g:l.spacing)!=null?E:m?void 0:u,ae=I({},T,{level:m,columns:he,container:U,direction:z,wrap:Y,spacing:ye,rowSpacing:be,columnSpacing:ge,gridSize:re,gridOffset:se,disableEqualOverflow:(B=(A=x)!=null?A:j)!=null?B:!1,parentDisableEqualOverflow:j}),ve=i(ae,$);let J=r.jsx(a,I({ref:k,as:v,ownerState:ae,className:je(ve.root,K)},ie,{children:d.Children.map(M,p=>{if(d.isValidElement(p)&&Ne(p,["Grid"])){var w;return d.cloneElement(p,{unstable_level:(w=p.props.unstable_level)!=null?w:m+1})}return p})}));return x!==void 0&&x!==(j??!1)&&(J=r.jsx(s.Provider,{value:x,children:J})),J});return c.muiName="Grid",c}const W=fo({createStyledComponent:Ve("div",{name:"MuiGrid2",slot:"Root",overridesResolver:(e,o)=>o.root}),componentName:"MuiGrid2",useThemeProps:e=>Be({props:e,name:"MuiGrid2"})}),po={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE"},mo={ENTITY:"ENTITY"};function tt(e){const{synapseClient:o,keyFactory:t}=O();return Ye({...e,initialPageParam:void 0,queryKey:t.getWebhooksQueryKey(),queryFn:async n=>o.webhookServicesClient.postRepoV1WebhookList({listUserWebhooksRequest:{nextPageToken:n.pageParam}}),getNextPageParam:n=>n.nextPageToken})}function ho(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.postRepoV1Webhook({createOrUpdateWebhookRequest:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function yo(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.putRepoV1WebhookWebhookId(s),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function bo(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.deleteRepoV1WebhookWebhookId({webhookId:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function go(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.postRepoV1WebhookWebhookIdVerify(s),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()}),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}function nt(e){const{synapseClient:o,keyFactory:t}=O(),n=D();return F({...e,mutationFn:s=>o.webhookServicesClient.putRepoV1WebhookWebhookIdVerificationCode({webhookId:s}),onSuccess:(...s)=>{n.invalidateQueries({queryKey:t.getWebhooksQueryKey()})}})}var ne={},vo=we;Object.defineProperty(ne,"__esModule",{value:!0});var me=ne.default=void 0,xo=vo(We()),ko=r;me=ne.default=(0,xo.default)((0,ko.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"SearchOutlined");const So=encodeURIComponent("Request to add new domain for webhook verification"),Co=encodeURIComponent("<Please provide the domain(s) you wish to use and any additional details related to your request.>"),Eo=`https://sagebionetworks.jira.com/servicedesk/customer/portal/9/group/16/create/85?summary=${So}&description=${Co}`;function jo(e){return r.jsxs(ze,{sx:{backgroundColor:"rgb(178, 36, 42, 0.03)"},mt:"10px",py:2,px:4,children:[r.jsx(N,{sx:{my:1},color:"error",variant:"headline3",gutterBottom:!0,children:"DANGER ZONE"}),r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Editing the following information will require you to re-verify the webhook."}),e.children]})}function de(e){const{initialData:o,open:t,onClose:n}=e,s=mo.ENTITY,[i,a]=d.useState(""),[c,f]=d.useState(new Set),[l,k]=d.useState(""),[y,S]=d.useState(!0);d.useEffect(()=>{a((o==null?void 0:o.objectId)||""),f(new Set((o==null?void 0:o.eventTypes)||[])),k((o==null?void 0:o.invokeEndpoint)||""),S((o==null?void 0:o.isEnabled)??!0)},[o]);const[C,b]=d.useState(!1),[E,g]=d.useState(!1),{mutate:B,isPending:A,error:$}=ho({onSuccess:()=>{G("Webhook created","success"),n()}}),{mutate:Q,isPending:T,error:j}=yo({onSuccess:()=>{G("Webhook updated","success"),n()}}),{mutate:K,isPending:M,error:L}=bo({onSuccess:()=>{G("Webhook deleted","info"),g(!1),n()}}),U=A||T,v=$||j;function z(){o?Q({webhookId:o.id,createOrUpdateWebhookRequest:{objectType:s,objectId:i,eventTypes:c,invokeEndpoint:l,isEnabled:y}}):B({objectType:s,objectId:i,eventTypes:c,invokeEndpoint:l,isEnabled:y})}function Y(){o&&K(o.id)}const _=v&&v.errorResponse&&"errorCode"in v.errorResponse&&v.errorResponse.errorCode===Oe.UNSUPPORTED_WEBHOOK_DOMAIN,H=o&&o.verificationStatus===Pe.VERIFIED?jo:$e.Fragment;return r.jsx(Z,{open:t,title:"Create New Webhook",maxWidth:"md",onCancel:n,onConfirm:()=>{z()},confirmButtonProps:{children:`${o?"Update":"Create"} Webhook`,disabled:U},cancelButtonProps:{disabled:U},content:r.jsxs(r.Fragment,{children:[r.jsxs(W,{container:!0,spacing:2,children:[r.jsx(W,{xs:12,children:r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Specify the ID of the entity and the types of events you would like to receive. Once you complete this step, Synapse will send a verification code to the endpoint you specify. After you verify your webhook, Synapse will send your chosen events to the verified endpoint."})}),r.jsxs(W,{xs:12,md:6,children:[r.jsx(Re,{configuration:{initialScope:qe.ALL_PROJECTS,initialContainer:"root",selectMultiple:!1,treeOnly:!1,versionSelection:Ie.DISALLOWED},show:C,onCancel:()=>{b(!1)},title:"Select item for Webhook",promptCopy:"Select an item to associate with the webhook. The webhook can be used to receive programmatic alerts when the item is updated.",onConfirm:u=>{a(u[0].targetId),b(!1)},confirmButtonCopy:"Select"}),r.jsx(X,{required:!0,label:r.jsxs(r.Fragment,{children:["Entity ID",r.jsx(Te,{containerSx:{position:"fixed",ml:"15px",fontSize:"12px"},markdownText:"The ID of a Synapse entity for which to receive events. For folders and projects, matching events are published to the webhook endpoint for any entity in their hierarchy."})]}),type:"text",fullWidth:!0,value:i,onChange:u=>{a(u.target.value)},InputProps:{endAdornment:r.jsx(Ae,{onClick:()=>b(!0),children:r.jsx(me,{})})}})]}),r.jsx(W,{xs:6,children:r.jsx(ce,{control:r.jsx(Me,{}),labelPlacement:"top",label:r.jsx(le,{children:"Enabled"}),checked:y,onChange:(u,R)=>{S(R)}})}),r.jsx(W,{xs:12,md:6,children:r.jsxs(Le,{children:[r.jsx(le,{required:!0,children:"Events"}),Object.values(po).map(u=>r.jsx(ce,{control:r.jsx(Ue,{}),label:Qe(u.toLowerCase()),checked:c.has(u),onChange:(R,m)=>{f(q=>{if(m){const x=new Set(q);return x.add(u),x}else return q.delete(u),new Set(q)})}},u))]})}),r.jsx(W,{xs:12,children:r.jsxs(H,{children:[r.jsx(X,{label:"Endpoint",fullWidth:!0,value:l,onChange:u=>k(u.target.value),required:!0,placeholder:"https://"}),o&&r.jsxs(r.Fragment,{children:[r.jsx(Ke,{onClick:()=>{g(!0)},color:"error",variant:"outlined",startIcon:r.jsx(xe,{}),sx:{my:2},children:"Delete Webhook"}),r.jsx(Z,{title:"Confirm Delete Webhook?",onCancel:()=>g(!1),open:E,content:r.jsxs(r.Fragment,{children:[r.jsx(N,{variant:"body1",children:"Are you sure you want to delete this webhook? This action cannot be undone."}),L&&r.jsx(ee,{severity:"error",sx:{mt:2},children:L.reason})]}),onConfirm:()=>{Y()},confirmButtonProps:{children:"Delete",color:"error",disabled:M},cancelButtonProps:{disabled:M}})]})]})})]}),v&&r.jsxs(ee,{severity:"error",sx:{my:2},children:[_&&r.jsxs(r.Fragment,{children:["Synapse only permits configuring webhooks on verified domains, which are specified in the"," ",r.jsx(ue,{href:"https://rest-docs.synapse.org/rest/index.html#org.sagebionetworks.repo.web.controller.WebhookController",target:"_blank",children:"REST documentation"}),". You have entered a domain that has not been verified."," ",r.jsx(ue,{href:Eo,target:"_blank",children:"Please fill out this form to request verification for your webhook domain"}),"."]}),!_&&v.reason]})]})})}try{de.displayName="CreateWebhookModal",de.__docgenInfo={description:"",displayName:"CreateWebhookModal",props:{initialData:{defaultValue:null,description:"",name:"initialData",required:!1,type:{name:"Webhook"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}function fe(e){const{open:o,onClose:t}=e,[n,s]=d.useState(""),{mutate:i,isPending:a,error:c}=go({onSuccess:f=>{f.isValid?G("Webhook verified","success"):G(`Webhook was not verified: ${f.invalidReason}`,"danger"),t()}});return r.jsx(Z,{title:"Verify Webhook",onCancel:()=>{a||t()},open:o,content:r.jsxs(r.Fragment,{children:[r.jsx(N,{variant:"body1",gutterBottom:!0,children:"Enter the code sent to your webhook to verify it. Once the webhook has been verified, Synapse will start sending the events you chose to your webhook endpoint."}),r.jsx(X,{label:"Verification code",value:n,onChange:f=>s(f.target.value),sx:{mt:1}}),c&&r.jsx(ee,{severity:"error",sx:{mt:2},children:c.reason})]}),onConfirm:()=>{i({webhookId:e.webhookId,verifyWebhookRequest:{verificationCode:n}})},confirmButtonProps:{children:"Verify",disabled:a},cancelButtonProps:{disabled:a}})}try{fe.displayName="WebhookVerificationDialog",fe.__docgenInfo={description:"",displayName:"WebhookVerificationDialog",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},webhookId:{defaultValue:null,description:"",name:"webhookId",required:!0,type:{name:"string"}}}}}catch{}export{de as C,mo as S,fe as W,nt as a,tt as u};
