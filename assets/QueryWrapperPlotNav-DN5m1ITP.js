import{r as P,j as t,V as w,c0 as S,bp as k,B as H,eC as K,eE as Y,gt as G,a0 as $,eF as z,eG as J,eH as Z,eI as X,eJ as ee,eK as te,eL as ae,ar as oe,fl as ne,bU as se}from"./iframe-SFoYirDz.js";import{a as Q,c as le,Q as re,b as ie,N as ue,e as ce}from"./QueryWrapper-Cms9zKKm.js";import{b as de,a as pe}from"./SqlFunctions-CtcOBfAw.js";import{u as me}from"./useEntity-DJx9kr6F.js";import"./DownloadConfirmationUI-COMWYaOk.js";import{T as ye,a as he,R as fe}from"./RowSetView-D0KhefAK.js";import{F as Pe,S as ve,T as xe}from"./TopLevelControls-CeoeI_1l.js";import{M as Se}from"./ModalDownload-CAZzSmaF.js";import{u as D}from"./QueryContext-fne1vZTO.js";import{i as _e}from"./TableRowSelectionState-C9ix-JZA.js";import{Q as ge,S as Ce}from"./QueryWrapperErrorBoundary--JJqnuWz.js";import"./ThemesPlot-dOxFUgG_.js";import"./UpsetPlot-IJ-BjHJT.js";import{S as Ee}from"./SynapsePlot-BpZS30mt.js";import{P as Te,u as we,g as je,F as Ne,b as Fe}from"./useFacetPlots-BPqJmZX4.js";function L(e){const o=D(),{currentQueryRequest:r}=o,{title:i,onCustomPlotClick:c,onHide:_}=e,{showPlots:d}=Q(),h=P.useMemo(()=>({...e,title:void 0,showlegend:!1,displayModebar:!1}),[e]),m=P.useMemo(()=>{const{selectedFacets:x,additionalFilters:g}=r.query;return{selectedFacets:x,additionalFilters:g,onCustomPlotClick:c,queryContext:o}},[r.query,c,o]);return t.jsx("div",{role:"figure",className:"SynapsePlot",children:d&&t.jsxs(t.Fragment,{children:[i&&t.jsx(Te,{title:i,onHide:_}),t.jsx(Ee,{synapsePlotWidgetParams:h,customPlotParams:m})]})})}try{L.displayName="QueryWrapperSynapsePlot",L.__docgenInfo={description:`This component wraps a SynapsePlot.  It passes in the current query context, and has a custom
"title" style so that it looks like it belongs in the QueryWrapperPlotNav plots.`,displayName:"QueryWrapperSynapsePlot",props:{onCustomPlotClick:{defaultValue:null,description:"",name:"onCustomPlotClick",required:!1,type:{name:"(event: QueryWrapperSynapsePlotRowClickEvent) => void"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"table"'},{value:'"image"'},{value:'"box"'},{value:'"volume"'},{value:'"bar"'},{value:'"barpolar"'},{value:'"candlestick"'},{value:'"carpet"'},{value:'"choropleth"'},{value:'"choroplethmapbox"'},{value:'"cone"'},{value:'"contour"'},{value:'"contourcarpet"'},{value:'"densitymapbox"'},{value:'"funnel"'},{value:'"funnelarea"'},{value:'"heatmap"'},{value:'"heatmapgl"'},{value:'"histogram"'},{value:'"histogram2d"'},{value:'"histogram2dcontour"'},{value:'"indicator"'},{value:'"isosurface"'},{value:'"mesh3d"'},{value:'"ohlc"'},{value:'"parcats"'},{value:'"parcoords"'},{value:'"pie"'},{value:'"pointcloud"'},{value:'"sankey"'},{value:'"scatter"'},{value:'"scatter3d"'},{value:'"scattercarpet"'},{value:'"scattergeo"'},{value:'"scattergl"'},{value:'"scattermapbox"'},{value:'"scatterpolar"'},{value:'"scatterpolargl"'},{value:'"scatterternary"'},{value:'"splom"'},{value:'"streamtube"'},{value:'"sunburst"'},{value:'"surface"'},{value:'"treemap"'},{value:'"violin"'},{value:'"waterfall"'}]}},horizontal:{defaultValue:null,description:"",name:"horizontal",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},xtitle:{defaultValue:null,description:"",name:"xtitle",required:!1,type:{name:"Plotly.LayoutAxis"}},ytitle:{defaultValue:null,description:"",name:"ytitle",required:!1,type:{name:"Plotly.LayoutAxis"}},xaxistype:{defaultValue:null,description:"",name:"xaxistype",required:!1,type:{name:"enum",value:[{value:'"log"'},{value:'"date"'},{value:'"linear"'},{value:'"-"'},{value:'"category"'},{value:'"multicategory"'}]}},showlegend:{defaultValue:null,description:"",name:"showlegend",required:!1,type:{name:"Plotly.Layout"}},barmode:{defaultValue:null,description:"",name:"barmode",required:!1,type:{name:"Plotly.Layout"}},displayModeBar:{defaultValue:null,description:"",name:"displayModeBar",required:!1,type:{name:"Plotly.Config"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function R(){return t.jsxs(w,{className:"FacetNavPanel",sx:{flexGrow:1},children:[t.jsxs(w,{className:"FacetNavPanel__title",children:[t.jsx(S,{variant:"rectangular",height:20,width:170}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(S,{variant:"rectangular",height:20,width:20}),t.jsx(S,{variant:"rectangular",height:20,width:20,sx:{ml:1}})]}),t.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",height:200,px:2,minWidth:"435px",flexGrow:1},children:[t.jsx(S,{variant:"circular",width:140,height:140}),t.jsxs(k,{sx:{gap:1},children:[t.jsx(S,{variant:"rectangular",height:15,width:220}),t.jsx(S,{variant:"rectangular",height:15,width:220}),t.jsx(S,{variant:"rectangular",height:15,width:220}),t.jsx(S,{variant:"rectangular",height:15,width:220})]})]})]})}function Ie(){return t.jsxs(w,{className:"PlotsContainer",sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:4},children:[t.jsx(R,{}),t.jsx(R,{})]})}const b=2,v=(e,o)=>"__custom"in o&&"__custom"in e?e.title==o.title:!("__custom"in o)&&!("__custom"in e)?K(e,o):!1;function be(e){return e==="bar"?"BAR":"PIE"}const Le=e=>"__custom"in e.plotId?`custom-${e.plotId.title}`:`facet-${e.plotId.columnName}-${e.plotId.jsonPath}`,Ae=(e,o)=>!!o.find(r=>v(r.plotId,e)),M=e=>({__custom:!0,title:e.title??""}),qe=(e=[],o=[],r=A)=>[...e.map((i,c)=>({plotId:M(i),isHidden:c>=b,plotType:be(i.type)})),...o.map((i,c)=>({plotId:i.facetToPlot,isHidden:c+e.length>=b,plotType:r}))],Qe=(e,o,r)=>o.some(i=>v(M(i),e.plotId))||r.some(i=>v(i.facetToPlot,e.plotId)),A="PIE",Me=[],Re=[];function q(e){const{facetsToPlot:o=Me,customPlots:r=Re,initialPlotType:i=A}=e,{data:c}=le(),{showPlots:_}=Q(),[d,h]=P.useState([]),m=we(o),x=a=>{var l;return((l=d.find(n=>v(a,n.plotId)))==null?void 0:l.plotType)??A};P.useEffect(()=>{const a=qe(r,m,i);h(s=>{const l=a.filter(u=>!Ae(u.plotId,s));return[...s.filter(u=>Qe(u,r,m)),...l]})},[r,m]);const g=a=>{h(s=>s.map((l,n)=>a?{...l,isHidden:!1}:{...l,isHidden:n>=b}))},j=a=>d.find(n=>v(a,n.plotId)&&n.isHidden===!0)!==void 0,p=P.useMemo(()=>d.find(a=>a.isHidden===!0)?"MORE":d.length<=b?"NONE":"LESS",[d]),E=a=>{C(a,"isHidden",!0)},N=(a,s)=>{C(a,"plotType",s)},C=(a,s,l)=>{h(n=>n.map(y=>v(a,y.plotId)?{...y,[s]:l}:y))},F=je(c,o).map((a,s)=>({facet:{columnName:a.columnName,jsonPath:a.jsonPath},colorIndex:s}));return t.jsx(t.Fragment,{children:d.length>0&&t.jsxs("div",{className:`PlotsContainer ${_?"":"hidden"} ${p==="LESS"?"less":""}`,children:[t.jsx("div",{className:"PlotsContainer__row",role:"list",children:d.map(a=>{var y;const s="__custom"in a.plotId,l=r.find(u=>v(M(u),a.plotId)),n=m.find(u=>v(u.facetToPlot,a.plotId));return t.jsxs("div",{style:{minWidth:"435px",display:j(a.plotId)?"none":"block"},children:[s&&l&&t.jsx(L,{...l,onHide:()=>E(a.plotId)}),!s&&n&&t.jsx(Ne,{index:(y=F.find(u=>v(u.facet,a.plotId)))==null?void 0:y.colorIndex,onHide:()=>E(a.plotId),plotType:x(a.plotId),onSetPlotType:u=>N(a.plotId,u),isModalView:!1,...n})]},Le(a))})}),p!=="NONE"&&t.jsx(w,{sx:{display:"flex",justifyContent:"center",backgroundColor:"grey.100",p:2,mt:2},children:t.jsx(H,{variant:"contained",color:"secondary",onClick:()=>g(p==="MORE"),sx:{width:"150px"},children:p==="LESS"?"Hide Charts":"View All Charts"})})]})})}function Ve(e){const{showPlots:o}=Q();return t.jsx(P.Suspense,{fallback:o?t.jsx(Ie,{}):null,children:t.jsx(q,{...e})})}try{q.displayName="PlotsContainer",q.__docgenInfo={description:"",displayName:"PlotsContainer",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}},customPlots:{defaultValue:null,description:"",name:"customPlots",required:!1,type:{name:"QueryWrapperSynapsePlotProps[]"}},initialPlotType:{defaultValue:null,description:"",name:"initialPlotType",required:!1,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'},{value:'"STACKED_HORIZONTAL_BAR"'}]}}}}}catch{}const De="isShowingFacetFilters",Oe="isHidingFacetFilters",Be="hasSelectedRows";function We(e){const{tableConfiguration:o,name:r,cardConfiguration:i,facetsToPlot:c,availableFacets:_,facetValueSortConfigs:d,initialExpandedFacetControls:h,hideDownload:m,hideQueryCount:x,hideSqlEditorControl:g,hideVisualizationsControl:j,searchConfiguration:p,cavaticaConnectAccountURL:E,customControls:N,remount:C,isFullTextSearchEnabled:F,customPlots:a,initialLimit:s,initialPlotType:l}=e,n=D(),[y,u]=P.useState(!1),{hasFacetedSelectColumn:T,queryMetadataQueryOptions:O}=n,{isLoading:B}=oe(O),W=ne(_e),f=n.currentQueryRequest,U=(f==null?void 0:f.query.selectedFacets)!==void 0&&f.query.selectedFacets.length>0||(f==null?void 0:f.query.additionalFilters)!==void 0&&(f==null?void 0:f.query.additionalFilters.length)>0;return t.jsx(ce,{children:I=>{if(I===void 0)throw new Error("No queryVisualizationContext found when using QueryVisualizationContextConsumer");return t.jsx(w,{className:`QueryWrapperPlotNav ${I.showFacetFilter?De:Oe} ${W?Be:""}`,sx:{"*":{cursor:B?"wait":void 0}},children:t.jsxs(ge,{children:[F?t.jsx(Pe,{ftsConfig:p==null?void 0:p.ftsConfig}):t.jsx(ve,{...p,queryContext:n,queryVisualizationContext:I}),t.jsx(Ce,{}),I.showDownloadConfirmation&&t.jsx(ye,{onClose:()=>I.setShowDownloadConfirmation(!1)}),t.jsx(se,{children:t.jsx(xe,{showColumnSelection:o!==void 0,name:r,hideDownload:m,hideQueryCount:x,hideFacetFilterControl:!T,hideVisualizationsControl:!T||j,hideSqlEditorControl:g,cavaticaConnectAccountURL:E,customControls:N,remount:C})}),T&&t.jsx(t.Fragment,{children:t.jsx(Fe,{availableFacets:_,facetValueSortConfigs:d,initialExpandedFacetControls:h})}),t.jsx(he,{frontText:"",endText:U?"filtered by":"",hideIfUnfiltered:!0}),t.jsx(Ve,{facetsToPlot:c,customPlots:a,initialPlotType:l}),t.jsx(fe,{tableConfiguration:o,hideDownload:m,cardConfiguration:i,initialLimit:s}),y&&t.jsx(Se,{getLastQueryRequest:n==null?void 0:n.getCurrentQueryRequest,onClose:()=>u(!1)})]})})}})}function V(e){var u;const{sql:o,tableConfiguration:r,isInfinite:i=!r,limit:c=Y,showLastUpdatedOn:_,unitDescription:d,additionalFiltersSessionStorageKey:h,helpConfiguration:m,customPlots:x,enabledExternalAnalysisPlatforms:g}=e,j=((u=e.query)==null?void 0:u.sql)??o??"",{entityId:p,versionNumber:E}=de(j),N=P.useMemo(()=>{if(e.query)return e.query;if(e.initQueryJson)return JSON.parse(e.initQueryJson);{const T=pe(e.searchParams,e.sqlOperator,h);return{sql:o,additionalFilters:T,limit:c,offset:0}}},[e.query,e.initQueryJson,e.searchParams,e.sqlOperator,h,o,c]),[C,F]=P.useState(1),a=()=>{F(C+1)},{data:s}=me(p,E),l={entityId:p??"",concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:$|z|J|Z|X|ee|te|ae,query:N},n=(s&&G(s)&&s.isSearchEnabled)??!1,y=`${JSON.stringify(l)}-${C}`;return P.createElement(re,{...e,initQueryRequest:l,key:y,isInfinite:i},t.jsx(ie,{unitDescription:d,rgbIndex:e.rgbIndex,columnAliases:e.columnAliases,helpConfiguration:m,visibleColumnCount:e.visibleColumnCount,defaultShowPlots:e.defaultShowPlots,hideCopyToClipboard:e.hideCopyToClipboard,defaultShowSearchBar:(e.defaultShowSearchBox||n)&&!e.hideSearchBarControl,hideSearchBarControl:e.hideSearchBarControl,showLastUpdatedOn:_,noContentPlaceholderType:ue.INTERACTIVE,hasCustomPlots:Array.isArray(x)&&x.length>0,enabledExternalAnalysisPlatforms:g,children:t.jsx(We,{...e,isFullTextSearchEnabled:n,remount:a})}))}try{V.displayName="QueryWrapperPlotNav",V.__docgenInfo={description:"",displayName:"QueryWrapperPlotNav",props:{}}}catch{}export{V as Q};
