import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{S as me}from"./createSvgIcon-Cg71VSX1.js";import{l as k,S as P,g as pe,B as fe}from"./useFiles-BNw6mVE-.js";import"./VerificationSubmission-BUSqAuLu.js";import"./StringUtils-CCbjCejM.js";import"./OrientationBanner-BOCf4qOE.js";import{r as d}from"./index-Dl6G-zuu.js";import{d as he,l as ye,o as ge}from"./useEntity-1Gq7_5yg.js";import{u as B}from"./useQuery-DFbKL1Tm.js";import{A as L,d as be,g as Se,a as je,b as J,c as ve,T as xe,v as Te}from"./MuiForm-BMUjR3t-.js";import{i as Ve}from"./isNil-c8QyzjdH.js";import{n as Fe}from"./noop-DX6rZLP_.js";import{a5 as z,a6 as Ae,J as we,a7 as qe,a8 as _e,a9 as Ce,aa as Ee,K as Ie,y as Oe,C as Ne,ab as De,ac as Re,ad as ke}from"./ConfirmationDialog-B1NhntOf.js";import{S as Pe}from"./LoadingScreen-DXya-_sQ.js";import"./styled-_IoEwjFQ.js";import{u as Be}from"./use-deep-compare-effect.esm-tD_iBzTd.js";import{d as Le}from"./ToastMessage-CBhzPong.js";import{T as He}from"./Tooltip-CbFhYBpv.js";import{B as $e}from"./Button-BkKUhIiJ.js";import{G as M}from"./Grid-CED6uvP0.js";import{T as Ge}from"./TextField-B3rZxamg.js";import{T as Ke}from"./TextWidget-Dck50eu7.js";import{A as O}from"./Alert-u0n1NA7e.js";import{L as Je}from"./Link-D-YR7sBc.js";import{B as W}from"./Box-Tu95KWeq.js";import{T as U}from"./Typography-DUswyeAh.js";import{D as Me}from"./Divider-DZif6ozR.js";function We(t,n){const{accessToken:a,keyFactory:r}=k();return B({...n,queryKey:r.getEntityBoundJsonSchemaQueryKey(t),queryFn:()=>P.getSchemaBinding(t,a)})}function vt(t,n){const{accessToken:a,keyFactory:r}=k();return B({...n,queryKey:r.getEntitySchemaValidationResultsQueryKey(t),queryFn:()=>P.getSchemaValidationResults(t,a)})}function Q(t,n){const{keyFactory:a}=k();return B({...n,queryKey:a.getValidationSchemaQueryKey(t),queryFn:async()=>(await P.getValidationSchema(t)).validationSchema})}const C=t=>e.jsx(me,{...t,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M14 10H2V12H14V10ZM14 6H2V8H14V6ZM18 14V10H16V14H12V16H16V20H18V16H22V14H18ZM2 16H10V14H2V16Z"})});try{C.displayName="AddToList",C.__docgenInfo={description:"",displayName:"AddToList",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: SVGSVGElement | null) => void) | RefObject<SVGSVGElement> | null"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function N(t){const{schema:n,formData:a,onChange:r}=t,{fields:{ObjectField:h}}=Se();return d.useEffect(()=>{const u={...a},m=z(n);m&&(Object.entries(m).forEach(([y,l])=>{const p=u[y];l[L]?Array.isArray(p)||(u[y]=Ae(p)):typeof l=="object"&&"type"in l&&l.type!=="array"&&Array.isArray(p)&&(u[y]=p.map(s=>`${s}`).join(", "))}),be(a,u)||r(u))},[n,a,r]),e.jsx(h,{...t})}try{N.displayName="SynapseAnnotationsRJSFObjectField",N.__docgenInfo={description:"Extends the",displayName:"SynapseAnnotationsRJSFObjectField",props:{}}}catch{}function D(t){const{description:n,disabled:a,formData:r,idSchema:h,onAddClick:u,properties:m,readonly:y,registry:l,required:p,schema:s,title:j,uiSchema:g}=t,f=je(g),x=J("TitleFieldTemplate",l,f),T=J("DescriptionFieldTemplate",l,f),F=d.useRef(new Set);return Be(()=>{if("properties"in s&&s.properties){const V=Object.keys(s.properties),A=new Set(V.filter(b=>!s.properties[b][L]));if(F.current!=null){const b=Array.from(F.current).filter(i=>!A.has(i)&&!!r&&r[i]!=null&&Array.isArray(r[i])&&r[i].filter(o=>o!=null).length>0);b.length>0&&Le(`The following annotations are no longer specified by the schema and have been converted to custom fields: ${b.join(", ")}.`,"warning",{title:"Fields No Longer Specified By Schema"})}F.current=A}},[s.properties]),e.jsxs("fieldset",{id:h.$id,children:[(f.title||j)&&e.jsx(x,{id:`${h.$id}__title`,schema:s,title:f.title||j,required:p,uiSchema:g,registry:l}),(f.description||n)&&e.jsx(T,{id:`${h.$id}__description`,description:f.description||n,registry:l,schema:s}),m.map(V=>V.content),ve(s,g,r)&&e.jsx(He,{title:"Add a new custom field",placement:"top",children:e.jsx($e,{sx:{my:2},variant:"contained",className:"object-property-expand",onClick:u(s),disabled:a||y,"aria-label":"Add Custom Field",children:e.jsx(C,{})})})]})}try{D.displayName="ObjectFieldTemplate",D.__docgenInfo={description:`Derived from the base ObjectFieldTemplate with annotations-editor-specific changes
- Custom button for adding additional properties
- Tracks properties to show a toast message if a property is converted to an additionalProperty because it was
  dropped from the schema (e.g. in a conditional schema)

See https://github.com/rjsf-team/react-jsonschema-form/blob/main/packages/mui/src/ObjectFieldTemplate/ObjectFieldTemplate.tsx`,displayName:"ObjectFieldTemplate",props:{title:{defaultValue:null,description:"A string value containing the title for the object",name:"title",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"A string value containing the description for the object",name:"description",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"A boolean value stating if the object is disabled",name:"disabled",required:!1,type:{name:"boolean"}},properties:{defaultValue:null,description:"An array of objects representing the properties in the object",name:"properties",required:!0,type:{name:"ObjectFieldTemplatePropertyType[]"}},onAddClick:{defaultValue:null,description:"Returns a function that adds a new property to the object (to be used with additionalProperties)",name:"onAddClick",required:!0,type:{name:"(schema: S) => () => void"}},readonly:{defaultValue:null,description:"A boolean value stating if the object is read-only",name:"readonly",required:!1,type:{name:"boolean"}},required:{defaultValue:null,description:"A boolean value stating if the object is required",name:"required",required:!1,type:{name:"boolean"}},hideError:{defaultValue:null,description:"A boolean value stating if the field is hiding its errors",name:"hideError",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"The schema object for this object",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this object field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},idSchema:{defaultValue:null,description:"An object containing the id for this object & ids for its properties",name:"idSchema",required:!0,type:{name:"FieldId | (FieldId & { [x: string]: FieldId | (FieldId & { [x: string]: FieldId | (FieldId & ...) | undefined; }) | undefined; })"}},errorSchema:{defaultValue:null,description:"The optional validation errors in the form of an `ErrorSchema`",name:"errorSchema",required:!1,type:{name:"ErrorSchema<T>"}},formData:{defaultValue:null,description:"The form data for the object",name:"formData",required:!1,type:{name:"Record<string, any> | null"}},formContext:{defaultValue:null,description:"The `formContext` object that was passed to Form",name:"formContext",required:!1,type:{name:"GenericObjectType"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}function R(t){const{id:n,classNames:a,disabled:r,label:h,onKeyChange:u,readonly:m,required:y,schema:l,children:p,registry:s}=t,{translateString:j}=s,g=j(xe.KeyLabel,[""]);if(!(L in l))return e.jsx("div",{className:a,children:p});const x=({target:T})=>{T&&u(T.value)};return e.jsx("div",{className:a,children:e.jsxs(M,{container:!0,my:1,columnSpacing:2,rowSpacing:0,children:[e.jsx(M,{item:!0,xs:3,children:e.jsx(Ge,{fullWidth:!0,required:y,label:g,defaultValue:h,disabled:r||m,id:`${n}-key`,name:`${n}-key`,onBlur:m?void 0:x,type:"text"})}),p]})})}try{R.displayName="SynapseAnnotationsWrapIfAdditionalTemplate",R.__docgenInfo={description:"The `WrapIfAdditional` component is used by the `FieldTemplate` to rename, or remove properties that are\npart of an `additionalProperties` part of a schema.",displayName:"SynapseAnnotationsWrapIfAdditionalTemplate",props:{children:{defaultValue:null,description:"The field or widget component instance for this field row",name:"children",required:!0,type:{name:"ReactNode"}},label:{defaultValue:null,description:"The computed label for this field, as a string",name:"label",required:!0,type:{name:"string"}},style:{defaultValue:null,description:"An object containing the style as defined in the `uiSchema`",name:"style",required:!1,type:{name:"StyleHTMLAttributes<any>"}},disabled:{defaultValue:null,description:"A boolean value stating if the field is disabled",name:"disabled",required:!0,type:{name:"boolean"}},id:{defaultValue:null,description:"The id of the field in the hierarchy. You can use it to render a label targeting the wrapped widget",name:"id",required:!0,type:{name:"string"}},required:{defaultValue:null,description:"A boolean value stating if the field is required",name:"required",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"The schema object for this field",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},readonly:{defaultValue:null,description:"A boolean value stating if the field is read-only",name:"readonly",required:!0,type:{name:"boolean"}},classNames:{defaultValue:null,description:"A string containing the base CSS classes, merged with any custom ones defined in your uiSchema",name:"classNames",required:!1,type:{name:"string"}},onKeyChange:{defaultValue:null,description:"The key change event handler; Called when the key associated with a field is changed for an additionalProperty",name:"onKeyChange",required:!0,type:{name:"(value: string) => () => void"}},onDropPropertyClick:{defaultValue:null,description:"The property drop/removal event handler; Called when a field is removed in an additionalProperty context",name:"onDropPropertyClick",required:!0,type:{name:"(value: string) => () => void"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}function Z(t,n){let a=Re(t);return n&&(a=ke(a)),a}function Y(t){const{entityId:n,schemaId:a,validationSchema:r,liveValidate:h,onSuccess:u=()=>{},onCancel:m,formRef:y,onChange:l=Fe,hideActions:p=!1}=t,s=d.useRef(null),j=y??s,[g,f]=d.useState(void 0),[x,T]=d.useState(void 0),[F,V]=d.useState(!1),[A,b]=d.useState(!1),{data:i}=he(n,void 0,!1,{staleTime:1/0,enabled:!!n,throwOnError:!0}),o=i==null?void 0:i.entityMetadata,X=i==null?void 0:i.annotations,[w,q]=d.useState(void 0),ee=d.useCallback(we(o==null?void 0:o.concreteType),[o==null?void 0:o.concreteType]);d.useEffect(()=>{i!=null&&i.entity&&q(i==null?void 0:i.entity)},[i==null?void 0:i.entity]);const{data:S,isLoading:te}=We(n,{enabled:!!n,refetchOnWindowFocus:!1,throwOnError:!0}),{data:ne,isLoading:ae}=Q(a??(S==null?void 0:S.jsonSchemaVersionInfo.$id)??"",{enabled:!!a||!!S,throwOnError:!0}),E=r||ne,H=qe((o==null?void 0:o.concreteType)??""),{data:$,isLoading:ie}=Q(H??"",{enabled:!!H,throwOnError:!0}),_=d.useMemo(()=>z($??{}),[$]),re=d.useMemo(()=>_e(E,_),[_,E]),oe=d.useMemo(()=>Ce(_),[_]),se=te||ae||ie,{mutate:le,isPending:de}=ye({onSuccess:()=>{u()},onError:c=>{T(c),V(!0)}});function G(){le({...Z(w,!0),...o})}const K=h??Ee(X,E),ce=o&&Ve(ge(w,(c,v)=>Object.keys(o).find(I=>I===v))),ue=S===null&&ce;return e.jsx("div",{className:"JsonSchemaFormContainer",children:se?e.jsx("div",{className:"LoadingPlaceholder",children:e.jsx(Pe,{size:30})}):e.jsxs(e.Fragment,{children:[o&&S&&e.jsxs(O,{severity:"info",sx:{mb:2},children:[e.jsx("b",{children:o.name})," requires scientific annotations specified by ",e.jsx("b",{children:S.jsonSchemaVersionInfo.$id}),". ",e.jsx("b",{children:e.jsx(Je,{href:`${pe(fe.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${S.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:"View required schema (JSON)"})})]}),ue&&e.jsx(O,{severity:"info",children:e.jsxs(W,{display:"flex",alignItems:"center",gap:.5,children:[e.jsxs(U,{variant:"smallText1",children:[e.jsx("b",{children:o.name})," has no annotations. Click the"," "]}),e.jsx(C,{}),e.jsx(U,{variant:"smallText1",children:"button to annotate."})]})}),e.jsxs(Ie,{validator:Te,liveValidate:K,noHtml5Validate:!0,formRef:j,disabled:de,formContext:{showDerivedAnnotationPlaceholder:!0,descriptionVariant:"expand",descriptionFormat:"table",allowFreeSoloEnum:!0},experimental_defaultFormStateBehavior:{emptyObjectFields:"skipDefaults"},fields:{ObjectField:N},templates:{ObjectFieldTemplate:D,WrapIfAdditionalTemplate:R},widgets:{TextWidget:Ke},schema:re,uiSchema:oe,transformErrors:ee,formData:w,onChange:({formData:c})=>{l(c),q(c),f(void 0)},onBlur:()=>{q(Z(w,!1))},onSubmit:({formData:c,errors:v},I)=>{I.preventDefault(),v&&v.length>0&&f(v),V(!1),q(c),G()},onError:c=>{f(c),(g||K)&&n&&b(!0)},children:[x&&F&&e.jsxs(O,{severity:"error",sx:{my:2},children:["Annotations could not be updated: ",x.reason]}),!p&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{sx:{my:2}}),e.jsx(W,{display:"flex",justifyContent:"space-between",sx:{gridRowStart:5},children:e.jsx(Oe,{hasCancelButton:m!==void 0,onCancel:()=>{m&&m()},onConfirm:()=>{j.current.formElement.current.requestSubmit()},confirmButtonProps:{children:n?"Save":"Validate"}})})]})]}),A&&e.jsx(Ne,{open:!0,onConfirm:()=>{G(),b(!1)},onCancel:()=>{b(!1)},title:"Update Annotations",content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"The following errors exist with the annotations you entered:"}),e.jsx("div",{children:e.jsx("ul",{children:(g??[]).map((c,v)=>e.jsxs("li",{children:[e.jsx("b",{children:`${De(c)}: `})," ",`${c.message}`]},v))})}),e.jsx("div",{children:"Are you sure you want to save the invalid annotations?"})]}),confirmButtonProps:{children:"Save"}})]})})}try{Y.displayName="SchemaDrivenAnnotationEditor",Y.__docgenInfo={description:`Renders a form for editing an entity's annotations. The component also supports supplying just a schema ID,
but work to support annotation flows without an entity (i.e. before creating entities) is not yet complete.`,displayName:"SchemaDrivenAnnotationEditor",props:{entityId:{defaultValue:null,description:"The entity whose annotations should be edited with the form",name:"entityId",required:!1,type:{name:"string"}},schemaId:{defaultValue:null,description:"If no entity ID is supplied, the schema to use for the form",name:"schemaId",required:!1,type:{name:"string"}},validationSchema:{defaultValue:null,description:"May be used to directly provide a JSON Schema to use for the form",name:"validationSchema",required:!1,type:{name:"JSONSchema7"}},formRef:{defaultValue:null,description:"Optionally supply a ref to the form to handle submission externally with `formRef.current.submit()`.",name:"formRef",required:!1,type:{name:"RefObject<Form<any, RJSFSchema, any>>"}},liveValidate:{defaultValue:null,description:"Provide live input validation. This can cause performance degradation. By default, liveValidate will be true if an entity with a schema and existing annotations is being edited",name:"liveValidate",required:!1,type:{name:"boolean"}},onSuccess:{defaultValue:null,description:"Invoked after a successful form submission",name:"onSuccess",required:!1,type:{name:"(() => void)"}},onCancel:{defaultValue:null,description:"If defined and formRef is not supplied, shows a 'Cancel' button and runs this effect on click",name:"onCancel",required:!1,type:{name:"(() => void)"}},onChange:{defaultValue:null,description:"Passes new form data upon each change to the form",name:"onChange",required:!1,type:{name:"((annotations: Record<string, unknown>) => void)"}},hideActions:{defaultValue:null,description:"If true, the editor will not render its own submit UI.",name:"hideActions",required:!1,type:{name:"boolean"}}}}}catch{}export{C as A,Y as S,vt as a,We as u};
