import{j as t}from"./jsx-runtime-Du8NFWEI.js";import{r as C}from"./index-Dl6G-zuu.js";import{C as F}from"./ChallengeRegisterButton-CrcBe-by.js";import{C as N}from"./ChallengeTeamWizard-3q61-I-J.js";import{j as w,B as E,M as V}from"./SynapseClient-rEyxSOTC.js";import"./OrientationBanner-D9iiRUAg.js";import"./EntityTypeUtils-BpOAC-k-.js";import"./getEndpoint-CjoHA800.js";import{u as M}from"./useGetEntityChallenge-BwX2Latr.js";import{u as z}from"./useGetUserTeams-DP29KinZ.js";import{a as W,b as O,c as H}from"./useTeamMembers-CJ0wEAcN.js";import{A as U,C as J}from"./HelpPopover-XEzjyTvX.js";import{R as Q}from"./index-CIIvWsNs.js";import{g as Y,h as K}from"./useAccessRequirements-B8kfQNqW.js";import{u as X}from"./useEntity-euh1uoy8.js";import{S as Z}from"./LoadingScreen-CINnrS9w.js";import{A as $}from"./Alert-Aa0bm5Nm.js";import{T as ee}from"./Typography-DgBbIcOX.js";import{B as v}from"./Button-CLkrjdQe.js";import{d as _}from"./ToastMessage-DLv4YVhE.js";function q(o){const{open:y,projectId:l,onRegisterComplete:g,onCancel:c}=o,{data:m,error:d}=X(l),{accessToken:T}=w(),{data:e,error:h}=M(l),b=!!T,{data:u,error:I}=E({enabled:b}),r=e==null?void 0:e.participantTeamId,n=u==null?void 0:u.ownerId,{data:s,error:j}=W(r,n,{enabled:!!(r&&n)}),{mutateAsync:f,isPending:p,error:R}=O(),{data:i,isSuccess:B,error:k}=Y(e==null?void 0:e.participantTeamId,{enabled:!!(e!=null&&e.participantTeamId)}),L=K((i==null?void 0:i.map(a=>String(a.id)))??[]),D=B&&L.every(a=>a.status==="success"&&a.data.isApproved),G=C.useCallback(async()=>{r&&n&&!(s!=null&&s.isMember)&&await f({teamId:r,userId:n}),g()},[f,g,r,s==null?void 0:s.isMember,n]),x=[d,h,I,j,k,R].filter(a=>!!a);let S=s!=null&&s.isMember?"Continue":"Register";return p&&(S="Registering..."),V(x)?!r||!y?t.jsx(t.Fragment,{}):t.jsx(U,{dialogTitle:"Challenge Terms and Conditions",subjectId:r,subjectType:Q.TEAM,teamId:e==null?void 0:e.participantTeamId,renderAsModal:!0,requestObjectName:m==null?void 0:m.name,onHide:()=>{c()},customDialogActions:t.jsxs(t.Fragment,{children:[t.jsx(v,{variant:"outlined",onClick:c,children:"Cancel"}),t.jsx(v,{variant:"contained",onClick:()=>{G()},startIcon:p?t.jsx(Z,{}):void 0,disabled:!D||p,children:S})]})}):t.jsx($,{severity:"error",children:x.map((a,P)=>t.jsx(ee,{variant:"body1",children:a.reason},P))})}try{q.displayName="ChallengeRequirementsModal",q.__docgenInfo={description:`The challenge requirements modal will
 1. Display the access requirements that must be accepted to join a participant team. The component will guide the user through meeting the requirements.
 2. If the user has accepted the requirements, the user can click 'Register' to join the team
    If the user has not accepted the requirements, the user cannot register for the challenge.`,displayName:"ChallengeRequirementsModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},onRegisterComplete:{defaultValue:null,description:"",name:"onRegisterComplete",required:!0,type:{name:"() => void"}}}}}catch{}function A({projectId:o}){const{accessToken:y}=w(),l=!!y,[g,c]=C.useState(!1),[m,d]=C.useState(!1),[T,e]=C.useState(!1),{data:h}=E(),b=i=>{c(i)},u=()=>{d(!0)},I=()=>{e(!0)},{data:r}=M(o),{data:n}=z(r==null?void 0:r.id,1,0,{enabled:!!(l&&r)}),s=n&&n.results.length>0,{mutate:j}=H({onSuccess:()=>{_("You are no longer registered for this challenge","info")},onError:i=>{_(i.reason,"danger")}}),f=()=>{l&&r&&h&&j({teamId:r.participantTeamId,userId:h.ownerId})},p=()=>{d(!1)},R=()=>{d(!1),c(!s)};return t.jsxs(t.Fragment,{children:[t.jsx(F,{projectId:o,onJoinClick:u,onLeaveClick:I}),t.jsx(q,{open:m,projectId:o,onRegisterComplete:R,onCancel:p}),t.jsx(N,{projectId:o,onClose:()=>{b(!1)},isShowingModal:g}),t.jsx(J,{open:T,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>e(!1),onConfirm:()=>{f(),e(!1)}})]})}try{A.displayName="ChallengeDetailPage",A.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}export{A as C};
