import{c$ as Q,bB as A,j as r,c9 as z,e_ as w,an as G,r as _,hL as k,dW as X,b$ as W,fM as H,a1 as J}from"./iframe-DtZANp-B.js";import{u as K}from"./unCamelCase-ZiU_emRy.js";import{u as Y}from"./uniq-CA_-bD3V.js";import{P as O}from"./Plot-BTewdGAw.js";import{c as Z}from"./_createAggregator-DfjFoJ8N.js";import{b as ee}from"./_baseOrderBy-COsRBMWK.js";import{h as te}from"./head-aneRfQQJ.js";var ae=Object.prototype,oe=ae.hasOwnProperty,le=Z(function(a,t,e){oe.call(a,e)?++a[e]:Q(a,e,1)});function M(a,t,e,o){return a==null?[]:(A(t)||(t=t==null?[]:[t]),e=e,A(e)||(e=e==null?[]:[e]),ee(a,t,e))}function re(a,t,e){t&&(a=a.filter(n=>n.y===t));const o=Y(a.map(n=>n.group)).sort(),l=[],s=["(28,118,175,1)","rgba(91,176,181,1)"];return o.forEach((n,d)=>{const p=a.filter(i=>i.group===n);l.push({x:p.map(i=>i.x),y:p.map(i=>i.y),name:n,orientation:"h",marker:{color:e?e[n]:s[d],width:1},text:[n],hovertemplate:"%{x} %{text}<extra></extra>",textposition:"none",type:"bar"})}),l}function se(a,{isTop:t,maxValue:e,backgroundColor:o}){const l=w(a);return l.xaxis={visible:!1,range:[0,e]},o&&(l.plot_bgcolor=o,l.paper_bgcolor=o),t||(l.hoverlabel={font:{size:10}}),l.showlegend=!1,l.height=t?40:20,l}const ne={backgroundColor:"transparent"},ie={width:"100%",height:"100%"};function C({plotData:a,optionsConfig:t,isTop:e,layoutConfig:o,label:l,xMax:s,colors:n,plotStyle:d=ne,style:p=ie,onClick:i}){return r.jsx(O,{style:p,layout:se(o,{isTop:e,maxValue:s,backgroundColor:d.backgroundColor}),config:t,data:re(a,l,n),onClick:c=>i?i(c):z})}try{C.displayName="BarPlot",C.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(event: Plotly.PlotMouseEvent) => void"}}}}}catch{}function ue(a,t){const e=w(a);if(!t)return e;t.backgroundColor&&(e.plot_bgcolor=t.backgroundColor),e.yaxis.showgrid=!1,e.yaxis.zeroline=!0,e.yaxis.zerolinecolor="#aeb5bc",e.yaxis.showticklabels=!1,e.xaxis.type==="log"?(e.xaxis.tickformat="f",e.xaxis.range=[-.1,Math.log10(t.maxValue)+.1]):e.xaxis.range=[t.maxValue/50*-1,t.maxValue+30],e.xaxis.visible=t.isXAxis,e.showlegend=t.isLegend,e.margin={t:0,b:t.isXAxis?50:0,l:0,r:0,pad:15};let o=40;return t.isLegend&&(o=35,e.margin.pad=0,e.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},e.yaxis={visible:!1,showline:!1}),t.isXAxis&&(e.yaxis={visible:!1,showgrid:!1,showline:!1},o=50),e.height=o,e}function de(a,t){const e=new Array(a.length);return t.forEach(o=>{const l=a.indexOf(o.y);l!==-1&&(e[l]=o.x)}),e}function V(a){const t=[],e=(a-1)/2;for(let o=0;o<a;o++)t.push(o-e);return t}function j(a){const t=le(a,l=>l[0]),e={},o={};return Object.keys(a).forEach(l=>{const s=a[l][0];if(t[s]===1)e[l]=[0];else{o[s]==null&&(o[s]=0);const d=V(t[s])[o[s]];e[l]=[d],o[s]=o[s]+1}}),e}function ce(a,t,e,o){const l=e===void 0,s=Y(a.map(c=>c.group)),n=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"],d=s.reduce((c,m)=>{const g=l?[-100]:de(e,a.filter(h=>h.group===m));return{...c,[m]:g}},{}),p=j(d);return s.map((c,m)=>{const g=d[c],h=p[c];return{type:"scatter",x:g,y:h,text:[c],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:c,marker:{color:t.markerFill,line:{color:t.markerLine,width:1},symbol:o?o[c]:n[m],size:t.markerSize}}})}const pe={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},fe={width:"100%",height:"100%"};function b({plotData:a,optionsConfig:t,layoutConfig:e,label:o,id:l,xMax:s,style:n=fe,markerSymbols:d,plotStyle:p=pe,onClick:i,isLegend:c=!1,isXAxis:m=!1}){const g=o?[o]:void 0;return r.jsx(O,{layout:ue(e,{isLegend:c,isXAxis:m,maxValue:s,backgroundColor:p.backgroundColor}),style:n,data:ce(a,p,g,d),config:t,onClick:h=>i?i(h):z},`dotPlot_${l}`)}try{V.displayName="generateCenteredSequence",V.__docgenInfo={description:`Generates a sequence of n numbers centered around 0

Examples:
if n is 4, the result would be [-1.5, -0.5, 0.5, 1.5]
if n is 5 the result would be [-2, -1, 0, 1, 2]`,displayName:"generateCenteredSequence",props:{}}}catch{}try{j.displayName="getYDataForDotPlotOffset",j.__docgenInfo={description:`Returns a set of y values where
 - if an x value is unique, the y value is 0
 - if an x value is repeated, the y value is an offset from 0

This has the effect of preventing overlapping points in a dot plot`,displayName:"getYDataForDotPlotOffset",props:{}}}catch{}try{b.displayName="DotPlot",b.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Plotly.Layout"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Plotly.Config"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:`{
  width: '100%',
  height: '100%',
}`},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
  markerFill: '#515359',
  markerLine: '#515359',
  markerSize: 9,
  backgroundColor: 'transparent',
}`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: Plotly.PlotMouseEvent) => void"}}}}}catch{}const P={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},D={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd",type:"log"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},$={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function L(a,{xField:t,yField:e,groupField:o,entityId:l,whereClause:s,infoField:n}){const d=`SELECT ${t} as "x", ${e} as "y", ${n?n+' as "info", ':""} ${o} as "group"
                 FROM ${l} ${s?" WHERE "+s:""}`;return H({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:J,entityId:l,query:{sql:d}},a).then(i=>i.queryResult.queryResults)}function q(a,t){const e=a.reduce((l,s)=>(l[s[t]]=(s[t]in l?Number(l[s[t]]):0)+Number(s.x),l),{}),o=[];for(const l in e)o.push({[t]:l,count:e[l]});return o}const S=(a,t)=>{const e=a.points[0].data;let o=e.y[0],l=e.name;return t&&([o,l]=[l,o]),{facetValue:o,type:l,event:a.event}},me=(a,t)=>r.jsx("div",{className:"ThemesPlot__barPlotLegend",children:t.map((e,o)=>r.jsxs("div",{style:{float:"left"},children:[r.jsx("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${a?a[e]:"transparent"}`}},"topBar_label"),r.jsx("div",{className:"ThemesPlot__barPlotLegend__graph",children:e},"topBar_graph")," "]},`topBar_${o}`))}),F=(a,t)=>{for(const e in a)a[e]=a[e].replace(",1)",`, ${t})`).replace(",1.0)",`, ${t})`);return a},ye=(a,t)=>te(a.filter(e=>e.y===t).map(e=>e.info));function R({dotPlot:a,topBarPlot:t,sideBarPlot:e,onPointClick:o,onIndividualThemeBarPlotPointClick:l,dotPlotYAxisLabel:s="Research Themes"}){const{accessToken:n}=G(),[d,p]=_.useState(!1),[i,c]=_.useState([]),[m,g]=_.useState([]),[h,U]=_.useState([]);_.useEffect(()=>{const u=L(n,a),f=L(n,t),x=L(n,e);return Promise.all([u,f,x]).then(y=>{c(k(y[0].headers,y[0].rows)),g(k(y[1].headers,y[1].rows)),U(k(y[2].headers,y[2].rows)),p(!0)}).catch(y=>{throw y}),()=>{}},[n,a,t,e]);let N=[],B=[],T=0,E=[],v=[];return d&&(v=q(h,"y"),N=v.sort((u,f)=>f.count-u.count).map(u=>u.y),T=Math.max(...i.map(u=>Number(u.x))),E=M(q(m,"y"),["y"]),B=M(q(m,"group"),["group"]).map(u=>u.group)),r.jsxs(r.Fragment,{children:[!d&&X,d&&r.jsxs("div",{className:"ThemesPlot",children:[r.jsx("div",{className:"ThemesPlot__dotPlotLegend",children:r.jsx(b,{id:"head",plotData:i,isLegend:!0,markerSymbols:a.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:D,optionsConfig:{...P,responsive:!0,staticPlot:!0},plotStyle:{...a.plotStyle,backgroundColor:"transparent"}})}),t.colors&&me(t.colors,B),E.map((u,f)=>r.jsxs("div",{className:"ThemesPlot__topBarPlot",children:[r.jsxs("div",{className:"ThemesPlot__topBarPlot__label",children:[u.count,"Â ",K(u.y)]}),r.jsx("div",{className:"ThemesPlot__topBarPlot__plot",children:r.jsx(C,{style:{width:"100%",height:"100%"},layoutConfig:w($),optionsConfig:{...P},plotData:m,isTop:!0,label:u.y,xMax:u.count,onClick:x=>o(S(x,!0)),colors:f%2===0?t.colors:F({...t.colors},"1")})})]},`topBarDiv_${f}`)),r.jsxs("div",{style:{display:"flex",position:"relative"},children:[r.jsx("div",{className:"ThemesPlot__dotPlotYLabel",children:s}),r.jsxs("div",{className:"ThemesPlot__dotPlot",children:[N.map((u,f)=>r.jsxs("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:a.plotStyle?.backgroundColor},children:[r.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",children:r.jsx(W,{title:`${ye(i,u)} `,placement:"right",children:r.jsxs("div",{children:[r.jsx("span",{className:"ThemesPlot__dotPlot__themeLabel",children:u}),r.jsx("br",{}),r.jsxs("span",{className:"ThemesPlot__dotPlot__countLabel",children:[v[f].count," ",e.countLabel]}),r.jsx("br",{}),r.jsx(C,{style:{width:"100%"},layoutConfig:$,optionsConfig:P,plotData:h,isTop:!1,xMax:v[f].count,label:u,colors:F({...t.colors},"1"),onClick:x=>{l&&l(S(x,!1))}})]})})}),r.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:r.jsx("div",{style:{width:"100%",backgroundColor:a.plotStyle?.backgroundColor},children:r.jsx(b,{id:`${f}`,onClick:x=>{const{type:y,event:I}=S(x,!1);o({facetValue:u,type:y,event:I})},plotData:i,plotStyle:a.plotStyle,markerSymbols:a.markerSymbols,xMax:T,label:u,layoutConfig:D,optionsConfig:{...P,responsive:!1}})})})]},`plotDiv_${+f}`)),r.jsxs("div",{className:"ThemesPlot__dotPlot__row",children:[r.jsx("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),r.jsx("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:r.jsx(b,{id:"footer",plotData:i,isXAxis:!0,xMax:T,layoutConfig:D,optionsConfig:{...P,responsive:!1}})})]})]})]}),r.jsx("div",{})]})]})}try{R.displayName="ThemesPlot",R.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},onIndividualThemeBarPlotPointClick:{defaultValue:null,description:"",name:"onIndividualThemeBarPlotPointClick",required:!1,type:{name:"({ facetValue, type, event, }: ClickCallbackParams) => void"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}export{R as T};
