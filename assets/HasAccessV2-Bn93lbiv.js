import{j as t}from"./jsx-runtime-DNP5ZHPF.js";import{l as f,S as I,g as q,B as _}from"./useFiles-DxEFRl-N.js";import{R as x,d as k}from"./VerificationSubmission-B0kBNeMy.js";import{k as F,r as C}from"./StringUtils-CzgJJW-6.js";import{S as H}from"./SynapseConstants-x7wBmLwm.js";import{r as m}from"./index-C9LqO53Z.js";import"./OrientationBanner-lGnlzz1n.js";import{u as j}from"./useQuery-Drm9MnN6.js";import{u as v}from"./utils-Dge9E0v5.js";import{c as S}from"./chunk-C4WEiA25.js";import{u as O}from"./useEntityBundle-DvRMGHeP.js";import{c as U,A as L}from"./AccessRequirementList-D8mM9Z5i.js";import{I as D}from"./IconSvg-DVy36fcc.js";import{B as g}from"./Button-C1D6jijN.js";import{B as V}from"./Box-DhP9mjg7.js";import{u as G}from"./useTheme-DaIKVKIj.js";const P=50;function B(e,n){const{accessToken:s,keyFactory:o}=f();return j({...n,queryKey:o.getRestrictionInformationQueryKey(e),queryFn:()=>I.getRestrictionInformation(e,s)})}function Y(e){return e.reduce((n,s)=>({restrictionInformation:n.restrictionInformation.concat(s.restrictionInformation)}),{restrictionInformation:[]})}function le(e,n){const{accessToken:s,keyFactory:o}=f(),r=v(),i=async()=>{const y=S(e.objectIds,P).map(c=>{const p={...e,objectIds:c};return I.getRestrictionInformationBatch(p,s)}),a=await Promise.all(y),d=Y(a);return d.restrictionInformation.forEach(c=>{r.setQueryData(o.getRestrictionInformationQueryKey({objectId:String(c.objectId),restrictableObjectType:e.restrictableObjectType}),c)}),d};return j({...n,queryKey:o.getRestrictionInformationBatchQueryKey(e),queryFn:i})}const E={p:"0px",minWidth:"unset"},Q={AccessBlockedToAnonymous:{icon:"accessClosed",color:e=>e.palette.warning.main,tooltipText:"You must sign in to access this item."},AccessBlockedByRestriction:{icon:"accessClosed",color:e=>e.palette.warning.main,tooltipText:"You must request access to this restricted item."},AccessBlockedByACL:{icon:"accessClosed",color:e=>e.palette.warning.main,tooltipText:"You do not have download access for this item."},AccessibleWithTerms:{icon:"accessOpen",color:e=>e.palette.success.main,tooltipText:"View Terms"},Accessible:{icon:"accessOpen",color:e=>e.palette.success.main,tooltipText:""},AccessibleExternalFileHandle:{icon:"linkOff",color:e=>e.palette.grey[700],tooltipText:"Access may be controlled by an external system."}};function b(e){const{restrictionUiType:n}=e,s=G();if(n){const o=Q[n];return t.jsx(D,{icon:o.icon,label:o.tooltipText,sx:{color:o.color(s),height:"16px",verticalAlign:"text-top"}})}return t.jsx(t.Fragment,{})}function A(e,n){const{accessToken:s}=f(),o=!!s,{data:r}=B({restrictableObjectType:x.ENTITY,objectId:e}),{data:i,isLoading:l}=M(e,{enabled:n.enabled});if(r&&!l)return i?"AccessibleExternalFileHandle":r.hasUnmetAccessRequirement?"AccessBlockedByRestriction":r.userEntityPermissions.canDownload?r.restrictionLevel!==k.OPEN?"AccessibleWithTerms":"Accessible":o?"AccessBlockedByACL":"AccessBlockedToAnonymous"}function M(e,n){return O(e,void 0,void 0,{...n,select:s=>{if(!F(s.entity))return!1;const o=s.entity,r=s.fileHandles,i=r==null?void 0:r.find(l=>l.id===o.dataFileHandleId);return i&&C(i)}})}function w(e){const[n,s]=m.useState(!1),[o,r]=m.useState([]),{entityId:i,showButtonText:l=!0,showExternalAccessIcon:y=!1}=e,a=A(i,{enabled:y}),{accessToken:d}=f(),{data:c}=B({restrictableObjectType:x.ENTITY,objectId:i}),p=m.useCallback(()=>{I.getAllAccessRequirements(d,i).then(u=>{U(u)?window.open(`${q(_.PORTAL_ENDPOINT)}AccessRequirements:ID=${i}&TYPE=ENTITY`,"_blank"):(r(u),s(!0))})},[d,i]),R=m.useMemo(()=>a==="AccessBlockedToAnonymous"?t.jsx(g,{sx:E,className:H,onClick:u=>{if(u.isTrusted){const h=new MouseEvent("click",{bubbles:!0});u.currentTarget.dispatchEvent(h)}},children:t.jsx(b,{restrictionUiType:a})}):t.jsx(b,{restrictionUiType:a}),[a]),N=m.useMemo(()=>{if(!c||!a)return t.jsx(t.Fragment,{});const u=c==null?void 0:c.hasUnmetAccessRequirement,h=c==null?void 0:c.restrictionLevel;let T="";if(u)T="Request Access";else{if(k.OPEN===h)return R;T="View Terms"}return t.jsxs(t.Fragment,{children:[t.jsxs(g,{sx:E,className:e.className,onClick:p,children:[t.jsx(b,{restrictionUiType:a}),l&&t.jsx(V,{ml:"5px",children:T})]}),n&&t.jsx(L,{subjectId:i,subjectType:x.ENTITY,accessRequirementFromProps:o,renderAsModal:!0,onHide:()=>{s(!1)}})]})},[i,c,o,n,p,e.className,a,l,R]);return a?t.jsx("span",{style:{whiteSpace:"nowrap"},children:N}):t.jsx(t.Fragment,{})}try{A.displayName="useGetRestrictionUiType",A.__docgenInfo={description:`Determines whether an Entity is accessible for download, or if it is blocked by the ACL or unmet Access Requirements.

To make download available, and determine if the file is downloadable via the web, see {@link DirectDownload.tsx }`,displayName:"useGetRestrictionUiType",props:{}}}catch{}try{w.displayName="HasAccessV2",w.__docgenInfo={description:`HasAccess shows if the user has access to the file or not. If the user doesn't have access due to a restriction,
then a link will be shown that opens a modal with steps to request access.`,displayName:"HasAccessV2",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!1,type:{name:"() => void"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},showButtonText:{defaultValue:null,description:"",name:"showButtonText",required:!1,type:{name:"boolean"}},showExternalAccessIcon:{defaultValue:{value:"false"},description:`If true, the component will show enhanced UI for the case where
- the entity is a FileEntity, AND
- the caller has permission to fetch the dataFileHandle, AND
- the dataFileHandle is an instance of ExternalFileHandleInterface (i.e. the file is not controlled by Synapse)
Note that this requires an additional API call that cannot be batched, so it should be avoided in bulk  contexts if possible.`,name:"showExternalAccessIcon",required:!1,type:{name:"boolean"}}}}}catch{}export{w as H,le as u};
