import{r as m,eT as _,cH as V,j as u,ao as j,cG as v,a0 as T,f7 as M,ab as b,a2 as k}from"./iframe-BQ-FyWsS.js";import{L as A}from"./LargeButton-Bh3NfdIO.js";import{b as F}from"./use-deep-compare-effect.esm-CEJVc6R6.js";import{g as z,c as x,L as J}from"./UserBadge-9nlLDOSg.js";import{w as Q}from"./without-K2iuFss8.js";class g extends m.Component{constructor(e){super(e),this.state={userProfileMap:{}},this.update=this.update.bind(this)}componentDidMount(){const{list:e}=this.props;this.update(e)}componentDidUpdate(e){const t=e.list,a=Q(this.props.list.filter(r=>r),...t);a.length>0&&this.update(a)}update(e){z(e.filter(t=>!!t)).then(t=>{const a={};t.list.forEach(r=>{const{ownerId:i}=r;a[i]=r}),this.setState({userProfileMap:{...this.state.userProfileMap,...a}})}).catch(t=>{console.error("Error on batch call =",t)})}manuallyExtractData(e){const t=e.headers.findIndex(s=>s.name==="firstName"),a=e.headers.findIndex(s=>s.name==="lastName"),r=e.headers.findIndex(s=>s.name==="institution"),i=e.headers.findIndex(s=>s.columnType===_.USERID);return e.rows.filter(s=>!s.values[i]).map(s=>{const n=s.values;return{firstName:n[t]??"",lastName:n[a]??"",company:n[r]??void 0,ownerId:null,userName:n[t]?n[t][0]??"":""}})}render(){const{size:e=V,rowSet:t,list:a}=this.props,{userProfileMap:r={}}=this.state,i=t&&this.manuallyExtractData(t);let l=0;return u.jsx("div",{className:"SRC-card-grid-row",children:a.map(s=>{const n=s!=null?r[s]:null;if(n)return u.jsx("div",{className:"SRC-grid-item SRC-narrow-grid-item",children:u.jsx(x,{size:e,preSignedURL:n.clientPreSignedURL,userProfile:n})},JSON.stringify(n));const c=i&&i[l];return c?(l+=1,u.jsx("div",{className:"SRC-grid-item SRC-narrow-grid-item",children:u.jsx(x,{disableLink:!0,hideEmail:!0,size:e,userProfile:c})},JSON.stringify(c))):!1})})}}try{g.displayName="UserCardList",g.__docgenInfo={description:"",displayName:"UserCardList",props:{list:{defaultValue:null,description:"",name:"list",required:!0,type:{name:"string[]"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"UserCardSize"}},rowSet:{defaultValue:null,description:"",name:"rowSet",required:!1,type:{name:"RowSet"}}}}}catch{}const B="sage_rotate_uids",Y=3,$=(o=[],e=Y,t)=>{let a=[],r=[];const i=localStorage.getItem(t);if(i!=null&&(a=JSON.parse(i)),a.length){const l=o.filter(s=>!a.includes(s));if(l.length>=e)return r=l.slice(0,e),localStorage.setItem(t,JSON.stringify(a.concat(r))),r;{localStorage.removeItem(t);const s=o.slice(0,e-l.length);return localStorage.setItem(t,JSON.stringify(s)),l.concat(s)}}else return r=o.slice(0,e),localStorage.setItem(t,JSON.stringify(r)),r};function U({sql:o,count:e,useQueryResultUserData:t=!1,size:a=v,summaryLink:r,summaryLinkText:i,selectedFacets:l,searchParams:s,sqlOperator:n,additionalFiltersSessionStorageKey:c}){const{accessToken:h}=j(),[p,C]=m.useState([]),[L,N]=m.useState(),[f,S]=m.useState();let R=!0;const q=`${B}-${o}-${JSON.stringify(l)}`;return F(()=>(async function(){S(!0);const E=T(o),w=M(s,n,c),D={partMask:k,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:E,query:{sql:o,additionalFilters:w,selectedFacets:l}},I=await b.getFullQueryTableResults(D,h),{queryResult:y}=I;if(y?.queryResults.rows){const P=y.queryResults.headers.findIndex(d=>d.columnType===_.USERID),O=y.queryResults.rows.map(d=>d.values[P]).filter(d=>d!==null);if(R){const d=$(O,e,q);C(d),t&&N(I),S(!1)}}else console.log("UserCardListRotate: Error getting data")}(),()=>{R=!1}),[o,l,e,h,s,n]),u.jsxs("div",{className:"UserCardListRotate",children:[f&&u.jsx(J,{}),!f&&p.length===0&&u.jsx("p",{className:"font-italic",children:"No one was found."}),!f&&p.length>0&&u.jsx(g,{list:p,size:a,rowSet:L?.queryResult?.queryResults}),r&&i&&u.jsx("div",{className:"UserCardListRotate__summary",children:u.jsx(A,{color:"secondary",variant:"contained",href:r,children:i})})]})}try{U.displayName="UserCardListRotate",U.__docgenInfo={description:"",displayName:"UserCardListRotate",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},count:{defaultValue:null,description:"",name:"count",required:!0,type:{name:"number"}},useQueryResultUserData:{defaultValue:{value:"false"},description:"",name:"useQueryResultUserData",required:!1,type:{name:"boolean"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"UserCardSize"}},summaryLink:{defaultValue:null,description:"",name:"summaryLink",required:!1,type:{name:"string"}},summaryLinkText:{defaultValue:null,description:"",name:"summaryLinkText",required:!1,type:{name:"string"}},selectedFacets:{defaultValue:null,description:"",name:"selectedFacets",required:!1,type:{name:"FacetColumnRequest[]"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"SQLOperator"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},additionalFiltersSessionStorageKey:{defaultValue:null,description:"",name:"additionalFiltersSessionStorageKey",required:!1,type:{name:"string"}}}}}catch{}export{g as U,U as a};
