import{r as A,R as te}from"./index-Dl6G-zuu.js";const h={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"};let ne=0;function he(t,c){const l=`atom${++ne}`,p={toString:()=>l};return typeof t=="function"?p.read=t:(p.init=t,p.read=oe,p.write=se),c&&(p.write=c),p}function oe(t){return t(this)}function se(t,c,l){return c(this,typeof l=="function"?l(t(this)):l)}const I=(t,c)=>t.unstable_is?t.unstable_is(c):c===t,U=t=>"init"in t,m=t=>!!t.write,C=new WeakMap,re=(t,c)=>{C.set(t,c),t.catch(()=>{}).finally(()=>C.delete(t))},$=(t,c)=>{const l=C.get(t);l&&(C.delete(t),l(c))},x=(t,c)=>{t.status="fulfilled",t.value=c},K=(t,c)=>{t.status="rejected",t.reason=c},ie=t=>typeof(t==null?void 0:t.then)=="function",R=(t,c)=>!!t&&"v"in t&&"v"in c&&Object.is(t.v,c.v),Y=(t,c)=>!!t&&"e"in t&&"e"in c&&Object.is(t.e,c.e),O=t=>!!t&&"v"in t&&t.v instanceof Promise,ce=(t,c)=>"v"in t&&"v"in c&&t.v.orig&&t.v.orig===c.v.orig,k=t=>{if("e"in t)throw t.e;return t.v},G=()=>{const t=new WeakMap,c=new WeakMap,l=[],p=new WeakMap;let g,b;(h?"production":void 0)!=="production"&&(g=new Set,b=new Set);const _=e=>t.get(e),E=(e,o)=>{o.d.forEach((u,i)=>{var s;if(!p.has(i)){const r=_(i);(s=l[l.length-1])==null||s.add(i),p.set(i,[r,new Set]),r&&E(i,r)}p.get(i)[1].add(e)})},N=(e,o)=>{var u;(h?"production":void 0)!=="production"&&Object.freeze(o);const i=_(e);if(t.set(e,o),p.has(e)||((u=l[l.length-1])==null||u.add(e),p.set(e,[i,new Set]),E(e,o)),O(i)){const s="v"in o?o.v instanceof Promise?o.v:Promise.resolve(o.v):Promise.reject(o.e);i.v!==s&&$(i.v,s)}},S=(e,o,u,i)=>{const s=new Map(i?o.d:null);let r=!1;u.forEach((n,d)=>{!n&&I(e,d)&&(n=o),n?(s.set(d,n),o.d.get(d)!==n&&(r=!0)):(h?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(r||o.d.size!==s.size)&&(o.d=s)},y=(e,o,u,i)=>{const s=_(e),r={d:(s==null?void 0:s.d)||new Map,v:o};if(u&&S(e,r,u,i),R(s,r)&&s.d===r.d)return s;if(O(s)&&O(r)&&ce(s,r)){if(s.d===r.d)return s;r.v=s.v}return N(e,r),r},V=(e,o,u,i)=>{if(ie(o)){let s;const r=()=>{const d=_(e);if(!O(d)||d.v!==n)return;const v=y(e,n,u);c.has(e)&&d.d!==v.d&&J(e,v,d.d)},n=new Promise((d,v)=>{let f=!1;o.then(a=>{f||(f=!0,x(n,a),d(a),r())},a=>{f||(f=!0,K(n,a),v(a),r())}),s=a=>{f||(f=!0,a.then(w=>x(n,w),w=>K(n,w)),d(a))}});return n.orig=o,n.status="pending",re(n,d=>{d&&s(d),i==null||i()}),y(e,n,u,!0)}return y(e,o,u)},Z=(e,o,u)=>{const i=_(e),s={d:(i==null?void 0:i.d)||new Map,e:o};return u&&S(e,s,u),Y(i,s)&&i.d===s.d?i:(N(e,s),s)},P=(e,o)=>{const u=_(e);if(!o&&u&&(c.has(e)||Array.from(u.d).every(([f,a])=>{if(f===e)return!0;const w=P(f);return w===a||R(w,a)})))return u;const i=new Map;let s=!0;const r=f=>{if(I(e,f)){const w=_(f);if(w)return i.set(f,w),k(w);if(U(f))return i.set(f,void 0),f.init;throw new Error("no atom init")}const a=P(f);return i.set(f,a),k(a)};let n,d;const v={get signal(){return n||(n=new AbortController),n.signal},get setSelf(){return(h?"production":void 0)!=="production"&&!m(e)&&console.warn("setSelf function cannot be used with read-only atom"),!d&&m(e)&&(d=(...f)=>{if((h?"production":void 0)!=="production"&&s&&console.warn("setSelf function cannot be called in sync"),!s)return M(e,...f)}),d}};try{const f=e.read(r,v);return V(e,f,i,()=>n==null?void 0:n.abort())}catch(f){return Z(e,f,i)}finally{s=!1}},z=e=>k(P(e)),Q=e=>{let o=c.get(e);return o||(o=D(e)),o},B=(e,o)=>!o.l.size&&(!o.t.size||o.t.size===1&&o.t.has(e)),ee=e=>{const o=c.get(e);o&&B(e,o)&&j(e)},L=e=>{const o=n=>{var d,v;const f=new Set((d=c.get(n))==null?void 0:d.t);return(v=p.get(n))==null||v[1].forEach(a=>{f.add(a)}),f},u=new Array,i=new Set,s=n=>{if(!i.has(n)){i.add(n);for(const d of o(n))n!==d&&s(d);u.push(n)}};s(e);const r=new Set([e]);for(let n=u.length-1;n>=0;--n){const d=u[n],v=_(d);if(!v)continue;let f=!1;for(const a of v.d.keys())if(a!==d&&r.has(a)){f=!0;break}if(f){const a=P(d,!0);R(v,a)||r.add(d)}}},W=(e,...o)=>{let u=!0;const i=n=>k(P(n)),s=(n,...d)=>{let v;if(I(e,n)){if(!U(n))throw new Error("atom not writable");const f=_(n),a=V(n,d[0]);R(f,a)||L(n)}else v=W(n,...d);if(!u){const f=T([n]);(h?"production":void 0)!=="production"&&g.forEach(a=>a({type:"async-write",flushed:f}))}return v},r=e.write(i,s,...o);return u=!1,r},M=(e,...o)=>{l.push(new Set([e]));const u=W(e,...o),i=T(l.pop());return(h?"production":void 0)!=="production"&&g.forEach(s=>s({type:"write",flushed:i})),u},D=(e,o,u)=>{var i;const s=u||[];(i=_(e))==null||i.d.forEach((n,d)=>{const v=c.get(d);v?v.t.add(e):d!==e&&D(d,e,s)}),P(e);const r={t:new Set(o&&[o]),l:new Set};if(c.set(e,r),(h?"production":void 0)!=="production"&&b.add(e),m(e)&&e.onMount){const{onMount:n}=e;s.push(()=>{const d=n((...v)=>M(e,...v));d&&(r.u=d)})}return u||s.forEach(n=>n()),r},j=e=>{var o;const u=(o=c.get(e))==null?void 0:o.u;u&&u(),c.delete(e),(h?"production":void 0)!=="production"&&b.delete(e);const i=_(e);i?(O(i)&&$(i.v),i.d.forEach((s,r)=>{if(r!==e){const n=c.get(r);n&&(n.t.delete(e),B(r,n)&&j(r))}})):(h?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",e)},J=(e,o,u)=>{const i=new Set(o.d.keys()),s=new Set;u==null||u.forEach((r,n)=>{if(i.has(n)){i.delete(n);return}s.add(n);const d=c.get(n);d&&d.t.delete(e)}),i.forEach(r=>{const n=c.get(r);n?n.t.add(e):c.has(e)&&D(r,e)}),s.forEach(r=>{const n=c.get(r);n&&B(r,n)&&j(r)})},T=e=>{let o;(h?"production":void 0)!=="production"&&(o=new Set);const u=[],i=s=>{var r;if(!p.has(s))return;const[n,d]=p.get(s);p.delete(s),u.push([s,n]),d.forEach(i),(r=_(s))==null||r.d.forEach((v,f)=>i(f))};if(e.forEach(i),u.forEach(([s,r])=>{const n=_(s);if(!n){(h?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush");return}if(n!==r){const d=c.get(s);d&&n.d!==(r==null?void 0:r.d)&&J(s,n,r==null?void 0:r.d),d&&!(!O(r)&&(R(r,n)||Y(r,n)))&&(d.l.forEach(v=>v()),(h?"production":void 0)!=="production"&&o.add(s))}}),(h?"production":void 0)!=="production")return o},q=(e,o)=>{const u=Q(e),i=T([e]),s=u.l;return s.add(o),(h?"production":void 0)!=="production"&&g.forEach(r=>r({type:"sub",flushed:i})),()=>{s.delete(o),ee(e),(h?"production":void 0)!=="production"&&g.forEach(r=>r({type:"unsub"}))}};return(h?"production":void 0)!=="production"?{get:z,set:M,sub:q,dev_subscribe_store:(e,o)=>{if(o!==2)throw new Error("The current StoreListener revision is 2.");return g.add(e),()=>{g.delete(e)}},dev_get_mounted_atoms:()=>b.values(),dev_get_atom_state:e=>t.get(e),dev_get_mounted:e=>c.get(e),dev_restore_atoms:e=>{l.push(new Set);for(const[u,i]of e)U(u)&&(V(u,i),L(u));const o=T(l.pop());g.forEach(u=>u({type:"restore",flushed:o}))}}:{get:z,set:M,sub:q}};let F;(h?"production":void 0)!=="production"&&(typeof globalThis.__NUMBER_OF_JOTAI_INSTANCES__=="number"?++globalThis.__NUMBER_OF_JOTAI_INSTANCES__:globalThis.__NUMBER_OF_JOTAI_INSTANCES__=1);const ue=()=>(F||((h?"production":void 0)!=="production"&&globalThis.__NUMBER_OF_JOTAI_INSTANCES__!==1&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"),F=G()),F),de={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"},H=A.createContext(void 0),X=t=>A.useContext(H)||ue(),_e=({children:t,store:c})=>{const l=A.useRef();return!c&&!l.current&&(l.current=G()),A.createElement(H.Provider,{value:c||l.current},t)},fe=t=>typeof(t==null?void 0:t.then)=="function",le=te.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(c=>{t.status="fulfilled",t.value=c},c=>{t.status="rejected",t.reason=c}),t)});function ae(t,c){const l=X(),[[p,g,b],_]=A.useReducer(S=>{const y=l.get(t);return Object.is(S[0],y)&&S[1]===l&&S[2]===t?S:[y,l,t]},void 0,()=>[l.get(t),l,t]);let E=p;return(g!==l||b!==t)&&(_(),E=l.get(t)),A.useEffect(()=>{const S=l.sub(t,()=>{_()});return _(),S},[l,t,void 0]),A.useDebugValue(E),fe(E)?le(E):E}function ve(t,c){const l=X();return A.useCallback((...g)=>{if((de?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return l.set(t,...g)},[l,t])}function ge(t,c){return[ae(t),ve(t)]}export{_e as P,he as a,ge as b,ve as c,ae as u};
