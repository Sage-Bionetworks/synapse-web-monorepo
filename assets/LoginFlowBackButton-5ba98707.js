import{r as C,R as b}from"./index-8db94870.js";import{as as z,b as U,at as pe}from"./SynapseConstants-1ebc8be6.js";import{S as I}from"./SynapseClient-3acc417d.js";import{u as $}from"./useMutation-4a5482b4.js";import{j as a,a as v,F as j}from"./jsx-runtime-095bf462.js";import{g as ee,B as te}from"./getEndpoint-ac94413e.js";import{F as me}from"./FullWidthAlert-48fa1a59.js";import{s as he}from"./styled-8ebe2b7d.js";import{T as fe}from"./TextField-2ca2cc45.js";import{B as V}from"./Box-bbfe1a31.js";import{B as T}from"./Button-7a4e3dd9.js";import{T as N}from"./TextField-a9834bb4.js";import{L as P}from"./Link-e1e47239.js";import{S as ge}from"./SvgIcon-147e032d.js";import{I as ne}from"./IconSvg-d5f86620.js";import{I as Ee}from"./IconButton-03ffcd84.js";function We(e,r){const[i,n]=C.useState("CHOOSE_AUTH_METHOD"),[p,o]=C.useState(),[d,c]=C.useState(),[h,m]=C.useState();C.useEffect(()=>{const s=new URL(window.location.href.replaceAll("#","/")),{searchParams:f}=s;if(f){const E=f.get("userId"),R=f.get("twoFaToken");E&&R&&(c(parseInt(E,10)),m(R),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||n("VERIFICATION_CODE"))}},[i]),C.useEffect(()=>{r&&(m(r.twoFaToken),c(r.userId),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||n("VERIFICATION_CODE"))},[r]),C.useEffect(()=>{o(void 0)},[i]);async function y(s){await I.setAccessTokenCookie(s.accessToken),localStorage.setItem(z,s.authenticationReceipt),n("LOGGED_IN"),e&&e()}const{mutate:g,isLoading:_}=$(({username:s,password:f,authenticationReceipt:E})=>I.login(s,f,E),{onError:s=>{o(s.reason)},onSuccess:async s=>{"errorCode"in s?(n("VERIFICATION_CODE"),m(s.twoFaToken),c(s.userId)):await y(s)}}),{mutate:w,isLoading:D}=$(I.loginWith2fa,{onError:s=>{o(s.reason),(s.reason.includes("The provided twoFaToken is invalid")||s.reason.includes("Token has expired"))&&(console.warn(s),o("Something went wrong. Refresh the page and try again."),window.location.href.includes("twoFaToken")&&window.history.replaceState({},document.title,window.location.href.replaceAll(/(twoFaToken|userId)=[^&]*&?/g,"")))},onSuccess:y});return{step:i,onStepChange:n,submitUsernameAndPassword:(s,f)=>{o(void 0);const E=localStorage.getItem(z);g({username:s,password:f,authenticationReceipt:E})},submitOneTimePassword:(s,f=i==="RECOVERY_CODE"?"RECOVERY_CODE":"TOTP")=>{if(o(void 0),h==null||d==null){o("You did not first log in with your password or a third-party identity provider.");return}w({userId:d,twoFaToken:h,otpCode:s,otpType:f})},errorMessage:p,isLoading:_||D}}const Oe=he(fe)`
  input {
    text-align: center;
  }
`,Ce={TextFieldStyled:Oe},ye=e=>a(Ce.TextFieldStyled,{...e}),L={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace"};function _e(e,r){return e<=0?[]:Array.from({length:e},r)}function Se(e,r,i){return e.map((n,p)=>r===p?i:n)}function K(e){return e.join("")}function Z(e,r){return[...e,r]}function ve(e,r,i){return e.reduce((n,p,o)=>{const{characters:d,restArrayMerged:c}=n;if(o<i)return{restArrayMerged:c,characters:Z(d,p)};const[h,...m]=c;return{restArrayMerged:m,characters:Z(d,h||"")}},{restArrayMerged:r,characters:[]}).characters}function Re(e){return e.split("")}const oe=b.forwardRef((e,r)=>{const{value:i,length:n,autoFocus:p,onChange:o,TextFieldsProps:d,onComplete:c,validateChar:h,className:m,...y}=e,{onPaste:g,onFocus:_,onKeyDown:w,className:D,...k}=d||{},S=_e(n,(t,u)=>({character:i[u]||"",inputRef:b.createRef()})),s=t=>S.findIndex(({inputRef:u})=>u.current===t),f=()=>S.map(({character:t})=>t),E=(t,u)=>{const l=Se(f(),t,u);return K(l)},R=t=>{var u,l;(l=(u=S[t])==null?void 0:u.inputRef.current)==null||l.focus()},A=t=>{var u,l;(l=(u=S[t])==null?void 0:u.inputRef.current)==null||l.select()},x=t=>{t+1!==n&&(S[t+1].character?A(t+1):R(t+1))},re=t=>{t>0&&A(t-1)},ae=t=>{const u=t.target.value[0]||"",l=s(t.target);if(typeof h=="function"&&!h(u,l))return;const O=E(l,u);o==null||o(O),O.length===n&&(c==null||c(O)),u!==""?O.length<n?x(O.length-1):x(l):O[l]?A(l):re(l)},ie=t=>{t.preventDefault(),t.target.select(),_==null||_(t)},se=t=>{const u=t.target,l=s(u);u.value===t.key?(t.preventDefault(),x(l)):!u.value&&L.backspace===t.key||L.left===t.key?(t.preventDefault(),A(l-1)):L.right===t.key&&(t.preventDefault(),A(l+1)),w==null||w(t)},le=t=>{t.preventDefault();const u=t.target,l=t.clipboardData.getData("text/plain"),O=s(u),ue=f(),W=ve(ue,Re(l),O),Y=W.findIndex((de,ce)=>ce>O&&de===""),F=K(W);if(o==null||o(F),F.length===n){c==null||c(F),R(n-1);return}Y!==-1&&R(Y),g==null||g(t)};return a(V,{display:"flex",gap:"20px",alignItems:"center",ref:r,className:`MuiOtpInput-Box ${m||""}`,...y,children:S.map(({character:t,inputRef:u},l)=>a(ye,{autoFocus:p?l===0:!1,autoComplete:"one-time-code",value:t,inputRef:u,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${l+1} ${D||""}`,onPaste:le,onFocus:ie,onChange:ae,onKeyDown:se,...k},l))})});oe.defaultProps={value:"",length:4,autoFocus:!1,validateChar:()=>!0,onChange:()=>{},onComplete:()=>{},TextFieldsProps:{}};const J=6,we=["0","1","2","3","4","5","6","7","8","9"];function M(e){const{onSubmit:r,isLoading:i}=e,[n,p]=b.useState("");return v(V,{children:[a(oe,{autoFocus:!0,length:J,value:n,onChange:p,onComplete:r,validateChar:o=>we.includes(o)||o==="",gap:"2px",sx:{".MuiInputBase-root":{paddingLeft:"5px",paddingRight:"5px"},".MuiFormControl-root:first-of-type > .MuiInputBase-root":{borderTopRightRadius:0,borderBottomRightRadius:0},".MuiFormControl-root:last-of-type > .MuiInputBase-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},".MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root":{borderRadius:0}}}),a(T,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:n.length!==J||i,onClick:o=>{o.preventDefault(),r(n)},children:i?"Verifying...":"Submit"})]})}try{M.displayName="TOTPForm",M.__docgenInfo={description:"",displayName:"TOTPForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function G(e){const{resetPasswordUrl:r=`${ee(te.PORTAL_ENDPOINT)}#!PasswordReset:0`,onSubmit:i,isLoading:n}=e,[p,o]=C.useState(""),[d,c]=C.useState("");function h(m){m.preventDefault(),i(p,d)}return v("form",{onSubmit:m=>{h(m)},children:[a(N,{required:!0,fullWidth:!0,autoFocus:!0,autoComplete:"username",label:"Username or Email Address",id:"username",type:"text",value:p,onChange:m=>o(m.target.value)}),a(N,{required:!0,fullWidth:!0,autoComplete:"current-password",label:"Password",id:"current-password",type:"password",value:d,onChange:m=>c(m.target.value)}),a(P,{href:r,children:"Forgot password?"}),a(T,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",disabled:n,sx:{height:"50px",mt:4,mb:2},children:n?"Logging you in...":"Sign in"})]})}try{G.displayName="UsernamePasswordForm",G.__docgenInfo={description:"",displayName:"UsernamePasswordForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(username: string, password: string) => void"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}const H=e=>v(ge,{...e,children:[a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.68 12.1818C19.68 11.6146 19.6291 11.0691 19.5345 10.5455H12V13.64H16.3055C16.12 14.64 15.5564 15.4873 14.7091 16.0546V18.0618H17.2945C18.8073 16.6691 19.68 14.6182 19.68 12.1818Z",fill:"#4285F4"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 20C14.16 20 15.9709 19.2836 17.2946 18.0618L14.7091 16.0545C13.9927 16.5345 13.0764 16.8182 12 16.8182C9.91637 16.8182 8.15273 15.4109 7.52364 13.52H4.85091V15.5927C6.16728 18.2073 8.87273 20 12 20Z",fill:"#34A853"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.52364 13.52C7.36364 13.04 7.27273 12.5273 7.27273 12C7.27273 11.4727 7.36364 10.96 7.52364 10.48V8.40729H4.85091C4.30909 9.48729 4 10.7091 4 12C4 13.2909 4.30909 14.5127 4.85091 15.5927L7.52364 13.52Z",fill:"#FBBC05"}),a("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 7.18182C13.1746 7.18182 14.2291 7.58545 15.0582 8.37818L17.3527 6.08364C15.9673 4.79273 14.1564 4 12 4C8.87273 4 6.16728 5.79273 4.85091 8.40727L7.52364 10.48C8.15273 8.58909 9.91637 7.18182 12 7.18182Z",fill:"#EA4335"})]});try{H.displayName="GoogleIcon24",H.__docgenInfo={description:"",displayName:"GoogleIcon24",props:{children:{defaultValue:null,description:"Node passed into the SVG element.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SvgIconClasses> & Partial<ClassNameMap<never>>)"}},color:{defaultValue:{value:"'inherit'"},description:`The color of the component.
It supports both default and custom theme colors, which can be added as shown in the
[palette customization guide](https://mui.com/material-ui/customization/palette/#adding-new-colors).
You can use the \`htmlColor\` prop to apply a color attribute to the SVG element.`,name:"color",required:!1,type:{name:"enum",value:[{value:'"action"'},{value:'"disabled"'},{value:'"info"'},{value:'"warning"'},{value:'"error"'},{value:'"success"'},{value:'"inherit"'},{value:'"primary"'},{value:'"secondary"'}]}},fontSize:{defaultValue:{value:"'medium'"},description:"The fontSize applied to the icon. Defaults to 24px, but can be configure to inherit font size.",name:"fontSize",required:!1,type:{name:"enum",value:[{value:'"small"'},{value:'"inherit"'},{value:'"medium"'},{value:'"large"'}]}},htmlColor:{defaultValue:null,description:"Applies a color attribute to the SVG element.",name:"htmlColor",required:!1,type:{name:"string"}},inheritViewBox:{defaultValue:{value:"false"},description:"If `true`, the root node will inherit the custom `component`'s viewBox and the `viewBox`\nprop will be ignored.\nUseful when you want to reference a custom `component` and have `SvgIcon` pass that\n`component`'s viewBox to the root node.",name:"inheritViewBox",required:!1,type:{name:"boolean"}},shapeRendering:{defaultValue:null,description:`The shape-rendering attribute. The behavior of the different options is described on the
[MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/shape-rendering).
If you are having issues with blurry icons you should investigate this prop.`,name:"shapeRendering",required:!1,type:{name:"string"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},titleAccess:{defaultValue:null,description:`Provides a human-readable title for the element that contains it.
https://www.w3.org/TR/SVG-access/#Equivalent`,name:"titleAccess",required:!1,type:{name:"string"}},viewBox:{defaultValue:{value:"'0 0 24 24'"},description:`Allows you to redefine what the coordinates without units mean inside an SVG element.
For example, if the SVG element is 500 (width) by 200 (height),
and you pass viewBox="0 0 50 20",
this means that the coordinates inside the SVG will go from the top left corner (0,0)
to bottom right (50,20) and each unit will be worth 10px.`,name:"viewBox",required:!1,type:{name:"string"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: SVGSVGElement | null) => void) | RefObject<SVGSVGElement> | null"}}}}}catch{}function q(e){const{onBeginOAuthSignIn:r,ssoRedirectUrl:i,onSelectUsernameAndPassword:n}=e;function p(o){r&&r(),o.preventDefault();const d=i?`${i}${U.GOOGLE}`:`${I.getRootURL()}?provider=${U.GOOGLE}`;I.oAuthUrlRequest(U.GOOGLE,d).then(c=>{window.location=c.authorizationUrl}).catch(c=>{console.log("Error on oAuth url ",c)})}return v(V,{children:[a(T,{fullWidth:!0,variant:"outlined",onClick:p,sx:{color:"grey.800",height:"50px",mb:"10px"},startIcon:a(H,{sx:{width:"28px",height:"28px"}}),children:"Sign in with Google"}),a(T,{fullWidth:!0,variant:"outlined",startIcon:a(ne,{icon:"email",sx:{width:"28px",height:"28px"}}),sx:{color:"grey.800",height:"50px",mb:"10px"},onClick:n,children:"Sign in with your email"})]})}try{q.displayName="AuthenticationMethodSelection",q.__docgenInfo={description:`To support Google SSO in your portal, you must add your domain to the Authorized Redirect URIs for Synapse authentication.
This can be done by visiting https://sagebionetworks.jira.com/servicedesk/customer/portal/9 to set up a collaboration.
Synapse engineers must add your redirect URL in the Google API console found at https://console.cloud.google.com/ for this functionality to work.`,displayName:"AuthenticationMethodSelection",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},onSelectUsernameAndPassword:{defaultValue:null,description:"",name:"onSelectUsernameAndPassword",required:!0,type:{name:"() => void"}}}}}catch{}const Ae=19;function B(e){const{onSubmit:r,isLoading:i}=e,[n,p]=b.useState("");return v(V,{children:[a(N,{placeholder:"Enter backup code",value:n,onChange:o=>{const d=o.target.value.toLowerCase().replace(/[^a-z0-9-]/gi,"");p(d)}}),a(T,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:n.length!==Ae||i,onClick:o=>{o.preventDefault(),r(n)},children:i?"Verifying...":"Submit"})]})}try{B.displayName="RecoveryCodeForm",B.__docgenInfo={description:"",displayName:"RecoveryCodeForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function Q(e){const{ssoRedirectUrl:r,registerAccountUrl:i=`${ee(te.PORTAL_ENDPOINT)}#!RegisterAccount:0`,resetPasswordUrl:n,onBeginOAuthSignIn:p,onStepChange:o,step:d,submitUsernameAndPassword:c,submitOneTimePassword:h,errorMessage:m,isLoading:y}=e;return v(j,{children:[d=="CHOOSE_AUTH_METHOD"&&a(q,{onSelectUsernameAndPassword:()=>o("USERNAME_PASSWORD"),onBeginOAuthSignIn:p,ssoRedirectUrl:r}),d==="USERNAME_PASSWORD"&&a(G,{isLoading:y,resetPasswordUrl:n,onSubmit:(g,_)=>{c(g,_)}}),d==="VERIFICATION_CODE"&&v(j,{children:[a(M,{isLoading:y,onSubmit:g=>{h(g,"TOTP")}}),a(P,{align:"center",color:"grey.700",sx:{display:"block",mx:"auto"},onClick:()=>o("RECOVERY_CODE"),children:"Use a backup code instead"})]}),d==="RECOVERY_CODE"&&a(B,{isLoading:y,onSubmit:g=>{h(g,"RECOVERY_CODE")}}),(d==="CHOOSE_AUTH_METHOD"||d==="USERNAME_PASSWORD")&&a(V,{sx:{display:"flex",justifyContent:"center",mt:"10px"},children:a(P,{href:i,align:"center",children:"Don't have an account? Create one now"})}),m&&a(me,{variant:"warning",isGlobal:!1,description:m})]})}try{Q.displayName="LoginForm",Q.__docgenInfo={description:"",displayName:"LoginForm",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},registerAccountUrl:{defaultValue:null,description:"",name:"registerAccountUrl",required:!1,type:{name:"string"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},twoFactorAuthenticationRequired:{defaultValue:null,description:"",name:"twoFactorAuthenticationRequired",required:!1,type:{name:"TwoFactorAuthErrorResponse"}},submitUsernameAndPassword:{defaultValue:null,description:"",name:"submitUsernameAndPassword",required:!0,type:{name:"(username: string, password: string) => void"}},submitOneTimePassword:{defaultValue:null,description:"",name:"submitOneTimePassword",required:!0,type:{name:"(code: string, otpType?: TwoFactorAuthOtpType | undefined) => void"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!0,type:{name:"string | undefined"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function Ie(e){switch(e){case"CHOOSE_AUTH_METHOD":return"CHOOSE_AUTH_METHOD";case"USERNAME_PASSWORD":return"CHOOSE_AUTH_METHOD";case"VERIFICATION_CODE":return"CHOOSE_AUTH_METHOD";case"RECOVERY_CODE":return"VERIFICATION_CODE";case"LOGGED_IN":return"LOGGED_IN"}}function X(e){const{step:r,onStepChange:i,sx:n}=e;return r==="USERNAME_PASSWORD"||r==="VERIFICATION_CODE"||r==="RECOVERY_CODE"?a(Ee,{className:pe,type:"button",onClick:()=>{i(Ie(r))},sx:n,children:a(ne,{icon:"arrowBack",wrap:!1,sx:{height:"24px",width:"24px"}})}):null}try{X.displayName="LoginFlowBackButton",X.__docgenInfo={description:"",displayName:"LoginFlowBackButton",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps"}}}}}catch{}export{X as L,Q as a,We as u};
//# sourceMappingURL=LoginFlowBackButton-5ba98707.js.map
