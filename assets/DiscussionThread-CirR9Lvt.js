import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{d as L}from"./dayjs.min-D1RcYm3-.js";import{r as n}from"./index-Cu9bd8lq.js";import{f as A}from"./DateFormatter-DOgbCCAK.js";import{u as oe,a as te,F as y,b as se}from"./ForumThreadEditor-DVev7p0X.js";import{u as ne,a as ie,b as re}from"./useThread-Bcp3V7Ob.js";import{S as ae}from"./SynapseConstants-binLeAzi.js";import{O as F,q as N}from"./VerificationSubmission-DL9jxYsQ.js";import{u as O,A as le}from"./useEntity-Wv2qc7GK.js";import{d as j}from"./ToastMessage-BzITCHuf.js";import{M as Y,x as v,C as de}from"./ConfirmationDialog-Zf7O5mq4.js";import{I as i}from"./IconSvg-CesIlRas.js";import{q as G}from"./useFiles-CEyBLkbD.js";import"./RegularExpressions-C8kNf9Fd.js";import"./OrientationBanner-6TFYkqd5.js";import{W as R}from"./WarningDialog-DlphGwEe.js";import{S as ce}from"./SkeletonTable-BZCRINy2.js";import{U as q}from"./UserBadge-B9CYaK-p.js";import{a as ue}from"./useSubscription-qmpGNZCY.js";import{S as pe}from"./SubscribersModal-B6etLSXk.js";import{B as D}from"./Button-j3jTttn9.js";import{T as me}from"./Typography-D6GCV-CB.js";const he=()=>alert("This functionality has not been implemented yet");function _(d){const{reply:t,onClickLink:C=he}=d,[c,u]=n.useState(!1),[g,r]=n.useState(!1),{data:p}=G(),{data:a}=O(t.projectId),{data:m,isLoading:x}=oe(t),{mutate:b}=te({onSuccess:()=>{r(!1),j("A reply has been deleted.","info")}}),h=t.createdBy==(p==null?void 0:p.ownerId);return e.jsx("div",{className:"reply-container",children:x?e.jsx(ce,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(q,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{className:"message-body",children:[e.jsx(Y,{markdown:m,objectType:F.REPLY}),e.jsxs("span",{children:["posted ",A(L(t.createdOn),"M/D/YYYY")]}),e.jsxs("div",{style:{float:"right"},children:[e.jsx("button",{onClick:()=>C(),children:e.jsx(i,{icon:"link"})}),h&&e.jsx("button",{onClick:()=>u(!0),children:e.jsx(i,{icon:"edit"})}),(a==null?void 0:a.permissions.canModerate)&&e.jsx("button",{onClick:()=>r(!0),children:e.jsx(i,{icon:"delete"})})]})]})]}),e.jsx(y,{isReply:!0,initialText:m,onClose:()=>u(!1),id:t.id,isDialog:!0,openDialog:c}),e.jsx(R,{open:g,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{r(!1)},onConfirm:()=>b({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{_.displayName="DiscussionReply",_.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"(() => void)"}}}}}catch{}const fe="You are following this topic. Click to stop following.",xe="You are not following this topic. Click to follow.",ye="You will need to sign in for access to that resource",E="Write a reply...";function B(d){const{threadId:t,limit:C}=d,[c,u]=n.useState(!0),[g,r]=n.useState(!1),[p,a]=n.useState(!1),[m,x]=n.useState(!1),[b,h]=n.useState(!1),[H,f]=n.useState(!1),[P,S]=n.useState(!1),[U,W]=n.useState(!1),{threadData:o,threadBody:w,togglePin:V}=ne(t),{data:s}=G(),{data:T}=O((o==null?void 0:o.projectId)??"",void 0,le,{enabled:!!o}),{subscription:M,toggleSubscribed:X,isLoading:z}=ue(t,N.THREAD),{mutate:K}=ie({onSuccess:()=>{h(!1),j("A thread has been deleted.","info")}}),{mutate:J}=re({onSuccess:()=>{S(!1),j("A thread has been restored.","info")}}),Q=(o==null?void 0:o.createdBy)==(s==null?void 0:s.ownerId);function Z(){if((s==null?void 0:s.userName)=="anonymous")f(!0);else try{X()}catch(l){j(l.reason,"danger")}}const{data:I,hasNextPage:$,fetchNextPage:ee}=se(t,c,C),k=(I==null?void 0:I.pages.flatMap(l=>l.results))??[];return e.jsxs("div",{className:"bootstrap-4-backport DiscussionThread",children:[o&&w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(D,{variant:c?"contained":"outlined",onClick:()=>u(!0),children:"Date Posted"}),e.jsx(D,{variant:c?"outlined":"contained",onClick:()=>u(!1),children:"Most Recent"})]}),e.jsx(q,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{children:[e.jsx(me,{style:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(pe,{id:t,objectType:N.THREAD,showModal:U,handleModal:W})]}),e.jsx("div",{children:e.jsx(Y,{markdown:w,objectType:F.THREAD})}),e.jsxs("span",{children:["posted ",A(L(o.createdOn),"M/D/YYYY")]}),e.jsx(y,{isReply:!1,initialText:w,onClose:()=>r(!1),initialTitle:o==null?void 0:o.title,id:t,isDialog:!0,openDialog:g})]}):e.jsx(e.Fragment,{}),e.jsx("div",{className:"control-container",children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>S(!0),children:e.jsx(i,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":M?"Unfollow thread":"Follow thread",disabled:z,onClick:()=>Z(),children:M?e.jsx(i,{icon:"visibility",label:fe}):e.jsx(i,{icon:"visibilityOff",label:xe})})}),Q&&e.jsx("button",{onClick:()=>r(!0),children:e.jsx(i,{icon:"edit",label:"Edit thread"})}),T!=null&&T.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(!0),children:e.jsx(i,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>V(),children:o!=null&&o.isPinned?e.jsx(i,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(i,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),p?e.jsx(y,{id:t,isReply:!0,onClose:()=>a(!1),isDialog:!1}):e.jsx(v,{type:"text",placeholder:E,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):a(!0)}}),e.jsx("div",{children:k.map(l=>e.jsx(_,{reply:l},l.id))}),k.length>0&&e.jsx(e.Fragment,{children:m?e.jsx(y,{id:t,isReply:!0,onClose:()=>x(!1),isDialog:!1}):e.jsx(v,{type:"text",placeholder:E,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):x(!0)}})}),$?e.jsx(D,{variant:"outlined",onClick:()=>{ee()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(R,{open:b,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>h(!1),onConfirm:()=>o&&K(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(R,{open:P,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>S(!1),onConfirm:()=>o&&J(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(de,{open:H,title:"Sign In Required",content:ye,onCancel:()=>f(!1),hasCancelButton:!1,onConfirm:()=>f(!1),confirmButtonProps:{children:"Sign In",className:ae}})]})}try{B.displayName="DiscussionThread",B.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{B as D};
