import{r as P,R as ne}from"./index-C9LqO53Z.js";const L={},Z=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,k=e=>"init"in e,C=e=>!!e.write,B=e=>"v"in e||"e"in e,x=e=>{if("e"in e)throw e.e;if((L?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},j=new WeakMap,H=e=>{var t;return M(e)&&!!((t=j.get(e))!=null&&t[0])},de=e=>{const t=j.get(e);t!=null&&t[0]&&(t[0]=!1,t[1].forEach(n=>n()))},re=(e,t)=>{let n=j.get(e);if(!n){n=[!0,new Set],j.set(e,n);const o=()=>{n[0]=!1};e.then(o,o)}n[1].add(t)},M=e=>typeof(e==null?void 0:e.then)=="function",oe=(e,t,n)=>{n.p.has(e)||(n.p.add(e),t.then(()=>{n.p.delete(e)},()=>{n.p.delete(e)}))},G=(e,t,n)=>{const o=n(e),u="v"in o,f=o.v;if(M(t))for(const a of o.d.keys())oe(e,t,n(a));o.v=t,delete o.e,(!u||!Object.is(f,o.v))&&(++o.n,M(f)&&de(f))},m=(e,t,n)=>{var o;const u=new Set;for(const f of((o=n.get(e))==null?void 0:o.t)||[])n.has(f)&&u.add(f);for(const f of t.p)u.add(f);return u},fe=()=>{const e=new Set,t=()=>{e.forEach(n=>n())};return t.add=n=>(e.add(n),()=>{e.delete(n)}),t},K=()=>{const e={},t=new WeakMap,n=o=>{var u,f;(u=t.get(e))==null||u.forEach(a=>a(o)),(f=t.get(o))==null||f.forEach(a=>a())};return n.add=(o,u)=>{const f=o||e,a=(t.has(f)?t:t.set(f,new Set)).get(f);return a.add(u),()=>{a==null||a.delete(u),a.size||t.delete(f)}},n},ae=e=>(e.c||(e.c=K()),e.m||(e.m=K()),e.u||(e.u=K()),e.f||(e.f=fe()),e),ve=Symbol(),he=(e=new WeakMap,t=new WeakMap,n=new WeakMap,o=new Set,u=new Set,f=new Set,a={},w=(h,...b)=>h.read(...b),g=(h,...b)=>h.write(...b),v=(h,b)=>{var A;return(A=h.unstable_onInit)==null?void 0:A.call(h,b)},_=(h,b)=>{var A;return(A=h.onMount)==null?void 0:A.call(h,b)},...y)=>{const h=y[0]||(r=>{if((L?"production":void 0)!=="production"&&!r)throw new Error("Atom is undefined or null");let d=e.get(r);return d||(d={d:new Map,p:new Set,n:0},e.set(r,d),v==null||v(r,J)),d}),b=y[1]||(()=>{const r=[],d=l=>{try{l()}catch(s){r.push(s)}};do{a.f&&d(a.f);const l=new Set,s=l.add.bind(l);o.forEach(i=>{var c;return(c=t.get(i))==null?void 0:c.l.forEach(s)}),o.clear(),f.forEach(s),f.clear(),u.forEach(s),u.clear(),l.forEach(d),o.size&&A()}while(o.size||f.size||u.size);if(r.length)throw new AggregateError(r)}),A=y[2]||(()=>{const r=[],d=new WeakSet,l=new WeakSet,s=Array.from(o);for(;s.length;){const i=s[s.length-1],c=h(i);if(l.has(i)){s.pop();continue}if(d.has(i)){if(n.get(i)===c.n)r.push([i,c]);else if((L?"production":void 0)!=="production"&&n.has(i))throw new Error("[Bug] invalidated atom exists");l.add(i),s.pop();continue}d.add(i);for(const p of m(i,c,t))d.has(p)||s.push(p)}for(let i=r.length-1;i>=0;--i){const[c,p]=r[i];let E=!1;for(const T of p.d.keys())if(T!==c&&o.has(T)){E=!0;break}E&&(R(c),W(c)),n.delete(c)}}),R=y[3]||(r=>{var d;const l=h(r);if(B(l)&&(t.has(r)&&n.get(r)!==l.n||Array.from(l.d).every(([S,V])=>R(S).n===V)))return l;l.d.clear();let s=!0;const i=()=>{t.has(r)&&(W(r),A(),b())},c=S=>{var V;if(Z(r,S)){const Y=h(S);if(!B(Y))if(k(S))G(S,S.init,h);else throw new Error("no atom init");return x(Y)}const $=R(S);try{return x($)}finally{l.d.set(S,$.n),H(l.v)&&oe(r,l.v,$),(V=t.get(S))==null||V.t.add(r),s||i()}};let p,E;const T={get signal(){return p||(p=new AbortController),p.signal},get setSelf(){return(L?"production":void 0)!=="production"&&!C(r)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&C(r)&&(E=(...S)=>{if((L?"production":void 0)!=="production"&&s&&console.warn("setSelf function cannot be called in sync"),!s)try{return D(r,...S)}finally{A(),b()}}),E}},N=l.n;try{const S=w(r,c,T);return G(r,S,h),M(S)&&(re(S,()=>p==null?void 0:p.abort()),S.then(i,i)),l}catch(S){return delete l.v,l.e=S,++l.n,l}finally{s=!1,N!==l.n&&n.get(r)===N&&(n.set(r,l.n),o.add(r),(d=a.c)==null||d.call(a,r))}}),U=y[4]||(r=>{const d=[r];for(;d.length;){const l=d.pop(),s=h(l);for(const i of m(l,s,t)){const c=h(i);n.set(i,c.n),d.push(i)}}}),D=y[5]||((r,...d)=>{let l=!0;const s=c=>x(R(c)),i=(c,...p)=>{var E;const T=h(c);try{if(Z(r,c)){if(!k(c))throw new Error("atom not writable");const N=T.n,S=p[0];G(c,S,h),W(c),N!==T.n&&(o.add(c),(E=a.c)==null||E.call(a,c),U(c));return}else return D(c,...p)}finally{l||(A(),b())}};try{return g(r,s,i,...d)}finally{l=!1}}),W=y[6]||(r=>{var d;const l=h(r),s=t.get(r);if(s&&!H(l.v)){for(const[i,c]of l.d)if(!s.d.has(i)){const p=h(i);z(i).t.add(r),s.d.add(i),c!==p.n&&(o.add(i),(d=a.c)==null||d.call(a,i),U(i))}for(const i of s.d||[])if(!l.d.has(i)){s.d.delete(i);const c=O(i);c==null||c.t.delete(r)}}}),z=y[7]||(r=>{var d;const l=h(r);let s=t.get(r);if(!s){R(r);for(const i of l.d.keys())z(i).t.add(r);if(s={l:new Set,d:new Set(l.d.keys()),t:new Set},t.set(r,s),(d=a.m)==null||d.call(a,r),C(r)){const i=()=>{let c=!0;const p=(...E)=>{try{return D(r,...E)}finally{c||(A(),b())}};try{const E=_(r,p);E&&(s.u=()=>{c=!0;try{E()}finally{c=!1}})}finally{c=!1}};u.add(i)}}return s}),O=y[8]||(r=>{var d;const l=h(r);let s=t.get(r);if(s&&!s.l.size&&!Array.from(s.t).some(i=>{var c;return(c=t.get(i))==null?void 0:c.d.has(r)})){s.u&&f.add(s.u),s=void 0,t.delete(r),(d=a.u)==null||d.call(a,r);for(const i of l.d.keys()){const c=O(i);c==null||c.t.delete(r)}return}return s}),ue=[e,t,n,o,u,f,a,w,g,v,_,h,b,A,R,U,D,W,z,O],J={get:r=>x(R(r)),set:(r,...d)=>{try{return D(r,...d)}finally{A(),b()}},sub:(r,d)=>{const s=z(r).l;return s.add(d),b(),()=>{s.delete(d),O(r),b()}}};return Object.defineProperty(J,ve,{value:ue}),J},ie=he,_e=ae,ee=re,X={};let Se=0;function Te(e,t){const n=`atom${++Se}`,o={toString(){return(X?"production":void 0)!=="production"&&this.debugLabel?n+":"+this.debugLabel:n}};return typeof e=="function"?o.read=e:(o.init=e,o.read=we,o.write=ye),t&&(o.write=t),o}function we(e){return e(this)}function ye(e,t,n){return t(this,typeof n=="function"?n(e(this)):n)}const ge=()=>{let e=0;const t=_e({}),n=new WeakMap,o=new WeakMap,u=ie(n,o,void 0,void 0,void 0,void 0,t,void 0,(w,g,v,..._)=>e?v(w,..._):w.write(g,v,..._)),f=new Set;return t.m.add(void 0,w=>{f.add(w);const g=n.get(w);g.m=o.get(w)}),t.u.add(void 0,w=>{f.delete(w);const g=n.get(w);delete g.m}),Object.assign(u,{dev4_get_internal_weak_map:()=>(console.log("Deprecated: Use devstore from the devtools library"),n),dev4_get_mounted_atoms:()=>f,dev4_restore_atoms:w=>{const g={read:()=>null,write:(v,_)=>{++e;try{for(const[y,h]of w)"init"in y&&_(y,h)}finally{--e}}};u.set(g)}})};function se(){return(X?"production":void 0)!=="production"?ge():ie()}let I;function pe(){return I||(I=se(),(X?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const be={},ce=P.createContext(void 0);function le(e){return P.useContext(ce)||pe()}function De({children:e,store:t}){const n=P.useRef(void 0);return!t&&!n.current&&(n.current=se()),P.createElement(ce.Provider,{value:t||n.current},e)}const F=e=>typeof(e==null?void 0:e.then)=="function",Q=e=>{e.status||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}))},Ee=ne.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Q(e),e)}),q=new WeakMap,te=(e,t)=>{let n=q.get(e);return n||(n=new Promise((o,u)=>{let f=e;const a=v=>_=>{f===v&&o(_)},w=v=>_=>{f===v&&u(_)},g=()=>{try{const v=t();F(v)?(q.set(v,n),f=v,v.then(a(v),w(v)),ee(v,g)):o(v)}catch(v){u(v)}};e.then(a(e),w(e)),ee(e,g)}),q.set(e,n)),n};function Ae(e,t){const{delay:n,unstable_promiseStatus:o=!ne.use}={},u=le(),[[f,a,w],g]=P.useReducer(_=>{const y=u.get(e);return Object.is(_[0],y)&&_[1]===u&&_[2]===e?_:[y,u,e]},void 0,()=>[u.get(e),u,e]);let v=f;if((a!==u||w!==e)&&(g(),v=u.get(e)),P.useEffect(()=>{const _=u.sub(e,()=>{if(o)try{const y=u.get(e);F(y)&&Q(te(y,()=>u.get(e)))}catch{}if(typeof n=="number"){setTimeout(g,n);return}g()});return g(),_},[u,e,n,o]),P.useDebugValue(v),F(v)){const _=te(v,()=>u.get(e));return o&&Q(_),Ee(_)}return v}function Pe(e,t){const n=le();return P.useCallback((...u)=>{if((be?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return n.set(e,...u)},[n,e])}function Ie(e,t){return[Ae(e),Pe(e)]}export{De as P,Te as a,Ie as b,Pe as c,Ae as u};
