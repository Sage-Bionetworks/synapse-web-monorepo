import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{R as l,d as L,M as V,b as B}from"./index-7Z2-YRMp.js";import{p as J}from"./pluralize-CVwSCrA2.js";import{R as Q,r as i}from"./index-Dl6G-zuu.js";import{V as W}from"./SynapseClient-Dzk5gF_R.js";import"./OrientationBanner-D9RUUnWX.js";import"./RegularExpressions-D6yUxzx6.js";import"./getEndpoint-CjoHA800.js";import{f as z,g as X,h as K}from"./useAccessRequirements-BT-M5y99.js";import{E as Z}from"./EntitySubjectsSelector-Dkla2e-s.js";import{T as ee}from"./TeamSubjectsSelector-y9gsl6oS.js";import{R as te}from"./RadioGroup-AMpK4AOs.js";import{C as se}from"./Checkbox-C63vyfGV.js";import{S as E}from"./Skeleton-1jrlRaLC.js";import{T as x}from"./TextField-CM8oUPj4.js";import{A as _}from"./Alert-Aa0bm5Nm.js";import{T as b}from"./Typography-DgBbIcOX.js";import{S as re}from"./Stack-D3AEdRlD.js";import{T as ne}from"./Tooltip-Drr3vXNI.js";import{H as oe}from"./IconSvg-lIXrpHNP.js";const ae="Please select at least one resource for this Access Requirement to be associated with.",g=c=>{const f=c===l.ENTITY?"Synapse":"Team",T=c[0].toUpperCase()+c.slice(1).toLowerCase();return`${f} IDs were specified but not added to the subjects list. Please either clear out the Add ${f} IDs textbox or click the Add ${J(T)} button.`},ie="Enter access requirement name. This will also be used when sending notifications for expiring or revoked approval. For example, 'The approval for the name access requirement was revoked...'",y={variant:"body1",fontWeight:700};function ce(c){switch(c){case l.ENTITY:return B.DOWNLOAD;case l.TEAM:return B.PARTICIPATE;default:throw new Error(`RestrictableObjectType ${c} does not have an access type specified.`)}}const Y=Q.forwardRef(function(f,T){const{subject:n,accessRequirementId:C,onSave:k,onError:h}=f,d=!n,[u,j]=i.useState(n?[n]:[]),[A,G]=i.useState(!1),[I,m]=i.useState(null),[S,N]=i.useState(""),[o,q]=i.useState(!1),[R,w]=i.useState((n==null?void 0:n.type)===l.TEAM?L:V),[v,U]=i.useState(null),M=t=>{U(null),k(t.id.toString(),t.concreteType)},D=t=>{U(t.reason),h()},{mutate:F}=z({onSuccess:t=>M(t),onError:t=>D(t)}),{mutate:O}=X({onSuccess:t=>M(t),onError:t=>D(t)}),{data:s,isLoading:H,error:P}=K(C,{enabled:!!C});i.useEffect(()=>{s&&(w(s.concreteType),N(s.name),j(s.subjectIds),q(s.subjectsDefinedByAnnotations))},[s]);const a=i.useMemo(()=>{if(n)return n.type;if(s){const t=s.subjectIds;if(t.length>0)return t[0].type}return o?l.ENTITY:null},[n,s,o]),$=i.useMemo(()=>{if(!a)return e.jsx(e.Fragment,{});function t(r){m(null),j(r)}function p(r){m(null),G(r.trim()!=="")}if(o)return e.jsx(e.Fragment,{});switch(a){case l.TEAM:return e.jsx(ee,{subjects:u,onUpdate:r=>t(r),onUpdateTeamIDsTextbox:r=>p(r)});case l.ENTITY:return e.jsx(Z,{subjects:u,onUpdate:r=>t(r),onUpdateEntityIDsTextbox:r=>p(r)});default:return console.error(`RestrictableObjectType ${a} does not have a selector implemented.`),e.jsx(e.Fragment,{})}},[a,u,o]);return i.useImperativeHandle(T,()=>({save(){const t=d&&!s||!a,p=!o&&(A||u.length===0);if(t||p){p&&!t&&(A?m(g(a)):u.length===0&&m(ae)),h();return}const r=ce(a);d||F({concreteType:R,subjectIds:u,name:S,accessType:r,subjectsDefinedByAnnotations:o}),d&&s&&O({...s,subjectIds:u,name:S,accessType:r,subjectsDefinedByAnnotations:o})}}),[A,a,u,S,R,s,d,h,F,O,o]),H||!a?e.jsxs(e.Fragment,{children:[e.jsx(E,{width:100,height:30}),e.jsx(E,{width:125,height:30}),e.jsx(E,{width:"100%",children:e.jsx(x,{})}),e.jsx(E,{width:100,height:30}),e.jsx(E,{width:"100%",children:e.jsx(x,{})})]}):P?e.jsx(_,{severity:"error",children:P.reason}):e.jsxs(e.Fragment,{children:[e.jsx(b,{...y,children:"Resources"}),a!==l.TEAM&&e.jsx(e.Fragment,{children:e.jsx(se,{label:"Associated entities should be defined by annotations (DUO)",checked:o,onChange:()=>{m(null);let t=[];o&&(s?t=s.subjectIds:n&&(t=[n])),j(t),q(!o)}})}),e.jsx(W,{children:$}),I&&e.jsx(_,{severity:"error",children:I}),e.jsxs(re,{direction:"row",gap:1,alignItems:"center",mb:1,mt:2,children:[e.jsx(b,{component:"label",htmlFor:"arName",...y,children:"Name"}),e.jsx(ne,{title:ie,placement:"right",children:e.jsx(oe,{sx:{color:"grey.600"}})})]}),e.jsx(x,{id:"arName",name:"arName",value:S,placeholder:"Access requirement name",fullWidth:!0,onChange:t=>N(t.target.value)}),!d&&a!==l.TEAM&&e.jsxs(e.Fragment,{children:[e.jsx(b,{...y,mt:2,children:"Access requirement type"}),e.jsx(te,{value:R,options:[{label:"Controlled - requests are in Synapse",value:V},{label:"Click wrap",value:L}],onChange:t=>w(t)})]}),v&&e.jsx(_,{severity:"error",sx:{marginTop:2},children:v})]})});try{g.displayName="UNSAVED_SUBJECTS_ERROR_MESSAGE",g.__docgenInfo={description:"",displayName:"UNSAVED_SUBJECTS_ERROR_MESSAGE",props:{}}}catch{}try{Y.displayName="SetAccessRequirementCommonFields",Y.__docgenInfo={description:"",displayName:"SetAccessRequirementCommonFields",props:{subject:{defaultValue:null,description:"",name:"subject",required:!1,type:{name:"RestrictableObjectDescriptor"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(accessRequirementId: string, accessRequirementConreteType: ACCESS_REQUIREMENT_CONCRETE_TYPE) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{Y as S};
