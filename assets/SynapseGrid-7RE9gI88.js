import{j0 as xd,j1 as Gi,da as Se,r as P,h0 as Ad,j2 as Nd,j3 as Rd,j4 as Id,ih as Hi,j,B as fl,an as Ge,aI as me,J as oe,c1 as Td,j5 as jd,j6 as Pd,hk as Md,j7 as qd,aH as hl,dc as Bd,j8 as Vd,dj as Jd,d0 as Ld,j9 as Dd,ja as Fd,bB as We,c3 as Ud,el as M,hZ as Gd,cv as zi,c9 as ye,c6 as Hd,ay as zd,ag as Wd}from"./iframe-DOA--ypP.js";import"./ErrorPage-BBfFebNt.js";import"./AccessTokenPage-gjeT8ppK.js";import"./AccountLevelBadges-DhlXk1qK.js";import"./CardContainerLogic-BNxOb3Uo.js";import"./RowDataTable-BUVcxJOW.js";import"./RowDataTableWithQuery-Zg_QTdO_.js";import"./MarkdownPopover-ByIhHE6X.js";import"./SkeletonButton-SLwBY3oR.js";import"./SkeletonInlineBlock-BSyES9P5.js";import{S as Kd}from"./SkeletonTable-BN8TQIoy.js";import"./SkeletonParagraph-CKHoRTTC.js";import"./CertificationAnswer-CWJATQly.js";import"./ChallengeDetailPage-CFJPgjRC.js";import"./index-DCUlvDuc.js";import"./AvailableEvaluationQueueList-BpQASSLh.js";import"./ChallengeSubmission-Dxu3PDPx.js";import"./ChangePassword-DSN-hefk.js";import"./ChangePasswordWithToken-CMY435_N.js";import"./ConfirmationDialog-Bx9ardy9.js";import"./CookiesNotification-D_ztccHL.js";import"./DownloadCartPage-ea32Yg8c.js";import"./ShowDownloadV2-8HtXNzJl.js";import"./DynamicForm-CmlUKPvA.js";import"./EntityBadgeIcons-Dq8B67Qd.js";import"./EntityFinder-CeIpEWmL.js";import"./EvaluationCard-BjhrR-Te.js";import"./EvaluationEditorPage-DUfE2rtf.js";import"./ExperimentalMode-0HxLanWD.js";import"./FileUpload-BowO54ZC.js";import"./FeaturedDataTabs-DnOk3zNL.js";import"./FeaturedToolsList-D8egawii.js";import"./DiscussionThread-BjycRdhI.js";import"./ForumPage-CC3rBt5L.js";import"./SynapseCardLabel-BCZ3f4l2.js";import"./GenericCard-Bxm3cq17.js";import"./HeaderCardV2-CtyyajiP.js";import"./CardUtils-hew8-ko-.js";import"./Goals-B6gCoHp-.js";import"./GoalsV2-Dz4VMVWl.js";import"./GoogleMap-DvJKvskc.js";import"./HasAccessV2-DQDL6lGk.js";import"./Icon-Z5S_ktPW.js";import"./MarkdownCollapse-DQDMuefa.js";import"./MarkdownEditor-CoYR2Hz6.js";import"./MarkdownGithub-jhZnfArb.js";import"./ModalDownload-BFF_r8TP.js";import"./InfiniteTableLayout-D2CmyVM_.js";import"./CopyToClipboardInput-nP8oMj1-.js";import"./DialogBase-COBCl3WL.js";import"./WarningDialog-PsVMDigs.js";import"./ColumnHeader-BTvi5gga.js";import"./StyledTanStackTable-Cm2IsY7-.js";import"./OAuthAclEditorModal-Beib8Eiu.js";import"./ThemesPlot-w5Mz8kB_.js";import"./UpsetPlot-DsFLDL6C.js";import"./SynapsePlot-CTZKa0Bv.js";import"./Programs-DT6TLZrq.js";import"./ProvenanceGraph-BXaNWv6J.js";import"./ProjectDataAvailability-CelEmXCo.js";import"./QueryContext-qzUpp5gp.js";import"./QueryCount-D6-g5f20.js";import"./QueryWrapper-CLX_EWRy.js";import"./RegisterPageLogoutPrompt-BAm8GC0d.js";import"./RenderIfInView-D1__stnQ.js";import"./Resources-DYJuu1wU.js";import"./AccessRequirementAclEditor-CrRKgKRy.js";import"./RssFeedCards-DR0f7tk7.js";import"./ShowMore-iWFBEXZA.js";import"./LightTooltip-Cp9tv2pP.js";import"./WideButton-Cv758Dog.js";import"./InputSizedButton-Cx8gTY6g.js";import"./DropdownSelect-hgE0a43l.js";import"./SubscriptionItem-mrLTTTDv.js";import"./SubsectionRowRenderer-BI3VNDfo.js";import"./SynapseFormWrapper-CjPa_41m.js";import"./SynapseFormSubmissionGrid-BRfG_ACQ.js";import"./SynapseTable-C6RReV8O.js";import{u as Yd,S as Xd,a as Qd}from"./SynapseChat-Dwpe8Vwr.js";import"./TableFeedCards-C9b7HDsW.js";import"./TermsAndConditions-DKgBH9dU.js";import"./UserBadge-B-bcdv8r.js";import"./UserCardListRotate-Dee2_2FT.js";import"./UserCardListGroups-DMwi-lXK.js";import"./UserOrTeamBadge-DcHJpLF_.js";import"./UserProfileLinks-C8QOfHgG.js";import"./EntityHeaderTable-C8S0iutJ.js";import"./AccessRequirementRelatedProjectsList-D7bROI4F.js";import"./HelpPopover-CQR-J_g5.js";import"./SageResourcesPopover-DFGKXm8Y.js";import"./RecentPublicationsGrid-BqDRHlkW.js";import"./ImageCardGridWithLinks-Bw2cKr5F.js";import"./PortalFeatureHighlights-6nkhnPP-.js";import"./CreatePortalModal-edkD3JW4.js";import"./PortalSectionHeader-StT-fMgx.js";import{C as Zd}from"./CsvPreviewDialog-Bnc5RBle.js";import{w as xr}from"./waitForAsyncResult-CukCkTkm.js";import{u as $d}from"./upperFirst-DXFyXPvl.js";import{u as Ar,k as ef}from"./useEntity-CbdSqMq0.js";import{D as tf}from"./DownloadTwoTone-BGj2EBP-.js";import{b as Wi}from"./useSchema-CrR7_2-L.js";import{G as nf,p as rf,r as sf,D as of}from"./DataGrid-B1tisidr.js";import{e as cf}from"./useUserBundle-CMLYFODb.js";import{B as Ki,P as af}from"./enums-BcOReSNy.js";import{a as uf,d as ce}from"./index-Chi_LkuB.js";import{g as lf}from"./_baseIteratee-DP1eEInn.js";import{t as df}from"./useUploadFiles-rRUM-rWm.js";import{D as ff}from"./DraggableDialog-DIrjZ3j4.js";import{K as Yi}from"./KeyboardArrowDown-UTflxSjp.js";import{M as sr}from"./MenuItem-BXWiBucH.js";import{u as hf,a as pf,b as mf,c as bf}from"./useGridSession-Bu6udqJJ.js";import{A as gf}from"./Autocomplete-SZgF-wnv.js";import{G as $}from"./Grid-37fxI_NR.js";import{C as yf}from"./CertificationRequirement-D2b-twZ8.js";var Lr=function(){return xd.Date.now()},vf="Expected a function",wf=Math.max,_f=Math.min;function Cf(e,t,d){var a,n,u,r,c,s,o=0,i=!1,f=!1,m=!0;if(typeof e!="function")throw new TypeError(vf);t=Gi(t)||0,Se(d)&&(i=!!d.leading,f="maxWait"in d,u=f?wf(Gi(d.maxWait)||0,t):u,m="trailing"in d?!!d.trailing:m);function p(C){var O=a,k=n;return a=n=void 0,o=C,r=e.apply(k,O),r}function w(C){return o=C,c=setTimeout(l,t),i?p(C):r}function g(C){var O=C-s,k=C-o,S=t-O;return f?_f(S,u-k):S}function b(C){var O=C-s,k=C-o;return s===void 0||O>=t||O<0||f&&k>=u}function l(){var C=Lr();if(b(C))return h(C);c=setTimeout(l,g(C))}function h(C){return c=void 0,m&&a?p(C):(a=n=void 0,r)}function v(){c!==void 0&&clearTimeout(c),o=0,a=s=n=c=void 0}function y(){return c===void 0?r:h(Lr())}function _(){var C=Lr(),O=b(C);if(a=arguments,n=this,s=C,O){if(c===void 0)return w(s);if(f)return clearTimeout(c),c=setTimeout(l,t),p(s)}return c===void 0&&(c=setTimeout(l,t)),r}return _.cancel=v,_.flush=y,_}var Sf="Expected a function";function Of(e,t,d){var a=!0,n=!0;if(typeof e!="function")throw new TypeError(Sf);return Se(d)&&(a="leading"in d?!1:a,n="trailing"in d?!0:n),Cf(e,t,{leading:a,maxWait:t,trailing:n})}function Ef(e=!1){const t=P.useRef(e),d=P.useCallback(()=>t.current,[]);return P.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),d}function kf(e){P.useEffect(()=>{e()},[])}function xf(e,...t){const d=Ef(),a=Ad(t[1]),n=P.useMemo(()=>function(...u){d()&&(typeof a.current=="function"?a.current.apply(this,u):typeof a.current.handleEvent=="function"&&a.current.handleEvent.apply(this,u))},[]);P.useEffect(()=>{const u=Af(e)?e.current:e;if(!u)return;const r=t.slice(2);return Nd(u,t[0],n,...r),()=>{Rd(u,t[0],n,...r)}},[e,t[0]])}function Af(e){return e!==null&&typeof e=="object"&&Id(e,"current")}const Dr=()=>document.visibilityState==="visible";function Nf(e=!0){const[t,d]=P.useState(Hi&&e?Dr():void 0);return kf(()=>{e||d(Dr())}),xf(Hi?document:null,"visibilitychange",()=>{d(Dr())}),t}const Rf="_button_185qd_17",If={button:Rf};function Oe(e){return j.jsx(fl,{...e,className:If.button})}try{Oe.displayName="GridMenuButton",Oe.__docgenInfo={description:"",displayName:"GridMenuButton",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function Tf(e){const{synapseClient:t}=Ge();return me({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridImportCsvAsyncStart({gridCsvImportRequest:d});return(await xr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function pi({createdCount:e=0,updatedCount:t=0}){let d="";return e>0&&(d+=`created ${e.toLocaleString()} rows`),e>0&&t>0?d+=" and ":t==0&&(d+="."),t>0&&(d+=`updated ${t.toLocaleString()} rows.`),$d(d)}function mi(e){const{gridSessionId:t,open:d,onClose:a,onComplete:n}=e,{mutate:u,isPending:r,error:c}=Tf({onSuccess:s=>{oe(pi(s),"success",{title:"Data imported successfully"}),n()}});return j.jsx(Zd,{open:d,onClose:a,onConfirm:(s,o,i)=>{u({concreteType:"org.sagebionetworks.repo.model.grid.GridCsvImportRequest",sessionId:t,fileHandleId:s,csvDescriptor:i,schema:o})},errorMessage:c?.message,confirmIsPending:r})}try{pi.displayName="getUpdateMessage",pi.__docgenInfo={description:"",displayName:"getUpdateMessage",props:{concreteType:{defaultValue:null,description:"@memberof GridCsvImportResponse",name:"concreteType",required:!0,type:{name:"{string}"}},sessionId:{defaultValue:null,description:`The grid session ID.
@memberof GridCsvImportResponse`,name:"sessionId",required:!1,type:{name:"{string}"}},totalCount:{defaultValue:null,description:`The total number of processed rows.
@memberof GridCsvImportResponse`,name:"totalCount",required:!1,type:{name:"{number}"}},createdCount:{defaultValue:{value:"0"},description:`The number of newly created rows in the grid.
@memberof GridCsvImportResponse`,name:"createdCount",required:!1,type:{name:"{number}"}},updatedCount:{defaultValue:{value:"0"},description:`The number of updated rows in the grid.
@memberof GridCsvImportResponse`,name:"updatedCount",required:!1,type:{name:"{number}"}}}}}catch{}try{mi.displayName="UploadCsvToGridDialog",mi.__docgenInfo={description:"",displayName:"UploadCsvToGridDialog",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onComplete:{defaultValue:null,description:"",name:"onComplete",required:!0,type:{name:"() => void"}}}}}catch{}function bi(e){const{sourceEntityId:t,gridSessionId:d}=e,[a,n]=P.useState(!1),{data:u,isLoading:r}=Ar(t);return r?j.jsx(Td,{variant:"rectangular",width:100}):u&&!jd(u)?null:j.jsxs(j.Fragment,{children:[a&&j.jsx(mi,{gridSessionId:d,open:a,onClose:()=>n(!1),onComplete:()=>n(!1)}),j.jsx(Oe,{onClick:()=>{n(!0)},variant:"outlined",startIcon:j.jsx(Pd,{}),children:"Upload"})]})}try{bi.displayName="UploadCsvToGridButton",bi.__docgenInfo={description:"",displayName:"UploadCsvToGridButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}function pl(e){const{synapseClient:t}=Ge();return me({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:d});return(await xr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function jf(e){const{gridSessionId:t,filename:d}=e,{accessToken:a}=Ge(),{mutate:n,isPending:u}=pl({onSuccess:c=>{c?.resultsFileHandleId&&Md(c.resultsFileHandleId,a).then(s=>fetch(s).then(o=>o.blob()).then(o=>{const i=URL.createObjectURL(o),f=document.createElement("a");f.href=i;const m=new Date().toISOString().replace(/[:.]/g,"-");f.setAttribute("download",`${d}-${m}.csv`),document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(i),oe("CSV export completed successfully","success")})).catch(s=>{oe(`Failed to download CSV: ${s instanceof Error?s.message:"Unknown error"}`,"danger")})},onError:c=>{oe(`CSV export failed: ${c.reason||"Unknown error"}`,"danger")}});return{exportToCsv:()=>{n({sessionId:t,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"})},isExporting:u}}function gi(e){const{gridSessionId:t,filename:d}=e,{exportToCsv:a,isExporting:n}=jf({gridSessionId:t,filename:d});return j.jsx(Oe,{onClick:a,variant:"outlined",startIcon:j.jsx(tf,{}),loading:n,children:"Export CSV"})}try{gi.displayName="ExportCsvFromGridButton",gi.__docgenInfo={description:"",displayName:"ExportCsvFromGridButton",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},filename:{defaultValue:null,description:"",name:"filename",required:!0,type:{name:"string"}}}}}catch{}const Pf=Object.prototype;function ir(e){for(const t in e)if(Pf.hasOwnProperty.call(e,t))return!1;return!0}const Mf=["array","boolean","integer","null","number","object","string"];new Set(Mf);const qf=["$defs","definitions","properties","patternProperties","dependencies"];new Set(qf);const Bf=["items","allOf","oneOf","anyOf"];new Set(Bf);const Vf=["items","additionalItems","additionalProperties","propertyNames","contains","if","then","else","not"];new Set(Vf);function Or(e){return typeof e=="object"}function pe(e){return Or(e)?ir(e):e===!0}function ze(e,t){return e<t?-1:e>t?1:0}function Fr(e,t){const d=e.length;if(d===0)return t;let a=t.length;if(a===0)return e;if(d<a){const u=e;e=t,t=u,a=d}const n=new Set(e);for(let u=0;u<a;u++)n.add(t[u]);return Array.from(n)}function Jf(e,t){const d=[];if(e.length===0||t.length===0)return d;if(e.length>t.length){const n=e;e=t,t=n}const a=new Set(t);for(let n=0;n<e.length&&a.size>0;n++){const u=e[n];a.delete(u)&&d.push(u)}return d}function Xi(e){return e.length===0}function Ur(e){return(t,d)=>{const a=t.length-d.length;if(a!==0)return a;for(let n=0;n<t.length;n++)if(t[n]!==d[n]){const u=e(t[n],d[n]);if(u!==0)return u}return 0}}function ml(e,{threshold:t=12}={}){return d=>{const a=d.length;if(a===0)return d;if(a<=t){const r=[];let c=0;e:for(let s=0;s<a;s++){const o=d[s];for(let i=0;i<c;i++)if(e(o,r[i])===0)continue e;c=r.push(o)}return r}const n=d.slice().sort(e);let u=0;for(let r=1;r<a;r++)e(n[u],n[r])!==0&&++u!==r&&(n[u]=n[r]);return n.length=u+1,n}}function Lf(e){return(t,d)=>{const a=[];let n=t.length,u=d.length;if(n===0||u===0)return a;if(n>u){const i=t;t=d,d=i;const f=n;n=u,u=f}const r=[...t].sort(e),c=[...d].sort(e);let s=0,o=0;for(;s<n&&o<u;){const i=e(r[s],c[o]);i===0?((a.length===0||e(a[a.length-1],r[s])!==0)&&a.push(r[s]),s++,o++):i<0?s++:o++}return a}}function Df(e,t){return d=>{if(e.has(d))return e.get(d);const a=t(d);return e.set(d,a),a}}const Qi=Df,bl=()=>0,Ff=e=>e===void 0,Uf=e=>typeof e!="object",Zi={boolean:0,number:1,string:2};function Gf(e,t){const d=typeof e,a=typeof t;return d===a?ze(e,t):Zi[d]-Zi[a]}function Hf(e,t){const d=e.length;if(d===0)return t;const a=t.length;if(a===0)return e;if(a>d){const r=e;e=t,t=r}const n=new Set(e),u=t.length;for(let r=0;r<u;r++){const c=t[r];n.has(c)||e.push(c)}return e}function Nr(e,t,d=bl){return(a,n)=>e(a)?e(n)?d(a,n):-1:e(n)?1:t(a,n)}function He(e){return Nr(Ff,e)}function Ce(e,t){return Nr(d=>d===void 0||e(d),t)}function Gr(e,t){return Nr(Array.isArray,e,t)}const X=He(ze),Hr=Ce(e=>e===0,(e,t)=>e-t);function zf({deduplicationCache:e=new WeakMap,sortedKeysCache:t=new WeakMap}={}){const d=Qi(t,g=>Object.keys(g).sort());function a(g){return(b,l)=>{const h=d(b),v=d(l),y=Math.min(h.length,v.length);for(let _=0;_<y;_++){const C=ze(h[_],v[_]);if(C!==0)return C}if(h.length!==v.length)return h.length-v.length;for(let _=0;_<y;_++){const C=h[_],O=g(b[C],l[C]);if(O!==0)return O}return 0}}function n(g){const b=Ur(g),l=Qi(e,ml(g,{threshold:0}));return(h,v)=>b(l(h),l(v))}const u=n(ze);function r(g,b){if(Or(g)){if(Or(b)){const l=Object.keys(g),h=Object.keys(b),v=Hf(l,h),y=v.length;for(let _=0;_<y;_++){const C=v[_];if(g[C]===b[C])continue;const k=(w[C]??c)(g[C],b[C]);if(k!==0)return k}return 0}return b===!0&&ir(g)?0:1}return Or(b)?g===!0&&ir(b)?0:-1:ze(g,b)}const c=He(o),s=Nr(Uf,Gr(a(c),Ur(o)),Gf);function o(g,b){return g===null?-1:b===null?1:s(g,b)}const i=He(r),f=Ce(ir,a(i)),m=He(n(r)),p=Ce(pe,r),w={$id:X,$comment:X,$defs:f,$ref:X,$schema:X,const:c,contains:i,contentEncoding:X,contentMediaType:X,default:c,definitions:f,description:X,else:i,examples:c,exclusiveMaximum:X,exclusiveMinimum:X,format:X,if:i,maximum:X,maxItems:X,maxLength:X,maxProperties:X,minimum:X,multipleOf:X,not:i,pattern:X,propertyNames:i,readOnly:X,then:i,title:X,writeOnly:X,uniqueItems:Ce(g=>g===!1,bl),minLength:Hr,minItems:Hr,minProperties:Hr,required:Ce(Xi,u),enum:Ce(Xi,n(o)),type:He((g,b)=>{const l=Array.isArray(g),h=Array.isArray(b);return!l&&!h?ze(g,b):u(l?g:[g],h?b:[b])}),items:Ce(g=>!Array.isArray(g)&&pe(g),Gr(r,Ur(r))),anyOf:m,allOf:m,oneOf:m,properties:f,patternProperties:f,additionalProperties:p,additionalItems:p,dependencies:Ce(ir,a(He(Gr(r,u))))};return{compareSchemaValues:o,compareSchemaDefinitions:r}}function $i(e){return e}const gl=(e,t)=>e?gl(t%e,e):t,Wf=(e,t)=>Math.abs(e*t)/gl(e,t);function Kf(e,t){return e===t?e:`^(?=.*(?:${e}))(?=.*(?:${t})).*$`}function*zr(e,t,d){const a=e.length,n=t.length;if(a>0&&n>0)for(let u=0;u<a;u++){const r=e[u];for(let c=0;c<n;c++)yield d(r,t[c])}}function Wr(e,t){return e||t}function eo(e){return(t,d)=>{const a={...t},n=Object.keys(d),u=n.length;for(let r=0;r<u;r++){const c=n[r];a[c]=t[c]===void 0?d[c]:e(t[c],d[c])}return a}}function Yf(e){const t=new Map;for(const d of e)for(const a of d[0])t.set(a,d[1]);return t}function Ne(e,t,d){d===void 0||pe(d)?delete e[t]:e[t]=d}const Xf=["properties","patternProperties","additionalProperties"];function to(e){const t=Object.keys(e),d=t.length,a=[];for(let n=0;n<d;n++){const u=t[n];a.push({regExp:new RegExp(u),schema:e[u]})}return[a,t]}const no=[[],[]];function ro(e,t,d){const a=d.length;for(let n=0;n<a;n++){const u=d[n];if(!u.regExp.test(t))continue;const r=u.schema;if(r===!1)return!0;e.push(r)}return!1}const Qf=["items","additionalItems"],Zf=["if","then","else"];function so(e,t){return t.if!==void 0&&(e.if=t.if),t.then!==void 0&&(e.then=t.then),t.else!==void 0&&(e.else=t.else),e}function Kr(e,t){if(e===t)return e;switch(e){case"number":if(t==="integer")return"integer";case"integer":if(t==="number")return"integer";default:return}}function Re(e,t,d){return[e,t,d]}function $f(e){const t=new Map;for(const[d,a,n]of e){const u=r=>{if(!n(r))throw new Error(`Schema keys '${d}' and '${a}' are conflicting (${d}: ${JSON.stringify(r[d])}, ${a}: ${JSON.stringify(r[a])})`)};for(const r of[[d,a],[a,d]]){let c=t.get(r[0]);c===void 0&&(c=[],t.set(r[0],c)),c.push({oppositeKey:r[1],check:u})}}return t}const eh=[Re("minimum","maximum",e=>e.maximum>=e.minimum),Re("exclusiveMinimum","maximum",e=>e.maximum>e.exclusiveMinimum),Re("minimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.minimum),Re("exclusiveMinimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.exclusiveMinimum),Re("minLength","maxLength",e=>e.maxLength>=e.minLength),Re("minItems","maxItems",e=>e.maxItems>=e.minItems),Re("minProperties","maxProperties",e=>e.maxProperties>=e.minProperties)];function th({mergePatterns:e=Kf,isSubRegExp:t=Object.is,intersectJson:d=Jf,deduplicateJsonSchemaDef:a=$i,defaultMerger:n=$i,assigners:u=[],checks:r=eh,mergers:c}={}){function s(y){const _=y.length;let C=y[0];for(let O=1;O<_;O++){const k=l(C,y[O]);if(k===!1)return!1;pe(k)||(C=k)}return C}function o(y,_,C,O,k,S,E){if(y.length=0,C===!1)return!1;if(y.push(C),k!==void 0){if(k===!1)return!1;y.push(k)}if(ro(y,_,S))return!1;const A=y.length<2;if(E===!1){if(A)return;if(ro(y,_,O))return!1}else A&&E!==void 0&&y.push(E);return y.length===1?y[0]:s(y)}function i(y,_,C,O,k,S){const E=C.length;if(E>0&&k!==!1)if(S)Object.assign(y,_);else for(let x=0;x<E;x++){const A=C[x];O.has(A)||(y[A]=l(_[A],k))}return y}const f=(y,{properties:_={},patternProperties:C,additionalProperties:O=!0},{properties:k={},patternProperties:S,additionalProperties:E=!0})=>{const x=pe(O),A=pe(E);if(x&&A)return Ne(y,"properties",h(_,k)),Ne(y,"patternProperties",C&&S?h(C,S):C??S),delete y.additionalProperties,y;const N=l(O,E);Ne(y,"additionalProperties",N);const I={},R=Object.keys(_),T=R.length,[q,B]=C?to(C):no,[J,D]=S?to(S):no,U=[],V=new Set,re=A?void 0:E;for(let W=0;W<T;W++){const Z=R[W];V.add(Z);const te=o(U,Z,_[Z],q,k[Z],J,re);te!==void 0&&(I[Z]=te)}const ie=Object.keys(k),be=ie.length,_e=x?void 0:O;for(let W=0;W<be;W++){const Z=ie[W];if(V.has(Z))continue;const te=o(U,Z,k[Z],J,void 0,q,_e);te!==void 0&&(I[Z]=te)}Ne(y,"properties",I);let G={};const z=new Set;if(B.length>0&&D.length>0){const W=zr(B,D,(Z,te)=>{t(Z,te)&&z.add(Z),t(te,Z)&&z.add(te),G[e(Z,te)]=l(C[Z],S[te])});for(;!W.next().done;);}return G=i(G,C,B,z,E,A),G=i(G,S,D,z,O,x),Ne(y,"patternProperties",G),y},m=(y,{items:_=[],additionalItems:C},{items:O=[],additionalItems:k})=>{const S=Array.isArray(_),E=Array.isArray(O),x=[];if(y.items=x,S&&E){const[A,N,I]=_.length<O.length?[_.length,C,O]:[O.length,k,_];let R=0;for(;R<A;R++)x.push(l(_[R],O[R]));if(N===!1)y.additionalItems=!1;else{const T=N===void 0||pe(N);for(;R<I.length;R++)x.push(T?I[R]:l(I[R],N));Ne(y,"additionalItems",C!==void 0&&k!==void 0?l(C,k):C??k)}}else if(S||E){const[A,N,I]=S?[_,O,C]:[O,_,k];Ne(y,"additionalItems",I&&l(I,N));for(let R=0;R<A.length;R++)x.push(l(A[R],N))}else delete y.additionalItems,y.items=l(_,O);return y},p=(y,_,C)=>{so(y,_);const O=so({},C);return y.allOf===void 0?y.allOf=[O]:y.allOf=y.allOf.concat(O),y};function w(y,_){return a(Array.from(zr(y,_,l)))}const g=Yf([[Xf,f],[Qf,m],[Zf,p],...u]),b=$f(r);function l(y,_){if(y===!1||_===!1)return!1;if(pe(y))return pe(_)?!0:_;if(pe(_))return y;let C={...y};const O=new Set,k=new Set,S=Object.keys(_),E=S.length;for(let x=0;x<E;x++){const A=S[x],N=_[A];if(N===void 0)continue;const I=b.get(A);if(I!==void 0){const B=I.length;for(let J=0;J<B;J++){const D=I[J];y[D.oppositeKey]!==void 0&&k.add(D.check)}}const R=y[A];if(R===void 0){C[A]=N;continue}const T=g.get(A);if(T){O.add(T);continue}const q=v[A]??n;C[A]=q(R,N)}for(const x of O)C=x(C,y,_);for(const x of k)x(C);return C}const h=eo(l),v={$id:n,$ref:n,$schema:n,$comment:n,$defs:h,definitions:h,type:(y,_)=>{if(y===_)return y;const C=Array.isArray(y),O=Array.isArray(_);if(!C&&!O){const k=Kr(y,_);if(k!==void 0)return k}else if(C||O){const k=new Set;if(C&&O)for(const E of zr(y,_,Kr))E!==void 0&&k.add(E);else{const E=C?y:_,x=C?_:y,A=E.length;for(let N=0;N<A;N++){const I=Kr(x,E[N]);I!==void 0&&k.add(I)}}const S=k.size;if(S===1)return k.values().next().value;if(S>1)return Array.from(k)}throw new Error(`It is not possible to create an intersection of the following incompatible types: ${y.toString()}, ${_.toString()}`)},default:n,description:n,title:n,const:n,format:n,contentEncoding:n,contentMediaType:n,not:(y,_)=>{const C=a([y,_]);return C.length===1?C[0]:{anyOf:C}},pattern:e,readOnly:Wr,writeOnly:Wr,enum:(y,_)=>{const C=d(y,_);if(C.length===0)throw new Error(`Intersection of the following enums is empty: "${JSON.stringify(y)}", "${JSON.stringify(_)}"`);return C},anyOf:w,oneOf:w,allOf:(y,_)=>a(y.concat(_)),propertyNames:l,contains:l,dependencies:eo((y,_)=>Array.isArray(y)?Array.isArray(_)?Fr(y,_):l(_,{required:y}):Array.isArray(_)?l(y,{required:_}):l(y,_)),examples:(y,_)=>{if(!Array.isArray(y)||!Array.isArray(_))throw new Error(`Value of the 'examples' field should be an array, but got "${JSON.stringify(y)}" and "${JSON.stringify(_)}"`);return Fr(y,_)},multipleOf:(y,_)=>{let C=1;for(;!Number.isInteger(y)||!Number.isInteger(_);)C*=10,y*=10,_*=10;return Wf(y,_)/C},exclusiveMaximum:Math.min,maximum:Math.min,maxItems:Math.min,maxLength:Math.min,maxProperties:Math.min,exclusiveMinimum:Math.max,minimum:Math.max,minItems:Math.max,minLength:Math.max,minProperties:Math.max,uniqueItems:Wr,required:Fr,...c};return{mergeSchemaDefinitions:l,mergeArrayOfSchemaDefinitions:s}}function nh(e){const t=[],d=[e];for(;d.length>0;){const a=d.pop();if(typeof a=="boolean"||a.allOf===void 0){t.push(a);continue}const{allOf:n,...u}=a;t.push(u);for(let r=n.length-1;r>=0;r--)d.push(n[r])}return t}function rh(e){return t=>e(nh(t))}const{compareSchemaDefinitions:sh,compareSchemaValues:ih}=zf(),{mergeArrayOfSchemaDefinitions:oh}=th({intersectJson:Lf(ih),deduplicateJsonSchemaDef:ml(sh)}),ch=rh(oh),ah=["id","createdBy","createdOn","modifiedBy","modifiedOn","etag","concreteType","parentId","path","type","currentVersion","benefactorId"];function uh(e){if(!e.properties)return e;const t={...e.properties};return ah.forEach(a=>{t[a]?t[a]={...Se(t[a])?t[a]:{},readOnly:!0}:t[a]={readOnly:!0}}),{...e,properties:t}}function lh(e){const{data:t}=Wi(e?.gridJsonSchema$Id??"",{enabled:!!e?.gridJsonSchema$Id}),{data:d}=Ar(e?.sourceEntityId,void 0,{enabled:!!e?.sourceEntityId});let a=!1;d&&qd(d)&&(a=!0);const{data:n}=Wi("org.sagebionetworks-repo.model.Entity",{enabled:a,select:uh});return P.useMemo(()=>t&&n?ch({allOf:[n,t]}):t,[t,n])}function dh(e){const{keyFactory:t,synapseClient:d}=Ge(),a=hl();return me({...e,mutationFn:async n=>{const u=await d.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:n.entityId,tableUpdateTransactionRequest:n});return(await xr(()=>d.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:u.token}))).responseBody},onSuccess:async(n,u,r)=>{await Bd(a,t,u.entityId)}})}function fh(e){const t=hl(),{mutateAsync:d}=pl(),{mutateAsync:a}=dh(),n=ef();return me({...e,mutationFn:async({gridSessionId:u,sourceEntityId:r})=>{const c=await t.fetchQuery(n(r)),s={...hh(c),sessionId:u},o=await d(s),i={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:r,changes:[{uploadFileHandleId:o.resultsFileHandleId,tableId:r,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return a(i)}})}function hh(e){return Vd(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}function ph(e){const{synapseClient:t}=Ge();return me({...e,mutationFn:async({gridSessionId:d})=>{const a={sessionId:d,concreteType:"org.sagebionetworks.repo.model.grid.GridRecordSetExportRequest"},n=await t.gridServicesClient.postRepoV1GridExportRecordsetAsyncStart({gridRecordSetExportRequest:a});return(await xr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:n.token}))).responseBody}})}function mh(e){const t=fh(),d=ph();return me({...e,mutationFn:async({gridSessionId:a,sourceEntityId:n,sourceEntityType:u})=>u===Jd.recordset?{type:"recordset",data:await d.mutateAsync({gridSessionId:a})}:{type:"table",data:await t.mutateAsync({gridSessionId:a,sourceEntityId:n})}})}function yi(e){const{sourceEntityId:t,gridSessionId:d}=e,{data:a,isLoading:n}=Ar(t),u=a?.concreteType?Ld(a.concreteType):void 0,{mutate:r,isPending:c}=mh({onSuccess:s=>{s.type==="table"?bh(s.data):oe("Successfully updated RecordSet.","success")},onError:s=>oe(s.message,"danger")});return j.jsx(Oe,{loading:c,disabled:n,onClick:()=>r({gridSessionId:d,sourceEntityId:t,sourceEntityType:u}),variant:"contained",children:"Apply changes"})}function bh(e){if(e.results?.length){const t=e.results[0];if(Dd(t)){const d=gh(t).join(`
`);d?oe(`Some changes could not be applied:
${d}`,"danger"):oe("Changes applied successfully","success")}else if(Fd(t)){const d=t.rowsProcessed?.toLocaleString();oe(`Successfully updated ${d} rows.`,"success")}}}function gh(e){return e.updateResults?.filter(t=>!!t.failureCode).map(t=>`${t.entityId}: ${t.failureMessage} (code: ${t.failureCode})`)??[]}try{yi.displayName="MergeGridWithSourceTableButton",yi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},sourceEntityType:{defaultValue:null,description:"",name:"sourceEntityType",required:!1,type:{name:"enum",value:[{value:'"link"'},{value:'"table"'},{value:'"file"'},{value:'"folder"'},{value:'"entityview"'},{value:'"submissionview"'},{value:'"dataset"'},{value:'"datasetcollection"'},{value:'"project"'},{value:'"dockerrepo"'},{value:'"materializedview"'},{value:'"virtualtable"'},{value:'"recordset"'}]}}}}}catch{}function yh(e,t){const d={},a=t.api.getSnapshot();if(io(a.rows,e.min.row,e.max.row))d.rowSelectAll=!0;else{const n=t.api.arr(["rows"]);d.rowSelection=oo(n,e.min.row,e.max.row)}if(io(a.columnOrder,e.min.col,e.max.col))d.columnSelectAll=!0;else{const n=t.api.arr(["columnOrder"]);d.columnSelection=oo(n,e.min.col,e.max.col)}return d}function io(e,t,d){return t===0&&d===e.length-1}function oo(e,t,d){const a=[];for(let n=t;n<=d;n++){const u=e.node.findChunk(n);if(u){const[r,c]=u;a.push({rep:r.id.sid,seq:r.id.time+c})}else console.warn(`getCrdtIdsForArrayRange: No chunk found for array index ${n}. This may indicate an unexpected state.`)}return a}function vh(e,t){let d;try{d=e.api.con(["rows",String(t),"metadata","rowValidation"])}catch{return!1}const a=d?.node?.id;try{const n=e.api.vec(["rows",String(t),"data"]);for(let u=0;u<n?.length();u++)if(n.get(u).asCon().node.id.time>a?.time)return!1}catch{}return!0}function wh(e){return`[${e.sid},${e.time}]`}function _h(e){const t=new Map,d=/^#(?:\/([^/:]+)(?:\/\d+)?)?:\s*(.*)$/;for(const a of e){if(typeof a!="string")continue;const u=a.trimStart().match(d);if(u){let r=u[1]?.trim()??"_row";const c=u[2].trim();if(r==="_row"){const s=c.match(/^required key \[([^\]]+)\] not found$/i);s&&(r=s[1])}t.has(r)||t.set(r,[]),t.get(r).push(c)}}return t}function Ch(e,t){if(!e||!t)return[];const{columnNames:d,columnOrder:a,rows:n}=t;return n.map((r,c)=>{const s={};return a.forEach(o=>{const i=d[o];i&&(s[i]=r.data[o])}),s[nf]=wh(e.api.obj(["rows",String(c)]).node.id),s.__validationResults=r.metadata?.rowValidation,s.__validationResults&&(s.__validationStatus=s.__validationResults?.isValid?"valid":"invalid"),vh(e,c)||(s.__validationStatus="pending"),s.__validationResults?.allValidationMessages&&(s.__cellValidationResults=_h(s.__validationResults.allValidationMessages)),s})}function Sh(e){return Se(e)&&"type"in e&&(e.type=="null"||Ud(e.type,["null"]))}function yl(e){if(e?.oneOf&&We(e.oneOf)){const t=e.oneOf.filter(d=>!Sh(d));if(t.length==1&&Se(t[0]))return t[0]}}function Oh(e){return{value:e.value}}function Eh(e){return We(e)&&e.every(t=>Se(t)&&"const"in t)}function co(e){let t=[];if(e.type==="boolean")return[{value:!0},{value:!1}];try{if(e?.oneOf&&We(e.oneOf)&&!Eh(e.oneOf)){const d=yl(e);d&&Object.hasOwn(d,"enum")&&(t=Ki(d)||[])}else t=Ki(e)||[]}catch(d){console.error("Error getting enumerated values from schema",d,e)}return t.map(Oh)}function kh(e,t){return lf(e,[af,t],{})}function xh(e){if(!e||!Se(e))return[];const t=new Set,d=new Set;function a(n){if(!(!Se(n)||d.has(n))){if(d.add(n),We(n.required))for(const u of n.required)typeof u=="string"&&t.add(u);["allOf"].forEach(u=>{const r=n[u];We(r)&&r.forEach(c=>a(c))})}}return a(e),Array.from(t)}const ao={type:"string",isArray:!1};function vi(e){const t={...ao};if(e.format&&(t.format=e.format),e.readOnly&&(t.readOnly=e.readOnly),e.type){if(e.type==="array"&&e.items){const d=Array.isArray(e.items)?e.items[0]:e.items,a=vi(d)??ao;return{...t,...a,isArray:!0}}return{...t,type:e.type}}if(e?.oneOf&&We(e.oneOf)){const d=yl(e);if(d)return vi(d)}return t}function Ah(e){if(!e)return{};const t=xh(e),d={};return e.properties&&Object.keys(e.properties).forEach(a=>{const n=kh(e,a),u=vi(n);let r=co(n).map(c=>c.value);if(r.length===0&&n&&n.items){const c=Array.isArray(n.items)?n.items[0]:n.items;r=co(c).map(s=>s.value)}d[a]={type:u,isRequired:t.includes(a),enumeratedValues:r.length>0?r:null}}),d}var Yr={};const L=uf(df);var Ze={},$e={},uo;function cr(){if(uo)return $e;uo=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.context=void 0;const e=M();return $e.context=e.createContext(null),$e}var Xr={},lo;function ee(){return lo||(lo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useStyles=e.context=void 0;const t=M();e.context=t.createContext({});const d=()=>t.useContext(e.context);e.useStyles=d})(Xr)),Xr}var Qr={},Zr={},$r={},es={},fo;function Nh(){return fo||(fo=1,Object.defineProperty(es,"__esModule",{value:!0})),es}var le={},ho;function Rh(){if(ho)return le;ho=1,Object.defineProperty(le,"__esModule",{value:!0}),le.COLOR=le.SYMBOL=le.ZINDEX=le.SIZE=void 0;var e;(function(n){n[n.SITE_WIDTH=1300]="SITE_WIDTH",n[n.SITE_PADDING=32]="SITE_PADDING",n[n.PAGE_WIDTH=1e3]="PAGE_WIDTH",n[n.TOP_NAV_HEIGHT=64]="TOP_NAV_HEIGHT",n[n.SIDEBAR_WIDTH=300]="SIDEBAR_WIDTH"})(e||(le.SIZE=e={}));var t;(function(n){n[n.TOP_NAV=1e3]="TOP_NAV",n[n.SIDEBAR=1001]="SIDEBAR",n[n.CONTEXT=1002]="CONTEXT",n[n.PROGRESS=2e3]="PROGRESS",n[n.MODAL=4e3]="MODAL",n[n.CURSOR=1e6]="CURSOR"})(t||(le.ZINDEX=t={}));var d;(function(n){n.CHECKMARK="✓",n.CROSS="✗",n.NIL="∅",n.ELLIPSIS="…",n.MDASH="—",n.NDASH="–",n.FDASH="‒",n.CTRL="⌃",n.CMD="⌘",n.ALT="⌥",n.SHIFT="⇧"})(d||(le.SYMBOL=d={}));var a;return(function(n){n.LINK="#0089ff"})(a||(le.COLOR=a={})),le}var ts={},ns={},po;function mo(){if(po)return ns;po=1;var e=/[A-Z]/g,t=function(d){for(var a=5381,n=d.length;n;)a=a*33^d.charCodeAt(--n);return"_"+(a>>>0).toString(36)};return ns.create=function(d){d=d||{};var a=d.assign||Object.assign,n=typeof window=="object",u=a({raw:"",pfx:"_",client:n,assign:a,stringify:JSON.stringify,kebab:function(r){return r.replace(e,"-$&").toLowerCase()},decl:function(r,c){return r=u.kebab(r),r+":"+c+";"},hash:function(r){return t(u.stringify(r))},selector:function(r,c){return r+(c[0]===":"?"":" ")+c},putRaw:function(r){u.raw+=r}},d);return u.client&&(u.sh||document.head.appendChild(u.sh=document.createElement("style")),u.putRaw=function(r){{var c=u.sh.sheet;try{c.insertRule(r,c.cssRules.length)}catch{}}}),u.put=function(r,c,s){var o="",i,f,m=[];for(i in c)f=c[i],f instanceof Object&&!(f instanceof Array)?m.push(i):o+=u.decl(i,f,r,s);o&&(o=r+"{"+o+"}",u.putRaw(s?s+"{"+o+"}":o));for(var p=0;p<m.length;p++)i=m[p],i[0]==="@"&&i!=="@font-face"?u.putAt(r,c[i],i):u.put(u.selector(r,i),c[i],s)},u.putAt=u.put,u},ns}var rs={},bo;function Ih(){return bo||(bo=1,rs.addon=function(e){var t={};e.cache=function(d){if(!d)return"";var a=e.hash(d);return t[a]||(t[a]=e.rule(d,a)),t[a]}}),rs}var ss={},is,go;function Th(){if(go)return is;go=1;var e=Object.keys,t=JSON.stringify;function d(a,n){var u,r,c,s,o,i,f;if(f=typeof a,f==="string")return t(a);if(a===!0)return"true";if(a===!1)return"false";if(a===null)return"null";if(a instanceof Array){for(c="[",r=a.length-1,u=0;u<r;u++)c+=d(a[u],!1)+",";return r>-1&&(c+=d(a[u],!1)),c+"]"}if(a instanceof Object){if(typeof a.toJSON=="function")return d(a.toJSON(),n);for(s=e(a).sort(),r=s.length,c="",u=0;u<r;)o=s[u],i=d(a[o],!0),i!==void 0&&(u&&c!==""&&(c+=","),c+=t(o)+":"+i),u++;return"{"+c+"}"}switch(f){case"function":case"undefined":return n?void 0:null;default:return isFinite(a)?a:null}}return is=function(a){return""+d(a,!1)},is}var yo;function jh(){if(yo)return ss;yo=1;var e=Th();return ss.addon=function(t){t.stringify=e},ss}var os={},vo;function Ph(){return vo||(vo=1,os.addon=function(e){e.selector=function(t,d){var a=t.split(","),n=[],u=d.split(","),r=a.length,c=u.length,s,o,i,f,m,p;for(s=0;s<c;s++)if(i=u[s],f=i.indexOf("&"),f>-1)for(o=0;o<r;o++)m=a[o],p=i.replace(/&/g,m),n.push(p);else for(o=0;o<r;o++)m=a[o],m?n.push(m+" "+i):n.push(i);return n.join(",")}}),os}var mr={},wo;function Mh(){if(wo)return mr;wo=1;var e="position",t="top",d="right",a="bottom",n="left",u="width",r="height",c="overflow",s="color",o="content",i=c+"-x",f=c+"-y",m="flex",p=m+"-direction",w=m+"-grow",g=m+"-shrink",b=m+"-basis",l=m+"-wrap",h="align",v=h+"-items",y=h+"-"+o,_=h+"-self",C="margin",O=C+"-"+t,k=C+"-"+d,S=C+"-"+a,E=C+"-"+n,x="padding",A=x+"-"+t,N=x+"-"+d,I=x+"-"+a,R=x+"-"+n,T="border",q=T+"-"+t,B=T+"-"+d,J=T+"-"+a,D=T+"-"+n,U=T+"-radius",V="background",re=V+"-"+s,ie=V+"-image",be=V+"-repeat",_e=V+"-attachment",G=V+"-position",z=V+"-size",W=V+"-origin",Z=V+"-clip",te="style",Xe="font",fd=Xe+"-size",hd=Xe+"-"+te,pd=Xe+"-weight",md=Xe+"-family",Qe="text",bd=Qe+"-align",gd=Qe+"-decoration",yd=Qe+"-transform",vd=Qe+"-shadow",wd=Qe+"-overflow",Jr="stroke",_d=Jr+"-width",Cd=Jr+"-linecap",Ae="animation",Sd=Ae+"-name",Od=mr.atoms={pos:e,t,r:d,b:a,l:n,z:"z-index",d:"display",vis:"visibility",w:u,h:r,minW:"min-"+u,maxW:"max-"+u,minH:"min-"+r,maxH:"max-"+r,ov:c,ovx:i,ovy:f,bxz:"box-sizing",cl:"clip",clp:"clip-path",clr:"clear",tbl:"table-layout",fl:m,fld:p,flg:w,fls:g,flb:b,flw:l,jc:"justify-"+o,ai:v,ac:y,as:_,mr:C,mrt:O,mrr:k,mrb:S,mrl:E,mar:C,mart:O,marr:k,marb:S,marl:E,pd:x,pdt:A,pdr:N,pdb:I,pdl:R,pad:x,padt:A,padr:N,padb:I,padl:R,bd:T,bdt:q,bdr:B,bdb:J,bdl:D,bdrad:U,bdc:T+"-"+s,bds:T+"-"+te,out:"outline",bxsh:"box-shadow",col:s,op:"opacity",bg:V,bgc:re,bgi:ie,bgr:be,bga:_e,bgp:G,bgs:z,bgo:W,bgcl:Z,bdfl:"backdrop-filter",bfvis:"backface-visibility",f:Xe,fz:fd,fs:hd,fw:pd,ff:md,ta:bd,td:gd,tt:yd,ts:vd,tov:wd,ww:"word-wrap",lts:"letter-spacing",ws:"white-space",lh:"line-"+r,va:"vertical-"+h,cur:"cursor",pe:"pointer-events",us:"user-select",an:Ae,ann:Sd,and:Ae+"-duration",anf:Ae+"-fill-mode",anit:Ae+"-iteration-count",anp:Ae+"-play-state",ant:Ae+"-timing-function",trs:"transition",tr:"transform",st:Jr,stw:_d,stl:Cd,ls:"list-"+te,con:o};return mr.addon=function(Fi){var Ed=Fi.decl;Fi.decl=function(Ui,kd){return Ed(Od[Ui]||Ui,kd)}},mr}var cs={},_o;function qh(){return _o||(_o=1,cs.addon=function(e){e.rule=function(t,d){return d=d||e.hash(t),d=e.pfx+d,e.put("."+d,t)," "+d}}),cs}var as={},Co;function Bh(){return Co||(Co=1,as.addon=function(e){e.drule=function(t,d){var a=e.rule(t,d),n=function(u){if(!u)return a;var r=e.cache(u);return a+r};return n.toString=function(){return a},n}}),as}var us={},So;function Vh(){return So||(So=1,us.addon=function(e,t){t=e.assign({prefixes:["-webkit-","-moz-","-o-",""]},t||{});var d=t.prefixes;e.client&&document.head.appendChild(e.ksh=document.createElement("style"));var a=e.putAt;e.putAt=function(n,u,r){if(r[1]==="k"){var c="";for(var s in u){var o=u[s],i="";for(var f in o)i+=e.decl(f,o[f]);c+=s+"{"+i+"}"}for(var m=0;m<d.length;m++){var p=d[m],w=r.replace("@keyframes","@"+p+"keyframes")+"{"+c+"}";e.client?e.ksh.appendChild(document.createTextNode(w)):e.putRaw(w)}return}a(n,u,r)},e.keyframes=function(n,u){return u||(u=e.hash(n)),u=e.pfx+u,e.putAt("",n,"@keyframes "+u),u}}),us}var ls={},Oo;function Jh(){return Oo||(Oo=1,ls.addon=function(e){var t={html:{lineHeight:1.15,"-webkit-text-size-adjust":"100%"},body:{margin:0},h1:{fontSize:"2em",margin:"0.67em 0"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp":{fontFamily:"monospace, monospace",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:1.15,margin:0},"button,input":{overflow:"visible"},"button,select":{textTransform:"none"},fieldset:{padding:"0.35em 0.75em 0.625em"},legend:{boxSizing:"border-box",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{verticalAlign:"baseline"},summary:{display:"list-item"}};e.put("",t)}),ls}var ds={},Eo;function Lh(){return Eo||(Eo=1,ds.addon=function(e){e.put("",{"html, body":{fontFamily:'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif',fontWeight:400,fontSize:"16px","-moz-text-size-adjust":"100%","-ms-text-size-adjust":"100%","-webkit-text-size-adjust":"100%","text-size-adjust":"100%","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"}})}),ds}var fs={},ko;function Dh(){if(ko)return fs;ko=1;function e(t,d,a){var n="?family="+encodeURIComponent(t);return d&&(d instanceof Array||(d=[d]),n+=":"+d.join(",")),a&&(a instanceof Array||(a=[a]),n+="&subset="+a.join(",")),"https://fonts.googleapis.com/css"+n}return fs.addon=function(t){t.client?t.googleFont=function(d,a,n){var u=document.createElement("link");u.href=e(d,a,n),u.rel="stylesheet",u.type="text/css",document.head.appendChild(u)}:t.googleFont=function(d,a,n){t.putRaw("@import url('"+e(d,a,n)+"');")}},fs}var xo;function vl(){return xo||(xo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nano=e.googleFont=e.keyframes=e.drule=e.rule=e.put=e.reset=void 0;const t=L,d=mo(),a=Ih(),n=jh(),u=Ph(),r=Mh(),c=qh(),s=Bh(),o=Vh(),i=Jh(),f=Lh(),m=Dh();t.__exportStar(mo(),e);const p=(0,d.create)({pfx:"nano-css"});e.nano=p,(0,a.addon)(p),(0,n.addon)(p),(0,u.addon)(p),(0,r.addon)(p),(0,c.addon)(p),(0,s.addon)(p),(0,o.addon)(p),(0,m.addon)(p);const w=()=>{(0,i.addon)(p),(0,f.addon)(p)};e.reset=w,e.put=p.put,e.rule=p.rule,e.drule=p.drule,e.keyframes=p.keyframes,e.googleFont=p.googleFont})(ts)),ts}var hs={},Ao;function Fh(){return Ao||(Ao=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.m4=e.m3=e.m2=e.m1=e.b4=e.b3=e.b2=e.b1=void 0,e.b1=520,e.b2=960,e.b3=1300,e.b4=1800,e.m1=`@media (max-width:${e.b1}px)`,e.m2=`@media (max-width:${e.b2}px)`,e.m3=`@media (max-width:${e.b3}px)`,e.m4=`@media (max-width:${e.b4}px)`})(hs)),hs}var et={},No;function wl(){if(No)return et;No=1,Object.defineProperty(et,"__esModule",{value:!0}),et.font=void 0;const e='"Open Sans",sans-serif',t='"Merriweather","Linux Libertine"',d='"Roboto Slab"',a='Ubuntu,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Cantarell,"Open Sans","Helvetica Neue",sans-serif',n='-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,"Apple Color Emoji",Arial,sans-serif,"Segoe UI Emoji","Segoe UI Symbol",'+a,u="Roboto,sans-serif,"+n;return et.font={sans:{lite:{fw:300,ff:e},mid:{fw:400,ff:e},bold:{fw:700,ff:e},black:{fw:800,ff:e}},serif:{lite:{fw:300,ff:t},mid:{fw:400,ff:t},bold:{fw:700,ff:t},black:{fw:700,ff:t}},slab:{lite:{fw:300,ff:d},mid:{fw:400,ff:d},bold:{fw:700,ff:d},black:{fw:800,ff:d}},mono:{mid:{fw:300,ff:'"Menlo","DejaVu Sans Mono","Roboto Mono","Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'},bold:{fw:400,ff:'"Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'}},ui1:{lite:{fw:300,ff:a},mid:{fw:400,ff:a},bold:{fw:700,ff:a},black:{fw:800,ff:a}},ui2:{lite:{fw:300,ff:n},mid:{fw:400,ff:n},bold:{fw:700,ff:n},black:{fw:800,ff:n}},ui3:{lite:{fw:300,ff:u},mid:{fw:400,ff:u},bold:{fw:700,ff:u},black:{fw:800,ff:u}}},et}var ps={},ms={},tt={},Ro;function Uh(){if(Ro)return tt;Ro=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.hash=void 0;const e=t=>{let d=5381,a=t.length;for(;a;)d=d*33^t.charCodeAt(--a);return d>>>0};return tt.hash=e,tt}var Io;function _l(){return Io||(Io=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toColor=e.color=void 0,e.color=["#FFC312","#F79F1F","#EE5A24","#EA2027","#C4E538","#A3CB38","#009432","#006266","#12CBC4","#1289A7","#0652DD","#1B1464","#9980FA","#ED4C67","#B53471","#833471","#6F1E51","#e27d60","#85dcbb","#e8a87c","#c38d9e","#41b3a3","#242582","#553d67","#f64c72","#99738e","#2f2fa2","#05386b","#fc4445","#3feee6","#55bcc9","#8ee4af","#5cdb95","#907163","#379683","#84ceeb","#5ab9ea","#8860d0","#75b5d8","#a64ac9","#fccd04","#17e9e0","#61892f","#86c232","#222629","#474b4f","#6b6e70","#eadb02","#46344e","#5a5560","#fa72a1","#e64398","#f78888","#1FB6FF","#13CE66","#FF4949","#FFC82C","#76266C","#8C2E5E","#5B2971","#9B344E","#4D2B73","#AA4139","#432F75","#AA5D38","#702D0C","#3C1200","#353377","#FE8C00","#FE7301","#FE4301","#FE0100","#E5013B","#CC0174","#A0048C","#560DAB","#252AAC","#0A6BA1","#09A471","#9DED05"];const t=Uh(),d=a=>e.color[(0,t.hash)(a)%e.color.length];e.toColor=d})(ms)),ms}var To;function xi(){return To||(To=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.theme=e.lightTheme=void 0;const t=_l(),d=wl(),a=(r,c=1)=>{const s=Math.round(255*r);return`rgba(${s},${s},${s},${c})`},n=[0,4,8,16,24,32,64,128,256,512],u=[10,12,14,16,20,24,32,48,64,96,128];e.lightTheme={isLight:!0,name:"light",bg:"#fff",color:{color:t.color,sem:{accent:["#07f","#1340EB","#07ACEB"],blue:["#07f","#1340EB","#07ACEB"],positive:["#13CE66","#16BA32","#38D420"],negative:["#FF4949","#EB4C31","#DB521A"],warning:["#FFC82C","#EBC715","#DBCC00"],link:["#0089ff","#134EEB","#07BBEB"],brand:["#E44A28","#985DF7","#EE69B1","#F6A832","#5FCC8A","#58B9F8"]},ui:{lightLine:a(.1,.04),line:a(.1,.08),lineDark:a(.1,.16)}},font:d.font,green:r=>`rgba(19,206,102,${r})`,red:r=>`rgba(225,20,10,${r})`,blue:r=>`rgba(40,160,222,${r})`,fontSize:(r=0)=>u[Math.min(Math.max(r+3,0),u.length-1)],space:(r=0)=>n[Math.min(Math.max(r+3,0),n.length-1)],g:a},e.theme=e.lightTheme})(ps)),ps}var nt={},jo;function Cl(){if(jo)return nt;jo=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.darkTheme=void 0;const e=xi(),t=(d,a=1)=>{const n=255-Math.round(255*d);return`rgba(${n},${n},${n},${a})`};return nt.darkTheme=Object.assign(Object.assign({},e.lightTheme),{isLight:!1,name:"dark",bg:"#101921",color:Object.assign(Object.assign({},e.lightTheme.color),{ui:{lightLine:t(.1,.04),line:t(.1,.08),lineDark:t(.1,.16)}}),g:t}),nt}var bs={},br={},se={},Po;function Sl(){if(Po)return se;Po=1,Object.defineProperty(se,"__esModule",{value:!0}),se.isNavigator=se.isBrowser=se.off=se.on=se.noop=void 0;var e=function(){};se.noop=e;function t(a){for(var n=[],u=1;u<arguments.length;u++)n[u-1]=arguments[u];a&&a.addEventListener&&a.addEventListener.apply(a,n)}se.on=t;function d(a){for(var n=[],u=1;u<arguments.length;u++)n[u-1]=arguments[u];a&&a.removeEventListener&&a.removeEventListener.apply(a,n)}return se.off=d,se.isBrowser=typeof window<"u",se.isNavigator=typeof navigator<"u",se}var Mo;function Gh(){if(Mo)return br;Mo=1,Object.defineProperty(br,"__esModule",{value:!0});var e=M(),t=Sl(),d=t.isBrowser?e.useLayoutEffect:e.useEffect;return br.default=d,br}var qo;function Hh(){return qo||(qo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalCss=e.makeRule=e.useRule=e.useTheme=e.Provider=void 0;const t=M(),d=xi(),a=Cl(),n=vl(),u=t.createContext(d.lightTheme);e.Provider=t.memo(({theme:f,children:m})=>{const p=f==="light"?d.lightTheme:a.darkTheme;return t.createElement(u.Provider,{value:p},m)});const r=()=>t.useContext(u);e.useTheme=r;const c=f=>{const m=(0,e.useTheme)(),p=f(m);return n.nano.cache(p)};e.useRule=c;const s=f=>()=>(0,e.useRule)(f);e.makeRule=s;const o=Gh(),i=()=>{const f=(0,e.useTheme)();return(0,o.default)(()=>{document.body.style.background=f.bg,document.body.style.color=f.g(.05,.85)},[f]),null};e.GlobalCss=i})(bs)),bs}var Bo;function Y(){return Bo||(Bo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Nh(),e),t.__exportStar(Rh(),e),t.__exportStar(vl(),e),t.__exportStar(Fh(),e),t.__exportStar(wl(),e),t.__exportStar(xi(),e),t.__exportStar(Cl(),e),t.__exportStar(Hh(),e),t.__exportStar(_l(),e)})($r)),$r}var Vo;function Q(){return Vo||(Vo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bottomRightActionPos=e.tooltip=e.insArrButton=e.insArrLine=e.insArrDot=e.insArrBlock=e.bracketHovered=e.collapsed=e.collapser=e.bracket=e.lineInner=e.line=e.list=e.colon=e.inputActive=e.input=e.property=e.quote=e.ValueColor=e.object=e.block=e.negative=e.blue=void 0;const t=Y();e.blue=t.theme.color.sem.blue[0],e.negative=t.theme.color.sem.negative[0],e.block=(0,t.rule)({d:"inline-block",ff:"monospace",col:t.theme.g(.1)}),e.object=(0,t.rule)({pos:"relative",d:"inline-block"}),e.ValueColor={nil:[t.theme.g(0,.4),t.darkTheme.g(0,.4)],undef:[t.theme.g(0,.2),t.darkTheme.g(0,.2)],str:["#e00e44","#f01e54"],bool:["#411888","#9168c8"],num:["#0a8F3F","#0FaF4F"],zero:["#748A00","#94AA11"],float:["#016873","#51a8b3"]},e.quote=(0,t.rule)({col:"#E84D3D"}),e.property=(0,t.rule)({pad:"0",fw:"bold",bxz:"border-box",va:"top"});const d={col:t.theme.g(0),pd:"5px",bg:t.theme.bg,bd:`1px solid ${t.theme.g(.7)}`,mr:"-6px",out:0};e.input=(0,t.rule)({z:2,pos:"relative",bd:0,mar:0,pad:0,bg:"transparent",bdrad:"5px",d:"inline-block",minW:"auto",w:"auto","&::selection":{col:"#fff",bgc:e.blue},input:{out:0}}),e.inputActive=(0,t.rule)(d),e.colon=(0,t.rule)({pd:"0 8px 0 0px",cur:"default",va:"top","&>span":{pd:"0 2px"},"&:hover":{"&>span":{out:`1px dotted ${e.blue}`}}}),e.list=(0,t.rule)({d:"block",listStyleType:"none",pd:0,mr:"0 0 0 32px"}),e.line=(0,t.rule)({d:"block",ls:"none",pd:0,mr:0}),e.lineInner=(0,t.rule)({d:"inline-block"}),e.bracket=(0,t.rule)({pos:"relative",cur:"default"}),e.collapser=(0,t.rule)({pd:"0 6px",pos:"absolute",t:"0px",l:"-24px",cur:"default",us:"none"}),e.collapsed=(0,t.rule)({col:e.blue,cur:"default",fw:"bold",bg:t.theme.blue(.1),pd:"2px",mr:"-2px",bdrad:"4px"}),e.bracketHovered=(0,t.rule)({out:`1px dotted ${e.blue}`}),e.insArrBlock=(0,t.rule)({pos:"relative",h:"0px",w:"0px"}),e.insArrDot=(0,t.rule)({pos:"absolute",t:"0px",l:"-4px",w:"3px",h:"3px",bdrad:"50%",bg:e.blue,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{top:"-2px",left:"2px",w:"7px",h:"7px"}}),e.insArrLine=(0,t.rule)({pos:"absolute",t:"1px",l:"-56px",w:"50px",h:"0px",bdt:`1px dotted ${e.blue}`,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{l:"-56px",w:"56px",bdt:`1px solid ${e.blue}`}}),e.insArrButton=(0,t.rule)({pos:"absolute",d:"block",t:"-8px",l:"-75px"}),e.tooltip=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.ui1),{pos:"absolute",d:"none",t:"-2.5em",l:"0px",bg:"rgba(0,0,0,.8)",col:"#fff",fz:12/13.4+"em",pad:".4em .8em",bdrad:".4em",z:3,pe:"none",us:"none",ws:"nowrap"})),e.bottomRightActionPos=(0,t.rule)({d:"inline-block",pos:"absolute",r:"-6px",b:"-9px",z:2})})(Zr)),Zr}var rt={},gs={},ys={},Jo;function zh(){return Jo||(Jo=1,Object.defineProperty(ys,"__esModule",{value:!0})),ys}var vs={},Lo;function Ai(){return Lo||(Lo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=u,e.escapeComponent=r,e.parseJsonPointer=c,e.formatJsonPointer=s,e.isChild=i,e.isPathEqual=f,e.parent=p,e.isValidIndex=w;const t=/~1/g,d=/~0/g,a=/~/g,n=/\//g;function u(b){return b.indexOf("~")===-1?b:b.replace(t,"/").replace(d,"~")}function r(b){return b.indexOf("/")===-1&&b.indexOf("~")===-1?b:b.replace(a,"~0").replace(n,"~1")}function c(b){return b?b.slice(1).split("/").map(u):[]}function s(b){return(0,e.isRoot)(b)?"":"/"+b.map(l=>r(String(l))).join("/")}const o=b=>typeof b=="string"?c(b):b;e.toPath=o;function i(b,l){if(b.length>=l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}function f(b,l){if(b.length!==l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}const m=b=>!b.length;e.isRoot=m;function p(b){if(b.length<1)throw new Error("NO_PARENT");return b.slice(0,b.length-1)}function w(b){if(typeof b=="number")return!0;const l=Number.parseInt(b,10);return String(l)===b&&l>=0}const g=b=>{const l=b.length;let h=0,v;for(;h<l;){if(v=b.charCodeAt(h),v>=48&&v<=57){h++;continue}return!1}return!0};e.isInteger=g})(vs)),vs}var ws={},Do;function Wh(){return Do||(Do=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const t=n=>{if(typeof n=="string"){if(n){if(n[0]!=="/")throw new Error("POINTER_INVALID");if(n.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(n)};e.validateJsonPointer=t;const{isArray:d}=Array,a=n=>{if(!d(n))throw new Error("Invalid path.");if(n.length>256)throw new Error("Path too long.");for(const u of n)switch(typeof u){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=a})(ws)),ws}var st={},it={},Fo;function Ni(){if(Fo)return it;Fo=1,Object.defineProperty(it,"__esModule",{value:!0}),it.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function t(d,a){return e.call(d,a)}return it.hasOwnProperty=t,it}var Uo;function Ol(){if(Uo)return st;Uo=1,Object.defineProperty(st,"__esModule",{value:!0}),st.get=void 0;const e=Ni(),t=(d,a)=>{const n=a.length;let u;if(!n)return d;for(let r=0;r<n;r++)if(u=a[r],d instanceof Array){if(typeof u!="number"){if(u==="-")return;const c=~~u;if(""+c!==u)return;u=c}d=d[u]}else if(typeof d=="object"){if(!d||!(0,e.hasOwnProperty)(d,u))return;d=d[u]}else return;return d};return st.get=t,st}var de={},Go;function Kh(){if(Go)return de;Go=1,Object.defineProperty(de,"__esModule",{value:!0}),de.isObjectReference=de.isArrayEnd=de.isArrayReference=de.find=void 0;const e=Ni(),{isArray:t}=Array,d=(r,c)=>{const s=c.length;if(!s)return{val:r};let o,i;for(let m=0;m<s;m++)if(o=r,i=c[m],t(o)){const p=o.length;if(i==="-")i=p;else if(typeof i=="string"){const w=~~i;if(""+w!==i)throw new Error("INVALID_INDEX");if(i=w,i<0)throw new Error("INVALID_INDEX")}r=o[i]}else if(typeof o=="object"&&o)r=(0,e.hasOwnProperty)(o,i)?o[i]:void 0;else throw new Error("NOT_FOUND");return{val:r,obj:o,key:i}};de.find=d;const a=r=>t(r.obj)&&typeof r.key=="number";de.isArrayReference=a;const n=r=>r.obj.length===r.key;de.isArrayEnd=n;const u=r=>typeof r.obj=="object"&&typeof r.key=="string";return de.isObjectReference=u,de}var _s={},ot={},Ho;function Yh(){if(Ho)return ot;Ho=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.findByPointer=void 0;const e=Ni(),t=Ai(),{isArray:d}=Array,a=(n,u)=>{if(!n)return{val:u};let r,c,s=0,o=1;for(;s>-1;)if(s=n.indexOf("/",o),c=s>-1?n.substring(o,s):n.substring(o),o=s+1,r=u,d(r)){const i=r.length;if(c==="-")c=i;else{const f=~~c;if(""+f!==c)throw new Error("INVALID_INDEX");if(c=f,c<0)throw"INVALID_INDEX"}u=r[c]}else if(typeof r=="object"&&r)c=(0,t.unescapeComponent)(c),u=(0,e.hasOwnProperty)(r,c)?r[c]:void 0;else throw"NOT_FOUND";return{val:u,obj:r,key:c}};return ot.findByPointer=a,ot}var zo;function Xh(){return zo||(zo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(Yh(),e)})(_s)),_s}var Wo;function Rr(){return Wo||(Wo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(zh(),e),t.__exportStar(Ai(),e),t.__exportStar(Wh(),e),t.__exportStar(Ol(),e),t.__exportStar(Kh(),e),t.__exportStar(Xh(),e)})(gs)),gs}var ct={},at={},Ko;function Qh(){if(Ko)return at;Ko=1,Object.defineProperty(at,"__esModule",{value:!0}),at.copyStyles=void 0;const e=(t,d,a)=>{const n=window.getComputedStyle(t);if(n)for(const u of a)d.style[u]=n[u]};return at.copyStyles=e,at}var Yo;function ar(){if(Yo)return ct;Yo=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.FlexibleInput=void 0;const e=M(),t=Y(),d=Qh(),a=(0,t.rule)({d:"inline-block",pos:"relative"}),n=(0,t.rule)({d:"inline-block",va:"bottom",bxz:"border-box",ov:"hidden",pd:0,mr:0,bd:0,bg:0,out:0,col:"inherit",fw:"inherit",f:"inherit",lh:"inherit",ws:"pre",resize:"none"}),u=(0,t.rule)({d:"inline-block",pos:"absolute",ov:"hidden",pe:"none",us:"none",bxz:"border-box",t:0,l:0,ws:"pre"}),r=({inp:c,value:s,uncontrolled:o,multiline:i,typebefore:f="",typeahead:m="",extraWidth:p,minWidth:w=8,maxWidth:g,focus:b,onChange:l,onFocus:h,onBlur:v,onKeyDown:y,onSubmit:_,onCancel:C,onTab:O})=>{const k=e.useRef(null),S=e.useRef(null),E=(0,t.useTheme)();e.useLayoutEffect(()=>{!k.current||!S.current||(b&&k.current.focus(),(0,d.copyStyles)(k.current,S.current,["font","fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","boxSizing"]))},[]),e.useLayoutEffect(()=>{const N=k.current,I=S.current;if(!N||!I)return;let R=I.scrollWidth;p&&(R+=p),w&&(R=Math.max(R,w)),g&&(R=Math.min(R,g));const T=N.style;if(T.width=R+"px",i){const q=I.scrollHeight;T.height=q+"px"}},[s,m,p]);const x={ref:N=>{k.current=N,c&&c(N)},className:n,onChange:l,onFocus:h,onBlur:v,onKeyDown:N=>{N.key==="Enter"&&(!i||N.ctrlKey)?_&&_(N):N.key==="Escape"?C&&C(N):N.key==="Tab"&&O&&O(N),y&&y(N)}},A=i?e.createElement("textarea",Object.assign({},x,{value:o?void 0:s})):e.createElement("input",Object.assign({},x,{value:o?void 0:s}));return e.createElement(e.Fragment,null,!!f&&e.createElement("span",{style:{color:E.g(.7),verticalAlign:"top"}},f),e.createElement("span",{className:a},A,e.createElement("span",{ref:S,className:u},e.createElement("span",{style:{visibility:"hidden"}},s),"​",!!m&&e.createElement("span",{style:{color:E.g(.7)}},m))))};return ct.FlexibleInput=r,ct}var Xo;function El(){if(Xo)return rt;Xo=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.JsonProperty=void 0;const e=M(),t=Y(),d=Rr(),a=Q(),n=ar(),u=ee(),r=({pointer:c,onChange:s})=>{const{formal:o}=(0,u.useStyles)(),i=e.useMemo(()=>c.split("/"),[c]),f=e.useMemo(()=>(0,d.unescapeComponent)(i[i.length-1]),[i]),[m,p]=e.useState(f),w=e.useRef(null),[g,b]=e.useState(!1),l=(0,t.useTheme)(),h={color:l.g(.1)};g&&(h.background=l.bg,h.border=`1px solid ${l.g(.9)}`,h.fontWeight="bold",h.margin="-3px",h.padding="2px"),(!f||f.indexOf(" ")!==-1)&&(h.background=l.blue(.1));const v=y=>{y&&y.preventDefault(),y&&y.stopPropagation(),s&&s([{op:"move",from:c,path:i.slice(0,i.length-1).join("/")+"/"+(0,d.escapeComponent)(m)}])};return e.createElement(e.Fragment,null,s?e.createElement("span",{className:a.property+a.input,style:h},e.createElement(n.FlexibleInput,{inp:y=>w.current=y,value:g?m:f,onChange:y=>p(y.target.value),onFocus:y=>{const _=y.target,O=_.value.length;O&&O<6&&setTimeout(()=>{_.setSelectionRange(0,O,"forward")},155),b(!0)},onBlur:()=>{b(!1)},onSubmit:y=>{w.current&&(w.current.blur(),b(!1)),v(y)},onCancel:()=>{w.current&&(w.current.blur(),b(!1))}})):e.createElement("span",{className:a.property,style:h},o?JSON.stringify(f):f),e.createElement("span",{className:a.colon,style:{color:l.g(.5)}},e.createElement("span",null,":")))};return rt.JsonProperty=r,rt}var ut={},lt={},Cs={},Qo;function Ir(){return Qo||(Qo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.typeahead=e.inputStyle=e.inputColor=e.valueBg=e.valueColor=void 0;const t=Y(),d=Q(),a=(s,o)=>{switch(typeof o){case"boolean":return d.ValueColor.bool[~~s];case"string":return d.ValueColor.str[~~s];case"number":return o?o===Math.round(o)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]:d.ValueColor.zero[~~s];case"bigint":return d.ValueColor.float[~~s];case"object":return o===null?d.ValueColor.nil[~~s]:void 0;case"undefined":return d.ValueColor.undef[~~s]}};e.valueColor=a;const n=s=>s===!1||typeof s=="number"&&s<0?t.theme.red(.06):void 0;e.valueBg=n;const u=(s,o)=>{if(o){if(o=o.trim(),o==="true"||o==="false")return d.ValueColor.bool[~~s];if(o==="null")return d.ValueColor.nil[~~s];if(o==="undefined")return d.ValueColor.undef[~~s];if(o==="0")return d.ValueColor.zero[~~s];if(o.length<24&&(o[0]==="-"||o[0]>="0"&&o[0]<="9"))try{const i=JSON.parse(o);if(typeof i=="number")return i===Math.round(i)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]}catch{}if(!(o[0]==="["||o[0]==="{"))return d.ValueColor.str[~~s]}};e.inputColor=u;const r=(s,o,i)=>({color:(0,e.inputColor)(o,i)||s.g(.1),background:s.bg,borderColor:s.g(.7)});e.inputStyle=r;const c=s=>{if(!s)return"";const o=s.length;return o>=5?"":"true".startsWith(s)?"true".slice(o):"false".startsWith(s)?"false".slice(o):"null".startsWith(s)?"null".slice(o):""};e.typeahead=c})(Cs)),Cs}var dt={},Zo;function Ri(){if(Zo)return dt;Zo=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.selectOnFocus=void 0;const e=t=>{const d=t.value,a=d.length;a&&a<40&&setTimeout(()=>{if(d[0]==='"'&&d[a-1]==='"')(a<17||d.indexOf(`
`)===-1&&d.indexOf(" ")===-1)&&t.setSelectionRange(1,a-1,"forward");else if(d==="null")t.setSelectionRange(0,4,"forward");else try{switch(typeof JSON.parse(d)){case"number":case"boolean":{t.setSelectionRange(0,a,"forward");break}}}catch{}},155),d[0]==='"'&&d[a-1]==='"'&&t.setSelectionRange(a-1,a-1)};return dt.selectOnFocus=e,dt}var $o;function Zh(){if($o)return lt;$o=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.ValueInput=void 0;const e=M(),t=Y(),d=Q(),a=Ir(),n=ar(),u=Ri(),r=c=>{const{value:s,onChange:o}=c,i=e.useRef(null),f=(0,t.useTheme)(),m=e.useMemo(()=>s===null?"null":typeof s=="boolean"?s?"true":"false":typeof s=="string"?JSON.stringify(s):String(s),[s,f]),[p,w]=e.useState(m),[g,b]=e.useState(!1);e.useEffect(()=>{w(m)},[m]);const l=O=>{O&&O.preventDefault(),O&&O.stopPropagation();let k;try{k=JSON.parse(p)}catch{k=String(p)}o&&o(k)},h=O=>{const k=O.target;k.value===p&&(0,u.selectOnFocus)(k),b(!0)},v=()=>{b(!1)},y=O=>{i.current&&i.current.blur(),l(O)},_=()=>{m!==p?w(m):i.current&&i.current.blur()},C=O=>{const k=(0,a.typeahead)(p);k&&(O.preventDefault(),w(p+k))};return e.createElement("span",{className:d.input,style:g?(0,a.inputStyle)(f,!f.isLight,p):{color:(0,a.valueColor)(!f.isLight,s),background:(0,a.valueBg)(s)}},e.createElement(n.FlexibleInput,{inp:O=>i.current=O,value:g?p:m,typeahead:g?(0,a.typeahead)(p):"",onChange:O=>w(O.target.value),onFocus:h,onBlur:v,onSubmit:y,onCancel:_,onTab:C}))};return lt.ValueInput=r,lt}var ft={},ec;function Ke(){if(ec)return ft;ec=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.JsonAtom=void 0;const e=M(),t=Y(),d=Ir(),a=t.theme.color.sem.blue[0],n=u=>{var r;const{value:c,onClick:s}=u,o=(0,t.useTheme)();let i=o.g(.2),f="∅";if(Array.isArray(c))i=a,f="["+c.length+"]";else if(c instanceof Uint8Array)i=o.g(.45),f=e.createElement("span",null,[...c].slice(0,128).map(w=>w<16?"0"+w.toString(16):w.toString(16)).join(" "),c.length>128?e.createElement("span",{style:{color:o.g(.3)}},` … (${c.length-128} more)`):"");else if(c&&typeof c=="object")i=a,f="{"+Object.keys(c).length+"}";else if(i=(r=(0,d.valueColor)(!o.isLight,c))!==null&&r!==void 0?r:i,typeof c=="string"){const g=c.length>64,b=JSON.stringify(g?c.slice(0,64):c);g?f=e.createElement("span",null,b.slice(0,-1),e.createElement("span",{style:{color:o.g(.3)}},` … (${c.length-64} more)`),'"'):f=b}else f=String(c);const m=(0,d.valueBg)(c),p={color:i,background:m};return m&&(p.borderRadius=4,p.margin=-1,p.padding=1),e.createElement("span",{style:p,onClick:s},f)};return ft.JsonAtom=n,ft}var tc;function $h(){if(tc)return ut;tc=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.JsonValue=void 0;const e=M(),t=El(),d=Zh(),a=Ke(),n=u=>{const{pointer:r,property:c,doc:s,parentCollapsed:o,comma:i,onChange:f}=u,m=s instanceof Uint8Array,p=w=>{f&&f([{op:"replace",path:r,value:w}])};return e.createElement(e.Fragment,null,typeof c=="string"&&e.createElement(t.JsonProperty,{key:"k"+String(o),pointer:r,onChange:f}),!f||m?e.createElement(a.JsonAtom,{value:s}):e.createElement(d.ValueInput,{key:String(o),value:s,onChange:p}),!!i&&",")};return ut.JsonValue=n,ut}var ht={},pt={},Ss={},Os={},nc;function e0(){return nc||(nc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTranslations=void 0;var t=L,d=M(),a=d.createContext,n=d.createElement,u=d.Fragment,r=function(s){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];for(var f=[],m=0;m<o.length;m++)f.push(s[m]),f.push(o[m]);return f.push(s[m]),n.apply(void 0,t.__spreadArrays([u,{}],f))},c=function(s){return function(o){for(var i=[],f=1;f<arguments.length;f++)i[f-1]=arguments[f];for(var m=[],p=0;p<i.length;p++)m.push(o[p]),m.push(s[i[p]]);return m.push(o[p]),n.apply(void 0,t.__spreadArrays([u,{}],m))}};e.createTranslations=function(s){var o;s===void 0&&(s="main");var i=a({}),f=i.Consumer,m=(o=(function(l){t.__extends(h,l);function h(v){var y,_=l.call(this,v)||this;_.load=function(x,A){return t.__awaiter(_,void 0,void 0,function(){var N;return t.__generator(this,function(I){switch(I.label){case 0:return this.state.map[x]||(this.state.map[x]={}),this.state.map[x][A]?[3,2]:(this.state.map[x][A]={},this.setState(t.__assign({},this.state)),[4,this.props.loader(x,A)]);case 1:N=I.sent(),this.state.map[x][A]=N,this.setState(t.__assign({},this.state)),I.label=2;case 2:return[2]}})})},_.setLocale=function(x){x!==_.state.locale&&(_.state.map[x]||(_.state.map[x]={}),_.setState({locale:x}))},_.createT=function(x){x===void 0&&(x=[_.props.ns]);for(var A=_.state.locale,N=_.state.map[A],I=0,R=x;I<R.length;I++){var T=R[I];N[T]||_.load(A,T).catch(function(B){return console.error(B)})}var q=(function(B){for(var J=[],D=1;D<arguments.length;D++)J[D-1]=arguments[D];for(var U=0,V=[A,_.props.defaultLocale];U<V.length;U++){var re=V[U];if(!re)break;for(var ie=_.state.map[re],be=0,_e=x;be<_e.length;be++){var G=_e[be],z=ie[G],W=z[B];if(W!==void 0)return typeof W=="function"?W(c(J)):W||B}}return B});return q.t=function(B){return function(J){for(var D=[],U=1;U<arguments.length;U++)D[U-1]=arguments[U];var V=q.apply(void 0,t.__spreadArrays([B],D));return typeof V=="object"?V:V!==B?n(u,{},V):r.apply(void 0,t.__spreadArrays([J],D))}},q};var C=v.map,O=C===void 0?{}:C,k=v.locale,S=v.defaultLocale,E=v.ns;return O[S]?O[S][E]||(O[S][E]={}):O[S]=(y={},y[E]={},y),_.state={locale:k,ns:E,map:O,load:_.load,setLocale:_.setLocale,createT:_.createT},k!==S&&_.load(k,E),_}return h.prototype.shouldComponentUpdate=function(v){return v.locale!==this.props.locale&&this.setLocale(v.locale),!0},h.prototype.render=function(){return d.createElement(i.Provider,{value:this.state,children:this.props.children})},h})(d.Component),o.defaultProps={locale:"en",defaultLocale:"en",ns:s},o),p=(function(l){return l});p.t=function(l){return function(h){for(var v=[],y=1;y<arguments.length;y++)v[y-1]=arguments[y];return r(h,v)}};var w=function(l){var h=l instanceof Array?l:[l||s],v=d.useContext(i);return[v.createT?v.createT(h):p,v]},g=function(l,h){return h===void 0&&(h=s),Array.isArray(h)||(h=[h]),(function(v){var y=w(h),_=y[0],C=y[1];return d.createElement(l,t.__assign(t.__assign({},v),{t:_,T:C}))})},b=function(l){var h=l.children,v=l.ns instanceof Array?l.ns:[l.ns||s],y=w(v),_=y[0],C=y[1];return(typeof h=="function"?h(_,C):h instanceof Array?d.createElement.apply(d,t.__spreadArrays([d.Fragment,null],h.map(function(O){return typeof O=="function"?O(_):typeof O=="string"?_(O):O||null}))):typeof h=="string"?_(h):h)||null};return{Consumer:f,Provider:m,context:i,useT:w,Trans:b,withT:g,T:p}},e.default=e.createTranslations})(Os)),Os}var Es={},rc;function t0(){return rc||(rc=1,Object.defineProperty(Es,"__esModule",{value:!0})),Es}var sc;function Ee(){return sc||(sc=1,(function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.T=e.withT=e.useT=e.context=e.Trans=e.Provider=e.Consumer=void 0;var d=L,a=e0();d.__exportStar(t0(),e),e.Consumer=(t=a.default(),t.Consumer),e.Provider=t.Provider,e.Trans=t.Trans,e.context=t.context,e.useT=t.useT,e.withT=t.withT,e.T=t.T})(Ss)),Ss}var mt={},bt={},ic;function ur(){if(ic)return bt;ic=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Action=void 0;const e=M(),t=Y(),d=Q(),a=(0,t.drule)({pos:"relative",d:"flex",jc:"center",ai:"center",w:"17px",h:"17px",bdrad:"2px",pad:0,mr:0,out:0,ff:"monospace",lh:"16px",cur:"pointer",bd:`1px dotted ${d.blue}`,col:d.blue,fw:"normal",z:3}),n=(0,t.drule)({[`.${a.toString().trim()}:hover &`]:{d:"inline-block"}}),u=({className:r="",tooltip:c,children:s,onClick:o,onMouseEnter:i,onMouseLeave:f,onMouseOver:m})=>{const p=(0,t.useTheme)();return e.createElement("button",{className:a({bg:p.bg,"&:hover":{col:p.bg,bg:d.blue},"&:active":{col:p.g(.9),bg:p.g(.1),bd:`1px solid ${p.g(.1)}`}})+r,onClick:o,onMouseEnter:i,onMouseLeave:f,onMouseOver:m},s,!!c&&e.createElement("span",{className:d.tooltip+n({})},c))};return bt.Action=u,bt}var oc;function Tr(){if(oc)return mt;oc=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.CancelAction=void 0;const e=M(),t=Y(),d=Q(),a=ur(),n=(0,t.drule)({w:"20px",h:"20px",pos:"absolute",t:"-11px",l:"-11px",z:2,bdrad:"50%",svg:{fill:d.blue}}),u=r=>{const c=(0,t.useTheme)();return e.createElement(a.Action,Object.assign({},r,{className:n({"&:hover":{bg:d.negative,bd:`1px solid ${d.negative}`,svg:{fill:"#fff"}},"&:active":{bg:c.g(.1),bd:`1px solid ${c.g(.1)}`}})}),"×")};return mt.CancelAction=u,mt}var gt={},cc;function n0(){if(cc)return gt;cc=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.EditAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"…");return gt.EditAction=d,gt}var ac;function Ii(){if(ac)return pt;ac=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.FocusRegion=void 0;const e=M(),t=Y(),d=Ee(),a=Q(),n=Tr(),u=n0(),r=(0,t.rule)({d:"inline-block",pos:"relative",va:"top",bxz:"border-box",pd:"3px",bdrad:"4px",trs:"background-color .3s ease-out"}),c=(0,t.rule)({pd:"1px 3px"}),s=(0,t.rule)({bgc:t.theme.blue(.1)}),o=(0,t.rule)({bgc:t.theme.red(.1)}),i=(0,t.rule)({bgc:t.theme.red(.08)}),f=(0,t.rule)({out:`1px dotted ${a.blue}`}),m=(0,t.rule)({out:`1px dotted ${a.negative}`}),p=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-1px",l:"calc(100% + 0.5em)"}),w=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-11px",l:"calc(100% - 24px)"}),g=b=>{const{focused:l,pointed:h,compact:v,aside:y,toolbar:_,negative:C,children:O,onClick:k,onMouseMove:S,onMouseEnter:E,onMouseLeave:x,onDelete:A,onEdit:N}=b,[I]=(0,d.useT)(),[R,T]=e.useState(!1),q=A?e.createElement(n.CancelAction,{tooltip:I("Delete"),onClick:A,onMouseEnter:()=>T(!0),onMouseOver:()=>T(!0),onMouseLeave:()=>T(!1)}):void 0,B=r+(v?c:"")+(h?C?o:s:"")+(R?i:"")+(l?C?m:f:"");return e.createElement("span",{className:B,style:{outline:R?`1px dotted ${a.negative}`:void 0},onMouseMove:S,onMouseEnter:E,onMouseLeave:x,onClick:k},O,q,!!l&&N&&e.createElement("span",{className:a.bottomRightActionPos},e.createElement(u.EditAction,{tooltip:I("Set"),onClick:N})),!!y&&e.createElement("span",{className:p},y),!!l&&!!_&&e.createElement("span",{className:w},_))};return pt.FocusRegion=g,pt}var ks={},uc;function ae(){return uc||(uc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FocusProvider=e.useIsFocused=e.useFocus=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useFocus=d;const a=u=>{const{focused:r}=(0,e.useFocus)();return r===u};e.useIsFocused=a;const n=({children:u,onFocus:r})=>{const[c,s]=t.useState(null),[o,i]=t.useState(null),f=t.useCallback(m=>{s(m),r?.(m)},[r]);return t.useEffect(()=>{const m=p=>{const w=document.activeElement;w&&(w.nodeName==="INPUT"||w.nodeName==="TEXTAREA")||p.key==="Escape"&&f(null)};return document.addEventListener("keydown",m,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",m)},[]),t.createElement(e.context.Provider,{value:{focused:c,focus:f,pointed:o,point:i}},u)};e.FocusProvider=n})(ks)),ks}var xs={},lc;function kl(){return lc||(lc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputProvider=e.useInput=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useInput=d;const a=({children:n})=>{const u=(0,e.useInput)(),[r,c]=t.useState(!1);return t.useEffect(()=>{if(u)return;const s=()=>{c(!!document.activeElement&&document.activeElement.tagName==="INPUT")};return document.addEventListener("focus",s,!0),document.addEventListener("blur",s,!0),()=>{document.removeEventListener("focus",s),document.removeEventListener("blur",s)}},[]),u?n:t.createElement(e.context.Provider,{value:{focused:r}},n)};e.InputProvider=a})(xs)),xs}var dc;function xl(){if(dc)return ht;dc=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.JsonHoverable=void 0;const e=M(),t=cr(),d=Ii(),a=ae(),n=ee(),u=kl(),r=({pointer:c,children:s})=>{const{focused:o,focus:i,pointed:f,point:m}=(0,a.useFocus)(),{pfx:p,onChange:w}=e.useContext(t.context),{compact:g}=(0,n.useStyles)(),b=(0,u.useInput)(),l=p+c,h=C=>{C.stopPropagation(),f!==l&&m(l)},v=C=>{C.preventDefault(),C.stopPropagation(),m(l)},y=()=>{m(null)},_=C=>{C.preventDefault(),C.stopPropagation(),i(l)};return e.createElement(d.FocusRegion,{pointed:f===l,focused:o===l,compact:g,onClick:_,onMouseMove:h,onMouseEnter:v,onMouseLeave:y,onDelete:w&&!b.focused&&l===o?()=>w([{op:"remove",path:c}]):void 0},s)};return ht.JsonHoverable=r,ht}var yt={},vt={},wt={},_t={},Ct={},fc;function r0(){if(fc)return Ct;fc=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.TypeSwitch=void 0;const e=M(),t=Y(),d=(0,t.drule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",col:t.theme.color.sem.blue[0],d:"inline-block",pd:"2px 2px",mr:"0",bxz:"border-box",bd:0,bdrad:"1em"}));return Ct.TypeSwitch=e.memo(({value:a,onKeyDown:n,onClick:u})=>{const r=(0,t.useTheme)();return e.createElement("button",{className:d({bg:r.g(.96),"&:hover":{bg:r.g(.88)}}),onClick:u,onKeyDown:n},a)}),Ct}var hc;function s0(){if(hc)return _t;hc=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.CrdtTypeSwitch=void 0;const e=M(),t=r0(),d=({types:a=["any","con","vec","val"],type:n,onSubmit:u,onClick:r})=>{const[c,s]=e.useState(a.findIndex(f=>f===n.current));e.useLayoutEffect(()=>{n.current=a[c]},[]);const o=()=>{s(f=>{const m=(f+1)%a.length;return n.current=a[m],m})},i=()=>{s(f=>{const m=(f-1+a.length)%a.length;return n.current=a[m],m})};return e.createElement("span",{style:{display:"inline-block",padding:"0 0 0 4px",margin:"-1px 0"}},e.createElement(t.TypeSwitch,{value:a[c],onClick:f=>{o(),r&&r(f)},onKeyDown:f=>{switch(f.key){case"ArrowDown":case"ArrowRight":{f.preventDefault(),o();break}case"ArrowUp":case"ArrowLeft":{f.preventDefault(),i();break}case"Enter":{f.preventDefault(),u&&(f.preventDefault(),u());break}}}}))};return _t.CrdtTypeSwitch=d,_t}var pc;function Ti(){if(pc)return wt;pc=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.ValueInput=void 0;const e=M(),t=Y(),d=ar(),a=Q(),n=Ir(),u=s0(),r=Ri(),c=({inp:s,focus:o,initialValue:i="",visible:f,types:m=["any","con","val","vec"],initialType:p,withType:w,onSubmit:g,onCancel:b})=>{const[l,h]=e.useState(i),v=e.useRef(null),y=(0,t.useTheme)(),_=e.useRef(p??(m&&m.length?m[0]:"")),C=()=>{v.current&&v.current.blur(),h(""),g(l,_.current)},O=(0,n.inputStyle)(y,!y.isLight,l);O.display=f?void 0:"none",O.margin="-1px 0 -1px -2px",O.padding="3px 4px 3px 5px",O.border=`1px solid ${y.g(.85)}`;let k=null;return m&&m.length&&w&&(k=e.createElement(u.CrdtTypeSwitch,{type:_,onSubmit:C,onClick:()=>{v.current&&v.current.focus()}})),e.createElement("span",{className:a.input,style:O},e.createElement(d.FlexibleInput,{focus:o,inp:S=>{v.current=S,s&&s(S)},value:l,typeahead:(0,n.typeahead)(l),onChange:S=>h(S.target.value),onSubmit:C,onFocus:S=>(0,r.selectOnFocus)(S.target),onCancel:S=>{h(""),b&&b(S)},onTab:S=>{const E=(0,n.typeahead)(l);E&&(S.preventDefault(),h(l+E))}}),k)};return wt.ValueInput=c,wt}var St={},mc;function Al(){if(mc)return St;mc=1,Object.defineProperty(St,"__esModule",{value:!0}),St.AddAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"+");return St.AddAction=d,St}var bc;function Nl(){if(bc)return vt;bc=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.ObjectInsert=void 0;const e=M(),t=Ee(),d=Q(),a=Y(),n=ar(),u=Ti(),r=Al(),c=({visible:s,withType:o,onSubmit:i})=>{const[f]=(0,t.useT)(),[m,p]=e.useState(!1),[w,g]=e.useState(""),[b,l]=e.useState(""),h=e.useRef(null),v=e.useRef(null),y=(0,a.useTheme)(),_=(C,O)=>{v.current&&v.current.blur(),i(w,C,O),g(""),l(""),p(!1)};if(!s)return null;if(m){const C=e.createElement("span",{className:d.property+d.input,style:{color:y.g(.1),background:y.bg,display:s?void 0:"none",margin:"-1px 0 -1px -2px",padding:"3px 4px",border:`1px solid ${y.g(.85)}`,fontWeight:"bold"}},e.createElement(n.FlexibleInput,{focus:!0,inp:k=>h.current=k,value:w,onChange:k=>g(k.target.value),onSubmit:()=>{v.current&&v.current.focus()},onCancel:()=>{w?g(""):b?l(""):p(!1)}})),O=e.createElement(u.ValueInput,{inp:k=>v.current=k,visible:s,withType:o,onSubmit:_,onCancel:()=>{h.current&&h.current.focus()}});return e.createElement("span",{style:{display:s?void 0:"none"}},C,e.createElement("span",{className:d.colon},e.createElement("span",null,":")),O)}return e.createElement("span",{className:d.insArrBlock,style:{display:s?void 0:"none"},onClick:()=>p(!0)},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(r.AddAction,{tooltip:f("Add key"),onClick:()=>p(!0)})))};return vt.ObjectInsert=c,vt}var gc;function i0(){if(gc)return yt;gc=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.JsonObjectInsert=void 0;const e=M(),t=Rr(),d=cr(),a=Nl(),n=({pointer:u,visible:r})=>{const{onChange:c}=e.useContext(d.context);if(!c)return null;const s=(o,i)=>{let f;try{f=JSON.parse(i)}catch{f=String(i)}c([{op:"add",path:u+"/"+(0,t.escapeComponent)(o),value:f}])};return e.createElement(a.ObjectInsert,{visible:r,onSubmit:s})};return yt.JsonObjectInsert=n,yt}var Ot={},Et={},yc;function ji(){if(yc)return Et;yc=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.ArrayInsert=void 0;const e=M(),t=Ee(),d=Q(),a=Ti(),n=Al(),u=Tr(),r=({visible:c,withType:s,onSubmit:o})=>{const[i]=(0,t.useT)(),[f,m]=e.useState(!1),p=(w,g)=>{m(!1),o(w,g)};return f?e.createElement("span",{style:{position:"relative"}},e.createElement(a.ValueInput,{focus:!0,withType:s,visible:c,onSubmit:p,onCancel:()=>m(!1)}),e.createElement(u.CancelAction,{onClick:()=>m(!1)})):e.createElement("span",{className:d.insArrBlock,style:{display:c?void 0:"none"}},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(n.AddAction,{tooltip:i("Insert"),onClick:()=>m(!0)})))};return Et.ArrayInsert=r,Et}var vc;function o0(){if(vc)return Ot;vc=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.JsonArrayInsert=void 0;const e=M(),t=cr(),d=ji(),a=({pointer:n,visible:u})=>{const{onChange:r}=e.useContext(t.context);if(!r)return null;const c=s=>{let o;try{o=JSON.parse(s)}catch{o=String(s)}r([{op:"add",path:n,value:o}])};return e.createElement(d.ArrayInsert,{visible:u,onSubmit:c})};return Ot.JsonArrayInsert=a,Ot}var kt={},wc;function Rl(){if(wc)return kt;wc=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.ObjectLayout=void 0;const e=M(),t=Y(),d=Q(),a=ee(),n=({property:u,collapsedView:r,header:c,collapsed:s,comma:o,brackets:i=["{","}"],children:f,onClick:m,onCollapserClick:p,onCollapsedClick:w,onBracketClick:g})=>{const[b,l]=e.useState(!1),h=(0,t.useTheme)(),{noCollapseToggles:v}=(0,a.useStyles)(),y=()=>{l(!0)},_=()=>{l(!1)},C=h.g(.3);r=e.createElement("span",{className:d.collapsed,style:{display:s?void 0:"none"},onClick:w},e.createElement("span",{style:{color:d.blue}},i[0]),r,e.createElement("span",{style:{color:d.blue}},i[1]));const O=e.createElement("span",null,u,e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:y,onMouseLeave:_,onClick:g},i[0],!!c&&e.createElement("span",{style:{display:"inline-block",position:"absolute",top:"-0.27em",left:"1em"}},c)));return e.createElement("span",{className:d.object,onClick:m},!v&&e.createElement("span",{className:d.collapser,style:{color:h.g(.6)},onClick:p},s?"+":"—"),O,r,e.createElement("span",{className:d.list,style:{display:s?"none":void 0}},f),e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:y,onMouseLeave:_,onClick:g},i[1]),!!o&&",")};return kt.ObjectLayout=n,kt}var _c;function c0(){return _c||(_c=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonDoc=void 0;const t=M(),d=Q(),a=cr(),n=El(),u=$h(),r=xl(),c=i0(),s=o0(),o=Rl(),i=ae(),f=ee(),m=Rr(),p=({property:b,doc:l,pointer:h,parentCollapsed:v,comma:y,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,keepOrder:S,collapsed:E}=(0,f.useStyles)(),x=t.useMemo(()=>{const T=Object.keys(l);return S?T:T.sort()},[l]),[A,N]=t.useState(E),I=()=>{!A&&C+h===O&&N(!0)},R=x.map((T,q)=>{const B=`${h}/${(0,m.escapeComponent)(T)}`;return t.createElement("span",{key:T,className:d.line},t.createElement(r.JsonHoverable,{pointer:B},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{property:T,doc:l[T],pointer:B,parentCollapsed:A,comma:k&&q<x.length-1,onChange:_}))))});return t.createElement(o.ObjectLayout,{collapsed:A,collapsedView:!!x.length&&t.createElement("strong",null,x.length),comma:y,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(v),pointer:h,onChange:_}),onClick:()=>{A&&N(!1)},onCollapserClick:()=>N(T=>!T),onBracketClick:I},R,t.createElement(c.JsonObjectInsert,{pointer:h,visible:O===C+h}))},w=({property:b,doc:l,pointer:h,parentCollapsed:v,comma:y,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,collapsed:S}=(0,f.useStyles)(),[E,x]=t.useState(S),A=()=>{!E&&C+h===O&&x(!0)},N=l.map((I,R)=>{const T=`${h}/${R}`;return t.createElement(t.Fragment,{key:R},t.createElement(s.JsonArrayInsert,{pointer:`${h}/${R}`,visible:O===C+h}),t.createElement("span",{className:d.line},t.createElement(r.JsonHoverable,{pointer:T},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{doc:l[R],pointer:T,parentCollapsed:E,comma:k&&R<l.length-1,onChange:_})))))});return t.createElement(o.ObjectLayout,{collapsed:E,collapsedView:!!l.length&&t.createElement("strong",null,l.length),comma:y,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(v),pointer:h,onChange:_}),onClick:()=>{E&&x(!1)},onCollapserClick:()=>x(I=>!I),onBracketClick:A,brackets:["[","]"]},N,t.createElement(s.JsonArrayInsert,{pointer:`${h}/-`,visible:O===C+h}))},g=b=>{const{doc:l,comma:h}=b;return l?typeof l=="object"?Array.isArray(l)?t.createElement(w,Object.assign({},b,{doc:l})):l instanceof Uint8Array?t.createElement(u.JsonValue,Object.assign({},b,{comma:h})):t.createElement(p,Object.assign({},b,{doc:l})):t.createElement(u.JsonValue,Object.assign({},b)):t.createElement(u.JsonValue,Object.assign({},b))};e.JsonDoc=g})(Qr)),Qr}var xt={},gr={},Cc;function a0(){if(Cc)return gr;Cc=1,Object.defineProperty(gr,"__esModule",{value:!0});var e=M(),t=Sl(),d=["mousedown","touchstart"],a=function(n,u,r){r===void 0&&(r=d);var c=e.useRef(u);e.useEffect(function(){c.current=u},[u]),e.useEffect(function(){for(var s=function(m){var p=n.current;p&&!p.contains(m.target)&&c.current(m)},o=0,i=r;o<i.length;o++){var f=i[o];t.on(document,f,s)}return function(){for(var m=0,p=r;m<p.length;m++){var w=p[m];t.off(document,w,s)}}},[r,n])};return gr.default=a,gr}var yr={},Sc;function u0(){if(Sc)return yr;Sc=1,Object.defineProperty(yr,"__esModule",{value:!0});var e=M();function t(){var d=e.useRef(!1),a=e.useCallback(function(){return d.current},[]);return e.useEffect(function(){return d.current=!0,function(){d.current=!1}},[]),a}return yr.default=t,yr}var Oc;function Il(){if(Oc)return xt;Oc=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.Root=void 0;const e=M(),t=a0(),d=u0(),a=ee(),n=ae(),u=kl(),c=(0,Y().rule)({d:"inline-block",ff:"monospace"}),s=({children:o,onFocus:i})=>{const f=(0,d.default)(),m=(0,a.useStyles)(),{focused:p,focus:w,point:g}=(0,n.useFocus)(),b=e.useRef(null),l=e.useRef(p);return(0,t.default)(b,()=>{f&&(g(null),w(null))}),i&&p!==l.current&&(l.current=p,i(p)),e.createElement(u.InputProvider,null,e.createElement("span",{ref:b,className:c,style:{fontSize:m.fontSize||"13.4px"}},o))};return xt.Root=s,xt}var Ec;function Tl(){if(Ec)return Ze;Ec=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ClickableJson=void 0;const e=M(),t=cr(),d=ee(),a=c0(),n=Il(),u=ae(),r=xl(),c=s=>{var o;const{onFocus:i}=s,f=s.readonly?void 0:s.onChange;return e.createElement(u.FocusProvider,null,e.createElement(d.context.Provider,{value:s},e.createElement(t.context.Provider,{value:{pfx:(o=s.pfx)!==null&&o!==void 0?o:"",onChange:f}},e.createElement(n.Root,{onFocus:i},e.createElement(r.JsonHoverable,{pointer:""},e.createElement(a.JsonDoc,Object.assign({},s,{pointer:"",onChange:f})))))))};return Ze.ClickableJson=c,Ze}var At={},As={},kc;function ue(){return kc||(kc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useJsonCrdt=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useJsonCrdt=d})(As)),As}var Ie={},xc;function lr(){if(xc)return Ie;xc=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.nodeRef=Ie.NodeRef=void 0;let e=class{constructor(n,u,r){this.node=n,this.parent=u,this.step=r}};Ie.NodeRef=e;const t=new WeakMap,d=(a,n,u)=>{try{const r=t.get(a);if(r)return r;const c=new e(a,n,u);return t.set(a,c),c}catch{return}};return Ie.nodeRef=d,Ie}var Ns={},Rs={},Is={},Ac;function l0(){return Ac||(Ac=1,Object.defineProperty(Is,"__esModule",{value:!0})),Is}var Ts={},Nt={},js={},Ps={},Nc;function d0(){return Nc||(Nc=1,Object.defineProperty(Ps,"__esModule",{value:!0})),Ps}var Ms={},Rc;function f0(){return Rc||(Rc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class t{constructor(b,l){this.sid=b,this.time=l}}e.Timestamp=t;class d{constructor(b,l,h){this.sid=b,this.time=l,this.span=h}}e.Timespan=d;const a=(g,b)=>new t(g,b);e.ts=a;const n=(g,b,l)=>new d(g,b,l);e.tss=n;const u=(g,b)=>(0,e.ts)(g.sid,g.time+b);e.tick=u;const r=(g,b)=>g.time===b.time&&g.sid===b.sid;e.equal=r;const c=(g,b)=>{const l=g.time,h=b.time;if(l>h)return 1;if(l<h)return-1;const v=g.sid,y=b.sid;return v>y?1:v<y?-1:0};e.compare=c;const s=(g,b,l,h)=>{if(g.sid!==l.sid)return!1;const v=g.time,y=l.time;return!(v>y||v+b<y+h)};e.contains=s;const o=(g,b,l)=>{if(g.sid!==l.sid)return!1;const h=g.time,v=l.time;return!(h>v||h+b<v+1)};e.containsId=o;const i=g=>{if(g.sid===1)return"."+g.time;let b=""+g.sid;return b.length>4&&(b=".."+b.slice(b.length-4)),b+"."+g.time};e.printTs=i;const f=(g,b,l)=>new d(g.sid,g.time+b,l);e.interval=f;class m extends t{tick(b){const l=new t(this.sid,this.time);return this.time+=b,l}}e.LogicalClock=m;class p extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,l){const h=b.time+l-1,v=b.sid;if(v!==this.sid){const y=this.peers.get(b.sid);y?h>y.time&&(y.time=h):this.peers.set(b.sid,(0,e.ts)(v,h))}h>=this.time&&(this.time=h+1)}clone(){return this.fork(this.sid)}fork(b){const l=new p(b,this.time);return b!==this.sid&&l.observe((0,e.tick)(this,-1),1),this.peers.forEach(h=>{l.observe(h,1)}),l}toString(b=""){const l=this.peers.size;let h=1,v="";return this.peers.forEach(y=>{v+=`
${b}${h===l?"└─":"├─"} ${y.sid}.${y.time}`,h++}),`clock ${this.sid}.${this.time}${v}`}}e.ClockVector=p;class w extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,l){if(b.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<b.time)throw new Error("TIME_TRAVEL");const h=b.time+l;h>this.time&&(this.time=h)}clone(){return this.fork()}fork(){return new w(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=w})(Ms)),Ms}var Ic;function H(){return Ic||(Ic=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(d0(),e),t.__exportStar(f0(),e)})(js)),js}var Tc;function jr(){if(Tc)return Nt;Tc=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.ConNode=void 0;const e=H();let t=class{constructor(a,n){this.id=a,this.val=n,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(a){const n=this.val,u=n instanceof Uint8Array?`Uint8Array { ${(""+n).replaceAll(",",", ")} }`:`{ ${n instanceof e.Timestamp?(0,e.printTs)(n):JSON.stringify(n)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${u}`}};return Nt.ConNode=t,Nt}var Rt={},It={},jc;function he(){if(jc)return It;jc=1,Object.defineProperty(It,"__esModule",{value:!0}),It.printTree=void 0;const e=(t="",d)=>{let a="",n=d.length-1;for(;n>=0&&!d[n];n--);for(let u=0;u<=n;u++){const r=d[u];if(!r)continue;const c=u===n,s=r(t+(c?" ":"│")+"  "),o=s?c?"└─":"├─":"│";a+=`
`+t+o+(s?" "+s:"")}return a};return It.printTree=e,It}var Te={},F={},Pc;function Ye(){if(Pc)return F;Pc=1,Object.defineProperty(F,"__esModule",{value:!0}),F.NopOp=F.DelOp=F.UpdArrOp=F.InsArrOp=F.InsBinOp=F.InsStrOp=F.InsVecOp=F.InsObjOp=F.InsValOp=F.NewArrOp=F.NewBinOp=F.NewStrOp=F.NewVecOp=F.NewObjOp=F.NewValOp=F.NewConOp=void 0;const e=he(),t=H();class d{constructor(y){this.id=y}span(){return 1}toString(){let y=this.name()+" "+(0,t.printTs)(this.id);const _=this.span();return _>1&&(y+="!"+_),y}}class a extends d{constructor(y,_){super(y),this.id=y,this.val=_}name(){return"new_con"}toString(){const y=this.val,_="Uint8Array",C=y instanceof t.Timestamp?`{ ${(0,t.printTs)(y)} }`:y instanceof Uint8Array?y.length<13?`${_} { ${(""+y).replaceAll(",",", ")} }`:`${_}(${y.length})`:`{ ${JSON.stringify(y)} }`;return super.toString()+" "+C}}F.NewConOp=a;class n extends d{name(){return"new_val"}}F.NewValOp=n;class u extends d{name(){return"new_obj"}}F.NewObjOp=u;class r extends d{name(){return"new_vec"}}F.NewVecOp=r;class c extends d{name(){return"new_str"}}F.NewStrOp=c;class s extends d{name(){return"new_bin"}}F.NewBinOp=s;class o extends d{name(){return"new_arr"}}F.NewArrOp=o;class i extends d{constructor(y,_,C){super(y),this.id=y,this.obj=_,this.val=C}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}, val = ${(0,t.printTs)(this.val)}`}}F.InsValOp=i;class f extends d{constructor(y,_,C){super(y),this.id=y,this.obj=_,this.data=C}name(){return"ins_obj"}toString(y=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(y,this.data.map(C=>O=>`${JSON.stringify(C[0])}: ${(0,t.printTs)(C[1])}`))}}F.InsObjOp=f;class m extends d{constructor(y,_,C){super(y),this.id=y,this.obj=_,this.data=C}name(){return"ins_vec"}toString(y=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(y,this.data.map(C=>O=>`${C[0]}: ${(0,t.printTs)(C[1])}`))}}F.InsVecOp=m;class p extends d{constructor(y,_,C,O){super(y),this.id=y,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${(0,t.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}F.InsStrOp=p;class w extends d{constructor(y,_,C,O){super(y),this.id=y,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_bin"}toString(){const y=(0,t.printTs)(this.ref);return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${y} ← ${this.data} }`}}F.InsBinOp=w;class g extends d{constructor(y,_,C,O){super(y),this.id=y,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_arr"}toString(){const y=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=this.data.map(t.printTs).join(", ");return super.toString()+", obj = "+y+" { "+_+" ← "+C+" }"}}F.InsArrOp=g;class b extends d{constructor(y,_,C,O){super(y),this.id=y,this.obj=_,this.ref=C,this.val=O}name(){return"upd_arr"}toString(){const y=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=(0,t.printTs)(this.val);return super.toString()+", obj = "+y+" { "+_+": "+C+" }"}}F.UpdArrOp=b;class l extends d{constructor(y,_,C){super(y),this.id=y,this.obj=_,this.what=C}name(){return"del"}toString(){const y=this.what.map(_=>(0,t.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${y} }`}}F.DelOp=l;class h extends d{constructor(y,_){super(y),this.id=y,this.len=_}span(){return this.len}name(){return"nop"}}return F.NopOp=h,F}var je={},Tt={},jt={},Pt={},Mc;function h0(){if(Mc)return Pt;Mc=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.RelativeTimestamp=void 0;let e=class{constructor(d,a){this.sessionIndex=d,this.timeDiff=a}};return Pt.RelativeTimestamp=e,Pt}var qc;function p0(){if(qc)return jt;qc=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.ClockEncoder=void 0;const e=H(),t=h0();class d{constructor(u,r){this.index=u,this.clock=r}}let a=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(u){this.index=1,this.clock=u;const r=new d(this.index++,(0,e.tick)(u,-1));this.table.clear(),this.table.set(u.sid,r)}append(u){const r=u.time,c=u.sid;let s=this.table.get(c);if(!s){let f=this.clock.peers.get(c);f||(f=new e.Timestamp(c,this.clock.time-1)),s=new d(this.index++,f),this.table.set(c,s)}const i=s.clock.time-r;if(i<0)throw new Error("TIME_TRAVEL");return new t.RelativeTimestamp(s.index,i)}toJson(){const u=[];return this.table.forEach(r=>{const c=r.clock;u.push(c.sid,c.time)}),u}};return jt.ClockEncoder=a,jt}var Mt={},qt={},Bt={},Bc;function m0(){if(Bc)return Bt;Bc=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Slice=void 0;let e=class{constructor(d,a,n,u){this.uint8=d,this.view=a,this.start=n,this.end=u}subarray(){return this.uint8.subarray(this.start,this.end)}};return Bt.Slice=e,Bt}var Vc;function jl(){if(Vc)return qt;Vc=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Writer=void 0;const e=m0(),t=new Uint8Array([]),d=new DataView(t.buffer),a=typeof ce.Buffer=="function",n=a?ce.Buffer.prototype.utf8Write:null,u=a?ce.Buffer.from:null,r=typeof TextEncoder<"u"?new TextEncoder:null;let c=class{constructor(o=64*1024){this.allocSize=o,this.view=d,this.x0=0,this.x=0,this.uint8=new Uint8Array(o),this.size=o,this.view=new DataView(this.uint8.buffer)}grow(o){const i=this.x0,f=this.x,m=this.uint8,p=new Uint8Array(o),w=new DataView(p.buffer),g=m.subarray(i,f);p.set(g,0),this.x=f-i,this.x0=0,this.uint8=p,this.size=o,this.view=w}ensureCapacity(o){const i=this.size,f=i-this.x;if(f<o){const m=i-this.x0,p=o-f,w=m+p;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(o){this.ensureCapacity(o),this.x+=o}reset(){this.x0=this.x}newBuffer(o){const i=this.uint8=new Uint8Array(o);this.size=o,this.view=new DataView(i.buffer),this.x=this.x0=0}flush(){const o=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,o}flushSlice(){const o=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,o}u8(o){this.ensureCapacity(1),this.uint8[this.x++]=o}u16(o){this.ensureCapacity(2),this.view.setUint16(this.x,o),this.x+=2}u32(o){this.ensureCapacity(4),this.view.setUint32(this.x,o),this.x+=4}i32(o){this.ensureCapacity(4),this.view.setInt32(this.x,o),this.x+=4}u64(o){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(o)),this.x+=8}f64(o){this.ensureCapacity(8),this.view.setFloat64(this.x,o),this.x+=8}u8u16(o,i){this.ensureCapacity(3);let f=this.x;this.uint8[f++]=o,this.uint8[f++]=i>>>8,this.uint8[f++]=i&255,this.x=f}u8u32(o,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=o,this.view.setUint32(f,i),this.x=f+4}u8u64(o,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=o,this.view.setBigUint64(f,BigInt(i)),this.x=f+8}u8f32(o,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=o,this.view.setFloat32(f,i),this.x=f+4}u8f64(o,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=o,this.view.setFloat64(f,i),this.x=f+8}buf(o,i){this.ensureCapacity(i);const f=this.x;this.uint8.set(o,f),this.x=f+i}utf8(o){const i=o.length*4;if(i<168)return this.utf8Native(o);if(n){const f=n.call(this.uint8,o,this.x,i);return this.x+=f,f}else if(u){const f=this.uint8,m=f.byteOffset+this.x,w=u(f.buffer).subarray(m,m+i).write(o,0,i,"utf8");return this.x+=w,w}else if(i>1024&&r){const f=r.encodeInto(o,this.uint8.subarray(this.x,this.x+i)).written;return this.x+=f,f}return this.utf8Native(o)}utf8Native(o){const i=o.length,f=this.uint8;let m=this.x,p=0;for(;p<i;){let g=o.charCodeAt(p++);if((g&4294967168)===0){f[m++]=g;continue}else if((g&4294965248)===0)f[m++]=g>>6&31|192;else{if(g>=55296&&g<=56319&&p<i){const b=o.charCodeAt(p);(b&64512)===56320&&(p++,g=((g&1023)<<10)+(b&1023)+65536)}(g&4294901760)===0?(f[m++]=g>>12&15|224,f[m++]=g>>6&63|128):(f[m++]=g>>18&7|240,f[m++]=g>>12&63|128,f[m++]=g>>6&63|128)}f[m++]=g&63|128}const w=m-this.x;return this.x=m,w}ascii(o){const i=o.length;this.ensureCapacity(i);const f=this.uint8;let m=this.x,p=0;for(;p<i;)f[m++]=o.charCodeAt(p++);this.x=m}};return qt.Writer=c,qt}var Jc;function Pi(){if(Jc)return Mt;Jc=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.CrdtWriter=void 0;const e=jl();let t=class extends e.Writer{id(a,n){a<=7&&n<=15?this.u8(a<<4|n):(this.b1vu56(1,a),this.vu57(n))}vu57(a){if(a<=127)this.u8(a);else if(a<=16383){this.ensureCapacity(2);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=a>>>7}else if(a<=2097151){this.ensureCapacity(3);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=a>>>14}else if(a<=268435455){this.ensureCapacity(4);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=128|a>>>14&127,n[this.x++]=a>>>21}else{let n=a|0;n<0&&(n+=4294967296);const u=(a-n)/4294967296;if(a<=34359738367){this.ensureCapacity(5);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=u<<4|a>>>28}else if(a<=4398046511103){this.ensureCapacity(6);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=u>>>3}else if(a<=562949953421311){this.ensureCapacity(7);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=u>>>10}else{this.ensureCapacity(8);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=128|(u&130048)>>>10,r[this.x++]=u>>>17}}}b1vu56(a,n){if(n<=63)this.u8(a<<7|n);else{const u=a<<7|64;if(n<=8191){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=n>>>6}else if(n<=1048575){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=n>>>13}else if(n<=134217727){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=128|n>>>13&127,r[this.x++]=n>>>20}else{let r=n|0;r<0&&(r+=4294967296);const c=(n-r)/4294967296;if(n<=17179869183){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=c<<5|n>>>27}else if(n<=2199023255551){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=c>>>2}else if(n<=0xffffffffffff){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=128|(c&508)>>>2,s[this.x++]=c>>>9}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(c&3)<<5|n>>>27,s[this.x++]=128|(c&508)>>>2,s[this.x++]=128|(c&65024)>>>9,s[this.x++]=c>>>16}}}}};return Mt.CrdtWriter=t,Mt}var Vt={},Jt={},Lc;function b0(){if(Lc)return Jt;Lc=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),t=d=>(e.setFloat32(0,d),d===e.getFloat32(0));return Jt.isFloat32=t,Jt}var Lt={},Dc;function Pl(){if(Dc)return Lt;Dc=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.JsonPackExtension=void 0;let e=class{constructor(d,a){this.tag=d,this.val=a}};return Lt.JsonPackExtension=e,Lt}var Dt={},Fc;function g0(){if(Fc)return Dt;Fc=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.CborEncoderFast=void 0;const e=jl(),t=Number.isSafeInteger;let d=class{constructor(n=new e.Writer){this.writer=n}encode(n){return this.writeAny(n),this.writer.flush()}encodeToSlice(n){return this.writeAny(n),this.writer.flushSlice()}writeAny(n){switch(typeof n){case"number":return this.writeNumber(n);case"string":return this.writeStr(n);case"boolean":return this.writer.u8(244+ +n);case"object":return n?n.constructor===Array?this.writeArr(n):this.writeObj(n):this.writer.u8(246)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(n){n?this.writer.u8(245):this.writer.u8(244)}writeNumber(n){t(n)?this.writeInteger(n):typeof n=="bigint"?this.writeBigInt(n):this.writeFloat(n)}writeBigInt(n){n>=0?this.writeBigUint(n):this.writeBigSint(n)}writeBigUint(n){if(n<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(n));this.writer.u8u64(27,n)}writeBigSint(n){if(n>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(n));const u=-BigInt(1)-n;this.writer.u8u64(59,u)}writeInteger(n){n>=0?this.writeUInteger(n):this.encodeNint(n)}writeUInteger(n){const u=this.writer;u.ensureCapacity(9);const r=u.uint8;let c=u.x;n<=23?r[c++]=0+n:n<=255?(r[c++]=24,r[c++]=n):n<=65535?(r[c++]=25,u.view.setUint16(c,n),c+=2):n<=4294967295?(r[c++]=26,u.view.setUint32(c,n),c+=4):(r[c++]=27,u.view.setBigUint64(c,BigInt(n)),c+=8),u.x=c}encodeNumber(n){this.writeNumber(n)}encodeInteger(n){this.writeInteger(n)}encodeUint(n){this.writeUInteger(n)}encodeNint(n){const u=-1-n,r=this.writer;r.ensureCapacity(9);const c=r.uint8;let s=r.x;u<24?c[s++]=32+u:u<=255?(c[s++]=56,c[s++]=u):u<=65535?(c[s++]=57,r.view.setUint16(s,u),s+=2):u<=4294967295?(c[s++]=58,r.view.setUint32(s,u),s+=4):(c[s++]=59,r.view.setBigUint64(s,BigInt(u)),s+=8),r.x=s}writeFloat(n){this.writer.u8f64(251,n)}writeBin(n){const u=n.length;this.writeBinHdr(u),this.writer.buf(n,u)}writeBinHdr(n){const u=this.writer;n<=23?u.u8(64+n):n<=255?u.u16(22528+n):n<=65535?u.u8u16(89,n):n<=4294967295?u.u8u32(90,n):u.u8u64(91,n)}writeStr(n){const u=this.writer,c=n.length*4;u.ensureCapacity(5+c);const s=u.uint8;let o=u.x;c<=23?u.x++:c<=255?(s[u.x++]=120,o=u.x,u.x++):c<=65535?(s[u.x++]=121,o=u.x,u.x+=2):(s[u.x++]=122,o=u.x,u.x+=4);const i=u.utf8(n);c<=23?s[o]=96+i:c<=255?s[o]=i:c<=65535?u.view.setUint16(o,i):u.view.setUint32(o,i)}writeStrHdr(n){const u=this.writer;n<=23?u.u8(96+n):n<=255?u.u16(30720+n):n<=65535?u.u8u16(121,n):u.u8u32(122,n)}writeAsciiStr(n){this.writeStrHdr(n.length),this.writer.ascii(n)}writeArr(n){const u=n.length;this.writeArrHdr(u);for(let r=0;r<u;r++)this.writeAny(n[r])}writeArrHdr(n){const u=this.writer;n<=23?u.u8(128+n):n<=255?u.u16(38912+n):n<=65535?u.u8u16(153,n):n<=4294967295?u.u8u32(154,n):u.u8u64(155,n)}writeObj(n){const u=Object.keys(n),r=u.length;this.writeObjHdr(r);for(let c=0;c<r;c++){const s=u[c];this.writeStr(s),this.writeAny(n[s])}}writeObjHdr(n){const u=this.writer;n<=23?u.u8(160+n):n<=255?u.u16(47104+n):n<=65535?u.u8u16(185,n):n<=4294967295?u.u8u32(186,n):u.u8u64(187,n)}writeMapHdr(n){this.writeObjHdr(n)}writeStartMap(){this.writer.u8(191)}writeTag(n,u){this.writeTagHdr(n),this.writeAny(u)}writeTagHdr(n){const u=this.writer;n<=23?u.u8(192+n):n<=255?u.u16(55296+n):n<=65535?u.u8u16(217,n):n<=4294967295?u.u8u32(218,n):u.u8u64(219,n)}writeTkn(n){const u=this.writer;n<=23?u.u8(224+n):n<=255&&u.u16(63488+n)}writeStartStr(){this.writer.u8(127)}writeStrChunk(n){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(n){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(n){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(n,u){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return Dt.CborEncoderFast=d,Dt}var Ft={},Uc;function Mi(){if(Uc)return Ft;Uc=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.JsonPackValue=void 0;let e=class{constructor(d){this.val=d}};return Ft.JsonPackValue=e,Ft}var Gc;function Ml(){if(Gc)return Vt;Gc=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.CborEncoder=void 0;const e=b0(),t=Pl(),d=g0(),a=Mi();let n=class extends d.CborEncoderFast{writeUnknown(r){this.writeNull()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Object:return this.writeObj(r);case Array:return this.writeArr(r);case Uint8Array:return this.writeBin(r);case Map:return this.writeMap(r);case t.JsonPackExtension:return this.writeTag(r.tag,r.val);case a.JsonPackValue:const s=r.val;return this.writer.buf(s,s.length);default:return r instanceof Uint8Array?this.writeBin(r):Array.isArray(r)?this.writeArr(r):r instanceof Map?this.writeMap(r):this.writeUnknown(r)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(r);default:return this.writeUnknown(r)}}writeFloat(r){(0,e.isFloat32)(r)?this.writer.u8f32(250,r):this.writer.u8f64(251,r)}writeMap(r){this.writeMapHdr(r.size),r.forEach((c,s)=>{this.writeAny(s),this.writeAny(c)})}writeUndef(){this.writer.u8(247)}};return Vt.CborEncoder=n,Vt}var Pe={},Hc;function ql(){if(Hc)return Pe;Hc=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.CRDT_MAJOR_OVERLAY=Pe.CRDT_MAJOR=void 0;var e;(function(d){d[d.CON=0]="CON",d[d.VAL=1]="VAL",d[d.OBJ=2]="OBJ",d[d.VEC=3]="VEC",d[d.STR=4]="STR",d[d.BIN=5]="BIN",d[d.ARR=6]="ARR"})(e||(Pe.CRDT_MAJOR=e={}));var t;return(function(d){d[d.CON=0]="CON",d[d.VAL=32]="VAL",d[d.VEC=96]="VEC",d[d.OBJ=64]="OBJ",d[d.STR=128]="STR",d[d.BIN=160]="BIN",d[d.ARR=192]="ARR"})(t||(Pe.CRDT_MAJOR_OVERLAY=t={})),Pe}var zc;function y0(){if(zc)return Tt;zc=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Encoder=void 0;const t=L.__importStar(ke()),d=p0(),a=Pi(),n=H(),u=Ml(),r=ql();class c extends u.CborEncoder{constructor(o){super(o||new a.CrdtWriter),this.clockEncoder=new d.ClockEncoder,this.time=0,this.cTableEntry=i=>{const f=i.clock,m=this.writer;m.vu57(f.sid),m.vu57(f.time)},this.tsLogical=i=>{const f=this.clockEncoder.append(i);this.writer.id(f.sessionIndex,f.timeDiff)},this.tsServer=i=>{this.writer.vu57(i.time)},this.ts=this.tsLogical,this.cKey=(i,f)=>{this.writeStr(f),this.cNode(this.doc.index.get(i))}}encode(o){this.doc=o;const i=this.writer;return i.reset(),o.clock.sid===1?this.encodeServer(o):this.encodeLogical(o),i.flush()}encodeLogical(o){const i=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(o.clock),i.ensureCapacity(4);const f=i.x0,m=i.x;i.x+=4,this.cRoot(o.root),this.encodeClockTable(f,m)}encodeServer(o){this.ts=this.tsServer;const i=this.writer;i.u8(128),i.vu57(this.time=o.clock.time),this.cRoot(o.root)}encodeClockTable(o,i){const f=this.writer,m=f.x0-o;f.view.setUint32(f.x0+(i-o),f.x-i-m-4);const w=this.clockEncoder.table,g=w.size;f.vu57(g),w.forEach(this.cTableEntry)}cRoot(o){o.val.sid===0?this.writer.u8(0):this.cNode(o.node())}writeTL(o,i){const f=this.writer;i<31?f.u8(o|i):(f.u8(o|31),f.vu57(i))}cNode(o){o instanceof t.ConNode?this.cCon(o):o instanceof t.ValNode?this.cVal(o):o instanceof t.StrNode?this.cStr(o):o instanceof t.ObjNode?this.cObj(o):o instanceof t.VecNode?this.cVec(o):o instanceof t.ArrNode?this.cArr(o):o instanceof t.BinNode&&this.cBin(o)}cCon(o){const i=o.val;this.ts(o.id),i instanceof n.Timestamp?(this.writer.u8(1),this.ts(i)):(this.writer.u8(0),this.writeAny(i))}cVal(o){this.ts(o.id),this.writer.u8(32),this.cNode(o.node())}cObj(o){this.ts(o.id);const i=o.keys;this.writeTL(r.CRDT_MAJOR_OVERLAY.OBJ,i.size),i.forEach(this.cKey)}cVec(o){const i=o.elements,f=i.length;this.ts(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.VEC,f);const m=this.doc.index;for(let p=0;p<f;p++){const w=i[p];w?this.cNode(m.get(w)):this.writer.u8(0)}}cStr(o){const i=this.ts;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.STR,o.count);for(let f=o.first();f;f=o.next(f))i(f.id),f.del?this.writeUInteger(f.span):this.writeStr(f.data)}cBin(o){const i=this.ts,f=this.writer;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.BIN,o.count);for(let m=o.first();m;m=o.next(m)){i(m.id);const p=m.span,w=m.del;f.b1vu56(~~w,p),!w&&f.buf(m.data,p)}}cArr(o){const i=this.ts,f=this.writer;i(o.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.ARR,o.count);const m=this.doc.index;for(let p=o.first();p;p=o.next(p)){i(p.id);const w=p.span,g=p.del;if(f.b1vu56(~~g,w),g)continue;const b=p.data;for(let l=0;l<w;l++)this.cNode(m.get(b[l]))}}}return Tt.Encoder=c,Tt}var Ut={},Gt={},Wc;function v0(){if(Wc)return Gt;Wc=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ClockDecoder=void 0;const e=H();let t=class Bl{static fromArr(a){const n=new Bl(a[0],a[1]),u=a.length;for(let r=2;r<u;r+=2)n.pushTuple(a[r],a[r+1]);return n}constructor(a,n){this.table=[],this.clock=new e.ClockVector(a,n+1),this.table.push((0,e.ts)(a,n))}pushTuple(a,n){const u=(0,e.ts)(a,n);this.clock.observe(u,1),this.table.push(u)}decodeId(a,n){if(!a)return(0,e.ts)(0,n);const u=this.table[a-1];if(!u)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(u.sid,u.time-n)}};return Gt.ClockDecoder=t,Gt}var Ht={},zt={},Wt={},vr={},Me={},Kc;function w0(){if(Kc)return Me;Kc=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.decodeAsciiMax15=Me.decodeAscii=void 0;const e=String.fromCharCode,t=(a,n,u)=>{const r=[];for(let c=0;c<u;c++){const s=a[n++];if(s&128)return;r.push(s)}return e.apply(String,r)};Me.decodeAscii=t;const d=(a,n,u)=>{if(u<4)if(u<2){if(u===0)return"";{const r=a[n++];if((r&128)>1){n-=1;return}return e(r)}}else{const r=a[n++],c=a[n++];if((r&128)>0||(c&128)>0){n-=2;return}if(u<3)return e(r,c);const s=a[n++];if((s&128)>0){n-=3;return}return e(r,c,s)}else{const r=a[n++],c=a[n++],s=a[n++],o=a[n++];if((r&128)>0||(c&128)>0||(s&128)>0||(o&128)>0){n-=4;return}if(u<6){if(u===4)return e(r,c,s,o);{const i=a[n++];if((i&128)>0){n-=5;return}return e(r,c,s,o,i)}}else if(u<8){const i=a[n++],f=a[n++];if((i&128)>0||(f&128)>0){n-=6;return}if(u<7)return e(r,c,s,o,i,f);const m=a[n++];if((m&128)>0){n-=7;return}return e(r,c,s,o,i,f,m)}else{const i=a[n++],f=a[n++],m=a[n++],p=a[n++];if((i&128)>0||(f&128)>0||(m&128)>0||(p&128)>0){n-=8;return}if(u<10){if(u===8)return e(r,c,s,o,i,f,m,p);{const w=a[n++];if((w&128)>0){n-=9;return}return e(r,c,s,o,i,f,m,p,w)}}else if(u<12){const w=a[n++],g=a[n++];if((w&128)>0||(g&128)>0){n-=10;return}if(u<11)return e(r,c,s,o,i,f,m,p,w,g);const b=a[n++];if((b&128)>0){n-=11;return}return e(r,c,s,o,i,f,m,p,w,g,b)}else{const w=a[n++],g=a[n++],b=a[n++],l=a[n++];if((w&128)>0||(g&128)>0||(b&128)>0||(l&128)>0){n-=12;return}if(u<14){if(u===12)return e(r,c,s,o,i,f,m,p,w,g,b,l);{const h=a[n++];if((h&128)>0){n-=13;return}return e(r,c,s,o,i,f,m,p,w,g,b,l,h)}}else{const h=a[n++],v=a[n++];if((h&128)>0||(v&128)>0){n-=14;return}if(u<15)return e(r,c,s,o,i,f,m,p,w,g,b,l,h,v);const y=a[n++];if((y&128)>0){n-=15;return}return e(r,c,s,o,i,f,m,p,w,g,b,l,h,v,y)}}}}};return Me.decodeAsciiMax15=d,Me}var wr={},Yc;function _0(){if(Yc)return wr;Yc=1,Object.defineProperty(wr,"__esModule",{value:!0});const e=String.fromCharCode;return wr.default=(t,d,a)=>{let n=d;const u=n+a,r=[];for(;n<u;){let c=t[n++];if((c&128)!==0){const s=t[n++]&63;if((c&224)===192)c=(c&31)<<6|s;else{const o=t[n++]&63;if((c&240)===224)c=(c&31)<<12|s<<6|o;else if((c&248)===240){const i=t[n++]&63;let f=(c&7)<<18|s<<12|o<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;c=56320|f&1023,r.push(m)}else c=f}}}r.push(c)}return e.apply(String,r)},wr}var Xc;function C0(){if(Xc)return vr;Xc=1,Object.defineProperty(vr,"__esModule",{value:!0});const e=L,t=w0(),d=e.__importDefault(_0()),a=typeof ce.Buffer<"u",n=a?ce.Buffer.prototype.utf8Slice:null,u=a?ce.Buffer.from:null,r=(i,f,m)=>(0,t.decodeAsciiMax15)(i,f,m)??(0,d.default)(i,f,m),c=(i,f,m)=>(0,t.decodeAscii)(i,f,m)??(0,d.default)(i,f,m),s=n?(i,f,m)=>n.call(i,f,f+m):u?(i,f,m)=>u(i).subarray(f,f+m).toString("utf8"):d.default,o=(i,f,m)=>m<16?r(i,f,m):m<32?c(i,f,m):s(i,f,m);return vr.default=o,vr}var Qc;function S0(){if(Qc)return Wt;Qc=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.decodeUtf8=void 0;const t=L.__importDefault(C0());return Wt.decodeUtf8=t.default,Wt}var Zc;function Vl(){if(Zc)return zt;Zc=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Reader=void 0;const e=S0();let t=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(a){this.x=0,this.uint8=a,this.view=new DataView(a.buffer,a.byteOffset,a.length)}peak(){return this.view.getUint8(this.x)}skip(a){this.x+=a}buf(a){const n=this.x+a,u=this.uint8.subarray(this.x,n);return this.x=n,u}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let a=this.x;const n=(this.uint8[a++]<<8)+this.uint8[a++];return this.x=a,n}i16(){const a=this.view.getInt16(this.x);return this.x+=2,a}u32(){const a=this.view.getUint32(this.x);return this.x+=4,a}i32(){const a=this.view.getInt32(this.x);return this.x+=4,a}u64(){const a=this.view.getBigUint64(this.x);return this.x+=8,a}i64(){const a=this.view.getBigInt64(this.x);return this.x+=8,a}f32(){const a=this.x;return this.x+=4,this.view.getFloat32(a)}f64(){const a=this.x;return this.x+=8,this.view.getFloat64(a)}utf8(a){const n=this.x;return this.x+=a,(0,e.decodeUtf8)(this.uint8,n,a)}ascii(a){const n=this.uint8;let u="";const r=this.x+a;for(let c=this.x;c<r;c++)u+=String.fromCharCode(n[c]);return this.x=r,u}};return zt.Reader=t,zt}var $c;function Jl(){if($c)return Ht;$c=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CrdtReader=void 0;const e=Vl();let t=class extends e.Reader{id(){const a=this.u8();return a<=127?[a>>>4,a&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const a=this.u8();if(a<=127)return a;const n=this.u8();if(n<=127)return n<<7|a&127;const u=this.u8();if(u<=127)return u<<14|(n&127)<<7|a&127;const r=this.u8();if(r<=127)return r<<21|(u&127)<<14|(n&127)<<7|a&127;const c=this.u8();if(c<=127)return c*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127);const s=this.u8();if(s<=127)return s*34359738368+((c&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127));const o=this.u8();return o<=127?o*4398046511104+((s&127)*34359738368+((c&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127))):this.u8()*562949953421312+((o&127)*4398046511104+((s&127)*34359738368+((c&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const a=this.u8(),n=a&128?1:0,u=127&a;if(u<=63)return[n,u];const r=this.u8();if(r<=127)return[n,r<<6|u&63];const c=this.u8();if(c<=127)return[n,c<<13|(r&127)<<6|u&63];const s=this.u8();if(s<=127)return[n,s<<20|(c&127)<<13|(r&127)<<6|u&63];const o=this.u8();if(o<=127)return[n,o*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|u&63)];const i=this.u8();if(i<=127)return[n,i*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|u&63))];const f=this.u8();if(f<=127)return[n,f*2199023255552+((i&127)*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|u&63)))];const m=this.u8();return[n,m*281474976710656+((f&127)*2199023255552+((i&127)*17179869184+((o&127)*134217728+((s&127)<<20|(c&127)<<13|(r&127)<<6|u&63))))]}};return Ht.CrdtReader=t,Ht}var Kt={},Yt={},ea;function O0(){if(ea)return Yt;ea=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.decodeF16=void 0;const e=Math.pow,t=d=>{const a=(d&31744)>>10,n=d&1023;return(d>>15?-1:1)*(a?a===31?n?NaN:1/0:e(2,a-15)*(1+n/1024):6103515625e-14*(n/1024))};return Yt.decodeF16=t,Yt}var _r={},Xt={},Cr={},ta;function E0(){if(ta)return Cr;ta=1,Object.defineProperty(Cr,"__esModule",{value:!0});const e=String.fromCharCode;return Cr.default=(t,d,a)=>{let n=d;const u=n+a;let r="";for(;n<u;){const c=t[n++];if((c&128)===0){r+=e(c);continue}const s=t[n++]&63;if((c&224)===192){r+=e((c&31)<<6|s);continue}const o=t[n++]&63;if((c&240)===224){r+=e((c&31)<<12|s<<6|o);continue}if((c&248)===240){const i=t[n++]&63;let f=(c&7)<<18|s<<12|o<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;f=56320|f&1023,r+=e(m,f)}else r+=e(f)}else r+=e(c)}return r},Cr}var na;function k0(){if(na)return Xt;na=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.CachedUtf8Decoder=void 0;const t=L.__importDefault(E0());let d=1+Math.round(Math.random()*((-1>>>0)-1));function a(r,c){return d^=d<<13,d^=d>>>17,d^=d<<5,(d>>>0)%(c-r+1)+r}class n{constructor(c,s){this.bytes=c,this.value=s}}let u=class{constructor(){this.caches=[];for(let c=0;c<31;c++)this.caches.push([])}get(c,s,o){const i=this.caches[o-1],f=i.length;e:for(let m=0;m<f;m++){const p=i[m],w=p.bytes;for(let g=0;g<o;g++)if(w[g]!==c[s+g])continue e;return p.value}return null}store(c,s){const o=this.caches[c.length-1],i=new n(c,s);o.length>=16?o[a(0,15)]=i:o.push(i)}decode(c,s,o){if(!o)return"";const i=this.get(c,s,o);if(i!==null)return i;const f=(0,t.default)(c,s,o),m=Uint8Array.prototype.slice.call(c,s,s+o);return this.store(m,f),f}};return Xt.CachedUtf8Decoder=u,Xt}var ra;function x0(){if(ra)return _r;ra=1,Object.defineProperty(_r,"__esModule",{value:!0});const e=k0();return _r.default=new e.CachedUtf8Decoder,_r}var sa;function Ll(){if(sa)return Kt;sa=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.CborDecoderBase=void 0;const e=L,t=O0(),d=Pl(),a=Mi(),n=Vl(),u=e.__importDefault(x0());let r=class{constructor(s=new n.Reader,o=u.default){this.reader=s,this.keyDecoder=o}read(s){return this.reader.reset(s),this.val()}decode(s){return this.reader.reset(s),this.val()}val(){const o=this.reader.u8(),i=o>>5,f=o&31;return i<4?i<2?i===0?this.readUint(f):this.readNint(f):i===2?this.readBin(f):this.readStr(f):i<6?i===4?this.readArr(f):this.readObj(f):i===6?this.readTag(f):this.readTkn(f)}readAnyRaw(s){const o=s>>5,i=s&31;return o<4?o<2?o===0?this.readUint(i):this.readNint(i):o===2?this.readBin(i):this.readStr(i):o<6?o===4?this.readArr(i):this.readObj(i):o===6?this.readTag(i):this.readTkn(i)}readMinorLen(s){if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(s){if(s<25)return s===24?this.reader.u8():s;if(s<27)return s===25?this.reader.u16():this.reader.u32();{const o=this.reader.u64();return o>9007199254740991?o:Number(o)}}readNint(s){if(s<25)return s===24?-this.reader.u8()-1:-s-1;if(s<27)return s===25?-this.reader.u16()-1:-this.reader.u32()-1;{const o=this.reader.u64();return o>9007199254740991-1?-o-BigInt(1):-Number(o)-1}}readBin(s){const o=this.reader;if(s<=23)return o.buf(s);switch(s){case 24:return o.buf(o.u8());case 25:return o.buf(o.u16());case 26:return o.buf(o.u32());case 27:return o.buf(Number(o.u64()));case 31:{let i=0;const f=[];for(;this.reader.peak()!==255;){const g=this.readBinChunk();i+=g.length,f.push(g)}this.reader.x++;const m=new Uint8Array(i);let p=0;const w=f.length;for(let g=0;g<w;g++){const b=f[g];m.set(b,p),p+=b.length}return m}default:throw 1}}readBinChunk(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==2)throw 2;if(i>27)throw 3;return this.readBin(i)}readAsStr(){const o=this.reader.u8(),i=o>>5,f=o&31;if(i!==3)throw 11;return this.readStr(f)}readStr(s){const o=this.reader;if(s<=23)return o.utf8(s);switch(s){case 24:return o.utf8(o.u8());case 25:return o.utf8(o.u16());case 26:return o.utf8(o.u32());case 27:return o.utf8(Number(o.u64()));case 31:{let i="";for(;o.peak()!==255;)i+=this.readStrChunk();return this.reader.x++,i}default:throw 1}}readStrLen(s){if(s<=23)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==3)throw 4;if(i>27)throw 5;return this.readStr(i)}readArr(s){const o=this.readMinorLen(s);return o>=0?this.readArrRaw(o):this.readArrIndef()}readArrRaw(s){const o=[];for(let i=0;i<s;i++)o.push(this.val());return o}readArrIndef(){const s=[];for(;this.reader.peak()!==255;)s.push(this.val());return this.reader.x++,s}readObj(s){if(s<28){let o=s;switch(s){case 24:o=this.reader.u8();break;case 25:o=this.reader.u16();break;case 26:o=this.reader.u32();break;case 27:o=Number(this.reader.u64());break}const i={};for(let f=0;f<o;f++){const m=this.key();if(m==="__proto__")throw 6;const p=this.val();i[m]=p}return i}else{if(s===31)return this.readObjIndef();throw 1}}readObjRaw(s){const o={};for(let i=0;i<s;i++){const f=this.key(),m=this.val();o[f]=m}return o}readObjIndef(){const s={};for(;this.reader.peak()!==255;){const o=this.key();if(this.reader.peak()===255)throw 7;const i=this.val();s[o]=i}return this.reader.x++,s}key(){const s=this.reader.u8(),o=s>>5,i=s&31;if(o!==3)return String(this.readAnyRaw(s));const f=this.readStrLen(i);if(f>31)return this.reader.utf8(f);const m=this.keyDecoder.decode(this.reader.uint8,this.reader.x,f);return this.reader.skip(f),m}readTag(s){if(s<=23)return this.readTagRaw(s);switch(s){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(s){return new d.JsonPackExtension(s,this.val())}readTkn(s){switch(s){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new a.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(s<=23)return new a.JsonPackValue(s);throw 1}f16(){return(0,t.decodeF16)(this.reader.u16())}};return Kt.CborDecoderBase=r,Kt}var ia;function A0(){if(ia)return Ut;ia=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Decoder=void 0;const t=L.__importStar(ke()),d=v0(),a=Jl(),n=H(),u=Li(),r=Ll(),c=ql();class s extends r.CborDecoderBase{constructor(){super(new a.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const i=this.ts(),f=this.val();return typeof f=="string"?new t.StrChunk(i,f.length,f):new t.StrChunk(i,~~f,"")},this.cBinChunk=()=>{const i=this.ts(),f=this.reader,[m,p]=f.b1vu56();return m?new t.BinChunk(i,p,void 0):new t.BinChunk(i,p,f.buf(p))},this.cArrChunk=()=>{const i=this.ts(),[f,m]=this.reader.b1vu56();if(f)return new t.ArrChunk(i,m,void 0);const p=[];for(let w=0;w<m;w++)p.push(this.cNode().id);return new t.ArrChunk(i,m,p)}}decode(i,f){this.clockDecoder=void 0,this.time=-1;const m=this.reader;if(m.reset(i),m.peak()&128){m.x++;const w=this.time=m.vu57();f||(f=u.Model.withServerClock(void 0,w))}else if(this.decodeClockTable(),!f){const w=this.clockDecoder.clock;f=u.Model.create(void 0,w)}return this.doc=f,f.root=new t.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,f}decodeClockTable(){const i=this.reader,f=i.u32(),m=i.x;i.x+=f;const p=i.vu57(),w=i.vu57(),g=i.vu57();this.clockDecoder=new d.ClockDecoder(w,g);for(let b=1;b<p;b++){const l=i.vu57(),h=i.vu57();this.clockDecoder.pushTuple(l,h)}i.x=m}ts(){if(this.time<0){const[m,p]=this.reader.id();return this.clockDecoder.decodeId(m,p)}else return new n.Timestamp(1,this.reader.vu57())}cRoot(){const i=this.reader;return i.uint8[i.x]?this.cNode():u.UNDEFINED}cNode(){const i=this.reader,f=this.ts(),m=i.u8(),p=m>>5,w=m&31;switch(p){case c.CRDT_MAJOR.CON:return this.cCon(f,w);case c.CRDT_MAJOR.VAL:return this.cVal(f);case c.CRDT_MAJOR.OBJ:return this.cObj(f,w!==31?w:i.vu57());case c.CRDT_MAJOR.VEC:return this.cVec(f,w!==31?w:i.vu57());case c.CRDT_MAJOR.STR:return this.cStr(f,w!==31?w:i.vu57());case c.CRDT_MAJOR.BIN:return this.cBin(f,w!==31?w:i.vu57());case c.CRDT_MAJOR.ARR:return this.cArr(f,w!==31?w:i.vu57())}throw new Error("UNKNOWN_NODE")}cCon(i,f){const m=this.doc,p=f?this.ts():this.val(),w=new t.ConNode(i,p);return m.index.set(i,w),w}cVal(i){const f=this.cNode(),m=this.doc,p=new t.ValNode(m,i,f.id);return m.index.set(i,p),p}cObj(i,f){const m=new t.ObjNode(this.doc,i);for(let p=0;p<f;p++)this.cObjChunk(m);return this.doc.index.set(i,m),m}cObjChunk(i){const f=this.key();i.keys.set(f,this.cNode().id)}cVec(i,f){const m=this.reader,p=new t.VecNode(this.doc,i),w=p.elements;for(let g=0;g<f;g++)m.peak()?w.push(this.cNode().id):(m.x++,w.push(void 0));return this.doc.index.set(i,p),p}cStr(i,f){const m=new t.StrNode(i);return f&&m.ingest(f,this.cStrChunk),this.doc.index.set(i,m),m}cBin(i,f){const m=new t.BinNode(i);return f&&m.ingest(f,this.cBinChunk),this.doc.index.set(i,m),m}cArr(i,f){const m=new t.ArrNode(this.doc,i);return f&&m.ingest(f,this.cArrChunk),this.doc.index.set(i,m),m}}return Ut.Decoder=s,Ut}var oa;function N0(){if(oa)return je;oa=1,Object.defineProperty(je,"__esModule",{value:!0}),je.decoder=je.encoder=void 0;const e=y0(),t=A0();return je.encoder=new e.Encoder,je.decoder=new t.Decoder,je}var qs={},K={},Qt={},ca;function R0(){if(ca)return Qt;ca=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.find=void 0;const e=Rr(),t=ke(),d=(a,n)=>{const u=(0,e.toPath)(n);let r=a;const c=u.length;if(!c)return r;let s=0;for(;s<c&&r;){const o=u[s++];if(r=r.container(),!r)throw new Error("NOT_CONTAINER");if(r instanceof t.ObjNode){const i=r.get(String(o));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.ArrNode){const i=r.getNode(Number(o));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.VecNode){const i=r.get(Number(o));if(!i)throw new Error("NOT_FOUND");r=i}}return r};return Qt.find=d,Qt}var Zt={},fe={},$t={},aa;function Dl(){if(aa)return $t;aa=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(d){this.listeners.forEach(a=>a(d))}listen(d){const a=this.listeners;return a.add(d),()=>a.delete(d)}}return $t.FanOut=e,$t}var ua;function Fl(){if(ua)return fe;ua=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.OnNewFanOut=fe.MapFanOut=fe.MicrotaskBufferFanOut=fe.MergeFanOut=void 0;const e=Dl();class t extends e.FanOut{constructor(r){super(),this.fanouts=r,this.unsubs=[]}listen(r){this.listeners.size||(this.unsubs=this.fanouts.map(s=>s.listen(o=>this.emit(o))));const c=super.listen(r);return()=>{if(c(),!this.listeners.size){for(const s of this.unsubs)s();this.unsubs=[]}}}}fe.MergeFanOut=t;class d extends e.FanOut{constructor(r){super(),this.source=r,this.buffer=[],this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{const o=this.buffer;o.length||queueMicrotask(()=>{this.emit(o),this.buffer=[]}),o.push(s)}));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}fe.MicrotaskBufferFanOut=d;class a extends e.FanOut{constructor(r,c){super(),this.source=r,this.mapper=c,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>this.emit(this.mapper(s))));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}fe.MapFanOut=a;class n extends e.FanOut{constructor(r,c=void 0){super(),this.source=r,this.last=c,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{this.last!==s&&this.emit(this.last=s)}));const c=super.listen(r);return()=>{c(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}return fe.OnNewFanOut=n,fe}var la;function I0(){if(la)return Zt;la=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.NodeEvents=void 0;const e=Fl();let t=class{constructor(a){this.api=a,this.subscribe=n=>this.onViewChanges.listen(()=>n()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Zt.NodeEvents=t,Zt}var en={},tn={},da;function qi(){return da||(da=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.isUint8Array=void 0,tn.isUint8Array=typeof ce.Buffer=="function"?e=>e instanceof Uint8Array||ce.Buffer.isBuffer(e):e=>e instanceof Uint8Array),tn}var nn={},Bs={},rn={},fa;function Ul(){if(fa)return rn;fa=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.Encoder=void 0;const t=L.__importStar(Ye()),d=Pi(),a=H(),n=Ml();class u extends n.CborEncoder{constructor(c=new d.CrdtWriter){super(c),this.writer=c,this.patchSid=0}encode(c){this.writer.reset();const s=c.getId(),o=this.patchSid=s.sid,i=this.writer;i.vu57(o),i.vu57(s.time);const f=c.meta;return f===void 0?this.writeUndef():this.writeArr([f]),this.encodeOperations(c),i.flush()}encodeOperations(c){const s=c.ops,o=s.length;this.writer.vu57(o);for(let i=0;i<o;i++)this.encodeOperation(s[i])}encodeId(c){const s=c.sid,o=c.time,i=this.writer;s===this.patchSid?i.b1vu56(0,o):(i.b1vu56(1,o),i.vu57(s))}encodeTss(c){this.encodeId(c),this.writer.vu57(c.span)}writeInsStr(c,s,o,i){const f=this.writer;return c<=7?f.u8(96+c):(f.u8(96),f.vu57(c)),this.encodeId(s),this.encodeId(o),f.utf8(i)}encodeOperation(c){const s=this.writer;switch(c.constructor){case t.NewConOp:{const f=c.val;f instanceof a.Timestamp?(s.u8(1),this.encodeId(f)):(s.u8(0),this.writeAny(f));break}case t.NewValOp:{s.u8(8);break}case t.NewObjOp:{s.u8(16);break}case t.NewVecOp:{s.u8(24);break}case t.NewStrOp:{s.u8(32);break}case t.NewBinOp:{s.u8(40);break}case t.NewArrOp:{s.u8(48);break}case t.InsValOp:{const i=c;s.u8(72),this.encodeId(i.obj),this.encodeId(i.val);break}case t.InsObjOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(80+m):(s.u8(80),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const w=f[p];this.writeStr(w[0]),this.encodeId(w[1])}break}case t.InsVecOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(88+m):(s.u8(88),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const w=f[p];s.u8(w[0]),this.encodeId(w[1])}break}case t.InsStrOp:{const i=c,f=i.obj,m=i.ref,p=i.data,w=p.length;s.ensureCapacity(24+w*4);const g=s.x,b=this.writeInsStr(w,f,m,p);w!==b&&(s.x=g,this.writeInsStr(b,f,m,p));break}case t.InsBinOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(104+m):(s.u8(104),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref),s.buf(f,m);break}case t.InsArrOp:{const i=c,f=i.data,m=f.length;m<=7?s.u8(112+m):(s.u8(112),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref);for(let p=0;p<m;p++)this.encodeId(f[p]);break}case t.UpdArrOp:{const i=c;s.u8(120),this.encodeId(i.obj),this.encodeId(i.ref),this.encodeId(i.val);break}case t.DelOp:{const i=c,f=i.what,m=f.length;m<=7?s.u8(128+m):(s.u8(128),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++)this.encodeTss(f[p]);break}case t.NopOp:{const f=c.len;f<=7?s.u8(136+f):(s.u8(136),s.vu57(f));break}default:throw new Error("UNKNOWN_OP")}}}return rn.Encoder=u,rn}var sn={},on={},ha;function T0(){if(ha)return on;ha=1,Object.defineProperty(on,"__esModule",{value:!0}),on.CborDecoder=void 0;const e=Ll(),t=Mi();let d=class extends e.CborDecoderBase{readAsMap(){const n=this.reader.u8(),u=n>>5,r=n&31;if(u===5)return this.readMap(r);throw 0}readMap(n){const u=this.readMinorLen(n);return u>=0?this.readMapRaw(u):this.readMapIndef()}readMapRaw(n){const u=new Map;for(let r=0;r<n;r++){const c=this.val(),s=this.val();u.set(c,s)}return u}readMapIndef(){const n=new Map;for(;this.reader.peak()!==255;){const u=this.val();if(this.reader.peak()===255)throw 7;const r=this.val();n.set(u,r)}return this.reader.x++,n}skipN(n){for(let u=0;u<n;u++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(n){const u=n>>5,r=n&31;switch(u){case 0:case 1:this.skipUNint(r);break;case 2:this.skipBin(r);break;case 3:this.skipStr(r);break;case 4:this.skipArr(r);break;case 5:this.skipObj(r);break;case 7:this.skipTkn(r);break;case 6:this.skipTag(r);break}}skipMinorLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(n){if(!(n<=23))switch(n){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(n){const u=this.skipMinorLen(n);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const n=this.reader.u8(),u=n>>5,r=n&31;if(u!==2)throw 2;if(r>27)throw 3;this.skipBin(r)}skipStr(n){const u=this.skipMinorLen(n);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const n=this.reader.u8(),u=n>>5,r=n&31;if(u!==3)throw 4;if(r>27)throw 5;this.skipStr(r)}skipArr(n){const u=this.skipMinorLen(n);if(u>=0)this.skipN(u);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(n){const u=this.readMinorLen(n);if(u>=0)return this.skipN(u*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(n){if(this.skipMinorLen(n)<0)throw 1;this.skipAny()}skipTkn(n){switch(n){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(n<=23))throw 1}validate(n,u=0,r=n.length){this.reader.reset(n),this.reader.x=u;const c=u;if(this.skipAny(),this.reader.x-c!==r)throw 8}decodeLevel(n){return this.reader.reset(n),this.readLevel()}readLevel(){const n=this.reader.u8(),u=n>>5,r=n&31;switch(u){case 4:return this.readArrLevel(r);case 5:return this.readObjLevel(r);default:return super.readAnyRaw(n)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const n=this.reader,u=n.x;this.skipAny();const r=n.x;return new t.JsonPackValue(n.uint8.subarray(u,r))}readObjLevel(n){const u=this.readMinorLen(n);return u>=0?this.readObjRawLevel(u):this.readObjIndefLevel()}readObjRawLevel(n){const u={};for(let r=0;r<n;r++){const c=this.key(),s=this.readPrimitiveOrVal();u[c]=s}return u}readObjIndefLevel(){const n={};for(;this.reader.peak()!==255;){const u=this.key();if(this.reader.peak()===255)throw 7;const r=this.readPrimitiveOrVal();n[u]=r}return this.reader.x++,n}readArrLevel(n){const u=this.readMinorLen(n);return u>=0?this.readArrRawLevel(u):this.readArrIndefLevel()}readArrRawLevel(n){const u=[];for(let r=0;r<n;r++)u.push(this.readPrimitiveOrVal());return u}readArrIndefLevel(){const n=[];for(;this.reader.peak()!==255;)n.push(this.readPrimitiveOrVal());return this.reader.x++,n}readHdr(n){const u=this.reader.u8();if(u>>5!==n)throw 0;const c=u&31;if(c<24)return c;switch(c){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(n){const u=this.readObjHdr();for(let r=0;r<u;r++){if(this.key()===n)return this;this.skipAny()}throw 9}findIndex(n){const u=this.readArrHdr();if(n>=u)throw 10;for(let r=0;r<n;r++)this.skipAny();return this}find(n){for(let u=0;u<n.length;u++){const r=n[u];typeof r=="string"?this.findKey(r):this.findIndex(r)}return this}};return on.CborDecoder=d,on}var pa;function Gl(){if(pa)return sn;pa=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.Decoder=void 0;const e=Jl(),t=H(),d=Mr(),a=T0();let n=class extends a.CborDecoder{constructor(r=new e.CrdtReader){super(r)}decode(r){return this.reader.reset(r),this.readPatch()}readPatch(){const r=this.reader,c=r.vu57(),s=r.vu57(),i=c===1?new t.ServerClockVector(1,s):new t.ClockVector(c,s);this.patchSid=i.sid;const f=this.builder=new d.PatchBuilder(i),m=this.val();return Array.isArray(m)&&(f.patch.meta=m[0]),this.decodeOperations(),f.patch}decodeId(){const r=this.reader,[c,s]=r.b1vu56();return c?new t.Timestamp(r.vu57(),s):new t.Timestamp(this.patchSid,s)}decodeTss(){const r=this.decodeId(),c=this.reader.vu57();return(0,t.interval)(r,0,c)}decodeOperations(){const c=this.reader.vu57();for(let s=0;s<c;s++)this.decodeOperation()}decodeOperation(){const r=this.builder,c=this.reader,s=c.u8();switch(s>>3){case 0:{const i=s&7;r.con(i?this.decodeId():this.val());break}case 1:{r.val();break}case 2:{r.obj();break}case 3:{r.vec();break}case 4:{r.str();break}case 5:{r.bin();break}case 6:{r.arr();break}case 9:{const i=this.decodeId(),f=this.decodeId();r.setVal(i,f);break}case 10:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const w=this.val();if(typeof w!="string")continue;const g=this.decodeId();m.push([w,g])}r.insObj(f,m);break}case 11:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const w=this.val();if(typeof w!="number")continue;const g=this.decodeId();m.push([w,g])}r.insVec(f,m);break}case 12:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=c.utf8(i);r.insStr(f,m,p);break}case 13:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=c.buf(i);if(!(p instanceof Uint8Array))return;r.insBin(f,m,p);break}case 14:{const i=s&7||c.vu57(),f=this.decodeId(),m=this.decodeId(),p=[];for(let w=0;w<i;w++)p.push(this.decodeId());r.insArr(f,m,p);break}case 15:{const i=this.decodeId(),f=this.decodeId(),m=this.decodeId();r.updArr(i,f,m);break}case 16:{const i=s&7||c.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++)m.push(this.decodeTss());r.del(f,m);break}case 17:{const i=s&7||c.vu57();r.nop(i);break}default:throw new Error("UNKNOWN_OP")}}};return sn.Decoder=n,sn}var Vs={},ma;function j0(){return ma||(ma=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const t=Ul(),d=Gl(),a=Pi(),n=new a.CrdtWriter(1024*4);e.encoder=new t.Encoder(n);const u=c=>e.encoder.encode(c);e.encode=u,e.decoder=new d.Decoder;const r=c=>e.decoder.decode(c);e.decode=r})(Vs)),Vs}var ba;function P0(){return ba||(ba=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Ul(),e),t.__exportStar(Gl(),e),t.__exportStar(j0(),e)})(Bs)),Bs}var ga;function zl(){if(ga)return nn;ga=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.Patch=void 0;const t=L.__importStar(Ye()),d=H(),a=he(),n=P0();let u=class Hl{constructor(){this.ops=[],this.meta=void 0}static fromBinary(c){return(0,n.decode)(c)}getId(){const c=this.ops[0];if(c)return c.id}span(){let c=0;for(const s of this.ops)c+=s.span();return c}nextTime(){const c=this.ops,s=c.length;if(!s)return 0;const o=c[s-1];return o.id.time+o.span()}rewriteTime(c){const s=new Hl,o=this.ops,i=o.length,f=s.ops;for(let m=0;m<i;m++){const p=o[m];p instanceof t.DelOp?f.push(new t.DelOp(c(p.id),c(p.obj),p.what)):p instanceof t.NewConOp?f.push(new t.NewConOp(c(p.id),p.val instanceof d.Timestamp?c(p.val):p.val)):p instanceof t.NewVecOp?f.push(new t.NewVecOp(c(p.id))):p instanceof t.NewValOp?f.push(new t.NewValOp(c(p.id))):p instanceof t.NewObjOp?f.push(new t.NewObjOp(c(p.id))):p instanceof t.NewStrOp?f.push(new t.NewStrOp(c(p.id))):p instanceof t.NewBinOp?f.push(new t.NewBinOp(c(p.id))):p instanceof t.NewArrOp?f.push(new t.NewArrOp(c(p.id))):p instanceof t.InsArrOp?f.push(new t.InsArrOp(c(p.id),c(p.obj),c(p.ref),p.data.map(c))):p instanceof t.UpdArrOp?f.push(new t.UpdArrOp(c(p.id),c(p.obj),c(p.ref),c(p.val))):p instanceof t.InsStrOp?f.push(new t.InsStrOp(c(p.id),c(p.obj),c(p.ref),p.data)):p instanceof t.InsBinOp?f.push(new t.InsBinOp(c(p.id),c(p.obj),c(p.ref),p.data)):p instanceof t.InsValOp?f.push(new t.InsValOp(c(p.id),c(p.obj),c(p.val))):p instanceof t.InsObjOp?f.push(new t.InsObjOp(c(p.id),c(p.obj),p.data.map(([w,g])=>[w,c(g)]))):p instanceof t.InsVecOp?f.push(new t.InsVecOp(c(p.id),c(p.obj),p.data.map(([w,g])=>[w,c(g)]))):p instanceof t.NopOp&&f.push(new t.NopOp(c(p.id),p.len))}return s}rebase(c,s){const o=this.getId();if(!o)throw new Error("EMPTY_PATCH");const i=o.sid,f=o.time;if(s??(s=f),f===c)return this;const m=c-f;return this.rewriteTime(p=>{if(p.sid!==i)return p;const w=p.time;return w<s?p:(0,d.ts)(i,w+m)})}clone(){return this.rewriteTime(c=>c)}toBinary(){return(0,n.encode)(this)}toString(c=""){const s=this.getId();return`Patch ${s?(0,d.printTs)(s):"(nil)"}!${this.span()}`+(0,a.printTree)(c,this.ops.map(i=>f=>i.toString(f)))}};return nn.Patch=u,nn}var Js={},Ls={},ya;function M0(){return ya||(ya=1,Object.defineProperty(Ls,"__esModule",{value:!0})),Ls}var va;function Pr(){return va||(va=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const t=L,d=H();t.__exportStar(M0(),e),e.ORIGIN=(0,d.ts)(0,0)})(Js)),Js}var Ds={},wa;function Wl(){return wa||(wa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const t=qi(),d=H(),a=r=>{switch(typeof r){case"number":case"boolean":case"undefined":return!0;case"object":return r===null||r instanceof d.Timestamp;default:return!1}};class n{constructor(c){this.build=c}}e.NodeBuilder=n;var u;(function(r){class c extends n{constructor(b){super(l=>l.con(b)),this.raw=b,this.type="con"}}r.con=c;class s extends n{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="str"}}r.str=s;class o extends n{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="bin"}}r.bin=o;class i extends n{constructor(b){super(l=>{const h=l.val(),v=b.build(l);return l.setVal(h,v),h}),this.value=b,this.type="val"}}r.val=i;class f extends n{constructor(b){super(l=>{const h=l.vec(),v=b.length;if(v){const y=[];for(let _=0;_<v;_++){const O=b[_].build(l);y.push([_,O])}l.insVec(h,y)}return h}),this.value=b,this.type="vec"}}r.vec=f;class m extends n{constructor(b,l){super(h=>{const v=h.obj(),y=[],_={...b,...l},C=Object.keys(_),O=C.length;if(O){for(let k=0;k<O;k++){const S=C[k],E=_[S].build(h);y.push([S,E])}h.insObj(v,y)}return v}),this.obj=b,this.opt=l,this.type="obj"}optional(){return this}}r.obj=m;class p extends n{constructor(b){super(l=>{const h=l.arr(),v=b.length;if(v){const y=[];for(let _=0;_<v;_++)y.push(b[_].build(l));l.insArr(h,h,y)}return h}),this.arr=b,this.type="arr"}}r.arr=p;class w extends n{constructor(b,l){super(h=>{const v=new Uint8Array([b,0,0]),y=h.vec();return v[1]=y.sid%256,v[2]=y.time%256,h.insVec(y,[[0,h.constOrJson(e.s.con(v))],[1,l.build(h)]]),y}),this.id=b,this.data=l,this.type="ext"}}r.ext=w})(u||(e.nodes=u={})),e.schema={con:r=>new u.con(r),str:r=>new u.str(r||""),bin:r=>new u.bin(r),val:r=>new u.val(r),vec:(...r)=>new u.vec(r),obj:(r,c)=>new u.obj(r,c),map:r=>e.schema.obj(r),arr:r=>new u.arr(r),json:r=>{switch(typeof r){case"object":{if(!r)return e.s.val(e.s.con(r));if(r instanceof n)return r;if(Array.isArray(r))return e.s.arr(r.map(c=>e.s.json(c)));if((0,t.isUint8Array)(r))return e.s.bin(r);if(r instanceof d.Timestamp)return e.s.val(e.s.con(r));{const c={},s=Object.keys(r);for(const o of s)c[o]=e.s.jsonCon(r[o]);return e.s.obj(c)}}case"string":return e.s.str(r);default:return e.s.val(e.s.con(r))}},jsonCon:r=>a(r)?e.s.con(r):e.s.json(r),ext:(r,c)=>new u.ext(r,c)},e.s=e.schema})(Ds)),Ds}var _a;function Mr(){if(_a)return en;_a=1,Object.defineProperty(en,"__esModule",{value:!0}),en.PatchBuilder=void 0;const t=L.__importStar(Ye()),d=H(),a=qi(),n=zl(),u=Pr(),r=Wl(),c=o=>{switch(typeof o){case"number":case"boolean":return!0;default:return o===null}};let s=class{constructor(i){this.clock=i,this.patch=new n.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const i=this.patch;return this.patch=new n.Patch,i}obj(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewObjOp(i)),i}arr(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewArrOp(i)),i}vec(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewVecOp(i)),i}str(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewStrOp(i)),i}bin(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewBinOp(i)),i}con(i){this.pad();const f=this.clock.tick(1);return this.patch.ops.push(new t.NewConOp(f,i)),f}val(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewValOp(i)),i}root(i){return this.setVal(u.ORIGIN,i)}insObj(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsObjOp(m,i,f),w=p.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(p),m}insVec(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsVecOp(m,i,f),w=p.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(p),m}setVal(i,f){this.pad();const m=this.clock.tick(1),p=new t.InsValOp(m,i,f);return this.patch.ops.push(p),m}insStr(i,f,m){if(!m.length)throw new Error("EMPTY_STRING");this.pad();const p=this.clock.tick(1),w=new t.InsStrOp(p,i,f,m),g=w.span();return g>1&&this.clock.tick(g-1),this.patch.ops.push(w),p}insBin(i,f,m){if(!m.length)throw new Error("EMPTY_BINARY");this.pad();const p=this.clock.tick(1),w=new t.InsBinOp(p,i,f,m),g=w.span();return g>1&&this.clock.tick(g-1),this.patch.ops.push(w),p}insArr(i,f,m){this.pad();const p=this.clock.tick(1),w=new t.InsArrOp(p,i,f,m),g=w.span();return g>1&&this.clock.tick(g-1),this.patch.ops.push(w),p}updArr(i,f,m){this.pad();const p=this.clock.tick(1),w=new t.UpdArrOp(p,i,f,m);return this.patch.ops.push(w),p}del(i,f){this.pad();const m=this.clock.tick(1);return this.patch.ops.push(new t.DelOp(m,i,f)),m}nop(i){this.pad();const f=this.clock.tick(i);return this.patch.ops.push(new t.NopOp(f,i)),f}jsonObj(i){const f=this.obj(),m=Object.keys(i);if(m.length){const p=[];for(const w of m){const g=i[w],b=g instanceof d.Timestamp?g:c(g)?this.con(g):this.json(g);p.push([w,b])}this.insObj(f,p)}return f}jsonArr(i){const f=this.arr();if(i.length){const m=[];for(const p of i)m.push(this.json(p));this.insArr(f,f,m)}return f}jsonStr(i){const f=this.str();return i&&this.insStr(f,f,i),f}jsonBin(i){const f=this.bin();return i.length&&this.insBin(f,f,i),f}jsonVal(i){const f=this.val(),m=this.con(i);return this.setVal(f,m),f}json(i){if(i instanceof d.Timestamp)return i;if(i===void 0)return this.con(i);if(i instanceof Array)return this.jsonArr(i);if((0,a.isUint8Array)(i))return this.jsonBin(i);if(i instanceof r.NodeBuilder)return i.build(this);switch(typeof i){case"object":return i===null?this.jsonVal(i):this.jsonObj(i);case"string":return this.jsonStr(i);case"number":case"boolean":return this.jsonVal(i)}throw new Error("INVALID_JSON")}constOrJson(i){return i instanceof d.Timestamp?i:c(i)?this.con(i):this.json(i)}maybeConst(i){return i instanceof d.Timestamp?i:this.con(i)}pad(){const i=this.patch.nextTime();if(!i)return;const f=this.clock.time-i;if(f>0){const m=(0,d.ts)(this.clock.sid,i),p=new t.NopOp(m,f);this.patch.ops.push(p)}}};return en.PatchBuilder=s,en}var cn={},Ca;function q0(){if(Ca)return cn;Ca=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.ExtNode=void 0;const e=H();let t=class{constructor(a){this.data=a,this.api=void 0,this.id=a.id}children(a){}child(){return this.data}container(){return this.data.container()}toString(a,n){return this.name()+(n?" "+(0,e.printTs)(n):"")+" "+this.data.toString(a)}};return cn.ExtNode=t,cn}var Fs={},qe={},Us={},Gs={},Sa;function B0(){return Sa||(Sa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const t=Array.isArray,d=Object.prototype,a=(n,u)=>{if(n===u)return!0;let r=0,c=0;if(t(n)){if(!t(u)||(r=n.length,r!==u.length))return!1;for(c=r;c--!==0;)if(!(0,e.deepEqual)(n[c],u[c]))return!1;return!0}if(n&&u&&typeof n=="object"&&typeof u=="object"){e:{if(n.__proto__===d)break e;if(n instanceof Uint8Array){if(!(u instanceof Uint8Array))return!1;const o=n.length;if(o!==u.length)return!1;for(let i=0;i<o;i++)if(n[i]!==u[i])return!1;return!0}}const s=Object.keys(n);if(r=s.length,r!==Object.keys(u).length||t(u))return!1;for(c=r;c--!==0;){const o=s[c];if(!(0,e.deepEqual)(n[o],u[o]))return!1}return!0}return!1};e.deepEqual=a})(Gs)),Gs}var Oa;function V0(){return Oa||(Oa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(B0(),e)})(Us)),Us}var an={},Ea;function J0(){if(Ea)return an;Ea=1,Object.defineProperty(an,"__esModule",{value:!0}),an.cmpUint8Array=void 0;const e=(t,d)=>{const a=t.length;if(a!==d.length)return!1;for(let n=0;n<a;n++)if(t[n]!==d[n])return!1;return!0};return an.cmpUint8Array=e,an}var Hs={},zs={},ka;function L0(){return ka||(ka=1,Object.defineProperty(zs,"__esModule",{value:!0})),zs}var xa;function qr(){return xa||(xa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(L0(),e),t.__exportStar(H(),e),t.__exportStar(Ye(),e),t.__exportStar(zl(),e),t.__exportStar(Mr(),e),t.__exportStar(Wl(),e)})(Hs)),Hs}var Ws={},Aa;function Br(){return Aa||(Aa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const t=l=>{const h=l.charCodeAt(0);return h>=56320&&h<=57343},d=l=>{const h=l.charCodeAt(l.length-1);return h>=55296&&h<=56319},a=(l,h)=>{l.push([0,""]);let v=0,y=0,_=0,C="",O="",k=0;for(;v<l.length;){if(v<l.length-1&&!l[v][1]){l.splice(v,1);continue}const E=l[v];switch(E[0]){case 1:_++,v++,O+=E[1];break;case-1:y++,v++,C+=E[1];break;case 0:{let x=v-_-y-1;if(h){const R=l[x];if(x>=0){let B=R[1];if(d(B)){const J=B.slice(-1);if(R[1]=B=B.slice(0,-1),C=J+C,O=J+O,!B){l.splice(x,1),v--;let D=x-1;const U=l[D];if(U){const V=U[0];V===1?(_++,D--,O=U[1]+O):V===-1&&(y++,D--,C=U[1]+C)}x=D}}}const T=l[v],q=T[1];if(t(q)){const B=q.charAt(0);T[1]=q.slice(1),C+=B,O+=B}}if(v<l.length-1&&!l[v][1]){l.splice(v,1);break}const A=C.length>0,N=O.length>0;if(A||N){A&&N&&(k=(0,e.pfx)(O,C),k!==0&&(x>=0?l[x][1]+=O.slice(0,k):(l.splice(0,0,[0,O.slice(0,k)]),v++),O=O.slice(k),C=C.slice(k)),k=(0,e.sfx)(O,C),k!==0&&(l[v][1]=O.slice(O.length-k)+l[v][1],O=O.slice(0,O.length-k),C=C.slice(0,C.length-k)));const R=_+y,T=C.length,q=O.length;T===0&&q===0?(l.splice(v-R,R),v=v-R):T===0?(l.splice(v-R,R,[1,O]),v=v-R+1):q===0?(l.splice(v-R,R,[-1,C]),v=v-R+1):(l.splice(v-R,R,[-1,C],[1,O]),v=v-R+2)}const I=l[v-1];v!==0&&I[0]===0?(I[1]+=l[v][1],l.splice(v,1)):v++,_=0,y=0,C="",O="";break}}}l[l.length-1][1]===""&&l.pop();let S=!1;for(v=1;v<l.length-1;){const E=l[v-1],x=l[v+1];if(E[0]===0&&x[0]===0){const A=E[1],N=l[v],I=N[1],R=x[1];I.slice(I.length-A.length)===A?(l[v][1]=A+I.slice(0,I.length-A.length),x[1]=A+R,l.splice(v-1,1),S=!0):I.slice(0,R.length)===R&&(E[1]+=x[1],N[1]=I.slice(R.length)+R,l.splice(v+1,1),S=!0)}v++}S&&a(l,h)},n=(l,h,v,y)=>{const _=o(l.slice(0,v),h.slice(0,y),!1),C=o(l.slice(v),h.slice(y),!1);return _.concat(C)},u=(l,h)=>{const v=l.length,y=h.length,_=Math.ceil((v+y)/2),C=_,O=2*_,k=new Array(O),S=new Array(O);for(let T=0;T<O;T++)k[T]=-1,S[T]=-1;k[C+1]=0,S[C+1]=0;const E=v-y,x=E%2!==0;let A=0,N=0,I=0,R=0;for(let T=0;T<_;T++){for(let q=-T+A;q<=T-N;q+=2){const B=C+q;let J=0;const D=k[B-1],U=k[B+1];q===-T||q!==T&&D<U?J=U:J=D+1;let V=J-q;for(;J<v&&V<y&&l.charAt(J)===h.charAt(V);)J++,V++;if(k[B]=J,J>v)N+=2;else if(V>y)A+=2;else if(x){const re=C+E-q,ie=S[re];if(re>=0&&re<O&&ie!==-1&&J>=v-ie)return n(l,h,J,V)}}for(let q=-T+I;q<=T-R;q+=2){const B=C+q;let J=q===-T||q!==T&&S[B-1]<S[B+1]?S[B+1]:S[B-1]+1,D=J-q;for(;J<v&&D<y&&l.charAt(v-J-1)===h.charAt(y-D-1);)J++,D++;if(S[B]=J,J>v)R+=2;else if(D>y)I+=2;else if(!x){const U=C+E-q,V=k[U];if(U>=0&&U<O&&V!==-1){const re=C+V-U;if(J=v-J,V>=J)return n(l,h,V,re)}}}}return[[-1,l],[1,h]]},r=(l,h)=>{if(!l)return[[1,h]];if(!h)return[[-1,l]];const v=l.length,y=h.length,_=v>y?l:h,C=v>y?h:l,O=C.length,k=_.indexOf(C);if(k>=0){const S=_.slice(0,k),E=_.slice(k+O);return v>y?[[-1,S],[0,C],[-1,E]]:[[1,S],[0,C],[1,E]]}return O===1?[[-1,l],[1,h]]:u(l,h)},c=(l,h)=>{if(!l||!h||l.charAt(0)!==h.charAt(0))return 0;let v=0,y=Math.min(l.length,h.length),_=y,C=0;for(;v<_;)l.slice(C,_)===h.slice(C,_)?(v=_,C=v):y=_,_=Math.floor((y-v)/2+v);const O=l.charCodeAt(_-1);return O>=55296&&O<=56319&&_--,_};e.pfx=c;const s=(l,h)=>{if(!l||!h||l.slice(-1)!==h.slice(-1))return 0;let v=0,y=Math.min(l.length,h.length),_=y,C=0;for(;v<_;)l.slice(l.length-_,l.length-C)===h.slice(h.length-_,h.length-C)?(v=_,C=v):y=_,_=Math.floor((y-v)/2+v);const O=l.charCodeAt(l.length-_);return O>=55296&&O<=56319&&_--,_};e.sfx=s;const o=(l,h,v)=>{if(l===h)return l?[[0,l]]:[];const y=(0,e.pfx)(l,h),_=l.slice(0,y);l=l.slice(y),h=h.slice(y);const C=(0,e.sfx)(l,h),O=l.slice(l.length-C);l=l.slice(0,l.length-C),h=h.slice(0,h.length-C);const k=r(l,h);return _&&k.unshift([0,_]),O&&k.push([0,O]),a(k,v),k},i=(l,h)=>o(l,h,!0);e.diff=i;const f=(l,h,v)=>{e:{if(v<0)break e;const y=l.length,_=h.length;if(y===_)break e;const C=h.slice(v),O=C.length;if(O>y||l.slice(y-O)!==C)break e;if(_>y){const E=y-O,x=l.slice(0,E),A=h.slice(0,E);if(x!==A)break e;const N=h.slice(E,v),I=[];return x&&I.push([0,x]),N&&I.push([1,N]),C&&I.push([0,C]),I}else{const E=_-O,x=h.slice(0,E),A=l.slice(0,E);if(A!==x)break e;const N=l.slice(E,y-O),I=[];return A&&I.push([0,A]),N&&I.push([-1,N]),C&&I.push([0,C]),I}}return(0,e.diff)(l,h)};e.diffEdit=f;const m=l=>{let h="";const v=l.length;for(let y=0;y<v;y++){const _=l[y];_[0]!==1&&(h+=_[1])}return h};e.src=m;const p=l=>{let h="";const v=l.length;for(let y=0;y<v;y++){const _=l[y];_[0]!==-1&&(h+=_[1])}return h};e.dst=p;const w=l=>{const h=l[0];return h===0?l:h===1?[-1,l[1]]:[1,l[1]]},g=l=>l.map(w);e.invert=g;const b=(l,h,v,y)=>{const _=l.length;let C=h;for(let O=_-1;O>=0;O--){const[k,S]=l[O];if(k===0)C-=S.length;else if(k===1)v(C,S);else{const E=S.length;C-=E,y(C,E,S)}}};e.apply=b})(Ws)),Ws}var Ks={},Na;function D0(){return Na||(Na=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const d=L.__importStar(Br()),a=o=>{let i="";const f=o.length;for(let m=0;m<f;m++)i+=String.fromCharCode(o[m]);return i};e.toStr=a;const n=o=>{const i=o.length,f=new Uint8Array(i);for(let m=0;m<i;m++)f[m]=o.charCodeAt(m);return f};e.toBin=n;const u=(o,i)=>{const f=(0,e.toStr)(o),m=(0,e.toStr)(i);return d.diff(f,m)};e.diff=u;const r=(o,i,f,m)=>d.apply(o,i,(p,w)=>f(p,(0,e.toBin)(w)),m);e.apply=r;const c=o=>(0,e.toBin)(d.src(o));e.src=c;const s=o=>(0,e.toBin)(d.dst(o));e.dst=s})(Ks)),Ks}var Ys={},Ra;function F0(){return Ra||(Ra=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const d=L.__importStar(Br()),a=u=>{const r=[],c=u.length;let s=[];const o=(i,f)=>{if(!f.length)return;const m=s.length;if(m){const p=s[m-1];if(p[0]===i){p[1]+=f;return}}s.push([i,f])};e:for(let i=0;i<c;i++){const f=u[i],m=f[0],p=f[1],w=p.indexOf(`
`);if(w<0){o(m,p);continue e}else o(m,p.slice(0,w+1)),s.length&&r.push(s),s=[];let g=w;const b=p.length;t:for(;g<b;){const l=p.indexOf(`
`,g+1);if(l<0){o(m,p.slice(g+1));break t}r.push([[m,p.slice(g+1,l+1)]]),g=l}}s.length&&r.push(s);{const i=r.length;for(let f=0;f<i;f++){const m=r[f];let p=m.length;e:{if(p<2)break e;const w=m[0],g=m[1],b=g[0];if(w[0]===0&&(b===-1||b===1)){for(let l=2;l<p;l++)if(m[l][0]!==b)break e;for(let l=f+1;l<i;l++){const h=r[l],v=h.length,y=w[1];let _,C;if(h.length>1&&(_=h[0])[0]===b&&(C=h[1])[0]===0&&y===_[1])m.splice(0,1),g[1]=y+g[1],C[1]=y+C[1],h.splice(0,1);else for(let O=0;O<v;O++)if(h[O][0]!==b)break e}}}p=m.length;e:{if(p<2)break e;const w=m[m.length-1],g=w[1],b=m[m.length-2];if(w[0]===-1)for(let l=f+1;l<i;l++){const h=r[l],v=h.length;if(v<=1){if(h[0][0]!==-1)break e}else{const y=h[h.length-1];if(y[0]!==0)break e;for(let S=0;S<h.length-1;S++)if(h[S][0]!==-1)break e;let _=y[1];const C=_.endsWith(`
`);if(C||(_+=`
`),_.length>g.length||!g.endsWith(_))break e;const O=g.length-_.length;O<0?(w[0]=0,b[0]===0&&(b[1]+=g,m.splice(p-1,1))):O===0?(m.splice(p-1,1),b[0]===0?b[1]+=_:m.push([0,_])):(w[1]=g.slice(0,O),m.push([0,_]));const k=h[h.length-2];k[0]===-1?(k[1]+=C?_:_.slice(0,-1),h.splice(v-1,1)):y[0]=-1}}}}}return r};e.agg=a;const n=(u,r)=>{const c=u.join(`
`)+`
`,s=r.join(`
`)+`
`;if(c===s)return[];const o=d.diff(c,s),i=(0,e.agg)(o),f=i.length,m=[];let p=-1,w=-1;const g=u.length,b=r.length;for(let l=0;l<f;l++){const h=i[l];let v=h.length;if(!v)continue;const y=h[v-1],_=y[0],C=y[1];if(C===`
`)h.splice(v-1,1);else{const k=C.length;C[k-1]===`
`&&(k===1?h.splice(v-1,1):y[1]=C.slice(0,k-1))}let O=0;if(v=h.length,l+1===f)p+1<g?w+1<b?(O=v===1&&h[0][0]===0?0:2,p++,w++):(O=-1,p++):(O=1,w++);else{const S=h[0][0];v===1&&S===_&&S===0?(p++,w++):_===0?(O=2,p++,w++):_===1?(O=1,w++):_===-1&&(O=-1,p++)}m.push([O,p,w,h])}return m};e.diff=n})(Ys)),Ys}var Xs={},un={},Ia;function Bi(){if(Ia)return un;Ia=1,Object.defineProperty(un,"__esModule",{value:!0}),un.sort=void 0;const e=t=>{const d=t.length;for(let a=1;a<d;a++){const n=t[a];let u=a;for(;u!==0&&t[u-1]>n;)t[u]=t[u-1],u--;t[u]=n}return t};return un.sort=e,un}var Qs={},Ta;function Vi(){return Ta||(Ta=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const t=Bi();var d;(function(s){s[s.START_STATE=5381]="START_STATE",s[s.NULL=982452847]="NULL",s[s.TRUE=982453247]="TRUE",s[s.FALSE=982454243]="FALSE",s[s.ARRAY=982452259]="ARRAY",s[s.STRING=982453601]="STRING",s[s.OBJECT=982454533]="OBJECT",s[s.BINARY=982454837]="BINARY"})(d||(e.CONST=d={}));const a=(s,o)=>(s<<5)+s+o;e.updateNum=a;const n=(s,o)=>{const i=o.length;s=(0,e.updateNum)(s,d.STRING),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+o.charCodeAt(--f);return s};e.updateStr=n;const u=(s,o)=>{const i=o.length;s=(0,e.updateNum)(s,d.BINARY),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+o[--f];return s};e.updateBin=u;const r=(s,o)=>{switch(typeof o){case"number":return(0,e.updateNum)(s,o);case"string":return s=(0,e.updateNum)(s,d.STRING),(0,e.updateStr)(s,o);case"object":{if(o===null)return(0,e.updateNum)(s,d.NULL);if(Array.isArray(o)){const m=o.length;s=(0,e.updateNum)(s,d.ARRAY);for(let p=0;p<m;p++)s=(0,e.updateJson)(s,o[p]);return s}if(o instanceof Uint8Array)return(0,e.updateBin)(s,o);s=(0,e.updateNum)(s,d.OBJECT);const i=(0,t.sort)(Object.keys(o)),f=i.length;for(let m=0;m<f;m++){const p=i[m];s=(0,e.updateStr)(s,p),s=(0,e.updateJson)(s,o[p])}return s}case"boolean":return(0,e.updateNum)(s,o?d.TRUE:d.FALSE)}return s};e.updateJson=r;const c=s=>(0,e.updateJson)(d.START_STATE,s)>>>0;e.hash=c})(Qs)),Qs}var Zs={},ja;function Kl(){return ja||(ja=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const t=Bi(),d=Vi(),a=n=>{switch(typeof n){case"string":return(0,d.hash)(n).toString(36);case"number":case"bigint":return n.toString(36);case"boolean":return n?"T":"F";case"object":if(n===null)return"N";if(Array.isArray(n)){const u=n.length;let r="[";for(let c=0;c<u;c++)r+=(0,e.structHash)(n[c])+",";return r+"]"}else{if(n instanceof Uint8Array)return(0,d.hash)(n).toString(36);{const u=Object.keys(n);(0,t.sort)(u);let r="{";const c=u.length;for(let s=0;s<c;s++){const o=u[s];r+=(0,d.hash)(o).toString(36)+":"+(0,e.structHash)(n[o])+","}return r+"}"}}default:return"U"}};e.structHash=a})(Zs)),Zs}var Pa;function U0(){return Pa||(Pa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const t=Bi(),d=dr(),a=Vi(),n=Kl(),u=r=>{if(r instanceof d.ConNode)return(0,n.structHash)(r.val);if(r instanceof d.ValNode)return(0,e.structHashCrdt)(r.node());if(r instanceof d.StrNode)return(0,a.hash)(r.view()).toString(36);if(r instanceof d.ObjNode){let c="{";const s=Array.from(r.keys.keys());(0,t.sort)(s);const o=s.length;for(let i=0;i<o;i++){const f=s[i],m=r.get(f);c+=(0,a.hash)(f).toString(36)+":"+(0,e.structHashCrdt)(m)+","}return c+"}"}else if(r instanceof d.ArrNode||r instanceof d.VecNode){let c="[";return r.children(s=>{c+=(0,e.structHashCrdt)(s)+","}),c+"]"}else if(r instanceof d.BinNode)return(0,a.hash)(r.view()).toString(36);return"U"};e.structHashCrdt=u})(Xs)),Xs}var $s={},Ma;function G0(){return Ma||(Ma=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Vi(),e),t.__exportStar(Kl(),e)})($s)),$s}var qa;function H0(){if(qa)return qe;qa=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.JsonCrdtDiff=qe.DiffError=void 0;const e=L,t=V0(),d=J0(),a=qr(),n=ke(),u=e.__importStar(Br()),r=e.__importStar(D0()),c=e.__importStar(F0()),s=U0(),o=G0();class i extends Error{constructor(p="DIFF"){super(p)}}qe.DiffError=i;let f=class{constructor(p){this.model=p,this.builder=new a.PatchBuilder(p.clock.clone())}diffStr(p,w){const g=p.view();if(g===w)return;const b=this.builder;u.apply(u.diff(g,w),g.length,(l,h)=>b.insStr(p.id,l?p.find(l-1):p.id,h),(l,h)=>b.del(p.id,p.findInterval(l,h)))}diffBin(p,w){const g=p.view();if((0,d.cmpUint8Array)(g,w))return;const b=this.builder;r.apply(r.diff(g,w),g.length,(l,h)=>b.insBin(p.id,l?p.find(l-1):p.id,h),(l,h)=>b.del(p.id,p.findInterval(l,h)))}diffArr(p,w){const g=[];p.children(k=>{g.push((0,s.structHashCrdt)(k))});const b=[],l=w.length;for(let k=0;k<l;k++)b.push((0,o.structHash)(w[k]));const h=c.diff(g,b);if(!h.length)return;const v=[],y=[],_=h.length;for(let k=_-1;k>=0;k--){const[S,E,x]=h[k];switch(S){case 0:break;case 1:{const A=w[x],N=E>=0?p.find(E):p.id;if(!N)throw new i;v.push([N,[A]]);break}case-1:{const A=p.findInterval(E,1);if(!A||!A.length)throw new i;y.push(...A);break}case 2:{const A=w[x];try{this.diffAny(p.getNode(E),A)}catch(N){if(N instanceof i){const I=p.findInterval(E,1);y.push(...I);const R=E?p.find(E-1):p.id;if(!R)throw new i;v.push([R,[A]])}else throw N}}}}const C=this.builder,O=v.length;for(let k=0;k<O;k++){const[S,E]=v[k];C.insArr(p.id,S,E.map(x=>C.json(x)))}y.length&&C.del(p.id,y)}diffObj(p,w){const g=this.builder,b=[],l=new Set;p.forEach(y=>{l.add(y),w[y]===void 0&&b.push([y,g.con(void 0)])});const h=Object.keys(w),v=h.length;for(let y=0;y<v;y++){const _=h[y],C=w[_];if(l.has(_)){const O=p.get(_);if(O)try{this.diffAny(O,C);continue}catch(k){if(!(k instanceof i))throw k}}b.push([_,p.get(_)instanceof n.ConNode?g.con(C):g.constOrJson(C)])}b.length&&g.insObj(p.id,b)}diffVec(p,w){const g=this.builder,b=[],l=p.elements,h=l.length,v=w.length,y=p.doc.index,_=Math.min(h,v);for(let C=v;C<h;C++){const O=l[C];if(O){const k=y.get(O);if(!k||k instanceof n.ConNode&&k.val===void 0)return;b.push([C,g.con(void 0)])}}for(let C=0;C<_;C++){const O=w[C],k=p.get(C);if(k)try{this.diffAny(k,O);continue}catch(S){if(!(S instanceof i))throw S}b.push([C,g.constOrJson(O)])}for(let C=h;C<v;C++)b.push([C,g.constOrJson(w[C])]);b.length&&g.insVec(p.id,b)}diffVal(p,w){try{this.diffAny(p.node(),w)}catch(g){if(g instanceof i){const b=this.builder;b.setVal(p.id,b.constOrJson(w))}else throw g}}diffAny(p,w){if(p instanceof n.ConNode){if(p.val!==w&&!(0,t.deepEqual)(p.val,w))throw new i}else if(p instanceof n.StrNode){if(typeof w!="string")throw new i;this.diffStr(p,w)}else if(p instanceof n.ObjNode){if(!w||typeof w!="object"||Array.isArray(w))throw new i;this.diffObj(p,w)}else if(p instanceof n.ValNode)this.diffVal(p,w);else if(p instanceof n.ArrNode){if(!Array.isArray(w))throw new i;this.diffArr(p,w)}else if(p instanceof n.VecNode){if(!Array.isArray(w))throw new i;this.diffVec(p,w)}else if(p instanceof n.BinNode){if(!(w instanceof Uint8Array))throw new i;this.diffBin(p,w)}else throw new i}diff(p,w){return this.diffAny(p,w),this.builder.flush()}};return qe.JsonCrdtDiff=f,qe}var Ba;function z0(){return Ba||(Ba=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const t=H0(),d=(n,u)=>{const c=new t.JsonCrdtDiff(n.api.model).diff(n.node,u);return c.ops.length?c:void 0};e.diff=d;const a=(n,u)=>{const r=(0,e.diff)(n,u);return r&&n.api.model.applyPatch(r),r};e.merge=a})(Fs)),Fs}var ei={},Va;function W0(){return Va||(Va=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const t=(a,n=[])=>new Proxy(()=>{},{get:(u,r,c)=>(n.push(String(r)),(0,e.proxy)(a,n)),apply:(u,r,c)=>a(n,...c)});e.proxy=t;const d=(a,n,u=[])=>new Proxy({},{get:(r,c,s)=>c===n?a(u):(u.push(String(c)),(0,e.proxy$)(a,n,u))});e.proxy$=d})(ei)),ei}var Ja;function K0(){if(Ja)return K;Ja=1,Object.defineProperty(K,"__esModule",{value:!0}),K.ModelApi=K.ArrApi=K.BinApi=K.StrApi=K.ObjApi=K.VecApi=K.ValApi=K.ConApi=K.NodeApi=void 0;const e=L,t=he(),d=Ol(),a=Ai(),n=R0(),u=H(),r=ke(),c=I0(),s=Dl(),o=Mr(),i=Fl(),f=q0(),m=e.__importStar(z0()),p=W0(),w=k=>{if(!k)return[void 0,""];if(typeof k=="number")return[void 0,k];switch(typeof k=="string"&&(k=(0,a.toPath)(k)),k.length){case 0:return[void 0,""];case 1:return[void 0,k[0]];default:{const S=k[k.length-1];return[k.slice(0,-1),S]}}};class g{constructor(S,E){this.node=S,this.api=E,this.ev=void 0}get events(){return this.ev||(this.ev=new c.NodeEvents(this))}find(S){let E=this.node;if(S===void 0){if(typeof E.child=="function"){const x=E.child();if(!x){if(E instanceof r.RootNode)return E;throw new Error("NO_CHILD")}return x}throw new Error("CANNOT_IN")}for(typeof S=="string"&&S&&S[0]!=="/"&&(S="/"+S),typeof S=="number"&&(S=[S]);E instanceof r.ValNode;)E=E.child();return(0,n.find)(E,S)}in(S){const E=this.find(S);return this.api.wrap(E)}asVal(){if(this.node instanceof r.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof r.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof r.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof r.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof r.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof r.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof r.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(S){let E;const x=this.node;if(x instanceof f.ExtNode&&(E=x),x instanceof r.VecNode&&(E=x.ext()),!E)throw new Error("NOT_EXT");const A=this.api.wrap(E);if(!S||A instanceof S.Api)return A;throw new Error("NOT_EXT")}val(S){return this.in(S).asVal()}str(S){return this.in(S).asStr()}bin(S){return this.in(S).asBin()}arr(S){return this.in(S).asArr()}vec(S){return this.in(S).asVec()}obj(S){return this.in(S).asObj()}con(S){return this.in(S).asCon()}view(){return this.node.view()}select(S,E){try{let x=S!==void 0?this.find(S):this.node;if(E)for(;x instanceof r.ValNode;)x=x.child();return this.api.wrap(x)}catch{return}}read(S){const E=this.view();if(Array.isArray(S))return(0,d.get)(E,S);if(!S)return E;let x=S+"";return S&&x[0]!=="/"&&(x="/"+x),(0,d.get)(E,(0,a.toPath)(x))}add(S,E){const[x,A]=w(S);e:try{const N=this.select(x,!0);if(N instanceof v)N.set({[A]:E});else if(N instanceof C||N instanceof y||N instanceof _){const I=N.length();let R=0;if(typeof A=="number")R=A;else if(A==="-")R=I;else if(R=~~A,R+""!==A)break e;if(R!==R)break e;if(R<0&&(R=0),R>I&&(R=I),N instanceof C)N.ins(R,Array.isArray(E)?E:[E]);else if(N instanceof y)N.ins(R,E+"");else if(N instanceof _){if(!(E instanceof Uint8Array))break e;N.ins(R,E)}}else if(N instanceof h)N.set([[~~A,E]]);else break e;return!0}catch{}return!1}replace(S,E){const[x,A]=w(S);e:try{const N=this.select(x,!0);if(N instanceof v){const I=A+"";if(!N.has(I))break e;N.set({[A]:E})}else if(N instanceof C){const I=N.length();let R=0;if(typeof A=="number")R=A;else if(R=~~A,R+""!==A)break e;if(R!==R||R<0||R>I)break e;R===I?N.ins(R,[E]):N.upd(R,E)}else if(N instanceof h)N.set([[~~A,E]]);else break e;return!0}catch{}return!1}remove(S,E=1){const[x,A]=w(S);e:try{const N=this.select(x,!0);if(N instanceof v){const I=A+"";if(!N.has(I))break e;N.del([I])}else if(N instanceof C||N instanceof y||N instanceof _){const I=N.length();let R=0;if(typeof A=="number")R=A;else if(A==="-")R=E;else if(R=~~A,R+""!==A)break e;if(R!==R||R<0||R>I)break e;N.del(R,Math.min(E,I-R))}else if(N instanceof h)N.set([[~~A,void 0]]);else break e;return!0}catch{}return!1}diff(S){return m.diff(this,S)}merge(S){return m.merge(this,S)}op(S){if(!Array.isArray(S))return!1;const[E,x,A]=S;switch(E){case"add":return this.add(x,A);case"replace":return this.replace(x,A);case"merge":return!!this.select(x)?.merge(A);case"remove":return this.remove(x,A)}}get s(){return{$:this}}get $(){return(0,p.proxy$)(S=>{try{return this.api.wrap(this.find(S))}catch{return}},"$")}toString(S=""){return"api("+(this.constructor===g?"*":this.node.name())+")"+(0,t.printTree)(S,[x=>this.node.toString(x)])}}K.NodeApi=g;class b extends g{get s(){return{$:this}}}K.ConApi=b;class l extends g{get(){return this.in()}set(S){const{api:E,node:x}=this,N=E.builder.constOrJson(S);E.builder.setVal(x.id,N),E.apply()}get s(){const S=this;return{$:this,get _(){const x=S.node.node();return S.api.wrap(x).s}}}}K.ValApi=l;class h extends g{get(S){return this.in(S)}set(S){const{api:E,node:x}=this,{builder:A}=E;A.insVec(x.id,S.map(([N,I])=>[N,A.constOrJson(I)])),E.apply()}push(...S){const E=this.length();this.set(S.map((x,A)=>[E+A,x]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(E,x,A)=>{if(x==="$")return this;if(x==="toExt")return()=>this.asExt();const N=Number(x);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const I=this.node.get(N);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}K.VecApi=h;class v extends g{get(S){return this.in(S)}set(S){const{api:E,node:x}=this,{builder:A}=E;A.insObj(x.id,Object.entries(S).map(([N,I])=>[N,A.constOrJson(I)])),E.apply()}del(S){const{api:E,node:x}=this,{builder:A}=E;E.builder.insObj(x.id,S.map(N=>[N,A.con(void 0)])),E.apply()}has(S){return this.node.keys.has(S)}get s(){return new Proxy({},{get:(E,x,A)=>{if(x==="$")return this;const N=String(x),I=this.node.get(N);if(!I)throw new Error("NO_SUCH_KEY");return this.api.wrap(I).s}})}}K.ObjApi=v;class y extends g{ins(S,E){const{api:x,node:A}=this;x.onBeforeLocalChange.emit(x.next);const N=x.builder;N.pad();const I=x.builder.nextTime(),R=new u.Timestamp(N.clock.sid,I),T=A.insAt(S,R,E);if(!T)throw new Error("OUT_OF_BOUNDS");N.insStr(A.id,T,E),x.advance()}del(S,E){const{api:x,node:A}=this;x.onBeforeLocalChange.emit(x.next);const N=x.builder;N.pad();const I=A.findInterval(S,E);if(!I)throw new Error("OUT_OF_BOUNDS");A.delete(I),N.del(A.id,I),x.advance()}findId(S){const E=this.node,A=E.length()-1;return S>A&&(S=A),S<0?E.id:E.find(S)||E.id}findPos(S){const E=this.node,x=E.id;if(x.sid===S.sid&&x.time===S.time)return-1;const A=E.findById(S);return A?E.pos(A)+(A.del?0:S.time-A.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}K.StrApi=y;class _ extends g{ins(S,E){const{api:x,node:A}=this,N=S?A.find(S-1):A.id;if(!N)throw new Error("OUT_OF_BOUNDS");x.builder.insBin(A.id,N,E),x.apply()}del(S,E){const{api:x,node:A}=this,N=A.findInterval(S,E);if(!N)throw new Error("OUT_OF_BOUNDS");x.builder.del(A.id,N),x.apply()}length(){return this.node.length()}get s(){return{$:this}}}K.BinApi=_;class C extends g{get(S){return this.in(S)}ins(S,E){const{api:x,node:A}=this,{builder:N}=x,I=S?A.find(S-1):A.id;if(!I)throw new Error("OUT_OF_BOUNDS");const R=[];for(let T=0;T<E.length;T++)R.push(N.json(E[T]));N.insArr(A.id,I,R),x.apply()}push(...S){const E=this.length();this.ins(E,S)}upd(S,E){const{api:x,node:A}=this,N=A.getId(S);if(!N)throw new Error("OUT_OF_BOUNDS");const{builder:I}=x;I.updArr(A.id,N,I.constOrJson(E)),x.apply()}del(S,E){const{api:x,node:A}=this,N=A.findInterval(S,E);if(!N)throw new Error("OUT_OF_BOUNDS");x.builder.del(A.id,N),x.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(E,x,A)=>{if(x==="$")return this;const N=Number(x);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const I=this.node.getNode(N);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}K.ArrApi=C;class O extends l{constructor(S){super(S.root,void 0),this.model=S,this.next=0,this.onBeforeReset=new s.FanOut,this.onReset=new s.FanOut,this.onBeforePatch=new s.FanOut,this.onPatch=new s.FanOut,this.onBeforeLocalChange=new s.FanOut,this.onLocalChange=new s.FanOut,this.onLocalChanges=new i.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new s.FanOut,this.onTransaction=new s.FanOut,this.onChange=new i.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new i.MicrotaskBufferFanOut(this.onChange),this.onFlush=new s.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=E=>this.onChanges.listen(()=>E()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new o.PatchBuilder(S.clock),S.onbeforereset=()=>this.onBeforeReset.emit(),S.onreset=()=>this.onReset.emit(),S.onbeforepatch=E=>this.onBeforePatch.emit(E),S.onpatch=E=>this.onPatch.emit(E)}wrap(S){if(S instanceof r.ValNode)return S.api||(S.api=new l(S,this));if(S instanceof r.StrNode)return S.api||(S.api=new y(S,this));if(S instanceof r.BinNode)return S.api||(S.api=new _(S,this));if(S instanceof r.ArrNode)return S.api||(S.api=new C(S,this));if(S instanceof r.ObjNode)return S.api||(S.api=new v(S,this));if(S instanceof r.ConNode)return S.api||(S.api=new b(S,this));if(S instanceof r.VecNode)return S.api||(S.api=new h(S,this));if(S instanceof f.ExtNode){if(S.api)return S.api;const E=this.model.ext.get(S.extId);return S.api=new E.Api(S,this)}else throw new Error("UNKNOWN_NODE")}root(S){return this.set(S)}set(S){return super.set(S),this}apply(){const S=this.builder.patch.ops,E=S.length,x=this.model,A=this.next;this.onBeforeLocalChange.emit(A);for(let N=this.next;N<E;N++)x.applyOperation(S[N]);this.next=E,x.tick++,this.onLocalChange.emit(A)}advance(){const S=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(S)}transaction(S){if(this.inTx)S();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),S(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const S=this.builder.flush();return this.next=0,S.ops.length&&this.onFlush.emit(S),S}autoFlush(S=!1){const E=()=>this.builder.patch.ops.length&&this.flush(),x=this.onLocalChanges.listen(E),A=this.onBeforeTransaction.listen(E),N=this.onTransaction.listen(E);return S&&E(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,x(),A(),N()}}}return K.ModelApi=O,K}var La;function Yl(){return La||(La=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(K0(),e)})(qs)),qs}var ln={},Da;function Y0(){if(Da)return ln;Da=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.randomSessionId=void 0;const e=65535,t=9007199254740991-e,d=()=>Math.floor(t*Math.random()+e);return ln.randomSessionId=d,ln}var dn={},Fa;function X0(){if(Fa)return dn;Fa=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.Extensions=void 0;const e=he();let t=class Xl{constructor(){this.ext={}}register(a){this.ext[a.id]=a}get(a){return this.ext[a]}size(){return Object.keys(this.ext).length}clone(){const a=new Xl;for(const n of Object.values(this.ext))a.register(n);return a}toString(a=""){const n=Object.keys(this.ext).map(u=>+u).sort();return"extensions"+(0,e.printTree)(a,n.map(u=>r=>`${u}: ${this.ext[u].name}`))}};return dn.Extensions=t,dn}var Be={},ti={},ni={},fn={},Ua;function Ji(){if(Ua)return fn;Ua=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.printBinary=void 0;const e=(t="",d)=>{const a=d[0],n=d[1];let u="";return a&&(u+=`
`+t+"← "+a(t+"  ")),n&&(u+=`
`+t+"→ "+n(t+"  ")),u};return fn.printBinary=e,fn}var Ga;function Q0(){return Ga||(Ga=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(Ji(),e)})(ni)),ni}var Ha;function Z0(){return Ha||(Ha=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const t=Q0(),d=JSON.stringify,a=(g,b,l)=>{const h=b.p;if(!h)return g;const v=b===h.l;let y=h.bf|0;switch(v?h.bf=++y:h.bf=--y,y){case 0:return g;case 1:case-1:return a(g,h,b);default:{const _=l===b.l;return v?_?(n(h,b),b.p?g:b):(r(h,b,l),l.p?g:l):_?(c(h,b,l),l.p?g:l):(u(h,b),b.p?g:b)}}},n=(g,b)=>{const l=g.p,h=b.r;b.p=l,b.r=g,g.p=b,g.l=h,h&&(h.p=g),l&&(l.l===g?l.l=b:l.r=b);let v=g.bf,y=b.bf;v+=-1-(y>0?y:0),y+=-1+(v<0?v:0),g.bf=v,b.bf=y},u=(g,b)=>{const l=g.p,h=b.l;b.p=l,b.l=g,g.p=b,g.r=h,h&&(h.p=g),l&&(l.l===g?l.l=b:l.r=b);let v=g.bf,y=b.bf;v+=1-(y<0?y:0),y+=1+(v>0?v:0),g.bf=v,b.bf=y},r=(g,b,l)=>{u(b,l),n(g,l)},c=(g,b,l)=>{n(b,l),u(g,l)},s=(g,b,l)=>(l.r=b,b.p=l,l.bf--,l.l?g:a(g,l,b));e.insertRight=s;const o=(g,b,l)=>(l.l=b,b.p=l,l.bf++,l.r?g:a(g,l,b));e.insertLeft=o;const i=(g,b,l)=>{if(!g)return b;const h=b.k;let v=g,y,_=0;for(;y=(_=l(h,v.k))<0?v.l:v.r;)v=y;return _<0?(0,e.insertLeft)(g,b,v):(0,e.insertRight)(g,b,v)};e.insert=i;const f=(g,b)=>{if(!g)return b;const l=b.p,h=b.l,v=b.r;if(b.p=b.l=b.r=void 0,h&&v)if(h.r){let C=h,O=C;for(;O=C.r;)C=O;const k=C.l,S=C.p,E=k;return l&&(l.l===b?l.l=C:l.r=C),C.p=l,C.r=v,C.bf=b.bf,h!==C&&(C.l=h,h.p=C),v.p=C,S&&(S.l===C?S.l=E:S.r=E),E&&(E.p=S),p(l?g:C,S,1)}else{l&&(l.l===b?l.l=h:l.r=h),h.p=l,h.r=v,v.p=h;const C=b.bf;if(l)return h.bf=C,m(g,h,1);const O=C-1;if(h.bf=O,O>=-1)return h;const k=v.l;return v.bf>0?(c(h,v,k),k):(u(h,v),v)}const y=h||v;return y&&(y.p=l),l?l.l===b?(l.l=y,m(g,l,1)):(l.r=y,p(g,l,1)):y};e.remove=f;const m=(g,b,l)=>{let h=b.bf|0;h-=l,b.bf=h;let v=l;if(h===-1)return g;if(h<-1){const _=b.r;if(_.bf<=0)_.l&&_.bf===0&&(v=0),u(b,_),b=_;else{const C=_.l;c(b,_,C),b=C}}const y=b.p;return y?y.l===b?m(g,y,v):p(g,y,v):b},p=(g,b,l)=>{let h=b.bf|0;h+=l,b.bf=h;let v=l;if(h===1)return g;if(h>1){const _=b.l;if(_.bf>=0)_.r&&_.bf===0&&(v=0),n(b,_),b=_;else{const C=_.r;r(b,_,C),b=C}}const y=b.p;return y?y.l===b?m(g,y,v):p(g,y,v):b},w=(g,b="")=>{if(!g)return"∅";const{bf:l,l:h,r:v,k:y,v:_}=g,C=_&&typeof _=="object"&&_.constructor===Object?d(_):_&&typeof _=="object"?_.toString(b):d(_),O=y!==void 0?` { ${d(y)} = ${C} }`:"",k=l?` [${l}]`:"";return g.constructor.name+`${k}`+O+(0,t.printBinary)(b,[h?S=>(0,e.print)(h,S):null,v?S=>(0,e.print)(v,S):null])};e.print=w})(ti)),ti}var hn={},ri={},pn={},za;function Ql(){if(za)return pn;za=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.first=void 0;const e=t=>{let d=t;for(;d;)if(d.l)d=d.l;else return d;return d};return pn.first=e,pn}var mn={},Wa;function $0(){if(Wa)return mn;Wa=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.next=void 0;const e=Ql(),t=d=>{const a=d.r;if(a)return(0,e.first)(a);let n=d.p;for(;n&&n.r===d;)d=n,n=n.p;return n};return mn.next=t,mn}var Ka;function Zl(){return Ka||(Ka=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const t=Ql();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return t.first}});const d=$0();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return d.next}});const a=p=>{let w=p;for(;w;)if(w.r)w=w.r;else return w;return w};e.last=a;const n=p=>{if(p.l){for(p=p.l;p.r;)p=p.r;return p}let w=p.p;for(;w&&w.l===p;)p=w,w=w.p;return w};e.prev=n;const u=p=>{const w=p.l,g=p.r;return 1+(w?u(w):0)+(g?u(g):0)},r=p=>p?u(p):0;e.size=r;const c=(p,w,g)=>{let b=p;for(;b;){const l=g(w,b.k);if(l===0)return b;b=l<0?b.l:b.r}return b};e.find=c;const s=(p,w,g)=>{let b=p,l;for(;b;){const h=g(b.k,w);if(h===0)return b;if(h>0)b=b.l;else{const v=b.r;if(l=b,!v)return l;b=v}}return l};e.findOrNextLower=s;const o=(p,w)=>{const g=p.r=w.r;w.r=p,p.p=w,g&&(g.p=p)};e.insertRight=o;const i=(p,w)=>{const g=p.l=w.l;w.l=p,p.p=w,g&&(g.p=p)};e.insertLeft=i;const f=(p,w,g)=>{if(!p)return w;const b=w.k;let l=p;for(;l;){const h=g(b,l.k),v=h<0?l.l:l.r;if(v)l=v;else{h<0?(0,e.insertLeft)(w,l):(0,e.insertRight)(w,l);break}}return p};e.insert=f;const m=(p,w)=>{const g=w.p,b=w.l,l=w.r;if(w.p=w.l=w.r=void 0,!b&&!l){if(g)g.l===w?g.l=void 0:g.r=void 0;else return;return p}else if(b&&l){let v=b;for(;v.r;)v=v.r;return v.r=l,l.p=v,g?(g.l===w?g.l=b:g.r=b,b.p=g,p):(b.p=void 0,b)}const h=b||l;if(h.p=g,g)g.l===w?g.l=h:g.r=h;else return h;return p};e.remove=m})(ri)),ri}var si={},Ya;function ep(){return Ya||(Ya=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),L.__exportStar(he(),e)})(si)),si}var Xa;function tp(){if(Xa)return hn;Xa=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.createMap=void 0;const e=Zl(),t=ep(),d=(n,u)=>n===u?0:n<u?-1:1,a=(n,u,r,c,s,o)=>{class i{constructor(m){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=m||d}set(m,p){const w=this.root;if(w===void 0){this._size=1;const y=new n(m,p);return this.root=this.min=this.max=u(void 0,y,this.comparator)}const g=this.comparator;let b;const l=this.max;if(b=g(m,l.k),b===0)return l.v=p,l;if(b>0){const y=this.max=new n(m,p);return this.root=c(w,y,l),this._size++,y}const h=this.min;if(b=g(m,h.k),b===0)return h.v=p,h;if(b<0){const y=this.min=new n(m,p);return this.root=r(w,y,h),this._size++,y}let v=w;do{if(b=g(m,v.k),b===0)return v.v=p,v;if(b>0){const y=v.r;if(y===void 0){const _=new n(m,p);return this.root=c(w,_,v),this._size++,_}v=y}else if(b<0){const y=v.l;if(y===void 0){const _=new n(m,p);return this.root=r(w,_,v),this._size++,_}v=y}}while(!0)}find(m){const p=this.comparator;let w=this.root;for(;w;){const g=+p(m,w.k);if(g===0)return w;w=g<0?w.l:w.r}}get(m){return this.find(m)?.v}del(m){const p=this.find(m);return p?(p===this.max&&(this.max=(0,e.prev)(p)),p===this.min&&(this.min=(0,e.next)(p)),this.root=s(this.root,p),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(m){return!!this.find(m)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(m){return(0,e.findOrNextLower)(this.root,m,this.comparator)||void 0}forEach(m){let p=this.first();if(p)do m(p);while(p=(0,e.next)(p))}first(){return this.min}last(){return this.max}iterator0(){let m=this.first();return()=>{if(!m)return;const p=m;return m=(0,e.next)(m),p}}iterator(){const m=this.iterator0();return{next:()=>{const p=m();return{value:p,done:!p}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(m){return this.constructor.name+(0,t.printTree)(m,[p=>o(this.root,p)])}}return i};return hn.createMap=a,hn}var Qa;function np(){if(Qa)return Be;Qa=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.AvlMap=Be.AvlNode=void 0;const e=Z0(),t=tp();class d{constructor(n,u){this.k=n,this.v=u,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Be.AvlNode=d,Be.AvlMap=(0,t.createMap)(d,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),Be}var Za;function Li(){if(Za)return Te;Za=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.Model=Te.UNDEFINED=void 0;const e=L,t=e.__importStar(Ye()),d=e.__importStar(H()),a=N0(),n=Yl(),u=Pr(),r=Y0(),c=ke(),s=jr(),o=he(),i=X0(),f=np(),m=qr();Te.UNDEFINED=new s.ConNode(u.ORIGIN,void 0);let p=class wi{rndSid(){const g=this.clock,b=g.sid,l=g.peers;for(;;){const h=(0,r.randomSessionId)();if(b!==h&&!l.has(h))return h}}static fromPatches(g){if(!g.length)throw new Error("NO_PATCHES");const h=g[0].getId().sid;if(!h)throw new Error("NO_SID");const v=wi.create(void 0,h);return v.applyBatch(g),v}constructor(g){this.root=new c.RootNode(this,u.ORIGIN),this.index=new f.AvlMap(d.compare),this.ext=new i.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=g,g.time||(g.time=1)}get api(){return this._api||(this._api=new n.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(g){const b=g.length;for(let l=0;l<b;l++)this.applyPatch(g[l])}applyLocalPatch(g){const b=g.getId();if(b){const l=this.clock;if(l.sid===b.sid){const h=l.time;h>b.time&&(g=g.rebase(h))}}this.applyPatch(g)}applyPatch(g){this.onbeforepatch?.(g);const b=g.ops,{length:l}=b;for(let h=0;h<l;h++)this.applyOperation(b[h]);this.tick++,this.onpatch?.(g)}applyOperation(g){this.clock.observe(g.id,g.span());const b=this.index;if(g instanceof t.InsStrOp){const l=b.get(g.obj);l instanceof c.StrNode&&l.ins(g.ref,g.id,g.data)}else if(g instanceof t.NewObjOp){const l=g.id;b.get(l)||b.set(l,new c.ObjNode(this,l))}else if(g instanceof t.NewArrOp){const l=g.id;b.get(l)||b.set(l,new c.ArrNode(this,l))}else if(g instanceof t.NewStrOp){const l=g.id;b.get(l)||b.set(l,new c.StrNode(l))}else if(g instanceof t.NewValOp){const l=g.id;b.get(l)||b.set(l,new c.ValNode(this,l,u.ORIGIN))}else if(g instanceof t.NewConOp){const l=g.id;b.get(l)||b.set(l,new s.ConNode(l,g.val))}else if(g instanceof t.InsObjOp){const l=b.get(g.obj),h=g.data,v=h.length;if(l instanceof c.ObjNode)for(let y=0;y<v;y++){const _=h[y],C=b.get(_[1]);if(!C||l.id.time>=_[1].time)continue;const O=l.put(_[0]+"",C.id);O&&this._gcTree(O)}}else if(g instanceof t.InsVecOp){const l=b.get(g.obj),h=g.data,v=h.length;if(l instanceof c.VecNode)for(let y=0;y<v;y++){const _=h[y],C=b.get(_[1]);if(!C||l.id.time>=_[1].time)continue;const O=l.put(Number(_[0]),C.id);O&&this._gcTree(O)}}else if(g instanceof t.InsValOp){const l=g.obj,h=l.sid===0&&l.time===0?this.root:b.get(l);if(h instanceof c.ValNode&&b.get(g.val)){const y=h.set(g.val);y&&this._gcTree(y)}}else if(g instanceof t.InsArrOp){const l=b.get(g.obj);if(l instanceof c.ArrNode){const h=[],v=g.data,y=v.length;for(let _=0;_<y;_++){const C=v[_];b.get(C)&&(l.id.time>=C.time||h.push(C))}h.length&&l.ins(g.ref,g.id,h)}}else if(g instanceof t.UpdArrOp){const l=b.get(g.obj);if(l instanceof c.ArrNode){const h=g.val;if(b.get(h)){const v=l.upd(g.ref,h);v&&this._gcTree(v)}}}else if(g instanceof t.DelOp){const l=b.get(g.obj);if(l instanceof c.ArrNode){const h=g.what.length;for(let v=0;v<h;v++){const y=g.what[v];for(let _=0;_<y.span;_++){const C=l.getById(new d.Timestamp(y.sid,y.time+_));C&&this._gcTree(C)}}l.delete(g.what)}else(l instanceof c.StrNode||l instanceof c.BinNode)&&l.delete(g.what)}else if(g instanceof t.NewBinOp){const l=g.id;b.get(l)||b.set(l,new c.BinNode(l))}else if(g instanceof t.InsBinOp){const l=b.get(g.obj);l instanceof c.BinNode&&l.ins(g.ref,g.id,g.data)}else if(g instanceof t.NewVecOp){const l=g.id;b.get(l)||b.set(l,new c.VecNode(this,l))}}_gcTree(g){if(g.sid===0)return;const l=this.index.get(g);if(!l)return;const h=l.api;h&&h.events.handleDelete(),l.children(v=>this._gcTree(v.id)),this.index.del(g)}fork(g=this.rndSid()){const b=wi.fromBinary(this.toBinary());return b.clock.sid!==g&&b.clock instanceof d.ClockVector&&(b.clock=b.clock.fork(g)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(g){this.onbeforereset?.();const b=this.index;this.index=new f.AvlMap(d.compare);const l=g.toBinary();a.decoder.decode(l,this),this.clock=g.clock.clone(),this.ext=g.ext.clone();const h=this._api;h&&(h.flush(),h.builder.clock=this.clock,h.node=this.root),b.forEach(({v})=>{const y=v.api;if(!y)return;const _=this.index.get(v.id);if(!_){y.events.handleDelete();return}y.node=_,_.api=y}),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return a.encoder.encode(this)}setSchema(g,b=!0){const l=this.clock;if(l.time===1){const v=l.sid;b&&(l.sid=2),this.api.set(g),b&&this.setSid(v)}return this}setSid(g){const b=this.clock,l=b.sid;l!==g&&(b.sid=g,b.observe(new d.Timestamp(l,b.time-1),1))}toString(g=""){const b=()=>"",l=this.ext.size()>0;return"model"+(0,o.printTree)(g,[h=>this.root.toString(h),b,h=>{const v=[];return this.index.forEach(y=>v.push(y.v)),`index (${v.length} nodes)`+(v.length?(0,o.printTree)(h,v.map(y=>_=>`${y.name()} ${d.printTs(y.id)}`)):"")},b,h=>`view${(0,o.printTree)(h,[v=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+v)])}`,b,h=>this.clock.toString(h),l?b:null,l?h=>this.ext.toString(h):null])}};return Te.Model=p,p.sid=r.randomSessionId,p.create=(w,g=p.sid())=>{const b=typeof g=="number"?g===1?new d.ServerClockVector(1,1):new d.ClockVector(g,1):g,l=new p(b);return w!==void 0&&l.setSchema(w instanceof m.NodeBuilder?w:m.s.json(w),!0),l},p.withServerClock=(w,g=1)=>p.create(w,new d.ServerClockVector(1,g)),p.fromBinary=w=>a.decoder.decode(w),p.load=(w,g,b)=>{const l=a.decoder.decode(w);return b&&l.setSchema(b,!0),typeof g=="number"&&l.setSid(g),l},Te}var $a;function $l(){if($a)return Rt;$a=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.ValNode=void 0;const e=H(),t=he(),d=Li();let a=class{constructor(u,r,c){this.doc=u,this.id=r,this.val=c,this.api=void 0}set(u){if((0,e.compare)(u,this.val)<=0&&this.val.sid!==0||(0,e.compare)(u,this.id)<=0)return;const r=this.val;return this.val=u,r}node(){return this.val.sid===0?d.UNDEFINED:this.child()}view(){return this.node()?.view()}children(u){u(this.node())}child(){return this.doc.index.get(this.val)}container(){const u=this.node();return u?u.container():void 0}name(){return"val"}toString(u=""){const r=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,t.printTree)(u,[s=>r?r.toString(s):(0,e.printTs)(this.val)])}};return Rt.ValNode=a,Rt}var bn={},eu;function rp(){if(eu)return bn;eu=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.RootNode=void 0;const e=Pr(),t=$l();let d=class extends t.ValNode{constructor(n,u){super(n,e.ORIGIN,u)}name(){return"root"}};return bn.RootNode=d,bn}var gn={},yn={},tu;function sp(){if(tu)return yn;tu=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.CRDT_CONSTANTS=void 0;var e;return(function(t){t[t.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"})(e||(yn.CRDT_CONSTANTS=e={})),yn}var nu;function ip(){if(nu)return gn;nu=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.VecNode=void 0;const e=jr(),t=sp(),d=he(),a=H();let n=class{constructor(r,c){this.doc=r,this.id=c,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(r){return this.elements[r]}get(r){const c=this.elements[r];if(c)return this.doc.index.get(c)}put(r,c){if(r>t.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const s=this.val(r);if(!(s&&(0,a.compare)(s,c)>=0)){if(r>this.elements.length)for(let o=this.elements.length;o<r;o++)this.elements.push(void 0);return r<this.elements.length?this.elements[r]=c:this.elements.push(c),s}}ext(){if(this.__extNode)return this.__extNode;const r=this.getExtId();if(!(r>=0))return;const s=this.doc.ext.get(r);if(s)return this.__extNode=new s.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const r=this.get(0);if(!(r instanceof e.ConNode))return-1;const c=r.val,s=this.id;return!(c instanceof Uint8Array)||c.length!==3||c[1]!==s.sid%256||c[2]!==s.time%256?-1:c[0]}child(){return this.ext()}container(){return this}children(r){const c=this.elements,s=c.length,o=this.doc.index;for(let i=0;i<s;i++){const f=c[i];if(!f)continue;const m=o.get(f);m&&r(m)}}view(){const r=this.ext();if(r)return r.view();let c=!0;const s=this._view,o=[],i=this.doc.index,f=this.elements,m=f.length;for(let p=0;p<m;p++){const w=f[p],g=w?i.get(w):void 0,b=g?g.view():void 0;s[p]!==b&&(c=!1),o.push(b)}return c?s:this._view=o}name(){return"vec"}toString(r=""){const c=this.ext(),s=this.name()+" "+(0,a.printTs)(this.id)+(c?` { extension = ${this.getExtId()} }`:"");if(c)return this.child().toString(r,this.id);const o=this.doc.index;return s+(0,d.printTree)(r,[...this.elements.map((i,f)=>m=>`${f}: ${i&&o.get(i)?o.get(i).toString(m+"  "+" ".repeat((""+f).length)):"nil"}`),...c?[i=>`${this.child().toString(i)}`]:[]])}};return gn.VecNode=n,gn}var vn={},ru;function op(){if(ru)return vn;ru=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.ObjNode=void 0;const e=he(),t=H(),d=jr();let a=class{constructor(u,r){this.doc=u,this.id=r,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(u){const r=this.keys.get(u);if(r)return this.doc.index.get(r)}put(u,r){const c=this.keys.get(u);if(!(c&&(0,t.compare)(c,r)>=0))return this.keys.set(u,r),c}nodes(u){const r=this.doc.index;this.keys.forEach((c,s)=>u(r.get(c),s))}forEach(u){const r=this.doc.index;this.keys.forEach((c,s)=>{const o=r.get(c);!o||o instanceof d.ConNode&&o.val===void 0||u(s,o)})}children(u){const r=this.doc.index;this.keys.forEach((c,s)=>u(r.get(c)))}child(){}container(){return this}view(){const u=this.doc,r=u.clock.time+u.tick,c=this._view;if(this._tick===r)return c;const s={},o=u.index;let i=!0;return this.keys.forEach((f,m)=>{const p=o.get(f);if(!p){i=!1;return}const w=p.view();w!==void 0?(c[m]!==w&&(i=!1),s[m]=w):c[m]!==void 0&&(i=!1)}),i?c:(this._tick=r,this._view=s)}name(){return"obj"}toString(u=""){return this.name()+" "+(0,t.printTs)(this.id)+(0,e.printTree)(u,[...this.keys.entries()].filter(([,c])=>!!this.doc.index.get(c)).map(([c,s])=>o=>JSON.stringify(c)+(0,e.printTree)(o+" ",[i=>this.doc.index.get(s).toString(i)])))}};return vn.ObjNode=a,vn}var Ve={},wn={},ii={},su;function cp(){return su||(su=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const t=(s,o,i)=>{const f=o.p;if(!f)return s;const m=f.p,p=f.l===o;return m?(m.l===f?p?s=(0,e.llSplay)(s,o,f,m):s=(0,e.lrSplay)(s,o,f,m):p?s=(0,e.rlSplay)(s,o,f,m):s=(0,e.rrSplay)(s,o,f,m),i>1?(0,e.splay)(s,o,i-1):s):(p?(0,e.rSplay)(o,f):(0,e.lSplay)(o,f),o)};e.splay=t;const d=(s,o)=>{const i=s.r;s.p=void 0,s.r=o,o.p=s,o.l=i,i&&(i.p=o)};e.rSplay=d;const a=(s,o)=>{const i=s.l;s.p=void 0,s.l=o,o.p=s,o.r=i,i&&(i.p=o)};e.lSplay=a;const n=(s,o,i,f)=>{const m=i.l,p=o.l,w=f.p;return o.p=w,o.l=i,i.p=o,i.l=f,i.r=p,f.p=i,f.r=m,m&&(m.p=f),p&&(p.p=i),w?w.l===f?w.l=o:w.r=o:s=o,s};e.rrSplay=n;const u=(s,o,i,f)=>{const m=i.r,p=o.r,w=f.p;return o.p=w,o.r=i,i.p=o,i.l=p,i.r=f,f.p=i,f.l=m,m&&(m.p=f),p&&(p.p=i),w?w.l===f?w.l=o:w.r=o:s=o,s};e.llSplay=u;const r=(s,o,i,f)=>{const m=o.l,p=o.r,w=f.p;return o.p=w,o.l=i,o.r=f,i.p=o,i.r=m,f.p=o,f.l=p,m&&(m.p=i),p&&(p.p=f),w?w.l===f?w.l=o:w.r=o:s=o,s};e.lrSplay=r;const c=(s,o,i,f)=>{const m=o.r,p=o.l,w=f.p;return o.p=w,o.l=f,o.r=i,i.p=o,i.l=m,f.p=o,f.r=p,m&&(m.p=i),p&&(p.p=f),w?w.l===f?w.l=o:w.r=o:s=o,s};e.rlSplay=c})(ii)),ii}var oi={},iu;function ap(){return iu||(iu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const t=(s,o)=>{const i=o.p2;if(!i)return s;const f=i.p2,m=i.l2===o;return f?(f.l2===i?m?s=u(s,o,i,f):s=r(s,o,i,f):m?s=c(s,o,i,f):s=n(s,o,i,f),(0,e.splay2)(s,o)):(m?d(o,i):a(o,i),o)};e.splay2=t;const d=(s,o)=>{const i=s.r2;s.p2=void 0,s.r2=o,o.p2=s,o.l2=i,i&&(i.p2=o)},a=(s,o)=>{const i=s.l2;s.p2=void 0,s.l2=o,o.p2=s,o.r2=i,i&&(i.p2=o)},n=(s,o,i,f)=>{const m=i.l2,p=o.l2,w=f.p2;return o.p2=w,o.l2=i,i.p2=o,i.l2=f,i.r2=p,f.p2=i,f.r2=m,m&&(m.p2=f),p&&(p.p2=i),w?w.l2===f?w.l2=o:w.r2=o:s=o,s},u=(s,o,i,f)=>{const m=i.r2,p=o.r2,w=f.p2;return o.p2=w,o.r2=i,i.p2=o,i.l2=p,i.r2=f,f.p2=i,f.l2=m,m&&(m.p2=f),p&&(p.p2=i),w?w.l2===f?w.l2=o:w.r2=o:s=o,s},r=(s,o,i,f)=>{const m=o.l2,p=o.r2,w=f.p2;return o.p2=w,o.l2=i,o.r2=f,i.p2=o,i.r2=m,f.p2=o,f.l2=p,m&&(m.p2=i),p&&(p.p2=f),w?w.l2===f?w.l2=o:w.r2=o:s=o,s},c=(s,o,i,f)=>{const m=o.r2,p=o.l2,w=f.p2;return o.p2=w,o.l2=f,o.r2=i,i.p2=o,i.l2=m,f.p2=o,f.r2=p,m&&(m.p2=i),p&&(p.p2=f),w?w.l2===f?w.l2=o:w.r2=o:s=o,s}})(oi)),oi}var ne={},ou;function up(){if(ou)return ne;ou=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.remove2=ne.insert2=ne.prev2=ne.next2=ne.last2=ne.first2=void 0;const e=s=>{let o=s;for(;o;)if(o.l2)o=o.l2;else return o;return o};ne.first2=e;const t=s=>{let o=s;for(;o;)if(o.r2)o=o.r2;else return o;return o};ne.last2=t;const d=s=>{if(s.r2){for(s=s.r2;s.l2;)s=s.l2;return s}let o=s.p2;for(;o&&o.r2===s;)s=o,o=o.p2;return o};ne.next2=d;const a=s=>{if(s.l2){for(s=s.l2;s.r2;)s=s.r2;return s}let o=s.p2;for(;o&&o.l2===s;)s=o,o=o.p2;return o};ne.prev2=a;const n=(s,o)=>{const i=s.r2=o.r2;o.r2=s,s.p2=o,i&&(i.p2=s)},u=(s,o)=>{const i=s.l2=o.l2;o.l2=s,s.p2=o,i&&(i.p2=s)},r=(s,o,i)=>{if(!s)return o;let f=s;for(;f;){const m=i(o,f),p=m<0?f.l2:f.r2;if(p)f=p;else{m<0?u(o,f):n(o,f);break}}return s};ne.insert2=r;const c=(s,o)=>{const i=o.p2,f=o.l2,m=o.r2;if(o.p2=o.l2=o.r2=void 0,!f&&!m){if(i)i.l2===o?i.l2=void 0:i.r2=void 0;else return;return s}else if(f&&m){let w=f;for(;w.r2;)w=w.r2;return w.r2=m,m.p2=w,i?(i.l2===o?i.l2=f:i.r2=f,f.p2=i,s):(f.p2=void 0,f)}const p=f||m;if(p.p2=i,i)i.l2===o?i.l2=p:i.r2=p;else return p;return s};return ne.remove2=c,ne}var _n={},cu;function lp(){if(cu)return _n;cu=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.printOctets=void 0;const e=(t,d=16)=>{let a="";if(!t.length)return a;t[0]<16&&(a+="0"),a+=t[0].toString(16);for(let n=1;n<t.length&&n<d;n++){const u=t[n];a+=" ",u<16&&(a+="0"),a+=u.toString(16)}return t.length>d&&(a+=`… (${t.length-d} more)`),a};return _n.printOctets=e,_n}var au;function Di(){if(au)return wn;au=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.AbstractRga=void 0;const e=H(),t=qi(),d=cp(),a=ap(),n=up(),u=Pr(),r=he(),c=Ji(),s=lp(),o=(b,l)=>{const h=b.id,v=l.id;return h.sid-v.sid||h.time-v.time},i=b=>{const l=b.l,h=b.r;b.len=(b.del?0:b.span)+(l?l.len:0)+(h?h.len:0)},f=b=>{const l=b.l,h=b.r;b.len=b.span+(l?l.len:0)+(h?h.len:0)},m=(b,l)=>{for(;b;)b.len+=l,b=b.p},p=b=>{const l=b.r;if(l){b=l;let v;for(;v=b.l;)b=v;return b}let h=b.p;for(;h&&h.r===b;)b=h,h=h.p;return h},w=b=>{const l=b.l;if(l){b=l;let v;for(;v=b.r;)b=v;return b}let h=b.p;for(;h&&h.l===b;)b=h,h=h.p;return h};let g=class{constructor(l){this.id=l,this.root=void 0,this.ids=void 0,this.count=0}ins(l,h,v){const y=this.id,_=l.time,C=l.sid;if(y.time===_&&y.sid===C){this.insAfterRoot(l,h,v);return}let k=this.ids,S=k;for(;k;){const T=k.id,q=T.sid;if(q>C)k=k.l2;else if(q<C)S=k,k=k.r2;else{const B=T.time;if(B>_)k=k.l2;else if(B<_)S=k,k=k.r2;else{S=k;break}}}if(!S)return;const E=S.id,x=E.time,A=E.sid,N=S.span;if(A!==C||_-x>=N)return;const R=_-x;this.insAfterChunk(l,S,R,h,v)}insAt(l,h,v){if(!l){const S=this.id;return this.insAfterRoot(S,h,v),S}const y=this.findChunk(l-1);if(!y)return;const[_,C]=y,O=_.id,k=C===0?O:new e.Timestamp(O.sid,O.time+C);return this.insAfterChunk(k,_,C,h,v),k}insAfterRoot(l,h,v){const y=this.createChunk(h,v),_=this.first();if(!_)this.setRoot(y);else if((0,e.compare)(_.id,h)<0)this.insertBefore(y,_);else{if((0,e.containsId)(_.id,_.span,h))return;this.insertAfterRef(y,l,_)}}insAfterChunk(l,h,v,y,_){const C=h.id,O=C.time,k=C.sid,S=h.span,E=this.createChunk(y,_);if(v+1<S){const A=y.sid,N=y.time;if(k===A&&O<=N&&O+S-1>=N)return;if(N>l.time+1||A>l.sid){this.insertInside(E,h,v+1),this.splay(E);return}}this.insertAfterRef(E,l,h),this.splay(E)}delete(l){const h=l.length;for(let v=0;v<h;v++)this.deleteSpan(l[v]);this.onChange()}deleteSpan(l){const h=l.span,v=l.time,y=v+h-1,_=this.findById(l);if(!_)return;let C=_,O=C;for(;C;){O=C;const k=C.id,S=C.span,E=k.time,x=E+S-1;if(C.del){if(x>=y)break;C=C.s;continue}const A=v<=E,N=v<=x;if(A)if(y>=x){if(C.delete(),m(C,-C.span),y<=x)break}else{const R=y-E+1,T=this.split(C,R);C.delete(),i(T),m(C,-C.span);break}else if(N)if(y>=x){const R=v-E,T=this.split(C,R);if(T.delete(),T.len=T.r?T.r.len:0,m(C,-T.span),y<=x)break}else{const R=this.split(C,y-E+1),T=this.split(C,v-E);T.delete(),i(R),i(T),m(C,-T.span);break}C=C.s}O&&this.mergeTombstones2(_,O)}find(l){let h=this.root;for(;h;){const v=h.l,y=v?v.len:0;let _;if(l<y)h=v;else if(h.del)l-=y,h=h.r;else if(l<y+(_=h.span)){const C=l-y,O=h.id;return C?new e.Timestamp(O.sid,O.time+C):O}else l-=y+_,h=h.r}}findChunk(l){let h=this.root;for(;h;){const v=h.l,y=v?v.len:0;let _;if(l<y)h=v;else if(h.del)l-=y,h=h.r;else{if(l<y+(_=h.span))return[h,l-y];l-=y+_,h=h.r}}}findInterval(l,h){const v=[];if(!h)return v;let y=this.root,_=0;for(;y;){const k=y.l?y.l.len:0;if(l<k)y=y.l;else if(y.del)l-=k,y=y.r;else if(l<k+y.span){_=l-k;break}else l-=k+y.span,y=y.r}if(!y)return v;if(y.span>=h+_){const k=y.id;return v.push((0,e.tss)(k.sid,k.time+_,h)),v}const C=y.span-_,O=y.id;if(v.push((0,e.tss)(O.sid,O.time+_,C)),h-=C,y=p(y),!y)return v;do{if(y.del)continue;const k=y.id,S=y.span;if(h<=S)return v.push((0,e.tss)(k.sid,k.time,h)),v;v.push((0,e.tss)(k.sid,k.time,S)),h-=S}while((y=p(y))&&h>0);return v}findInterval2(l,h){const v=[];return this.range0(void 0,l,h,(y,_,C)=>{const O=y.id;v.push((0,e.tss)(O.sid,O.time+_,C))}),v}range0(l,h,v,y){let _=l||this.findById(h);if(l)for(;_&&!(0,e.containsId)(_.id,_.span,h);)_=p(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,v))return}else{const C=h.time-_.id.time;if((0,e.containsId)(_.id,_.span,v)){const S=v.time-h.time+1;return y(_,C,S),_}const k=_.span-C;if(y(_,C,k))return _}for(_=p(_);_;){if((0,e.containsId)(_.id,_.span,v))return!_.del&&y(_,0,v.time-_.id.time+1),_;if(!_.del&&y(_,0,_.span))return _;_=p(_)}return _}}first(){let l=this.root;for(;l;){const h=l.l;if(h)l=h;else return l}return l}last(){let l=this.root;for(;l;){const h=l.r;if(h)l=h;else return l}return l}lastId(){const l=this.last();if(!l)return;const h=l.id,v=l.span;return v===1?h:new e.Timestamp(h.sid,h.time+v-1)}next(l){return p(l)}prev(l){return w(l)}length(){const l=this.root;return l?l.len:0}size(){return this.count}pos(l){const h=l.p,v=l.l;if(!h)return v?v.len:0;const y=this.pos(h);if(h.r===l)return y+(h.del?0:h.span)+(v?v.len:0);const C=l.r;return y-(l.del?0:l.span)-(C?C.len:0)}setRoot(l){this.root=l,this.insertId(l),this.onChange()}insertBefore(l,h){const v=h.l;h.l=l,l.l=v,l.p=h;let y=0;v&&(v.p=l,y=v.len),l.len=l.span+y,m(h,l.span),this.insertId(l),this.onChange()}insertAfter(l,h){const v=h.r;h.r=l,l.r=v,l.p=h;let y=0;v&&(v.p=l,y=v.len),l.len=l.span+y,m(h,l.span),this.insertId(l),this.onChange()}insertAfterRef(l,h,v){const y=l.id,_=y.sid,C=y.time;let O=!1;for(;;){const k=v.id,S=k.time+v.span;v.s||(O=k.sid===_&&S===C&&S-1===h.time,O&&(v.s=l));const E=p(v);if(!E)break;const x=E.id,A=x.time,N=x.sid;if(A<C)break;if(A===C){if(N===_)return;if(N<_)break}v=E}O&&!v.del?(this.mergeContent(v,l.data),v.s=void 0):this.insertAfter(l,v)}mergeContent(l,h){const v=l.span;l.merge(h),m(l,l.span-v),this.onChange()}insertInside(l,h,v){const y=h.p,_=h.l,C=h.r,O=h.s,k=h.len,S=h.split(v);if(h.s=S,S.s=O,h.l=h.r=S.l=S.r=void 0,S.l=void 0,l.p=y,!_)l.l=h,h.p=l;else{l.l=_,_.p=l;const A=_.r;_.r=h,h.p=_,h.l=A,A&&(A.p=h)}if(!C)l.r=S,S.p=l;else{l.r=C,C.p=l;const A=C.l;C.l=S,S.p=C,S.r=A,A&&(A.p=S)}y?y.l===h?y.l=l:y.r=l:this.root=l,i(h),i(S),_&&(_.len=(_.l?_.l.len:0)+h.len+(_.del?0:_.span)),C&&(C.len=(C.r?C.r.len:0)+S.len+(C.del?0:C.span)),l.len=k+l.span;const E=l.span;let x=l.p;for(;x;)x.len+=E,x=x.p;this.insertId(S),this.insertIdFast(l),this.onChange()}split(l,h){const v=l.s,y=l.split(h),_=l.r;return l.s=y,y.r=_,y.s=v,l.r=y,y.p=l,this.insertId(y),_&&(_.p=y),y}mergeTombstones(l,h){if(!l.del||!h.del)return!1;const v=l.id,y=h.id;return v.sid!==y.sid||v.time+l.span!==y.time?!1:(l.s=h.s,l.span+=h.span,this.deleteChunk(h),!0)}mergeTombstones2(l,h){let v=l;for(;v;){const _=p(v);if(!_)break;if(!this.mergeTombstones(v,_)){if(_===h){if(_){const O=p(_);O&&this.mergeTombstones(_,O)}break}v=v.s}}const y=w(l);y&&this.mergeTombstones(y,l)}removeTombstones(){let l=this.first();const h=[];for(;l;)l.del&&h.push(l),l=p(l);for(let v=0;v<h.length;v++)this.deleteChunk(h[v])}deleteChunk(l){this.deleteId(l);const h=l.p,v=l.l,y=l.r;if(l.id=u.ORIGIN,!v&&!y)h?h.l===l?h.l=void 0:h.r=void 0:this.root=void 0;else if(v&&y){let _=v;for(;_.r;)_=_.r;_.r=y,y.p=_;const C=y.len;let O;for(O=_,h?(h.l===l?h.l=v:h.r=v,v.p=h):(this.root=v,v.p=void 0);O&&O!==h;)O.len+=C,O=O.p}else{const _=v||y;_.p=h,h?h.l===l?h.l=_:h.r=_:this.root=_}}insertId(l){this.ids=(0,n.insert2)(this.ids,l,o),this.count++,this.ids=(0,a.splay2)(this.ids,l)}insertIdFast(l){this.ids=(0,n.insert2)(this.ids,l,o),this.count++}deleteId(l){this.ids=(0,n.remove2)(this.ids,l),this.count--}findById(l){const h=l.sid,v=l.time;let y=this.ids,_=y;for(;y;){const x=y.id,A=x.sid;if(A>h)y=y.l2;else if(A<h)_=y,y=y.r2;else{const N=x.time;if(N>v)y=y.l2;else if(N<v)_=y,y=y.r2;else{_=y;break}}}if(!_)return;const C=_.id,O=C.time,k=C.sid,S=_.span;if(!(k!==h||v<O||v-O>=S))return _}prevId(l){let h=this.findById(l);if(!h)return;const v=l.time;if(h.id.time<v)return new e.Timestamp(l.sid,v-1);if(h=w(h),!h)return;const y=h.id;return h.span>1?new e.Timestamp(y.sid,y.time+h.span-1):y}spanView(l){const h=[];let v=l.span;const y=l.time;let _=this.findById(l);if(!_)return h;if(!_.del)if(_.span>=v+y-_.id.time){const C=y-_.id.time,O=C+v,k=_.view().slice(C,O);return h.push(k),h}else{const C=y-_.id.time,O=_.view().slice(C,l.span);v-=_.span-C,h.push(O)}for(;_=_.s;){const C=_.span;if(!_.del){if(C>v){const O=_.view().slice(0,v);h.push(O);break}h.push(_.data)}if(v-=C,v<=0)break}return h}splay(l){const h=l.p;if(!h)return;const v=h.p,y=h.l===l;if(!v){y?(0,d.rSplay)(l,h):(0,d.lSplay)(l,h),this.root=l,i(h),f(l);return}v.l===h?y?this.root=(0,d.llSplay)(this.root,l,h,v):this.root=(0,d.lrSplay)(this.root,l,h,v):y?this.root=(0,d.rlSplay)(this.root,l,h,v):this.root=(0,d.rrSplay)(this.root,l,h,v),i(v),i(h),f(l),this.splay(l)}iterator(){let l=this.first();return()=>{const h=l;return l&&(l=p(l)),h}}ingest(l,h){if(l<1)return;const v=new Map;this.root=this._ingest(l,()=>{const y=h(),_=y.id,C=_.sid+"."+_.time,O=v.get(C);O&&(O.s=y,v.delete(C));const k=(0,e.tick)(_,y.span);return v.set(k.sid+"."+k.time,y),y})}_ingest(l,h){const v=l>>1,y=l-v-1,_=v>0?this._ingest(v,h):void 0,C=h();_&&(C.l=_,_.p=C);const O=y>0?this._ingest(y,h):void 0;return O&&(C.r=O,O.p=C),i(C),this.insertId(C),C}toStringName(){return"AbstractRga"}toString(l=""){const h=this.view();let v="";return(0,t.isUint8Array)(h)?v+=` { ${(0,s.printOctets)(h)||"∅"} }`:typeof h=="string"&&(v+=`{ ${h.length>32?JSON.stringify(h.substring(0,32))+" …":JSON.stringify(h)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${v}`+(0,r.printTree)(l,[_=>this.root?this.printChunk(_,this.root):"∅"])}printChunk(l,h){return this.formatChunk(h)+(0,c.printBinary)(l,[h.l?v=>this.printChunk(v,h.l):null,h.r?v=>this.printChunk(v,h.r):null])}formatChunk(l){let v=`chunk ${(0,e.printTs)(l.id)}:${l.span} .${l.len}.`;if(l.del)v+=` [${l.span}]`;else if((0,t.isUint8Array)(l.data))v+=` { ${(0,s.printOctets)(l.data)||"∅"} }`;else if(typeof l.data=="string"){const y=l.data.length>32?JSON.stringify(l.data.substring(0,32))+" …":JSON.stringify(l.data);v+=` { ${y} }`}return v}};return wn.AbstractRga=g,wn}var uu;function dp(){if(uu)return Ve;uu=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.ArrNode=Ve.ArrChunk=void 0;const e=Di(),t=H(),d=Ji(),a=he();class n{constructor(c,s,o){this.id=c,this.span=s,this.len=o?s:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(c){this.data.push(...c),this.span=this.data.length}split(c){const s=this.span;if(this.span=c,!this.del){const i=this.data.splice(c);return new n((0,t.tick)(this.id,c),s-c,i)}return new n((0,t.tick)(this.id,c),s-c,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new n(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ve.ArrChunk=n;let u=class extends e.AbstractRga{constructor(c,s){super(s),this.doc=c,this._tick=0,this._view=[],this.api=void 0}get(c){const s=this.findChunk(c);if(s)return s[0].data[s[1]]}getNode(c){const s=this.get(c);if(s)return this.doc.index.get(s)}getId(c){const s=this.findChunk(c);if(!s)return;const[o,i]=s,f=o.id;return i?(0,t.tick)(f,i):f}getById(c){const s=this.findById(c);if(!s||s.del)return;const o=c.time-s.id.time;return s.data[o]}upd(c,s){const o=this.findById(c);if(!o)return;const i=o.data;if(!i)return;const f=c.time-o.id.time,m=i[f];if(!(m&&(0,t.compare)(m,s)>=0))return i[f]=s,this.onChange(),m}createChunk(c,s){return new n(c,s?s.length:0,s)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const c=this.doc,s=c.clock.time+c.tick,o=this._view;if(this._tick===s)return o;const i=[],f=c.index;let m=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const g of w.data){const b=f.get(g);if(!b){m=!1;continue}const l=b.view();o[i.length]!==l&&(m=!1),i.push(l)}return o.length!==i.length&&(m=!1),m?o:(this._tick=s,this._view=i)}children(c){const s=this.doc.index;for(let o=this.first();o;o=this.next(o)){const i=o.data;if(!i)continue;const f=i.length;for(let m=0;m<f;m++)c(s.get(i[m]))}}name(){return"arr"}printChunk(c,s){const o=this.pos(s);let i="";if(!s.del){const f=this.doc.index;i=(0,a.printTree)(c,s.data.map(m=>f.get(m)).filter(m=>!!m).map((m,p)=>w=>`[${o+p}]: ${m.toString(w+"    "+" ".repeat(String(p).length))}`))}return this.formatChunk(s)+i+(0,d.printBinary)(c,[s.l?f=>this.printChunk(f,s.l):null,s.r?f=>this.printChunk(f,s.r):null])}};return Ve.ArrNode=u,Ve}var Je={},lu;function fp(){if(lu)return Je;lu=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.BinNode=Je.BinChunk=void 0;const e=H(),t=Di();class d{constructor(u,r,c){this.id=u,this.span=r,this.len=c?r:0,this.del=!c,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=c}merge(u){const r=this.data.length,c=new Uint8Array(r+u.length);c.set(this.data),c.set(u,r),this.data=c,this.span=c.length}split(u){if(!this.del){const c=this.data,s=c.subarray(u),o=new d((0,e.tick)(this.id,u),this.span-u,s);return this.data=c.subarray(0,u),this.span=u,o}const r=new d((0,e.tick)(this.id,u),this.span-u,void 0);return this.span=u,r}delete(){this.del=!0,this.data=void 0}clone(){return new d(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Je.BinChunk=d;let a=class extends t.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const u=new Uint8Array(this.length());let r=0,c=this.first();for(;c;){if(!c.del){const s=c.data;u.set(s,r),r+=s.length}c=this.next(c)}return this._view=u}children(){}child(){}container(){}name(){return"bin"}createChunk(u,r){return new d(u,r?r.length:0,r)}onChange(){this._view=null}toStringName(){return this.name()}};return Je.BinNode=a,Je}var Le={},du;function hp(){if(du)return Le;du=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.StrNode=Le.StrChunk=void 0;const e=H(),t=Di(),d=Zl();class a{constructor(r,c,s){this.id=r,this.span=c,this.len=s?c:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=s}merge(r){this.data+=r,this.span=this.data.length}split(r){if(!this.del){const s=new a((0,e.tick)(this.id,r),this.span-r,this.data.slice(r));return this.data=this.data.slice(0,r),this.span=r,s}const c=new a((0,e.tick)(this.id,r),this.span-r,"");return this.span=r,c}delete(){this.del=!0,this.data=""}clone(){return new a(this.id,this.span,this.data)}view(){return this.data}}Le.StrChunk=a;let n=class extends t.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let r="";for(let c=this.first();c;c=(0,d.next)(c))r+=c.data;return this._view=r}name(){return"str"}createChunk(r,c){return new a(r,c?c.length:0,c||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Le.StrNode=n,Le}var fu;function pp(){return fu||(fu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var t=jr();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return t.ConNode}});var d=$l();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return d.ValNode}});var a=rp();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return a.RootNode}});var n=ip();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return n.VecNode}});var u=op();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return u.ObjNode}});var r=dp();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return r.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return r.ArrChunk}});var c=fp();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return c.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return c.BinChunk}});var s=hp();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return s.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return s.StrChunk}})})(Ts)),Ts}var hu;function ke(){return hu||(hu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(l0(),e),t.__exportStar(pp(),e)})(Rs)),Rs}var ci={},pu;function mp(){return pu||(pu=1,Object.defineProperty(ci,"__esModule",{value:!0})),ci}var ai={},mu;function bp(){return mu||(mu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const t=L;var d=Li();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return d.Model}}),t.__exportStar(Yl(),e)})(ai)),ai}var bu;function dr(){return bu||(bu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(ke(),e),t.__exportStar(mp(),e),t.__exportStar(bp(),e),t.__exportStar(qr(),e)})(Ns)),Ns}var Cn={},Sn={},On={},gu;function gp(){if(gu)return On;gu=1,Object.defineProperty(On,"__esModule",{value:!0}),On.PropertyLayout=void 0;const e=M(),t=Y(),d=Q(),a=({property:n,formal:u,focused:r})=>{const c=(0,t.useTheme)(),s={color:c.g(.1)};return r&&(s.background=c.bg,s.border=`1px solid ${c.g(.9)}`,s.fontWeight="bold",s.margin="-3px",s.padding="2px"),(!n||n.indexOf(" ")!==-1)&&(s.background=c.blue(.1)),e.createElement(e.Fragment,null,e.createElement("span",{className:d.property,style:s},u?JSON.stringify(n):n),e.createElement("span",{className:d.colon,style:{color:c.g(.5)}},e.createElement("span",null,":")))};return On.PropertyLayout=a,On}var yu;function ve(){if(yu)return Sn;yu=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.JsonCrdtProperty=void 0;const e=M(),t=gp(),d=({node:a})=>!a.parent||a.parent.node.name()!=="obj"?null:e.createElement(t.PropertyLayout,{property:a.step});return Sn.JsonCrdtProperty=d,Sn}var En={},kn={},vu;function yp(){if(vu)return kn;vu=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.TypeAndId=void 0;const e=M(),t=Y(),d=dr(),a=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",us:"none",pe:"none"}));return kn.TypeAndId=e.memo(({node:n,active:u,negative:r,extension:c})=>{const s=(0,t.useTheme)(),o=n.node;let i=o.name();c&&o instanceof d.VecNode&&o.isExt()&&(i=e.createElement("span",{style:{whiteSpace:"nowrap"}},"ext ",e.createElement("span",{style:{color:s.color.sem.brand[1]}},o.ext().name())));const{sid:f,time:m}=o.id;return e.createElement("span",{className:a,style:{color:u?r?s.color.sem.negative[0]:s.color.sem.blue[0]:s.g(0,.5)}},i,e.createElement("span",{style:{color:u?s.g(0,.45):s.g(0,.2),display:"block"}},u?(f>999?"...":"")+String(f).slice(String(f).length-4):null,e.createElement("span",{style:{color:u?s.g(0,.7):s.g(0,.3)}},"."+m)))}),kn}var ge={},wu;function we(){if(wu)return ge;wu=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.isContainer=ge.createValue=ge.id=void 0;const e=a=>{const n=a.node.id;return n.sid+"."+n.time};ge.id=e;const t=(a,n,u,r)=>{let c=n;try{c=JSON.parse(n)}catch{}const s=a.api,o=s.builder,i=u==="any"?r?o.constOrJson(c):o.json(c):u==="con"?s.builder.const(c):u==="vec"?s.builder.vec():u==="val"?s.builder.val():s.builder.const(void 0);if(u==="vec"){if(n){const f=Array.isArray(c)?c:[c];o.insVec(i,f.map((m,p)=>[p,s.builder.maybeConst(m)]))}}else u==="val"&&o.setVal(i,n?s.builder.maybeConst(c):s.builder.const(void 0));return i};ge.createValue=t;const d=a=>!!a&&typeof a=="object";return ge.isContainer=d,ge}var xn={},_u;function vp(){if(_u)return xn;_u=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.JsonCrdtRegionEdit=void 0;const e=M(),t=ve(),d=Ti(),a=Tr(),n=Ii(),u=ee(),r=we(),c=ue(),s=({node:o,onCancel:i})=>{const{compact:f}=(0,u.useStyles)(),{model:m}=(0,c.useJsonCrdt)(),p=(b,l)=>{const h=o.parent;if(h&&h.node.name()==="obj"){const v=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set({[o.step]:v})}else if(h&&(h.node.name()==="val"||h.node.name()==="root")){const v=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set(v)}else if(h&&h.node.name()==="vec"){const v=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set([[+o.step,v]])}i&&i()},w=o.node.view(),g=(0,r.isContainer)(w)?"":JSON.stringify(w);return e.createElement(n.FocusRegion,{compact:f},e.createElement(t.JsonCrdtProperty,{node:o}),e.createElement("span",{style:{display:"inline-block",margin:"-3px 0",position:"relative"}},e.createElement(d.ValueInput,{focus:!0,withType:!0,visible:!0,initialType:o.node.name()==="con"&&o.node.view()!==void 0?"con":"any",initialValue:g,onSubmit:p,onCancel:i}),!!i&&e.createElement(a.CancelAction,{onClick:()=>i()})))};return xn.JsonCrdtRegionEdit=s,xn}var Cu;function xe(){if(Cu)return En;Cu=1,Object.defineProperty(En,"__esModule",{value:!0}),En.JsonCrdtRegion=void 0;const e=M(),t=Ii(),d=ae(),a=ee(),n=ue(),u=yp(),r=we(),c=vp(),s=i=>!i.parent||i.node.name()!=="con"?!1:i.node.val===void 0,o=({node:i,editing:f,extension:m,toolbar:p,children:w})=>{var g;const{model:b}=(0,n.useJsonCrdt)(),{compact:l,readonly:h}=(0,a.useStyles)(),{focused:v,focus:y,pointed:_,point:C}=(0,d.useFocus)(),O=(0,r.id)(i),[k,S]=e.useState(!1),E=V=>{V.stopPropagation(),_!==O&&C(O)},x=V=>{V.preventDefault(),V.stopPropagation(),C(O)},A=()=>{C("")},N=V=>{V.preventDefault(),V.stopPropagation(),y(O)},I=v===O,R=_===O,T=(g=i.parent)===null||g===void 0?void 0:g.node.name(),q=s(i),B=T==="obj",J=T==="arr",D=T==="vec",U=I?e.createElement("span",{style:{display:"inline-block",margin:"-4px 0 0"}},e.createElement(u.TypeAndId,{node:i,active:I,negative:q,extension:m})):void 0;return k?e.createElement(c.JsonCrdtRegionEdit,{node:i,onCancel:()=>S(!1)}):e.createElement(t.FocusRegion,{pointed:R,focused:I,compact:l,negative:q,aside:U,toolbar:p,onClick:N,onMouseMove:E,onMouseEnter:x,onMouseLeave:A,onDelete:f||h||!I||q?void 0:B?()=>{b.api.wrap(i.parent.node).del([i.step])}:J?()=>{b.api.wrap(i.parent.node).del(+i.step,1)}:D?()=>{b.api.wrap(i.parent.node).set([[+i.step,void 0]])}:T==="val"&&!q?()=>{b.api.wrap(i.parent.node).set(void 0)}:void 0,onEdit:f||h?void 0:I&&(T==="obj"||T==="val"||T==="root"||T==="vec")?()=>S(!0):void 0},w)};return En.JsonCrdtRegion=o,En}var An={},Su;function ed(){if(Su)return An;Su=1,Object.defineProperty(An,"__esModule",{value:!0}),An.JsonCrdtConstant=void 0;const e=M(),t=Ke(),d=Tl(),a=ae(),n=({id:u,view:r})=>{const{focus:c}=(0,a.useFocus)(),[s,o]=e.useState(!1),i=()=>{r&&typeof r=="object"&&o(!s)};return s?e.createElement("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"}},e.createElement(d.ClickableJson,{readonly:!0,compact:!0,noCollapseToggles:!0,pfx:u,doc:r,onFocus:f=>{f!==null&&c(u)}})):e.createElement(t.JsonAtom,{value:r,onClick:i})};return An.JsonCrdtConstant=n,An}var Ou;function wp(){if(Ou)return Cn;Ou=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.JsonCrdtConNode=void 0;const e=M(),t=ve(),d=xe(),a=ee(),n=we(),u=ed(),r=({node:c})=>{const{formal:s}=(0,a.useStyles)();return e.createElement(d.JsonCrdtRegion,{node:c},e.createElement(t.JsonCrdtProperty,{node:c}),e.createElement(u.JsonCrdtConstant,{id:(0,n.id)(c),view:c.node.view()}),!!s&&",")};return Cn.JsonCrdtConNode=r,Cn}var Nn={},Rn={},Eu;function fr(){if(Eu)return Rn;Eu=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.JsonCrdtObjectLayout=void 0;const e=L,t=M(),d=Rl(),a=ee(),n=ae(),u=we(),r=c=>{var{node:s}=c,o=e.__rest(c,["node"]);const{collapsed:i}=(0,a.useStyles)(),{focused:f}=(0,n.useFocus)(),[m,p]=t.useState(i),w=()=>{!m&&(0,u.id)(s)===f&&p(!0)};return t.createElement(d.ObjectLayout,Object.assign({collapsed:m,onCollapserClick:()=>p(!m),onBracketClick:w,onCollapsedClick:()=>{m&&p(!1)}},o))};return Rn.JsonCrdtObjectLayout=r,Rn}var ui={},ku;function hr(){return ku||(ku=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useRerenderModel=e.useRerender=e.useNodeApi=void 0;const t=M(),d=ue(),a=r=>{const{model:c}=(0,d.useJsonCrdt)();return c.api.wrap(r.node)};e.useNodeApi=a;const n=r=>{const c=(0,e.useNodeApi)(r).events;return t.useSyncExternalStore(c.subscribe,c.getSnapshot)};e.useRerender=n;const u=()=>{const{model:r}=(0,d.useJsonCrdt)(),c=r.api;t.useSyncExternalStore(c.subscribe,()=>r.tick)};e.useRerenderModel=u})(ui)),ui}var xu;function _p(){if(xu)return Nn;xu=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.JsonCrdtValNode=void 0;const e=M(),t=Q(),d=lr(),a=ue(),n=xe(),u=ve(),r=fr(),c=Ke(),s=hr(),o=({node:i})=>{const{render:f}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const m=i.node.node();if(!m)return null;const p=(0,d.nodeRef)(m,i,"");if(!p)return null;const w=e.createElement("span",{className:t.line},f(p));let g="…";if(m.name()==="con"){const b=m.view();g=e.createElement(c.JsonAtom,{value:b})}return e.createElement(n.JsonCrdtRegion,{node:i},e.createElement(r.JsonCrdtObjectLayout,{node:i,property:e.createElement(u.JsonCrdtProperty,{node:i}),collapsedView:g,brackets:["(",")"]},w))};return Nn.JsonCrdtValNode=o,Nn}var In={},Tn={},Au;function Cp(){if(Au)return Tn;Au=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.AddKey=void 0;const e=M(),t=Nl(),d=ae(),a=we(),n=ue(),u=({node:r})=>{const{model:c}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),o=e.useCallback((i,f,m)=>{const p=(0,a.createValue)(c,f,m,!0);c.api.wrap(r.node).set({[i]:p})},[r.node]);return e.createElement(t.ObjectInsert,{withType:!0,visible:s,onSubmit:o})};return Tn.AddKey=u,Tn}var jn={},Pn={},Nu;function Sp(){if(Nu)return Pn;Nu=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.MiniTitle=void 0;const e=M(),t=Y(),d=(0,t.rule)({...t.theme.font.sans.bold,fz:"10px",textTransform:"uppercase",col:t.theme.g(.5),pad:0,mar:0}),a=({component:n="span",style:u,onClick:r,children:c})=>e.createElement(n,{className:d,style:u,onClick:r,children:c});return Pn.MiniTitle=a,Pn}var Ru;function Op(){if(Ru)return jn;Ru=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.Tombstones=void 0;const e=M(),t=Y(),d=Ee(),a=Sp(),n=(0,t.rule)({d:"block",bxz:"border-box",pd:"0 4px 4px 16px",bdrad:"8px",mr:"4px 0 0 -16px",w:"calc(100% + 16px)",bg:t.theme.red(.05)}),u=(0,t.rule)({d:"block",w:"100%",bxz:"border-box",pd:"4px 8px 3px 3px",cur:"default",us:"none"}),r=({tombstones:c})=>{const[s,o]=e.useState(!1),[i]=(0,d.useT)();return c.length?e.createElement("span",{className:n},e.createElement("style",{className:u,onClick:()=>o(f=>!f)},e.createElement(a.MiniTitle,{style:{fontSize:"0.65em",color:t.theme.red(.75)}},c.length+" "+(c.length===1?i("tombstone"):i("tombstones")))),s&&c):null};return jn.Tombstones=r,jn}var Iu;function Ep(){if(Iu)return In;Iu=1,Object.defineProperty(In,"__esModule",{value:!0}),In.JsonCrdtObjNode=void 0;const e=M(),t=dr(),d=Q(),a=ue(),n=lr(),u=xe(),r=ve(),c=fr(),s=hr(),o=Cp(),i=Op(),f=ee(),m=w=>w instanceof t.ConNode&&w.val===void 0,p=({node:w})=>{const{readonly:g}=(0,f.useStyles)(),{render:b}=(0,a.useJsonCrdt)();(0,s.useRerender)(w);const l=[],h=[];return w.node.nodes((v,y)=>{if(!v)return;const _=(0,n.nodeRef)(v,w,y);if(!_)return;const C=e.createElement("span",{key:y,className:d.line},b(_));m(v)?h.push(C):l.push(C)}),e.createElement(u.JsonCrdtRegion,{node:w},e.createElement(c.JsonCrdtObjectLayout,{node:w,property:e.createElement(r.JsonCrdtProperty,{node:w}),collapsedView:!!l.length&&l.length},l,!g&&e.createElement(o.AddKey,{node:w}),!!h.length&&e.createElement(i.Tombstones,{tombstones:h})))};return In.JsonCrdtObjNode=p,In}var Mn={},qn={},Tu;function kp(){if(Tu)return qn;Tu=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.PushElement=void 0;const e=M(),t=ji(),d=ae(),a=we(),n=ue(),u=({node:r})=>{const{model:c}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),o=e.useCallback((i,f)=>{const m=(0,a.createValue)(c,i,f,!0),p=c.api.wrap(r.node);p.set([[p.view().length,m]])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:s,onSubmit:o})};return qn.PushElement=u,qn}var Bn={},Vn={},ju;function td(){if(ju)return Vn;ju=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.SwitchAction=void 0;const e=M(),t=Y(),d=Q(),a=ur(),n=(0,t.drule)({w:"20px",h:"20px",bdrad:"50%",svg:{fill:d.blue}}),u=r=>e.createElement(a.Action,Object.assign({},r,{className:n()}),"~");return Vn.SwitchAction=u,Vn}var Pu;function xp(){if(Pu)return Bn;Pu=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.JsonCrdtExtNode=void 0;const e=M(),t=Ee(),d=xe(),a=ve(),n=fr(),u=hr(),r=ed(),c=we(),s=Ke(),o=td(),i=({node:f,onViewChange:m})=>{const[p]=(0,t.useT)();(0,u.useRerenderModel)();const g=f.node.view();return e.createElement(d.JsonCrdtRegion,{node:f,extension:!0,toolbar:e.createElement(o.SwitchAction,{onClick:m,tooltip:p('Show "vec" node')})},e.createElement(n.JsonCrdtObjectLayout,{node:f,property:e.createElement(a.JsonCrdtProperty,{node:f}),collapsedView:e.createElement(s.JsonAtom,{value:g}),brackets:["(",")"]},e.createElement(r.JsonCrdtConstant,{id:(0,c.id)(f),view:g})))};return Bn.JsonCrdtExtNode=i,Bn}var Mu;function Ap(){if(Mu)return Mn;Mu=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.JsonCrdtVecNode=void 0;const e=M(),t=Ee(),d=Q(),a=ue(),n=lr(),u=xe(),r=ve(),c=fr(),s=hr(),o=kp(),i=ee(),f=xp(),m=td(),p=({node:w})=>{const[g]=(0,t.useT)(),[b,l]=e.useState(!1),{readonly:h}=(0,i.useStyles)(),{render:v}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const y=w.node.isExt();if(y&&!b)return e.createElement(f.JsonCrdtExtNode,{node:w,onViewChange:()=>l(!0)});const _=[];let C=0;return w.node.children(O=>{if(!O)return;const k=(0,n.nodeRef)(O,w,String(C));k&&(_.push(e.createElement("span",{key:O.id.sid+"."+O.id.time,className:d.line},v(k))),C++)}),e.createElement(u.JsonCrdtRegion,{node:w,toolbar:y?e.createElement(m.SwitchAction,{onClick:()=>l(!1),tooltip:g('Show "ext" view')}):void 0},e.createElement(c.JsonCrdtObjectLayout,{node:w,property:e.createElement(r.JsonCrdtProperty,{node:w}),collapsedView:!!_.length&&_.length,brackets:["[","]"],header:e.createElement("span",{style:{opacity:.5,display:"inline-block",margin:"0.25em 0 0 -0.3em"}},"→")},_,!h&&e.createElement(o.PushElement,{node:w})))};return Mn.JsonCrdtVecNode=p,Mn}var Jn={},Ln={},qu;function Np(){if(qu)return Ln;qu=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.InsertElement=void 0;const e=M(),t=ji(),d=ae(),a=we(),n=ue(),u=({node:r,index:c})=>{const{model:s}=(0,n.useJsonCrdt)(),o=(0,d.useIsFocused)((0,a.id)(r)),i=e.useCallback((f,m)=>{const p=(0,a.createValue)(s,f,m);s.api.wrap(r.node).ins(c,[p])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:o,onSubmit:i})};return Ln.InsertElement=u,Ln}var Bu;function Rp(){if(Bu)return Jn;Bu=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.JsonCrdtArrNode=void 0;const e=M(),t=Q(),d=ue(),a=lr(),n=xe(),u=ve(),r=fr(),c=hr(),s=Np(),o=ee(),i=({node:f})=>{const{readonly:m}=(0,o.useStyles)(),{render:p}=(0,d.useJsonCrdt)();(0,c.useRerender)(f);const w=[];let g=0;return f.node.children(b=>{if(!b)return;const l=(0,a.nodeRef)(b,f,String(g));if(!l)return;l.step=String(g);const h=b.id.sid+"."+b.id.time+"."+g;w.push(e.createElement(e.Fragment,{key:h},!m&&e.createElement(s.InsertElement,{key:h,node:f,index:g}),e.createElement("span",{className:t.line},p(l)))),g++}),e.createElement(n.JsonCrdtRegion,{node:f},e.createElement(r.JsonCrdtObjectLayout,{node:f,property:e.createElement(u.JsonCrdtProperty,{node:f}),collapsedView:!!w.length&&w.length,brackets:["[","]"]},w,!m&&e.createElement(s.InsertElement,{key:f.node.length(),node:f,index:f.node.length()})))};return Jn.JsonCrdtArrNode=i,Jn}var Dn={},Fn={},Un={},li={},di={},Vu;function Ip(){return Vu||(Vu=1,Object.defineProperty(di,"__esModule",{value:!0})),di}var Gn={},Ju;function nd(){if(Ju)return Gn;Ju=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.Selection=void 0;let e=class{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}};return Gn.Selection=e,Gn}var Hn={},De={},Lu;function Du(){if(Lu)return De;Lu=1,Object.defineProperty(De,"__esModule",{value:!0}),De.invokeFirstOnly=De.applyChange=void 0;const e=(d,a,n,u)=>d.slice(0,a)+u+d.slice(a+n);De.applyChange=e;const t=()=>{let d=!1;return a=>{if(!d){d=!0;try{a()}finally{d=!1}}}};return De.invokeFirstOnly=t,De}var Fu;function Tp(){if(Fu)return Hn;Fu=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.StrBinding=void 0;const e=Du(),t=nd(),d=Du(),a=Br();let n=class{constructor(r,c){this.str=r,this.editor=c,this.race=(0,e.invokeFirstOnly)(),this.onModelChange=()=>{this.race(()=>{this.syncFromModel(),this.saveSelection()})},this.onchange=(s,o)=>{this.race(()=>{if(s instanceof Array&&s.length>0){const i=this.str();if(!i)return;let f=!0;if(o){let m=this.view;for(let w=0;w<length;w++){const g=s[w],[b,l,h]=g;m=(0,d.applyChange)(m,b,l,h)}const p=this.editor;p.getLength&&m.length!==p.getLength()||m!==p.get()?f=!1:this.view=m}if(f){const m=s.length;try{i.api.transaction(()=>{let p=this.view;for(let w=0;w<m;w++){const g=s[w],[b,l,h]=g;p=(0,d.applyChange)(p,b,l,h),l&&i.del(b,l),h&&i.ins(b,h)}this.view=p}),this.saveSelection();return}catch{}}}this.syncFromEditor()})},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout(()=>{this.race(()=>{try{const s=this.view,o=this.editor;(o.getLength&&s.length!==o.getLength()||s!==o.get())&&this.syncFromEditor()}catch{}this._p&&this.pollChanges()})},this.pollingInterval)},this._s=null,this.bind=s=>{this.syncFromModel();const o=this.editor;o.onchange=this.onchange,o.onselection=()=>this.saveSelection(),s&&this.pollChanges(),this._s=this.str().api.onChange.listen(this.onModelChange)},this.unbind=()=>{var s,o,i;this.stopPolling(),(s=this._s)===null||s===void 0||s.call(this),(i=(o=this.editor).dispose)===null||i===void 0||i.call(o)},this.view=r().view(),c.selection=this.selection=new t.Selection}saveSelection(){var r,c,s;const{editor:o,selection:i}=this,f=this.str();if(!f)return;const[m,p,w]=((r=o.getSelection)===null||r===void 0?void 0:r.call(o))||[-1,-1,0],{start:g,end:b}=i,l=Date.now(),h=f.api.model.tick;g===m&&b===p&&(h===i.tick||l-i.ts<3e3)||(i.start=m,i.end=p,i.dir=w,i.ts=l,i.tick=h,i.startId=typeof m=="number"&&(c=f.findId((m??0)-1))!==null&&c!==void 0?c:null,i.endId=typeof p=="number"&&(s=f.findId((p??0)-1))!==null&&s!==void 0?s:null)}syncFromModel(){const r=this.editor,c=this.str();if(!c)return;const s=(this.view=c.view())||"";if(r.ins&&r.del){const o=r.get();if(s===o)return;const i=(0,a.diff)(o,s),f=i.length;let m=0;for(let p=0;p<f;p++){const w=i[p],[g,b]=w,l=b.length;switch(g){case-1:r.del(m,l);break;case 0:m+=l;break;case 1:r.ins(m,b),m+=l;break}}}else{r.set(s);const{selection:o}=this;if(r.setSelection){const i=o.startId?c.findPos(o.startId)+1:-1,f=o.endId?c.findPos(o.endId)+1:-1;r.setSelection(i,f,o.dir)}}}syncFromEditor(){var r;let c=this.view;const s=this.editor.get();if(s===c)return;const o=this.selection,i=o.start===o.end&&(r=o.start)!==null&&r!==void 0?r:void 0,f=(0,a.diffEdit)(c,s,i||0),m=f.length,p=this.str();p&&(p.api.transaction(()=>{let w=0;for(let g=0;g<m;g++){const b=f[g],[l,h]=b;switch(l){case-1:{c=(0,d.applyChange)(c,w,h.length,""),p.del(w,h.length);break}case 0:{w+=h.length;break}case 1:{c=(0,d.applyChange)(c,w,0,h),p.ins(w,h),w+=h.length;break}}}}),this.view=c,this.saveSelection())}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}};return Hn.StrBinding=n,n.bind=(u,r,c)=>{const s=new n(u,r);return s.syncFromModel(),s.bind(c),s.unbind},Hn}var Uu;function jp(){return Uu||(Uu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Ip(),e),t.__exportStar(nd(),e),t.__exportStar(Tp(),e)})(li)),li}var zn={},Gu;function Pp(){if(Gu)return zn;Gu=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.InputEditor=void 0;let e=class{constructor(d,a){this.str=d,this.input=a,this.onInput=n=>{this.emitChange(n)},this.onSelectionChange=()=>{this.onselection()},a.addEventListener("input",this.onInput),document.addEventListener("selectionchange",this.onSelectionChange)}get(){return this.input.value}getLength(){return this.input.value.length}set(d){this.input.value=d}ins(d,a){const n=this.getSelection(),u=this.get(),r=u.slice(0,d)+a+u.slice(d);if(this.set(r),n){let[c,s]=n;const o=a.length;c>=d&&(c+=o),s>d&&(s+=o),this.setSelection(c,s,n[2])}}del(d,a){const n=this.getSelection(),u=this.get(),r=u.slice(0,d)+u.slice(d+a);if(this.set(r),n){let[c,s]=n;c>=d&&(c=Math.max(d,c-a)),s>=d&&(s=Math.max(d,s-a)),this.setSelection(c,s,n[2])}}getSelection(){const d=this.input,{selectionStart:a,selectionEnd:n,selectionDirection:u}=d;return[typeof a=="number"?a:-1,typeof n=="number"?n:-1,u==="backward"?-1:u==="forward"?1:0]}setSelection(d,a,n){const u=this.input;u.selectionStart=d>-1?d:null,u.selectionEnd=a>-1?a:null,u.selectionDirection=n===-1?"backward":n===1?"forward":"none"}emitChange(d){var a,n;if(!d.isComposing){switch(d.inputType){case"insertText":{const u=d.data;if(!u||u.length!==1)break;const{selectionStart:r,selectionEnd:c}=this.input;if(r===null||c===null||r!==c||r<=0)break;const s=this.selection;if(r-u.length!==s.start||typeof s.end!="number"||typeof s.end!="number")break;const o=s.end-s.start,i=[s.start,o,u];this.onchange([i]);return}case"deleteContentBackward":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const c=u===r?[u-1,1,""]:[u,r-u,""];this.onchange([c]);return}case"deleteContentForward":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const c=u===r?[u,1,""]:[u,r-u,""];this.onchange([c]);return}case"deleteByCut":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number"||u===r)break;const c=Math.min(u,r),s=Math.max(u,r),o=this.str().view(),f=this.input.value;if(o.length-f.length!==s-c)break;const m=[c,s-c,""];this.onchange([m]);return}case"insertFromPaste":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const c=Math.min(u,r),s=Math.max(u,r),o=this.str().view(),i=this.input,f=i.value,m=Math.max((a=i.selectionStart)!==null&&a!==void 0?a:0,(n=i.selectionEnd)!==null&&n!==void 0?n:0);if(m<=c)break;const p=s-c,w=f.slice(c,m);if(f.length!==o.length-p+w.length)return;const g=[c,p,w];this.onchange([g]);return}}this.onchange()}}dispose(){this.input.removeEventListener("input",this.onInput),document.removeEventListener("selectionchange",this.onSelectionChange)}};return zn.InputEditor=e,zn}var Hu;function Mp(){if(Hu)return Un;Hu=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.bind=void 0;const e=jp(),t=Pp(),d=(a,n,u)=>{const r=new t.InputEditor(a,n),c=new e.StrBinding(a,r);return c.syncFromModel(),c.bind(u),c.unbind};return Un.bind=d,Un}var Wn={},zu;function qp(){if(zu)return Wn;zu=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.SubmitAction=void 0;const e=M(),t=ur(),d=a=>e.createElement(t.Action,Object.assign({},a),"→");return Wn.SubmitAction=d,Wn}var Wu;function Bp(){if(Wu)return Fn;Wu=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.StrEdit=void 0;const e=M(),t=Y(),d=Mp(),a=ar(),n=Ee(),u=Q(),r=Ri(),c=Ir(),s=Tr(),o=qp(),i=ue(),f=({node:m,onCancel:p,onDone:w})=>{const[g]=(0,n.useT)(),b=e.useRef(),{model:l}=(0,i.useJsonCrdt)(),[h,v]=e.useMemo(()=>{const O=l.clone();O.api.flush();const k=O.index.get(m.node.id),S=O.api.wrap(k);return[O,S]},[]),y=e.useSyncExternalStore(v.events.subscribe,v.events.getSnapshot);e.useEffect(()=>{if(!b.current)return;const O=(0,d.bind)(()=>v,b.current);return()=>{O()}},[l]);const _=()=>{if(!!h.api.builder.patch.ops.length){const k=h.api.flush();l.applyLocalPatch(k)}w()},C=(0,c.inputStyle)(t.theme,!t.theme.isLight,'""');return C.margin="-3px -3px -3px -5px",C.padding="2px 4px",C.border=`1px solid ${t.theme.g(.85)}`,e.createElement("span",{className:u.input,style:C},e.createElement(a.FlexibleInput,{focus:!0,inp:O=>{b.current=O},value:y,multiline:!0,uncontrolled:!0,typebefore:'"',typeahead:'"',maxWidth:800,onSubmit:_,onFocus:O=>(0,r.selectOnFocus)(O.target),onCancel:()=>{p&&p()}}),e.createElement(s.CancelAction,{onClick:p,tooltip:g("Cancel")}),e.createElement("span",{className:u.bottomRightActionPos},e.createElement(o.SubmitAction,{onClick:_,tooltip:g("Done (Ctrl + Enter)")})))};return Fn.StrEdit=f,Fn}var Ku;function Vp(){if(Ku)return Dn;Ku=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.JsonCrdtStrNode=void 0;const e=M(),t=Y(),d=Ee(),a=xe(),n=ve(),u=Ke(),r=ee(),c=ae(),s=we(),o=Q(),i=Bp(),f=(0,t.rule)({d:"inline-block",pos:"relative",cur:"pointer",bdrad:"2px"}),m=(0,t.rule)({out:"1px dotted transparent","&:hover":{out:`1px dotted ${t.theme.color.sem.blue[0]}`},[`&:hover .${o.tooltip.trim()}`]:{d:"inline-block"}}),p=({node:w})=>{const[g]=(0,d.useT)(),{formal:b,readonly:l}=(0,r.useStyles)(),{focused:h}=(0,c.useFocus)(),[v,y]=e.useState(!1),_=h===(0,s.id)(w);return e.createElement(a.JsonCrdtRegion,{node:w,editing:v},e.createElement(n.JsonCrdtProperty,{node:w}),v?e.createElement(i.StrEdit,{node:w,onCancel:()=>y(!1),onDone:()=>y(!1)}):e.createElement("span",{className:f+(_&&!l?m:""),onClick:_&&!l?()=>y(!0):void 0},e.createElement(u.JsonAtom,{value:w.node.view()}),!l&&e.createElement("span",{className:o.tooltip},g("Edit"))),!!b&&",")};return Dn.JsonCrdtStrNode=p,Dn}var Kn={},Yu;function Jp(){if(Yu)return Kn;Yu=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.JsonCrdtBinNode=void 0;const e=M(),t=xe(),d=ve(),a=Ke(),n=ee(),u=({node:r})=>{const{formal:c}=(0,n.useStyles)();return e.createElement(t.JsonCrdtRegion,{node:r},e.createElement(d.JsonCrdtProperty,{node:r}),e.createElement(a.JsonAtom,{value:r.node.view()}),!!c&&",")};return Kn.JsonCrdtBinNode=u,Kn}var Xu;function Lp(){if(Xu)return At;Xu=1,Object.defineProperty(At,"__esModule",{value:!0}),At.ClickableJsonCrdt=void 0;const e=M(),t=ue(),d=ee(),a=lr(),n=Il(),u=ae(),r=dr(),c=wp(),s=_p(),o=Ep(),i=Ap(),f=Rp(),m=Vp(),p=Jp(),w=b=>b.node instanceof r.ConNode?e.createElement(c.JsonCrdtConNode,{node:b}):b.node instanceof r.ValNode?e.createElement(s.JsonCrdtValNode,{node:b}):b.node instanceof r.ObjNode?e.createElement(o.JsonCrdtObjNode,{node:b}):b.node instanceof r.StrNode?e.createElement(m.JsonCrdtStrNode,{node:b}):b.node instanceof r.VecNode?e.createElement(i.JsonCrdtVecNode,{node:b}):b.node instanceof r.ArrNode?e.createElement(f.JsonCrdtArrNode,{node:b}):b.node instanceof r.BinNode?e.createElement(p.JsonCrdtBinNode,{node:b}):"∅",g=b=>{const{model:l,compact:h,readonly:v,showRoot:y,onFocus:_}=b,[C,O]=e.useState(0);e.useEffect(()=>{const S=l.api.onReset.listen(()=>O(E=>E+1));return()=>S()},[l]);const k=e.useMemo(()=>(0,a.nodeRef)(y?l.root:l.root.node(),null,""),[l,C]);return e.createElement(d.context.Provider,{value:{compact:h,readonly:v}},e.createElement(t.context.Provider,{value:{model:l,render:w}},e.createElement(u.FocusProvider,{onFocus:_},!!k&&e.createElement(n.Root,{key:C},w(k)))))};return At.ClickableJsonCrdt=g,At}var Qu;function Dp(){return Qu||(Qu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(Tl(),e),t.__exportStar(Lp(),e)})(Yr)),Yr}var Fp=Dp();function _i({gridSessionId:e,usersReplicaId:t,chatbotName:d="Grid Assistant",initialMessage:a,open:n,onClose:u,agentRegistrationId:r}){const[c,s]=P.useState(),o=Yd(c),i={concreteType:"org.sagebionetworks.repo.model.agent.GridAgentSessionContext",gridSessionId:e,usersReplicaId:t};return j.jsx(ff,{open:n,onClose:u,title:d,children:j.jsx(Xd,{agentRegistrationId:r,chatbotName:d,initialMessage:a,sessionContext:i,textboxPositionOffset:"16px",hideTitle:!0,showAccessLevelMenu:!1,defaultAgentAccessLevel:Gd.WRITE_YOUR_PRIVATE_DATA,externalSession:c,setExternalSession:s,externalChatState:o})})}try{_i.displayName="GridAgentChat",_i.__docgenInfo={description:"",displayName:"GridAgentChat",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},usersReplicaId:{defaultValue:null,description:"",name:"usersReplicaId",required:!0,type:{name:"number"}},chatbotName:{defaultValue:{value:"Grid Assistant"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},agentRegistrationId:{defaultValue:null,description:"Optional ID to use a different agent registered in Synapse",name:"agentRegistrationId",required:!1,type:{name:"string"}}}}}catch{}function Sr(e,t){switch(e.type){case"CREATE":return t==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const d=t==="undo"?e.previousValue:e.newValue;return d?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:d}:null}case"DELETE":return t==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function Er(e=[],t){const[d,a]=P.useState(e),n=P.useCallback(o=>{a(i=>{const f=[...i,o];return t&&f.length>t&&f.shift(),f})},[t]),u=P.useCallback(()=>{if(d.length===0)return;const o=d[d.length-1];return a(i=>i.slice(0,-1)),o},[d]),r=P.useCallback(()=>d[d.length-1],[d]),c=P.useCallback(()=>{a([])},[]),s=P.useCallback(()=>d.length===0,[d]);return{stack:d,push:n,pop:u,clear:c,peek:r,size:d.length,isEmpty:s}}try{Er.displayName="useStack",Er.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}function Ci(e){return{type:"COMPOSITE",actions:e}}const Up=100,Gp=100;function Si(e){const t=Er([],Up),d=Er([],Gp),[a,n]=P.useState(null),[u,r]=P.useState(null),c=!!a,s=!!u,o=S=>{n(S.currentTarget)},i=S=>{r(S.currentTarget)},f=()=>n(null),m=()=>r(null),p=P.useCallback(()=>{if(t.isEmpty())return null;const S=t.peek();let E,x=0;if(S.type==="COMPOSITE"){E="COMPOSITE";for(let A=t.stack.length-1;A>=0&&t.stack[A].type==="COMPOSITE";A--)x++}else{E=S.type;for(let A=t.stack.length-1;A>=0&&t.stack[A].type===E;A--)x++}return{lastType:E,sameTypeCount:x,totalActions:t.size}},[t]),w=P.useCallback(()=>{if(d.isEmpty())return null;const S=d.peek();let E,x=0;if(S.type==="COMPOSITE")E="COMPOSITE",x=1;else{E=S.type;for(let A=d.stack.length-1;A>=0&&d.stack[A].type===E;A--)x++}return{lastType:E,sameTypeCount:x,totalActions:d.size}},[d]),g=p(),b=w(),l=P.useCallback(()=>{if(t.isEmpty())return;const S=t.pop();if(S)if(S.type==="COMPOSITE"){for(let E=S.actions.length-1;E>=0;E--){const x=S.actions[E],A=Sr(x,"undo");A&&e(A)}d.push(S)}else{const E=Sr(S,"undo");if(!E)return;e(E),d.push(S)}f()},[e,t,d]),h=P.useCallback(()=>{if(d.isEmpty())return;const S=d.pop();if(S)if(S.type==="COMPOSITE"){for(let E=0;E<S.actions.length;E++){const x=S.actions[E],A=Sr(x,"redo");A&&e(A)}t.push(S)}else{const E=Sr(S,"redo");if(!E)return;e(E),t.push(S)}m()},[d,t,e]);P.useEffect(()=>{const S=E=>{E.ctrlKey&&E.key==="z"&&!E.shiftKey||E.metaKey&&E.key==="z"&&!E.shiftKey?(E.preventDefault(),l()):(E.ctrlKey&&E.key==="y"||E.ctrlKey&&E.shiftKey&&E.key==="z"||E.metaKey&&E.shiftKey&&E.key==="z")&&(E.preventDefault(),h())};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[l,h]);const v=S=>{t.push(S)},y=()=>t.clear(),_=()=>d.clear(),C=(S,E,x)=>{_();const A=[];for(const N of S){const I=N.fromRowIndex,R=N.toRowIndex;if(N.type==="CREATE")for(let T=I;T<R;T++){const q=x[T];A.push({type:"CREATE",rowIndex:T,newValue:q})}if(N.type==="UPDATE"){const T=E.slice(I,R);x.slice(I,R).forEach((B,J)=>{const D=T[J],U=I+J;A.push({type:"UPDATE",rowIndex:U,previousValue:D,newValue:B})})}N.type==="DELETE"&&E.slice(I,R).forEach((q,B)=>{A.push({type:"DELETE",rowIndex:I+B,previousValue:q})})}A.length===1?v(A[0]):A.length>1&&v(Ci(A))},O=j.jsxs(j.Fragment,{children:[j.jsxs(Oe,{variant:"outlined","aria-controls":c?"undo-menu":void 0,"aria-haspopup":"true",onClick:o,disabled:!g,endIcon:j.jsx(Yi,{}),children:["Undo ",g&&`(${g.totalActions})`]}),j.jsx(zi,{id:"undo-menu",anchorEl:a,open:c,onClose:f,children:g?j.jsxs(sr,{onClick:l,children:["Undo last ",g.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(sr,{disabled:!0,children:"No actions to undo"})})]}),k=j.jsxs(j.Fragment,{children:[j.jsxs(Oe,{variant:"outlined","aria-controls":s?"redo-menu":void 0,"aria-haspopup":"true",onClick:i,disabled:!b,endIcon:j.jsx(Yi,{}),children:["Redo ",b&&`(${b.totalActions})`]}),j.jsx(zi,{id:"redo-menu",anchorEl:u,open:s,onClose:m,children:b?j.jsxs(sr,{onClick:h,children:["Redo last ",b.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(sr,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:g,handleUndo:l,addToUndoStack:v,clearUndoStack:y,addOperationsToUndoStack:C,undoUI:O,undoTotalActions:g?g.totalActions:0,redoPreview:b,redoUI:k,redoTotalActions:b?b.totalActions:0,handleRedo:h,clearRedoStack:_}}try{Ci.displayName="batchGridActions",Ci.__docgenInfo={description:"Helper to batch multiple single actions into a composite action",displayName:"batchGridActions",props:{}}}catch{}try{Si.displayName="useGridUndoRedo",Si.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}function Oi(e){const{inputValue:t,onInputValueChange:d,onConfirmInput:a=ye,onSessionChange:n=ye,onReplicaChange:u=ye}=e,{data:r}=hf({}),{mutate:c}=pf({onSuccess:(o,i)=>{oe(`Successfully deleted grid session ${i}`,"success"),n(null),u(null)},onError:o=>{oe(o.reason,"danger")}}),s=P.useMemo(()=>r?.pages.flatMap(o=>o.page||[])||[],[r]);return j.jsx(gf,{freeSolo:!0,fullWidth:!0,renderInput:o=>j.jsx(Hd,{...o,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:s,getOptionLabel:o=>typeof o=="string"?o:o.sessionId||"",value:t,onInputChange:(o,i)=>{d(i)},onChange:(o,i)=>{i&&typeof i=="object"?(d(i.sessionId||""),a(i.sessionId||"")):d(i||"")},onKeyDown:o=>{o.key==="Enter"&&a(t)},renderOption:(o,i)=>P.createElement(sr,{...o,key:i.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs($,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx($,{size:{xs:6,md:2},children:i.sessionId}),j.jsx($,{size:{xs:5,md:2},children:i.sourceEntityId}),j.jsx($,{size:{xs:0,md:6},children:i.gridJsonSchema$Id??"No schema"}),j.jsx($,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:f=>{f.stopPropagation(),c(i.sessionId)},children:"🗑️"})})]}))})}try{Oi.displayName="GridSessionSelectionField",Oi.__docgenInfo={description:"Utility form field to pick the grid session from existing sessions. Currently, for testing/demo purposes only.",displayName:"GridSessionSelectionField",props:{inputValue:{defaultValue:null,description:"",name:"inputValue",required:!0,type:{name:"string"}},onInputValueChange:{defaultValue:null,description:"",name:"onInputValueChange",required:!0,type:{name:"(value: string) => void"}},onConfirmInput:{defaultValue:null,description:"",name:"onConfirmInput",required:!1,type:{name:"(value: string) => void"}},onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}}}}}catch{}function Hp(){const{mutateAsync:e}=bf(),{synapseClient:t}=Ge();return me({mutationFn:async({createGridRequest:d,sessionId:a})=>{if(!(d||a))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(d){const n=await e(d);return console.log("Grid session started:",n),n.gridSession}return console.log(`Joining existing session ID: ${a}`),await t.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:a})}})}function zp(e){const{mutateAsync:t}=Hp(),{mutateAsync:d}=mf();return me({...e,mutationFn:async({createGridRequest:a,sessionId:n})=>{if(!(a||n))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const u=await t({createGridRequest:a,sessionId:n}),r=u.sessionId;try{const c=await d(r);console.log("Replica created:",c);const s=c.replica;return{session:u,replica:s}}catch(c){throw new Error("Error starting session:",{cause:c})}}})}const Ei=P.forwardRef((e,t)=>{const{show:d=!1,onSessionChange:a=ye,onReplicaChange:n=ye}=e,[u,r]=P.useState(""),{mutate:c}=zp({onMutate(o){console.debug("Starting grid session with args:",o)},onSuccess({session:o,replica:i}){a(o),n(i.replicaId)},onError(o){const i=o&&typeof o=="object"&&"message"in o&&typeof o.message=="string"?o.message:"An error occurred";oe(i,"danger")}}),s=function(o){c(Wp(o))};return P.useImperativeHandle(t,()=>({handleStartSession:o=>{c({createGridRequest:o})},handleLoadSession:o=>{c({sessionId:o})}}),[c]),d?j.jsxs($,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx($,{size:{xs:12},sx:{position:"relative"},children:j.jsx(Oi,{inputValue:u,onInputValueChange:r,onConfirmInput:s,onSessionChange:a,onReplicaChange:n})}),j.jsx($,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(fl,{color:"primary",variant:"contained",onClick:()=>{s(u)},children:"Start Grid Session"})})]}):null});function Wp(e){const t=rf(e);if(t.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query, Synapse ID, or session ID.");switch(t.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:t.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:t.input};case"recordSetId":return{createGridRequest:{recordSetId:t.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{Ei.displayName="StartGridSession",Ei.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function Kp(e){const t=P.useMemo(()=>e?e.api.subscribe:()=>ye,[e]),d=P.useCallback(()=>e?e.api.getSnapshot():null,[e]);return P.useSyncExternalStore(t,d)}function Yp(){const{synapseClient:e}=Ge();return me({mutationFn:async({sessionId:t,replicaId:d})=>{const{presignedUrl:a}=await e.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:t,createGridPresignedUrlRequest:{gridSessionId:t,replicaId:d}});return a}})}class pr{typeCode;constructor(t){this.typeCode=t}getJson(){throw new Error("Method should be implemented by subclass.")}}const rd=8;class sd extends pr{methodName;payload;getMethodName(){return this.methodName}getPayload(){return this.payload}constructor(t,d){super(rd),this.methodName=t,this.payload=d}getJson(){const t=[this.typeCode,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const id=0;class Xp extends pr{requestId;methodName;payload;constructor(t,d,a){super(id),this.requestId=t,this.methodName=d,this.payload=a}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}const od=4;class cd extends pr{subscriptionId;payload;getPayload(){return this.payload}constructor(t,d){super(od),this.subscriptionId=t,this.payload=d}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const ad=5;class ud extends pr{subscriptionId;payload;getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}constructor(t,d){super(ad),this.subscriptionId=t,this.payload=d}getJson(){const t=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&t.push(this.payload),t}}const ld=1;class or extends pr{requestId;methodName;payload;constructor(t,d,a){super(ld),this.requestId=t,this.methodName=d,this.payload=a}setRequestId(t){this.requestId=t}getJson(){const t=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&t.push(this.payload),t}}class Qp{static fromJson(t){if(!Array.isArray(t))throw new Error("Invalid JSON-Rx message: not an array");const d=t[0];if(typeof d!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${d}`);switch(d){case id:{const[a,n,u,r]=t;return new Xp(n,u,r)}case ld:{const[a,n,u,r]=t;return new or(n,u,r)}case od:{const[a,n,u]=t;return new cd(n,u)}case ad:{const[a,n,u]=t;return new ud(n,u)}case rd:{const[a,n,u]=t;return new sd(n,u)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${d}`)}}}const Zp=Math.pow(2,31)-1;class $p{counter;constructor(){this.counter=1}getNext(){const t=this.counter;return this.counter+=1,this.counter>Zp&&(this.counter=1),t}}var fi={},hi={},Zu;function em(){return Zu||(Zu=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var Yn={},Xn={},Fe={},$u;function Vr(){return $u||($u=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.hasBuffer=Fe.alphabet=void 0,Fe.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe.hasBuffer=typeof ce.Buffer=="function"&&typeof ce.Buffer.from=="function"),Fe}var Qn={},Zn={},el;function tm(){if(el)return Zn;el=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.flatstr=void 0;const e=t=>t;return Zn.flatstr=e,Zn}var tl;function nm(){if(tl)return Qn;tl=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.createToBase64=void 0;const e=tm(),t=Vr(),d=(a=t.alphabet,n="=")=>{if(a.length!==64)throw new Error("chars must be 64 characters long");const u=a.split(""),r=[];for(const o of u)for(const i of u){const f=(0,e.flatstr)(o+i);r.push(f)}const c=n,s=(0,e.flatstr)(n+n);return(o,i)=>{let f="";const m=i%3,p=i-m;for(let w=0;w<p;w+=3){const g=o[w],b=o[w+1],l=o[w+2],h=g<<4|b>>4,v=(b&15)<<8|l;f+=r[h]+r[v]}if(!m)return f;if(m===1){const w=o[p];f+=r[w<<4]+s}else{const w=o[p],g=o[p+1],b=w<<4|g>>4,l=(g&15)<<2;f+=r[b]+u[l]+c}return f}};return Qn.createToBase64=d,Qn}var nl;function dd(){if(nl)return Xn;nl=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.toBase64=void 0;const e=Vr(),d=(0,nm().createToBase64)();return Xn.toBase64=e.hasBuffer?a=>{const n=a.length;return n<=48?d(a,n):ce.Buffer.from(a).toString("base64")}:a=>d(a,a.length),Xn}var rl;function rm(){if(rl)return Yn;rl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.encode=void 0;const t=L.__importStar(Ye()),d=H(),a=dd(),n=(c,s)=>{const o=s.sid;return o===c?s.time:[o,s.time]},u=(c,s)=>{const o=n(c,s);return Array.isArray(o)?(o.push(s.span),o):[o,s.span]},r=c=>{const s=c.getId();if(!s)throw new Error("PATCH_EMPTY");const o=s.sid,i=s.time,f=o===1?[i]:[[o,i]],m=c.meta;m!==void 0&&f.push(m);const p=[f];for(const w of c.ops)if(w instanceof t.NewConOp){const g=w.val;g instanceof d.Timestamp?p.push([0,n(o,g),!0]):g===void 0?p.push([0]):p.push([0,g])}else if(w instanceof t.NewValOp)p.push([1]);else if(w instanceof t.NewObjOp)p.push([2]);else if(w instanceof t.NewVecOp)p.push([3]);else if(w instanceof t.NewStrOp)p.push([4]);else if(w instanceof t.NewBinOp)p.push([5]);else if(w instanceof t.NewArrOp)p.push([6]);else if(w instanceof t.InsValOp)p.push([9,n(o,w.obj),n(o,w.val)]);else if(w instanceof t.InsObjOp){const g=[];for(const[l,h]of w.data)g.push([l,n(o,h)]);const b=[10,n(o,w.obj),g];p.push(b)}else if(w instanceof t.InsVecOp){const g=[];for(const[l,h]of w.data)g.push([l,n(o,h)]);const b=[11,n(o,w.obj),g];p.push(b)}else if(w instanceof t.InsStrOp){const g=[12,n(o,w.obj),n(o,w.ref),w.data];p.push(g)}else if(w instanceof t.InsBinOp){const g=[13,n(o,w.obj),n(o,w.ref),(0,a.toBase64)(w.data)];p.push(g)}else if(w instanceof t.InsArrOp){const g=[];for(const l of w.data)g.push(n(o,l));const b=[14,n(o,w.obj),n(o,w.ref),g];p.push(b)}else if(w instanceof t.UpdArrOp){const g=[15,n(o,w.obj),n(o,w.ref),n(o,w.val)];p.push(g)}else if(w instanceof t.DelOp){const g=[16,n(o,w.obj),w.what.map(b=>u(o,b))];p.push(g)}else if(w instanceof t.NopOp){const g=[17],b=w.len;b>1&&g.push(b),p.push(g)}return p};return Yn.encode=r,Yn}var $n={},er={},tr={},sl;function sm(){if(sl)return tr;sl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.bufferToUint8Array=void 0;const e=t=>new Uint8Array(t.buffer,t.byteOffset,t.length);return tr.bufferToUint8Array=e,tr}var nr={},il;function im(){if(il)return nr;il=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.createFromBase64=void 0;const e=Vr(),t="=",d=(a=e.alphabet,n=!1)=>{if(a.length!==64)throw new Error("chars must be 64 characters long");let u=0;for(let c=0;c<a.length;c++)u=Math.max(u,a.charCodeAt(c));const r=[];for(let c=0;c<=u;c+=1)r[c]=-1;for(let c=0;c<a.length;c++)r[a.charCodeAt(c)]=c;return c=>{if(!c)return new Uint8Array(0);let s=c.length;if(n){const g=s%4;g===2?(c+="==",s+=2):g===3&&(c+="=",s+=1)}if(s%4!==0)throw new Error("Base64 string length must be a multiple of 4");const o=c[s-1]!==t?s:s-4;let i=(s>>2)*3,f=0;c[s-2]===t?(f=2,i-=2):c[s-1]===t&&(f=1,i-=1);const m=new Uint8Array(i);let p=0,w=0;for(;w<o;w+=4){const g=r[c.charCodeAt(w)],b=r[c.charCodeAt(w+1)],l=r[c.charCodeAt(w+2)],h=r[c.charCodeAt(w+3)];if(g<0||b<0||l<0||h<0)throw new Error("INVALID_BASE64_STRING");m[p]=g<<2|b>>4,m[p+1]=b<<4|l>>2,m[p+2]=l<<6|h,p+=3}if(f===2){const g=r[c.charCodeAt(o)],b=r[c.charCodeAt(o+1)];if(g<0||b<0)throw new Error("INVALID_BASE64_STRING");m[p]=g<<2|b>>4}else if(f===1){const g=r[c.charCodeAt(o)],b=r[c.charCodeAt(o+1)],l=r[c.charCodeAt(o+2)];if(g<0||b<0||l<0)throw new Error("INVALID_BASE64_STRING");m[p]=g<<2|b>>4,m[p+1]=b<<4|l>>2}return m}};return nr.createFromBase64=d,nr}var ol;function om(){if(ol)return er;ol=1,Object.defineProperty(er,"__esModule",{value:!0}),er.fromBase64=void 0;const e=sm(),t=Vr(),d=im(),a=t.hasBuffer?u=>(0,e.bufferToUint8Array)(ce.Buffer.from(u,"base64")):null,n=(0,d.createFromBase64)();return er.fromBase64=a?u=>u.length>48?a(u):n(u):n,er}var cl;function cm(){if(cl)return $n;cl=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.decode=void 0;const e=om(),t=H(),d=Mr(),a=(r,c)=>Array.isArray(c)?new t.Timestamp(c[0],c[1]):new t.Timestamp(r,c),n=(r,c)=>c.length===3?new t.Timespan(c[0],c[1],c[2]):new t.Timespan(r,c[0],c[1]),u=r=>{const c=r[0],s=c[0],o=Array.isArray(s)?new t.ClockVector(s[0],s[1]):new t.ServerClockVector(1,s),i=o.sid;o.time;const f=new d.PatchBuilder(o),m=r.length;for(let w=1;w<m;w++){const g=r[w];switch(g[0]){case 0:{const[,b,l]=g;f.con(l?a(i,b):b);break}case 1:{f.val();break}case 2:{f.obj();break}case 3:{f.vec();break}case 4:{f.str();break}case 5:{f.bin();break}case 6:{f.arr();break}case 9:{f.setVal(a(i,g[1]),a(i,g[2]));break}case 10:{const b=a(i,g[1]),l=[],h=g[2],v=h.length;for(let y=0;y<v;y++){const[_,C]=h[y];l.push([_,a(i,C)])}f.insObj(b,l);break}case 11:{const b=a(i,g[1]),l=[],h=g[2],v=h.length;for(let y=0;y<v;y++){const[_,C]=h[y];l.push([_,a(i,C)])}f.insVec(b,l);break}case 12:{f.insStr(a(i,g[1]),a(i,g[2]),g[3]);break}case 13:{f.insBin(a(i,g[1]),a(i,g[2]),(0,e.fromBase64)(g[3]));break}case 14:{const b=a(i,g[1]),l=a(i,g[2]),h=g[3],v=[],y=h.length;for(let _=0;_<y;_++)v.push(a(i,h[_]));f.insArr(b,l,v);break}case 15:{const b=a(i,g[1]),l=a(i,g[2]),h=a(i,g[3]);f.updArr(b,l,h);break}case 16:{const b=a(i,g[1]),l=g[2],h=[],v=l.length;for(let y=0;y<v;y++)h.push(n(i,l[y]));f.del(b,h);break}case 17:{f.nop(g[1]||1);break}}}const p=f.patch;return p.meta=c[1],p};return $n.decode=u,$n}var al;function am(){return al||(al=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=L;t.__exportStar(em(),e),t.__exportStar(rm(),e),t.__exportStar(cm(),e)})(fi)),fi}var kr=am();function ul(e){return new TextEncoder().encode(JSON.stringify(e)).length}function um(e){const t=kr.decode(e),d=t.getId(),a=t.span();return[[d?.sid,d.time+a]]}function lm(e,t){if(!e.ops||e.ops.length===0)return[];const d=kr.encode(e),a=ul(d);if(a<=t)return[d];if(e.ops.length==1)return console.warn(`Patch is too large (${a} B) but cannot be split further since it only contains one operation.`),[d];const n=d[0],u=[];let r=[n];for(let c=1;c<d.length;c+=1){const s=r.length-1;ul([...r,d[c]])>t&&s>0&&(u.push(r),r=[um(r)]),r.push(d[c])}return r.length>1&&u.push(r),u}var dm=dr(),rr={},ll;function fm(){if(ll)return rr;ll=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.Encoder=void 0;const t=L.__importStar(ke()),d=dd(),a=H();let n=class{encode(r){this.model=r;const c=r.clock;return{time:c.sid===1?c.time:this.cClock(r.clock),root:this.cVal(r.root)}}cClock(r){const c=[],s=r.sid;r.peers.get(s)||c.push([s,r.time]);for(const i of r.peers.values())c.push([i.sid,i.time]);return c}cTs(r){return r.sid===1?r.time:[r.sid,r.time]}cNode(r){if(r instanceof t.ObjNode)return this.cObj(r);if(r instanceof t.ArrNode)return this.cArr(r);if(r instanceof t.StrNode)return this.cStr(r);if(r instanceof t.ValNode)return this.cVal(r);if(r instanceof t.ConNode)return this.cCon(r);if(r instanceof t.BinNode)return this.cBin(r);if(r instanceof t.VecNode)return this.cVec(r);throw new Error("UNKNOWN_NODE")}cObj(r){const c={};return r.nodes((s,o)=>{c[o]=this.cNode(s)}),{type:"obj",id:this.cTs(r.id),map:c}}cVec(r){const c=[],s=r.elements,o=s.length,i=this.model.index;for(let f=0;f<o;f++){const m=s[f];m===void 0?c.push(null):c.push(this.cNode(i.get(m)))}return{type:"vec",id:this.cTs(r.id),map:c}}cArr(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cArrChunk(o));return{type:"arr",id:this.cTs(r.id),chunks:c}}cArrChunk(r){if(r.del)return{id:this.cTs(r.id),span:r.span};const c=this.model.index;return{id:this.cTs(r.id),value:r.data.map(o=>this.cNode(c.get(o)))}}cStr(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cStrChunk(o));return{type:"str",id:this.cTs(r.id),chunks:c}}cStrChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:r.data}}cBin(r){const c=[],s=r.iterator();let o;for(;o=s();)c.push(this.cBinChunk(o));return{type:"bin",id:this.cTs(r.id),chunks:c}}cBinChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:(0,d.toBase64)(r.data)}}cVal(r){return{type:"val",id:this.cTs(r.id),value:this.cNode(r.node())}}cCon(r){const c={type:"con",id:this.cTs(r.id)},s=r.val;return s instanceof a.Timestamp?(c.timestamp=!0,c.value=this.cTs(s)):s!==void 0&&(c.value=s),c}};return rr.Encoder=n,rr}var hm=fm();const pm=30*1024,mm=250;class bm{socket;model=null;messageCounter;replicaId;verboseEncoder=new hm.Encoder;maxPayloadSizeBytes;throttledSendPatch;onModelCreate=ye;onGridReady=ye;onStatusChange=ye;constructor(t){const{replicaId:d,url:a,onGridReady:n,onStatusChange:u,onModelCreate:r,maxPayloadSizeBytes:c,socket:s,model:o,patchThrottleMs:i}=t;this.messageCounter=new $p,this.replicaId=d,this.maxPayloadSizeBytes=c??pm,this.socket=s??new WebSocket(a),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=f=>{typeof f.data=="string"?this.handleMessage(f.data):console.error("Received non-string message data:",f.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=f=>{console.error("WebSocket error:",f)},r&&(this.onModelCreate=r),n&&(this.onGridReady=n),u&&(this.onStatusChange=u),this.model=o||null,this.throttledSendPatch=Of(()=>this.sendPatchImmediate(),i??mm,{leading:!1,trailing:!0})}disconnect(){this.throttledSendPatch.flush(),this.throttledSendPatch.cancel(),this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}messageHandler=t=>{if(t instanceof cd){const d=t.getPayload();try{const a=kr.decode(d);this.model?(console.debug("Applying patch from server:",a),this.model?.applyPatch(a)):(console.debug("Initializing new model from patch:"),console.debug(a.toString()),this.model=dm.Model.fromPatches([a]).fork(this.replicaId),this.onModelCreate(this.model));const n=this.model?.api.flush();let u;if(n?.ops.length!==0&&(u=kr.encode(n)),u){const r=new or(this.messageCounter.getNext(),"patch",u);console.debug("Responding with patch:",r),this.sendMessage(r)}else{const r=this.verboseEncoder.encode(this.model);this.sendSyncMessage(r.time)}}catch(a){console.error("Failed to apply patch or send clock:",a)}}else if(t instanceof ud)this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(t instanceof sd){const d=t.getMethodName();if(console.debug("Message received from server:",d),d==="ping"&&console.debug("Received ping response from server"),d==="connected"){console.debug("Server ready to receive patches");const a=this.model?this.verboseEncoder.encode(this.model):null;this.sendSyncMessage(a?.time)}if(d==="error"){console.warn("Error from server:",t.getPayload());return}if(d==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const a=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",a.time);const n=new or(this.messageCounter.getNext(),"synchronize-clock",a.time);this.sendMessage(n)}}else console.warn("Unexpected WebSocket message format:",t)};handleMessage(t){this.messageHandler(Qp.fromJson(JSON.parse(t)))}sendMessage(t){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",t),this.socket.send(JSON.stringify(t.getJson()))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){this.throttledSendPatch()}sendPatchImmediate(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const t=this.model.api.flush();t&&lm(t,this.maxPayloadSizeBytes).forEach(a=>{console.debug("Sending patch to server:",a);const n=new or(this.messageCounter.getNext(),"patch",a);this.sendMessage(n)})}sendSyncMessage(t=[]){const d=new or(this.messageCounter.getNext(),"synchronize-clock",t);this.sendMessage(d)}}function gm(e){const{mutateAsync:t}=Yp(),[d,a]=P.useState(null),n=P.useCallback(()=>{a(null)},[]);return{...me({retry:5,retryDelay:r=>Math.min(r>1?2**r*1e3:1e3,30*1e3),mutationFn:async({replicaId:r,sessionId:c,websocketOptions:s})=>{if(!r)throw new Error("replicaId is required");const o=await t({replicaId:r,sessionId:c});return a(o),new bm({replicaId:r,url:o,...s||{}})},...e}),presignedUrl:d,clearPresignedUrl:n}}function ym(e,t){switch(t.type){case"CONNECT_REQUESTED":{const d=e.connectionParams&&e.connectionParams.replicaId===t.payload.replicaId&&e.connectionParams.sessionId===t.payload.sessionId;return{...e,connectionParams:{replicaId:t.payload.replicaId,sessionId:t.payload.sessionId},hasCompletedInitialSync:d?e.hasCompletedInitialSync:!1,model:d?e.model:null,isConnected:!1,isConnecting:!1,connectionAttemptId:t.payload.attemptId,connectionError:null}}case"CONNECTION_ESTABLISHED":return{...e,websocketInstance:t.payload,isConnecting:!0};case"CONNECTION_OPENED":return{...e,isConnected:!0,isConnecting:!1};case"CONNECTION_CLOSED":return{...e,isConnected:!1,isConnecting:!1};case"GRID_READY":return{...e,hasCompletedInitialSync:!0};case"MODEL_CREATED":return{...e,model:t.payload};case"CONNECTION_ERROR":return{...e,connectionError:t.payload,isConnecting:!1};default:return e}}const vm={model:null,hasCompletedInitialSync:!1,isConnected:!1,isConnecting:!1,connectionParams:null,websocketInstance:null,connectionAttemptId:null,connectionError:null};function wm(){const[e,t]=P.useReducer(ym,vm),d=P.useRef(0),a=P.useRef(null),n=Kp(e.model),u=Nf(),{mutateAsync:r,isPending:c,error:s,presignedUrl:o,reset:i,clearPresignedUrl:f}=gm(),m=P.useCallback(l=>{t({type:"MODEL_CREATED",payload:l})},[t]),p=P.useMemo(()=>({onGridReady:()=>t({type:"GRID_READY"}),onStatusChange:l=>t({type:l?"CONNECTION_OPENED":"CONNECTION_CLOSED"}),onModelCreate:m}),[m]),w=P.useCallback((l,h)=>{i(),(!e.connectionParams||e.connectionParams.replicaId!==l||e.connectionParams.sessionId!==h)&&f(),d.current+=1;const y=d.current;t({type:"CONNECT_REQUESTED",payload:{replicaId:l,sessionId:h,attemptId:y}})},[t,e.connectionParams,i,f,d]);P.useEffect(()=>{const{connectionParams:l,connectionAttemptId:h}=e;!l||h===null||e.isConnected||e.isConnecting||c||s||e.connectionError||!u||(a.current=h,r({replicaId:l.replicaId,sessionId:l.sessionId,websocketOptions:{...p,model:e.model}}).then(v=>{if(a.current!==h){v.disconnect();return}t({type:"CONNECTION_ESTABLISHED",payload:v})}).catch(v=>{t({type:"CONNECTION_ERROR",payload:v}),console.error("Failed to establish WebSocket",v)}))},[e,e.connectionParams,e.connectionAttemptId,e.isConnected,e.isConnecting,c,s,u,r,p]);const g=P.useRef(null);P.useEffect(()=>{const l=g.current,h=e.connectionParams;l&&h&&(l.replicaId!==h.replicaId||l.sessionId!==h.sessionId)&&e.websocketInstance?.disconnect(),g.current=h},[e.connectionParams,e.websocketInstance]),P.useEffect(()=>()=>{e.websocketInstance?.disconnect(),a.current=null},[e.websocketInstance]);function b(l){if(!l||!l.api.getSnapshot()||!n)return!1;const{columnNames:h,columnOrder:v,rows:y}=n,_=h.length>=1,C=v.length>=1,O=y.length>=0;return _&&C&&O}return{isConnected:e.isConnected,websocketInstance:e.websocketInstance,hasCompletedInitialSync:e.hasCompletedInitialSync,model:e.model,modelSnapshot:n,connect:w,presignedUrl:o,errorEstablishingWebsocketConnection:e.connectionError??s,hasSufficientData:b(e.model)}}var Ue=qr();function _m(e,t,d){let a;return Object.hasOwn(e,t)?a=e[t]:d[t]?.isRequired?a=null:a=void 0,a}function Cm(e,t,d){const a=e.api.arr(["rows"]),{columnNames:n}=e.api.getSnapshot();switch(t.type){case"CREATE":{const u=n.map(r=>Ue.s.con(_m(t.rowData,r,d)));a?.ins(t.rowIndex,[Ue.s.obj({data:Ue.s.vec(...u),metadata:Ue.s.obj({})})]);break}case"DELETE":a?.del(t.rowIndex,t.count??1);break;case"UPDATE":{Object.entries(t.updatedData).forEach(([u,r])=>{if(u.startsWith("_"))return;const c=n.indexOf(u);c!==-1&&e.api.vec(["rows",String(t.rowIndex),"data"])?.set([[c,Ue.s.con(r)]])});break}case"SET_SELECTION":{e.api.obj().has("selection")||e.api.obj().add(["selection"],Ue.s.obj({})),e.api.obj(["selection"]).set({[t.replicaId]:Ue.s.con(t.selection)});break}}}function Sm(e,t){const d=[];return e.forEach(a=>{if(a.type==="CREATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"CREATE",rowIndex:n,rowData:t[n]});if(a.type==="UPDATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"UPDATE",rowIndex:n,updatedData:t[n]});a.type==="DELETE"&&d.push({type:"DELETE",rowIndex:a.fromRowIndex,count:a.toRowIndex-a.fromRowIndex})}),d}const ki=({selectedRowIndex:e,rowValues:t})=>{if(e===null)return null;const d=t[e];if(!d)return null;const a=d.__validationResults?.allValidationMessages;return!Array.isArray(a)||a.length===0?null:j.jsx(zd,{variant:"warning",title:"Validation Messages For Selected Row:",isGlobal:!1,description:j.jsx("ul",{children:a.map(n=>j.jsx("li",{children:n},n))}),sx:{marginTop:"12px"}})};try{ki.displayName="ValidationAlert",ki.__docgenInfo={description:"",displayName:"ValidationAlert",props:{selectedRowIndex:{defaultValue:null,description:"",name:"selectedRowIndex",required:!0,type:{name:"number"}},rowValues:{defaultValue:null,description:"",name:"rowValues",required:!0,type:{name:"DataGridRow[]"}}}}}catch{}const dl=P.forwardRef(({agentRegistrationId:e,showDebugInfo:t=!1},d)=>{const[a,n]=P.useState(null),[u,r]=P.useState(null),[c,s]=P.useState(!1),[o,i]=P.useState(null),f=P.useRef(null),m=P.useRef(null),{data:p,isLoading:w}=cf();P.useImperativeHandle(d,()=>({initializeGrid:G=>{f.current&&f.current.handleStartSession(G)},loadExistingSession:G=>{f.current&&f.current.handleLoadSession(G)}}),[]);const{isConnected:g,websocketInstance:b,hasCompletedInitialSync:l,model:h,modelSnapshot:v,connect:y,presignedUrl:_,hasSufficientData:C}=wm(),O=P.useRef(null);P.useEffect(()=>{O.current=b},[b]);const k=P.useRef(null);P.useEffect(()=>{if(u==null||!a?.sessionId){k.current=null;return}const G={replicaId:u,sessionId:a.sessionId},z=k.current;z&&z.replicaId===G.replicaId&&z.sessionId===G.sessionId||(k.current=G,y(u,a.sessionId))},[u,a?.sessionId,y]),P.useEffect(()=>{h===null&&(i(null),m.current&&m.current.setActiveCell(null))},[h]);const S=lh(a),{data:E}=Ar(a?.sourceEntityId,void 0,{enabled:!!a?.sourceEntityId}),x=E?.concreteType==="org.sagebionetworks.repo.model.table.EntityView",A=P.useMemo(()=>Ah(S??null),[S]),N=g?"Connected":"Disconnected",I=P.useMemo(()=>v?Ch(h,v):[],[h,v]),R=P.useCallback(()=>{!g||!O.current||O.current.sendPatch()},[g,O]);P.useEffect(()=>{g&&R()},[g,R]);const T=P.useCallback((G,z)=>{z.forEach(W=>{Cm(G,W,A)}),R()},[R,A]),q=P.useCallback(G=>{if(!h){console.error("Model is not initialized");return}G.type==="DELETE"&&m.current&&m.current.setActiveCell(null),T(h,[G])},[h,T]),{undoUI:B,redoUI:J,addOperationsToUndoStack:D,clearRedoStack:U}=Si(q),V=P.useCallback((G,z)=>{if(!h){console.error("Model is not initialized");return}if(z=sf(G,I,z),z.length>0){U(),D(z,I,G);const W=Sm(z,G);T(h,W)}},[h,I,U,D,T]),re=P.useCallback(G=>{const{selection:z}=G;if(z!=null&&(i(z),h!=null&&u!=null)){const W=yh(z,h);T(h,[{type:"SET_SELECTION",replicaId:u.toString(),selection:W}])}},[T,h,u]),ie=P.useRef(null),[,be]=P.useState({}),_e=P.useCallback((G,z)=>{ie.current=G,be({})},[]);return!w&&!p?.isCertified?j.jsx(yf,{}):j.jsx("div",{children:j.jsxs($,{container:!0,spacing:2,children:[j.jsx($,{size:{xs:12,xl:8},children:j.jsx(Ei,{ref:f,onSessionChange:n,onReplicaChange:r,show:t})}),j.jsx($,{size:{xs:12,xl:4},children:t&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",a?.sessionId||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",u||"No replica created"]}),j.jsxs("p",{children:["Source Entity ID:"," ",a?.sourceEntityId||"No source entity"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",a?.gridJsonSchema$Id||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",_?_.substring(0,30)+(_.length>30?" ... "+_.substring(_.length-10):""):"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:g?"green":"red"},children:N})]})]})}),a&&j.jsxs(j.Fragment,{children:[!C&&j.jsxs($,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!a&&j.jsx("p",{children:"Creating grid session..."}),a&&!u&&j.jsx("p",{children:"Setting up real-time sync..."}),a&&u&&!_&&j.jsx("p",{children:"Establishing secure connection..."}),a&&u&&_&&!g&&j.jsx("p",{children:"Connecting to server..."}),g&&!l&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Kd,{numRows:4,numCols:1})]})]}),C&&j.jsxs(j.Fragment,{children:[j.jsx($,{size:12,children:j.jsxs(Wd,{direction:"row",spacing:1,sx:{justifyContent:"flex-end"},children:[B,J,j.jsx(Oe,{variant:"outlined",onClick:()=>s(!0),startIcon:j.jsx(Qd,{}),children:"Open chat"}),j.jsx(_i,{agentRegistrationId:e,open:c,onClose:()=>s(!1),gridSessionId:a.sessionId,usersReplicaId:u,chatbotName:"Grid Assistant"}),a.sourceEntityId&&j.jsx(bi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId}),a.sessionId&&j.jsx(gi,{gridSessionId:a.sessionId,filename:"grid-"+(a.sourceEntityId||"export")}),a.sourceEntityId&&j.jsx(yi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId})]})}),j.jsx($,{size:12,children:j.jsx(of,{gridRef:m,rowValues:I,columnNames:v?.columnNames??[],columnOrder:v?.columnOrder??[],schemaPropertiesInfo:A,entityIsView:x,jsonSchema:S,lastSelection:o,handleChange:V,handleSelectionChange:re,onSelectedRowChange:_e})}),j.jsx($,{size:12,children:j.jsx(ki,{selectedRowIndex:ie.current,rowValues:I})})]}),t&&j.jsxs($,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model"}),h?j.jsx(Fp.ClickableJsonCrdt,{model:h}):"No model available"]})]})]})})});try{dl.displayName="SynapseGrid",dl.__docgenInfo={description:"",displayName:"SynapseGrid",props:{agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}export{Oi as G,dl as S};
