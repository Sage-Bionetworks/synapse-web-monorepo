import{r as s,d6 as F,hJ as u,j as t,$ as M,am as w,cJ as L,dI as R,hH as E,B as C,Y as A,hK as N,d8 as U,K as O}from"./iframe-Es1qDbGP.js";import{d as P}from"./useUserBundle-B6mxhG5s.js";import{a as V,u as k}from"./useForum-BRwmb2FX.js";import{u as z}from"./useSubscription-Dx4AOCo4.js";import{C as B}from"./ConfirmationDialog-Dm9z241S.js";import{I as q}from"./InfiniteTableLayout-B_UH-shh.js";import{u as H,g as Y,S as G,c as X}from"./StyledTanStackTable-CB5g-5QE.js";import{C as l}from"./ColumnHeader-PGeGXJyl.js";import{U as J,c as K}from"./UserBadge-CRnAPqN0.js";import{F as W}from"./ForumThreadEditor-CWx7JzqW.js";import{S as $}from"./SubscribersModal-Bs6SAbrh.js";const d=X();function Q(a){return[d.accessor("title",{header:e=>t.jsx(l,{...e,title:"Topic"}),cell:({row:e})=>t.jsxs(M,{onClick:()=>a(e.original.id),children:[e.original.isPinned?t.jsx(w,{icon:"pushpin"}):t.jsx(t.Fragment,{}),e.original.title]}),enableSorting:!0,size:250}),d.accessor("createdBy",{header:e=>t.jsx(l,{...e,title:"Author"}),cell:({getValue:e})=>t.jsx(J,{userId:e()}),enableSorting:!1,size:60}),d.accessor("activeAuthors",{header:e=>t.jsx(l,{...e,title:"Active Users"}),cell:({getValue:e})=>e().map(i=>t.jsx("div",{className:"avatarContainer",children:t.jsx(K,{showCardOnHover:!0,className:"ActiveUsers",size:L,avatarSize:"MEDIUM",ownerId:i})},i)),enableSorting:!1}),d.accessor("numberOfReplies",{header:e=>t.jsx(l,{...e,title:"Replies"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("numberOfViews",{header:e=>t.jsx(l,{...e,title:"Views"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("lastActivity",{header:e=>t.jsx(l,{...e,title:"Activity"}),cell:({getValue:e})=>R(e()).format("L"),enableSorting:!0,size:30})]}function g({forumId:a,limit:e,filter:i,onClickLink:m}){const[r,S]=s.useState([{desc:!0,id:"lastActivity"}]),c=s.useMemo(()=>{if(!F(r)){if(r[0].id=="lastActivity")return u.PINNED_AND_LAST_ACTIVITY;if(r[0].id=="numberOfReplies")return u.NUMBER_OF_REPLIES;if(r[0].id=="title")return u.THREAD_TITLE;if(r[0].id=="numberOfViews")return u.NUMBER_OF_VIEWS}return u.PINNED_AND_LAST_ACTIVITY},[r]),{data:o,isLoading:p,hasNextPage:T,fetchNextPage:b,isFetchingNextPage:h}=V(a,e,c,!r[0]?.desc,i),_=s.useMemo(()=>o?.pages.flatMap(n=>n.results)??[],[o]),x=s.useMemo(()=>Q(m),[m]),f=H({data:_,columns:x,state:{sorting:r},onSortingChange:S,getRowId:n=>n.id,getCoreRowModel:Y(),columnResizeMode:"onChange",manualSorting:!0,enableMultiSort:!1,enableFilters:!1}),y=!p&&f.getRowModel().rows.length===0;return t.jsx("div",{className:"ForumTable",children:t.jsx(q,{table:t.jsx(G,{table:f,styledTableContainerProps:{sx:{my:2,maxHeight:"250px"}}}),isLoading:p,isEmpty:y,hasNextPage:T,onFetchNextPageClicked:()=>{b()},isFetchingNextPage:h})})}try{g.displayName="ForumTable",g.__docgenInfo={description:"",displayName:"ForumTable",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"enum",value:[{value:'"NO_FILTER"'},{value:'"DELETED_ONLY"'},{value:'"EXCLUDE_DELETED"'}]}}}}}catch{}const Z="You will need to sign in for access to that resource";function j({forumId:a,limit:e,onClickLink:i}){const[m,r]=s.useState(!1),[S,c]=s.useState(!1),[o,p]=s.useState(!1),[T,b]=s.useState(!1),{subscription:h,isLoading:_,toggleSubscribed:x}=z(a,E.FORUM);function f(){try{x()}catch(D){O(D.reason,"danger")}}const{data:y}=k(a),{data:n}=P(),I=y?.includes(n?.ownerId??""),v=()=>{n?.userName=="anonymous"?c(!0):r(!0)};return t.jsxs("div",{className:"ForumTable",children:[t.jsxs("div",{className:"ForumTable__top-level-control",children:[t.jsx($,{id:a,objectType:E.FORUM,showModal:T,handleModal:b}),t.jsx(C,{variant:h?"outlined":"contained",color:"primary",onClick:()=>f(),disabled:_,children:h?"Unfollow":"Follow"}),t.jsx(C,{variant:"contained",color:"primary",onClick:()=>v(),children:"New Thread"}),I&&t.jsx(C,{variant:"contained",color:"primary",onClick:()=>p(!o),children:o?"Hide Deleted Threads":"Show Deleted Threads"})]}),o&&t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"h4",children:"Deleted Threads"}),t.jsx(g,{onClickLink:i,forumId:a,limit:e,filter:N.DELETED_ONLY})]}),t.jsx(g,{onClickLink:i,forumId:a,limit:e,filter:N.EXCLUDE_DELETED}),t.jsx(W,{isReply:!1,id:a,onClose:()=>r(!1),isDialog:!0,openDialog:m}),t.jsx(B,{open:S,title:"Sign In Required",content:Z,onCancel:()=>c(!1),hasCancelButton:!1,onConfirm:()=>c(!1),confirmButtonProps:{children:"Sign In",className:U}})]})}try{j.displayName="ForumPage",j.__docgenInfo={description:"",displayName:"ForumPage",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}}}}}catch{}export{j as F};
