var z=t=>{throw TypeError(t)};var S=(t,e,s)=>e.has(t)||z("Cannot "+s);var a=(t,e,s)=>(S(t,e,"read from private field"),s?s.call(t):e.get(t)),v=(t,e,s)=>e.has(t)?z("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),b=(t,e,s,r)=>(S(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(S(t,e,"access private method"),s);import{r as H}from"./index-Dl6G-zuu.js";import{aB as K,aC as B,aD as N,aE as J,r as _,aF as j,aG as T,aH as V,aI as X,aJ as Y,aK as D,aL as F,aM as Z,aN as $}from"./SynapseClient-BHsOBGLR.js";function U(t,e){return t.filter(s=>!e.includes(s))}function W(t,e,s){const r=t.slice(0);return r[e]=s,r}var R,E,C,f,M,w,c,x,L,P,k,A,G,ee=(G=class extends K{constructor(e,s,r){super();v(this,c);v(this,R);v(this,E);v(this,C);v(this,f);v(this,M);v(this,w);b(this,R,e),b(this,C,[]),b(this,f,[]),p(this,c,x).call(this,[]),this.setQueries(s,r)}onSubscribe(){this.listeners.size===1&&a(this,f).forEach(e=>{e.subscribe(s=>{p(this,c,k).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,f).forEach(e=>{e.destroy()})}setQueries(e,s,r){b(this,C,e),b(this,M,s),B.batch(()=>{const n=a(this,f),i=p(this,c,P).call(this,a(this,C));i.forEach(h=>h.observer.setOptions(h.defaultedQueryOptions,r));const u=i.map(h=>h.observer),d=u.map(h=>h.getCurrentResult()),Q=u.some((h,g)=>h!==n[g]);n.length===u.length&&!Q||(b(this,f,u),p(this,c,x).call(this,d),this.hasListeners()&&(U(n,u).forEach(h=>{h.destroy()}),U(u,n).forEach(h=>{h.subscribe(g=>{p(this,c,k).call(this,h,g)})}),p(this,c,A).call(this)))})}getCurrentResult(){return a(this,w)}getQueries(){return a(this,f).map(e=>e.getCurrentQuery())}getObservers(){return a(this,f)}getOptimisticResult(e,s){const r=p(this,c,P).call(this,e),n=r.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[n,i=>p(this,c,L).call(this,i??n,s),()=>r.map((i,u)=>{const d=n[u];return i.defaultedQueryOptions.notifyOnChangeProps?d:i.observer.trackResult(d)})]}},R=new WeakMap,E=new WeakMap,C=new WeakMap,f=new WeakMap,M=new WeakMap,w=new WeakMap,c=new WeakSet,x=function(e){var s;b(this,E,e),b(this,w,p(this,c,L).call(this,e,(s=a(this,M))==null?void 0:s.combine))},L=function(e,s){return s?N(a(this,w),s(e)):e},P=function(e){const s=a(this,f),r=new Map(s.map(o=>[o.options.queryHash,o])),n=e.map(o=>a(this,R).defaultQueryOptions(o)),i=n.flatMap(o=>{const O=r.get(o.queryHash);return O!=null?[{defaultedQueryOptions:o,observer:O}]:[]}),u=new Set(i.map(o=>o.defaultedQueryOptions.queryHash)),d=n.filter(o=>!u.has(o.queryHash)),Q=o=>{const O=a(this,R).defaultQueryOptions(o);return a(this,f).find(l=>l.options.queryHash===O.queryHash)??new J(a(this,R),O)},h=d.map(o=>({defaultedQueryOptions:o,observer:Q(o)})),g=(o,O)=>n.indexOf(o.defaultedQueryOptions)-n.indexOf(O.defaultedQueryOptions);return i.concat(h).sort(g)},k=function(e,s){const r=a(this,f).indexOf(e);r!==-1&&(p(this,c,x).call(this,W(a(this,E),r,s)),p(this,c,A).call(this))},A=function(){B.batch(()=>{this.listeners.forEach(e=>{e(a(this,E))})})},G);function ne({queries:t,...e},s){const r=_(),n=j(),i=T(),u=H.useMemo(()=>t.map(l=>{const m=r.defaultQueryOptions(l);return m._optimisticResults=n?"isRestoring":"optimistic",m}),[t,r,n]);u.forEach(l=>{V(l),X(l,i)}),Y(i);const[d]=H.useState(()=>new ee(r,u,e)),[Q,h,g]=d.getOptimisticResult(u,e.combine);H.useSyncExternalStore(H.useCallback(l=>n?()=>{}:d.subscribe(B.batchCalls(l)),[d,n]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),H.useEffect(()=>{d.setQueries(u,e,{listeners:!1})},[u,e,d]);const O=Q.some((l,m)=>D(u[m],l))?Q.flatMap((l,m)=>{const y=u[m];if(y){const I=new J(r,y);if(D(y,l))return F(y,I,i);Z(l,n)&&F(y,I,i)}return[]}):[];if(O.length>0)throw Promise.all(O);const q=Q.find((l,m)=>{const y=u[m];return y&&$({result:l,errorResetBoundary:i,throwOnError:y.throwOnError,query:r.getQueryCache().get(y.queryHash)})});if(q!=null&&q.error)throw q.error;return h(g())}export{ne as u};
