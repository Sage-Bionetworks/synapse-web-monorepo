import{a3 as H,cd as f,cc as R,r,c9 as C,ce as P}from"./iframe-CmoSAPSB.js";import{u as T}from"./UserBadge-zo9ivwKg.js";function y(s,c){let i;(o=>{o[o.A_FIRST=-1]="A_FIRST",o[o.B_FIRST=1]="B_FIRST"})(i||(i={}));const a=s.resourceAccess.accessType.includes(H.CHANGE_PERMISSIONS),t=c.resourceAccess.accessType.includes(H.CHANGE_PERMISSIONS);return a&&!t?-1:!a&&t?1:s.resourceAccess.principalId===f&&c.resourceAccess.principalId!==f?-1:s.resourceAccess.principalId!==f&&c.resourceAccess.principalId===f?1:s.resourceAccess.principalId===R&&c.resourceAccess.principalId!==R?-1:s.resourceAccess.principalId!==R&&c.resourceAccess.principalId===R?1:s.userGroupHeader.userName.localeCompare(c.userGroupHeader.userName)}function D(s){const c=r.useMemo(()=>s.map(n=>n.principalId),[s]),{data:i,isLoading:a,error:t}=T(c.map(String),{enabled:c.length>0});return r.useEffect(()=>{t&&console.error("Error fetching user group headers: ",t)},[t]),{sortedResourceAccessList:r.useMemo(()=>{if(!i)return null;const n=s.map(e=>({resourceAccess:e,userGroupHeader:i.find(A=>String(A.ownerId)===String(e.principalId))}));return n.every(e=>!!e.userGroupHeader)?n.toSorted(y).map(e=>e.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",n.filter(e=>!e.userGroupHeader)),null)},[s,i]),isLoading:a}}const N="User or team already has permissions.",U=[];function w(s={}){const{initialResourceAccessList:c=U,onChange:i=C,onError:a=C}=s,[t,o]=r.useState(!1),{setIsEditing:n}=P();r.useEffect(()=>(n(t),()=>{n(!1)}),[t,n]);const[l,e]=r.useState(c),[A,G]=r.useState(!1),{sortedResourceAccessList:S,isLoading:m}=D(l);r.useEffect(()=>{!t&&!m&&!A&&S!=null&&(e(S),G(!0))},[A,t,m,S]),r.useEffect(()=>{i(l)},[l]);const g=r.useCallback((u,p)=>{o(!0),u&&e(d=>{if(d.some(E=>E.principalId===u))a(N);else{const E={principalId:u,accessType:p};return[...d,E]}return d})},[a]),_=r.useCallback((u,p)=>{o(!0),e(d=>d.map(I=>I.principalId===u?{...I,accessType:p}:I))},[]),L=r.useCallback(u=>{o(!0),e(p=>p.filter(d=>d.principalId!==u))},[]),h=r.useCallback(()=>{o(!1)},[]);return{resourceAccessList:l,setResourceAccessList:e,addResourceAccessItem:g,updateResourceAccessItem:_,removeResourceAccessItem:L,resetDirtyState:h}}export{w as u};
