import{j as f,dG as Qe,e0 as pe,r as d,cM as Xn,dA as He,c7 as yn,c0 as Bn,c4 as $n,eN as Yn}from"./iframe-CKbLOTsP.js";import{D as Gn}from"./DateTimePicker-SaX0Tjj_.js";import{d as Ft}from"./index-Chi_LkuB.js";import{A as vn}from"./Autocomplete-t_FNPX90.js";import{C as Jn}from"./Chip-CxgxE7T3.js";import{c as xn}from"./index-DbESNxNd.js";import{u as Zn}from"./index-DMKoe34_.js";function wt({rowData:e,setRowData:n,disabled:t,colType:o}){return f.jsx(Gn,{disabled:t,value:e?Qe(e):null,onChange:r=>{r==null?n(null):n(o==="number"?Qe(r).valueOf():Qe(r).toISOString())},sx:{pointerEvents:t?"none":void 0,width:"100%",height:"100%","& .MuiInputBase-root":{height:"100%",backgroundColor:"inherit"}}})}function yt({colType:e}){return{component:(n=>f.jsx(wt,{...n,colType:e})),copyValue:({rowData:n})=>n,pasteValue:({value:n})=>n,disableKeys:!0,keepFocus:!0}}try{wt.displayName="DateTimeCell",wt.__docgenInfo={description:"",displayName:"DateTimeCell",props:{rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"any"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean"}},focus:{defaultValue:null,description:"",name:"focus",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},columnData:{defaultValue:null,description:"",name:"columnData",required:!0,type:{name:"any"}},setRowData:{defaultValue:null,description:"",name:"setRowData",required:!0,type:{name:"(rowData: any) => void"}},stopEditing:{defaultValue:null,description:"",name:"stopEditing",required:!0,type:{name:"(opts?: { nextRow?: boolean; }) => void"}},insertRowBelow:{defaultValue:null,description:"",name:"insertRowBelow",required:!0,type:{name:"() => void"}},duplicateRow:{defaultValue:null,description:"",name:"duplicateRow",required:!0,type:{name:"() => void"}},deleteRow:{defaultValue:null,description:"",name:"deleteRow",required:!0,type:{name:"() => void"}},getContextMenuItems:{defaultValue:null,description:"",name:"getContextMenuItems",required:!0,type:{name:"() => ContextMenuItem[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}try{yt.displayName="dateTimeColumn",yt.__docgenInfo={description:"",displayName:"dateTimeColumn",props:{colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}const Qn=(e,n)=>{const t=n.map(({basis:r,minWidth:l,maxWidth:s})=>({basis:r,minWidth:l,maxWidth:s,size:r,violation:0,frozen:!1,factor:0}));let o=t.reduce((r,l)=>r-l.size,e);o>0?n.forEach(({grow:r},l)=>{t[l].factor=r}):o<0&&n.forEach(({shrink:r},l)=>{t[l].factor=r});for(const r of t)r.factor===0&&(r.frozen=!0);for(;t.some(({frozen:r})=>!r);){const r=t.reduce((s,i)=>s+(i.frozen?0:i.factor),0);let l=0;for(const s of t)s.frozen||(s.size+=o*s.factor/r,s.size<s.minWidth?s.violation=s.minWidth-s.size:s.maxWidth!==void 0&&s.size>s.maxWidth?s.violation=s.maxWidth-s.size:s.violation=0,s.size+=s.violation,l+=s.violation);if(l>0)for(const s of t)s.violation>0&&(s.frozen=!0);else if(l<0)for(const s of t)s.violation<0&&(s.frozen=!0);else break;o=t.reduce((s,i)=>s-i.size,e)}return t.map(({size:r})=>r)},er=(e,n)=>{const t=e.map(({basis:o,minWidth:r,maxWidth:l,grow:s,shrink:i})=>[o,r,l,s,i].join(",")).join("|");return d.useMemo(()=>{if(n===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const o=Qn(n,e);let r=0;const l=o.map((s,i)=>(r+=s,i===o.length-1?1/0:r));return{fullWidth:Math.abs(n-r)<.1,columnWidths:o,columnRights:l,totalWidth:r}},[n,t])};var Te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ft.global<"u"?Ft.global:typeof self<"u"?self:{};function Ke(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var et,Tt;function Et(){if(Tt)return et;Tt=1;function e(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}return et=e,et}var tt,Wt;function tr(){if(Wt)return tt;Wt=1;var e=typeof Te=="object"&&Te&&Te.Object===Object&&Te;return tt=e,tt}var nt,Lt;function bn(){if(Lt)return nt;Lt=1;var e=tr(),n=typeof self=="object"&&self&&self.Object===Object&&self,t=e||n||Function("return this")();return nt=t,nt}var rt,qt;function nr(){if(qt)return rt;qt=1;var e=bn(),n=function(){return e.Date.now()};return rt=n,rt}var ot,Pt;function rr(){if(Pt)return ot;Pt=1;var e=/\s/;function n(t){for(var o=t.length;o--&&e.test(t.charAt(o)););return o}return ot=n,ot}var lt,Ut;function or(){if(Ut)return lt;Ut=1;var e=rr(),n=/^\s+/;function t(o){return o&&o.slice(0,e(o)+1).replace(n,"")}return lt=t,lt}var st,Ht;function Cn(){if(Ht)return st;Ht=1;var e=bn(),n=e.Symbol;return st=n,st}var it,Kt;function lr(){if(Kt)return it;Kt=1;var e=Cn(),n=Object.prototype,t=n.hasOwnProperty,o=n.toString,r=e?e.toStringTag:void 0;function l(s){var i=t.call(s,r),c=s[r];try{s[r]=void 0;var h=!0}catch{}var g=o.call(s);return h&&(i?s[r]=c:delete s[r]),g}return it=l,it}var at,Xt;function sr(){if(Xt)return at;Xt=1;var e=Object.prototype,n=e.toString;function t(o){return n.call(o)}return at=t,at}var ut,Bt;function ir(){if(Bt)return ut;Bt=1;var e=Cn(),n=lr(),t=sr(),o="[object Null]",r="[object Undefined]",l=e?e.toStringTag:void 0;function s(i){return i==null?i===void 0?r:o:l&&l in Object(i)?n(i):t(i)}return ut=s,ut}var ct,$t;function ar(){if($t)return ct;$t=1;function e(n){return n!=null&&typeof n=="object"}return ct=e,ct}var dt,Yt;function ur(){if(Yt)return dt;Yt=1;var e=ir(),n=ar(),t="[object Symbol]";function o(r){return typeof r=="symbol"||n(r)&&e(r)==t}return dt=o,dt}var ht,Gt;function cr(){if(Gt)return ht;Gt=1;var e=or(),n=Et(),t=ur(),o=NaN,r=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,s=/^0o[0-7]+$/i,i=parseInt;function c(h){if(typeof h=="number")return h;if(t(h))return o;if(n(h)){var g=typeof h.valueOf=="function"?h.valueOf():h;h=n(g)?g+"":g}if(typeof h!="string")return h===0?h:+h;h=e(h);var b=l.test(h);return b||s.test(h)?i(h.slice(2),b?2:8):r.test(h)?o:+h}return ht=c,ht}var mt,Jt;function Rn(){if(Jt)return mt;Jt=1;var e=Et(),n=nr(),t=cr(),o="Expected a function",r=Math.max,l=Math.min;function s(i,c,h){var g,b,p,I,R,O,N=0,z=!1,V=!1,C=!0;if(typeof i!="function")throw new TypeError(o);c=t(c)||0,e(h)&&(z=!!h.leading,V="maxWait"in h,p=V?r(t(h.maxWait)||0,c):p,C="trailing"in h?!!h.trailing:C);function E(P){var y=g,k=b;return g=b=void 0,N=P,I=i.apply(k,y),I}function L(P){return N=P,R=setTimeout(B,c),z?E(P):I}function j(P){var y=P-O,k=P-N,ae=c-y;return V?l(ae,p-k):ae}function X(P){var y=P-O,k=P-N;return O===void 0||y>=c||y<0||V&&k>=p}function B(){var P=n();if(X(P))return q(P);R=setTimeout(B,j(P))}function q(P){return R=void 0,C&&g?E(P):(g=b=void 0,I)}function T(){R!==void 0&&clearTimeout(R),N=0,g=O=b=R=void 0}function Q(){return R===void 0?I:q(n())}function H(){var P=n(),y=X(P);if(g=arguments,b=this,O=P,y){if(R===void 0)return L(O);if(V)return clearTimeout(R),R=setTimeout(B,c),E(O)}return R===void 0&&(R=setTimeout(B,c)),I}return H.cancel=T,H.flush=Q,H}return mt=s,mt}var dr=Rn();const hr=Ke(dr);var pt,Zt;function mr(){if(Zt)return pt;Zt=1;var e=Rn(),n=Et(),t="Expected a function";function o(r,l,s){var i=!0,c=!0;if(typeof r!="function")throw new TypeError(t);return n(s)&&(i="leading"in s?!!s.leading:i,c="trailing"in s?!!s.trailing:c),e(r,l,{leading:i,maxWait:l,trailing:c})}return pt=o,pt}var pr=mr();const fr=Ke(pr),gr=(e,n,t,o)=>{switch(n){case"debounce":return hr(e,t,o);case"throttle":return fr(e,t,o);default:return e}};function wr({skipOnMount:e=!1,refreshMode:n,refreshRate:t=1e3,refreshOptions:o,handleWidth:r=!0,handleHeight:l=!0,targetRef:s,observerOptions:i,onResize:c}={}){const h=d.useRef(e),[g,b]=d.useState({width:void 0,height:void 0}),[p,I]=d.useState(s?.current||null);s&&setTimeout(()=>{s.current!==p&&I(s.current)},0);const R=d.useMemo(()=>new Proxy(V=>{V!==p&&I(V)},{get(V,C){return C==="current"?p:V[C]},set(V,C,E){return C==="current"?I(E):V[C]=E,!0}}),[p]),O=d.useCallback((V,C)=>!(V.width===C.width&&V.height===C.height||V.width===C.width&&!l||V.height===C.height&&!r),[r,l]),N=d.useCallback(V=>{if(!(!r&&!l)){if(h.current){h.current=!1;return}V.forEach(C=>{const{width:E,height:L}=C?.contentRect||{};b(j=>O(j,{width:E,height:L})?{width:E,height:L}:j)})}},[r,l,h,O]),z=d.useCallback(gr(N,n,t,o),[N,n,t,o]);return d.useEffect(()=>{let V;return p?(V=new window.ResizeObserver(z),V.observe(p,i)):(g.width||g.height)&&b({width:void 0,height:void 0}),()=>{var C,E,L;(C=V?.disconnect)===null||C===void 0||C.call(V),(L=(E=z).cancel)===null||L===void 0||L.call(E)}},[z,p]),d.useEffect(()=>{c?.(g.width,g.height)},[g]),Object.assign({ref:R},g)}const yr=()=>f.jsx(f.Fragment,{}),vr=()=>!1,Qt=({rowData:e})=>e,xr=()=>null,br=({rowIndex:e})=>f.jsx(f.Fragment,{children:e+1}),ft=()=>!0,Cr=e=>e,Rr=e=>{if(typeof e=="number")return{basis:0,grow:e,shrink:1};if(e.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(e.trim()),shrink:1};if(e.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(e.trim()),grow:1,shrink:1};if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[n,t]=e.trim().split(" ");return{basis:0,grow:parseFloat(n),shrink:parseFloat(t)}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[n,t]=e.trim().split(" ");return{basis:parseFloat(t),grow:parseFloat(n),shrink:1}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[n,t,o]=e.trim().split(" ");return{basis:parseFloat(o),grow:parseFloat(n),shrink:parseFloat(t)}}return{basis:0,grow:1,shrink:1}},Sr=(e,n,t)=>d.useMemo(()=>{const o=[n===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>f.jsx(f.Fragment,{}),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:ft}:{...n,basis:n?.basis??40,grow:n?.grow??0,shrink:n?.shrink??0,minWidth:n?.minWidth??0,title:n?.title??f.jsx("div",{className:"dsg-corner-indicator"}),component:n?.component??br,isCellEmpty:ft},...e];return t&&o.push({...t,basis:t?.basis??40,grow:t?.grow??0,shrink:t?.shrink??0,minWidth:t.minWidth??0,isCellEmpty:ft}),o.map(r=>{const l=r.width!==void 0?Rr(r.width):{basis:void 0,grow:void 0,shrink:void 0};return{...r,basis:r.basis??l.basis??0,grow:r.grow??l.grow??1,shrink:r.shrink??l.shrink??1,minWidth:r.minWidth??100,component:r.component??yr,disableKeys:r.disableKeys??!1,disabled:r.disabled??!1,keepFocus:r.keepFocus??!1,deleteValue:r.deleteValue??Qt,copyValue:r.copyValue??xr,pasteValue:r.pasteValue??Qt,prePasteValues:r.prePasteValues??Cr,isCellEmpty:r.isCellEmpty??vr}})},[n,t,e]);function Pe(e,n,t,o){var r,l=!1,s=0;function i(){r&&clearTimeout(r)}function c(){i(),l=!0}typeof n!="boolean"&&(o=t,t=n,n=void 0);function h(){for(var g=arguments.length,b=new Array(g),p=0;p<g;p++)b[p]=arguments[p];var I=this,R=Date.now()-s;if(l)return;function O(){s=Date.now(),t.apply(I,b)}function N(){r=void 0}o&&!r&&O(),i(),o===void 0&&R>e?O():n!==!0&&(r=setTimeout(o?N:O,o===void 0?e-R:e))}return h.cancel=c,h}function Ir(e,n,t){return t===void 0?Pe(e,n,!1):Pe(e,t,n!==!1)}var en,tn;function Er(){return tn||(tn=1,en=function e(n,t){if(n===t)return!0;if(n&&t&&typeof n=="object"&&typeof t=="object"){if(n.constructor!==t.constructor)return!1;var o,r,l;if(Array.isArray(n)){if(o=n.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!e(n[r],t[r]))return!1;return!0}if(n.constructor===RegExp)return n.source===t.source&&n.flags===t.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===t.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===t.toString();if(l=Object.keys(n),o=l.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[r]))return!1;for(r=o;r--!==0;){var s=l[r];if(!e(n[s],t[s]))return!1}return!0}return n!==n&&t!==t}),en}var Mr=Er();const Sn=Ke(Mr),qe=e=>{const[n,t]=d.useState(e),o=d.useCallback(r=>{t(l=>{const s=typeof r=="function"?r(l):r;return Sn(s,l)?l:s})},[t]);return[n,o]},Dr=(e,n,t)=>{const[o,r]=qe({top:!0,right:!0,bottom:!0,left:!0});return d.useEffect(()=>{const l=Pe(100,()=>{r({top:e.current?.scrollTop===0,right:(e.current?.scrollLeft??0)>=(e.current?.scrollWidth??0)-(n??0)-1,bottom:(e.current?.scrollTop??0)>=(e.current?.scrollHeight??0)-(t??0)-1,left:e.current?.scrollLeft===0})}),s=e.current;return s?.addEventListener("scroll",l),setTimeout(l,100),()=>{s?.removeEventListener("scroll",l),l.cancel()}},[t,n,e,r]),o},he=(e,n)=>{d.useEffect(()=>(document.addEventListener(e,n),()=>{document.removeEventListener(e,n)}),[n,e])},nn=(e,n=200)=>{const t=d.useRef(null),o=d.useMemo(()=>Pe(n,!0,()=>{setTimeout(()=>t.current=e.current?.getBoundingClientRect()||null,0)}),[e,n]);return d.useCallback((r=!1)=>(r?t.current=e.current?.getBoundingClientRect()||null:o(),t.current),[e,o])},In=(e={})=>(({addRows:n})=>{const[t,o]=d.useState(1),[r,l]=d.useState(String(t));return f.jsxs("div",{className:"dsg-add-row",children:[f.jsx("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>n(t),children:e.button??"Add"})," ",f.jsx("input",{className:"dsg-add-row-input",value:r,onBlur:()=>l(String(t)),type:"number",min:1,onChange:s=>{l(s.target.value),o(Math.max(1,Math.round(parseInt(s.target.value)||0)))},onKeyDown:s=>{s.key==="Enter"&&n(t)}})," ",e.unit??"rows"]})}),En=In();En.displayName="AddRows";const Nr=(e,n)=>{const[t,o]=d.useState(e),r=d.useRef();d.useEffect(()=>()=>r.current?.cancel(),[]);const l=d.useMemo(()=>r.current=Ir(n,s=>{o(s)}),[n]);return[t,l]},Mn=e=>e.type==="CUT"?f.jsx(f.Fragment,{children:"Cut"}):e.type==="COPY"?f.jsx(f.Fragment,{children:"Copy"}):e.type==="PASTE"?f.jsx(f.Fragment,{children:"Paste"}):e.type==="DELETE_ROW"?f.jsx(f.Fragment,{children:"Delete row"}):e.type==="DELETE_ROWS"?f.jsxs(f.Fragment,{children:["Delete rows ",f.jsx("b",{children:e.fromRow})," to ",f.jsx("b",{children:e.toRow})]}):e.type==="INSERT_ROW_BELLOW"?f.jsx(f.Fragment,{children:"Insert row below"}):e.type==="DUPLICATE_ROW"?f.jsx(f.Fragment,{children:"Duplicate row"}):e.type==="DUPLICATE_ROWS"?f.jsxs(f.Fragment,{children:["Duplicate rows ",f.jsx("b",{children:e.fromRow})," to ",f.jsx("b",{children:e.toRow})]}):e.type,Mt=(e=Mn)=>(({clientX:n,clientY:t,items:o,close:r})=>{const l=d.useRef(null),s=d.useCallback(i=>{l.current?.contains(i.target)||r()},[r]);return he("mousedown",s),f.jsx("div",{className:"dsg-context-menu",style:{left:n+"px",top:t+"px"},ref:l,children:o.map(i=>f.jsx("div",{onClick:i.action,className:"dsg-context-menu-item",children:e(i)},i.type))})}),Dn=Mt(Mn);Dn.displayName="ContextMenu";const Or=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},Vr=e=>Or.parseFromString(e,"text/html"),gt=e=>{const n=Vr(e.replace(/<br\/?>/g,`
`)),t=n.getElementsByTagName("table")[0];if(t){const r=[];for(let l=0;l<t.rows.length;l++){const s=[];r.push(s);for(let i=0;i<t.rows[l].cells.length;i++)s.push(t.rows[l].cells[i].textContent??"")}return r}const o=n.getElementsByTagName("span")[0];return o?[[o.textContent??""]]:[[""]]},We=e=>{const n=e.replace(/\r|\n$/g,""),t=[[]];let o=0,r=0,l=!1,s=0;const i=()=>{let c=n.slice(r,o);c[0]==='"'&&c[c.length-1]==='"'&&(l=!0),l&&c[c.length-1]==='"'&&c.includes(`
`)&&(c=c.slice(1,c.length-1).replace(/""/g,'"'),l=!1),l&&c[c.length-1]!=='"'?c.split(`
`).forEach((h,g,{length:b})=>{t[s].push(h),g<b-1&&(t.push([]),s++)}):t[s].push(c)};for(;o<n.length;)l&&n[o]==='"'&&![void 0,"	",'"'].includes(n[o+1])&&(l=!1),l&&n[o]==='"'&&n[o+1]==='"'&&o++,o===r&&n[o]==='"'&&(l=!0),n[o]==="	"&&(i(),r=o+1,l=!1),n[o]===`
`&&!l&&(i(),t.push([]),r=o+1,s++),o++;return i(),t},_r=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),kr=e=>e.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null,vt=(e,n,t,o)=>{if(e===null||!n||!t)return null;if(typeof e!="object")throw new Error("Value must be an object or null");const r=o.findIndex(s=>s.id===e.col),l={col:Math.max(0,Math.min(n-1,r===-1?Number(e.col):r-1)),row:Math.max(0,Math.min(t-1,Number(e.row)))};if(isNaN(l.col)||isNaN(l.row))throw new Error("col or cell are not valid positive numbers");return l},De=(e,n)=>e?{col:e.col,row:e.row,colId:n[e.col+1]?.id}:null,Ar=(e,n,t,o)=>{if(e===null||!n||!t)return null;if(typeof e!="object")throw new Error("Value must be an object or null");const r={min:vt(e.min,n,t,o),max:vt(e.max,n,t,o)};if(!r.min||!r.max)throw new Error("min and max must be defined");return r},rn=(e,n)=>e?{min:De(e.min,n),max:De(e.max,n)}:null,on=()=>Array.from(document.querySelectorAll("*")).filter(e=>e instanceof HTMLElement&&typeof e.tabIndex=="number"&&e.tabIndex>=0&&!e.disabled&&(!(e instanceof HTMLAnchorElement)||!!e.href||e.getAttribute("tabIndex")!==null)&&getComputedStyle(e).visibility!=="collapse");function Ee(e,n,t){let o=t.initialDeps??[],r,l=!0;function s(){var i,c,h;let g;t.key&&(i=t.debug)!=null&&i.call(t)&&(g=Date.now());const b=e();if(!(b.length!==o.length||b.some((I,R)=>o[R]!==I)))return r;o=b;let p;if(t.key&&(c=t.debug)!=null&&c.call(t)&&(p=Date.now()),r=n(...b),t.key&&(h=t.debug)!=null&&h.call(t)){const I=Math.round((Date.now()-g)*100)/100,R=Math.round((Date.now()-p)*100)/100,O=R/16,N=(z,V)=>{for(z=String(z);z.length<V;)z=" "+z;return z};console.info(`%câ± ${N(R,5)} /${N(I,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*O,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(l&&t.skipInitialOnChange)&&t.onChange(r),l=!1,r}return s.updateDeps=i=>{o=i},s}function ln(e,n){if(e===void 0)throw new Error("Unexpected undefined");return e}const jr=(e,n)=>Math.abs(e-n)<1.01,zr=(e,n,t)=>{let o;return function(...r){e.clearTimeout(o),o=e.setTimeout(()=>n.apply(this,r),t)}},sn=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},Fr=e=>e,Nn=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),o=[];for(let r=n;r<=t;r++)o.push(r);return o},Tr=(e,n)=>{const t=e.scrollElement;if(!t)return;const o=e.targetWindow;if(!o)return;const r=s=>{const{width:i,height:c}=s;n({width:Math.round(i),height:Math.round(c)})};if(r(sn(t)),!o.ResizeObserver)return()=>{};const l=new o.ResizeObserver(s=>{const i=()=>{const c=s[0];if(c?.borderBoxSize){const h=c.borderBoxSize[0];if(h){r({width:h.inlineSize,height:h.blockSize});return}}r(sn(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return l.observe(t,{box:"border-box"}),()=>{l.unobserve(t)}},an={passive:!0},un=typeof window>"u"?!0:"onscrollend"in window,Wr=(e,n)=>{const t=e.scrollElement;if(!t)return;const o=e.targetWindow;if(!o)return;let r=0;const l=e.options.useScrollendEvent&&un?()=>{}:zr(o,()=>{n(r,!1)},e.options.isScrollingResetDelay),s=g=>()=>{const{horizontal:b,isRtl:p}=e.options;r=b?t.scrollLeft*(p&&-1||1):t.scrollTop,l(),n(r,g)},i=s(!0),c=s(!1);t.addEventListener("scroll",i,an);const h=e.options.useScrollendEvent&&un;return h&&t.addEventListener("scrollend",c,an),()=>{t.removeEventListener("scroll",i),h&&t.removeEventListener("scrollend",c)}},Lr=(e,n,t)=>{if(n?.borderBoxSize){const o=n.borderBoxSize[0];if(o)return Math.round(o[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},qr=(e,{adjustments:n=0,behavior:t},o)=>{var r,l;const s=e+n;(l=(r=o.scrollElement)==null?void 0:r.scrollTo)==null||l.call(r,{[o.options.horizontal?"left":"top"]:s,behavior:t})};class Pr{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const o=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(r=>{r.forEach(l=>{const s=()=>{this._measureElement(l.target,l)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(s):s()})}));return{disconnect:()=>{var r;(r=o())==null||r.disconnect(),t=null},observe:r=>{var l;return(l=o())==null?void 0:l.observe(r,{box:"border-box"})},unobserve:r=>{var l;return(l=o())==null?void 0:l.unobserve(r)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([o,r])=>{typeof r>"u"&&delete t[o]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Fr,rangeExtractor:Nn,onChange:()=>{},measureElement:Lr,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var o,r;(r=(o=this.options).onChange)==null||r.call(o,this,t)},this.maybeNotify=Ee(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const o=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==o){if(this.cleanup(),!o){this.maybeNotify();return}this.scrollElement=o,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(r=>{this.observer.observe(r)}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(r,l)=>{this.scrollAdjustments=0,this.scrollDirection=l?this.getScrollOffset()<r?"forward":"backward":null,this.scrollOffset=r,this.isScrolling=l,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,o)=>{const r=new Map,l=new Map;for(let s=o-1;s>=0;s--){const i=t[s];if(r.has(i.lane))continue;const c=l.get(i.lane);if(c==null||i.end>c.end?l.set(i.lane,i):i.end<c.end&&r.set(i.lane,!0),r.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((s,i)=>s.end===i.end?s.index-i.index:s.end-i.end)[0]:void 0},this.getMeasurementOptions=Ee(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,o,r,l,s,i)=>(this.prevLanes!==void 0&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:o,scrollMargin:r,getItemKey:l,enabled:s,lanes:i}),{key:!1}),this.getMeasurements=Ee(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:o,scrollMargin:r,getItemKey:l,enabled:s,lanes:i},c)=>{if(!s)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const p of this.laneAssignments.keys())p>=t&&this.laneAssignments.delete(p);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(p=>{this.itemSizeCache.set(p.key,p.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const g=this.measurementsCache.slice(0,h),b=new Array(i).fill(void 0);for(let p=0;p<h;p++){const I=g[p];I&&(b[I.lane]=p)}for(let p=h;p<t;p++){const I=l(p),R=this.laneAssignments.get(p);let O,N;if(R!==void 0&&this.options.lanes>1){O=R;const E=b[O],L=E!==void 0?g[E]:void 0;N=L?L.end+this.options.gap:o+r}else{const E=this.options.lanes===1?g[p-1]:this.getFurthestMeasurement(g,p);N=E?E.end+this.options.gap:o+r,O=E?E.lane:p%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(p,O)}const z=c.get(I),V=typeof z=="number"?z:this.options.estimateSize(p),C=N+V;g[p]={index:p,start:N,size:V,end:C,key:I,lane:O},b[O]=p}return this.measurementsCache=g,g},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ee(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,o,r,l)=>this.range=t.length>0&&o>0?Ur({measurements:t,outerSize:o,scrollOffset:r,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ee(()=>{let t=null,o=null;const r=this.calculateRange();return r&&(t=r.startIndex,o=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,o]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,o]},(t,o,r,l,s)=>l===null||s===null?[]:t({startIndex:l,endIndex:s,overscan:o,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const o=this.options.indexAttribute,r=t.getAttribute(o);return r?parseInt(r,10):(console.warn(`Missing attribute name '${o}={index}' on measured element.`),-1)},this._measureElement=(t,o)=>{const r=this.indexFromElement(t),l=this.measurementsCache[r];if(!l)return;const s=l.key,i=this.elementsCache.get(s);i!==t&&(i&&this.observer.unobserve(i),this.observer.observe(t),this.elementsCache.set(s,t)),t.isConnected&&this.resizeItem(r,this.options.measureElement(t,o,this))},this.resizeItem=(t,o)=>{const r=this.measurementsCache[t];if(!r)return;const l=this.itemSizeCache.get(r.key)??r.size,s=o-l;s!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(r,s,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=s,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,o)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((o,r)=>{o.isConnected||(this.observer.unobserve(o),this.elementsCache.delete(r))});return}this._measureElement(t,void 0)},this.getVirtualItems=Ee(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,o)=>{const r=[];for(let l=0,s=t.length;l<s;l++){const i=t[l],c=o[i];r.push(c)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const o=this.getMeasurements();if(o.length!==0)return ln(o[On(0,o.length-1,r=>ln(o[r]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,o,r=0)=>{if(!this.scrollElement)return 0;const l=this.getSize(),s=this.getScrollOffset();o==="auto"&&(o=t>=s+l?"end":"start"),o==="center"?t+=(r-l)/2:o==="end"&&(t-=l);const i=this.getMaxScrollOffset();return Math.max(Math.min(i,t),0)},this.getOffsetForIndex=(t,o="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const r=this.measurementsCache[t];if(!r)return;const l=this.getSize(),s=this.getScrollOffset();if(o==="auto")if(r.end>=s+l-this.options.scrollPaddingEnd)o="end";else if(r.start<=s+this.options.scrollPaddingStart)o="start";else return[s,o];if(o==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),o];const i=o==="end"?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,o,r.size),o]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:o="start",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,o),{adjustments:void 0,behavior:r})},this.scrollToIndex=(t,{align:o="auto",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let l=0;const s=10,i=h=>{if(!this.targetWindow)return;const g=this.getOffsetForIndex(t,h);if(!g){console.warn("Failed to get offset for index:",t);return}const[b,p]=g;this._scrollToOffset(b,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const I=()=>{if(this.currentScrollToIndex!==t)return;const R=this.getScrollOffset(),O=this.getOffsetForIndex(t,p);if(!O){console.warn("Failed to get offset for index:",t);return}jr(O[0],R)||c(p)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(I):I()})},c=h=>{this.targetWindow&&this.currentScrollToIndex===t&&(l++,l<s?this.targetWindow.requestAnimationFrame(()=>i(h)):console.warn(`Failed to scroll to index ${t} after ${s} attempts.`))};i(o)},this.scrollBy=(t,{behavior:o}={})=>{o==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:o})},this.getTotalSize=()=>{var t;const o=this.getMeasurements();let r;if(o.length===0)r=this.options.paddingStart;else if(this.options.lanes===1)r=((t=o[o.length-1])==null?void 0:t.end)??0;else{const l=Array(this.options.lanes).fill(null);let s=o.length-1;for(;s>=0&&l.some(i=>i===null);){const i=o[s];l[i.lane]===null&&(l[i.lane]=i.end),s--}r=Math.max(...l.filter(i=>i!==null))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:o,behavior:r})=>{this.options.scrollToFn(t,{behavior:r,adjustments:o},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(n)}}const On=(e,n,t,o)=>{for(;e<=n;){const r=(e+n)/2|0,l=t(r);if(l<o)e=r+1;else if(l>o)n=r-1;else return r}return e>0?e-1:0};function Ur({measurements:e,outerSize:n,scrollOffset:t,lanes:o}){const r=e.length-1,l=c=>e[c].start;if(e.length<=o)return{startIndex:0,endIndex:r};let s=On(0,r,l,t),i=s;if(o===1)for(;i<r&&e[i].end<t+n;)i++;else if(o>1){const c=Array(o).fill(0);for(;i<r&&c.some(g=>g<t+n);){const g=e[i];c[g.lane]=g.end,i++}const h=Array(o).fill(t+n);for(;s>=0&&h.some(g=>g>=t);){const g=e[s];h[g.lane]=g.start,s--}s=Math.max(0,s-s%o),i=Math.min(r,i+(o-1-i%o))}return{startIndex:s,endIndex:i}}const cn=typeof document<"u"?d.useLayoutEffect:d.useEffect;function Hr({useFlushSync:e=!0,...n}){const t=d.useReducer(()=>({}),{})[1],o={...n,onChange:(l,s)=>{var i;e&&s?Xn.flushSync(t):t(),(i=n.onChange)==null||i.call(n,l,s)}},[r]=d.useState(()=>new Pr(o));return r.setOptions(o),cn(()=>r._didMount(),[]),cn(()=>r._willUpdate()),r}function dn(e){return Hr({observeElementRect:Tr,observeElementOffset:Wr,scrollToFn:qr,...e})}var hn={exports:{}},mn;function Kr(){return mn||(mn=1,(function(e){(function(){var n={}.hasOwnProperty;function t(){for(var l="",s=0;s<arguments.length;s++){var i=arguments[s];i&&(l=r(l,o(i)))}return l}function o(l){if(typeof l=="string"||typeof l=="number")return l;if(typeof l!="object")return"";if(Array.isArray(l))return t.apply(null,l);if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]"))return l.toString();var s="";for(var i in l)n.call(l,i)&&l[i]&&(s=r(s,i));return s}function r(l,s){return s?l?l+" "+s:l+s:l}e.exports?(t.default=t,e.exports=t):window.classNames=t})()})(hn)),hn.exports}var Xr=Kr();const Z=Ke(Xr),pn=({children:e,gutter:n,stickyRight:t,active:o,disabled:r,className:l,width:s,left:i})=>f.jsx("div",{className:Z("dsg-cell",n&&"dsg-cell-gutter",r&&"dsg-cell-disabled",n&&o&&"dsg-cell-gutter-active",t&&"dsg-cell-sticky-right",l),style:{width:s,left:t?void 0:i},children:e}),Le=(e,n)=>d.useMemo(()=>{const t=new Map;return o=>(t.has(o)||t.set(o,(...r)=>{e(o,...r.slice(0,n))}),t.get(o))},[n,e]),Br=({data:e,columns:n,outerRef:t,innerRef:o,columnWidths:r,hasStickyRightColumn:l,displayHeight:s,headerRowHeight:i,rowHeight:c,rowKey:h,fullWidth:g,selection:b,activeCell:p,rowClassName:I,cellClassName:R,children:O,editing:N,getContextMenuItems:z,setRowData:V,deleteRows:C,duplicateRows:E,insertRowAfter:L,stopEditing:j,onScroll:X})=>{const B=dn({count:e.length,getScrollElement:()=>t.current,paddingStart:i,estimateSize:D=>c(D).height,getItemKey:D=>{if(h&&D>0){const $=e[D-1];if(typeof h=="function")return h({rowData:$,rowIndex:D});if(typeof h=="string"&&$ instanceof Object&&h in $){const K=$[h];if(typeof K=="string"||typeof K=="number")return K}}return D},overscan:5}),q=dn({count:n.length,getScrollElement:()=>t.current,estimateSize:D=>r?.[D]??100,horizontal:!0,getItemKey:D=>n[D].id??D,overscan:1,rangeExtractor:D=>{const $=Nn(D);return $[0]!==0&&$.unshift(0),l&&$[$.length-1]!==n.length-1&&$.push(n.length-1),$}});d.useEffect(()=>{q.measure()},[q,r]);const T=Le(V,1),Q=Le(C,0),H=Le(E,0),P=Le(L,0),y=b?.min.col??p?.col,k=b?.max.col??p?.col,ae=b?.min.row??p?.row,te=b?.max.row??p?.row;return f.jsx("div",{ref:t,className:"dsg-container",onScroll:X,style:{height:s},children:f.jsxs("div",{ref:o,style:{width:g?"100%":q.getTotalSize(),height:B.getTotalSize()},children:[i>0&&f.jsx("div",{className:Z("dsg-row","dsg-row-header"),style:{width:g?"100%":q.getTotalSize(),height:i},children:q.getVirtualItems().map(D=>f.jsx(pn,{gutter:D.index===0,stickyRight:l&&D.index===n.length-1,width:D.size,left:D.start,className:Z("dsg-cell-header",y!==void 0&&k!==void 0&&y<=D.index-1&&k>=D.index-1&&"dsg-cell-header-active",n[D.index].headerClassName),children:f.jsx("div",{className:"dsg-cell-header-container",children:n[D.index].title})},D.key))}),B.getVirtualItems().map(D=>{const $=D.index>=(ae??1/0)&&D.index<=(te??-1/0);return f.jsx("div",{className:Z("dsg-row",typeof I=="string"?I:null,typeof I=="function"?I({rowData:e[D.index],rowIndex:D.index}):null),style:{height:D.size,top:D.start,width:g?"100%":q.getTotalSize()},children:q.getVirtualItems().map(K=>{const Ne=n[K.index].cellClassName,ie=n[K.index].disabled,Xe=n[K.index].component,Oe=ie===!0||typeof ie=="function"&&ie({rowData:e[D.index],rowIndex:D.index}),Ve=p?.row===D.index&&p.col===K.index-1;return f.jsx(pn,{gutter:K.index===0,stickyRight:l&&K.index===n.length-1,active:K.index===0&&$,disabled:Oe,className:Z(typeof Ne=="function"?Ne({rowData:e[D.index],rowIndex:D.index,columnId:n[K.index].id}):Ne,typeof R=="function"?R({rowData:e[D.index],rowIndex:D.index,columnId:n[K.index].id}):R),width:K.size,left:K.start,children:f.jsx(Xe,{rowData:e[D.index],getContextMenuItems:z,disabled:Oe,active:Ve,columnIndex:K.index-1,rowIndex:D.index,focus:Ve&&N,deleteRow:Q(D.index),duplicateRow:H(D.index),stopEditing:j,insertRowBelow:P(D.index),setRowData:T(D.index),columnData:n[K.index].columnData})},K.key)})},D.key)}),O]})})},fn=(e,n,t,o)=>[[o,e],[n,e],[n,t],[o,t],[o,e]],$r=(e,n,t,o)=>`polygon(evenodd, ${[...fn(0,"100%","100%",0),...fn(e,n,t,o)].map(r=>r.map(l=>typeof l=="number"&&l!==0?l+"px":l).join(" ")).join(",")})`,Vn=pe.memo(({columnWidths:e,columnRights:n,headerRowHeight:t,selection:o,rowHeight:r,activeCell:l,hasStickyRightColumn:s,dataLength:i,viewWidth:c,viewHeight:h,contentWidth:g,edges:b,isCellDisabled:p,editing:I,expandSelection:R})=>{const O=l?p(l):!1,N=d.useMemo(()=>{if(!o)return O;for(let q=o.min.col;q<=o.max.col;++q)for(let T=o.min.row;T<=o.max.row;++T)if(!p({col:q,row:T}))return!1;return!0},[O,p,o]);if(!e||!n)return null;const z=q=>q<i-1?1:0,V=q=>q<e.length-(s?3:2)?1:0,C=l&&{width:e[l.col+1]+V(l.col),height:r(l.row).height+z(l.row),left:n[l.col],top:r(l.row).top+t},E=o&&{width:e.slice(o.min.col+1,o.max.col+2).reduce((q,T)=>q+T)+V(o.max.col),height:r(o.max.row).top+r(o.max.row).height-r(o.min.row).top+z(o.max.row),left:n[o.min.col],top:r(o.min.row).top+t},L=o?.min||l,j=o?.max||l,X=j&&R!==null&&{left:n[j.col]+e[j.col+1],top:r(j.row).top+r(j.row).height+t,transform:`translate(-${j.col<e.length-(s?3:2)?50:100}%, -${j.row<i-1?50:100}%)`},B=L&&j&&R!==null&&{width:e.slice(L.col+1,j.col+2).reduce((q,T)=>q+T)+V(j.col),height:r(j.row+R).top+r(j.row+R).height-r(j.row+1).top+z(j.row+R)-1,left:n[L.col],top:r(j.row).top+r(j.row).height+t+1};return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"dsg-scrollable-view-container",style:{height:r(i-1).top+r(i-1).height+t,width:g||"100%"},children:f.jsx("div",{className:Z({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!b.top,"dsg-scrollable-view-r":!b.right,"dsg-scrollable-view-b":!b.bottom,"dsg-scrollable-view-l":!b.left}),style:{top:t,left:e[0],height:h?h-t:0,width:g&&c?c-e[0]-(s?e[e.length-1]:0):`calc(100% - ${e[0]+(s?e[e.length-1]:0)}px)`}})}),(E||C)&&f.jsx("div",{className:"dsg-selection-col-marker-container",style:{left:E?.left??C?.left,width:E?.width??C?.width,height:r(i-1).top+r(i-1).height+t},children:f.jsx("div",{className:Z("dsg-selection-col-marker",N&&"dsg-selection-col-marker-disabled"),style:{top:t}})}),(E||C)&&f.jsx("div",{className:"dsg-selection-row-marker-container",style:{top:E?.top??C?.top,height:E?.height??C?.height,width:g||"100%"},children:f.jsx("div",{className:Z("dsg-selection-row-marker",N&&"dsg-selection-row-marker-disabled"),style:{left:e[0]}})}),C&&l&&f.jsx("div",{className:Z("dsg-active-cell",{"dsg-active-cell-focus":I,"dsg-active-cell-disabled":O}),style:C}),E&&C&&f.jsx("div",{className:Z("dsg-selection-rect",N&&"dsg-selection-rect-disabled"),style:{...E,clipPath:$r(C.top-E.top,C.left-E.left,C.top+C.height-E.top,C.left+C.width-E.left)}}),B&&f.jsx("div",{className:Z("dsg-expand-rows-rect"),style:B}),X&&f.jsx("div",{className:Z("dsg-expand-rows-indicator",N&&"dsg-expand-rows-indicator-disabled"),style:X})]})});Vn.displayName="SelectionRect";const Yr=({value:e,rowHeight:n})=>{const t=d.useRef([]),[,o]=d.useState(0);return d.useMemo(()=>{const r=l=>{if(typeof n=="number")return Math.min(e.length-1,Math.max(-1,Math.floor(l/n)));let s=0,i=t.current.length-1;for(;s<=i;){const c=Math.floor((s+i)/2);if(t.current[c].top<l)s=c+1;else if(t.current[c].top>l)i=c-1;else return c}if(i===t.current.length-1&&e.length>t.current.length&&(!t.current.length||l>=t.current[i].top+t.current[i].height)){let c=i===-1?0:t.current[i].top+t.current[i].height;do{i++;const h=n({rowIndex:i,rowData:e[i]});t.current.push({height:h,top:c}),c+=h}while(c<=l&&i<t.current.length-1)}return i};return{resetAfter:l=>{t.current=t.current.slice(0,l),o(s=>s+1)},getRowSize:l=>{if(typeof n=="number")return{height:n,top:n*l};if(l>=e.length)return{height:0,top:0};if(l<t.current.length)return t.current[l];let s=t.current[t.current.length-1].top+t.current[t.current.length-1].height;for(let i=t.current.length;i<=l;i++){const c=n({rowIndex:i,rowData:e[i]});t.current.push({height:c,top:s}),s+=c}return t.current[l]},getRowIndex:r,totalSize:l=>{if(typeof n=="number")return e.length*n;const s=r(l);return t.current[s].top+t.current[s].height}}},[n,e])},Gr=[],Jr=[],Zr=()=>({}),Ae=()=>null,Qr=({rowData:e})=>({...e}),Dt=pe.memo(pe.forwardRef(({value:e=Gr,className:n,style:t,height:o=400,onChange:r=Ae,columns:l=Jr,rowHeight:s=40,headerRowHeight:i=typeof s=="number"?s:40,gutterColumn:c,stickyRightColumn:h,rowKey:g,addRowsComponent:b=En,createRow:p=Zr,autoAddRow:I=!1,lockRows:R=!1,disableExpandSelection:O=!1,disableSmartDelete:N=!1,duplicateRow:z=Qr,contextMenuComponent:V=Dn,disableContextMenu:C=!1,onFocus:E=Ae,onBlur:L=Ae,onActiveCellChange:j=Ae,onSelectionChange:X=Ae,rowClassName:B,cellClassName:q,onScroll:T},Q)=>{const H=d.useRef(null),P=C||R,y=Sr(l,c,h),k=!!h,ae=d.useRef(null),te=d.useRef(null),D=d.useRef(null),$=d.useRef(null),[K,Ne]=Nr(1,100),{getRowSize:ie,totalSize:Xe,getRowIndex:Oe}=Yr({value:e,rowHeight:s}),Ve=Math.min(o,i+Xe(o)+K),{width:ye,height:ge}=wr({targetRef:te,refreshMode:"throttle",refreshRate:100});Ne(ge?Ve-ge:0);const An=Dr(te,ye,ge),{fullWidth:Vt,totalWidth:jn,columnWidths:oe,columnRights:se}=er(y,ye),[ve,le]=d.useState(null),[xe,zn]=d.useState([]),[U,Y]=d.useState(!1),[be,_t]=d.useState(0),[Ce,kt]=d.useState(null),[m,W]=qe(null),[J,F]=qe(null),v=d.useMemo(()=>m&&J&&{min:{col:Math.min(m.col,J.col),row:Math.min(m.row,J.row)},max:{col:Math.max(m.col,J.col),row:Math.max(m.row,J.row)}},[m,J]),[ue,Re]=qe({columns:!1,rows:!1,active:!1}),Fn=O||U||ue.active||m?.row===e?.length-1||v?.max.row===e?.length-1||m&&y.slice((v?.min.col??m.col)+1,(v?.max.col??m.col)+2).every(a=>a.disabled===!0)?null:be,At=nn(ae),jt=nn(te);d.useEffect(()=>{m!==null&&(document.activeElement.blur(),window.getSelection()?.removeAllRanges())},[m!==null]);const we=d.useCallback((a,u=!1,x=!1)=>{const w=At(u),_=x&&jt(u);if(w&&se&&oe){let S=a.clientX-w.left,A=a.clientY-w.top;return _&&(a.clientY-_.top<=i&&(A=0),a.clientX-_.left<=oe[0]&&(S=0),k&&_.right-a.clientX<=oe[oe.length-1]&&(S=se[se.length-2]+1)),{col:se.findIndex(M=>S<M)-1,row:Oe(A-i)}}return null},[se,oe,e.length,At,jt,i,k,Oe]),ne=d.useRef(e);ne.current=e;const re=d.useCallback(a=>{const u=y[a.col+1].disabled;return!!(typeof u=="function"?u({rowData:ne.current[a.row],rowIndex:a.row}):u)},[y]),ce=d.useCallback((a,u=1)=>{R||(F(null),Y(!1),r([...ne.current.slice(0,a+1),...new Array(u).fill(0).map(p),...ne.current.slice(a+1)],[{type:"CREATE",fromRowIndex:a+1,toRowIndex:a+1+u}]),W(x=>({col:x?.col||0,row:a+u,doNotScrollX:!0})))},[p,R,r,W,F]),Se=d.useCallback((a,u=a)=>{R||(r([...ne.current.slice(0,u+1),...ne.current.slice(a,u+1).map((x,w)=>z({rowData:x,rowIndex:w+a})),...ne.current.slice(u+1)],[{type:"CREATE",fromRowIndex:u+1,toRowIndex:u+2+u-a}]),W({col:0,row:u+1,doNotScrollX:!0}),F({col:y.length-(k?3:2),row:2*u-a+1,doNotScrollX:!0}),Y(!1))},[y.length,z,R,r,W,F,k]),de=d.useCallback(a=>{if(!(!ge||!ye)){if(!a.doNotScrollY){const u=ie(a.row).top,x=ie(a.row).top+ie(a.row).height+i-ge+1,w=te.current.scrollTop;w>u?te.current.scrollTop=u:w<x&&(te.current.scrollTop=x)}if(se&&oe&&te.current&&!a.doNotScrollX){const u=se[a.col]-se[0],x=se[a.col]+oe[a.col+1]+(k?oe[oe.length-1]:0)-ye+1,w=te.current.scrollLeft;w>u?te.current.scrollLeft=u:w<x&&(te.current.scrollLeft=x)}}},[ge,ye,i,se,oe,ie,k]);d.useEffect(()=>{J&&de(J)},[J,de]),d.useEffect(()=>{m&&de(m)},[m,de]);const Tn=d.useCallback((a,u)=>{r([...ne.current?.slice(0,a),u,...ne.current?.slice(a+1)],[{type:"UPDATE",fromRowIndex:a,toRowIndex:a+1}])},[r]),Ie=d.useCallback((a,u=a)=>{R||(Y(!1),W(x=>{const w=Math.min(ne.current.length-2-u+a,a);return w<0?null:x&&{col:x.col,row:w}}),F(null),r([...ne.current.slice(0,a),...ne.current.slice(u+1)],[{type:"DELETE",fromRowIndex:a,toRowIndex:u+1}]))},[R,r,W,F]),Fe=d.useCallback((a=!0)=>{const u=a&&!N;if(!m)return;const x=v?.min||m,w=v?.max||m;if(e.slice(x.row,w.row+1).every((S,A)=>y.every(M=>M.isCellEmpty({rowData:S,rowIndex:A+x.row})))){u&&Ie(x.row,w.row);return}const _=[...e];for(let S=x.row;S<=w.row;++S)for(let A=x.col;A<=w.col;++A)if(!re({col:A,row:S})){const{deleteValue:M=({rowData:G})=>G}=y[A+1];_[S]=M({rowData:_[S],rowIndex:S})}if(u&&Sn(_,e)){W({col:0,row:x.row,doNotScrollX:!0}),F({col:y.length-(k?3:2),row:w.row,doNotScrollX:!0});return}r(_,[{type:"UPDATE",fromRowIndex:x.row,toRowIndex:w.row+1}])},[m,y,e,Ie,re,r,v?.max,v?.min,W,F,k]),Be=d.useCallback(({nextRow:a=!0}={})=>{m?.row===ne.current.length-1?a&&I?ce(m.row):Y(!1):(Y(!1),a&&W(u=>u&&{col:u.col,row:u.row+1}))},[m?.row,I,ce,W]),_e=d.useCallback(async a=>{if(!U&&m){const u=[],x=v?.min||m,w=v?.max||m;for(let M=x.row;M<=w.row;++M){u.push([]);for(let G=x.col;G<=w.col;++G){const{copyValue:ee=()=>null}=y[G+1];u[M-x.row].push(ee({rowData:e[M],rowIndex:M}))}}const _=u.map(M=>M.join("	")).join(`
`),S=`<table>${u.map(M=>`<tr>${M.map(G=>`<td>${_r(String(G??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(a!==void 0){a.clipboardData?.setData("text/plain",_),a.clipboardData?.setData("text/html",S),a.preventDefault();return}let A=!1;if(navigator.clipboard.write!==void 0){const M=new Blob([_],{type:"text/plain"}),G=new Blob([S],{type:"text/html"}),ee=[new ClipboardItem({"text/plain":M,"text/html":G})];await navigator.clipboard.write(ee).then(()=>{A=!0})}else navigator.clipboard.writeText!==void 0?await navigator.clipboard.writeText(_).then(()=>{A=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(A=!0);A||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}},[m,y,e,U,v]);he("copy",_e);const $e=d.useCallback(a=>{!U&&m&&(_e(a),Fe(!1))},[m,Fe,U,_e]);he("cut",$e);const ke=d.useCallback(async a=>{if(!U&&m){const u=v?.min||m,x=v?.max||m,w=await Promise.all(a[0].map((_,S)=>{const A=y[u.col+S+1]?.prePasteValues,M=a.map(G=>G[S]);return A?.(M)??M}));if(a=a.map((_,S)=>w.map(A=>A[S])),a.length===1){const _=[...e];for(let S=0;S<a[0].length;S++){const A=y[u.col+S+1]?.pasteValue;if(A)for(let M=u.row;M<=x.row;M++)re({col:S+u.col,row:M})||(_[M]=await A({rowData:_[M],value:a[0][S],rowIndex:M}))}r(_,[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:x.row+1}]),W({col:u.col,row:u.row}),F({col:Math.min(u.col+a[0].length-1,y.length-(k?3:2)),row:x.row})}else{let _=[...e];const S=u.row+a.length-e.length;S>0&&(R?a.splice(a.length-S,S):_=[..._,...new Array(S).fill(0).map(()=>p())]);for(let M=0;M<a[0].length&&u.col+M<y.length-(k?2:1);M++){const G=y[u.col+M+1]?.pasteValue;if(G)for(let ee=0;ee<a.length;ee++)re({col:u.col+M,row:u.row+ee})||(_[u.row+ee]=await G({rowData:_[u.row+ee],value:a[ee][M],rowIndex:u.row+ee}))}const A=[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:u.row+a.length-(!R&&S>0?S:0)}];S>0&&!R&&A.push({type:"CREATE",fromRowIndex:u.row+a.length-S,toRowIndex:u.row+a.length}),r(_,A),W({col:u.col,row:u.row}),F({col:Math.min(u.col+a[0].length-1,y.length-(k?3:2)),row:u.row+a.length-1})}}},[m,y,p,e,U,k,re,R,r,v?.max,v?.min,W,F]),Wn=d.useCallback(a=>{if(m&&!U){let u=[[""]];a.clipboardData?.types.includes("text/html")?u=gt(a.clipboardData?.getData("text/html")):a.clipboardData?.types.includes("text/plain")?u=We(a.clipboardData?.getData("text/plain")):a.clipboardData?.types.includes("text")&&(u=We(a.clipboardData?.getData("text"))),ke(u),a.preventDefault()}},[m,ke,U]);he("paste",Wn);const Ln=d.useCallback(a=>{if(ve&&xe.length)return;const u=a.button===2||a.button===0&&a.ctrlKey,x=ae.current?.contains(a.target)||!1,w=x?we(a,!0,!0):null;if(!x&&U&&m&&y[m.col+1].keepFocus)return;if(a.target instanceof HTMLElement&&a.target.className.includes("dsg-expand-rows-indicator")){kt(Math.max(m?.row??0,v?.max.row??0));return}const _=w&&m&&m.col===w.col&&m.row===w.row&&!re(m);if(_&&U)return;const S=w?.col===y.length-2&&k,A=u&&v&&w&&w.row>=v.min.row&&w.row<=v.max.row&&w.col>=v.min.col&&w.col<=v.max.col,M=u&&v&&w&&w.row===-1&&w.col>=v.min.col&&w.col<=v.max.col,G=u&&v&&w&&w.row>=v.min.row&&w.row<=v.max.row&&w.col===-1,ee=S&&v&&w&&w.row>=v.min.row&&w.row<=v.max.row;if(u&&!P&&le({x:a.clientX,y:a.clientY,cursorIndex:w}),(!(a.shiftKey&&m)||u)&&e.length>0&&W(w&&{col:(A||M)&&m?m.col:Math.max(0,S?0:w.col),row:(A||G||ee)&&m?m.row:Math.max(0,w.row),doNotScrollX:!!(A&&m||S||w.col===-1),doNotScrollY:!!(A&&m||w.row===-1)}),_&&!u&&(H.current=m),Y(!!(_&&!u)),Re(w&&!u?{columns:w.col!==-1&&!S||!!(a.shiftKey&&m),rows:w.row!==-1||!!(a.shiftKey&&m),active:!0}:{columns:!1,rows:!1,active:!1}),a.shiftKey&&m&&!u)F(w&&{col:Math.max(0,w.col-(S?1:0)),row:Math.max(0,w.row)});else if(!A){if(w&&(w?.col===-1||w?.row===-1||S)){let Ye=w.col,Ge=w.row,Je=!1,Ze=!1;(w.col===-1||S)&&(Ye=y.length-(k?3:2),Je=!0),w.row===-1&&(Ge=e.length-1,Ze=!0),M&&J&&(Ye=J.col,Ze=!0),(G||ee)&&J&&(Ge=J.row,Je=!0),F({col:Ye,row:Ge,doNotScrollX:Je,doNotScrollY:Ze})}else F(null);x&&a.preventDefault()}},[ve,xe.length,we,U,m,y,re,v,k,P,Re,W,F,J,e.length]);he("mousedown",Ln);const qn=d.useCallback(()=>{if(Ce!==null){if(be>0&&m){let a=[];const u=v?.min||m,x=v?.max||m;for(let w=u.row;w<=x.row;++w){a.push([]);for(let _=u.col;_<=x.col;++_){const{copyValue:S=()=>null}=y[_+1];a[w-u.row].push(String(S({rowData:e[w],rowIndex:w})??""))}}Promise.all(a[0].map((w,_)=>{const S=y[u.col+_+1]?.prePasteValues,A=a.map(M=>M[_]);return S?.(A)??A})).then(w=>{a=a.map((S,A)=>w.map(M=>M[A]));const _=[...e];for(let S=0;S<a[0].length;S++){const A=y[u.col+S+1]?.pasteValue;if(A)for(let M=x.row+1;M<=x.row+be;M++)re({col:S+u.col,row:M})||(_[M]=A({rowData:_[M],value:a[(M-x.row-1)%a.length][S],rowIndex:M}))}r(_,[{type:"UPDATE",fromRowIndex:x.row+1,toRowIndex:x.row+1+be}])}),_t(0),W({col:Math.min(m?.col??1/0,v?.min.col??1/0),row:Math.min(m?.row??1/0,v?.min.row??1/0),doNotScrollX:!0,doNotScrollY:!0}),F({col:Math.max(m?.col??0,v?.max.col??0),row:Math.max(m?.row??0,v?.max.row??0)+be})}kt(null)}Re({columns:!1,rows:!1,active:!1})},[Ce,Re,be,m,v?.min,v?.max,e,r,W,F,y,re]);he("mouseup",qn);const Pn=d.useCallback(a=>{if(Ce!==null){const u=we(a);u&&(_t(Math.max(0,u.row-Ce)),de({col:u.col,row:Math.max(u.row,Ce)}))}if(ue.active){const u=we(a),x=y.length-(k?3:2);F(u&&{col:ue.columns?Math.max(0,Math.min(x,u.col)):x,row:ue.rows?Math.max(0,u.row):e.length-1,doNotScrollX:!ue.columns,doNotScrollY:!ue.rows}),Y(!1)}},[de,ue.active,ue.columns,ue.rows,we,y.length,k,F,e.length,Ce]);he("mousemove",Pn);const Un=d.useCallback(a=>{if(m&&!a.isComposing){if(a.key==="Tab"&&!a.shiftKey&&m.col===y.length-(k?3:2)&&!y[m.col+1].disableKeys)if(m.row===e.length-1){if($.current){a.preventDefault(),W(null),F(null),Y(!1);const u=on(),x=u.indexOf($.current);u[(x+1)%u.length].focus();return}}else{W(u=>({col:0,row:(u?.row??0)+1})),F(null),Y(!1),a.preventDefault();return}if(a.key==="Tab"&&a.shiftKey&&m.col===0&&!y[m.col+1].disableKeys)if(m.row===0){if(D.current){a.preventDefault(),W(null),F(null),Y(!1);const u=on(),x=u.indexOf(D.current);u[(x-1+u.length)%u.length].focus();return}}else{W(u=>({col:y.length-(k?3:2),row:(u?.row??1)-1})),F(null),Y(!1),a.preventDefault();return}if(a.key?.startsWith("Arrow")||a.key==="Tab"){if(U&&y[m.col+1].disableKeys||U&&["ArrowLeft","ArrowRight"].includes(a.key))return;const u=([x,w],_)=>_&&{col:Math.max(0,Math.min(y.length-(k?3:2),_.col+x)),row:Math.max(0,Math.min(e.length-1,_.row+w))};if(a.key==="Tab"&&a.shiftKey)W(x=>u([-1,0],x)),F(null);else{const x={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[a.key];(a.ctrlKey||a.metaKey)&&(x[0]*=y.length,x[1]*=e.length),a.shiftKey?F(w=>u(x,w||m)):(W(w=>u(x,w)),F(null))}Y(!1),a.preventDefault()}else a.key==="Escape"?(!U&&!J&&W(null),F(null),Y(!1)):(a.key==="Enter"||a.key==="F2")&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&!a.shiftKey?(F(null),U?y[m.col+1].disableKeys||(Be(),a.preventDefault()):re(m)||(H.current=m,Y(!0),de(m),a.preventDefault())):a.key==="Enter"&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&a.shiftKey?ce(v?.max.row||m.row):a.key==="d"&&(a.ctrlKey||a.metaKey)&&!a.altKey&&!a.shiftKey?(Se(v?.min.row||m.row,v?.max.row),a.preventDefault()):(kr(a.key)||a.code.match(/Key[A-Z]$/))&&!a.ctrlKey&&!a.metaKey&&!a.altKey?!U&&!re(m)&&(H.current=m,F(null),Y(!0),de(m)):["Backspace","Delete"].includes(a.key)?U||(Fe(),a.preventDefault()):a.key==="a"&&(a.ctrlKey||a.metaKey)&&(U||(W({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),F({col:y.length-(k?3:2),row:e.length-1,doNotScrollY:!0,doNotScrollX:!0}),a.preventDefault()))}},[m,y,e.length,Fe,Se,U,ce,re,de,v?.max.row,v?.min.row,J,W,F,Be,k]);he("keydown",Un);const Hn=d.useCallback(a=>{const u=ae.current?.contains(a.target)||!1,x=u?we(a,!0,!0):null,w=x&&m&&m.col===x.col&&m.row===x.row&&U;u&&!w&&a.preventDefault()},[we,m,U]);he("contextmenu",Hn),d.useEffect(()=>{const a=[];m?.row!==void 0&&a.push({type:"COPY",action:()=>{_e(),le(null)}},{type:"CUT",action:()=>{$e(),le(null)}},{type:"PASTE",action:async()=>{if(navigator.clipboard.read!==void 0)(await navigator.clipboard.read()).forEach(async u=>{let x=[[""]];if(u.types.includes("text/html")){const w=await u.getType("text/html");x=gt(await w.text())}else if(u.types.includes("text/plain")){const w=await u.getType("text/plain");x=We(await w.text())}else if(u.types.includes("text")){const w=await u.getType("text");x=gt(await w.text())}ke(x)});else if(navigator.clipboard.readText!==void 0){const u=await navigator.clipboard.readText();ke(We(u))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");le(null)}}),v?.max.row!==void 0?a.push({type:"INSERT_ROW_BELLOW",action:()=>{le(null),ce(v.max.row)}}):m?.row!==void 0&&a.push({type:"INSERT_ROW_BELLOW",action:()=>{le(null),ce(m.row)}}),v?.min.row!==void 0&&v.min.row!==v.max.row?a.push({type:"DUPLICATE_ROWS",fromRow:v.min.row+1,toRow:v.max.row+1,action:()=>{le(null),Se(v.min.row,v.max.row)}}):m?.row!==void 0&&a.push({type:"DUPLICATE_ROW",action:()=>{le(null),Se(m.row)}}),v?.min.row!==void 0&&v.min.row!==v.max.row?a.push({type:"DELETE_ROWS",fromRow:v.min.row+1,toRow:v.max.row+1,action:()=>{le(null),Ie(v.min.row,v.max.row)}}):m?.row!==void 0&&a.push({type:"DELETE_ROW",action:()=>{le(null),Ie(m.row)}}),zn(a),a.length||le(null)},[v,m,Ie,Se,ce,$e,_e,ke]);const zt=d.useRef(xe);zt.current=xe;const Kn=d.useCallback(()=>zt.current,[]);d.useImperativeHandle(Q,()=>({activeCell:De(m,y),selection:rn(v??(m?{min:m,max:m}:null),y),setSelection:a=>{const u=Ar(a,y.length-(k?2:1),e.length,y);W(u?.min||null),Y(!1),Re({columns:!1,active:!1,rows:!1}),F(u?.max||null)},setActiveCell:a=>{const u=vt(a,y.length-(k?2:1),e.length,y);W(u),Y(!1),Re({columns:!1,active:!1,rows:!1}),F(null)}}));const me=d.useRef({onFocus:E,onBlur:L,onActiveCellChange:j,onSelectionChange:X});return me.current.onFocus=E,me.current.onBlur=L,me.current.onActiveCellChange=j,me.current.onSelectionChange=X,d.useEffect(()=>{H.current&&(U?me.current.onFocus({cell:De(H.current,y)}):me.current.onBlur({cell:De(H.current,y)}))},[U,y]),d.useEffect(()=>{me.current.onActiveCellChange({cell:De(m,y)})},[m?.col,m?.row,y]),d.useEffect(()=>{me.current.onSelectionChange({selection:rn(v??(m?{min:m,max:m}:null),y)})},[v?.min.col??m?.col,v?.min.row??m?.row,v?.max.col??m?.col,v?.max.row??m?.row,m?.col,m?.row,y]),f.jsxs("div",{className:n,style:t,children:[f.jsx("div",{ref:D,tabIndex:l.length&&e.length?0:void 0,onFocus:a=>{a.target.blur(),W({col:0,row:0})}}),f.jsx(Br,{columns:y,outerRef:te,columnWidths:oe,hasStickyRightColumn:k,displayHeight:Ve,data:e,fullWidth:Vt,headerRowHeight:i,activeCell:m,innerRef:ae,rowHeight:ie,rowKey:g,selection:v,rowClassName:B,editing:U,getContextMenuItems:Kn,setRowData:Tn,deleteRows:Ie,insertRowAfter:ce,duplicateRows:Se,stopEditing:Be,cellClassName:q,onScroll:T,children:f.jsx(Vn,{columnRights:se,columnWidths:oe,activeCell:m,selection:v,headerRowHeight:i,rowHeight:ie,hasStickyRightColumn:k,dataLength:e.length,viewHeight:ge,viewWidth:ye,contentWidth:Vt?void 0:jn,edges:An,editing:U,isCellDisabled:re,expandSelection:Fn})}),f.jsx("div",{ref:$,tabIndex:l.length&&e.length?0:void 0,onFocus:a=>{a.target.blur(),W({col:y.length-(k?3:2),row:e.length-1})}}),!R&&b&&f.jsx(b,{addRows:a=>ce(e.length-1,a)}),ve&&xe.length>0&&f.jsx(V,{clientX:ve.x,clientY:ve.y,cursorIndex:ve.cursorIndex,items:xe,close:()=>le(null)})]})}));Dt.displayName="DataSheetGrid";pe.forwardRef(({columns:e,gutterColumn:n,stickyRightColumn:t,addRowsComponent:o,createRow:r,duplicateRow:l,style:s,rowKey:i,onFocus:c,onBlur:h,onActiveCellChange:g,onSelectionChange:b,rowClassName:p,rowHeight:I,...R},O)=>{const[N]=d.useState({columns:e,gutterColumn:n,stickyRightColumn:t,addRowsComponent:o,createRow:r,duplicateRow:l,style:s,rowKey:i,onFocus:c,onBlur:h,onActiveCellChange:g,onSelectionChange:b,rowClassName:p,rowHeight:I});return f.jsx(Dt,{...N,...R,rowHeight:typeof I=="number"?I:N.rowHeight,ref:O})});const eo=()=>{const e=d.useRef(!0),n=e.current;return e.current=!1,n},_n=pe.memo(({active:e,focus:n,rowData:t,setRowData:o,columnData:{placeholder:r,alignRight:l,formatInputOnFocus:s,formatBlurredInput:i,parseUserInput:c,continuousUpdates:h}})=>{const g=d.useRef(null),b=eo(),p=d.useRef({rowData:t,formatInputOnFocus:s,formatBlurredInput:i,setRowData:o,parseUserInput:c,continuousUpdates:h,firstRender:b,focusedAt:0,changedAt:0,escPressed:!1});return p.current={rowData:t,formatInputOnFocus:s,formatBlurredInput:i,setRowData:o,parseUserInput:c,continuousUpdates:h,firstRender:b,focusedAt:p.current.focusedAt,changedAt:p.current.changedAt,escPressed:p.current.escPressed},d.useLayoutEffect(()=>{n?(g.current&&(g.current.value=p.current.formatInputOnFocus(p.current.rowData),g.current.focus(),g.current.select()),p.current.escPressed=!1,p.current.focusedAt=Date.now()):g.current&&(!p.current.escPressed&&!p.current.continuousUpdates&&!p.current.firstRender&&p.current.changedAt>=p.current.focusedAt&&p.current.setRowData(p.current.parseUserInput(g.current.value)),g.current.blur())},[n]),d.useEffect(()=>{!n&&g.current&&(g.current.value=p.current.formatBlurredInput(t))},[n,t]),f.jsx("input",{defaultValue:i(t),className:Z("dsg-input",l&&"dsg-input-align-right"),placeholder:e?r:void 0,tabIndex:-1,ref:g,style:{pointerEvents:n?"auto":"none"},onChange:I=>{p.current.changedAt=Date.now(),h&&o(c(I.target.value))},onKeyDown:I=>{I.key==="Escape"&&(p.current.escPressed=!0)}})});_n.displayName="TextComponent";ze();function ze({placeholder:e,alignRight:n=!1,continuousUpdates:t=!0,deletedValue:o=null,parseUserInput:r=h=>h.trim()||null,formatBlurredInput:l=h=>String(h??""),formatInputOnFocus:s=h=>String(h??""),formatForCopy:i=h=>String(h??""),parsePastedValue:c=h=>h.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:_n,columnData:{placeholder:e,alignRight:n,continuousUpdates:t,formatInputOnFocus:s,formatBlurredInput:l,parseUserInput:r},deleteValue:()=>o,copyValue:({rowData:h})=>i(h),pasteValue:({value:h})=>c(h),isCellEmpty:({rowData:h})=>h==null}}const to=pe.memo(({focus:e,rowData:n,setRowData:t,active:o,stopEditing:r,disabled:l})=>{const s=d.useRef(null);return d.useLayoutEffect(()=>{e&&(t(!n),r({nextRow:!1}))},[e,r]),f.jsx("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:s,disabled:l,checked:!!n,onMouseDown:()=>!o&&t(!n),onChange:()=>null})});to.displayName="CheckboxComponent";const no=ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:n},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:n}});ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:Math.round(n)},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:Math.round(n)}});const ro=1e12,oo=1e10;ze({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(e):"",formatInputOnFocus:e=>typeof e=="number"&&!isNaN(e)?String(Math.round(e*ro)/oo):"",parseUserInput:e=>{const n=parseFloat(e);return isNaN(n)?null:n/100},parsePastedValue:e=>{const n=parseFloat(e);return isNaN(n)?null:n}});const lo=pe.memo(({focus:e,active:n,rowData:t,setRowData:o})=>{const r=d.useRef(null);return d.useLayoutEffect(()=>{e?r.current?.select():r.current?.blur()},[e]),f.jsx("input",{className:Z("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:r,style:{pointerEvents:e?"auto":"none",opacity:t||n?void 0:0},value:t?.toISOString().substr(0,10)??"",onChange:l=>{const s=new Date(l.target.value);o(isNaN(s.getTime())?null:s)}})});lo.displayName="DateComponent";const so=pe.memo(({focus:e,active:n,rowData:t,setRowData:o})=>{const r=d.useRef(null);return d.useLayoutEffect(()=>{e?r.current?.select():r.current?.blur()},[e]),f.jsx("input",{className:Z("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:r,style:{pointerEvents:e?"auto":"none",opacity:t||n?void 0:0},value:t??"",onChange:l=>{const s=new Date(l.target.value);o(isNaN(s.getTime())?null:s.toISOString().substr(0,10))}})});so.displayName="IsoDateComponent";const io=({columnData:{key:e,original:n},rowData:t,setRowData:o,...r})=>{const l=d.useRef(t);l.current=t;const s=d.useCallback(c=>{o({...l.current,[e]:c})},[e,o]);if(!n.component)return f.jsx(f.Fragment,{});const i=n.component;return f.jsx(i,{columnData:n.columnData,setRowData:s,rowData:t[e],...r})},ao=(e,n)=>({id:e,...n,columnData:{key:e,original:n},component:io,copyValue:({rowData:t,rowIndex:o})=>n.copyValue?.({rowData:t[e],rowIndex:o})??null,deleteValue:({rowData:t,rowIndex:o})=>({...t,[e]:n.deleteValue?.({rowData:t[e],rowIndex:o})??null}),pasteValue:({rowData:t,value:o,rowIndex:r})=>({...t,[e]:n.pasteValue?.({rowData:t[e],value:o,rowIndex:r})??null}),disabled:typeof n.disabled=="function"?({rowData:t,rowIndex:o})=>typeof n.disabled=="function"?n.disabled({rowData:t[e],rowIndex:o}):n.disabled??!1:n.disabled,cellClassName:typeof n.cellClassName=="function"?({rowData:t,rowIndex:o,columnId:r})=>typeof n.cellClassName=="function"?n.cellClassName({rowData:t[e],rowIndex:o,columnId:r}):n.cellClassName??void 0:n.cellClassName,isCellEmpty:({rowData:t,rowIndex:o})=>n.isCellEmpty?.({rowData:t[e],rowIndex:o})??!1}),uo=Dt;function je(e,n){if(!n||n==="string")return String(e);if(n==="number"||n==="integer"){if(e.trim()==="")return e;let t;return n==="integer"?t=parseInt(e,10):t=Number(e),isNaN(t)?e:t}else{if(n==="boolean")return e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e;if(n==="object"||n==="array")try{return JSON.parse(e)}catch{return e}else return n==="null"&&(e.toLowerCase()==="null"||e.trim()==="")?null:e}}const co={width:"100%",height:"100%","& .MuiTextField-root .MuiInputBase-root":{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0},"& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}};function fe(e){return He(e)?"":typeof e=="object"?JSON.stringify(e):String(e)}function xt({rowData:e,setRowData:n,choices:t,colType:o,focus:r,stopEditing:l,active:s,clearValue:i=void 0}){const[c,h]=d.useState(!1),g=d.useRef(null),b=fe(e),[p,I]=d.useState(b);d.useEffect(()=>{s?g.current?.focus():(h(!1),g.current?.blur(),p!==b&&n(je(p,o)))},[s]),d.useEffect(()=>{!r&&!s&&I(b)},[r,s,b]);const R=!He(e)&&e!=="",O=d.useMemo(()=>({...co,"& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit",pointerEvents:r?void 0:"none"},"& .MuiAutocomplete-clearIndicator":{visibility:s?"visible":"hidden",pointerEvents:"auto"},"& .MuiAutocomplete-popupIndicator":{visibility:s?"visible":"hidden",pointerEvents:"auto"},"&:hover .MuiAutocomplete-clearIndicator":{visibility:"visible"},"&:hover .MuiAutocomplete-popupIndicator":{visibility:"visible"}}),[s,r]);return f.jsx(vn,{open:c,onOpen:()=>{h(!0)},forcePopupIcon:!0,disableClearable:!R,freeSolo:!0,disablePortal:!1,options:t,autoSelect:!0,selectOnFocus:!0,getOptionLabel:N=>fe(N),value:e,inputValue:p,onInputChange:(N,z)=>{I(z)},onKeyDown:N=>{N.key==="Tab"?(N.preventDefault(),l({nextRow:!1})):N.key==="Enter"&&(N.preventDefault(),l({nextRow:!0}))},onClose:()=>{h(!1),l({nextRow:!1})},onChange:(N,z,V)=>{n(V==="clear"?i:V==="createOption"?je(z,o):z),setTimeout(()=>l({nextRow:!1}),0)},blurOnSelect:!0,renderInput:N=>f.jsx(yn,{...N,inputRef:g}),sx:O})}const ho=d.memo(xt,(e,n)=>e.active===n.active&&e.focus===n.focus&&e.rowData===n.rowData&&e.choices===n.choices&&e.colType===n.colType&&e.clearValue===n.clearValue);function Ue({choices:e,colType:n,clearValue:t}){return{component:(o=>f.jsx(ho,{...o,choices:e,colType:n,clearValue:t})),copyValue:({rowData:o})=>o,pasteValue:({value:o})=>o,disableKeys:!0,keepFocus:!0}}try{fe.displayName="castCellValueToString",fe.__docgenInfo={description:"",displayName:"castCellValueToString",props:{}}}catch{}try{xt.displayName="AutocompleteCell",xt.__docgenInfo={description:"",displayName:"AutocompleteCell",props:{rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"any"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean"}},focus:{defaultValue:null,description:"",name:"focus",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},columnData:{defaultValue:null,description:"",name:"columnData",required:!0,type:{name:"any"}},setRowData:{defaultValue:null,description:"",name:"setRowData",required:!0,type:{name:"((rowData: any) => void) & ((value: AutocompleteOption) => void)"}},stopEditing:{defaultValue:null,description:"",name:"stopEditing",required:!0,type:{name:"(opts?: { nextRow?: boolean; }) => void"}},insertRowBelow:{defaultValue:null,description:"",name:"insertRowBelow",required:!0,type:{name:"() => void"}},duplicateRow:{defaultValue:null,description:"",name:"duplicateRow",required:!0,type:{name:"() => void"}},deleteRow:{defaultValue:null,description:"",name:"deleteRow",required:!0,type:{name:"() => void"}},getContextMenuItems:{defaultValue:null,description:"",name:"getContextMenuItems",required:!0,type:{name:"() => ContextMenuItem[]"}},choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},clearValue:{defaultValue:{value:"undefined"},description:"",name:"clearValue",required:!1,type:{name:"null"}}}}}catch{}try{Ue.displayName="autocompleteColumn",Ue.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},clearValue:{defaultValue:null,description:"",name:"clearValue",required:!0,type:{name:"null"}}}}}catch{}function bt({option:e,active:n=!1,...t}){return f.jsx(Jn,{...t,label:fe(e),sx:{maxWidth:n?"none":"120px",fontSize:"0.75rem",height:"24px",margin:"1px",flexShrink:0,...t.sx}})}try{bt.displayName="GridAutocompleteChip",bt.__docgenInfo={description:"",displayName:"GridAutocompleteChip",props:{option:{defaultValue:null,description:"",name:"option",required:!0,type:{name:"unknown"}},active:{defaultValue:{value:"false"},description:"",name:"active",required:!1,type:{name:"boolean"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}},slots:{defaultValue:{value:"{}"},description:"The components used for each slot inside.",name:"slots",required:!1,type:{name:"Partial<ChipSlots>"}},slotProps:{defaultValue:{value:"{}"},description:"The props used for each slot inside.",name:"slotProps",required:!1,type:{name:'{ root?: SlotProps<"div", {}, ChipOwnerState>; label?: SlotProps<"span", {}, ChipOwnerState>; }'}}}}}catch{}const mo={width:"100%",height:"100%","& .MuiFormControl-root":{height:"100%"},"& .MuiAutocomplete-tag":{margin:"1px"},"&:hover .MuiAutocomplete-clearIndicator":{visibility:"visible"},"&:hover .MuiAutocomplete-popupIndicator":{visibility:"visible"}},po={height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0};function gn(e){return{label:fe(e),value:e}}function Ct(e){return Array.isArray(e)?e:He(e)?[]:[e]}function fo({rowData:e,setRowData:n,choices:t,colType:o,limitTags:r=2,active:l,focus:s,stopEditing:i,clearValue:c=void 0}){const h=d.useRef(null);d.useLayoutEffect(()=>{s?h.current?.focus():h.current?.blur()},[s]);const[g,b]=d.useState(""),p=Ct(e),I=t.map(gn),R=p.map(gn),O=l?-1:r,N=p.length>0?p.map(C=>fe(C)).join(","):"",z=!He(e)&&e!=="",V=d.useMemo(()=>({...mo,"& .MuiAutocomplete-inputRoot":{pointerEvents:s?void 0:"none",padding:"0 10px",backgroundColor:"inherit",flexWrap:l?"wrap":"nowrap",minHeight:"100%",maxHeight:"100%",overflowY:l?"auto":"hidden",overflowX:"hidden","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"3px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555"}},"& .MuiAutocomplete-clearIndicator":{visibility:l?"visible":"hidden",pointerEvents:"auto"},"& .MuiAutocomplete-popupIndicator":{visibility:l?"visible":"hidden",pointerEvents:"auto"}}),[l,s]);return f.jsx(Bn,{title:N,placement:"top-start",arrow:!0,enterDelay:500,disableHoverListener:l||p.length<=r,children:f.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:f.jsx(vn,{ref:h,forcePopupIcon:t.length>0,disableClearable:!z,multiple:!0,freeSolo:!0,open:!!s,disablePortal:!1,limitTags:O,options:I,getOptionLabel:C=>typeof C=="string"?C:C.label,isOptionEqualToValue:(C,E)=>{const L=typeof C=="string"?C:C.value,j=typeof E=="string"?E:E.value;return $n(L,j)},value:R,inputValue:g,onInputChange:(C,E)=>{b(E)},onClose:()=>i({nextRow:!1}),onChange:(C,E,L)=>{const j=(E||[]).map(X=>typeof X=="string"?je(X,o):X.value);n(j.length===0?c:j),b("")},disableCloseOnSelect:t.length>1,onBlur:()=>{if(g.trim()){const C=je(g,o);n([...p,C]),b("")}},renderValue:(C,E)=>C.map((L,j)=>{const{key:X,...B}=E({index:j}),q=typeof L=="string"?L:L.value;return f.jsx(bt,{option:q,active:l,...B},X)}),renderInput:C=>f.jsx(yn,{...C,slotProps:{input:{...C.InputProps,disableUnderline:!0,sx:po}}}),sx:V})})})}const go=d.memo(fo,(e,n)=>e.active===n.active&&e.focus===n.focus&&e.rowData===n.rowData&&e.choices===n.choices&&e.colType===n.colType&&e.limitTags===n.limitTags&&e.clearValue===n.clearValue);function Rt({choices:e,colType:n,limitTags:t=2,dynamicHeight:o=!1,clearValue:r=void 0}){return{component:(l=>f.jsx(go,{...l,choices:e,colType:n,limitTags:t,clearValue:r})),copyValue:({rowData:l})=>Ct(l).map(i=>fe(i)).join(","),pasteValue:({value:l})=>{if(typeof l!="string")return l;const s=/[,\t]/,i=l.split(s).map(c=>c.trim()).filter(c=>c.length>0).map(c=>je(c,n)).filter(c=>c!=null);return i.length>0?i:[]},disableKeys:!0,keepFocus:!0,...o&&{cellClassName:({rowData:l})=>Ct(l).length>3?"multi-value-cell-large":"multi-value-cell"}}}try{Rt.displayName="autocompleteMultipleEnumColumn",Rt.__docgenInfo={description:"",displayName:"autocompleteMultipleEnumColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"unknown[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}},limitTags:{defaultValue:{value:"2"},description:"",name:"limitTags",required:!1,type:{name:"number"}},dynamicHeight:{defaultValue:{value:"false"},description:"",name:"dynamicHeight",required:!1,type:{name:"boolean"}},clearValue:{defaultValue:{value:"undefined"},description:"",name:"clearValue",required:!1,type:{name:"null"}}}}}catch{}function Nt(e,n){const t=n?.type?.format==="date-time"?215:175,o=e.length*11;return Math.max(t,o)}function wo(e){return e?"header-cell-required":"header-cell"}function yo(e,n){return({rowData:t})=>({...t,[e]:n?null:void 0})}function vo(e){return n=>{const t=n.trim();return t===""?e?null:void 0:t}}function Me(e,n){const t=e.customWidth??Nt(e.columnName);return{...ao(e.columnName,n),title:e.columnName,headerClassName:wo(e.isRequired),minWidth:t,basis:t,grow:0,shrink:0,disabled:e.disabled,deleteValue:yo(e.columnName,e.isRequired)}}const xo={multipleEnum:e=>Me(e,Rt({choices:e.enumeratedValues??[],colType:e.typeInfo?.type||null,limitTags:3,clearValue:e.isRequired?null:void 0})),boolean:e=>Me(e,Ue({choices:[!0,!1],colType:"boolean",clearValue:e.isRequired?null:void 0})),number:e=>Me(e,no),enumerated:e=>Me(e,Ue({choices:e.enumeratedValues??[],colType:e.typeInfo?.type||null,clearValue:e.isRequired?null:void 0})),"date-time":e=>{const n=yt({colType:e.typeInfo?.type||null}),t=e.customWidth??Nt(e.columnName,{type:e.typeInfo??void 0,isRequired:e.isRequired});return{...Me(e,n),minWidth:t,basis:t}},text:e=>{const n=ze({continuousUpdates:!1,deletedValue:void 0,parseUserInput:vo(e.isRequired)});return{...Me(e,n),cellClassName:"MuiInputBase-input"}}};function bo(e,n){return e?e.format==="date-time"?"date-time":e.isArray?"multipleEnum":e.type==="boolean"?"boolean":e.type==="number"||e.type==="integer"?"number":n&&n.length>0?"enumerated":"text":n&&n.length>0?"enumerated":"text"}function Co(e){const n=bo(e.typeInfo,e.enumeratedValues);return xo[n](e)}function Ro(e,n,t,o={}){return n.map(r=>{const l=e[r],s=t[l];return Co({columnName:l,typeInfo:s?.type||null,enumeratedValues:s?.enumeratedValues||[],isRequired:s?.isRequired||!1,disabled:s?.type?.readOnly,customWidth:o[l]})})}const So=["COPY","PASTE","CUT"],Io=In(),kn=e=>{if(e.type==="COPY")return f.jsx(f.Fragment,{children:"Copy"});if(e.type==="PASTE")return f.jsx(f.Fragment,{children:"Paste"});if(e.type==="CUT")return f.jsx(f.Fragment,{children:"Cut"});if(e.type==="INSERT_ROW_BELLOW")return f.jsx(f.Fragment,{children:"Insert row below"});if(e.type==="DELETE_ROW")return f.jsx(f.Fragment,{children:"Delete row"});if(e.type==="DUPLICATE_ROW")return f.jsx(f.Fragment,{children:"Duplicate row"});if(e.type==="DELETE_ROWS")return f.jsx(f.Fragment,{children:"Delete rows"});if(e.type==="DUPLICATE_ROWS")return f.jsx(f.Fragment,{children:"Duplicate rows"})},Eo=Mt(kn),Mo=Mt(kn),Do=e=>{const n=e.items.filter(t=>So.includes(t.type));return f.jsx(Eo,{...e,items:n})},No=e=>f.jsx(Io,{...e}),St=e=>f.jsx(Do,{...e}),It=e=>f.jsx(Mo,{...e});try{St.displayName="renderViewContextMenu",St.__docgenInfo={description:"",displayName:"renderViewContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}try{It.displayName="renderRecordSetContextMenu",It.__docgenInfo={description:"",displayName:"renderRecordSetContextMenu",props:{clientX:{defaultValue:null,description:"",name:"clientX",required:!0,type:{name:"number"}},clientY:{defaultValue:null,description:"",name:"clientY",required:!0,type:{name:"number"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ContextMenuItem[]"}},cursorIndex:{defaultValue:null,description:"",name:"cursorIndex",required:!0,type:{name:"Cell"}},close:{defaultValue:null,description:"",name:"close",required:!0,type:{name:"() => void"}}}}}catch{}const Oo="__rowKey",qo=e=>{const n=e.trim();if(n){if(n.toUpperCase().startsWith("SELECT"))return{type:"sql",input:n};if(Yn.test(n))return{type:"recordSetId",input:n};if(/^[A-Za-z]\w*=+$/.test(n))return{type:"sessionId",input:n}}else return{type:"empty",input:""};return{type:"unknown",input:n}};function Vo(e,n){const t=Object.keys(e),o=Object.keys(n);if(t.length!==o.length)return!1;for(const r of t){const l=e[r],s=n[r],i=c=>c==null||c==="";if(!(i(l)&&i(s))&&String(l)!==String(s))return!1}return!0}function Po(e,n,t){function o(r){if(r.type==="UPDATE"){const l=n.slice(r.fromRowIndex,r.toRowIndex),s=e.slice(r.fromRowIndex,r.toRowIndex);return l.map((c,h)=>Vo(c,s[h])).every(Boolean)}return!1}return t.filter(r=>!o(r))}function _o(e){const{rowData:n,rowIndex:t,columnId:o,selectedRowIndex:r,lastSelection:l,colValues:s}=e,i=r===t,c=n.__cellValidationResults,h=c&&o&&c.has(o),g=[];i&&g.push("cell-row-selected");let b=!1;return l&&o&&s&&(b=t>=l.min.row&&t<=l.max.row&&s.findIndex(p=>p.id===o)>=l.min.col&&s.findIndex(p=>p.id===o)<=l.max.col,b&&g.push("cell-selected")),h&&g.push("cell-invalid"),g.length?xn(g):void 0}class Ot{constructor(n,t){this.colValues=n,this.onColumnResize=t}static COLUMN_MIN_WIDTH_PX=50;handlesMap=new Map;cleanupFunctions=[];activeResize=null;gridContainer=null;headerRow=null;observer=null;updateColumns(n,t){this.colValues=n,this.onColumnResize=t,this.syncHandles()}initialize(n){const t=n.querySelector(".dsg-container");if(!t)return!1;const o=t.querySelector(".dsg-row.dsg-row-header");return o?(this.gridContainer=t,this.headerRow=o,this.setupEventListeners(),this.syncHandles(),!0):!1}createNewHandle(n){if(!this.gridContainer)throw new Error("Cannot create handle without grid container");const t=document.createElement("div");t.className="column-resize-handle",t.dataset.columnName=n,t.style.position="absolute",t.style.top="0",t.style.width="8px",t.style.cursor="col-resize",t.style.pointerEvents="auto",t.style.zIndex="1000";const o=r=>this.handleMouseDown(r,t);return t.addEventListener("mousedown",o),this.cleanupFunctions.push(()=>t.removeEventListener("mousedown",o)),this.gridContainer.appendChild(t),this.cleanupFunctions.push(t),this.handlesMap.set(n,t),t}createOrUpdateHandle(n,t){const o=this.colValues[t]?.title;if(!o||!this.gridContainer)return;let r=this.handlesMap.get(o);r||(r=this.createNewHandle(o)),this.updateHandlePosition(r,n)}updateHandlePosition(n,t){if(!this.gridContainer)return;const o=this.gridContainer.scrollHeight,r=t.offsetLeft+t.offsetWidth-3;n.__cellElement=t,n.__columnName=n.dataset.columnName,n.style.left=`${r}px`,n.style.height=`${o}px`,n.style.display=""}handleMouseDown(n,t){n.preventDefault(),n.stopPropagation();const o=t.__columnName,r=t.__cellElement;if(!o||!r)return;const l=parseFloat(t.style.left);this.activeResize={columnName:o,startX:n.clientX,startWidth:r.offsetWidth,handle:t,initialLeft:l},t.classList.add("is-resizing"),document.body.classList.add("col-resizing")}handleMouseMove=n=>{if(!this.activeResize)return;const{startX:t,handle:o,initialLeft:r}=this.activeResize,l=n.clientX-t;o.style.left=`${r+l}px`};handleMouseUp=n=>{if(!this.activeResize)return;const{columnName:t,startX:o,startWidth:r,handle:l}=this.activeResize,s=n.clientX-o,i=Math.max(Ot.COLUMN_MIN_WIDTH_PX,r+s);l.classList.remove("is-resizing"),document.body.classList.remove("col-resizing"),this.activeResize=null,this.onColumnResize(t,i)};syncHandles=()=>{if(this.activeResize||!this.headerRow)return;const n=this.headerRow.querySelectorAll(".dsg-cell");if(n.length<=1)return;const t=new Set;n.forEach((o,r)=>{if(r===0)return;const l=o,s=l.textContent?.trim()||"",i=this.colValues.findIndex(c=>c.title===s);if(i!==-1){const c=this.colValues[i]?.title;t.add(c),this.createOrUpdateHandle(l,i)}}),this.handlesMap.forEach((o,r)=>{t.has(r)||(o.style.display="none")})};setupEventListeners(){!this.gridContainer||!this.headerRow||(document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("mouseleave",this.handleMouseUp),this.gridContainer.addEventListener("scroll",this.syncHandles),this.observer=new MutationObserver(()=>{requestAnimationFrame(()=>{this.syncHandles()})}),this.observer.observe(this.headerRow,{childList:!0,subtree:!0}),this.cleanupFunctions.push(()=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("mouseleave",this.handleMouseUp),this.gridContainer?.removeEventListener("scroll",this.syncHandles),this.observer?.disconnect()}))}cleanup(){document.body.classList.remove("col-resizing"),this.activeResize&&(this.activeResize.handle?.classList.remove("is-resizing"),this.activeResize=null),this.cleanupFunctions.forEach(n=>{typeof n=="function"?n():n.remove()}),this.cleanupFunctions=[],this.handlesMap.clear(),this.gridContainer=null,this.headerRow=null,this.observer=null}}function ko({wrapperRef:e,colValues:n,onColumnResize:t}){const o=d.useRef(null);Zn(e,r=>{if(!(!e.current||!r||r.contentRect.height===0)&&!o.current){const l=new Ot(n,t);l.initialize(e.current)&&(o.current=l)}}),d.useEffect(()=>{o.current&&o.current.updateColumns(n,t)},[n,t]),d.useEffect(()=>()=>{o.current?.cleanup(),o.current=null},[])}function wn(e){const{gridRef:n,rowValues:t,columnNames:o,columnOrder:r,schemaPropertiesInfo:l,entityIsView:s,jsonSchema:i,lastSelection:c,handleChange:h,handleSelectionChange:g,onSelectedRowChange:b}=e,[p,I]=d.useState({});d.useEffect(()=>{!o||!r||I(T=>{const Q=r.map(y=>o[y]);if(!Q.some(y=>!T[y]))return T;const P={...T};return Q.forEach(y=>{if(!P[y]){const k=l[y];P[y]=Nt(y,k)}}),P})},[o,r,l]);const R=d.useMemo(()=>Ro(o,r,l,p),[o,r,l,p]),[O,N]=d.useState(null),z=d.useMemo(()=>s?St:It,[s]),V=d.useMemo(()=>s?!1:No,[s]),C=d.useCallback(({rowData:T,rowIndex:Q})=>xn({"row-valid":!!i&&T.__validationStatus==="valid","row-invalid":!!i&&T.__validationStatus==="invalid","row-unknown":!!i&&T.__validationStatus==="pending","row-selected":O===Q}),[i,O]),E=d.useCallback(({rowData:T,rowIndex:Q,columnId:H})=>_o({rowData:T,rowIndex:Q,columnId:H||"",selectedRowIndex:O,lastSelection:c,colValues:R}),[O,c,R]),L=d.useCallback(({rowData:T})=>({...T}),[]),j=d.useCallback(({cell:T})=>{T?(N(T.row),b?.(T.row,t[T.row])):(N(null),b?.(null,null))},[b,t]),X=d.useRef(null),B=d.useRef(null),q=d.useCallback((T,Q)=>{if(n.current){const H=n.current.activeCell;H?B.current={col:H.col,row:H.row}:B.current=null}I(H=>({...H,[T]:Q}))},[n]);return ko({wrapperRef:X,colValues:R,onColumnResize:q}),f.jsx("div",{ref:X,style:{position:"relative",width:"100%"},children:f.jsx(uo,{ref:n,value:t,columns:R,autoAddRow:!s,disableSmartDelete:!0,addRowsComponent:V,contextMenuComponent:z,rowKey:Oo,rowClassName:C,cellClassName:E,duplicateRow:L,onChange:h,onActiveCellChange:j,onSelectionChange:g})})}try{wn.displayName="DataGrid",wn.__docgenInfo={description:"Component that renders a data grid/spreadsheet using react-datasheet-grid.",displayName:"DataGrid",props:{gridRef:{defaultValue:null,description:"",name:"gridRef",required:!0,type:{name:"RefObject<DataSheetGridRef>"}},columnNames:{defaultValue:null,description:"",name:"columnNames",required:!0,type:{name:"string[]"}},columnOrder:{defaultValue:null,description:"",name:"columnOrder",required:!0,type:{name:"number[]"}},schemaPropertiesInfo:{defaultValue:null,description:"",name:"schemaPropertiesInfo",required:!0,type:{name:"SchemaPropertiesMap"}},rowValues:{defaultValue:null,description:"",name:"rowValues",required:!0,type:{name:"DataGridRow[]"}},entityIsView:{defaultValue:null,description:"",name:"entityIsView",required:!0,type:{name:"boolean"}},jsonSchema:{defaultValue:null,description:"",name:"jsonSchema",required:!0,type:{name:"JSONSchema7"}},lastSelection:{defaultValue:null,description:"",name:"lastSelection",required:!0,type:{name:"SelectionWithId"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(newValue: DataGridRow[], operations: Operation[]) => void"}},handleSelectionChange:{defaultValue:null,description:"",name:"handleSelectionChange",required:!0,type:{name:"(opts: { selection: SelectionWithId; }) => void"}},onSelectedRowChange:{defaultValue:null,description:"",name:"onSelectedRowChange",required:!1,type:{name:"(rowIndex: number, row: DataGridRow) => void"}}}}}catch{}export{wn as D,Oo as G,qo as p,Po as r};
