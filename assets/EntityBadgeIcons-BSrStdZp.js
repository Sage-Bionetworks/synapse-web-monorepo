import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{r as h}from"./index-Cu9bd8lq.js";import{u as G}from"./index-S6oMIluj.js";import{a6 as J}from"./useFiles-od6qlkTh.js";import{a as K,E as Y}from"./VerificationSubmission-DL9jxYsQ.js";import{e as $,u as Q,f as X,A as Z}from"./useEntity-BrWPjpkr.js";import"./RegularExpressions-CmcMRs19.js";import{K as ee}from"./SynapseConstants-D-PFMQZz.js";import"./OrientationBanner-BX0HvA84.js";import{u as ne,a as te}from"./SchemaDrivenAnnotationEditor-Gw83Al8d.js";import{V as ae}from"./ConfirmationDialog-BrUzGKhk.js";import{g as E,E as ie}from"./EntityModal-DK8Q5JhU.js";import{W as se}from"./WarningDialog-BwhlUdg1.js";import{T as i}from"./Tooltip-CQm22TSO.js";import{P as oe}from"./IconSvg-D7Q47tWe.js";import{L as le,C as re}from"./RequirementItem-DufJwpnZ.js";import{c as p}from"./createSvgIcon-BhV3a4Zr.js";const de=p([e.jsx("path",{d:"m4 18 2-2h14V4H4z",opacity:".3"},"0"),e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"},"1")],"ChatBubbleTwoTone"),ce=p([e.jsx("path",{d:"M13 4H6v16h12V9h-5zm3 14H8v-2h8zm0-6v2H8v-2z",opacity:".3"},"0"),e.jsx("path",{d:"M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5z"},"1")],"DescriptionTwoTone"),ue=p(e.jsx("path",{d:"M14.39 11 16 12.61V11zM17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.27-.77 2.37-1.87 2.84l1.4 1.4C21.05 15.36 22 13.79 22 12c0-2.76-2.24-5-5-5M2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4.01 1.41-1.41L3.41 2.86z"}),"LinkOffTwoTone"),me=p([e.jsx("path",{d:"M11 4H4v7l9 9.01L20 13zM6.5 8C5.67 8 5 7.33 5 6.5S5.67 5 6.5 5 8 5.67 8 6.5 7.33 8 6.5 8",opacity:".3"},"0"),e.jsx("path",{d:"M12.41 2.58C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42zM13 20.01 4 11V4h7v-.01l9 9z"},"1"),e.jsx("circle",{cx:"6.5",cy:"6.5",r:"1.5"},"2")],"LocalOfferTwoTone");function I(u){return u.benefactorAcl.resourceAccess.some(a=>ee.includes(a.principalId))}const H=u=>{var N;const{entityId:a,versionNumber:w,flexWrap:_="nowrap",justifyContent:A="flex-start",showIsPublicPrivate:j=!0,showHasLocalSharingSettings:C=!0,showHasAnnotations:B=!0,showHasWiki:D=!0,showHasDiscussionThread:M=!0,showUnlink:L=!0,onUnlink:U=()=>{},onUnlinkError:O=()=>{},canOpenModal:f}=u;let v;(t=>{t.NO_SCHEMA="",t.VALID="Valid",t.INVALID="Invalid",t.ANNOTATIONS_MISSING="Missing"})(v||(v={}));const{ref:z,inView:m}=G(),{data:g}=$(a,w,!0,{enabled:m}),s=g==null?void 0:g.annotations,{data:n}=Q(a,w,Z,{enabled:m}),[P,T]=h.useState(!1),[q,y]=h.useState(!1),[S,b]=h.useState(""),r=ae(K.JSONSCHEMA_VALIDATION_STATUS),{data:x}=ne(a,{enabled:r&&m,staleTime:60*1e3}),{data:d}=te(a,{enabled:r&&m&&!!x,staleTime:60*1e3}),c=10,o=s&&!J(s)?Object.keys(s).length:0;h.useEffect(()=>{r&&d&&(d.isValid?b("Valid"):b(o?"Invalid":"Missing"))},[d,r,o,s,"Valid","Invalid","Missing"]);const{mutate:F}=X({onSuccess:(t,l)=>{U(l)},onError:O}),k=e.jsx(e.Fragment,{children:s?Object.entries(s??[]).reduce((t,l,V)=>V<c||V===c&&c===o?e.jsxs(e.Fragment,{children:[t,e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("b",{children:l[0]})}),e.jsx("td",{children:Array.isArray(l[1])?l[1].map(E).join(", "):E(l[1])})]})]}):t,e.jsx(e.Fragment,{})):""}),W=e.jsx(e.Fragment,{children:r&&x?e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("b",{children:"Validation Schema"})}),e.jsx("td",{children:x.jsonSchemaVersionInfo.schemaName})]}):""}),R=e.jsxs("div",{className:"EntityBadgeTooltip",children:[d?e.jsxs("p",{children:[S," Annotations"]}):"",e.jsxs("table",{children:[k||"",W]}),o>c?e.jsxs("p",{children:["and ",o-c," more"]}):""]});return e.jsx("div",{className:"EntityBadge",ref:z,style:{flexWrap:_,justifyContent:A},children:n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:t=>t.stopPropagation(),children:e.jsx(ie,{entityId:a,show:P,showTabs:!1,onClose:()=>T(!1),initialTab:"ANNOTATIONS"})}),j&&n.benefactorAcl&&I(n)?e.jsx(i,{title:"Public",enterNextDelay:100,placement:"right",children:e.jsx(oe,{"aria-hidden":!1,role:"img",className:"EntityBadge__Badge","data-testid":"is-public-icon"})}):null,j&&n.benefactorAcl&&!I(n)?e.jsx(i,{title:"Private",enterNextDelay:100,placement:"right",children:e.jsx(le,{"aria-hidden":!1,role:"img",className:"EntityBadge__Badge","data-testid":"is-private-icon"})}):null,C&&n.benefactorAcl&&a===n.benefactorAcl.id?e.jsx(i,{title:"Sharing Settings have been set",enterNextDelay:100,placement:"right",children:e.jsx(re,{"aria-hidden":!1,role:"img",className:"EntityBadge__Badge","data-testid":"sharing-settings-icon"})}):null,B&&!!(o||d)&&e.jsx(i,{title:R,enterNextDelay:100,placement:"right",children:e.jsx(me,{"aria-hidden":!1,role:f?"button":"img",className:`EntityBadge__Badge ${S}`,style:f?{cursor:"pointer"}:void 0,onClick:f?()=>T(!0):void 0,"data-html":!0,"data-testid":"annotations-icon"})}),D&&n.rootWikiId&&e.jsx(i,{title:"Has a wiki",enterNextDelay:100,placement:"right",children:e.jsx(ce,{"aria-hidden":!1,role:"img",className:"EntityBadge__Badge","data-testid":"wiki-icon"})}),M&&!!n.threadCount&&n.threadCount>0&&e.jsx(i,{title:"Has been mentioned in discussion",enterNextDelay:100,placement:"right",children:e.jsx(de,{"aria-hidden":!1,role:"img",className:"EntityBadge__Badge","data-testid":"discussion-icon"})}),L&&n.entityType===Y.LINK&&((N=n.permissions)==null?void 0:N.canDelete)&&e.jsxs(e.Fragment,{children:[e.jsx(se,{open:q,title:"Confirm Unlink",content:"Are you sure you want to remove this link? The original object will not be changed.",confirmButtonText:"Unlink",confirmButtonColor:"error",onConfirm:()=>{F(a),y(!1)},onCancel:()=>{y(!1)}}),e.jsx(i,{title:"Remove this link",enterNextDelay:100,placement:"right",children:e.jsx(ue,{"aria-hidden":!1,role:"button",onClick:()=>y(!0),className:"EntityBadge__Badge Unlink","data-testid":"unlink-icon"})})]})]})})};try{H.displayName="EntityBadgeIcons",H.__docgenInfo={description:`Stateless component used to show icons that show an entity's status.
Adapted from https://github.com/Sage-Bionetworks/SynapseWebClient/blob/46b9b717636cda2421926d96365244bbb72a05b6/src/main/java/org/sagebionetworks/web/client/widget/entity/EntityBadge.java`,displayName:"EntityBadgeIcons",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},flexWrap:{defaultValue:null,description:"",name:"flexWrap",required:!1,type:{name:"enum",value:[{value:'"wrap"'},{value:'"inherit"'},{value:'"initial"'},{value:'"nowrap"'},{value:'"-moz-initial"'},{value:'"revert"'},{value:'"unset"'},{value:'"wrap-reverse"'}]}},justifyContent:{defaultValue:null,description:"",name:"justifyContent",required:!1,type:{name:"string"}},showIsPublicPrivate:{defaultValue:null,description:"Shows an icon indicating if the entity is 'public' or 'private'. Default true",name:"showIsPublicPrivate",required:!1,type:{name:"boolean"}},showHasLocalSharingSettings:{defaultValue:null,description:"Shows an icon if the entity has sharing settings set on itself. Default true",name:"showHasLocalSharingSettings",required:!1,type:{name:"boolean"}},showHasAnnotations:{defaultValue:null,description:"Shows an icon if the entity has annotations, or if it has a validation schema (in experimental mode only). Default true",name:"showHasAnnotations",required:!1,type:{name:"boolean"}},showHasWiki:{defaultValue:null,description:"Shows an icon if the entity a wiki. Default true",name:"showHasWiki",required:!1,type:{name:"boolean"}},showHasDiscussionThread:{defaultValue:null,description:"Shows an icon if the entity has been mentioned in discussion threads. Default true",name:"showHasDiscussionThread",required:!1,type:{name:"boolean"}},showUnlink:{defaultValue:null,description:"",name:"showUnlink",required:!1,type:{name:"boolean"}},onUnlink:{defaultValue:null,description:"",name:"onUnlink",required:!1,type:{name:"((entityId: string) => void)"}},onUnlinkError:{defaultValue:null,description:"",name:"onUnlinkError",required:!1,type:{name:"((error: unknown) => void)"}},canOpenModal:{defaultValue:null,description:"Whether or not the badges (e.g. Annotations) can trigger opening a modal on click",name:"canOpenModal",required:!0,type:{name:"boolean"}},renderTooltipComponent:{defaultValue:null,description:"Whether this component should render a ReactTooltip or if an external component is managing it",name:"renderTooltipComponent",required:!0,type:{name:"boolean"}}}}}catch{}export{H as E};
