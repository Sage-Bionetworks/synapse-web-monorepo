import{r as P}from"./index-Dl6G-zuu.js";import{u as I}from"./useQueries-CrJ5bZfl.js";import{u as f}from"./useQuery-6SsvXKRa.js";import{bf as w,bg as L,bh as h,l as a,S as o,bi as G}from"./useFiles-HQFjeZWk.js";import{u as m}from"./utils-Bx1BRerw.js";import{u as E}from"./useMutation-DjwfMZ6R.js";import{u as B}from"./useInfiniteQuery-UCIrcrtH.js";import"./VerificationSubmission-CjmU3lv6.js";import{x as A}from"./StringUtils-CkZesiyJ.js";import{a as q}from"./isArray-ggc3KxVp.js";import{i as T}from"./_baseTimes-36S_kd0L.js";import{i as Q,o as K}from"./omitBy-CRJy37mM.js";import"./OrientationBanner-D9CLn5zV.js";import{i as F}from"./QueryFilterUtils-w0-jlmHD.js";import{g as p}from"./InfiniteQueryUtils-CKlRW-xB.js";import"./jsx-runtime-Du8NFWEI.js";import{p as D,o as O}from"./pick-MH0ObWih.js";const k={includeEntity:!0,includeEntityPath:!0,includeAnnotations:!0,includePermissions:!0,includeHasChildren:!0,includeAccessControlList:!0,includeFileHandles:!0,includeTableBundle:!0,includeRootWikiId:!0,includeBenefactorACL:!0,includeDOIAssociation:!0,includeFileName:!0,includeThreadCount:!0,includeRestrictionInformation:!0},M=(e,n)=>{if(!(q(e)||q(n))&&!(!T(e)||!T(n))&&!(!Q(e,void 0)&&!Q(n,void 0)))return w(K(e,s=>s===void 0),K(n,s=>s===void 0),M)};function v(e,n){return w(e,n,M)}function J(e,n){const s=new Set;for(const u of e)s.add(u.id);for(const u of n)if(u.id!=null&&!s.has(u.id))throw new Error(`Proposed schema contains a new column model with ID ${u.id} that is not in the old schema.`)}async function U(e,n,s,u){J(s,u);const t=new Map;for(const l of s)t.set(l.id,l);const c=[];for(const l of u){const y={...l};if(y.id!=null){const g=t.get(y.id);g!=null&&!v(g,y)&&delete y.id}c.push(y)}const r=(await L(e,c)).list,i=[],d=new Set;for(let l=0;l<u.length;l++){const y=u[l].id??null,g=r[l].id;y!=null&&d.add(y),d.add(g),y!=null&&y!==g?i.push({oldColumnId:y,newColumnId:g}):y==null&&i.push({oldColumnId:null,newColumnId:g})}for(const l of s){const y=l.id;d.has(y)||i.push({oldColumnId:y,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:n,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:n,changes:i,orderedColumnIds:r.map(l=>l.id)}]}}function C(e,n,s=k){const{accessToken:u,keyFactory:t}=a();return{queryKey:t.getEntityBundleQueryKey(e,n,s),queryFn:()=>o.getEntityBundleV2(e,s,n,u)}}function ae(e,n,s=k,u){const t=C(e,n,s);return f({...u,...t})}function oe(e,n,s=k,u){const t=C(e,n,s);return h({...u,...t})}function V(){const{keyFactory:e,accessToken:n}=a();return(s,u)=>({queryKey:e.getEntityVersionQueryKey(s,u),queryFn:()=>o.getEntity(n,s,u==null?void 0:u.toString())})}function ie(e,n,s){const u=V();return f({...s,...u(e,n)})}function ye(e,n){const{accessToken:s,keyFactory:u}=a(),t=P.useMemo(()=>({queries:e.map(c=>({queryKey:u.getEntityVersionQueryKey(c.id,c.versionNumber),queryFn:()=>o.getEntity(s,c.id,c.versionNumber),options:n}))}),[s,e,u,n]);return I(t)}function le(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({mutationFn:t=>o.createEntity(t,s),onSuccess:async(t,c,r)=>{const i=u.getEntityQueryKey(t.id);n.setQueryData(i,t),n.setQueryData(u.getEntityLookupQueryKey({parentId:t.parentId,entityName:t.name}),t.id),await F(n,u,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function de(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.updateEntity(t,s),onSuccess:async(t,c,r)=>{const i=u.getEntityQueryKey(t.id);n.setQueryData(i,t),await F(n,u,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function fe(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.deleteEntity(s,t),onSuccess:async(t,c,r)=>{await F(n,u,c),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function me(e,n){const{accessToken:u,keyFactory:t}=a();return B({...n,queryKey:t.getEntityVersionsQueryKey(e),queryFn:async c=>await o.getEntityVersions(e,u,c.pageParam,200),initialPageParam:void 0,getNextPageParam:p})}function b(e){return D(e,A[e.concreteType])}function R(e){return O(e,A[e.concreteType])}function Ee(e,n,s,u){const{accessToken:t,keyFactory:c}=a();return f({...u,queryKey:c.getEntityJsonQueryKey(e,n,s),queryFn:()=>o.getEntityJson(e,n,s,t),select:r=>{const i=b(r),d=R(r);return{entity:r,entityMetadata:i,annotations:d}}})}function ge(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>{const c=t.id;return o.updateEntityJson(c,t,s)},onSuccess:async(t,c,r)=>{const i=t.id,d=u.getEntityJsonQueryKey(i,void 0,!1);n.setQueryData(d,t),await F(n,u,i,d),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function Fe(e,n){const{accessToken:s,keyFactory:u}=a();return f({...n,queryKey:u.getEntityPathQueryKey(e),queryFn:()=>o.getEntityPath(e,s)})}function ke(e,n){const{accessToken:s,keyFactory:u}=a();return f({...n,queryKey:u.getEntityPathQueryKey(e),queryFn:()=>o.getEntityACL(e,s)})}function Ce(e,n){const{accessToken:s,keyFactory:u}=a();return f({...n,queryKey:u.getEntityAliasQueryKey(e),queryFn:()=>o.getEntityAlias(e,s)})}function Se(e,n,s){const{accessToken:u,keyFactory:t}=a();return f({...s,queryKey:t.getEntityEvaluationsQueryKey(e),queryFn:()=>o.getAllEntityEvaluations(e,n,u)})}function qe(e,n){const{accessToken:s,keyFactory:u}=a();return f({...n,queryKey:u.getEntityPermissionsQueryKey(e),queryFn:()=>o.getEntityPermissions(e,s)})}const S=async(e,n,s,u)=>{const t=u.getEntityACLQueryKey(e);n&&s.setQueryData(t,n),await F(s,u,e,t)};function Te(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.createEntityACL(t,s),onSuccess:async(t,c,r)=>{await S(t.id,t,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function Qe(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.updateEntityACL(t,s),onSuccess:async(t,c,r)=>{await S(t.id,t,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function Ke(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.deleteEntityACL(t,s),onSuccess:async(t,c,r)=>{await S(c,null,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function x(e){return{...C(e,void 0,{includeBenefactorACL:!0}),select:s=>s.benefactorAcl}}function we(e,n){const s=x(e);return h({...n,...s})}function he(e){const n=m(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:async t=>{const c=await U(s,t.entityId,t.originalColumnModels,t.newColumnModels);return o.updateTable(c,s)},onSuccess:async(t,c,r)=>{await F(n,u,c.entityId),e!=null&&e.onSuccess&&await e.onSuccess(t,c,r)}})}function Ae(){const{keyFactory:e,synapseClient:n}=a();return s=>({queryKey:e.getEntityLookupQueryKey(s),queryFn:async()=>{var u;return((u=await G(()=>n.entityServicesClient.postRepoV1EntityChild({entityLookupRequest:s})))==null?void 0:u.id)??null}})}export{k as A,ie as a,de as b,he as c,Ee as d,fe as e,ye as f,Se as g,Qe as h,Ce as i,ke as j,qe as k,le as l,me as m,Fe as n,ge as o,Ae as p,V as q,oe as r,we as s,Te as t,ae as u,Ke as v};
