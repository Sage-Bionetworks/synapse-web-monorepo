import{r as C,f3 as P,j as e,ax as V,a0 as U,X as u,bp as F,e5 as W,bW as G,av as Y,c5 as Q,aq as X,Y as D}from"./iframe-DkJtXMGY.js";import{S as z}from"./immutable.es-BJjDfH8f.js";import{C as J}from"./ConfirmationDialog-DYXCYbxt.js";import{F as K}from"./FormControlLabel-BtRUWfK0.js";import{C as $}from"./Checkbox-1S1SsZEO.js";const N="category",H="category email prompt",Z="rejection reason",ee="email text";function te(l){const{category:m,rows:d,selectedRowIds:i,setSelectedRowIds:p,rejectionReasonFormTextIndex:s,initialIsExpanded:y=!1}=l,[c,g]=C.useState(y);return e.jsxs(e.Fragment,{children:[e.jsxs(u,{variant:"body1",onClick:()=>g(!c),sx:{fontWeight:700,cursor:"pointer",my:1},children:[e.jsx(X,{icon:c?"expandMore":"chevronRight",sx:{color:"grey.700"},wrap:!1}),m]}),e.jsx(D,{in:c,children:e.jsx(F,{sx:{ml:3},children:(d??[]).map(a=>e.jsx(K,{control:e.jsx($,{checked:i.has(a.rowId),size:"small",onChange:n=>{n.target.checked?p(i.add(a.rowId)):p(i.remove(a.rowId))}}),label:e.jsx(u,{variant:"smallText1",children:a.values[s]})},a.rowId))})})]})}function ne(l){var j,R;const{tableQuery:m,selectedRowIds:d,setSelectedRowIds:i,rejectionFormPromptCopy:p}=l,{data:s,isLoading:y,error:c}=m,g=(j=s==null?void 0:s.queryResult)==null?void 0:j.queryResults.headers.findIndex(r=>r.name.toLowerCase()===N),a=(R=s==null?void 0:s.queryResult)==null?void 0:R.queryResults.headers.findIndex(r=>r.name.toLowerCase()===Z),n=s&&s.queryResult&&s.queryResult.queryResults.rows.reduce((r,x)=>{const E=x.values[g];return r[E]=[...r[E]||[],x],r},{});return e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"headline3",gutterBottom:!0,children:"Reasons for rejecting"}),p&&e.jsx(u,{variant:"body1",gutterBottom:!0,children:p}),y&&e.jsx(F,{sx:{my:2},children:e.jsx(W,{size:30})}),c&&e.jsx(G,{error:c}),n&&e.jsx(Y,{children:Object.keys(n).map(r=>e.jsx(te,{category:r,rows:n[r],selectedRowIds:d,setSelectedRowIds:i,rejectionReasonFormTextIndex:a,initialIsExpanded:Object.keys(n).length===1},r))}),e.jsx(u,{variant:"headline3",sx:{mt:1},gutterBottom:!0,children:"We’ll generate a response email message based on your selections."}),e.jsx(u,{variant:"body1",gutterBottom:!0,children:"If your reasons for rejecting are not shown here, that’s okay! You can edit the complete text of the message on the next screen before sending it."})]})}function re(l){const{emailText:m,setEmailText:d}=l;return e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"headline3",gutterBottom:!0,children:"Edit the text of the rejection message"}),e.jsx(u,{variant:"body1",gutterBottom:!0,children:"This message will be sent to the requester. You may edit it, or add custom text to the message."}),e.jsx(Q,{multiline:!0,fullWidth:!0,rows:15,value:m,onChange:i=>{d(i.target.value)}})]})}function S(l){var b,M,v;const{open:m,tableId:d,onClose:i,onConfirm:p,defaultMessagePrefix:s="",defaultMessageAppend:y="",rejectionFormPromptCopy:c,children:g,error:a}=l,[n,j]=C.useState(1),[R,r]=C.useState(""),[x,E]=C.useState(z()),q=P({entityId:d,query:{sql:`SELECT * FROM ${d}`},partMask:U,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o}=q,A=(b=o==null?void 0:o.queryResult)==null?void 0:b.queryResults.headers.findIndex(t=>t.name.toLowerCase()===N),L=(M=o==null?void 0:o.queryResult)==null?void 0:M.queryResults.headers.findIndex(t=>t.name.toLowerCase()===H),O=(v=o==null?void 0:o.queryResult)==null?void 0:v.queryResults.headers.findIndex(t=>t.name.toLowerCase()===ee),I=o&&o.queryResult&&x.reduce((t,T)=>{const h=o.queryResult.queryResults.rows.find(k=>k.rowId===T),f=h.values[A],B=h.values[L],w=h.values[O];return t[f]?t[f].reasons=[...t[f].reasons,w]:t[f]={sectionText:B,reasons:[w]},t},{}),_=I&&s+Object.keys(I).reduce((t,T)=>{t+=`
`;const h=I[T].sectionText;h&&(t+=h+`
`);for(const f of I[T].reasons)f!=null&&(t+=`
* `+f.replaceAll("\\n",`
`)+`
`);return t},"")+y;return C.useEffect(()=>{_&&r(_)},[x]),e.jsx(J,{open:m,onCancel:()=>{n===1&&i(),n===2&&j(1)},maxWidth:"md",fullWidth:!0,title:"Reject Request?",content:e.jsxs(e.Fragment,{children:[n===1&&e.jsx(ne,{tableQuery:q,selectedRowIds:x,setSelectedRowIds:E,rejectionFormPromptCopy:c}),n===2&&e.jsxs(e.Fragment,{children:[e.jsx(re,{emailText:R,setEmailText:r}),g]}),a&&e.jsx(V,{variant:"danger",description:a.reason,isGlobal:!1})]}),onConfirm:()=>{n===1&&j(2),n===2&&p(R)},confirmButtonProps:{children:n===1?"Generate Email":"Reject and Notify Requester"},cancelButtonProps:{children:n===1?"Cancel":"Back"}})}try{S.displayName="CannedRejectionDialog",S.__docgenInfo={description:`Modal component presented to a data access submission reviewer when they decide to reject a request.
The modal contains a form for selecting rejection reasons and a text field for editing the rejection message.
After crafting a message, the user can reject the submission and send the message to the requester.`,displayName:"CannedRejectionDialog",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},tableId:{defaultValue:null,description:"",name:"tableId",required:!0,type:{name:"string"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"(message: string) => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},defaultMessagePrefix:{defaultValue:null,description:"Text injected into the beginning of the email template",name:"defaultMessagePrefix",required:!1,type:{name:"string"}},defaultMessageAppend:{defaultValue:null,description:"Text appended onto the end of the email template",name:"defaultMessageAppend",required:!1,type:{name:"string"}},rejectionFormPromptCopy:{defaultValue:null,description:"Text to display above the canned rejection reasons",name:"rejectionFormPromptCopy",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Error to display, in case one occurred in the callback to `onReject`",name:"error",required:!0,type:{name:"any"}},children:{defaultValue:null,description:"Optional children, can be used to extend the form as needed on step 2",name:"children",required:!1,type:{name:"ReactNode"}}}}}catch{}export{S as C};
