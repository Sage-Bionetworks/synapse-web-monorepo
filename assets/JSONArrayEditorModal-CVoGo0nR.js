var _=Object.defineProperty;var A=(r,e,a)=>e in r?_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a;var g=(r,e,a)=>A(r,typeof e!="symbol"?e+"":e,a);import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{r as i}from"./index-BrHPMy4K.js";import{C as N}from"./ConfirmationDialog-Bq1bkUGO.js";import{J as w,t as b}from"./JsonSchemaForm-CU5Rv1sU.js";import{T as D}from"./TextWidget-sz_z1ynu.js";import{p as P}from"./papaparse.min-D1KxGBLm.js";import{i as I}from"./_Uint8Array-C3Qj-RGn.js";import{B as x}from"./Box--Gvn6t5i.js";import{B as f}from"./Button-hgfOZiyo.js";import{C as J}from"./Collapse-Cj8gEvHg.js";import{T as O}from"./TextField-DnrY6rLe.js";import{A as q}from"./Alert-1njaMFSc.js";import{A as R}from"./AlertTitle-CNf8Z2JO.js";import{T as F}from"./Typography-C4cWgMpl.js";const M={jsonSchemaDefinition:{type:"string"}};class T extends Error{constructor(a){super("Error parsing CSV");g(this,"parseErrors");this.parseErrors=a}}function k(r=M){const{jsonSchemaDefinition:e}=r,a=i.useMemo(()=>I(e)&&e.type&&e.type==="string",[e]);return{parse:i.useCallback(l=>new Promise((s,u)=>{P.parse(l,{dynamicTyping:!a,complete:o=>{o.errors.length>0?u(new T(o.errors)):s(o.data.flat())}})}),[a])}}const E={type:"string"};function B(r=E){return{$schema:"http://json-schema.org/draft-07/schema#",type:"array",items:r}}function y(r){const{value:e=[],onChange:a,onSubmit:p,arrayItemDefinition:l=E,formRef:s}=r,[u,o]=i.useState(!1),[m,d]=i.useState(""),[c,h]=i.useState([]),V=i.useMemo(()=>B(l),[l]),{parse:S}=k({jsonSchemaDefinition:l}),j=i.useCallback(async()=>{if(m)try{const t=await S(m);a([...e,...t]),h([]),d(""),o(!1)}catch(t){if(t instanceof T)h(t.parseErrors);else throw t}},[a,m,e,S]);return n.jsxs(x,{className:"JsonSchemaFormContainer",sx:{".JsonSchemaForm .LabelContainer":{display:"none",visibility:"hidden"}},children:[n.jsx(w,{formRef:s,schema:V,noHtml5Validate:!0,uiSchema:{"ui:submitButtonOptions":{norender:!0}},formData:e,formContext:{allowRemovingLastItemInArray:!0},onChange:({formData:t})=>a(t),onSubmit:({formData:t})=>p(t),transformErrors:b,widgets:{TextWidget:D}}),n.jsx(f,{onClick:()=>o(!0),children:"Paste new values"}),n.jsxs(J,{sx:{mt:2},in:u,children:[n.jsx(O,{multiline:!0,rows:5,placeholder:"Place comma or tab delimited values here",value:m,onChange:t=>d(t.target.value),slotProps:{input:{inputProps:{"aria-label":"CSV or TSV to Append"}}}}),n.jsxs(x,{sx:{my:1,display:"flex",justifyContent:"flex-end"},children:[n.jsx(f,{onClick:()=>o(!1),children:"Cancel"}),n.jsx(f,{onClick:()=>{j()},children:"Add"})]}),c&&c.length>0&&n.jsxs(q,{severity:"error",sx:{my:2},children:[n.jsx(R,{children:"Parsing errors encountered:"}),n.jsx("ul",{children:c.map((t,v)=>n.jsxs(F,{component:"li",variant:"smallText1",sx:{lineHeight:1.5},children:[t.row?`At ${t.row}: `:"",t.message]},v))})]})]})]})}try{y.displayName="JSONArrayEditor",y.__docgenInfo={description:"",displayName:"JSONArrayEditor",props:{value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"T[]"}},arrayItemDefinition:{defaultValue:null,description:"",name:"arrayItemDefinition",required:!1,type:{name:"JSONSchema7Definition"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: T[]) => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(formData: T[]) => void"}},formRef:{defaultValue:null,description:"",name:"formRef",required:!1,type:{name:"Ref<Form<T, RJSFSchema, GenericObjectType>>"}}}}}catch{}function C(r){const{isShowingModal:e,onConfirm:a,onCancel:p,dialogTitle:l="Edit Values",value:s,...u}=r,o=i.useRef(null),[m,d]=i.useState(s??[]);return i.useEffect(()=>{s&&d(s)},[s]),n.jsx(N,{open:e,title:l,onCancel:p,maxWidth:"md",content:n.jsx(y,{formRef:o,value:m,onChange:c=>d(c),onSubmit:a,...u}),onConfirm:()=>{o.current.formElement.current.requestSubmit()}})}try{C.displayName="JSONArrayEditorModal",C.__docgenInfo={description:"",displayName:"JSONArrayEditorModal",props:{value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"T[]"}},arrayItemDefinition:{defaultValue:null,description:"",name:"arrayItemDefinition",required:!1,type:{name:"JSONSchema7Definition"}},dialogTitle:{defaultValue:null,description:"",name:"dialogTitle",required:!1,type:{name:"ReactNode"}},isShowingModal:{defaultValue:null,description:"",name:"isShowingModal",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"(value: T[]) => void"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}}}}}catch{}export{C as J};
