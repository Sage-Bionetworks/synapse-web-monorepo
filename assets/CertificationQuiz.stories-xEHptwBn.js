import{an as v,am as M,aH as O,aI as A,aa as T,as as B,hf as G,r as m,j as e,c4 as j,hZ as w,X as a,_ as C,dH as K,dG as $,B as I,V as b,by as _,c1 as Y,J as E}from"./iframe-BIEbu1W6.js";import{d as V,e as J}from"./useUserBundle-bL5uBmII.js";import{M as X}from"./MarkdownPopover-D4XSX2HP.js";import"./SkeletonButton-CYSUqy8V.js";import"./SkeletonInlineBlock-BPt0uiBn.js";import{S as Z}from"./SkeletonTable-xs4-qgjj.js";import{S as W}from"./SkeletonParagraph-C7NGLrAr.js";import{C as P}from"./CertificationAnswer-LgqbK7JC.js";import"./index-Chi_LkuB.js";import"./useSuspenseQuery-B21UYyAc.js";import"./LightTooltip-Cl8rvG15.js";import"./MarkdownSynapse-C6TGH7qQ.js";const ee="org.sagebionetworks.repo.model.quiz.MultichoiceResponse";function se(t="",r){const{accessToken:i,keyFactory:l}=v();return M({...r,queryKey:l.getPassingRecordQueryKey(t),queryFn:()=>T.getPassingRecord(t,i)})}function te(t){const r=O(),{accessToken:i,keyFactory:l}=v(),{data:f}=V();return A({...t,mutationFn:d=>T.postCertifiedUserTestResponse(i,d),onSuccess:async(d,p,x)=>{await Promise.all([r.invalidateQueries({queryKey:l.getPassingRecordQueryKey(f?.ownerId)}),r.invalidateQueries({queryKey:l.getUserBundleQueryKey("current",B)})]),t?.onSuccess&&await t.onSuccess(d,p,x)}})}function ne(){const{accessToken:t}=v(),r=G(),[i,l]=m.useState(),[f,d]=m.useState(!1),[p,x]=m.useState([]),{data:S}=J(B),h=S?.isCertified,k=S?.userId,{data:n,isLoading:q}=se(k,{enabled:k!==void 0}),R=m.useRef(null),N="https://help.synapse.org/docs/Getting-Started.2055471150.html",z=async()=>{try{l(await T.getCertifyQuiz(t))}catch(s){r(s)}},{mutate:U,isPending:F}=te({onSuccess:()=>{d(!1),window.scrollTo(0,0)},throwOnError:!0}),y=!h&&(n==null||f);if(m.useEffect(()=>{t&&z()},[t]),q||i==null)return e.jsx(re,{});const H=(s,o)=>{const u=[...p.filter(c=>c.questionIndex!==s),{questionIndex:s,answerIndex:[o],concreteType:ee}];x(u)},Q=()=>{R.current?.reset(),d(!0),x([]),z()},L=()=>{try{if(i&&i.questions.length===p.length){const s={quizId:i.id,questionResponses:p};U(s)}else E("Please answer all of the questions and try again.","warning")}catch(s){E(s.reason,"danger")}},D=s=>s?{content:e.jsx(e.Fragment,{children:"More info"}),closePopoverOnClick:!0,onClick:()=>window.open(s,"_blank"),color:"primary"}:void 0;return e.jsxs("div",{children:[n&&!y&&e.jsxs(e.Fragment,{children:[(n.revokedOn||n.passed)&&!h&&e.jsxs(j,{severity:"error",children:[!n.passed&&e.jsx(w,{children:"Certification Revoked"}),e.jsxs(a,{variant:"body1",sx:{marginTop:"5px"},children:["Your certification was revoked. To become certified, you must"," ",e.jsx(C,{href:"#",onClick:s=>{s.preventDefault(),Q()},children:"retake the quiz"}),"."]})]}),!n.passed&&!h&&e.jsxs(j,{severity:"error",children:[!n.passed&&e.jsx(w,{children:"Quiz Failed"}),e.jsxs(a,{variant:"body1",sx:{marginTop:"5px"},children:["Please review the results from the previous attempt, and"," ",e.jsx(C,{href:"#",onClick:s=>{s.preventDefault(),Q()},children:"retake the quiz"}),"."]})]}),n.passed&&h&&e.jsxs(j,{severity:"success",children:[e.jsx(w,{children:"Quiz Passed"}),e.jsx(a,{variant:"body1",sx:{marginTop:"5px"},children:`You passed the Synapse Certification Quiz on ${K($(n.passedOn))}`})]}),e.jsxs(a,{variant:"sectionTitle",sx:{marginTop:"20px",marginBottom:"20px"},children:["Score: ",n.score," / ",n.corrections?.length]})]}),e.jsxs("div",{className:"CertificationQuiz__container",children:[i&&y&&e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>window.open(N,"_blank"),className:"help-button",color:"primary",variant:"contained",children:e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(_,{className:"HelpButton",style:{marginRight:"4px",color:"white"}}),e.jsx(e.Fragment,{children:"Help"})]})}),e.jsx(a,{variant:"headline1",sx:{marginBottom:"25px"},children:"Certified User Quiz"}),e.jsx(a,{variant:"body1",sx:{marginBottom:"15px"},children:"Certified users are authorized to use the full Synapse functionality. In order to ensure that users who create content in the system and/or wish to interact more freely within Synapse are familiar with the governance process and Synapse operating procedures when dealing with possibly sensitive data, users must pass a short quiz (approximately 15 minutes) to become Synapse certified."}),e.jsx(a,{variant:"body1",sx:{marginBottom:"15px"},children:"Please answer the following questions to become certified."}),e.jsx("form",{ref:R,onSubmit:s=>s.preventDefault(),children:e.jsx("ol",{children:i?.questions.map(s=>{const o=s.helpText||s.docLink;return e.jsxs("li",{role:s.exclusive?"radiogroup":void 0,children:[e.jsx(a,{variant:"headline3",dangerouslySetInnerHTML:{__html:s.prompt},sx:{marginTop:"40px",marginBottom:"10px"}}),s.answers.map(u=>e.jsx(P,{question:s,answer:u,onClick:c=>H(s.questionIndex,Number(c.currentTarget.value))},`${s.questionIndex}-${u.answerIndex}`)),o&&e.jsx(X,{contentProps:{markdown:s.helpText},placement:"right",sx:{table:{textAlign:"center",th:{padding:"5px"}}},actionButton:D(s.docLink),showCloseButton:!0,children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginTop:"10px"},children:[e.jsx(_,{className:"HelpButton",style:{marginRight:"4px"}}),e.jsx(C,{children:"Need help answering this question?"})]})})]},s.questionIndex)})})}),e.jsx(I,{className:"help-button",color:"primary",variant:"contained",size:"large",disabled:F,onClick:()=>{L()},children:"Submit"})]}),!y&&n?.corrections&&e.jsx("ol",{children:n.corrections.map(s=>{const o=s.question,u=s.response;return e.jsxs("li",{children:[e.jsx(a,{variant:"headline3",dangerouslySetInnerHTML:{__html:o.prompt},className:s.isCorrect?"":"incorrectQuestion",sx:{marginTop:"40px",marginBottom:"10px"}}),o.answers.map(c=>e.jsx(P,{question:o,answer:c,disabled:!0,checked:u.answerIndex.includes(c.answerIndex)},`${o.questionIndex}-${c.answerIndex}`))]},o.questionIndex)})})]})]})}function re(){const t=[];for(let r=0;r<20;r++)t.push(e.jsx("li",{children:e.jsx(Z,{numCols:1,numRows:5})},r));return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(Y,{height:"80px",width:"460px"})}),e.jsx(W,{numRows:5}),e.jsx("div",{className:"CertificationQuiz__container",children:e.jsx("ol",{style:{marginTop:"20px"},children:t})})]})}const fe={title:"Synapse/CertificationQuiz",component:ne},g={};g.parameters={...g.parameters,docs:{...g.parameters?.docs,source:{originalSource:"{}",...g.parameters?.docs?.source}}};const ye=["CertificationQuizDemo"];export{g as CertificationQuizDemo,ye as __namedExportsOrder,fe as default};
