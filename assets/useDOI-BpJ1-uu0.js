import{l as a,aP as c}from"./useFiles-Dx4nqkrZ.js";import{d as u,S as l}from"./fetchWithExponentialTimeout-CXmnpl-T.js";import{u as y}from"./useQuery-DWcuFtFn.js";import{u as p}from"./utils-BSLg82VF.js";import{u as d}from"./useMutation-Bn2cJuV2.js";const C={ENTITY:"ENTITY"};async function b(o,r){var s;let t=125;const n=1e3;let e=await o();for(;"jobState"in e&&e.jobState==="PROCESSING";)await u(t),e=await o(),t=Math.min(t*2,n);if("jobState"in e&&e.jobState==="FAILED")throw console.error("Asynchronous job failed:",e.errorMessage,`
Details:
`,e.errorDetails),new l(400,e.errorMessage,`waitForAsyncResult - ${(s=e.requestBody)==null?void 0:s.concreteType}`);return e}function j(o,r){const{synapseClient:t,keyFactory:n}=a();return y({...r,queryKey:n.getDOIAssociationQueryKey(o),queryFn:()=>c(()=>t.doiServicesClient.getRepoV1DoiAssociation(o))})}function w(o,r){const{synapseClient:t,keyFactory:n}=a();return y({...r,queryKey:n.getDOIQueryKey(o),queryFn:()=>c(()=>t.doiServicesClient.getRepoV1Doi(o))})}function F(o){const r=p(),{synapseClient:t,keyFactory:n}=a();return d({...o,mutationFn:async e=>{const s=await t.doiServicesClient.postRepoV1DoiAsyncStart({doiRequest:e});return(await b(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:s.token}))).responseBody},onSuccess(...e){o!=null&&o.onSuccess&&o.onSuccess(...e);const s=e[1].doi;if(s){const i={id:s.objectId,type:s.objectType,portalId:s.portalId,version:s.objectVersion};r.invalidateQueries({queryKey:n.getDOIQueryKey(i)})}}})}export{C as D,w as a,F as b,j as u};
