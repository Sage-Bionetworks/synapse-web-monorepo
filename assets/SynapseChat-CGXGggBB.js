import{U as F,j as t,an as f,aI as D,aa as _,am as K,r as i,hZ as S,V as x,X as k,aF as z,B as te,dZ as se,Y as ne,c4 as $,dR as ae,c6 as oe,br as re,J as ce}from"./iframe-IkK4rSOB.js";import"./SkeletonButton-CzqxZow7.js";import"./SkeletonInlineBlock-CUWgPSJQ.js";import"./SkeletonTable-CHtYHCYt.js";import{S as ie}from"./SkeletonParagraph-Ckq6DzI_.js";import{D as le}from"./DropdownSelect-ClcZhswi.js";import{J as L}from"./index-browser-esm-k-o2Qe0C.js";import{M as Y}from"./MarkdownSynapse-DW-6eoVs.js";import{L as N}from"./ListItem-DkSWpsM8.js";import{L as ue}from"./ListItemText-Ie968Zjk.js";import{K as de}from"./KeyboardArrowDown-BliFxqdt.js";import{A as pe}from"./ArrowUpward-DQecsv_k.js";const xe=F(t.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),me=F([t.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),t.jsx("path",{d:"M8 15h8v2H8z"},"1"),t.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),t.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),t.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function he(e){const{accessToken:n}=f();return D({mutationFn:s=>_.createAgentSession(s,n),onSuccess:async(s,a,r)=>{e?.onSuccess&&await e.onSuccess(s,a,r)}})}function fe(e){const{accessToken:n}=f();return D({mutationFn:s=>_.updateAgentSession(s,n),onSuccess:async(s,a,r)=>{e?.onSuccess&&await e.onSuccess(s,a,r)},onError:async(s,a,r)=>{e?.onError&&await e.onError(s,a,r)}})}function ge(e,n){const{accessToken:s}=f();return D({mutationFn:a=>_.getAgentChatAsyncJobResults(a,s,n),onSuccess:(a,r,o)=>{e?.onSuccess&&a.responseBody&&e.onSuccess(a.responseBody,r,o)},onError:(a,r,o)=>{e?.onError&&e.onError(a,r,o)}})}function ye(e,n){const{accessToken:s,keyFactory:a}=f();return K({...n,queryKey:a.getChatAgentTraceKey(e),queryFn:()=>_.getChatAgentTraceEvents(e,s)})}function Se(e){const[n,s]=i.useState([]),[a,r]=i.useState(null),{mutate:o}=ge({onMutate:u=>{r(u.chatText)}},u=>{n.includes(u.jobId)||(r(null),s(()=>[...n,u.jobId]))}),c=i.useCallback(u=>{if(!e?.sessionId)throw new Error("No agent session available to send chat message.");o({chatText:u,sessionId:e.sessionId,enableTrace:!0})},[e?.sessionId,o]);return i.useMemo(()=>({sendChat:c,pendingMessage:a,chatJobIds:n}),[c,a,n])}const V=[{value:S.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:S.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:S.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function q({onChange:e,initAccessLevel:n}){const s=V.findIndex(c=>c.value==n),a=V.map(c=>c.label),[r,o]=i.useState(s);return t.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[t.jsx(k,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),t.jsx(le,{variant:"outlined",options:a,selectedIndex:r,setSelectedIndex:c=>{r!==c&&(o(c),e(V[c].value))}})]})}try{q.displayName="AccessLevelMenu",q.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function Ae(e){const n=[],s=JSON.parse(e.message);return L({path:"$.output.message.content[*]",json:s}).forEach(r=>{const o=L({path:"$.reasoningContent.reasoningText.text",json:r});o[0]&&n.push({reasoningText:o[0]});const c=L({path:"$.toolUse[name,input]",json:r});c.length>0&&n.push({toolName:c[0],toolInput:c[1]})}),n}function Te(e){return"reasoningText"in e?e.reasoningText:""}function E({userMessage:e,chatResponseText:n,chatErrorReason:s,chatResponseTrace:a,scrollIntoView:r=!1}){const o=z(),c=i.useRef(null),[u,g]=i.useState(!1);i.useEffect(()=>{r&&c.current&&c.current.scrollIntoView({behavior:"smooth"})},[c]);const A=!n&&!s,m=i.useMemo(()=>(a??[]).flatMap(d=>Ae(d))?.filter(d=>!!d),[a]),j=m.length>0,T=i.useMemo(()=>m.filter(d=>"reasoningText"in d).at(-1),[m]),p=T==null?"Thinking...":T.reasoningText,v=A?p:`${u?"Hide":"Show"} Trace`,h=i.useMemo(()=>{const b=new DOMParser().parseFromString(n??"","text/html");return b.querySelectorAll("tool_name").forEach(y=>y.remove()),b.body.textContent??""},[n]);return t.jsxs(t.Fragment,{children:[t.jsx(N,{ref:c,sx:{alignSelf:"flex-end",backgroundColor:o.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:t.jsx(ue,{primary:e})}),t.jsxs(N,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[t.jsx(x,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:t.jsx(me,{sx:{color:"secondary.main"}})}),t.jsxs(x,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%",overflow:"auto"},children:[t.jsxs(x,{component:"aside",sx:{".markdown":{fontStyle:"italic",borderLeft:`4px solid ${o.palette.grey[300]}`,marginLeft:"4px",paddingLeft:"8px",mt:1,mb:2}},children:[t.jsx(te,{variant:"outlined",size:"small",startIcon:A?t.jsx(se,{size:14}):u?t.jsx(de,{sx:{width:"14px"}}):t.jsx(xe,{sx:{width:"14px"}}),disabled:!j,onClick:()=>{g(d=>!d)},sx:{height:"20px",fontSize:"12px",fontWeight:600,mb:1,border:"none !important",color:"grey.700",justifyContent:"flex-start",whiteSpace:"nowrap",maxWidth:"325px",textTransform:"none",pl:0,".MuiButton-startIcon":{mr:.5}},children:t.jsx(x,{sx:{overflow:"hidden",textOverflow:"ellipsis"},children:v})}),a&&t.jsx(ne,{in:u,children:t.jsx(Y,{markdown:m.map(Te).filter(d=>d.trim().length>0).join("<br/><br/>")})})]}),h&&t.jsx(Y,{markdown:h})]})]}),s&&t.jsx($,{severity:"error",sx:{my:2},children:s})]})}try{E.displayName="SynapseChatInteraction",E.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},chatResponseTrace:{defaultValue:null,description:"",name:"chatResponseTrace",required:!1,type:{name:"TraceEvent[]"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function ve(e){const{synapseClient:n,keyFactory:s}=f(),[a,r]=i.useState(1e3),o=K({queryKey:s.getAsyncJobStatusQueryKey(e),refetchInterval:a,queryFn:()=>n.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:e})});return i.useEffect(()=>{(o.error||o.data&&o?.data.jobState!="PROCESSING")&&r(!1)},[o.data,o.data?.jobState,o.error]),o}function be(e,n){const[s,a]=i.useState([]),r=i.useCallback(u=>{a(g=>[...g,...u])},[]),o=s.at(s.length-1),{data:c}=ye({jobId:e,newerThanTimestamp:o?.timestamp},{enabled:n,refetchInterval:1e3,refetchIntervalInBackground:!0});return i.useEffect(()=>{c&&c.page.length>0&&(r(c.page),console.debug(c.page))},[r,c]),{traceEvents:s}}function P(e){const{chatJobId:n}=e,{data:s}=ve(n),a=s?.requestBody,r=s?.responseBody,o=s?.errorMessage,c=!!n&&(!s?.jobState||s.jobState=="PROCESSING"),{traceEvents:u}=be(n,c);return t.jsx(E,{userMessage:a?.chatText,chatResponseText:r?.responseText,chatResponseTrace:u,chatErrorReason:o})}try{P.displayName="SynapseChatMessage",P.__docgenInfo={description:"",displayName:"SynapseChatMessage",props:{chatJobId:{defaultValue:null,description:"",name:"chatJobId",required:!0,type:{name:"string"}}}}}catch{}function W({initialMessage:e,agentRegistrationId:n,chatbotName:s="SynapseChat",hideTitle:a=!1,textboxPositionOffset:r="0px",sessionContext:o,externalSession:c,setExternalSession:u,externalChatState:g,showAccessLevelMenu:A=!0}){const{accessToken:m}=f(),[j,T]=i.useState(),p=c??j,v=u??T,{mutate:h,error:d}=he({onSuccess:l=>v(l)}),{mutate:b}=fe({onSuccess:l=>v(l),onError:l=>ce(`Unable to update the agent session: ${l.message}`,"danger")}),B=z(),[y,G]=i.useState(o?S.WRITE_YOUR_PRIVATE_DATA:S.PUBLICLY_ACCESSIBLE),H=Se(p),Q=g??H,{pendingMessage:w,chatJobIds:Z,sendChat:R}=Q,[C,J]=i.useState(""),[O,X]=i.useState(!1);i.useEffect(()=>{h&&!p&&h({agentAccessLevel:y,agentRegistrationId:n,sessionContext:o})},[h,p,m,o,y,n]),i.useEffect(()=>{p&&e&&!O&&(R(e),X(!0))},[p,e,O,R]);const M=()=>{C.trim()&&(R(C.trim()),J(""))},I=!p||!C||!!w,ee=l=>{!I&&l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),M())},U=B.palette.secondary[300];return d?t.jsx($,{severity:"error",sx:{my:2},children:d.reason}):t.jsxs(x,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",height:"100%"},children:[!a&&t.jsx(k,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:s}),A&&t.jsx(q,{initAccessLevel:y,onChange:l=>{G(l),b({agentAccessLevel:l,sessionId:p.sessionId})}}),!p&&t.jsx(ie,{numRows:10}),p&&t.jsx(x,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:t.jsxs(ae,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[Z.map(l=>t.jsx(P,{chatJobId:l},l)),w&&t.jsx(E,{userMessage:w,chatResponseText:"",chatErrorReason:"",scrollIntoView:!0})]})}),t.jsx(x,{sx:{position:"sticky",bottom:r,backgroundColor:"white"},children:t.jsxs(x,{component:"form",sx:{pt:"8px",mt:"5px",pb:"10px",position:"sticky",borderTop:"1px solid",borderColor:"grey.400"},onSubmit:M,children:[t.jsx(oe,{fullWidth:!0,value:C,onChange:l=>J(l.target.value),onKeyDown:ee,placeholder:`Message ${s}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:t.jsx(re,{disabled:I,onClick:M,sx:{ml:"7px",mr:"-8px",color:U,borderStyle:"solid",borderWidth:I?"1px":"2px",borderColor:I?"gray":U},children:t.jsx(pe,{})})}}}),t.jsxs(k,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[s," can make mistakes."]})]})})]})}try{W.displayName="SynapseChat",W.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}},sessionContext:{defaultValue:null,description:"",name:"sessionContext",required:!1,type:{name:"GridAgentSessionContext"}},externalSession:{defaultValue:null,description:"",name:"externalSession",required:!1,type:{name:"AgentSession"}},setExternalSession:{defaultValue:null,description:"",name:"setExternalSession",required:!1,type:{name:"(s: AgentSession) => void"}},externalChatState:{defaultValue:null,description:"",name:"externalChatState",required:!1,type:{name:"ChatState"}},defaultAgentAccessLevel:{defaultValue:null,description:"",name:"defaultAgentAccessLevel",required:!1,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},showAccessLevelMenu:{defaultValue:{value:"true"},description:"",name:"showAccessLevelMenu",required:!1,type:{name:"boolean"}}}}}catch{}export{W as S,me as a,Se as u};
