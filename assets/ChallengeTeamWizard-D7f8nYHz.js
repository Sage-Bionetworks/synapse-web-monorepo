import{i5 as me,an as G,am as Z,aa as ee,U as pe,j as e,r as d,c9 as J,V as x,dZ as R,c4 as v,X as f,c6 as he,B as j,ag as ge,gL as Te,dH as fe,_ as xe,ct as Ie,cu as Ce,b$ as te,dG as ye,dX as be,dm as Se,bV as _e}from"./iframe-9zwml_ZL.js";import{u as je}from"./useGetEntityChallenge-DGR3jJ4g.js";import{d as ve,a as ae,e as ne,u as Ee}from"./useTeamMembers-BQJ0Xlkv.js";import{u as Me}from"./useGetUserTeams-BdmMaqUC.js";import{d as N}from"./useUserBundle-MekiU7Qn.js";import{D as Re}from"./DialogBase-Hity4xAw.js";import{C as Ne}from"./CreateChallengeTeam-CY0WFBwE.js";import{u as D}from"./useTeam-UfHKAnmX.js";import{U as qe}from"./UserBadge-roJgG6JX.js";import{U as we}from"./UserOrTeamBadge-CMALff2j.js";import{S as Ae}from"./Search-g_vHhGbY.js";import{B as K}from"./Box-DtDJ2EG1.js";import{R as Le}from"./Radio-6WjF00Am.js";import{D as Fe}from"./DataGrid-C0UWTpr1.js";const Oe=me();function Ue(t,r){const{accessToken:i,keyFactory:n}=G();return Z({...r,queryKey:n.getTeamListQueryKey(t.sort().join()),queryFn:()=>ee.getTeamList(t,i)})}function ke(t,r){const{accessToken:i,keyFactory:n}=G();return Z({...r,queryKey:n.getChallengeTeamListQueryKey(t),queryFn:()=>ee.getAllChallengeTeams(i,t)})}const Ve=pe([e.jsx("path",{d:"m20 8-8 5-8-5v10h16zm0-2H4l8 4.99z",opacity:".3"},"0"),e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2M20 6l-8 4.99L4 6zM4 8l8 5 8-5v10H4z"},"1")]),F=d.forwardRef(function(r,i){const{teamId:n,onRequestSubmitted:o=J}=r,[c,l]=d.useState(""),{data:a}=N(),{data:u,status:I,error:E}=D(n,{enabled:!!n}),{mutate:T}=ve({onSuccess:()=>{o()}}),M=C=>{const y=C.target.value;l(y)};return d.useImperativeHandle(i,()=>({submit(){a&&T({teamId:n,userId:a.ownerId,message:c,expiresOn:void 0})}}),[c,T,n,a]),I==="pending"?e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(R,{})}):I==="error"?e.jsx(v,{severity:"error",children:E.message}):e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e.jsx("strong",{children:u.name})," team."]}),e.jsx(x,{children:e.jsx(he,{label:"Your Message to Team Managers(s)",id:"membershipRequestMessage",value:c,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:M})})]})});try{F.displayName="MembershipRequestForm",F.__docgenInfo={description:"Component that provides a form that a user can use to create a MembershipRequest for a Team.\n\nTo submit the form, pass a ref and call the `submit` handle on the ref.",displayName:"MembershipRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onRequestSubmitted:{defaultValue:null,description:"",name:"onRequestSubmitted",required:!0,type:{name:"() => void"}}}}}catch{}function O(t){const{teamId:r,onSuccess:i=J,...n}=t,{data:o}=N(),{mutate:c,isPending:l}=ae({onSuccess:()=>{i()}}),a=!o||l,u=d.useCallback(()=>{o?.ownerId&&c({teamId:r,userId:o.ownerId})},[o?.ownerId,c,r]);return e.jsx(j,{variant:"contained",disabled:a,startIcon:l?e.jsx(R,{}):void 0,...n,onClick:u,children:"Accept Invitation"})}function U(t){const{teamId:r}=t,{data:i}=N(),{data:n,status:o,error:c}=ne(i?.ownerId,{enabled:!!i?.ownerId}),{data:l}=D(r,{enabled:!!r});if(o==="pending")return e.jsx(R,{});if(o==="error")return e.jsx(v,{severity:"error",children:c.message});const a=n.find(u=>u.teamId===r);return a==null?e.jsxs(v,{severity:"error",children:["No matching invitation for team ",l?l.name:`ID: ${r}`]}):e.jsxs(ge,{sx:{gap:2},children:[e.jsxs(f,{variant:"body1",children:[e.jsx(qe,{userId:a.createdBy})," has invited you to join"," ",e.jsx("span",{children:e.jsx(we,{principalId:r})}),a.message?" with the following message:":"."]}),a.message&&e.jsx(f,{variant:"body1",component:"blockquote",children:a.message}),e.jsx(f,{variant:"body1",children:"Do you want to accept this invitation?"})]})}try{O.displayName="AcceptMembershipInvitationButton",O.__docgenInfo={description:"",displayName:"AcceptMembershipInvitationButton",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}try{U.displayName="OpenMembershipInvitation",U.__docgenInfo={description:`For the current, authenticated user, displays the details of an open MembershipInvitation for the provided team ID.

This component requires
  1. The current user is logged-in
  2. The current user has an open invitation to join the teamId passed in via props

To prompt the user to accept the invitation, use the {@link AcceptMembershipInvitationButton} component.`,displayName:"OpenMembershipInvitation",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}}}}}catch{}const k=({createdNewTeam:t,teamId:r})=>{const{data:i,status:n,error:o}=D(r,{enabled:!!r});return r?n==="pending"?e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(R,{})}):n==="error"?e.jsx(v,{severity:"error",children:o.message}):e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",t?"created":"joined"," team"," ",e.jsx("b",{children:i.name})," and have been added to this challenge."]}),t&&e.jsx(x,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{k.displayName="RegistrationSuccessful",k.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}}}}}catch{}function V(t){const{value:r,rowCount:i,onChange:n}=t,o=i>5?"calc(100% - 8px)":"100%";return e.jsxs(K,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:o,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e.jsx(K,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e.jsx(Ae,{sx:{color:"#878E95"}})}),e.jsx(Te,{value:r,onChange:n,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})}try{V.displayName="ChallengeTeamSearch",V.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function B(t){const{challengeId:r,onSelectTeam:i,selectedTeamId:n}=t,{data:o,isLoading:c}=ke(r),{data:l}=N(),{data:a}=ne(l?.ownerId,{enabled:!!l?.ownerId}),[u,I]=d.useState(""),E=o?.map(s=>s.teamId)??[],{data:T,isLoading:M}=Ue(E,{enabled:!!E.length}),C=d.useMemo(()=>{const s=u.toLowerCase(),p=T?.list.filter(m=>m.canPublicJoin||m.canRequestMembership!==!1||a?.some(S=>S.teamId===m.id))??[];let q=p;return s.length&&(q=p.filter(m=>m.name.toLowerCase().includes(s)||m.description?.toLowerCase().includes(s))),q.map(m=>({...m,hasInvitation:!!a?.some(S=>S.teamId===m.id)}))},[a,u,T?.list]),y=c||M,b=d.useMemo(()=>[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:s})=>e.jsx(Le,{value:s.id,checked:String(s.id)===n,onClick:()=>{i(String(s.id))},inputProps:{"aria-label":`Select ${s.name}`}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:s})=>e.jsx(xe,{href:`${Ie(Ce.PORTAL_ENDPOINT)}/Team:${s.id}`,target:"_blank",underline:"hover",children:s.name})},{field:"hasInvitation",headerName:"",width:15,filterable:!1,hideable:!1,disableColumnMenu:!0,align:"center",renderCell:({value:s})=>s?e.jsx(te,{title:"You have been invited to join this team",children:e.jsx(Ve,{fontSize:"small",sx:{color:"grey.700"}})}):null},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({value:s})=>fe(ye(s),"MM/DD/YY")},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}],[i,n]);return e.jsxs(x,{sx:{height:220},children:[!y&&e.jsx(V,{value:u,onChange:s=>I(s.target.value),rowCount:C.length}),e.jsx(Fe,{initialState:{sorting:{sortModel:[{field:"hasInvitation",sort:"desc"}]}},loading:y,rows:C,columns:b,rowCount:5,hideFooter:!0,density:"compact",rowBufferPx:500,sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:s=>s.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]})}try{B.displayName="ChallengeTeamTable",B.__docgenInfo={description:`Table component that displays teams that
 1. are registered for the challenge specified by the challengeId prop
 2. the current user is able to join, create a request to join, or accept an invitation to join`,displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}const Be='To participate in a challenge, you need to create a new Team or join an existing one.   By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.   All team members will need a Synapse account so that they can login and accept the team invitation.',P=({challengeId:t,onCreateTeam:r,selectedTeamId:i,onSelectTeam:n})=>e.jsxs(Oe,{spacing:2,children:[e.jsx(f,{variant:"body1",sx:{lineHeight:"20px"},children:Be}),e.jsx(x,{sx:{height:270},children:e.jsx(B,{challengeId:t,selectedTeamId:i,onSelectTeam:n})}),e.jsx(x,{children:e.jsx(j,{color:"primary",variant:"contained",onClick:r,startIcon:e.jsx(be,{}),children:"Create New Team"})})]});try{P.displayName="SelectChallengeTeam",P.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}function Pe(t){switch(t){case"SELECT_YOUR_CHALLENGE_TEAM":return"Select Your Challenge Team";case"ACCEPT_INVITATION":return"Invitation to Join Team";case"JOIN_REQUEST_FORM":return"Request Team Membership";case"JOIN_REQUEST_SENT":return"Request Sent";case"CREATE_NEW_TEAM":return"Create Team";case"REGISTRATION_SUCCESSFUL":return"Registration Successful!"}}function X(t){const{projectId:r,isShowingModal:i=!1,onClose:n}=t,{isAuthenticated:o}=G(),[c,l]=d.useState("SELECT_YOUR_CHALLENGE_TEAM"),[a,u]=d.useState(),[I,E]=d.useState(!1),[T,M]=d.useState(!1),C=d.useRef(null),y=d.useRef(null),{data:b,isLoading:s}=N({enabled:o}),{data:p,isLoading:q}=je(r),{mutateAsync:m,isPending:S,error:re}=ae(),{data:H,error:se}=Me(p?.id,1,0,{enabled:!!(o&&p)}),A=H&&H.results.length>0,{data:h,isLoading:Y,error:ie}=Ee(a,String(b?.ownerId),{enabled:o&&!!a&&!!b}),Q=d.useCallback(async()=>{!a||!b||(await m({teamId:a,userId:b.ownerId}),l("REGISTRATION_SUCCESSFUL"))},[m,l,a,b]),oe=d.useCallback(()=>{M(!1),u(void 0),n()},[n]),le=s||q,_=d.useMemo(()=>{switch(c){case"SELECT_YOUR_CHALLENGE_TEAM":case"JOIN_REQUEST_SENT":case"REGISTRATION_SUCCESSFUL":return e.jsx(e.Fragment,{});default:return e.jsx(j,{variant:"outlined",onClick:()=>{l("SELECT_YOUR_CHALLENGE_TEAM"),u(void 0)},children:"Back"})}},[c]),L=d.useMemo(()=>e.jsx(j,{variant:"contained",onClick:()=>{n()},children:"Close"}),[n]),{actions:de=e.jsx(e.Fragment,{}),content:ce=e.jsx(e.Fragment,{})}=d.useMemo(()=>{if(!o)return{content:e.jsx(v,{severity:"error",children:e.jsx(Se,{})})};if(A)return{content:e.jsx(v,{severity:"error",children:e.jsx(f,{children:"You are already a member of a registered submission team for this Challenge."})})};switch(c){case"SELECT_YOUR_CHALLENGE_TEAM":{let g="Join Team",W=!1,w=J,$="";return h&&h.hasOpenInvitation?(g="View Invitation to Join Team",w=()=>{l("ACCEPT_INVITATION")}):h&&h.hasOpenRequest?(g="Join Request Pending",W=!0,$="You have already submitted a request to join this team."):h&&h.membershipApprovalRequired?(g="Request to Join Team",w=()=>{l("JOIN_REQUEST_FORM")}):h&&h.canJoin&&(g="Join Team",w=()=>{Q()}),{content:p&&!A&&e.jsx(P,{challengeId:p.id,onCreateTeam:()=>l("CREATE_NEW_TEAM"),selectedTeamId:a,onSelectTeam:ue=>u(ue)}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(te,{title:$,children:e.jsx("span",{children:e.jsx(j,{onClick:w,startIcon:S?e.jsx(R,{}):void 0,disabled:!a||Y||S||W,variant:"contained",children:g})})})]})}}case"ACCEPT_INVITATION":return{content:e.jsx(U,{teamId:a}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(O,{teamId:a,onSuccess:()=>{l("REGISTRATION_SUCCESSFUL")}})]})};case"JOIN_REQUEST_FORM":return{content:e.jsx(F,{ref:C,teamId:a,onRequestSubmitted:()=>{l("JOIN_REQUEST_SENT")}}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(j,{variant:"contained",onClick:()=>{C?.current?.submit()},children:"Send Request"})]})};case"JOIN_REQUEST_SENT":return{content:e.jsx(f,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."}),actions:e.jsxs(e.Fragment,{children:[_,L]})};case"REGISTRATION_SUCCESSFUL":return{content:e.jsx(k,{createdNewTeam:T,teamId:a}),actions:e.jsxs(e.Fragment,{children:[_,L]})};case"CREATE_NEW_TEAM":return{content:e.jsx(Ne,{ref:y,challengeId:p?.id,onCanSubmitChange:g=>E(g),onFinished:g=>{M(!0),u(g),l("REGISTRATION_SUCCESSFUL")}}),actions:e.jsxs(e.Fragment,{children:[_,e.jsx(j,{variant:"contained",disabled:!I,onClick:()=>{y?.current?.submit()},children:"Create Team"})]})}}},[o,A,c,a,_,L,T,h,p,S,Y,Q,I]),z=re?.message||ie?.message||se?.message;return e.jsx(Re,{onCancel:oe,open:i,actions:de,title:Pe(c),content:e.jsx(_e,{children:e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:le?e.jsx(R,{size:40}):e.jsxs(e.Fragment,{children:[ce,z&&e.jsx(v,{severity:"error",children:z})]})})})})}try{X.displayName="ChallengeTeamWizard",X.__docgenInfo={description:`The ChallengeTeamWizard is used to guide a user through the process of joining or creating a team for a challenge.

A required precondition is that the user is NOT on any registered submission team for the challenge.`,displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:null,description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{X as C};
