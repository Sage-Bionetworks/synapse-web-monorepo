import{r as h}from"./index-Dl6G-zuu.js";import{u as M}from"./useQueries-D5v9yrEi.js";import{b3 as P,r as f,l as r,m as o,k as A,n as g}from"./SynapseClient-BHsOBGLR.js";import{u as d}from"./useMutation-DIWUsof1.js";import{u as I}from"./useInfiniteQuery-Cx3gNQUJ.js";import"./OrientationBanner-D9iiRUAg.js";import{q as w}from"./EntityTypeUtils-D1CcfD2e.js";import"./getEndpoint-CjoHA800.js";import{i as Q}from"./isEqualWith-C3M3X9js.js";import{a as C}from"./isArray-ggc3KxVp.js";import{i as S}from"./_Map-CWVOAJuy.js";import{i as q,o as T,p as G,a as v}from"./pick-BlIfypZz.js";import"./jsx-runtime-Du8NFWEI.js";import{i as F}from"./QueryFilterUtils-BT4hsN6t.js";import{g as L}from"./InfiniteQueryUtils-CKlRW-xB.js";import{a as D}from"./useEntityBundle-DHJUvYtz.js";const K=(e,n)=>{if(!(C(e)||C(n))&&!(!S(e)||!S(n))&&!(!q(e,void 0)&&!q(n,void 0)))return Q(T(e,s=>s===void 0),T(n,s=>s===void 0),K)};function J(e,n){return Q(e,n,K)}function U(e,n){const s=new Set;for(const c of e)s.add(c.id);for(const c of n)if(c.id!=null&&!s.has(c.id))throw new Error(`Proposed schema contains a new column model with ID ${c.id} that is not in the old schema.`)}async function B(e,n,s,c){U(s,c);const t=new Map;for(const l of s)t.set(l.id,l);let a=[];for(const l of c){const y={...l};if(y.id!=null){const E=t.get(y.id);E!=null&&!J(E,y)&&delete y.id}a.push(y)}const u=(await P(e,a)).list,i=[],m=new Set;for(let l=0;l<c.length;l++){const y=c[l].id??null,E=u[l].id;y!=null&&m.add(y),m.add(E),y!=null&&y!==E?i.push({oldColumnId:y,newColumnId:E}):y==null&&i.push({oldColumnId:null,newColumnId:E})}for(const l of s){const y=l.id;m.has(y)||i.push({oldColumnId:y,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:n,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:n,changes:i,orderedColumnIds:u.map(l=>l.id)}]}}function se(e,n,s){const{accessToken:c,keyFactory:t}=r();return g({...s,queryKey:t.getEntityVersionQueryKey(e,n),queryFn:()=>o.getEntity(c,e,n==null?void 0:n.toString())})}function ce(e,n){const{accessToken:s,keyFactory:c}=r(),t=h.useMemo(()=>({queries:e.map(a=>({queryKey:c.getEntityVersionQueryKey(a.id,a.versionNumber),queryFn:()=>o.getEntity(s,a.id,a.versionNumber),options:n}))}),[s,e,c,n]);return M(t)}function ae(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({mutationFn:t=>o.createEntity(t,s),onSuccess:async(t,a,u)=>{const i=c.getEntityQueryKey(t.id);n.setQueryData(i,t),await F(n,c,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function ue(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>o.updateEntity(t,s),onSuccess:async(t,a,u)=>{const i=c.getEntityQueryKey(t.id);n.setQueryData(i,t),await F(n,c,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function re(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>o.deleteEntity(s,t),onSuccess:async(t,a,u)=>{await F(n,c,a),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function oe(e,n){const{accessToken:c,keyFactory:t}=r();return I({...n,queryKey:t.getEntityVersionsQueryKey(e),queryFn:async a=>await o.getEntityVersions(e,c,a.pageParam,200),initialPageParam:void 0,getNextPageParam:L})}function R(e){return G(e,w[e.concreteType])}function V(e){return v(e,w[e.concreteType])}function ie(e,n,s,c){const{accessToken:t,keyFactory:a}=r();return g({...c,queryKey:a.getEntityJsonQueryKey(e,n,s),queryFn:()=>o.getEntityJson(e,n,s,t),select:u=>{const i=R(u),m=V(u);return{entity:u,entityMetadata:i,annotations:m}}})}function ye(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>{const a=t.id;return o.updateEntityJson(a,t,s)},onSuccess:async(t,a,u)=>{const i=t.id,m=c.getEntityJsonQueryKey(i,void 0,!1);n.setQueryData(m,t),await F(n,c,i,m),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function le(e,n){const{accessToken:s,keyFactory:c}=r();return g({...n,queryKey:c.getEntityPathQueryKey(e),queryFn:()=>o.getEntityPath(e,s)})}function me(e,n){const{accessToken:s,keyFactory:c}=r();return g({...n,queryKey:c.getEntityPathQueryKey(e),queryFn:()=>o.getEntityACL(e,s)})}function fe(e,n){const{accessToken:s,keyFactory:c}=r();return g({...n,queryKey:c.getEntityAliasQueryKey(e),queryFn:()=>o.getEntityAlias(e,s)})}function de(e,n,s){const{accessToken:c,keyFactory:t}=r();return g({...s,queryKey:t.getEntityEvaluationsQueryKey(e),queryFn:()=>o.getAllEntityEvaluations(e,n,c)})}function Ee(e,n){const{accessToken:s,keyFactory:c}=r();return g({...n,queryKey:c.getEntityPermissionsQueryKey(e),queryFn:()=>o.getEntityPermissions(e,s)})}const k=async(e,n,s,c)=>{const t=c.getEntityACLQueryKey(e);n&&s.setQueryData(t,n),await F(s,c,e,t)};function ge(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>o.createEntityACL(t,s),onSuccess:async(t,a,u)=>{await k(t.id,t,n,c),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function Fe(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>o.updateEntityACL(t,s),onSuccess:async(t,a,u)=>{await k(t.id,t,n,c),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function ke(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:t=>o.deleteEntityACL(t,s),onSuccess:async(t,a,u)=>{await k(a,null,n,c),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}function x(e){return{...D(e,void 0,{includeBenefactorACL:!0}),select:s=>s.benefactorAcl}}function Ce(e,n){const s=x(e);return A({...n,...s})}function Se(e){const n=f(),{accessToken:s,keyFactory:c}=r();return d({...e,mutationFn:async t=>{const a=await B(s,t.entityId,t.originalColumnModels,t.newColumnModels);return o.updateTable(a,s)},onSuccess:async(t,a,u)=>{await F(n,c,a.entityId),e!=null&&e.onSuccess&&await e.onSuccess(t,a,u)}})}export{ue as a,Se as b,le as c,ie as d,ce as e,de as f,Fe as g,fe as h,me as i,Ee as j,ae as k,Ce as l,ge as m,ke as n,ye as o,re as p,oe as q,se as u};
