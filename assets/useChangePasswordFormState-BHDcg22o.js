import{aI as q,aa as j,cZ as N,i4 as V,r as t,i5 as U,j as a,X as y,i6 as W,i7 as v,i8 as Y,c4 as _}from"./iframe-BVXHJH4u.js";function B(r){return q({...r,mutationFn:d=>j.changePassword(d)})}const H="Two-factor authentication is required to change your password. Your password has not yet been changed.";function O(r){const d=N("/reset2FA"),g=V(d,"twoFAResetToken"),[C,S]=t.useState(""),[p,P]=t.useState(""),[o,R]=t.useState(),[n,i]=t.useState("VERIFICATION_CODE"),[I,f]=t.useState(!1),{mutate:c,isPending:h,error:k}=B({onSuccess:e=>{e?R(e):(f(!0),R(void 0),r?.onChangePasswordSuccess&&r.onChangePasswordSuccess())}}),b=t.useCallback((e,s,u)=>{S(s),P(u),c({username:e,currentPassword:s,newPassword:u,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithCurrentPassword"})},[c]),x=t.useCallback((e,s)=>{P(e),c({newPassword:e,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithToken",passwordChangeToken:s})},[c]),F=t.useCallback((e,s,u)=>{if(o){const E={newPassword:e,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithTwoFactorAuthToken",userId:o.userId,twoFaToken:o.twoFaToken,otpType:u,otpCode:s};c(E)}},[c,o]),l=!!o,{mutate:T,isSuccess:w,isPending:A}=U(),m=t.useCallback(e=>{if(o){const s={userId:o.userId,twoFaResetEndpoint:e,password:C};T(s)}},[C,T,o]),D=t.useCallback(()=>l?a.jsxs(a.Fragment,{children:[n==="VERIFICATION_CODE"&&a.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:W}),n==="RECOVERY_CODE"&&a.jsx(y,{variant:"body1",sx:{my:2},align:"center",children:v}),a.jsx(Y,{step:n,onClickUseTOTP:()=>{i("VERIFICATION_CODE")},onClickUseBackupCode:()=>{i("RECOVERY_CODE")},loginIsPending:h,onSubmit:(e,s)=>F(p,e,s),hideReset2FA:r?.hideReset2FA,onClickPromptReset2FA:()=>{i("DISABLE_2FA_PROMPT")},onClickReset2FA:()=>{m(g)},twoFactorAuthResetIsPending:A,twoFactorAuthResetIsSuccess:w}),(n==="RECOVERY_CODE"||n==="VERIFICATION_CODE")&&a.jsx(_,{severity:"info",sx:{my:2},children:H}),n==="DISABLE_2FA_PROMPT"&&w&&a.jsxs(_,{severity:"warning",sx:{my:2},children:[a.jsx("strong",{children:"Your password has not been changed."})," To disable two-factor authentication, you may be required to enter your current password after clicking the link sent to your email address."]})]}):a.jsx(a.Fragment,{}),[m,F,h,p,r?.hideReset2FA,n,l,A,w,g]);return{successfullyChangedPassword:I,isPending:h,error:k,promptForTwoFactorAuth:l,TwoFactorAuthPrompt:D,handleChangePasswordWithCurrentPassword:b,handleChangePasswordWithResetToken:x}}try{O.displayName="useChangePasswordFormState",O.__docgenInfo={description:"Hook that handles submitting a change password request and prompting the user for 2FA if necessary.",displayName:"useChangePasswordFormState",props:{hideReset2FA:{defaultValue:null,description:"",name:"hideReset2FA",required:!1,type:{name:"boolean"}},onChangePasswordSuccess:{defaultValue:null,description:"",name:"onChangePasswordSuccess",required:!1,type:{name:"() => void"}}}}}catch{}export{O as u};
