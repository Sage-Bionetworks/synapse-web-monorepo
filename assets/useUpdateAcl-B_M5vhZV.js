import{r}from"./index-Dl6G-zuu.js";import"./SynapseClient-CkXq5sDK.js";import"./OrientationBanner-D6e-DxhT.js";import"./EntityTypeUtils-B_e8UrIf.js";import"./getEndpoint-CjoHA800.js";import"./jsx-runtime-Du8NFWEI.js";import{b as h}from"./UserBadge-DTriS2Ie.js";import{b as E}from"./index-CcBaOCma.js";import{c as I,P as m}from"./SynapseConstants-C1tM-lWj.js";import{n as H}from"./noop-DX6rZLP_.js";function L(e,s){let i;(t=>{t[t.A_FIRST=-1]="A_FIRST",t[t.B_FIRST=1]="B_FIRST"})(i||(i={}));const a=e.resourceAccess.accessType.includes(E.CHANGE_PERMISSIONS),c=s.resourceAccess.accessType.includes(E.CHANGE_PERMISSIONS);return a&&!c?-1:!a&&c?1:e.resourceAccess.principalId===I&&s.resourceAccess.principalId!==I?-1:e.resourceAccess.principalId!==I&&s.resourceAccess.principalId===I?1:e.resourceAccess.principalId===m&&s.resourceAccess.principalId!==m?-1:e.resourceAccess.principalId!==m&&s.resourceAccess.principalId===m?1:e.userGroupHeader.userName.localeCompare(s.userGroupHeader.userName)}function P(e){const s=r.useMemo(()=>e.map(o=>o.principalId),[e]),{data:i,isLoading:a,error:c}=h(s.map(String),{enabled:s.length>0});return r.useEffect(()=>{c&&console.error("Error fetching user group headers: ",c)},[c]),{sortedResourceAccessList:r.useMemo(()=>{if(!i)return null;const o=e.map(n=>({resourceAccess:n,userGroupHeader:i.find(d=>String(d.ownerId)===String(n.principalId))}));return o.every(n=>!!n.userGroupHeader)?o.toSorted(L).map(n=>n.resourceAccess):(console.warn("Some ACL entries do not have a corresponding UserGroupHeader. The ResourceAccess list will not be sorted. Missing entries: ",o.filter(n=>!n.userGroupHeader)),null)},[e,i]),isLoading:a}}const T="User or team already has permissions.";function F(e={}){const{onChange:s=H,onError:i=H}=e,[a,c]=r.useState(!1),[t,o]=r.useState([]),[f,n]=r.useState(!1),{sortedResourceAccessList:d,isLoading:R}=P(t);r.useEffect(()=>{!a&&!R&&!f&&d!=null&&(o(d),n(!0))},[f,a,R,d]),r.useEffect(()=>{s(t)},[t]);const C=r.useCallback((u,l)=>{c(!0),u&&o(p=>{if(p.some(S=>S.principalId===u))i(T);else{const S={principalId:u,accessType:l};return[...p,S]}return p})},[i]),G=r.useCallback((u,l)=>{c(!0),o(p=>p.map(A=>A.principalId===u?{...A,accessType:l}:A))},[]),_=r.useCallback(u=>{c(!0),o(l=>l.filter(p=>p.principalId!==u))},[]),g=r.useCallback(()=>{c(!1)},[]);return{resourceAccessList:t,setResourceAccessList:o,addResourceAccessItem:C,updateResourceAccessItem:G,removeResourceAccessItem:_,resetDirtyState:g}}export{F as u};
