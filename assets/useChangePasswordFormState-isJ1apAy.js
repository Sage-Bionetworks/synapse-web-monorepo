import{j as s}from"./jsx-runtime-Du8NFWEI.js";import{r as t}from"./index-Dl6G-zuu.js";import{u as F}from"./useMutation-C_5c4ONT.js";import{p as O}from"./SynapseClient-D4M9LQNp.js";import"./OrientationBanner-BV5RFxzC.js";import"./getEndpoint-CjoHA800.js";import{T as _,R as y,O as I}from"./Constants-BnCIFKDi.js";import"./LastLoginInfo-BDN1JmKA.js";import"./StandaloneLoginForm-CoNxRFRp.js";import"./TwoFactorAuthSettingsPanel-DPQ6K82x.js";import"./TwoFactorEnrollmentForm-CivU0YO9.js";import"./TwoFactorBackupCodes-hrd2uCcl.js";import{T as l}from"./Typography-B88_J_TK.js";import{M as S}from"./Alert-HJYNNEvY.js";function k(a){return F({...a,mutationFn:i=>O.changePassword(i)})}function P(a){const[i,p]=t.useState(""),[n,m]=t.useState(),[u,g]=t.useState("VERIFICATION_CODE"),{mutate:r,isPending:d,error:T}=k({onSuccess:e=>{e?m(e):(m(void 0),a.onChangePasswordSuccess&&a.onChangePasswordSuccess())}}),E=t.useCallback((e,o,c)=>{p(c),r({username:e,currentPassword:o,newPassword:c,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithCurrentPassword"})},[r]),f=t.useCallback((e,o)=>{p(e),r({newPassword:e,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithToken",passwordChangeToken:o})},[r]),w=t.useCallback((e,o,c)=>{if(n){const C={newPassword:e,concreteType:"org.sagebionetworks.repo.model.auth.ChangePasswordWithTwoFactorAuthToken",userId:n.userId,twoFaToken:n.twoFaToken,otpType:c,otpCode:o};r(C)}},[r,n]),h=!!n,R=t.useCallback(()=>h?s.jsxs(s.Fragment,{children:[u==="VERIFICATION_CODE"&&s.jsx(l,{variant:"body1",sx:{my:2},align:"center",children:_}),u==="RECOVERY_CODE"&&s.jsx(l,{variant:"body1",sx:{my:2},align:"center",children:y}),s.jsx(I,{step:u,onClickUseTOTP:()=>{g("VERIFICATION_CODE")},onClickUseBackupCode:()=>{g("RECOVERY_CODE")},loginIsPending:d,onSubmit:(e,o)=>w(i,e,o),hideReset2FA:!0,twoFactorAuthResetIsPending:!1,twoFactorAuthResetIsSuccess:!1}),s.jsx(S,{severity:"info",sx:{my:2},children:"Two-factor authentication is required to change your password."})]}):s.jsx(s.Fragment,{}),[w,d,i,u,h]);return{isPending:d,error:T,promptForTwoFactorAuth:h,TwoFactorAuthPrompt:R,handleChangePasswordWithCurrentPassword:E,handleChangePasswordWithResetToken:f}}try{P.displayName="useChangePasswordFormState",P.__docgenInfo={description:"Hook that handles submitting a change password request and prompting the user for 2FA if necessary.",displayName:"useChangePasswordFormState",props:{onChangePasswordSuccess:{defaultValue:null,description:"",name:"onChangePasswordSuccess",required:!1,type:{name:"(() => void)"}}}}}catch{}export{P as u};
