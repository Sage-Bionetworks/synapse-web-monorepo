import{j as e}from"./jsx-runtime-BZeBjSIS.js";import{m as oe,bx as we}from"./useFiles-Dzh-xGba.js";import{O as te,q as X}from"./VerificationSubmission-DHPhgAH7.js";import{u as se,A as $e}from"./useEntityBundle-DNNSjMGV.js";import{f as Me}from"./StringUtils-Bj0SG9ce.js";import{S as Se}from"./SynapseConstants-DV83Gi-b.js";import{r as i}from"./index-CjoTohT0.js";import"./OrientationBanner-DELzGaI_.js";import{u as ke,a as Ie,F as W,b as _e}from"./ForumThreadEditor-CkqH7p3l.js";import{c as Ne,d as De,e as Ee}from"./useThread-CBZmViSE.js";import{a as Ae}from"./useSubscription-DP2JX7Hp.js";import{f as re}from"./DateFormatter-ifvW74Cv.js";import{d as ne}from"./dayjs.min-D6B11bIY.js";import{C as Le}from"./ConfirmationDialog-BA7yNn1-.js";import{I as v}from"./IconSvg-GC35QVjU.js";import{M as le}from"./MarkdownSynapse-CvB7Heat.js";import{W as Y}from"./WarningDialog-BArOBFnT.js";import{d as L}from"./ToastMessage-DEAa4r0P.js";import{U as ie}from"./UserBadge-Blb5QlZV.js";import{S as Oe}from"./SkeletonTable-C_uULwMl.js";import{B as N}from"./Box-DHzWNABX.js";import{S as ze}from"./SubscribersModal-DD9qq63F.js";import{a as Ge}from"./useForum-BKQ-aAw5.js";import{T as F}from"./Typography-DUG2FEmz.js";import{g as ae,b as de,_ as U,a as $,c as ce,h as P}from"./createTheme-bwx9K6ts.js";import{r as We,u as ue,s as pe,c as fe}from"./DefaultPropsProvider-DUfDTxF6.js";import{g as Pe}from"./getValidReactChildren-DGMbkgzp.js";import{B as Fe}from"./ButtonBase-BbwScQV5.js";import{a as G}from"./Skeleton-BcT1rE-U.js";import{T as K}from"./TextField-BazWD-a1.js";import{B as J}from"./Button-DMakyqZH.js";function Ye(o){return de("MuiToggleButton",o)}const D=ae("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),me=i.createContext({}),ge=i.createContext(void 0);function Ue(o,t){return t===void 0||o===void 0?!1:Array.isArray(t)?t.indexOf(o)>=0:o===t}const qe=["value"],He=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],Ve=o=>{const{classes:t,fullWidth:r,selected:a,disabled:g,size:h,color:x}=o,f={root:["root",a&&"selected",g&&"disabled",r&&"fullWidth",`size${P(h)}`,x]};return fe(f,Ye,t)},Xe=pe(Fe,{name:"MuiToggleButton",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[t.root,t[`size${P(r.size)}`]]}})(({theme:o,ownerState:t})=>{let r=t.color==="standard"?o.palette.text.primary:o.palette[t.color].main,a;return o.vars&&(r=t.color==="standard"?o.vars.palette.text.primary:o.vars.palette[t.color].main,a=t.color==="standard"?o.vars.palette.text.primaryChannel:o.vars.palette[t.color].mainChannel),$({},o.typography.button,{borderRadius:(o.vars||o).shape.borderRadius,padding:11,border:`1px solid ${(o.vars||o).palette.divider}`,color:(o.vars||o).palette.action.active},t.fullWidth&&{width:"100%"},{[`&.${D.disabled}`]:{color:(o.vars||o).palette.action.disabled,border:`1px solid ${(o.vars||o).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:o.vars?`rgba(${o.vars.palette.text.primaryChannel} / ${o.vars.palette.action.hoverOpacity})`:G(o.palette.text.primary,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${D.selected}`]:{color:r,backgroundColor:o.vars?`rgba(${a} / ${o.vars.palette.action.selectedOpacity})`:G(r,o.palette.action.selectedOpacity),"&:hover":{backgroundColor:o.vars?`rgba(${a} / calc(${o.vars.palette.action.selectedOpacity} + ${o.vars.palette.action.hoverOpacity}))`:G(r,o.palette.action.selectedOpacity+o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:o.vars?`rgba(${a} / ${o.vars.palette.action.selectedOpacity})`:G(r,o.palette.action.selectedOpacity)}}}},t.size==="small"&&{padding:7,fontSize:o.typography.pxToRem(13)},t.size==="large"&&{padding:15,fontSize:o.typography.pxToRem(15)})}),Q=i.forwardRef(function(t,r){const a=i.useContext(me),{value:g}=a,h=U(a,qe),x=i.useContext(ge),f=We($({},h,{selected:Ue(t.value,g)}),t),y=ue({props:f,name:"MuiToggleButton"}),{children:b,className:C,color:u="standard",disabled:R=!1,disableFocusRipple:d=!1,fullWidth:S=!1,onChange:m,onClick:p,selected:T,size:k="medium",value:M}=y,s=U(y,He),w=$({},y,{color:u,disabled:R,disableFocusRipple:d,fullWidth:S,size:k}),E=Ve(w),l=B=>{p&&(p(B,M),B.defaultPrevented)||m&&m(B,M)},c=x||"";return e.jsx(Xe,$({className:ce(h.className,E.root,C,c),disabled:R,focusRipple:!d,ref:r,onClick:l,onChange:m,value:M,ownerState:w,"aria-pressed":T},s,{children:b}))});function Ke(o){return de("MuiToggleButtonGroup",o)}const n=ae("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Je=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],Qe=o=>{const{classes:t,orientation:r,fullWidth:a,disabled:g}=o,h={root:["root",r==="vertical"&&"vertical",a&&"fullWidth"],grouped:["grouped",`grouped${P(r)}`,g&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return fe(h,Ke,t)},Ze=pe("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(o,t)=>{const{ownerState:r}=o;return[{[`& .${n.grouped}`]:t.grouped},{[`& .${n.grouped}`]:t[`grouped${P(r.orientation)}`]},{[`& .${n.firstButton}`]:t.firstButton},{[`& .${n.lastButton}`]:t.lastButton},{[`& .${n.middleButton}`]:t.middleButton},t.root,r.orientation==="vertical"&&t.vertical,r.fullWidth&&t.fullWidth]}})(({ownerState:o,theme:t})=>$({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius},o.orientation==="vertical"&&{flexDirection:"column"},o.fullWidth&&{width:"100%"},{[`& .${n.grouped}`]:$({},o.orientation==="horizontal"?{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderTop:0,marginTop:0}})},o.orientation==="horizontal"?{[`& .${n.firstButton},& .${n.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${n.firstButton},& .${n.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},o.orientation==="horizontal"?{[`& .${n.lastButton}.${D.disabled},& .${n.middleButton}.${D.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${n.lastButton}.${D.disabled},& .${n.middleButton}.${D.disabled}`]:{borderTop:"1px solid transparent"}})),eo=i.forwardRef(function(t,r){const a=ue({props:t,name:"MuiToggleButtonGroup"}),{children:g,className:h,color:x="standard",disabled:f=!1,exclusive:y=!1,fullWidth:b=!1,onChange:C,orientation:u="horizontal",size:R="medium",value:d}=a,S=U(a,Je),m=$({},a,{disabled:f,fullWidth:b,orientation:u,size:R}),p=Qe(m),T=i.useCallback((l,c)=>{if(!C)return;const B=d&&d.indexOf(c);let I;d&&B>=0?(I=d.slice(),I.splice(B,1)):I=d?d.concat(c):[c],C(l,I)},[C,d]),k=i.useCallback((l,c)=>{C&&C(l,d===c?null:c)},[C,d]),M=i.useMemo(()=>({className:p.grouped,onChange:y?k:T,value:d,size:R,fullWidth:b,color:x,disabled:f}),[p.grouped,y,k,T,d,R,b,x,f]),s=Pe(g),w=s.length,E=l=>{const c=l===0,B=l===w-1;return c&&B?"":c?p.firstButton:B?p.lastButton:p.middleButton};return e.jsx(Ze,$({role:"group",className:ce(p.root,h),ref:r,ownerState:m},S,{children:e.jsx(me.Provider,{value:M,children:s.map((l,c)=>e.jsx(ge.Provider,{value:E(c),children:l},c))})}))}),H="replyid",oo=o=>{const r=`${`${window.location.origin}${window.location.pathname}`}?${H}=${o}`;Me(r).then(()=>L("Reply link copied to clipboard","info"))};function q(o){const{reply:t,isReplyAuthorModerator:r=!1}=o,[a,g]=i.useState(!1),[h,x]=i.useState(!1),{data:f}=oe(),{data:y}=se(t.projectId),{data:b,isLoading:C}=ke(t),u=i.useRef(null),{mutate:R}=Ie({onSuccess:()=>{x(!1),L("A reply has been deleted.","info")}}),d=t.createdBy==(f==null?void 0:f.ownerId);return i.useEffect(()=>{const m=new URLSearchParams(window.location.search).get(H);let p;return m===t.id&&u.current&&(u.current.style.transition="background-color 1s ease",u.current.style.backgroundColor="#fbf4e0",u.current.style.borderColor="#f4dda3",p=setTimeout(()=>{u.current&&(u.current.style.backgroundColor="#f9f9f9",u.current.style.borderColor="#ccc")},2e3)),()=>{p&&clearTimeout(p)}},[t.id]),e.jsx("div",{className:"reply-container",id:`reply._${t.id}`,ref:u,role:"article",children:C?e.jsx(Oe,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(ie,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:r}),e.jsxs("div",{className:"message-body",children:[e.jsx(le,{markdown:b,objectType:te.REPLY}),e.jsxs("span",{children:["posted ",re(ne(t.createdOn),"M/D/YYYY"),t.isEdited?e.jsx("i",{children:" (Edited)"}):null]}),e.jsxs(N,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[e.jsx("button",{onClick:()=>oo(t.id),children:e.jsx(v,{icon:"link",label:"Copy link to this reply"})}),d&&e.jsx("button",{onClick:()=>g(!0),children:e.jsx(v,{icon:"edit",label:"Edit reply"})}),(y==null?void 0:y.permissions.canModerate)&&e.jsx("button",{onClick:()=>x(!0),children:e.jsx(v,{icon:"delete",label:"Delete reply"})})]})]})]}),e.jsx(W,{isReply:!0,initialText:b,onClose:()=>g(!1),id:t.id,isDialog:!0,openDialog:a}),e.jsx(Y,{open:h,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{x(!1)},onConfirm:()=>R({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{q.displayName="DiscussionReply",q.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const to="You are following this topic. Click to stop following.",so="You are not following this topic. Click to follow.",ro="You will need to sign in for access to that resource",Z="Write a reply...";function ee(o){const{threadId:t,limit:r}=o,a="16px",[g,h]=i.useState(!0),[x,f]=i.useState(!1),[y,b]=i.useState(!1),[C,u]=i.useState(!1),[R,d]=i.useState(!1),[S,m]=i.useState(!1),[p,T]=i.useState(!1),[k,M]=i.useState(!1),{threadData:s,threadBody:w,togglePin:E}=Ne(t),{data:l}=oe(),{data:c}=se((s==null?void 0:s.projectId)??"",void 0,$e,{enabled:!!s}),{subscription:B,toggleSubscribed:I,isLoading:he}=Ae(t,X.THREAD),{mutate:xe}=De({onSuccess:()=>{d(!1),L("A thread has been deleted.","info")}}),{mutate:ye}=Ee({onSuccess:()=>{T(!1),L("A thread has been restored.","info")}}),be=(s==null?void 0:s.createdBy)==(l==null?void 0:l.ownerId);function Ce(){if((l==null?void 0:l.userName)=="anonymous")m(!0);else try{I()}catch(j){L(j.reason,"danger")}}const{data:O,hasNextPage:Be,fetchNextPage:je}=_e(t,g,r),{data:_}=Ge((s==null?void 0:s.forumId)??""),ve=_==null?void 0:_.results.includes((s==null?void 0:s.createdBy)??""),[z,Re]=we(H),V=i.useMemo(()=>{const j=(O==null?void 0:O.pages.flatMap(A=>A.results))??[];return z?j.filter(A=>A.id===z):j},[O,z]),Te=()=>{Re(null)};return e.jsxs("div",{className:"DiscussionThread",role:"article",children:[s&&w?e.jsxs(e.Fragment,{children:[e.jsxs(N,{sx:{mb:2,textAlign:"right"},children:[e.jsx(F,{component:"span",sx:{mr:1},children:"Sort:"}),e.jsxs(eo,{color:"primary",exclusive:!0,value:g?"datePosted":"mostRecent",children:[e.jsx(Q,{value:"datePosted",onClick:()=>h(!0),children:"Date Posted"}),e.jsx(Q,{value:"mostRecent",onClick:()=>h(!1),children:"Most Recent"})]})]}),e.jsx(ie,{userId:s.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:ve}),e.jsxs(N,{sx:j=>({[j.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:a,marginTop:a,".SubscribersModal":{justifyContent:"flex-start",marginBottom:a}}}),children:[e.jsx(F,{sx:{marginTop:"4px"},variant:"headline2",children:s.title}),e.jsx(ze,{id:t,objectType:X.THREAD,showModal:k,handleModal:M})]}),e.jsx("div",{children:e.jsx(le,{markdown:w,objectType:te.THREAD})}),e.jsxs("span",{children:["posted ",re(ne(s.createdOn),"M/D/YYYY"),s.isEdited?e.jsx("i",{children:" (Edited)"}):null]}),e.jsx(W,{isReply:!1,initialText:w,onClose:()=>f(!1),initialTitle:s==null?void 0:s.title,id:t,isDialog:!0,openDialog:x})]}):e.jsx(e.Fragment,{}),e.jsx(N,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:s!=null&&s.isDeleted?e.jsx("button",{onClick:()=>T(!0),children:e.jsx(v,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":B?"Unfollow thread":"Follow thread",disabled:he,onClick:()=>Ce(),children:B?e.jsx(v,{icon:"visibility",label:to}):e.jsx(v,{icon:"visibilityOff",label:so})})}),be&&e.jsx("button",{onClick:()=>f(!0),children:e.jsx(v,{icon:"edit",label:"Edit thread"})}),c!=null&&c.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(!0),children:e.jsx(v,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>E(),children:s!=null&&s.isPinned?e.jsx(v,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(v,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(N,{sx:{mt:2,mb:3},children:y?e.jsx(W,{id:t,isReply:!0,onClose:()=>b(!1),isDialog:!1}):e.jsx(K,{fullWidth:!0,placeholder:Z,onClick:()=>{(l==null?void 0:l.userName)=="anonymous"?m(!0):b(!0)}})}),z&&e.jsxs(J,{variant:"outlined",onClick:Te,sx:{display:"flex",alignItems:"center",padding:"2px 8px",marginBottom:"12px",gap:"4px"},children:[e.jsx(v,{icon:"arrowBack",sx:{width:"16px"}}),e.jsx(F,{variant:"smallText2",children:"Show all replies"})]}),e.jsx("div",{children:V.map(j=>{const A=_==null?void 0:_.results.includes(j.createdBy);return e.jsx(q,{reply:j,isReplyAuthorModerator:A},j.id)})}),V.length>0&&e.jsx(N,{sx:j=>({mt:2,mb:3,[j.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:C?e.jsx(W,{id:t,isReply:!0,onClose:()=>u(!1),isDialog:!1}):e.jsx(K,{fullWidth:!0,placeholder:Z,onClick:()=>{(l==null?void 0:l.userName)=="anonymous"?m(!0):u(!0)}})}),Be?e.jsx(J,{variant:"outlined",onClick:()=>{je()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(Y,{open:R,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>d(!1),onConfirm:()=>s&&xe(s),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(Y,{open:p,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>s&&ye(s),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(Le,{open:S,title:"Sign In Required",content:ro,onCancel:()=>m(!1),hasCancelButton:!1,onConfirm:()=>m(!1),confirmButtonProps:{children:"Sign In",className:Se}})]})}try{ee.displayName="DiscussionThread",ee.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{ee as D};
