import{U as me,j as e,ao as S,aA as P,aa as C,an as fe,i0 as y,r,V as p,X as I,ax as se,b_ as te,dU as ge,e0 as he,c5 as ye,cm as Se,c0 as Ae,bl as ve,J as Ie}from"./iframe-BdkWYmI6.js";import"./SkeletonButton-DYpS-IT5.js";import"./SkeletonInlineBlock-B4ZEP19M.js";import"./SkeletonTable-BveBy0vn.js";import{S as Te}from"./SkeletonParagraph-CVsqmSli.js";import{D as Ce}from"./DropdownSelect-DWROMPQk.js";import{M as Ee}from"./MarkdownSynapse-Bv4Hlehq.js";import{L as Z}from"./ListItem-aRyaDNJW.js";import{L as be}from"./ListItemText-BaqSWbUA.js";import{A as Re}from"./ArrowUpward-CSkxDUNS.js";const _e=me([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function je(s){const{accessToken:c}=S();return P({mutationFn:n=>C.createAgentSession(n,c),onSuccess:async(n,a,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,a,o)}})}function Le(s){const{accessToken:c}=S();return P({mutationFn:n=>C.updateAgentSession(n,c),onSuccess:async(n,a,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,a,o)},onError:async(n,a,o)=>{s!=null&&s.onError&&await s.onError(n,a,o)}})}function Me(s,c){const{accessToken:n}=S();return P({mutationFn:a=>C.getAgentChatAsyncJobResults(a,n,c),onSuccess:(a,o,i)=>{s!=null&&s.onSuccess&&a.responseBody&&s.onSuccess(a.responseBody,o,i)},onError:(a,o,i)=>{s!=null&&s.onError&&s.onError(a,o,i)}})}function Ve(s,c){const{accessToken:n,keyFactory:a}=S();return fe({...c,queryKey:a.getChatAgentTraceKey(s),queryFn:()=>C.getChatAgentTraceEvents(s,n)})}const k=[{value:y.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:y.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:y.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function D({onChange:s,initAccessLevel:c}){const n=k.findIndex(l=>l.value==c),a=k.map(l=>l.label),[o,i]=r.useState(n);return e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[e.jsx(I,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),e.jsx(Ce,{variant:"outlined",options:a,selectedIndex:o,setSelectedIndex:l=>{o!==l&&(i(l),s(k[l].value))}})]})}try{D.displayName="AccessLevelMenu",D.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function T({userMessage:s,chatResponseText:c,chatErrorReason:n,scrollIntoView:a=!1}){const o=se(),i=r.useRef(null);r.useEffect(()=>{a&&i.current&&i.current.scrollIntoView({behavior:"smooth"})},[i]);const l=r.useMemo(()=>{const A=new DOMParser().parseFromString(c??"","text/html");return A.querySelectorAll("tool_name").forEach(E=>E.remove()),A.body.textContent??""},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{ref:i,sx:{alignSelf:"flex-end",backgroundColor:o.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(be,{primary:s})}),l&&e.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(p,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(_e,{sx:{color:"secondary.main"}})}),e.jsx(p,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"},children:e.jsx(Ee,{markdown:l})})]}),n&&e.jsx(te,{severity:"error",sx:{my:2},children:n})]})}try{T.displayName="SynapseChatInteraction",T.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function ee({initialMessage:s,agentRegistrationId:c,chatbotName:n="SynapseChat",hideTitle:a=!1,textboxPositionOffset:o="0px",sessionContext:i,externalSession:l,setExternalSession:q,externalInteractions:A,setExternalInteractions:U,showAccessLevelMenu:E=!0}){const{accessToken:ne}=S(),[ae,re]=r.useState(),u=l??ae,B=q??re,{mutate:b,error:Y}=je({onSuccess:t=>B(t)}),{mutate:oe}=Le({onSuccess:t=>B(t),onError:t=>Ie(`Unable to update the agent session: ${t.message}`,"danger")}),ce=se(),[O,ie]=r.useState(i?y.WRITE_YOUR_PRIVATE_DATA:y.PUBLICLY_ACCESSIBLE),[le,ue]=r.useState([]),W=A??le,de=U??ue,[d,R]=r.useState(),[_,F]=r.useState(),[j,N]=r.useState(""),[L,z]=r.useState(""),[f,K]=r.useState(""),[G,pe]=r.useState(!1),[x,H]=r.useState(),{mutate:M}=Me({onSuccess:t=>{N(t.responseText)},onError:t=>{z(t.reason)}},t=>{F(t.jobId)}),{data:m}=Ve({jobId:_,newerThanTimestamp:x==null?void 0:x.timestamp},{enabled:!!_,refetchInterval:_?1e3:!1,refetchIntervalInBackground:!0});r.useEffect(()=>{if(m&&m.page.length>0){const t=m.page[m.page.length-1],w=JSON.parse(t.message);let Q="";const X=g=>{for(const h in g)h==="text"&&typeof g[h]=="string"?Q+=g[h]+`
`:typeof g[h]=="object"&&X(g[h])};X(w),t.friendlyMessage=Q??"Thinking...",H(t),console.debug(m.page)}},[m]),r.useEffect(()=>{d&&(j||L)&&(d.chatResponseText=j,d.chatErrorReason=L,de([...W,d]),N(""),z(""),R(void 0),F(void 0),H(void 0))},[j,L,d]),r.useEffect(()=>{b&&!u&&b({agentAccessLevel:O,agentRegistrationId:c,sessionContext:i})},[b,u,ne,i]),r.useEffect(()=>{u&&s&&!G&&(R({userMessage:s}),M({chatText:s,sessionId:u.sessionId,enableTrace:!0}),pe(!0))},[u,s,G,M]);const V=()=>{f.trim()&&(R({userMessage:f}),K(""),M({chatText:f,sessionId:u.sessionId,enableTrace:!0}))},v=!u||!f||!!d,xe=t=>{!v&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),V())},J=ce.palette.secondary[300];if(Y)return e.jsx(te,{severity:"error",sx:{my:2},children:Y.reason});const $=(x==null?void 0:x.friendlyMessage)??"Thinking...";return e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",height:"100%"},children:[!a&&e.jsx(I,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:n}),E&&e.jsx(D,{initAccessLevel:O,onChange:t=>{ie(t),oe({agentAccessLevel:t,sessionId:u.sessionId})}}),!u&&e.jsx(Te,{numRows:10}),u&&e.jsx(p,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(ge,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[W.map((t,w)=>e.jsx(T,{userMessage:t.userMessage,chatResponseText:t.chatResponseText,chatErrorReason:t.chatErrorReason},w)),d&&e.jsxs(e.Fragment,{children:[e.jsx(T,{userMessage:d.userMessage,chatResponseText:d.chatResponseText,chatErrorReason:d.chatErrorReason,scrollIntoView:!0}),e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"5px"},children:[e.jsx(he,{size:40}),e.jsx(p,{sx:{position:"relative",pt:"130px"},children:e.jsx(ye,{children:e.jsx(Se,{timeout:500,children:e.jsx(I,{sx:{textAlign:"center",position:"absolute",width:"100%",top:0},variant:"body1Italic",children:$})},$)})})]})]})]})}),e.jsx(p,{sx:{position:"sticky",bottom:o,backgroundColor:"white"},children:e.jsxs(p,{component:"form",sx:{pt:"8px",mt:"5px",pb:"10px",position:"sticky",borderTop:"1px solid",borderColor:"grey.400"},onSubmit:V,children:[e.jsx(Ae,{fullWidth:!0,value:f,onChange:t=>K(t.target.value),onKeyDown:xe,placeholder:`Message ${n}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:e.jsx(ve,{disabled:v,onClick:V,sx:{ml:"7px",mr:"-8px",color:J,borderStyle:"solid",borderWidth:v?"1px":"2px",borderColor:v?"gray":J},children:e.jsx(Re,{})})}}}),e.jsxs(I,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[n," can make mistakes."]})]})})]})}try{ee.displayName="SynapseChat",ee.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}},sessionContext:{defaultValue:null,description:"",name:"sessionContext",required:!1,type:{name:"GridAgentSessionContext"}},externalSession:{defaultValue:null,description:"",name:"externalSession",required:!1,type:{name:"AgentSession"}},setExternalSession:{defaultValue:null,description:"",name:"setExternalSession",required:!1,type:{name:"(s: AgentSession) => void"}},externalInteractions:{defaultValue:null,description:"",name:"externalInteractions",required:!1,type:{name:"ChatInteraction[]"}},setExternalInteractions:{defaultValue:null,description:"",name:"setExternalInteractions",required:!1,type:{name:"(i: ChatInteraction[]) => void"}},defaultAgentAccessLevel:{defaultValue:null,description:"",name:"defaultAgentAccessLevel",required:!1,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},showAccessLevelMenu:{defaultValue:{value:"true"},description:"",name:"showAccessLevelMenu",required:!1,type:{name:"boolean"}}}}}catch{}export{ee as S,_e as a};
