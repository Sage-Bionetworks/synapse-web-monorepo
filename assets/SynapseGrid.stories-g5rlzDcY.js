var Cc=Object.defineProperty;var Ec=(i,u,_)=>u in i?Cc(i,u,{enumerable:!0,configurable:!0,writable:!0,value:_}):i[u]=_;var Qe=(i,u,_)=>Ec(i,typeof u!="symbol"?u+"":u,_);import{j as W}from"./jsx-runtime-D_zvdyIk.js";import{C as Nc}from"./ComplexJSONRenderer-DnIrpX5r.js";import{l as qt}from"./useFiles-CiH3RjAX.js";import"./VerificationSubmission-CNoSrCdk.js";import"./StringUtils-CwQ1lgbR.js";import"./OrientationBanner-C5RkxOxO.js";import{b as me,r as K}from"./index-Cwo7W8Q3.js";import{u as Ic}from"./useSchema-B8dcNKtB.js";import{i as Rc}from"./isEqual-BDen11ft.js";import{B as ds,P as jc}from"./enums-DGHU28N4.js";import{i as ar}from"./_Uint8Array-CmcRwmUk.js";import{a as gl,d as Re}from"./iframe-BtEoy5Pi.js";import{r as kc,a as wl}from"./isArray-CnKdinKf.js";import{g as Tc}from"./_baseIteratee-DBweqB1b.js";import{r as Bt,c as Ac}from"./index-Bn4nW4sP.js";import{t as Mc}from"./tslib.es6-Bipx4pcW.js";import{a as fs}from"./toInteger-D9StSSXw.js";import{r as Pc}from"./index-v-nvGdj1.js";import{r as yl}from"./index-C148XJoK.js";import{r as Dc}from"./index-BN3chRwR.js";import{F as qc}from"./FullWidthAlert-VQ26Wohr.js";import"./SkeletonButton--Z2pTtcK.js";import"./SkeletonInlineBlock-C2UkkSQu.js";import{S as Bc}from"./SkeletonTable-Ctka8zso.js";import"./SkeletonParagraph-BY8ebSZu.js";import{A as _l}from"./Autocomplete-fZ3QeMGU.js";import{T as qi}from"./TextField-Bs4K1nyU.js";import{u as lr}from"./useMutation-7jNvOIUs.js";import{w as Vc}from"./waitForAsyncResult-P7HUkBTt.js";import{u as Ol}from"./QueryClientProvider-Di2vdjqh.js";import{u as $c}from"./useInfiniteQuery-DQH3wWcK.js";import{n as Pt}from"./useQuery-BCuPd4te.js";import{d as Vr}from"./ToastMessage-DNMZhQNJ.js";import{G as Fe}from"./Grid-5puC-jM1.js";import{M as Lc}from"./MenuItem-CaKUvSRs.js";import{B as Sl}from"./Button-CEhhBQoQ.js";import"./ExpandCollapseButton-D8FVpYO0.js";import"./IconSvg-CZiCmQQr.js";import"./createSvgIcon-rlX8m3bd.js";import"./createTheme-B3oloupt.js";import"./DefaultPropsProvider-DpCpUutu.js";import"./spreadSx-CwcO6WA9.js";import"./useTheme-BplOPChe.js";import"./useTheme-QJ-q2rrh.js";import"./Tooltip-CKZvCezQ.js";import"./index-Bd9SP0or.js";import"./useSlot-mvKG6Wgh.js";import"./useForkRef-Bpui_Rog.js";import"./useTimeout-CubXWxzm.js";import"./useControlled-z9k1lOAa.js";import"./getReactElementRef-ButuhwgZ.js";import"./Grow-Dl0KNxbG.js";import"./Popper-DcSxBs27.js";import"./ownerDocument-DW-IO8s5.js";import"./isFocusVisible-B8k4qzLc.js";import"./LayersTwoTone-bL86XaCe.js";import"./ContentCopyTwoTone-DJdMr7BX.js";import"./HelpOutlineTwoTone-u_uBjZ5A.js";import"./ErrorOutlined-CJOHjQ7Q.js";import"./GetAppTwoTone-BX5La1zy.js";import"./InfoOutlined-C6mnOLwL.js";import"./PhoneTwoTone-CTNxExxA.js";import"./DeleteTwoTone-BN7zdXA7.js";import"./CheckCircleTwoTone-DqiaR3hR.js";import"./Typography-iLYEzmu9.js";import"./index-BmkogvA6.js";import"./extendSxProp-CnnbPdZl.js";import"./createSimplePaletteValueFilter-BdVFfA6R.js";import"./Box-DidoKigV.js";import"./SynapseConstants-Dgm-hl2F.js";import"./fetchWithExponentialTimeout-CXmnpl-T.js";import"./Link--7vwFeSR.js";import"./Stack-DxloL_Pr.js";import"./getThemeProps-Cq16S1xU.js";import"./Collapse-Cw63Bxtw.js";import"./_baseUniq-lS6Hau16.js";import"./_getTag-azHmxwvU.js";import"./merge-Bz19LOV8.js";import"./_initCloneObject-BMJ-50ps.js";import"./identity-DKeuBCMA.js";import"./tinycolor-Begke6kS.js";import"./Fade-C9sFZx16.js";import"./inputBaseClasses-CQzdIqXJ.js";import"./calculateFriendlyFileSize-CgweHd8h.js";import"./InfoTwoTone-sx2IvFci.js";import"./dayjs.min-C4CfR9Mw.js";import"./chunk-AYJ5UCUI-DAxvSOK2.js";import"./cloneDeep-h4gs_ZpB.js";import"./Skeleton-CCoTHJKu.js";import"./index-CYkyUI0D.js";import"./react-DINmqar4.js";import"./omit-vZKCmqRE.js";import"./toString-BZ6Q1cUN.js";import"./isSymbol-Cg20Bfxn.js";import"./_baseGet-BDSGAvHF.js";import"./_baseSlice-F8doVSIJ.js";import"./hasIn-98zFwrCP.js";import"./isString-D0MlmJUW.js";import"./_arrayReduce-CrxnWFSq.js";import"./_baseEach-Dp_wLIiX.js";import"./times-BFLagf9l.js";import"./_baseSet-B6sce5V2.js";import"./uniq-BfKYSRNb.js";import"./forEach-BvobdqcE.js";import"./Alert-CgZUdEqv.js";import"./Close-COYMWJeW.js";import"./IconButton-Dtr_Byk4.js";import"./ButtonBase-zX45zIy8.js";import"./CircularProgress-DpVN9MSn.js";import"./Paper-CFj-iwzR.js";import"./AlertTitle-DUAUDP9r.js";import"./ClickAwayListener-KmNvIbDM.js";import"./Input-DD2oY-5A.js";import"./InputBase-Bhjf7XIX.js";import"./isHostComponent-DVu5iVWx.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-DCzahHgP.js";import"./FormControl-v2XtVn_P.js";import"./isMuiElement-DdQqUZG0.js";import"./ownerWindow-HkKU3E4x.js";import"./debounce-Be36O1Ab.js";import"./Select-mAJp8WrO.js";import"./Menu-B8anToHr.js";import"./Popover-CTE-bZ_9.js";import"./mergeSlotProps-C3m7hjoe.js";import"./Modal-B4OepUy4.js";import"./getScrollbarSize-CaCM53D3.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Backdrop-CVWLzBCE.js";import"./MenuList-H4gPx6pg.js";import"./List-D5_R26s6.js";import"./usePreviousProps-BU9JsiVg.js";import"./Chip-BRH8Z14Y.js";import"./InputLabel-BneqEpzo.js";import"./FormLabel-D7upvHfk.js";import"./FormHelperText-BBD8-BD2.js";import"./uniqueId-CH_Qqd3p.js";import"./CSSTransition-DglNXaqL.js";import"./dividerClasses-BRjqL4oq.js";var $r=function(){return kc.Date.now()},Uc="Expected a function",Fc=Math.max,zc=Math.min;function Wc(i,u,_){var p,o,c,r,s,n,t=0,e=!1,l=!1,h=!0;if(typeof i!="function")throw new TypeError(Uc);u=fs(u)||0,ar(_)&&(e=!!_.leading,l="maxWait"in _,c=l?Fc(fs(_.maxWait)||0,u):c,h="trailing"in _?!!_.trailing:h);function d(O){var x=p,C=o;return p=o=void 0,t=O,r=i.apply(C,x),r}function w(O){return t=O,s=setTimeout(a,u),e?d(O):r}function b(O){var x=O-n,C=O-t,S=u-x;return l?zc(S,c-C):S}function v(O){var x=O-n,C=O-t;return n===void 0||x>=u||x<0||l&&C>=c}function a(){var O=$r();if(v(O))return f(O);s=setTimeout(a,b(O))}function f(O){return s=void 0,h&&p?d(O):(p=o=void 0,r)}function m(){s!==void 0&&clearTimeout(s),t=0,p=n=o=s=void 0}function g(){return s===void 0?r:f($r())}function y(){var O=$r(),x=v(O);if(p=arguments,o=this,n=O,x){if(s===void 0)return w(n);if(l)return clearTimeout(s),s=setTimeout(a,u),d(n)}return s===void 0&&(s=setTimeout(a,u)),r}return y.cancel=m,y.flush=g,y}var Gc="Expected a function";function Jc(i,u,_){var p=!0,o=!0;if(typeof i!="function")throw new TypeError(Gc);return ar(_)&&(p="leading"in _?!!_.leading:p,o="trailing"in _?!!_.trailing:o),Wc(i,u,{leading:p,maxWait:u,trailing:o})}function Hc(i){return{value:i.value}}function Kc(i){return ar(i)&&"type"in i&&(i.type=="null"||Rc(i.type,["null"]))}function Xc(i){return wl(i)&&i.every(u=>ar(u)&&"const"in u)}function Yc(i){let u=[];if(i!=null&&i.oneOf&&wl(i.oneOf)&&!Xc(i.oneOf)){const _=i.oneOf.filter(p=>!Kc(p));_.length==1&&ar(_[0])&&Object.hasOwn(_[0],"enum")&&(u=ds(_[0])||[])}else u=ds(i)||[];return u.map(Hc)}function Qc(i,u){return Tc(i,[jc,u],{})}var Lr={};const ie=gl(Mc);var Ur={},hs;function Zc(){return hs||(hs=1,Object.defineProperty(Ur,"__esModule",{value:!0})),Ur}var Fr={},zr={},ps;function eu(){return ps||(ps=1,Object.defineProperty(zr,"__esModule",{value:!0})),zr}var Wr={},ms;function tu(){return ms||(ms=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ServerClockVector=i.ClockVector=i.LogicalClock=i.interval=i.printTs=i.containsId=i.contains=i.compare=i.equal=i.tick=i.tss=i.ts=i.Timespan=i.Timestamp=void 0;class u{constructor(v,a){this.sid=v,this.time=a}}i.Timestamp=u;class _{constructor(v,a,f){this.sid=v,this.time=a,this.span=f}}i.Timespan=_;const p=(b,v)=>new u(b,v);i.ts=p;const o=(b,v,a)=>new _(b,v,a);i.tss=o;const c=(b,v)=>(0,i.ts)(b.sid,b.time+v);i.tick=c;const r=(b,v)=>b.time===v.time&&b.sid===v.sid;i.equal=r;const s=(b,v)=>{const a=b.time,f=v.time;if(a>f)return 1;if(a<f)return-1;const m=b.sid,g=v.sid;return m>g?1:m<g?-1:0};i.compare=s;const n=(b,v,a,f)=>{if(b.sid!==a.sid)return!1;const m=b.time,g=a.time;return!(m>g||m+v<g+f)};i.contains=n;const t=(b,v,a)=>{if(b.sid!==a.sid)return!1;const f=b.time,m=a.time;return!(f>m||f+v<m+1)};i.containsId=t;const e=b=>{if(b.sid===1)return"."+b.time;let v=""+b.sid;return v.length>4&&(v=".."+v.slice(v.length-4)),v+"."+b.time};i.printTs=e;const l=(b,v,a)=>new _(b.sid,b.time+v,a);i.interval=l;class h extends u{tick(v){const a=new u(this.sid,this.time);return this.time+=v,a}}i.LogicalClock=h;class d extends h{constructor(){super(...arguments),this.peers=new Map}observe(v,a){const f=v.time+a-1,m=v.sid;if(m!==this.sid){const g=this.peers.get(v.sid);g?f>g.time&&(g.time=f):this.peers.set(v.sid,(0,i.ts)(m,f))}f>=this.time&&(this.time=f+1)}clone(){return this.fork(this.sid)}fork(v){const a=new d(v,this.time);return v!==this.sid&&a.observe((0,i.tick)(this,-1),1),this.peers.forEach(f=>{a.observe(f,1)}),a}toString(v=""){const a=this.peers.size;let f=1,m="";return this.peers.forEach(g=>{m+=`
${v}${f===a?"└─":"├─"} ${g.sid}.${g.time}`,f++}),`clock ${this.sid}.${this.time}${m}`}}i.ClockVector=d;class w extends h{constructor(){super(...arguments),this.peers=new Map}observe(v,a){if(v.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<v.time)throw new Error("TIME_TRAVEL");const f=v.time+a;f>this.time&&(this.time=f)}clone(){return this.fork()}fork(){return new w(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}i.ServerClockVector=w}(Wr)),Wr}var bs;function he(){return bs||(bs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(eu(),i),u.__exportStar(tu(),i)}(Fr)),Fr}var te={},Ut={},vs;function Ye(){if(vs)return Ut;vs=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.printTree=void 0;const i=(u="",_)=>{let p="",o=_.length-1;for(;o>=0&&!_[o];o--);for(let c=0;c<=o;c++){const r=_[c];if(!r)continue;const s=c===o,n=r(u+(s?" ":"│")+"  "),t=n?s?"└─":"├─":"│";p+=`
`+u+t+(n?" "+n:"")}return p};return Ut.printTree=i,Ut}var gs;function Vt(){if(gs)return te;gs=1,Object.defineProperty(te,"__esModule",{value:!0}),te.NopOp=te.DelOp=te.UpdArrOp=te.InsArrOp=te.InsBinOp=te.InsStrOp=te.InsVecOp=te.InsObjOp=te.InsValOp=te.NewArrOp=te.NewBinOp=te.NewStrOp=te.NewVecOp=te.NewObjOp=te.NewValOp=te.NewConOp=void 0;const i=Ye(),u=he();class _{constructor(g){this.id=g}span(){return 1}toString(){let g=this.name()+" "+(0,u.printTs)(this.id);const y=this.span();return y>1&&(g+="!"+y),g}}class p extends _{constructor(g,y){super(g),this.id=g,this.val=y}name(){return"new_con"}toString(){const g=this.val,y="Uint8Array",O=g instanceof u.Timestamp?`{ ${(0,u.printTs)(g)} }`:g instanceof Uint8Array?g.length<13?`${y} { ${(""+g).replaceAll(",",", ")} }`:`${y}(${g.length})`:`{ ${JSON.stringify(g)} }`;return super.toString()+" "+O}}te.NewConOp=p;class o extends _{name(){return"new_val"}}te.NewValOp=o;class c extends _{name(){return"new_obj"}}te.NewObjOp=c;class r extends _{name(){return"new_vec"}}te.NewVecOp=r;class s extends _{name(){return"new_str"}}te.NewStrOp=s;class n extends _{name(){return"new_bin"}}te.NewBinOp=n;class t extends _{name(){return"new_arr"}}te.NewArrOp=t;class e extends _{constructor(g,y,O){super(g),this.id=g,this.obj=y,this.val=O}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}, val = ${(0,u.printTs)(this.val)}`}}te.InsValOp=e;class l extends _{constructor(g,y,O){super(g),this.id=g,this.obj=y,this.data=O}name(){return"ins_obj"}toString(g=""){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}`+(0,i.printTree)(g,this.data.map(O=>x=>`${JSON.stringify(O[0])}: ${(0,u.printTs)(O[1])}`))}}te.InsObjOp=l;class h extends _{constructor(g,y,O){super(g),this.id=g,this.obj=y,this.data=O}name(){return"ins_vec"}toString(g=""){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)}`+(0,i.printTree)(g,this.data.map(O=>x=>`${O[0]}: ${(0,u.printTs)(O[1])}`))}}te.InsVecOp=h;class d extends _{constructor(g,y,O,x){super(g),this.id=g,this.obj=y,this.ref=O,this.data=x}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${(0,u.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}te.InsStrOp=d;class w extends _{constructor(g,y,O,x){super(g),this.id=g,this.obj=y,this.ref=O,this.data=x}span(){return this.data.length}name(){return"ins_bin"}toString(){const g=(0,u.printTs)(this.ref);return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${g} ← ${this.data} }`}}te.InsBinOp=w;class b extends _{constructor(g,y,O,x){super(g),this.id=g,this.obj=y,this.ref=O,this.data=x}span(){return this.data.length}name(){return"ins_arr"}toString(){const g=(0,u.printTs)(this.obj),y=(0,u.printTs)(this.ref),O=this.data.map(u.printTs).join(", ");return super.toString()+", obj = "+g+" { "+y+" ← "+O+" }"}}te.InsArrOp=b;class v extends _{constructor(g,y,O,x){super(g),this.id=g,this.obj=y,this.ref=O,this.val=x}name(){return"upd_arr"}toString(){const g=(0,u.printTs)(this.obj),y=(0,u.printTs)(this.ref),O=(0,u.printTs)(this.val);return super.toString()+", obj = "+g+" { "+y+": "+O+" }"}}te.UpdArrOp=v;class a extends _{constructor(g,y,O){super(g),this.id=g,this.obj=y,this.what=O}name(){return"del"}toString(){const g=this.what.map(y=>(0,u.printTs)(y)+"!"+y.span).join(", ");return super.toString()+`, obj = ${(0,u.printTs)(this.obj)} { ${g} }`}}te.DelOp=a;class f extends _{constructor(g,y){super(g),this.id=g,this.len=y}span(){return this.len}name(){return"nop"}}return te.NopOp=f,te}var Ft={},Gr={},zt={},Wt={},Gt={},Jt={},ws;function nu(){if(ws)return Jt;ws=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Slice=void 0;let i=class{constructor(_,p,o,c){this.uint8=_,this.view=p,this.start=o,this.end=c}subarray(){return this.uint8.subarray(this.start,this.end)}};return Jt.Slice=i,Jt}var ys;function xl(){if(ys)return Gt;ys=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.Writer=void 0;const i=nu(),u=new Uint8Array([]),_=new DataView(u.buffer),p=typeof Re.Buffer=="function",o=p?Re.Buffer.prototype.utf8Write:null,c=p?Re.Buffer.from:null,r=typeof TextEncoder<"u"?new TextEncoder:null;let s=class{constructor(t=64*1024){this.allocSize=t,this.view=_,this.x0=0,this.x=0,this.uint8=new Uint8Array(t),this.size=t,this.view=new DataView(this.uint8.buffer)}grow(t){const e=this.x0,l=this.x,h=this.uint8,d=new Uint8Array(t),w=new DataView(d.buffer),b=h.subarray(e,l);d.set(b,0),this.x=l-e,this.x0=0,this.uint8=d,this.size=t,this.view=w}ensureCapacity(t){const e=this.size,l=e-this.x;if(l<t){const h=e-this.x0,d=t-l,w=h+d;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(t){this.ensureCapacity(t),this.x+=t}reset(){this.x0=this.x}newBuffer(t){const e=this.uint8=new Uint8Array(t);this.size=t,this.view=new DataView(e.buffer),this.x=this.x0=0}flush(){const t=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,t}flushSlice(){const t=new i.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,t}u8(t){this.ensureCapacity(1),this.uint8[this.x++]=t}u16(t){this.ensureCapacity(2),this.view.setUint16(this.x,t),this.x+=2}u32(t){this.ensureCapacity(4),this.view.setUint32(this.x,t),this.x+=4}i32(t){this.ensureCapacity(4),this.view.setInt32(this.x,t),this.x+=4}u64(t){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(t)),this.x+=8}f64(t){this.ensureCapacity(8),this.view.setFloat64(this.x,t),this.x+=8}u8u16(t,e){this.ensureCapacity(3);let l=this.x;this.uint8[l++]=t,this.uint8[l++]=e>>>8,this.uint8[l++]=e&255,this.x=l}u8u32(t,e){this.ensureCapacity(5);let l=this.x;this.uint8[l++]=t,this.view.setUint32(l,e),this.x=l+4}u8u64(t,e){this.ensureCapacity(9);let l=this.x;this.uint8[l++]=t,this.view.setBigUint64(l,BigInt(e)),this.x=l+8}u8f32(t,e){this.ensureCapacity(5);let l=this.x;this.uint8[l++]=t,this.view.setFloat32(l,e),this.x=l+4}u8f64(t,e){this.ensureCapacity(9);let l=this.x;this.uint8[l++]=t,this.view.setFloat64(l,e),this.x=l+8}buf(t,e){this.ensureCapacity(e);const l=this.x;this.uint8.set(t,l),this.x=l+e}utf8(t){const e=t.length*4;if(e<168)return this.utf8Native(t);if(o){const l=o.call(this.uint8,t,this.x,e);return this.x+=l,l}else if(c){const l=this.uint8,h=l.byteOffset+this.x,w=c(l.buffer).subarray(h,h+e).write(t,0,e,"utf8");return this.x+=w,w}else if(e>1024&&r){const l=r.encodeInto(t,this.uint8.subarray(this.x,this.x+e)).written;return this.x+=l,l}return this.utf8Native(t)}utf8Native(t){const e=t.length,l=this.uint8;let h=this.x,d=0;for(;d<e;){let b=t.charCodeAt(d++);if((b&4294967168)===0){l[h++]=b;continue}else if((b&4294965248)===0)l[h++]=b>>6&31|192;else{if(b>=55296&&b<=56319&&d<e){const v=t.charCodeAt(d);(v&64512)===56320&&(d++,b=((b&1023)<<10)+(v&1023)+65536)}(b&4294901760)===0?(l[h++]=b>>12&15|224,l[h++]=b>>6&63|128):(l[h++]=b>>18&7|240,l[h++]=b>>12&63|128,l[h++]=b>>6&63|128)}l[h++]=b&63|128}const w=h-this.x;return this.x=h,w}ascii(t){const e=t.length;this.ensureCapacity(e);const l=this.uint8;let h=this.x,d=0;for(;d<e;)l[h++]=t.charCodeAt(d++);this.x=h}};return Gt.Writer=s,Gt}var _s;function Fi(){if(_s)return Wt;_s=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.CrdtWriter=void 0;const i=xl();let u=class extends i.Writer{id(p,o){p<=7&&o<=15?this.u8(p<<4|o):(this.b1vu56(1,p),this.vu57(o))}vu57(p){if(p<=127)this.u8(p);else if(p<=16383){this.ensureCapacity(2);const o=this.uint8;o[this.x++]=128|p&127,o[this.x++]=p>>>7}else if(p<=2097151){this.ensureCapacity(3);const o=this.uint8;o[this.x++]=128|p&127,o[this.x++]=128|p>>>7&127,o[this.x++]=p>>>14}else if(p<=268435455){this.ensureCapacity(4);const o=this.uint8;o[this.x++]=128|p&127,o[this.x++]=128|p>>>7&127,o[this.x++]=128|p>>>14&127,o[this.x++]=p>>>21}else{let o=p|0;o<0&&(o+=4294967296);const c=(p-o)/4294967296;if(p<=34359738367){this.ensureCapacity(5);const r=this.uint8;r[this.x++]=128|p&127,r[this.x++]=128|p>>>7&127,r[this.x++]=128|p>>>14&127,r[this.x++]=128|p>>>21&127,r[this.x++]=c<<4|p>>>28}else if(p<=4398046511103){this.ensureCapacity(6);const r=this.uint8;r[this.x++]=128|p&127,r[this.x++]=128|p>>>7&127,r[this.x++]=128|p>>>14&127,r[this.x++]=128|p>>>21&127,r[this.x++]=128|(c&7)<<4|p>>>28,r[this.x++]=c>>>3}else if(p<=562949953421311){this.ensureCapacity(7);const r=this.uint8;r[this.x++]=128|p&127,r[this.x++]=128|p>>>7&127,r[this.x++]=128|p>>>14&127,r[this.x++]=128|p>>>21&127,r[this.x++]=128|(c&7)<<4|p>>>28,r[this.x++]=128|(c&1016)>>>3,r[this.x++]=c>>>10}else{this.ensureCapacity(8);const r=this.uint8;r[this.x++]=128|p&127,r[this.x++]=128|p>>>7&127,r[this.x++]=128|p>>>14&127,r[this.x++]=128|p>>>21&127,r[this.x++]=128|(c&7)<<4|p>>>28,r[this.x++]=128|(c&1016)>>>3,r[this.x++]=128|(c&130048)>>>10,r[this.x++]=c>>>17}}}b1vu56(p,o){if(o<=63)this.u8(p<<7|o);else{const c=p<<7|64;if(o<=8191){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=c|o&63,r[this.x++]=o>>>6}else if(o<=1048575){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=c|o&63,r[this.x++]=128|o>>>6&127,r[this.x++]=o>>>13}else if(o<=134217727){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=c|o&63,r[this.x++]=128|o>>>6&127,r[this.x++]=128|o>>>13&127,r[this.x++]=o>>>20}else{let r=o|0;r<0&&(r+=4294967296);const s=(o-r)/4294967296;if(o<=17179869183){this.ensureCapacity(5);const n=this.uint8;n[this.x++]=c|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=128|o>>>13&127,n[this.x++]=128|o>>>20&127,n[this.x++]=s<<5|o>>>27}else if(o<=2199023255551){this.ensureCapacity(6);const n=this.uint8;n[this.x++]=c|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=128|o>>>13&127,n[this.x++]=128|o>>>20&127,n[this.x++]=128|(s&3)<<5|o>>>27,n[this.x++]=s>>>2}else if(o<=0xffffffffffff){this.ensureCapacity(7);const n=this.uint8;n[this.x++]=c|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=128|o>>>13&127,n[this.x++]=128|o>>>20&127,n[this.x++]=128|(s&3)<<5|o>>>27,n[this.x++]=128|(s&508)>>>2,n[this.x++]=s>>>9}else{this.ensureCapacity(8);const n=this.uint8;n[this.x++]=c|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=128|o>>>13&127,n[this.x++]=128|o>>>20&127,n[this.x++]=128|(s&3)<<5|o>>>27,n[this.x++]=128|(s&508)>>>2,n[this.x++]=128|(s&65024)>>>9,n[this.x++]=s>>>16}}}}};return Wt.CrdtWriter=u,Wt}var Ht={},Kt={},Os;function ru(){if(Os)return Kt;Os=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.isFloat32=void 0;const i=new DataView(new ArrayBuffer(4)),u=_=>(i.setFloat32(0,_),_===i.getFloat32(0));return Kt.isFloat32=u,Kt}var Xt={},Ss;function Cl(){if(Ss)return Xt;Ss=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.JsonPackExtension=void 0;let i=class{constructor(_,p){this.tag=_,this.val=p}};return Xt.JsonPackExtension=i,Xt}var Yt={},xs;function iu(){if(xs)return Yt;xs=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.CborEncoderFast=void 0;const i=xl(),u=Number.isSafeInteger;let _=class{constructor(o=new i.Writer){this.writer=o}encode(o){return this.writeAny(o),this.writer.flush()}encodeToSlice(o){return this.writeAny(o),this.writer.flushSlice()}writeAny(o){switch(typeof o){case"number":return this.writeNumber(o);case"string":return this.writeStr(o);case"boolean":return this.writer.u8(244+ +o);case"object":{if(!o)return this.writer.u8(246);switch(o.constructor){case Array:return this.writeArr(o);default:return this.writeObj(o)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(o){o?this.writer.u8(245):this.writer.u8(244)}writeNumber(o){u(o)?this.writeInteger(o):typeof o=="bigint"?this.writeBigInt(o):this.writeFloat(o)}writeBigInt(o){o>=0?this.writeBigUint(o):this.writeBigSint(o)}writeBigUint(o){if(o<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(o));this.writer.u8u64(27,o)}writeBigSint(o){if(o>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(o));const c=-BigInt(1)-o;this.writer.u8u64(59,c)}writeInteger(o){o>=0?this.writeUInteger(o):this.encodeNint(o)}writeUInteger(o){const c=this.writer;c.ensureCapacity(9);const r=c.uint8;let s=c.x;o<=23?r[s++]=0+o:o<=255?(r[s++]=24,r[s++]=o):o<=65535?(r[s++]=25,c.view.setUint16(s,o),s+=2):o<=4294967295?(r[s++]=26,c.view.setUint32(s,o),s+=4):(r[s++]=27,c.view.setBigUint64(s,BigInt(o)),s+=8),c.x=s}encodeNumber(o){this.writeNumber(o)}encodeInteger(o){this.writeInteger(o)}encodeUint(o){this.writeUInteger(o)}encodeNint(o){const c=-1-o,r=this.writer;r.ensureCapacity(9);const s=r.uint8;let n=r.x;c<24?s[n++]=32+c:c<=255?(s[n++]=56,s[n++]=c):c<=65535?(s[n++]=57,r.view.setUint16(n,c),n+=2):c<=4294967295?(s[n++]=58,r.view.setUint32(n,c),n+=4):(s[n++]=59,r.view.setBigUint64(n,BigInt(c)),n+=8),r.x=n}writeFloat(o){this.writer.u8f64(251,o)}writeBin(o){const c=o.length;this.writeBinHdr(c),this.writer.buf(o,c)}writeBinHdr(o){const c=this.writer;o<=23?c.u8(64+o):o<=255?c.u16(22528+o):o<=65535?c.u8u16(89,o):o<=4294967295?c.u8u32(90,o):c.u8u64(91,o)}writeStr(o){const c=this.writer,s=o.length*4;c.ensureCapacity(5+s);const n=c.uint8;let t=c.x;s<=23?c.x++:s<=255?(n[c.x++]=120,t=c.x,c.x++):s<=65535?(n[c.x++]=121,t=c.x,c.x+=2):(n[c.x++]=122,t=c.x,c.x+=4);const e=c.utf8(o);s<=23?n[t]=96+e:s<=255?n[t]=e:s<=65535?c.view.setUint16(t,e):c.view.setUint32(t,e)}writeStrHdr(o){const c=this.writer;o<=23?c.u8(96+o):o<=255?c.u16(30720+o):o<=65535?c.u8u16(121,o):c.u8u32(122,o)}writeAsciiStr(o){this.writeStrHdr(o.length),this.writer.ascii(o)}writeArr(o){const c=o.length;this.writeArrHdr(c);for(let r=0;r<c;r++)this.writeAny(o[r])}writeArrHdr(o){const c=this.writer;o<=23?c.u8(128+o):o<=255?c.u16(38912+o):o<=65535?c.u8u16(153,o):o<=4294967295?c.u8u32(154,o):c.u8u64(155,o)}writeObj(o){const c=Object.keys(o),r=c.length;this.writeObjHdr(r);for(let s=0;s<r;s++){const n=c[s];this.writeStr(n),this.writeAny(o[n])}}writeObjHdr(o){const c=this.writer;o<=23?c.u8(160+o):o<=255?c.u16(47104+o):o<=65535?c.u8u16(185,o):o<=4294967295?c.u8u32(186,o):c.u8u64(187,o)}writeMapHdr(o){this.writeObjHdr(o)}writeStartMap(){this.writer.u8(191)}writeTag(o,c){this.writeTagHdr(o),this.writeAny(c)}writeTagHdr(o){const c=this.writer;o<=23?c.u8(192+o):o<=255?c.u16(55296+o):o<=65535?c.u8u16(217,o):o<=4294967295?c.u8u32(218,o):c.u8u64(219,o)}writeTkn(o){const c=this.writer;o<=23?c.u8(224+o):o<=255&&c.u16(63488+o)}writeStartStr(){this.writer.u8(127)}writeStrChunk(o){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(o){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(o){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(o,c){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return Yt.CborEncoderFast=_,Yt}var Qt={},Cs;function zi(){if(Cs)return Qt;Cs=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.JsonPackValue=void 0;let i=class{constructor(_){this.val=_}};return Qt.JsonPackValue=i,Qt}var Es;function El(){if(Es)return Ht;Es=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CborEncoder=void 0;const i=ru(),u=Cl(),_=iu(),p=zi();let o=class extends _.CborEncoderFast{writeUnknown(r){this.writeNull()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Object:return this.writeObj(r);case Array:return this.writeArr(r);case Uint8Array:return this.writeBin(r);case Map:return this.writeMap(r);case u.JsonPackExtension:return this.writeTag(r.tag,r.val);case p.JsonPackValue:const n=r.val;return this.writer.buf(n,n.length);default:return r instanceof Uint8Array?this.writeBin(r):Array.isArray(r)?this.writeArr(r):r instanceof Map?this.writeMap(r):this.writeUnknown(r)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(r);default:return this.writeUnknown(r)}}writeFloat(r){(0,i.isFloat32)(r)?this.writer.u8f32(250,r):this.writer.u8f64(251,r)}writeMap(r){this.writeMapHdr(r.size),r.forEach((s,n)=>{this.writeAny(n),this.writeAny(s)})}writeUndef(){this.writer.u8(247)}};return Ht.CborEncoder=o,Ht}var Ns;function Nl(){if(Ns)return zt;Ns=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Encoder=void 0;const u=ie.__importStar(Vt()),_=Fi(),p=he(),o=El();class c extends o.CborEncoder{constructor(s=new _.CrdtWriter){super(s),this.writer=s,this.patchSid=0}encode(s){this.writer.reset();const n=s.getId(),t=this.patchSid=n.sid,e=this.writer;e.vu57(t),e.vu57(n.time);const l=s.meta;return l===void 0?this.writeUndef():this.writeArr([l]),this.encodeOperations(s),e.flush()}encodeOperations(s){const n=s.ops,t=n.length;this.writer.vu57(t);for(let e=0;e<t;e++)this.encodeOperation(n[e])}encodeId(s){const n=s.sid,t=s.time,e=this.writer;n===this.patchSid?e.b1vu56(0,t):(e.b1vu56(1,t),e.vu57(n))}encodeTss(s){this.encodeId(s),this.writer.vu57(s.span)}writeInsStr(s,n,t,e){const l=this.writer;return s<=7?l.u8(96+s):(l.u8(96),l.vu57(s)),this.encodeId(n),this.encodeId(t),l.utf8(e)}encodeOperation(s){const n=this.writer;switch(s.constructor){case u.NewConOp:{const l=s.val;l instanceof p.Timestamp?(n.u8(1),this.encodeId(l)):(n.u8(0),this.writeAny(l));break}case u.NewValOp:{n.u8(8);break}case u.NewObjOp:{n.u8(16);break}case u.NewVecOp:{n.u8(24);break}case u.NewStrOp:{n.u8(32);break}case u.NewBinOp:{n.u8(40);break}case u.NewArrOp:{n.u8(48);break}case u.InsValOp:{const e=s;n.u8(72),this.encodeId(e.obj),this.encodeId(e.val);break}case u.InsObjOp:{const e=s,l=e.data,h=l.length;h<=7?n.u8(80+h):(n.u8(80),n.vu57(h)),this.encodeId(e.obj);for(let d=0;d<h;d++){const w=l[d];this.writeStr(w[0]),this.encodeId(w[1])}break}case u.InsVecOp:{const e=s,l=e.data,h=l.length;h<=7?n.u8(88+h):(n.u8(88),n.vu57(h)),this.encodeId(e.obj);for(let d=0;d<h;d++){const w=l[d];n.u8(w[0]),this.encodeId(w[1])}break}case u.InsStrOp:{const e=s,l=e.obj,h=e.ref,d=e.data,w=d.length;n.ensureCapacity(24+w*4);const b=n.x,v=this.writeInsStr(w,l,h,d);w!==v&&(n.x=b,this.writeInsStr(v,l,h,d));break}case u.InsBinOp:{const e=s,l=e.data,h=l.length;h<=7?n.u8(104+h):(n.u8(104),n.vu57(h)),this.encodeId(e.obj),this.encodeId(e.ref),n.buf(l,h);break}case u.InsArrOp:{const e=s,l=e.data,h=l.length;h<=7?n.u8(112+h):(n.u8(112),n.vu57(h)),this.encodeId(e.obj),this.encodeId(e.ref);for(let d=0;d<h;d++)this.encodeId(l[d]);break}case u.UpdArrOp:{const e=s;n.u8(120),this.encodeId(e.obj),this.encodeId(e.ref),this.encodeId(e.val);break}case u.DelOp:{const e=s,l=e.what,h=l.length;h<=7?n.u8(128+h):(n.u8(128),n.vu57(h)),this.encodeId(e.obj);for(let d=0;d<h;d++)this.encodeTss(l[d]);break}case u.NopOp:{const l=s.len;l<=7?n.u8(136+l):(n.u8(136),n.vu57(l));break}default:throw new Error("UNKNOWN_OP")}}}return zt.Encoder=c,zt}var Zt={},en={},tn={},nn={},hr={},dt={},Is;function su(){if(Is)return dt;Is=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.decodeAsciiMax15=dt.decodeAscii=void 0;const i=String.fromCharCode,u=(p,o,c)=>{const r=[];for(let s=0;s<c;s++){const n=p[o++];if(n&128)return;r.push(n)}return i.apply(String,r)};dt.decodeAscii=u;const _=(p,o,c)=>{if(c<4)if(c<2){if(c===0)return"";{const r=p[o++];if((r&128)>1){o-=1;return}return i(r)}}else{const r=p[o++],s=p[o++];if((r&128)>0||(s&128)>0){o-=2;return}if(c<3)return i(r,s);const n=p[o++];if((n&128)>0){o-=3;return}return i(r,s,n)}else{const r=p[o++],s=p[o++],n=p[o++],t=p[o++];if((r&128)>0||(s&128)>0||(n&128)>0||(t&128)>0){o-=4;return}if(c<6){if(c===4)return i(r,s,n,t);{const e=p[o++];if((e&128)>0){o-=5;return}return i(r,s,n,t,e)}}else if(c<8){const e=p[o++],l=p[o++];if((e&128)>0||(l&128)>0){o-=6;return}if(c<7)return i(r,s,n,t,e,l);const h=p[o++];if((h&128)>0){o-=7;return}return i(r,s,n,t,e,l,h)}else{const e=p[o++],l=p[o++],h=p[o++],d=p[o++];if((e&128)>0||(l&128)>0||(h&128)>0||(d&128)>0){o-=8;return}if(c<10){if(c===8)return i(r,s,n,t,e,l,h,d);{const w=p[o++];if((w&128)>0){o-=9;return}return i(r,s,n,t,e,l,h,d,w)}}else if(c<12){const w=p[o++],b=p[o++];if((w&128)>0||(b&128)>0){o-=10;return}if(c<11)return i(r,s,n,t,e,l,h,d,w,b);const v=p[o++];if((v&128)>0){o-=11;return}return i(r,s,n,t,e,l,h,d,w,b,v)}else{const w=p[o++],b=p[o++],v=p[o++],a=p[o++];if((w&128)>0||(b&128)>0||(v&128)>0||(a&128)>0){o-=12;return}if(c<14){if(c===12)return i(r,s,n,t,e,l,h,d,w,b,v,a);{const f=p[o++];if((f&128)>0){o-=13;return}return i(r,s,n,t,e,l,h,d,w,b,v,a,f)}}else{const f=p[o++],m=p[o++];if((f&128)>0||(m&128)>0){o-=14;return}if(c<15)return i(r,s,n,t,e,l,h,d,w,b,v,a,f,m);const g=p[o++];if((g&128)>0){o-=15;return}return i(r,s,n,t,e,l,h,d,w,b,v,a,f,m,g)}}}}};return dt.decodeAsciiMax15=_,dt}var pr={},Rs;function ou(){if(Rs)return pr;Rs=1,Object.defineProperty(pr,"__esModule",{value:!0});const i=String.fromCharCode;return pr.default=(u,_,p)=>{let o=_;const c=o+p,r=[];for(;o<c;){let s=u[o++];if((s&128)!==0){const n=u[o++]&63;if((s&224)===192)s=(s&31)<<6|n;else{const t=u[o++]&63;if((s&240)===224)s=(s&31)<<12|n<<6|t;else if((s&248)===240){const e=u[o++]&63;let l=(s&7)<<18|n<<12|t<<6|e;if(l>65535){l-=65536;const h=l>>>10&1023|55296;s=56320|l&1023,r.push(h)}else s=l}}}r.push(s)}return i.apply(String,r)},pr}var js;function au(){if(js)return hr;js=1,Object.defineProperty(hr,"__esModule",{value:!0});const i=ie,u=su(),_=i.__importDefault(ou()),p=typeof Re.Buffer<"u",o=p?Re.Buffer.prototype.utf8Slice:null,c=p?Re.Buffer.from:null,r=(e,l,h)=>(0,u.decodeAsciiMax15)(e,l,h)??(0,_.default)(e,l,h),s=(e,l,h)=>(0,u.decodeAscii)(e,l,h)??(0,_.default)(e,l,h),n=o?(e,l,h)=>o.call(e,l,l+h):c?(e,l,h)=>c(e).subarray(l,l+h).toString("utf8"):_.default,t=(e,l,h)=>h<16?r(e,l,h):h<32?s(e,l,h):n(e,l,h);return hr.default=t,hr}var ks;function lu(){if(ks)return nn;ks=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.decodeUtf8=void 0;const u=ie.__importDefault(au());return nn.decodeUtf8=u.default,nn}var Ts;function Il(){if(Ts)return tn;Ts=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.Reader=void 0;const i=lu();let u=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(p){this.x=0,this.uint8=p,this.view=new DataView(p.buffer,p.byteOffset,p.length)}peak(){return this.view.getUint8(this.x)}skip(p){this.x+=p}buf(p){const o=this.x+p,c=this.uint8.subarray(this.x,o);return this.x=o,c}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let p=this.x;const o=(this.uint8[p++]<<8)+this.uint8[p++];return this.x=p,o}i16(){const p=this.view.getInt16(this.x);return this.x+=2,p}u32(){const p=this.view.getUint32(this.x);return this.x+=4,p}i32(){const p=this.view.getInt32(this.x);return this.x+=4,p}u64(){const p=this.view.getBigUint64(this.x);return this.x+=8,p}i64(){const p=this.view.getBigInt64(this.x);return this.x+=8,p}f32(){const p=this.x;return this.x+=4,this.view.getFloat32(p)}f64(){const p=this.x;return this.x+=8,this.view.getFloat64(p)}utf8(p){const o=this.x;return this.x+=p,(0,i.decodeUtf8)(this.uint8,o,p)}ascii(p){const o=this.uint8;let c="";const r=this.x+p;for(let s=this.x;s<r;s++)c+=String.fromCharCode(o[s]);return this.x=r,c}};return tn.Reader=u,tn}var As;function Rl(){if(As)return en;As=1,Object.defineProperty(en,"__esModule",{value:!0}),en.CrdtReader=void 0;const i=Il();let u=class extends i.Reader{id(){const p=this.u8();return p<=127?[p>>>4,p&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const p=this.u8();if(p<=127)return p;const o=this.u8();if(o<=127)return o<<7|p&127;const c=this.u8();if(c<=127)return c<<14|(o&127)<<7|p&127;const r=this.u8();if(r<=127)return r<<21|(c&127)<<14|(o&127)<<7|p&127;const s=this.u8();if(s<=127)return s*268435456+((r&127)<<21|(c&127)<<14|(o&127)<<7|p&127);const n=this.u8();if(n<=127)return n*34359738368+((s&127)*268435456+((r&127)<<21|(c&127)<<14|(o&127)<<7|p&127));const t=this.u8();return t<=127?t*4398046511104+((n&127)*34359738368+((s&127)*268435456+((r&127)<<21|(c&127)<<14|(o&127)<<7|p&127))):this.u8()*562949953421312+((t&127)*4398046511104+((n&127)*34359738368+((s&127)*268435456+((r&127)<<21|(c&127)<<14|(o&127)<<7|p&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const p=this.u8(),o=p&128?1:0,c=127&p;if(c<=63)return[o,c];const r=this.u8();if(r<=127)return[o,r<<6|c&63];const s=this.u8();if(s<=127)return[o,s<<13|(r&127)<<6|c&63];const n=this.u8();if(n<=127)return[o,n<<20|(s&127)<<13|(r&127)<<6|c&63];const t=this.u8();if(t<=127)return[o,t*134217728+((n&127)<<20|(s&127)<<13|(r&127)<<6|c&63)];const e=this.u8();if(e<=127)return[o,e*17179869184+((t&127)*134217728+((n&127)<<20|(s&127)<<13|(r&127)<<6|c&63))];const l=this.u8();if(l<=127)return[o,l*2199023255552+((e&127)*17179869184+((t&127)*134217728+((n&127)<<20|(s&127)<<13|(r&127)<<6|c&63)))];const h=this.u8();return[o,h*281474976710656+((l&127)*2199023255552+((e&127)*17179869184+((t&127)*134217728+((n&127)<<20|(s&127)<<13|(r&127)<<6|c&63))))]}};return en.CrdtReader=u,en}var rn={},sn={},Ms;function Wi(){return Ms||(Ms=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.isUint8Array=void 0,sn.isUint8Array=typeof Re.Buffer=="function"?i=>i instanceof Uint8Array||Re.Buffer.isBuffer(i):i=>i instanceof Uint8Array),sn}var Jr={},Hr={},Ps;function cu(){return Ps||(Ps=1,Object.defineProperty(Hr,"__esModule",{value:!0})),Hr}var Ds;function Or(){return Ds||(Ds=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ORIGIN=void 0;const u=ie,_=he();u.__exportStar(cu(),i),i.ORIGIN=(0,_.ts)(0,0)}(Jr)),Jr}var Kr={},qs;function jl(){return qs||(qs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.s=i.schema=i.nodes=i.NodeBuilder=void 0;const u=Wi(),_=he(),p=r=>{switch(typeof r){case"number":case"boolean":case"undefined":return!0;case"object":return r===null||r instanceof _.Timestamp;default:return!1}};class o{constructor(s){this.build=s}}i.NodeBuilder=o;var c;(function(r){class s extends o{constructor(v){super(a=>a.con(v)),this.raw=v,this.type="con"}}r.con=s;class n extends o{constructor(v){super(a=>a.json(v)),this.raw=v,this.type="str"}}r.str=n;class t extends o{constructor(v){super(a=>a.json(v)),this.raw=v,this.type="bin"}}r.bin=t;class e extends o{constructor(v){super(a=>{const f=a.val(),m=v.build(a);return a.setVal(f,m),f}),this.value=v,this.type="val"}}r.val=e;class l extends o{constructor(v){super(a=>{const f=a.vec(),m=v.length;if(m){const g=[];for(let y=0;y<m;y++){const x=v[y].build(a);g.push([y,x])}a.insVec(f,g)}return f}),this.value=v,this.type="vec"}}r.vec=l;class h extends o{constructor(v,a){super(f=>{const m=f.obj(),g=[],y={...v,...a},O=Object.keys(y),x=O.length;if(x){for(let C=0;C<x;C++){const S=O[C],E=y[S].build(f);g.push([S,E])}f.insObj(m,g)}return m}),this.obj=v,this.opt=a,this.type="obj"}optional(){return this}}r.obj=h;class d extends o{constructor(v){super(a=>{const f=a.arr(),m=v.length;if(m){const g=[];for(let y=0;y<m;y++)g.push(v[y].build(a));a.insArr(f,f,g)}return f}),this.arr=v,this.type="arr"}}r.arr=d;class w extends o{constructor(v,a){super(f=>{const m=new Uint8Array([v,0,0]),g=f.vec();return m[1]=g.sid%256,m[2]=g.time%256,f.insVec(g,[[0,f.constOrJson(i.s.con(m))],[1,a.build(f)]]),g}),this.id=v,this.data=a,this.type="ext"}}r.ext=w})(c||(i.nodes=c={})),i.schema={con:r=>new c.con(r),str:r=>new c.str(r||""),bin:r=>new c.bin(r),val:r=>new c.val(r),vec:(...r)=>new c.vec(r),obj:(r,s)=>new c.obj(r,s),map:r=>i.schema.obj(r),arr:r=>new c.arr(r),json:r=>{switch(typeof r){case"object":{if(!r)return i.s.val(i.s.con(r));if(r instanceof o)return r;if(Array.isArray(r))return i.s.arr(r.map(s=>i.s.json(s)));if((0,u.isUint8Array)(r))return i.s.bin(r);if(r instanceof _.Timestamp)return i.s.val(i.s.con(r));{const s={},n=Object.keys(r);for(const t of n)s[t]=i.s.jsonCon(r[t]);return i.s.obj(s)}}case"string":return i.s.str(r);default:return i.s.val(i.s.con(r))}},jsonCon:r=>p(r)?i.s.con(r):i.s.json(r),ext:(r,s)=>new c.ext(r,s)},i.s=i.schema}(Kr)),Kr}var Bs;function Sr(){if(Bs)return rn;Bs=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.PatchBuilder=void 0;const u=ie.__importStar(Vt()),_=he(),p=Wi(),o=Ml(),c=Or(),r=jl(),s=t=>{switch(typeof t){case"number":case"boolean":return!0;default:return t===null}};let n=class{constructor(e){this.clock=e,this.patch=new o.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const e=this.patch;return this.patch=new o.Patch,e}obj(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewObjOp(e)),e}arr(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewArrOp(e)),e}vec(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewVecOp(e)),e}str(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewStrOp(e)),e}bin(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewBinOp(e)),e}con(e){this.pad();const l=this.clock.tick(1);return this.patch.ops.push(new u.NewConOp(l,e)),l}val(){this.pad();const e=this.clock.tick(1);return this.patch.ops.push(new u.NewValOp(e)),e}root(e){return this.setVal(c.ORIGIN,e)}insObj(e,l){if(!l.length)throw new Error("EMPTY_TUPLES");this.pad();const h=this.clock.tick(1),d=new u.InsObjOp(h,e,l),w=d.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(d),h}insVec(e,l){if(!l.length)throw new Error("EMPTY_TUPLES");this.pad();const h=this.clock.tick(1),d=new u.InsVecOp(h,e,l),w=d.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(d),h}setVal(e,l){this.pad();const h=this.clock.tick(1),d=new u.InsValOp(h,e,l);return this.patch.ops.push(d),h}insStr(e,l,h){if(!h.length)throw new Error("EMPTY_STRING");this.pad();const d=this.clock.tick(1),w=new u.InsStrOp(d,e,l,h),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),d}insBin(e,l,h){if(!h.length)throw new Error("EMPTY_BINARY");this.pad();const d=this.clock.tick(1),w=new u.InsBinOp(d,e,l,h),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),d}insArr(e,l,h){this.pad();const d=this.clock.tick(1),w=new u.InsArrOp(d,e,l,h),b=w.span();return b>1&&this.clock.tick(b-1),this.patch.ops.push(w),d}updArr(e,l,h){this.pad();const d=this.clock.tick(1),w=new u.UpdArrOp(d,e,l,h);return this.patch.ops.push(w),d}del(e,l){this.pad();const h=this.clock.tick(1);return this.patch.ops.push(new u.DelOp(h,e,l)),h}nop(e){this.pad();const l=this.clock.tick(e);return this.patch.ops.push(new u.NopOp(l,e)),l}jsonObj(e){const l=this.obj(),h=Object.keys(e);if(h.length){const d=[];for(const w of h){const b=e[w],v=b instanceof _.Timestamp?b:s(b)?this.con(b):this.json(b);d.push([w,v])}this.insObj(l,d)}return l}jsonArr(e){const l=this.arr();if(e.length){const h=[];for(const d of e)h.push(this.json(d));this.insArr(l,l,h)}return l}jsonStr(e){const l=this.str();return e&&this.insStr(l,l,e),l}jsonBin(e){const l=this.bin();return e.length&&this.insBin(l,l,e),l}jsonVal(e){const l=this.val(),h=this.con(e);return this.setVal(l,h),l}json(e){if(e instanceof _.Timestamp)return e;if(e===void 0)return this.con(e);if(e instanceof Array)return this.jsonArr(e);if((0,p.isUint8Array)(e))return this.jsonBin(e);if(e instanceof r.NodeBuilder)return e.build(this);switch(typeof e){case"object":return e===null?this.jsonVal(e):this.jsonObj(e);case"string":return this.jsonStr(e);case"number":case"boolean":return this.jsonVal(e)}throw new Error("INVALID_JSON")}constOrJson(e){return e instanceof _.Timestamp?e:s(e)?this.con(e):this.json(e)}maybeConst(e){return e instanceof _.Timestamp?e:this.con(e)}pad(){const e=this.patch.nextTime();if(!e)return;const l=this.clock.time-e;if(l>0){const h=(0,_.ts)(this.clock.sid,e),d=new u.NopOp(h,l);this.patch.ops.push(d)}}};return rn.PatchBuilder=n,rn}var on={},an={},ln={},Vs;function uu(){if(Vs)return ln;Vs=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.decodeF16=void 0;const i=Math.pow,u=_=>{const p=(_&31744)>>10,o=_&1023;return(_>>15?-1:1)*(p?p===31?o?NaN:1/0:i(2,p-15)*(1+o/1024):6103515625e-14*(o/1024))};return ln.decodeF16=u,ln}var mr={},cn={},br={},$s;function du(){if($s)return br;$s=1,Object.defineProperty(br,"__esModule",{value:!0});const i=String.fromCharCode;return br.default=(u,_,p)=>{let o=_;const c=o+p;let r="";for(;o<c;){const s=u[o++];if((s&128)===0){r+=i(s);continue}const n=u[o++]&63;if((s&224)===192){r+=i((s&31)<<6|n);continue}const t=u[o++]&63;if((s&240)===224){r+=i((s&31)<<12|n<<6|t);continue}if((s&248)===240){const e=u[o++]&63;let l=(s&7)<<18|n<<12|t<<6|e;if(l>65535){l-=65536;const h=l>>>10&1023|55296;l=56320|l&1023,r+=i(h,l)}else r+=i(l)}else r+=i(s)}return r},br}var Ls;function fu(){if(Ls)return cn;Ls=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.CachedUtf8Decoder=void 0;const u=ie.__importDefault(du());let _=1+Math.round(Math.random()*((-1>>>0)-1));function p(r,s){return _^=_<<13,_^=_>>>17,_^=_<<5,(_>>>0)%(s-r+1)+r}class o{constructor(s,n){this.bytes=s,this.value=n}}let c=class{constructor(){this.caches=[];for(let s=0;s<31;s++)this.caches.push([])}get(s,n,t){const e=this.caches[t-1],l=e.length;e:for(let h=0;h<l;h++){const d=e[h],w=d.bytes;for(let b=0;b<t;b++)if(w[b]!==s[n+b])continue e;return d.value}return null}store(s,n){const t=this.caches[s.length-1],e=new o(s,n);t.length>=16?t[p(0,15)]=e:t.push(e)}decode(s,n,t){if(!t)return"";const e=this.get(s,n,t);if(e!==null)return e;const l=(0,u.default)(s,n,t),h=Uint8Array.prototype.slice.call(s,n,n+t);return this.store(h,l),l}};return cn.CachedUtf8Decoder=c,cn}var Us;function hu(){if(Us)return mr;Us=1,Object.defineProperty(mr,"__esModule",{value:!0});const i=fu();return mr.default=new i.CachedUtf8Decoder,mr}var Fs;function kl(){if(Fs)return an;Fs=1,Object.defineProperty(an,"__esModule",{value:!0}),an.CborDecoderBase=void 0;const i=ie,u=uu(),_=Cl(),p=zi(),o=Il(),c=i.__importDefault(hu());let r=class{constructor(n=new o.Reader,t=c.default){this.reader=n,this.keyDecoder=t}read(n){return this.reader.reset(n),this.val()}decode(n){return this.reader.reset(n),this.val()}val(){const t=this.reader.u8(),e=t>>5,l=t&31;return e<4?e<2?e===0?this.readUint(l):this.readNint(l):e===2?this.readBin(l):this.readStr(l):e<6?e===4?this.readArr(l):this.readObj(l):e===6?this.readTag(l):this.readTkn(l)}readAnyRaw(n){const t=n>>5,e=n&31;return t<4?t<2?t===0?this.readUint(e):this.readNint(e):t===2?this.readBin(e):this.readStr(e):t<6?t===4?this.readArr(e):this.readObj(e):t===6?this.readTag(e):this.readTkn(e)}readMinorLen(n){if(n<24)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(n){if(n<25)return n===24?this.reader.u8():n;if(n<27)return n===25?this.reader.u16():this.reader.u32();{const t=this.reader.u64();return t>9007199254740991?t:Number(t)}}readNint(n){if(n<25)return n===24?-this.reader.u8()-1:-n-1;if(n<27)return n===25?-this.reader.u16()-1:-this.reader.u32()-1;{const t=this.reader.u64();return t>9007199254740991-1?-t-BigInt(1):-Number(t)-1}}readBin(n){const t=this.reader;if(n<=23)return t.buf(n);switch(n){case 24:return t.buf(t.u8());case 25:return t.buf(t.u16());case 26:return t.buf(t.u32());case 27:return t.buf(Number(t.u64()));case 31:{let e=0;const l=[];for(;this.reader.peak()!==255;){const b=this.readBinChunk();e+=b.length,l.push(b)}this.reader.x++;const h=new Uint8Array(e);let d=0;const w=l.length;for(let b=0;b<w;b++){const v=l[b];h.set(v,d),d+=v.length}return h}default:throw 1}}readBinChunk(){const n=this.reader.u8(),t=n>>5,e=n&31;if(t!==2)throw 2;if(e>27)throw 3;return this.readBin(e)}readAsStr(){const t=this.reader.u8(),e=t>>5,l=t&31;if(e!==3)throw 11;return this.readStr(l)}readStr(n){const t=this.reader;if(n<=23)return t.utf8(n);switch(n){case 24:return t.utf8(t.u8());case 25:return t.utf8(t.u16());case 26:return t.utf8(t.u32());case 27:return t.utf8(Number(t.u64()));case 31:{let e="";for(;t.peak()!==255;)e+=this.readStrChunk();return this.reader.x++,e}default:throw 1}}readStrLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const n=this.reader.u8(),t=n>>5,e=n&31;if(t!==3)throw 4;if(e>27)throw 5;return this.readStr(e)}readArr(n){const t=this.readMinorLen(n);return t>=0?this.readArrRaw(t):this.readArrIndef()}readArrRaw(n){const t=[];for(let e=0;e<n;e++)t.push(this.val());return t}readArrIndef(){const n=[];for(;this.reader.peak()!==255;)n.push(this.val());return this.reader.x++,n}readObj(n){if(n<28){let t=n;switch(n){case 24:t=this.reader.u8();break;case 25:t=this.reader.u16();break;case 26:t=this.reader.u32();break;case 27:t=Number(this.reader.u64());break}const e={};for(let l=0;l<t;l++){const h=this.key();if(h==="__proto__")throw 6;const d=this.val();e[h]=d}return e}else{if(n===31)return this.readObjIndef();throw 1}}readObjRaw(n){const t={};for(let e=0;e<n;e++){const l=this.key(),h=this.val();t[l]=h}return t}readObjIndef(){const n={};for(;this.reader.peak()!==255;){const t=this.key();if(this.reader.peak()===255)throw 7;const e=this.val();n[t]=e}return this.reader.x++,n}key(){const n=this.reader.u8(),t=n>>5,e=n&31;if(t!==3)return String(this.readAnyRaw(n));const l=this.readStrLen(e);if(l>31)return this.reader.utf8(l);const h=this.keyDecoder.decode(this.reader.uint8,this.reader.x,l);return this.reader.skip(l),h}readTag(n){if(n<=23)return this.readTagRaw(n);switch(n){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(n){return new _.JsonPackExtension(n,this.val())}readTkn(n){switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new p.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(n<=23)return new p.JsonPackValue(n);throw 1}f16(){return(0,u.decodeF16)(this.reader.u16())}};return an.CborDecoderBase=r,an}var zs;function pu(){if(zs)return on;zs=1,Object.defineProperty(on,"__esModule",{value:!0}),on.CborDecoder=void 0;const i=kl(),u=zi();let _=class extends i.CborDecoderBase{readAsMap(){const o=this.reader.u8(),c=o>>5,r=o&31;switch(c){case 5:return this.readMap(r);default:throw 0}}readMap(o){const c=this.readMinorLen(o);return c>=0?this.readMapRaw(c):this.readMapIndef()}readMapRaw(o){const c=new Map;for(let r=0;r<o;r++){const s=this.val(),n=this.val();c.set(s,n)}return c}readMapIndef(){const o=new Map;for(;this.reader.peak()!==255;){const c=this.val();if(this.reader.peak()===255)throw 7;const r=this.val();o.set(c,r)}return this.reader.x++,o}skipN(o){for(let c=0;c<o;c++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(o){const c=o>>5,r=o&31;switch(c){case 0:case 1:this.skipUNint(r);break;case 2:this.skipBin(r);break;case 3:this.skipStr(r);break;case 4:this.skipArr(r);break;case 5:this.skipObj(r);break;case 7:this.skipTkn(r);break;case 6:this.skipTag(r);break}}skipMinorLen(o){if(o<=23)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(o){if(!(o<=23))switch(o){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(o){const c=this.skipMinorLen(o);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const o=this.reader.u8(),c=o>>5,r=o&31;if(c!==2)throw 2;if(r>27)throw 3;this.skipBin(r)}skipStr(o){const c=this.skipMinorLen(o);if(c>=0)this.reader.skip(c);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const o=this.reader.u8(),c=o>>5,r=o&31;if(c!==3)throw 4;if(r>27)throw 5;this.skipStr(r)}skipArr(o){const c=this.skipMinorLen(o);if(c>=0)this.skipN(c);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(o){const c=this.readMinorLen(o);if(c>=0)return this.skipN(c*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(o){if(this.skipMinorLen(o)<0)throw 1;this.skipAny()}skipTkn(o){switch(o){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(o<=23))throw 1}validate(o,c=0,r=o.length){this.reader.reset(o),this.reader.x=c;const s=c;if(this.skipAny(),this.reader.x-s!==r)throw 8}decodeLevel(o){return this.reader.reset(o),this.readLevel()}readLevel(){const o=this.reader.u8(),c=o>>5,r=o&31;switch(c){case 4:return this.readArrLevel(r);case 5:return this.readObjLevel(r);default:return super.readAnyRaw(o)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const o=this.reader,c=o.x;this.skipAny();const r=o.x;return new u.JsonPackValue(o.uint8.subarray(c,r))}readObjLevel(o){const c=this.readMinorLen(o);return c>=0?this.readObjRawLevel(c):this.readObjIndefLevel()}readObjRawLevel(o){const c={};for(let r=0;r<o;r++){const s=this.key(),n=this.readPrimitiveOrVal();c[s]=n}return c}readObjIndefLevel(){const o={};for(;this.reader.peak()!==255;){const c=this.key();if(this.reader.peak()===255)throw 7;const r=this.readPrimitiveOrVal();o[c]=r}return this.reader.x++,o}readArrLevel(o){const c=this.readMinorLen(o);return c>=0?this.readArrRawLevel(c):this.readArrIndefLevel()}readArrRawLevel(o){const c=[];for(let r=0;r<o;r++)c.push(this.readPrimitiveOrVal());return c}readArrIndefLevel(){const o=[];for(;this.reader.peak()!==255;)o.push(this.readPrimitiveOrVal());return this.reader.x++,o}readHdr(o){const c=this.reader.u8();if(c>>5!==o)throw 0;const s=c&31;if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(o){const c=this.readObjHdr();for(let r=0;r<c;r++){if(this.key()===o)return this;this.skipAny()}throw 9}findIndex(o){const c=this.readArrHdr();if(o>=c)throw 10;for(let r=0;r<o;r++)this.skipAny();return this}find(o){for(let c=0;c<o.length;c++){const r=o[c];typeof r=="string"?this.findKey(r):this.findIndex(r)}return this}};return on.CborDecoder=_,on}var Ws;function Tl(){if(Ws)return Zt;Ws=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Decoder=void 0;const i=Rl(),u=he(),_=Sr(),p=pu();class o extends p.CborDecoder{constructor(r=new i.CrdtReader){super(r)}decode(r){return this.reader.reset(r),this.readPatch()}readPatch(){const r=this.reader,s=r.vu57(),n=r.vu57(),e=s===1?new u.ServerClockVector(1,n):new u.ClockVector(s,n);this.patchSid=e.sid;const l=this.builder=new _.PatchBuilder(e),h=this.val();return Array.isArray(h)&&(l.patch.meta=h[0]),this.decodeOperations(),l.patch}decodeId(){const r=this.reader,[s,n]=r.b1vu56();return s?new u.Timestamp(r.vu57(),n):new u.Timestamp(this.patchSid,n)}decodeTss(){const r=this.decodeId(),s=this.reader.vu57();return(0,u.interval)(r,0,s)}decodeOperations(){const s=this.reader.vu57();for(let n=0;n<s;n++)this.decodeOperation()}decodeOperation(){const r=this.builder,s=this.reader,n=s.u8();switch(n>>3){case 0:{const e=n&7;r.con(e?this.decodeId():this.val());break}case 1:{r.val();break}case 2:{r.obj();break}case 3:{r.vec();break}case 4:{r.str();break}case 5:{r.bin();break}case 6:{r.arr();break}case 9:{const e=this.decodeId(),l=this.decodeId();r.setVal(e,l);break}case 10:{const e=n&7||s.vu57(),l=this.decodeId(),h=[];for(let d=0;d<e;d++){const w=this.val();if(typeof w!="string")continue;const b=this.decodeId();h.push([w,b])}r.insObj(l,h);break}case 11:{const e=n&7||s.vu57(),l=this.decodeId(),h=[];for(let d=0;d<e;d++){const w=this.val();if(typeof w!="number")continue;const b=this.decodeId();h.push([w,b])}r.insVec(l,h);break}case 12:{const e=n&7||s.vu57(),l=this.decodeId(),h=this.decodeId(),d=s.utf8(e);r.insStr(l,h,d);break}case 13:{const e=n&7||s.vu57(),l=this.decodeId(),h=this.decodeId(),d=s.buf(e);if(!(d instanceof Uint8Array))return;r.insBin(l,h,d);break}case 14:{const e=n&7||s.vu57(),l=this.decodeId(),h=this.decodeId(),d=[];for(let w=0;w<e;w++)d.push(this.decodeId());r.insArr(l,h,d);break}case 15:{const e=this.decodeId(),l=this.decodeId(),h=this.decodeId();r.updArr(e,l,h);break}case 16:{const e=n&7||s.vu57(),l=this.decodeId(),h=[];for(let d=0;d<e;d++)h.push(this.decodeTss());r.del(l,h);break}case 17:{const e=n&7||s.vu57();r.nop(e);break}default:throw new Error("UNKNOWN_OP")}}}return Zt.Decoder=o,Zt}var Xr={},Gs;function mu(){return Gs||(Gs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.decode=i.decoder=i.encode=i.encoder=void 0;const u=Nl(),_=Tl(),p=Fi(),o=new p.CrdtWriter(1024*4);i.encoder=new u.Encoder(o);const c=s=>i.encoder.encode(s);i.encode=c,i.decoder=new _.Decoder;const r=s=>i.decoder.decode(s);i.decode=r}(Xr)),Xr}var Js;function bu(){return Js||(Js=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(Nl(),i),u.__exportStar(Tl(),i),u.__exportStar(mu(),i)}(Gr)),Gr}var Hs;function Ml(){if(Hs)return Ft;Hs=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Patch=void 0;const u=ie.__importStar(Vt()),_=he(),p=Ye(),o=bu();let c=class Al{constructor(){this.ops=[],this.meta=void 0}static fromBinary(s){return(0,o.decode)(s)}getId(){const s=this.ops[0];if(s)return s.id}span(){let s=0;for(const n of this.ops)s+=n.span();return s}nextTime(){const s=this.ops,n=s.length;if(!n)return 0;const t=s[n-1];return t.id.time+t.span()}rewriteTime(s){const n=new Al,t=this.ops,e=t.length,l=n.ops;for(let h=0;h<e;h++){const d=t[h];d instanceof u.DelOp?l.push(new u.DelOp(s(d.id),s(d.obj),d.what)):d instanceof u.NewConOp?l.push(new u.NewConOp(s(d.id),d.val instanceof _.Timestamp?s(d.val):d.val)):d instanceof u.NewVecOp?l.push(new u.NewVecOp(s(d.id))):d instanceof u.NewValOp?l.push(new u.NewValOp(s(d.id))):d instanceof u.NewObjOp?l.push(new u.NewObjOp(s(d.id))):d instanceof u.NewStrOp?l.push(new u.NewStrOp(s(d.id))):d instanceof u.NewBinOp?l.push(new u.NewBinOp(s(d.id))):d instanceof u.NewArrOp?l.push(new u.NewArrOp(s(d.id))):d instanceof u.InsArrOp?l.push(new u.InsArrOp(s(d.id),s(d.obj),s(d.ref),d.data.map(s))):d instanceof u.UpdArrOp?l.push(new u.UpdArrOp(s(d.id),s(d.obj),s(d.ref),s(d.val))):d instanceof u.InsStrOp?l.push(new u.InsStrOp(s(d.id),s(d.obj),s(d.ref),d.data)):d instanceof u.InsBinOp?l.push(new u.InsBinOp(s(d.id),s(d.obj),s(d.ref),d.data)):d instanceof u.InsValOp?l.push(new u.InsValOp(s(d.id),s(d.obj),s(d.val))):d instanceof u.InsObjOp?l.push(new u.InsObjOp(s(d.id),s(d.obj),d.data.map(([w,b])=>[w,s(b)]))):d instanceof u.InsVecOp?l.push(new u.InsVecOp(s(d.id),s(d.obj),d.data.map(([w,b])=>[w,s(b)]))):d instanceof u.NopOp&&l.push(new u.NopOp(s(d.id),d.len))}return n}rebase(s,n){const t=this.getId();if(!t)throw new Error("EMPTY_PATCH");const e=t.sid,l=t.time;if(n??(n=l),l===s)return this;const h=s-l;return this.rewriteTime(d=>{if(d.sid!==e)return d;const w=d.time;return w<n?d:(0,_.ts)(e,w+h)})}clone(){return this.rewriteTime(s=>s)}toBinary(){return(0,o.encode)(this)}toString(s=""){const n=this.getId();return`Patch ${n?(0,_.printTs)(n):"(nil)"}!${this.span()}`+(0,p.printTree)(s,this.ops.map(e=>l=>e.toString(l)))}};return Ft.Patch=c,Ft}var Ks;function xr(){return Ks||(Ks=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(Zc(),i),u.__exportStar(he(),i),u.__exportStar(Vt(),i),u.__exportStar(Ml(),i),u.__exportStar(Sr(),i),u.__exportStar(jl(),i)}(Lr)),Lr}var Yr=xr(),Qr={},Me={},Zr={},Xs;function vu(){return Xs||(Xs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.useColumnWidths=i.getColumnWidths=void 0;const u=me(),_=(o,c)=>{const r=c.map(({basis:n,minWidth:t,maxWidth:e})=>({basis:n,minWidth:t,maxWidth:e,size:n,violation:0,frozen:!1,factor:0}));let s=r.reduce((n,t)=>n-t.size,o);s>0?c.forEach(({grow:n},t)=>{r[t].factor=n}):s<0&&c.forEach(({shrink:n},t)=>{r[t].factor=n});for(const n of r)n.factor===0&&(n.frozen=!0);for(;r.some(({frozen:n})=>!n);){const n=r.reduce((e,l)=>e+(l.frozen?0:l.factor),0);let t=0;for(const e of r)e.frozen||(e.size+=s*e.factor/n,e.size<e.minWidth?e.violation=e.minWidth-e.size:e.maxWidth!==void 0&&e.size>e.maxWidth?e.violation=e.maxWidth-e.size:e.violation=0,e.size+=e.violation,t+=e.violation);if(t>0)for(const e of r)e.violation>0&&(e.frozen=!0);else if(t<0)for(const e of r)e.violation<0&&(e.frozen=!0);else break;s=r.reduce((e,l)=>e-l.size,o)}return r.map(({size:n})=>n)};i.getColumnWidths=_;const p=(o,c)=>{const r=o.map(({basis:s,minWidth:n,maxWidth:t,grow:e,shrink:l})=>[s,n,t,e,l].join(",")).join("|");return(0,u.useMemo)(()=>{if(c===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const s=(0,i.getColumnWidths)(c,o);let n=0;const t=s.map((e,l)=>(n+=e,l===s.length-1?1/0:n));return{fullWidth:Math.abs(c-n)<.1,columnWidths:s,columnRights:t,totalWidth:n}},[c,r])};i.useColumnWidths=p}(Zr)),Zr}var Bi=function(i,u){return Bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,p){_.__proto__=p}||function(_,p){for(var o in p)Object.prototype.hasOwnProperty.call(p,o)&&(_[o]=p[o])},Bi(i,u)};function Pl(i,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");Bi(i,u);function _(){this.constructor=i}i.prototype=u===null?Object.create(u):(_.prototype=u.prototype,new _)}var Dt=function(){return Dt=Object.assign||function(u){for(var _,p=1,o=arguments.length;p<o;p++){_=arguments[p];for(var c in _)Object.prototype.hasOwnProperty.call(_,c)&&(u[c]=_[c])}return u},Dt.apply(this,arguments)};function Dl(i,u){var _={};for(var p in i)Object.prototype.hasOwnProperty.call(i,p)&&u.indexOf(p)<0&&(_[p]=i[p]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,p=Object.getOwnPropertySymbols(i);o<p.length;o++)u.indexOf(p[o])<0&&Object.prototype.propertyIsEnumerable.call(i,p[o])&&(_[p[o]]=i[p[o]]);return _}var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Re.global<"u"?Re.global:typeof self<"u"?self:{};function gu(i){var u=typeof i;return i!=null&&(u=="object"||u=="function")}var Gi=gu,wu=typeof vr=="object"&&vr&&vr.Object===Object&&vr,yu=wu,_u=yu,Ou=typeof self=="object"&&self&&self.Object===Object&&self,Su=_u||Ou||Function("return this")(),ql=Su,xu=ql,Cu=function(){return xu.Date.now()},Eu=Cu,Nu=/\s/;function Iu(i){for(var u=i.length;u--&&Nu.test(i.charAt(u)););return u}var Ru=Iu,ju=Ru,ku=/^\s+/;function Tu(i){return i&&i.slice(0,ju(i)+1).replace(ku,"")}var Au=Tu,Mu=ql,Pu=Mu.Symbol,Bl=Pu,Ys=Bl,Vl=Object.prototype,Du=Vl.hasOwnProperty,qu=Vl.toString,un=Ys?Ys.toStringTag:void 0;function Bu(i){var u=Du.call(i,un),_=i[un];try{i[un]=void 0;var p=!0}catch{}var o=qu.call(i);return p&&(u?i[un]=_:delete i[un]),o}var Vu=Bu,$u=Object.prototype,Lu=$u.toString;function Uu(i){return Lu.call(i)}var Fu=Uu,Qs=Bl,zu=Vu,Wu=Fu,Gu="[object Null]",Ju="[object Undefined]",Zs=Qs?Qs.toStringTag:void 0;function Hu(i){return i==null?i===void 0?Ju:Gu:Zs&&Zs in Object(i)?zu(i):Wu(i)}var Ku=Hu;function Xu(i){return i!=null&&typeof i=="object"}var Yu=Xu,Qu=Ku,Zu=Yu,ed="[object Symbol]";function td(i){return typeof i=="symbol"||Zu(i)&&Qu(i)==ed}var nd=td,rd=Au,eo=Gi,id=nd,to=NaN,sd=/^[-+]0x[0-9a-f]+$/i,od=/^0b[01]+$/i,ad=/^0o[0-7]+$/i,ld=parseInt;function cd(i){if(typeof i=="number")return i;if(id(i))return to;if(eo(i)){var u=typeof i.valueOf=="function"?i.valueOf():i;i=eo(u)?u+"":u}if(typeof i!="string")return i===0?i:+i;i=rd(i);var _=od.test(i);return _||ad.test(i)?ld(i.slice(2),_?2:8):sd.test(i)?to:+i}var ud=cd,dd=Gi,ei=Eu,no=ud,fd="Expected a function",hd=Math.max,pd=Math.min;function md(i,u,_){var p,o,c,r,s,n,t=0,e=!1,l=!1,h=!0;if(typeof i!="function")throw new TypeError(fd);u=no(u)||0,dd(_)&&(e=!!_.leading,l="maxWait"in _,c=l?hd(no(_.maxWait)||0,u):c,h="trailing"in _?!!_.trailing:h);function d(O){var x=p,C=o;return p=o=void 0,t=O,r=i.apply(C,x),r}function w(O){return t=O,s=setTimeout(a,u),e?d(O):r}function b(O){var x=O-n,C=O-t,S=u-x;return l?pd(S,c-C):S}function v(O){var x=O-n,C=O-t;return n===void 0||x>=u||x<0||l&&C>=c}function a(){var O=ei();if(v(O))return f(O);s=setTimeout(a,b(O))}function f(O){return s=void 0,h&&p?d(O):(p=o=void 0,r)}function m(){s!==void 0&&clearTimeout(s),t=0,p=n=o=s=void 0}function g(){return s===void 0?r:f(ei())}function y(){var O=ei(),x=v(O);if(p=arguments,o=this,n=O,x){if(s===void 0)return w(n);if(l)return clearTimeout(s),s=setTimeout(a,u),d(n)}return s===void 0&&(s=setTimeout(a,u)),r}return y.cancel=m,y.flush=g,y}var $l=md,bd=$l,vd=Gi,gd="Expected a function";function wd(i,u,_){var p=!0,o=!0;if(typeof i!="function")throw new TypeError(gd);return vd(_)&&(p="leading"in _?!!_.leading:p,o="trailing"in _?!!_.trailing:o),bd(i,u,{leading:p,maxWait:u,trailing:o})}var yd=wd,Ll=function(i,u,_,p){switch(u){case"debounce":return $l(i,_,p);case"throttle":return yd(i,_,p);default:return i}},Vi=function(i){return typeof i=="function"},at=function(){return typeof window>"u"},ro=function(i){return i instanceof Element||i instanceof HTMLDocument},Ul=function(i,u,_,p){return function(o){var c=o.width,r=o.height;u(function(s){return s.width===c&&s.height===r||s.width===c&&!p||s.height===r&&!_?s:(i&&Vi(i)&&i(c,r),{width:c,height:r})})}},Fl=function(i){Pl(u,i);function u(_){var p=i.call(this,_)||this;p.cancelHandler=function(){p.resizeHandler&&p.resizeHandler.cancel&&(p.resizeHandler.cancel(),p.resizeHandler=null)},p.attachObserver=function(){var t=p.props,e=t.targetRef,l=t.observerOptions;if(!at()){e&&e.current&&(p.targetRef.current=e.current);var h=p.getElement();h&&(p.observableElement&&p.observableElement===h||(p.observableElement=h,p.resizeObserver.observe(h,l)))}},p.getElement=function(){var t=p.props,e=t.querySelector,l=t.targetDomEl;if(at())return null;if(e)return document.querySelector(e);if(l&&ro(l))return l;if(p.targetRef&&ro(p.targetRef.current))return p.targetRef.current;var h=Pc.findDOMNode(p);if(!h)return null;var d=p.getRenderType();switch(d){case"renderProp":return h;case"childFunction":return h;case"child":return h;case"childArray":return h;default:return h.parentElement}},p.createResizeHandler=function(t){var e=p.props,l=e.handleWidth,h=l===void 0?!0:l,d=e.handleHeight,w=d===void 0?!0:d,b=e.onResize;if(!(!h&&!w)){var v=Ul(b,p.setState.bind(p),h,w);t.forEach(function(a){var f=a&&a.contentRect||{},m=f.width,g=f.height,y=!p.skipOnMount&&!at();y&&v({width:m,height:g}),p.skipOnMount=!1})}},p.getRenderType=function(){var t=p.props,e=t.render,l=t.children;return Vi(e)?"renderProp":Vi(l)?"childFunction":K.isValidElement(l)?"child":Array.isArray(l)?"childArray":"parent"};var o=_.skipOnMount,c=_.refreshMode,r=_.refreshRate,s=r===void 0?1e3:r,n=_.refreshOptions;return p.state={width:void 0,height:void 0},p.skipOnMount=o,p.targetRef=K.createRef(),p.observableElement=null,at()||(p.resizeHandler=Ll(p.createResizeHandler,c,s,n),p.resizeObserver=new window.ResizeObserver(p.resizeHandler)),p}return u.prototype.componentDidMount=function(){this.attachObserver()},u.prototype.componentDidUpdate=function(){this.attachObserver()},u.prototype.componentWillUnmount=function(){at()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},u.prototype.render=function(){var _=this.props,p=_.render,o=_.children,c=_.nodeType,r=c===void 0?"div":c,s=this.state,n=s.width,t=s.height,e={width:n,height:t,targetRef:this.targetRef},l=this.getRenderType(),h;switch(l){case"renderProp":return p&&p(e);case"childFunction":return h=o,h(e);case"child":if(h=o,h.type&&typeof h.type=="string"){e.targetRef;var d=Dl(e,["targetRef"]);return K.cloneElement(h,d)}return K.cloneElement(h,e);case"childArray":return h=o,h.map(function(w){return!!w&&K.cloneElement(w,e)});default:return K.createElement(r,null)}},u}(K.PureComponent);function _d(i,u){u===void 0&&(u={});var _=function(c){Pl(r,c);function r(){var s=c!==null&&c.apply(this,arguments)||this;return s.ref=K.createRef(),s}return r.prototype.render=function(){var s=this.props,n=s.forwardedRef,t=Dl(s,["forwardedRef"]),e=n??this.ref;return K.createElement(Fl,Dt({},u,{targetRef:e}),K.createElement(i,Dt({targetRef:e},t)))},r}(K.Component);function p(c,r){return K.createElement(_,Dt({},c,{forwardedRef:r}))}var o=i.displayName||i.name;return p.displayName="withResizeDetector(".concat(o,")"),K.forwardRef(p)}var Od=at()?K.useEffect:K.useLayoutEffect;function Sd(i){i===void 0&&(i={});var u=i.skipOnMount,_=u===void 0?!1:u,p=i.refreshMode,o=i.refreshRate,c=o===void 0?1e3:o,r=i.refreshOptions,s=i.handleWidth,n=s===void 0?!0:s,t=i.handleHeight,e=t===void 0?!0:t,l=i.targetRef,h=i.observerOptions,d=i.onResize,w=K.useRef(_),b=K.useRef(null),v=l??b,a=K.useRef(),f=K.useState({width:void 0,height:void 0}),m=f[0],g=f[1];return Od(function(){if(!at()){var y=Ul(d,g,n,e),O=function(C){!n&&!e||C.forEach(function(S){var E=S&&S.contentRect||{},I=E.width,j=E.height,N=!w.current&&!at();N&&y({width:I,height:j}),w.current=!1})};a.current=Ll(O,p,c,r);var x=new window.ResizeObserver(a.current);return v.current&&x.observe(v.current,h),function(){x.disconnect();var C=a.current;C&&C.cancel&&C.cancel()}}},[p,c,r,n,e,d,h,v.current]),Dt({ref:v},m)}const xd=Object.freeze(Object.defineProperty({__proto__:null,default:Fl,useResizeDetector:Sd,withResizeDetector:_d},Symbol.toStringTag,{value:"Module"})),Cd=gl(xd);var nt={},io;function Ed(){return io||(io=1,function(i){var u=nt&&nt.__createBinding||(Object.create?function(w,b,v,a){a===void 0&&(a=v);var f=Object.getOwnPropertyDescriptor(b,v);(!f||("get"in f?!b.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return b[v]}}),Object.defineProperty(w,a,f)}:function(w,b,v,a){a===void 0&&(a=v),w[a]=b[v]}),_=nt&&nt.__setModuleDefault||(Object.create?function(w,b){Object.defineProperty(w,"default",{enumerable:!0,value:b})}:function(w,b){w.default=b}),p=nt&&nt.__importStar||function(w){if(w&&w.__esModule)return w;var b={};if(w!=null)for(var v in w)v!=="default"&&Object.prototype.hasOwnProperty.call(w,v)&&u(b,w,v);return _(b,w),b};Object.defineProperty(i,"__esModule",{value:!0}),i.useColumns=i.parseFlexValue=void 0;const o=p(me()),c=()=>o.default.createElement(o.default.Fragment,null),r=()=>!1,s=({rowData:w})=>w,n=()=>null,t=({rowIndex:w})=>o.default.createElement(o.default.Fragment,null,w+1),e=()=>!0,l=w=>w,h=w=>{if(typeof w=="number")return{basis:0,grow:w,shrink:1};if(w.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(w.trim()),shrink:1};if(w.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(w.trim()),grow:1,shrink:1};if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[b,v]=w.trim().split(" ");return{basis:0,grow:parseFloat(b),shrink:parseFloat(v)}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,v]=w.trim().split(" ");return{basis:parseFloat(v),grow:parseFloat(b),shrink:1}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[b,v,a]=w.trim().split(" ");return{basis:parseFloat(a),grow:parseFloat(b),shrink:parseFloat(v)}}return{basis:0,grow:1,shrink:1}};i.parseFlexValue=h;const d=(w,b,v)=>(0,o.useMemo)(()=>{var a,f,m,g,y,O,x,C,S,E;const I=[b===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>o.default.createElement(o.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:e}:Object.assign(Object.assign({},b),{basis:(a=b==null?void 0:b.basis)!==null&&a!==void 0?a:40,grow:(f=b==null?void 0:b.grow)!==null&&f!==void 0?f:0,shrink:(m=b==null?void 0:b.shrink)!==null&&m!==void 0?m:0,minWidth:(g=b==null?void 0:b.minWidth)!==null&&g!==void 0?g:0,title:(y=b==null?void 0:b.title)!==null&&y!==void 0?y:o.default.createElement("div",{className:"dsg-corner-indicator"}),component:(O=b==null?void 0:b.component)!==null&&O!==void 0?O:t,isCellEmpty:e}),...w];return v&&I.push(Object.assign(Object.assign({},v),{basis:(x=v==null?void 0:v.basis)!==null&&x!==void 0?x:40,grow:(C=v==null?void 0:v.grow)!==null&&C!==void 0?C:0,shrink:(S=v==null?void 0:v.shrink)!==null&&S!==void 0?S:0,minWidth:(E=v.minWidth)!==null&&E!==void 0?E:0,isCellEmpty:e})),I.map(j=>{var N,M,A,D,V,z,U,Z,se,L,J,ce,Y,ye,ee,le;const be=j.width!==void 0?(0,i.parseFlexValue)(j.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},j),{basis:(M=(N=j.basis)!==null&&N!==void 0?N:be.basis)!==null&&M!==void 0?M:0,grow:(D=(A=j.grow)!==null&&A!==void 0?A:be.grow)!==null&&D!==void 0?D:1,shrink:(z=(V=j.shrink)!==null&&V!==void 0?V:be.shrink)!==null&&z!==void 0?z:1,minWidth:(U=j.minWidth)!==null&&U!==void 0?U:100,component:(Z=j.component)!==null&&Z!==void 0?Z:c,disableKeys:(se=j.disableKeys)!==null&&se!==void 0?se:!1,disabled:(L=j.disabled)!==null&&L!==void 0?L:!1,keepFocus:(J=j.keepFocus)!==null&&J!==void 0?J:!1,deleteValue:(ce=j.deleteValue)!==null&&ce!==void 0?ce:s,copyValue:(Y=j.copyValue)!==null&&Y!==void 0?Y:n,pasteValue:(ye=j.pasteValue)!==null&&ye!==void 0?ye:s,prePasteValues:(ee=j.prePasteValues)!==null&&ee!==void 0?ee:l,isCellEmpty:(le=j.isCellEmpty)!==null&&le!==void 0?le:r})})},[b,v,w]);i.useColumns=d}(nt)),nt}var dn={},fn={},so;function Ji(){if(so)return fn;so=1,Object.defineProperty(fn,"__esModule",{value:!0});function i(_,p,o,c){var r,s=!1,n=0;function t(){r&&clearTimeout(r)}function e(){t(),s=!0}typeof p!="boolean"&&(c=o,o=p,p=void 0);function l(){for(var h=arguments.length,d=new Array(h),w=0;w<h;w++)d[w]=arguments[w];var b=this,v=Date.now()-n;if(s)return;function a(){n=Date.now(),o.apply(b,d)}function f(){r=void 0}c&&!r&&a(),t(),c===void 0&&v>_?a():p!==!0&&(r=setTimeout(c?f:a,c===void 0?_-v:_))}return l.cancel=e,l}function u(_,p,o){return o===void 0?i(_,p,!1):i(_,o,p!==!1)}return fn.debounce=u,fn.throttle=i,fn}var ft={},oo;function zl(){if(oo)return ft;oo=1;var i=ft&&ft.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(ft,"__esModule",{value:!0}),ft.useDeepEqualState=void 0;const u=me(),_=i(yl()),p=o=>{const[c,r]=(0,u.useState)(o),s=(0,u.useCallback)(n=>{r(t=>{const e=typeof n=="function"?n(t):n;return(0,_.default)(e,t)?t:e})},[r]);return[c,s]};return ft.useDeepEqualState=p,ft}var ao;function Nd(){if(ao)return dn;ao=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.useEdges=void 0;const i=me(),u=Ji(),_=zl(),p=(o,c,r)=>{const[s,n]=(0,_.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,i.useEffect)(()=>{const t=(0,u.throttle)(100,()=>{var l,h,d,w,b,v,a,f,m,g;n({top:((l=o.current)===null||l===void 0?void 0:l.scrollTop)===0,right:((d=(h=o.current)===null||h===void 0?void 0:h.scrollLeft)!==null&&d!==void 0?d:0)>=((b=(w=o.current)===null||w===void 0?void 0:w.scrollWidth)!==null&&b!==void 0?b:0)-(c??0)-1,bottom:((a=(v=o.current)===null||v===void 0?void 0:v.scrollTop)!==null&&a!==void 0?a:0)>=((m=(f=o.current)===null||f===void 0?void 0:f.scrollHeight)!==null&&m!==void 0?m:0)-(r??0)-1,left:((g=o.current)===null||g===void 0?void 0:g.scrollLeft)===0})}),e=o.current;return e==null||e.addEventListener("scroll",t),setTimeout(t,100),()=>{e==null||e.removeEventListener("scroll",t),t.cancel()}},[r,c,o,n]),s};return dn.useEdges=p,dn}var hn={},lo;function Wl(){if(lo)return hn;lo=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.useDocumentEventListener=void 0;const i=me(),u=(_,p)=>{(0,i.useEffect)(()=>(document.addEventListener(_,p),()=>{document.removeEventListener(_,p)}),[p,_])};return hn.useDocumentEventListener=u,hn}var pn={},co;function Id(){if(co)return pn;co=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.useGetBoundingClientRect=void 0;const i=me(),u=Ji(),_=(p,o=200)=>{const c=(0,i.useRef)(null),r=(0,i.useMemo)(()=>(0,u.throttle)(o,!0,()=>{setTimeout(()=>{var s;return c.current=((s=p.current)===null||s===void 0?void 0:s.getBoundingClientRect())||null},0)}),[p,o]);return(0,i.useCallback)((s=!1)=>{var n;return s?c.current=((n=p.current)===null||n===void 0?void 0:n.getBoundingClientRect())||null:r(),c.current},[p,r])};return pn.useGetBoundingClientRect=_,pn}var rt={},uo;function Gl(){return uo||(uo=1,function(i){var u=rt&&rt.__createBinding||(Object.create?function(r,s,n,t){t===void 0&&(t=n);var e=Object.getOwnPropertyDescriptor(s,n);(!e||("get"in e?!s.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(r,t,e)}:function(r,s,n,t){t===void 0&&(t=n),r[t]=s[n]}),_=rt&&rt.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),p=rt&&rt.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var n in r)n!=="default"&&Object.prototype.hasOwnProperty.call(r,n)&&u(s,r,n);return _(s,r),s};Object.defineProperty(i,"__esModule",{value:!0}),i.AddRows=i.createAddRowsComponent=void 0;const o=p(me()),c=(r={})=>({addRows:s})=>{var n,t;const[e,l]=(0,o.useState)(1),[h,d]=(0,o.useState)(String(e));return o.default.createElement("div",{className:"dsg-add-row"},o.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>s(e)},(n=r.button)!==null&&n!==void 0?n:"Add")," ",o.default.createElement("input",{className:"dsg-add-row-input",value:h,onBlur:()=>d(String(e)),type:"number",min:1,onChange:w=>{d(w.target.value),l(Math.max(1,Math.round(parseInt(w.target.value)||0)))},onKeyDown:w=>{w.key==="Enter"&&s(e)}})," ",(t=r.unit)!==null&&t!==void 0?t:"rows")};i.createAddRowsComponent=c,i.AddRows=(0,i.createAddRowsComponent)(),i.AddRows.displayName="AddRows"}(rt)),rt}var mn={},fo;function Rd(){if(fo)return mn;fo=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.useDebounceState=void 0;const i=me(),u=Ji(),_=(p,o)=>{const[c,r]=(0,i.useState)(p),s=(0,i.useRef)();(0,i.useEffect)(()=>()=>{var t;return(t=s.current)===null||t===void 0?void 0:t.cancel()},[]);const n=(0,i.useMemo)(()=>s.current=(0,u.debounce)(o,t=>{r(t)}),[o]);return[c,n]};return mn.useDebounceState=_,mn}var it={},ho;function Jl(){return ho||(ho=1,function(i){var u=it&&it.__createBinding||(Object.create?function(t,e,l,h){h===void 0&&(h=l);var d=Object.getOwnPropertyDescriptor(e,l);(!d||("get"in d?!e.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return e[l]}}),Object.defineProperty(t,h,d)}:function(t,e,l,h){h===void 0&&(h=l),t[h]=e[l]}),_=it&&it.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),p=it&&it.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var l in t)l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)&&u(e,t,l);return _(e,t),e};Object.defineProperty(i,"__esModule",{value:!0}),i.ContextMenu=i.createContextMenuComponent=i.defaultRenderItem=void 0;const o=p(me()),c=me(),r=Wl(),s=t=>t.type==="CUT"?o.createElement(o.Fragment,null,"Cut"):t.type==="COPY"?o.createElement(o.Fragment,null,"Copy"):t.type==="PASTE"?o.createElement(o.Fragment,null,"Paste"):t.type==="DELETE_ROW"?o.createElement(o.Fragment,null,"Delete row"):t.type==="DELETE_ROWS"?o.createElement(o.Fragment,null,"Delete rows ",o.createElement("b",null,t.fromRow)," to ",o.createElement("b",null,t.toRow)):t.type==="INSERT_ROW_BELLOW"?o.createElement(o.Fragment,null,"Insert row below"):t.type==="DUPLICATE_ROW"?o.createElement(o.Fragment,null,"Duplicate row"):t.type==="DUPLICATE_ROWS"?o.createElement(o.Fragment,null,"Duplicate rows ",o.createElement("b",null,t.fromRow)," to ",o.createElement("b",null,t.toRow)):t.type;i.defaultRenderItem=s;const n=(t=i.defaultRenderItem)=>({clientX:e,clientY:l,items:h,close:d})=>{const w=(0,c.useRef)(null),b=(0,c.useCallback)(v=>{var a;((a=w.current)===null||a===void 0?void 0:a.contains(v.target))||d()},[d]);return(0,r.useDocumentEventListener)("mousedown",b),o.createElement("div",{className:"dsg-context-menu",style:{left:e+"px",top:l+"px"},ref:w},h.map(v=>o.createElement("div",{key:v.type,onClick:v.action,className:"dsg-context-menu-item"},t(v))))};i.createContextMenuComponent=n,i.ContextMenu=(0,i.createContextMenuComponent)(i.defaultRenderItem),i.ContextMenu.displayName="ContextMenu"}(it)),it}var Ge={},bn={},po;function jd(){if(po)return bn;po=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.parseDom=void 0;const i=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},u=_=>i.parseFromString(_,"text/html");return bn.parseDom=u,bn}var mo;function kd(){if(mo)return Ge;mo=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.isPrintableUnicode=Ge.encodeHtml=Ge.parseTextPlainData=Ge.parseTextHtmlData=void 0;const i=jd(),u=c=>{var r,s;const n=(0,i.parseDom)(c.replace(/<br\/?>/g,`
`)),t=n.getElementsByTagName("table")[0];if(t){const l=[];for(let h=0;h<t.rows.length;h++){const d=[];l.push(d);for(let w=0;w<t.rows[h].cells.length;w++)d.push((r=t.rows[h].cells[w].textContent)!==null&&r!==void 0?r:"")}return l}const e=n.getElementsByTagName("span")[0];return e?[[(s=e.textContent)!==null&&s!==void 0?s:""]]:[[""]]};Ge.parseTextHtmlData=u;const _=c=>{const r=c.replace(/\r|\n$/g,""),s=[[]];let n=0,t=0,e=!1,l=0;const h=()=>{let d=r.slice(t,n);d[0]==='"'&&d[d.length-1]==='"'&&(e=!0),e&&d[d.length-1]==='"'&&d.includes(`
`)&&(d=d.slice(1,d.length-1).replace(/""/g,'"'),e=!1),e&&d[d.length-1]!=='"'?d.split(`
`).forEach((w,b,{length:v})=>{s[l].push(w),b<v-1&&(s.push([]),l++)}):s[l].push(d)};for(;n<r.length;)e&&r[n]==='"'&&![void 0,"	",'"'].includes(r[n+1])&&(e=!1),e&&r[n]==='"'&&r[n+1]==='"'&&n++,n===t&&r[n]==='"'&&(e=!0),r[n]==="	"&&(h(),t=n+1,e=!1),r[n]===`
`&&!e&&(h(),s.push([]),t=n+1,l++),n++;return h(),s};Ge.parseTextPlainData=_;const p=c=>c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");Ge.encodeHtml=p;const o=c=>c.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return Ge.isPrintableUnicode=o,Ge}var ti={},bo;function Td(){return bo||(bo=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.getSelectionWithId=i.getSelection=i.getCellWithId=i.getCell=void 0;const u=(c,r,s,n)=>{if(c===null||!r||!s)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const t=n.findIndex(l=>l.id===c.col),e={col:Math.max(0,Math.min(r-1,t===-1?Number(c.col):t-1)),row:Math.max(0,Math.min(s-1,Number(c.row)))};if(isNaN(e.col)||isNaN(e.row))throw new Error("col or cell are not valid positive numbers");return e};i.getCell=u;const _=(c,r)=>{var s;return c?{col:c.col,row:c.row,colId:(s=r[c.col+1])===null||s===void 0?void 0:s.id}:null};i.getCellWithId=_;const p=(c,r,s,n)=>{if(c===null||!r||!s)return null;if(typeof c!="object")throw new Error("Value must be an object or null");const t={min:(0,i.getCell)(c.min,r,s,n),max:(0,i.getCell)(c.max,r,s,n)};if(!t.min||!t.max)throw new Error("min and max must be defined");return t};i.getSelection=p;const o=(c,r)=>c?{min:(0,i.getCellWithId)(c.min,r),max:(0,i.getCellWithId)(c.max,r)}:null;i.getSelectionWithId=o}(ti)),ti}var vn={},vo;function Ad(){if(vo)return vn;vo=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.getAllTabbableElements=void 0;const i=()=>Array.from(document.querySelectorAll("*")).filter(u=>u instanceof HTMLElement&&typeof u.tabIndex=="number"&&u.tabIndex>=0&&!u.disabled&&(!(u instanceof HTMLAnchorElement)||!!u.href||u.getAttribute("tabIndex")!==null)&&getComputedStyle(u).visibility!=="collapse");return vn.getAllTabbableElements=i,vn}var Pe={},ni={},ri={},ii={},go;function Md(){return go||(go=1,function(i){Object.defineProperty(i,Symbol.toStringTag,{value:"Module"});function u(c,r,s){let n=s.initialDeps??[],t;function e(){var l,h,d,w;let b;s.key&&((l=s.debug)!=null&&l.call(s))&&(b=Date.now());const v=c();if(!(v.length!==n.length||v.some((m,g)=>n[g]!==m)))return t;n=v;let f;if(s.key&&((h=s.debug)!=null&&h.call(s))&&(f=Date.now()),t=r(...v),s.key&&((d=s.debug)!=null&&d.call(s))){const m=Math.round((Date.now()-b)*100)/100,g=Math.round((Date.now()-f)*100)/100,y=g/16,O=(x,C)=>{for(x=String(x);x.length<C;)x=" "+x;return x};console.info(`%c⏱ ${O(g,5)} /${O(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,s==null?void 0:s.key)}return(w=s==null?void 0:s.onChange)==null||w.call(s,t),t}return e.updateDeps=l=>{n=l},e}function _(c,r){if(c===void 0)throw new Error(`Unexpected undefined${r?`: ${r}`:""}`);return c}const p=(c,r)=>Math.abs(c-r)<=1,o=(c,r,s)=>{let n;return function(...t){c.clearTimeout(n),n=c.setTimeout(()=>r.apply(this,t),s)}};i.approxEqual=p,i.debounce=o,i.memo=u,i.notUndefined=_}(ii)),ii}var wo;function Pd(){return wo||(wo=1,function(i){Object.defineProperty(i,Symbol.toStringTag,{value:"Module"});const u=Md(),_=a=>{const{offsetWidth:f,offsetHeight:m}=a;return{width:f,height:m}},p=a=>a,o=a=>{const f=Math.max(a.startIndex-a.overscan,0),m=Math.min(a.endIndex+a.overscan,a.count-1),g=[];for(let y=f;y<=m;y++)g.push(y);return g},c=(a,f)=>{const m=a.scrollElement;if(!m)return;const g=a.targetWindow;if(!g)return;const y=x=>{const{width:C,height:S}=x;f({width:Math.round(C),height:Math.round(S)})};if(y(_(m)),!g.ResizeObserver)return()=>{};const O=new g.ResizeObserver(x=>{const C=()=>{const S=x[0];if(S!=null&&S.borderBoxSize){const E=S.borderBoxSize[0];if(E){y({width:E.inlineSize,height:E.blockSize});return}}y(_(m))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(C):C()});return O.observe(m,{box:"border-box"}),()=>{O.unobserve(m)}},r={passive:!0},s=(a,f)=>{const m=a.scrollElement;if(!m)return;const g=()=>{f({width:m.innerWidth,height:m.innerHeight})};return g(),m.addEventListener("resize",g,r),()=>{m.removeEventListener("resize",g)}},n=typeof window>"u"?!0:"onscrollend"in window,t=(a,f)=>{const m=a.scrollElement;if(!m)return;const g=a.targetWindow;if(!g)return;let y=0;const O=a.options.useScrollendEvent&&n?()=>{}:u.debounce(g,()=>{f(y,!1)},a.options.isScrollingResetDelay),x=I=>()=>{const{horizontal:j,isRtl:N}=a.options;y=j?m.scrollLeft*(N&&-1||1):m.scrollTop,O(),f(y,I)},C=x(!0),S=x(!1);S(),m.addEventListener("scroll",C,r);const E=a.options.useScrollendEvent&&n;return E&&m.addEventListener("scrollend",S,r),()=>{m.removeEventListener("scroll",C),E&&m.removeEventListener("scrollend",S)}},e=(a,f)=>{const m=a.scrollElement;if(!m)return;const g=a.targetWindow;if(!g)return;let y=0;const O=a.options.useScrollendEvent&&n?()=>{}:u.debounce(g,()=>{f(y,!1)},a.options.isScrollingResetDelay),x=I=>()=>{y=m[a.options.horizontal?"scrollX":"scrollY"],O(),f(y,I)},C=x(!0),S=x(!1);S(),m.addEventListener("scroll",C,r);const E=a.options.useScrollendEvent&&n;return E&&m.addEventListener("scrollend",S,r),()=>{m.removeEventListener("scroll",C),E&&m.removeEventListener("scrollend",S)}},l=(a,f,m)=>{if(f!=null&&f.borderBoxSize){const g=f.borderBoxSize[0];if(g)return Math.round(g[m.options.horizontal?"inlineSize":"blockSize"])}return a[m.options.horizontal?"offsetWidth":"offsetHeight"]},h=(a,{adjustments:f=0,behavior:m},g)=>{var y,O;const x=a+f;(O=(y=g.scrollElement)==null?void 0:y.scrollTo)==null||O.call(y,{[g.options.horizontal?"left":"top"]:x,behavior:m})},d=(a,{adjustments:f=0,behavior:m},g)=>{var y,O;const x=a+f;(O=(y=g.scrollElement)==null?void 0:y.scrollTo)==null||O.call(y,{[g.options.horizontal?"left":"top"]:x,behavior:m})};class w{constructor(f){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let m=null;const g=()=>m||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:m=new this.targetWindow.ResizeObserver(y=>{y.forEach(O=>{const x=()=>{this._measureElement(O.target,O)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()})}));return{disconnect:()=>{var y;(y=g())==null||y.disconnect(),m=null},observe:y=>{var O;return(O=g())==null?void 0:O.observe(y,{box:"border-box"})},unobserve:y=>{var O;return(O=g())==null?void 0:O.unobserve(y)}}})(),this.range=null,this.setOptions=m=>{Object.entries(m).forEach(([g,y])=>{typeof y>"u"&&delete m[g]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:p,rangeExtractor:o,onChange:()=>{},measureElement:l,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...m}},this.notify=m=>{var g,y;(y=(g=this.options).onChange)==null||y.call(g,this,m)},this.maybeNotify=u.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),m=>{this.notify(m)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(m=>m()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var m;const g=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==g){if(this.cleanup(),!g){this.maybeNotify();return}this.scrollElement=g,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((m=this.scrollElement)==null?void 0:m.window)??null,this.elementsCache.forEach(y=>{this.observer.observe(y)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,y=>{this.scrollRect=y,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(y,O)=>{this.scrollAdjustments=0,this.scrollDirection=O?this.getScrollOffset()<y?"forward":"backward":null,this.scrollOffset=y,this.isScrolling=O,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(m,g)=>{const y=new Map,O=new Map;for(let x=g-1;x>=0;x--){const C=m[x];if(y.has(C.lane))continue;const S=O.get(C.lane);if(S==null||C.end>S.end?O.set(C.lane,C):C.end<S.end&&y.set(C.lane,!0),y.size===this.options.lanes)break}return O.size===this.options.lanes?Array.from(O.values()).sort((x,C)=>x.end===C.end?x.index-C.index:x.end-C.end)[0]:void 0},this.getMeasurementOptions=u.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(m,g,y,O,x)=>(this.pendingMeasuredCacheIndexes=[],{count:m,paddingStart:g,scrollMargin:y,getItemKey:O,enabled:x}),{key:!1}),this.getMeasurements=u.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:m,paddingStart:g,scrollMargin:y,getItemKey:O,enabled:x},C)=>{if(!x)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(I=>{this.itemSizeCache.set(I.key,I.size)}));const S=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const E=this.measurementsCache.slice(0,S);for(let I=S;I<m;I++){const j=O(I),N=this.options.lanes===1?E[I-1]:this.getFurthestMeasurement(E,I),M=N?N.end+this.options.gap:g+y,A=C.get(j),D=typeof A=="number"?A:this.options.estimateSize(I),V=M+D,z=N?N.lane:I%this.options.lanes;E[I]={index:I,start:M,size:D,end:V,key:j,lane:z}}return this.measurementsCache=E,E},{key:!1,debug:()=>this.options.debug}),this.calculateRange=u.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(m,g,y,O)=>this.range=m.length>0&&g>0?v({measurements:m,outerSize:g,scrollOffset:y,lanes:O}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=u.memo(()=>{let m=null,g=null;const y=this.calculateRange();return y&&(m=y.startIndex,g=y.endIndex),this.maybeNotify.updateDeps([this.isScrolling,m,g]),[this.options.rangeExtractor,this.options.overscan,this.options.count,m,g]},(m,g,y,O,x)=>O===null||x===null?[]:m({startIndex:O,endIndex:x,overscan:g,count:y}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=m=>{const g=this.options.indexAttribute,y=m.getAttribute(g);return y?parseInt(y,10):(console.warn(`Missing attribute name '${g}={index}' on measured element.`),-1)},this._measureElement=(m,g)=>{const y=this.indexFromElement(m),O=this.measurementsCache[y];if(!O)return;const x=O.key,C=this.elementsCache.get(x);C!==m&&(C&&this.observer.unobserve(C),this.observer.observe(m),this.elementsCache.set(x,m)),m.isConnected&&this.resizeItem(y,this.options.measureElement(m,g,this))},this.resizeItem=(m,g)=>{const y=this.measurementsCache[m];if(!y)return;const O=this.itemSizeCache.get(y.key)??y.size,x=g-O;x!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(y,x,this):y.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=x,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(y.index),this.itemSizeCache=new Map(this.itemSizeCache.set(y.key,g)),this.notify(!1))},this.measureElement=m=>{if(!m){this.elementsCache.forEach((g,y)=>{g.isConnected||(this.observer.unobserve(g),this.elementsCache.delete(y))});return}this._measureElement(m,void 0)},this.getVirtualItems=u.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(m,g)=>{const y=[];for(let O=0,x=m.length;O<x;O++){const C=m[O],S=g[C];y.push(S)}return y},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=m=>{const g=this.getMeasurements();if(g.length!==0)return u.notUndefined(g[b(0,g.length-1,y=>u.notUndefined(g[y]).start,m)])},this.getOffsetForAlignment=(m,g,y=0)=>{const O=this.getSize(),x=this.getScrollOffset();g==="auto"&&(g=m>=x+O?"end":"start"),g==="center"?m+=(y-O)/2:g==="end"&&(m-=O);const C=this.getTotalSize()-O;return Math.max(Math.min(C,m),0)},this.getOffsetForIndex=(m,g="auto")=>{m=Math.max(0,Math.min(m,this.options.count-1));const y=this.measurementsCache[m];if(!y)return;const O=this.getSize(),x=this.getScrollOffset();if(g==="auto")if(y.end>=x+O-this.options.scrollPaddingEnd)g="end";else if(y.start<=x+this.options.scrollPaddingStart)g="start";else return[x,g];const C=g==="end"?y.end+this.options.scrollPaddingEnd:y.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(C,g,y.size),g]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(m,{align:g="start",behavior:y}={})=>{this.cancelScrollToIndex(),y==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(m,g),{adjustments:void 0,behavior:y})},this.scrollToIndex=(m,{align:g="auto",behavior:y}={})=>{m=Math.max(0,Math.min(m,this.options.count-1)),this.cancelScrollToIndex(),y==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const O=this.getOffsetForIndex(m,g);if(!O)return;const[x,C]=O;this._scrollToOffset(x,{adjustments:void 0,behavior:y}),y!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(m))){const[E]=u.notUndefined(this.getOffsetForIndex(m,C)),I=this.getScrollOffset();u.approxEqual(E,I)||this.scrollToIndex(m,{align:C,behavior:y})}else this.scrollToIndex(m,{align:C,behavior:y})}))},this.scrollBy=(m,{behavior:g}={})=>{this.cancelScrollToIndex(),g==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+m,{adjustments:void 0,behavior:g})},this.getTotalSize=()=>{var m;const g=this.getMeasurements();let y;if(g.length===0)y=this.options.paddingStart;else if(this.options.lanes===1)y=((m=g[g.length-1])==null?void 0:m.end)??0;else{const O=Array(this.options.lanes).fill(null);let x=g.length-1;for(;x>=0&&O.some(C=>C===null);){const C=g[x];O[C.lane]===null&&(O[C.lane]=C.end),x--}y=Math.max(...O.filter(C=>C!==null))}return Math.max(y-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(m,{adjustments:g,behavior:y})=>{this.options.scrollToFn(m,{behavior:y,adjustments:g},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(f)}}const b=(a,f,m,g)=>{for(;a<=f;){const y=(a+f)/2|0,O=m(y);if(O<g)a=y+1;else if(O>g)f=y-1;else return y}return a>0?a-1:0};function v({measurements:a,outerSize:f,scrollOffset:m,lanes:g}){const y=a.length-1,O=S=>a[S].start;if(a.length<=g)return{startIndex:0,endIndex:y};let x=b(0,y,O,m),C=x;if(g===1)for(;C<y&&a[C].end<m+f;)C++;else if(g>1){const S=Array(g).fill(0);for(;C<y&&S.some(I=>I<m+f);){const I=a[C];S[I.lane]=I.end,C++}const E=Array(g).fill(m+f);for(;x>=0&&E.some(I=>I>=m);){const I=a[x];E[I.lane]=I.start,x--}x=Math.max(0,x-x%g),C=Math.min(y,C+(g-1-C%g))}return{startIndex:x,endIndex:C}}i.approxEqual=u.approxEqual,i.debounce=u.debounce,i.memo=u.memo,i.notUndefined=u.notUndefined,i.Virtualizer=w,i.defaultKeyExtractor=p,i.defaultRangeExtractor=o,i.elementScroll=d,i.measureElement=l,i.observeElementOffset=t,i.observeElementRect=c,i.observeWindowOffset=e,i.observeWindowRect=s,i.windowScroll=h}(ri)),ri}var yo;function Dd(){return yo||(yo=1,function(i){Object.defineProperty(i,Symbol.toStringTag,{value:"Module"});const u=me(),_=Dc(),p=Pd();function o(e){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const h in e)if(h!=="default"){const d=Object.getOwnPropertyDescriptor(e,h);Object.defineProperty(l,h,d.get?d:{enumerable:!0,get:()=>e[h]})}}return l.default=e,Object.freeze(l)}const c=o(u),r=typeof document<"u"?c.useLayoutEffect:c.useEffect;function s(e){const l=c.useReducer(()=>({}),{})[1],h={...e,onChange:(w,b)=>{var v;b?_.flushSync(l):l(),(v=e.onChange)==null||v.call(e,w,b)}},[d]=c.useState(()=>new p.Virtualizer(h));return d.setOptions(h),r(()=>d._didMount(),[]),r(()=>d._willUpdate()),d}function n(e){return s({observeElementRect:p.observeElementRect,observeElementOffset:p.observeElementOffset,scrollToFn:p.elementScroll,...e})}function t(e){return s({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:p.observeWindowRect,observeElementOffset:p.observeWindowOffset,scrollToFn:p.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...e})}i.useVirtualizer=n,i.useWindowVirtualizer=t,Object.keys(p).forEach(e=>{e!=="default"&&!Object.prototype.hasOwnProperty.call(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:()=>p[e]})})}(ni)),ni}var ht={},_o;function qd(){if(_o)return ht;_o=1;var i=ht&&ht.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(ht,"__esModule",{value:!0}),ht.Cell=void 0;const u=i(me()),_=i(Bt()),p=({children:o,gutter:c,stickyRight:r,active:s,disabled:n,className:t,width:e,left:l})=>u.default.createElement("div",{className:(0,_.default)("dsg-cell",c&&"dsg-cell-gutter",n&&"dsg-cell-disabled",c&&s&&"dsg-cell-gutter-active",r&&"dsg-cell-sticky-right",t),style:{width:e,left:r?void 0:l}},o);return ht.Cell=p,ht}var gn={},Oo;function Bd(){if(Oo)return gn;Oo=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.useMemoizedIndexCallback=void 0;const i=me(),u=(_,p)=>(0,i.useMemo)(()=>{const o=new Map;return c=>(o.has(c)||o.set(c,(...r)=>{_(c,...r.slice(0,p))}),o.get(c))},[p,_]);return gn.useMemoizedIndexCallback=u,gn}var So;function Vd(){if(So)return Pe;So=1;var i=Pe&&Pe.__createBinding||(Object.create?function(e,l,h,d){d===void 0&&(d=h);var w=Object.getOwnPropertyDescriptor(l,h);(!w||("get"in w?!l.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return l[h]}}),Object.defineProperty(e,d,w)}:function(e,l,h,d){d===void 0&&(d=h),e[d]=l[h]}),u=Pe&&Pe.__setModuleDefault||(Object.create?function(e,l){Object.defineProperty(e,"default",{enumerable:!0,value:l})}:function(e,l){e.default=l}),_=Pe&&Pe.__importStar||function(e){if(e&&e.__esModule)return e;var l={};if(e!=null)for(var h in e)h!=="default"&&Object.prototype.hasOwnProperty.call(e,h)&&i(l,e,h);return u(l,e),l},p=Pe&&Pe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Grid=void 0;const o=Dd(),c=_(me()),r=p(Bt()),s=qd(),n=Bd(),t=({data:e,columns:l,outerRef:h,innerRef:d,columnWidths:w,hasStickyRightColumn:b,displayHeight:v,headerRowHeight:a,rowHeight:f,rowKey:m,fullWidth:g,selection:y,activeCell:O,rowClassName:x,cellClassName:C,children:S,editing:E,getContextMenuItems:I,setRowData:j,deleteRows:N,duplicateRows:M,insertRowAfter:A,stopEditing:D,onScroll:V})=>{var z,U,Z,se;const L=(0,o.useVirtualizer)({count:e.length,getScrollElement:()=>h.current,paddingStart:a,estimateSize:G=>f(G).height,getItemKey:G=>{if(m&&G>0){const ve=e[G-1];if(typeof m=="function")return m({rowData:ve,rowIndex:G});if(typeof m=="string"&&ve instanceof Object&&m in ve){const ge=ve[m];if(typeof ge=="string"||typeof ge=="number")return ge}}return G},overscan:5}),J=(0,o.useVirtualizer)({count:l.length,getScrollElement:()=>h.current,estimateSize:G=>{var ve;return(ve=w==null?void 0:w[G])!==null&&ve!==void 0?ve:100},horizontal:!0,getItemKey:G=>{var ve;return(ve=l[G].id)!==null&&ve!==void 0?ve:G},overscan:1,rangeExtractor:G=>{const ve=(0,o.defaultRangeExtractor)(G);return ve[0]!==0&&ve.unshift(0),b&&ve[ve.length-1]!==l.length-1&&ve.push(l.length-1),ve}});(0,c.useEffect)(()=>{J.measure()},[J,w]);const ce=(0,n.useMemoizedIndexCallback)(j,1),Y=(0,n.useMemoizedIndexCallback)(N,0),ye=(0,n.useMemoizedIndexCallback)(M,0),ee=(0,n.useMemoizedIndexCallback)(A,0),le=(z=y==null?void 0:y.min.col)!==null&&z!==void 0?z:O==null?void 0:O.col,be=(U=y==null?void 0:y.max.col)!==null&&U!==void 0?U:O==null?void 0:O.col,_e=(Z=y==null?void 0:y.min.row)!==null&&Z!==void 0?Z:O==null?void 0:O.row,xe=(se=y==null?void 0:y.max.row)!==null&&se!==void 0?se:O==null?void 0:O.row;return c.default.createElement("div",{ref:h,className:"dsg-container",onScroll:V,style:{height:v}},c.default.createElement("div",{ref:d,style:{width:g?"100%":J.getTotalSize(),height:L.getTotalSize()}},a>0&&c.default.createElement("div",{className:(0,r.default)("dsg-row","dsg-row-header"),style:{width:g?"100%":J.getTotalSize(),height:a}},J.getVirtualItems().map(G=>c.default.createElement(s.Cell,{key:G.key,gutter:G.index===0,stickyRight:b&&G.index===l.length-1,width:G.size,left:G.start,className:(0,r.default)("dsg-cell-header",le!==void 0&&be!==void 0&&le<=G.index-1&&be>=G.index-1&&"dsg-cell-header-active",l[G.index].headerClassName)},c.default.createElement("div",{className:"dsg-cell-header-container"},l[G.index].title)))),L.getVirtualItems().map(G=>{const ve=G.index>=(_e??1/0)&&G.index<=(xe??-1/0);return c.default.createElement("div",{key:G.key,className:(0,r.default)("dsg-row",typeof x=="string"?x:null,typeof x=="function"?x({rowData:e[G.index],rowIndex:G.index}):null),style:{height:G.size,top:G.start,width:g?"100%":J.getTotalSize()}},J.getVirtualItems().map(ge=>{const St=l[ge.index].cellClassName,xt=l[ge.index].disabled,Ir=l[ge.index].component,cr=xt===!0||typeof xt=="function"&&xt({rowData:e[G.index],rowIndex:G.index}),ur=(O==null?void 0:O.row)===G.index&&O.col===ge.index-1;return c.default.createElement(s.Cell,{key:ge.key,gutter:ge.index===0,stickyRight:b&&ge.index===l.length-1,active:ge.index===0&&ve,disabled:cr,className:(0,r.default)(typeof St=="function"?St({rowData:e[G.index],rowIndex:G.index,columnId:l[ge.index].id}):St,typeof C=="function"?C({rowData:e[G.index],rowIndex:G.index,columnId:l[ge.index].id}):C),width:ge.size,left:ge.start},c.default.createElement(Ir,{rowData:e[G.index],getContextMenuItems:I,disabled:cr,active:ur,columnIndex:ge.index-1,rowIndex:G.index,focus:ur&&E,deleteRow:Y(G.index),duplicateRow:ye(G.index),stopEditing:D,insertRowBelow:ee(G.index),setRowData:ce(G.index),columnData:l[ge.index].columnData}))}))}),S))};return Pe.Grid=t,Pe}var Je={},xo;function $d(){return xo||(xo=1,function(i){var u=Je&&Je.__createBinding||(Object.create?function(t,e,l,h){h===void 0&&(h=l);var d=Object.getOwnPropertyDescriptor(e,l);(!d||("get"in d?!e.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return e[l]}}),Object.defineProperty(t,h,d)}:function(t,e,l,h){h===void 0&&(h=l),t[h]=e[l]}),_=Je&&Je.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),p=Je&&Je.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var l in t)l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)&&u(e,t,l);return _(e,t),e},o=Je&&Je.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionRect=void 0;const c=p(me()),r=o(Bt()),s=(t,e,l,h)=>[[h,t],[e,t],[e,l],[h,l],[h,t]],n=(t,e,l,h)=>`polygon(evenodd, ${[...s(0,"100%","100%",0),...s(t,e,l,h)].map(w=>w.map(b=>typeof b=="number"&&b!==0?b+"px":b).join(" ")).join(",")})`;i.SelectionRect=c.default.memo(({columnWidths:t,columnRights:e,headerRowHeight:l,selection:h,rowHeight:d,activeCell:w,hasStickyRightColumn:b,dataLength:v,viewWidth:a,viewHeight:f,contentWidth:m,edges:g,isCellDisabled:y,editing:O,expandSelection:x})=>{var C,S,E,I;const j=w?y(w):!1,N=(0,c.useMemo)(()=>{if(!h)return j;for(let L=h.min.col;L<=h.max.col;++L)for(let J=h.min.row;J<=h.max.row;++J)if(!y({col:L,row:J}))return!1;return!0},[j,y,h]);if(!t||!e)return null;const M=L=>L<v-1?1:0,A=L=>L<t.length-(b?3:2)?1:0,D=w&&{width:t[w.col+1]+A(w.col),height:d(w.row).height+M(w.row),left:e[w.col],top:d(w.row).top+l},V=h&&{width:t.slice(h.min.col+1,h.max.col+2).reduce((L,J)=>L+J)+A(h.max.col),height:d(h.max.row).top+d(h.max.row).height-d(h.min.row).top+M(h.max.row),left:e[h.min.col],top:d(h.min.row).top+l},z=(h==null?void 0:h.min)||w,U=(h==null?void 0:h.max)||w,Z=U&&x!==null&&{left:e[U.col]+t[U.col+1],top:d(U.row).top+d(U.row).height+l,transform:`translate(-${U.col<t.length-(b?3:2)?50:100}%, -${U.row<v-1?50:100}%)`},se=z&&U&&x!==null&&{width:t.slice(z.col+1,U.col+2).reduce((L,J)=>L+J)+A(U.col),height:d(U.row+x).top+d(U.row+x).height-d(U.row+1).top+M(U.row+x)-1,left:e[z.col],top:d(U.row).top+d(U.row).height+l+1};return c.default.createElement(c.default.Fragment,null,c.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:d(v-1).top+d(v-1).height+l,width:m||"100%"}},c.default.createElement("div",{className:(0,r.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!g.top,"dsg-scrollable-view-r":!g.right,"dsg-scrollable-view-b":!g.bottom,"dsg-scrollable-view-l":!g.left}),style:{top:l,left:t[0],height:f?f-l:0,width:m&&a?a-t[0]-(b?t[t.length-1]:0):`calc(100% - ${t[0]+(b?t[t.length-1]:0)}px)`}})),(V||D)&&c.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(C=V==null?void 0:V.left)!==null&&C!==void 0?C:D==null?void 0:D.left,width:(S=V==null?void 0:V.width)!==null&&S!==void 0?S:D==null?void 0:D.width,height:d(v-1).top+d(v-1).height+l}},c.default.createElement("div",{className:(0,r.default)("dsg-selection-col-marker",N&&"dsg-selection-col-marker-disabled"),style:{top:l}})),(V||D)&&c.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(E=V==null?void 0:V.top)!==null&&E!==void 0?E:D==null?void 0:D.top,height:(I=V==null?void 0:V.height)!==null&&I!==void 0?I:D==null?void 0:D.height,width:m||"100%"}},c.default.createElement("div",{className:(0,r.default)("dsg-selection-row-marker",N&&"dsg-selection-row-marker-disabled"),style:{left:t[0]}})),D&&w&&c.default.createElement("div",{className:(0,r.default)("dsg-active-cell",{"dsg-active-cell-focus":O,"dsg-active-cell-disabled":j}),style:D}),V&&D&&c.default.createElement("div",{className:(0,r.default)("dsg-selection-rect",N&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},V),{clipPath:n(D.top-V.top,D.left-V.left,D.top+D.height-V.top,D.left+D.width-V.left)})}),se&&c.default.createElement("div",{className:(0,r.default)("dsg-expand-rows-rect"),style:se}),Z&&c.default.createElement("div",{className:(0,r.default)("dsg-expand-rows-indicator",N&&"dsg-expand-rows-indicator-disabled"),style:Z}))}),i.SelectionRect.displayName="SelectionRect"}(Je)),Je}var wn={},Co;function Ld(){if(Co)return wn;Co=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.useRowHeights=void 0;const i=me(),u=({value:_,rowHeight:p})=>{const o=(0,i.useRef)([]),[,c]=(0,i.useState)(0);return(0,i.useMemo)(()=>{const r=s=>{if(typeof p=="number")return Math.min(_.length-1,Math.max(-1,Math.floor(s/p)));let n=0,t=o.current.length-1;for(;n<=t;){const e=Math.floor((n+t)/2);if(o.current[e].top<s)n=e+1;else if(o.current[e].top>s)t=e-1;else return e}if(t===o.current.length-1&&_.length>o.current.length&&(!o.current.length||s>=o.current[t].top+o.current[t].height)){let e=t===-1?0:o.current[t].top+o.current[t].height;do{t++;const l=p({rowIndex:t,rowData:_[t]});o.current.push({height:l,top:e}),e+=l}while(e<=s&&t<o.current.length-1)}return t};return{resetAfter:s=>{o.current=o.current.slice(0,s),c(n=>n+1)},getRowSize:s=>{if(typeof p=="number")return{height:p,top:p*s};if(s>=_.length)return{height:0,top:0};if(s<o.current.length)return o.current[s];let n=o.current[o.current.length-1].top+o.current[o.current.length-1].height;for(let t=o.current.length;t<=s;t++){const e=p({rowIndex:t,rowData:_[t]});o.current.push({height:e,top:n}),n+=e}return o.current[s]},getRowIndex:r,totalSize:s=>{if(typeof p=="number")return _.length*p;const n=r(s);return o.current[n].top+o.current[n].height}}},[p,_])};return wn.useRowHeights=u,wn}var Eo;function Hl(){return Eo||(Eo=1,function(i){var u=Me&&Me.__createBinding||(Object.create?function(N,M,A,D){D===void 0&&(D=A);var V=Object.getOwnPropertyDescriptor(M,A);(!V||("get"in V?!M.__esModule:V.writable||V.configurable))&&(V={enumerable:!0,get:function(){return M[A]}}),Object.defineProperty(N,D,V)}:function(N,M,A,D){D===void 0&&(D=A),N[D]=M[A]}),_=Me&&Me.__setModuleDefault||(Object.create?function(N,M){Object.defineProperty(N,"default",{enumerable:!0,value:M})}:function(N,M){N.default=M}),p=Me&&Me.__importStar||function(N){if(N&&N.__esModule)return N;var M={};if(N!=null)for(var A in N)A!=="default"&&Object.prototype.hasOwnProperty.call(N,A)&&u(M,N,A);return _(M,N),M},o=Me&&Me.__awaiter||function(N,M,A,D){function V(z){return z instanceof A?z:new A(function(U){U(z)})}return new(A||(A=Promise))(function(z,U){function Z(J){try{L(D.next(J))}catch(ce){U(ce)}}function se(J){try{L(D.throw(J))}catch(ce){U(ce)}}function L(J){J.done?z(J.value):V(J.value).then(Z,se)}L((D=D.apply(N,M||[])).next())})},c=Me&&Me.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(i,"__esModule",{value:!0}),i.DataSheetGrid=void 0;const r=p(me()),s=vu(),n=Cd,t=Ed(),e=Nd(),l=zl(),h=Wl(),d=Id(),w=Gl(),b=Rd(),v=c(yl()),a=Jl(),f=kd(),m=Td(),g=Ad(),y=Vd(),O=$d(),x=Ld(),C=[],S=[],E=()=>({}),I=()=>null,j=({rowData:N})=>Object.assign({},N);i.DataSheetGrid=r.default.memo(r.default.forwardRef(({value:N=C,className:M,style:A,height:D=400,onChange:V=I,columns:z=S,rowHeight:U=40,headerRowHeight:Z=typeof U=="number"?U:40,gutterColumn:se,stickyRightColumn:L,rowKey:J,addRowsComponent:ce=w.AddRows,createRow:Y=E,autoAddRow:ye=!1,lockRows:ee=!1,disableExpandSelection:le=!1,disableSmartDelete:be=!1,duplicateRow:_e=j,contextMenuComponent:xe=a.ContextMenu,disableContextMenu:G=!1,onFocus:ve=I,onBlur:ge=I,onActiveCellChange:St=I,onSelectionChange:xt=I,rowClassName:Ir,cellClassName:cr,onScroll:ur},lc)=>{var Rr,jr,kr,Tr,Ar,Mr;const Ct=(0,r.useRef)(null),ns=G||ee,F=(0,t.useColumns)(z,se,L),ue=!!L,dr=(0,r.useRef)(null),ze=(0,r.useRef)(null),Pr=(0,r.useRef)(null),Dr=(0,r.useRef)(null),[cc,uc]=(0,b.useDebounceState)(1,100),{getRowSize:Et,totalSize:dc,getRowIndex:rs}=(0,x.useRowHeights)({value:N,rowHeight:U}),is=Math.min(D,Z+dc(D)+cc),{width:Nt,height:ct}=(0,n.useResizeDetector)({targetRef:ze,refreshMode:"throttle",refreshRate:100});uc(ct?is-ct:0);const fc=(0,e.useEdges)(ze,Nt,ct),{fullWidth:ss,totalWidth:hc,columnWidths:Ve,columnRights:We}=(0,s.useColumnWidths)(F,Nt),[It,$e]=(0,r.useState)(null),[Rt,pc]=(0,r.useState)([]),[de,Oe]=(0,r.useState)(!1),[jt,os]=(0,r.useState)(0),[kt,as]=(0,r.useState)(null),[k,oe]=(0,l.useDeepEqualState)(null),[Se,ne]=(0,l.useDeepEqualState)(null),T=(0,r.useMemo)(()=>k&&Se&&{min:{col:Math.min(k.col,Se.col),row:Math.min(k.row,Se.row)},max:{col:Math.max(k.col,Se.col),row:Math.max(k.row,Se.row)}},[k,Se]),[Ze,Tt]=(0,l.useDeepEqualState)({columns:!1,rows:!1,active:!1}),mc=le||de||Ze.active||(k==null?void 0:k.row)===(N==null?void 0:N.length)-1||(T==null?void 0:T.max.row)===(N==null?void 0:N.length)-1||k&&F.slice(((Rr=T==null?void 0:T.min.col)!==null&&Rr!==void 0?Rr:k.col)+1,((jr=T==null?void 0:T.max.col)!==null&&jr!==void 0?jr:k.col)+2).every(R=>R.disabled===!0)?null:jt,ls=(0,d.useGetBoundingClientRect)(dr),cs=(0,d.useGetBoundingClientRect)(ze);(0,r.useEffect)(()=>{var R;k!==null&&(document.activeElement.blur(),(R=window.getSelection())===null||R===void 0||R.removeAllRanges())},[k!==null]);const ut=(0,r.useCallback)((R,q=!1,B=!1)=>{const P=ls(q),H=B&&cs(q);if(P&&We&&Ve){let re=R.clientX-P.left,$=R.clientY-P.top;return H&&(R.clientY-H.top<=Z&&($=0),R.clientX-H.left<=Ve[0]&&(re=0),ue&&H.right-R.clientX<=Ve[Ve.length-1]&&(re=We[We.length-2]+1)),{col:We.findIndex(Q=>re<Q)-1,row:rs($-Z)}}return null},[We,Ve,N.length,ls,cs,Z,ue,rs]),je=(0,r.useRef)(N);je.current=N;const ke=(0,r.useCallback)(R=>{const q=F[R.col+1].disabled;return!!(typeof q=="function"?q({rowData:je.current[R.row],rowIndex:R.row}):q)},[F]),et=(0,r.useCallback)((R,q=1)=>{ee||(ne(null),Oe(!1),V([...je.current.slice(0,R+1),...new Array(q).fill(0).map(Y),...je.current.slice(R+1)],[{type:"CREATE",fromRowIndex:R+1,toRowIndex:R+1+q}]),oe(B=>({col:(B==null?void 0:B.col)||0,row:R+q,doNotScrollX:!0})))},[Y,ee,V,oe,ne]),At=(0,r.useCallback)((R,q=R)=>{ee||(V([...je.current.slice(0,q+1),...je.current.slice(R,q+1).map((B,P)=>_e({rowData:B,rowIndex:P+R})),...je.current.slice(q+1)],[{type:"CREATE",fromRowIndex:q+1,toRowIndex:q+2+q-R}]),oe({col:0,row:q+1,doNotScrollX:!0}),ne({col:F.length-(ue?3:2),row:2*q-R+1,doNotScrollX:!0}),Oe(!1))},[F.length,_e,ee,V,oe,ne,ue]),tt=(0,r.useCallback)(R=>{if(!(!ct||!Nt)){if(!R.doNotScrollY){const q=Et(R.row).top,B=Et(R.row).top+Et(R.row).height+Z-ct+1,P=ze.current.scrollTop;P>q?ze.current.scrollTop=q:P<B&&(ze.current.scrollTop=B)}if(We&&Ve&&ze.current&&!R.doNotScrollX){const q=We[R.col]-We[0],B=We[R.col]+Ve[R.col+1]+(ue?Ve[Ve.length-1]:0)-Nt+1,P=ze.current.scrollLeft;P>q?ze.current.scrollLeft=q:P<B&&(ze.current.scrollLeft=B)}}},[ct,Nt,Z,We,Ve,Et,ue]);(0,r.useEffect)(()=>{Se&&tt(Se)},[Se,tt]),(0,r.useEffect)(()=>{k&&tt(k)},[k,tt]);const bc=(0,r.useCallback)((R,q)=>{var B,P;V([...(B=je.current)===null||B===void 0?void 0:B.slice(0,R),q,...(P=je.current)===null||P===void 0?void 0:P.slice(R+1)],[{type:"UPDATE",fromRowIndex:R,toRowIndex:R+1}])},[V]),Mt=(0,r.useCallback)((R,q=R)=>{ee||(Oe(!1),oe(B=>{const P=Math.min(je.current.length-2-q+R,R);return P<0?null:B&&{col:B.col,row:P}}),ne(null),V([...je.current.slice(0,R),...je.current.slice(q+1)],[{type:"DELETE",fromRowIndex:R,toRowIndex:q+1}]))},[ee,V,oe,ne]),fr=(0,r.useCallback)((R=!0)=>{const q=R&&!be;if(!k)return;const B=(T==null?void 0:T.min)||k,P=(T==null?void 0:T.max)||k;if(N.slice(B.row,P.row+1).every((re,$)=>F.every(Q=>Q.isCellEmpty({rowData:re,rowIndex:$+B.row})))){q&&Mt(B.row,P.row);return}const H=[...N];for(let re=B.row;re<=P.row;++re)for(let $=B.col;$<=P.col;++$)if(!ke({col:$,row:re})){const{deleteValue:Q=({rowData:ae})=>ae}=F[$+1];H[re]=Q({rowData:H[re],rowIndex:re})}if(q&&(0,v.default)(H,N)){oe({col:0,row:B.row,doNotScrollX:!0}),ne({col:F.length-(ue?3:2),row:P.row,doNotScrollX:!0});return}V(H,[{type:"UPDATE",fromRowIndex:B.row,toRowIndex:P.row+1}])},[k,F,N,Mt,ke,V,T==null?void 0:T.max,T==null?void 0:T.min,oe,ne,ue]),qr=(0,r.useCallback)(({nextRow:R=!0}={})=>{(k==null?void 0:k.row)===je.current.length-1?R&&ye?et(k.row):Oe(!1):(Oe(!1),R&&oe(q=>q&&{col:q.col,row:q.row+1}))},[k==null?void 0:k.row,ye,et,oe]),$t=(0,r.useCallback)(R=>o(void 0,void 0,void 0,function*(){var q,B;if(!de&&k){const P=[],H=(T==null?void 0:T.min)||k,re=(T==null?void 0:T.max)||k;for(let X=H.row;X<=re.row;++X){P.push([]);for(let fe=H.col;fe<=re.col;++fe){const{copyValue:pe=()=>null}=F[fe+1];P[X-H.row].push(pe({rowData:N[X],rowIndex:X}))}}const $=P.map(X=>X.join("	")).join(`
`),Q=`<table>${P.map(X=>`<tr>${X.map(fe=>`<td>${(0,f.encodeHtml)(String(fe??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(R!==void 0){(q=R.clipboardData)===null||q===void 0||q.setData("text/plain",$),(B=R.clipboardData)===null||B===void 0||B.setData("text/html",Q),R.preventDefault();return}let ae=!1;if(navigator.clipboard.write!==void 0){const X=new Blob([$],{type:"text/plain"}),fe=new Blob([Q],{type:"text/html"}),pe=[new ClipboardItem({"text/plain":X,"text/html":fe})];yield navigator.clipboard.write(pe).then(()=>{ae=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText($).then(()=>{ae=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(ae=!0);ae||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[k,F,N,de,T]);(0,h.useDocumentEventListener)("copy",$t);const Br=(0,r.useCallback)(R=>{!de&&k&&($t(R),fr(!1))},[k,fr,de,$t]);(0,h.useDocumentEventListener)("cut",Br);const Lt=(0,r.useCallback)(R=>o(void 0,void 0,void 0,function*(){var q,B;if(!de&&k){const P=(T==null?void 0:T.min)||k,H=(T==null?void 0:T.max)||k,re=yield Promise.all(R[0].map(($,Q)=>{var ae,X;const fe=(ae=F[P.col+Q+1])===null||ae===void 0?void 0:ae.prePasteValues,pe=R.map(Te=>Te[Q]);return(X=fe==null?void 0:fe(pe))!==null&&X!==void 0?X:pe}));if(R=R.map(($,Q)=>re.map(ae=>ae[Q])),R.length===1){const $=[...N];for(let Q=0;Q<R[0].length;Q++){const ae=(q=F[P.col+Q+1])===null||q===void 0?void 0:q.pasteValue;if(ae)for(let X=P.row;X<=H.row;X++)ke({col:Q+P.col,row:X})||($[X]=yield ae({rowData:$[X],value:R[0][Q],rowIndex:X}))}V($,[{type:"UPDATE",fromRowIndex:P.row,toRowIndex:H.row+1}]),oe({col:P.col,row:P.row}),ne({col:Math.min(P.col+R[0].length-1,F.length-(ue?3:2)),row:H.row})}else{let $=[...N];const Q=P.row+R.length-N.length;Q>0&&(ee?R.splice(R.length-Q,Q):$=[...$,...new Array(Q).fill(0).map(()=>Y())]);for(let X=0;X<R[0].length&&P.col+X<F.length-(ue?2:1);X++){const fe=(B=F[P.col+X+1])===null||B===void 0?void 0:B.pasteValue;if(fe)for(let pe=0;pe<R.length;pe++)ke({col:P.col+X,row:P.row+pe})||($[P.row+pe]=yield fe({rowData:$[P.row+pe],value:R[pe][X],rowIndex:P.row+pe}))}const ae=[{type:"UPDATE",fromRowIndex:P.row,toRowIndex:P.row+R.length-(!ee&&Q>0?Q:0)}];Q>0&&!ee&&ae.push({type:"CREATE",fromRowIndex:P.row+R.length-Q,toRowIndex:P.row+R.length}),V($,ae),oe({col:P.col,row:P.row}),ne({col:Math.min(P.col+R[0].length-1,F.length-(ue?3:2)),row:P.row+R.length-1})}}}),[k,F,Y,N,de,ue,ke,ee,V,T==null?void 0:T.max,T==null?void 0:T.min,oe,ne]),vc=(0,r.useCallback)(R=>{var q,B,P,H,re,$;if(k&&!de){let Q=[[""]];!((q=R.clipboardData)===null||q===void 0)&&q.types.includes("text/html")?Q=(0,f.parseTextHtmlData)((B=R.clipboardData)===null||B===void 0?void 0:B.getData("text/html")):!((P=R.clipboardData)===null||P===void 0)&&P.types.includes("text/plain")?Q=(0,f.parseTextPlainData)((H=R.clipboardData)===null||H===void 0?void 0:H.getData("text/plain")):!((re=R.clipboardData)===null||re===void 0)&&re.types.includes("text")&&(Q=(0,f.parseTextPlainData)(($=R.clipboardData)===null||$===void 0?void 0:$.getData("text"))),Lt(Q),R.preventDefault()}},[k,Lt,de]);(0,h.useDocumentEventListener)("paste",vc);const gc=(0,r.useCallback)(R=>{var q,B,P;if(It&&Rt.length)return;const H=R.button===2||R.button===0&&R.ctrlKey,re=((q=dr.current)===null||q===void 0?void 0:q.contains(R.target))||!1,$=re?ut(R,!0,!0):null;if(!re&&de&&k&&F[k.col+1].keepFocus)return;if(R.target instanceof HTMLElement&&R.target.className.includes("dsg-expand-rows-indicator")){as(Math.max((B=k==null?void 0:k.row)!==null&&B!==void 0?B:0,(P=T==null?void 0:T.max.row)!==null&&P!==void 0?P:0));return}const Q=$&&k&&k.col===$.col&&k.row===$.row&&!ke(k);if(Q&&de)return;const ae=($==null?void 0:$.col)===F.length-2&&ue,X=H&&T&&$&&$.row>=T.min.row&&$.row<=T.max.row&&$.col>=T.min.col&&$.col<=T.max.col,fe=H&&T&&$&&$.row===-1&&$.col>=T.min.col&&$.col<=T.max.col,pe=H&&T&&$&&$.row>=T.min.row&&$.row<=T.max.row&&$.col===-1,Te=ae&&T&&$&&$.row>=T.min.row&&$.row<=T.max.row;if(H&&!ns&&$e({x:R.clientX,y:R.clientY,cursorIndex:$}),(!(R.shiftKey&&k)||H)&&N.length>0&&oe($&&{col:(X||fe)&&k?k.col:Math.max(0,ae?0:$.col),row:(X||pe||Te)&&k?k.row:Math.max(0,$.row),doNotScrollX:!!(X&&k||ae||$.col===-1),doNotScrollY:!!(X&&k||$.row===-1)}),Q&&!H&&(Ct.current=k),Oe(!!(Q&&!H)),Tt($&&!H?{columns:$.col!==-1&&!ae||!!(R.shiftKey&&k),rows:$.row!==-1||!!(R.shiftKey&&k),active:!0}:{columns:!1,rows:!1,active:!1}),R.shiftKey&&k&&!H)ne($&&{col:Math.max(0,$.col-(ae?1:0)),row:Math.max(0,$.row)});else if(!X){if($&&(($==null?void 0:$.col)===-1||($==null?void 0:$.row)===-1||ae)){let Ne=$.col,Ae=$.row,Ie=!1,Le=!1;($.col===-1||ae)&&(Ne=F.length-(ue?3:2),Ie=!0),$.row===-1&&(Ae=N.length-1,Le=!0),fe&&Se&&(Ne=Se.col,Le=!0),(pe||Te)&&Se&&(Ae=Se.row,Ie=!0),ne({col:Ne,row:Ae,doNotScrollX:Ie,doNotScrollY:Le})}else ne(null);re&&R.preventDefault()}},[It,Rt.length,ut,de,k,F,ke,T,ue,ns,Tt,oe,ne,Se,N.length]);(0,h.useDocumentEventListener)("mousedown",gc);const wc=(0,r.useCallback)(()=>{var R,q,B,P,H,re,$,Q,ae;if(kt!==null){if(jt>0&&k){let X=[];const fe=(T==null?void 0:T.min)||k,pe=(T==null?void 0:T.max)||k;for(let Te=fe.row;Te<=pe.row;++Te){X.push([]);for(let Ne=fe.col;Ne<=pe.col;++Ne){const{copyValue:Ae=()=>null}=F[Ne+1];X[Te-fe.row].push(String((R=Ae({rowData:N[Te],rowIndex:Te}))!==null&&R!==void 0?R:""))}}Promise.all(X[0].map((Te,Ne)=>{var Ae,Ie;const Le=(Ae=F[fe.col+Ne+1])===null||Ae===void 0?void 0:Ae.prePasteValues,Ue=X.map(xc=>xc[Ne]);return(Ie=Le==null?void 0:Le(Ue))!==null&&Ie!==void 0?Ie:Ue})).then(Te=>{var Ne;X=X.map((Ie,Le)=>Te.map(Ue=>Ue[Le]));const Ae=[...N];for(let Ie=0;Ie<X[0].length;Ie++){const Le=(Ne=F[fe.col+Ie+1])===null||Ne===void 0?void 0:Ne.pasteValue;if(Le)for(let Ue=pe.row+1;Ue<=pe.row+jt;Ue++)ke({col:Ie+fe.col,row:Ue})||(Ae[Ue]=Le({rowData:Ae[Ue],value:X[(Ue-pe.row-1)%X.length][Ie],rowIndex:Ue}))}V(Ae,[{type:"UPDATE",fromRowIndex:pe.row+1,toRowIndex:pe.row+1+jt}])}),os(0),oe({col:Math.min((q=k==null?void 0:k.col)!==null&&q!==void 0?q:1/0,(B=T==null?void 0:T.min.col)!==null&&B!==void 0?B:1/0),row:Math.min((P=k==null?void 0:k.row)!==null&&P!==void 0?P:1/0,(H=T==null?void 0:T.min.row)!==null&&H!==void 0?H:1/0),doNotScrollX:!0,doNotScrollY:!0}),ne({col:Math.max((re=k==null?void 0:k.col)!==null&&re!==void 0?re:0,($=T==null?void 0:T.max.col)!==null&&$!==void 0?$:0),row:Math.max((Q=k==null?void 0:k.row)!==null&&Q!==void 0?Q:0,(ae=T==null?void 0:T.max.row)!==null&&ae!==void 0?ae:0)+jt})}as(null)}Tt({columns:!1,rows:!1,active:!1})},[kt,Tt,jt,k,T==null?void 0:T.min,T==null?void 0:T.max,N,V,oe,ne,F,ke]);(0,h.useDocumentEventListener)("mouseup",wc);const yc=(0,r.useCallback)(R=>{if(kt!==null){const q=ut(R);q&&(os(Math.max(0,q.row-kt)),tt({col:q.col,row:Math.max(q.row,kt)}))}if(Ze.active){const q=ut(R),B=F.length-(ue?3:2);ne(q&&{col:Ze.columns?Math.max(0,Math.min(B,q.col)):B,row:Ze.rows?Math.max(0,q.row):N.length-1,doNotScrollX:!Ze.columns,doNotScrollY:!Ze.rows}),Oe(!1)}},[tt,Ze.active,Ze.columns,Ze.rows,ut,F.length,ue,ne,N.length,kt]);(0,h.useDocumentEventListener)("mousemove",yc);const _c=(0,r.useCallback)(R=>{var q;if(k&&!R.isComposing){if(R.key==="Tab"&&!R.shiftKey&&k.col===F.length-(ue?3:2)&&!F[k.col+1].disableKeys)if(k.row===N.length-1){if(Dr.current){R.preventDefault(),oe(null),ne(null),Oe(!1);const B=(0,g.getAllTabbableElements)(),P=B.indexOf(Dr.current);B[(P+1)%B.length].focus();return}}else{oe(B=>{var P;return{col:0,row:((P=B==null?void 0:B.row)!==null&&P!==void 0?P:0)+1}}),ne(null),Oe(!1),R.preventDefault();return}if(R.key==="Tab"&&R.shiftKey&&k.col===0&&!F[k.col+1].disableKeys)if(k.row===0){if(Pr.current){R.preventDefault(),oe(null),ne(null),Oe(!1);const B=(0,g.getAllTabbableElements)(),P=B.indexOf(Pr.current);B[(P-1+B.length)%B.length].focus();return}}else{oe(B=>{var P;return{col:F.length-(ue?3:2),row:((P=B==null?void 0:B.row)!==null&&P!==void 0?P:1)-1}}),ne(null),Oe(!1),R.preventDefault();return}if(!((q=R.key)===null||q===void 0)&&q.startsWith("Arrow")||R.key==="Tab"){if(de&&F[k.col+1].disableKeys||de&&["ArrowLeft","ArrowRight"].includes(R.key))return;const B=([P,H],re)=>re&&{col:Math.max(0,Math.min(F.length-(ue?3:2),re.col+P)),row:Math.max(0,Math.min(N.length-1,re.row+H))};if(R.key==="Tab"&&R.shiftKey)oe(P=>B([-1,0],P)),ne(null);else{const P={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[R.key];(R.ctrlKey||R.metaKey)&&(P[0]*=F.length,P[1]*=N.length),R.shiftKey?ne(H=>B(P,H||k)):(oe(H=>B(P,H)),ne(null))}Oe(!1),R.preventDefault()}else R.key==="Escape"?(!de&&!Se&&oe(null),ne(null),Oe(!1)):(R.key==="Enter"||R.key==="F2")&&!R.ctrlKey&&!R.metaKey&&!R.altKey&&!R.shiftKey?(ne(null),de?F[k.col+1].disableKeys||(qr(),R.preventDefault()):ke(k)||(Ct.current=k,Oe(!0),tt(k),R.preventDefault())):R.key==="Enter"&&!R.ctrlKey&&!R.metaKey&&!R.altKey&&R.shiftKey?et((T==null?void 0:T.max.row)||k.row):R.key==="d"&&(R.ctrlKey||R.metaKey)&&!R.altKey&&!R.shiftKey?(At((T==null?void 0:T.min.row)||k.row,T==null?void 0:T.max.row),R.preventDefault()):((0,f.isPrintableUnicode)(R.key)||R.code.match(/Key[A-Z]$/))&&!R.ctrlKey&&!R.metaKey&&!R.altKey?!de&&!ke(k)&&(Ct.current=k,ne(null),Oe(!0),tt(k)):["Backspace","Delete"].includes(R.key)?de||(fr(),R.preventDefault()):R.key==="a"&&(R.ctrlKey||R.metaKey)&&(de||(oe({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),ne({col:F.length-(ue?3:2),row:N.length-1,doNotScrollY:!0,doNotScrollX:!0}),R.preventDefault()))}},[k,F,N.length,fr,At,de,et,ke,tt,T==null?void 0:T.max.row,T==null?void 0:T.min.row,Se,oe,ne,qr,ue]);(0,h.useDocumentEventListener)("keydown",_c);const Oc=(0,r.useCallback)(R=>{var q;const B=((q=dr.current)===null||q===void 0?void 0:q.contains(R.target))||!1,P=B?ut(R,!0,!0):null,H=P&&k&&k.col===P.col&&k.row===P.row&&de;B&&!H&&R.preventDefault()},[ut,k,de]);(0,h.useDocumentEventListener)("contextmenu",Oc),(0,r.useEffect)(()=>{const R=[];(k==null?void 0:k.row)!==void 0&&R.push({type:"COPY",action:()=>{$t(),$e(null)}},{type:"CUT",action:()=>{Br(),$e(null)}},{type:"PASTE",action:()=>o(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(B=>o(void 0,void 0,void 0,function*(){let P=[[""]];if(B.types.includes("text/html")){const H=yield B.getType("text/html");P=(0,f.parseTextHtmlData)(yield H.text())}else if(B.types.includes("text/plain")){const H=yield B.getType("text/plain");P=(0,f.parseTextPlainData)(yield H.text())}else if(B.types.includes("text")){const H=yield B.getType("text");P=(0,f.parseTextHtmlData)(yield H.text())}Lt(P)}));else if(navigator.clipboard.readText!==void 0){const q=yield navigator.clipboard.readText();Lt((0,f.parseTextPlainData)(q))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");$e(null)})}),(T==null?void 0:T.max.row)!==void 0?R.push({type:"INSERT_ROW_BELLOW",action:()=>{$e(null),et(T.max.row)}}):(k==null?void 0:k.row)!==void 0&&R.push({type:"INSERT_ROW_BELLOW",action:()=>{$e(null),et(k.row)}}),(T==null?void 0:T.min.row)!==void 0&&T.min.row!==T.max.row?R.push({type:"DUPLICATE_ROWS",fromRow:T.min.row+1,toRow:T.max.row+1,action:()=>{$e(null),At(T.min.row,T.max.row)}}):(k==null?void 0:k.row)!==void 0&&R.push({type:"DUPLICATE_ROW",action:()=>{$e(null),At(k.row)}}),(T==null?void 0:T.min.row)!==void 0&&T.min.row!==T.max.row?R.push({type:"DELETE_ROWS",fromRow:T.min.row+1,toRow:T.max.row+1,action:()=>{$e(null),Mt(T.min.row,T.max.row)}}):(k==null?void 0:k.row)!==void 0&&R.push({type:"DELETE_ROW",action:()=>{$e(null),Mt(k.row)}}),pc(R),R.length||$e(null)},[T,k,Mt,At,et,Br,$t,Lt]);const us=(0,r.useRef)(Rt);us.current=Rt;const Sc=(0,r.useCallback)(()=>us.current,[]);(0,r.useImperativeHandle)(lc,()=>({activeCell:(0,m.getCellWithId)(k,F),selection:(0,m.getSelectionWithId)(T??(k?{min:k,max:k}:null),F),setSelection:R=>{const q=(0,m.getSelection)(R,F.length-(ue?2:1),N.length,F);oe((q==null?void 0:q.min)||null),Oe(!1),Tt({columns:!1,active:!1,rows:!1}),ne((q==null?void 0:q.max)||null)},setActiveCell:R=>{const q=(0,m.getCell)(R,F.length-(ue?2:1),N.length,F);oe(q),Oe(!1),Tt({columns:!1,active:!1,rows:!1}),ne(null)}}));const ot=(0,r.useRef)({onFocus:ve,onBlur:ge,onActiveCellChange:St,onSelectionChange:xt});return ot.current.onFocus=ve,ot.current.onBlur=ge,ot.current.onActiveCellChange=St,ot.current.onSelectionChange=xt,(0,r.useEffect)(()=>{Ct.current&&(de?ot.current.onFocus({cell:(0,m.getCellWithId)(Ct.current,F)}):ot.current.onBlur({cell:(0,m.getCellWithId)(Ct.current,F)}))},[de,F]),(0,r.useEffect)(()=>{ot.current.onActiveCellChange({cell:(0,m.getCellWithId)(k,F)})},[k==null?void 0:k.col,k==null?void 0:k.row,F]),(0,r.useEffect)(()=>{ot.current.onSelectionChange({selection:(0,m.getSelectionWithId)(T??(k?{min:k,max:k}:null),F)})},[(kr=T==null?void 0:T.min.col)!==null&&kr!==void 0?kr:k==null?void 0:k.col,(Tr=T==null?void 0:T.min.row)!==null&&Tr!==void 0?Tr:k==null?void 0:k.row,(Ar=T==null?void 0:T.max.col)!==null&&Ar!==void 0?Ar:k==null?void 0:k.col,(Mr=T==null?void 0:T.max.row)!==null&&Mr!==void 0?Mr:k==null?void 0:k.row,k==null?void 0:k.col,k==null?void 0:k.row,F]),r.default.createElement("div",{className:M,style:A},r.default.createElement("div",{ref:Pr,tabIndex:z.length&&N.length?0:void 0,onFocus:R=>{R.target.blur(),oe({col:0,row:0})}}),r.default.createElement(y.Grid,{columns:F,outerRef:ze,columnWidths:Ve,hasStickyRightColumn:ue,displayHeight:is,data:N,fullWidth:ss,headerRowHeight:Z,activeCell:k,innerRef:dr,rowHeight:Et,rowKey:J,selection:T,rowClassName:Ir,editing:de,getContextMenuItems:Sc,setRowData:bc,deleteRows:Mt,insertRowAfter:et,duplicateRows:At,stopEditing:qr,cellClassName:cr,onScroll:ur},r.default.createElement(O.SelectionRect,{columnRights:We,columnWidths:Ve,activeCell:k,selection:T,headerRowHeight:Z,rowHeight:Et,hasStickyRightColumn:ue,dataLength:N.length,viewHeight:ct,viewWidth:Nt,contentWidth:ss?void 0:hc,edges:fc,editing:de,isCellDisabled:ke,expandSelection:mc})),r.default.createElement("div",{ref:Dr,tabIndex:z.length&&N.length?0:void 0,onFocus:R=>{R.target.blur(),oe({col:F.length-(ue?3:2),row:N.length-1})}}),!ee&&ce&&r.default.createElement(ce,{addRows:R=>et(N.length-1,R)}),It&&Rt.length>0&&r.default.createElement(xe,{clientX:It.x,clientY:It.y,cursorIndex:It.cursorIndex,items:Rt,close:()=>$e(null)}))})),i.DataSheetGrid.displayName="DataSheetGrid"}(Me)),Me}var st={},No;function Ud(){if(No)return st;No=1;var i=st&&st.__rest||function(c,r){var s={};for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&r.indexOf(n)<0&&(s[n]=c[n]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,n=Object.getOwnPropertySymbols(c);t<n.length;t++)r.indexOf(n[t])<0&&Object.prototype.propertyIsEnumerable.call(c,n[t])&&(s[n[t]]=c[n[t]]);return s},u=st&&st.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(st,"__esModule",{value:!0}),st.StaticDataSheetGrid=void 0;const _=me(),p=Hl(),o=u(me());return st.StaticDataSheetGrid=o.default.forwardRef((c,r)=>{var{columns:s,gutterColumn:n,stickyRightColumn:t,addRowsComponent:e,createRow:l,duplicateRow:h,style:d,rowKey:w,onFocus:b,onBlur:v,onActiveCellChange:a,onSelectionChange:f,rowClassName:m,rowHeight:g}=c,y=i(c,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[O]=(0,_.useState)({columns:s,gutterColumn:n,stickyRightColumn:t,addRowsComponent:e,createRow:l,duplicateRow:h,style:d,rowKey:w,onFocus:b,onBlur:v,onActiveCellChange:a,onSelectionChange:f,rowClassName:m,rowHeight:g});return o.default.createElement(p.DataSheetGrid,Object.assign({},O,y,{rowHeight:typeof g=="number"?g:O.rowHeight,ref:r}))}),st}var Ce={},yn={},Io;function Fd(){if(Io)return yn;Io=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.useFirstRender=void 0;const i=me(),u=()=>{const _=(0,i.useRef)(!0),p=_.current;return _.current=!1,p};return yn.useFirstRender=u,yn}var Ro;function Cr(){if(Ro)return Ce;Ro=1;var i=Ce&&Ce.__createBinding||(Object.create?function(t,e,l,h){h===void 0&&(h=l);var d=Object.getOwnPropertyDescriptor(e,l);(!d||("get"in d?!e.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return e[l]}}),Object.defineProperty(t,h,d)}:function(t,e,l,h){h===void 0&&(h=l),t[h]=e[l]}),u=Ce&&Ce.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),_=Ce&&Ce.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var l in t)l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)&&i(e,t,l);return u(e,t),e},p=Ce&&Ce.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.createTextColumn=Ce.textColumn=void 0;const o=_(me()),c=p(Bt()),r=Fd(),s=o.default.memo(({active:t,focus:e,rowData:l,setRowData:h,columnData:{placeholder:d,alignRight:w,formatInputOnFocus:b,formatBlurredInput:v,parseUserInput:a,continuousUpdates:f}})=>{const m=(0,o.useRef)(null),g=(0,r.useFirstRender)(),y=(0,o.useRef)({rowData:l,formatInputOnFocus:b,formatBlurredInput:v,setRowData:h,parseUserInput:a,continuousUpdates:f,firstRender:g,focusedAt:0,changedAt:0,escPressed:!1});return y.current={rowData:l,formatInputOnFocus:b,formatBlurredInput:v,setRowData:h,parseUserInput:a,continuousUpdates:f,firstRender:g,focusedAt:y.current.focusedAt,changedAt:y.current.changedAt,escPressed:y.current.escPressed},(0,o.useLayoutEffect)(()=>{e?(m.current&&(m.current.value=y.current.formatInputOnFocus(y.current.rowData),m.current.focus(),m.current.select()),y.current.escPressed=!1,y.current.focusedAt=Date.now()):m.current&&(!y.current.escPressed&&!y.current.continuousUpdates&&!y.current.firstRender&&y.current.changedAt>=y.current.focusedAt&&y.current.setRowData(y.current.parseUserInput(m.current.value)),m.current.blur())},[e]),(0,o.useEffect)(()=>{!e&&m.current&&(m.current.value=y.current.formatBlurredInput(l))},[e,l]),o.default.createElement("input",{defaultValue:v(l),className:(0,c.default)("dsg-input",w&&"dsg-input-align-right"),placeholder:t?d:void 0,tabIndex:-1,ref:m,style:{pointerEvents:e?"auto":"none"},onChange:O=>{y.current.changedAt=Date.now(),f&&h(a(O.target.value))},onKeyDown:O=>{O.key==="Escape"&&(y.current.escPressed=!0)}})});s.displayName="TextComponent",Ce.textColumn=n();function n({placeholder:t,alignRight:e=!1,continuousUpdates:l=!0,deletedValue:h=null,parseUserInput:d=f=>f.trim()||null,formatBlurredInput:w=f=>String(f??""),formatInputOnFocus:b=f=>String(f??""),formatForCopy:v=f=>String(f??""),parsePastedValue:a=f=>f.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:s,columnData:{placeholder:t,alignRight:e,continuousUpdates:l,formatInputOnFocus:b,formatBlurredInput:w,parseUserInput:d},deleteValue:()=>h,copyValue:({rowData:f})=>v(f),pasteValue:({value:f})=>a(f),isCellEmpty:({rowData:f})=>f==null}}return Ce.createTextColumn=n,Ce}var He={},jo;function zd(){if(jo)return He;jo=1;var i=He&&He.__createBinding||(Object.create?function(r,s,n,t){t===void 0&&(t=n);var e=Object.getOwnPropertyDescriptor(s,n);(!e||("get"in e?!s.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(r,t,e)}:function(r,s,n,t){t===void 0&&(t=n),r[t]=s[n]}),u=He&&He.__setModuleDefault||(Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s}),_=He&&He.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var n in r)n!=="default"&&Object.prototype.hasOwnProperty.call(r,n)&&i(s,r,n);return u(s,r),s};Object.defineProperty(He,"__esModule",{value:!0}),He.checkboxColumn=void 0;const p=_(me()),o=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],c=p.default.memo(({focus:r,rowData:s,setRowData:n,active:t,stopEditing:e,disabled:l})=>{const h=(0,p.useRef)(null);return(0,p.useLayoutEffect)(()=>{r&&(n(!s),e({nextRow:!1}))},[r,e]),p.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:h,disabled:l,checked:!!s,onMouseDown:()=>!t&&n(!s),onChange:()=>null})});return c.displayName="CheckboxComponent",He.checkboxColumn={component:c,deleteValue:()=>!1,copyValue:({rowData:r})=>r?"YES":"NO",pasteValue:({value:r})=>!o.includes(r.toLowerCase()),isCellEmpty:({rowData:r})=>!r},He}var _n={},ko;function Wd(){if(ko)return _n;ko=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.floatColumn=void 0;const i=Cr();return _n.floatColumn=(0,i.createTextColumn)({alignRight:!0,formatBlurredInput:u=>typeof u=="number"?new Intl.NumberFormat().format(u):"",parseUserInput:u=>{const _=parseFloat(u);return isNaN(_)?null:_},parsePastedValue:u=>{const _=parseFloat(u);return isNaN(_)?null:_}}),_n}var On={},To;function Gd(){if(To)return On;To=1,Object.defineProperty(On,"__esModule",{value:!0}),On.intColumn=void 0;const i=Cr();return On.intColumn=(0,i.createTextColumn)({alignRight:!0,formatBlurredInput:u=>typeof u=="number"?new Intl.NumberFormat().format(u):"",parseUserInput:u=>{const _=parseFloat(u);return isNaN(_)?null:Math.round(_)},parsePastedValue:u=>{const _=parseFloat(u);return isNaN(_)?null:Math.round(_)}}),On}var Sn={},Ao;function Jd(){if(Ao)return Sn;Ao=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.percentColumn=void 0;const i=Cr(),u=1e12,_=1e10;return Sn.percentColumn=(0,i.createTextColumn)({alignRight:!0,formatBlurredInput:p=>typeof p=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(p):"",formatInputOnFocus:p=>typeof p=="number"&&!isNaN(p)?String(Math.round(p*u)/_):"",parseUserInput:p=>{const o=parseFloat(p);return isNaN(o)?null:o/100},parsePastedValue:p=>{const o=parseFloat(p);return isNaN(o)?null:o}}),Sn}var De={},Mo;function Hd(){if(Mo)return De;Mo=1;var i=De&&De.__createBinding||(Object.create?function(s,n,t,e){e===void 0&&(e=t);var l=Object.getOwnPropertyDescriptor(n,t);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(s,e,l)}:function(s,n,t,e){e===void 0&&(e=t),s[e]=n[t]}),u=De&&De.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),_=De&&De.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&i(n,s,t);return u(n,s),n},p=De&&De.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(De,"__esModule",{value:!0}),De.dateColumn=void 0;const o=_(me()),c=p(Bt()),r=o.default.memo(({focus:s,active:n,rowData:t,setRowData:e})=>{var l;const h=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var d,w;s?(d=h.current)===null||d===void 0||d.select():(w=h.current)===null||w===void 0||w.blur()},[s]),o.default.createElement("input",{className:(0,c.default)("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:h,style:{pointerEvents:s?"auto":"none",opacity:t||n?void 0:0},value:(l=t==null?void 0:t.toISOString().substr(0,10))!==null&&l!==void 0?l:"",onChange:d=>{const w=new Date(d.target.value);e(isNaN(w.getTime())?null:w)}})});return r.displayName="DateComponent",De.dateColumn={component:r,deleteValue:()=>null,copyValue:({rowData:s})=>s?s.toISOString().substr(0,10):null,pasteValue:({value:s})=>{const n=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(n.getTime())?null:n},minWidth:170,isCellEmpty:({rowData:s})=>!s},De}var qe={},Po;function Kd(){if(Po)return qe;Po=1;var i=qe&&qe.__createBinding||(Object.create?function(s,n,t,e){e===void 0&&(e=t);var l=Object.getOwnPropertyDescriptor(n,t);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(s,e,l)}:function(s,n,t,e){e===void 0&&(e=t),s[e]=n[t]}),u=qe&&qe.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),_=qe&&qe.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&i(n,s,t);return u(n,s),n},p=qe&&qe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(qe,"__esModule",{value:!0}),qe.isoDateColumn=void 0;const o=_(me()),c=p(Bt()),r=o.default.memo(({focus:s,active:n,rowData:t,setRowData:e})=>{const l=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var h,d;s?(h=l.current)===null||h===void 0||h.select():(d=l.current)===null||d===void 0||d.blur()},[s]),o.default.createElement("input",{className:(0,c.default)("dsg-input",!n&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:l,style:{pointerEvents:s?"auto":"none",opacity:t||n?void 0:0},value:t??"",onChange:h=>{const d=new Date(h.target.value);e(isNaN(d.getTime())?null:d.toISOString().substr(0,10))}})});return r.displayName="IsoDateComponent",qe.isoDateColumn={component:r,deleteValue:()=>null,copyValue:({rowData:s})=>s,pasteValue:({value:s})=>{const n=new Date(s.replace(/\.\s?|\//g,"-"));return isNaN(n.getTime())?null:n.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:s})=>!s},qe}var Be={},Do;function Xd(){if(Do)return Be;Do=1;var i=Be&&Be.__createBinding||(Object.create?function(s,n,t,e){e===void 0&&(e=t);var l=Object.getOwnPropertyDescriptor(n,t);(!l||("get"in l?!n.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(s,e,l)}:function(s,n,t,e){e===void 0&&(e=t),s[e]=n[t]}),u=Be&&Be.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),_=Be&&Be.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&i(n,s,t);return u(n,s),n},p=Be&&Be.__rest||function(s,n){var t={};for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&n.indexOf(e)<0&&(t[e]=s[e]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,e=Object.getOwnPropertySymbols(s);l<e.length;l++)n.indexOf(e[l])<0&&Object.prototype.propertyIsEnumerable.call(s,e[l])&&(t[e[l]]=s[e[l]]);return t};Object.defineProperty(Be,"__esModule",{value:!0}),Be.keyColumn=void 0;const o=_(me()),c=s=>{var{columnData:{key:n,original:t},rowData:e,setRowData:l}=s,h=p(s,["columnData","rowData","setRowData"]);const d=(0,o.useRef)(e);d.current=e;const w=(0,o.useCallback)(v=>{l(Object.assign(Object.assign({},d.current),{[n]:v}))},[n,l]);if(!t.component)return o.default.createElement(o.default.Fragment,null);const b=t.component;return o.default.createElement(b,Object.assign({columnData:t.columnData,setRowData:w,rowData:e[n]},h))},r=(s,n)=>Object.assign(Object.assign({id:s},n),{columnData:{key:s,original:n},component:c,copyValue:({rowData:t,rowIndex:e})=>{var l,h;return(h=(l=n.copyValue)===null||l===void 0?void 0:l.call(n,{rowData:t[s],rowIndex:e}))!==null&&h!==void 0?h:null},deleteValue:({rowData:t,rowIndex:e})=>{var l,h;return Object.assign(Object.assign({},t),{[s]:(h=(l=n.deleteValue)===null||l===void 0?void 0:l.call(n,{rowData:t[s],rowIndex:e}))!==null&&h!==void 0?h:null})},pasteValue:({rowData:t,value:e,rowIndex:l})=>{var h,d;return Object.assign(Object.assign({},t),{[s]:(d=(h=n.pasteValue)===null||h===void 0?void 0:h.call(n,{rowData:t[s],value:e,rowIndex:l}))!==null&&d!==void 0?d:null})},disabled:typeof n.disabled=="function"?({rowData:t,rowIndex:e})=>{var l;return typeof n.disabled=="function"?n.disabled({rowData:t[s],rowIndex:e}):(l=n.disabled)!==null&&l!==void 0?l:!1}:n.disabled,cellClassName:typeof n.cellClassName=="function"?({rowData:t,rowIndex:e,columnId:l})=>{var h;return typeof n.cellClassName=="function"?n.cellClassName({rowData:t[s],rowIndex:e,columnId:l}):(h=n.cellClassName)!==null&&h!==void 0?h:void 0}:n.cellClassName,isCellEmpty:({rowData:t,rowIndex:e})=>{var l,h;return(h=(l=n.isCellEmpty)===null||l===void 0?void 0:l.call(n,{rowData:t[s],rowIndex:e}))!==null&&h!==void 0?h:!1}});return Be.keyColumn=r,Be}var qo;function Yd(){return qo||(qo=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.renderContextMenuItem=i.createContextMenuComponent=i.createAddRowsComponent=i.keyColumn=i.isoDateColumn=i.dateColumn=i.percentColumn=i.intColumn=i.floatColumn=i.checkboxColumn=i.createTextColumn=i.textColumn=i.DataSheetGrid=i.DynamicDataSheetGrid=void 0;const u=Hl(),_=Ud();i.DynamicDataSheetGrid=u.DataSheetGrid,i.DataSheetGrid=_.StaticDataSheetGrid;var p=Cr();Object.defineProperty(i,"textColumn",{enumerable:!0,get:function(){return p.textColumn}}),Object.defineProperty(i,"createTextColumn",{enumerable:!0,get:function(){return p.createTextColumn}});var o=zd();Object.defineProperty(i,"checkboxColumn",{enumerable:!0,get:function(){return o.checkboxColumn}});var c=Wd();Object.defineProperty(i,"floatColumn",{enumerable:!0,get:function(){return c.floatColumn}});var r=Gd();Object.defineProperty(i,"intColumn",{enumerable:!0,get:function(){return r.intColumn}});var s=Jd();Object.defineProperty(i,"percentColumn",{enumerable:!0,get:function(){return s.percentColumn}});var n=Hd();Object.defineProperty(i,"dateColumn",{enumerable:!0,get:function(){return n.dateColumn}});var t=Kd();Object.defineProperty(i,"isoDateColumn",{enumerable:!0,get:function(){return t.isoDateColumn}});var e=Xd();Object.defineProperty(i,"keyColumn",{enumerable:!0,get:function(){return e.keyColumn}});var l=Gl();Object.defineProperty(i,"createAddRowsComponent",{enumerable:!0,get:function(){return l.createAddRowsComponent}});var h=Jl();Object.defineProperty(i,"createContextMenuComponent",{enumerable:!0,get:function(){return h.createContextMenuComponent}}),Object.defineProperty(i,"renderContextMenuItem",{enumerable:!0,get:function(){return h.defaultRenderItem}})}(Qr)),Qr}var gr=Yd();function Bo(i){return typeof i=="object"?JSON.stringify(i):String(i)}function Qd({rowData:i,setRowData:u,choices:_}){const p=i||"",[o,c]=K.useState(Bo(i));return W.jsx(_l,{freeSolo:!0,disablePortal:!1,options:_,getOptionLabel:r=>Bo(r),value:p,onInputChange:(r,s)=>{c(s)},onBlur:()=>u(o),renderInput:r=>W.jsx(qi,{...r,slotProps:{input:{...r.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}}})}function $i({choices:i}){return{component:u=>W.jsx(Qd,{...u,choices:i}),disableKeys:!0,keepFocus:!0}}try{$i.displayName="autocompleteColumn",$i.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}}}}}catch{}const Zd=i=>{const u=i.trim();if(u){if(u.toUpperCase().startsWith("SELECT"))return{type:"sql",input:u};if(/^[A-Za-z]\w*=+$/.test(u))return{type:"sessionId",input:u}}else return{type:"empty",input:""};return{type:"unknown",input:u}};function ef(i,u){const _=Object.keys(i),p=Object.keys(u);if(_.length!==p.length)return!1;for(const o of _){const c=i[o],r=u[o],s=n=>n==null||n==="";if(!(s(c)&&s(r))&&String(c)!==String(r))return!1}return!0}async function tf(i,u){const _=await i.gridServicesClient.postRepoV1GridSessionAsyncStart({createGridRequest:u});if(!_.token)throw new Error("No async job token returned from startGridSession");return(await Vc(()=>i.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:_.token}))).responseBody}function nf(i){const u=Ol(),{keyFactory:_,synapseClient:p}=qt();return lr({...i,mutationFn:o=>p.gridServicesClient.postRepoV1GridSessionSessionIdReplica({sessionId:o,createReplicaRequest:{gridSessionId:o}}),onSuccess:async(o,c,r)=>{await u.invalidateQueries({queryKey:_.getGridSessionListKey()})}})}function rf(i){const u=Ol(),{keyFactory:_,synapseClient:p}=qt();return lr({...i,mutationFn:o=>p.gridServicesClient.deleteRepoV1GridSessionSessionId({sessionId:o}),onSuccess:async(o,c,r)=>{await u.invalidateQueries({queryKey:_.getGridSessionListKey()}),i!=null&&i.onSuccess&&await i.onSuccess(o,c,r)}})}function sf(i){const{keyFactory:u,synapseClient:_}=qt();return $c({...i,queryKey:u.getGridSessionListKey(),queryFn:async p=>await _.gridServicesClient.postRepoV1GridSessionList({listGridSessionsRequest:{nextPageToken:p.pageParam}}),initialPageParam:void 0,getNextPageParam:p=>p.nextPageToken})}const of=i=>{const{synapseClient:u}=qt();return lr({...i,mutationFn:async _=>await tf(u,_)})};function af(){const{mutateAsync:i}=of(),{synapseClient:u}=qt();return lr({mutationFn:async({gridSqlOrSessionId:_,schemaId:p})=>{let o;const c=Zd(_);if(!["empty","sql","sessionId"].includes(c.type))throw new Error("Unknown input type, please provide a valid SQL query or session ID.");if(c.type==="empty"||c.type==="sql"){const r={concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",initialQuery:void 0,schema$id:p||void 0};c.type==="sql"?(r.initialQuery={sql:c.input},console.log("Starting grid session with table query: ",c.input)):console.log("Starting a new empty grid session.");const s=await i(r);console.log("Grid session started:",s),o=s.gridSession}else console.log(`Joining existing session ID: ${c.input}`),o=await u.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:c.input});return o}})}function lf(i){const{mutateAsync:u}=af(),{mutateAsync:_}=nf(),{synapseClient:p}=qt();return lr({...i,mutationFn:async({gridSqlOrSessionId:o,schemaId:c})=>{const r=await u({gridSqlOrSessionId:o,schemaId:c}),s=r.sessionId;try{const n=await _(s);console.log("Replica created:",n);const t=n.replica,{presignedUrl:e}=await p.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:s,createGridPresignedUrlRequest:{gridSessionId:s,replicaId:t.replicaId}});return{session:r,replica:t,presignedUrl:e}}catch(n){throw new Error("Error starting session:",{cause:n})}}})}const Li=K.forwardRef(({onSessionChange:i=Pt,onReplicaChange:u=Pt,onPresignedUrlChange:_=Pt,query:p},o)=>{const[c,r]=K.useState(""),[s,n]=K.useState(""),t=!p,{mutate:e}=lf({onMutate(b){console.log("Starting grid session with args:",b)},onSuccess({session:b,replica:v,presignedUrl:a}){Vr("Grid session started successfully","success"),i(b),u(v.replicaId),_(a)}}),{mutate:l}=rf({onSuccess:()=>{Vr("Successfully deleted grid session","success"),i(null),u(null),_("")},onError:b=>{Vr(b.reason,"danger")}}),{data:h}=sf(),d=K.useMemo(()=>(h==null?void 0:h.pages.flatMap(b=>b.page||[]))||[],[h]),w=function(){e({gridSqlOrSessionId:c,schemaId:s})};return K.useImperativeHandle(o,()=>({handleStartSession:b=>{e({gridSqlOrSessionId:b})}}),[e]),t?W.jsxs(Fe,{container:!0,spacing:2,sx:{mb:2},children:[W.jsx(Fe,{size:{xs:12,lg:6},sx:{position:"relative"},children:W.jsx(_l,{freeSolo:!0,fullWidth:!0,renderInput:b=>W.jsx(qi,{...b,label:"SQL Query or Session ID",placeholder:"(Optional) Enter a SQL query or session ID"}),options:d,getOptionLabel:b=>typeof b=="string"?b:b.sessionId||"",value:c,onInputChange:(b,v)=>{r(v)},onChange:(b,v)=>{v&&typeof v=="object"?(r(v.sessionId||""),n(v.gridJsonSchema$Id||""),e({gridSqlOrSessionId:v.sessionId,schemaId:v.gridJsonSchema$Id})):r(v||"")},onKeyDown:b=>{b.key==="Enter"&&w()},renderOption:(b,v)=>K.createElement(Lc,{...b,key:v.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},W.jsxs(Fe,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[W.jsx(Fe,{size:{xs:6,md:2},children:v.sessionId}),W.jsx(Fe,{size:{xs:5,md:2},children:v.sourceEntityId}),W.jsx(Fe,{size:{xs:0,md:6},children:v.gridJsonSchema$Id??"No schema"}),W.jsx(Fe,{size:{xs:1},children:W.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:a=>{a.stopPropagation(),l(v.sessionId)},children:"🗑️"})})]}))})}),W.jsx(Fe,{size:{xs:12,lg:6},children:W.jsx(qi,{label:"Schema (optional)",placeholder:"Enter a schema $id e.g. my-org.NameOfMySchema-1.0.0",value:s,fullWidth:!0,onChange:b=>n(b.target.value)})}),W.jsx(Fe,{container:!0,size:12,justifyContent:"flex-end",children:W.jsx(Sl,{color:"primary",variant:"contained",onClick:()=>{w()},children:"Start Grid Session"})})]}):null});try{Li.displayName="StartGridSession",Li.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},onPresignedUrlChange:{defaultValue:null,description:"",name:"onPresignedUrlChange",required:!1,type:{name:"(url: string) => void"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string"}}}}}catch{}var si={},oi={},ai={},Vo;function cf(){return Vo||(Vo=1,Object.defineProperty(ai,"__esModule",{value:!0})),ai}var li={},xn={},$o;function Er(){if($o)return xn;$o=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.ConNode=void 0;const i=he();let u=class{constructor(p,o){this.id=p,this.val=o,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(p){const o=this.val,c=o instanceof Uint8Array?`Uint8Array { ${(""+o).replaceAll(",",", ")} }`:`{ ${o instanceof i.Timestamp?(0,i.printTs)(o):JSON.stringify(o)} }`;return`${this.name()} ${(0,i.printTs)(this.id)} ${c}`}};return xn.ConNode=u,xn}var Cn={},pt={},mt={},En={},Nn={},In={},Lo;function uf(){if(Lo)return In;Lo=1,Object.defineProperty(In,"__esModule",{value:!0}),In.RelativeTimestamp=void 0;let i=class{constructor(_,p){this.sessionIndex=_,this.timeDiff=p}};return In.RelativeTimestamp=i,In}var Uo;function df(){if(Uo)return Nn;Uo=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.ClockEncoder=void 0;const i=he(),u=uf();class _{constructor(c,r){this.index=c,this.clock=r}}let p=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(c){this.index=1,this.clock=c;const r=new _(this.index++,(0,i.tick)(c,-1));this.table.clear(),this.table.set(c.sid,r)}append(c){const r=c.time,s=c.sid;let n=this.table.get(s);if(!n){let l=this.clock.peers.get(s);l||(l=new i.Timestamp(s,this.clock.time-1)),n=new _(this.index++,l),this.table.set(s,n)}const e=n.clock.time-r;if(e<0)throw new Error("TIME_TRAVEL");return new u.RelativeTimestamp(n.index,e)}toJson(){const c=[];return this.table.forEach(r=>{const s=r.clock;c.push(s.sid,s.time)}),c}};return Nn.ClockEncoder=p,Nn}var bt={},Fo;function Kl(){if(Fo)return bt;Fo=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.CRDT_MAJOR_OVERLAY=bt.CRDT_MAJOR=void 0;var i;(function(_){_[_.CON=0]="CON",_[_.VAL=1]="VAL",_[_.OBJ=2]="OBJ",_[_.VEC=3]="VEC",_[_.STR=4]="STR",_[_.BIN=5]="BIN",_[_.ARR=6]="ARR"})(i||(bt.CRDT_MAJOR=i={}));var u;return function(_){_[_.CON=0]="CON",_[_.VAL=32]="VAL",_[_.VEC=96]="VEC",_[_.OBJ=64]="OBJ",_[_.STR=128]="STR",_[_.BIN=160]="BIN",_[_.ARR=192]="ARR"}(u||(bt.CRDT_MAJOR_OVERLAY=u={})),bt}var zo;function ff(){if(zo)return En;zo=1,Object.defineProperty(En,"__esModule",{value:!0}),En.Encoder=void 0;const u=ie.__importStar(lt()),_=df(),p=Fi(),o=he(),c=El(),r=Kl();class s extends c.CborEncoder{constructor(t){super(t||new p.CrdtWriter),this.clockEncoder=new _.ClockEncoder,this.time=0,this.cTableEntry=e=>{const l=e.clock,h=this.writer;h.vu57(l.sid),h.vu57(l.time)},this.tsLogical=e=>{const l=this.clockEncoder.append(e);this.writer.id(l.sessionIndex,l.timeDiff)},this.tsServer=e=>{this.writer.vu57(e.time)},this.ts=this.tsLogical,this.cKey=(e,l)=>{this.writeStr(l),this.cNode(this.doc.index.get(e))}}encode(t){this.doc=t;const e=this.writer;return e.reset(),t.clock.sid===1?this.encodeServer(t):this.encodeLogical(t),e.flush()}encodeLogical(t){const e=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(t.clock),e.ensureCapacity(4);const l=e.x0,h=e.x;e.x+=4,this.cRoot(t.root),this.encodeClockTable(l,h)}encodeServer(t){this.ts=this.tsServer;const e=this.writer;e.u8(128),e.vu57(this.time=t.clock.time),this.cRoot(t.root)}encodeClockTable(t,e){const l=this.writer,h=l.x0-t;l.view.setUint32(l.x0+(e-t),l.x-e-h-4);const w=this.clockEncoder.table,b=w.size;l.vu57(b),w.forEach(this.cTableEntry)}cRoot(t){t.val.sid===0?this.writer.u8(0):this.cNode(t.node())}writeTL(t,e){const l=this.writer;e<31?l.u8(t|e):(l.u8(t|31),l.vu57(e))}cNode(t){t instanceof u.ConNode?this.cCon(t):t instanceof u.ValNode?this.cVal(t):t instanceof u.StrNode?this.cStr(t):t instanceof u.ObjNode?this.cObj(t):t instanceof u.VecNode?this.cVec(t):t instanceof u.ArrNode?this.cArr(t):t instanceof u.BinNode&&this.cBin(t)}cCon(t){const e=t.val;this.ts(t.id),e instanceof o.Timestamp?(this.writer.u8(1),this.ts(e)):(this.writer.u8(0),this.writeAny(e))}cVal(t){this.ts(t.id),this.writer.u8(32),this.cNode(t.node())}cObj(t){this.ts(t.id);const e=t.keys;this.writeTL(r.CRDT_MAJOR_OVERLAY.OBJ,e.size),e.forEach(this.cKey)}cVec(t){const e=t.elements,l=e.length;this.ts(t.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.VEC,l);const h=this.doc.index;for(let d=0;d<l;d++){const w=e[d];w?this.cNode(h.get(w)):this.writer.u8(0)}}cStr(t){const e=this.ts;e(t.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.STR,t.count);for(let l=t.first();l;l=t.next(l))e(l.id),l.del?this.writeUInteger(l.span):this.writeStr(l.data)}cBin(t){const e=this.ts,l=this.writer;e(t.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.BIN,t.count);for(let h=t.first();h;h=t.next(h)){e(h.id);const d=h.span,w=h.del;l.b1vu56(~~w,d),!w&&l.buf(h.data,d)}}cArr(t){const e=this.ts,l=this.writer;e(t.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.ARR,t.count);const h=this.doc.index;for(let d=t.first();d;d=t.next(d)){e(d.id);const w=d.span,b=d.del;if(l.b1vu56(~~b,w),b)continue;const v=d.data;for(let a=0;a<w;a++)this.cNode(h.get(v[a]))}}}return En.Encoder=s,En}var Rn={},jn={},Wo;function hf(){if(Wo)return jn;Wo=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.ClockDecoder=void 0;const i=he();let u=class Xl{static fromArr(p){const o=new Xl(p[0],p[1]),c=p.length;for(let r=2;r<c;r+=2)o.pushTuple(p[r],p[r+1]);return o}constructor(p,o){this.table=[],this.clock=new i.ClockVector(p,o+1),this.table.push((0,i.ts)(p,o))}pushTuple(p,o){const c=(0,i.ts)(p,o);this.clock.observe(c,1),this.table.push(c)}decodeId(p,o){if(!p)return(0,i.ts)(0,o);const c=this.table[p-1];if(!c)throw new Error("INVALID_CLOCK_TABLE");return(0,i.ts)(c.sid,c.time-o)}};return jn.ClockDecoder=u,jn}var Go;function pf(){if(Go)return Rn;Go=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.Decoder=void 0;const u=ie.__importStar(lt()),_=hf(),p=Rl(),o=he(),c=es(),r=kl(),s=Kl();let n=class extends r.CborDecoderBase{constructor(){super(new p.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const e=this.ts(),l=this.val();return typeof l=="string"?new u.StrChunk(e,l.length,l):new u.StrChunk(e,~~l,"")},this.cBinChunk=()=>{const e=this.ts(),l=this.reader,[h,d]=l.b1vu56();return h?new u.BinChunk(e,d,void 0):new u.BinChunk(e,d,l.buf(d))},this.cArrChunk=()=>{const e=this.ts(),[l,h]=this.reader.b1vu56();if(l)return new u.ArrChunk(e,h,void 0);const d=[];for(let w=0;w<h;w++)d.push(this.cNode().id);return new u.ArrChunk(e,h,d)}}decode(e,l){this.clockDecoder=void 0,this.time=-1;const h=this.reader;if(h.reset(e),h.peak()&128){h.x++;const w=this.time=h.vu57();l||(l=c.Model.withServerClock(void 0,w))}else if(this.decodeClockTable(),!l){const w=this.clockDecoder.clock;l=c.Model.create(void 0,w)}return this.doc=l,l.root=new u.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,l}decodeClockTable(){const e=this.reader,l=e.u32(),h=e.x;e.x+=l;const d=e.vu57(),w=e.vu57(),b=e.vu57();this.clockDecoder=new _.ClockDecoder(w,b);for(let v=1;v<d;v++){const a=e.vu57(),f=e.vu57();this.clockDecoder.pushTuple(a,f)}e.x=h}ts(){if(this.time<0){const[h,d]=this.reader.id();return this.clockDecoder.decodeId(h,d)}else return new o.Timestamp(1,this.reader.vu57())}cRoot(){const e=this.reader;return e.uint8[e.x]?this.cNode():c.UNDEFINED}cNode(){const e=this.reader,l=this.ts(),h=e.u8(),d=h>>5,w=h&31;switch(d){case s.CRDT_MAJOR.CON:return this.cCon(l,w);case s.CRDT_MAJOR.VAL:return this.cVal(l);case s.CRDT_MAJOR.OBJ:return this.cObj(l,w!==31?w:e.vu57());case s.CRDT_MAJOR.VEC:return this.cVec(l,w!==31?w:e.vu57());case s.CRDT_MAJOR.STR:return this.cStr(l,w!==31?w:e.vu57());case s.CRDT_MAJOR.BIN:return this.cBin(l,w!==31?w:e.vu57());case s.CRDT_MAJOR.ARR:return this.cArr(l,w!==31?w:e.vu57())}throw new Error("UNKNOWN_NODE")}cCon(e,l){const h=this.doc,d=l?this.ts():this.val(),w=new u.ConNode(e,d);return h.index.set(e,w),w}cVal(e){const l=this.cNode(),h=this.doc,d=new u.ValNode(h,e,l.id);return h.index.set(e,d),d}cObj(e,l){const h=new u.ObjNode(this.doc,e);for(let d=0;d<l;d++)this.cObjChunk(h);return this.doc.index.set(e,h),h}cObjChunk(e){const l=this.key();e.keys.set(l,this.cNode().id)}cVec(e,l){const h=this.reader,d=new u.VecNode(this.doc,e),w=d.elements;for(let b=0;b<l;b++)h.peak()?w.push(this.cNode().id):(h.x++,w.push(void 0));return this.doc.index.set(e,d),d}cStr(e,l){const h=new u.StrNode(e);return l&&h.ingest(l,this.cStrChunk),this.doc.index.set(e,h),h}cBin(e,l){const h=new u.BinNode(e);return l&&h.ingest(l,this.cBinChunk),this.doc.index.set(e,h),h}cArr(e,l){const h=new u.ArrNode(this.doc,e);return l&&h.ingest(l,this.cArrChunk),this.doc.index.set(e,h),h}};return Rn.Decoder=n,Rn}var Jo;function mf(){if(Jo)return mt;Jo=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.decoder=mt.encoder=void 0;const i=ff(),u=pf();return mt.encoder=new i.Encoder,mt.decoder=new u.Decoder,mt}var ci={},we={},kn={},Tn={},Ho;function Hi(){if(Ho)return Tn;Ho=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.hasOwnProperty=void 0;const i=Object.prototype.hasOwnProperty;function u(_,p){return i.call(_,p)}return Tn.hasOwnProperty=u,Tn}var Ko;function Yl(){if(Ko)return kn;Ko=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.get=void 0;const i=Hi(),u=(_,p)=>{const o=p.length;let c;if(!o)return _;for(let r=0;r<o;r++)if(c=p[r],_ instanceof Array){if(typeof c!="number"){if(c==="-")return;const s=~~c;if(""+s!==c)return;c=s}_=_[c]}else if(typeof _=="object"){if(!_||!(0,i.hasOwnProperty)(_,c))return;_=_[c]}else return;return _};return kn.get=u,kn}var ui={},Xo;function Ki(){return Xo||(Xo=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.isInteger=i.isRoot=i.toPath=void 0,i.unescapeComponent=c,i.escapeComponent=r,i.parseJsonPointer=s,i.formatJsonPointer=n,i.isChild=e,i.isPathEqual=l,i.parent=d,i.isValidIndex=w;const u=/~1/g,_=/~0/g,p=/~/g,o=/\//g;function c(v){return v.indexOf("~")===-1?v:v.replace(u,"/").replace(_,"~")}function r(v){return v.indexOf("/")===-1&&v.indexOf("~")===-1?v:v.replace(p,"~0").replace(o,"~1")}function s(v){return v?v.slice(1).split("/").map(c):[]}function n(v){return(0,i.isRoot)(v)?"":"/"+v.map(a=>r(String(a))).join("/")}const t=v=>typeof v=="string"?s(v):v;i.toPath=t;function e(v,a){if(v.length>=a.length)return!1;for(let f=0;f<v.length;f++)if(v[f]!==a[f])return!1;return!0}function l(v,a){if(v.length!==a.length)return!1;for(let f=0;f<v.length;f++)if(v[f]!==a[f])return!1;return!0}const h=v=>!v.length;i.isRoot=h;function d(v){if(v.length<1)throw new Error("NO_PARENT");return v.slice(0,v.length-1)}function w(v){if(typeof v=="number")return!0;const a=Number.parseInt(v,10);return String(a)===v&&a>=0}const b=v=>{const a=v.length;let f=0,m;for(;f<a;){if(m=v.charCodeAt(f),m>=48&&m<=57){f++;continue}return!1}return!0};i.isInteger=b}(ui)),ui}var An={},di={},fi={},Yo;function bf(){return Yo||(Yo=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi}var hi={},Qo;function vf(){return Qo||(Qo=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.validatePath=i.validateJsonPointer=void 0;const u=o=>{if(typeof o=="string"){if(o){if(o[0]!=="/")throw new Error("POINTER_INVALID");if(o.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,i.validatePath)(o)};i.validateJsonPointer=u;const{isArray:_}=Array,p=o=>{if(!_(o))throw new Error("Invalid path.");if(o.length>256)throw new Error("Path too long.");for(const c of o)switch(typeof c){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};i.validatePath=p}(hi)),hi}var Ke={},Zo;function gf(){if(Zo)return Ke;Zo=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.isObjectReference=Ke.isArrayEnd=Ke.isArrayReference=Ke.find=void 0;const i=Hi(),{isArray:u}=Array,_=(r,s)=>{const n=s.length;if(!n)return{val:r};let t,e;for(let h=0;h<n;h++)if(t=r,e=s[h],u(t)){const d=t.length;if(e==="-")e=d;else if(typeof e=="string"){const w=~~e;if(""+w!==e)throw new Error("INVALID_INDEX");if(e=w,e<0)throw new Error("INVALID_INDEX")}r=t[e]}else if(typeof t=="object"&&t)r=(0,i.hasOwnProperty)(t,e)?t[e]:void 0;else throw new Error("NOT_FOUND");return{val:r,obj:t,key:e}};Ke.find=_;const p=r=>u(r.obj)&&typeof r.key=="number";Ke.isArrayReference=p;const o=r=>r.obj.length===r.key;Ke.isArrayEnd=o;const c=r=>typeof r.obj=="object"&&typeof r.key=="string";return Ke.isObjectReference=c,Ke}var pi={},Mn={},ea;function wf(){if(ea)return Mn;ea=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.findByPointer=void 0;const i=Hi(),u=Ki(),{isArray:_}=Array,p=(o,c)=>{if(!o)return{val:c};let r,s,n=0,t=1;for(;n>-1;)if(n=o.indexOf("/",t),s=n>-1?o.substring(t,n):o.substring(t),t=n+1,r=c,_(r)){const e=r.length;if(s==="-")s=e;else{const l=~~s;if(""+l!==s)throw new Error("INVALID_INDEX");if(s=l,s<0)throw"INVALID_INDEX"}c=r[s]}else if(typeof r=="object"&&r)s=(0,u.unescapeComponent)(s),c=(0,i.hasOwnProperty)(r,s)?r[s]:void 0;else throw"NOT_FOUND";return{val:c,obj:r,key:s}};return Mn.findByPointer=p,Mn}var ta;function yf(){return ta||(ta=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ie.__exportStar(wf(),i)}(pi)),pi}var na;function _f(){return na||(na=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(bf(),i),u.__exportStar(Ki(),i),u.__exportStar(vf(),i),u.__exportStar(Yl(),i),u.__exportStar(gf(),i),u.__exportStar(yf(),i)}(di)),di}var ra;function Of(){if(ra)return An;ra=1,Object.defineProperty(An,"__esModule",{value:!0}),An.find=void 0;const i=_f(),u=lt(),_=(p,o)=>{const c=(0,i.toPath)(o);let r=p;const s=c.length;if(!s)return r;let n=0;for(;n<s&&r;){const t=c[n++];if(r=r.container(),!r)throw new Error("NOT_CONTAINER");if(r instanceof u.ObjNode){const e=r.get(String(t));if(!e)throw new Error("NOT_FOUND");r=e}else if(r instanceof u.ArrNode){const e=r.getNode(Number(t));if(!e)throw new Error("NOT_FOUND");r=e}else if(r instanceof u.VecNode){const e=r.get(Number(t));if(!e)throw new Error("NOT_FOUND");r=e}}return r};return An.find=_,An}var Pn={},Xe={},Dn={},ia;function Ql(){if(ia)return Dn;ia=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.FanOut=void 0;class i{constructor(){this.listeners=new Set}emit(_){this.listeners.forEach(p=>p(_))}listen(_){const p=this.listeners;return p.add(_),()=>p.delete(_)}}return Dn.FanOut=i,Dn}var sa;function Zl(){if(sa)return Xe;sa=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.OnNewFanOut=Xe.MapFanOut=Xe.MicrotaskBufferFanOut=Xe.MergeFanOut=void 0;const i=Ql();class u extends i.FanOut{constructor(r){super(),this.fanouts=r,this.unsubs=[]}listen(r){this.listeners.size||(this.unsubs=this.fanouts.map(n=>n.listen(t=>this.emit(t))));const s=super.listen(r);return()=>{if(s(),!this.listeners.size){for(const n of this.unsubs)n();this.unsubs=[]}}}}Xe.MergeFanOut=u;class _ extends i.FanOut{constructor(r){super(),this.source=r,this.buffer=[],this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(n=>{const t=this.buffer;t.length||queueMicrotask(()=>{this.emit(t),this.buffer=[]}),t.push(n)}));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.buffer=[],(r=this.unsub)==null||r.call(this),this.unsub=void 0}}Xe.MicrotaskBufferFanOut=_;class p extends i.FanOut{constructor(r,s){super(),this.source=r,this.mapper=s,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(n=>this.emit(this.mapper(n))));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),(r=this.unsub)==null||r.call(this),this.unsub=void 0}}Xe.MapFanOut=p;class o extends i.FanOut{constructor(r,s=void 0){super(),this.source=r,this.last=s,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(n=>{this.last!==n&&this.emit(this.last=n)}));const s=super.listen(r);return()=>{s(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.last=void 0,(r=this.unsub)==null||r.call(this),this.unsub=void 0}}return Xe.OnNewFanOut=o,Xe}var oa;function Sf(){if(oa)return Pn;oa=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.NodeEvents=void 0;const i=Zl();let u=class{constructor(p){this.api=p,this.subscribe=o=>this.onViewChanges.listen(()=>o()),this.getSnapshot=()=>this.api.view(),this.onChanges=new i.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new i.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Pn.NodeEvents=u,Pn}var qn={},aa;function xf(){if(aa)return qn;aa=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.ExtNode=void 0;const i=he();let u=class{constructor(p){this.data=p,this.api=void 0,this.id=p.id}children(p){}child(){return this.data}container(){return this.data.container()}toString(p,o){return this.name()+(o?" "+(0,i.printTs)(o):"")+" "+this.data.toString(p)}};return qn.ExtNode=u,qn}var mi={},vt={},bi={},vi={},la;function Cf(){return la||(la=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.deepEqual=void 0;const u=Array.isArray,_=Object.prototype,p=(o,c)=>{if(o===c)return!0;let r=0,s=0;if(u(o)){if(!u(c)||(r=o.length,r!==c.length))return!1;for(s=r;s--!==0;)if(!(0,i.deepEqual)(o[s],c[s]))return!1;return!0}if(o&&c&&typeof o=="object"&&typeof c=="object"){e:{if(o.__proto__===_)break e;if(o instanceof Uint8Array){if(!(c instanceof Uint8Array))return!1;const t=o.length;if(t!==c.length)return!1;for(let e=0;e<t;e++)if(o[e]!==c[e])return!1;return!0}}const n=Object.keys(o);if(r=n.length,r!==Object.keys(c).length||u(c))return!1;for(s=r;s--!==0;){const t=n[s];if(!(0,i.deepEqual)(o[t],c[t]))return!1}return!0}return!1};i.deepEqual=p}(vi)),vi}var ca;function Ef(){return ca||(ca=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ie.__exportStar(Cf(),i)}(bi)),bi}var Bn={},ua;function Nf(){if(ua)return Bn;ua=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.cmpUint8Array=void 0;const i=(u,_)=>{const p=u.length;if(p!==_.length)return!1;for(let o=0;o<p;o++)if(u[o]!==_[o])return!1;return!0};return Bn.cmpUint8Array=i,Bn}var gi={},da;function Xi(){return da||(da=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.apply=i.invert=i.dst=i.src=i.diffEdit=i.diff=i.sfx=i.pfx=void 0;const u=a=>{const f=a.charCodeAt(0);return f>=56320&&f<=57343},_=a=>{const f=a.charCodeAt(a.length-1);return f>=55296&&f<=56319},p=(a,f)=>{a.push([0,""]);let m=0,g=0,y=0,O="",x="",C=0;for(;m<a.length;){if(m<a.length-1&&!a[m][1]){a.splice(m,1);continue}const E=a[m];switch(E[0]){case 1:y++,m++,x+=E[1];break;case-1:g++,m++,O+=E[1];break;case 0:{let I=m-y-g-1;if(f){const A=a[I];if(I>=0){let z=A[1];if(_(z)){const U=z.slice(-1);if(A[1]=z=z.slice(0,-1),O=U+O,x=U+x,!z){a.splice(I,1),m--;let Z=I-1;const se=a[Z];if(se){const L=se[0];L===1?(y++,Z--,x=se[1]+x):L===-1&&(g++,Z--,O=se[1]+O)}I=Z}}}const D=a[m],V=D[1];if(u(V)){const z=V.charAt(0);D[1]=V.slice(1),O+=z,x+=z}}if(m<a.length-1&&!a[m][1]){a.splice(m,1);break}const j=O.length>0,N=x.length>0;if(j||N){j&&N&&(C=(0,i.pfx)(x,O),C!==0&&(I>=0?a[I][1]+=x.slice(0,C):(a.splice(0,0,[0,x.slice(0,C)]),m++),x=x.slice(C),O=O.slice(C)),C=(0,i.sfx)(x,O),C!==0&&(a[m][1]=x.slice(x.length-C)+a[m][1],x=x.slice(0,x.length-C),O=O.slice(0,O.length-C)));const A=y+g,D=O.length,V=x.length;D===0&&V===0?(a.splice(m-A,A),m=m-A):D===0?(a.splice(m-A,A,[1,x]),m=m-A+1):V===0?(a.splice(m-A,A,[-1,O]),m=m-A+1):(a.splice(m-A,A,[-1,O],[1,x]),m=m-A+2)}const M=a[m-1];m!==0&&M[0]===0?(M[1]+=a[m][1],a.splice(m,1)):m++,y=0,g=0,O="",x="";break}}}a[a.length-1][1]===""&&a.pop();let S=!1;for(m=1;m<a.length-1;){const E=a[m-1],I=a[m+1];if(E[0]===0&&I[0]===0){const j=E[1],N=a[m],M=N[1],A=I[1];M.slice(M.length-j.length)===j?(a[m][1]=j+M.slice(0,M.length-j.length),I[1]=j+A,a.splice(m-1,1),S=!0):M.slice(0,A.length)===A&&(E[1]+=I[1],N[1]=M.slice(A.length)+A,a.splice(m+1,1),S=!0)}m++}S&&p(a,f)},o=(a,f,m,g)=>{const y=t(a.slice(0,m),f.slice(0,g),!1),O=t(a.slice(m),f.slice(g),!1);return y.concat(O)},c=(a,f)=>{const m=a.length,g=f.length,y=Math.ceil((m+g)/2),O=y,x=2*y,C=new Array(x),S=new Array(x);for(let D=0;D<x;D++)C[D]=-1,S[D]=-1;C[O+1]=0,S[O+1]=0;const E=m-g,I=E%2!==0;let j=0,N=0,M=0,A=0;for(let D=0;D<y;D++){for(let V=-D+j;V<=D-N;V+=2){const z=O+V;let U=0;const Z=C[z-1],se=C[z+1];V===-D||V!==D&&Z<se?U=se:U=Z+1;let L=U-V;for(;U<m&&L<g&&a.charAt(U)===f.charAt(L);)U++,L++;if(C[z]=U,U>m)N+=2;else if(L>g)j+=2;else if(I){const J=O+E-V,ce=S[J];if(J>=0&&J<x&&ce!==-1&&U>=m-ce)return o(a,f,U,L)}}for(let V=-D+M;V<=D-A;V+=2){const z=O+V;let U=V===-D||V!==D&&S[z-1]<S[z+1]?S[z+1]:S[z-1]+1,Z=U-V;for(;U<m&&Z<g&&a.charAt(m-U-1)===f.charAt(g-Z-1);)U++,Z++;if(S[z]=U,U>m)A+=2;else if(Z>g)M+=2;else if(!I){const se=O+E-V,L=C[se];if(se>=0&&se<x&&L!==-1){const J=O+L-se;if(U=m-U,L>=U)return o(a,f,L,J)}}}}return[[-1,a],[1,f]]},r=(a,f)=>{if(!a)return[[1,f]];if(!f)return[[-1,a]];const m=a.length,g=f.length,y=m>g?a:f,O=m>g?f:a,x=O.length,C=y.indexOf(O);if(C>=0){const S=y.slice(0,C),E=y.slice(C+x);return m>g?[[-1,S],[0,O],[-1,E]]:[[1,S],[0,O],[1,E]]}return x===1?[[-1,a],[1,f]]:c(a,f)},s=(a,f)=>{if(!a||!f||a.charAt(0)!==f.charAt(0))return 0;let m=0,g=Math.min(a.length,f.length),y=g,O=0;for(;m<y;)a.slice(O,y)===f.slice(O,y)?(m=y,O=m):g=y,y=Math.floor((g-m)/2+m);const x=a.charCodeAt(y-1);return x>=55296&&x<=56319&&y--,y};i.pfx=s;const n=(a,f)=>{if(!a||!f||a.slice(-1)!==f.slice(-1))return 0;let m=0,g=Math.min(a.length,f.length),y=g,O=0;for(;m<y;)a.slice(a.length-y,a.length-O)===f.slice(f.length-y,f.length-O)?(m=y,O=m):g=y,y=Math.floor((g-m)/2+m);const x=a.charCodeAt(a.length-y);return x>=55296&&x<=56319&&y--,y};i.sfx=n;const t=(a,f,m)=>{if(a===f)return a?[[0,a]]:[];const g=(0,i.pfx)(a,f),y=a.slice(0,g);a=a.slice(g),f=f.slice(g);const O=(0,i.sfx)(a,f),x=a.slice(a.length-O);a=a.slice(0,a.length-O),f=f.slice(0,f.length-O);const C=r(a,f);return y&&C.unshift([0,y]),x&&C.push([0,x]),p(C,m),C},e=(a,f)=>t(a,f,!0);i.diff=e;const l=(a,f,m)=>{e:{if(m<0)break e;const g=a.length,y=f.length;if(g===y)break e;const O=f.slice(m),x=O.length;if(x>g||a.slice(g-x)!==O)break e;if(y>g){const E=g-x,I=a.slice(0,E),j=f.slice(0,E);if(I!==j)break e;const N=f.slice(E,m),M=[];return I&&M.push([0,I]),N&&M.push([1,N]),O&&M.push([0,O]),M}else{const E=y-x,I=f.slice(0,E),j=a.slice(0,E);if(j!==I)break e;const N=a.slice(E,g-x),M=[];return j&&M.push([0,j]),N&&M.push([-1,N]),O&&M.push([0,O]),M}}return(0,i.diff)(a,f)};i.diffEdit=l;const h=a=>{let f="";const m=a.length;for(let g=0;g<m;g++){const y=a[g];y[0]!==1&&(f+=y[1])}return f};i.src=h;const d=a=>{let f="";const m=a.length;for(let g=0;g<m;g++){const y=a[g];y[0]!==-1&&(f+=y[1])}return f};i.dst=d;const w=a=>{const f=a[0];return f===0?a:f===1?[-1,a[1]]:[1,a[1]]},b=a=>a.map(w);i.invert=b;const v=(a,f,m,g)=>{const y=a.length;let O=f;for(let x=y-1;x>=0;x--){const[C,S]=a[x];if(C===0)O-=S.length;else if(C===1)m(O,S);else{const E=S.length;O-=E,g(O,E,S)}}};i.apply=v}(gi)),gi}var wi={},fa;function If(){return fa||(fa=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.dst=i.src=i.apply=i.diff=i.toBin=i.toStr=void 0;const _=ie.__importStar(Xi()),p=t=>{let e="";const l=t.length;for(let h=0;h<l;h++)e+=String.fromCharCode(t[h]);return e};i.toStr=p;const o=t=>{const e=t.length,l=new Uint8Array(e);for(let h=0;h<e;h++)l[h]=t.charCodeAt(h);return l};i.toBin=o;const c=(t,e)=>{const l=(0,i.toStr)(t),h=(0,i.toStr)(e);return _.diff(l,h)};i.diff=c;const r=(t,e,l,h)=>_.apply(t,e,(d,w)=>l(d,(0,i.toBin)(w)),h);i.apply=r;const s=t=>(0,i.toBin)(_.src(t));i.src=s;const n=t=>(0,i.toBin)(_.dst(t));i.dst=n}(wi)),wi}var yi={},ha;function Rf(){return ha||(ha=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.diff=i.agg=void 0;const _=ie.__importStar(Xi()),p=c=>{const r=[],s=c.length;let n=[];const t=(e,l)=>{if(!l.length)return;const h=n.length;if(h){const d=n[h-1];if(d[0]===e){d[1]+=l;return}}n.push([e,l])};e:for(let e=0;e<s;e++){const l=c[e],h=l[0],d=l[1],w=d.indexOf(`
`);if(w<0){t(h,d);continue e}else t(h,d.slice(0,w+1)),n.length&&r.push(n),n=[];let b=w;const v=d.length;t:for(;b<v;){const a=d.indexOf(`
`,b+1);if(a<0){t(h,d.slice(b+1));break t}r.push([[h,d.slice(b+1,a+1)]]),b=a}}n.length&&r.push(n);{const e=r.length;for(let l=0;l<e;l++){const h=r[l];let d=h.length;e:{if(d<2)break e;const w=h[0],b=h[1],v=b[0];if(w[0]===0&&(v===-1||v===1)){for(let a=2;a<d;a++)if(h[a][0]!==v)break e;for(let a=l+1;a<e;a++){const f=r[a],m=f.length,g=w[1];let y,O;if(f.length>1&&(y=f[0])[0]===v&&(O=f[1])[0]===0&&g===y[1])h.splice(0,1),b[1]=g+b[1],O[1]=g+O[1],f.splice(0,1);else for(let x=0;x<m;x++)if(f[x][0]!==v)break e}}}d=h.length;e:{if(d<2)break e;const w=h[h.length-1],b=w[1],v=h[h.length-2];if(w[0]===-1)for(let a=l+1;a<e;a++){const f=r[a],m=f.length;if(m<=1){if(f[0][0]!==-1)break e}else{const g=f[f.length-1];if(g[0]!==0)break e;for(let S=0;S<f.length-1;S++)if(f[S][0]!==-1)break e;let y=g[1];const O=y.endsWith(`
`);if(O||(y+=`
`),y.length>b.length||!b.endsWith(y))break e;const x=b.length-y.length;x<0?(w[0]=0,v[0]===0&&(v[1]+=b,h.splice(d-1,1))):x===0?(h.splice(d-1,1),v[0]===0?v[1]+=y:h.push([0,y])):(w[1]=b.slice(0,x),h.push([0,y]));const C=f[f.length-2];C[0]===-1?(C[1]+=O?y:y.slice(0,-1),f.splice(m-1,1)):g[0]=-1}}}}}return r};i.agg=p;const o=(c,r)=>{const s=c.join(`
`)+`
`,n=r.join(`
`)+`
`;if(s===n)return[];const t=_.diff(s,n),e=(0,i.agg)(t),l=e.length,h=[];let d=-1,w=-1;const b=c.length,v=r.length;for(let a=0;a<l;a++){const f=e[a];let m=f.length;if(!m)continue;const g=f[m-1],y=g[0],O=g[1];if(O===`
`)f.splice(m-1,1);else{const C=O.length;O[C-1]===`
`&&(C===1?f.splice(m-1,1):g[1]=O.slice(0,C-1))}let x=0;if(m=f.length,a+1===l)d+1<b?w+1<v?(x=m===1&&f[0][0]===0?0:2,d++,w++):(x=-1,d++):(x=1,w++);else{const S=f[0][0];m===1&&S===y&&S===0?(d++,w++):y===0?(x=2,d++,w++):y===1?(x=1,w++):y===-1&&(x=-1,d++)}h.push([x,d,w,f])}return h};i.diff=o}(yi)),yi}var _i={},Vn={},pa;function Yi(){if(pa)return Vn;pa=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.sort=void 0;const i=u=>{const _=u.length;for(let p=1;p<_;p++){const o=u[p];let c=p;for(;c!==0&&u[c-1]>o;)u[c]=u[c-1],c--;u[c]=o}return u};return Vn.sort=i,Vn}var Oi={},ma;function Qi(){return ma||(ma=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.hash=i.updateJson=i.updateBin=i.updateStr=i.updateNum=i.CONST=void 0;const u=Yi();var _;(function(n){n[n.START_STATE=5381]="START_STATE",n[n.NULL=982452847]="NULL",n[n.TRUE=982453247]="TRUE",n[n.FALSE=982454243]="FALSE",n[n.ARRAY=982452259]="ARRAY",n[n.STRING=982453601]="STRING",n[n.OBJECT=982454533]="OBJECT",n[n.BINARY=982454837]="BINARY"})(_||(i.CONST=_={}));const p=(n,t)=>(n<<5)+n+t;i.updateNum=p;const o=(n,t)=>{const e=t.length;n=(0,i.updateNum)(n,_.STRING),n=(0,i.updateNum)(n,e);let l=e;for(;l;)n=(n<<5)+n+t.charCodeAt(--l);return n};i.updateStr=o;const c=(n,t)=>{const e=t.length;n=(0,i.updateNum)(n,_.BINARY),n=(0,i.updateNum)(n,e);let l=e;for(;l;)n=(n<<5)+n+t[--l];return n};i.updateBin=c;const r=(n,t)=>{switch(typeof t){case"number":return(0,i.updateNum)(n,t);case"string":return n=(0,i.updateNum)(n,_.STRING),(0,i.updateStr)(n,t);case"object":{if(t===null)return(0,i.updateNum)(n,_.NULL);if(Array.isArray(t)){const h=t.length;n=(0,i.updateNum)(n,_.ARRAY);for(let d=0;d<h;d++)n=(0,i.updateJson)(n,t[d]);return n}if(t instanceof Uint8Array)return(0,i.updateBin)(n,t);n=(0,i.updateNum)(n,_.OBJECT);const e=(0,u.sort)(Object.keys(t)),l=e.length;for(let h=0;h<l;h++){const d=e[h];n=(0,i.updateStr)(n,d),n=(0,i.updateJson)(n,t[d])}return n}case"boolean":return(0,i.updateNum)(n,t?_.TRUE:_.FALSE)}return n};i.updateJson=r;const s=n=>(0,i.updateJson)(_.START_STATE,n)>>>0;i.hash=s}(Oi)),Oi}var Si={},ba;function ec(){return ba||(ba=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.structHash=void 0;const u=Yi(),_=Qi(),p=o=>{switch(typeof o){case"string":return(0,_.hash)(o).toString(36);case"number":case"bigint":return o.toString(36);case"boolean":return o?"T":"F";case"object":if(o===null)return"N";if(Array.isArray(o)){const c=o.length;let r="[";for(let s=0;s<c;s++)r+=(0,i.structHash)(o[s])+",";return r+"]"}else{if(o instanceof Uint8Array)return(0,_.hash)(o).toString(36);{const c=Object.keys(o);(0,u.sort)(c);let r="{";const s=c.length;for(let n=0;n<s;n++){const t=c[n];r+=(0,_.hash)(t).toString(36)+":"+(0,i.structHash)(o[t])+","}return r+"}"}}default:return"U"}};i.structHash=p}(Si)),Si}var va;function jf(){return va||(va=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.structHashCrdt=void 0;const u=Yi(),_=oc(),p=Qi(),o=ec(),c=r=>{if(r instanceof _.ConNode)return(0,o.structHash)(r.val);if(r instanceof _.ValNode)return(0,i.structHashCrdt)(r.node());if(r instanceof _.StrNode)return(0,p.hash)(r.view()).toString(36);if(r instanceof _.ObjNode){let s="{";const n=Array.from(r.keys.keys());(0,u.sort)(n);const t=n.length;for(let e=0;e<t;e++){const l=n[e],h=r.get(l);s+=(0,p.hash)(l).toString(36)+":"+(0,i.structHashCrdt)(h)+","}return s+"}"}else if(r instanceof _.ArrNode||r instanceof _.VecNode){let s="[";return r.children(n=>{s+=(0,i.structHashCrdt)(n)+","}),s+"]"}else if(r instanceof _.BinNode)return(0,p.hash)(r.view()).toString(36);return"U"};i.structHashCrdt=c}(_i)),_i}var xi={},ga;function kf(){return ga||(ga=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(Qi(),i),u.__exportStar(ec(),i)}(xi)),xi}var wa;function Tf(){if(wa)return vt;wa=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.JsonCrdtDiff=vt.DiffError=void 0;const i=ie,u=Ef(),_=Nf(),p=xr(),o=lt(),c=i.__importStar(Xi()),r=i.__importStar(If()),s=i.__importStar(Rf()),n=jf(),t=kf();class e extends Error{constructor(d="DIFF"){super(d)}}vt.DiffError=e;let l=class{constructor(d){this.model=d,this.builder=new p.PatchBuilder(d.clock.clone())}diffStr(d,w){const b=d.view();if(b===w)return;const v=this.builder;c.apply(c.diff(b,w),b.length,(a,f)=>v.insStr(d.id,a?d.find(a-1):d.id,f),(a,f)=>v.del(d.id,d.findInterval(a,f)))}diffBin(d,w){const b=d.view();if((0,_.cmpUint8Array)(b,w))return;const v=this.builder;r.apply(r.diff(b,w),b.length,(a,f)=>v.insBin(d.id,a?d.find(a-1):d.id,f),(a,f)=>v.del(d.id,d.findInterval(a,f)))}diffArr(d,w){const b=[];d.children(C=>{b.push((0,n.structHashCrdt)(C))});const v=[],a=w.length;for(let C=0;C<a;C++)v.push((0,t.structHash)(w[C]));const f=s.diff(b,v);if(!f.length)return;const m=[],g=[],y=f.length;for(let C=y-1;C>=0;C--){const[S,E,I]=f[C];switch(S){case 0:break;case 1:{const j=w[I],N=E>=0?d.find(E):d.id;if(!N)throw new e;m.push([N,[j]]);break}case-1:{const j=d.findInterval(E,1);if(!j||!j.length)throw new e;g.push(...j);break}case 2:{const j=w[I];try{this.diffAny(d.getNode(E),j)}catch(N){if(N instanceof e){const M=d.findInterval(E,1);g.push(...M);const A=E?d.find(E-1):d.id;if(!A)throw new e;m.push([A,[j]])}else throw N}}}}const O=this.builder,x=m.length;for(let C=0;C<x;C++){const[S,E]=m[C];O.insArr(d.id,S,E.map(I=>O.json(I)))}g.length&&O.del(d.id,g)}diffObj(d,w){const b=this.builder,v=[],a=new Set;d.forEach(g=>{a.add(g),w[g]===void 0&&v.push([g,b.con(void 0)])});const f=Object.keys(w),m=f.length;for(let g=0;g<m;g++){const y=f[g],O=w[y];if(a.has(y)){const x=d.get(y);if(x)try{this.diffAny(x,O);continue}catch(C){if(!(C instanceof e))throw C}}v.push([y,d.get(y)instanceof o.ConNode?b.con(O):b.constOrJson(O)])}v.length&&b.insObj(d.id,v)}diffVec(d,w){const b=this.builder,v=[],a=d.elements,f=a.length,m=w.length,g=d.doc.index,y=Math.min(f,m);for(let O=m;O<f;O++){const x=a[O];if(x){const C=g.get(x);if(!C||C instanceof o.ConNode&&C.val===void 0)return;v.push([O,b.con(void 0)])}}for(let O=0;O<y;O++){const x=w[O],C=d.get(O);if(C)try{this.diffAny(C,x);continue}catch(S){if(!(S instanceof e))throw S}v.push([O,b.constOrJson(x)])}for(let O=f;O<m;O++)v.push([O,b.constOrJson(w[O])]);v.length&&b.insVec(d.id,v)}diffVal(d,w){try{this.diffAny(d.node(),w)}catch(b){if(b instanceof e){const v=this.builder;v.setVal(d.id,v.constOrJson(w))}else throw b}}diffAny(d,w){if(d instanceof o.ConNode){if(d.val!==w&&!(0,u.deepEqual)(d.val,w))throw new e}else if(d instanceof o.StrNode){if(typeof w!="string")throw new e;this.diffStr(d,w)}else if(d instanceof o.ObjNode){if(!w||typeof w!="object"||Array.isArray(w))throw new e;this.diffObj(d,w)}else if(d instanceof o.ValNode)this.diffVal(d,w);else if(d instanceof o.ArrNode){if(!Array.isArray(w))throw new e;this.diffArr(d,w)}else if(d instanceof o.VecNode){if(!Array.isArray(w))throw new e;this.diffVec(d,w)}else if(d instanceof o.BinNode){if(!(w instanceof Uint8Array))throw new e;this.diffBin(d,w)}else throw new e}diff(d,w){return this.diffAny(d,w),this.builder.flush()}};return vt.JsonCrdtDiff=l,vt}var ya;function Af(){return ya||(ya=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.merge=i.diff=void 0;const u=Tf(),_=(o,c)=>{const s=new u.JsonCrdtDiff(o.api.model).diff(o.node,c);return s.ops.length?s:void 0};i.diff=_;const p=(o,c)=>{const r=(0,i.diff)(o,c);return r&&o.api.model.applyPatch(r),r};i.merge=p}(mi)),mi}var Ci={},_a;function Mf(){return _a||(_a=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.proxy$=i.proxy=void 0;const u=(p,o=[])=>new Proxy(()=>{},{get:(c,r,s)=>(o.push(String(r)),(0,i.proxy)(p,o)),apply:(c,r,s)=>p(o,...s)});i.proxy=u;const _=(p,o,c=[])=>new Proxy({},{get:(r,s,n)=>s===o?p(c):(c.push(String(s)),(0,i.proxy$)(p,o,c))});i.proxy$=_}(Ci)),Ci}var Oa;function Pf(){if(Oa)return we;Oa=1,Object.defineProperty(we,"__esModule",{value:!0}),we.ModelApi=we.ArrApi=we.BinApi=we.StrApi=we.ObjApi=we.VecApi=we.ValApi=we.ConApi=we.NodeApi=void 0;const i=ie,u=Ye(),_=Yl(),p=Ki(),o=Of(),c=he(),r=lt(),s=Sf(),n=Ql(),t=Sr(),e=Zl(),l=xf(),h=i.__importStar(Af()),d=Mf(),w=C=>{if(!C)return[void 0,""];if(typeof C=="number")return[void 0,C];switch(typeof C=="string"&&(C=(0,p.toPath)(C)),C.length){case 0:return[void 0,""];case 1:return[void 0,C[0]];default:{const S=C[C.length-1];return[C.slice(0,-1),S]}}};class b{constructor(S,E){this.node=S,this.api=E,this.ev=void 0}get events(){return this.ev||(this.ev=new s.NodeEvents(this))}find(S){let E=this.node;if(S===void 0){if(typeof E.child=="function"){const I=E.child();if(!I){if(E instanceof r.RootNode)return E;throw new Error("NO_CHILD")}return I}throw new Error("CANNOT_IN")}for(typeof S=="string"&&S&&S[0]!=="/"&&(S="/"+S),typeof S=="number"&&(S=[S]);E instanceof r.ValNode;)E=E.child();return(0,o.find)(E,S)}in(S){const E=this.find(S);return this.api.wrap(E)}asVal(){if(this.node instanceof r.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof r.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof r.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof r.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof r.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof r.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof r.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(S){let E;const I=this.node;if(I instanceof l.ExtNode&&(E=I),I instanceof r.VecNode&&(E=I.ext()),!E)throw new Error("NOT_EXT");const j=this.api.wrap(E);if(!S||j instanceof S.Api)return j;throw new Error("NOT_EXT")}val(S){return this.in(S).asVal()}str(S){return this.in(S).asStr()}bin(S){return this.in(S).asBin()}arr(S){return this.in(S).asArr()}vec(S){return this.in(S).asVec()}obj(S){return this.in(S).asObj()}con(S){return this.in(S).asCon()}view(){return this.node.view()}select(S,E){try{let I=S!==void 0?this.find(S):this.node;if(E)for(;I instanceof r.ValNode;)I=I.child();return this.api.wrap(I)}catch{return}}read(S){const E=this.view();if(Array.isArray(S))return(0,_.get)(E,S);if(!S)return E;let I=S+"";return S&&I[0]!=="/"&&(I="/"+I),(0,_.get)(E,(0,p.toPath)(I))}add(S,E){const[I,j]=w(S);e:try{const N=this.select(I,!0);if(N instanceof m)N.set({[j]:E});else if(N instanceof O||N instanceof g||N instanceof y){const M=N.length();let A=0;if(typeof j=="number")A=j;else if(j==="-")A=M;else if(A=~~j,A+""!==j)break e;if(A!==A)break e;if(A<0&&(A=0),A>M&&(A=M),N instanceof O)N.ins(A,Array.isArray(E)?E:[E]);else if(N instanceof g)N.ins(A,E+"");else if(N instanceof y){if(!(E instanceof Uint8Array))break e;N.ins(A,E)}}else if(N instanceof f)N.set([[~~j,E]]);else break e;return!0}catch{}return!1}replace(S,E){const[I,j]=w(S);e:try{const N=this.select(I,!0);if(N instanceof m){const M=j+"";if(!N.has(M))break e;N.set({[j]:E})}else if(N instanceof O){const M=N.length();let A=0;if(typeof j=="number")A=j;else if(A=~~j,A+""!==j)break e;if(A!==A||A<0||A>M)break e;A===M?N.ins(A,[E]):N.upd(A,E)}else if(N instanceof f)N.set([[~~j,E]]);else break e;return!0}catch{}return!1}remove(S,E=1){const[I,j]=w(S);e:try{const N=this.select(I,!0);if(N instanceof m){const M=j+"";if(!N.has(M))break e;N.del([M])}else if(N instanceof O||N instanceof g||N instanceof y){const M=N.length();let A=0;if(typeof j=="number")A=j;else if(j==="-")A=E;else if(A=~~j,A+""!==j)break e;if(A!==A||A<0||A>M)break e;N.del(A,Math.min(E,M-A))}else if(N instanceof f)N.set([[~~j,void 0]]);else break e;return!0}catch{}return!1}diff(S){return h.diff(this,S)}merge(S){return h.merge(this,S)}op(S){var N;if(!Array.isArray(S))return!1;const[E,I,j]=S;switch(E){case"add":return this.add(I,j);case"replace":return this.replace(I,j);case"merge":return!!((N=this.select(I))!=null&&N.merge(j));case"remove":return this.remove(I,j)}}get s(){return{$:this}}get $(){return(0,d.proxy$)(S=>{try{return this.api.wrap(this.find(S))}catch{return}},"$")}toString(S=""){return"api("+(this.constructor===b?"*":this.node.name())+")"+(0,u.printTree)(S,[I=>this.node.toString(I)])}}we.NodeApi=b;class v extends b{get s(){return{$:this}}}we.ConApi=v;class a extends b{get(){return this.in()}set(S){const{api:E,node:I}=this,N=E.builder.constOrJson(S);E.builder.setVal(I.id,N),E.apply()}get s(){const S=this;return{$:this,get _(){const I=S.node.node();return S.api.wrap(I).s}}}}we.ValApi=a;class f extends b{get(S){return this.in(S)}set(S){const{api:E,node:I}=this,{builder:j}=E;j.insVec(I.id,S.map(([N,M])=>[N,j.constOrJson(M)])),E.apply()}push(...S){const E=this.length();this.set(S.map((I,j)=>[E+j,I]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(E,I,j)=>{if(I==="$")return this;if(I==="toExt")return()=>this.asExt();const N=Number(I);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const M=this.node.get(N);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}we.VecApi=f;class m extends b{get(S){return this.in(S)}set(S){const{api:E,node:I}=this,{builder:j}=E;j.insObj(I.id,Object.entries(S).map(([N,M])=>[N,j.constOrJson(M)])),E.apply()}del(S){const{api:E,node:I}=this,{builder:j}=E;E.builder.insObj(I.id,S.map(N=>[N,j.con(void 0)])),E.apply()}has(S){return this.node.keys.has(S)}get s(){return new Proxy({},{get:(E,I,j)=>{if(I==="$")return this;const N=String(I),M=this.node.get(N);if(!M)throw new Error("NO_SUCH_KEY");return this.api.wrap(M).s}})}}we.ObjApi=m;class g extends b{ins(S,E){const{api:I,node:j}=this;I.onBeforeLocalChange.emit(I.next);const N=I.builder;N.pad();const M=I.builder.nextTime(),A=new c.Timestamp(N.clock.sid,M),D=j.insAt(S,A,E);if(!D)throw new Error("OUT_OF_BOUNDS");N.insStr(j.id,D,E),I.advance()}del(S,E){const{api:I,node:j}=this;I.onBeforeLocalChange.emit(I.next);const N=I.builder;N.pad();const M=j.findInterval(S,E);if(!M)throw new Error("OUT_OF_BOUNDS");j.delete(M),N.del(j.id,M),I.advance()}findId(S){const E=this.node,j=E.length()-1;return S>j&&(S=j),S<0?E.id:E.find(S)||E.id}findPos(S){const E=this.node,I=E.id;if(I.sid===S.sid&&I.time===S.time)return-1;const j=E.findById(S);return j?E.pos(j)+(j.del?0:S.time-j.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}we.StrApi=g;class y extends b{ins(S,E){const{api:I,node:j}=this,N=S?j.find(S-1):j.id;if(!N)throw new Error("OUT_OF_BOUNDS");I.builder.insBin(j.id,N,E),I.apply()}del(S,E){const{api:I,node:j}=this,N=j.findInterval(S,E);if(!N)throw new Error("OUT_OF_BOUNDS");I.builder.del(j.id,N),I.apply()}length(){return this.node.length()}get s(){return{$:this}}}we.BinApi=y;class O extends b{get(S){return this.in(S)}ins(S,E){const{api:I,node:j}=this,{builder:N}=I,M=S?j.find(S-1):j.id;if(!M)throw new Error("OUT_OF_BOUNDS");const A=[];for(let D=0;D<E.length;D++)A.push(N.json(E[D]));N.insArr(j.id,M,A),I.apply()}push(...S){const E=this.length();this.ins(E,S)}upd(S,E){const{api:I,node:j}=this,N=j.getId(S);if(!N)throw new Error("OUT_OF_BOUNDS");const{builder:M}=I;M.updArr(j.id,N,M.constOrJson(E)),I.apply()}del(S,E){const{api:I,node:j}=this,N=j.findInterval(S,E);if(!N)throw new Error("OUT_OF_BOUNDS");I.builder.del(j.id,N),I.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(E,I,j)=>{if(I==="$")return this;const N=Number(I);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const M=this.node.getNode(N);if(!M)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(M).s}})}}we.ArrApi=O;class x extends a{constructor(S){super(S.root,void 0),this.model=S,this.next=0,this.onBeforeReset=new n.FanOut,this.onReset=new n.FanOut,this.onBeforePatch=new n.FanOut,this.onPatch=new n.FanOut,this.onBeforeLocalChange=new n.FanOut,this.onLocalChange=new n.FanOut,this.onLocalChanges=new e.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new n.FanOut,this.onTransaction=new n.FanOut,this.onChange=new e.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new e.MicrotaskBufferFanOut(this.onChange),this.onFlush=new n.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=E=>this.onChanges.listen(()=>E()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new t.PatchBuilder(S.clock),S.onbeforereset=()=>this.onBeforeReset.emit(),S.onreset=()=>this.onReset.emit(),S.onbeforepatch=E=>this.onBeforePatch.emit(E),S.onpatch=E=>this.onPatch.emit(E)}wrap(S){if(S instanceof r.ValNode)return S.api||(S.api=new a(S,this));if(S instanceof r.StrNode)return S.api||(S.api=new g(S,this));if(S instanceof r.BinNode)return S.api||(S.api=new y(S,this));if(S instanceof r.ArrNode)return S.api||(S.api=new O(S,this));if(S instanceof r.ObjNode)return S.api||(S.api=new m(S,this));if(S instanceof r.ConNode)return S.api||(S.api=new v(S,this));if(S instanceof r.VecNode)return S.api||(S.api=new f(S,this));if(S instanceof l.ExtNode){if(S.api)return S.api;const E=this.model.ext.get(S.extId);return S.api=new E.Api(S,this)}else throw new Error("UNKNOWN_NODE")}root(S){return this.set(S)}set(S){return super.set(S),this}apply(){const S=this.builder.patch.ops,E=S.length,I=this.model,j=this.next;this.onBeforeLocalChange.emit(j);for(let N=this.next;N<E;N++)I.applyOperation(S[N]);this.next=E,I.tick++,this.onLocalChange.emit(j)}advance(){const S=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(S)}transaction(S){if(this.inTx)S();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),S(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const S=this.builder.flush();return this.next=0,S.ops.length&&this.onFlush.emit(S),S}autoFlush(S=!1){const E=()=>this.builder.patch.ops.length&&this.flush(),I=this.onLocalChanges.listen(E),j=this.onBeforeTransaction.listen(E),N=this.onTransaction.listen(E);return S&&E(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,I(),j(),N()}}}return we.ModelApi=x,we}var Sa;function tc(){return Sa||(Sa=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ie.__exportStar(Pf(),i)}(ci)),ci}var $n={},xa;function Df(){if(xa)return $n;xa=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.randomSessionId=void 0;const i=65535,u=9007199254740991-i,_=()=>Math.floor(u*Math.random()+i);return $n.randomSessionId=_,$n}var Ln={},Ca;function qf(){if(Ca)return Ln;Ca=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.Extensions=void 0;const i=Ye();let u=class nc{constructor(){this.ext={}}register(p){this.ext[p.id]=p}get(p){return this.ext[p]}size(){return Object.keys(this.ext).length}clone(){const p=new nc;for(const o of Object.values(this.ext))p.register(o);return p}toString(p=""){const o=Object.keys(this.ext).map(c=>+c).sort();return"extensions"+(0,i.printTree)(p,o.map(c=>r=>`${c}: ${this.ext[c].name}`))}};return Ln.Extensions=u,Ln}var gt={},Ei={},Ni={},Un={},Ea;function Zi(){if(Ea)return Un;Ea=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.printBinary=void 0;const i=(u="",_)=>{const p=_[0],o=_[1];let c="";return p&&(c+=`
`+u+"← "+p(u+"  ")),o&&(c+=`
`+u+"→ "+o(u+"  ")),c};return Un.printBinary=i,Un}var Na;function Bf(){return Na||(Na=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ie.__exportStar(Zi(),i)}(Ni)),Ni}var Ia;function Vf(){return Ia||(Ia=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.print=i.remove=i.insert=i.insertLeft=i.insertRight=void 0;const u=Bf(),_=JSON.stringify,p=(b,v,a)=>{const f=v.p;if(!f)return b;const m=v===f.l;let g=f.bf|0;switch(m?f.bf=++g:f.bf=--g,g){case 0:return b;case 1:case-1:return p(b,f,v);default:{const y=a===v.l;return m?y?(o(f,v),v.p?b:v):(r(f,v,a),a.p?b:a):y?(s(f,v,a),a.p?b:a):(c(f,v),v.p?b:v)}}},o=(b,v)=>{const a=b.p,f=v.r;v.p=a,v.r=b,b.p=v,b.l=f,f&&(f.p=b),a&&(a.l===b?a.l=v:a.r=v);let m=b.bf,g=v.bf;m+=-1-(g>0?g:0),g+=-1+(m<0?m:0),b.bf=m,v.bf=g},c=(b,v)=>{const a=b.p,f=v.l;v.p=a,v.l=b,b.p=v,b.r=f,f&&(f.p=b),a&&(a.l===b?a.l=v:a.r=v);let m=b.bf,g=v.bf;m+=1-(g<0?g:0),g+=1+(m>0?m:0),b.bf=m,v.bf=g},r=(b,v,a)=>{c(v,a),o(b,a)},s=(b,v,a)=>{o(v,a),c(b,a)},n=(b,v,a)=>(a.r=v,v.p=a,a.bf--,a.l?b:p(b,a,v));i.insertRight=n;const t=(b,v,a)=>(a.l=v,v.p=a,a.bf++,a.r?b:p(b,a,v));i.insertLeft=t;const e=(b,v,a)=>{if(!b)return v;const f=v.k;let m=b,g,y=0;for(;g=(y=a(f,m.k))<0?m.l:m.r;)m=g;return y<0?(0,i.insertLeft)(b,v,m):(0,i.insertRight)(b,v,m)};i.insert=e;const l=(b,v)=>{if(!b)return v;const a=v.p,f=v.l,m=v.r;if(v.p=v.l=v.r=void 0,f&&m)if(f.r){let O=f,x=O;for(;x=O.r;)O=x;const C=O.l,S=O.p,E=C;return a&&(a.l===v?a.l=O:a.r=O),O.p=a,O.r=m,O.bf=v.bf,f!==O&&(O.l=f,f.p=O),m.p=O,S&&(S.l===O?S.l=E:S.r=E),E&&(E.p=S),d(a?b:O,S,1)}else{a&&(a.l===v?a.l=f:a.r=f),f.p=a,f.r=m,m.p=f;const O=v.bf;if(a)return f.bf=O,h(b,f,1);const x=O-1;if(f.bf=x,x>=-1)return f;const C=m.l;return m.bf>0?(s(f,m,C),C):(c(f,m),m)}const g=f||m;return g&&(g.p=a),a?a.l===v?(a.l=g,h(b,a,1)):(a.r=g,d(b,a,1)):g};i.remove=l;const h=(b,v,a)=>{let f=v.bf|0;f-=a,v.bf=f;let m=a;if(f===-1)return b;if(f<-1){const y=v.r;if(y.bf<=0)y.l&&y.bf===0&&(m=0),c(v,y),v=y;else{const O=y.l;s(v,y,O),v=O}}const g=v.p;return g?g.l===v?h(b,g,m):d(b,g,m):v},d=(b,v,a)=>{let f=v.bf|0;f+=a,v.bf=f;let m=a;if(f===1)return b;if(f>1){const y=v.l;if(y.bf>=0)y.r&&y.bf===0&&(m=0),o(v,y),v=y;else{const O=y.r;r(v,y,O),v=O}}const g=v.p;return g?g.l===v?h(b,g,m):d(b,g,m):v},w=(b,v="")=>{if(!b)return"∅";const{bf:a,l:f,r:m,k:g,v:y}=b,O=y&&typeof y=="object"&&y.constructor===Object?_(y):y&&typeof y=="object"?y.toString(v):_(y),x=g!==void 0?` { ${_(g)} = ${O} }`:"",C=a?` [${a}]`:"";return b.constructor.name+`${C}`+x+(0,u.printBinary)(v,[f?S=>(0,i.print)(f,S):null,m?S=>(0,i.print)(m,S):null])};i.print=w}(Ei)),Ei}var Fn={},Ii={},zn={},Ra;function rc(){if(Ra)return zn;Ra=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.first=void 0;const i=u=>{let _=u;for(;_;)if(_.l)_=_.l;else return _;return _};return zn.first=i,zn}var Wn={},ja;function $f(){if(ja)return Wn;ja=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.next=void 0;const i=rc(),u=_=>{const p=_.r;if(p)return(0,i.first)(p);let o=_.p;for(;o&&o.r===_;)_=o,o=o.p;return o};return Wn.next=u,Wn}var ka;function ic(){return ka||(ka=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.remove=i.insert=i.insertLeft=i.insertRight=i.findOrNextLower=i.find=i.size=i.prev=i.last=i.next=i.first=void 0;const u=rc();Object.defineProperty(i,"first",{enumerable:!0,get:function(){return u.first}});const _=$f();Object.defineProperty(i,"next",{enumerable:!0,get:function(){return _.next}});const p=d=>{let w=d;for(;w;)if(w.r)w=w.r;else return w;return w};i.last=p;const o=d=>{if(d.l){for(d=d.l;d.r;)d=d.r;return d}let w=d.p;for(;w&&w.l===d;)d=w,w=w.p;return w};i.prev=o;const c=d=>{const w=d.l,b=d.r;return 1+(w?c(w):0)+(b?c(b):0)},r=d=>d?c(d):0;i.size=r;const s=(d,w,b)=>{let v=d;for(;v;){const a=b(w,v.k);if(a===0)return v;v=a<0?v.l:v.r}return v};i.find=s;const n=(d,w,b)=>{let v=d,a;for(;v;){const f=b(v.k,w);if(f===0)return v;if(f>0)v=v.l;else{const m=v.r;if(a=v,!m)return a;v=m}}return a};i.findOrNextLower=n;const t=(d,w)=>{const b=d.r=w.r;w.r=d,d.p=w,b&&(b.p=d)};i.insertRight=t;const e=(d,w)=>{const b=d.l=w.l;w.l=d,d.p=w,b&&(b.p=d)};i.insertLeft=e;const l=(d,w,b)=>{if(!d)return w;const v=w.k;let a=d;for(;a;){const f=b(v,a.k),m=f<0?a.l:a.r;if(m)a=m;else{f<0?(0,i.insertLeft)(w,a):(0,i.insertRight)(w,a);break}}return d};i.insert=l;const h=(d,w)=>{const b=w.p,v=w.l,a=w.r;if(w.p=w.l=w.r=void 0,!v&&!a){if(b)b.l===w?b.l=void 0:b.r=void 0;else return;return d}else if(v&&a){let m=v;for(;m.r;)m=m.r;return m.r=a,a.p=m,b?(b.l===w?b.l=v:b.r=v,v.p=b,d):(v.p=void 0,v)}const f=v||a;if(f.p=b,b)b.l===w?b.l=f:b.r=f;else return f;return d};i.remove=h}(Ii)),Ii}var Ri={},Ta;function Lf(){return Ta||(Ta=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),ie.__exportStar(Ye(),i)}(Ri)),Ri}var Aa;function Uf(){if(Aa)return Fn;Aa=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.createMap=void 0;const i=ic(),u=Lf(),_=(o,c)=>o===c?0:o<c?-1:1,p=(o,c,r,s,n,t)=>{class e{constructor(h){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=i.next,this.comparator=h||_}set(h,d){const w=this.root;if(w===void 0){this._size=1;const g=new o(h,d);return this.root=this.min=this.max=c(void 0,g,this.comparator)}const b=this.comparator;let v;const a=this.max;if(v=b(h,a.k),v===0)return a.v=d,a;if(v>0){const g=this.max=new o(h,d);return this.root=s(w,g,a),this._size++,g}const f=this.min;if(v=b(h,f.k),v===0)return f.v=d,f;if(v<0){const g=this.min=new o(h,d);return this.root=r(w,g,f),this._size++,g}let m=w;do{if(v=b(h,m.k),v===0)return m.v=d,m;if(v>0){const g=m.r;if(g===void 0){const y=new o(h,d);return this.root=s(w,y,m),this._size++,y}m=g}else if(v<0){const g=m.l;if(g===void 0){const y=new o(h,d);return this.root=r(w,y,m),this._size++,y}m=g}}while(!0)}find(h){const d=this.comparator;let w=this.root;for(;w;){const b=+d(h,w.k);if(b===0)return w;w=b<0?w.l:w.r}}get(h){var d;return(d=this.find(h))==null?void 0:d.v}del(h){const d=this.find(h);return d?(d===this.max&&(this.max=(0,i.prev)(d)),d===this.min&&(this.min=(0,i.next)(d)),this.root=n(this.root,d),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(h){return!!this.find(h)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(h){return(0,i.findOrNextLower)(this.root,h,this.comparator)||void 0}forEach(h){let d=this.first();if(d)do h(d);while(d=(0,i.next)(d))}first(){return this.min}last(){return this.max}iterator0(){let h=this.first();return()=>{if(!h)return;const d=h;return h=(0,i.next)(h),d}}iterator(){const h=this.iterator0();return{next:()=>{const d=h();return{value:d,done:!d}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(h){return this.constructor.name+(0,u.printTree)(h,[d=>t(this.root,d)])}}return e};return Fn.createMap=p,Fn}var Ma;function Ff(){if(Ma)return gt;Ma=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.AvlMap=gt.AvlNode=void 0;const i=Vf(),u=Uf();class _{constructor(o,c){this.k=o,this.v=c,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return gt.AvlNode=_,gt.AvlMap=(0,u.createMap)(_,i.insert,i.insertLeft,i.insertRight,i.remove,i.print),gt}var Pa;function es(){if(Pa)return pt;Pa=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.Model=pt.UNDEFINED=void 0;const i=ie,u=i.__importStar(Vt()),_=i.__importStar(he()),p=mf(),o=tc(),c=Or(),r=Df(),s=lt(),n=Er(),t=Ye(),e=qf(),l=Ff(),h=xr();pt.UNDEFINED=new n.ConNode(c.ORIGIN,void 0);let d=class Ui{rndSid(){const b=this.clock,v=b.sid,a=b.peers;for(;;){const f=(0,r.randomSessionId)();if(v!==f&&!a.has(f))return f}}static fromPatches(b){if(!b.length)throw new Error("NO_PATCHES");const f=b[0].getId().sid;if(!f)throw new Error("NO_SID");const m=Ui.create(void 0,f);return m.applyBatch(b),m}constructor(b){this.root=new s.RootNode(this,c.ORIGIN),this.index=new l.AvlMap(_.compare),this.ext=new e.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=b,b.time||(b.time=1)}get api(){return this._api||(this._api=new o.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(b){const v=b.length;for(let a=0;a<v;a++)this.applyPatch(b[a])}applyLocalPatch(b){const v=b.getId();if(v){const a=this.clock;if(a.sid===v.sid){const f=a.time;f>v.time&&(b=b.rebase(f))}}this.applyPatch(b)}applyPatch(b){var f,m;(f=this.onbeforepatch)==null||f.call(this,b);const v=b.ops,{length:a}=v;for(let g=0;g<a;g++)this.applyOperation(v[g]);this.tick++,(m=this.onpatch)==null||m.call(this,b)}applyOperation(b){this.clock.observe(b.id,b.span());const v=this.index;if(b instanceof u.InsStrOp){const a=v.get(b.obj);a instanceof s.StrNode&&a.ins(b.ref,b.id,b.data)}else if(b instanceof u.NewObjOp){const a=b.id;v.get(a)||v.set(a,new s.ObjNode(this,a))}else if(b instanceof u.NewArrOp){const a=b.id;v.get(a)||v.set(a,new s.ArrNode(this,a))}else if(b instanceof u.NewStrOp){const a=b.id;v.get(a)||v.set(a,new s.StrNode(a))}else if(b instanceof u.NewValOp){const a=b.id;v.get(a)||v.set(a,new s.ValNode(this,a,c.ORIGIN))}else if(b instanceof u.NewConOp){const a=b.id;v.get(a)||v.set(a,new n.ConNode(a,b.val))}else if(b instanceof u.InsObjOp){const a=v.get(b.obj),f=b.data,m=f.length;if(a instanceof s.ObjNode)for(let g=0;g<m;g++){const y=f[g],O=v.get(y[1]);if(!O||a.id.time>=y[1].time)continue;const x=a.put(y[0]+"",O.id);x&&this._gcTree(x)}}else if(b instanceof u.InsVecOp){const a=v.get(b.obj),f=b.data,m=f.length;if(a instanceof s.VecNode)for(let g=0;g<m;g++){const y=f[g],O=v.get(y[1]);if(!O||a.id.time>=y[1].time)continue;const x=a.put(Number(y[0]),O.id);x&&this._gcTree(x)}}else if(b instanceof u.InsValOp){const a=b.obj,f=a.sid===0&&a.time===0?this.root:v.get(a);if(f instanceof s.ValNode&&v.get(b.val)){const g=f.set(b.val);g&&this._gcTree(g)}}else if(b instanceof u.InsArrOp){const a=v.get(b.obj);if(a instanceof s.ArrNode){const f=[],m=b.data,g=m.length;for(let y=0;y<g;y++){const O=m[y];v.get(O)&&(a.id.time>=O.time||f.push(O))}f.length&&a.ins(b.ref,b.id,f)}}else if(b instanceof u.UpdArrOp){const a=v.get(b.obj);if(a instanceof s.ArrNode){const f=b.val;if(v.get(f)){const m=a.upd(b.ref,f);m&&this._gcTree(m)}}}else if(b instanceof u.DelOp){const a=v.get(b.obj);if(a instanceof s.ArrNode){const f=b.what.length;for(let m=0;m<f;m++){const g=b.what[m];for(let y=0;y<g.span;y++){const O=a.getById(new _.Timestamp(g.sid,g.time+y));O&&this._gcTree(O)}}a.delete(b.what)}else(a instanceof s.StrNode||a instanceof s.BinNode)&&a.delete(b.what)}else if(b instanceof u.NewBinOp){const a=b.id;v.get(a)||v.set(a,new s.BinNode(a))}else if(b instanceof u.InsBinOp){const a=v.get(b.obj);a instanceof s.BinNode&&a.ins(b.ref,b.id,b.data)}else if(b instanceof u.NewVecOp){const a=b.id;v.get(a)||v.set(a,new s.VecNode(this,a))}}_gcTree(b){if(b.sid===0)return;const a=this.index.get(b);if(!a)return;const f=a.api;f&&f.events.handleDelete(),a.children(m=>this._gcTree(m.id)),this.index.del(b)}fork(b=this.rndSid()){const v=Ui.fromBinary(this.toBinary());return v.clock.sid!==b&&v.clock instanceof _.ClockVector&&(v.clock=v.clock.fork(b)),v.ext=this.ext,v}clone(){return this.fork(this.clock.sid)}reset(b){var m,g;(m=this.onbeforereset)==null||m.call(this);const v=this.index;this.index=new l.AvlMap(_.compare);const a=b.toBinary();p.decoder.decode(a,this),this.clock=b.clock.clone(),this.ext=b.ext.clone();const f=this._api;f&&(f.flush(),f.builder.clock=this.clock,f.node=this.root),v.forEach(({v:y})=>{const O=y.api;if(!O)return;const x=this.index.get(y.id);if(!x){O.events.handleDelete();return}O.node=x,x.api=O}),this.tick++,(g=this.onreset)==null||g.call(this)}view(){return this.root.view()}toBinary(){return p.encoder.encode(this)}setSchema(b,v=!0){const a=this.clock;if(a.time===1){const m=a.sid;v&&(a.sid=2),this.api.set(b),v&&this.setSid(m)}return this}setSid(b){const v=this.clock,a=v.sid;a!==b&&(v.sid=b,v.observe(new _.Timestamp(a,v.time-1),1))}toString(b=""){const v=()=>"",a=this.ext.size()>0;return"model"+(0,t.printTree)(b,[f=>this.root.toString(f),v,f=>{const m=[];return this.index.forEach(g=>m.push(g.v)),`index (${m.length} nodes)`+(m.length?(0,t.printTree)(f,m.map(g=>y=>`${g.name()} ${_.printTs(g.id)}`)):"")},v,f=>`view${(0,t.printTree)(f,[m=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+m)])}`,v,f=>this.clock.toString(f),a?v:null,a?f=>this.ext.toString(f):null])}};return pt.Model=d,d.sid=r.randomSessionId,d.create=(w,b=d.sid())=>{const v=typeof b=="number"?b===1?new _.ServerClockVector(1,1):new _.ClockVector(b,1):b,a=new d(v);return w!==void 0&&a.setSchema(w instanceof h.NodeBuilder?w:h.s.json(w),!0),a},d.withServerClock=(w,b=1)=>d.create(w,new _.ServerClockVector(1,b)),d.fromBinary=w=>p.decoder.decode(w),d.load=(w,b,v)=>{const a=p.decoder.decode(w);return v&&a.setSchema(v,!0),typeof b=="number"&&a.setSid(b),a},pt}var Da;function sc(){if(Da)return Cn;Da=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.ValNode=void 0;const i=he(),u=Ye(),_=es();let p=class{constructor(c,r,s){this.doc=c,this.id=r,this.val=s,this.api=void 0}set(c){if((0,i.compare)(c,this.val)<=0&&this.val.sid!==0||(0,i.compare)(c,this.id)<=0)return;const r=this.val;return this.val=c,r}node(){return this.val.sid===0?_.UNDEFINED:this.child()}view(){var c;return(c=this.node())==null?void 0:c.view()}children(c){c(this.node())}child(){return this.doc.index.get(this.val)}container(){const c=this.node();return c?c.container():void 0}name(){return"val"}toString(c=""){const r=this.node();return this.name()+" "+(0,i.printTs)(this.id)+(0,u.printTree)(c,[n=>r?r.toString(n):(0,i.printTs)(this.val)])}};return Cn.ValNode=p,Cn}var Gn={},qa;function zf(){if(qa)return Gn;qa=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.RootNode=void 0;const i=Or(),u=sc();let _=class extends u.ValNode{constructor(o,c){super(o,i.ORIGIN,c)}name(){return"root"}};return Gn.RootNode=_,Gn}var Jn={},Hn={},Ba;function Wf(){if(Ba)return Hn;Ba=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.CRDT_CONSTANTS=void 0;var i;return function(u){u[u.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(i||(Hn.CRDT_CONSTANTS=i={})),Hn}var Va;function Gf(){if(Va)return Jn;Va=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.VecNode=void 0;const i=Er(),u=Wf(),_=Ye(),p=he();let o=class{constructor(r,s){this.doc=r,this.id=s,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(r){return this.elements[r]}get(r){const s=this.elements[r];if(s)return this.doc.index.get(s)}put(r,s){if(r>u.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const n=this.val(r);if(!(n&&(0,p.compare)(n,s)>=0)){if(r>this.elements.length)for(let t=this.elements.length;t<r;t++)this.elements.push(void 0);return r<this.elements.length?this.elements[r]=s:this.elements.push(s),n}}ext(){if(this.__extNode)return this.__extNode;const r=this.getExtId();if(!(r>=0))return;const n=this.doc.ext.get(r);if(n)return this.__extNode=new n.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const r=this.get(0);if(!(r instanceof i.ConNode))return-1;const s=r.val,n=this.id;return!(s instanceof Uint8Array)||s.length!==3||s[1]!==n.sid%256||s[2]!==n.time%256?-1:s[0]}child(){return this.ext()}container(){return this}children(r){const s=this.elements,n=s.length,t=this.doc.index;for(let e=0;e<n;e++){const l=s[e];if(!l)continue;const h=t.get(l);h&&r(h)}}view(){const r=this.ext();if(r)return r.view();let s=!0;const n=this._view,t=[],e=this.doc.index,l=this.elements,h=l.length;for(let d=0;d<h;d++){const w=l[d],b=w?e.get(w):void 0,v=b?b.view():void 0;n[d]!==v&&(s=!1),t.push(v)}return s?n:this._view=t}name(){return"vec"}toString(r=""){const s=this.ext(),n=this.name()+" "+(0,p.printTs)(this.id)+(s?` { extension = ${this.getExtId()} }`:"");if(s)return this.child().toString(r,this.id);const t=this.doc.index;return n+(0,_.printTree)(r,[...this.elements.map((e,l)=>h=>`${l}: ${e&&t.get(e)?t.get(e).toString(h+"  "+" ".repeat((""+l).length)):"nil"}`),...s?[e=>`${this.child().toString(e)}`]:[]])}};return Jn.VecNode=o,Jn}var Kn={},$a;function Jf(){if($a)return Kn;$a=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.ObjNode=void 0;const i=Ye(),u=he(),_=Er();let p=class{constructor(c,r){this.doc=c,this.id=r,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(c){const r=this.keys.get(c);if(r)return this.doc.index.get(r)}put(c,r){const s=this.keys.get(c);if(!(s&&(0,u.compare)(s,r)>=0))return this.keys.set(c,r),s}nodes(c){const r=this.doc.index;this.keys.forEach((s,n)=>c(r.get(s),n))}forEach(c){const r=this.doc.index;this.keys.forEach((s,n)=>{const t=r.get(s);!t||t instanceof _.ConNode&&t.val===void 0||c(n,t)})}children(c){const r=this.doc.index;this.keys.forEach((s,n)=>c(r.get(s)))}child(){}container(){return this}view(){const c=this.doc,r=c.clock.time+c.tick,s=this._view;if(this._tick===r)return s;const n={},t=c.index;let e=!0;return this.keys.forEach((l,h)=>{const d=t.get(l);if(!d){e=!1;return}const w=d.view();w!==void 0?(s[h]!==w&&(e=!1),n[h]=w):s[h]!==void 0&&(e=!1)}),e?s:(this._tick=r,this._view=n)}name(){return"obj"}toString(c=""){return this.name()+" "+(0,u.printTs)(this.id)+(0,i.printTree)(c,[...this.keys.entries()].filter(([,s])=>!!this.doc.index.get(s)).map(([s,n])=>t=>JSON.stringify(s)+(0,i.printTree)(t+" ",[e=>this.doc.index.get(n).toString(e)])))}};return Kn.ObjNode=p,Kn}var wt={},Xn={},ji={},La;function Hf(){return La||(La=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.rlSplay=i.lrSplay=i.llSplay=i.rrSplay=i.lSplay=i.rSplay=i.splay=void 0;const u=(n,t,e)=>{const l=t.p;if(!l)return n;const h=l.p,d=l.l===t;return h?(h.l===l?d?n=(0,i.llSplay)(n,t,l,h):n=(0,i.lrSplay)(n,t,l,h):d?n=(0,i.rlSplay)(n,t,l,h):n=(0,i.rrSplay)(n,t,l,h),e>1?(0,i.splay)(n,t,e-1):n):(d?(0,i.rSplay)(t,l):(0,i.lSplay)(t,l),t)};i.splay=u;const _=(n,t)=>{const e=n.r;n.p=void 0,n.r=t,t.p=n,t.l=e,e&&(e.p=t)};i.rSplay=_;const p=(n,t)=>{const e=n.l;n.p=void 0,n.l=t,t.p=n,t.r=e,e&&(e.p=t)};i.lSplay=p;const o=(n,t,e,l)=>{const h=e.l,d=t.l,w=l.p;return t.p=w,t.l=e,e.p=t,e.l=l,e.r=d,l.p=e,l.r=h,h&&(h.p=l),d&&(d.p=e),w?w.l===l?w.l=t:w.r=t:n=t,n};i.rrSplay=o;const c=(n,t,e,l)=>{const h=e.r,d=t.r,w=l.p;return t.p=w,t.r=e,e.p=t,e.l=d,e.r=l,l.p=e,l.l=h,h&&(h.p=l),d&&(d.p=e),w?w.l===l?w.l=t:w.r=t:n=t,n};i.llSplay=c;const r=(n,t,e,l)=>{const h=t.l,d=t.r,w=l.p;return t.p=w,t.l=e,t.r=l,e.p=t,e.r=h,l.p=t,l.l=d,h&&(h.p=e),d&&(d.p=l),w?w.l===l?w.l=t:w.r=t:n=t,n};i.lrSplay=r;const s=(n,t,e,l)=>{const h=t.r,d=t.l,w=l.p;return t.p=w,t.l=l,t.r=e,e.p=t,e.l=h,l.p=t,l.r=d,h&&(h.p=e),d&&(d.p=l),w?w.l===l?w.l=t:w.r=t:n=t,n};i.rlSplay=s}(ji)),ji}var ki={},Ua;function Kf(){return Ua||(Ua=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.splay2=void 0;const u=(n,t)=>{const e=t.p2;if(!e)return n;const l=e.p2,h=e.l2===t;return l?(l.l2===e?h?n=c(n,t,e,l):n=r(n,t,e,l):h?n=s(n,t,e,l):n=o(n,t,e,l),(0,i.splay2)(n,t)):(h?_(t,e):p(t,e),t)};i.splay2=u;const _=(n,t)=>{const e=n.r2;n.p2=void 0,n.r2=t,t.p2=n,t.l2=e,e&&(e.p2=t)},p=(n,t)=>{const e=n.l2;n.p2=void 0,n.l2=t,t.p2=n,t.r2=e,e&&(e.p2=t)},o=(n,t,e,l)=>{const h=e.l2,d=t.l2,w=l.p2;return t.p2=w,t.l2=e,e.p2=t,e.l2=l,e.r2=d,l.p2=e,l.r2=h,h&&(h.p2=l),d&&(d.p2=e),w?w.l2===l?w.l2=t:w.r2=t:n=t,n},c=(n,t,e,l)=>{const h=e.r2,d=t.r2,w=l.p2;return t.p2=w,t.r2=e,e.p2=t,e.l2=d,e.r2=l,l.p2=e,l.l2=h,h&&(h.p2=l),d&&(d.p2=e),w?w.l2===l?w.l2=t:w.r2=t:n=t,n},r=(n,t,e,l)=>{const h=t.l2,d=t.r2,w=l.p2;return t.p2=w,t.l2=e,t.r2=l,e.p2=t,e.r2=h,l.p2=t,l.l2=d,h&&(h.p2=e),d&&(d.p2=l),w?w.l2===l?w.l2=t:w.r2=t:n=t,n},s=(n,t,e,l)=>{const h=t.r2,d=t.l2,w=l.p2;return t.p2=w,t.l2=l,t.r2=e,e.p2=t,e.l2=h,l.p2=t,l.r2=d,h&&(h.p2=e),d&&(d.p2=l),w?w.l2===l?w.l2=t:w.r2=t:n=t,n}}(ki)),ki}var Ee={},Fa;function Xf(){if(Fa)return Ee;Fa=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.remove2=Ee.insert2=Ee.prev2=Ee.next2=Ee.last2=Ee.first2=void 0;const i=n=>{let t=n;for(;t;)if(t.l2)t=t.l2;else return t;return t};Ee.first2=i;const u=n=>{let t=n;for(;t;)if(t.r2)t=t.r2;else return t;return t};Ee.last2=u;const _=n=>{if(n.r2){for(n=n.r2;n.l2;)n=n.l2;return n}let t=n.p2;for(;t&&t.r2===n;)n=t,t=t.p2;return t};Ee.next2=_;const p=n=>{if(n.l2){for(n=n.l2;n.r2;)n=n.r2;return n}let t=n.p2;for(;t&&t.l2===n;)n=t,t=t.p2;return t};Ee.prev2=p;const o=(n,t)=>{const e=n.r2=t.r2;t.r2=n,n.p2=t,e&&(e.p2=n)},c=(n,t)=>{const e=n.l2=t.l2;t.l2=n,n.p2=t,e&&(e.p2=n)},r=(n,t,e)=>{if(!n)return t;let l=n;for(;l;){const h=e(t,l),d=h<0?l.l2:l.r2;if(d)l=d;else{h<0?c(t,l):o(t,l);break}}return n};Ee.insert2=r;const s=(n,t)=>{const e=t.p2,l=t.l2,h=t.r2;if(t.p2=t.l2=t.r2=void 0,!l&&!h){if(e)e.l2===t?e.l2=void 0:e.r2=void 0;else return;return n}else if(l&&h){let w=l;for(;w.r2;)w=w.r2;return w.r2=h,h.p2=w,e?(e.l2===t?e.l2=l:e.r2=l,l.p2=e,n):(l.p2=void 0,l)}const d=l||h;if(d.p2=e,e)e.l2===t?e.l2=d:e.r2=d;else return d;return n};return Ee.remove2=s,Ee}var Yn={},za;function Yf(){if(za)return Yn;za=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.printOctets=void 0;const i=(u,_=16)=>{let p="";if(!u.length)return p;u[0]<16&&(p+="0"),p+=u[0].toString(16);for(let o=1;o<u.length&&o<_;o++){const c=u[o];p+=" ",c<16&&(p+="0"),p+=c.toString(16)}return u.length>_&&(p+=`… (${u.length-_} more)`),p};return Yn.printOctets=i,Yn}var Wa;function ts(){if(Wa)return Xn;Wa=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.AbstractRga=void 0;const i=he(),u=Wi(),_=Hf(),p=Kf(),o=Xf(),c=Or(),r=Ye(),s=Zi(),n=Yf(),t=(v,a)=>{const f=v.id,m=a.id;return f.sid-m.sid||f.time-m.time},e=v=>{const a=v.l,f=v.r;v.len=(v.del?0:v.span)+(a?a.len:0)+(f?f.len:0)},l=v=>{const a=v.l,f=v.r;v.len=v.span+(a?a.len:0)+(f?f.len:0)},h=(v,a)=>{for(;v;)v.len+=a,v=v.p},d=v=>{const a=v.r;if(a){v=a;let m;for(;m=v.l;)v=m;return v}let f=v.p;for(;f&&f.r===v;)v=f,f=f.p;return f},w=v=>{const a=v.l;if(a){v=a;let m;for(;m=v.r;)v=m;return v}let f=v.p;for(;f&&f.l===v;)v=f,f=f.p;return f};let b=class{constructor(a){this.id=a,this.root=void 0,this.ids=void 0,this.count=0}ins(a,f,m){const g=this.id,y=a.time,O=a.sid;if(g.time===y&&g.sid===O){this.insAfterRoot(a,f,m);return}let C=this.ids,S=C;for(;C;){const D=C.id,V=D.sid;if(V>O)C=C.l2;else if(V<O)S=C,C=C.r2;else{const z=D.time;if(z>y)C=C.l2;else if(z<y)S=C,C=C.r2;else{S=C;break}}}if(!S)return;const E=S.id,I=E.time,j=E.sid,N=S.span;if(j!==O||y-I>=N)return;const A=y-I;this.insAfterChunk(a,S,A,f,m)}insAt(a,f,m){if(!a){const S=this.id;return this.insAfterRoot(S,f,m),S}const g=this.findChunk(a-1);if(!g)return;const[y,O]=g,x=y.id,C=O===0?x:new i.Timestamp(x.sid,x.time+O);return this.insAfterChunk(C,y,O,f,m),C}insAfterRoot(a,f,m){const g=this.createChunk(f,m),y=this.first();if(!y)this.setRoot(g);else if((0,i.compare)(y.id,f)<0)this.insertBefore(g,y);else{if((0,i.containsId)(y.id,y.span,f))return;this.insertAfterRef(g,a,y)}}insAfterChunk(a,f,m,g,y){const O=f.id,x=O.time,C=O.sid,S=f.span,E=this.createChunk(g,y);if(m+1<S){const j=g.sid,N=g.time;if(C===j&&x<=N&&x+S-1>=N)return;if(N>a.time+1||j>a.sid){this.insertInside(E,f,m+1),this.splay(E);return}}this.insertAfterRef(E,a,f),this.splay(E)}delete(a){const f=a.length;for(let m=0;m<f;m++)this.deleteSpan(a[m]);this.onChange()}deleteSpan(a){const f=a.span,m=a.time,g=m+f-1,y=this.findById(a);if(!y)return;let O=y,x=O;for(;O;){x=O;const C=O.id,S=O.span,E=C.time,I=E+S-1;if(O.del){if(I>=g)break;O=O.s;continue}const j=m<=E,N=m<=I;if(j)if(g>=I){if(O.delete(),h(O,-O.span),g<=I)break}else{const A=g-E+1,D=this.split(O,A);O.delete(),e(D),h(O,-O.span);break}else if(N)if(g>=I){const A=m-E,D=this.split(O,A);if(D.delete(),D.len=D.r?D.r.len:0,h(O,-D.span),g<=I)break}else{const A=this.split(O,g-E+1),D=this.split(O,m-E);D.delete(),e(A),e(D),h(O,-D.span);break}O=O.s}x&&this.mergeTombstones2(y,x)}find(a){let f=this.root;for(;f;){const m=f.l,g=m?m.len:0;let y;if(a<g)f=m;else if(f.del)a-=g,f=f.r;else if(a<g+(y=f.span)){const O=a-g,x=f.id;return O?new i.Timestamp(x.sid,x.time+O):x}else a-=g+y,f=f.r}}findChunk(a){let f=this.root;for(;f;){const m=f.l,g=m?m.len:0;let y;if(a<g)f=m;else if(f.del)a-=g,f=f.r;else{if(a<g+(y=f.span))return[f,a-g];a-=g+y,f=f.r}}}findInterval(a,f){const m=[];if(!f)return m;let g=this.root,y=0;for(;g;){const C=g.l?g.l.len:0;if(a<C)g=g.l;else if(g.del)a-=C,g=g.r;else if(a<C+g.span){y=a-C;break}else a-=C+g.span,g=g.r}if(!g)return m;if(g.span>=f+y){const C=g.id;return m.push((0,i.tss)(C.sid,C.time+y,f)),m}const O=g.span-y,x=g.id;if(m.push((0,i.tss)(x.sid,x.time+y,O)),f-=O,g=d(g),!g)return m;do{if(g.del)continue;const C=g.id,S=g.span;if(f<=S)return m.push((0,i.tss)(C.sid,C.time,f)),m;m.push((0,i.tss)(C.sid,C.time,S)),f-=S}while((g=d(g))&&f>0);return m}findInterval2(a,f){const m=[];return this.range0(void 0,a,f,(g,y,O)=>{const x=g.id;m.push((0,i.tss)(x.sid,x.time+y,O))}),m}range0(a,f,m,g){let y=a||this.findById(f);if(a)for(;y&&!(0,i.containsId)(y.id,y.span,f);)y=d(y);if(y){if(y.del){if((0,i.containsId)(y.id,y.span,m))return}else{const O=f.time-y.id.time;if((0,i.containsId)(y.id,y.span,m)){const S=m.time-f.time+1;return g(y,O,S),y}const C=y.span-O;if(g(y,O,C))return y}for(y=d(y);y;){if((0,i.containsId)(y.id,y.span,m))return!y.del&&g(y,0,m.time-y.id.time+1),y;if(!y.del&&g(y,0,y.span))return y;y=d(y)}return y}}first(){let a=this.root;for(;a;){const f=a.l;if(f)a=f;else return a}return a}last(){let a=this.root;for(;a;){const f=a.r;if(f)a=f;else return a}return a}lastId(){const a=this.last();if(!a)return;const f=a.id,m=a.span;return m===1?f:new i.Timestamp(f.sid,f.time+m-1)}next(a){return d(a)}prev(a){return w(a)}length(){const a=this.root;return a?a.len:0}size(){return this.count}pos(a){const f=a.p,m=a.l;if(!f)return m?m.len:0;const g=this.pos(f);if(f.r===a)return g+(f.del?0:f.span)+(m?m.len:0);const O=a.r;return g-(a.del?0:a.span)-(O?O.len:0)}setRoot(a){this.root=a,this.insertId(a),this.onChange()}insertBefore(a,f){const m=f.l;f.l=a,a.l=m,a.p=f;let g=0;m&&(m.p=a,g=m.len),a.len=a.span+g,h(f,a.span),this.insertId(a),this.onChange()}insertAfter(a,f){const m=f.r;f.r=a,a.r=m,a.p=f;let g=0;m&&(m.p=a,g=m.len),a.len=a.span+g,h(f,a.span),this.insertId(a),this.onChange()}insertAfterRef(a,f,m){const g=a.id,y=g.sid,O=g.time;let x=!1;for(;;){const C=m.id,S=C.time+m.span;m.s||(x=C.sid===y&&S===O&&S-1===f.time,x&&(m.s=a));const E=d(m);if(!E)break;const I=E.id,j=I.time,N=I.sid;if(j<O)break;if(j===O){if(N===y)return;if(N<y)break}m=E}x&&!m.del?(this.mergeContent(m,a.data),m.s=void 0):this.insertAfter(a,m)}mergeContent(a,f){const m=a.span;a.merge(f),h(a,a.span-m),this.onChange()}insertInside(a,f,m){const g=f.p,y=f.l,O=f.r,x=f.s,C=f.len,S=f.split(m);if(f.s=S,S.s=x,f.l=f.r=S.l=S.r=void 0,S.l=void 0,a.p=g,!y)a.l=f,f.p=a;else{a.l=y,y.p=a;const j=y.r;y.r=f,f.p=y,f.l=j,j&&(j.p=f)}if(!O)a.r=S,S.p=a;else{a.r=O,O.p=a;const j=O.l;O.l=S,S.p=O,S.r=j,j&&(j.p=S)}g?g.l===f?g.l=a:g.r=a:this.root=a,e(f),e(S),y&&(y.len=(y.l?y.l.len:0)+f.len+(y.del?0:y.span)),O&&(O.len=(O.r?O.r.len:0)+S.len+(O.del?0:O.span)),a.len=C+a.span;const E=a.span;let I=a.p;for(;I;)I.len+=E,I=I.p;this.insertId(S),this.insertIdFast(a),this.onChange()}split(a,f){const m=a.s,g=a.split(f),y=a.r;return a.s=g,g.r=y,g.s=m,a.r=g,g.p=a,this.insertId(g),y&&(y.p=g),g}mergeTombstones(a,f){if(!a.del||!f.del)return!1;const m=a.id,g=f.id;return m.sid!==g.sid||m.time+a.span!==g.time?!1:(a.s=f.s,a.span+=f.span,this.deleteChunk(f),!0)}mergeTombstones2(a,f){let m=a;for(;m;){const y=d(m);if(!y)break;if(!this.mergeTombstones(m,y)){if(y===f){if(y){const x=d(y);x&&this.mergeTombstones(y,x)}break}m=m.s}}const g=w(a);g&&this.mergeTombstones(g,a)}removeTombstones(){let a=this.first();const f=[];for(;a;)a.del&&f.push(a),a=d(a);for(let m=0;m<f.length;m++)this.deleteChunk(f[m])}deleteChunk(a){this.deleteId(a);const f=a.p,m=a.l,g=a.r;if(a.id=c.ORIGIN,!m&&!g)f?f.l===a?f.l=void 0:f.r=void 0:this.root=void 0;else if(m&&g){let y=m;for(;y.r;)y=y.r;y.r=g,g.p=y;const O=g.len;let x;for(x=y,f?(f.l===a?f.l=m:f.r=m,m.p=f):(this.root=m,m.p=void 0);x&&x!==f;)x.len+=O,x=x.p}else{const y=m||g;y.p=f,f?f.l===a?f.l=y:f.r=y:this.root=y}}insertId(a){this.ids=(0,o.insert2)(this.ids,a,t),this.count++,this.ids=(0,p.splay2)(this.ids,a)}insertIdFast(a){this.ids=(0,o.insert2)(this.ids,a,t),this.count++}deleteId(a){this.ids=(0,o.remove2)(this.ids,a),this.count--}findById(a){const f=a.sid,m=a.time;let g=this.ids,y=g;for(;g;){const I=g.id,j=I.sid;if(j>f)g=g.l2;else if(j<f)y=g,g=g.r2;else{const N=I.time;if(N>m)g=g.l2;else if(N<m)y=g,g=g.r2;else{y=g;break}}}if(!y)return;const O=y.id,x=O.time,C=O.sid,S=y.span;if(!(C!==f||m<x||m-x>=S))return y}prevId(a){let f=this.findById(a);if(!f)return;const m=a.time;if(f.id.time<m)return new i.Timestamp(a.sid,m-1);if(f=w(f),!f)return;const g=f.id;return f.span>1?new i.Timestamp(g.sid,g.time+f.span-1):g}spanView(a){const f=[];let m=a.span;const g=a.time;let y=this.findById(a);if(!y)return f;if(!y.del)if(y.span>=m+g-y.id.time){const O=g-y.id.time,x=O+m,C=y.view().slice(O,x);return f.push(C),f}else{const O=g-y.id.time,x=y.view().slice(O,a.span);m-=y.span-O,f.push(x)}for(;y=y.s;){const O=y.span;if(!y.del){if(O>m){const x=y.view().slice(0,m);f.push(x);break}f.push(y.data)}if(m-=O,m<=0)break}return f}splay(a){const f=a.p;if(!f)return;const m=f.p,g=f.l===a;if(!m){g?(0,_.rSplay)(a,f):(0,_.lSplay)(a,f),this.root=a,e(f),l(a);return}m.l===f?g?this.root=(0,_.llSplay)(this.root,a,f,m):this.root=(0,_.lrSplay)(this.root,a,f,m):g?this.root=(0,_.rlSplay)(this.root,a,f,m):this.root=(0,_.rrSplay)(this.root,a,f,m),e(m),e(f),l(a),this.splay(a)}iterator(){let a=this.first();return()=>{const f=a;return a&&(a=d(a)),f}}ingest(a,f){if(a<1)return;const m=new Map;this.root=this._ingest(a,()=>{const g=f(),y=g.id,O=y.sid+"."+y.time,x=m.get(O);x&&(x.s=g,m.delete(O));const C=(0,i.tick)(y,g.span);return m.set(C.sid+"."+C.time,g),g})}_ingest(a,f){const m=a>>1,g=a-m-1,y=m>0?this._ingest(m,f):void 0,O=f();y&&(O.l=y,y.p=O);const x=g>0?this._ingest(g,f):void 0;return x&&(O.r=x,x.p=O),e(O),this.insertId(O),O}toStringName(){return"AbstractRga"}toString(a=""){const f=this.view();let m="";return(0,u.isUint8Array)(f)?m+=` { ${(0,n.printOctets)(f)||"∅"} }`:typeof f=="string"&&(m+=`{ ${f.length>32?JSON.stringify(f.substring(0,32))+" …":JSON.stringify(f)} }`),`${this.toStringName()} ${(0,i.printTs)(this.id)} ${m}`+(0,r.printTree)(a,[y=>this.root?this.printChunk(y,this.root):"∅"])}printChunk(a,f){return this.formatChunk(f)+(0,s.printBinary)(a,[f.l?m=>this.printChunk(m,f.l):null,f.r?m=>this.printChunk(m,f.r):null])}formatChunk(a){let m=`chunk ${(0,i.printTs)(a.id)}:${a.span} .${a.len}.`;if(a.del)m+=` [${a.span}]`;else if((0,u.isUint8Array)(a.data))m+=` { ${(0,n.printOctets)(a.data)||"∅"} }`;else if(typeof a.data=="string"){const g=a.data.length>32?JSON.stringify(a.data.substring(0,32))+" …":JSON.stringify(a.data);m+=` { ${g} }`}return m}};return Xn.AbstractRga=b,Xn}var Ga;function Qf(){if(Ga)return wt;Ga=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.ArrNode=wt.ArrChunk=void 0;const i=ts(),u=he(),_=Zi(),p=Ye();class o{constructor(s,n,t){this.id=s,this.span=n,this.len=t?n:0,this.del=!t,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=t}merge(s){this.data.push(...s),this.span=this.data.length}split(s){const n=this.span;if(this.span=s,!this.del){const e=this.data.splice(s);return new o((0,u.tick)(this.id,s),n-s,e)}return new o((0,u.tick)(this.id,s),n-s,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new o(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}wt.ArrChunk=o;let c=class extends i.AbstractRga{constructor(s,n){super(n),this.doc=s,this._tick=0,this._view=[],this.api=void 0}get(s){const n=this.findChunk(s);if(n)return n[0].data[n[1]]}getNode(s){const n=this.get(s);if(n)return this.doc.index.get(n)}getId(s){const n=this.findChunk(s);if(!n)return;const[t,e]=n,l=t.id;return e?(0,u.tick)(l,e):l}getById(s){const n=this.findById(s);if(!n||n.del)return;const t=s.time-n.id.time;return n.data[t]}upd(s,n){const t=this.findById(s);if(!t)return;const e=t.data;if(!e)return;const l=s.time-t.id.time,h=e[l];if(!(h&&(0,u.compare)(h,n)>=0))return e[l]=n,this.onChange(),h}createChunk(s,n){return new o(s,n?n.length:0,n)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const s=this.doc,n=s.clock.time+s.tick,t=this._view;if(this._tick===n)return t;const e=[],l=s.index;let h=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const b of w.data){const v=l.get(b);if(!v){h=!1;continue}const a=v.view();t[e.length]!==a&&(h=!1),e.push(a)}return t.length!==e.length&&(h=!1),h?t:(this._tick=n,this._view=e)}children(s){const n=this.doc.index;for(let t=this.first();t;t=this.next(t)){const e=t.data;if(!e)continue;const l=e.length;for(let h=0;h<l;h++)s(n.get(e[h]))}}name(){return"arr"}printChunk(s,n){const t=this.pos(n);let e="";if(!n.del){const l=this.doc.index;e=(0,p.printTree)(s,n.data.map(h=>l.get(h)).filter(h=>!!h).map((h,d)=>w=>`[${t+d}]: ${h.toString(w+"    "+" ".repeat(String(d).length))}`))}return this.formatChunk(n)+e+(0,_.printBinary)(s,[n.l?l=>this.printChunk(l,n.l):null,n.r?l=>this.printChunk(l,n.r):null])}};return wt.ArrNode=c,wt}var yt={},Ja;function Zf(){if(Ja)return yt;Ja=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.BinNode=yt.BinChunk=void 0;const i=he(),u=ts();class _{constructor(c,r,s){this.id=c,this.span=r,this.len=s?r:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=s}merge(c){const r=this.data.length,s=new Uint8Array(r+c.length);s.set(this.data),s.set(c,r),this.data=s,this.span=s.length}split(c){if(!this.del){const s=this.data,n=s.subarray(c),t=new _((0,i.tick)(this.id,c),this.span-c,n);return this.data=s.subarray(0,c),this.span=c,t}const r=new _((0,i.tick)(this.id,c),this.span-c,void 0);return this.span=c,r}delete(){this.del=!0,this.data=void 0}clone(){return new _(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}yt.BinChunk=_;let p=class extends u.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const c=new Uint8Array(this.length());let r=0,s=this.first();for(;s;){if(!s.del){const n=s.data;c.set(n,r),r+=n.length}s=this.next(s)}return this._view=c}children(){}child(){}container(){}name(){return"bin"}createChunk(c,r){return new _(c,r?r.length:0,r)}onChange(){this._view=null}toStringName(){return this.name()}};return yt.BinNode=p,yt}var _t={},Ha;function eh(){if(Ha)return _t;Ha=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.StrNode=_t.StrChunk=void 0;const i=he(),u=ts(),_=ic();class p{constructor(r,s,n){this.id=r,this.span=s,this.len=n?s:0,this.del=!n,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=n}merge(r){this.data+=r,this.span=this.data.length}split(r){if(!this.del){const n=new p((0,i.tick)(this.id,r),this.span-r,this.data.slice(r));return this.data=this.data.slice(0,r),this.span=r,n}const s=new p((0,i.tick)(this.id,r),this.span-r,"");return this.span=r,s}delete(){this.del=!0,this.data=""}clone(){return new p(this.id,this.span,this.data)}view(){return this.data}}_t.StrChunk=p;let o=class extends u.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let r="";for(let s=this.first();s;s=(0,_.next)(s))r+=s.data;return this._view=r}name(){return"str"}createChunk(r,s){return new p(r,s?s.length:0,s||"")}onChange(){this._view=""}toStringName(){return this.name()}};return _t.StrNode=o,_t}var Ka;function th(){return Ka||(Ka=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.StrChunk=i.StrNode=i.BinChunk=i.BinNode=i.ArrChunk=i.ArrNode=i.ObjNode=i.VecNode=i.RootNode=i.ValNode=i.ConNode=void 0;var u=Er();Object.defineProperty(i,"ConNode",{enumerable:!0,get:function(){return u.ConNode}});var _=sc();Object.defineProperty(i,"ValNode",{enumerable:!0,get:function(){return _.ValNode}});var p=zf();Object.defineProperty(i,"RootNode",{enumerable:!0,get:function(){return p.RootNode}});var o=Gf();Object.defineProperty(i,"VecNode",{enumerable:!0,get:function(){return o.VecNode}});var c=Jf();Object.defineProperty(i,"ObjNode",{enumerable:!0,get:function(){return c.ObjNode}});var r=Qf();Object.defineProperty(i,"ArrNode",{enumerable:!0,get:function(){return r.ArrNode}}),Object.defineProperty(i,"ArrChunk",{enumerable:!0,get:function(){return r.ArrChunk}});var s=Zf();Object.defineProperty(i,"BinNode",{enumerable:!0,get:function(){return s.BinNode}}),Object.defineProperty(i,"BinChunk",{enumerable:!0,get:function(){return s.BinChunk}});var n=eh();Object.defineProperty(i,"StrNode",{enumerable:!0,get:function(){return n.StrNode}}),Object.defineProperty(i,"StrChunk",{enumerable:!0,get:function(){return n.StrChunk}})}(li)),li}var Xa;function lt(){return Xa||(Xa=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(cf(),i),u.__exportStar(th(),i)}(oi)),oi}var Ti={},Ya;function nh(){return Ya||(Ya=1,Object.defineProperty(Ti,"__esModule",{value:!0})),Ti}var Ai={},Qa;function rh(){return Qa||(Qa=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Model=void 0;const u=ie;var _=es();Object.defineProperty(i,"Model",{enumerable:!0,get:function(){return _.Model}}),u.__exportStar(tc(),i)}(Ai)),Ai}var Za;function oc(){return Za||(Za=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(lt(),i),u.__exportStar(nh(),i),u.__exportStar(rh(),i),u.__exportStar(xr(),i)}(si)),si}var ih=oc(),Mi={},Pi={},el;function sh(){return el||(el=1,Object.defineProperty(Pi,"__esModule",{value:!0})),Pi}var Qn={},Zn={},Ot={},tl;function Nr(){return tl||(tl=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.hasBuffer=Ot.alphabet=void 0,Ot.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ot.hasBuffer=typeof Re.Buffer=="function"&&typeof Re.Buffer.from=="function"),Ot}var er={},tr={},nl;function oh(){if(nl)return tr;nl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.flatstr=void 0;const i=u=>u;return tr.flatstr=i,tr}var rl;function ah(){if(rl)return er;rl=1,Object.defineProperty(er,"__esModule",{value:!0}),er.createToBase64=void 0;const i=oh(),u=Nr(),_=(p=u.alphabet,o="=")=>{if(p.length!==64)throw new Error("chars must be 64 characters long");const c=p.split(""),r=[];for(const t of c)for(const e of c){const l=(0,i.flatstr)(t+e);r.push(l)}const s=o,n=(0,i.flatstr)(o+o);return(t,e)=>{let l="";const h=e%3,d=e-h;for(let w=0;w<d;w+=3){const b=t[w],v=t[w+1],a=t[w+2],f=b<<4|v>>4,m=(v&15)<<8|a;l+=r[f]+r[m]}if(!h)return l;if(h===1){const w=t[d];l+=r[w<<4]+n}else{const w=t[d],b=t[d+1],v=w<<4|b>>4,a=(b&15)<<2;l+=r[v]+c[a]+s}return l}};return er.createToBase64=_,er}var il;function ac(){if(il)return Zn;il=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.toBase64=void 0;const i=Nr(),_=(0,ah().createToBase64)();return Zn.toBase64=i.hasBuffer?p=>{const o=p.length;return o<=48?_(p,o):Re.Buffer.from(p).toString("base64")}:p=>_(p,p.length),Zn}var sl;function lh(){if(sl)return Qn;sl=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.encode=void 0;const u=ie.__importStar(Vt()),_=he(),p=ac(),o=(s,n)=>{const t=n.sid;return t===s?n.time:[t,n.time]},c=(s,n)=>{const t=o(s,n);return Array.isArray(t)?(t.push(n.span),t):[t,n.span]},r=s=>{const n=s.getId();if(!n)throw new Error("PATCH_EMPTY");const t=n.sid,e=n.time,l=t===1?[e]:[[t,e]],h=s.meta;h!==void 0&&l.push(h);const d=[l];for(const w of s.ops)if(w instanceof u.NewConOp){const b=w.val;b instanceof _.Timestamp?d.push([0,o(t,b),!0]):b===void 0?d.push([0]):d.push([0,b])}else if(w instanceof u.NewValOp)d.push([1]);else if(w instanceof u.NewObjOp)d.push([2]);else if(w instanceof u.NewVecOp)d.push([3]);else if(w instanceof u.NewStrOp)d.push([4]);else if(w instanceof u.NewBinOp)d.push([5]);else if(w instanceof u.NewArrOp)d.push([6]);else if(w instanceof u.InsValOp)d.push([9,o(t,w.obj),o(t,w.val)]);else if(w instanceof u.InsObjOp){const b=[];for(const[a,f]of w.data)b.push([a,o(t,f)]);const v=[10,o(t,w.obj),b];d.push(v)}else if(w instanceof u.InsVecOp){const b=[];for(const[a,f]of w.data)b.push([a,o(t,f)]);const v=[11,o(t,w.obj),b];d.push(v)}else if(w instanceof u.InsStrOp){const b=[12,o(t,w.obj),o(t,w.ref),w.data];d.push(b)}else if(w instanceof u.InsBinOp){const b=[13,o(t,w.obj),o(t,w.ref),(0,p.toBase64)(w.data)];d.push(b)}else if(w instanceof u.InsArrOp){const b=[];for(const a of w.data)b.push(o(t,a));const v=[14,o(t,w.obj),o(t,w.ref),b];d.push(v)}else if(w instanceof u.UpdArrOp){const b=[15,o(t,w.obj),o(t,w.ref),o(t,w.val)];d.push(b)}else if(w instanceof u.DelOp){const b=[16,o(t,w.obj),w.what.map(v=>c(t,v))];d.push(b)}else if(w instanceof u.NopOp){const b=[17],v=w.len;v>1&&b.push(v),d.push(b)}return d};return Qn.encode=r,Qn}var nr={},rr={},ir={},ol;function ch(){if(ol)return ir;ol=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.bufferToUint8Array=void 0;const i=u=>new Uint8Array(u.buffer,u.byteOffset,u.length);return ir.bufferToUint8Array=i,ir}var sr={},al;function uh(){if(al)return sr;al=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.createFromBase64=void 0;const i=Nr(),u="=",_=(p=i.alphabet,o=!1)=>{if(p.length!==64)throw new Error("chars must be 64 characters long");let c=0;for(let s=0;s<p.length;s++)c=Math.max(c,p.charCodeAt(s));const r=[];for(let s=0;s<=c;s+=1)r[s]=-1;for(let s=0;s<p.length;s++)r[p.charCodeAt(s)]=s;return s=>{if(!s)return new Uint8Array(0);let n=s.length;if(o){const b=n%4;b===2?(s+="==",n+=2):b===3&&(s+="=",n+=1)}if(n%4!==0)throw new Error("Base64 string length must be a multiple of 4");const t=s[n-1]!==u?n:n-4;let e=(n>>2)*3,l=0;s[n-2]===u?(l=2,e-=2):s[n-1]===u&&(l=1,e-=1);const h=new Uint8Array(e);let d=0,w=0;for(;w<t;w+=4){const b=r[s.charCodeAt(w)],v=r[s.charCodeAt(w+1)],a=r[s.charCodeAt(w+2)],f=r[s.charCodeAt(w+3)];if(b<0||v<0||a<0||f<0)throw new Error("INVALID_BASE64_STRING");h[d]=b<<2|v>>4,h[d+1]=v<<4|a>>2,h[d+2]=a<<6|f,d+=3}if(l===2){const b=r[s.charCodeAt(t)],v=r[s.charCodeAt(t+1)];if(b<0||v<0)throw new Error("INVALID_BASE64_STRING");h[d]=b<<2|v>>4}else if(l===1){const b=r[s.charCodeAt(t)],v=r[s.charCodeAt(t+1)],a=r[s.charCodeAt(t+2)];if(b<0||v<0||a<0)throw new Error("INVALID_BASE64_STRING");h[d]=b<<2|v>>4,h[d+1]=v<<4|a>>2}return h}};return sr.createFromBase64=_,sr}var ll;function dh(){if(ll)return rr;ll=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.fromBase64=void 0;const i=ch(),u=Nr(),_=uh(),p=u.hasBuffer?c=>(0,i.bufferToUint8Array)(Re.Buffer.from(c,"base64")):null,o=(0,_.createFromBase64)();return rr.fromBase64=p?c=>c.length>48?p(c):o(c):o,rr}var cl;function fh(){if(cl)return nr;cl=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.decode=void 0;const i=dh(),u=he(),_=Sr(),p=(r,s)=>Array.isArray(s)?new u.Timestamp(s[0],s[1]):new u.Timestamp(r,s),o=(r,s)=>s.length===3?new u.Timespan(s[0],s[1],s[2]):new u.Timespan(r,s[0],s[1]),c=r=>{const s=r[0],n=s[0],t=Array.isArray(n)?new u.ClockVector(n[0],n[1]):new u.ServerClockVector(1,n),e=t.sid;t.time;const l=new _.PatchBuilder(t),h=r.length;for(let w=1;w<h;w++){const b=r[w];switch(b[0]){case 0:{const[,v,a]=b;l.con(a?p(e,v):v);break}case 1:{l.val();break}case 2:{l.obj();break}case 3:{l.vec();break}case 4:{l.str();break}case 5:{l.bin();break}case 6:{l.arr();break}case 9:{l.setVal(p(e,b[1]),p(e,b[2]));break}case 10:{const v=p(e,b[1]),a=[],f=b[2],m=f.length;for(let g=0;g<m;g++){const[y,O]=f[g];a.push([y,p(e,O)])}l.insObj(v,a);break}case 11:{const v=p(e,b[1]),a=[],f=b[2],m=f.length;for(let g=0;g<m;g++){const[y,O]=f[g];a.push([y,p(e,O)])}l.insVec(v,a);break}case 12:{l.insStr(p(e,b[1]),p(e,b[2]),b[3]);break}case 13:{l.insBin(p(e,b[1]),p(e,b[2]),(0,i.fromBase64)(b[3]));break}case 14:{const v=p(e,b[1]),a=p(e,b[2]),f=b[3],m=[],g=f.length;for(let y=0;y<g;y++)m.push(p(e,f[y]));l.insArr(v,a,m);break}case 15:{const v=p(e,b[1]),a=p(e,b[2]),f=p(e,b[3]);l.updArr(v,a,f);break}case 16:{const v=p(e,b[1]),a=b[2],f=[],m=a.length;for(let g=0;g<m;g++)f.push(o(e,a[g]));l.del(v,f);break}case 17:{l.nop(b[1]||1);break}}}const d=l.patch;return d.meta=s[1],d};return nr.decode=c,nr}var ul;function hh(){return ul||(ul=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const u=ie;u.__exportStar(sh(),i),u.__exportStar(lh(),i),u.__exportStar(fh(),i)}(Mi)),Mi}var Di=hh(),or={},dl;function ph(){if(dl)return or;dl=1,Object.defineProperty(or,"__esModule",{value:!0}),or.Encoder=void 0;const u=ie.__importStar(lt()),_=ac(),p=he();let o=class{encode(r){this.model=r;const s=r.clock;return{time:s.sid===1?s.time:this.cClock(r.clock),root:this.cVal(r.root)}}cClock(r){const s=[],n=r.sid;r.peers.get(n)||s.push([n,r.time]);for(const e of r.peers.values())s.push([e.sid,e.time]);return s}cTs(r){return r.sid===1?r.time:[r.sid,r.time]}cNode(r){if(r instanceof u.ObjNode)return this.cObj(r);if(r instanceof u.ArrNode)return this.cArr(r);if(r instanceof u.StrNode)return this.cStr(r);if(r instanceof u.ValNode)return this.cVal(r);if(r instanceof u.ConNode)return this.cCon(r);if(r instanceof u.BinNode)return this.cBin(r);if(r instanceof u.VecNode)return this.cVec(r);throw new Error("UNKNOWN_NODE")}cObj(r){const s={};return r.nodes((n,t)=>{s[t]=this.cNode(n)}),{type:"obj",id:this.cTs(r.id),map:s}}cVec(r){const s=[],n=r.elements,t=n.length,e=this.model.index;for(let l=0;l<t;l++){const h=n[l];h===void 0?s.push(null):s.push(this.cNode(e.get(h)))}return{type:"vec",id:this.cTs(r.id),map:s}}cArr(r){const s=[],n=r.iterator();let t;for(;t=n();)s.push(this.cArrChunk(t));return{type:"arr",id:this.cTs(r.id),chunks:s}}cArrChunk(r){if(r.del)return{id:this.cTs(r.id),span:r.span};const s=this.model.index;return{id:this.cTs(r.id),value:r.data.map(t=>this.cNode(s.get(t)))}}cStr(r){const s=[],n=r.iterator();let t;for(;t=n();)s.push(this.cStrChunk(t));return{type:"str",id:this.cTs(r.id),chunks:s}}cStrChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:r.data}}cBin(r){const s=[],n=r.iterator();let t;for(;t=n();)s.push(this.cBinChunk(t));return{type:"bin",id:this.cTs(r.id),chunks:s}}cBinChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:(0,_.toBase64)(r.data)}}cVal(r){return{type:"val",id:this.cTs(r.id),value:this.cNode(r.node())}}cCon(r){const s={type:"con",id:this.cTs(r.id)},n=r.val;return n instanceof p.Timestamp?(s.timestamp=!0,s.value=this.cTs(n)):n!==void 0&&(s.value=n),s}};return or.Encoder=o,or}var mh=ph();class bh{constructor(u){Qe(this,"socket");Qe(this,"model",null);Qe(this,"sequenceNumber",0);Qe(this,"replicaId");Qe(this,"verboseEncoder",new mh.Encoder);Qe(this,"onModelChange",Pt);Qe(this,"onGridReady",Pt);Qe(this,"onStatusChange",Pt);Qe(this,"messageHandler",u=>{var _,p;if(u=JSON.parse(u),Array.isArray(u)&&u.length===3&&u[0]===4){const[,,o]=u;try{const c=Di.decode(o);this.model?(console.log("Applying patch from server:",c),(_=this.model)==null||_.applyPatch(c),this.onModelChange(this.model)):(console.log("Initializing new model from patch:"),console.log(c.toString()),this.model=ih.Model.fromPatches([c]).fork(this.replicaId),this.onModelChange(this.model));const r=(p=this.model)==null?void 0:p.api.flush();let s;if((r==null?void 0:r.ops.length)!==0&&(s=Di.encode(r)),s){const n=[1,this.sequenceNumber,"patch",s];console.log("Responding with patch:",n),this.sendMessage(n)}else{const n=this.verboseEncoder.encode(this.model);this.sendSyncMessage(n.time)}}catch(c){console.error("Failed to apply patch or send clock:",c)}}else if(Array.isArray(u)&&u.length===2&&u[0]===5)this.sequenceNumber+=1,this.onGridReady(),console.log("Clocks synchronized with server. Incrementing sequence number.");else if(Array.isArray(u)&&u[0]===8){if(console.log("Message received from server:",u[1]),u[1]==="ping"&&console.log("Received ping response from server"),u[1]==="connected"&&(console.log("Server ready to receive patches"),this.sendSyncMessage()),u[1]==="error"){console.warn("Error from server:",u[2]);return}if(u[1]==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const o=this.verboseEncoder.encode(this.model);console.log("New patch received, syncing data:",o.time);const c=[1,this.sequenceNumber,"synchronize-clock",o.time];this.sendMessage(c)}}else console.warn("Unexpected WebSocket message format:",u)});const{replicaId:_,url:p,onGridReady:o,onStatusChange:c,onModelChange:r}=u;this.replicaId=_,this.socket=new WebSocket(p),this.socket.onopen=()=>{console.log("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=s=>{this.handleMessage(s.data)},this.socket.onclose=()=>{console.log("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=s=>{console.error("WebSocket error:",s)},r&&(this.onModelChange=r),o&&(this.onGridReady=o),c&&(this.onStatusChange=c)}disconnect(){this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.log("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(u){this.messageHandler(u)}sendMessage(u){this.socket.readyState===WebSocket.OPEN?(console.log("Sending message:",u),this.socket.send(JSON.stringify(u))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}this.onModelChange(this.model);const u=this.model.api.flush();if(u){console.log("Sending patch to server:",u);const _=Di.encode(u),p=[1,this.sequenceNumber,"patch",_];this.sendMessage(p)}}sendSyncMessage(u=[]){const _=[1,this.sequenceNumber,"synchronize-clock",u];this.sendMessage(_)}}function vh(){const i=K.useRef(null),[u,_]=K.useState(null);return{modelRef:i,modelSnapshot:u,getModel:()=>i.current,setModel:c=>{i.current=c,_(i.current.api.getSnapshot())}}}function gh(){const[i,u]=K.useState(null),[_,p]=K.useState(!1),[o,c]=K.useState(!1),{modelRef:r,modelSnapshot:s,getModel:n,setModel:t}=vh(),e=K.useCallback((l,h)=>{if(h&&!i){const d=new bh({replicaId:l,url:h,onGridReady:()=>{c(!0)},onStatusChange:(w,b)=>{p(w)},onModelChange:w=>{t(w)}});u(d)}},[]);return{isConnected:_,createWebsocket:e,websocketInstance:i,isGridReady:o,modelRef:r,modelSnapshot:s,getModel:n,setModel:t}}const _r=K.forwardRef(({query:i,showDebugInfo:u=!1},_)=>{var Z,se;const[p,o]=K.useState(null),[c,r]=K.useState(null),[s,n]=K.useState(""),t=K.useRef(null);K.useImperativeHandle(_,()=>({initializeGrid:()=>{t.current&&t.current.handleStartSession(i)}}),[i]);const{isConnected:e,websocketInstance:l,createWebsocket:h,isGridReady:d,modelRef:w,modelSnapshot:b,getModel:v}=gh();K.useEffect(()=>{c&&s&&h(c,s)},[c,s,h]);const{data:a}=Ic((p==null?void 0:p.gridJsonSchema$Id)??"",{enabled:!!(p!=null&&p.gridJsonSchema$Id)}),f=e?"Connected":"Disconnected";K.useEffect(()=>{(p||c)&&(w.current=null,g([]),O([]))},[p,c,l]);const[m,g]=K.useState([]),[y,O]=K.useState([]);K.useEffect(()=>{b&&(g(x(b)),O(C(b)))},[b]);function x(L){if(!L)return[];const{columnNames:J,columnOrder:ce,rows:Y}=L;return Y.map(ee=>{var be;const le={};return ce.forEach(_e=>{const xe=J[_e];xe&&(le[xe]=ee.data[_e])}),le.__validationResults=(be=ee.metadata)==null?void 0:be.rowValidation,le})}function C(L){if(!L)return[];const{columnNames:J,columnOrder:ce}=L;return ce.map(ye=>{const ee=J[ye],le=a?Yc(Qc(a,ee)).map(be=>be.value):null;return le&&le.length>0?{...gr.keyColumn(ee,$i({choices:le})),title:ee}:{...gr.keyColumn(ee,gr.createTextColumn({continuousUpdates:!1})),title:ee}})}function S(L,J){if(!J)return J;const{columnNames:ce}=J.api.getSnapshot();for(let Y=0;Y<L.length;Y++){const ye=L[Y],ee=J.api.vec(["rows",String(Y),"data"]);Object.entries(ye).forEach(([le,be])=>{const _e=ce.indexOf(le);isNaN(_e)||ee==null||ee.set([[_e,Yr.s.con(be)]])})}return J}const E=K.useMemo(()=>new Set,[]),I=K.useMemo(()=>new Set,[]),j=K.useMemo(()=>new Set,[]),N=L=>(S(L,v()),l==null||l.sendPatch(),E.clear(),I.clear(),j.clear(),L);function M(){return Math.floor(Math.random()*1e6)}const A=K.useCallback(Jc(L=>{console.log("Auto-committing changes"),N(L)},500),[N]);function D(){return{_rowId:M()}}const V=(L,J)=>{if(!w.current){console.error("Model is not initialized");return}for(const Y of J){const ye=w.current,ee=ye.api.arr(["rows"]);if(Y.type==="CREATE"){for(let le=Y.fromRowIndex;le<Y.toRowIndex;le++)ye.api.arr(["rows"]).ins(le,[{data:Yr.s.vec(Yr.s.con(""))}]);L.slice(Y.fromRowIndex,Y.toRowIndex).forEach(({_rowId:le})=>E.add(le))}if(Y.type==="UPDATE"){const le=m.slice(Y.fromRowIndex,Y.toRowIndex),be=L.slice(Y.fromRowIndex,Y.toRowIndex),_e=le.map((xe,G)=>ef(xe,be[G]));if(_e.every(Boolean))return;be.filter((xe,G)=>!_e[G]).forEach(({_rowId:xe})=>{!E.has(xe)&&!I.has(xe)&&j.add(xe)})}if(Y.type==="DELETE"){let le=0;ee==null||ee.del(Y.fromRowIndex,Y.toRowIndex-Y.fromRowIndex),m.slice(Y.fromRowIndex,Y.toRowIndex).forEach(({_rowId:be},_e)=>{j.delete(be),E.has(be)?E.delete(be):(I.add(be),L.splice(Y.fromRowIndex+le++,0,m[Y.fromRowIndex+_e]))})}}const ce=L.filter(({_rowId:Y})=>!I.has(Y));g(ce),A(ce)},[z,U]=K.useState(null);return W.jsxs("div",{children:[W.jsxs(Fe,{container:!0,spacing:2,children:[W.jsx(Fe,{size:{xs:12,xl:8},children:W.jsx(Li,{ref:t,onSessionChange:o,onReplicaChange:r,onPresignedUrlChange:n,query:i})}),W.jsx(Fe,{size:{xs:12,xl:4},children:u&&W.jsxs("div",{children:[W.jsxs("p",{children:["Session ID: ",(p==null?void 0:p.sessionId)||"No session created"]}),W.jsxs("p",{children:["Replica ID: ",c||"No replica created"]}),W.jsxs("p",{children:["JSON Schema $id:"," ",(p==null?void 0:p.gridJsonSchema$Id)||"No schema attached to session"]}),W.jsxs("p",{children:["Presigned URL:"," ",s.substring(0,30)+(s.length>30?" ... "+s.substring(s.length-10,s.length):"")||"No URL generated"]}),W.jsxs("p",{children:["WebSocket Status:"," ",W.jsx("span",{style:{color:e?"green":"red"},children:f})]})]})})]}),p&&W.jsxs(W.Fragment,{children:[!d&&W.jsxs(W.Fragment,{children:[W.jsx("h3",{children:"Setting up grid..."}),W.jsxs("div",{style:{marginBottom:"10px"},children:[!p&&W.jsx("p",{children:"Creating grid session..."}),p&&!c&&W.jsx("p",{children:"Setting up real-time sync..."}),p&&c&&!s&&W.jsx("p",{children:"Establishing secure connection..."}),p&&c&&s&&!e&&W.jsx("p",{children:"Connecting to server..."}),e&&!d&&W.jsx("p",{children:"Loading table data..."}),W.jsx(Bc,{numRows:4,numCols:1})]})]}),d&&W.jsxs("div",{children:[W.jsx(gr.DataSheetGrid,{value:m,columns:y,rowKey:"_rowId",rowClassName:({rowData:L,rowIndex:J})=>{var ce,Y,ye;return Ac({"row-deleted":I.has(L._rowId),"row-created":E.has(L._rowId),"row-updated":j.has(L._rowId),"row-valid":((ce=L.__validationResults)==null?void 0:ce.isValid)===!0,"row-invalid":((Y=L.__validationResults)==null?void 0:Y.isValid)===!1,"row-unknown":((ye=L.__validationResults)==null?void 0:ye.isValid)==null,"row-selected":z===J})},createRow:D,duplicateRow:({rowData:L})=>({...L,_rowId:M()}),onChange:V,onActiveCellChange:({cell:L})=>{U(L?L.row:null)}}),z!==null&&m[z]&&Array.isArray((Z=m[z].__validationResults)==null?void 0:Z.allValidationMessages)&&((se=m[z].__validationResults)==null?void 0:se.allValidationMessages.length)>0&&W.jsx(qc,{variant:"warning",title:"Validation Messages:",isGlobal:!1,description:W.jsx("ul",{children:m[z].__validationResults.allValidationMessages.map(L=>W.jsx("li",{children:L},L))}),sx:{marginTop:"12px"}})]}),u&&W.jsxs("div",{style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[W.jsx("h3",{children:"Model snapshot"}),b?W.jsx(Nc,{value:b}):"No model available"]})]})]})});try{_r.displayName="SynapseGrid",_r.__docgenInfo={description:"",displayName:"SynapseGrid",props:{query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}const N1={title:"Components/SynapseGrid",component:_r,parameters:{stack:"staging"},argTypes:{showDebugInfo:{control:"boolean",description:"Show debug information including session details and model snapshot"}}},wh=i=>{const u=K.useRef(null);return W.jsxs("div",{children:[W.jsx(Sl,{variant:"outlined",onClick:()=>{var _;return(_=u.current)==null?void 0:_.initializeGrid()},sx:{color:"inherit",margin:"10px 0"},children:"Start Grid Session"}),W.jsx(_r,{ref:u,...i})]})},wr={render:wh,args:{query:"SELECT * FROM syn35295069"},parameters:{msw:{handlers:[]}}},yr={args:{query:"",showDebugInfo:!0},parameters:{msw:{handlers:[]}}};var fl,hl,pl;wr.parameters={...wr.parameters,docs:{...(fl=wr.parameters)==null?void 0:fl.docs,source:{originalSource:`{
  render: GridWithButton,
  args: {
    query: 'SELECT * FROM syn35295069'
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(pl=(hl=wr.parameters)==null?void 0:hl.docs)==null?void 0:pl.source}}};var ml,bl,vl;yr.parameters={...yr.parameters,docs:{...(ml=yr.parameters)==null?void 0:ml.docs,source:{originalSource:`{
  args: {
    query: '',
    showDebugInfo: true
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(vl=(bl=yr.parameters)==null?void 0:bl.docs)==null?void 0:vl.source}}};const I1=["GridWithQuery","GridWithUserInputAndDebugInfo"];export{wr as GridWithQuery,yr as GridWithUserInputAndDebugInfo,I1 as __namedExportsOrder,N1 as default};
