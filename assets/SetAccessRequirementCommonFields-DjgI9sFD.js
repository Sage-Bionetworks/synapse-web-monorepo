import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{R as l,d as P,M as D,b as L}from"./index-Bm-ar3Hy.js";import{p as $}from"./pluralize-CVwSCrA2.js";import{R as J,r as o}from"./index-Dl6G-zuu.js";import"./SynapseClient-DRbPdjiJ.js";import"./OrientationBanner-Dih8CVog.js";import"./getEndpoint-CjoHA800.js";import{b as Q,c as W,d as z}from"./useAccessRequirements-DwQZ2zeR.js";import{E as X}from"./EntitySubjectsSelector-Dg_t_cV0.js";import{T as K}from"./TeamSubjectsSelector-DLe2XBEr.js";import{R as Z}from"./RadioGroup-AMpK4AOs.js";import{S as d}from"./Skeleton-C2B0Utez.js";import{M as _}from"./TextField-BYBL0P0S.js";import{M as j}from"./Alert-HJYNNEvY.js";import{T as x}from"./Typography-B88_J_TK.js";import{S as ee}from"./Stack-CkbmjR2j.js";import{M as te}from"./Tooltip-CYVQ1vhC.js";import{H as re}from"./IconSvg-B_5LF0ig.js";const se="Please select at least one resource for this Access Requirement to be associated with.",y=a=>{const p=a===l.ENTITY?"Synapse":"Team",T=a[0].toUpperCase()+a.slice(1).toLowerCase();return`${p} IDs were specified but not added to the subjects list. Please either clear out the Add ${p} IDs textbox or click the Add ${$(T)} button.`},ne="Enter access requirement name. This will also be used when sending notifications for expiring or revoked approval. For example, 'The approval for the name access requirement was revoked...'",A={variant:"body1",fontWeight:700};function V(a){switch(a.type){case l.ENTITY:return L.DOWNLOAD;case l.TEAM:return L.PARTICIPATE;default:throw new Error(`RestrictableObjectType ${a.type} does not have an access type specified.`)}}const G=J.forwardRef(function(p,T){const{subject:i,accessRequirementId:b,onSave:Y,onError:f}=p,u=!i,[n,g]=o.useState(i?[i]:[]),[h,k]=o.useState(!1),[C,E]=o.useState(null),[S,I]=o.useState(""),[R,q]=o.useState((i==null?void 0:i.type)===l.TEAM?P:D),[M,N]=o.useState(null),v=t=>{N(null),Y(t.id.toString(),t.concreteType)},w=t=>{N(t.reason),f()},{mutate:U}=Q({onSuccess:t=>v(t),onError:t=>w(t)}),{mutate:O}=W({onSuccess:t=>v(t),onError:t=>w(t)}),{data:s,isLoading:B,error:F}=z(b,{enabled:!!b});o.useEffect(()=>{s&&(q(s.concreteType),I(s.name),g(s.subjectIds))},[s]);const c=o.useMemo(()=>{if(i)return i.type;if(s){const t=s.subjectIds;if(t.length>0)return t[0].type}return null},[i,s]),H=o.useMemo(()=>{if(!c)return e.jsx(e.Fragment,{});function t(r){E(null),g(r)}function m(r){E(null),k(r.trim()!=="")}switch(c){case l.TEAM:return e.jsx(K,{subjects:n,onUpdate:r=>t(r),onUpdateTeamIDsTextbox:r=>m(r)});case l.ENTITY:return e.jsx(X,{subjects:n,onUpdate:r=>t(r),onUpdateEntityIDsTextbox:r=>m(r)});default:return console.error(`RestrictableObjectType ${c} does not have a selector implemented.`),e.jsx(e.Fragment,{})}},[c,n]);return o.useImperativeHandle(T,()=>({save(){const t=u&&!s||!c,m=h||n.length===0;if(t||m){m&&!t&&(h?E(y(c)):n.length===0&&E(se)),f();return}if(!u){const r={concreteType:R,subjectIds:n,name:S,accessType:V(n[0])};U(r)}u&&s&&O({...s,subjectIds:n,name:S,accessType:V(n[0])})}}),[h,c,n,S,R,s,u,f,U,O]),B||!c?e.jsxs(e.Fragment,{children:[e.jsx(d,{width:100,height:30}),e.jsx(d,{width:125,height:30}),e.jsx(d,{width:"100%",children:e.jsx(_,{})}),e.jsx(d,{width:100,height:30}),e.jsx(d,{width:"100%",children:e.jsx(_,{})})]}):F?e.jsx(j,{severity:"error",children:F.reason}):e.jsxs(e.Fragment,{children:[e.jsx(x,{...A,children:"Resources"}),H,C&&e.jsx(j,{severity:"error",children:C}),e.jsxs(ee,{direction:"row",gap:1,alignItems:"center",mb:1,mt:2,children:[e.jsx(x,{component:"label",htmlFor:"arName",...A,children:"Name"}),e.jsx(te,{title:ne,placement:"right",children:e.jsx(re,{sx:{color:"grey.600"}})})]}),e.jsx(_,{id:"arName",name:"arName",value:S,placeholder:"Access requirement name",fullWidth:!0,onChange:t=>I(t.target.value)}),!u&&c!==l.TEAM&&e.jsxs(e.Fragment,{children:[e.jsx(x,{...A,mt:2,children:"Access requirement type"}),e.jsx(Z,{value:R,options:[{label:"Controlled - requests are in Synapse",value:D},{label:"Click wrap",value:P}],onChange:t=>q(t)})]}),M&&e.jsx(j,{severity:"error",sx:{marginTop:2},children:M})]})});try{y.displayName="UNSAVED_SUBJECTS_ERROR_MESSAGE",y.__docgenInfo={description:"",displayName:"UNSAVED_SUBJECTS_ERROR_MESSAGE",props:{}}}catch{}try{G.displayName="SetAccessRequirementCommonFields",G.__docgenInfo={description:"",displayName:"SetAccessRequirementCommonFields",props:{subject:{defaultValue:null,description:"",name:"subject",required:!1,type:{name:"RestrictableObjectDescriptor"}},accessRequirementId:{defaultValue:null,description:"",name:"accessRequirementId",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(accessRequirementId: string, accessRequirementConreteType: ACCESS_REQUIREMENT_CONCRETE_TYPE) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"() => void"}}}}}catch{}export{G as S};
