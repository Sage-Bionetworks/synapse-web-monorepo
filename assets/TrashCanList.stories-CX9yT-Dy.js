import{aI as I,ao as x,aJ as k,ab as C,r as c,j as t,hj as D,Y as f,d$ as L,c5 as P,W as N,B as p,dk as Q,dJ as q,dI as K}from"./iframe-BQ-FyWsS.js";import{u as z}from"./useInfiniteQuery-BmVO0mhr.js";import{g as V}from"./InfiniteQueryUtils-CKlRW-xB.js";import{u as O,S as Y,c as A,g as H}from"./StyledTanStackTable-eF1KeTqf.js";import{C as W,a as J}from"./EntityHeaderTableCellRenderers-CHea1IP-.js";import{E as _}from"./EntityLink-BFEWJ26e.js";import{W as G}from"./WarningDialog-BSzk5q3h.js";import"./index-Chi_LkuB.js";import"./StyledTableContainer-D1dOw2MN.js";import"./ExpandCollapseButton-HsVCPp7v.js";import"./index-BwICq_4V.js";import"./Checkbox-BSd_DIyD.js";import"./SwitchBase-B5Q_tRt4.js";import"./useEntity-Cy5Mg2dp.js";import"./pickBy-BvN_jGL3.js";import"./isString-CYdSqs19.js";import"./_baseIteratee-D1Tm5upA.js";import"./useQueries-CogN6Y-I.js";import"./useSuspenseQuery-DUVSvPvg.js";import"./useEntityBundle-CPRwldBA.js";import"./useGetEntityHeaders-BwRrh0VC.js";import"./EntityIcon-Dbz3i6K6.js";import"./ErrorChip-CnkGxJXt.js";import"./Chip-zSUCPrxT.js";import"./ConfirmationDialog-CdZxz-42.js";import"./DialogBase-Dt2niwwh.js";import"./Close-D_CGw3dB.js";import"./HelpPopover-B1pDuJfg.js";import"./MarkdownPopover-CUwT3SOT.js";import"./LightTooltip-DhzMlioI.js";import"./MarkdownSynapse-mIczoqmL.js";import"./SkeletonButton-BZyaXej1.js";import"./SkeletonInlineBlock-D_nLMWfH.js";import"./SkeletonTable-DUCbFLJl.js";import"./SkeletonParagraph-D-enYo3q.js";function $(r){const{accessToken:e,keyFactory:i}=x();return z({...r,queryKey:i.getTrashCanItemsQueryKey(),queryFn:l=>C.getItemsInTrashCan(e,l.pageParam),initialPageParam:void 0,getNextPageParam:V})}function U(r){const e=I(),{accessToken:i,keyFactory:l}=x();return k({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.restoreFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function X(r){const e=I(),{accessToken:i,keyFactory:l}=x();return k({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.purgeFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function Z(r){return r.filter(e=>e.status==="rejected").map(e=>e.reason)}const m=A();function ee(r){return[{id:"select",header:J,cell:W,maxSize:50},m.accessor("entityId",{header:"ID"}),m.accessor("entityName",{header:"Name"}),m.accessor("entityType",{header:"Entity Type",cell:e=>Q(e.getValue())}),m.accessor("originalParentId",{header:"Location",cell:e=>t.jsxs(t.Fragment,{children:[e.getValue()&&t.jsx(_,{entity:e.getValue()})," (",e.getValue(),")"]}),size:200}),m.accessor("deletedOn",{header:"Deleted On",cell:e=>q(K(e.getValue()))}),{id:"restoreButton",header:"",cell:({row:e})=>t.jsx(p,{size:"small",variant:"outlined",onClick:()=>{r(e.original.entityId),e.toggleSelected(!1)},children:"Restore"}),maxSize:100}]}function te(){const[r,e]=c.useState(!1),[i,l]=c.useState([]),[a,s]=c.useState({});function o(n,w){n?l(Z(n)):w&&l([w]),s({})}const{mutate:y,isPending:R}=U({onSettled:o}),{mutate:b,isPending:S}=X({onSettled:o}),v=R||S,{data:T,isLoading:g,hasNextPage:F,fetchNextPage:E,isFetchingNextPage:M}=$({throwOnError:!0}),h=c.useMemo(()=>T?.pages.flatMap(n=>n.results)??[],[T]),B=c.useMemo(()=>ee(n=>{y(n)}),[y]),j=O({data:h,columns:B,state:{rowSelection:a},getRowId:n=>n.entityId,enableRowSelection:!0,onRowSelectionChange:s,getCoreRowModel:H(),columnResizeMode:"onChange"}),u=j.getSelectedRowModel().rows.map(n=>n.original.entityId);return t.jsxs("div",{children:[t.jsx(D,{show:v,headlineText:S?"Deleting...":"Restoring..."}),t.jsx(f,{variant:"body1",children:'The trash can contains items that were recently deleted. You can recover deleted items in the trash can by clicking "Restore". Items will remain in the trash can for 30 days before being automatically purged.'}),t.jsx(G,{title:"Delete selected items from your Trash?",content:t.jsx(f,{variant:"body1",children:"You can't undo this action."}),confirmButtonText:"Delete",confirmButtonColor:"error",onConfirm:()=>{b(u),e(!1)},onCancel:()=>{e(!1)},open:r}),g&&t.jsx(L,{}),!g&&h.length===0&&t.jsx(P,{severity:"info",sx:{my:2},children:t.jsx(f,{variant:"body1",children:"Your trash can is currently empty."})}),!g&&h.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{table:j,styledTableContainerProps:{sx:{my:4}}}),i.length>0&&t.jsxs(P,{severity:"error",sx:{mb:1},children:["The following errors were encountered:",t.jsx("ul",{style:{marginBottom:0},children:i.map(n=>t.jsx("li",{children:n.message},n.message))})]}),t.jsxs(N,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[F&&t.jsx(p,{variant:"contained",disabled:M,onClick:()=>{E()},children:"Load More"}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(p,{variant:"contained",color:"error",disabled:u.length===0,onClick:()=>{e(!0)},children:"Delete Selected"}),t.jsx(p,{variant:"outlined",disabled:u.length===0,onClick:()=>{y(u)},children:"Restore Selected"})]})]})]})}const Qe={title:"Synapse/TrashCanList",component:te},d={};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:"{}",...d.parameters?.docs?.source}}};const qe=["TrashCan"];export{d as TrashCan,qe as __namedExportsOrder,Qe as default};
