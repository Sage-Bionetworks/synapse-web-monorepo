import{l as a,aY as r}from"./useFiles-Dj-FXM-L.js";import{d as y}from"./fetchWithExponentialTimeout-Cpvpsfq8.js";import{u as c}from"./useQuery-I3Pn_uCs.js";import{u as l}from"./utils-9_iaA6Vu.js";import{u as p}from"./useMutation-CeoIpbsA.js";const f={ENTITY:"ENTITY"};async function d(e,i){let t=125;const n=1e3;let o=await e();for(;"jobState"in o&&o.jobState==="PROCESSING";)await y(t),o=await e(),t=Math.min(t*2,n);return o}function O(e,i){const{synapseClient:t,keyFactory:n}=a();return c({...i,queryKey:n.getDOIAssociationQueryKey(e),queryFn:()=>r(()=>t.doiServicesClient.getRepoV1DoiAssociation(e))})}function b(e,i){const{synapseClient:t,keyFactory:n}=a();return c({...i,queryKey:n.getDOIQueryKey(e),queryFn:()=>r(()=>t.doiServicesClient.getRepoV1Doi(e))})}function F(e){const i=l(),{synapseClient:t,keyFactory:n}=a();return p({...e,mutationFn:async o=>{const s=await t.doiServicesClient.postRepoV1DoiAsyncStart({doiRequest:o});return d(()=>t.doiServicesClient.getRepoV1DoiAsyncGetAsyncToken({asyncToken:s.token}))},onSuccess(...o){e!=null&&e.onSuccess&&e.onSuccess(...o);const s=o[1].doi;if(s){const u={id:s.objectId,type:s.objectType,portalId:s.portalId,version:s.objectVersion};i.invalidateQueries({queryKey:n.getDOIQueryKey(u)})}}})}export{f as D,F as a,O as b,b as u};
