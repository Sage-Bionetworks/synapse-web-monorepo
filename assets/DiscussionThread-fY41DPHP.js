import{aK as Z,aJ as ee,r as n,gY as Te,aQ as te,j as t,aU as oe,aO as se,aV as z,aP as re,bm as we,aW as ae,aZ as M,a_ as Se,d2 as ne,bQ as le,dK as ie,dJ as de,V as O,am as v,J as A,Z as $e,hI as H,hJ as Me,X as W,c0 as q,B as J,d7 as ke}from"./iframe-CT7eET3u.js";import{u as ce,A as Ie}from"./useEntityBundle-DFrie1fk.js";import{u as Ne,a as Oe,F as P,b as De}from"./ForumThreadEditor-C5N0HMyb.js";import{u as Ee,a as _e,b as Ae}from"./useThread-CTFM4msf.js";import{u as Le}from"./useSubscription-CP3cuz0A.js";import{C as Ge}from"./ConfirmationDialog-DUrsRsl-.js";import{M as ue}from"./MarkdownSynapse-ChtEi03w.js";import{W as F}from"./WarningDialog-BOMrbTeB.js";import{U as pe}from"./UserBadge-CJ5OnICi.js";import{S as Pe}from"./SkeletonTable-C5avUwyT.js";import{S as ze}from"./SubscribersModal-Dh1TKQDL.js";import{u as We}from"./useForum-vuoXm7fL.js";import{g as Fe}from"./getValidReactChildren-K2HCKN8g.js";function Ye(e){return ee("MuiToggleButton",e)}const k=Z("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),fe=n.createContext({}),ge=n.createContext(void 0);function Ue(e,o){return o===void 0||e===void 0?!1:Array.isArray(o)?o.includes(e):e===o}const Ve=e=>{const{classes:o,fullWidth:l,selected:p,disabled:f,size:m,color:y}=e,u={root:["root",p&&"selected",f&&"disabled",l&&"fullWidth",`size${z(m)}`,y]};return re(u,Ye,o)},He=oe(we,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:l}=e;return[o.root,o[`size${z(l.size)}`]]}})(ae(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${k.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:M(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${k.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(Se()).map(([o])=>({props:{color:o},style:{[`&.${k.selected}`]:{color:(e.vars||e).palette[o].main,backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:M(e.palette[o].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:M(e.palette[o].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),X=n.forwardRef(function(o,l){const{value:p,...f}=n.useContext(fe),m=n.useContext(ge),y=Te({...f,selected:Ue(o.value,p)},o),u=te({props:y,name:"MuiToggleButton"}),{children:B,className:h,color:b="standard",disabled:c=!1,disableFocusRipple:j=!1,fullWidth:d=!1,onChange:R,onClick:x,selected:g,size:T="medium",value:w,...D}=u,s={...u,color:b,disabled:c,disableFocusRipple:j,fullWidth:d,size:T},$=Ve(s),E=i=>{x&&(x(i,w),i.defaultPrevented)||R&&R(i,w)},a=m||"";return t.jsx(He,{className:se(f.className,$.root,h,a),disabled:c,focusRipple:!j,ref:l,onClick:E,onChange:R,value:w,ownerState:s,"aria-pressed":g,...D,children:B})});function qe(e){return ee("MuiToggleButtonGroup",e)}const r=Z("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Je=e=>{const{classes:o,orientation:l,fullWidth:p,disabled:f}=e,m={root:["root",l,p&&"fullWidth"],grouped:["grouped",`grouped${z(l)}`,f&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return re(m,qe,o)},Xe=oe("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:l}=e;return[{[`& .${r.grouped}`]:o.grouped},{[`& .${r.grouped}`]:o[`grouped${z(l.orientation)}`]},{[`& .${r.firstButton}`]:o.firstButton},{[`& .${r.lastButton}`]:o.lastButton},{[`& .${r.middleButton}`]:o.middleButton},o.root,l.orientation==="vertical"&&o.vertical,l.fullWidth&&o.fullWidth]}})(ae(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${r.grouped}`]:{[`&.${r.selected} + .${r.grouped}.${r.selected}`]:{borderTop:0,marginTop:0}},[`& .${r.firstButton},& .${r.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${r.lastButton},& .${r.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${r.lastButton}.${k.disabled},& .${r.middleButton}.${k.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${r.grouped}`]:{[`&.${r.selected} + .${r.grouped}.${r.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${r.firstButton},& .${r.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${r.lastButton},& .${r.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${r.lastButton}.${k.disabled},& .${r.middleButton}.${k.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Ke=n.forwardRef(function(o,l){const p=te({props:o,name:"MuiToggleButtonGroup"}),{children:f,className:m,color:y="standard",disabled:u=!1,exclusive:B=!1,fullWidth:h=!1,onChange:b,orientation:c="horizontal",size:j="medium",value:d,...R}=p,x={...p,disabled:u,fullWidth:h,orientation:c,size:j},g=Je(x),T=n.useCallback((a,i)=>{if(!b)return;const S=d&&d.indexOf(i);let I;d&&S>=0?(I=d.slice(),I.splice(S,1)):I=d?d.concat(i):[i],b(a,I)},[b,d]),w=n.useCallback((a,i)=>{b&&b(a,d===i?null:i)},[b,d]),D=n.useMemo(()=>({className:g.grouped,onChange:B?w:T,value:d,size:j,fullWidth:h,color:y,disabled:u}),[g.grouped,B,w,T,d,j,h,y,u]),s=Fe(f),$=s.length,E=a=>{const i=a===0,S=a===$-1;return i&&S?"":i?g.firstButton:S?g.lastButton:g.middleButton};return t.jsx(Xe,{role:"group",className:se(g.root,m),ref:l,ownerState:x,...R,children:t.jsx(fe.Provider,{value:D,children:s.map((a,i)=>t.jsx(ge.Provider,{value:E(i),children:a},i))})})}),U="replyid",Qe=e=>{const l=`${`${window.location.origin}${window.location.pathname}`}?${U}=${e}`;$e(l).then(()=>A("Reply link copied to clipboard","info"))};function Y(e){const{reply:o,isReplyAuthorModerator:l=!1}=e,[p,f]=n.useState(!1),[m,y]=n.useState(!1),{data:u}=ne(),{data:B}=ce(o.projectId),{data:h,isLoading:b}=Ne(o),c=n.useRef(null),{mutate:j}=Oe({onSuccess:()=>{y(!1),A("A reply has been deleted.","info")}}),d=o.createdBy==(u==null?void 0:u.ownerId);return n.useEffect(()=>{const x=new URLSearchParams(window.location.search).get(U);let g;return x===o.id&&c.current&&(c.current.style.transition="background-color 1s ease",c.current.style.backgroundColor="#fbf4e0",c.current.style.borderColor="#f4dda3",g=setTimeout(()=>{c.current&&(c.current.style.backgroundColor="#f9f9f9",c.current.style.borderColor="#ccc")},2e3)),()=>{g&&clearTimeout(g)}},[o.id]),t.jsx("div",{className:"reply-container",id:`reply._${o.id}`,ref:c,role:"article",children:b?t.jsx(Pe,{numCols:1,numRows:4}):t.jsx(t.Fragment,{children:h&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx(pe,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:l}),t.jsxs("div",{className:"message-body",children:[t.jsx(ue,{markdown:h,objectType:le.REPLY}),t.jsxs("span",{children:["posted ",ie(de(o.createdOn),"M/D/YYYY"),o.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsxs(O,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[t.jsx("button",{onClick:()=>Qe(o.id),children:t.jsx(v,{icon:"link",label:"Copy link to this reply"})}),d&&t.jsx("button",{onClick:()=>f(!0),children:t.jsx(v,{icon:"edit",label:"Edit reply"})}),(B==null?void 0:B.permissions.canModerate)&&t.jsx("button",{onClick:()=>y(!0),children:t.jsx(v,{icon:"delete",label:"Delete reply"})})]})]})]}),t.jsx(P,{isReply:!0,initialText:h,onClose:()=>f(!1),id:o.id,isDialog:!0,openDialog:p}),t.jsx(F,{open:m,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{y(!1)},onConfirm:()=>j({forumId:o.forumId,threadId:o.threadId,replyId:o.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{Y.displayName="DiscussionReply",Y.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},isReplyAuthorModerator:{defaultValue:null,description:"",name:"isReplyAuthorModerator",required:!1,type:{name:"boolean"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"() => void"}}}}}catch{}const Ze="You are following this topic. Click to stop following.",et="You are not following this topic. Click to follow.",tt="You will need to sign in for access to that resource",K="Write a reply...";function Q(e){const{threadId:o,limit:l}=e,p="16px",[f,m]=n.useState(!0),[y,u]=n.useState(!1),[B,h]=n.useState(!1),[b,c]=n.useState(!1),[j,d]=n.useState(!1),[R,x]=n.useState(!1),[g,T]=n.useState(!1),[w,D]=n.useState(!1),{threadData:s,threadBody:$,togglePin:E}=Ee(o),{data:a}=ne(),{data:i}=ce((s==null?void 0:s.projectId)??"",void 0,Ie,{enabled:!!s}),{subscription:S,toggleSubscribed:I,isLoading:xe}=Le(o,H.THREAD),{mutate:me}=_e({onSuccess:()=>{d(!1),A("A thread has been deleted.","info")}}),{mutate:ye}=Ae({onSuccess:()=>{T(!1),A("A thread has been restored.","info")}}),he=(s==null?void 0:s.createdBy)==(a==null?void 0:a.ownerId);function be(){if((a==null?void 0:a.userName)=="anonymous")x(!0);else try{I()}catch(C){A(C.reason,"danger")}}const{data:L,hasNextPage:Ce,fetchNextPage:ve}=De(o,f,l),{data:N}=We((s==null?void 0:s.forumId)??"",{enabled:!!(s!=null&&s.forumId)}),Be=N==null?void 0:N.includes((s==null?void 0:s.createdBy)??""),[G,je]=Me(U),V=n.useMemo(()=>{const C=(L==null?void 0:L.pages.flatMap(_=>_.results))??[];return G?C.filter(_=>_.id===G):C},[L,G]),Re=()=>{je(null)};return t.jsxs("div",{className:"DiscussionThread",role:"article",children:[s&&$?t.jsxs(t.Fragment,{children:[t.jsxs(O,{sx:{mb:2,textAlign:"right"},children:[t.jsx(W,{component:"span",sx:{mr:1},children:"Sort:"}),t.jsxs(Ke,{color:"primary",exclusive:!0,value:f?"datePosted":"mostRecent",children:[t.jsx(X,{value:"datePosted",onClick:()=>m(!0),children:"Date Posted"}),t.jsx(X,{value:"mostRecent",onClick:()=>m(!1),children:"Most Recent"})]})]}),t.jsx(pe,{userId:s.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0,showModeratorBadge:Be}),t.jsxs(O,{sx:C=>({[C.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:p,marginTop:p,".SubscribersModal":{justifyContent:"flex-start",marginBottom:p}}}),children:[t.jsx(W,{sx:{marginTop:"4px"},variant:"headline2",children:s.title}),t.jsx(ze,{id:o,objectType:H.THREAD,showModal:w,handleModal:D})]}),t.jsx("div",{children:t.jsx(ue,{markdown:$,objectType:le.THREAD})}),t.jsxs("span",{children:["posted ",ie(de(s.createdOn),"M/D/YYYY"),s.isEdited?t.jsx("i",{children:" (Edited)"}):null]}),t.jsx(P,{isReply:!1,initialText:$,onClose:()=>u(!1),initialTitle:s==null?void 0:s.title,id:o,isDialog:!0,openDialog:y})]}):t.jsx(t.Fragment,{}),t.jsx(O,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:s!=null&&s.isDeleted?t.jsx("button",{onClick:()=>T(!0),children:t.jsx(v,{icon:"restore",label:"Restore deleted thread"})}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:t.jsx("button",{className:"follow-button","aria-label":S?"Unfollow thread":"Follow thread",disabled:xe,onClick:()=>be(),children:S?t.jsx(v,{icon:"visibility",label:Ze}):t.jsx(v,{icon:"visibilityOff",label:et})})}),he&&t.jsx("button",{onClick:()=>u(!0),children:t.jsx(v,{icon:"edit",label:"Edit thread"})}),i!=null&&i.permissions.canModerate?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>d(!0),children:t.jsx(v,{icon:"delete",label:"Delete thread"})}),t.jsx("button",{onClick:()=>E(),children:s!=null&&s.isPinned?t.jsx(v,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):t.jsx(v,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),t.jsx(O,{sx:{mt:2,mb:3},children:B?t.jsx(P,{id:o,isReply:!0,onClose:()=>h(!1),isDialog:!1}):t.jsx(q,{fullWidth:!0,placeholder:K,onClick:()=>{(a==null?void 0:a.userName)=="anonymous"?x(!0):h(!0)}})}),G&&t.jsxs(J,{variant:"outlined",onClick:Re,sx:{display:"flex",alignItems:"center",padding:"2px 8px",marginBottom:"12px",gap:"4px"},children:[t.jsx(v,{icon:"arrowBack",sx:{width:"16px"}}),t.jsx(W,{variant:"smallText2",children:"Show all replies"})]}),t.jsx("div",{children:V.map(C=>{const _=N==null?void 0:N.includes(C.createdBy);return t.jsx(Y,{reply:C,isReplyAuthorModerator:_},C.id)})}),V.length>0&&t.jsx(O,{sx:C=>({mt:2,mb:3,[C.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:b?t.jsx(P,{id:o,isReply:!0,onClose:()=>c(!1),isDialog:!1}):t.jsx(q,{fullWidth:!0,placeholder:K,onClick:()=>{(a==null?void 0:a.userName)=="anonymous"?x(!0):c(!0)}})}),Ce?t.jsx(J,{variant:"outlined",onClick:()=>{ve()},children:"Show more results"}):t.jsx(t.Fragment,{}),t.jsx(F,{open:j,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>d(!1),onConfirm:()=>s&&me(s),confirmButtonColor:"error",confirmButtonText:"Delete"}),t.jsx(F,{open:g,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>s&&ye(s),confirmButtonColor:"info",confirmButtonText:"Restore"}),t.jsx(Ge,{open:R,title:"Sign In Required",content:tt,onCancel:()=>x(!1),hasCancelButton:!1,onConfirm:()=>x(!1),confirmButtonProps:{children:"Sign In",className:ke}})]})}try{Q.displayName="DiscussionThread",Q.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{Q as D};
