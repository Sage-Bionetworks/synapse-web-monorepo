import{j}from"./jsx-runtime-D_zvdyIk.js";import{L as dt}from"./LargeButton-9F0IhJwb.js";import{l as pt,k as ht,S as yt}from"./useFiles-NAPEOWTe.js";import{p as gt}from"./SqlFunctions-B-lgMRiM.js";import"./StringUtils-Dsx1COFf.js";import{h as bt}from"./SynapseConstants-ZujiDdnj.js";import{r as N,R as d}from"./index-Ql9GupV3.js";import"./VerificationSubmission-NmfK1W18.js";import"./OrientationBanner-BFVnzJCT.js";import{g as St}from"./iframe-BbHdFlCZ.js";import{g as xt}from"./ColorGradient-Zy7TAKxK.js";import{l as $t}from"./LoadingScreen-ymbQ_R9Q.js";import{u as vt}from"./useTheme-CXo8RiLD.js";import{B as Ue}from"./Box-CA3S1lN6.js";import{u as wt}from"./index-CY6BERDw.js";const Et=(e,t)=>N.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:36,height:36,ref:t,...e},N.createElement("defs",null,N.createElement("pattern",{id:"diagonalLinePattern",patternUnits:"userSpaceOnUse",width:36,height:36},N.createElement("g",null,N.createElement("path",{d:"M54.24 85.7393L-17.76 13.7393",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 76.7393L-17.76 4.73926",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 67.7393L-17.76 -4.26074",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 58.7393L-17.76 -13.2607",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 49.7393L-17.76 -22.2607",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 40.7393L-17.76 -31.2607",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 31.7393L-17.76 -40.2607",stroke:"black",strokeWidth:1.125}),N.createElement("path",{d:"M54.24 22.7393L-17.76 -49.2607",stroke:"black",strokeWidth:1.125}))))),kt=N.forwardRef(Et);function Ct(e){return e instanceof Set?e.size:e.length}function ae(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),s=r.size,n={setA:s,setB:s,union:s,intersection:s};return o=>{if(o===e)return n;let a=0;o.forEach(i=>{(t&&r.has(t(i))||!t&&r.has(i))&&a++});const l=Ct(o);return{setA:s,setB:l,intersection:a,union:s+l-a}}}function At(e,t){const r=t?new Set((e instanceof Set?Array.from(e):e).map(t)):e instanceof Set?e:new Set(e),s=Array.isArray(e)?e:Array.from(e),n={setA:s,setB:s,union:s,intersection:s};return o=>{if(o===e)return n;const a=[],l=s.slice();return o.forEach(i=>{t&&r.has(t(i))||!t&&r.has(i)?a.push(i):l.push(i)}),{setA:s,setB:Array.isArray(o)?o:Array.from(o),intersection:a,union:l}}}function Nt(e,t){const r=e instanceof Set?Array.from(e):e,s=t?new Set(r.map(t)):e instanceof Set?e:new Set(e);return n=>{if(n===e)return r;const o=[];return n.forEach(a=>{(t&&s.has(t(a))||!t&&s.has(a))&&o.push(a)}),o}}function ne(e){return Array.isArray(e.elems)}function Xe(e){return typeof e.overlap=="function"}function Z(e){return e.set!=null}function Lt(e,t,r){if(Xe(e))return e.overlap;if(Z(e)&&e.set.overlap)return e.set.overlap;const s=ae(ne(e)?e.elems:e.set.elems,r);return n=>n.overlap&&ne(e)&&Array.isArray(e.elems)?n.overlap(e.elems):n.overlap&&Z(e)?n.overlap(e.set):s(n.elems)[t]}function Mt(e,t,r){if(Xe(e))return()=>null;{const s=Nt(ne(e)?e.elems:e.set.elems,r);return n=>s(n.elems)}}function ze(e){const t=e;return e!=null&&typeof t.cardinality=="number"&&typeof e.name=="string"&&Array.isArray(e.elems)}function $e(e){return ze(e)&&e.type==="set"}function Ot(e){const t=e;return ze(e)&&["composite","union","intersection","distinctIntersection"].includes(t.type)&&t.sets instanceof Set&&typeof t.degree=="number"}function ie(e){return $e(e)||Ot(e)}function H(e,t){return e.name.localeCompare(t.name)}function me(e,t){return t.cardinality-e.cardinality}function Ie(e,t){return e.degree-t.degree}function ve(e){return(t,r)=>e.reduce((s,n)=>s===0?n(t,r):s,0)}function ee(e){return(t,r)=>-e(t,r)}function Be(e){return(t,r)=>{const s=a=>a<0?Number.POSITIVE_INFINITY:a,n=s(e.findIndex(a=>t.sets.has(a))),o=s(e.findIndex(a=>r.sets.has(a)));return n-o}}function Tt(e,t){if(!t)return H;const r=Array.isArray(t)?t:[t];return r.length===0?H:ve(r.map(s=>{switch(s){case"cardinality":case"cardinality:desc":return me;case"cardinality:asc":return ee(me);case"name:desc":return ee(H);case"degree":case"degree:asc":return Ie;case"degree:desc":return ee(Ie);case"group":case"group:asc":return Be(e);case"group:desc":return ee(Be(e));default:return H}}))}function _t(e,t,r={}){let s=t;return r.order&&(s=s.sort(Tt(e,r.order))),r.limit!=null?s.slice(0,r.limit):s}const Ae={distinctIntersection:" ∩ ",intersection:" ∩ ",union:" ∪ ",composite:","};function Ut(e){if(!e)return[255,255,255];const t=e.match(/#([\da-f]{2})([\da-f]{2})([\da-f]{2})/i);if(t)return[Number.parseInt(t[1],16),Number.parseInt(t[2],16),Number.parseInt(t[3],16)];const r=e.match(/\(([\d]+)[, ]([\d]+)[, ]([\d]+)\)/i);return r?[Number.parseInt(r[1],10),Number.parseInt(r[2],10),Number.parseInt(r[3],10)]:[255,255,255]}function It(e){if(e.length===1)return e[0];if(e.every(o=>o==null))return;const t=e.map(Ut),r=Math.floor(t.reduce((o,a)=>o+a[0],0)/t.length),s=Math.floor(t.reduce((o,a)=>o+a[1],0)/t.length),n=Math.floor(t.reduce((o,a)=>o+a[2],0)/t.length);return`#${r.toString(16)}${s.toString(16)}${n.toString(16)}`}function et(e,t,r){const s=Array.from(e).sort((n,o)=>t.get(n)-t.get(o));return s.length===1?s[0].name:`(${s.map(n=>n.name).join(r)})`}function q(e,t,r,s,n){return{type:r.size===0?"composite":e,elems:s,color:n(Array.from(r).map(o=>o.color)),sets:r,name:t,cardinality:s.length,degree:r.size}}function Bt(e,t,r,s,n,o,a){const l=new Set(e.sets);t.sets.forEach(k=>l.add(k));const i=et(l,n,Ae[o]);if(e.cardinality===0||t.cardinality===0)return q(o,i,l,[],a);let f=e,c=t;e.cardinality>t.cardinality&&(f=t,c=e);const u=new Set,m=r.get(c),p=[],g=f.elems.length;for(let k=0;k<g;k++){const w=f.elems[k],E=s(w);m.has(E)&&(u.add(E),p.push(w))}const S=q(o,i,l,p,a);return r.set(S,u),S}function Pt(e,t,r,s,n,o,a){const l=new Set(e.sets);t.sets.forEach(S=>l.add(S));const i=et(l,n,Ae[o]);if(e.cardinality===0){const S=q(o,i,l,t.elems,a);return r.set(S,r.get(t)),S}if(t.cardinality===0){const S=q(o,i,l,e.elems,a);return r.set(S,r.get(e)),S}let f=e,c=t;e.cardinality>t.cardinality&&(f=t,c=e);const u=new Set(r.get(c)),m=r.get(c),p=c.elems.slice();f.elems.forEach(S=>{const k=s(S);m.has(k)||(u.add(k),p.push(S))});const g=q(o,i,l,p,a);return r.set(g,u),g}function Pe(e,t,r,s,n,o){if(typeof t=="number")return{type:"composite",elems:[],color:o?o([]):void 0,sets:new Set,name:"()",cardinality:t,overlap(i){return i===this||ie(i)&&i.name===this.name&&i.cardinality===this.cardinality?this.cardinality:0},degree:0};if(Array.isArray(t))return q(e,"()",new Set,t,o);const a=Array.from(s.values()),l=r.filter(i=>{const f=n(i);return a.every(c=>!c.has(f))});return q(e,"()",new Set,l,o)}function tt(e,t={}){const{type:r="intersection",min:s=0,max:n=Number.POSITIVE_INFINITY,empty:o=!1,elems:a=[],notPartOfAnySet:l,toElemKey:i,mergeColors:f=It}=t,c=[],u=new Map(e.map((b,$)=>[b,$])),m=new Map(e.map(b=>[b,i?new Set(b.elems.map(i)):new Set(b.elems)])),p=i?null:m,g=i?m:null,S=r==="union"?Pt:Bt;function k(b){if(b.degree<s||b.degree>n||b.cardinality===0&&!o)return;if(r!=="distinctIntersection"){c.push(b);return}const $=e.filter(x=>!b.sets.has(x));let v=[];if(i){const x=$.map(y=>g.get(y));v=b.elems.filter(y=>{const A=i(y);return x.every(L=>!L.has(A))})}else{const x=$.map(y=>p.get(y));v=b.elems.filter(y=>x.every(A=>!A.has(y)))}if(v.length===b.cardinality){c.push(b);return}const h=q(r,b.name,b.sets,v,f);h.cardinality===0&&!o||c.push(h)}function w(b,$,v,h){if($>n)return;const x=b.length;for(let y=0;y<x;y++){const A=b[y],L=[];for(let B=y+1;B<x;B++){const T=b[B],G=S(A,T,v,h,u,r,f);k(G),(r==="union"||G.cardinality>0||o)&&L.push(G)}L.length>1&&w(L,$+1,v,h)}}s<=0&&k(i?Pe(r,l,a,g,i,f):Pe(r,l,a,p,b=>b,f));const E=e.map(b=>{const $=q(r,b.name,new Set([b]),b.elems,f);return m.set($,m.get(b)),k($),$});return i?w(E,2,g,i):w(E,2,p,b=>b),_t(e,c,t)}function jt(e){if(!e)return H;switch(e){case"cardinality":case"cardinality:desc":return ve([me,H]);case"cardinality:asc":return ve([ee(me),H]);case"name:desc":return ee(H);default:return H}}function Wt(e,t={}){let r=e;if(t.order){const s=jt(t.order);r=r.slice().sort(s)}return t.limit!=null?r.slice(0,t.limit):r}function Dt(e,t,r={}){var s;const n=l=>l.sets,o=(s=t)!==null&&s!==void 0?s:{},a=Object.create(null);return e.forEach(l=>{n(l).forEach(i=>{const f=typeof i=="string"?i:String(i),c=a[f];c==null?a[f]=[l]:c.push(l)})}),Wt(Object.entries(a).map(([l,i])=>({type:"set",elems:i,name:String(l),cardinality:i.length})),o)}function V(e){return`${e.name}:${e.type}#${e.cardinality}`}function je(e){return e.sets.size===0}function Ne(e,t,r=V){const s={done:null,aKey:"",bKey:"",aIsSet:!1,bIsSet:!1,toKey:r};return e===t?(s.done=e.cardinality,s):e.cardinality===0||t.cardinality===0?(s.done=0,s):(s.aKey=r(e),s.bKey=r(t),s.aKey===s.bKey?(s.done=e.cardinality,s):(s.aIsSet=$e(e),s.bIsSet=$e(t),(!s.aIsSet&&je(e)||!s.bIsSet&&je(t))&&(s.done=0),s))}function Le(e,t){return t.bIsSet||!t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.aKey)}function Me(e,t){return!t.bIsSet||t.aIsSet?!1:Array.from(e.sets).map(t.toKey).includes(t.bKey)}function Oe(e,t=V){return e.map(r=>{const s=Array.from(r.sets).map(t).sort();return{key:s.join("&"),s,sets:new Set(s),degree:r.degree,cardinality:r.cardinality}})}function nt(e,t,r){const s=new Set;if(r.aIsSet)s.add(r.aKey);else for(const n of Array.from(e.sets))s.add(r.toKey(n));if(r.bIsSet)s.add(r.bKey);else for(const n of Array.from(t.sets))s.add(r.toKey(n));return Array.from(s).sort().join("&")}function Ft(e,t,r=V){const s=new Map;for(const n of Oe(e,r))for(const o of n.s)s.has(o)?s.get(o).push(n):s.set(o,[n]);return(n,o)=>{const a=Ne(n,o,r);if(a.done!=null)return a.done;if(!a.aIsSet&&!a.bIsSet)return 0;if(a.aIsSet&&!a.bIsSet)return Le(o,a)?o.cardinality:0;if(!a.aIsSet&&a.bIsSet)return Me(n,a)?n.cardinality:0;const l=s.get(a.aKey),i=s.get(a.bKey);return!l||!i?t(n,o):l.length<i.length?l.reduce((f,c)=>f+(c.sets.has(a.bKey)?c.cardinality:0),0):i.reduce((f,c)=>f+(c.sets.has(a.aKey)?c.cardinality:0),0)}}function Rt(e,t,r=V){const s=new Map(Oe(e,r).map(n=>[n.key,n.cardinality]));return(n,o)=>{const a=Ne(n,o,r);if(a.done!=null)return a.done;if(a.aIsSet&&!a.bIsSet&&Le(o,a))return o.cardinality;if(!a.aIsSet&&a.bIsSet&&Me(n,a))return n.cardinality;const l=nt(n,o,a);return s.has(l)?s.get(l):t(n,o)}}function Ht(e,t,r=V){const s=new Map(Oe(e,r).map(n=>[n.key,n.cardinality]));return(n,o)=>{const a=Ne(n,o,r);if(a.done!=null)return a.done;if(a.aIsSet&&!a.bIsSet&&Le(o,a))return n.cardinality;if(!a.aIsSet&&a.bIsSet&&Me(n,a))return o.cardinality;const l=nt(n,o,a);return s.has(l)?n.cardinality+o.cardinality-s.get(l):t(n,o)}}function qt(e,t,r=V){if(e.length===0)return t;const s=e[0].type;if(e.some(n=>n.type!==s))return t;switch(s){case"union":return Ht(e,t,r);case"intersection":return Rt(e,t,r);case"distinctIntersection":return Ft(e,t,r)}return t}function Vt(e){if(e.length===0)return"";const t=[];let r=e[0],s=1;for(let n=1;n<e.length;n++){const o=e[n];o===r?s++:(s>1?t.push(`${r}=${s-1}`):r===0?t.push(""):t.push(r.toString()),r=o,s=1)}return s>1?t.push(`${r}=${s}`):r===0?t.push(""):t.push(r.toString()),t.join(",")}function Gt(e){if(e.length===0)return"";const t=e.length,r=e.flat();return`${t};${Vt(r)}`}function Kt(e,t,{toElemKey:r,what:s="intersection",compress:n="auto"}={}){const o=e.concat(t);function a(u){if(u.overlap)return u.overlap;const m=ae(u.elems,r);return p=>p.overlap?p.overlap(u):m(p.elems)[s]}const l=o.map((u,m)=>{const p=a(u),g=[];for(let S=m+1;S<o.length;S++)g.push(p(o[S]));return g});if(l.pop(),n==="no")return l;const i=Gt(l);if(n==="yes")return i;const f=JSON.stringify(l).length;return i.length+2<f*.6?i:l}const Yt=(e,t,r)=>{const s=e.length+r,n=t/Math.max(1,s),o=t-n*e.length,a=new Map(e.map((f,c)=>[f,c])),l=n/(1+r),i=f=>{const c=a.get(f);if(c!=null)return o+n*c};return i.bandwidth=()=>l,i};function We(e,t,r=1){for(let s=0;s<e.length-r;s+=r){const n=e[s],o=e[s+1];if(n<o){const a=n+t[s]/2,l=o-t[s+1]/2;if(a>l)return!0}else{const a=n-t[s]/2;if(o+t[s+1]/2>a)return!0}}return!1}function we(e,t,r,s,n){let o=e[e.length-1];if(!o.label){for(let a=e.length-2;a>0;--a)if(e[a].label){o=e[a];break}}if(o.value<t){const a=r(o.value),l=r(t);if(a<l){const i=a+s(o.value)/2,f=l-s(t)/2;i<f&&e.push({value:t,label:n(t)})}else{const i=a-s(o.value)/2;l+s(t)/2<i&&e.push({value:t,label:n(t)})}}return e}function de(e,t=String,r=1){return e.map((s,n)=>({value:s,label:r===1||n%r===0?t(s):void 0}))}function rt(e,t,r,s,n){const o=e.map(l=>t(l)),a=e.map(l=>r(l));return!We(o,a)||!We(o,a,2)?we(de(e,n),s,t,r,n):null}function pe(e){return e.toLocaleString()}function Qt(e,t=11){const r=Math.max(0,Math.floor(Math.log10(e)-.5)),s=Math.pow(10,r),n=[1,2,5],o=n.map(l=>l*s);r>0&&o.unshift(n[n.length-1]*Math.pow(10,r-1)),o.push(n[0]*Math.pow(10,r+1));const a=Math.ceil(e/t);return o.filter(l=>l>=a&&l<=e)}function Jt(e,t=1){const r=[];for(let s=0;s<=e;s+=t)r.push(s);return r}function De(e,t,r,s){if(t<=0)return[];const n=Qt(e,t);for(let o=0;o<n.length;o++){const a=Jt(e,n[o]),l=rt(a,r,s,e,pe);if(l)return l}return de([0,e],pe)}const Zt=(e,t,r)=>{const s=t[1]-t[0],n=e,o=a=>{const i=Math.max(0,Math.min(a,n))/n;return t[0]+i*s};return o.ticks=(a=10)=>{if(r.orientation==="vertical"){const i=Math.ceil(r.fontSizeHint*1.4);return De(e,a+1,o,()=>i)}const l=r.fontSizeHint/1.4;return De(e,a+1,o,i=>Math.ceil(pe(i).length*l))},o.tickFormat=()=>pe,o};function te(e){const t=["","k","M","G"],r=Math.max(0,Math.min(Math.floor(Math.log10(e)/3),t.length-1));return`${(Math.round(e/Math.pow(10,r*3-1))/10).toLocaleString()}${t[r]}`}function Xt(e,t){const r=[],s=Math.pow(10,t);for(let n=1;n<=e;n*=s)r.push(n);return r}function zt(e,t){const r=[];for(let n=1,o=0;n<=e;n*=10,o++){r.push({value:n,label:t===1||o%t===0?te(n):void 0});for(let a=n+n;a<n*10&&a<e;a+=n*t)r.push({value:a})}return r}function Fe(e,t,r,s){if(t<=0)return[];for(const n of[1,2,5]){const o=Xt(e,n);if(rt(o,r,s,e,te))return we(zt(e,n),e,r,s,te)}return de([0,e],te)}const en=(e,t,r)=>{const s=t[1]-t[0],n=e<1?1:Math.log10(e),o=a=>{const l=Math.max(0,Math.min(a,n)),i=l<=1?0:Math.log10(l)/n;return t[0]+i*s};return o.ticks=(a=10)=>{if(r.orientation==="vertical"){const i=Math.ceil(r.fontSizeHint*1.4);return Fe(e,a+1,o,()=>i)}const l=r.fontSizeHint/1.4;return Fe(e,a+1,o,i=>Math.ceil(te(i).length*l))},o.tickFormat=()=>te,o};function tn(e){if(e.length===0)return"";const t=[];let r=0;const s=n=>(n===r+1?t.push(e[r].toString()):n===r+2&&n<10?t.push(`${e[r]},${e[r+1]}`):t.push(`${e[r]}+${n-r-1}`),n);for(let n=1;n<e.length;n++){const o=e[n-1]+1;e[n]!==o&&(r=s(n),r=n)}return s(e.length),t.join(",")}function se(e,t,{sortAble:r,compress:s="auto"}={}){if(e.length===0)return[];const n=e.map(i=>t(i));if(s==="no")return n;r&&n.sort((i,f)=>i-f);const o=tn(n),a=JSON.stringify(n).length,l=o.length+2;return l<a*.6||a-l>50||s==="yes"&&l<a?o:n}function he(e,t){return t.color&&(e.color=t.color),e}function nn(e,t={}){var r;const s=Object.assign({sortAble:!0},t),n=(r=t.toKey)!==null&&r!==void 0?r:V,o=new Map(e.sets.map((f,c)=>[n(f),c])),a=new Map(e.combinations.map((f,c)=>[n(f),c])),l=f=>{if(f.type==="set")return{type:f.type,index:o.get(n(f))};const c=a.get(n(f));return c==null||c<0?se(f.elems,e.toElemIndex,s):{type:f.type,index:c}},i=e.sets.map((f,c)=>({key:n(f),i:c}));return{sets:e.sets.map(f=>he({name:f.name,cardinality:f.cardinality,elems:se(f.elems,e.toElemIndex,s)},f)),combinations:t.compress==="no"?e.combinations.map(f=>{const c=new Set(Array.from(f.sets).map(n));return he({name:f.name,type:f.type,cardinality:f.cardinality,degree:f.degree,sets:i.filter(({key:u})=>c.has(u)).map(({i:u})=>u),elems:se(f.elems,e.toElemIndex,s)},f)}):void 0,combinationOptions:e.combinationOptions,selection:e.selection?Array.isArray(e.selection)?se(e.selection,e.toElemIndex,s):l(e.selection):void 0,queries:e.queries.map(f=>{const c=Z(f)?l(f.set):se(Array.from(f.elems),e.toElemIndex,s);return{name:f.name,color:f.color,set:typeof c=="string"||Array.isArray(c)?void 0:c,elems:typeof c=="string"||Array.isArray(c)?c:void 0}})}}function rn(e,t){return e.length===1?e[0].name:`(${e.map(r=>r.name).join(Ae[t])})`}function sn(e,t={}){var r;const s=(r=t.toKey)!==null&&r!==void 0?r:V,n=new Map(e.sets.map((u,m)=>[s(u),m])),o=new Map(e.combinations.map((u,m)=>[s(u),m])),a=u=>{if(ie(u)){if(u.type==="set")return{type:u.type,index:n.get(s(u))};const p=o.get(s(u));if(p!=null&&p>=0)return{type:u.type,index:p}}const m=ae(ie(u)?u.elems:u);return e.sets.map(p=>m(p.elems).intersection).concat(e.combinations.map(p=>m(p.elems).intersection))},l=new Map(e.sets.map((u,m)=>[s(u),m])),i=Kt(e.sets,e.combinations,t),f=t.compress==="yes",c=u=>{const m=Array.from(u.sets).map(g=>l.get(s(g))).sort((g,S)=>g-S),p={c:u.cardinality,s:m.reduce((g,S)=>g+Math.pow(2,S),0)};return u.name!==rn(m.map(g=>e.sets[g]),u.type)&&(p.n=u.name),u.type!=="intersection"&&(p.type=u.type[0]),u.color&&(p.cc=u.color),p};return{sets:f?e.sets.map(u=>({n:u.name,cc:u.color,c:u.cardinality})):e.sets.map(u=>he({name:u.name,cardinality:u.cardinality},u)),combinations:f?e.combinations.map(c):e.combinations.map(u=>he({name:u.name,cardinality:u.cardinality,type:u.type,sets:Array.from(u.sets).map(m=>l.get(s(m))).sort((m,p)=>m-p)},u)),overlaps:i,selection:e.selection?a(e.selection):void 0,queries:e.queries.map(u=>{if(Z(u)){const g=a(u.set);return Array.isArray(g)?{name:u.name,color:u.color,overlaps:g}:{name:u.name,color:u.color,set:g}}const m=ae(u.elems),p=e.sets.map(g=>m(g.elems).intersection).concat(e.combinations.map(g=>m(g.elems).intersection));return{name:u.name,color:u.color,overlaps:p}})}}var xe={exports:{}},Re;function on(){return Re||(Re=1,function(e){var t=function(){var r=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function a(i,f){if(!o[i]){o[i]={};for(var c=0;c<i.length;c++)o[i][i.charAt(c)]=c}return o[i][f]}var l={compressToBase64:function(i){if(i==null)return"";var f=l._compress(i,6,function(c){return s.charAt(c)});switch(f.length%4){default:case 0:return f;case 1:return f+"===";case 2:return f+"==";case 3:return f+"="}},decompressFromBase64:function(i){return i==null?"":i==""?null:l._decompress(i.length,32,function(f){return a(s,i.charAt(f))})},compressToUTF16:function(i){return i==null?"":l._compress(i,15,function(f){return r(f+32)})+" "},decompressFromUTF16:function(i){return i==null?"":i==""?null:l._decompress(i.length,16384,function(f){return i.charCodeAt(f)-32})},compressToUint8Array:function(i){for(var f=l.compress(i),c=new Uint8Array(f.length*2),u=0,m=f.length;u<m;u++){var p=f.charCodeAt(u);c[u*2]=p>>>8,c[u*2+1]=p%256}return c},decompressFromUint8Array:function(i){if(i==null)return l.decompress(i);for(var f=new Array(i.length/2),c=0,u=f.length;c<u;c++)f[c]=i[c*2]*256+i[c*2+1];var m=[];return f.forEach(function(p){m.push(r(p))}),l.decompress(m.join(""))},compressToEncodedURIComponent:function(i){return i==null?"":l._compress(i,6,function(f){return n.charAt(f)})},decompressFromEncodedURIComponent:function(i){return i==null?"":i==""?null:(i=i.replace(/ /g,"+"),l._decompress(i.length,32,function(f){return a(n,i.charAt(f))}))},compress:function(i){return l._compress(i,16,function(f){return r(f)})},_compress:function(i,f,c){if(i==null)return"";var u,m,p={},g={},S="",k="",w="",E=2,b=3,$=2,v=[],h=0,x=0,y;for(y=0;y<i.length;y+=1)if(S=i.charAt(y),Object.prototype.hasOwnProperty.call(p,S)||(p[S]=b++,g[S]=!0),k=w+S,Object.prototype.hasOwnProperty.call(p,k))w=k;else{if(Object.prototype.hasOwnProperty.call(g,w)){if(w.charCodeAt(0)<256){for(u=0;u<$;u++)h=h<<1,x==f-1?(x=0,v.push(c(h)),h=0):x++;for(m=w.charCodeAt(0),u=0;u<8;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1}else{for(m=1,u=0;u<$;u++)h=h<<1|m,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=0;for(m=w.charCodeAt(0),u=0;u<16;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1}E--,E==0&&(E=Math.pow(2,$),$++),delete g[w]}else for(m=p[w],u=0;u<$;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1;E--,E==0&&(E=Math.pow(2,$),$++),p[k]=b++,w=String(S)}if(w!==""){if(Object.prototype.hasOwnProperty.call(g,w)){if(w.charCodeAt(0)<256){for(u=0;u<$;u++)h=h<<1,x==f-1?(x=0,v.push(c(h)),h=0):x++;for(m=w.charCodeAt(0),u=0;u<8;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1}else{for(m=1,u=0;u<$;u++)h=h<<1|m,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=0;for(m=w.charCodeAt(0),u=0;u<16;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1}E--,E==0&&(E=Math.pow(2,$),$++),delete g[w]}else for(m=p[w],u=0;u<$;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1;E--,E==0&&(E=Math.pow(2,$),$++)}for(m=2,u=0;u<$;u++)h=h<<1|m&1,x==f-1?(x=0,v.push(c(h)),h=0):x++,m=m>>1;for(;;)if(h=h<<1,x==f-1){v.push(c(h));break}else x++;return v.join("")},decompress:function(i){return i==null?"":i==""?null:l._decompress(i.length,32768,function(f){return i.charCodeAt(f)})},_decompress:function(i,f,c){var u=[],m=4,p=4,g=3,S="",k=[],w,E,b,$,v,h,x,y={val:c(0),position:f,index:1};for(w=0;w<3;w+=1)u[w]=w;for(b=0,v=Math.pow(2,2),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;switch(b){case 0:for(b=0,v=Math.pow(2,8),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;x=r(b);break;case 1:for(b=0,v=Math.pow(2,16),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;x=r(b);break;case 2:return""}for(u[3]=x,E=x,k.push(x);;){if(y.index>i)return"";for(b=0,v=Math.pow(2,g),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;switch(x=b){case 0:for(b=0,v=Math.pow(2,8),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;u[p++]=r(b),x=p-1,m--;break;case 1:for(b=0,v=Math.pow(2,16),h=1;h!=v;)$=y.val&y.position,y.position>>=1,y.position==0&&(y.position=f,y.val=c(y.index++)),b|=($>0?1:0)*h,h<<=1;u[p++]=r(b),x=p-1,m--;break;case 2:return k.join("")}if(m==0&&(m=Math.pow(2,g),g++),u[x])S=u[x];else if(x===p)S=E+E.charAt(0);else return null;k.push(S),u[p++]=E+S.charAt(0),m--,E=S,m==0&&(m=Math.pow(2,g),g++)}}};return l}();e!=null?e.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})}(xe)),xe.exports}var an=on();const He=St(an);function st(e){return Array.from(e.classList).find(t=>t.startsWith("root-")).slice(5)}function ot(e,t){var r,s;return(s=(r=e.querySelector(`titleTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&s!==void 0?s:"UpSetJS"}function ln(e,t){var r,s;return(s=(r=e.querySelector(`descTextStyle-${t}`))===null||r===void 0?void 0:r.textContent)!==null&&s!==void 0?s:""}const oe={},Ee=[],ke={setLabel:"16px",axisTick:"10px",chartLabel:"16px",barLabel:"10px",legend:"10px",description:"16px",title:"24px",valueLabel:"12px",exportLabel:"10px"},cn=[.18,.12,.7],un=[.6,.4],at={type:"intersection",order:["cardinality:desc","name:asc"]},fn=Object.keys(ke),ce=[.7,.4],le=[.15,.3],mn={selectionColor:"#ffa500",color:"#000000",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!1},dn={selectionColor:"#ffa500",color:"#cccccc",hasSelectionColor:"",opacity:1,hasSelectionOpacity:-1,textColor:"#ffffff",hoverHintColor:"#d9d9d9",notMemberColor:"#666666",alternatingBackgroundColor:"rgba(255, 255, 255, 0.2)",valueTextColor:"#ffffff",strokeColor:"#ffffff",backgroundColor:"#303030",filled:!1},pn={selectionColor:"#4c78a8",color:"#4c78a8",hasSelectionColor:"#c9d6e5",opacity:1,hasSelectionOpacity:-1,textColor:"#000000",hoverHintColor:"#cccccc",notMemberColor:"#d3d3d3",alternatingBackgroundColor:"rgba(0,0,0,0.05)",valueTextColor:"#000000",strokeColor:"#000000",backgroundColor:"#ffffff",filled:!0};function Te(e){return e==="vega"?pn:e==="dark"?dn:mn}function hn(e){return Array.isArray(e)}function yn(e){return d.createElement("style",null,e)}function gn(e,t,r={}){const s=Te(t.theme);return Object.assign(e,{queryLegend:t.queries!=null&&t.queries.length>0,theme:"light",padding:20,selection:null,title:"",description:"",fontFamily:"sans-serif",queries:Ee,exportButtons:!0,className:"",fontSizes:ke,classNames:oe,style:oe,styles:oe,toKey:V,tooltips:!0,styleFactory:yn},s,t,r,t.fontSizes?{fontSizes:Object.assign({},ke,t.fontSizes)}:oe)}function bn(e){return gn({barPadding:.3,dotPadding:.7,combinations:at,combinationName:e.combinations!=null&&!hn(e.combinations)&&e.combinations.type==="union"?"Union Size":"Intersection Size",barLabelOffset:2,setNameAxisOffset:"auto",combinationNameAxisOffset:"auto",setName:"Set Size",widthRatios:cn,heightRatios:un,setLabelAlignment:"center",numericScale:"linear",bandScale:"band",childrenFactories:oe,setAddons:Ee,combinationAddons:Ee,setAddonPadding:1,combinationAddonPadding:1,emptySelection:!0},e)}function it(e){return bn(e)}function Sn(e,t){const r=e.cloneNode(!0);return r.style.backgroundColor=Te(e.dataset.theme).backgroundColor,t&&Array.from(r.querySelectorAll(t)).forEach(s=>s.remove()),new XMLSerializer().serializeToString(r)}function xn(e,{type:t="png",title:r,toRemove:s}){const n=new Blob([Sn(e,s)],{type:"image/svg+xml;charset=utf-8"}),o=st(e),a=r??ot(e,o),l=URL.createObjectURL(n);return t==="svg"?(ye(l,`${a}.${t}`,e.ownerDocument),URL.revokeObjectURL(l),Promise.resolve()):$n(l,e).then(i=>{ye(i,`${a}.${t}`,e.ownerDocument),URL.revokeObjectURL(l)})}function $n(e,t){const r=t.ownerDocument.createElement("canvas"),s=t.getBoundingClientRect();r.width=s.width,r.height=s.height;const n=r.getContext("2d"),o=new Image(r.width,r.height);return new Promise(a=>{o.onload=()=>{n.drawImage(o,0,0);const l=r.toDataURL("image/png");a(l)},o.src=e})}function ye(e,t,r){const s=r.createElement("a");s.href=e,s.style.position="absolute",s.style.left="-10000px",s.style.top="-10000px",s.download=t,r.body.appendChild(s),s.click(),s.remove()}function vn(e,t){var r,s,n,o,a;const l=(n=e.getComputedStyle||((s=(r=e.ownerDocument)===null||r===void 0?void 0:r.defaultView)===null||s===void 0?void 0:s.getComputedStyle))!==null&&n!==void 0?n:window.getComputedStyle,i=st(e),f=t??ot(e,i),c=Array.from(e.querySelectorAll("[data-upset=sets] [data-cardinality]")).map(C=>({name:C.querySelector(`text.setTextStyle-${i}`).textContent,cardinality:Number.parseInt(C.dataset.cardinality,10)})).reverse(),u=-Number.parseFloat(e.querySelector(`.sBarTextStyle-${i}`).getAttribute("dx")),m=l(e.querySelector(`.fillPrimary-${i}`)).fill,p=l(e.querySelector(`.fillNotMember-${i}`)).fill,g=l(e.querySelector("text")).fill,S=e.querySelector(`.cChartTextStyle-${i}`).textContent,k=e.querySelector(`.sChartTextStyle-${i}`).textContent,w=Array.from(e.querySelectorAll("[data-upset=cs] [data-cardinality]")).map(C=>({name:C.querySelector(`text.hoverBarTextStyle-${i}`).textContent,cardinality:Number.parseInt(C.dataset.cardinality,10),sets:Array.from(C.querySelectorAll(`.fillPrimary-${i} > title`)).map(_=>_.textContent)})),E=C=>Number.parseFloat(C.getAttribute("transform").match(/([\d.]+),/)[1]),b=C=>Number.parseFloat(C.getAttribute("transform").match(/,([\d.]+)/)[1]),$=e.querySelector("[data-upset=base]"),v=E($),h=E(e.querySelector("[data-upset=csaxis]")),x=Number.parseFloat($.querySelector("g").firstElementChild.children[1].getAttribute("x2")),y=b(e.querySelector("[data-upset=setaxis]")),A=Number.parseFloat(e.querySelector("defs rect").getAttribute("width")),L=Number.parseFloat(e.querySelector("defs rect").getAttribute("height")),B=Number.parseFloat(e.querySelector(`[data-cardinality] circle.fillPrimary-${i}`).getAttribute("r")),T=e.querySelector("[data-upset=sets-s] [data-cardinality]")!=null,G=e.querySelector("[data-upset=sets-q] [data-cardinality]")!=null,I=T||G;let U="orange";I&&(Array.from(e.querySelectorAll(`[data-upset=sets-${T?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(C=>{const _=c.length-Number.parseInt(C.dataset.i,10)-1;c[_].selection=Number.parseInt(C.dataset.cardinality,10)}),Array.from(e.querySelectorAll(`[data-upset=cs-${T?"s]":"q]:first-of-type"} [data-cardinality]`)).forEach(C=>{const _=Number.parseInt(C.dataset.i,10);w[_].selection=Number.parseInt(C.dataset.cardinality,10)}),U=l(e.querySelector(`[data-upset=sets-${T?"s":"q"}] [data-cardinality]`)).fill);const D=Number.parseInt((a=(o=e.querySelector("[data-upset=cs-ss]"))===null||o===void 0?void 0:o.dataset.i)!==null&&a!==void 0?a:"-1",10),F=D>=0?{field:"partOf",oneOf:[1,2]}:{field:"partOf",equal:1};return{$schema:"https://vega.github.io/schema/vega-lite/v4.json",title:f,description:ln(e,i),datasets:{sets:c,combinations:w.map((C,_)=>Object.assign({},C,{partOf:D===_?2:1,nsets:[""]})).concat(w.map(C=>({name:C.name,cardinality:C.cardinality,partOf:0,sets:[""],nsets:c.filter(_=>!C.sets.includes(_.name)).map(_=>_.name)})))},vconcat:[{hconcat:[{mark:"bar",width:h+A-40,height:y},{width:x,height:y,data:{name:"combinations"},transform:[{filter:F}],layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"center",baseline:"bottom",dy:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},I&&{mark:{type:"bar",fill:U,tooltip:!0},encoding:{y:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null},y:{field:"cardinality",type:"quantitative",axis:{grid:!1},title:S}}}]},{hconcat:[{width:h,height:L,data:{name:"sets"},layer:[{mark:{type:"bar",tooltip:!0}},{mark:{type:"text",align:"right",baseline:"middle",dx:-u},encoding:{text:{field:"cardinality",type:"quantitative"}}},I&&{mark:{type:"bar",fill:U,tooltip:!0},encoding:{x:{field:"selection",type:"quantitative"}}}].filter(Boolean),encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},x:{field:"cardinality",type:"quantitative",title:k,sort:"descending",axis:{grid:!1}}}},{data:{name:"sets"},width:A,height:L,mark:{type:"text",align:"center",baseline:"middle",fontSize:Number.parseInt(l(e.querySelector(`.setTextStyle-${i}`)).fontSize,10)},encoding:{y:{field:"name",type:"ordinal",axis:null,sort:null},text:{field:"name",type:"ordinal"}}},{width:x,height:L,data:{name:"combinations"},transform:[{flatten:["sets"],as:["has_set"]},{flatten:["nsets"],as:["has_not_set"]},{calculate:"datum.has_set+datum.has_not_set",as:"set"}],layer:[{mark:{type:"circle",size:B*B*Math.PI,tooltip:!0},encoding:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[p,m].concat(D>=0?[U]:[])}},y:{field:"set",type:"ordinal",axis:null,sort:null,scale:{domain:c.map(C=>C.name)}}}},{mark:"rule",transform:[{filter:F},{calculate:"datum.sets[datum.sets.length -1]",as:"set_end"}],encoding:Object.assign({y:{field:"sets[0]",type:"ordinal",axis:null,sort:null},y2:{field:"set_end"}},D<0?{}:{color:{field:"partOf",type:"nominal",legend:null,scale:{range:[m,U]}}})}],encoding:{x:{field:"name",type:"ordinal",axis:null,sort:null}}}]}],config:{padding:v,background:Te(e.dataset.theme).backgroundColor,concat:{spacing:0},view:{stroke:null},bar:{fill:m},circle:{opacity:1},rule:{stroke:m,strokeWidth:Number.parseInt(l(e.querySelector("[data-upset=cs] [data-cardinality] line")).strokeWidth,10)},axis:{labelColor:g,labelFontSize:Number.parseInt(l(e.querySelector(`.axisTextStyle-${i}`)).fontSize,10),titleColor:g,titleFontSize:Number.parseInt(l(e.querySelector(`.cChartTextStyle-${i}`)).fontSize,10)},title:{color:g},text:{fill:g,fontSize:Number.parseInt(l(e.querySelector(`.sBarTextStyle-${i}`)).fontSize,10)}}}}function wn(e,{title:t}={}){const r=vn(e,t),s=URL.createObjectURL(new Blob([JSON.stringify(r,null,2)],{type:"application/json"}));ye(s,`${r.title}.json`,e.ownerDocument),URL.revokeObjectURL(s)}const En=["selectionColor","color","textColor","hoverHintColor","notMemberColor","alternatingBackgroundColor","hasSelectionColor","hasSelectionOpacity","opacity","strokeColor","valueTextColor"],kn=["padding","barPadding","dotPadding","widthRatios","heightRatios"],Cn=["fontSizes","combinationName","setName","barLabelOffset","setNameAxisOffset","combinationNameAxisOffset","theme","fontFamily","emptySelection","exportButtons","queryLegend"],An=["bandScale","numericScale"].concat(En,kn,Cn);function lt(e){var t;const r=it({width:0,height:0,sets:(t=e.sets)!==null&&t!==void 0?t:[],combinations:e.combinations,theme:e.theme}),s={};return An.forEach(n=>{const o=e[n],a=r[n];if(n==="theme"&&o!=="light"){s[n]=o;return}if(!(o==null||o===a))if(n==="fontSizes"){let l=!0;const i={};fn.forEach(f=>{const c=o[f],u=a[f];c!==u&&(i[f]=c,l=!1)}),l||(s[n]=i)}else s[n]=o}),s}function Nn(e,t,r,s,n){return Object.assign({$schema:"https://upset.js.org/schema.1.0.0.json",name:typeof r.title=="string"?r.title:"UpSetJS",description:typeof r.description=="string"?r.description:"",mode:n,author:s,elements:t,attrs:[],props:lt(r)},e)}function Ln(e,t,r,s){return Object.assign({$schema:"https://upset.js.org/schema-static.1.0.0.json",name:typeof t.title=="string"?t.title:"UpSetJS",description:typeof t.description=="string"?t.description:"",mode:s,author:r,props:lt(t)},e)}function ct(e,t,r=!1,s){var n,o;const a=[],l=new Map,i=c=>l.has(c)?l.get(c):(l.set(c,a.length),a.push(c),a.length-1),f=nn({sets:e.sets,queries:(o=(n=e.queries)===null||n===void 0?void 0:n.filter(c=>ne(c)||Z(c)))!==null&&o!==void 0?o:[],toElemIndex:i,selection:e.selection&&ie(e.selection)?e.selection:void 0,combinations:t.cs.v,combinationOptions:Array.isArray(e.combinations)?{}:e.combinations},{compress:r?"yes":"no"});return Nn(f,a,e,void 0,s)}function Mn(e,t,r=!1,s){var n,o;const a=sn({sets:e.sets,queries:(o=(n=e.queries)===null||n===void 0?void 0:n.filter(l=>ne(l)||Z(l)))!==null&&o!==void 0?o:[],selection:e.selection&&ie(e.selection)?e.selection:void 0,combinations:t.cs.v},{compress:r?"yes":"no"});return Ln(a,e,void 0,s)}function On(e,t,r,s){const n=ct(t,r,!1,s),o=URL.createObjectURL(new Blob([JSON.stringify(n,null,2)],{type:"application/json"}));ye(o,`${n.name}.json`,e.ownerDocument),URL.revokeObjectURL(o)}const qe=2048*2;function Tn(e,t,r){const s=ct(e,t,!0,r);delete s.$schema;const n=He.compressToEncodedURIComponent(JSON.stringify(s)),o=new URL("https://upset.js.org/app/embed.html");if(o.searchParams.set("p",n),o.toString().length<qe)return window.open(o.toString(),"_blank"),!0;const a=Mn(e,t,!0,r);delete a.$schema;const l=He.compressToEncodedURIComponent(JSON.stringify(a));if(o.searchParams.set("p",l),o.toString().length<qe)return window.open(o.toString(),"_blank"),!0;o.searchParams.delete("p");const i=window.open(o.toString(),"_blank");return i==null||i.addEventListener("load",()=>{i==null||i.postMessage(s,o.origin)}),!1}function M(...e){return e.filter(Boolean).join(" ")}function _e(e){return`upset-${Math.random().toString(36).slice(4)}`}function Ve(e){return e!=null&&!Array.isArray(e)}function Ge(e,t){const r=ae(e,t);return s=>r(s.elems).intersection}function _n(){return-1}function Un(e,t,r){if(!e)return Bn;if(typeof e=="function")return e;if(Array.isArray(e))return Ge(e,r);const s=e;if(s.overlap)return s.overlap.bind(s);let n=null;return o=>{if(o.overlap)return o.overlap(s);const a=t(o,s);return a>=0?a:(n||(n=Ge(s.elems,r)),n(o))}}function ut(e){var t;return Array.isArray(e)?`Array(${e.length})`:typeof e=="function"?"?":(t=e)===null||t===void 0?void 0:t.name}function In(e,t){const r=At(e,t);return s=>r(s.elems).intersection}function Bn(){return 0}function Ke(e){return e==null?10:e.endsWith("pt")?Math.floor(4/3*Number.parseInt(e,10)):Number.parseInt(e,10)}function Pn(e){var t;return(t={left:"start",center:"middle",right:"end"}[e])!==null&&t!==void 0?t:"middle"}function jn(e){return e==="linear"?Zt:e==="log"?en:e}function Wn(e){return e==="band"?Yt:e}function Dn(e){return Array.isArray(e)}function Fn(e,t,r,s,n,o,a,l,i,f,c,u,m,p,g){var S;const k=jn(s),w=Wn(n),E=Dn(t)?t:tt(e,Object.assign({toElemKey:u},at,t)),b=E.map(c),$=w(b,r.cs.w,r.padding),v=E.reduce((O,R)=>Math.max(O,R.cardinality),0),h=g??v,x=h>v?0:o,y=k(h,[r.cs.h,x],{orientation:"vertical",fontSizeHint:i}),A=O=>Math.floor(o/1.4*.7*O.length),L=O=>A(y.tickFormat()(O)),B=e.reduce((O,R)=>Math.max(O,R.cardinality),0),T=p??B,G=L(T);let I=L(h);for(const O of f){if(!O.scale)continue;const R=O.scale.ticks(3),X=O.scale.tickFormat();for(const P of R){const Q=typeof P=="number"?X(P):(S=P.label)!==null&&S!==void 0?S:X(P.value),z=A(Q);z>I&&(I=z)}}const U=T>B?0:G,D=k(T,[r.sets.w,U],{orientation:"horizontal",fontSizeHint:i}),F=e.map(c),C=w(F.slice().reverse(),r.sets.h,r.padding),_=Math.min(C.bandwidth(),$.bandwidth())/2*a,be=Math.max(2,Math.min(C.bandwidth(),$.bandwidth())/2*l);return{id:m||_e(),r:_,triangleSize:be,sets:{v:e,keys:F,rv:e.slice().reverse(),x:D,xAxisWidth:r.sets.w-U,y:O=>C(c(O)),max:T,bandWidth:C.bandwidth(),cy:C.bandwidth()/2+r.cs.h,format:D.tickFormat(),labelOffset:o+9+2},cs:{v:E,keys:E.map(c),x:O=>$(c(O)),max:h,y,yAxisWidth:r.cs.h-x,cx:$.bandwidth()/2,bandWidth:$.bandwidth(),format:y.tickFormat(),has:(O,R)=>{const X=c(R);return Array.from(O.sets).some(P=>c(P)===X)},labelOffset:I+9+6},toKey:c,toElemKey:u,overlapGuesser:qt(E,_n,c)}}function Rn(e,t,r,s,n,o,a,l,i,f,c){const u=a.reduce(($,v)=>$+(v.position==="before"?v.size+f:0),0),m=a.reduce(($,v)=>$+(v.position!=="before"?v.size+f:0),0),p=l.reduce(($,v)=>$+(v.position==="before"?v.size+f:0),0),g=l.reduce(($,v)=>$+(v.position!=="before"?v.size+f:0),0),S=t-2*r-20-g-p,k=e-2*r-u-m,w=n[0]>1?n[0]:k*n[0],E=n[1]>1?n[1]:k*n[1],b=o[0]>1?o[0]:S*o[0];return{id:i||_e(),cs:{before:p,after:g,x:u+w+E,y:p,w:k-w-E,h:b,addons:l,addonPadding:c},labels:{x:u+w,y:p+b,w:E,h:S-b},sets:{before:u,after:m,x:u,y:p+b,w,h:S-b,addons:a,addonPadding:f},padding:s,legend:{x:e/2},margin:r,w:e,h:t}}function Hn(e,t,r,s,n,o,a,l,i,f,c,u,m,p,g){return{theme:e,styles:t,classNames:r,cs:{name:s,offset:n},sets:{name:o,offset:a},emptySelection:c,id:l,barLabelOffset:i,selectionColor:f,title:u,description:m,tooltips:p,setLabelAlignment:g}}function qn({transform:e,styleId:t,exportButtons:r,exportChart:s}){if(!r)return null;const n=26,o=26,a=34,l=34,i=42,f=2;let c=0;const u=[];return(r===!0||r.svg!==!1)&&(c+=n,u.push(d.createElement("g",{key:"svg",className:`exportButton-${t}`,onClick:s,"data-type":"svg",transform:`translate(-${c}, 0)`},d.createElement("title",null,"Download SVG Image"),d.createElement("rect",{y:-9,width:n,height:11,rx:2,ry:2}),d.createElement("text",{className:`exportTextStyle-${t}`,x:n/2},"SVG"))),c+=f),(r===!0||r.png!==!1)&&(c+=o,u.push(d.createElement("g",{key:"png",className:`exportButton-${t}`,onClick:s,"data-type":"png",transform:`translate(-${c}, 0)`},d.createElement("title",null,"Download PNG Image"),d.createElement("rect",{y:-9,width:o,height:11,rx:2,ry:2}),d.createElement("text",{className:`exportTextStyle-${t}`,x:o/2},"PNG"))),c+=f),(r===!0||r.vega!==!1)&&(c+=a,u.push(d.createElement("g",{key:"vega",className:`exportButton-${t}`,onClick:s,"data-type":"vega",transform:`translate(-${c}, 0)`},d.createElement("title",null,"Download VEGA-Lite Specification"),d.createElement("rect",{y:-9,width:a,height:11,rx:2,ry:2}),d.createElement("text",{className:`exportTextStyle-${t}`,x:a/2},"VEGA"))),c+=f),(r===!0||r.dump!==!1)&&(c+=l,u.push(d.createElement("g",{key:"dump",className:`exportButton-${t}`,onClick:s,"data-type":"dump",transform:`translate(-${c}, 0)`},d.createElement("title",null,"Download UpSet.js JSON Dump"),d.createElement("rect",{y:-9,width:l,height:11,rx:2,ry:2}),d.createElement("text",{className:`exportTextStyle-${t}`,x:l/2},"DUMP"))),c+=f),(r===!0||r.share!==!1)&&(c+=i,u.push(d.createElement("g",{key:"share",className:`exportButton-${t}`,onClick:s,"data-type":"share",transform:`translate(-${c}, 0)`},d.createElement("title",null,"Open a shareable URL"),d.createElement("rect",{y:-9,width:i,height:11,rx:2,ry:2}),d.createElement("text",{className:`exportTextStyle-${t}`,x:i/2},"SHARE"))),c+=f),d.createElement("g",{className:`exportButtons-${t}`,transform:e},u)}const Vn=d.memo(function({queries:t,x:r,style:s,data:n}){return d.createElement("text",{transform:`translate(${r},4)`,style:s.styles.legend,className:M(`legendTextStyle-${s.id}`,s.classNames.legend)},t.map((o,a)=>{let l=null;return Z(o)?l=o.set.cardinality:ne(o)&&(l=o.elems instanceof Set?o.elems.size:o.elems.length),d.createElement(d.Fragment,{key:o.name},d.createElement("tspan",{className:`fillQ${a}-${n.id}`},"  ⬤ "),d.createElement("tspan",null,o.name,l!=null?`: ${n.sets.format(l)}`:""))}))}),Gn=d.memo(function({pos:t,spacing:r,tickSizeInner:s,orient:n,name:o,style:a}){const l=n==="top"||n==="left"?-1:1;return d.createElement("g",{transform:`translate(0, ${t+.5})`},o&&d.createElement("text",{x:l*r,dy:"0.32em",className:M(`axisTextStyle-${a.id}`,n==="right"?`startText-${a.id}`:`endText-${a.id}`,a.classNames.axisTick),style:a.styles.axisTick},o),d.createElement("line",{x2:l*s,className:`axisLine-${a.id}`}))}),Kn=d.memo(function({pos:t,name:r,spacing:s,orient:n,tickSizeInner:o,style:a}){const l=n==="top"||n==="left"?-1:1;return d.createElement("g",{transform:`translate(${t+.5}, 0)`},r&&d.createElement("text",{y:l*s,dy:n==="top"?"0em":"0.71em",className:M(`axisTextStyle-${a.id}`,a.classNames.axisTick),style:a.styles.axisTick},r),d.createElement("line",{y2:l*o,className:`axisLine-${a.id}`}))});function ue({scale:e,orient:t,tickSizeInner:r=6,tickSizeOuter:s=6,tickPadding:n=3,size:o,start:a,style:l,transform:i}){const f=Math.max(r,0)+n,c=a,u=o,m=t==="top"||t==="left"?-1:1,p=t==="left"||t==="right"?Gn:Kn,g=e.ticks().map(S=>typeof S=="number"?{value:S,label:S.toLocaleString()}:S);return d.createElement("g",{transform:i},g.map(S=>d.createElement(p,{key:S.value,pos:e(S.value),name:S.label,spacing:f,tickSizeInner:r,orient:t,style:l})),d.createElement("path",{className:`axisLine-${l.id}`,d:t==="left"||t==="right"?s?`M${m*s},${c}H0.5V${u}H${m*s}`:`M0.5,${c}V${u}`:s?`M${c},${m*s}V0.5H${u}V${m*s}`:`M${c},0.5H${u}`}))}const Ye=d.memo(function({width:t,text:r,dy:s,x:n,style:o,className:a}){const l=N.useRef(null),[i,f]=N.useState(typeof r=="string"?[r]:[]);return N.useLayoutEffect(()=>{f(typeof r=="string"?[r]:[])},[r]),N.useLayoutEffect(()=>{if(!l.current||l.current.childElementCount>0||typeof r!="string"||typeof l.current.getComputedTextLength!="function")return;const c=l.current.getComputedTextLength(),u=[];let m=t,p=0;const g=l.current.getStartPositionOfChar(0);for(;c>m;){g.x=m;const S=l.current.getCharNumAtPosition(g),k=r.lastIndexOf(" ",S);if(k<p)break;u.push(r.slice(p,k+1));const w=l.current.getEndPositionOfChar(k+1).x;p=k+1,m=w+t}u.push(r.slice(p)),f(u)},[l,r,t]),r?d.createElement("tspan",{ref:l,dy:s,style:o,x:n,className:a},i.length>1?i.map((c,u)=>d.createElement("tspan",{key:c,x:0,dy:u>0?"1.2em":s},c)):r):null});var Yn=d.memo(function({width:t,descriptionWidth:r=t,style:s}){return!s.title&&!s.description?null:d.createElement("text",null,d.createElement(Ye,{text:s.title,width:t,dy:"10px",className:M(`titleTextStyle-${s.id}`,s.classNames.title),style:s.styles.title}),d.createElement(Ye,{x:0,width:r,dy:s.title?"2em":"10px",text:s.description,className:M(`descTextStyle-${s.id}`,s.classNames.description),style:s.styles.description}))});function Qn(){}function fe(e){return e?(t,r)=>function(s){return e.call(this,t,s.nativeEvent,r.map(n=>n.createOnHandlerData?n.createOnHandlerData(t):null))}:Qn}function re(e,t){let r=0,s=0;return n=>{let o=0;return n.position==="before"?(r+=n.size+t,o=-r):(o=e+s+t,s+=n.size+t),o}}function W(e,t,r="fill"){return t?e?Object.assign({[r]:t},e):t?{[r]:t}:void 0:e}const Jn=d.memo(function({size:t,style:r,data:s}){const n=re(t.sets.w+t.labels.w+t.cs.w,t.sets.addonPadding),o=re(t.cs.h+t.sets.h,t.cs.addonPadding),a=r.cs.offset==="auto"?s.cs.labelOffset:r.cs.offset,l=r.sets.offset==="auto"?s.sets.labelOffset:r.sets.offset;return d.createElement("g",null,d.createElement(Yn,{style:r,width:t.cs.x-a-20}),t.cs.h>0&&d.createElement("g",{transform:`translate(${t.cs.x},${t.cs.y})`,"data-upset":"csaxis"},d.createElement(ue,{scale:s.cs.y,orient:"left",size:t.cs.h,start:t.cs.h-s.cs.yAxisWidth,style:r}),d.createElement("line",{x1:0,x2:t.cs.w,y1:t.cs.h+1,y2:t.cs.h+1,className:`axisLine-${r.id}`}),d.createElement("text",{className:M(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-a}, ${t.cs.h/2})rotate(-90)`},r.cs.name),t.cs.addons.map(i=>{const f=o(i),c=d.createElement("text",{key:i.name,className:M(`cChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${-a}, ${f+i.size/2})rotate(-90)`},i.name);return i.scale?d.createElement(d.Fragment,{key:i.name},d.createElement(ue,{scale:i.scale,orient:"left",size:i.size,start:0,style:r,transform:`translate(0,${f})`}),c):c})),t.sets.w>0&&d.createElement("g",{transform:`translate(${t.sets.x},${t.sets.y})`,"data-upset":"setaxis"},d.createElement(ue,{scale:s.sets.x,orient:"bottom",size:t.sets.w,start:t.sets.w-s.sets.xAxisWidth,transform:`translate(0, ${t.sets.h})`,style:r}),d.createElement("text",{className:M(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${t.sets.w/2}, ${t.sets.h+l})`},r.sets.name),t.sets.addons.map(i=>{const f=n(i),c=d.createElement("text",{key:i.name,className:M(`sChartTextStyle-${r.id}`,r.classNames.chartLabel),style:r.styles.chartLabel,transform:`translate(${f+i.size/2}, ${t.sets.h+l})`},i.name);return i.scale?d.createElement(d.Fragment,{key:i.name},d.createElement(ue,{scale:i.scale,orient:"bottom",size:i.size,start:0,transform:`translate(${f}, ${t.sets.h})`,style:r}),c):c})))}),Ce=d.memo(function({cx:t,r,cy:s,name:n,className:o,style:a,fill:l}){return d.createElement("circle",{r,cx:t,cy:s,className:o,style:W(a,l)},n&&d.createElement("title",null,n))});function ge(e,t,r){const s=[r(e)];for(let n=0;n<le.length&&e>t;n++)e-=t,s.push(r(e));return s}const Zn=d.memo(function({d:t,h:r,className:s,data:n,size:o,style:a,children:l}){const i=ge(t.cardinality,n.cs.max,n.cs.y),f=re(o.cs.h+o.sets.h,o.cs.addonPadding);return d.createElement("g",{transform:`translate(${n.cs.x(t)}, 0)`,onMouseEnter:r.onMouseEnter(t,o.cs.addons),onMouseLeave:r.onMouseLeave,onClick:r.onClick(t,o.cs.addons),onContextMenu:r.onContextMenu(t,o.cs.addons),onMouseMove:r.onMouseMove(t,o.cs.addons),className:s,"data-cardinality":t.cardinality},a.tooltips&&d.createElement("title",null,t.name,": ",n.cs.format(t.cardinality)),d.createElement("rect",{y:-o.cs.before,width:n.cs.bandWidth,height:o.sets.h+o.cs.h+o.cs.before+o.cs.after,className:`hoverBar-${a.id}`}),o.cs.h>0&&d.createElement(d.Fragment,null,i.map((c,u)=>{const m=u>0?Math.floor(n.cs.bandWidth*le[u-1]):0;return d.createElement("rect",{key:u,x:m,y:c,height:o.cs.h-c,width:n.cs.bandWidth-m*2,className:M(`fillPrimary-${a.id}`,u<i.length-1&&`fillOverflow${i.length-1-u}-${a.id}`,a.classNames.bar),style:W(a.styles.bar,t.color)})}),d.createElement("text",{y:i[0]-a.barLabelOffset,x:n.cs.bandWidth/2,style:a.styles.barLabel,className:M(`cBarTextStyle-${a.id}`,a.classNames.barLabel)},n.cs.format(t.cardinality))),d.createElement("text",{y:-a.barLabelOffset-o.cs.before,x:n.cs.bandWidth/2,style:a.styles.barLabel,className:M(`hoverBarTextStyle-${a.id}`,a.classNames.barLabel)},t.name),n.sets.v.map((c,u)=>n.cs.has(t,c)?null:d.createElement(Ce,{key:n.sets.keys[u],r:n.r,cx:n.cs.cx,cy:n.sets.y(c)+n.sets.cy,name:a.tooltips?t.name:"",style:a.styles.dot,fill:void 0,className:M(`fillNotMember-${a.id}`,a.classNames.dot)})),t.sets.size>1&&d.createElement("line",{x1:n.cs.cx,y1:n.sets.y(n.sets.v.find(c=>n.cs.has(t,c)))+n.sets.cy-(n.r-1),x2:n.cs.cx,y2:n.sets.y(n.sets.rv.find(c=>n.cs.has(t,c)))+n.sets.cy+(n.r-1),style:t.color?{stroke:t.color}:void 0,className:`upsetLine-${n.id}`}),n.sets.v.map((c,u)=>{var m;return n.cs.has(t,c)?d.createElement(Ce,{key:n.sets.keys[u],r:n.r,cx:n.cs.cx,cy:n.sets.y(c)+n.sets.cy,name:a.tooltips?c.name:"",style:a.styles.dot,fill:(m=c.color)!==null&&m!==void 0?m:t.color,className:M(`fillPrimary-${a.id}`,a.classNames.dot)}):null}),o.cs.addons.map(c=>d.createElement("g",{key:c.name,transform:`translate(0,${f(c)})`},c.render({set:t,width:n.cs.bandWidth,height:c.size,theme:a.theme}))),l)}),Xn=d.memo(function({d:t,i:r,h:s,className:n,size:o,data:a,style:l,children:i}){const f=ge(t.cardinality,a.sets.max,a.sets.x),c=re(o.sets.w+o.labels.w+o.cs.w,o.sets.addonPadding),u=l.setLabelAlignment==="center"?o.labels.w/2:l.setLabelAlignment==="left"?2:o.labels.w-2;return d.createElement("g",{transform:`translate(0, ${a.sets.y(t)})`,onMouseEnter:s.onMouseEnter(t,o.sets.addons),onMouseLeave:s.onMouseLeave,onClick:s.onClick(t,o.sets.addons),onContextMenu:s.onContextMenu(t,o.sets.addons),onMouseMove:s.onMouseMove(t,o.sets.addons),className:n,"data-cardinality":t.cardinality},l.tooltips&&d.createElement("title",null,t.name,": ",a.sets.format(t.cardinality)),d.createElement("rect",{x:-o.sets.before,width:o.sets.w+o.labels.w+o.cs.w+o.sets.after,height:a.sets.bandWidth,className:`hoverBar-${l.id}`}),r%2===1&&d.createElement("rect",{x:o.sets.w,width:o.labels.w+o.cs.w+o.sets.after,height:a.sets.bandWidth,className:`fillAlternating-${l.id}`}),o.sets.w>0&&d.createElement(d.Fragment,null,f.map((m,p)=>{const g=p>0?Math.floor(a.sets.bandWidth*le[p-1]):0;return d.createElement("rect",{key:p,x:m,y:g,width:o.sets.w-m,height:a.sets.bandWidth-g*2,className:M(`fillPrimary-${l.id}`,p<f.length-1&&`fillOverflow${f.length-1-p}-${l.id}`,l.classNames.bar),style:W(l.styles.bar,t.color)})}),d.createElement("text",{x:f[0],dx:-l.barLabelOffset,y:a.sets.bandWidth/2,style:l.styles.barLabel,className:M(`sBarTextStyle-${l.id}`,l.classNames.barLabel)},a.sets.format(t.cardinality))),d.createElement("text",{x:o.sets.w+u,y:a.sets.bandWidth/2,className:M(`setTextStyle-${l.id}`,l.classNames.setLabel),style:l.styles.setLabel,clipPath:`url(#clip-${o.id})`},t.name),o.sets.addons.map(m=>d.createElement("g",{key:m.name,transform:`translate(${c(m)},0)`},m.render({set:t,width:m.size,height:a.sets.bandWidth,theme:l.theme}))),i)}),zn=d.memo(function({data:t,size:r,style:s,h:n,setChildrenFactory:o,combinationChildrenFactory:a}){return d.createElement("g",{className:n.hasClick?`clickAble-${s.id}`:void 0},d.createElement("g",{transform:`translate(${r.sets.x},${r.sets.y})`,"data-upset":"sets"},t.sets.v.map((l,i)=>d.createElement(Xn,{key:t.sets.keys[i],d:l,i,h:n,className:n.hasClick||n.hasHover?`interactive-${s.id}`:void 0,data:t,style:s,size:r},o&&o(l)))),d.createElement("g",{transform:`translate(${r.cs.x},${r.cs.y})`,"data-upset":"cs"},t.cs.v.map((l,i)=>d.createElement(Zn,{key:t.cs.keys[i],d:l,h:n,className:n.hasClick||n.hasHover?`interactive-${s.id}`:void 0,data:t,style:s,size:r},a&&a(l)))))});function ft({data:e,size:t,style:r,elemOverlap:s,secondary:n,tooltip:o,suffix:a,transform:l,empty:i,combinationAddons:f}){const c=e.cs.bandWidth,u=t.cs.h+t.sets.h,m=t.cs.h,p=M(`fill${a}`,!o&&`pnone-${r.id}`,r.classNames.bar);return d.createElement("g",{transform:l,"data-upset":n?"cs-q":"cs-s"},e.cs.v.map((g,S)=>{const k=e.cs.x(g),w=e.cs.keys[S];if(i&&!n)return d.createElement("rect",{key:w,x:k,y:m,height:0,width:c,className:p,style:W(r.styles.bar,r.selectionColor?void 0:g.color)},o&&d.createElement("title",null));const E=s(g);if(E===0)return null;const b=ge(E,e.cs.max,e.cs.y),$=o&&d.createElement("title",null,`${g.name} ∩ ${o}: ${E}`),v=n?d.createElement("path",{key:w,transform:`translate(${k}, ${b[0]})`,d:`M0,-1 l${c},0 l0,2 l${-c},0 L-${e.triangleSize},-${e.triangleSize} L-${e.triangleSize},${e.triangleSize} Z`,className:p,"data-i":S,"data-cardinality":E,style:W(void 0,r.selectionColor?void 0:g.color)},$):b.map((y,A)=>{const L=A>0?Math.floor(e.cs.bandWidth*le[A-1]):0;return d.createElement("rect",{key:A,x:k+L,y,height:m-y,width:c-L*2,"data-i":A>0?null:S,"data-cardinality":A>0?null:E,className:M(p,A<b.length-1&&`fillOverflow${b.length-1-A}-${r.id}`),style:W(r.styles.bar,r.selectionColor?void 0:g.color)},$)}),h=re(u,t.cs.addonPadding),x=f.map(y=>{const A=h(y),L=y.render({set:g,width:c,height:y.size,theme:r.theme});return L?d.createElement("g",{key:y.name,transform:`translate(${k},${A})`},L):null}).filter(Boolean);return x.length===0?v:d.createElement("g",{key:w},v,x)}))}function mt({data:e,size:t,style:r,elemOverlap:s,suffix:n,secondary:o,empty:a,tooltip:l,setAddons:i,transform:f}){const c=t.sets.w,u=t.sets.w+t.labels.w+t.cs.w,m=e.sets.bandWidth,p=M(`fill${n}`,!l&&` pnone-${r.id}`,r.classNames.bar);return d.createElement("g",{transform:f,"data-upset":o?"sets-q":"sets-s"},e.sets.v.map((g,S)=>{const k=e.sets.y(g),w=e.sets.keys[S];if(a&&!o)return d.createElement("rect",{key:w,x:c,y:k,width:0,height:m,className:p,style:W(r.styles.bar,r.selectionColor?void 0:g.color)},r.tooltips&&l&&d.createElement("title",null));const E=s(g);if(E===0)return null;const b=ge(E,e.sets.max,e.sets.x),$=r.tooltips&&l&&d.createElement("title",null,`${g.name} ∩ ${l}: ${E}`),v=o?d.createElement("path",{key:w,transform:`translate(${b[0]}, ${k+m})`,d:`M1,0 l0,${-m} l-2,0 l0,${m} L-${e.triangleSize},${e.triangleSize} L${e.triangleSize},${e.triangleSize} Z`,"data-i":S,"data-cardinality":E,className:p,style:W(void 0,r.selectionColor?void 0:g.color)},$):b.map((y,A)=>{const L=A>0?Math.floor(e.sets.bandWidth*le[A-1]):0;return d.createElement("rect",{key:A,"data-i":A>0?null:S,"data-cardinality":A>0?null:E,x:y,y:k+L,width:c-y,height:m-L*2,className:M(p,A<b.length-1&&`fillOverflow${b.length-1-A}-${r.id}`),style:W(r.styles.bar,r.selectionColor?void 0:g.color)},$)}),h=re(u,t.sets.addonPadding),x=i.map(y=>{const A=h(y),L=y.render({set:g,width:y.size,height:m,theme:r.theme});return L?d.createElement("g",{key:y.name,transform:`translate(${A},${k})`},L):null}).filter(Boolean);return x.length===0?v:d.createElement("g",{key:w},v,x)}))}const Qe=[],er=d.memo(function({size:t,data:r,style:s,hasHover:n,secondary:o,queries:a}){const l=t.sets.addons.some(c=>c.renderQuery!=null)||t.cs.addons.some(c=>c.renderQuery!=null),i=N.useMemo(()=>a.map(c=>Object.assign(Object.assign({},c),{overlap:Lt(c,"intersection",r.toElemKey),elemOverlap:l?Mt(c,"intersection",r.toElemKey):null})),[a,l,r.toElemKey]);function f(c,u,m,p,g){return Object.assign(Object.assign({},c),{render:S=>{const k=p(S.set);return c.renderQuery?c.renderQuery(Object.assign({query:u,overlap:k,index:m,secondary:g},S)):null}})}return d.createElement("g",{className:n&&!o?`pnone-${s.id}`:void 0},d.createElement("g",{transform:`translate(${t.sets.x},${t.sets.y})`},i.map((c,u)=>d.createElement(mt,{key:c.name,data:r,size:t,style:s,elemOverlap:c.overlap,suffix:`Q${u}-${r.id}`,secondary:o||u>0,tooltip:n&&!(o||u>0)?void 0:c.name,setAddons:t.sets.addons.length===0?Qe:t.sets.addons.map((m,p)=>f(m,c,p,c.elemOverlap,o||p>0))}))),d.createElement("g",{transform:`translate(${t.cs.x},${t.cs.y})`},i.map((c,u)=>d.createElement(ft,{key:c.name,data:r,size:t,style:s,elemOverlap:c.overlap,suffix:`Q${u}-${r.id}`,secondary:o||u>0,tooltip:n&&!(o||u>0)?void 0:c.name,combinationAddons:t.cs.addons.length===0?Qe:t.cs.addons.map((m,p)=>f(m,c,p,c.elemOverlap,o||p>0))}))))});function tr({data:e,size:t,style:r,selection:s}){if(!s||s.type!=="set"||!e.sets.keys.includes(e.toKey(s)))return null;const n=s;return d.createElement("rect",{y:e.sets.y(n),width:t.labels.w+t.cs.w+t.sets.after,height:e.sets.bandWidth,className:`selectionHint-${r.id}`})}function nr({data:e,size:t,style:r,selection:s}){const n=e.sets.bandWidth/2,o=e.cs.cx,a=e.r,l=t.sets.h+t.sets.after,i=e.cs.bandWidth;if(!s||s.type==="set"||!e.cs)return null;const f=s,c=e.cs.keys.indexOf(e.toKey(f));return c<0?null:d.createElement("g",{transform:`translate(${t.labels.w+e.cs.x(f)}, 0)`,"data-upset":"cs-ss","data-i":c},d.createElement("rect",{width:i,height:l,className:`selectionHint-${r.id}`}),f.sets.size>1&&d.createElement("line",{x1:o,y1:e.sets.y(e.sets.v.find(u=>e.cs.has(f,u)))+n-(e.r-1),x2:o,y2:e.sets.y(e.sets.rv.find(u=>e.cs.has(f,u)))+n+(e.r-1),className:`upsetSelectionLine-${e.id}`,style:W(void 0,r.selectionColor?void 0:f.color,"stroke")}),e.sets.v.filter(u=>e.cs.has(f,u)).map(u=>d.createElement(Ce,{key:e.toKey(u),r:a*1.1,cx:o,cy:e.sets.y(u)+n,name:r.tooltips?u.name:"",className:M(`fillSelection-${r.id}`,`pnone-${r.id}`,r.classNames.dot),style:W(r.styles.dot,r.selectionColor?void 0:u.color)})))}const Je=[];function rr({size:e,data:t,style:r,selection:s,hasHover:n}){const o=r.emptySelection,a=Un(s,t.overlapGuesser,t.toElemKey),l=ut(s),i=e.sets.addons.some(u=>u.renderSelection!=null)||e.cs.addons.some(u=>u.renderSelection!=null),f=s&&typeof s!="function"&&i?In(Array.isArray(s)?s:s.elems,t.toElemKey):null;function c(u){return Object.assign(Object.assign({},u),{render:m=>{const p=f?f(m.set):null;return u.renderSelection?u.renderSelection(Object.assign({selection:s,selectionColor:r.selectionColor||m.set.color||"orange",overlap:p},m)):null}})}return d.createElement("g",{className:n?`pnone-${r.id}`:void 0},(s||o)&&d.createElement(ft,{data:t,size:e,style:r,transform:`translate(${e.cs.x},${e.cs.y})`,empty:o&&!s,elemOverlap:a,suffix:`Selection-${r.id}`,tooltip:n?void 0:l,combinationAddons:e.cs.addons.length===0?Je:e.cs.addons.map(c)}),(s||o)&&d.createElement(mt,{data:t,size:e,style:r,transform:`translate(${e.sets.x},${e.sets.y})`,empty:o&&!s,elemOverlap:a,suffix:`Selection-${r.id}`,tooltip:n?void 0:l,setAddons:e.sets.addons.length===0?Je:e.sets.addons.map(c)}),d.createElement("g",{transform:`translate(${e.labels.x},${e.labels.y})`},Ve(s)&&d.createElement(tr,{data:t,size:e,style:r,selection:s}),Ve(s)&&d.createElement(nr,{data:t,size:e,style:r,selection:s})))}function J(e,t="font-size"){return e?`${t}: ${e};`:""}function sr(e,t,r,s){const n=[];t.hasSelectionColor&&n.push(`fill: ${t.hasSelectionColor};`);const o=t.hasSelectionOpacity!=null&&t.hasSelectionOpacity>=0;return o&&n.push(`fill-opacity: ${t.hasSelectionOpacity};`),{p:J,root:`
  .root-${e} {
    ${J(r,"font-family")}
  }
  `,text:`
  .titleTextStyle-${e} {
    fill: ${t.textColor};
    ${J(s.title)}
  }
  .descTextStyle-${e} {
    fill: ${t.textColor};
    ${J(s.description)}
  }

  .legendTextStyle-${e} {
    fill: ${t.textColor};
    ${J(s.legend)}
    text-anchor: middle;
    dominant-baseline: hanging;
    pointer-events: none;
  }
  `,hasSFill:n.join(" "),hasSStroke:n.join(" ").replace("fill:","stroke:").replace("fill-","stroke-"),fill:`
  .fillPrimary-${e} { fill: ${t.color}; fill-opacity: ${t.opacity}; }
  .fillOverflow1-${e} { fill-opacity: ${t.opacity*ce[0]}; }
  .fillOverflow2-${e} { fill-opacity: ${t.opacity*ce[1]}; }
  ${n.length>0?`.root-${e}[data-selection] .fillPrimary-${e} { ${n.join(" ")} }`:""}
  ${o?`
      .root-${e}[data-selection] .fillOverflow1-${e} { fill-opacity: ${t.opacity*ce[0]}; }
      .root-${e}[data-selection] .fillOverflow2-${e} { fill-opacity: ${t.opacity*ce[1]}; }`:""}
  ${t.selectionColor?`.fillSelection-${e} { fill: ${t.selectionColor}; }`:""}
  .fillTransparent-${e} { fill: transparent; }

  .selectionHint-${e} {
    fill: transparent;
    pointer-events: none;
    ${J(t.selectionColor,"stroke")}
  }
  .clickAble-${e} {
    cursor: pointer;
  }

  .startText-${e} {
    text-anchor: start;
  }
  .endText-${e} {
    text-anchor: end;
  }
  .pnone-${e} {
    pointer-events: none;
  }`,export:`
  .exportTextStyle-${e} {
    fill: ${t.textColor};
    ${J(s.exportLabel)}
  }
  .exportButtons-${e} {
    text-anchor: middle;
  }
  .exportButton-${e} {
    cursor: pointer;
    opacity: 0.5;
  }
  .exportButton-${e}:hover {
    opacity: 1;
  }
  .exportButton-${e} > rect {
    fill: none;
    stroke: ${t.textColor};
  }
  `}}function or(e){const t=e.onClick;return N.useMemo(()=>({hasClick:t!=null,hasHover:e.onHover!=null,onClick:fe(t),onMouseEnter:fe(e.onHover),onContextMenu:fe(e.onContextMenu),onMouseLeave:e.onHover?r=>e.onHover(null,r.nativeEvent,[]):void 0,onMouseMove:fe(e.onMouseMove),reset:r=>t?t(null,r.nativeEvent,[]):null}),[t,e.onHover,e.onContextMenu,e.onMouseMove])}const ar=d.forwardRef(function(t,r){var s;const n=it(t),{selection:o=null,queries:a=[],fontSizes:l}=n,i=N.useMemo(()=>n.id?n.id:_e([n.fontFamily,l.axisTick,l.barLabel,l.chartLabel,l.legend,l.setLabel,l.title,l.exportLabel,l.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),[n.id,n.fontFamily,l.axisTick,l.barLabel,l.chartLabel,l.legend,l.setLabel,l.title,l.exportLabel,l.description,n.textColor,n.hoverHintColor,n.color,n.hasSelectionColor,n.selectionColor,n.notMemberColor,n.alternatingBackgroundColor,n.opacity,n.hasSelectionOpacity]),f=N.useMemo(()=>Hn(n.theme,n.styles,n.classNames,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,i,n.barLabelOffset,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment),[n.theme,n.styles,n.classNames,n.barLabelOffset,n.combinationName,n.combinationNameAxisOffset,n.setName,n.setNameAxisOffset,i,n.selectionColor,n.emptySelection,n.title,n.description,n.tooltips,n.setLabelAlignment]),c=N.useMemo(()=>Rn(n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding),[n.width,n.height,n.padding,n.barPadding,n.widthRatios,n.heightRatios,n.setAddons,n.combinationAddons,n.id,n.setAddonPadding,n.combinationAddonPadding]),u=N.useMemo(()=>Fn(n.sets,n.combinations,c,n.numericScale,n.bandScale,n.barLabelOffset+Ke(l.barLabel),n.dotPadding,n.barPadding,Ke(l.axisTick),n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale),[n.sets,n.combinations,c,n.numericScale,n.bandScale,n.barLabelOffset,l.barLabel,n.dotPadding,n.barPadding,l.axisTick,n.combinationAddons,n.toKey,n.toElemKey,n.id,n.setMaxScale,n.combinationMaxScale]),m=sr(i,n,n.fontFamily,l),p=or(n),g=`
  ${m.root}
  ${m.text}

  .axisTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.axisTick)}
    text-anchor: middle;
  }
  .barTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.barLabel)}
  }
  .cBarTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.barLabel)}
    text-anchor: middle;
  }
  .sBarTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.barLabel)}
    text-anchor: end;
    dominant-baseline: central;
  }
  .hoverBarTextStyle-${i} {
    ${m.p(l.barLabel)}
    fill: ${n.hoverHintColor};
    display: none;
    text-anchor: middle;
  }
  .setTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.setLabel)}
    text-anchor: ${Pn(n.setLabelAlignment)};
    dominant-baseline: central;
  }
  .cChartTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.chartLabel)}
    text-anchor: middle;
  }
  .sChartTextStyle-${i} {
    fill: ${n.textColor};
    ${m.p(l.chartLabel)}
    text-anchor: middle;
    dominant-baseline: hanging;
  }

  ${m.fill}
  .fillNotMember-${i} { fill: ${n.notMemberColor}; }
  .fillAlternating-${i} { fill: ${n.alternatingBackgroundColor||"transparent"}; }

  .axisLine-${i} {
    fill: none;
    stroke: ${n.textColor};
  }
  .hoverBar-${i} {
    fill: transparent;
  }

  .interactive-${i}:hover > .hoverBar-${i} {
    stroke: ${n.hoverHintColor};
  }
  .interactive-${i}:hover > .hoverBarTextStyle-${i} {
    display: unset;
  }

  ${m.export}

  .upsetLine-${u.id} {
    stroke-width: ${u.r*.6};
    stroke: ${n.color};
    stroke-opacity: ${n.opacity};
  }
  ${m.hasSStroke?`.root-${i}[data-selection] .upsetLine-${u.id} { ${m.hasSStroke} }`:""}

  .upsetSelectionLine-${u.id} {
    stroke-width: ${u.r*.6*1.1};
    ${m.p(n.selectionColor,"stroke")}
    pointer-events: none;
  }

  ${a.map((w,E)=>`.fillQ${E}-${u.id} {
    fill: ${w.color};
  }`).join(`
`)}
  `,S=N.useCallback(w=>{const E=w.currentTarget.closest("svg"),b=w.currentTarget.dataset.type||"png";switch(b){case"vega":wn(E);break;case"dump":On(E,t,u);break;case"share":Tn(t,u);break;case"svg":case"png":xn(E,{type:b,toRemove:`.${w.currentTarget.getAttribute("class")}`})}},[u,t]),k=ut(o);return d.createElement("svg",{id:n.id,className:M(`root-${i}`,n.className),style:n.style,width:n.width,height:n.height,ref:r,viewBox:`0 0 ${n.width} ${n.height}`,"data-theme":(s=n.theme)!==null&&s!==void 0?s:"light","data-selection":k||void 0},n.styleFactory(g),d.createElement("defs",null,d.createElement("clipPath",{id:`clip-${c.id}`},d.createElement("rect",{x:c.sets.w,y:0,width:c.labels.w,height:c.sets.h}))),n.queryLegend&&d.createElement(Vn,{queries:a,x:c.legend.x,style:f,data:u}),d.createElement(qn,{transform:`translate(${c.w-2},${c.h-3})`,styleId:i,exportButtons:n.exportButtons,exportChart:S}),d.createElement("g",{transform:`translate(${n.padding},${n.padding})`,"data-upset":"base"},n.onClick&&d.createElement("rect",{width:c.cs.x,height:c.sets.y,onClick:p.reset,className:`fillTransparent-${i}`}),d.createElement(Jn,{size:c,style:f,data:u}),d.createElement(zn,{size:c,style:f,data:u,h:p,setChildrenFactory:n.setChildrenFactory,combinationChildrenFactory:n.combinationChildrenFactory}),d.createElement(rr,{size:c,style:f,data:u,hasHover:p.hasHover,selection:o}),d.createElement(er,{size:c,style:f,data:u,hasHover:p.hasHover,queries:a,secondary:n.onHover!=null||o!=null})),t.children)});function Ze({sql:e,variant:t,rgbIndex:r,maxBarCount:s,setName:n,combinationName:o,height:a=700,summaryLinkText:l,summaryLink:i,onClick:f,customPlotColor:c,selectionOpacity:u}){const{accessToken:m}=pt(),[p,g]=N.useState(),[S,k]=N.useState(),[w,E]=N.useState(),[b,$]=N.useState(null),v=vt(),[h,x]=wt(),y={default:{'text[class^="sChartTextStyle-upset-"], text[class^= "cChartTextStyle-upset-"]':{textTransform:"uppercase"}},ampals:{width:"100%","& .selectionHint-upset-":{stroke:"transparent !important"},'& [class^="selectionHint-upset-"]':{stroke:"transparent !important"},'& g[class^="interactive-upset-"]:hover line[class^="upsetLine-"]':{stroke:v.palette.primary.main,strokeWidth:"4px",strokeOpacity:1},'& g[class^="interactive-upset-"]:hover circle[class^="fillNotMember-upset-"]':{opacity:.2},'& line[class^="upsetLine-"]':{strokeOpacity:0},'& rect[class^="fillPrimary-upset-"]':{fill:"url(#diagonalLinePattern)",stroke:v.palette.grey[700],strokeWidth:2},'& circle[class^="fillNotMember-upset-"]':{stroke:v.palette.grey[600],strokeWidth:2},'& text[class^="sChartTextStyle-upset-"], & text[class^="cChartTextStyle-upset-"]':{fontWeight:700,fill:v.palette.grey[800],lineHeight:"150%"},'& text[class^="cChartTextStyle-upset-"]':{transform:"translate(-60px, 190px) rotate(-90deg)"},'& text[class^="sChartTextStyle-upset-"]':{transform:"translate(-10px, 100px) rotate(-90deg)"}}};let A,L;if(r!=null){const{colorPalette:T}=xt(r,2);A=T[0],L=T[0]}else A=v.palette.grey[700],L=c||v.palette.primary.main;const B={setLabel:"14px"};return N.useEffect(()=>{let T=!1;return(async()=>{g(!0);try{const I=gt(e),D={partMask:bt,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:I,query:{sql:e}},{queryResult:F}=await yt.getFullQueryTableResults(D,m),C={},_={};for(const P of(F==null?void 0:F.queryResults.rows)??[])for(let Q=1;Q<P.values.length;Q+=1){const z=P.values;z.some(Se=>Se===null)&&console.warn("Row has null value(s) when no nulls expected");const K=z[0];let Y=z[Q];C[K]=C[K]||{},C[K].name=K,C[K].sets=C[K].sets||[],!C[K].sets.find(Se=>Se==Y)&&Y&&(_[Y.toUpperCase()]?Y=_[Y.toUpperCase()]:_[Y.toUpperCase()]=Y,C[K].sets.push(Y))}const be=Object.values(C),O=Dt(be),R=O.sort((P,Q)=>(""+Q.name).localeCompare(P.name)),X=tt(R,{type:"intersection",min:1,limit:s,order:"cardinality:desc"});T||(k({sets:O,combinations:X}),g(!1))}catch(I){if(!T){g(!1);let U=I.reason;U||(console.error(I),U="Error retrieving data"),E(U)}}})(),()=>{T=!0}},[e,m]),j.jsxs(j.Fragment,{children:[p&&$t,!p&&S&&j.jsxs(j.Fragment,{children:[y.ampals&&j.jsx(Ue,{sx:{"& path":{stroke:"#D9D9D9 !important"},width:0,height:0,position:"absolute"},children:j.jsx(kt,{})}),j.jsxs(Ue,{className:"UpsetPlot",sx:t?y[t]:y.default,ref:x,children:[j.jsx(ar,{sets:S.sets,combinations:S.combinations,width:(h==null?void 0:h.width)||800,height:a,onHover:$,onClick:f,selection:b,color:A,selectionColor:L,hoverHintColor:"orange",hasSelectionOpacity:u||.3,setName:n,combinationName:o,fontFamily:"'DM Sans', sans-serif",fontSizes:B,exportButtons:!1,notMemberColor:"transparent"}),i&&l&&j.jsx("div",{className:"UpsetPlot__summary",children:j.jsx(dt,{color:"secondary",variant:"contained",href:i,children:l})})]})]}),j.jsx(ht,{error:w})]})}try{Ze.displayName="UpsetPlot",Ze.__docgenInfo={description:`Upset plot.  See https://medium.com/@sgratzl/upset-js-javascript-tutorial-1b84bfd6896d
Currently this is driven by a Synapse Table/View, but we may want to alter it to read in the data from a flat file instead.`,displayName:"UpsetPlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},customPlotColor:{defaultValue:null,description:"",name:"customPlotColor",required:!1,type:{name:"string"}},selectionOpacity:{defaultValue:null,description:"",name:"selectionOpacity",required:!1,type:{name:"number"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:'"ampals"'}},maxBarCount:{defaultValue:null,description:"",name:"maxBarCount",required:!1,type:{name:"number"}},setName:{defaultValue:null,description:"",name:"setName",required:!1,type:{name:"string"}},combinationName:{defaultValue:null,description:"",name:"combinationName",required:!1,type:{name:"string"}},height:{defaultValue:{value:"700"},description:"",name:"height",required:!1,type:{name:"number"}},summaryLinkText:{defaultValue:null,description:"",name:"summaryLinkText",required:!1,type:{name:"string"}},summaryLink:{defaultValue:null,description:"",name:"summaryLink",required:!1,type:{name:"string"}}}}}catch{}export{Ze as U};
