import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{q as F}from"./useFiles-BFKs8i28.js";import{O,q as E}from"./VerificationSubmission-CWAFIXEx.js";import{u as Y,A as se}from"./useEntity-D8uQSWkv.js";import"./StringUtils-DBSsSsIU.js";import{S as ne}from"./SynapseConstants-WPaa3dXz.js";import{r as i}from"./index-Dl6G-zuu.js";import"./OrientationBanner-C-7EA0fi.js";import{u as ie,a as re,F as y,b as ae}from"./ForumThreadEditor-D-0Sg3-Z.js";import{u as le,a as de,b as ce}from"./useThread-DtUxFlgD.js";import{a as ue}from"./useSubscription-BtEEOEF3.js";import{f as G}from"./DateFormatter-B6orZn0y.js";import{d as q}from"./dayjs.min-d18Up55D.js";import{M as W,C as me}from"./ConfirmationDialog-w-lkodJ0.js";import{I as r}from"./IconSvg-CmigWBjQ.js";import{W as k}from"./WarningDialog-BUm5QjPr.js";import{d as g}from"./ToastMessage-BXb1aV_x.js";import{U as H}from"./UserBadge-C5POQofa.js";import{S as pe}from"./SkeletonTable-Bfp_IXYb.js";import{B as u}from"./Box-sTghsUmj.js";import{S as he}from"./SubscribersModal-C41bWXee.js";import{B as M}from"./Button-mTo7xxsU.js";import{T as fe}from"./Typography-u5-eOh5K.js";import{T as v}from"./TextField-BJQecJUe.js";const xe=()=>alert("This functionality has not been implemented yet");function _(m){const{reply:t,onClickLink:b=xe}=m,[a,l]=i.useState(!1),[x,p]=i.useState(!1),{data:d}=F(),{data:h}=Y(t.projectId),{data:c,isLoading:C}=ie(t),{mutate:j}=re({onSuccess:()=>{p(!1),g("A reply has been deleted.","info")}}),S=t.createdBy==(d==null?void 0:d.ownerId);return e.jsx("div",{className:"reply-container",children:C?e.jsx(pe,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(H,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{className:"message-body",children:[e.jsx(W,{markdown:c,objectType:O.REPLY}),e.jsxs("span",{children:["posted ",G(q(t.createdOn),"M/D/YYYY")]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",marginTop:{xs:"8px",sm:0},float:{sm:"right"}},children:[e.jsx("button",{onClick:()=>b(),children:e.jsx(r,{icon:"link"})}),S&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(r,{icon:"edit"})}),(h==null?void 0:h.permissions.canModerate)&&e.jsx("button",{onClick:()=>p(!0),children:e.jsx(r,{icon:"delete"})})]})]})]}),e.jsx(y,{isReply:!0,initialText:c,onClose:()=>l(!1),id:t.id,isDialog:!0,openDialog:a}),e.jsx(k,{open:x,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{p(!1)},onConfirm:()=>j({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{_.displayName="DiscussionReply",_.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"(() => void)"}}}}}catch{}const je="You are following this topic. Click to stop following.",ye="You are not following this topic. Click to follow.",ge="You will need to sign in for access to that resource",L="Write a reply...";function A(m){const{threadId:t,limit:b}=m,a="16px",[l,x]=i.useState(!0),[p,d]=i.useState(!1),[h,c]=i.useState(!1),[C,j]=i.useState(!1),[S,w]=i.useState(!1),[P,f]=i.useState(!1),[U,T]=i.useState(!1),[V,X]=i.useState(!1),{threadData:o,threadBody:I,togglePin:z}=le(t),{data:s}=F(),{data:D}=Y((o==null?void 0:o.projectId)??"",void 0,se,{enabled:!!o}),{subscription:N,toggleSubscribed:K,isLoading:J}=ue(t,E.THREAD),{mutate:Q}=de({onSuccess:()=>{w(!1),g("A thread has been deleted.","info")}}),{mutate:Z}=ce({onSuccess:()=>{T(!1),g("A thread has been restored.","info")}}),$=(o==null?void 0:o.createdBy)==(s==null?void 0:s.ownerId);function ee(){if((s==null?void 0:s.userName)=="anonymous")f(!0);else try{K()}catch(n){g(n.reason,"danger")}}const{data:R,hasNextPage:oe,fetchNextPage:te}=ae(t,l,b),B=(R==null?void 0:R.pages.flatMap(n=>n.results))??[];return e.jsxs("div",{className:"DiscussionThread",children:[o&&I?e.jsxs(e.Fragment,{children:[e.jsxs(u,{sx:n=>({textAlign:"center",[n.breakpoints.down("sm")]:{display:"flex",marginBottom:a,button:{whiteSpace:"nowrap"}}}),children:[e.jsx(M,{variant:l?"contained":"outlined",onClick:()=>x(!0),children:"Date Posted"}),e.jsx(M,{variant:l?"outlined":"contained",onClick:()=>x(!1),children:"Most Recent"})]}),e.jsx(H,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs(u,{sx:n=>({[n.breakpoints.down("sm")]:{display:"flex",flexDirection:"column-reverse",marginBottom:a,marginTop:a,".SubscribersModal":{justifyContent:"flex-start",marginBottom:a}}}),children:[e.jsx(fe,{sx:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(he,{id:t,objectType:E.THREAD,showModal:V,handleModal:X})]}),e.jsx("div",{children:e.jsx(W,{markdown:I,objectType:O.THREAD})}),e.jsxs("span",{children:["posted ",G(q(o.createdOn),"M/D/YYYY")]}),e.jsx(y,{isReply:!1,initialText:I,onClose:()=>d(!1),initialTitle:o==null?void 0:o.title,id:t,isDialog:!0,openDialog:p})]}):e.jsx(e.Fragment,{}),e.jsx(u,{sx:{float:"right",margin:{xs:"8px 0",sm:"0 24px 0 0"}},children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>T(!0),children:e.jsx(r,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":N?"Unfollow thread":"Follow thread",disabled:J,onClick:()=>ee(),children:N?e.jsx(r,{icon:"visibility",label:je}):e.jsx(r,{icon:"visibilityOff",label:ye})})}),$&&e.jsx("button",{onClick:()=>d(!0),children:e.jsx(r,{icon:"edit",label:"Edit thread"})}),D!=null&&D.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(!0),children:e.jsx(r,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>z(),children:o!=null&&o.isPinned?e.jsx(r,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(r,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(u,{sx:{mt:2,mb:3},children:h?e.jsx(y,{id:t,isReply:!0,onClose:()=>c(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):c(!0)}})}),e.jsx("div",{children:B.map(n=>e.jsx(_,{reply:n},n.id))}),B.length>0&&e.jsx(u,{sx:n=>({mt:2,mb:3,[n.breakpoints.down("sm")]:{MarkdownEditor:{display:"block"}}}),children:C?e.jsx(y,{id:t,isReply:!0,onClose:()=>j(!1),isDialog:!1}):e.jsx(v,{fullWidth:!0,placeholder:L,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):j(!0)}})}),oe?e.jsx(M,{variant:"outlined",onClick:()=>{te()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(k,{open:S,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>w(!1),onConfirm:()=>o&&Q(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(k,{open:U,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>T(!1),onConfirm:()=>o&&Z(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(me,{open:P,title:"Sign In Required",content:ge,onCancel:()=>f(!1),hasCancelButton:!1,onConfirm:()=>f(!1),confirmButtonProps:{children:"Sign In",className:ne}})]})}try{A.displayName="DiscussionThread",A.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{A as D};
