var I=t=>{throw TypeError(t)};var M=(t,e,s)=>e.has(t)||I("Cannot "+s);var a=(t,e,s)=>(M(t,e,"read from private field"),s?s.call(t):e.get(t)),Q=(t,e,s)=>e.has(t)?I("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),y=(t,e,s,r)=>(M(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(M(t,e,"access private method"),s);import{r as S}from"./index-Dl6G-zuu.js";import{Q as j,a as G,b as J,e as K,c as N,d as T,s as U,f as D,w as V,g as X}from"./useQuery-BiN9FESP.js";import{S as Y,n as B,r as Z,u as $}from"./utils-Bx1BRerw.js";function F(t,e){return t.filter(s=>!e.includes(s))}function W(t,e,s){const r=t.slice(0);return r[e]=s,r}var R,E,w,f,x,C,c,H,P,k,A,L,_,ee=(_=class extends Y{constructor(e,s,r){super();Q(this,c);Q(this,R);Q(this,E);Q(this,w);Q(this,f);Q(this,x);Q(this,C);y(this,R,e),y(this,w,[]),y(this,f,[]),p(this,c,H).call(this,[]),this.setQueries(s,r)}onSubscribe(){this.listeners.size===1&&a(this,f).forEach(e=>{e.subscribe(s=>{p(this,c,A).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,f).forEach(e=>{e.destroy()})}setQueries(e,s,r){y(this,w,e),y(this,x,s),B.batch(()=>{const n=a(this,f),i=p(this,c,k).call(this,a(this,w));i.forEach(h=>h.observer.setOptions(h.defaultedQueryOptions,r));const u=i.map(h=>h.observer),d=u.map(h=>h.getCurrentResult()),g=u.some((h,v)=>h!==n[v]);n.length===u.length&&!g||(y(this,f,u),p(this,c,H).call(this,d),this.hasListeners()&&(F(n,u).forEach(h=>{h.destroy()}),F(u,n).forEach(h=>{h.subscribe(v=>{p(this,c,A).call(this,h,v)})}),p(this,c,L).call(this)))})}getCurrentResult(){return a(this,C)}getQueries(){return a(this,f).map(e=>e.getCurrentQuery())}getObservers(){return a(this,f)}getOptimisticResult(e,s){const r=p(this,c,k).call(this,e),n=r.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[n,i=>p(this,c,P).call(this,i??n,s),()=>r.map((i,u)=>{const d=n[u];return i.defaultedQueryOptions.notifyOnChangeProps?d:i.observer.trackResult(d)})]}},R=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,x=new WeakMap,C=new WeakMap,c=new WeakSet,H=function(e){var s;y(this,E,e),y(this,C,p(this,c,P).call(this,e,(s=a(this,x))==null?void 0:s.combine))},P=function(e,s){return s?Z(a(this,C),s(e)):e},k=function(e){const s=a(this,f),r=new Map(s.map(o=>[o.options.queryHash,o])),n=e.map(o=>a(this,R).defaultQueryOptions(o)),i=n.flatMap(o=>{const O=r.get(o.queryHash);return O!=null?[{defaultedQueryOptions:o,observer:O}]:[]}),u=new Set(i.map(o=>o.defaultedQueryOptions.queryHash)),d=n.filter(o=>!u.has(o.queryHash)),g=o=>{const O=a(this,R).defaultQueryOptions(o);return a(this,f).find(l=>l.options.queryHash===O.queryHash)??new j(a(this,R),O)},h=d.map(o=>({defaultedQueryOptions:o,observer:g(o)})),v=(o,O)=>n.indexOf(o.defaultedQueryOptions)-n.indexOf(O.defaultedQueryOptions);return i.concat(h).sort(v)},A=function(e,s){const r=a(this,f).indexOf(e);r!==-1&&(p(this,c,H).call(this,W(a(this,E),r,s)),p(this,c,L).call(this))},L=function(){B.batch(()=>{this.listeners.forEach(e=>{e(a(this,E))})})},_);function ie({queries:t,...e},s){const r=$(),n=G(),i=J(),u=S.useMemo(()=>t.map(l=>{const m=r.defaultQueryOptions(l);return m._optimisticResults=n?"isRestoring":"optimistic",m}),[t,r,n]);u.forEach(l=>{K(l),N(l,i)}),T(i);const[d]=S.useState(()=>new ee(r,u,e)),[g,h,v]=d.getOptimisticResult(u,e.combine);S.useSyncExternalStore(S.useCallback(l=>n?()=>{}:d.subscribe(B.batchCalls(l)),[d,n]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),S.useEffect(()=>{d.setQueries(u,e,{listeners:!1})},[u,e,d]);const O=g.some((l,m)=>U(u[m],l))?g.flatMap((l,m)=>{const b=u[m];if(b){const z=new j(r,b);if(U(b,l))return D(b,z,i);V(l,n)&&D(b,z,i)}return[]}):[];if(O.length>0)throw Promise.all(O);const q=g.find((l,m)=>{const b=u[m];return b&&X({result:l,errorResetBoundary:i,throwOnError:b.throwOnError,query:r.getQueryCache().get(b.queryHash)})});if(q!=null&&q.error)throw q.error;return h(v())}export{ie as u};
