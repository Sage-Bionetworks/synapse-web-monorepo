import{j as e}from"./jsx-runtime-CmUBiTSS.js";import{l as ye}from"./useFiles-CvqXu3qP.js";import{S as c,R as g}from"./VerificationSubmission-B0kBNeMy.js";import{A as te}from"./ACTAccessRequirement-WDpE4gfi.js";import{M as D,S as L}from"./SelfSignAccessRequirement-C_01XAIc.js";import{T as re}from"./StringUtils-CzgJJW-6.js";import"./OrientationBanner-2QI37Wfz.js";import{r as m}from"./index-B2mmVxOD.js";import{h as qe,g as ge,t as je,r as Re,j as Te,o as xe,v as Ee,w as be}from"./useAccessRequirements-DbP4eG2p.js";import{n as X}from"./noop-DX6rZLP_.js";import{g as Ce}from"./groupBy-C8_vLtxS.js";import{S as Se}from"./StandaloneLoginForm-D5x5Yy8X.js";import{a as Z}from"./DialogBase-BKfMtDP6.js";import{E as Ie}from"./EntityLink-CCT8-yf3.js";import{I as K}from"./IconSvg-C81gJqYD.js";import{U as _e}from"./UserOrTeamBadge-CrQODHxS.js";import{U as ve}from"./UnmanagedACTAccessRequirementItem-Cb7bs5LS.js";import{M as De}from"./MarkdownSynapse-CxoQsrlL.js";import{a as v,R as we}from"./RequirementItem-StXukRWk.js";import{A as j}from"./Alert-B-cn8V0o.js";import{T as h}from"./Typography-BM-M-p3D.js";import{L as ke}from"./Link-C7sf-qNT.js";import{B}from"./Box-B5_L4GWb.js";import{S as Ne}from"./SelfSignAccessRequirementItem-CT6fQS0l.js";import{D as ne}from"./DialogTitle-N3OYp2uu.js";import{S as ae}from"./Stack-nY20Dr3r.js";import{I as ie}from"./IconButton-C2H3UkEd.js";import{D as U,a as $}from"./DialogContent-CuPGSmuZ.js";import{B as w}from"./Button-MnbgKpIJ.js";import{D as Pe}from"./DataAccessRequestAccessorsFilesForm-nYOzQwVK.js";import{R as Fe}from"./ResearchProjectForm-CZoA5pB4.js";import{A as Ve}from"./AuthenticatedRequirement-C7MXO1At.js";import{C as Me}from"./CertificationRequirement-DzDqAkGO.js";import{T as Le}from"./TwoFactorAuthEnabledRequirement-BjQ4ZsH6.js";import{V as Ue}from"./ValidationRequirement-BpUs5hwQ.js";import{s as Oe}from"./DefaultPropsProvider-HrPDOaQj.js";import{D as Be}from"./Dialog-_aWsMVay.js";function G(t){var k,x,N,P,F,V;const{accessRequirement:r,onHide:u,onRequestAccess:d}=t,{data:i}=qe(r.id.toString()),{data:s,isLoading:b}=ge(String(r.id)),{mutate:R}=je({onError:H=>{console.error("Error cancelling data access request",H),l({key:"error",message:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error canceling your data access request."}),e.jsx("br",{}),"Please try again later."]})})}}),[p,T]=m.useState(!0),[a,l]=m.useState(),f=s==null?void 0:s.isApproved;let C=e.jsx(e.Fragment,{});i&&(C=e.jsxs("div",{children:[e.jsx(De,{wikiId:i.wikiPageId,ownerId:i.ownerObjectId,objectType:i.ownerObjectType}),a&&e.jsx(j,{className:"access-requirement-list-alert",severity:a.key,children:a.message}),((k=s==null?void 0:s.currentSubmissionStatus)==null?void 0:k.state)===c.SUBMITTED&&e.jsx(j,{className:"access-requirement-list-alert",severity:"info",children:e.jsx("strong",{children:"You have submitted a data access request."})}),((x=s==null?void 0:s.currentSubmissionStatus)==null?void 0:x.state)===c.APPROVED&&f&&e.jsx(j,{className:"access-requirement-list-alert",severity:"success",children:e.jsx("strong",{children:"Your data access request has been approved."})}),((N=s==null?void 0:s.currentSubmissionStatus)==null?void 0:N.state)===c.APPROVED&&!f&&e.jsx(j,{className:"access-requirement-list-alert",severity:"warning",children:e.jsx("strong",{children:"Your data access request has been revoked."})}),((P=s==null?void 0:s.currentSubmissionStatus)==null?void 0:P.state)===c.REJECTED&&e.jsxs(j,{className:"access-requirement-list-alert",severity:"error",children:[e.jsx(h,{variant:"body1",gutterBottom:!0,children:e.jsx("strong",{children:"Your data access request has been rejected."})}),e.jsx(h,{variant:"body1",gutterBottom:!0,sx:{whiteSpace:"pre-line"},children:(s==null?void 0:s.currentSubmissionStatus.rejectedReason)||""})]}),((F=s==null?void 0:s.currentSubmissionStatus)==null?void 0:F.state)===c.CANCELLED&&e.jsx(j,{className:"access-requirement-list-alert",severity:"info",children:e.jsx(h,{variant:"body1",children:"Your data access request has been canceled."})})]}));const y=[];s&&(s.currentSubmissionStatus==null?(y.push({variant:"outlined",onClick:d,children:"Request access"}),y.push({variant:"text",onClick:u,children:"I do not accept"})):[c.APPROVED,c.REJECTED,c.CANCELLED].includes(s.currentSubmissionStatus.state)?y.push({variant:"outlined",onClick:d,children:"Update Request"}):s.currentSubmissionStatus.state===c.SUBMITTED&&y.push({variant:"outlined",onClick:()=>{R({submissionId:s.currentSubmissionStatus.submissionId,accessRequirementId:String(r.id)})},children:"Cancel Request"}));let q=v.LOADING;if(!b)switch((V=s==null?void 0:s.currentSubmissionStatus)==null?void 0:V.state){case c.APPROVED:q=s!=null&&s.isApproved?v.COMPLETE:v.LOCKED;break;case c.SUBMITTED:q=v.PENDING;break;case c.REJECTED:case c.CANCELLED:default:q=v.LOCKED}return e.jsxs(we,{"data-testid":"ManagedACTAccessRequirementItem",status:q,actions:y,children:[!f&&e.jsx(e.Fragment,{children:C}),f&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{variant:"body1",children:["Your data access request has been approved."," ",e.jsx(ke,{role:"button",onClick:()=>{T(!p)},children:p?"View Terms":"Hide Terms"})]}),!p&&e.jsx(B,{sx:{my:1},children:C})]})]})}try{G.displayName="ManagedACTAccessRequirementItem",G.__docgenInfo={description:`Renders a {@link RequirementItem} for a ManagedACTAccessRequirement, which allows a user to see if they have met the
requirement, and if not, complete a data access request to apply for access.`,displayName:"ManagedACTAccessRequirementItem",props:{accessRequirement:{defaultValue:null,description:"",name:"accessRequirement",required:!0,type:{name:"ManagedACTAccessRequirement"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:"",name:"onRequestAccess",required:!0,type:{name:"() => void"}}}}}catch{}function Q(t){const{accessRequirement:r,subjectId:u,subjectType:d,onHide:i,onRequestAccess:s}=t;switch(r.concreteType){case L:case re:return e.jsx(Ne,{accessRequirement:r,onHide:i});case te:return e.jsx(ve,{accessRequirement:r,onHide:i,subjectId:u,subjectType:d});case D:return e.jsx(G,{accessRequirement:r,onHide:i,onRequestAccess:()=>{s(r)}});default:return console.warn("Unsupported access requirement type:",r.concreteType),e.jsx(e.Fragment,{})}}try{Q.displayName="AccessRequirementListItem",Q.__docgenInfo={description:"Renders an individual AR item for the AccessRequirementList",displayName:"AccessRequirementListItem",props:{accessRequirement:{defaultValue:null,description:"",name:"accessRequirement",required:!0,type:{name:"AccessRequirement"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:"",name:"onRequestAccess",required:!0,type:{name:"(accessRequirement: ManagedACTAccessRequirement) => void"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}function z(t){const{modifiedDataAccessRequest:r,onHide:u}=t,[d,i]=m.useState(),[s,b]=m.useState(!1),{mutate:R}=Re({onSuccess:()=>{u()},onError:T=>{i({key:"error",message:`Sorry, there is an error in submitting your request. ${T.reason?T.reason+".":" "}Please close this dialog and try again later.`}),b(!0)}});function p(){r&&R(r)}return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(ae,{direction:"row",alignItems:"center",gap:"5px",children:["Save Changes",e.jsx(B,{sx:{flexGrow:1}}),e.jsx(ie,{onClick:u,children:e.jsx(K,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsxs(U,{children:[e.jsx(h,{variant:"body1",children:"Would you like to save your recent changes?"}),d&&e.jsx(j,{severity:d.key,children:d.message})]}),e.jsxs($,{children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outlined",onClick:u,children:"Cancel"}),e.jsx(w,{variant:"contained",onClick:()=>{p()},children:"Save changes"})]}),s&&e.jsx(w,{variant:"contained",onClick:u,children:"Close"})]})]})}try{z.displayName="CancelRequestDataAccess",z.__docgenInfo={description:"",displayName:"CancelRequestDataAccess",props:{modifiedDataAccessRequest:{defaultValue:null,description:"",name:"modifiedDataAccessRequest",required:!0,type:{name:"Request | Renewal"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function J(t){const{onHide:r}=t;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(ae,{direction:"row",alignItems:"center",gap:"5px",children:["Your Data Access Request Has Been Submitted",e.jsx(B,{sx:{flexGrow:1}}),e.jsx(ie,{onClick:r,children:e.jsx(K,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsx(U,{children:e.jsx(h,{variant:"body1",children:"Your data access request been submitted and is currently being reviewed. Please allow for up to 2 weeks for your request to be reviewed and approved."})}),e.jsx($,{children:e.jsx(w,{variant:"contained",onClick:r,children:"Finish"})})]})}try{J.displayName="RequestDataAccessSuccess",J.__docgenInfo={description:"",displayName:"RequestDataAccessSuccess",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}const oe=[L,re,D,te],He=new Set(oe),O=Oe(h,{label:"DialogSubsectionHeader"})(({theme:t})=>({marginTop:t.spacing(4),marginBottom:t.spacing(2),paddingBottom:t.spacing(1),fontSize:"18px",fontWeight:"bold",borderBottom:"1px solid",borderColor:t.palette.grey[200]}));O.defaultProps={...O.defaultProps,variant:"h4"};const ee=t=>t.some(Ye),Ye=t=>!He.has(t.concreteType);function se(t){const{onHide:r=X,renderAsModal:u=!1,numberOfFilesAffected:d,requestObjectName:i,customDialogActions:s,onSubmissionCreated:b=X}=t,R="entityId"in t,p="teamId"in t,T="accessRequirementFromProps"in t,a="subjectId"in t?t.subjectId:R?t.entityId:p?t.teamId:void 0,l="subjectType"in t?t.subjectType:R?g.ENTITY:p?g.TEAM:void 0;let{dialogTitle:f="Data Access Request"}=t;const{accessToken:C}=ye(),y=!!C,[q,k]=m.useState(0),[x,N]=m.useState(),[P,F]=m.useState(""),[V,H]=m.useState(),ce=Te(),{data:de}=xe(a,{enabled:a!==void 0&&l===g.TEAM}),{data:ue}=Ee(a,{enabled:a!==void 0&&l===g.ENTITY}),o=(T?t.accessRequirementFromProps:void 0)??ue??de,{data:Y}=be((o??[]).map(n=>String(n.id)),{enabled:!!o,staleTime:1/0}),W=m.useMemo(()=>{if(o&&Y){const n=Ce(o,"concreteType");return oe.map(E=>{const _=n[E];return _?Y.map(M=>_.find(he=>M===String(he.id))):[]}).flat().filter(E=>E!==void 0)}},[Y]),S=n=>{const{managedACTAccessRequirement:I,step:E,researchProjectId:_,dataAccessRequest:M}=n;I&&N(I),_&&F(_),M&&H(M),k(E)},le=o==null?void 0:o.some(n=>n.concreteType===D&&n.isTwoFaRequired),me=o==null?void 0:o.some(n=>(n.concreteType===D||n.concreteType===L)&&n.isCertifiedUserRequired),pe=o==null?void 0:o.some(n=>(n.concreteType===D||n.concreteType===L)&&n.isValidatedProfileRequired),fe=m.useMemo(()=>i||(d?e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:"file",sx:{width:"30px"}})," ",d," ","File(s)"]}):a!==void 0&&l===g.ENTITY?e.jsx(Ie,{entity:a}):l===g.TEAM?e.jsx(_e,{principalId:a}):(console.warn(`Unhandled case for AccessRequirementList requestDetails: ${l}: ${a}`),e.jsx(e.Fragment,{}))),[d,i,a,l]),Ae=[2,1].includes(q)&&ce?"xl":"md";let A=e.jsx(e.Fragment,{});switch(q){case 1:A=e.jsx(Fe,{managedACTAccessRequirement:x,onSave:n=>{S({managedACTAccessRequirement:x,step:2,researchProjectId:n.id})},onHide:r});break;case 2:A=e.jsx(Pe,{researchProjectId:P,managedACTAccessRequirement:x,subjectId:a??"",subjectType:l??g.ENTITY,onHide:r,onCancel:n=>{S({step:3,dataAccessRequest:n})},onSubmissionCreated:n=>{S({step:5}),b(n)},onBackClicked:()=>{S({step:1})}});break;case 3:A=e.jsx(z,{modifiedDataAccessRequest:V,onHide:r});break;case 4:f="Please Log In",A=e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:f,onCancel:r}),e.jsx(U,{className:"AccessRequirementList login-modal ",children:e.jsx(Se,{sessionCallback:()=>{window.location.reload()}})})]});break;case 5:A=e.jsx(J,{onHide:r});break;case 0:default:A=e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:f,onCancel:r}),e.jsxs(U,{children:[e.jsx(O,{sx:{mt:0},children:"What is this request for?"}),e.jsx(h,{variant:"body1",component:"span",children:fe}),e.jsx(O,{children:"What do I need to do?"}),e.jsx(Ve,{}),me&&e.jsx(Me,{}),pe&&e.jsx(Ue,{}),le&&e.jsx(Le,{}),W==null?void 0:W.map(n=>e.jsx(Q,{accessRequirement:n,subjectId:a,subjectType:l,onHide:r,onRequestAccess:I=>{S({managedACTAccessRequirement:I,step:y?1:4})}},n.id))]}),e.jsx($,{children:s||e.jsx(w,{variant:"contained",onClick:r,children:"Close"})})]})}return u?e.jsx(Be,{maxWidth:Ae,fullWidth:!0,open:!0,onClose:r,children:A}):e.jsx(B,{children:A})}try{se.displayName="AccessRequirementList",se.__docgenInfo={description:`The AccessRequirementListV2 component renders a set of {@link AccessRequirement}s (either pre-defined, or those applied
to an entity, based on provided props).

The component shows the user the approval status of each AR and provides a workflow for accepting the terms of or
creating a submission for any of the Access Requirements.`,displayName:"AccessRequirementList",props:{numberOfFilesAffected:{defaultValue:null,description:"",name:"numberOfFilesAffected",required:!1,type:{name:"number"}},requestObjectName:{defaultValue:null,description:"",name:"requestObjectName",required:!1,type:{name:"string"}},renderAsModal:{defaultValue:null,description:"",name:"renderAsModal",required:!1,type:{name:"boolean"}},dialogTitle:{defaultValue:null,description:"",name:"dialogTitle",required:!1,type:{name:"string"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},accessRequirementFromProps:{defaultValue:null,description:"",name:"accessRequirementFromProps",required:!1,type:{name:"AccessRequirement[]"}},customDialogActions:{defaultValue:null,description:"",name:"customDialogActions",required:!1,type:{name:"ReactNode"}},onSubmissionCreated:{defaultValue:null,description:"",name:"onSubmissionCreated",required:!1,type:{name:"(submissionId: string) => void"}},entityId:{defaultValue:null,description:"Fetches the access requirements associated with an entity\n@deprecated Please use `subjectId` and `subjectType`",name:"entityId",required:!0,type:{name:"string"}},teamId:{defaultValue:null,description:"Fetches the access requirements associated with a team\n@deprecated Please use `subjectId` and `subjectType`",name:"teamId",required:!0,type:{name:"string"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}try{ee.displayName="checkHasUnsupportedRequirement",ee.__docgenInfo={description:"",displayName:"checkHasUnsupportedRequirement",props:{}}}catch{}export{se as A,ee as c};
