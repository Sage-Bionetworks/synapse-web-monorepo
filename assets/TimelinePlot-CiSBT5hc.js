import{j as t}from"./jsx-runtime-DBMcmXCa.js";import{K as z,bt as b}from"./useFiles-BCC9o9bm.js";import{p as Q,g as se}from"./SqlFunctions-DnxC6kpb.js";import"./StringUtils-CzgJJW-6.js";import{O as re,i as $}from"./SynapseConstants-D6yJoWPV.js";import{r as y}from"./index-DBlnVwD8.js";import{C as ne,f as oe}from"./VerificationSubmission-B0kBNeMy.js";import"./OrientationBanner-D1D6xyRZ.js";import{g as B}from"./ColorGradient-Zy7TAKxK.js";import{B as g}from"./Box-DJkw5w9G.js";import{T as j}from"./Typography-DqN6Bou9.js";import{d as V}from"./dayjs.min-Dkt-OZPU.js";import{C as ie}from"./CardContainerLogic-Bc8A8USO.js";import{P as ae}from"./Plot-DNuWS543.js";import{D as le}from"./Dialog-CjCgCpc4.js";import{D as ue}from"./DialogContent-BsgajzLU.js";import"./LeftRightPanel-B9OIRSzK.js";import"./LightTooltip-Bh0LtSvU.js";import{S as de}from"./StyledFormControl-Dl7aHdD_.js";import"./WideButton-Bbb_YicD.js";import{s as ce}from"./DefaultPropsProvider-DuMbHCRm.js";import{B as me}from"./Button-CNqVIcaA.js";import{I as pe}from"./InputLabel-aaed7xOD.js";import{S as he}from"./TextField--zXdD2Ho.js";import{M as ve}from"./MenuItem-CzUdFkAE.js";import{S as E}from"./Skeleton-Ci_PYPE4.js";const fe=e=>{const[s,a]=y.useState({width:1,height:2});return y.useEffect(()=>{const c=()=>{if(e.current){const i=e.current.getBoundingClientRect(),{width:l,height:o}=i,r=Math.round(l),n=Math.round(o);(s.width!=r||s.height!=n)&&a({width:r,height:n})}};return c(),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[s.height,s.width,e]),s},ye="species",ge="observationphase",P={queryResult:{queryResults:{headers:[{name:"species",columnType:"STRING",id:"152514"},{name:"observationPhase",columnType:"STRING",id:"197976"},{name:"observationPhaseOrder",columnType:"INTEGER",id:"198102"},{name:"observationTimeMax",columnType:"INTEGER",id:"198103"},{name:"observationTimeUnits",columnType:"STRING",id:"198101"}],rows:[{rowId:9,versionNumber:4,values:["Danio rerio","embryo","1","7","days"]},{rowId:10,versionNumber:4,values:["Danio rerio","larval","2","3","months"]},{rowId:11,versionNumber:4,values:["Danio rerio","juvenile","3","6","months"]},{rowId:12,versionNumber:4,values:["Danio rerio","adult","4","12","months"]},{rowId:16,versionNumber:4,values:["Drosophila","embryo","1","24","hours"]},{rowId:17,versionNumber:4,values:["Drosophila","larval","2","5","days"]},{rowId:18,versionNumber:4,values:["Drosophila","pupal","3","12","days"]},{rowId:19,versionNumber:4,values:["Drosophila","adult","4","5","weeks"]},{rowId:1,versionNumber:4,values:["Mus musculus","prenatal","1","21","days"]},{rowId:2,versionNumber:4,values:["Mus musculus","postnatal","2","6","months"]},{rowId:20,versionNumber:4,values:["Rattus norvegicus","prenatal","1","23","days"]},{rowId:21,versionNumber:4,values:["Rattus norvegicus","neonatal","2","4","weeks"]},{rowId:22,versionNumber:4,values:["Rattus norvegicus","weanling","3","2","months"]},{rowId:23,versionNumber:4,values:["Rattus norvegicus","juvenile","4","3","months"]},{rowId:24,versionNumber:4,values:["Rattus norvegicus","adolescent","5","6","months"]},{rowId:25,versionNumber:4,values:["Rattus norvegicus","adult","6","12","months"]},{rowId:13,versionNumber:4,values:["Saccharomyces","log phase","1","7","days"]},{rowId:14,versionNumber:4,values:["Saccharomyces","stationary phase","2","2","weeks"]},{rowId:15,versionNumber:4,values:["Saccharomyces","death phase","3","3","weeks"]},{rowId:3,versionNumber:4,values:["Sus scrofa","prenatal","1","115","days"]},{rowId:4,versionNumber:4,values:["Sus scrofa","neonatal","2","3","months"]},{rowId:5,versionNumber:4,values:["Sus scrofa","weanling","3","6","months"]},{rowId:6,versionNumber:4,values:["Sus scrofa","juvenile","4","12","months"]},{rowId:7,versionNumber:4,values:["Sus scrofa","adolescent","5","2","years"]},{rowId:8,versionNumber:4,values:["Sus scrofa","adult","6","3","years"]}]}}};var D;const xe=(D=P.queryResult)==null?void 0:D.queryResults.headers.findIndex(e=>e.name.toLowerCase()===ye);var H;const O=(H=P.queryResult)==null?void 0:H.queryResults.headers.findIndex(e=>e.name.toLowerCase()===ge),q=({color:e,phaseName:s})=>t.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:"7px"},children:[t.jsx(g,{sx:{backgroundColor:e,width:"20px",height:"20px"}}),t.jsx(j,{variant:"body1",children:s==null?void 0:s.toUpperCase()})]});try{q.displayName="TimelineLegendItem",q.__docgenInfo={description:"",displayName:"TimelineLegendItem",props:{color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},phaseName:{defaultValue:null,description:"",name:"phaseName",required:!0,type:{name:"string"}}}}}catch{}const Ie=(e,s,a,c)=>{let i=-1;return{timepoints:s.map((o,r)=>{const n=parseFloat(o.values[a.observationTime]),u=o.values[a.observationTimeUnits];return o.rowId==c&&(i=r),e.add(n,u)}),hoverOverIndex:i}},M=e=>e.length==0?V().add(1,"days"):e.reduce((s,a)=>!s||a.isAfter(s)?a:s),be=(e,s)=>{if(e.timepoints==null||e.timepoints.length==0)return[{x:[V().format()],y:[.5],mode:"lines",line:{color:"blue",width:2},customdata:[],hoverinfo:"none"}];const a=e.timepoints.reduce((i,l,o)=>{const r=i;return r[l.format()]||(r[l.format()]=[]),r[l.format()].push(s[o]),i},{});return e.timepoints.map((i,l)=>{const o=i.format(),r=l==e.hoverOverIndex,u=a[o].map(m=>m.rowId);return{x:[o,o,o],y:[0,.5,1],mode:"lines",line:{color:r?"black":"gray",width:r?2:1},customdata:[u,u,u],hoverinfo:"none"}})},Te=(e,s,a,c,i,l)=>{const o=c.map(n=>n.x[0]),r=c.map(n=>{const u=n.customdata[0];if(u&&u.length>0){const m=u.length,p=i==null?void 0:i.filter(h=>u[0]==h.rowId);if(p&&p.length>0){const h=p[0],v=parseFloat(h.values[l.observationTime]),T=h.values[l.observationTimeUnits],d=m>1?`(${m})`:"";return`${v} ${T} ${d}`}}return""});return{hovermode:"closest",dragmode:!1,showlegend:!1,xaxis:{showgrid:!1,showticklabels:!0,showline:!1,zeroline:!1,tickvals:o,ticktext:r,tickangle:-45},yaxis:{range:[0,1.25],showgrid:!1,zeroline:!1,showline:!1,showticklabels:!1},shapes:[{type:"rect",x0:e.subtract(s.diff(e)/10).format(),x1:s.add(s.diff(e)/3).format(),y0:.25,y1:.75,fillcolor:a,opacity:.8,line:{width:0}}],margin:{l:0,r:0,t:60,b:60}}},C=({color:e,rowData:s,schema:a,widthPx:c,sql:i})=>{const[l,o]=y.useState(),[r,n]=y.useState(),[u,m]=y.useState(1),p=V(),h=y.useRef(null),v=l==null?void 0:l.points[0].customdata,T=s==null?void 0:s.filter(x=>v==null?void 0:v.includes(x.rowId)),d=r==null?void 0:r.points[0].customdata,N=y.useMemo(()=>Ie(p,s,a,(d==null?void 0:d.length)>0?d[0]:void 0),[d,s,a,p]),f=M(N.timepoints),S=y.useMemo(()=>be(N,s),[N,s]),R=T.map(x=>x.rowId);return t.jsxs("div",{ref:h,style:{width:c},children:[t.jsx(ae,{style:{width:c,height:"220px"},data:S,layout:Te(p,f,e,S,s,a),config:{displayModeBar:!1},useResizeHandler:!0,onClick:x=>{o(x),n(void 0)},onDoubleClick:()=>{m(u+1)},onHover:x=>{n(x)},onUnhover:()=>{n(void 0)}},`Plot-${e}-${u}`),t.jsx(le,{onClose:()=>o(void 0),open:T&&T.length>0,children:t.jsx(ue,{children:t.jsx(ie,{topLevelEnumeratedFacetToFilter:{columnName:"observationType"},sql:i,searchParams:{ROW_ID:R.map(String).join(",")},sqlOperator:ne.IN,lockedColumn:{columnName:"ROW_ID"},cardConfiguration:{type:re},initialLimit:3})})})]})};try{M.displayName="getMaxDate",M.__docgenInfo={description:"",displayName:"getMaxDate",props:{}}}catch{}try{C.displayName="TimelinePhase",C.__docgenInfo={description:"",displayName:"TimelinePhase",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"Row[]"}},schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},widthPx:{defaultValue:null,description:"",name:"widthPx",required:!0,type:{name:"number"}},sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const F=ce(me,{label:"InputSizedButton"})(({theme:e})=>({height:"calc(1.4375em + 33px)",marginTop:e.spacing(3),marginBottom:e.spacing(1.5)}));try{F.displayName="InputSizedButton",F.__docgenInfo={description:"",displayName:"InputSizedButton",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"Ref<HTMLButtonElement>"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const L=({sql:e,additionalFilters:s,species:a,setSpecies:c})=>{var m,p;const i=Q(e),l=z({entityId:i,query:{sql:`SELECT distinct unnest(species) FROM ${i} WHERE species IS NOT NULL AND observationTime IS NOT NULL GROUP BY species`,additionalFilters:s},partMask:$,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o,isLoading:r}=l,n=(p=(m=o==null?void 0:o.queryResult)==null?void 0:m.queryResults)==null?void 0:p.rows,u=n&&n.length>0?n[0].values[0]:void 0;return a==null&&u!=null&&c(u),r||!n||n.length<2?t.jsx(t.Fragment,{}):t.jsx(g,{children:t.jsxs(de,{children:[t.jsx(pe,{children:"Species"}),t.jsx(he,{sx:{marginLeft:"2px",marginBottom:"2px"},value:a,label:"Species",onChange:h=>{c(h.target.value)},children:n==null?void 0:n.map(h=>{const v=h.values[0];return t.jsx(ve,{value:v,children:v},v)})})]})})};try{L.displayName="TimelinePlotSpeciesSelector",L.__docgenInfo={description:"",displayName:"TimelinePlotSpeciesSelector",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},additionalFilters:{defaultValue:null,description:"",name:"additionalFilters",required:!1,type:{name:"QueryFilter[]"}},species:{defaultValue:null,description:"",name:"species",required:!1,type:{name:"string"}},setSpecies:{defaultValue:null,description:"",name:"setSpecies",required:!0,type:{name:"Dispatch<SetStateAction<string>>"}}}}}catch{}const Ne="observationphase",_e="observationtime",Se="observationtimeunits",we="observationsubmittername",Re="observationtext",Ee="observationtype",Oe="synapseid",je="doi",k=({sql:e,searchParams:s,sqlOperator:a,defaultSpecies:c,title:i,subTitle:l})=>{const o=Q(e),[r,n]=y.useState(c),u=y.createRef(),m=fe(u),p=se(s,a)??[],h=r?{columnName:"species",concreteType:"org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",values:[r],function:oe.HAS}:void 0,v=[...p];h&&v.push(h);const T=z({entityId:o,query:{sql:`${e} WHERE observationTime IS NOT NULL`,sort:[{column:"observationTime",direction:"ASC"}],additionalFilters:v},partMask:$,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"},{enabled:!!r}),{data:d,isLoading:N}=T,f=y.useMemo(()=>{var I;if(r)return(I=P.queryResult)==null?void 0:I.queryResults.rows.filter(_=>_.values[xe]==r)},[r]);if(N)return t.jsx(qe,{});const S=b(Ne,d),R=b(_e,d),x=b(Se,d),G=b(we,d),W=b(Re,d),K=b(je,d),Y=b(Ee,d),X=b(Oe,d),J={observationSubmitterName:G,synapseId:X,observationType:Y,observationText:W,observationTime:R,observationTimeUnits:x,doi:K},Z=m.width&&f?m.width/f.length:0,ee=f==null?void 0:f.map(()=>"auto").join(" ");return t.jsxs(t.Fragment,{children:[r&&t.jsxs(t.Fragment,{children:[i&&t.jsx(j,{variant:"h2",children:i}),l&&t.jsx(j,{variant:"body1Italic",sx:{margin:"10px 0px"},children:l})]}),t.jsxs(g,{children:[t.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(g,{children:!c&&t.jsx(L,{setSpecies:n,species:r,sql:e,additionalFilters:p})}),f&&t.jsx(g,{sx:{display:"flex",justifyContent:"flex-end",gap:"25px"},children:f.map((I,w)=>{const{colorPalette:_}=B(w,1);return t.jsx(q,{color:_[0],phaseName:I.values[O]},I.rowId)})})]}),r&&f&&t.jsx("div",{ref:u,children:t.jsx(g,{sx:{display:"inline-grid",gridTemplateColumns:ee,minWidth:m.width,maxWidth:m.width},className:"forcePlotlyDefaultCursor",children:f.map((I,w)=>{var U;const{colorPalette:_}=B(w,1),A=(U=d==null?void 0:d.queryResult)==null?void 0:U.queryResults.rows.filter(te=>te.values[S]==I.values[O]);return A?t.jsx(C,{name:I.values[O],color:_[0],rowData:A,schema:J,widthPx:Z,sql:e},I.rowId):t.jsx(t.Fragment,{})})})})]})]})},qe=()=>t.jsxs(g,{children:[t.jsxs(g,{sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[t.jsx(E,{height:"45px",width:"80px"}),t.jsx(E,{height:"45px",width:"80px"})]}),t.jsx(g,{sx:{display:"flex"},children:t.jsx(E,{height:"150px",width:"100%"})})]});try{k.displayName="TimelinePlot",k.__docgenInfo={description:"",displayName:"TimelinePlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"SQLOperator"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!1,type:{name:"string"}},defaultSpecies:{defaultValue:null,description:"",name:"defaultSpecies",required:!1,type:{name:"string"}}}}}catch{}export{F as I,k as T};
