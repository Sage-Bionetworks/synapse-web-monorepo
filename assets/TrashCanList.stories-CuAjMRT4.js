import{aI as I,ao as x,aJ as R,ab as C,r as c,j as t,hg as D,Y as f,dZ as L,c5 as P,W as N,B as p,di as Q,dH as q,dG as K}from"./iframe-BoCRNbsR.js";import{u as z}from"./useInfiniteQuery-C7o_Dqt1.js";import{g as V}from"./InfiniteQueryUtils-CKlRW-xB.js";import{u as H,S as O,c as Y,g as A}from"./StyledTanStackTable-DgwHrcdI.js";import{C as W,a as G}from"./EntityHeaderTableCellRenderers-CAdYxX2T.js";import{E as _}from"./EntityLink-Co1VwZuj.js";import{W as J}from"./WarningDialog-BCV9qnW8.js";import"./index-Chi_LkuB.js";import"./StyledTableContainer-Do81XGd2.js";import"./ExpandCollapseButton-DgGO83jR.js";import"./index-HMHqnHnT.js";import"./Checkbox-DV0KOIC_.js";import"./SwitchBase-DMiiRzXA.js";import"./useEntity-BLxQdrE1.js";import"./pickBy-6pkKX37b.js";import"./isString-1YX391PZ.js";import"./_baseIteratee-CTfPkNe8.js";import"./useQueries-DDvkrzrG.js";import"./useSuspenseQuery-BPlGfXJb.js";import"./useEntityBundle-anaddiS5.js";import"./useGetEntityHeaders-Bu0sna_E.js";import"./EntityIcon-BETcrj3P.js";import"./ErrorChip-CB9VFob9.js";import"./Chip-BpnG7Xon.js";import"./ConfirmationDialog-DXOTVrB0.js";import"./DialogBase-BB6caHGd.js";import"./Close-DsrOrIhe.js";import"./HelpPopover-_vX2Eq3R.js";import"./MarkdownPopover-CTLC6eAI.js";import"./LightTooltip-BeuPdc0Y.js";import"./MarkdownSynapse-DncFydPI.js";import"./SkeletonButton-DmCSxkyJ.js";import"./SkeletonInlineBlock-C7NJLvZR.js";import"./SkeletonTable-COyqVKjD.js";import"./SkeletonParagraph-DoTSC7_a.js";function Z(r){const{accessToken:e,keyFactory:i}=x();return z({...r,queryKey:i.getTrashCanItemsQueryKey(),queryFn:l=>C.getItemsInTrashCan(e,l.pageParam),initialPageParam:void 0,getNextPageParam:V})}function U(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.restoreFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function X(r){const e=I(),{accessToken:i,keyFactory:l}=x();return R({...r,mutationFn:a=>{typeof a=="string"&&(a=new Set([a]));const s=Array.from(a).map(o=>C.purgeFromTrashCan(o,i));return Promise.allSettled(s)},onSuccess:async(a,s,o)=>{await e.invalidateQueries({queryKey:l.getTrashCanItemsQueryKey()}),r?.onSuccess&&await r.onSuccess(a,s,o)}})}function $(r){return r.filter(e=>e.status==="rejected").map(e=>e.reason)}const m=Y();function ee(r){return[{id:"select",header:G,cell:W,maxSize:50},m.accessor("entityId",{header:"ID"}),m.accessor("entityName",{header:"Name"}),m.accessor("entityType",{header:"Entity Type",cell:e=>Q(e.getValue())}),m.accessor("originalParentId",{header:"Location",cell:e=>t.jsxs(t.Fragment,{children:[e.getValue()&&t.jsx(_,{entity:e.getValue()})," (",e.getValue(),")"]}),size:200}),m.accessor("deletedOn",{header:"Deleted On",cell:e=>q(K(e.getValue()))}),{id:"restoreButton",header:"",cell:({row:e})=>t.jsx(p,{size:"small",variant:"outlined",onClick:()=>{r(e.original.entityId),e.toggleSelected(!1)},children:"Restore"}),maxSize:100}]}function te(){const[r,e]=c.useState(!1),[i,l]=c.useState([]),[a,s]=c.useState({});function o(n,w){n?l($(n)):w&&l([w]),s({})}const{mutate:y,isPending:b}=U({onSettled:o}),{mutate:k,isPending:S}=X({onSettled:o}),v=b||S,{data:T,isLoading:g,hasNextPage:F,fetchNextPage:E,isFetchingNextPage:M}=Z({throwOnError:!0}),h=c.useMemo(()=>T?.pages.flatMap(n=>n.results)??[],[T]),B=c.useMemo(()=>ee(n=>{y(n)}),[y]),j=H({data:h,columns:B,state:{rowSelection:a},getRowId:n=>n.entityId,enableRowSelection:!0,onRowSelectionChange:s,getCoreRowModel:A(),columnResizeMode:"onChange"}),u=j.getSelectedRowModel().rows.map(n=>n.original.entityId);return t.jsxs("div",{children:[t.jsx(D,{show:v,headlineText:S?"Deleting...":"Restoring..."}),t.jsx(f,{variant:"body1",children:'The trash can contains items that were recently deleted. You can recover deleted items in the trash can by clicking "Restore". Items will remain in the trash can for 30 days before being automatically purged.'}),t.jsx(J,{title:"Delete selected items from your Trash?",content:t.jsx(f,{variant:"body1",children:"You can't undo this action."}),confirmButtonText:"Delete",confirmButtonColor:"error",onConfirm:()=>{k(u),e(!1)},onCancel:()=>{e(!1)},open:r}),g&&t.jsx(L,{}),!g&&h.length===0&&t.jsx(P,{severity:"info",sx:{my:2},children:t.jsx(f,{variant:"body1",children:"Your trash can is currently empty."})}),!g&&h.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(O,{table:j,styledTableContainerProps:{sx:{my:4}}}),i.length>0&&t.jsxs(P,{severity:"error",sx:{mb:1},children:["The following errors were encountered:",t.jsx("ul",{style:{marginBottom:0},children:i.map(n=>t.jsx("li",{children:n.message},n.message))})]}),t.jsxs(N,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[F&&t.jsx(p,{variant:"contained",disabled:M,onClick:()=>{E()},children:"Load More"}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(p,{variant:"contained",color:"error",disabled:u.length===0,onClick:()=>{e(!0)},children:"Delete Selected"}),t.jsx(p,{variant:"outlined",disabled:u.length===0,onClick:()=>{y(u)},children:"Restore Selected"})]})]})]})}const Qe={title:"Synapse/TrashCanList",component:te},d={};d.parameters={...d.parameters,docs:{...d.parameters?.docs,source:{originalSource:"{}",...d.parameters?.docs?.source}}};const qe=["TrashCan"];export{d as TrashCan,qe as __namedExportsOrder,Qe as default};
