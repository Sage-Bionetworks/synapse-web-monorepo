import{j as e,X as S,B,al as re,di as L,d0 as oe,_ as W,r as a,J as F,ca as ae,bV as ce,dj as le,cd as de,cc as N,gW as ue,ag as pe,ay as fe,c8 as k,c4 as he,ct as me,cu as ye,c7 as q,c9 as ge}from"./iframe-BSxjDfu3.js";import{C as Ie}from"./ConfirmCloseWithoutSavingDialog-SvO6ZqBA.js";import{b as Ae,A as Se,u as Ce}from"./useEntityBundle-CkG6Qytw.js";import{C as Ee}from"./ConfirmationDialog-BqzMQSuY.js";import{a as _e,b as be,c as Le,d as Ne}from"./useEntity-KS5kNauW.js";import{d as ve,f as je}from"./useUserBundle-CJruWbUT.js";import{r as Te}from"./AccessControlListUtils-B1bY8X4-.js";import{a as we,A as xe}from"./AclEditor-DvdMPYnh.js";import{u as Pe}from"./useUpdateAcl-DmudfqxY.js";import{u as De}from"./useGetEntityHeaders-Cl7fVQKr.js";import{E as H}from"./EntityLink-CijL3lfy.js";import{O as Ue}from"./OpenData-BaryZ3ej.js";import{u as Re}from"./useMessage-BDv3TgO6.js";import{u as Oe}from"./UserBadge-GA8Aaaz5.js";function Ve(t,s){return t?s?` (${t})`:t:""}function Ge(t,s,r){let n="",i=!1;return t&&(n+=t.trim(),i=!0),s&&(n+=" "+s.trim(),i=!0),n+=Ve(r,i),n}function Be(t){return Ge(t.firstName,t.lastName,t.userName)}const ke="Create local sharing settings",qe="Delete local sharing settings";function j(t){const{isInherited:s,setIsInherited:r}=t;return s?e.jsxs("div",{children:[e.jsx(S,{variant:"body1",sx:{mt:2,mb:1},children:"Sharing settings are initially inherited from the parent folder or project by default. To customize settings for a specific file, folder, or table, you must create and adjust local sharing settings."}),e.jsx(B,{variant:"contained",size:"small",color:"success",startIcon:e.jsx(re,{icon:"add",wrap:!1}),onClick:()=>r(!1),children:ke})]}):e.jsxs("div",{children:[e.jsx(S,{variant:"body1",sx:{mt:2,mb:1},children:"The sharing settings will be inherited from the parent folder or project if local sharing settings are deleted."}),e.jsx(B,{variant:"outlined",size:"small",color:"error",onClick:()=>r(!0),children:qe})]})}try{j.displayName="CreateOrDeleteLocalSharingSettingsButton",j.__docgenInfo={description:"",displayName:"CreateOrDeleteLocalSharingSettingsButton",props:{isInherited:{defaultValue:null,description:"",name:"isInherited",required:!0,type:{name:"boolean"}},setIsInherited:{defaultValue:null,description:"",name:"setIsInherited",required:!0,type:{name:"(isInherited: boolean) => void"}}}}}catch{}function T(t){const{isProject:s,isInherited:r,isAfterUpload:n=!1,benefactorId:i}=t,{data:u}=De(i,void 0,{enabled:!!i});return n?e.jsxs(e.Fragment,{children:[e.jsxs(S,{variant:"body1",children:["Currently, the sharing settings are inherited from the"," ",u?L(oe(u.type)).toLowerCase():"container"," ","named",i?e.jsxs(e.Fragment,{children:[" ",e.jsx(H,{entity:i})," "]}):"",". If you wish to customize settings for a particular file, folder, or table, you must establish ",e.jsx("strong",{children:"Local Sharing Settings"})," to make modifications."]}),e.jsxs(S,{variant:"body1",children:["After uploading, choose the file you want to customize sharing settings for, then navigate to File Tools >"," ",e.jsx(W,{href:"https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html",children:"File Sharing Settings"}),"."]})]}):s?e.jsx(S,{variant:"body1",children:"The sharing settings shown below apply to this project and are inherited by all project contents unless local sharing settings have been set."}):r?e.jsxs(S,{variant:"body1",children:["The sharing settings shown below are currently being inherited"," ",i?e.jsxs(e.Fragment,{children:["from ",e.jsx(H,{entity:i})," "]}):"","and cannot be modified here."]}):e.jsxs(S,{variant:"body1",children:["The local sharing settings shown below are ",e.jsx("strong",{children:"not"})," being inherited from a parent resource."]})}try{T.displayName="InheritanceMessage",T.__docgenInfo={description:"",displayName:"InheritanceMessage",props:{isProject:{defaultValue:null,description:"",name:"isProject",required:!0,type:{name:"boolean"}},isInherited:{defaultValue:null,description:"",name:"isInherited",required:!0,type:{name:"boolean"}},isAfterUpload:{defaultValue:null,description:"",name:"isAfterUpload",required:!1,type:{name:"boolean"}},benefactorId:{defaultValue:null,description:"",name:"benefactorId",required:!1,type:{name:"string"}}}}}catch{}function He(t,s,r,n){const i=s.some(o=>t===o.principalId),u=r.isIndividual,h=String(t)===n,p=ae.includes(t);return!i&&u&&!h&&!p}function Me(t){const{subject:s,body:r,initialResourceAccessList:n,newResourceAccessList:i}=t,{data:u,isLoading:h}=ve(),{data:p,isLoading:o}=Oe(i.map(f=>String(f.principalId))),g=h||o,{mutate:m,isPending:l}=Re({onError:f=>{F(`New users couldn't be notified: ${f.reason}`)}});return{sendNotification:a.useCallback(()=>{if(g){console.error("Attempted to send notification before user profile or user group headers were loaded. This should never happen.");return}const f=i.filter(y=>{const d=p.find(c=>c.ownerId===String(y.principalId));return He(y.principalId,n,d,u.ownerId)}).map(y=>String(y.principalId));f.length>0&&m({subject:s,body:r,recipients:f})},[r,u,n,g,i,m,s,p]),isPending:l,isLoading:g}}const We=["CAN_VIEW","CAN_DOWNLOAD","CAN_EDIT","CAN_EDIT_DELETE","CAN_ADMINISTER"];function Fe(t){return`${t} (shared on Synapse)`}function $e(t,s){return`${Be(t)} has shared an item with you on Synapse:
${me(ye.PORTAL_ENDPOINT)}Synapse:${s}`}function ze(t,s,r){return!t||s?!1:n=>{const i=r.ownerId===String(n.principalId),u=n.principalId===N;return!(i||u)}}function Ye(t,s,r){return!t||s?!1:n=>r.ownerId===String(n.principalId)?!1:t}function Ke(t){return s=>{if(s.principalId===N)return t?q.CAN_DOWNLOAD:q.CAN_VIEW}}const w=a.forwardRef(function(s,r){const{entityId:n,onCanSaveChange:i,onUpdateSuccess:u,isAfterUpload:h=!1}=s,{data:p}=je(),{data:o}=Ae(n,void 0,Se,{staleTime:1/0}),g=le.project==o.entityType,{data:m}=_e(o.entity.parentId,{staleTime:1/0}),l=o.benefactorAcl.resourceAccess,E=a.useMemo(()=>m?.resourceAccess??[],[m]),f=o.permissions.canChangePermissions,y=o.permissions.isEntityOpenData,d=o.benefactorAcl.id!=n,[c,x]=a.useState(d),[P,$]=a.useState(!1),[D,z]=a.useState(),{resourceAccessList:I,setResourceAccessList:_,addResourceAccessItem:U,updateResourceAccessItem:Y,removeResourceAccessItem:K,resetDirtyState:C}=Pe({initialResourceAccessList:l});a.useEffect(()=>{l&&(C(),_([...l]))},[l,C,_]),a.useEffect(()=>{C(),x(d)},[d,C]),a.useEffect(()=>{d==c?_(l):c&&_(E),C()},[d,l,E,C,_,c]);const J=I.some(A=>[de,N,ue].includes(A.principalId)),{sendNotification:X,isLoading:Q,isPending:Z}=Me({subject:Fe(o.entity.name||""),body:$e(p,n),initialResourceAccessList:l,newResourceAccessList:I}),v={onSuccess:()=>{P&&X(),u()},onError:A=>{z(A)}},{mutate:R,isPending:ee}=be(v),{mutate:O,isPending:te}=Le(v),{mutate:V,isPending:se}=Ne(v),ne=ee||te||se||Z,G=a.useMemo(()=>d!=c||!Te(l,I),[l,d,c,I]),b=G||Q||ne,ie=G&&h;return a.useEffect(()=>{i(b)},[i,b]),a.useImperativeHandle(r,()=>({save(){b?d!=c?c?V(n):R({id:n,resourceAccess:I}):O({...o.accessControlList,resourceAccess:I}):console.error("EntityAclEditor: save() called but canSave is false")}}),[b,R,V,o,n,d,O,c,I]),e.jsxs(pe,{sx:{gap:2},children:[e.jsx(Ue,{isOpenData:y,isPublic:J,currentUserCanUpdateSharingSettings:f}),e.jsx(T,{isProject:g,isInherited:c,benefactorId:c?m?.id:n,isAfterUpload:h}),ie&&e.jsx(fe,{isGlobal:!1,variant:"warning",title:`Edits will affect settings of entire ${L(o?.entityType).toLowerCase()}.`,description:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Editing the settings here will impact the sharing settings for all files and folders within this"," ",L(o?.entityType).toLowerCase(),", not just the ones you've recently uploaded."]}),e.jsxs("p",{children:["View the instructions above for setting your"," ",e.jsx(W,{href:"https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html",target:"_blank",children:"Local Sharing Settings"}),"."]})]})}),e.jsx(xe,{isInherited:c,canEdit:ze(f,c,p),canRemoveEntry:Ye(f,c,p),resourceAccessList:I,availablePermissionLevels:We,emptyText:"",displayedPermissionLevelOverride:Ke(y),onAddPrincipalToAcl:A=>{A===N?U(A,k("CAN_VIEW")):U(A,k("CAN_DOWNLOAD"))},updateResourceAccessItem:Y,removeResourceAccessItem:K,showNotifyCheckbox:!0,notifyCheckboxValue:P,onNotifyCheckboxChange:$,showAddRemovePublicButton:!0}),!h&&!g&&o.permissions.canEnableInheritance&&e.jsx(j,{isInherited:c,setIsInherited:x}),D&&e.jsx(he,{severity:"error",children:D.message})]})}),Je=a.forwardRef(function(s,r){return e.jsx(ce,{children:e.jsx(a.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(w,{...s,ref:r})})})});try{w.displayName="EntityAclEditor",w.__docgenInfo={description:"",displayName:"EntityAclEditor",props:{entityId:{defaultValue:null,description:"The ID of the entity on which to view/edit the ACL. Note that the ACL may actually belong to an entity ancestor (benefactor).",name:"entityId",required:!0,type:{name:"string"}},onCanSaveChange:{defaultValue:null,description:"Invoked when the user can/cannot save the pending changes.",name:"onCanSaveChange",required:!0,type:{name:"(canSaveChanges: boolean) => void"}},onUpdateSuccess:{defaultValue:null,description:"Invoked when changes are successfully made.",name:"onUpdateSuccess",required:!0,type:{name:"() => void"}},isAfterUpload:{defaultValue:null,description:`Special case to show specific copy and allow changes to an inherited ACL immediately after a file is uploaded.
Note that if this is true, the entityId should be the ID of the folder or project that is the benefactor of the newly uploaded file(s)
@defaultValue false`,name:"isAfterUpload",required:!1,type:{name:"boolean"}}}}}catch{}const Xe=`Sharing settings determine who can access your content, and what kind of access they have. Choose people/teams and define their level of access below.

_Only Administrators can add, delete, or change access levels for other people._`,Qe="https://help.synapse.org/docs/Sharing-Settings,-Permissions,-and-Conditions-for-Use.2024276030.html";function M(t){const{entityId:s,open:r,onUpdateSuccess:n=ge,onClose:i,isAfterUpload:u=!1}=t,[h,p]=a.useState(!1),[o,g]=a.useState(!1),m=a.useRef(null),{data:l}=Ce(s),E=l?.entityType?L(l?.entityType):"",f=l?.permissions?.canChangePermissions;function y(){o?p(!0):i()}return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{open:h,onCancel:()=>{p(!1)},onConfirm:()=>{p(!1),i()}}),e.jsx(Ee,{title:`${E} Sharing Settings`.trim(),onCancel:y,open:r,maxWidth:"md",titleHelpPopoverProps:{markdownText:Xe,helpUrl:Qe},content:e.jsx(Je,{ref:m,entityId:s,onCanSaveChange:d=>g(d),onUpdateSuccess:()=>{F("Permissions were successfully saved to Synapse","info"),n(),i()},isAfterUpload:u}),onConfirm:d=>{d.preventDefault(),m.current.save()},confirmButtonProps:{children:f?"Save":"OK",disabled:!o}})]})}try{M.displayName="EntityAclEditorModal",M.__docgenInfo={description:"",displayName:"EntityAclEditorModal",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onUpdateSuccess:{defaultValue:null,description:"",name:"onUpdateSuccess",required:!1,type:{name:"() => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isAfterUpload:{defaultValue:null,description:"",name:"isAfterUpload",required:!1,type:{name:"boolean"}}}}}catch{}export{M as E};
