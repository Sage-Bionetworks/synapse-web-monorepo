import{j as t}from"./jsx-runtime-Bv8YEaBH.js";import{r as P}from"./index-C8JkJuAu.js";import{u as M,d as U,Q as H,a as K,N as Y,b as $}from"./QueryWrapper-DKle5ClZ.js";import{aL as G,s as z}from"./useFiles-Su2vP-Vi.js";import{b as J,g as Z}from"./SqlFunctions-DMQpCQSh.js";import{l as X}from"./StringUtils-DnD65nWI.js";import{u as ee}from"./useQuery-BUFsJCGJ.js";import{i as te,h as ae,B as oe,k as ne,x as se,l as re,j as le,w as ie,m as ue}from"./SynapseConstants-EeVSIOhY.js";import"./VerificationSubmission-DeH3Sb8D.js";import"./OrientationBanner-BQ3EEnjD.js";import{u as de}from"./useEntity-Boy3rQwy.js";import"./DownloadConfirmationUI-B52UrP01.js";import{a as ce,T as me,R as pe}from"./RowSetView-Bx5geEJT.js";import{F as ye,S as fe,T as he}from"./TopLevelControls-TYcyCs0M.js";import{M as Pe}from"./ModalDownload-CvnC1eay.js";import{u as D}from"./QueryContext-v9aErJlD.js";import{a as ve}from"./TableRowSelectionState-DHg3MbFz.js";import{Q as Se,S as xe}from"./QueryWrapperErrorBoundary-DUyJwIwo.js";import"./ThemesPlot-Che4JQzy.js";import"./UpsetPlot-BN7SA8kj.js";import{S as _e}from"./SynapsePlot-C2A2oTIM.js";import{P as ge,u as Ce,g as Ee,F as Te,a as we}from"./useFacetPlots-Bs4V0t_s.js";import{B as j}from"./Box-BMPqYR7p.js";import{S as x}from"./Skeleton-CBrnuwpI.js";import{S as je}from"./Stack-rdeC-v74.js";import{B as Ne}from"./Button-DEBpA164.js";import{u as Ie}from"./react-CiUdbne5.js";function L(e){const o=D(),{currentQueryRequest:l}=o,{title:i,onCustomPlotClick:d,onHide:_}=e,{showPlots:c}=M(),f=P.useMemo(()=>({...e,title:void 0,showlegend:!1,displayModebar:!1}),[e]),p=P.useMemo(()=>{const{selectedFacets:S,additionalFilters:g}=l.query;return{selectedFacets:S,additionalFilters:g,onCustomPlotClick:d,queryContext:o}},[l.query,d,o]);return t.jsx("div",{role:"figure",className:"SynapsePlot",children:c&&t.jsxs(t.Fragment,{children:[i&&t.jsx(ge,{title:i,onHide:_}),t.jsx(_e,{synapsePlotWidgetParams:f,customPlotParams:p})]})})}try{L.displayName="QueryWrapperSynapsePlot",L.__docgenInfo={description:`This component wraps a SynapsePlot.  It passes in the current query context, and has a custom
"title" style so that it looks like it belongs in the QueryWrapperPlotNav plots.`,displayName:"QueryWrapperSynapsePlot",props:{onCustomPlotClick:{defaultValue:null,description:"",name:"onCustomPlotClick",required:!1,type:{name:"(event: QueryWrapperSynapsePlotRowClickEvent) => void"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"table"'},{value:'"image"'},{value:'"box"'},{value:'"bar"'},{value:'"volume"'},{value:'"barpolar"'},{value:'"candlestick"'},{value:'"carpet"'},{value:'"choropleth"'},{value:'"choroplethmapbox"'},{value:'"cone"'},{value:'"contour"'},{value:'"contourcarpet"'},{value:'"densitymapbox"'},{value:'"funnel"'},{value:'"funnelarea"'},{value:'"heatmap"'},{value:'"heatmapgl"'},{value:'"histogram"'},{value:'"histogram2d"'},{value:'"histogram2dcontour"'},{value:'"indicator"'},{value:'"isosurface"'},{value:'"mesh3d"'},{value:'"ohlc"'},{value:'"parcats"'},{value:'"parcoords"'},{value:'"pie"'},{value:'"pointcloud"'},{value:'"sankey"'},{value:'"scatter"'},{value:'"scatter3d"'},{value:'"scattercarpet"'},{value:'"scattergeo"'},{value:'"scattergl"'},{value:'"scattermapbox"'},{value:'"scatterpolar"'},{value:'"scatterpolargl"'},{value:'"scatterternary"'},{value:'"splom"'},{value:'"streamtube"'},{value:'"sunburst"'},{value:'"surface"'},{value:'"treemap"'},{value:'"violin"'},{value:'"waterfall"'}]}},horizontal:{defaultValue:null,description:"",name:"horizontal",required:!1,type:{name:"boolean"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},xtitle:{defaultValue:null,description:"",name:"xtitle",required:!1,type:{name:"Plotly.LayoutAxis"}},ytitle:{defaultValue:null,description:"",name:"ytitle",required:!1,type:{name:"Plotly.LayoutAxis"}},xaxistype:{defaultValue:null,description:"",name:"xaxistype",required:!1,type:{name:"enum",value:[{value:'"log"'},{value:'"date"'},{value:'"linear"'},{value:'"-"'},{value:'"category"'},{value:'"multicategory"'}]}},showlegend:{defaultValue:null,description:"",name:"showlegend",required:!1,type:{name:"Plotly.Layout"}},barmode:{defaultValue:null,description:"",name:"barmode",required:!1,type:{name:"Plotly.Layout"}},displayModeBar:{defaultValue:null,description:"",name:"displayModeBar",required:!1,type:{name:"Plotly.Config"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function V(){return t.jsxs(j,{className:"FacetNavPanel",flexGrow:1,children:[t.jsxs(j,{className:"FacetNavPanel__title",children:[t.jsx(x,{variant:"rectangular",height:20,width:170}),t.jsx("div",{style:{margin:"auto"}}),t.jsx(x,{variant:"rectangular",height:20,width:20}),t.jsx(x,{variant:"rectangular",height:20,width:20,sx:{ml:1}})]}),t.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{minWidth:"435px",flexGrow:1},height:200,px:2,children:[t.jsx(x,{variant:"circular",width:140,height:140}),t.jsxs(je,{gap:1,children:[t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220}),t.jsx(x,{variant:"rectangular",height:15,width:220})]})]})]})}function Fe(){return t.jsxs(j,{className:"PlotsContainer",display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:4,children:[t.jsx(V,{}),t.jsx(V,{})]})}const b=2,v=(e,o)=>"__custom"in o&&"__custom"in e?e.title==o.title:!("__custom"in o)&&!("__custom"in e)?G(e,o):!1;function be(e){return e==="bar"?"BAR":"PIE"}const Ae=e=>"__custom"in e.plotId?`custom-${e.plotId.title}`:`facet-${e.plotId.columnName}-${e.plotId.jsonPath}`,Le=(e,o)=>!!o.find(l=>v(l.plotId,e)),R=e=>({__custom:!0,title:e.title??""}),qe=(e=[],o=[],l=q)=>[...e.map((i,d)=>({plotId:R(i),isHidden:d>=b,plotType:be(i.type)})),...o.map((i,d)=>({plotId:i.facetToPlot,isHidden:d+e.length>=b,plotType:l}))],Qe=(e,o,l)=>o.some(i=>v(R(i),e.plotId))||l.some(i=>v(i.facetToPlot,e.plotId)),q="PIE",Me=[],Re=[];function Q(e){const{facetsToPlot:o=Me,customPlots:l=Re,initialPlotType:i=q}=e,{data:d}=U(),{showPlots:_}=M(),[c,f]=P.useState([]),p=Ce(o),S=a=>{var r;return((r=c.find(n=>v(a,n.plotId)))==null?void 0:r.plotType)??q};P.useEffect(()=>{const a=qe(l,p,i);f(s=>{const r=a.filter(u=>!Le(u.plotId,s));return[...s.filter(u=>Qe(u,l,p)),...r]})},[l,p]);const g=a=>{f(s=>s.map((r,n)=>a?{...r,isHidden:!1}:{...r,isHidden:n>=b}))},N=a=>c.find(n=>v(a,n.plotId)&&n.isHidden===!0)!==void 0,y=P.useMemo(()=>c.find(a=>a.isHidden===!0)?"MORE":c.length<=b?"NONE":"LESS",[c]),C=a=>{T(a,"isHidden",!0)},I=(a,s)=>{T(a,"plotType",s)},T=(a,s,r)=>{f(n=>n.map(m=>v(a,m.plotId)?{...m,[s]:r}:m))},w=Ee(d,o).map((a,s)=>({facet:{columnName:a.columnName,jsonPath:a.jsonPath},colorIndex:s}));return t.jsx(t.Fragment,{children:c.length>0&&t.jsxs("div",{className:`PlotsContainer ${_?"":"hidden"} ${y==="LESS"?"less":""}`,children:[t.jsx("div",{className:"PlotsContainer__row",role:"list",children:c.map(a=>{var m;const s="__custom"in a.plotId,r=l.find(u=>v(R(u),a.plotId)),n=p.find(u=>v(u.facetToPlot,a.plotId));return t.jsxs("div",{style:{minWidth:"435px",display:N(a.plotId)?"none":"block"},children:[s&&r&&t.jsx(L,{...r,onHide:()=>C(a.plotId)}),!s&&n&&t.jsx(Te,{index:(m=w.find(u=>v(u.facet,a.plotId)))==null?void 0:m.colorIndex,onHide:()=>C(a.plotId),plotType:S(a.plotId),onSetPlotType:u=>I(a.plotId,u),isModalView:!1,...n})]},Ae(a))})}),y!=="NONE"&&t.jsx(j,{display:"flex",justifyContent:"center",sx:{backgroundColor:"grey.100",p:2,mt:2},children:t.jsx(Ne,{variant:"contained",color:"secondary",onClick:()=>g(y==="MORE"),sx:{width:"150px"},children:y==="LESS"?"Hide Charts":"View All Charts"})})]})})}function Ve(e){const{showPlots:o}=M();return t.jsx(P.Suspense,{fallback:o?t.jsx(Fe,{}):null,children:t.jsx(Q,{...e})})}try{Q.displayName="PlotsContainer",Q.__docgenInfo={description:"",displayName:"PlotsContainer",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}},customPlots:{defaultValue:null,description:"",name:"customPlots",required:!1,type:{name:"QueryWrapperSynapsePlotProps[]"}},initialPlotType:{defaultValue:null,description:"",name:"initialPlotType",required:!1,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'},{value:'"STACKED_HORIZONTAL_BAR"'}]}}}}}catch{}const Be="isShowingFacetFilters",De="isHidingFacetFilters",Oe="hasSelectedRows";function We(e){const{tableConfiguration:o,name:l,cardConfiguration:i,facetsToPlot:d,availableFacets:_,facetValueSortConfigs:c,initialExpandedFacetControls:f,hideDownload:p,hideQueryCount:S,hideSqlEditorControl:g,hideVisualizationsControl:N,searchConfiguration:y,cavaticaConnectAccountURL:C,customControls:I,remount:T,isFullTextSearchEnabled:w,customPlots:a,initialLimit:s,initialPlotType:r}=e,n=D(),[m,u]=P.useState(!1),{hasFacetedSelectColumn:E,queryMetadataQueryOptions:A}=n,{isLoading:O}=ee(A),W=Ie(ve),h=n.currentQueryRequest,k=(h==null?void 0:h.query.selectedFacets)!==void 0&&h.query.selectedFacets.length>0||(h==null?void 0:h.query.additionalFilters)!==void 0&&(h==null?void 0:h.query.additionalFilters.length)>0;return t.jsx($,{children:F=>{if(F===void 0)throw new Error("No queryVisualizationContext found when using QueryVisualizationContextConsumer");return t.jsx(j,{className:`QueryWrapperPlotNav ${F.showFacetFilter?Be:De} ${W?Oe:""}`,sx:{"*":{cursor:O?"wait":void 0}},children:t.jsxs(Se,{children:[w?t.jsx(ye,{ftsConfig:y==null?void 0:y.ftsConfig}):t.jsx(fe,{...y,queryContext:n,queryVisualizationContext:F}),t.jsx(xe,{}),F.showDownloadConfirmation&&t.jsx(ce,{onClose:()=>F.setShowDownloadConfirmation(!1)}),t.jsx(z,{children:t.jsx(he,{showColumnSelection:o!==void 0,name:l,hideDownload:p,hideQueryCount:S,hideFacetFilterControl:!E,hideVisualizationsControl:!E||N,hideSqlEditorControl:g,cavaticaConnectAccountURL:C,customControls:I,remount:T})}),E&&t.jsx(t.Fragment,{children:t.jsx(we,{availableFacets:_,facetValueSortConfigs:c,initialExpandedFacetControls:f})}),t.jsx(me,{frontText:"",endText:k?"filtered by":"",hideIfUnfiltered:!0}),t.jsx(Ve,{facetsToPlot:d,customPlots:a,initialPlotType:r}),t.jsx(pe,{tableConfiguration:o,hideDownload:p,cardConfiguration:i,initialLimit:s}),m&&t.jsx(Pe,{getLastQueryRequest:n==null?void 0:n.getCurrentQueryRequest,onClose:()=>u(!1)})]})})}})}function B(e){var E;const{sql:o,tableConfiguration:l,isInfinite:i=!l,limit:d=te,showLastUpdatedOn:_,unitDescription:c,additionalFiltersSessionStorageKey:f,helpConfiguration:p,customPlots:S,enabledExternalAnalysisPlatforms:g}=e,N=((E=e.query)==null?void 0:E.sql)??o??"",y=J(N),{entityId:C,versionNumber:I}=y??{entityId:""},T=P.useMemo(()=>{if(e.query)return e.query;if(e.initQueryJson)return JSON.parse(e.initQueryJson);{const A=Z(e.searchParams,e.sqlOperator,f);return{sql:o,additionalFilters:A,limit:d,offset:0}}},[e.query,e.initQueryJson,e.searchParams,e.sqlOperator,f,o,d]),[w,a]=P.useState(1),s=()=>{a(w+1)},{data:r}=de(C,I),n={entityId:C,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:ae|oe|ne|se|re|le|ie|ue,query:T},m=(r&&X(r)&&r.isSearchEnabled)??!1,u=`${JSON.stringify(n)}-${w}`;return P.createElement(H,{...e,initQueryRequest:n,key:u,isInfinite:i},t.jsx(K,{unitDescription:c,rgbIndex:e.rgbIndex,columnAliases:e.columnAliases,helpConfiguration:p,visibleColumnCount:e.visibleColumnCount,defaultShowPlots:e.defaultShowPlots,hideCopyToClipboard:e.hideCopyToClipboard,defaultShowSearchBar:(e.defaultShowSearchBox||m)&&!e.hideSearchBarControl,hideSearchBarControl:e.hideSearchBarControl,showLastUpdatedOn:_,noContentPlaceholderType:Y.INTERACTIVE,hasCustomPlots:Array.isArray(S)&&S.length>0,enabledExternalAnalysisPlatforms:g,children:t.jsx(We,{...e,isFullTextSearchEnabled:m,remount:s})}))}try{B.displayName="QueryWrapperPlotNav",B.__docgenInfo={description:"",displayName:"QueryWrapperPlotNav",props:{}}}catch{}export{B as Q};
