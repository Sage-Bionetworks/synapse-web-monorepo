import{V as z,j as e,r as u,c4 as T,ah as V,c9 as k,c5 as U,ca as B,B as E,K as P,W as _,Y as f,bs as M,$ as O,dG as N,dV as R}from"./iframe-BoCRNbsR.js";import{c as b}from"./UserBadge-jrgoiBJ0.js";import{b as Y,c as F,d as W,e as K}from"./usePortal-D3Dj4ypv.js";import{A as H}from"./AclEditor-n-YHTSaj.js";import{u as $}from"./useUpdateAcl-BcLimx6Z.js";import{c as G,u as J}from"./AccessControlListUtils-CXAjf6zR.js";import{D as Q}from"./DialogBase-BB6caHGd.js";import{C as q}from"./ConfirmationDialog-DXOTVrB0.js";import{C as X}from"./Card-Bt5_s5Bl.js";import{C as Z}from"./CardContent-BU4PSXJH.js";const ee=z(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"})),te=z(e.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"})),re="_portalCard_1fzry_1",ae="_header_1fzry_9",oe="_titleRow_1fzry_13",se="_actions_1fzry_21",ne="_url_1fzry_26",le="_metadata_1fzry_33",ce="_userInfo_1fzry_40",x={portalCard:re,header:ae,titleRow:oe,actions:se,url:ne,metadata:le,userInfo:ce},ie=["CAN_ADMINISTER_PORTAL"],A=u.forwardRef(function(t,p){const{portalId:r,onSaveComplete:o}=t,[s,i]=u.useState(null),y=()=>{i(null),o(!0)},d=m=>{i(m.reason),o(!1)},{data:n,isLoading:g}=Y(r,{staleTime:1/0}),{resourceAccessList:l,setResourceAccessList:h,addResourceAccessItem:C,updateResourceAccessItem:j,removeResourceAccessItem:a,resetDirtyState:S}=$({onChange:()=>i(null),onError:i});u.useEffect(()=>{n&&(S(),h(G(n.resourceAccess)))},[n,h,S]);const{mutate:I}=F({onSuccess:()=>y(),onError:m=>d(m)});return u.useImperativeHandle(p,()=>({save(){const m=J(n,l);n===null&&m==null||T(n?.resourceAccess,l)&&n?.id===m?.id?o(!0):I(m)}}),[r,n,l,o,I]),e.jsxs(V,{direction:"column",sx:{gap:"20px"},children:[e.jsx(H,{resourceAccessList:l,availablePermissionLevels:ie,isLoading:g,canEdit:!0,emptyText:"",onAddPrincipalToAcl:m=>C(m,k("CAN_ADMINISTER_PORTAL")),updateResourceAccessItem:j,removeResourceAccessItem:a,showAddRemovePublicButton:!1,showNotifyCheckbox:!1,isInherited:!1}),s&&e.jsx(U,{severity:"error",children:s})]})});try{A.displayName="PortalAclEditor",A.__docgenInfo={description:"",displayName:"PortalAclEditor",props:{portalId:{defaultValue:null,description:"",name:"portalId",required:!0,type:{name:"string"}},onSaveComplete:{defaultValue:null,description:"",name:"onSaveComplete",required:!0,type:{name:"(saveSuccessful: boolean) => void"}}}}}catch{}function v(c){const{portalId:t,open:p,onUpdateSuccess:r=B,onClose:o}=c,s=u.useRef(null);return e.jsx(e.Fragment,{children:e.jsx(Q,{open:p,title:"Portal Sharing Settings",onCancel:o,maxWidth:"md",content:e.jsx(A,{ref:s,portalId:t,onSaveComplete:()=>{P("Permissions were successfully saved to Synapse","info"),r(),o()}}),actions:e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"outlined",onClick:()=>{o()},children:"Cancel"}),e.jsx(E,{variant:"contained",color:"primary",onClick:()=>{s.current?.save()},children:"Save"})]})})})}try{v.displayName="PortalAclEditorModal",v.__docgenInfo={description:"",displayName:"PortalAclEditorModal",props:{portalId:{defaultValue:null,description:"",name:"portalId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onUpdateSuccess:{defaultValue:null,description:"",name:"onUpdateSuccess",required:!1,type:{name:"() => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}const D="1";function L({portal:c}){const{id:t,name:p,url:r,createdBy:o,createdOn:s,modifiedBy:i,modifiedOn:y}=c,[d,n]=u.useState(!1),[g,l]=u.useState(!1),h=t&&t!==D,C=t&&t!==D,{mutate:j}=W({onSuccess:()=>{P(`Portal "${p}" was successfully deleted`,"success"),l(!1)},onError:a=>{P(`Failed to delete portal: ${a.reason}`,"danger")}});return e.jsxs(e.Fragment,{children:[e.jsx(X,{className:x.portalCard,children:e.jsxs(Z,{children:[e.jsxs(_,{className:x.header,children:[e.jsxs(_,{className:x.titleRow,children:[e.jsx(f,{variant:"h6",component:"h3",children:p}),e.jsxs(_,{className:x.actions,children:[h&&e.jsx(M,{size:"small",onClick:()=>n(!0),"aria-label":"Manage portal permissions",title:"Manage portal permissions",children:e.jsx(te,{fontSize:"small"})}),C&&e.jsx(M,{size:"small",onClick:()=>l(!0),"aria-label":"Delete portal",title:"Delete portal",color:"error",children:e.jsx(ee,{fontSize:"small"})})]})]}),r&&e.jsx(O,{href:r,target:"_blank",rel:"noopener noreferrer",className:x.url,children:r})]}),e.jsxs(_,{className:x.metadata,children:[t&&e.jsxs(f,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"ID:"})," ",t]}),o&&e.jsxs(_,{className:x.userInfo,children:[e.jsx(f,{variant:"body2",color:"text.secondary",children:e.jsx("strong",{children:"Created by:"})}),e.jsx(b,{ownerId:o,size:"SMALL USER CARD",hideEmail:!0,disableLink:!1}),s&&e.jsxs(f,{variant:"caption",color:"text.secondary",children:["on ",N(s).format("MMMM D, YYYY")]})]}),i&&e.jsxs(_,{className:x.userInfo,children:[e.jsx(f,{variant:"body2",color:"text.secondary",children:e.jsx("strong",{children:"Last modified by:"})}),e.jsx(b,{ownerId:i,size:"SMALL USER CARD",hideEmail:!0,disableLink:!1}),y&&e.jsxs(f,{variant:"caption",color:"text.secondary",children:["on ",N(y).format("MMMM D, YYYY")]})]})]})]})}),h&&t&&e.jsx(v,{portalId:t,open:d,onClose:()=>n(!1)}),t&&e.jsx(q,{open:g,title:"Delete Portal",content:e.jsxs(_,{children:[e.jsx(f,{variant:"body1",sx:{mb:2},children:"Are you sure you want to delete this portal?"}),e.jsxs(f,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Name:"})," ",p]}),r&&e.jsxs(f,{variant:"body2",children:[e.jsx("strong",{children:"URL:"})," ",r]})]}),confirmButtonProps:{children:"Delete",color:"error",variant:"contained"},onConfirm:()=>{t&&j(t)},onCancel:()=>l(!1),maxWidth:"sm"})]})}try{L.displayName="PortalCard",L.__docgenInfo={description:"",displayName:"PortalCard",props:{portal:{defaultValue:null,description:"",name:"portal",required:!0,type:{name:"Portal"}}}}}catch{}function w({open:c,onClose:t,onSuccess:p}){const[r,o]=u.useState(""),[s,i]=u.useState(""),[y,d]=u.useState(),{mutate:n,isPending:g}=K({onSuccess:a=>{P("Portal created successfully","success"),l(),p?.(a)},onError:a=>{d(a.reason||a.message)}}),l=()=>{o(""),i(""),d(void 0),t()},h=()=>{if(!r.trim()){d("Portal name is required");return}if(!s.trim()){d("Portal URL is required");return}const a={name:r.trim(),url:s.trim()};n(a)},C=a=>{a.key==="Enter"&&r.trim()&&s.trim()&&h()},j=e.jsxs(e.Fragment,{children:[e.jsx(R,{id:"portalNameInput",label:"Portal Name",value:r,fullWidth:!0,required:!0,onChange:a=>{o(a.target.value),d(void 0)},inputProps:{onKeyDown:C},sx:{mb:2}}),e.jsx(R,{id:"portalUrlInput",label:"Portal URL",value:s,fullWidth:!0,required:!0,placeholder:"https://example.synapse.org",onChange:a=>{i(a.target.value),d(void 0)},inputProps:{onKeyDown:C}}),y&&e.jsx(U,{severity:"error",sx:{mt:2},children:y})]});return e.jsx(q,{open:c,title:"Create a New Portal",content:j,confirmButtonProps:{children:"Create",disabled:g||!r.trim()||!s.trim()},onConfirm:h,onCancel:l,maxWidth:"sm"})}try{w.displayName="CreatePortalModal",w.__docgenInfo={description:"",displayName:"CreatePortalModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"(portal: Portal) => void"}}}}}catch{}export{w as C,L as P};
