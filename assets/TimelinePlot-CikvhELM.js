import{j as e,X as j,r as I,dO as P,bl as se,bm as te,ai as re,el as oe,f3 as Q,a0 as D,gu as ne,dM as ie,eb as ae,em as le,j0 as b,c0 as O}from"./iframe-DkJtXMGY.js";import{p as $,a as ue}from"./SqlFunctions-DDowXms4.js";import{g as F}from"./ColorGradient-Zy7TAKxK.js";import{B as f}from"./Box-Bc8zTrL5.js";import{C as de}from"./CardContainerLogic-CFdaE9l1.js";import{P as ce}from"./Plot-DFQXQU_N.js";import"./LightTooltip-DemkIWEH.js";import"./WideButton-VLrEVAkB.js";import"./InputSizedButton-OaC5z9Wq.js";import{M as me}from"./MenuItem-__VZzdvD.js";import{u as pe}from"./index-BOkvxSTS.js";const ve="species",ye="observationphase",V={queryResult:{queryResults:{headers:[{name:"species",columnType:"STRING",id:"152514"},{name:"observationPhase",columnType:"STRING",id:"197976"},{name:"observationPhaseOrder",columnType:"INTEGER",id:"198102"},{name:"observationTimeMax",columnType:"INTEGER",id:"198103"},{name:"observationTimeUnits",columnType:"STRING",id:"198101"}],rows:[{rowId:9,versionNumber:4,values:["Danio rerio","embryo","1","7","days"]},{rowId:10,versionNumber:4,values:["Danio rerio","larval","2","3","months"]},{rowId:11,versionNumber:4,values:["Danio rerio","juvenile","3","6","months"]},{rowId:12,versionNumber:4,values:["Danio rerio","adult","4","12","months"]},{rowId:16,versionNumber:4,values:["Drosophila","embryo","1","24","hours"]},{rowId:17,versionNumber:4,values:["Drosophila","larval","2","5","days"]},{rowId:18,versionNumber:4,values:["Drosophila","pupal","3","12","days"]},{rowId:19,versionNumber:4,values:["Drosophila","adult","4","5","weeks"]},{rowId:1,versionNumber:4,values:["Mus musculus","prenatal","1","21","days"]},{rowId:2,versionNumber:4,values:["Mus musculus","postnatal","2","6","months"]},{rowId:20,versionNumber:4,values:["Rattus norvegicus","prenatal","1","23","days"]},{rowId:21,versionNumber:4,values:["Rattus norvegicus","neonatal","2","4","weeks"]},{rowId:22,versionNumber:4,values:["Rattus norvegicus","weanling","3","2","months"]},{rowId:23,versionNumber:4,values:["Rattus norvegicus","juvenile","4","3","months"]},{rowId:24,versionNumber:4,values:["Rattus norvegicus","adolescent","5","6","months"]},{rowId:25,versionNumber:4,values:["Rattus norvegicus","adult","6","12","months"]},{rowId:13,versionNumber:4,values:["Saccharomyces","log phase","1","7","days"]},{rowId:14,versionNumber:4,values:["Saccharomyces","stationary phase","2","2","weeks"]},{rowId:15,versionNumber:4,values:["Saccharomyces","death phase","3","3","weeks"]},{rowId:3,versionNumber:4,values:["Sus scrofa","prenatal","1","115","days"]},{rowId:4,versionNumber:4,values:["Sus scrofa","neonatal","2","3","months"]},{rowId:5,versionNumber:4,values:["Sus scrofa","weanling","3","6","months"]},{rowId:6,versionNumber:4,values:["Sus scrofa","juvenile","4","12","months"]},{rowId:7,versionNumber:4,values:["Sus scrofa","adolescent","5","2","years"]},{rowId:8,versionNumber:4,values:["Sus scrofa","adult","6","3","years"]}]}}};var B;const he=(B=V.queryResult)==null?void 0:B.queryResults.headers.findIndex(s=>s.name.toLowerCase()===ve);var H;const E=(H=V.queryResult)==null?void 0:H.queryResults.headers.findIndex(s=>s.name.toLowerCase()===ye),q=({color:s,phaseName:r})=>e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:"7px"},children:[e.jsx(f,{sx:{backgroundColor:s,width:"20px",height:"20px"}}),e.jsx(j,{variant:"body1",children:r==null?void 0:r.toUpperCase()})]});try{q.displayName="TimelineLegendItem",q.__docgenInfo={description:"",displayName:"TimelineLegendItem",props:{color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},phaseName:{defaultValue:null,description:"",name:"phaseName",required:!0,type:{name:"string"}}}}}catch{}const fe=(s,r,u,c)=>{let a=-1;return{timepoints:r.map((n,o)=>{const i=parseFloat(n.values[u.observationTime]),t=n.values[u.observationTimeUnits];return n.rowId==c&&(a=o),s.add(i,t)}),hoverOverIndex:a}},M=s=>s.length==0?P().add(1,"days"):s.reduce((r,u)=>!r||u.isAfter(r)?u:r),ge=(s,r)=>{if(s.timepoints==null||s.timepoints.length==0)return[{x:[P().format()],y:[.5],mode:"lines",line:{color:"blue",width:2},customdata:[],hoverinfo:"none"}];const u=s.timepoints.reduce((a,d,n)=>{const o=a;return o[d.format()]||(o[d.format()]=[]),o[d.format()].push(r[n]),a},{});return s.timepoints.map((a,d)=>{const n=a.format(),o=d==s.hoverOverIndex,t=u[n].map(y=>y.rowId);return{x:[n,n,n],y:[0,.5,1],mode:"lines",line:{color:o?"black":"gray",width:o?2:1},customdata:[t,t,t],hoverinfo:"none"}})},xe=(s,r,u,c,a,d)=>{const n=c.map(i=>i.x[0]),o=c.map(i=>{const t=i.customdata[0];if(t&&t.length>0){const y=t.length,m=a==null?void 0:a.filter(p=>t[0]==p.rowId);if(m&&m.length>0){const p=m[0],v=parseFloat(p.values[d.observationTime]),N=p.values[d.observationTimeUnits],l=y>1?`(${y})`:"";return`${v} ${N} ${l}`}}return""});return{hovermode:"closest",dragmode:!1,showlegend:!1,xaxis:{showgrid:!1,showticklabels:!0,showline:!1,zeroline:!1,tickvals:n,ticktext:o,tickangle:-45},yaxis:{range:[0,1.25],showgrid:!1,zeroline:!1,showline:!1,showticklabels:!1},shapes:[{type:"rect",x0:s.subtract(r.diff(s)/10).format(),x1:r.add(r.diff(s)/3).format(),y0:.25,y1:.75,fillcolor:u,opacity:.8,line:{width:0}}],margin:{l:0,r:0,t:60,b:60}}},C=({color:s,rowData:r,schema:u,widthPx:c,sql:a})=>{const[d,n]=I.useState(),[o,i]=I.useState(),[t,y]=I.useState(1),m=P(),p=I.useRef(null),v=d==null?void 0:d.points[0].customdata,N=r==null?void 0:r.filter(g=>v==null?void 0:v.includes(g.rowId)),l=o==null?void 0:o.points[0].customdata,T=I.useMemo(()=>fe(m,r,u,(l==null?void 0:l.length)>0?l[0]:void 0),[l,r,u,m]),h=M(T.timepoints),S=I.useMemo(()=>ge(T,r),[T,r]),R=N.map(g=>g.rowId);return e.jsxs("div",{ref:p,style:{width:c},children:[e.jsx(ce,{style:{width:c,height:"220px"},data:S,layout:xe(m,h,s,S,r,u),config:{displayModeBar:!1},useResizeHandler:!0,onClick:g=>{n(g),i(void 0)},onDoubleClick:()=>{y(t+1)},onHover:g=>{i(g)},onUnhover:()=>{i(void 0)}},`Plot-${s}-${t}`),e.jsx(se,{onClose:()=>n(void 0),open:N&&N.length>0,children:e.jsx(te,{children:e.jsx(de,{topLevelEnumeratedFacetToFilter:{columnName:"observationType"},sql:a,searchParams:{ROW_ID:R.map(String).join(",")},sqlOperator:oe.IN,lockedColumn:{columnName:"ROW_ID"},cardConfiguration:{type:re},initialLimit:3})})})]})};try{M.displayName="getMaxDate",M.__docgenInfo={description:"",displayName:"getMaxDate",props:{}}}catch{}try{C.displayName="TimelinePhase",C.__docgenInfo={description:"",displayName:"TimelinePhase",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"Row[]"}},schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},widthPx:{defaultValue:null,description:"",name:"widthPx",required:!0,type:{name:"number"}},sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const L=({sql:s,additionalFilters:r,species:u,setSpecies:c})=>{var y,m;const a=$(s),d=Q({entityId:a,query:{sql:`SELECT distinct unnest(species) FROM ${a} WHERE species IS NOT NULL AND observationTime IS NOT NULL GROUP BY species`,additionalFilters:r},partMask:D,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:n,isLoading:o}=d,i=(m=(y=n==null?void 0:n.queryResult)==null?void 0:y.queryResults)==null?void 0:m.rows,t=i&&i.length>0?i[0].values[0]:void 0;return u==null&&t!=null&&c(t),o||!i||i.length<2?e.jsx(e.Fragment,{}):e.jsx(f,{children:e.jsxs(ne,{children:[e.jsx(ie,{children:"Species"}),e.jsx(ae,{sx:{marginLeft:"2px",marginBottom:"2px"},value:u,label:"Species",onChange:p=>{c(p.target.value)},children:i==null?void 0:i.map(p=>{const v=p.values[0];return e.jsx(me,{value:v,children:v},v)})})]})})};try{L.displayName="TimelinePlotSpeciesSelector",L.__docgenInfo={description:"",displayName:"TimelinePlotSpeciesSelector",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},additionalFilters:{defaultValue:null,description:"",name:"additionalFilters",required:!1,type:{name:"QueryFilter[]"}},species:{defaultValue:null,description:"",name:"species",required:!1,type:{name:"string"}},setSpecies:{defaultValue:null,description:"",name:"setSpecies",required:!0,type:{name:"Dispatch<SetStateAction<string>>"}}}}}catch{}const be="observationphase",Ie="observationtime",Ne="observationtimeunits",Te="observationsubmittername",_e="observationtext",Se="observationtype",we="synapseid",Re="doi",k=({sql:s,searchParams:r,sqlOperator:u,defaultSpecies:c,title:a,subTitle:d})=>{const n=$(s),[o,i]=I.useState(c),[t,y]=pe(),m=ue(r,u)??[],p=o?{columnName:"species",concreteType:"org.sagebionetworks.repo.model.table.ColumnMultiValueFunctionQueryFilter",values:[o],function:le.HAS}:void 0,v=[...m];p&&v.push(p);const N=Q({entityId:n,query:{sql:`${s} WHERE observationTime IS NOT NULL`,sort:[{column:"observationTime",direction:"ASC"}],additionalFilters:v},partMask:D,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"},{enabled:!!o}),{data:l,isLoading:T}=N,h=I.useMemo(()=>{var x;if(o)return(x=V.queryResult)==null?void 0:x.queryResults.rows.filter(_=>_.values[he]==o)},[o]);if(T)return e.jsx(Oe,{});const S=b(be,l),R=b(Ie,l),g=b(Ne,l),G=b(Te,l),W=b(_e,l),z=b(Re,l),K=b(Se,l),Y=b(we,l),X={observationSubmitterName:G,synapseId:Y,observationType:K,observationText:W,observationTime:R,observationTimeUnits:g,doi:z},J=t!=null&&t.width&&h?(t==null?void 0:t.width)/h.length:0,Z=h==null?void 0:h.map(()=>"auto").join(" ");return e.jsxs(e.Fragment,{children:[o&&e.jsxs(e.Fragment,{children:[a&&e.jsx(j,{variant:"h2",children:a}),d&&e.jsx(j,{variant:"body1Italic",sx:{margin:"10px 0px"},children:d})]}),e.jsxs(f,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(f,{children:!c&&e.jsx(L,{setSpecies:i,species:o,sql:s,additionalFilters:m})}),h&&e.jsx(f,{sx:{display:"flex",justifyContent:"flex-end",gap:"25px"},children:h.map((x,w)=>{const{colorPalette:_}=F(w,1);return e.jsx(q,{color:_[0],phaseName:x.values[E]},x.rowId)})})]}),o&&h&&e.jsx("div",{ref:y,children:e.jsx(f,{sx:{display:"inline-grid",gridTemplateColumns:Z,minWidth:t==null?void 0:t.width,maxWidth:t==null?void 0:t.width},className:"forcePlotlyDefaultCursor",children:h.map((x,w)=>{var U;const{colorPalette:_}=F(w,1),A=(U=l==null?void 0:l.queryResult)==null?void 0:U.queryResults.rows.filter(ee=>ee.values[S]==x.values[E]);return A?e.jsx(C,{name:x.values[E],color:_[0],rowData:A,schema:X,widthPx:J,sql:s},x.rowId):e.jsx(e.Fragment,{})})})})]})]})},Oe=()=>e.jsxs(f,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx(O,{height:"45px",width:"80px"}),e.jsx(O,{height:"45px",width:"80px"})]}),e.jsx(f,{sx:{display:"flex"},children:e.jsx(O,{height:"150px",width:"100%"})})]});try{k.displayName="TimelinePlot",k.__docgenInfo={description:"",displayName:"TimelinePlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"SQLOperator"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!1,type:{name:"string"}},defaultSpecies:{defaultValue:null,description:"",name:"defaultSpecies",required:!1,type:{name:"string"}}}}}catch{}export{k as T};
