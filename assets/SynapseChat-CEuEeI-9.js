import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{l as h,S as A}from"./useFiles-Da5SPf30.js";import{t as y}from"./VerificationSubmission-DHtRxRPZ.js";import"./StringUtils-DP1EOPFU.js";import"./OrientationBanner-BwAbfTIw.js";import{r as o}from"./index-CfbPO5Pk.js";import{u as ne}from"./useQuery-CT4vRpQZ.js";import{u as k}from"./useMutation--SOUpC1Y.js";import{S as ae}from"./LoadingScreen-Ds0Ndjy1.js";import"./SkeletonButton-BIJr3ITb.js";import"./SkeletonInlineBlock-a8Brxge5.js";import"./SkeletonTable-Dl8AIzWW.js";import{S as oe}from"./SkeletonParagraph-DHxPNJSL.js";import{d as ce}from"./ToastMessage-CNJGC2nc.js";import{D as ie}from"./DropdownSelect-DPs-tyK1.js";import{B as d}from"./Box-C_8woQ6t.js";import{T as S}from"./Typography-C496KcFS.js";import{M as le}from"./MarkdownSynapse-D9EkkUup.js";import{u as J}from"./useTheme-5tq7elWw.js";import{L as K}from"./ListItem-b7l4pdSV.js";import{L as ue}from"./ListItemText-4LAF8fYq.js";import{c as de}from"./createSvgIcon-B4oujve6.js";import{A as $}from"./Alert-Cy2iyRT_.js";import{L as pe}from"./List-ghJioupv.js";import{T as me}from"./ButtonBase-EQYK4HG0.js";import{F as xe}from"./Fade-BbU8Qxyz.js";import{T as fe}from"./TextField-_o1u933z.js";import{I as he}from"./IconButton-CNjLAA-N.js";import{A as ge}from"./ArrowUpward-CaoBEuOA.js";const ye=de([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function Se(s){const{accessToken:i}=h();return k({mutationFn:r=>A.createAgentSession(r,i),onSuccess:async(r,a,c)=>{s!=null&&s.onSuccess&&await s.onSuccess(r,a,c)}})}function ve(s){const{accessToken:i}=h();return k({mutationFn:r=>A.updateAgentSession(r,i),onSuccess:async(r,a,c)=>{s!=null&&s.onSuccess&&await s.onSuccess(r,a,c)},onError:async(r,a,c)=>{s!=null&&s.onError&&await s.onError(r,a,c)}})}function Ae(s,i){const{accessToken:r}=h();return k({mutationFn:a=>A.getAgentChatAsyncJobResults(a,r,i),onSuccess:(a,c,l)=>{s!=null&&s.onSuccess&&a.responseBody&&s.onSuccess(a.responseBody,c,l)},onError:(a,c,l)=>{s!=null&&s.onError&&s.onError(a,c,l)}})}function Te(s,i){const{accessToken:r,keyFactory:a}=h();return ne({...i,queryKey:a.getChatAgentTraceKey(s),queryFn:()=>A.getChatAgentTraceEvents(s,r)})}const w=[{value:y.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:y.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:y.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function L({onChange:s,initAccessLevel:i}){const r=w.findIndex(n=>n.value==i),a=w.map(n=>n.label),[c,l]=o.useState(r);return e.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[e.jsx(S,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),e.jsx(ie,{variant:"outlined",options:a,selectedIndex:c,setSelectedIndex:n=>{c!==n&&(l(n),s(w[n].value))}})]})}try{L.displayName="AccessLevelMenu",L.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function v({userMessage:s,chatResponseText:i,chatErrorReason:r,scrollIntoView:a=!1}){const c=J(),l=o.useRef(null);o.useEffect(()=>{a&&l.current&&l.current.scrollIntoView({behavior:"smooth"})},[l]);const n=o.useMemo(()=>{const p=new DOMParser().parseFromString(i??"","text/html");return p.querySelectorAll("tool_name").forEach(C=>C.remove()),p.body.textContent??""},[i]);return e.jsxs(e.Fragment,{children:[e.jsx(K,{ref:l,sx:{alignSelf:"flex-end",backgroundColor:c.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(ue,{primary:s})}),n&&e.jsxs(K,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(d,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(ye,{sx:{color:"secondary.main"}})}),e.jsx(d,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"},children:e.jsx(le,{markdown:n})})]}),r&&e.jsx($,{severity:"error",sx:{my:2},children:r})]})}try{v.displayName="SynapseChatInteraction",v.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function G({initialMessage:s,agentRegistrationId:i,chatbotName:r="SynapseChat",hideTitle:a=!1,textboxPositionOffset:c="0px"}){const{accessToken:l}=h(),[n,T]=o.useState(),{mutate:p,error:I}=Se({onSuccess:t=>T(t)}),{mutate:C}=ve({onSuccess:t=>T(t),onError:t=>ce(`Unable to update the agent session: ${t.message}`,"danger")}),Q=J(),[V,X]=o.useState(y.PUBLICLY_ACCESSIBLE),[D,Z]=o.useState([]),[u,b]=o.useState(),[j,P]=o.useState(),[E,B]=o.useState(""),[R,q]=o.useState(""),[f,F]=o.useState(""),[O,ee]=o.useState(!1),[m,U]=o.useState(),{mutate:Y}=Ae({onSuccess:t=>{B(t.responseText)},onError:t=>{q(t.reason)}},t=>{P(t.jobId)}),{data:x}=Te({jobId:j,newerThanTimestamp:m==null?void 0:m.timestamp},{enabled:!!j,refetchInterval:j?1e3:!1,refetchIntervalInBackground:!0});o.useEffect(()=>{if(x&&x.page.length>0){const t=x.page[x.page.length-1],te=new DOMParser().parseFromString(t.message,"text/html").getElementsByTagName("thinking"),re=Array.from(te).map(M=>{var H;return(H=M==null?void 0:M.textContent)==null?void 0:H.trim()}).join(`
`);t.friendlyMessage=re??t.message,U(t),console.debug(x.page)}},[x]),o.useEffect(()=>{u&&(E||R)&&(u.chatResponseText=E,u.chatErrorReason=R,Z([...D,u]),B(""),q(""),b(void 0),P(void 0),U(void 0))},[E,R,u]),o.useEffect(()=>{p&&!n&&p({agentAccessLevel:V,agentRegistrationId:i})},[p,n,l]),o.useEffect(()=>{n&&s&&!O&&(b({userMessage:s}),Y({chatText:s,sessionId:n.sessionId,enableTrace:!0}),ee(!0))},[n,s,O]);const _=()=>{f.trim()&&(b({userMessage:f}),F(""),Y({chatText:f,sessionId:n.sessionId,enableTrace:!0}))},g=!n||!f||!!u,se=t=>{!g&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),_())},W=Q.palette.secondary[300];if(I)return e.jsx($,{severity:"error",sx:{my:2},children:I.reason});const N=(m==null?void 0:m.friendlyMessage)??"Processing...";return e.jsxs(d,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto"},children:[!a&&e.jsx(S,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:r}),e.jsx(L,{initAccessLevel:V,onChange:t=>{X(t),C({agentAccessLevel:t,sessionId:n.sessionId})}}),!n&&e.jsx(oe,{numRows:10}),n&&e.jsx(d,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(pe,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[D.map((t,z)=>e.jsx(v,{userMessage:t.userMessage,chatResponseText:t.chatResponseText,chatErrorReason:t.chatErrorReason},z)),u&&e.jsxs(e.Fragment,{children:[e.jsx(v,{userMessage:u.userMessage,chatResponseText:u.chatResponseText,chatErrorReason:u.chatErrorReason,scrollIntoView:!0}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"5px"},children:[e.jsx(ae,{size:40}),e.jsx(d,{sx:{position:"relative",pt:"130px"},children:e.jsx(me,{children:e.jsx(xe,{timeout:500,children:e.jsx(S,{sx:{textAlign:"center",position:"absolute",width:"100%",top:0},variant:"body1Italic",children:N})},N)})})]})]})]})}),e.jsx(d,{sx:{position:"sticky",bottom:c,backgroundColor:"white"},children:e.jsxs(d,{component:"form",sx:{pb:"10px",position:"sticky"},onSubmit:_,children:[e.jsx(fe,{fullWidth:!0,value:f,onChange:t=>F(t.target.value),onKeyDown:se,placeholder:`Message ${r}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:e.jsx(he,{disabled:g,onClick:_,sx:{ml:"7px",mr:"-8px",color:W,borderStyle:"solid",borderWidth:g?"1px":"2px",borderColor:g?"gray":W},children:e.jsx(ge,{})})}}}),e.jsxs(S,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[r," can make mistakes."]})]})})]})}try{G.displayName="SynapseChat",G.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}}}}}catch{}export{G as S};
