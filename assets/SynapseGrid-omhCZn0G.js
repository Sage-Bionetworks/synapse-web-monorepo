var Od=Object.defineProperty;var Ed=(e,t,d)=>t in e?Od(e,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[t]=d;var H=(e,t,d)=>Ed(e,typeof t!="symbol"?t+"":t,d);import{i_ as kd,i$ as Fi,da as Oe,r as P,g_ as Ad,j0 as Nd,j1 as xd,j2 as Rd,ie as Ui,j,B as ll,an as We,aI as be,J as ve,c1 as Id,j3 as Td,j4 as jd,j5 as Pd,aH as dl,dc as Md,j6 as qd,dj as Bd,d0 as Vd,j7 as $d,j8 as Jd,bB as ze,c3 as Ld,ek as M,hX as Dd,cv as Gi,c9 as we,c6 as Fd,ag as Ud,ay as Gd}from"./iframe-Djv8MYNB.js";import"./ErrorPage-C2tb2MVp.js";import"./AccessTokenPage-EN3qizaD.js";import"./AccountLevelBadges-DDeZbWfZ.js";import"./CardContainerLogic-DYNtD2op.js";import"./RowDataTable-Bb35NXXQ.js";import"./RowDataTableWithQuery-BTo2QR38.js";import"./MarkdownPopover-p5QWJMaq.js";import"./SkeletonButton-D377GQsO.js";import"./SkeletonInlineBlock-Bo6_99BY.js";import{S as Hd}from"./SkeletonTable-5bHQrafN.js";import"./SkeletonParagraph-CvIzEYe-.js";import"./CertificationAnswer-CPNZgUHx.js";import"./ChallengeDetailPage-Y6JR29mq.js";import"./index-D2AZ6sDr.js";import"./AvailableEvaluationQueueList-BWXWHPoD.js";import"./ChallengeSubmission-ClvtSnKR.js";import"./ChangePassword-BRFWzLrR.js";import"./ChangePasswordWithToken-Dwnf81Zo.js";import"./ConfirmationDialog-Cxl5Efnn.js";import"./CookiesNotification-DuJS_QzH.js";import"./DownloadCartPage-IA-Ql2Rg.js";import"./ShowDownloadV2-B5uU_l_l.js";import"./DynamicForm-BFa2phpb.js";import"./EntityBadgeIcons-B1Oi6ZIf.js";import"./EntityFinder-CnwY7J9S.js";import"./EvaluationCard-q0g2zrkb.js";import"./EvaluationEditorPage-CugAfHoG.js";import"./ExperimentalMode-DAWjc-fu.js";import"./FileUpload-DQrUtRJs.js";import"./FeaturedDataTabs-D4MKdPFB.js";import"./FeaturedToolsList-C2NGr2_i.js";import"./DiscussionThread-FxbpN8qq.js";import"./ForumPage-CYVFEXyv.js";import"./SynapseCardLabel-CPLS7LRf.js";import"./GenericCard--0sm5SFZ.js";import"./HeaderCardV2-BcphhWHJ.js";import"./CardUtils-3FMH5TaA.js";import"./Goals-Bd2IC2Yl.js";import"./GoalsV2-Bbnhk6Uc.js";import"./GoogleMap-Dar1h74Y.js";import"./HasAccessV2-tV9QHREU.js";import"./Icon-B44I_7ja.js";import"./MarkdownCollapse-Dku25O7J.js";import"./MarkdownEditor-CEJ32dGf.js";import"./MarkdownGithub-BAlF1XZv.js";import"./ModalDownload-BNCfLzvq.js";import"./InfiniteTableLayout-BFrTJbdC.js";import"./CopyToClipboardInput-BH2Xim9z.js";import"./DialogBase-Bt09srou.js";import"./WarningDialog-hYpSzh3A.js";import"./ColumnHeader-NRq3KPqg.js";import"./StyledTanStackTable-7isotsrx.js";import"./OAuthAclEditorModal-B91C2uBg.js";import"./ThemesPlot-BFS960fU.js";import"./UpsetPlot-BEKY_Es-.js";import"./SynapsePlot-5AyzzKDV.js";import"./Programs-wmQJNlRe.js";import"./ProvenanceGraph-fxuI_CSg.js";import"./ProjectDataAvailability-nkK7M8lf.js";import"./QueryContext-3wYHWecy.js";import"./QueryCount-Bk3ako84.js";import"./QueryWrapper-4HkIGy0y.js";import"./RegisterPageLogoutPrompt-CgC9aECL.js";import"./RenderIfInView-CrEt6JKM.js";import"./Resources-D9PYpB3a.js";import"./AccessRequirementAclEditor-BgrUunLq.js";import"./RssFeedCards-VBerqgHR.js";import"./ShowMore-DS0Xl-E1.js";import"./LightTooltip-CPJ4gklA.js";import"./WideButton-iFivCAit.js";import"./InputSizedButton-DCYYHUhR.js";import"./DropdownSelect-C6FyHYrY.js";import"./SubscriptionItem-BXOOrYKP.js";import"./SubsectionRowRenderer-DwoNMlb5.js";import"./SynapseFormWrapper-B5s43yWR.js";import"./SynapseFormSubmissionGrid-CQPujj0m.js";import"./SynapseTable-CH9TSm9E.js";import{u as zd,S as Wd,a as Kd}from"./SynapseChat-Gz_x5OX5.js";import"./TableFeedCards-C9B_eejr.js";import"./TermsAndConditions-D4TJt45K.js";import"./UserBadge-BO7tdhe5.js";import"./UserCardListRotate-4hLlsTAa.js";import"./UserCardListGroups-DV-t6GEd.js";import"./UserOrTeamBadge-DfEqzrbe.js";import"./UserProfileLinks-B6MmyCYN.js";import"./EntityHeaderTable-CtnVILKU.js";import"./AccessRequirementRelatedProjectsList-Br9VZ9TD.js";import"./HelpPopover-DVpvTiRQ.js";import"./SageResourcesPopover-BTuyoaGQ.js";import"./RecentPublicationsGrid-XVAxoBHi.js";import"./ImageCardGridWithLinks-BLCTZ9c7.js";import"./PortalFeatureHighlights-B4tuMem7.js";import"./CreatePortalModal-OmDA-0US.js";import"./PortalSectionHeader-CZSibFmT.js";import{C as Yd}from"./CsvPreviewDialog-BiqhH1t8.js";import{w as Nr}from"./waitForAsyncResult-2GUI2rev.js";import{u as Xd}from"./upperFirst-C__UvDGh.js";import{u as xr,r as Qd}from"./useEntity-D1Vbp73T.js";import{b as Hi}from"./useSchema-DxolivkT.js";import{G as Zd,p as ef,D as tf,r as nf}from"./DataGrid-OekgKrdW.js";import{e as rf}from"./useUserBundle-tM9bsliG.js";import{B as zi,P as sf}from"./enums-BUyp-lYE.js";import{a as of,d as ae}from"./index-r8ZA1smB.js";import{g as cf}from"./_baseIteratee-DzOJkO1l.js";import{t as af}from"./useUploadFiles-BtJwj8H6.js";import{D as uf}from"./DraggableDialog-CnB0deyU.js";import{K as Wi}from"./KeyboardArrowDown-L-reAL9u.js";import{M as ir}from"./MenuItem-B1PtcVYM.js";import{u as lf,a as df,b as ff,c as hf}from"./useGridSession-Bzxj5Rwp.js";import{A as pf}from"./Autocomplete-DSkDcqCY.js";import{G as ee}from"./Grid-SmLd1_qQ.js";import{C as mf}from"./CertificationRequirement-CoJYh1_r.js";var Lr=function(){return kd.Date.now()},bf="Expected a function",gf=Math.max,yf=Math.min;function vf(e,t,d){var a,n,u,r,o,s,c=0,i=!1,f=!1,m=!0;if(typeof e!="function")throw new TypeError(bf);t=Fi(t)||0,Oe(d)&&(i=!!d.leading,f="maxWait"in d,u=f?gf(Fi(d.maxWait)||0,t):u,m="trailing"in d?!!d.trailing:m);function p(C){var O=a,k=n;return a=n=void 0,c=C,r=e.apply(k,O),r}function v(C){return c=C,o=setTimeout(l,t),i?p(C):r}function y(C){var O=C-s,k=C-c,S=t-O;return f?yf(S,u-k):S}function b(C){var O=C-s,k=C-c;return s===void 0||O>=t||O<0||f&&k>=u}function l(){var C=Lr();if(b(C))return h(C);o=setTimeout(l,y(C))}function h(C){return o=void 0,m&&a?p(C):(a=n=void 0,r)}function w(){o!==void 0&&clearTimeout(o),c=0,a=s=n=o=void 0}function g(){return o===void 0?r:h(Lr())}function _(){var C=Lr(),O=b(C);if(a=arguments,n=this,s=C,O){if(o===void 0)return v(s);if(f)return clearTimeout(o),o=setTimeout(l,t),p(s)}return o===void 0&&(o=setTimeout(l,t)),r}return _.cancel=w,_.flush=g,_}var wf="Expected a function";function _f(e,t,d){var a=!0,n=!0;if(typeof e!="function")throw new TypeError(wf);return Oe(d)&&(a="leading"in d?!1:a,n="trailing"in d?!0:n),vf(e,t,{leading:a,maxWait:t,trailing:n})}function Cf(e=!1){const t=P.useRef(e),d=P.useCallback(()=>t.current,[]);return P.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),d}function Sf(e){P.useEffect(()=>{e()},[])}function Of(e,...t){const d=Cf(),a=Ad(t[1]),n=P.useMemo(()=>function(...u){d()&&(typeof a.current=="function"?a.current.apply(this,u):typeof a.current.handleEvent=="function"&&a.current.handleEvent.apply(this,u))},[]);P.useEffect(()=>{const u=Ef(e)?e.current:e;if(!u)return;const r=t.slice(2);return Nd(u,t[0],n,...r),()=>{xd(u,t[0],n,...r)}},[e,t[0]])}function Ef(e){return e!==null&&typeof e=="object"&&Rd(e,"current")}const Dr=()=>document.visibilityState==="visible";function kf(e=!0){const[t,d]=P.useState(Ui&&e?Dr():void 0);return Sf(()=>{e||d(Dr())}),Of(Ui?document:null,"visibilitychange",()=>{d(Dr())}),t}const Af="_button_185qd_17",Nf={button:Af};function Ue(e){return j.jsx(ll,{...e,className:Nf.button})}try{Ue.displayName="GridMenuButton",Ue.__docgenInfo={description:"",displayName:"GridMenuButton",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}function xf(e){const{synapseClient:t}=We();return be({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridImportCsvAsyncStart({gridCsvImportRequest:d});return(await Nr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function mi({createdCount:e=0,updatedCount:t=0}){let d="";return e>0&&(d+=`created ${e.toLocaleString()} rows`),e>0&&t>0?d+=" and ":t==0&&(d+="."),t>0&&(d+=`updated ${t.toLocaleString()} rows.`),Xd(d)}function bi(e){const{gridSessionId:t,open:d,onClose:a,onComplete:n}=e,{mutate:u,isPending:r,error:o}=xf({onSuccess:s=>{ve(mi(s),"success",{title:"Data imported successfully"}),n()}});return j.jsx(Yd,{open:d,onClose:a,onConfirm:(s,c,i)=>{u({concreteType:"org.sagebionetworks.repo.model.grid.GridCsvImportRequest",sessionId:t,fileHandleId:s,csvDescriptor:i,schema:c})},errorMessage:o==null?void 0:o.message,confirmIsPending:r})}try{mi.displayName="getUpdateMessage",mi.__docgenInfo={description:"",displayName:"getUpdateMessage",props:{concreteType:{defaultValue:null,description:"@memberof GridCsvImportResponse",name:"concreteType",required:!0,type:{name:"{string}"}},sessionId:{defaultValue:null,description:`The grid session ID.
@memberof GridCsvImportResponse`,name:"sessionId",required:!1,type:{name:"{string}"}},totalCount:{defaultValue:null,description:`The total number of processed rows.
@memberof GridCsvImportResponse`,name:"totalCount",required:!1,type:{name:"{number}"}},createdCount:{defaultValue:{value:"0"},description:`The number of newly created rows in the grid.
@memberof GridCsvImportResponse`,name:"createdCount",required:!1,type:{name:"{number}"}},updatedCount:{defaultValue:{value:"0"},description:`The number of updated rows in the grid.
@memberof GridCsvImportResponse`,name:"updatedCount",required:!1,type:{name:"{number}"}}}}}catch{}try{bi.displayName="UploadCsvToGridDialog",bi.__docgenInfo={description:"",displayName:"UploadCsvToGridDialog",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},onComplete:{defaultValue:null,description:"",name:"onComplete",required:!0,type:{name:"() => void"}}}}}catch{}function gi(e){const{sourceEntityId:t,gridSessionId:d}=e,[a,n]=P.useState(!1),{data:u,isLoading:r}=xr(t);return r?j.jsx(Id,{variant:"rectangular",width:100}):u&&!Td(u)?null:j.jsxs(j.Fragment,{children:[a&&j.jsx(bi,{gridSessionId:d,open:a,onClose:()=>n(!1),onComplete:()=>n(!1)}),j.jsx(Ue,{onClick:()=>{n(!0)},variant:"outlined",startIcon:j.jsx(jd,{}),children:"Upload"})]})}try{gi.displayName="UploadCsvToGridButton",gi.__docgenInfo={description:"",displayName:"UploadCsvToGridButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}const Rf=Object.prototype;function or(e){for(const t in e)if(Rf.hasOwnProperty.call(e,t))return!1;return!0}const If=["array","boolean","integer","null","number","object","string"];new Set(If);const Tf=["$defs","definitions","properties","patternProperties","dependencies"];new Set(Tf);const jf=["items","allOf","oneOf","anyOf"];new Set(jf);const Pf=["items","additionalItems","additionalProperties","propertyNames","contains","if","then","else","not"];new Set(Pf);function Er(e){return typeof e=="object"}function me(e){return Er(e)?or(e):e===!0}function He(e,t){return e<t?-1:e>t?1:0}function Fr(e,t){const d=e.length;if(d===0)return t;let a=t.length;if(a===0)return e;if(d<a){const u=e;e=t,t=u,a=d}const n=new Set(e);for(let u=0;u<a;u++)n.add(t[u]);return Array.from(n)}function Mf(e,t){const d=[];if(e.length===0||t.length===0)return d;if(e.length>t.length){const n=e;e=t,t=n}const a=new Set(t);for(let n=0;n<e.length&&a.size>0;n++){const u=e[n];a.delete(u)&&d.push(u)}return d}function Ki(e){return e.length===0}function Ur(e){return(t,d)=>{const a=t.length-d.length;if(a!==0)return a;for(let n=0;n<t.length;n++)if(t[n]!==d[n]){const u=e(t[n],d[n]);if(u!==0)return u}return 0}}function fl(e,{threshold:t=12}={}){return d=>{const a=d.length;if(a===0)return d;if(a<=t){const r=[];let o=0;e:for(let s=0;s<a;s++){const c=d[s];for(let i=0;i<o;i++)if(e(c,r[i])===0)continue e;o=r.push(c)}return r}const n=d.slice().sort(e);let u=0;for(let r=1;r<a;r++)e(n[u],n[r])!==0&&++u!==r&&(n[u]=n[r]);return n.length=u+1,n}}function qf(e){return(t,d)=>{const a=[];let n=t.length,u=d.length;if(n===0||u===0)return a;if(n>u){const i=t;t=d,d=i;const f=n;n=u,u=f}const r=[...t].sort(e),o=[...d].sort(e);let s=0,c=0;for(;s<n&&c<u;){const i=e(r[s],o[c]);i===0?((a.length===0||e(a[a.length-1],r[s])!==0)&&a.push(r[s]),s++,c++):i<0?s++:c++}return a}}function Bf(e,t){return d=>{if(e.has(d))return e.get(d);const a=t(d);return e.set(d,a),a}}const Yi=Bf,hl=()=>0,Vf=e=>e===void 0,$f=e=>typeof e!="object",Xi={boolean:0,number:1,string:2};function Jf(e,t){const d=typeof e,a=typeof t;return d===a?He(e,t):Xi[d]-Xi[a]}function Lf(e,t){const d=e.length;if(d===0)return t;const a=t.length;if(a===0)return e;if(a>d){const r=e;e=t,t=r}const n=new Set(e),u=t.length;for(let r=0;r<u;r++){const o=t[r];n.has(o)||e.push(o)}return e}function Rr(e,t,d=hl){return(a,n)=>e(a)?e(n)?d(a,n):-1:e(n)?1:t(a,n)}function Ge(e){return Rr(Vf,e)}function Se(e,t){return Rr(d=>d===void 0||e(d),t)}function Gr(e,t){return Rr(Array.isArray,e,t)}const X=Ge(He),Hr=Se(e=>e===0,(e,t)=>e-t);function Df({deduplicationCache:e=new WeakMap,sortedKeysCache:t=new WeakMap}={}){const d=Yi(t,y=>Object.keys(y).sort());function a(y){return(b,l)=>{const h=d(b),w=d(l),g=Math.min(h.length,w.length);for(let _=0;_<g;_++){const C=He(h[_],w[_]);if(C!==0)return C}if(h.length!==w.length)return h.length-w.length;for(let _=0;_<g;_++){const C=h[_],O=y(b[C],l[C]);if(O!==0)return O}return 0}}function n(y){const b=Ur(y),l=Yi(e,fl(y,{threshold:0}));return(h,w)=>b(l(h),l(w))}const u=n(He);function r(y,b){if(Er(y)){if(Er(b)){const l=Object.keys(y),h=Object.keys(b),w=Lf(l,h),g=w.length;for(let _=0;_<g;_++){const C=w[_];if(y[C]===b[C])continue;const k=(v[C]??o)(y[C],b[C]);if(k!==0)return k}return 0}return b===!0&&or(y)?0:1}return Er(b)?y===!0&&or(b)?0:-1:He(y,b)}const o=Ge(c),s=Rr($f,Gr(a(o),Ur(c)),Jf);function c(y,b){return y===null?-1:b===null?1:s(y,b)}const i=Ge(r),f=Se(or,a(i)),m=Ge(n(r)),p=Se(me,r),v={$id:X,$comment:X,$defs:f,$ref:X,$schema:X,const:o,contains:i,contentEncoding:X,contentMediaType:X,default:o,definitions:f,description:X,else:i,examples:o,exclusiveMaximum:X,exclusiveMinimum:X,format:X,if:i,maximum:X,maxItems:X,maxLength:X,maxProperties:X,minimum:X,multipleOf:X,not:i,pattern:X,propertyNames:i,readOnly:X,then:i,title:X,writeOnly:X,uniqueItems:Se(y=>y===!1,hl),minLength:Hr,minItems:Hr,minProperties:Hr,required:Se(Ki,u),enum:Se(Ki,n(c)),type:Ge((y,b)=>{const l=Array.isArray(y),h=Array.isArray(b);return!l&&!h?He(y,b):u(l?y:[y],h?b:[b])}),items:Se(y=>!Array.isArray(y)&&me(y),Gr(r,Ur(r))),anyOf:m,allOf:m,oneOf:m,properties:f,patternProperties:f,additionalProperties:p,additionalItems:p,dependencies:Se(or,a(Ge(Gr(r,u))))};return{compareSchemaValues:c,compareSchemaDefinitions:r}}function Qi(e){return e}const pl=(e,t)=>e?pl(t%e,e):t,Ff=(e,t)=>Math.abs(e*t)/pl(e,t);function Uf(e,t){return e===t?e:`^(?=.*(?:${e}))(?=.*(?:${t})).*$`}function*zr(e,t,d){const a=e.length,n=t.length;if(a>0&&n>0)for(let u=0;u<a;u++){const r=e[u];for(let o=0;o<n;o++)yield d(r,t[o])}}function Wr(e,t){return e||t}function Zi(e){return(t,d)=>{const a={...t},n=Object.keys(d),u=n.length;for(let r=0;r<u;r++){const o=n[r];a[o]=t[o]===void 0?d[o]:e(t[o],d[o])}return a}}function Gf(e){const t=new Map;for(const d of e)for(const a of d[0])t.set(a,d[1]);return t}function xe(e,t,d){d===void 0||me(d)?delete e[t]:e[t]=d}const Hf=["properties","patternProperties","additionalProperties"];function eo(e){const t=Object.keys(e),d=t.length,a=[];for(let n=0;n<d;n++){const u=t[n];a.push({regExp:new RegExp(u),schema:e[u]})}return[a,t]}const to=[[],[]];function no(e,t,d){const a=d.length;for(let n=0;n<a;n++){const u=d[n];if(!u.regExp.test(t))continue;const r=u.schema;if(r===!1)return!0;e.push(r)}return!1}const zf=["items","additionalItems"],Wf=["if","then","else"];function ro(e,t){return t.if!==void 0&&(e.if=t.if),t.then!==void 0&&(e.then=t.then),t.else!==void 0&&(e.else=t.else),e}function Kr(e,t){if(e===t)return e;switch(e){case"number":if(t==="integer")return"integer";case"integer":if(t==="number")return"integer";default:return}}function Re(e,t,d){return[e,t,d]}function Kf(e){const t=new Map;for(const[d,a,n]of e){const u=r=>{if(!n(r))throw new Error(`Schema keys '${d}' and '${a}' are conflicting (${d}: ${JSON.stringify(r[d])}, ${a}: ${JSON.stringify(r[a])})`)};for(const r of[[d,a],[a,d]]){let o=t.get(r[0]);o===void 0&&(o=[],t.set(r[0],o)),o.push({oppositeKey:r[1],check:u})}}return t}const Yf=[Re("minimum","maximum",e=>e.maximum>=e.minimum),Re("exclusiveMinimum","maximum",e=>e.maximum>e.exclusiveMinimum),Re("minimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.minimum),Re("exclusiveMinimum","exclusiveMaximum",e=>e.exclusiveMaximum>e.exclusiveMinimum),Re("minLength","maxLength",e=>e.maxLength>=e.minLength),Re("minItems","maxItems",e=>e.maxItems>=e.minItems),Re("minProperties","maxProperties",e=>e.maxProperties>=e.minProperties)];function Xf({mergePatterns:e=Uf,isSubRegExp:t=Object.is,intersectJson:d=Mf,deduplicateJsonSchemaDef:a=Qi,defaultMerger:n=Qi,assigners:u=[],checks:r=Yf,mergers:o}={}){function s(g){const _=g.length;let C=g[0];for(let O=1;O<_;O++){const k=l(C,g[O]);if(k===!1)return!1;me(k)||(C=k)}return C}function c(g,_,C,O,k,S,E){if(g.length=0,C===!1)return!1;if(g.push(C),k!==void 0){if(k===!1)return!1;g.push(k)}if(no(g,_,S))return!1;const N=g.length<2;if(E===!1){if(N)return;if(no(g,_,O))return!1}else N&&E!==void 0&&g.push(E);return g.length===1?g[0]:s(g)}function i(g,_,C,O,k,S){const E=C.length;if(E>0&&k!==!1)if(S)Object.assign(g,_);else for(let A=0;A<E;A++){const N=C[A];O.has(N)||(g[N]=l(_[N],k))}return g}const f=(g,{properties:_={},patternProperties:C,additionalProperties:O=!0},{properties:k={},patternProperties:S,additionalProperties:E=!0})=>{const A=me(O),N=me(E);if(A&&N)return xe(g,"properties",h(_,k)),xe(g,"patternProperties",C&&S?h(C,S):C??S),delete g.additionalProperties,g;const x=l(O,E);xe(g,"additionalProperties",x);const I={},R=Object.keys(_),T=R.length,[q,B]=C?eo(C):to,[$,L]=S?eo(S):to,F=[],V=new Set,Q=N?void 0:E;for(let U=0;U<T;U++){const W=R[U];V.add(W);const ne=c(F,W,_[W],q,k[W],$,Q);ne!==void 0&&(I[W]=ne)}const ce=Object.keys(k),se=ce.length,ge=A?void 0:O;for(let U=0;U<se;U++){const W=ce[U];if(V.has(W))continue;const ne=c(F,W,k[W],$,void 0,q,ge);ne!==void 0&&(I[W]=ne)}xe(g,"properties",I);let ie={};const G=new Set;if(B.length>0&&L.length>0){const U=zr(B,L,(W,ne)=>{t(W,ne)&&G.add(W),t(ne,W)&&G.add(ne),ie[e(W,ne)]=l(C[W],S[ne])});for(;!U.next().done;);}return ie=i(ie,C,B,G,E,N),ie=i(ie,S,L,G,O,A),xe(g,"patternProperties",ie),g},m=(g,{items:_=[],additionalItems:C},{items:O=[],additionalItems:k})=>{const S=Array.isArray(_),E=Array.isArray(O),A=[];if(g.items=A,S&&E){const[N,x,I]=_.length<O.length?[_.length,C,O]:[O.length,k,_];let R=0;for(;R<N;R++)A.push(l(_[R],O[R]));if(x===!1)g.additionalItems=!1;else{const T=x===void 0||me(x);for(;R<I.length;R++)A.push(T?I[R]:l(I[R],x));xe(g,"additionalItems",C!==void 0&&k!==void 0?l(C,k):C??k)}}else if(S||E){const[N,x,I]=S?[_,O,C]:[O,_,k];xe(g,"additionalItems",I&&l(I,x));for(let R=0;R<N.length;R++)A.push(l(N[R],x))}else delete g.additionalItems,g.items=l(_,O);return g},p=(g,_,C)=>{ro(g,_);const O=ro({},C);return g.allOf===void 0?g.allOf=[O]:g.allOf=g.allOf.concat(O),g};function v(g,_){return a(Array.from(zr(g,_,l)))}const y=Gf([[Hf,f],[zf,m],[Wf,p],...u]),b=Kf(r);function l(g,_){if(g===!1||_===!1)return!1;if(me(g))return me(_)?!0:_;if(me(_))return g;let C={...g};const O=new Set,k=new Set,S=Object.keys(_),E=S.length;for(let A=0;A<E;A++){const N=S[A],x=_[N];if(x===void 0)continue;const I=b.get(N);if(I!==void 0){const B=I.length;for(let $=0;$<B;$++){const L=I[$];g[L.oppositeKey]!==void 0&&k.add(L.check)}}const R=g[N];if(R===void 0){C[N]=x;continue}const T=y.get(N);if(T){O.add(T);continue}const q=w[N]??n;C[N]=q(R,x)}for(const A of O)C=A(C,g,_);for(const A of k)A(C);return C}const h=Zi(l),w={$id:n,$ref:n,$schema:n,$comment:n,$defs:h,definitions:h,type:(g,_)=>{if(g===_)return g;const C=Array.isArray(g),O=Array.isArray(_);if(!C&&!O){const k=Kr(g,_);if(k!==void 0)return k}else if(C||O){const k=new Set;if(C&&O)for(const E of zr(g,_,Kr))E!==void 0&&k.add(E);else{const E=C?g:_,A=C?_:g,N=E.length;for(let x=0;x<N;x++){const I=Kr(A,E[x]);I!==void 0&&k.add(I)}}const S=k.size;if(S===1)return k.values().next().value;if(S>1)return Array.from(k)}throw new Error(`It is not possible to create an intersection of the following incompatible types: ${g.toString()}, ${_.toString()}`)},default:n,description:n,title:n,const:n,format:n,contentEncoding:n,contentMediaType:n,not:(g,_)=>{const C=a([g,_]);return C.length===1?C[0]:{anyOf:C}},pattern:e,readOnly:Wr,writeOnly:Wr,enum:(g,_)=>{const C=d(g,_);if(C.length===0)throw new Error(`Intersection of the following enums is empty: "${JSON.stringify(g)}", "${JSON.stringify(_)}"`);return C},anyOf:v,oneOf:v,allOf:(g,_)=>a(g.concat(_)),propertyNames:l,contains:l,dependencies:Zi((g,_)=>Array.isArray(g)?Array.isArray(_)?Fr(g,_):l(_,{required:g}):Array.isArray(_)?l(g,{required:_}):l(g,_)),examples:(g,_)=>{if(!Array.isArray(g)||!Array.isArray(_))throw new Error(`Value of the 'examples' field should be an array, but got "${JSON.stringify(g)}" and "${JSON.stringify(_)}"`);return Fr(g,_)},multipleOf:(g,_)=>{let C=1;for(;!Number.isInteger(g)||!Number.isInteger(_);)C*=10,g*=10,_*=10;return Ff(g,_)/C},exclusiveMaximum:Math.min,maximum:Math.min,maxItems:Math.min,maxLength:Math.min,maxProperties:Math.min,exclusiveMinimum:Math.max,minimum:Math.max,minItems:Math.max,minLength:Math.max,minProperties:Math.max,uniqueItems:Wr,required:Fr,...o};return{mergeSchemaDefinitions:l,mergeArrayOfSchemaDefinitions:s}}function Qf(e){const t=[],d=[e];for(;d.length>0;){const a=d.pop();if(typeof a=="boolean"||a.allOf===void 0){t.push(a);continue}const{allOf:n,...u}=a;t.push(u);for(let r=n.length-1;r>=0;r--)d.push(n[r])}return t}function Zf(e){return t=>e(Qf(t))}const{compareSchemaDefinitions:eh,compareSchemaValues:th}=Df(),{mergeArrayOfSchemaDefinitions:nh}=Xf({intersectJson:qf(th),deduplicateJsonSchemaDef:fl(eh)}),rh=Zf(nh),sh=["id","createdBy","createdOn","modifiedBy","modifiedOn","etag","concreteType","parentId"];function ih(e){if(!e.properties)return e;const t={...e.properties};return sh.forEach(a=>{t[a]&&(t[a]={...Oe(t[a])?t[a]:{},readOnly:!0})}),{...e,properties:t}}function oh(e){const{data:t}=Hi((e==null?void 0:e.gridJsonSchema$Id)??"",{enabled:!!(e!=null&&e.gridJsonSchema$Id)}),{data:d}=xr(e==null?void 0:e.sourceEntityId,void 0,{enabled:!!(e!=null&&e.sourceEntityId)});let a=!1;d&&Pd(d)&&(a=!0);const{data:n}=Hi("org.sagebionetworks-repo.model.Entity",{enabled:a,select:ih});return t&&n?rh({allOf:[n,t]}):t}function ch(e){const{synapseClient:t}=We();return be({...e,mutationFn:async d=>{const a=await t.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:d});return(await Nr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:a.token}))).responseBody}})}function ah(e){const{keyFactory:t,synapseClient:d}=We(),a=dl();return be({...e,mutationFn:async n=>{const u=await d.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:n.entityId,tableUpdateTransactionRequest:n});return(await Nr(()=>d.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:u.token}))).responseBody},onSuccess:async(n,u,r)=>{await Md(a,t,u.entityId)}})}function uh(e){const t=dl(),{mutateAsync:d}=ch(),{mutateAsync:a}=ah(),n=Qd();return be({...e,mutationFn:async({gridSessionId:u,sourceEntityId:r})=>{const o=await t.fetchQuery(n(r)),s={...lh(o),sessionId:u},c=await d(s),i={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:r,changes:[{uploadFileHandleId:c.resultsFileHandleId,tableId:r,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return a(i)}})}function lh(e){return qd(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}function dh(e){const{synapseClient:t}=We();return be({...e,mutationFn:async({gridSessionId:d})=>{const a={sessionId:d,concreteType:"org.sagebionetworks.repo.model.grid.GridRecordSetExportRequest"},n=await t.gridServicesClient.postRepoV1GridExportRecordsetAsyncStart({gridRecordSetExportRequest:a});return(await Nr(()=>t.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:n.token}))).responseBody}})}function fh(e){const t=uh(),d=dh();return be({...e,mutationFn:async({gridSessionId:a,sourceEntityId:n,sourceEntityType:u})=>u===Bd.recordset?{type:"recordset",data:await d.mutateAsync({gridSessionId:a})}:{type:"table",data:await t.mutateAsync({gridSessionId:a,sourceEntityId:n})}})}function yi(e){const{sourceEntityId:t,gridSessionId:d}=e,{data:a,isLoading:n}=xr(t),u=a!=null&&a.concreteType?Vd(a.concreteType):void 0,{mutate:r,isPending:o}=fh({onSuccess:s=>{s.type==="table"?hh(s.data):ve("Successfully updated RecordSet.","success")},onError:s=>ve(s.message,"danger")});return j.jsx(Ue,{loading:o,disabled:n,onClick:()=>r({gridSessionId:d,sourceEntityId:t,sourceEntityType:u}),variant:"contained",children:"Apply changes"})}function hh(e){var t,d;if((t=e.results)!=null&&t.length){const a=e.results[0];if($d(a)){const n=ph(a).join(`
`);n?ve(`Some changes could not be applied:
${n}`,"danger"):ve("Changes applied successfully","success")}else if(Jd(a)){const n=(d=a.rowsProcessed)==null?void 0:d.toLocaleString();ve(`Successfully updated ${n} rows.`,"success")}}}function ph(e){var t;return((t=e.updateResults)==null?void 0:t.filter(d=>!!d.failureCode).map(d=>`${d.entityId}: ${d.failureMessage} (code: ${d.failureCode})`))??[]}try{yi.displayName="MergeGridWithSourceTableButton",yi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},sourceEntityType:{defaultValue:null,description:"",name:"sourceEntityType",required:!1,type:{name:"enum",value:[{value:'"link"'},{value:'"table"'},{value:'"file"'},{value:'"folder"'},{value:'"entityview"'},{value:'"submissionview"'},{value:'"dataset"'},{value:'"datasetcollection"'},{value:'"project"'},{value:'"dockerrepo"'},{value:'"materializedview"'},{value:'"virtualtable"'},{value:'"recordset"'}]}}}}}catch{}function mh(e,t){const d={},a=t.api.getSnapshot();if(so(a.rows,e.min.row,e.max.row))d.rowSelectAll=!0;else{const n=t.api.arr(["rows"]);d.rowSelection=io(n,e.min.row,e.max.row)}if(so(a.columnOrder,e.min.col,e.max.col))d.columnSelectAll=!0;else{const n=t.api.arr(["columnOrder"]);d.columnSelection=io(n,e.min.col,e.max.col)}return d}function so(e,t,d){return t===0&&d===e.length-1}function io(e,t,d){const a=[];for(let n=t;n<=d;n++){const u=e.node.findChunk(n);if(u){const[r,o]=u;a.push({rep:r.id.sid,seq:r.id.time+o})}else console.warn(`getCrdtIdsForArrayRange: No chunk found for array index ${n}. This may indicate an unexpected state.`)}return a}function bh(e,t){var n;let d;try{d=e.api.con(["rows",String(t),"metadata","rowValidation"])}catch{return!1}const a=(n=d==null?void 0:d.node)==null?void 0:n.id;try{const u=e.api.vec(["rows",String(t),"data"]);for(let r=0;r<(u==null?void 0:u.length());r++)if(u.get(r).asCon().node.id.time>(a==null?void 0:a.time))return!1}catch{}return!0}function gh(e){return`[${e.sid},${e.time}]`}function yh(e){var a;const t=new Map,d=/^#(?:\/([^/:]+)(?:\/\d+)?)?:\s*(.*)$/;for(const n of e){if(typeof n!="string")continue;const r=n.trimStart().match(d);if(r){let o=((a=r[1])==null?void 0:a.trim())??"_row";const s=r[2].trim();if(o==="_row"){const c=s.match(/^required key \[([^\]]+)\] not found$/i);c&&(o=c[1])}t.has(o)||t.set(o,[]),t.get(o).push(s)}}return t}function vh(e,t){if(!e||!t)return[];const{columnNames:d,columnOrder:a,rows:n}=t;return n.map((r,o)=>{var c,i,f;const s={};return a.forEach(m=>{const p=d[m];p&&(s[p]=r.data[m])}),s[Zd]=gh(e.api.obj(["rows",String(o)]).node.id),s.__validationResults=(c=r.metadata)==null?void 0:c.rowValidation,s.__validationResults&&(s.__validationStatus=(i=s.__validationResults)!=null&&i.isValid?"valid":"invalid"),bh(e,o)||(s.__validationStatus="pending"),(f=s.__validationResults)!=null&&f.allValidationMessages&&(s.__cellValidationResults=yh(s.__validationResults.allValidationMessages)),s})}function wh(e){return Oe(e)&&"type"in e&&(e.type=="null"||Ld(e.type,["null"]))}function ml(e){if(e!=null&&e.oneOf&&ze(e.oneOf)){const t=e.oneOf.filter(d=>!wh(d));if(t.length==1&&Oe(t[0]))return t[0]}}function _h(e){return{value:e.value}}function Ch(e){return ze(e)&&e.every(t=>Oe(t)&&"const"in t)}function oo(e){let t=[];if(e.type==="boolean")return[{value:!0},{value:!1}];try{if(e!=null&&e.oneOf&&ze(e.oneOf)&&!Ch(e.oneOf)){const d=ml(e);d&&Object.hasOwn(d,"enum")&&(t=zi(d)||[])}else t=zi(e)||[]}catch(d){console.error("Error getting enumerated values from schema",d,e)}return t.map(_h)}function Sh(e,t){return cf(e,[sf,t],{})}function Oh(e){if(!e||!Oe(e))return[];const t=new Set,d=new Set;function a(n){if(!(!Oe(n)||d.has(n))){if(d.add(n),ze(n.required))for(const u of n.required)typeof u=="string"&&t.add(u);["allOf"].forEach(u=>{const r=n[u];ze(r)&&r.forEach(o=>a(o))})}}return a(e),Array.from(t)}function vi(e){if(e.type){if(e.type==="array"&&e.items){const t=Array.isArray(e.items)?e.items[0]:e.items;return{...vi(t)??{type:"string",isArray:!1},isArray:!0}}return{type:e.type,format:e.format,isArray:!1,readOnly:e.readOnly}}if(e!=null&&e.oneOf&&ze(e.oneOf)){const t=ml(e);if(t)return vi(t)}}function Eh(e){if(!e)return{};const t=Oh(e),d={};return e.properties&&Object.keys(e.properties).forEach(a=>{const n=Sh(e,a),u=vi(n);let r=oo(n).map(o=>o.value);if(r.length===0&&n&&n.items){const o=Array.isArray(n.items)?n.items[0]:n.items;r=oo(o).map(s=>s.value)}d[a]={type:u,isRequired:t.includes(a),enumeratedValues:r.length>0?r:null}}),d}var Yr={};const J=of(af);var Ze={},et={},co;function ar(){if(co)return et;co=1,Object.defineProperty(et,"__esModule",{value:!0}),et.context=void 0;const e=M();return et.context=e.createContext(null),et}var Xr={},ao;function te(){return ao||(ao=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useStyles=e.context=void 0;const t=M();e.context=t.createContext({});const d=()=>t.useContext(e.context);e.useStyles=d}(Xr)),Xr}var Qr={},Zr={},es={},ts={},uo;function kh(){return uo||(uo=1,Object.defineProperty(ts,"__esModule",{value:!0})),ts}var de={},lo;function Ah(){if(lo)return de;lo=1,Object.defineProperty(de,"__esModule",{value:!0}),de.COLOR=de.SYMBOL=de.ZINDEX=de.SIZE=void 0;var e;(function(n){n[n.SITE_WIDTH=1300]="SITE_WIDTH",n[n.SITE_PADDING=32]="SITE_PADDING",n[n.PAGE_WIDTH=1e3]="PAGE_WIDTH",n[n.TOP_NAV_HEIGHT=64]="TOP_NAV_HEIGHT",n[n.SIDEBAR_WIDTH=300]="SIDEBAR_WIDTH"})(e||(de.SIZE=e={}));var t;(function(n){n[n.TOP_NAV=1e3]="TOP_NAV",n[n.SIDEBAR=1001]="SIDEBAR",n[n.CONTEXT=1002]="CONTEXT",n[n.PROGRESS=2e3]="PROGRESS",n[n.MODAL=4e3]="MODAL",n[n.CURSOR=1e6]="CURSOR"})(t||(de.ZINDEX=t={}));var d;(function(n){n.CHECKMARK="✓",n.CROSS="✗",n.NIL="∅",n.ELLIPSIS="…",n.MDASH="—",n.NDASH="–",n.FDASH="‒",n.CTRL="⌃",n.CMD="⌘",n.ALT="⌥",n.SHIFT="⇧"})(d||(de.SYMBOL=d={}));var a;return function(n){n.LINK="#0089ff"}(a||(de.COLOR=a={})),de}var ns={},rs={},fo;function ho(){if(fo)return rs;fo=1;var e=/[A-Z]/g,t=function(d){for(var a=5381,n=d.length;n;)a=a*33^d.charCodeAt(--n);return"_"+(a>>>0).toString(36)};return rs.create=function(d){d=d||{};var a=d.assign||Object.assign,n=typeof window=="object",u=a({raw:"",pfx:"_",client:n,assign:a,stringify:JSON.stringify,kebab:function(r){return r.replace(e,"-$&").toLowerCase()},decl:function(r,o){return r=u.kebab(r),r+":"+o+";"},hash:function(r){return t(u.stringify(r))},selector:function(r,o){return r+(o[0]===":"?"":" ")+o},putRaw:function(r){u.raw+=r}},d);return u.client&&(u.sh||document.head.appendChild(u.sh=document.createElement("style")),u.putRaw=function(r){{var o=u.sh.sheet;try{o.insertRule(r,o.cssRules.length)}catch{}}}),u.put=function(r,o,s){var c="",i,f,m=[];for(i in o)f=o[i],f instanceof Object&&!(f instanceof Array)?m.push(i):c+=u.decl(i,f,r,s);c&&(c=r+"{"+c+"}",u.putRaw(s?s+"{"+c+"}":c));for(var p=0;p<m.length;p++)i=m[p],i[0]==="@"&&i!=="@font-face"?u.putAt(r,o[i],i):u.put(u.selector(r,i),o[i],s)},u.putAt=u.put,u},rs}var ss={},po;function Nh(){return po||(po=1,ss.addon=function(e){var t={};e.cache=function(d){if(!d)return"";var a=e.hash(d);return t[a]||(t[a]=e.rule(d,a)),t[a]}}),ss}var is={},os,mo;function xh(){if(mo)return os;mo=1;var e=Object.keys,t=JSON.stringify;function d(a,n){var u,r,o,s,c,i,f;if(f=typeof a,f==="string")return t(a);if(a===!0)return"true";if(a===!1)return"false";if(a===null)return"null";if(a instanceof Array){for(o="[",r=a.length-1,u=0;u<r;u++)o+=d(a[u],!1)+",";return r>-1&&(o+=d(a[u],!1)),o+"]"}if(a instanceof Object){if(typeof a.toJSON=="function")return d(a.toJSON(),n);for(s=e(a).sort(),r=s.length,o="",u=0;u<r;)c=s[u],i=d(a[c],!0),i!==void 0&&(u&&o!==""&&(o+=","),o+=t(c)+":"+i),u++;return"{"+o+"}"}switch(f){case"function":case"undefined":return n?void 0:null;default:return isFinite(a)?a:null}}return os=function(a){return""+d(a,!1)},os}var bo;function Rh(){if(bo)return is;bo=1;var e=xh();return is.addon=function(t){t.stringify=e},is}var cs={},go;function Ih(){return go||(go=1,cs.addon=function(e){e.selector=function(t,d){var a=t.split(","),n=[],u=d.split(","),r=a.length,o=u.length,s,c,i,f,m,p;for(s=0;s<o;s++)if(i=u[s],f=i.indexOf("&"),f>-1)for(c=0;c<r;c++)m=a[c],p=i.replace(/&/g,m),n.push(p);else for(c=0;c<r;c++)m=a[c],m?n.push(m+" "+i):n.push(i);return n.join(",")}}),cs}var br={},yo;function Th(){if(yo)return br;yo=1;var e="position",t="top",d="right",a="bottom",n="left",u="width",r="height",o="overflow",s="color",c="content",i=o+"-x",f=o+"-y",m="flex",p=m+"-direction",v=m+"-grow",y=m+"-shrink",b=m+"-basis",l=m+"-wrap",h="align",w=h+"-items",g=h+"-"+c,_=h+"-self",C="margin",O=C+"-"+t,k=C+"-"+d,S=C+"-"+a,E=C+"-"+n,A="padding",N=A+"-"+t,x=A+"-"+d,I=A+"-"+a,R=A+"-"+n,T="border",q=T+"-"+t,B=T+"-"+d,$=T+"-"+a,L=T+"-"+n,F=T+"-radius",V="background",Q=V+"-"+s,ce=V+"-image",se=V+"-repeat",ge=V+"-attachment",ie=V+"-position",G=V+"-size",U=V+"-origin",W=V+"-clip",ne="style",Xe="font",ud=Xe+"-size",ld=Xe+"-"+ne,dd=Xe+"-weight",fd=Xe+"-family",Qe="text",hd=Qe+"-align",pd=Qe+"-decoration",md=Qe+"-transform",bd=Qe+"-shadow",gd=Qe+"-overflow",Jr="stroke",yd=Jr+"-width",vd=Jr+"-linecap",Ne="animation",wd=Ne+"-name",_d=br.atoms={pos:e,t,r:d,b:a,l:n,z:"z-index",d:"display",vis:"visibility",w:u,h:r,minW:"min-"+u,maxW:"max-"+u,minH:"min-"+r,maxH:"max-"+r,ov:o,ovx:i,ovy:f,bxz:"box-sizing",cl:"clip",clp:"clip-path",clr:"clear",tbl:"table-layout",fl:m,fld:p,flg:v,fls:y,flb:b,flw:l,jc:"justify-"+c,ai:w,ac:g,as:_,mr:C,mrt:O,mrr:k,mrb:S,mrl:E,mar:C,mart:O,marr:k,marb:S,marl:E,pd:A,pdt:N,pdr:x,pdb:I,pdl:R,pad:A,padt:N,padr:x,padb:I,padl:R,bd:T,bdt:q,bdr:B,bdb:$,bdl:L,bdrad:F,bdc:T+"-"+s,bds:T+"-"+ne,out:"outline",bxsh:"box-shadow",col:s,op:"opacity",bg:V,bgc:Q,bgi:ce,bgr:se,bga:ge,bgp:ie,bgs:G,bgo:U,bgcl:W,bdfl:"backdrop-filter",bfvis:"backface-visibility",f:Xe,fz:ud,fs:ld,fw:dd,ff:fd,ta:hd,td:pd,tt:md,ts:bd,tov:gd,ww:"word-wrap",lts:"letter-spacing",ws:"white-space",lh:"line-"+r,va:"vertical-"+h,cur:"cursor",pe:"pointer-events",us:"user-select",an:Ne,ann:wd,and:Ne+"-duration",anf:Ne+"-fill-mode",anit:Ne+"-iteration-count",anp:Ne+"-play-state",ant:Ne+"-timing-function",trs:"transition",tr:"transform",st:Jr,stw:yd,stl:vd,ls:"list-"+ne,con:c};return br.addon=function(Li){var Cd=Li.decl;Li.decl=function(Di,Sd){return Cd(_d[Di]||Di,Sd)}},br}var as={},vo;function jh(){return vo||(vo=1,as.addon=function(e){e.rule=function(t,d){return d=d||e.hash(t),d=e.pfx+d,e.put("."+d,t)," "+d}}),as}var us={},wo;function Ph(){return wo||(wo=1,us.addon=function(e){e.drule=function(t,d){var a=e.rule(t,d),n=function(u){if(!u)return a;var r=e.cache(u);return a+r};return n.toString=function(){return a},n}}),us}var ls={},_o;function Mh(){return _o||(_o=1,ls.addon=function(e,t){t=e.assign({prefixes:["-webkit-","-moz-","-o-",""]},t||{});var d=t.prefixes;e.client&&document.head.appendChild(e.ksh=document.createElement("style"));var a=e.putAt;e.putAt=function(n,u,r){if(r[1]==="k"){var o="";for(var s in u){var c=u[s],i="";for(var f in c)i+=e.decl(f,c[f]);o+=s+"{"+i+"}"}for(var m=0;m<d.length;m++){var p=d[m],v=r.replace("@keyframes","@"+p+"keyframes")+"{"+o+"}";e.client?e.ksh.appendChild(document.createTextNode(v)):e.putRaw(v)}return}a(n,u,r)},e.keyframes=function(n,u){return u||(u=e.hash(n)),u=e.pfx+u,e.putAt("",n,"@keyframes "+u),u}}),ls}var ds={},Co;function qh(){return Co||(Co=1,ds.addon=function(e){var t={html:{lineHeight:1.15,"-webkit-text-size-adjust":"100%"},body:{margin:0},h1:{fontSize:"2em",margin:"0.67em 0"},hr:{boxSizing:"content-box",height:0,overflow:"visible"},pre:{fontFamily:"monospace, monospace",fontSize:"1em"},"b,strong":{fontWeight:"bolder"},"code,kbd,samp":{fontFamily:"monospace, monospace",fontSize:"1em"},small:{fontSize:"80%"},"sub,sup":{fontSize:"75%",lineHeight:0,position:"relative",verticalAlign:"baseline"},sub:{bottom:"-0.25em"},sup:{top:"-0.5em"},"button,input,optgroup,select,textarea":{fontFamily:"inherit",fontSize:"100%",lineHeight:1.15,margin:0},"button,input":{overflow:"visible"},"button,select":{textTransform:"none"},fieldset:{padding:"0.35em 0.75em 0.625em"},legend:{boxSizing:"border-box",display:"table",maxWidth:"100%",padding:0,whiteSpace:"normal"},progress:{verticalAlign:"baseline"},summary:{display:"list-item"}};e.put("",t)}),ds}var fs={},So;function Bh(){return So||(So=1,fs.addon=function(e){e.put("",{"html, body":{fontFamily:'"Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif',fontWeight:400,fontSize:"16px","-moz-text-size-adjust":"100%","-ms-text-size-adjust":"100%","-webkit-text-size-adjust":"100%","text-size-adjust":"100%","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"}})}),fs}var hs={},Oo;function Vh(){if(Oo)return hs;Oo=1;function e(t,d,a){var n="?family="+encodeURIComponent(t);return d&&(d instanceof Array||(d=[d]),n+=":"+d.join(",")),a&&(a instanceof Array||(a=[a]),n+="&subset="+a.join(",")),"https://fonts.googleapis.com/css"+n}return hs.addon=function(t){t.client?t.googleFont=function(d,a,n){var u=document.createElement("link");u.href=e(d,a,n),u.rel="stylesheet",u.type="text/css",document.head.appendChild(u)}:t.googleFont=function(d,a,n){t.putRaw("@import url('"+e(d,a,n)+"');")}},hs}var Eo;function bl(){return Eo||(Eo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.nano=e.googleFont=e.keyframes=e.drule=e.rule=e.put=e.reset=void 0;const t=J,d=ho(),a=Nh(),n=Rh(),u=Ih(),r=Th(),o=jh(),s=Ph(),c=Mh(),i=qh(),f=Bh(),m=Vh();t.__exportStar(ho(),e);const p=(0,d.create)({pfx:"nano-css"});e.nano=p,(0,a.addon)(p),(0,n.addon)(p),(0,u.addon)(p),(0,r.addon)(p),(0,o.addon)(p),(0,s.addon)(p),(0,c.addon)(p),(0,m.addon)(p);const v=()=>{(0,i.addon)(p),(0,f.addon)(p)};e.reset=v,e.put=p.put,e.rule=p.rule,e.drule=p.drule,e.keyframes=p.keyframes,e.googleFont=p.googleFont}(ns)),ns}var ps={},ko;function $h(){return ko||(ko=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.m4=e.m3=e.m2=e.m1=e.b4=e.b3=e.b2=e.b1=void 0,e.b1=520,e.b2=960,e.b3=1300,e.b4=1800,e.m1=`@media (max-width:${e.b1}px)`,e.m2=`@media (max-width:${e.b2}px)`,e.m3=`@media (max-width:${e.b3}px)`,e.m4=`@media (max-width:${e.b4}px)`}(ps)),ps}var tt={},Ao;function gl(){if(Ao)return tt;Ao=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.font=void 0;const e='"Open Sans",sans-serif',t='"Merriweather","Linux Libertine"',d='"Roboto Slab"',a='Ubuntu,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Cantarell,"Open Sans","Helvetica Neue",sans-serif',n='-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,"Apple Color Emoji",Arial,sans-serif,"Segoe UI Emoji","Segoe UI Symbol",'+a,u="Roboto,sans-serif,"+n;return tt.font={sans:{lite:{fw:300,ff:e},mid:{fw:400,ff:e},bold:{fw:700,ff:e},black:{fw:800,ff:e}},serif:{lite:{fw:300,ff:t},mid:{fw:400,ff:t},bold:{fw:700,ff:t},black:{fw:700,ff:t}},slab:{lite:{fw:300,ff:d},mid:{fw:400,ff:d},bold:{fw:700,ff:d},black:{fw:800,ff:d}},mono:{mid:{fw:300,ff:'"Menlo","DejaVu Sans Mono","Roboto Mono","Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'},bold:{fw:400,ff:'"Fira Mono","Cousine",Consolas,"Liberation Mono",Courier,monospace'}},ui1:{lite:{fw:300,ff:a},mid:{fw:400,ff:a},bold:{fw:700,ff:a},black:{fw:800,ff:a}},ui2:{lite:{fw:300,ff:n},mid:{fw:400,ff:n},bold:{fw:700,ff:n},black:{fw:800,ff:n}},ui3:{lite:{fw:300,ff:u},mid:{fw:400,ff:u},bold:{fw:700,ff:u},black:{fw:800,ff:u}}},tt}var ms={},bs={},nt={},No;function Jh(){if(No)return nt;No=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.hash=void 0;const e=t=>{let d=5381,a=t.length;for(;a;)d=d*33^t.charCodeAt(--a);return d>>>0};return nt.hash=e,nt}var xo;function yl(){return xo||(xo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.toColor=e.color=void 0,e.color=["#FFC312","#F79F1F","#EE5A24","#EA2027","#C4E538","#A3CB38","#009432","#006266","#12CBC4","#1289A7","#0652DD","#1B1464","#9980FA","#ED4C67","#B53471","#833471","#6F1E51","#e27d60","#85dcbb","#e8a87c","#c38d9e","#41b3a3","#242582","#553d67","#f64c72","#99738e","#2f2fa2","#05386b","#fc4445","#3feee6","#55bcc9","#8ee4af","#5cdb95","#907163","#379683","#84ceeb","#5ab9ea","#8860d0","#75b5d8","#a64ac9","#fccd04","#17e9e0","#61892f","#86c232","#222629","#474b4f","#6b6e70","#eadb02","#46344e","#5a5560","#fa72a1","#e64398","#f78888","#1FB6FF","#13CE66","#FF4949","#FFC82C","#76266C","#8C2E5E","#5B2971","#9B344E","#4D2B73","#AA4139","#432F75","#AA5D38","#702D0C","#3C1200","#353377","#FE8C00","#FE7301","#FE4301","#FE0100","#E5013B","#CC0174","#A0048C","#560DAB","#252AAC","#0A6BA1","#09A471","#9DED05"];const t=Jh(),d=a=>e.color[(0,t.hash)(a)%e.color.length];e.toColor=d}(bs)),bs}var Ro;function ki(){return Ro||(Ro=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.theme=e.lightTheme=void 0;const t=yl(),d=gl(),a=(r,o=1)=>{const s=Math.round(255*r);return`rgba(${s},${s},${s},${o})`},n=[0,4,8,16,24,32,64,128,256,512],u=[10,12,14,16,20,24,32,48,64,96,128];e.lightTheme={isLight:!0,name:"light",bg:"#fff",color:{color:t.color,sem:{accent:["#07f","#1340EB","#07ACEB"],blue:["#07f","#1340EB","#07ACEB"],positive:["#13CE66","#16BA32","#38D420"],negative:["#FF4949","#EB4C31","#DB521A"],warning:["#FFC82C","#EBC715","#DBCC00"],link:["#0089ff","#134EEB","#07BBEB"],brand:["#E44A28","#985DF7","#EE69B1","#F6A832","#5FCC8A","#58B9F8"]},ui:{lightLine:a(.1,.04),line:a(.1,.08),lineDark:a(.1,.16)}},font:d.font,green:r=>`rgba(19,206,102,${r})`,red:r=>`rgba(225,20,10,${r})`,blue:r=>`rgba(40,160,222,${r})`,fontSize:(r=0)=>u[Math.min(Math.max(r+3,0),u.length-1)],space:(r=0)=>n[Math.min(Math.max(r+3,0),n.length-1)],g:a},e.theme=e.lightTheme}(ms)),ms}var rt={},Io;function vl(){if(Io)return rt;Io=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.darkTheme=void 0;const e=ki(),t=(d,a=1)=>{const n=255-Math.round(255*d);return`rgba(${n},${n},${n},${a})`};return rt.darkTheme=Object.assign(Object.assign({},e.lightTheme),{isLight:!1,name:"dark",bg:"#101921",color:Object.assign(Object.assign({},e.lightTheme.color),{ui:{lightLine:t(.1,.04),line:t(.1,.08),lineDark:t(.1,.16)}}),g:t}),rt}var gs={},gr={},oe={},To;function wl(){if(To)return oe;To=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.isNavigator=oe.isBrowser=oe.off=oe.on=oe.noop=void 0;var e=function(){};oe.noop=e;function t(a){for(var n=[],u=1;u<arguments.length;u++)n[u-1]=arguments[u];a&&a.addEventListener&&a.addEventListener.apply(a,n)}oe.on=t;function d(a){for(var n=[],u=1;u<arguments.length;u++)n[u-1]=arguments[u];a&&a.removeEventListener&&a.removeEventListener.apply(a,n)}return oe.off=d,oe.isBrowser=typeof window<"u",oe.isNavigator=typeof navigator<"u",oe}var jo;function Lh(){if(jo)return gr;jo=1,Object.defineProperty(gr,"__esModule",{value:!0});var e=M(),t=wl(),d=t.isBrowser?e.useLayoutEffect:e.useEffect;return gr.default=d,gr}var Po;function Dh(){return Po||(Po=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalCss=e.makeRule=e.useRule=e.useTheme=e.Provider=void 0;const t=M(),d=ki(),a=vl(),n=bl(),u=t.createContext(d.lightTheme);e.Provider=t.memo(({theme:f,children:m})=>{const p=f==="light"?d.lightTheme:a.darkTheme;return t.createElement(u.Provider,{value:p},m)});const r=()=>t.useContext(u);e.useTheme=r;const o=f=>{const m=(0,e.useTheme)(),p=f(m);return n.nano.cache(p)};e.useRule=o;const s=f=>()=>(0,e.useRule)(f);e.makeRule=s;const c=Lh(),i=()=>{const f=(0,e.useTheme)();return(0,c.default)(()=>{document.body.style.background=f.bg,document.body.style.color=f.g(.05,.85)},[f]),null};e.GlobalCss=i}(gs)),gs}var Mo;function Y(){return Mo||(Mo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(kh(),e),t.__exportStar(Ah(),e),t.__exportStar(bl(),e),t.__exportStar($h(),e),t.__exportStar(gl(),e),t.__exportStar(ki(),e),t.__exportStar(vl(),e),t.__exportStar(Dh(),e),t.__exportStar(yl(),e)}(es)),es}var qo;function Z(){return qo||(qo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bottomRightActionPos=e.tooltip=e.insArrButton=e.insArrLine=e.insArrDot=e.insArrBlock=e.bracketHovered=e.collapsed=e.collapser=e.bracket=e.lineInner=e.line=e.list=e.colon=e.inputActive=e.input=e.property=e.quote=e.ValueColor=e.object=e.block=e.negative=e.blue=void 0;const t=Y();e.blue=t.theme.color.sem.blue[0],e.negative=t.theme.color.sem.negative[0],e.block=(0,t.rule)({d:"inline-block",ff:"monospace",col:t.theme.g(.1)}),e.object=(0,t.rule)({pos:"relative",d:"inline-block"}),e.ValueColor={nil:[t.theme.g(0,.4),t.darkTheme.g(0,.4)],undef:[t.theme.g(0,.2),t.darkTheme.g(0,.2)],str:["#e00e44","#f01e54"],bool:["#411888","#9168c8"],num:["#0a8F3F","#0FaF4F"],zero:["#748A00","#94AA11"],float:["#016873","#51a8b3"]},e.quote=(0,t.rule)({col:"#E84D3D"}),e.property=(0,t.rule)({pad:"0",fw:"bold",bxz:"border-box",va:"top"});const d={col:t.theme.g(0),pd:"5px",bg:t.theme.bg,bd:`1px solid ${t.theme.g(.7)}`,mr:"-6px",out:0};e.input=(0,t.rule)({z:2,pos:"relative",bd:0,mar:0,pad:0,bg:"transparent",bdrad:"5px",d:"inline-block",minW:"auto",w:"auto","&::selection":{col:"#fff",bgc:e.blue},input:{out:0}}),e.inputActive=(0,t.rule)(d),e.colon=(0,t.rule)({pd:"0 8px 0 0px",cur:"default",va:"top","&>span":{pd:"0 2px"},"&:hover":{"&>span":{out:`1px dotted ${e.blue}`}}}),e.list=(0,t.rule)({d:"block",listStyleType:"none",pd:0,mr:"0 0 0 32px"}),e.line=(0,t.rule)({d:"block",ls:"none",pd:0,mr:0}),e.lineInner=(0,t.rule)({d:"inline-block"}),e.bracket=(0,t.rule)({pos:"relative",cur:"default"}),e.collapser=(0,t.rule)({pd:"0 6px",pos:"absolute",t:"0px",l:"-24px",cur:"default",us:"none"}),e.collapsed=(0,t.rule)({col:e.blue,cur:"default",fw:"bold",bg:t.theme.blue(.1),pd:"2px",mr:"-2px",bdrad:"4px"}),e.bracketHovered=(0,t.rule)({out:`1px dotted ${e.blue}`}),e.insArrBlock=(0,t.rule)({pos:"relative",h:"0px",w:"0px"}),e.insArrDot=(0,t.rule)({pos:"absolute",t:"0px",l:"-4px",w:"3px",h:"3px",bdrad:"50%",bg:e.blue,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{top:"-2px",left:"2px",w:"7px",h:"7px"}}),e.insArrLine=(0,t.rule)({pos:"absolute",t:"1px",l:"-56px",w:"50px",h:"0px",bdt:`1px dotted ${e.blue}`,pe:"none",[`.${e.insArrBlock.trim()}:hover &`]:{l:"-56px",w:"56px",bdt:`1px solid ${e.blue}`}}),e.insArrButton=(0,t.rule)({pos:"absolute",d:"block",t:"-8px",l:"-75px"}),e.tooltip=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.ui1),{pos:"absolute",d:"none",t:"-2.5em",l:"0px",bg:"rgba(0,0,0,.8)",col:"#fff",fz:12/13.4+"em",pad:".4em .8em",bdrad:".4em",z:3,pe:"none",us:"none",ws:"nowrap"})),e.bottomRightActionPos=(0,t.rule)({d:"inline-block",pos:"absolute",r:"-6px",b:"-9px",z:2})}(Zr)),Zr}var st={},ys={},vs={},Bo;function Fh(){return Bo||(Bo=1,Object.defineProperty(vs,"__esModule",{value:!0})),vs}var ws={},Vo;function Ai(){return Vo||(Vo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=u,e.escapeComponent=r,e.parseJsonPointer=o,e.formatJsonPointer=s,e.isChild=i,e.isPathEqual=f,e.parent=p,e.isValidIndex=v;const t=/~1/g,d=/~0/g,a=/~/g,n=/\//g;function u(b){return b.indexOf("~")===-1?b:b.replace(t,"/").replace(d,"~")}function r(b){return b.indexOf("/")===-1&&b.indexOf("~")===-1?b:b.replace(a,"~0").replace(n,"~1")}function o(b){return b?b.slice(1).split("/").map(u):[]}function s(b){return(0,e.isRoot)(b)?"":"/"+b.map(l=>r(String(l))).join("/")}const c=b=>typeof b=="string"?o(b):b;e.toPath=c;function i(b,l){if(b.length>=l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}function f(b,l){if(b.length!==l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}const m=b=>!b.length;e.isRoot=m;function p(b){if(b.length<1)throw new Error("NO_PARENT");return b.slice(0,b.length-1)}function v(b){if(typeof b=="number")return!0;const l=Number.parseInt(b,10);return String(l)===b&&l>=0}const y=b=>{const l=b.length;let h=0,w;for(;h<l;){if(w=b.charCodeAt(h),w>=48&&w<=57){h++;continue}return!1}return!0};e.isInteger=y}(ws)),ws}var _s={},$o;function Uh(){return $o||($o=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const t=n=>{if(typeof n=="string"){if(n){if(n[0]!=="/")throw new Error("POINTER_INVALID");if(n.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(n)};e.validateJsonPointer=t;const{isArray:d}=Array,a=n=>{if(!d(n))throw new Error("Invalid path.");if(n.length>256)throw new Error("Path too long.");for(const u of n)switch(typeof u){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=a}(_s)),_s}var it={},ot={},Jo;function Ni(){if(Jo)return ot;Jo=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function t(d,a){return e.call(d,a)}return ot.hasOwnProperty=t,ot}var Lo;function _l(){if(Lo)return it;Lo=1,Object.defineProperty(it,"__esModule",{value:!0}),it.get=void 0;const e=Ni(),t=(d,a)=>{const n=a.length;let u;if(!n)return d;for(let r=0;r<n;r++)if(u=a[r],d instanceof Array){if(typeof u!="number"){if(u==="-")return;const o=~~u;if(""+o!==u)return;u=o}d=d[u]}else if(typeof d=="object"){if(!d||!(0,e.hasOwnProperty)(d,u))return;d=d[u]}else return;return d};return it.get=t,it}var fe={},Do;function Gh(){if(Do)return fe;Do=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.isObjectReference=fe.isArrayEnd=fe.isArrayReference=fe.find=void 0;const e=Ni(),{isArray:t}=Array,d=(r,o)=>{const s=o.length;if(!s)return{val:r};let c,i;for(let m=0;m<s;m++)if(c=r,i=o[m],t(c)){const p=c.length;if(i==="-")i=p;else if(typeof i=="string"){const v=~~i;if(""+v!==i)throw new Error("INVALID_INDEX");if(i=v,i<0)throw new Error("INVALID_INDEX")}r=c[i]}else if(typeof c=="object"&&c)r=(0,e.hasOwnProperty)(c,i)?c[i]:void 0;else throw new Error("NOT_FOUND");return{val:r,obj:c,key:i}};fe.find=d;const a=r=>t(r.obj)&&typeof r.key=="number";fe.isArrayReference=a;const n=r=>r.obj.length===r.key;fe.isArrayEnd=n;const u=r=>typeof r.obj=="object"&&typeof r.key=="string";return fe.isObjectReference=u,fe}var Cs={},ct={},Fo;function Hh(){if(Fo)return ct;Fo=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.findByPointer=void 0;const e=Ni(),t=Ai(),{isArray:d}=Array,a=(n,u)=>{if(!n)return{val:u};let r,o,s=0,c=1;for(;s>-1;)if(s=n.indexOf("/",c),o=s>-1?n.substring(c,s):n.substring(c),c=s+1,r=u,d(r)){const i=r.length;if(o==="-")o=i;else{const f=~~o;if(""+f!==o)throw new Error("INVALID_INDEX");if(o=f,o<0)throw"INVALID_INDEX"}u=r[o]}else if(typeof r=="object"&&r)o=(0,t.unescapeComponent)(o),u=(0,e.hasOwnProperty)(r,o)?r[o]:void 0;else throw"NOT_FOUND";return{val:u,obj:r,key:o}};return ct.findByPointer=a,ct}var Uo;function zh(){return Uo||(Uo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),J.__exportStar(Hh(),e)}(Cs)),Cs}var Go;function Ir(){return Go||(Go=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(Fh(),e),t.__exportStar(Ai(),e),t.__exportStar(Uh(),e),t.__exportStar(_l(),e),t.__exportStar(Gh(),e),t.__exportStar(zh(),e)}(ys)),ys}var at={},ut={},Ho;function Wh(){if(Ho)return ut;Ho=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.copyStyles=void 0;const e=(t,d,a)=>{const n=window.getComputedStyle(t);if(n)for(const u of a)d.style[u]=n[u]};return ut.copyStyles=e,ut}var zo;function ur(){if(zo)return at;zo=1,Object.defineProperty(at,"__esModule",{value:!0}),at.FlexibleInput=void 0;const e=M(),t=Y(),d=Wh(),a=(0,t.rule)({d:"inline-block",pos:"relative"}),n=(0,t.rule)({d:"inline-block",va:"bottom",bxz:"border-box",ov:"hidden",pd:0,mr:0,bd:0,bg:0,out:0,col:"inherit",fw:"inherit",f:"inherit",lh:"inherit",ws:"pre",resize:"none"}),u=(0,t.rule)({d:"inline-block",pos:"absolute",ov:"hidden",pe:"none",us:"none",bxz:"border-box",t:0,l:0,ws:"pre"}),r=({inp:o,value:s,uncontrolled:c,multiline:i,typebefore:f="",typeahead:m="",extraWidth:p,minWidth:v=8,maxWidth:y,focus:b,onChange:l,onFocus:h,onBlur:w,onKeyDown:g,onSubmit:_,onCancel:C,onTab:O})=>{const k=e.useRef(null),S=e.useRef(null),E=(0,t.useTheme)();e.useLayoutEffect(()=>{!k.current||!S.current||(b&&k.current.focus(),(0,d.copyStyles)(k.current,S.current,["font","fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","boxSizing"]))},[]),e.useLayoutEffect(()=>{const x=k.current,I=S.current;if(!x||!I)return;let R=I.scrollWidth;p&&(R+=p),v&&(R=Math.max(R,v)),y&&(R=Math.min(R,y));const T=x.style;if(T.width=R+"px",i){const q=I.scrollHeight;T.height=q+"px"}},[s,m,p]);const A={ref:x=>{k.current=x,o&&o(x)},className:n,onChange:l,onFocus:h,onBlur:w,onKeyDown:x=>{x.key==="Enter"&&(!i||x.ctrlKey)?_&&_(x):x.key==="Escape"?C&&C(x):x.key==="Tab"&&O&&O(x),g&&g(x)}},N=i?e.createElement("textarea",Object.assign({},A,{value:c?void 0:s})):e.createElement("input",Object.assign({},A,{value:c?void 0:s}));return e.createElement(e.Fragment,null,!!f&&e.createElement("span",{style:{color:E.g(.7),verticalAlign:"top"}},f),e.createElement("span",{className:a},N,e.createElement("span",{ref:S,className:u},e.createElement("span",{style:{visibility:"hidden"}},s),"​",!!m&&e.createElement("span",{style:{color:E.g(.7)}},m))))};return at.FlexibleInput=r,at}var Wo;function Cl(){if(Wo)return st;Wo=1,Object.defineProperty(st,"__esModule",{value:!0}),st.JsonProperty=void 0;const e=M(),t=Y(),d=Ir(),a=Z(),n=ur(),u=te(),r=({pointer:o,onChange:s})=>{const{formal:c}=(0,u.useStyles)(),i=e.useMemo(()=>o.split("/"),[o]),f=e.useMemo(()=>(0,d.unescapeComponent)(i[i.length-1]),[i]),[m,p]=e.useState(f),v=e.useRef(null),[y,b]=e.useState(!1),l=(0,t.useTheme)(),h={color:l.g(.1)};y&&(h.background=l.bg,h.border=`1px solid ${l.g(.9)}`,h.fontWeight="bold",h.margin="-3px",h.padding="2px"),(!f||f.indexOf(" ")!==-1)&&(h.background=l.blue(.1));const w=g=>{g&&g.preventDefault(),g&&g.stopPropagation(),s&&s([{op:"move",from:o,path:i.slice(0,i.length-1).join("/")+"/"+(0,d.escapeComponent)(m)}])};return e.createElement(e.Fragment,null,s?e.createElement("span",{className:a.property+a.input,style:h},e.createElement(n.FlexibleInput,{inp:g=>v.current=g,value:y?m:f,onChange:g=>p(g.target.value),onFocus:g=>{const _=g.target,O=_.value.length;O&&O<6&&setTimeout(()=>{_.setSelectionRange(0,O,"forward")},155),b(!0)},onBlur:()=>{b(!1)},onSubmit:g=>{v.current&&(v.current.blur(),b(!1)),w(g)},onCancel:()=>{v.current&&(v.current.blur(),b(!1))}})):e.createElement("span",{className:a.property,style:h},c?JSON.stringify(f):f),e.createElement("span",{className:a.colon,style:{color:l.g(.5)}},e.createElement("span",null,":")))};return st.JsonProperty=r,st}var lt={},dt={},Ss={},Ko;function Tr(){return Ko||(Ko=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.typeahead=e.inputStyle=e.inputColor=e.valueBg=e.valueColor=void 0;const t=Y(),d=Z(),a=(s,c)=>{switch(typeof c){case"boolean":return d.ValueColor.bool[~~s];case"string":return d.ValueColor.str[~~s];case"number":return c?c===Math.round(c)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]:d.ValueColor.zero[~~s];case"bigint":return d.ValueColor.float[~~s];case"object":return c===null?d.ValueColor.nil[~~s]:void 0;case"undefined":return d.ValueColor.undef[~~s]}};e.valueColor=a;const n=s=>s===!1||typeof s=="number"&&s<0?t.theme.red(.06):void 0;e.valueBg=n;const u=(s,c)=>{if(c){if(c=c.trim(),c==="true"||c==="false")return d.ValueColor.bool[~~s];if(c==="null")return d.ValueColor.nil[~~s];if(c==="undefined")return d.ValueColor.undef[~~s];if(c==="0")return d.ValueColor.zero[~~s];if(c.length<24&&(c[0]==="-"||c[0]>="0"&&c[0]<="9"))try{const i=JSON.parse(c);if(typeof i=="number")return i===Math.round(i)?d.ValueColor.num[~~s]:d.ValueColor.float[~~s]}catch{}if(!(c[0]==="["||c[0]==="{"))return d.ValueColor.str[~~s]}};e.inputColor=u;const r=(s,c,i)=>({color:(0,e.inputColor)(c,i)||s.g(.1),background:s.bg,borderColor:s.g(.7)});e.inputStyle=r;const o=s=>{if(!s)return"";const c=s.length;return c>=5?"":"true".startsWith(s)?"true".slice(c):"false".startsWith(s)?"false".slice(c):"null".startsWith(s)?"null".slice(c):""};e.typeahead=o}(Ss)),Ss}var ft={},Yo;function xi(){if(Yo)return ft;Yo=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.selectOnFocus=void 0;const e=t=>{const d=t.value,a=d.length;a&&a<40&&setTimeout(()=>{if(d[0]==='"'&&d[a-1]==='"')(a<17||d.indexOf(`
`)===-1&&d.indexOf(" ")===-1)&&t.setSelectionRange(1,a-1,"forward");else if(d==="null")t.setSelectionRange(0,4,"forward");else try{switch(typeof JSON.parse(d)){case"number":case"boolean":{t.setSelectionRange(0,a,"forward");break}}}catch{}},155),d[0]==='"'&&d[a-1]==='"'&&t.setSelectionRange(a-1,a-1)};return ft.selectOnFocus=e,ft}var Xo;function Kh(){if(Xo)return dt;Xo=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.ValueInput=void 0;const e=M(),t=Y(),d=Z(),a=Tr(),n=ur(),u=xi(),r=o=>{const{value:s,onChange:c}=o,i=e.useRef(null),f=(0,t.useTheme)(),m=e.useMemo(()=>s===null?"null":typeof s=="boolean"?s?"true":"false":typeof s=="string"?JSON.stringify(s):String(s),[s,f]),[p,v]=e.useState(m),[y,b]=e.useState(!1);e.useEffect(()=>{v(m)},[m]);const l=O=>{O&&O.preventDefault(),O&&O.stopPropagation();let k;try{k=JSON.parse(p)}catch{k=String(p)}c&&c(k)},h=O=>{const k=O.target;k.value===p&&(0,u.selectOnFocus)(k),b(!0)},w=()=>{b(!1)},g=O=>{i.current&&i.current.blur(),l(O)},_=()=>{m!==p?v(m):i.current&&i.current.blur()},C=O=>{const k=(0,a.typeahead)(p);k&&(O.preventDefault(),v(p+k))};return e.createElement("span",{className:d.input,style:y?(0,a.inputStyle)(f,!f.isLight,p):{color:(0,a.valueColor)(!f.isLight,s),background:(0,a.valueBg)(s)}},e.createElement(n.FlexibleInput,{inp:O=>i.current=O,value:y?p:m,typeahead:y?(0,a.typeahead)(p):"",onChange:O=>v(O.target.value),onFocus:h,onBlur:w,onSubmit:g,onCancel:_,onTab:C}))};return dt.ValueInput=r,dt}var ht={},Qo;function Ke(){if(Qo)return ht;Qo=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.JsonAtom=void 0;const e=M(),t=Y(),d=Tr(),a=t.theme.color.sem.blue[0],n=u=>{var r;const{value:o,onClick:s}=u,c=(0,t.useTheme)();let i=c.g(.2),f="∅";if(Array.isArray(o))i=a,f="["+o.length+"]";else if(o instanceof Uint8Array)i=c.g(.45),f=e.createElement("span",null,[...o].slice(0,128).map(v=>v<16?"0"+v.toString(16):v.toString(16)).join(" "),o.length>128?e.createElement("span",{style:{color:c.g(.3)}},` … (${o.length-128} more)`):"");else if(o&&typeof o=="object")i=a,f="{"+Object.keys(o).length+"}";else if(i=(r=(0,d.valueColor)(!c.isLight,o))!==null&&r!==void 0?r:i,typeof o=="string"){const y=o.length>64,b=JSON.stringify(y?o.slice(0,64):o);y?f=e.createElement("span",null,b.slice(0,-1),e.createElement("span",{style:{color:c.g(.3)}},` … (${o.length-64} more)`),'"'):f=b}else f=String(o);const m=(0,d.valueBg)(o),p={color:i,background:m};return m&&(p.borderRadius=4,p.margin=-1,p.padding=1),e.createElement("span",{style:p,onClick:s},f)};return ht.JsonAtom=n,ht}var Zo;function Yh(){if(Zo)return lt;Zo=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.JsonValue=void 0;const e=M(),t=Cl(),d=Kh(),a=Ke(),n=u=>{const{pointer:r,property:o,doc:s,parentCollapsed:c,comma:i,onChange:f}=u,m=s instanceof Uint8Array,p=v=>{f&&f([{op:"replace",path:r,value:v}])};return e.createElement(e.Fragment,null,typeof o=="string"&&e.createElement(t.JsonProperty,{key:"k"+String(c),pointer:r,onChange:f}),!f||m?e.createElement(a.JsonAtom,{value:s}):e.createElement(d.ValueInput,{key:String(c),value:s,onChange:p}),!!i&&",")};return lt.JsonValue=n,lt}var pt={},mt={},Os={},Es={},ec;function Xh(){return ec||(ec=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTranslations=void 0;var t=J,d=M(),a=d.createContext,n=d.createElement,u=d.Fragment,r=function(s){for(var c=[],i=1;i<arguments.length;i++)c[i-1]=arguments[i];for(var f=[],m=0;m<c.length;m++)f.push(s[m]),f.push(c[m]);return f.push(s[m]),n.apply(void 0,t.__spreadArrays([u,{}],f))},o=function(s){return function(c){for(var i=[],f=1;f<arguments.length;f++)i[f-1]=arguments[f];for(var m=[],p=0;p<i.length;p++)m.push(c[p]),m.push(s[i[p]]);return m.push(c[p]),n.apply(void 0,t.__spreadArrays([u,{}],m))}};e.createTranslations=function(s){var c;s===void 0&&(s="main");var i=a({}),f=i.Consumer,m=(c=function(l){t.__extends(h,l);function h(w){var g,_=l.call(this,w)||this;_.load=function(A,N){return t.__awaiter(_,void 0,void 0,function(){var x;return t.__generator(this,function(I){switch(I.label){case 0:return this.state.map[A]||(this.state.map[A]={}),this.state.map[A][N]?[3,2]:(this.state.map[A][N]={},this.setState(t.__assign({},this.state)),[4,this.props.loader(A,N)]);case 1:x=I.sent(),this.state.map[A][N]=x,this.setState(t.__assign({},this.state)),I.label=2;case 2:return[2]}})})},_.setLocale=function(A){A!==_.state.locale&&(_.state.map[A]||(_.state.map[A]={}),_.setState({locale:A}))},_.createT=function(A){A===void 0&&(A=[_.props.ns]);for(var N=_.state.locale,x=_.state.map[N],I=0,R=A;I<R.length;I++){var T=R[I];x[T]||_.load(N,T).catch(function(B){return console.error(B)})}var q=function(B){for(var $=[],L=1;L<arguments.length;L++)$[L-1]=arguments[L];for(var F=0,V=[N,_.props.defaultLocale];F<V.length;F++){var Q=V[F];if(!Q)break;for(var ce=_.state.map[Q],se=0,ge=A;se<ge.length;se++){var ie=ge[se],G=ce[ie],U=G[B];if(U!==void 0)return typeof U=="function"?U(o($)):U||B}}return B};return q.t=function(B){return function($){for(var L=[],F=1;F<arguments.length;F++)L[F-1]=arguments[F];var V=q.apply(void 0,t.__spreadArrays([B],L));return typeof V=="object"?V:V!==B?n(u,{},V):r.apply(void 0,t.__spreadArrays([$],L))}},q};var C=w.map,O=C===void 0?{}:C,k=w.locale,S=w.defaultLocale,E=w.ns;return O[S]?O[S][E]||(O[S][E]={}):O[S]=(g={},g[E]={},g),_.state={locale:k,ns:E,map:O,load:_.load,setLocale:_.setLocale,createT:_.createT},k!==S&&_.load(k,E),_}return h.prototype.shouldComponentUpdate=function(w){return w.locale!==this.props.locale&&this.setLocale(w.locale),!0},h.prototype.render=function(){return d.createElement(i.Provider,{value:this.state,children:this.props.children})},h}(d.Component),c.defaultProps={locale:"en",defaultLocale:"en",ns:s},c),p=function(l){return l};p.t=function(l){return function(h){for(var w=[],g=1;g<arguments.length;g++)w[g-1]=arguments[g];return r(h,w)}};var v=function(l){var h=l instanceof Array?l:[l||s],w=d.useContext(i);return[w.createT?w.createT(h):p,w]},y=function(l,h){return h===void 0&&(h=s),Array.isArray(h)||(h=[h]),function(w){var g=v(h),_=g[0],C=g[1];return d.createElement(l,t.__assign(t.__assign({},w),{t:_,T:C}))}},b=function(l){var h=l.children,w=l.ns instanceof Array?l.ns:[l.ns||s],g=v(w),_=g[0],C=g[1];return(typeof h=="function"?h(_,C):h instanceof Array?d.createElement.apply(d,t.__spreadArrays([d.Fragment,null],h.map(function(O){return typeof O=="function"?O(_):typeof O=="string"?_(O):O||null}))):typeof h=="string"?_(h):h)||null};return{Consumer:f,Provider:m,context:i,useT:v,Trans:b,withT:y,T:p}},e.default=e.createTranslations}(Es)),Es}var ks={},tc;function Qh(){return tc||(tc=1,Object.defineProperty(ks,"__esModule",{value:!0})),ks}var nc;function Ee(){return nc||(nc=1,function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.T=e.withT=e.useT=e.context=e.Trans=e.Provider=e.Consumer=void 0;var d=J,a=Xh();d.__exportStar(Qh(),e),e.Consumer=(t=a.default(),t.Consumer),e.Provider=t.Provider,e.Trans=t.Trans,e.context=t.context,e.useT=t.useT,e.withT=t.withT,e.T=t.T}(Os)),Os}var bt={},gt={},rc;function lr(){if(rc)return gt;rc=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.Action=void 0;const e=M(),t=Y(),d=Z(),a=(0,t.drule)({pos:"relative",d:"flex",jc:"center",ai:"center",w:"17px",h:"17px",bdrad:"2px",pad:0,mr:0,out:0,ff:"monospace",lh:"16px",cur:"pointer",bd:`1px dotted ${d.blue}`,col:d.blue,fw:"normal",z:3}),n=(0,t.drule)({[`.${a.toString().trim()}:hover &`]:{d:"inline-block"}}),u=({className:r="",tooltip:o,children:s,onClick:c,onMouseEnter:i,onMouseLeave:f,onMouseOver:m})=>{const p=(0,t.useTheme)();return e.createElement("button",{className:a({bg:p.bg,"&:hover":{col:p.bg,bg:d.blue},"&:active":{col:p.g(.9),bg:p.g(.1),bd:`1px solid ${p.g(.1)}`}})+r,onClick:c,onMouseEnter:i,onMouseLeave:f,onMouseOver:m},s,!!o&&e.createElement("span",{className:d.tooltip+n({})},o))};return gt.Action=u,gt}var sc;function jr(){if(sc)return bt;sc=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.CancelAction=void 0;const e=M(),t=Y(),d=Z(),a=lr(),n=(0,t.drule)({w:"20px",h:"20px",pos:"absolute",t:"-11px",l:"-11px",z:2,bdrad:"50%",svg:{fill:d.blue}}),u=r=>{const o=(0,t.useTheme)();return e.createElement(a.Action,Object.assign({},r,{className:n({"&:hover":{bg:d.negative,bd:`1px solid ${d.negative}`,svg:{fill:"#fff"}},"&:active":{bg:o.g(.1),bd:`1px solid ${o.g(.1)}`}})}),"×")};return bt.CancelAction=u,bt}var yt={},ic;function Zh(){if(ic)return yt;ic=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.EditAction=void 0;const e=M(),t=lr(),d=a=>e.createElement(t.Action,Object.assign({},a),"…");return yt.EditAction=d,yt}var oc;function Ri(){if(oc)return mt;oc=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.FocusRegion=void 0;const e=M(),t=Y(),d=Ee(),a=Z(),n=jr(),u=Zh(),r=(0,t.rule)({d:"inline-block",pos:"relative",va:"top",bxz:"border-box",pd:"3px",bdrad:"4px",trs:"background-color .3s ease-out"}),o=(0,t.rule)({pd:"1px 3px"}),s=(0,t.rule)({bgc:t.theme.blue(.1)}),c=(0,t.rule)({bgc:t.theme.red(.1)}),i=(0,t.rule)({bgc:t.theme.red(.08)}),f=(0,t.rule)({out:`1px dotted ${a.blue}`}),m=(0,t.rule)({out:`1px dotted ${a.negative}`}),p=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-1px",l:"calc(100% + 0.5em)"}),v=(0,t.rule)({d:"inline-block",pos:"absolute",top:"-11px",l:"calc(100% - 24px)"}),y=b=>{const{focused:l,pointed:h,compact:w,aside:g,toolbar:_,negative:C,children:O,onClick:k,onMouseMove:S,onMouseEnter:E,onMouseLeave:A,onDelete:N,onEdit:x}=b,[I]=(0,d.useT)(),[R,T]=e.useState(!1),q=N?e.createElement(n.CancelAction,{tooltip:I("Delete"),onClick:N,onMouseEnter:()=>T(!0),onMouseOver:()=>T(!0),onMouseLeave:()=>T(!1)}):void 0,B=r+(w?o:"")+(h?C?c:s:"")+(R?i:"")+(l?C?m:f:"");return e.createElement("span",{className:B,style:{outline:R?`1px dotted ${a.negative}`:void 0},onMouseMove:S,onMouseEnter:E,onMouseLeave:A,onClick:k},O,q,!!l&&x&&e.createElement("span",{className:a.bottomRightActionPos},e.createElement(u.EditAction,{tooltip:I("Set"),onClick:x})),!!g&&e.createElement("span",{className:p},g),!!l&&!!_&&e.createElement("span",{className:v},_))};return mt.FocusRegion=y,mt}var As={},cc;function ue(){return cc||(cc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FocusProvider=e.useIsFocused=e.useFocus=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useFocus=d;const a=u=>{const{focused:r}=(0,e.useFocus)();return r===u};e.useIsFocused=a;const n=({children:u,onFocus:r})=>{const[o,s]=t.useState(null),[c,i]=t.useState(null),f=t.useCallback(m=>{s(m),r==null||r(m)},[r]);return t.useEffect(()=>{const m=p=>{const v=document.activeElement;v&&(v.nodeName==="INPUT"||v.nodeName==="TEXTAREA")||p.key==="Escape"&&f(null)};return document.addEventListener("keydown",m,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",m)},[]),t.createElement(e.context.Provider,{value:{focused:o,focus:f,pointed:c,point:i}},u)};e.FocusProvider=n}(As)),As}var Ns={},ac;function Sl(){return ac||(ac=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputProvider=e.useInput=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useInput=d;const a=({children:n})=>{const u=(0,e.useInput)(),[r,o]=t.useState(!1);return t.useEffect(()=>{if(u)return;const s=()=>{o(!!document.activeElement&&document.activeElement.tagName==="INPUT")};return document.addEventListener("focus",s,!0),document.addEventListener("blur",s,!0),()=>{document.removeEventListener("focus",s),document.removeEventListener("blur",s)}},[]),u?n:t.createElement(e.context.Provider,{value:{focused:r}},n)};e.InputProvider=a}(Ns)),Ns}var uc;function Ol(){if(uc)return pt;uc=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.JsonHoverable=void 0;const e=M(),t=ar(),d=Ri(),a=ue(),n=te(),u=Sl(),r=({pointer:o,children:s})=>{const{focused:c,focus:i,pointed:f,point:m}=(0,a.useFocus)(),{pfx:p,onChange:v}=e.useContext(t.context),{compact:y}=(0,n.useStyles)(),b=(0,u.useInput)(),l=p+o,h=C=>{C.stopPropagation(),f!==l&&m(l)},w=C=>{C.preventDefault(),C.stopPropagation(),m(l)},g=()=>{m(null)},_=C=>{C.preventDefault(),C.stopPropagation(),i(l)};return e.createElement(d.FocusRegion,{pointed:f===l,focused:c===l,compact:y,onClick:_,onMouseMove:h,onMouseEnter:w,onMouseLeave:g,onDelete:v&&!b.focused&&l===c?()=>v([{op:"remove",path:o}]):void 0},s)};return pt.JsonHoverable=r,pt}var vt={},wt={},_t={},Ct={},St={},lc;function e0(){if(lc)return St;lc=1,Object.defineProperty(St,"__esModule",{value:!0}),St.TypeSwitch=void 0;const e=M(),t=Y(),d=(0,t.drule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",col:t.theme.color.sem.blue[0],d:"inline-block",pd:"2px 2px",mr:"0",bxz:"border-box",bd:0,bdrad:"1em"}));return St.TypeSwitch=e.memo(({value:a,onKeyDown:n,onClick:u})=>{const r=(0,t.useTheme)();return e.createElement("button",{className:d({bg:r.g(.96),"&:hover":{bg:r.g(.88)}}),onClick:u,onKeyDown:n},a)}),St}var dc;function t0(){if(dc)return Ct;dc=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.CrdtTypeSwitch=void 0;const e=M(),t=e0(),d=({types:a=["any","con","vec","val"],type:n,onSubmit:u,onClick:r})=>{const[o,s]=e.useState(a.findIndex(f=>f===n.current));e.useLayoutEffect(()=>{n.current=a[o]},[]);const c=()=>{s(f=>{const m=(f+1)%a.length;return n.current=a[m],m})},i=()=>{s(f=>{const m=(f-1+a.length)%a.length;return n.current=a[m],m})};return e.createElement("span",{style:{display:"inline-block",padding:"0 0 0 4px",margin:"-1px 0"}},e.createElement(t.TypeSwitch,{value:a[o],onClick:f=>{c(),r&&r(f)},onKeyDown:f=>{switch(f.key){case"ArrowDown":case"ArrowRight":{f.preventDefault(),c();break}case"ArrowUp":case"ArrowLeft":{f.preventDefault(),i();break}case"Enter":{f.preventDefault(),u&&(f.preventDefault(),u());break}}}}))};return Ct.CrdtTypeSwitch=d,Ct}var fc;function Ii(){if(fc)return _t;fc=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.ValueInput=void 0;const e=M(),t=Y(),d=ur(),a=Z(),n=Tr(),u=t0(),r=xi(),o=({inp:s,focus:c,initialValue:i="",visible:f,types:m=["any","con","val","vec"],initialType:p,withType:v,onSubmit:y,onCancel:b})=>{const[l,h]=e.useState(i),w=e.useRef(null),g=(0,t.useTheme)(),_=e.useRef(p??(m&&m.length?m[0]:"")),C=()=>{w.current&&w.current.blur(),h(""),y(l,_.current)},O=(0,n.inputStyle)(g,!g.isLight,l);O.display=f?void 0:"none",O.margin="-1px 0 -1px -2px",O.padding="3px 4px 3px 5px",O.border=`1px solid ${g.g(.85)}`;let k=null;return m&&m.length&&v&&(k=e.createElement(u.CrdtTypeSwitch,{type:_,onSubmit:C,onClick:()=>{w.current&&w.current.focus()}})),e.createElement("span",{className:a.input,style:O},e.createElement(d.FlexibleInput,{focus:c,inp:S=>{w.current=S,s&&s(S)},value:l,typeahead:(0,n.typeahead)(l),onChange:S=>h(S.target.value),onSubmit:C,onFocus:S=>(0,r.selectOnFocus)(S.target),onCancel:S=>{h(""),b&&b(S)},onTab:S=>{const E=(0,n.typeahead)(l);E&&(S.preventDefault(),h(l+E))}}),k)};return _t.ValueInput=o,_t}var Ot={},hc;function El(){if(hc)return Ot;hc=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.AddAction=void 0;const e=M(),t=lr(),d=a=>e.createElement(t.Action,Object.assign({},a),"+");return Ot.AddAction=d,Ot}var pc;function kl(){if(pc)return wt;pc=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.ObjectInsert=void 0;const e=M(),t=Ee(),d=Z(),a=Y(),n=ur(),u=Ii(),r=El(),o=({visible:s,withType:c,onSubmit:i})=>{const[f]=(0,t.useT)(),[m,p]=e.useState(!1),[v,y]=e.useState(""),[b,l]=e.useState(""),h=e.useRef(null),w=e.useRef(null),g=(0,a.useTheme)(),_=(C,O)=>{w.current&&w.current.blur(),i(v,C,O),y(""),l(""),p(!1)};if(!s)return null;if(m){const C=e.createElement("span",{className:d.property+d.input,style:{color:g.g(.1),background:g.bg,display:s?void 0:"none",margin:"-1px 0 -1px -2px",padding:"3px 4px",border:`1px solid ${g.g(.85)}`,fontWeight:"bold"}},e.createElement(n.FlexibleInput,{focus:!0,inp:k=>h.current=k,value:v,onChange:k=>y(k.target.value),onSubmit:()=>{w.current&&w.current.focus()},onCancel:()=>{v?y(""):b?l(""):p(!1)}})),O=e.createElement(u.ValueInput,{inp:k=>w.current=k,visible:s,withType:c,onSubmit:_,onCancel:()=>{h.current&&h.current.focus()}});return e.createElement("span",{style:{display:s?void 0:"none"}},C,e.createElement("span",{className:d.colon},e.createElement("span",null,":")),O)}return e.createElement("span",{className:d.insArrBlock,style:{display:s?void 0:"none"},onClick:()=>p(!0)},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(r.AddAction,{tooltip:f("Add key"),onClick:()=>p(!0)})))};return wt.ObjectInsert=o,wt}var mc;function n0(){if(mc)return vt;mc=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.JsonObjectInsert=void 0;const e=M(),t=Ir(),d=ar(),a=kl(),n=({pointer:u,visible:r})=>{const{onChange:o}=e.useContext(d.context);if(!o)return null;const s=(c,i)=>{let f;try{f=JSON.parse(i)}catch{f=String(i)}o([{op:"add",path:u+"/"+(0,t.escapeComponent)(c),value:f}])};return e.createElement(a.ObjectInsert,{visible:r,onSubmit:s})};return vt.JsonObjectInsert=n,vt}var Et={},kt={},bc;function Ti(){if(bc)return kt;bc=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.ArrayInsert=void 0;const e=M(),t=Ee(),d=Z(),a=Ii(),n=El(),u=jr(),r=({visible:o,withType:s,onSubmit:c})=>{const[i]=(0,t.useT)(),[f,m]=e.useState(!1),p=(v,y)=>{m(!1),c(v,y)};return f?e.createElement("span",{style:{position:"relative"}},e.createElement(a.ValueInput,{focus:!0,withType:s,visible:o,onSubmit:p,onCancel:()=>m(!1)}),e.createElement(u.CancelAction,{onClick:()=>m(!1)})):e.createElement("span",{className:d.insArrBlock,style:{display:o?void 0:"none"}},e.createElement("span",{className:d.insArrDot}),e.createElement("span",{className:d.insArrLine}),e.createElement("span",{className:d.insArrButton},e.createElement(n.AddAction,{tooltip:i("Insert"),onClick:()=>m(!0)})))};return kt.ArrayInsert=r,kt}var gc;function r0(){if(gc)return Et;gc=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.JsonArrayInsert=void 0;const e=M(),t=ar(),d=Ti(),a=({pointer:n,visible:u})=>{const{onChange:r}=e.useContext(t.context);if(!r)return null;const o=s=>{let c;try{c=JSON.parse(s)}catch{c=String(s)}r([{op:"add",path:n,value:c}])};return e.createElement(d.ArrayInsert,{visible:u,onSubmit:o})};return Et.JsonArrayInsert=a,Et}var At={},yc;function Al(){if(yc)return At;yc=1,Object.defineProperty(At,"__esModule",{value:!0}),At.ObjectLayout=void 0;const e=M(),t=Y(),d=Z(),a=te(),n=({property:u,collapsedView:r,header:o,collapsed:s,comma:c,brackets:i=["{","}"],children:f,onClick:m,onCollapserClick:p,onCollapsedClick:v,onBracketClick:y})=>{const[b,l]=e.useState(!1),h=(0,t.useTheme)(),{noCollapseToggles:w}=(0,a.useStyles)(),g=()=>{l(!0)},_=()=>{l(!1)},C=h.g(.3);r=e.createElement("span",{className:d.collapsed,style:{display:s?void 0:"none"},onClick:v},e.createElement("span",{style:{color:d.blue}},i[0]),r,e.createElement("span",{style:{color:d.blue}},i[1]));const O=e.createElement("span",null,u,e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:g,onMouseLeave:_,onClick:y},i[0],!!o&&e.createElement("span",{style:{display:"inline-block",position:"absolute",top:"-0.27em",left:"1em"}},o)));return e.createElement("span",{className:d.object,onClick:m},!w&&e.createElement("span",{className:d.collapser,style:{color:h.g(.6)},onClick:p},s?"+":"—"),O,r,e.createElement("span",{className:d.list,style:{display:s?"none":void 0}},f),e.createElement("span",{className:d.bracket+(b?d.bracketHovered:""),style:{display:s?"none":void 0,color:C},onMouseEnter:g,onMouseLeave:_,onClick:y},i[1]),!!c&&",")};return At.ObjectLayout=n,At}var vc;function s0(){return vc||(vc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonDoc=void 0;const t=M(),d=Z(),a=ar(),n=Cl(),u=Yh(),r=Ol(),o=n0(),s=r0(),c=Al(),i=ue(),f=te(),m=Ir(),p=({property:b,doc:l,pointer:h,parentCollapsed:w,comma:g,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,keepOrder:S,collapsed:E}=(0,f.useStyles)(),A=t.useMemo(()=>{const T=Object.keys(l);return S?T:T.sort()},[l]),[N,x]=t.useState(E),I=()=>{!N&&C+h===O&&x(!0)},R=A.map((T,q)=>{const B=`${h}/${(0,m.escapeComponent)(T)}`;return t.createElement("span",{key:T,className:d.line},t.createElement(r.JsonHoverable,{pointer:B},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{property:T,doc:l[T],pointer:B,parentCollapsed:N,comma:k&&q<A.length-1,onChange:_}))))});return t.createElement(c.ObjectLayout,{collapsed:N,collapsedView:!!A.length&&t.createElement("strong",null,A.length),comma:g,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(w),pointer:h,onChange:_}),onClick:()=>{N&&x(!1)},onCollapserClick:()=>x(T=>!T),onBracketClick:I},R,t.createElement(o.JsonObjectInsert,{pointer:h,visible:O===C+h}))},v=({property:b,doc:l,pointer:h,parentCollapsed:w,comma:g,onChange:_})=>{const{pfx:C}=t.useContext(a.context),{focused:O}=(0,i.useFocus)(),{formal:k,collapsed:S}=(0,f.useStyles)(),[E,A]=t.useState(S),N=()=>{!E&&C+h===O&&A(!0)},x=l.map((I,R)=>{const T=`${h}/${R}`;return t.createElement(t.Fragment,{key:R},t.createElement(s.JsonArrayInsert,{pointer:`${h}/${R}`,visible:O===C+h}),t.createElement("span",{className:d.line},t.createElement(r.JsonHoverable,{pointer:T},t.createElement("span",{className:d.lineInner},t.createElement(e.JsonDoc,{doc:l[R],pointer:T,parentCollapsed:E,comma:k&&R<l.length-1,onChange:_})))))});return t.createElement(c.ObjectLayout,{collapsed:E,collapsedView:!!l.length&&t.createElement("strong",null,l.length),comma:g,property:typeof b=="string"&&t.createElement(n.JsonProperty,{key:"k"+String(w),pointer:h,onChange:_}),onClick:()=>{E&&A(!1)},onCollapserClick:()=>A(I=>!I),onBracketClick:N,brackets:["[","]"]},x,t.createElement(s.JsonArrayInsert,{pointer:`${h}/-`,visible:O===C+h}))},y=b=>{const{doc:l,comma:h}=b;return l?typeof l=="object"?Array.isArray(l)?t.createElement(v,Object.assign({},b,{doc:l})):l instanceof Uint8Array?t.createElement(u.JsonValue,Object.assign({},b,{comma:h})):t.createElement(p,Object.assign({},b,{doc:l})):t.createElement(u.JsonValue,Object.assign({},b)):t.createElement(u.JsonValue,Object.assign({},b))};e.JsonDoc=y}(Qr)),Qr}var Nt={},yr={},wc;function i0(){if(wc)return yr;wc=1,Object.defineProperty(yr,"__esModule",{value:!0});var e=M(),t=wl(),d=["mousedown","touchstart"],a=function(n,u,r){r===void 0&&(r=d);var o=e.useRef(u);e.useEffect(function(){o.current=u},[u]),e.useEffect(function(){for(var s=function(m){var p=n.current;p&&!p.contains(m.target)&&o.current(m)},c=0,i=r;c<i.length;c++){var f=i[c];t.on(document,f,s)}return function(){for(var m=0,p=r;m<p.length;m++){var v=p[m];t.off(document,v,s)}}},[r,n])};return yr.default=a,yr}var vr={},_c;function o0(){if(_c)return vr;_c=1,Object.defineProperty(vr,"__esModule",{value:!0});var e=M();function t(){var d=e.useRef(!1),a=e.useCallback(function(){return d.current},[]);return e.useEffect(function(){return d.current=!0,function(){d.current=!1}},[]),a}return vr.default=t,vr}var Cc;function Nl(){if(Cc)return Nt;Cc=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.Root=void 0;const e=M(),t=i0(),d=o0(),a=te(),n=ue(),u=Sl(),o=(0,Y().rule)({d:"inline-block",ff:"monospace"}),s=({children:c,onFocus:i})=>{const f=(0,d.default)(),m=(0,a.useStyles)(),{focused:p,focus:v,point:y}=(0,n.useFocus)(),b=e.useRef(null),l=e.useRef(p);return(0,t.default)(b,()=>{f&&(y(null),v(null))}),i&&p!==l.current&&(l.current=p,i(p)),e.createElement(u.InputProvider,null,e.createElement("span",{ref:b,className:o,style:{fontSize:m.fontSize||"13.4px"}},c))};return Nt.Root=s,Nt}var Sc;function xl(){if(Sc)return Ze;Sc=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ClickableJson=void 0;const e=M(),t=ar(),d=te(),a=s0(),n=Nl(),u=ue(),r=Ol(),o=s=>{var c;const{onFocus:i}=s,f=s.readonly?void 0:s.onChange;return e.createElement(u.FocusProvider,null,e.createElement(d.context.Provider,{value:s},e.createElement(t.context.Provider,{value:{pfx:(c=s.pfx)!==null&&c!==void 0?c:"",onChange:f}},e.createElement(n.Root,{onFocus:i},e.createElement(r.JsonHoverable,{pointer:""},e.createElement(a.JsonDoc,Object.assign({},s,{pointer:"",onChange:f})))))))};return Ze.ClickableJson=o,Ze}var xt={},xs={},Oc;function le(){return Oc||(Oc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useJsonCrdt=e.context=void 0;const t=M();e.context=t.createContext(null);const d=()=>t.useContext(e.context);e.useJsonCrdt=d}(xs)),xs}var Ie={},Ec;function dr(){if(Ec)return Ie;Ec=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.nodeRef=Ie.NodeRef=void 0;let e=class{constructor(n,u,r){this.node=n,this.parent=u,this.step=r}};Ie.NodeRef=e;const t=new WeakMap,d=(a,n,u)=>{try{const r=t.get(a);if(r)return r;const o=new e(a,n,u);return t.set(a,o),o}catch{return}};return Ie.nodeRef=d,Ie}var Rs={},Is={},Ts={},kc;function c0(){return kc||(kc=1,Object.defineProperty(Ts,"__esModule",{value:!0})),Ts}var js={},Rt={},Ps={},Ms={},Ac;function a0(){return Ac||(Ac=1,Object.defineProperty(Ms,"__esModule",{value:!0})),Ms}var qs={},Nc;function u0(){return Nc||(Nc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class t{constructor(b,l){this.sid=b,this.time=l}}e.Timestamp=t;class d{constructor(b,l,h){this.sid=b,this.time=l,this.span=h}}e.Timespan=d;const a=(y,b)=>new t(y,b);e.ts=a;const n=(y,b,l)=>new d(y,b,l);e.tss=n;const u=(y,b)=>(0,e.ts)(y.sid,y.time+b);e.tick=u;const r=(y,b)=>y.time===b.time&&y.sid===b.sid;e.equal=r;const o=(y,b)=>{const l=y.time,h=b.time;if(l>h)return 1;if(l<h)return-1;const w=y.sid,g=b.sid;return w>g?1:w<g?-1:0};e.compare=o;const s=(y,b,l,h)=>{if(y.sid!==l.sid)return!1;const w=y.time,g=l.time;return!(w>g||w+b<g+h)};e.contains=s;const c=(y,b,l)=>{if(y.sid!==l.sid)return!1;const h=y.time,w=l.time;return!(h>w||h+b<w+1)};e.containsId=c;const i=y=>{if(y.sid===1)return"."+y.time;let b=""+y.sid;return b.length>4&&(b=".."+b.slice(b.length-4)),b+"."+y.time};e.printTs=i;const f=(y,b,l)=>new d(y.sid,y.time+b,l);e.interval=f;class m extends t{tick(b){const l=new t(this.sid,this.time);return this.time+=b,l}}e.LogicalClock=m;class p extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,l){const h=b.time+l-1,w=b.sid;if(w!==this.sid){const g=this.peers.get(b.sid);g?h>g.time&&(g.time=h):this.peers.set(b.sid,(0,e.ts)(w,h))}h>=this.time&&(this.time=h+1)}clone(){return this.fork(this.sid)}fork(b){const l=new p(b,this.time);return b!==this.sid&&l.observe((0,e.tick)(this,-1),1),this.peers.forEach(h=>{l.observe(h,1)}),l}toString(b=""){const l=this.peers.size;let h=1,w="";return this.peers.forEach(g=>{w+=`
${b}${h===l?"└─":"├─"} ${g.sid}.${g.time}`,h++}),`clock ${this.sid}.${this.time}${w}`}}e.ClockVector=p;class v extends m{constructor(){super(...arguments),this.peers=new Map}observe(b,l){if(b.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<b.time)throw new Error("TIME_TRAVEL");const h=b.time+l;h>this.time&&(this.time=h)}clone(){return this.fork()}fork(){return new v(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=v}(qs)),qs}var xc;function z(){return xc||(xc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(a0(),e),t.__exportStar(u0(),e)}(Ps)),Ps}var Rc;function Pr(){if(Rc)return Rt;Rc=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.ConNode=void 0;const e=z();let t=class{constructor(a,n){this.id=a,this.val=n,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(a){const n=this.val,u=n instanceof Uint8Array?`Uint8Array { ${(""+n).replaceAll(",",", ")} }`:`{ ${n instanceof e.Timestamp?(0,e.printTs)(n):JSON.stringify(n)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${u}`}};return Rt.ConNode=t,Rt}var It={},Tt={},Ic;function pe(){if(Ic)return Tt;Ic=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.printTree=void 0;const e=(t="",d)=>{let a="",n=d.length-1;for(;n>=0&&!d[n];n--);for(let u=0;u<=n;u++){const r=d[u];if(!r)continue;const o=u===n,s=r(t+(o?" ":"│")+"  "),c=s?o?"└─":"├─":"│";a+=`
`+t+c+(s?" "+s:"")}return a};return Tt.printTree=e,Tt}var Te={},D={},Tc;function Ye(){if(Tc)return D;Tc=1,Object.defineProperty(D,"__esModule",{value:!0}),D.NopOp=D.DelOp=D.UpdArrOp=D.InsArrOp=D.InsBinOp=D.InsStrOp=D.InsVecOp=D.InsObjOp=D.InsValOp=D.NewArrOp=D.NewBinOp=D.NewStrOp=D.NewVecOp=D.NewObjOp=D.NewValOp=D.NewConOp=void 0;const e=pe(),t=z();class d{constructor(g){this.id=g}span(){return 1}toString(){let g=this.name()+" "+(0,t.printTs)(this.id);const _=this.span();return _>1&&(g+="!"+_),g}}class a extends d{constructor(g,_){super(g),this.id=g,this.val=_}name(){return"new_con"}toString(){const g=this.val,_="Uint8Array",C=g instanceof t.Timestamp?`{ ${(0,t.printTs)(g)} }`:g instanceof Uint8Array?g.length<13?`${_} { ${(""+g).replaceAll(",",", ")} }`:`${_}(${g.length})`:`{ ${JSON.stringify(g)} }`;return super.toString()+" "+C}}D.NewConOp=a;class n extends d{name(){return"new_val"}}D.NewValOp=n;class u extends d{name(){return"new_obj"}}D.NewObjOp=u;class r extends d{name(){return"new_vec"}}D.NewVecOp=r;class o extends d{name(){return"new_str"}}D.NewStrOp=o;class s extends d{name(){return"new_bin"}}D.NewBinOp=s;class c extends d{name(){return"new_arr"}}D.NewArrOp=c;class i extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.val=C}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}, val = ${(0,t.printTs)(this.val)}`}}D.InsValOp=i;class f extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.data=C}name(){return"ins_obj"}toString(g=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(g,this.data.map(C=>O=>`${JSON.stringify(C[0])}: ${(0,t.printTs)(C[1])}`))}}D.InsObjOp=f;class m extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.data=C}name(){return"ins_vec"}toString(g=""){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)}`+(0,e.printTree)(g,this.data.map(C=>O=>`${C[0]}: ${(0,t.printTs)(C[1])}`))}}D.InsVecOp=m;class p extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${(0,t.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}D.InsStrOp=p;class v extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_bin"}toString(){const g=(0,t.printTs)(this.ref);return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${g} ← ${this.data} }`}}D.InsBinOp=v;class y extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.data=O}span(){return this.data.length}name(){return"ins_arr"}toString(){const g=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=this.data.map(t.printTs).join(", ");return super.toString()+", obj = "+g+" { "+_+" ← "+C+" }"}}D.InsArrOp=y;class b extends d{constructor(g,_,C,O){super(g),this.id=g,this.obj=_,this.ref=C,this.val=O}name(){return"upd_arr"}toString(){const g=(0,t.printTs)(this.obj),_=(0,t.printTs)(this.ref),C=(0,t.printTs)(this.val);return super.toString()+", obj = "+g+" { "+_+": "+C+" }"}}D.UpdArrOp=b;class l extends d{constructor(g,_,C){super(g),this.id=g,this.obj=_,this.what=C}name(){return"del"}toString(){const g=this.what.map(_=>(0,t.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,t.printTs)(this.obj)} { ${g} }`}}D.DelOp=l;class h extends d{constructor(g,_){super(g),this.id=g,this.len=_}span(){return this.len}name(){return"nop"}}return D.NopOp=h,D}var je={},jt={},Pt={},Mt={},jc;function l0(){if(jc)return Mt;jc=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.RelativeTimestamp=void 0;let e=class{constructor(d,a){this.sessionIndex=d,this.timeDiff=a}};return Mt.RelativeTimestamp=e,Mt}var Pc;function d0(){if(Pc)return Pt;Pc=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.ClockEncoder=void 0;const e=z(),t=l0();class d{constructor(u,r){this.index=u,this.clock=r}}let a=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(u){this.index=1,this.clock=u;const r=new d(this.index++,(0,e.tick)(u,-1));this.table.clear(),this.table.set(u.sid,r)}append(u){const r=u.time,o=u.sid;let s=this.table.get(o);if(!s){let f=this.clock.peers.get(o);f||(f=new e.Timestamp(o,this.clock.time-1)),s=new d(this.index++,f),this.table.set(o,s)}const i=s.clock.time-r;if(i<0)throw new Error("TIME_TRAVEL");return new t.RelativeTimestamp(s.index,i)}toJson(){const u=[];return this.table.forEach(r=>{const o=r.clock;u.push(o.sid,o.time)}),u}};return Pt.ClockEncoder=a,Pt}var qt={},Bt={},Vt={},Mc;function f0(){if(Mc)return Vt;Mc=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Slice=void 0;let e=class{constructor(d,a,n,u){this.uint8=d,this.view=a,this.start=n,this.end=u}subarray(){return this.uint8.subarray(this.start,this.end)}};return Vt.Slice=e,Vt}var qc;function Rl(){if(qc)return Bt;qc=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Writer=void 0;const e=f0(),t=new Uint8Array([]),d=new DataView(t.buffer),a=typeof ae.Buffer=="function",n=a?ae.Buffer.prototype.utf8Write:null,u=a?ae.Buffer.from:null,r=typeof TextEncoder<"u"?new TextEncoder:null;let o=class{constructor(c=64*1024){this.allocSize=c,this.view=d,this.x0=0,this.x=0,this.uint8=new Uint8Array(c),this.size=c,this.view=new DataView(this.uint8.buffer)}grow(c){const i=this.x0,f=this.x,m=this.uint8,p=new Uint8Array(c),v=new DataView(p.buffer),y=m.subarray(i,f);p.set(y,0),this.x=f-i,this.x0=0,this.uint8=p,this.size=c,this.view=v}ensureCapacity(c){const i=this.size,f=i-this.x;if(f<c){const m=i-this.x0,p=c-f,v=m+p;this.grow(v<=this.allocSize?this.allocSize:v*2)}}move(c){this.ensureCapacity(c),this.x+=c}reset(){this.x0=this.x}newBuffer(c){const i=this.uint8=new Uint8Array(c);this.size=c,this.view=new DataView(i.buffer),this.x=this.x0=0}flush(){const c=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,c}flushSlice(){const c=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,c}u8(c){this.ensureCapacity(1),this.uint8[this.x++]=c}u16(c){this.ensureCapacity(2),this.view.setUint16(this.x,c),this.x+=2}u32(c){this.ensureCapacity(4),this.view.setUint32(this.x,c),this.x+=4}i32(c){this.ensureCapacity(4),this.view.setInt32(this.x,c),this.x+=4}u64(c){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(c)),this.x+=8}f64(c){this.ensureCapacity(8),this.view.setFloat64(this.x,c),this.x+=8}u8u16(c,i){this.ensureCapacity(3);let f=this.x;this.uint8[f++]=c,this.uint8[f++]=i>>>8,this.uint8[f++]=i&255,this.x=f}u8u32(c,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=c,this.view.setUint32(f,i),this.x=f+4}u8u64(c,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=c,this.view.setBigUint64(f,BigInt(i)),this.x=f+8}u8f32(c,i){this.ensureCapacity(5);let f=this.x;this.uint8[f++]=c,this.view.setFloat32(f,i),this.x=f+4}u8f64(c,i){this.ensureCapacity(9);let f=this.x;this.uint8[f++]=c,this.view.setFloat64(f,i),this.x=f+8}buf(c,i){this.ensureCapacity(i);const f=this.x;this.uint8.set(c,f),this.x=f+i}utf8(c){const i=c.length*4;if(i<168)return this.utf8Native(c);if(n){const f=n.call(this.uint8,c,this.x,i);return this.x+=f,f}else if(u){const f=this.uint8,m=f.byteOffset+this.x,v=u(f.buffer).subarray(m,m+i).write(c,0,i,"utf8");return this.x+=v,v}else if(i>1024&&r){const f=r.encodeInto(c,this.uint8.subarray(this.x,this.x+i)).written;return this.x+=f,f}return this.utf8Native(c)}utf8Native(c){const i=c.length,f=this.uint8;let m=this.x,p=0;for(;p<i;){let y=c.charCodeAt(p++);if((y&4294967168)===0){f[m++]=y;continue}else if((y&4294965248)===0)f[m++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&p<i){const b=c.charCodeAt(p);(b&64512)===56320&&(p++,y=((y&1023)<<10)+(b&1023)+65536)}(y&4294901760)===0?(f[m++]=y>>12&15|224,f[m++]=y>>6&63|128):(f[m++]=y>>18&7|240,f[m++]=y>>12&63|128,f[m++]=y>>6&63|128)}f[m++]=y&63|128}const v=m-this.x;return this.x=m,v}ascii(c){const i=c.length;this.ensureCapacity(i);const f=this.uint8;let m=this.x,p=0;for(;p<i;)f[m++]=c.charCodeAt(p++);this.x=m}};return Bt.Writer=o,Bt}var Bc;function ji(){if(Bc)return qt;Bc=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.CrdtWriter=void 0;const e=Rl();let t=class extends e.Writer{id(a,n){a<=7&&n<=15?this.u8(a<<4|n):(this.b1vu56(1,a),this.vu57(n))}vu57(a){if(a<=127)this.u8(a);else if(a<=16383){this.ensureCapacity(2);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=a>>>7}else if(a<=2097151){this.ensureCapacity(3);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=a>>>14}else if(a<=268435455){this.ensureCapacity(4);const n=this.uint8;n[this.x++]=128|a&127,n[this.x++]=128|a>>>7&127,n[this.x++]=128|a>>>14&127,n[this.x++]=a>>>21}else{let n=a|0;n<0&&(n+=4294967296);const u=(a-n)/4294967296;if(a<=34359738367){this.ensureCapacity(5);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=u<<4|a>>>28}else if(a<=4398046511103){this.ensureCapacity(6);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=u>>>3}else if(a<=562949953421311){this.ensureCapacity(7);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=u>>>10}else{this.ensureCapacity(8);const r=this.uint8;r[this.x++]=128|a&127,r[this.x++]=128|a>>>7&127,r[this.x++]=128|a>>>14&127,r[this.x++]=128|a>>>21&127,r[this.x++]=128|(u&7)<<4|a>>>28,r[this.x++]=128|(u&1016)>>>3,r[this.x++]=128|(u&130048)>>>10,r[this.x++]=u>>>17}}}b1vu56(a,n){if(n<=63)this.u8(a<<7|n);else{const u=a<<7|64;if(n<=8191){this.ensureCapacity(2);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=n>>>6}else if(n<=1048575){this.ensureCapacity(3);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=n>>>13}else if(n<=134217727){this.ensureCapacity(4);const r=this.uint8;r[this.x++]=u|n&63,r[this.x++]=128|n>>>6&127,r[this.x++]=128|n>>>13&127,r[this.x++]=n>>>20}else{let r=n|0;r<0&&(r+=4294967296);const o=(n-r)/4294967296;if(n<=17179869183){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=o<<5|n>>>27}else if(n<=2199023255551){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(o&3)<<5|n>>>27,s[this.x++]=o>>>2}else if(n<=0xffffffffffff){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(o&3)<<5|n>>>27,s[this.x++]=128|(o&508)>>>2,s[this.x++]=o>>>9}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=u|n&63,s[this.x++]=128|n>>>6&127,s[this.x++]=128|n>>>13&127,s[this.x++]=128|n>>>20&127,s[this.x++]=128|(o&3)<<5|n>>>27,s[this.x++]=128|(o&508)>>>2,s[this.x++]=128|(o&65024)>>>9,s[this.x++]=o>>>16}}}}};return qt.CrdtWriter=t,qt}var $t={},Jt={},Vc;function h0(){if(Vc)return Jt;Vc=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),t=d=>(e.setFloat32(0,d),d===e.getFloat32(0));return Jt.isFloat32=t,Jt}var Lt={},$c;function Il(){if($c)return Lt;$c=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.JsonPackExtension=void 0;let e=class{constructor(d,a){this.tag=d,this.val=a}};return Lt.JsonPackExtension=e,Lt}var Dt={},Jc;function p0(){if(Jc)return Dt;Jc=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.CborEncoderFast=void 0;const e=Rl(),t=Number.isSafeInteger;let d=class{constructor(n=new e.Writer){this.writer=n}encode(n){return this.writeAny(n),this.writer.flush()}encodeToSlice(n){return this.writeAny(n),this.writer.flushSlice()}writeAny(n){switch(typeof n){case"number":return this.writeNumber(n);case"string":return this.writeStr(n);case"boolean":return this.writer.u8(244+ +n);case"object":{if(!n)return this.writer.u8(246);switch(n.constructor){case Array:return this.writeArr(n);default:return this.writeObj(n)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(n){n?this.writer.u8(245):this.writer.u8(244)}writeNumber(n){t(n)?this.writeInteger(n):typeof n=="bigint"?this.writeBigInt(n):this.writeFloat(n)}writeBigInt(n){n>=0?this.writeBigUint(n):this.writeBigSint(n)}writeBigUint(n){if(n<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(n));this.writer.u8u64(27,n)}writeBigSint(n){if(n>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(n));const u=-BigInt(1)-n;this.writer.u8u64(59,u)}writeInteger(n){n>=0?this.writeUInteger(n):this.encodeNint(n)}writeUInteger(n){const u=this.writer;u.ensureCapacity(9);const r=u.uint8;let o=u.x;n<=23?r[o++]=0+n:n<=255?(r[o++]=24,r[o++]=n):n<=65535?(r[o++]=25,u.view.setUint16(o,n),o+=2):n<=4294967295?(r[o++]=26,u.view.setUint32(o,n),o+=4):(r[o++]=27,u.view.setBigUint64(o,BigInt(n)),o+=8),u.x=o}encodeNumber(n){this.writeNumber(n)}encodeInteger(n){this.writeInteger(n)}encodeUint(n){this.writeUInteger(n)}encodeNint(n){const u=-1-n,r=this.writer;r.ensureCapacity(9);const o=r.uint8;let s=r.x;u<24?o[s++]=32+u:u<=255?(o[s++]=56,o[s++]=u):u<=65535?(o[s++]=57,r.view.setUint16(s,u),s+=2):u<=4294967295?(o[s++]=58,r.view.setUint32(s,u),s+=4):(o[s++]=59,r.view.setBigUint64(s,BigInt(u)),s+=8),r.x=s}writeFloat(n){this.writer.u8f64(251,n)}writeBin(n){const u=n.length;this.writeBinHdr(u),this.writer.buf(n,u)}writeBinHdr(n){const u=this.writer;n<=23?u.u8(64+n):n<=255?u.u16(22528+n):n<=65535?u.u8u16(89,n):n<=4294967295?u.u8u32(90,n):u.u8u64(91,n)}writeStr(n){const u=this.writer,o=n.length*4;u.ensureCapacity(5+o);const s=u.uint8;let c=u.x;o<=23?u.x++:o<=255?(s[u.x++]=120,c=u.x,u.x++):o<=65535?(s[u.x++]=121,c=u.x,u.x+=2):(s[u.x++]=122,c=u.x,u.x+=4);const i=u.utf8(n);o<=23?s[c]=96+i:o<=255?s[c]=i:o<=65535?u.view.setUint16(c,i):u.view.setUint32(c,i)}writeStrHdr(n){const u=this.writer;n<=23?u.u8(96+n):n<=255?u.u16(30720+n):n<=65535?u.u8u16(121,n):u.u8u32(122,n)}writeAsciiStr(n){this.writeStrHdr(n.length),this.writer.ascii(n)}writeArr(n){const u=n.length;this.writeArrHdr(u);for(let r=0;r<u;r++)this.writeAny(n[r])}writeArrHdr(n){const u=this.writer;n<=23?u.u8(128+n):n<=255?u.u16(38912+n):n<=65535?u.u8u16(153,n):n<=4294967295?u.u8u32(154,n):u.u8u64(155,n)}writeObj(n){const u=Object.keys(n),r=u.length;this.writeObjHdr(r);for(let o=0;o<r;o++){const s=u[o];this.writeStr(s),this.writeAny(n[s])}}writeObjHdr(n){const u=this.writer;n<=23?u.u8(160+n):n<=255?u.u16(47104+n):n<=65535?u.u8u16(185,n):n<=4294967295?u.u8u32(186,n):u.u8u64(187,n)}writeMapHdr(n){this.writeObjHdr(n)}writeStartMap(){this.writer.u8(191)}writeTag(n,u){this.writeTagHdr(n),this.writeAny(u)}writeTagHdr(n){const u=this.writer;n<=23?u.u8(192+n):n<=255?u.u16(55296+n):n<=65535?u.u8u16(217,n):n<=4294967295?u.u8u32(218,n):u.u8u64(219,n)}writeTkn(n){const u=this.writer;n<=23?u.u8(224+n):n<=255&&u.u16(63488+n)}writeStartStr(){this.writer.u8(127)}writeStrChunk(n){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(n){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(n){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(n,u){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return Dt.CborEncoderFast=d,Dt}var Ft={},Lc;function Pi(){if(Lc)return Ft;Lc=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.JsonPackValue=void 0;let e=class{constructor(d){this.val=d}};return Ft.JsonPackValue=e,Ft}var Dc;function Tl(){if(Dc)return $t;Dc=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.CborEncoder=void 0;const e=h0(),t=Il(),d=p0(),a=Pi();let n=class extends d.CborEncoderFast{writeUnknown(r){this.writeNull()}writeAny(r){switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"boolean":return this.writer.u8(244+ +r);case"object":{if(!r)return this.writer.u8(246);switch(r.constructor){case Object:return this.writeObj(r);case Array:return this.writeArr(r);case Uint8Array:return this.writeBin(r);case Map:return this.writeMap(r);case t.JsonPackExtension:return this.writeTag(r.tag,r.val);case a.JsonPackValue:const s=r.val;return this.writer.buf(s,s.length);default:return r instanceof Uint8Array?this.writeBin(r):Array.isArray(r)?this.writeArr(r):r instanceof Map?this.writeMap(r):this.writeUnknown(r)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(r);default:return this.writeUnknown(r)}}writeFloat(r){(0,e.isFloat32)(r)?this.writer.u8f32(250,r):this.writer.u8f64(251,r)}writeMap(r){this.writeMapHdr(r.size),r.forEach((o,s)=>{this.writeAny(s),this.writeAny(o)})}writeUndef(){this.writer.u8(247)}};return $t.CborEncoder=n,$t}var Pe={},Fc;function jl(){if(Fc)return Pe;Fc=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.CRDT_MAJOR_OVERLAY=Pe.CRDT_MAJOR=void 0;var e;(function(d){d[d.CON=0]="CON",d[d.VAL=1]="VAL",d[d.OBJ=2]="OBJ",d[d.VEC=3]="VEC",d[d.STR=4]="STR",d[d.BIN=5]="BIN",d[d.ARR=6]="ARR"})(e||(Pe.CRDT_MAJOR=e={}));var t;return function(d){d[d.CON=0]="CON",d[d.VAL=32]="VAL",d[d.VEC=96]="VEC",d[d.OBJ=64]="OBJ",d[d.STR=128]="STR",d[d.BIN=160]="BIN",d[d.ARR=192]="ARR"}(t||(Pe.CRDT_MAJOR_OVERLAY=t={})),Pe}var Uc;function m0(){if(Uc)return jt;Uc=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.Encoder=void 0;const t=J.__importStar(ke()),d=d0(),a=ji(),n=z(),u=Tl(),r=jl();class o extends u.CborEncoder{constructor(c){super(c||new a.CrdtWriter),this.clockEncoder=new d.ClockEncoder,this.time=0,this.cTableEntry=i=>{const f=i.clock,m=this.writer;m.vu57(f.sid),m.vu57(f.time)},this.tsLogical=i=>{const f=this.clockEncoder.append(i);this.writer.id(f.sessionIndex,f.timeDiff)},this.tsServer=i=>{this.writer.vu57(i.time)},this.ts=this.tsLogical,this.cKey=(i,f)=>{this.writeStr(f),this.cNode(this.doc.index.get(i))}}encode(c){this.doc=c;const i=this.writer;return i.reset(),c.clock.sid===1?this.encodeServer(c):this.encodeLogical(c),i.flush()}encodeLogical(c){const i=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(c.clock),i.ensureCapacity(4);const f=i.x0,m=i.x;i.x+=4,this.cRoot(c.root),this.encodeClockTable(f,m)}encodeServer(c){this.ts=this.tsServer;const i=this.writer;i.u8(128),i.vu57(this.time=c.clock.time),this.cRoot(c.root)}encodeClockTable(c,i){const f=this.writer,m=f.x0-c;f.view.setUint32(f.x0+(i-c),f.x-i-m-4);const v=this.clockEncoder.table,y=v.size;f.vu57(y),v.forEach(this.cTableEntry)}cRoot(c){c.val.sid===0?this.writer.u8(0):this.cNode(c.node())}writeTL(c,i){const f=this.writer;i<31?f.u8(c|i):(f.u8(c|31),f.vu57(i))}cNode(c){c instanceof t.ConNode?this.cCon(c):c instanceof t.ValNode?this.cVal(c):c instanceof t.StrNode?this.cStr(c):c instanceof t.ObjNode?this.cObj(c):c instanceof t.VecNode?this.cVec(c):c instanceof t.ArrNode?this.cArr(c):c instanceof t.BinNode&&this.cBin(c)}cCon(c){const i=c.val;this.ts(c.id),i instanceof n.Timestamp?(this.writer.u8(1),this.ts(i)):(this.writer.u8(0),this.writeAny(i))}cVal(c){this.ts(c.id),this.writer.u8(32),this.cNode(c.node())}cObj(c){this.ts(c.id);const i=c.keys;this.writeTL(r.CRDT_MAJOR_OVERLAY.OBJ,i.size),i.forEach(this.cKey)}cVec(c){const i=c.elements,f=i.length;this.ts(c.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.VEC,f);const m=this.doc.index;for(let p=0;p<f;p++){const v=i[p];v?this.cNode(m.get(v)):this.writer.u8(0)}}cStr(c){const i=this.ts;i(c.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.STR,c.count);for(let f=c.first();f;f=c.next(f))i(f.id),f.del?this.writeUInteger(f.span):this.writeStr(f.data)}cBin(c){const i=this.ts,f=this.writer;i(c.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.BIN,c.count);for(let m=c.first();m;m=c.next(m)){i(m.id);const p=m.span,v=m.del;f.b1vu56(~~v,p),!v&&f.buf(m.data,p)}}cArr(c){const i=this.ts,f=this.writer;i(c.id),this.writeTL(r.CRDT_MAJOR_OVERLAY.ARR,c.count);const m=this.doc.index;for(let p=c.first();p;p=c.next(p)){i(p.id);const v=p.span,y=p.del;if(f.b1vu56(~~y,v),y)continue;const b=p.data;for(let l=0;l<v;l++)this.cNode(m.get(b[l]))}}}return jt.Encoder=o,jt}var Ut={},Gt={},Gc;function b0(){if(Gc)return Gt;Gc=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ClockDecoder=void 0;const e=z();let t=class Pl{static fromArr(a){const n=new Pl(a[0],a[1]),u=a.length;for(let r=2;r<u;r+=2)n.pushTuple(a[r],a[r+1]);return n}constructor(a,n){this.table=[],this.clock=new e.ClockVector(a,n+1),this.table.push((0,e.ts)(a,n))}pushTuple(a,n){const u=(0,e.ts)(a,n);this.clock.observe(u,1),this.table.push(u)}decodeId(a,n){if(!a)return(0,e.ts)(0,n);const u=this.table[a-1];if(!u)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(u.sid,u.time-n)}};return Gt.ClockDecoder=t,Gt}var Ht={},zt={},Wt={},wr={},Me={},Hc;function g0(){if(Hc)return Me;Hc=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.decodeAsciiMax15=Me.decodeAscii=void 0;const e=String.fromCharCode,t=(a,n,u)=>{const r=[];for(let o=0;o<u;o++){const s=a[n++];if(s&128)return;r.push(s)}return e.apply(String,r)};Me.decodeAscii=t;const d=(a,n,u)=>{if(u<4)if(u<2){if(u===0)return"";{const r=a[n++];if((r&128)>1){n-=1;return}return e(r)}}else{const r=a[n++],o=a[n++];if((r&128)>0||(o&128)>0){n-=2;return}if(u<3)return e(r,o);const s=a[n++];if((s&128)>0){n-=3;return}return e(r,o,s)}else{const r=a[n++],o=a[n++],s=a[n++],c=a[n++];if((r&128)>0||(o&128)>0||(s&128)>0||(c&128)>0){n-=4;return}if(u<6){if(u===4)return e(r,o,s,c);{const i=a[n++];if((i&128)>0){n-=5;return}return e(r,o,s,c,i)}}else if(u<8){const i=a[n++],f=a[n++];if((i&128)>0||(f&128)>0){n-=6;return}if(u<7)return e(r,o,s,c,i,f);const m=a[n++];if((m&128)>0){n-=7;return}return e(r,o,s,c,i,f,m)}else{const i=a[n++],f=a[n++],m=a[n++],p=a[n++];if((i&128)>0||(f&128)>0||(m&128)>0||(p&128)>0){n-=8;return}if(u<10){if(u===8)return e(r,o,s,c,i,f,m,p);{const v=a[n++];if((v&128)>0){n-=9;return}return e(r,o,s,c,i,f,m,p,v)}}else if(u<12){const v=a[n++],y=a[n++];if((v&128)>0||(y&128)>0){n-=10;return}if(u<11)return e(r,o,s,c,i,f,m,p,v,y);const b=a[n++];if((b&128)>0){n-=11;return}return e(r,o,s,c,i,f,m,p,v,y,b)}else{const v=a[n++],y=a[n++],b=a[n++],l=a[n++];if((v&128)>0||(y&128)>0||(b&128)>0||(l&128)>0){n-=12;return}if(u<14){if(u===12)return e(r,o,s,c,i,f,m,p,v,y,b,l);{const h=a[n++];if((h&128)>0){n-=13;return}return e(r,o,s,c,i,f,m,p,v,y,b,l,h)}}else{const h=a[n++],w=a[n++];if((h&128)>0||(w&128)>0){n-=14;return}if(u<15)return e(r,o,s,c,i,f,m,p,v,y,b,l,h,w);const g=a[n++];if((g&128)>0){n-=15;return}return e(r,o,s,c,i,f,m,p,v,y,b,l,h,w,g)}}}}};return Me.decodeAsciiMax15=d,Me}var _r={},zc;function y0(){if(zc)return _r;zc=1,Object.defineProperty(_r,"__esModule",{value:!0});const e=String.fromCharCode;return _r.default=(t,d,a)=>{let n=d;const u=n+a,r=[];for(;n<u;){let o=t[n++];if((o&128)!==0){const s=t[n++]&63;if((o&224)===192)o=(o&31)<<6|s;else{const c=t[n++]&63;if((o&240)===224)o=(o&31)<<12|s<<6|c;else if((o&248)===240){const i=t[n++]&63;let f=(o&7)<<18|s<<12|c<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;o=56320|f&1023,r.push(m)}else o=f}}}r.push(o)}return e.apply(String,r)},_r}var Wc;function v0(){if(Wc)return wr;Wc=1,Object.defineProperty(wr,"__esModule",{value:!0});const e=J,t=g0(),d=e.__importDefault(y0()),a=typeof ae.Buffer<"u",n=a?ae.Buffer.prototype.utf8Slice:null,u=a?ae.Buffer.from:null,r=(i,f,m)=>(0,t.decodeAsciiMax15)(i,f,m)??(0,d.default)(i,f,m),o=(i,f,m)=>(0,t.decodeAscii)(i,f,m)??(0,d.default)(i,f,m),s=n?(i,f,m)=>n.call(i,f,f+m):u?(i,f,m)=>u(i).subarray(f,f+m).toString("utf8"):d.default,c=(i,f,m)=>m<16?r(i,f,m):m<32?o(i,f,m):s(i,f,m);return wr.default=c,wr}var Kc;function w0(){if(Kc)return Wt;Kc=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.decodeUtf8=void 0;const t=J.__importDefault(v0());return Wt.decodeUtf8=t.default,Wt}var Yc;function Ml(){if(Yc)return zt;Yc=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Reader=void 0;const e=w0();let t=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(a){this.x=0,this.uint8=a,this.view=new DataView(a.buffer,a.byteOffset,a.length)}peak(){return this.view.getUint8(this.x)}skip(a){this.x+=a}buf(a){const n=this.x+a,u=this.uint8.subarray(this.x,n);return this.x=n,u}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let a=this.x;const n=(this.uint8[a++]<<8)+this.uint8[a++];return this.x=a,n}i16(){const a=this.view.getInt16(this.x);return this.x+=2,a}u32(){const a=this.view.getUint32(this.x);return this.x+=4,a}i32(){const a=this.view.getInt32(this.x);return this.x+=4,a}u64(){const a=this.view.getBigUint64(this.x);return this.x+=8,a}i64(){const a=this.view.getBigInt64(this.x);return this.x+=8,a}f32(){const a=this.x;return this.x+=4,this.view.getFloat32(a)}f64(){const a=this.x;return this.x+=8,this.view.getFloat64(a)}utf8(a){const n=this.x;return this.x+=a,(0,e.decodeUtf8)(this.uint8,n,a)}ascii(a){const n=this.uint8;let u="";const r=this.x+a;for(let o=this.x;o<r;o++)u+=String.fromCharCode(n[o]);return this.x=r,u}};return zt.Reader=t,zt}var Xc;function ql(){if(Xc)return Ht;Xc=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.CrdtReader=void 0;const e=Ml();let t=class extends e.Reader{id(){const a=this.u8();return a<=127?[a>>>4,a&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const a=this.u8();if(a<=127)return a;const n=this.u8();if(n<=127)return n<<7|a&127;const u=this.u8();if(u<=127)return u<<14|(n&127)<<7|a&127;const r=this.u8();if(r<=127)return r<<21|(u&127)<<14|(n&127)<<7|a&127;const o=this.u8();if(o<=127)return o*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127);const s=this.u8();if(s<=127)return s*34359738368+((o&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127));const c=this.u8();return c<=127?c*4398046511104+((s&127)*34359738368+((o&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127))):this.u8()*562949953421312+((c&127)*4398046511104+((s&127)*34359738368+((o&127)*268435456+((r&127)<<21|(u&127)<<14|(n&127)<<7|a&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const a=this.u8(),n=a&128?1:0,u=127&a;if(u<=63)return[n,u];const r=this.u8();if(r<=127)return[n,r<<6|u&63];const o=this.u8();if(o<=127)return[n,o<<13|(r&127)<<6|u&63];const s=this.u8();if(s<=127)return[n,s<<20|(o&127)<<13|(r&127)<<6|u&63];const c=this.u8();if(c<=127)return[n,c*134217728+((s&127)<<20|(o&127)<<13|(r&127)<<6|u&63)];const i=this.u8();if(i<=127)return[n,i*17179869184+((c&127)*134217728+((s&127)<<20|(o&127)<<13|(r&127)<<6|u&63))];const f=this.u8();if(f<=127)return[n,f*2199023255552+((i&127)*17179869184+((c&127)*134217728+((s&127)<<20|(o&127)<<13|(r&127)<<6|u&63)))];const m=this.u8();return[n,m*281474976710656+((f&127)*2199023255552+((i&127)*17179869184+((c&127)*134217728+((s&127)<<20|(o&127)<<13|(r&127)<<6|u&63))))]}};return Ht.CrdtReader=t,Ht}var Kt={},Yt={},Qc;function _0(){if(Qc)return Yt;Qc=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.decodeF16=void 0;const e=Math.pow,t=d=>{const a=(d&31744)>>10,n=d&1023;return(d>>15?-1:1)*(a?a===31?n?NaN:1/0:e(2,a-15)*(1+n/1024):6103515625e-14*(n/1024))};return Yt.decodeF16=t,Yt}var Cr={},Xt={},Sr={},Zc;function C0(){if(Zc)return Sr;Zc=1,Object.defineProperty(Sr,"__esModule",{value:!0});const e=String.fromCharCode;return Sr.default=(t,d,a)=>{let n=d;const u=n+a;let r="";for(;n<u;){const o=t[n++];if((o&128)===0){r+=e(o);continue}const s=t[n++]&63;if((o&224)===192){r+=e((o&31)<<6|s);continue}const c=t[n++]&63;if((o&240)===224){r+=e((o&31)<<12|s<<6|c);continue}if((o&248)===240){const i=t[n++]&63;let f=(o&7)<<18|s<<12|c<<6|i;if(f>65535){f-=65536;const m=f>>>10&1023|55296;f=56320|f&1023,r+=e(m,f)}else r+=e(f)}else r+=e(o)}return r},Sr}var ea;function S0(){if(ea)return Xt;ea=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.CachedUtf8Decoder=void 0;const t=J.__importDefault(C0());let d=1+Math.round(Math.random()*((-1>>>0)-1));function a(r,o){return d^=d<<13,d^=d>>>17,d^=d<<5,(d>>>0)%(o-r+1)+r}class n{constructor(o,s){this.bytes=o,this.value=s}}let u=class{constructor(){this.caches=[];for(let o=0;o<31;o++)this.caches.push([])}get(o,s,c){const i=this.caches[c-1],f=i.length;e:for(let m=0;m<f;m++){const p=i[m],v=p.bytes;for(let y=0;y<c;y++)if(v[y]!==o[s+y])continue e;return p.value}return null}store(o,s){const c=this.caches[o.length-1],i=new n(o,s);c.length>=16?c[a(0,15)]=i:c.push(i)}decode(o,s,c){if(!c)return"";const i=this.get(o,s,c);if(i!==null)return i;const f=(0,t.default)(o,s,c),m=Uint8Array.prototype.slice.call(o,s,s+c);return this.store(m,f),f}};return Xt.CachedUtf8Decoder=u,Xt}var ta;function O0(){if(ta)return Cr;ta=1,Object.defineProperty(Cr,"__esModule",{value:!0});const e=S0();return Cr.default=new e.CachedUtf8Decoder,Cr}var na;function Bl(){if(na)return Kt;na=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.CborDecoderBase=void 0;const e=J,t=_0(),d=Il(),a=Pi(),n=Ml(),u=e.__importDefault(O0());let r=class{constructor(s=new n.Reader,c=u.default){this.reader=s,this.keyDecoder=c}read(s){return this.reader.reset(s),this.val()}decode(s){return this.reader.reset(s),this.val()}val(){const c=this.reader.u8(),i=c>>5,f=c&31;return i<4?i<2?i===0?this.readUint(f):this.readNint(f):i===2?this.readBin(f):this.readStr(f):i<6?i===4?this.readArr(f):this.readObj(f):i===6?this.readTag(f):this.readTkn(f)}readAnyRaw(s){const c=s>>5,i=s&31;return c<4?c<2?c===0?this.readUint(i):this.readNint(i):c===2?this.readBin(i):this.readStr(i):c<6?c===4?this.readArr(i):this.readObj(i):c===6?this.readTag(i):this.readTkn(i)}readMinorLen(s){if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(s){if(s<25)return s===24?this.reader.u8():s;if(s<27)return s===25?this.reader.u16():this.reader.u32();{const c=this.reader.u64();return c>9007199254740991?c:Number(c)}}readNint(s){if(s<25)return s===24?-this.reader.u8()-1:-s-1;if(s<27)return s===25?-this.reader.u16()-1:-this.reader.u32()-1;{const c=this.reader.u64();return c>9007199254740991-1?-c-BigInt(1):-Number(c)-1}}readBin(s){const c=this.reader;if(s<=23)return c.buf(s);switch(s){case 24:return c.buf(c.u8());case 25:return c.buf(c.u16());case 26:return c.buf(c.u32());case 27:return c.buf(Number(c.u64()));case 31:{let i=0;const f=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();i+=y.length,f.push(y)}this.reader.x++;const m=new Uint8Array(i);let p=0;const v=f.length;for(let y=0;y<v;y++){const b=f[y];m.set(b,p),p+=b.length}return m}default:throw 1}}readBinChunk(){const s=this.reader.u8(),c=s>>5,i=s&31;if(c!==2)throw 2;if(i>27)throw 3;return this.readBin(i)}readAsStr(){const c=this.reader.u8(),i=c>>5,f=c&31;if(i!==3)throw 11;return this.readStr(f)}readStr(s){const c=this.reader;if(s<=23)return c.utf8(s);switch(s){case 24:return c.utf8(c.u8());case 25:return c.utf8(c.u16());case 26:return c.utf8(c.u32());case 27:return c.utf8(Number(c.u64()));case 31:{let i="";for(;c.peak()!==255;)i+=this.readStrChunk();return this.reader.x++,i}default:throw 1}}readStrLen(s){if(s<=23)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const s=this.reader.u8(),c=s>>5,i=s&31;if(c!==3)throw 4;if(i>27)throw 5;return this.readStr(i)}readArr(s){const c=this.readMinorLen(s);return c>=0?this.readArrRaw(c):this.readArrIndef()}readArrRaw(s){const c=[];for(let i=0;i<s;i++)c.push(this.val());return c}readArrIndef(){const s=[];for(;this.reader.peak()!==255;)s.push(this.val());return this.reader.x++,s}readObj(s){if(s<28){let c=s;switch(s){case 24:c=this.reader.u8();break;case 25:c=this.reader.u16();break;case 26:c=this.reader.u32();break;case 27:c=Number(this.reader.u64());break}const i={};for(let f=0;f<c;f++){const m=this.key();if(m==="__proto__")throw 6;const p=this.val();i[m]=p}return i}else{if(s===31)return this.readObjIndef();throw 1}}readObjRaw(s){const c={};for(let i=0;i<s;i++){const f=this.key(),m=this.val();c[f]=m}return c}readObjIndef(){const s={};for(;this.reader.peak()!==255;){const c=this.key();if(this.reader.peak()===255)throw 7;const i=this.val();s[c]=i}return this.reader.x++,s}key(){const s=this.reader.u8(),c=s>>5,i=s&31;if(c!==3)return String(this.readAnyRaw(s));const f=this.readStrLen(i);if(f>31)return this.reader.utf8(f);const m=this.keyDecoder.decode(this.reader.uint8,this.reader.x,f);return this.reader.skip(f),m}readTag(s){if(s<=23)return this.readTagRaw(s);switch(s){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(s){return new d.JsonPackExtension(s,this.val())}readTkn(s){switch(s){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new a.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(s<=23)return new a.JsonPackValue(s);throw 1}f16(){return(0,t.decodeF16)(this.reader.u16())}};return Kt.CborDecoderBase=r,Kt}var ra;function E0(){if(ra)return Ut;ra=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Decoder=void 0;const t=J.__importStar(ke()),d=b0(),a=ql(),n=z(),u=$i(),r=Bl(),o=jl();class s extends r.CborDecoderBase{constructor(){super(new a.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const i=this.ts(),f=this.val();return typeof f=="string"?new t.StrChunk(i,f.length,f):new t.StrChunk(i,~~f,"")},this.cBinChunk=()=>{const i=this.ts(),f=this.reader,[m,p]=f.b1vu56();return m?new t.BinChunk(i,p,void 0):new t.BinChunk(i,p,f.buf(p))},this.cArrChunk=()=>{const i=this.ts(),[f,m]=this.reader.b1vu56();if(f)return new t.ArrChunk(i,m,void 0);const p=[];for(let v=0;v<m;v++)p.push(this.cNode().id);return new t.ArrChunk(i,m,p)}}decode(i,f){this.clockDecoder=void 0,this.time=-1;const m=this.reader;if(m.reset(i),m.peak()&128){m.x++;const v=this.time=m.vu57();f||(f=u.Model.withServerClock(void 0,v))}else if(this.decodeClockTable(),!f){const v=this.clockDecoder.clock;f=u.Model.create(void 0,v)}return this.doc=f,f.root=new t.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,f}decodeClockTable(){const i=this.reader,f=i.u32(),m=i.x;i.x+=f;const p=i.vu57(),v=i.vu57(),y=i.vu57();this.clockDecoder=new d.ClockDecoder(v,y);for(let b=1;b<p;b++){const l=i.vu57(),h=i.vu57();this.clockDecoder.pushTuple(l,h)}i.x=m}ts(){if(this.time<0){const[m,p]=this.reader.id();return this.clockDecoder.decodeId(m,p)}else return new n.Timestamp(1,this.reader.vu57())}cRoot(){const i=this.reader;return i.uint8[i.x]?this.cNode():u.UNDEFINED}cNode(){const i=this.reader,f=this.ts(),m=i.u8(),p=m>>5,v=m&31;switch(p){case o.CRDT_MAJOR.CON:return this.cCon(f,v);case o.CRDT_MAJOR.VAL:return this.cVal(f);case o.CRDT_MAJOR.OBJ:return this.cObj(f,v!==31?v:i.vu57());case o.CRDT_MAJOR.VEC:return this.cVec(f,v!==31?v:i.vu57());case o.CRDT_MAJOR.STR:return this.cStr(f,v!==31?v:i.vu57());case o.CRDT_MAJOR.BIN:return this.cBin(f,v!==31?v:i.vu57());case o.CRDT_MAJOR.ARR:return this.cArr(f,v!==31?v:i.vu57())}throw new Error("UNKNOWN_NODE")}cCon(i,f){const m=this.doc,p=f?this.ts():this.val(),v=new t.ConNode(i,p);return m.index.set(i,v),v}cVal(i){const f=this.cNode(),m=this.doc,p=new t.ValNode(m,i,f.id);return m.index.set(i,p),p}cObj(i,f){const m=new t.ObjNode(this.doc,i);for(let p=0;p<f;p++)this.cObjChunk(m);return this.doc.index.set(i,m),m}cObjChunk(i){const f=this.key();i.keys.set(f,this.cNode().id)}cVec(i,f){const m=this.reader,p=new t.VecNode(this.doc,i),v=p.elements;for(let y=0;y<f;y++)m.peak()?v.push(this.cNode().id):(m.x++,v.push(void 0));return this.doc.index.set(i,p),p}cStr(i,f){const m=new t.StrNode(i);return f&&m.ingest(f,this.cStrChunk),this.doc.index.set(i,m),m}cBin(i,f){const m=new t.BinNode(i);return f&&m.ingest(f,this.cBinChunk),this.doc.index.set(i,m),m}cArr(i,f){const m=new t.ArrNode(this.doc,i);return f&&m.ingest(f,this.cArrChunk),this.doc.index.set(i,m),m}}return Ut.Decoder=s,Ut}var sa;function k0(){if(sa)return je;sa=1,Object.defineProperty(je,"__esModule",{value:!0}),je.decoder=je.encoder=void 0;const e=m0(),t=E0();return je.encoder=new e.Encoder,je.decoder=new t.Decoder,je}var Bs={},K={},Qt={},ia;function A0(){if(ia)return Qt;ia=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.find=void 0;const e=Ir(),t=ke(),d=(a,n)=>{const u=(0,e.toPath)(n);let r=a;const o=u.length;if(!o)return r;let s=0;for(;s<o&&r;){const c=u[s++];if(r=r.container(),!r)throw new Error("NOT_CONTAINER");if(r instanceof t.ObjNode){const i=r.get(String(c));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.ArrNode){const i=r.getNode(Number(c));if(!i)throw new Error("NOT_FOUND");r=i}else if(r instanceof t.VecNode){const i=r.get(Number(c));if(!i)throw new Error("NOT_FOUND");r=i}}return r};return Qt.find=d,Qt}var Zt={},he={},en={},oa;function Vl(){if(oa)return en;oa=1,Object.defineProperty(en,"__esModule",{value:!0}),en.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(d){this.listeners.forEach(a=>a(d))}listen(d){const a=this.listeners;return a.add(d),()=>a.delete(d)}}return en.FanOut=e,en}var ca;function $l(){if(ca)return he;ca=1,Object.defineProperty(he,"__esModule",{value:!0}),he.OnNewFanOut=he.MapFanOut=he.MicrotaskBufferFanOut=he.MergeFanOut=void 0;const e=Vl();class t extends e.FanOut{constructor(r){super(),this.fanouts=r,this.unsubs=[]}listen(r){this.listeners.size||(this.unsubs=this.fanouts.map(s=>s.listen(c=>this.emit(c))));const o=super.listen(r);return()=>{if(o(),!this.listeners.size){for(const s of this.unsubs)s();this.unsubs=[]}}}}he.MergeFanOut=t;class d extends e.FanOut{constructor(r){super(),this.source=r,this.buffer=[],this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{const c=this.buffer;c.length||queueMicrotask(()=>{this.emit(c),this.buffer=[]}),c.push(s)}));const o=super.listen(r);return()=>{o(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.buffer=[],(r=this.unsub)==null||r.call(this),this.unsub=void 0}}he.MicrotaskBufferFanOut=d;class a extends e.FanOut{constructor(r,o){super(),this.source=r,this.mapper=o,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>this.emit(this.mapper(s))));const o=super.listen(r);return()=>{o(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),(r=this.unsub)==null||r.call(this),this.unsub=void 0}}he.MapFanOut=a;class n extends e.FanOut{constructor(r,o=void 0){super(),this.source=r,this.last=o,this.unsub=void 0}listen(r){this.unsub||(this.unsub=this.source.listen(s=>{this.last!==s&&this.emit(this.last=s)}));const o=super.listen(r);return()=>{o(),this.listeners.size||this.clear()}}clear(){var r;this.listeners.clear(),this.last=void 0,(r=this.unsub)==null||r.call(this),this.unsub=void 0}}return he.OnNewFanOut=n,he}var aa;function N0(){if(aa)return Zt;aa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.NodeEvents=void 0;const e=$l();let t=class{constructor(a){this.api=a,this.subscribe=n=>this.onViewChanges.listen(()=>n()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Zt.NodeEvents=t,Zt}var tn={},nn={},ua;function Mi(){return ua||(ua=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.isUint8Array=void 0,nn.isUint8Array=typeof ae.Buffer=="function"?e=>e instanceof Uint8Array||ae.Buffer.isBuffer(e):e=>e instanceof Uint8Array),nn}var rn={},Vs={},sn={},la;function Jl(){if(la)return sn;la=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.Encoder=void 0;const t=J.__importStar(Ye()),d=ji(),a=z(),n=Tl();class u extends n.CborEncoder{constructor(o=new d.CrdtWriter){super(o),this.writer=o,this.patchSid=0}encode(o){this.writer.reset();const s=o.getId(),c=this.patchSid=s.sid,i=this.writer;i.vu57(c),i.vu57(s.time);const f=o.meta;return f===void 0?this.writeUndef():this.writeArr([f]),this.encodeOperations(o),i.flush()}encodeOperations(o){const s=o.ops,c=s.length;this.writer.vu57(c);for(let i=0;i<c;i++)this.encodeOperation(s[i])}encodeId(o){const s=o.sid,c=o.time,i=this.writer;s===this.patchSid?i.b1vu56(0,c):(i.b1vu56(1,c),i.vu57(s))}encodeTss(o){this.encodeId(o),this.writer.vu57(o.span)}writeInsStr(o,s,c,i){const f=this.writer;return o<=7?f.u8(96+o):(f.u8(96),f.vu57(o)),this.encodeId(s),this.encodeId(c),f.utf8(i)}encodeOperation(o){const s=this.writer;switch(o.constructor){case t.NewConOp:{const f=o.val;f instanceof a.Timestamp?(s.u8(1),this.encodeId(f)):(s.u8(0),this.writeAny(f));break}case t.NewValOp:{s.u8(8);break}case t.NewObjOp:{s.u8(16);break}case t.NewVecOp:{s.u8(24);break}case t.NewStrOp:{s.u8(32);break}case t.NewBinOp:{s.u8(40);break}case t.NewArrOp:{s.u8(48);break}case t.InsValOp:{const i=o;s.u8(72),this.encodeId(i.obj),this.encodeId(i.val);break}case t.InsObjOp:{const i=o,f=i.data,m=f.length;m<=7?s.u8(80+m):(s.u8(80),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const v=f[p];this.writeStr(v[0]),this.encodeId(v[1])}break}case t.InsVecOp:{const i=o,f=i.data,m=f.length;m<=7?s.u8(88+m):(s.u8(88),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++){const v=f[p];s.u8(v[0]),this.encodeId(v[1])}break}case t.InsStrOp:{const i=o,f=i.obj,m=i.ref,p=i.data,v=p.length;s.ensureCapacity(24+v*4);const y=s.x,b=this.writeInsStr(v,f,m,p);v!==b&&(s.x=y,this.writeInsStr(b,f,m,p));break}case t.InsBinOp:{const i=o,f=i.data,m=f.length;m<=7?s.u8(104+m):(s.u8(104),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref),s.buf(f,m);break}case t.InsArrOp:{const i=o,f=i.data,m=f.length;m<=7?s.u8(112+m):(s.u8(112),s.vu57(m)),this.encodeId(i.obj),this.encodeId(i.ref);for(let p=0;p<m;p++)this.encodeId(f[p]);break}case t.UpdArrOp:{const i=o;s.u8(120),this.encodeId(i.obj),this.encodeId(i.ref),this.encodeId(i.val);break}case t.DelOp:{const i=o,f=i.what,m=f.length;m<=7?s.u8(128+m):(s.u8(128),s.vu57(m)),this.encodeId(i.obj);for(let p=0;p<m;p++)this.encodeTss(f[p]);break}case t.NopOp:{const f=o.len;f<=7?s.u8(136+f):(s.u8(136),s.vu57(f));break}default:throw new Error("UNKNOWN_OP")}}}return sn.Encoder=u,sn}var on={},cn={},da;function x0(){if(da)return cn;da=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.CborDecoder=void 0;const e=Bl(),t=Pi();let d=class extends e.CborDecoderBase{readAsMap(){const n=this.reader.u8(),u=n>>5,r=n&31;switch(u){case 5:return this.readMap(r);default:throw 0}}readMap(n){const u=this.readMinorLen(n);return u>=0?this.readMapRaw(u):this.readMapIndef()}readMapRaw(n){const u=new Map;for(let r=0;r<n;r++){const o=this.val(),s=this.val();u.set(o,s)}return u}readMapIndef(){const n=new Map;for(;this.reader.peak()!==255;){const u=this.val();if(this.reader.peak()===255)throw 7;const r=this.val();n.set(u,r)}return this.reader.x++,n}skipN(n){for(let u=0;u<n;u++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(n){const u=n>>5,r=n&31;switch(u){case 0:case 1:this.skipUNint(r);break;case 2:this.skipBin(r);break;case 3:this.skipStr(r);break;case 4:this.skipArr(r);break;case 5:this.skipObj(r);break;case 7:this.skipTkn(r);break;case 6:this.skipTag(r);break}}skipMinorLen(n){if(n<=23)return n;switch(n){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(n){if(!(n<=23))switch(n){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(n){const u=this.skipMinorLen(n);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const n=this.reader.u8(),u=n>>5,r=n&31;if(u!==2)throw 2;if(r>27)throw 3;this.skipBin(r)}skipStr(n){const u=this.skipMinorLen(n);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const n=this.reader.u8(),u=n>>5,r=n&31;if(u!==3)throw 4;if(r>27)throw 5;this.skipStr(r)}skipArr(n){const u=this.skipMinorLen(n);if(u>=0)this.skipN(u);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(n){const u=this.readMinorLen(n);if(u>=0)return this.skipN(u*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(n){if(this.skipMinorLen(n)<0)throw 1;this.skipAny()}skipTkn(n){switch(n){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(n<=23))throw 1}validate(n,u=0,r=n.length){this.reader.reset(n),this.reader.x=u;const o=u;if(this.skipAny(),this.reader.x-o!==r)throw 8}decodeLevel(n){return this.reader.reset(n),this.readLevel()}readLevel(){const n=this.reader.u8(),u=n>>5,r=n&31;switch(u){case 4:return this.readArrLevel(r);case 5:return this.readObjLevel(r);default:return super.readAnyRaw(n)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const n=this.reader,u=n.x;this.skipAny();const r=n.x;return new t.JsonPackValue(n.uint8.subarray(u,r))}readObjLevel(n){const u=this.readMinorLen(n);return u>=0?this.readObjRawLevel(u):this.readObjIndefLevel()}readObjRawLevel(n){const u={};for(let r=0;r<n;r++){const o=this.key(),s=this.readPrimitiveOrVal();u[o]=s}return u}readObjIndefLevel(){const n={};for(;this.reader.peak()!==255;){const u=this.key();if(this.reader.peak()===255)throw 7;const r=this.readPrimitiveOrVal();n[u]=r}return this.reader.x++,n}readArrLevel(n){const u=this.readMinorLen(n);return u>=0?this.readArrRawLevel(u):this.readArrIndefLevel()}readArrRawLevel(n){const u=[];for(let r=0;r<n;r++)u.push(this.readPrimitiveOrVal());return u}readArrIndefLevel(){const n=[];for(;this.reader.peak()!==255;)n.push(this.readPrimitiveOrVal());return this.reader.x++,n}readHdr(n){const u=this.reader.u8();if(u>>5!==n)throw 0;const o=u&31;if(o<24)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(n){const u=this.readObjHdr();for(let r=0;r<u;r++){if(this.key()===n)return this;this.skipAny()}throw 9}findIndex(n){const u=this.readArrHdr();if(n>=u)throw 10;for(let r=0;r<n;r++)this.skipAny();return this}find(n){for(let u=0;u<n.length;u++){const r=n[u];typeof r=="string"?this.findKey(r):this.findIndex(r)}return this}};return cn.CborDecoder=d,cn}var fa;function Ll(){if(fa)return on;fa=1,Object.defineProperty(on,"__esModule",{value:!0}),on.Decoder=void 0;const e=ql(),t=z(),d=qr(),a=x0();let n=class extends a.CborDecoder{constructor(r=new e.CrdtReader){super(r)}decode(r){return this.reader.reset(r),this.readPatch()}readPatch(){const r=this.reader,o=r.vu57(),s=r.vu57(),i=o===1?new t.ServerClockVector(1,s):new t.ClockVector(o,s);this.patchSid=i.sid;const f=this.builder=new d.PatchBuilder(i),m=this.val();return Array.isArray(m)&&(f.patch.meta=m[0]),this.decodeOperations(),f.patch}decodeId(){const r=this.reader,[o,s]=r.b1vu56();return o?new t.Timestamp(r.vu57(),s):new t.Timestamp(this.patchSid,s)}decodeTss(){const r=this.decodeId(),o=this.reader.vu57();return(0,t.interval)(r,0,o)}decodeOperations(){const o=this.reader.vu57();for(let s=0;s<o;s++)this.decodeOperation()}decodeOperation(){const r=this.builder,o=this.reader,s=o.u8();switch(s>>3){case 0:{const i=s&7;r.con(i?this.decodeId():this.val());break}case 1:{r.val();break}case 2:{r.obj();break}case 3:{r.vec();break}case 4:{r.str();break}case 5:{r.bin();break}case 6:{r.arr();break}case 9:{const i=this.decodeId(),f=this.decodeId();r.setVal(i,f);break}case 10:{const i=s&7||o.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const v=this.val();if(typeof v!="string")continue;const y=this.decodeId();m.push([v,y])}r.insObj(f,m);break}case 11:{const i=s&7||o.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++){const v=this.val();if(typeof v!="number")continue;const y=this.decodeId();m.push([v,y])}r.insVec(f,m);break}case 12:{const i=s&7||o.vu57(),f=this.decodeId(),m=this.decodeId(),p=o.utf8(i);r.insStr(f,m,p);break}case 13:{const i=s&7||o.vu57(),f=this.decodeId(),m=this.decodeId(),p=o.buf(i);if(!(p instanceof Uint8Array))return;r.insBin(f,m,p);break}case 14:{const i=s&7||o.vu57(),f=this.decodeId(),m=this.decodeId(),p=[];for(let v=0;v<i;v++)p.push(this.decodeId());r.insArr(f,m,p);break}case 15:{const i=this.decodeId(),f=this.decodeId(),m=this.decodeId();r.updArr(i,f,m);break}case 16:{const i=s&7||o.vu57(),f=this.decodeId(),m=[];for(let p=0;p<i;p++)m.push(this.decodeTss());r.del(f,m);break}case 17:{const i=s&7||o.vu57();r.nop(i);break}default:throw new Error("UNKNOWN_OP")}}};return on.Decoder=n,on}var $s={},ha;function R0(){return ha||(ha=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const t=Jl(),d=Ll(),a=ji(),n=new a.CrdtWriter(1024*4);e.encoder=new t.Encoder(n);const u=o=>e.encoder.encode(o);e.encode=u,e.decoder=new d.Decoder;const r=o=>e.decoder.decode(o);e.decode=r}($s)),$s}var pa;function I0(){return pa||(pa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(Jl(),e),t.__exportStar(Ll(),e),t.__exportStar(R0(),e)}(Vs)),Vs}var ma;function Fl(){if(ma)return rn;ma=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.Patch=void 0;const t=J.__importStar(Ye()),d=z(),a=pe(),n=I0();let u=class Dl{constructor(){this.ops=[],this.meta=void 0}static fromBinary(o){return(0,n.decode)(o)}getId(){const o=this.ops[0];if(o)return o.id}span(){let o=0;for(const s of this.ops)o+=s.span();return o}nextTime(){const o=this.ops,s=o.length;if(!s)return 0;const c=o[s-1];return c.id.time+c.span()}rewriteTime(o){const s=new Dl,c=this.ops,i=c.length,f=s.ops;for(let m=0;m<i;m++){const p=c[m];p instanceof t.DelOp?f.push(new t.DelOp(o(p.id),o(p.obj),p.what)):p instanceof t.NewConOp?f.push(new t.NewConOp(o(p.id),p.val instanceof d.Timestamp?o(p.val):p.val)):p instanceof t.NewVecOp?f.push(new t.NewVecOp(o(p.id))):p instanceof t.NewValOp?f.push(new t.NewValOp(o(p.id))):p instanceof t.NewObjOp?f.push(new t.NewObjOp(o(p.id))):p instanceof t.NewStrOp?f.push(new t.NewStrOp(o(p.id))):p instanceof t.NewBinOp?f.push(new t.NewBinOp(o(p.id))):p instanceof t.NewArrOp?f.push(new t.NewArrOp(o(p.id))):p instanceof t.InsArrOp?f.push(new t.InsArrOp(o(p.id),o(p.obj),o(p.ref),p.data.map(o))):p instanceof t.UpdArrOp?f.push(new t.UpdArrOp(o(p.id),o(p.obj),o(p.ref),o(p.val))):p instanceof t.InsStrOp?f.push(new t.InsStrOp(o(p.id),o(p.obj),o(p.ref),p.data)):p instanceof t.InsBinOp?f.push(new t.InsBinOp(o(p.id),o(p.obj),o(p.ref),p.data)):p instanceof t.InsValOp?f.push(new t.InsValOp(o(p.id),o(p.obj),o(p.val))):p instanceof t.InsObjOp?f.push(new t.InsObjOp(o(p.id),o(p.obj),p.data.map(([v,y])=>[v,o(y)]))):p instanceof t.InsVecOp?f.push(new t.InsVecOp(o(p.id),o(p.obj),p.data.map(([v,y])=>[v,o(y)]))):p instanceof t.NopOp&&f.push(new t.NopOp(o(p.id),p.len))}return s}rebase(o,s){const c=this.getId();if(!c)throw new Error("EMPTY_PATCH");const i=c.sid,f=c.time;if(s??(s=f),f===o)return this;const m=o-f;return this.rewriteTime(p=>{if(p.sid!==i)return p;const v=p.time;return v<s?p:(0,d.ts)(i,v+m)})}clone(){return this.rewriteTime(o=>o)}toBinary(){return(0,n.encode)(this)}toString(o=""){const s=this.getId();return`Patch ${s?(0,d.printTs)(s):"(nil)"}!${this.span()}`+(0,a.printTree)(o,this.ops.map(i=>f=>i.toString(f)))}};return rn.Patch=u,rn}var Js={},Ls={},ba;function T0(){return ba||(ba=1,Object.defineProperty(Ls,"__esModule",{value:!0})),Ls}var ga;function Mr(){return ga||(ga=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const t=J,d=z();t.__exportStar(T0(),e),e.ORIGIN=(0,d.ts)(0,0)}(Js)),Js}var Ds={},ya;function Ul(){return ya||(ya=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const t=Mi(),d=z(),a=r=>{switch(typeof r){case"number":case"boolean":case"undefined":return!0;case"object":return r===null||r instanceof d.Timestamp;default:return!1}};class n{constructor(o){this.build=o}}e.NodeBuilder=n;var u;(function(r){class o extends n{constructor(b){super(l=>l.con(b)),this.raw=b,this.type="con"}}r.con=o;class s extends n{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="str"}}r.str=s;class c extends n{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="bin"}}r.bin=c;class i extends n{constructor(b){super(l=>{const h=l.val(),w=b.build(l);return l.setVal(h,w),h}),this.value=b,this.type="val"}}r.val=i;class f extends n{constructor(b){super(l=>{const h=l.vec(),w=b.length;if(w){const g=[];for(let _=0;_<w;_++){const O=b[_].build(l);g.push([_,O])}l.insVec(h,g)}return h}),this.value=b,this.type="vec"}}r.vec=f;class m extends n{constructor(b,l){super(h=>{const w=h.obj(),g=[],_={...b,...l},C=Object.keys(_),O=C.length;if(O){for(let k=0;k<O;k++){const S=C[k],E=_[S].build(h);g.push([S,E])}h.insObj(w,g)}return w}),this.obj=b,this.opt=l,this.type="obj"}optional(){return this}}r.obj=m;class p extends n{constructor(b){super(l=>{const h=l.arr(),w=b.length;if(w){const g=[];for(let _=0;_<w;_++)g.push(b[_].build(l));l.insArr(h,h,g)}return h}),this.arr=b,this.type="arr"}}r.arr=p;class v extends n{constructor(b,l){super(h=>{const w=new Uint8Array([b,0,0]),g=h.vec();return w[1]=g.sid%256,w[2]=g.time%256,h.insVec(g,[[0,h.constOrJson(e.s.con(w))],[1,l.build(h)]]),g}),this.id=b,this.data=l,this.type="ext"}}r.ext=v})(u||(e.nodes=u={})),e.schema={con:r=>new u.con(r),str:r=>new u.str(r||""),bin:r=>new u.bin(r),val:r=>new u.val(r),vec:(...r)=>new u.vec(r),obj:(r,o)=>new u.obj(r,o),map:r=>e.schema.obj(r),arr:r=>new u.arr(r),json:r=>{switch(typeof r){case"object":{if(!r)return e.s.val(e.s.con(r));if(r instanceof n)return r;if(Array.isArray(r))return e.s.arr(r.map(o=>e.s.json(o)));if((0,t.isUint8Array)(r))return e.s.bin(r);if(r instanceof d.Timestamp)return e.s.val(e.s.con(r));{const o={},s=Object.keys(r);for(const c of s)o[c]=e.s.jsonCon(r[c]);return e.s.obj(o)}}case"string":return e.s.str(r);default:return e.s.val(e.s.con(r))}},jsonCon:r=>a(r)?e.s.con(r):e.s.json(r),ext:(r,o)=>new u.ext(r,o)},e.s=e.schema}(Ds)),Ds}var va;function qr(){if(va)return tn;va=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.PatchBuilder=void 0;const t=J.__importStar(Ye()),d=z(),a=Mi(),n=Fl(),u=Mr(),r=Ul(),o=c=>{switch(typeof c){case"number":case"boolean":return!0;default:return c===null}};let s=class{constructor(i){this.clock=i,this.patch=new n.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const i=this.patch;return this.patch=new n.Patch,i}obj(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewObjOp(i)),i}arr(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewArrOp(i)),i}vec(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewVecOp(i)),i}str(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewStrOp(i)),i}bin(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewBinOp(i)),i}con(i){this.pad();const f=this.clock.tick(1);return this.patch.ops.push(new t.NewConOp(f,i)),f}val(){this.pad();const i=this.clock.tick(1);return this.patch.ops.push(new t.NewValOp(i)),i}root(i){return this.setVal(u.ORIGIN,i)}insObj(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsObjOp(m,i,f),v=p.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(p),m}insVec(i,f){if(!f.length)throw new Error("EMPTY_TUPLES");this.pad();const m=this.clock.tick(1),p=new t.InsVecOp(m,i,f),v=p.span();return v>1&&this.clock.tick(v-1),this.patch.ops.push(p),m}setVal(i,f){this.pad();const m=this.clock.tick(1),p=new t.InsValOp(m,i,f);return this.patch.ops.push(p),m}insStr(i,f,m){if(!m.length)throw new Error("EMPTY_STRING");this.pad();const p=this.clock.tick(1),v=new t.InsStrOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}insBin(i,f,m){if(!m.length)throw new Error("EMPTY_BINARY");this.pad();const p=this.clock.tick(1),v=new t.InsBinOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}insArr(i,f,m){this.pad();const p=this.clock.tick(1),v=new t.InsArrOp(p,i,f,m),y=v.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(v),p}updArr(i,f,m){this.pad();const p=this.clock.tick(1),v=new t.UpdArrOp(p,i,f,m);return this.patch.ops.push(v),p}del(i,f){this.pad();const m=this.clock.tick(1);return this.patch.ops.push(new t.DelOp(m,i,f)),m}nop(i){this.pad();const f=this.clock.tick(i);return this.patch.ops.push(new t.NopOp(f,i)),f}jsonObj(i){const f=this.obj(),m=Object.keys(i);if(m.length){const p=[];for(const v of m){const y=i[v],b=y instanceof d.Timestamp?y:o(y)?this.con(y):this.json(y);p.push([v,b])}this.insObj(f,p)}return f}jsonArr(i){const f=this.arr();if(i.length){const m=[];for(const p of i)m.push(this.json(p));this.insArr(f,f,m)}return f}jsonStr(i){const f=this.str();return i&&this.insStr(f,f,i),f}jsonBin(i){const f=this.bin();return i.length&&this.insBin(f,f,i),f}jsonVal(i){const f=this.val(),m=this.con(i);return this.setVal(f,m),f}json(i){if(i instanceof d.Timestamp)return i;if(i===void 0)return this.con(i);if(i instanceof Array)return this.jsonArr(i);if((0,a.isUint8Array)(i))return this.jsonBin(i);if(i instanceof r.NodeBuilder)return i.build(this);switch(typeof i){case"object":return i===null?this.jsonVal(i):this.jsonObj(i);case"string":return this.jsonStr(i);case"number":case"boolean":return this.jsonVal(i)}throw new Error("INVALID_JSON")}constOrJson(i){return i instanceof d.Timestamp?i:o(i)?this.con(i):this.json(i)}maybeConst(i){return i instanceof d.Timestamp?i:this.con(i)}pad(){const i=this.patch.nextTime();if(!i)return;const f=this.clock.time-i;if(f>0){const m=(0,d.ts)(this.clock.sid,i),p=new t.NopOp(m,f);this.patch.ops.push(p)}}};return tn.PatchBuilder=s,tn}var an={},wa;function j0(){if(wa)return an;wa=1,Object.defineProperty(an,"__esModule",{value:!0}),an.ExtNode=void 0;const e=z();let t=class{constructor(a){this.data=a,this.api=void 0,this.id=a.id}children(a){}child(){return this.data}container(){return this.data.container()}toString(a,n){return this.name()+(n?" "+(0,e.printTs)(n):"")+" "+this.data.toString(a)}};return an.ExtNode=t,an}var Fs={},qe={},Us={},Gs={},_a;function P0(){return _a||(_a=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const t=Array.isArray,d=Object.prototype,a=(n,u)=>{if(n===u)return!0;let r=0,o=0;if(t(n)){if(!t(u)||(r=n.length,r!==u.length))return!1;for(o=r;o--!==0;)if(!(0,e.deepEqual)(n[o],u[o]))return!1;return!0}if(n&&u&&typeof n=="object"&&typeof u=="object"){e:{if(n.__proto__===d)break e;if(n instanceof Uint8Array){if(!(u instanceof Uint8Array))return!1;const c=n.length;if(c!==u.length)return!1;for(let i=0;i<c;i++)if(n[i]!==u[i])return!1;return!0}}const s=Object.keys(n);if(r=s.length,r!==Object.keys(u).length||t(u))return!1;for(o=r;o--!==0;){const c=s[o];if(!(0,e.deepEqual)(n[c],u[c]))return!1}return!0}return!1};e.deepEqual=a}(Gs)),Gs}var Ca;function M0(){return Ca||(Ca=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),J.__exportStar(P0(),e)}(Us)),Us}var un={},Sa;function q0(){if(Sa)return un;Sa=1,Object.defineProperty(un,"__esModule",{value:!0}),un.cmpUint8Array=void 0;const e=(t,d)=>{const a=t.length;if(a!==d.length)return!1;for(let n=0;n<a;n++)if(t[n]!==d[n])return!1;return!0};return un.cmpUint8Array=e,un}var Hs={},zs={},Oa;function B0(){return Oa||(Oa=1,Object.defineProperty(zs,"__esModule",{value:!0})),zs}var Ea;function Br(){return Ea||(Ea=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(B0(),e),t.__exportStar(z(),e),t.__exportStar(Ye(),e),t.__exportStar(Fl(),e),t.__exportStar(qr(),e),t.__exportStar(Ul(),e)}(Hs)),Hs}var Ws={},ka;function Vr(){return ka||(ka=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const t=l=>{const h=l.charCodeAt(0);return h>=56320&&h<=57343},d=l=>{const h=l.charCodeAt(l.length-1);return h>=55296&&h<=56319},a=(l,h)=>{l.push([0,""]);let w=0,g=0,_=0,C="",O="",k=0;for(;w<l.length;){if(w<l.length-1&&!l[w][1]){l.splice(w,1);continue}const E=l[w];switch(E[0]){case 1:_++,w++,O+=E[1];break;case-1:g++,w++,C+=E[1];break;case 0:{let A=w-_-g-1;if(h){const R=l[A];if(A>=0){let B=R[1];if(d(B)){const $=B.slice(-1);if(R[1]=B=B.slice(0,-1),C=$+C,O=$+O,!B){l.splice(A,1),w--;let L=A-1;const F=l[L];if(F){const V=F[0];V===1?(_++,L--,O=F[1]+O):V===-1&&(g++,L--,C=F[1]+C)}A=L}}}const T=l[w],q=T[1];if(t(q)){const B=q.charAt(0);T[1]=q.slice(1),C+=B,O+=B}}if(w<l.length-1&&!l[w][1]){l.splice(w,1);break}const N=C.length>0,x=O.length>0;if(N||x){N&&x&&(k=(0,e.pfx)(O,C),k!==0&&(A>=0?l[A][1]+=O.slice(0,k):(l.splice(0,0,[0,O.slice(0,k)]),w++),O=O.slice(k),C=C.slice(k)),k=(0,e.sfx)(O,C),k!==0&&(l[w][1]=O.slice(O.length-k)+l[w][1],O=O.slice(0,O.length-k),C=C.slice(0,C.length-k)));const R=_+g,T=C.length,q=O.length;T===0&&q===0?(l.splice(w-R,R),w=w-R):T===0?(l.splice(w-R,R,[1,O]),w=w-R+1):q===0?(l.splice(w-R,R,[-1,C]),w=w-R+1):(l.splice(w-R,R,[-1,C],[1,O]),w=w-R+2)}const I=l[w-1];w!==0&&I[0]===0?(I[1]+=l[w][1],l.splice(w,1)):w++,_=0,g=0,C="",O="";break}}}l[l.length-1][1]===""&&l.pop();let S=!1;for(w=1;w<l.length-1;){const E=l[w-1],A=l[w+1];if(E[0]===0&&A[0]===0){const N=E[1],x=l[w],I=x[1],R=A[1];I.slice(I.length-N.length)===N?(l[w][1]=N+I.slice(0,I.length-N.length),A[1]=N+R,l.splice(w-1,1),S=!0):I.slice(0,R.length)===R&&(E[1]+=A[1],x[1]=I.slice(R.length)+R,l.splice(w+1,1),S=!0)}w++}S&&a(l,h)},n=(l,h,w,g)=>{const _=c(l.slice(0,w),h.slice(0,g),!1),C=c(l.slice(w),h.slice(g),!1);return _.concat(C)},u=(l,h)=>{const w=l.length,g=h.length,_=Math.ceil((w+g)/2),C=_,O=2*_,k=new Array(O),S=new Array(O);for(let T=0;T<O;T++)k[T]=-1,S[T]=-1;k[C+1]=0,S[C+1]=0;const E=w-g,A=E%2!==0;let N=0,x=0,I=0,R=0;for(let T=0;T<_;T++){for(let q=-T+N;q<=T-x;q+=2){const B=C+q;let $=0;const L=k[B-1],F=k[B+1];q===-T||q!==T&&L<F?$=F:$=L+1;let V=$-q;for(;$<w&&V<g&&l.charAt($)===h.charAt(V);)$++,V++;if(k[B]=$,$>w)x+=2;else if(V>g)N+=2;else if(A){const Q=C+E-q,ce=S[Q];if(Q>=0&&Q<O&&ce!==-1&&$>=w-ce)return n(l,h,$,V)}}for(let q=-T+I;q<=T-R;q+=2){const B=C+q;let $=q===-T||q!==T&&S[B-1]<S[B+1]?S[B+1]:S[B-1]+1,L=$-q;for(;$<w&&L<g&&l.charAt(w-$-1)===h.charAt(g-L-1);)$++,L++;if(S[B]=$,$>w)R+=2;else if(L>g)I+=2;else if(!A){const F=C+E-q,V=k[F];if(F>=0&&F<O&&V!==-1){const Q=C+V-F;if($=w-$,V>=$)return n(l,h,V,Q)}}}}return[[-1,l],[1,h]]},r=(l,h)=>{if(!l)return[[1,h]];if(!h)return[[-1,l]];const w=l.length,g=h.length,_=w>g?l:h,C=w>g?h:l,O=C.length,k=_.indexOf(C);if(k>=0){const S=_.slice(0,k),E=_.slice(k+O);return w>g?[[-1,S],[0,C],[-1,E]]:[[1,S],[0,C],[1,E]]}return O===1?[[-1,l],[1,h]]:u(l,h)},o=(l,h)=>{if(!l||!h||l.charAt(0)!==h.charAt(0))return 0;let w=0,g=Math.min(l.length,h.length),_=g,C=0;for(;w<_;)l.slice(C,_)===h.slice(C,_)?(w=_,C=w):g=_,_=Math.floor((g-w)/2+w);const O=l.charCodeAt(_-1);return O>=55296&&O<=56319&&_--,_};e.pfx=o;const s=(l,h)=>{if(!l||!h||l.slice(-1)!==h.slice(-1))return 0;let w=0,g=Math.min(l.length,h.length),_=g,C=0;for(;w<_;)l.slice(l.length-_,l.length-C)===h.slice(h.length-_,h.length-C)?(w=_,C=w):g=_,_=Math.floor((g-w)/2+w);const O=l.charCodeAt(l.length-_);return O>=55296&&O<=56319&&_--,_};e.sfx=s;const c=(l,h,w)=>{if(l===h)return l?[[0,l]]:[];const g=(0,e.pfx)(l,h),_=l.slice(0,g);l=l.slice(g),h=h.slice(g);const C=(0,e.sfx)(l,h),O=l.slice(l.length-C);l=l.slice(0,l.length-C),h=h.slice(0,h.length-C);const k=r(l,h);return _&&k.unshift([0,_]),O&&k.push([0,O]),a(k,w),k},i=(l,h)=>c(l,h,!0);e.diff=i;const f=(l,h,w)=>{e:{if(w<0)break e;const g=l.length,_=h.length;if(g===_)break e;const C=h.slice(w),O=C.length;if(O>g||l.slice(g-O)!==C)break e;if(_>g){const E=g-O,A=l.slice(0,E),N=h.slice(0,E);if(A!==N)break e;const x=h.slice(E,w),I=[];return A&&I.push([0,A]),x&&I.push([1,x]),C&&I.push([0,C]),I}else{const E=_-O,A=h.slice(0,E),N=l.slice(0,E);if(N!==A)break e;const x=l.slice(E,g-O),I=[];return N&&I.push([0,N]),x&&I.push([-1,x]),C&&I.push([0,C]),I}}return(0,e.diff)(l,h)};e.diffEdit=f;const m=l=>{let h="";const w=l.length;for(let g=0;g<w;g++){const _=l[g];_[0]!==1&&(h+=_[1])}return h};e.src=m;const p=l=>{let h="";const w=l.length;for(let g=0;g<w;g++){const _=l[g];_[0]!==-1&&(h+=_[1])}return h};e.dst=p;const v=l=>{const h=l[0];return h===0?l:h===1?[-1,l[1]]:[1,l[1]]},y=l=>l.map(v);e.invert=y;const b=(l,h,w,g)=>{const _=l.length;let C=h;for(let O=_-1;O>=0;O--){const[k,S]=l[O];if(k===0)C-=S.length;else if(k===1)w(C,S);else{const E=S.length;C-=E,g(C,E,S)}}};e.apply=b}(Ws)),Ws}var Ks={},Aa;function V0(){return Aa||(Aa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const d=J.__importStar(Vr()),a=c=>{let i="";const f=c.length;for(let m=0;m<f;m++)i+=String.fromCharCode(c[m]);return i};e.toStr=a;const n=c=>{const i=c.length,f=new Uint8Array(i);for(let m=0;m<i;m++)f[m]=c.charCodeAt(m);return f};e.toBin=n;const u=(c,i)=>{const f=(0,e.toStr)(c),m=(0,e.toStr)(i);return d.diff(f,m)};e.diff=u;const r=(c,i,f,m)=>d.apply(c,i,(p,v)=>f(p,(0,e.toBin)(v)),m);e.apply=r;const o=c=>(0,e.toBin)(d.src(c));e.src=o;const s=c=>(0,e.toBin)(d.dst(c));e.dst=s}(Ks)),Ks}var Ys={},Na;function $0(){return Na||(Na=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const d=J.__importStar(Vr()),a=u=>{const r=[],o=u.length;let s=[];const c=(i,f)=>{if(!f.length)return;const m=s.length;if(m){const p=s[m-1];if(p[0]===i){p[1]+=f;return}}s.push([i,f])};e:for(let i=0;i<o;i++){const f=u[i],m=f[0],p=f[1],v=p.indexOf(`
`);if(v<0){c(m,p);continue e}else c(m,p.slice(0,v+1)),s.length&&r.push(s),s=[];let y=v;const b=p.length;t:for(;y<b;){const l=p.indexOf(`
`,y+1);if(l<0){c(m,p.slice(y+1));break t}r.push([[m,p.slice(y+1,l+1)]]),y=l}}s.length&&r.push(s);{const i=r.length;for(let f=0;f<i;f++){const m=r[f];let p=m.length;e:{if(p<2)break e;const v=m[0],y=m[1],b=y[0];if(v[0]===0&&(b===-1||b===1)){for(let l=2;l<p;l++)if(m[l][0]!==b)break e;for(let l=f+1;l<i;l++){const h=r[l],w=h.length,g=v[1];let _,C;if(h.length>1&&(_=h[0])[0]===b&&(C=h[1])[0]===0&&g===_[1])m.splice(0,1),y[1]=g+y[1],C[1]=g+C[1],h.splice(0,1);else for(let O=0;O<w;O++)if(h[O][0]!==b)break e}}}p=m.length;e:{if(p<2)break e;const v=m[m.length-1],y=v[1],b=m[m.length-2];if(v[0]===-1)for(let l=f+1;l<i;l++){const h=r[l],w=h.length;if(w<=1){if(h[0][0]!==-1)break e}else{const g=h[h.length-1];if(g[0]!==0)break e;for(let S=0;S<h.length-1;S++)if(h[S][0]!==-1)break e;let _=g[1];const C=_.endsWith(`
`);if(C||(_+=`
`),_.length>y.length||!y.endsWith(_))break e;const O=y.length-_.length;O<0?(v[0]=0,b[0]===0&&(b[1]+=y,m.splice(p-1,1))):O===0?(m.splice(p-1,1),b[0]===0?b[1]+=_:m.push([0,_])):(v[1]=y.slice(0,O),m.push([0,_]));const k=h[h.length-2];k[0]===-1?(k[1]+=C?_:_.slice(0,-1),h.splice(w-1,1)):g[0]=-1}}}}}return r};e.agg=a;const n=(u,r)=>{const o=u.join(`
`)+`
`,s=r.join(`
`)+`
`;if(o===s)return[];const c=d.diff(o,s),i=(0,e.agg)(c),f=i.length,m=[];let p=-1,v=-1;const y=u.length,b=r.length;for(let l=0;l<f;l++){const h=i[l];let w=h.length;if(!w)continue;const g=h[w-1],_=g[0],C=g[1];if(C===`
`)h.splice(w-1,1);else{const k=C.length;C[k-1]===`
`&&(k===1?h.splice(w-1,1):g[1]=C.slice(0,k-1))}let O=0;if(w=h.length,l+1===f)p+1<y?v+1<b?(O=w===1&&h[0][0]===0?0:2,p++,v++):(O=-1,p++):(O=1,v++);else{const S=h[0][0];w===1&&S===_&&S===0?(p++,v++):_===0?(O=2,p++,v++):_===1?(O=1,v++):_===-1&&(O=-1,p++)}m.push([O,p,v,h])}return m};e.diff=n}(Ys)),Ys}var Xs={},ln={},xa;function qi(){if(xa)return ln;xa=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.sort=void 0;const e=t=>{const d=t.length;for(let a=1;a<d;a++){const n=t[a];let u=a;for(;u!==0&&t[u-1]>n;)t[u]=t[u-1],u--;t[u]=n}return t};return ln.sort=e,ln}var Qs={},Ra;function Bi(){return Ra||(Ra=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const t=qi();var d;(function(s){s[s.START_STATE=5381]="START_STATE",s[s.NULL=982452847]="NULL",s[s.TRUE=982453247]="TRUE",s[s.FALSE=982454243]="FALSE",s[s.ARRAY=982452259]="ARRAY",s[s.STRING=982453601]="STRING",s[s.OBJECT=982454533]="OBJECT",s[s.BINARY=982454837]="BINARY"})(d||(e.CONST=d={}));const a=(s,c)=>(s<<5)+s+c;e.updateNum=a;const n=(s,c)=>{const i=c.length;s=(0,e.updateNum)(s,d.STRING),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+c.charCodeAt(--f);return s};e.updateStr=n;const u=(s,c)=>{const i=c.length;s=(0,e.updateNum)(s,d.BINARY),s=(0,e.updateNum)(s,i);let f=i;for(;f;)s=(s<<5)+s+c[--f];return s};e.updateBin=u;const r=(s,c)=>{switch(typeof c){case"number":return(0,e.updateNum)(s,c);case"string":return s=(0,e.updateNum)(s,d.STRING),(0,e.updateStr)(s,c);case"object":{if(c===null)return(0,e.updateNum)(s,d.NULL);if(Array.isArray(c)){const m=c.length;s=(0,e.updateNum)(s,d.ARRAY);for(let p=0;p<m;p++)s=(0,e.updateJson)(s,c[p]);return s}if(c instanceof Uint8Array)return(0,e.updateBin)(s,c);s=(0,e.updateNum)(s,d.OBJECT);const i=(0,t.sort)(Object.keys(c)),f=i.length;for(let m=0;m<f;m++){const p=i[m];s=(0,e.updateStr)(s,p),s=(0,e.updateJson)(s,c[p])}return s}case"boolean":return(0,e.updateNum)(s,c?d.TRUE:d.FALSE)}return s};e.updateJson=r;const o=s=>(0,e.updateJson)(d.START_STATE,s)>>>0;e.hash=o}(Qs)),Qs}var Zs={},Ia;function Gl(){return Ia||(Ia=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const t=qi(),d=Bi(),a=n=>{switch(typeof n){case"string":return(0,d.hash)(n).toString(36);case"number":case"bigint":return n.toString(36);case"boolean":return n?"T":"F";case"object":if(n===null)return"N";if(Array.isArray(n)){const u=n.length;let r="[";for(let o=0;o<u;o++)r+=(0,e.structHash)(n[o])+",";return r+"]"}else{if(n instanceof Uint8Array)return(0,d.hash)(n).toString(36);{const u=Object.keys(n);(0,t.sort)(u);let r="{";const o=u.length;for(let s=0;s<o;s++){const c=u[s];r+=(0,d.hash)(c).toString(36)+":"+(0,e.structHash)(n[c])+","}return r+"}"}}default:return"U"}};e.structHash=a}(Zs)),Zs}var Ta;function J0(){return Ta||(Ta=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const t=qi(),d=fr(),a=Bi(),n=Gl(),u=r=>{if(r instanceof d.ConNode)return(0,n.structHash)(r.val);if(r instanceof d.ValNode)return(0,e.structHashCrdt)(r.node());if(r instanceof d.StrNode)return(0,a.hash)(r.view()).toString(36);if(r instanceof d.ObjNode){let o="{";const s=Array.from(r.keys.keys());(0,t.sort)(s);const c=s.length;for(let i=0;i<c;i++){const f=s[i],m=r.get(f);o+=(0,a.hash)(f).toString(36)+":"+(0,e.structHashCrdt)(m)+","}return o+"}"}else if(r instanceof d.ArrNode||r instanceof d.VecNode){let o="[";return r.children(s=>{o+=(0,e.structHashCrdt)(s)+","}),o+"]"}else if(r instanceof d.BinNode)return(0,a.hash)(r.view()).toString(36);return"U"};e.structHashCrdt=u}(Xs)),Xs}var ei={},ja;function L0(){return ja||(ja=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(Bi(),e),t.__exportStar(Gl(),e)}(ei)),ei}var Pa;function D0(){if(Pa)return qe;Pa=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.JsonCrdtDiff=qe.DiffError=void 0;const e=J,t=M0(),d=q0(),a=Br(),n=ke(),u=e.__importStar(Vr()),r=e.__importStar(V0()),o=e.__importStar($0()),s=J0(),c=L0();class i extends Error{constructor(p="DIFF"){super(p)}}qe.DiffError=i;let f=class{constructor(p){this.model=p,this.builder=new a.PatchBuilder(p.clock.clone())}diffStr(p,v){const y=p.view();if(y===v)return;const b=this.builder;u.apply(u.diff(y,v),y.length,(l,h)=>b.insStr(p.id,l?p.find(l-1):p.id,h),(l,h)=>b.del(p.id,p.findInterval(l,h)))}diffBin(p,v){const y=p.view();if((0,d.cmpUint8Array)(y,v))return;const b=this.builder;r.apply(r.diff(y,v),y.length,(l,h)=>b.insBin(p.id,l?p.find(l-1):p.id,h),(l,h)=>b.del(p.id,p.findInterval(l,h)))}diffArr(p,v){const y=[];p.children(k=>{y.push((0,s.structHashCrdt)(k))});const b=[],l=v.length;for(let k=0;k<l;k++)b.push((0,c.structHash)(v[k]));const h=o.diff(y,b);if(!h.length)return;const w=[],g=[],_=h.length;for(let k=_-1;k>=0;k--){const[S,E,A]=h[k];switch(S){case 0:break;case 1:{const N=v[A],x=E>=0?p.find(E):p.id;if(!x)throw new i;w.push([x,[N]]);break}case-1:{const N=p.findInterval(E,1);if(!N||!N.length)throw new i;g.push(...N);break}case 2:{const N=v[A];try{this.diffAny(p.getNode(E),N)}catch(x){if(x instanceof i){const I=p.findInterval(E,1);g.push(...I);const R=E?p.find(E-1):p.id;if(!R)throw new i;w.push([R,[N]])}else throw x}}}}const C=this.builder,O=w.length;for(let k=0;k<O;k++){const[S,E]=w[k];C.insArr(p.id,S,E.map(A=>C.json(A)))}g.length&&C.del(p.id,g)}diffObj(p,v){const y=this.builder,b=[],l=new Set;p.forEach(g=>{l.add(g),v[g]===void 0&&b.push([g,y.con(void 0)])});const h=Object.keys(v),w=h.length;for(let g=0;g<w;g++){const _=h[g],C=v[_];if(l.has(_)){const O=p.get(_);if(O)try{this.diffAny(O,C);continue}catch(k){if(!(k instanceof i))throw k}}b.push([_,p.get(_)instanceof n.ConNode?y.con(C):y.constOrJson(C)])}b.length&&y.insObj(p.id,b)}diffVec(p,v){const y=this.builder,b=[],l=p.elements,h=l.length,w=v.length,g=p.doc.index,_=Math.min(h,w);for(let C=w;C<h;C++){const O=l[C];if(O){const k=g.get(O);if(!k||k instanceof n.ConNode&&k.val===void 0)return;b.push([C,y.con(void 0)])}}for(let C=0;C<_;C++){const O=v[C],k=p.get(C);if(k)try{this.diffAny(k,O);continue}catch(S){if(!(S instanceof i))throw S}b.push([C,y.constOrJson(O)])}for(let C=h;C<w;C++)b.push([C,y.constOrJson(v[C])]);b.length&&y.insVec(p.id,b)}diffVal(p,v){try{this.diffAny(p.node(),v)}catch(y){if(y instanceof i){const b=this.builder;b.setVal(p.id,b.constOrJson(v))}else throw y}}diffAny(p,v){if(p instanceof n.ConNode){if(p.val!==v&&!(0,t.deepEqual)(p.val,v))throw new i}else if(p instanceof n.StrNode){if(typeof v!="string")throw new i;this.diffStr(p,v)}else if(p instanceof n.ObjNode){if(!v||typeof v!="object"||Array.isArray(v))throw new i;this.diffObj(p,v)}else if(p instanceof n.ValNode)this.diffVal(p,v);else if(p instanceof n.ArrNode){if(!Array.isArray(v))throw new i;this.diffArr(p,v)}else if(p instanceof n.VecNode){if(!Array.isArray(v))throw new i;this.diffVec(p,v)}else if(p instanceof n.BinNode){if(!(v instanceof Uint8Array))throw new i;this.diffBin(p,v)}else throw new i}diff(p,v){return this.diffAny(p,v),this.builder.flush()}};return qe.JsonCrdtDiff=f,qe}var Ma;function F0(){return Ma||(Ma=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const t=D0(),d=(n,u)=>{const o=new t.JsonCrdtDiff(n.api.model).diff(n.node,u);return o.ops.length?o:void 0};e.diff=d;const a=(n,u)=>{const r=(0,e.diff)(n,u);return r&&n.api.model.applyPatch(r),r};e.merge=a}(Fs)),Fs}var ti={},qa;function U0(){return qa||(qa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const t=(a,n=[])=>new Proxy(()=>{},{get:(u,r,o)=>(n.push(String(r)),(0,e.proxy)(a,n)),apply:(u,r,o)=>a(n,...o)});e.proxy=t;const d=(a,n,u=[])=>new Proxy({},{get:(r,o,s)=>o===n?a(u):(u.push(String(o)),(0,e.proxy$)(a,n,u))});e.proxy$=d}(ti)),ti}var Ba;function G0(){if(Ba)return K;Ba=1,Object.defineProperty(K,"__esModule",{value:!0}),K.ModelApi=K.ArrApi=K.BinApi=K.StrApi=K.ObjApi=K.VecApi=K.ValApi=K.ConApi=K.NodeApi=void 0;const e=J,t=pe(),d=_l(),a=Ai(),n=A0(),u=z(),r=ke(),o=N0(),s=Vl(),c=qr(),i=$l(),f=j0(),m=e.__importStar(F0()),p=U0(),v=k=>{if(!k)return[void 0,""];if(typeof k=="number")return[void 0,k];switch(typeof k=="string"&&(k=(0,a.toPath)(k)),k.length){case 0:return[void 0,""];case 1:return[void 0,k[0]];default:{const S=k[k.length-1];return[k.slice(0,-1),S]}}};class y{constructor(S,E){this.node=S,this.api=E,this.ev=void 0}get events(){return this.ev||(this.ev=new o.NodeEvents(this))}find(S){let E=this.node;if(S===void 0){if(typeof E.child=="function"){const A=E.child();if(!A){if(E instanceof r.RootNode)return E;throw new Error("NO_CHILD")}return A}throw new Error("CANNOT_IN")}for(typeof S=="string"&&S&&S[0]!=="/"&&(S="/"+S),typeof S=="number"&&(S=[S]);E instanceof r.ValNode;)E=E.child();return(0,n.find)(E,S)}in(S){const E=this.find(S);return this.api.wrap(E)}asVal(){if(this.node instanceof r.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof r.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof r.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof r.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof r.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof r.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof r.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(S){let E;const A=this.node;if(A instanceof f.ExtNode&&(E=A),A instanceof r.VecNode&&(E=A.ext()),!E)throw new Error("NOT_EXT");const N=this.api.wrap(E);if(!S||N instanceof S.Api)return N;throw new Error("NOT_EXT")}val(S){return this.in(S).asVal()}str(S){return this.in(S).asStr()}bin(S){return this.in(S).asBin()}arr(S){return this.in(S).asArr()}vec(S){return this.in(S).asVec()}obj(S){return this.in(S).asObj()}con(S){return this.in(S).asCon()}view(){return this.node.view()}select(S,E){try{let A=S!==void 0?this.find(S):this.node;if(E)for(;A instanceof r.ValNode;)A=A.child();return this.api.wrap(A)}catch{return}}read(S){const E=this.view();if(Array.isArray(S))return(0,d.get)(E,S);if(!S)return E;let A=S+"";return S&&A[0]!=="/"&&(A="/"+A),(0,d.get)(E,(0,a.toPath)(A))}add(S,E){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w)x.set({[N]:E});else if(x instanceof C||x instanceof g||x instanceof _){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(N==="-")R=I;else if(R=~~N,R+""!==N)break e;if(R!==R)break e;if(R<0&&(R=0),R>I&&(R=I),x instanceof C)x.ins(R,Array.isArray(E)?E:[E]);else if(x instanceof g)x.ins(R,E+"");else if(x instanceof _){if(!(E instanceof Uint8Array))break e;x.ins(R,E)}}else if(x instanceof h)x.set([[~~N,E]]);else break e;return!0}catch{}return!1}replace(S,E){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w){const I=N+"";if(!x.has(I))break e;x.set({[N]:E})}else if(x instanceof C){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(R=~~N,R+""!==N)break e;if(R!==R||R<0||R>I)break e;R===I?x.ins(R,[E]):x.upd(R,E)}else if(x instanceof h)x.set([[~~N,E]]);else break e;return!0}catch{}return!1}remove(S,E=1){const[A,N]=v(S);e:try{const x=this.select(A,!0);if(x instanceof w){const I=N+"";if(!x.has(I))break e;x.del([I])}else if(x instanceof C||x instanceof g||x instanceof _){const I=x.length();let R=0;if(typeof N=="number")R=N;else if(N==="-")R=E;else if(R=~~N,R+""!==N)break e;if(R!==R||R<0||R>I)break e;x.del(R,Math.min(E,I-R))}else if(x instanceof h)x.set([[~~N,void 0]]);else break e;return!0}catch{}return!1}diff(S){return m.diff(this,S)}merge(S){return m.merge(this,S)}op(S){var x;if(!Array.isArray(S))return!1;const[E,A,N]=S;switch(E){case"add":return this.add(A,N);case"replace":return this.replace(A,N);case"merge":return!!((x=this.select(A))!=null&&x.merge(N));case"remove":return this.remove(A,N)}}get s(){return{$:this}}get $(){return(0,p.proxy$)(S=>{try{return this.api.wrap(this.find(S))}catch{return}},"$")}toString(S=""){return"api("+(this.constructor===y?"*":this.node.name())+")"+(0,t.printTree)(S,[A=>this.node.toString(A)])}}K.NodeApi=y;class b extends y{get s(){return{$:this}}}K.ConApi=b;class l extends y{get(){return this.in()}set(S){const{api:E,node:A}=this,x=E.builder.constOrJson(S);E.builder.setVal(A.id,x),E.apply()}get s(){const S=this;return{$:this,get _(){const A=S.node.node();return S.api.wrap(A).s}}}}K.ValApi=l;class h extends y{get(S){return this.in(S)}set(S){const{api:E,node:A}=this,{builder:N}=E;N.insVec(A.id,S.map(([x,I])=>[x,N.constOrJson(I)])),E.apply()}push(...S){const E=this.length();this.set(S.map((A,N)=>[E+N,A]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;if(A==="toExt")return()=>this.asExt();const x=Number(A);if(Number.isNaN(x))throw new Error("INVALID_INDEX");const I=this.node.get(x);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}K.VecApi=h;class w extends y{get(S){return this.in(S)}set(S){const{api:E,node:A}=this,{builder:N}=E;N.insObj(A.id,Object.entries(S).map(([x,I])=>[x,N.constOrJson(I)])),E.apply()}del(S){const{api:E,node:A}=this,{builder:N}=E;E.builder.insObj(A.id,S.map(x=>[x,N.con(void 0)])),E.apply()}has(S){return this.node.keys.has(S)}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;const x=String(A),I=this.node.get(x);if(!I)throw new Error("NO_SUCH_KEY");return this.api.wrap(I).s}})}}K.ObjApi=w;class g extends y{ins(S,E){const{api:A,node:N}=this;A.onBeforeLocalChange.emit(A.next);const x=A.builder;x.pad();const I=A.builder.nextTime(),R=new u.Timestamp(x.clock.sid,I),T=N.insAt(S,R,E);if(!T)throw new Error("OUT_OF_BOUNDS");x.insStr(N.id,T,E),A.advance()}del(S,E){const{api:A,node:N}=this;A.onBeforeLocalChange.emit(A.next);const x=A.builder;x.pad();const I=N.findInterval(S,E);if(!I)throw new Error("OUT_OF_BOUNDS");N.delete(I),x.del(N.id,I),A.advance()}findId(S){const E=this.node,N=E.length()-1;return S>N&&(S=N),S<0?E.id:E.find(S)||E.id}findPos(S){const E=this.node,A=E.id;if(A.sid===S.sid&&A.time===S.time)return-1;const N=E.findById(S);return N?E.pos(N)+(N.del?0:S.time-N.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}K.StrApi=g;class _ extends y{ins(S,E){const{api:A,node:N}=this,x=S?N.find(S-1):N.id;if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.insBin(N.id,x,E),A.apply()}del(S,E){const{api:A,node:N}=this,x=N.findInterval(S,E);if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.del(N.id,x),A.apply()}length(){return this.node.length()}get s(){return{$:this}}}K.BinApi=_;class C extends y{get(S){return this.in(S)}ins(S,E){const{api:A,node:N}=this,{builder:x}=A,I=S?N.find(S-1):N.id;if(!I)throw new Error("OUT_OF_BOUNDS");const R=[];for(let T=0;T<E.length;T++)R.push(x.json(E[T]));x.insArr(N.id,I,R),A.apply()}push(...S){const E=this.length();this.ins(E,S)}upd(S,E){const{api:A,node:N}=this,x=N.getId(S);if(!x)throw new Error("OUT_OF_BOUNDS");const{builder:I}=A;I.updArr(N.id,x,I.constOrJson(E)),A.apply()}del(S,E){const{api:A,node:N}=this,x=N.findInterval(S,E);if(!x)throw new Error("OUT_OF_BOUNDS");A.builder.del(N.id,x),A.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(E,A,N)=>{if(A==="$")return this;const x=Number(A);if(Number.isNaN(x))throw new Error("INVALID_INDEX");const I=this.node.getNode(x);if(!I)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(I).s}})}}K.ArrApi=C;class O extends l{constructor(S){super(S.root,void 0),this.model=S,this.next=0,this.onBeforeReset=new s.FanOut,this.onReset=new s.FanOut,this.onBeforePatch=new s.FanOut,this.onPatch=new s.FanOut,this.onBeforeLocalChange=new s.FanOut,this.onLocalChange=new s.FanOut,this.onLocalChanges=new i.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new s.FanOut,this.onTransaction=new s.FanOut,this.onChange=new i.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new i.MicrotaskBufferFanOut(this.onChange),this.onFlush=new s.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=E=>this.onChanges.listen(()=>E()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new c.PatchBuilder(S.clock),S.onbeforereset=()=>this.onBeforeReset.emit(),S.onreset=()=>this.onReset.emit(),S.onbeforepatch=E=>this.onBeforePatch.emit(E),S.onpatch=E=>this.onPatch.emit(E)}wrap(S){if(S instanceof r.ValNode)return S.api||(S.api=new l(S,this));if(S instanceof r.StrNode)return S.api||(S.api=new g(S,this));if(S instanceof r.BinNode)return S.api||(S.api=new _(S,this));if(S instanceof r.ArrNode)return S.api||(S.api=new C(S,this));if(S instanceof r.ObjNode)return S.api||(S.api=new w(S,this));if(S instanceof r.ConNode)return S.api||(S.api=new b(S,this));if(S instanceof r.VecNode)return S.api||(S.api=new h(S,this));if(S instanceof f.ExtNode){if(S.api)return S.api;const E=this.model.ext.get(S.extId);return S.api=new E.Api(S,this)}else throw new Error("UNKNOWN_NODE")}root(S){return this.set(S)}set(S){return super.set(S),this}apply(){const S=this.builder.patch.ops,E=S.length,A=this.model,N=this.next;this.onBeforeLocalChange.emit(N);for(let x=this.next;x<E;x++)A.applyOperation(S[x]);this.next=E,A.tick++,this.onLocalChange.emit(N)}advance(){const S=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(S)}transaction(S){if(this.inTx)S();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),S(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const S=this.builder.flush();return this.next=0,S.ops.length&&this.onFlush.emit(S),S}autoFlush(S=!1){const E=()=>this.builder.patch.ops.length&&this.flush(),A=this.onLocalChanges.listen(E),N=this.onBeforeTransaction.listen(E),x=this.onTransaction.listen(E);return S&&E(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,A(),N(),x()}}}return K.ModelApi=O,K}var Va;function Hl(){return Va||(Va=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),J.__exportStar(G0(),e)}(Bs)),Bs}var dn={},$a;function H0(){if($a)return dn;$a=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.randomSessionId=void 0;const e=65535,t=9007199254740991-e,d=()=>Math.floor(t*Math.random()+e);return dn.randomSessionId=d,dn}var fn={},Ja;function z0(){if(Ja)return fn;Ja=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.Extensions=void 0;const e=pe();let t=class zl{constructor(){this.ext={}}register(a){this.ext[a.id]=a}get(a){return this.ext[a]}size(){return Object.keys(this.ext).length}clone(){const a=new zl;for(const n of Object.values(this.ext))a.register(n);return a}toString(a=""){const n=Object.keys(this.ext).map(u=>+u).sort();return"extensions"+(0,e.printTree)(a,n.map(u=>r=>`${u}: ${this.ext[u].name}`))}};return fn.Extensions=t,fn}var Be={},ni={},ri={},hn={},La;function Vi(){if(La)return hn;La=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.printBinary=void 0;const e=(t="",d)=>{const a=d[0],n=d[1];let u="";return a&&(u+=`
`+t+"← "+a(t+"  ")),n&&(u+=`
`+t+"→ "+n(t+"  ")),u};return hn.printBinary=e,hn}var Da;function W0(){return Da||(Da=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),J.__exportStar(Vi(),e)}(ri)),ri}var Fa;function K0(){return Fa||(Fa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const t=W0(),d=JSON.stringify,a=(y,b,l)=>{const h=b.p;if(!h)return y;const w=b===h.l;let g=h.bf|0;switch(w?h.bf=++g:h.bf=--g,g){case 0:return y;case 1:case-1:return a(y,h,b);default:{const _=l===b.l;return w?_?(n(h,b),b.p?y:b):(r(h,b,l),l.p?y:l):_?(o(h,b,l),l.p?y:l):(u(h,b),b.p?y:b)}}},n=(y,b)=>{const l=y.p,h=b.r;b.p=l,b.r=y,y.p=b,y.l=h,h&&(h.p=y),l&&(l.l===y?l.l=b:l.r=b);let w=y.bf,g=b.bf;w+=-1-(g>0?g:0),g+=-1+(w<0?w:0),y.bf=w,b.bf=g},u=(y,b)=>{const l=y.p,h=b.l;b.p=l,b.l=y,y.p=b,y.r=h,h&&(h.p=y),l&&(l.l===y?l.l=b:l.r=b);let w=y.bf,g=b.bf;w+=1-(g<0?g:0),g+=1+(w>0?w:0),y.bf=w,b.bf=g},r=(y,b,l)=>{u(b,l),n(y,l)},o=(y,b,l)=>{n(b,l),u(y,l)},s=(y,b,l)=>(l.r=b,b.p=l,l.bf--,l.l?y:a(y,l,b));e.insertRight=s;const c=(y,b,l)=>(l.l=b,b.p=l,l.bf++,l.r?y:a(y,l,b));e.insertLeft=c;const i=(y,b,l)=>{if(!y)return b;const h=b.k;let w=y,g,_=0;for(;g=(_=l(h,w.k))<0?w.l:w.r;)w=g;return _<0?(0,e.insertLeft)(y,b,w):(0,e.insertRight)(y,b,w)};e.insert=i;const f=(y,b)=>{if(!y)return b;const l=b.p,h=b.l,w=b.r;if(b.p=b.l=b.r=void 0,h&&w)if(h.r){let C=h,O=C;for(;O=C.r;)C=O;const k=C.l,S=C.p,E=k;return l&&(l.l===b?l.l=C:l.r=C),C.p=l,C.r=w,C.bf=b.bf,h!==C&&(C.l=h,h.p=C),w.p=C,S&&(S.l===C?S.l=E:S.r=E),E&&(E.p=S),p(l?y:C,S,1)}else{l&&(l.l===b?l.l=h:l.r=h),h.p=l,h.r=w,w.p=h;const C=b.bf;if(l)return h.bf=C,m(y,h,1);const O=C-1;if(h.bf=O,O>=-1)return h;const k=w.l;return w.bf>0?(o(h,w,k),k):(u(h,w),w)}const g=h||w;return g&&(g.p=l),l?l.l===b?(l.l=g,m(y,l,1)):(l.r=g,p(y,l,1)):g};e.remove=f;const m=(y,b,l)=>{let h=b.bf|0;h-=l,b.bf=h;let w=l;if(h===-1)return y;if(h<-1){const _=b.r;if(_.bf<=0)_.l&&_.bf===0&&(w=0),u(b,_),b=_;else{const C=_.l;o(b,_,C),b=C}}const g=b.p;return g?g.l===b?m(y,g,w):p(y,g,w):b},p=(y,b,l)=>{let h=b.bf|0;h+=l,b.bf=h;let w=l;if(h===1)return y;if(h>1){const _=b.l;if(_.bf>=0)_.r&&_.bf===0&&(w=0),n(b,_),b=_;else{const C=_.r;r(b,_,C),b=C}}const g=b.p;return g?g.l===b?m(y,g,w):p(y,g,w):b},v=(y,b="")=>{if(!y)return"∅";const{bf:l,l:h,r:w,k:g,v:_}=y,C=_&&typeof _=="object"&&_.constructor===Object?d(_):_&&typeof _=="object"?_.toString(b):d(_),O=g!==void 0?` { ${d(g)} = ${C} }`:"",k=l?` [${l}]`:"";return y.constructor.name+`${k}`+O+(0,t.printBinary)(b,[h?S=>(0,e.print)(h,S):null,w?S=>(0,e.print)(w,S):null])};e.print=v}(ni)),ni}var pn={},si={},mn={},Ua;function Wl(){if(Ua)return mn;Ua=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.first=void 0;const e=t=>{let d=t;for(;d;)if(d.l)d=d.l;else return d;return d};return mn.first=e,mn}var bn={},Ga;function Y0(){if(Ga)return bn;Ga=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.next=void 0;const e=Wl(),t=d=>{const a=d.r;if(a)return(0,e.first)(a);let n=d.p;for(;n&&n.r===d;)d=n,n=n.p;return n};return bn.next=t,bn}var Ha;function Kl(){return Ha||(Ha=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const t=Wl();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return t.first}});const d=Y0();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return d.next}});const a=p=>{let v=p;for(;v;)if(v.r)v=v.r;else return v;return v};e.last=a;const n=p=>{if(p.l){for(p=p.l;p.r;)p=p.r;return p}let v=p.p;for(;v&&v.l===p;)p=v,v=v.p;return v};e.prev=n;const u=p=>{const v=p.l,y=p.r;return 1+(v?u(v):0)+(y?u(y):0)},r=p=>p?u(p):0;e.size=r;const o=(p,v,y)=>{let b=p;for(;b;){const l=y(v,b.k);if(l===0)return b;b=l<0?b.l:b.r}return b};e.find=o;const s=(p,v,y)=>{let b=p,l;for(;b;){const h=y(b.k,v);if(h===0)return b;if(h>0)b=b.l;else{const w=b.r;if(l=b,!w)return l;b=w}}return l};e.findOrNextLower=s;const c=(p,v)=>{const y=p.r=v.r;v.r=p,p.p=v,y&&(y.p=p)};e.insertRight=c;const i=(p,v)=>{const y=p.l=v.l;v.l=p,p.p=v,y&&(y.p=p)};e.insertLeft=i;const f=(p,v,y)=>{if(!p)return v;const b=v.k;let l=p;for(;l;){const h=y(b,l.k),w=h<0?l.l:l.r;if(w)l=w;else{h<0?(0,e.insertLeft)(v,l):(0,e.insertRight)(v,l);break}}return p};e.insert=f;const m=(p,v)=>{const y=v.p,b=v.l,l=v.r;if(v.p=v.l=v.r=void 0,!b&&!l){if(y)y.l===v?y.l=void 0:y.r=void 0;else return;return p}else if(b&&l){let w=b;for(;w.r;)w=w.r;return w.r=l,l.p=w,y?(y.l===v?y.l=b:y.r=b,b.p=y,p):(b.p=void 0,b)}const h=b||l;if(h.p=y,y)y.l===v?y.l=h:y.r=h;else return h;return p};e.remove=m}(si)),si}var ii={},za;function X0(){return za||(za=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),J.__exportStar(pe(),e)}(ii)),ii}var Wa;function Q0(){if(Wa)return pn;Wa=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.createMap=void 0;const e=Kl(),t=X0(),d=(n,u)=>n===u?0:n<u?-1:1,a=(n,u,r,o,s,c)=>{class i{constructor(m){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=m||d}set(m,p){const v=this.root;if(v===void 0){this._size=1;const g=new n(m,p);return this.root=this.min=this.max=u(void 0,g,this.comparator)}const y=this.comparator;let b;const l=this.max;if(b=y(m,l.k),b===0)return l.v=p,l;if(b>0){const g=this.max=new n(m,p);return this.root=o(v,g,l),this._size++,g}const h=this.min;if(b=y(m,h.k),b===0)return h.v=p,h;if(b<0){const g=this.min=new n(m,p);return this.root=r(v,g,h),this._size++,g}let w=v;do{if(b=y(m,w.k),b===0)return w.v=p,w;if(b>0){const g=w.r;if(g===void 0){const _=new n(m,p);return this.root=o(v,_,w),this._size++,_}w=g}else if(b<0){const g=w.l;if(g===void 0){const _=new n(m,p);return this.root=r(v,_,w),this._size++,_}w=g}}while(!0)}find(m){const p=this.comparator;let v=this.root;for(;v;){const y=+p(m,v.k);if(y===0)return v;v=y<0?v.l:v.r}}get(m){var p;return(p=this.find(m))==null?void 0:p.v}del(m){const p=this.find(m);return p?(p===this.max&&(this.max=(0,e.prev)(p)),p===this.min&&(this.min=(0,e.next)(p)),this.root=s(this.root,p),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(m){return!!this.find(m)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(m){return(0,e.findOrNextLower)(this.root,m,this.comparator)||void 0}forEach(m){let p=this.first();if(p)do m(p);while(p=(0,e.next)(p))}first(){return this.min}last(){return this.max}iterator0(){let m=this.first();return()=>{if(!m)return;const p=m;return m=(0,e.next)(m),p}}iterator(){const m=this.iterator0();return{next:()=>{const p=m();return{value:p,done:!p}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(m){return this.constructor.name+(0,t.printTree)(m,[p=>c(this.root,p)])}}return i};return pn.createMap=a,pn}var Ka;function Z0(){if(Ka)return Be;Ka=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.AvlMap=Be.AvlNode=void 0;const e=K0(),t=Q0();class d{constructor(n,u){this.k=n,this.v=u,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Be.AvlNode=d,Be.AvlMap=(0,t.createMap)(d,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),Be}var Ya;function $i(){if(Ya)return Te;Ya=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.Model=Te.UNDEFINED=void 0;const e=J,t=e.__importStar(Ye()),d=e.__importStar(z()),a=k0(),n=Hl(),u=Mr(),r=H0(),o=ke(),s=Pr(),c=pe(),i=z0(),f=Z0(),m=Br();Te.UNDEFINED=new s.ConNode(u.ORIGIN,void 0);let p=class wi{rndSid(){const y=this.clock,b=y.sid,l=y.peers;for(;;){const h=(0,r.randomSessionId)();if(b!==h&&!l.has(h))return h}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const h=y[0].getId().sid;if(!h)throw new Error("NO_SID");const w=wi.create(void 0,h);return w.applyBatch(y),w}constructor(y){this.root=new o.RootNode(this,u.ORIGIN),this.index=new f.AvlMap(d.compare),this.ext=new i.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new n.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const b=y.length;for(let l=0;l<b;l++)this.applyPatch(y[l])}applyLocalPatch(y){const b=y.getId();if(b){const l=this.clock;if(l.sid===b.sid){const h=l.time;h>b.time&&(y=y.rebase(h))}}this.applyPatch(y)}applyPatch(y){var h,w;(h=this.onbeforepatch)==null||h.call(this,y);const b=y.ops,{length:l}=b;for(let g=0;g<l;g++)this.applyOperation(b[g]);this.tick++,(w=this.onpatch)==null||w.call(this,y)}applyOperation(y){this.clock.observe(y.id,y.span());const b=this.index;if(y instanceof t.InsStrOp){const l=b.get(y.obj);l instanceof o.StrNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewObjOp){const l=y.id;b.get(l)||b.set(l,new o.ObjNode(this,l))}else if(y instanceof t.NewArrOp){const l=y.id;b.get(l)||b.set(l,new o.ArrNode(this,l))}else if(y instanceof t.NewStrOp){const l=y.id;b.get(l)||b.set(l,new o.StrNode(l))}else if(y instanceof t.NewValOp){const l=y.id;b.get(l)||b.set(l,new o.ValNode(this,l,u.ORIGIN))}else if(y instanceof t.NewConOp){const l=y.id;b.get(l)||b.set(l,new s.ConNode(l,y.val))}else if(y instanceof t.InsObjOp){const l=b.get(y.obj),h=y.data,w=h.length;if(l instanceof o.ObjNode)for(let g=0;g<w;g++){const _=h[g],C=b.get(_[1]);if(!C||l.id.time>=_[1].time)continue;const O=l.put(_[0]+"",C.id);O&&this._gcTree(O)}}else if(y instanceof t.InsVecOp){const l=b.get(y.obj),h=y.data,w=h.length;if(l instanceof o.VecNode)for(let g=0;g<w;g++){const _=h[g],C=b.get(_[1]);if(!C||l.id.time>=_[1].time)continue;const O=l.put(Number(_[0]),C.id);O&&this._gcTree(O)}}else if(y instanceof t.InsValOp){const l=y.obj,h=l.sid===0&&l.time===0?this.root:b.get(l);if(h instanceof o.ValNode&&b.get(y.val)){const g=h.set(y.val);g&&this._gcTree(g)}}else if(y instanceof t.InsArrOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const h=[],w=y.data,g=w.length;for(let _=0;_<g;_++){const C=w[_];b.get(C)&&(l.id.time>=C.time||h.push(C))}h.length&&l.ins(y.ref,y.id,h)}}else if(y instanceof t.UpdArrOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const h=y.val;if(b.get(h)){const w=l.upd(y.ref,h);w&&this._gcTree(w)}}}else if(y instanceof t.DelOp){const l=b.get(y.obj);if(l instanceof o.ArrNode){const h=y.what.length;for(let w=0;w<h;w++){const g=y.what[w];for(let _=0;_<g.span;_++){const C=l.getById(new d.Timestamp(g.sid,g.time+_));C&&this._gcTree(C)}}l.delete(y.what)}else(l instanceof o.StrNode||l instanceof o.BinNode)&&l.delete(y.what)}else if(y instanceof t.NewBinOp){const l=y.id;b.get(l)||b.set(l,new o.BinNode(l))}else if(y instanceof t.InsBinOp){const l=b.get(y.obj);l instanceof o.BinNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof t.NewVecOp){const l=y.id;b.get(l)||b.set(l,new o.VecNode(this,l))}}_gcTree(y){if(y.sid===0)return;const l=this.index.get(y);if(!l)return;const h=l.api;h&&h.events.handleDelete(),l.children(w=>this._gcTree(w.id)),this.index.del(y)}fork(y=this.rndSid()){const b=wi.fromBinary(this.toBinary());return b.clock.sid!==y&&b.clock instanceof d.ClockVector&&(b.clock=b.clock.fork(y)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(y){var w,g;(w=this.onbeforereset)==null||w.call(this);const b=this.index;this.index=new f.AvlMap(d.compare);const l=y.toBinary();a.decoder.decode(l,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const h=this._api;h&&(h.flush(),h.builder.clock=this.clock,h.node=this.root),b.forEach(({v:_})=>{const C=_.api;if(!C)return;const O=this.index.get(_.id);if(!O){C.events.handleDelete();return}C.node=O,O.api=C}),this.tick++,(g=this.onreset)==null||g.call(this)}view(){return this.root.view()}toBinary(){return a.encoder.encode(this)}setSchema(y,b=!0){const l=this.clock;if(l.time===1){const w=l.sid;b&&(l.sid=2),this.api.set(y),b&&this.setSid(w)}return this}setSid(y){const b=this.clock,l=b.sid;l!==y&&(b.sid=y,b.observe(new d.Timestamp(l,b.time-1),1))}toString(y=""){const b=()=>"",l=this.ext.size()>0;return"model"+(0,c.printTree)(y,[h=>this.root.toString(h),b,h=>{const w=[];return this.index.forEach(g=>w.push(g.v)),`index (${w.length} nodes)`+(w.length?(0,c.printTree)(h,w.map(g=>_=>`${g.name()} ${d.printTs(g.id)}`)):"")},b,h=>`view${(0,c.printTree)(h,[w=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+w)])}`,b,h=>this.clock.toString(h),l?b:null,l?h=>this.ext.toString(h):null])}};return Te.Model=p,p.sid=r.randomSessionId,p.create=(v,y=p.sid())=>{const b=typeof y=="number"?y===1?new d.ServerClockVector(1,1):new d.ClockVector(y,1):y,l=new p(b);return v!==void 0&&l.setSchema(v instanceof m.NodeBuilder?v:m.s.json(v),!0),l},p.withServerClock=(v,y=1)=>p.create(v,new d.ServerClockVector(1,y)),p.fromBinary=v=>a.decoder.decode(v),p.load=(v,y,b)=>{const l=a.decoder.decode(v);return b&&l.setSchema(b,!0),typeof y=="number"&&l.setSid(y),l},Te}var Xa;function Yl(){if(Xa)return It;Xa=1,Object.defineProperty(It,"__esModule",{value:!0}),It.ValNode=void 0;const e=z(),t=pe(),d=$i();let a=class{constructor(u,r,o){this.doc=u,this.id=r,this.val=o,this.api=void 0}set(u){if((0,e.compare)(u,this.val)<=0&&this.val.sid!==0||(0,e.compare)(u,this.id)<=0)return;const r=this.val;return this.val=u,r}node(){return this.val.sid===0?d.UNDEFINED:this.child()}view(){var u;return(u=this.node())==null?void 0:u.view()}children(u){u(this.node())}child(){return this.doc.index.get(this.val)}container(){const u=this.node();return u?u.container():void 0}name(){return"val"}toString(u=""){const r=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,t.printTree)(u,[s=>r?r.toString(s):(0,e.printTs)(this.val)])}};return It.ValNode=a,It}var gn={},Qa;function ep(){if(Qa)return gn;Qa=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.RootNode=void 0;const e=Mr(),t=Yl();let d=class extends t.ValNode{constructor(n,u){super(n,e.ORIGIN,u)}name(){return"root"}};return gn.RootNode=d,gn}var yn={},vn={},Za;function tp(){if(Za)return vn;Za=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.CRDT_CONSTANTS=void 0;var e;return function(t){t[t.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(e||(vn.CRDT_CONSTANTS=e={})),vn}var eu;function np(){if(eu)return yn;eu=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.VecNode=void 0;const e=Pr(),t=tp(),d=pe(),a=z();let n=class{constructor(r,o){this.doc=r,this.id=o,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(r){return this.elements[r]}get(r){const o=this.elements[r];if(o)return this.doc.index.get(o)}put(r,o){if(r>t.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const s=this.val(r);if(!(s&&(0,a.compare)(s,o)>=0)){if(r>this.elements.length)for(let c=this.elements.length;c<r;c++)this.elements.push(void 0);return r<this.elements.length?this.elements[r]=o:this.elements.push(o),s}}ext(){if(this.__extNode)return this.__extNode;const r=this.getExtId();if(!(r>=0))return;const s=this.doc.ext.get(r);if(s)return this.__extNode=new s.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const r=this.get(0);if(!(r instanceof e.ConNode))return-1;const o=r.val,s=this.id;return!(o instanceof Uint8Array)||o.length!==3||o[1]!==s.sid%256||o[2]!==s.time%256?-1:o[0]}child(){return this.ext()}container(){return this}children(r){const o=this.elements,s=o.length,c=this.doc.index;for(let i=0;i<s;i++){const f=o[i];if(!f)continue;const m=c.get(f);m&&r(m)}}view(){const r=this.ext();if(r)return r.view();let o=!0;const s=this._view,c=[],i=this.doc.index,f=this.elements,m=f.length;for(let p=0;p<m;p++){const v=f[p],y=v?i.get(v):void 0,b=y?y.view():void 0;s[p]!==b&&(o=!1),c.push(b)}return o?s:this._view=c}name(){return"vec"}toString(r=""){const o=this.ext(),s=this.name()+" "+(0,a.printTs)(this.id)+(o?` { extension = ${this.getExtId()} }`:"");if(o)return this.child().toString(r,this.id);const c=this.doc.index;return s+(0,d.printTree)(r,[...this.elements.map((i,f)=>m=>`${f}: ${i&&c.get(i)?c.get(i).toString(m+"  "+" ".repeat((""+f).length)):"nil"}`),...o?[i=>`${this.child().toString(i)}`]:[]])}};return yn.VecNode=n,yn}var wn={},tu;function rp(){if(tu)return wn;tu=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.ObjNode=void 0;const e=pe(),t=z(),d=Pr();let a=class{constructor(u,r){this.doc=u,this.id=r,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(u){const r=this.keys.get(u);if(r)return this.doc.index.get(r)}put(u,r){const o=this.keys.get(u);if(!(o&&(0,t.compare)(o,r)>=0))return this.keys.set(u,r),o}nodes(u){const r=this.doc.index;this.keys.forEach((o,s)=>u(r.get(o),s))}forEach(u){const r=this.doc.index;this.keys.forEach((o,s)=>{const c=r.get(o);!c||c instanceof d.ConNode&&c.val===void 0||u(s,c)})}children(u){const r=this.doc.index;this.keys.forEach((o,s)=>u(r.get(o)))}child(){}container(){return this}view(){const u=this.doc,r=u.clock.time+u.tick,o=this._view;if(this._tick===r)return o;const s={},c=u.index;let i=!0;return this.keys.forEach((f,m)=>{const p=c.get(f);if(!p){i=!1;return}const v=p.view();v!==void 0?(o[m]!==v&&(i=!1),s[m]=v):o[m]!==void 0&&(i=!1)}),i?o:(this._tick=r,this._view=s)}name(){return"obj"}toString(u=""){return this.name()+" "+(0,t.printTs)(this.id)+(0,e.printTree)(u,[...this.keys.entries()].filter(([,o])=>!!this.doc.index.get(o)).map(([o,s])=>c=>JSON.stringify(o)+(0,e.printTree)(c+" ",[i=>this.doc.index.get(s).toString(i)])))}};return wn.ObjNode=a,wn}var Ve={},_n={},oi={},nu;function sp(){return nu||(nu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const t=(s,c,i)=>{const f=c.p;if(!f)return s;const m=f.p,p=f.l===c;return m?(m.l===f?p?s=(0,e.llSplay)(s,c,f,m):s=(0,e.lrSplay)(s,c,f,m):p?s=(0,e.rlSplay)(s,c,f,m):s=(0,e.rrSplay)(s,c,f,m),i>1?(0,e.splay)(s,c,i-1):s):(p?(0,e.rSplay)(c,f):(0,e.lSplay)(c,f),c)};e.splay=t;const d=(s,c)=>{const i=s.r;s.p=void 0,s.r=c,c.p=s,c.l=i,i&&(i.p=c)};e.rSplay=d;const a=(s,c)=>{const i=s.l;s.p=void 0,s.l=c,c.p=s,c.r=i,i&&(i.p=c)};e.lSplay=a;const n=(s,c,i,f)=>{const m=i.l,p=c.l,v=f.p;return c.p=v,c.l=i,i.p=c,i.l=f,i.r=p,f.p=i,f.r=m,m&&(m.p=f),p&&(p.p=i),v?v.l===f?v.l=c:v.r=c:s=c,s};e.rrSplay=n;const u=(s,c,i,f)=>{const m=i.r,p=c.r,v=f.p;return c.p=v,c.r=i,i.p=c,i.l=p,i.r=f,f.p=i,f.l=m,m&&(m.p=f),p&&(p.p=i),v?v.l===f?v.l=c:v.r=c:s=c,s};e.llSplay=u;const r=(s,c,i,f)=>{const m=c.l,p=c.r,v=f.p;return c.p=v,c.l=i,c.r=f,i.p=c,i.r=m,f.p=c,f.l=p,m&&(m.p=i),p&&(p.p=f),v?v.l===f?v.l=c:v.r=c:s=c,s};e.lrSplay=r;const o=(s,c,i,f)=>{const m=c.r,p=c.l,v=f.p;return c.p=v,c.l=f,c.r=i,i.p=c,i.l=m,f.p=c,f.r=p,m&&(m.p=i),p&&(p.p=f),v?v.l===f?v.l=c:v.r=c:s=c,s};e.rlSplay=o}(oi)),oi}var ci={},ru;function ip(){return ru||(ru=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const t=(s,c)=>{const i=c.p2;if(!i)return s;const f=i.p2,m=i.l2===c;return f?(f.l2===i?m?s=u(s,c,i,f):s=r(s,c,i,f):m?s=o(s,c,i,f):s=n(s,c,i,f),(0,e.splay2)(s,c)):(m?d(c,i):a(c,i),c)};e.splay2=t;const d=(s,c)=>{const i=s.r2;s.p2=void 0,s.r2=c,c.p2=s,c.l2=i,i&&(i.p2=c)},a=(s,c)=>{const i=s.l2;s.p2=void 0,s.l2=c,c.p2=s,c.r2=i,i&&(i.p2=c)},n=(s,c,i,f)=>{const m=i.l2,p=c.l2,v=f.p2;return c.p2=v,c.l2=i,i.p2=c,i.l2=f,i.r2=p,f.p2=i,f.r2=m,m&&(m.p2=f),p&&(p.p2=i),v?v.l2===f?v.l2=c:v.r2=c:s=c,s},u=(s,c,i,f)=>{const m=i.r2,p=c.r2,v=f.p2;return c.p2=v,c.r2=i,i.p2=c,i.l2=p,i.r2=f,f.p2=i,f.l2=m,m&&(m.p2=f),p&&(p.p2=i),v?v.l2===f?v.l2=c:v.r2=c:s=c,s},r=(s,c,i,f)=>{const m=c.l2,p=c.r2,v=f.p2;return c.p2=v,c.l2=i,c.r2=f,i.p2=c,i.r2=m,f.p2=c,f.l2=p,m&&(m.p2=i),p&&(p.p2=f),v?v.l2===f?v.l2=c:v.r2=c:s=c,s},o=(s,c,i,f)=>{const m=c.r2,p=c.l2,v=f.p2;return c.p2=v,c.l2=f,c.r2=i,i.p2=c,i.l2=m,f.p2=c,f.r2=p,m&&(m.p2=i),p&&(p.p2=f),v?v.l2===f?v.l2=c:v.r2=c:s=c,s}}(ci)),ci}var re={},su;function op(){if(su)return re;su=1,Object.defineProperty(re,"__esModule",{value:!0}),re.remove2=re.insert2=re.prev2=re.next2=re.last2=re.first2=void 0;const e=s=>{let c=s;for(;c;)if(c.l2)c=c.l2;else return c;return c};re.first2=e;const t=s=>{let c=s;for(;c;)if(c.r2)c=c.r2;else return c;return c};re.last2=t;const d=s=>{if(s.r2){for(s=s.r2;s.l2;)s=s.l2;return s}let c=s.p2;for(;c&&c.r2===s;)s=c,c=c.p2;return c};re.next2=d;const a=s=>{if(s.l2){for(s=s.l2;s.r2;)s=s.r2;return s}let c=s.p2;for(;c&&c.l2===s;)s=c,c=c.p2;return c};re.prev2=a;const n=(s,c)=>{const i=s.r2=c.r2;c.r2=s,s.p2=c,i&&(i.p2=s)},u=(s,c)=>{const i=s.l2=c.l2;c.l2=s,s.p2=c,i&&(i.p2=s)},r=(s,c,i)=>{if(!s)return c;let f=s;for(;f;){const m=i(c,f),p=m<0?f.l2:f.r2;if(p)f=p;else{m<0?u(c,f):n(c,f);break}}return s};re.insert2=r;const o=(s,c)=>{const i=c.p2,f=c.l2,m=c.r2;if(c.p2=c.l2=c.r2=void 0,!f&&!m){if(i)i.l2===c?i.l2=void 0:i.r2=void 0;else return;return s}else if(f&&m){let v=f;for(;v.r2;)v=v.r2;return v.r2=m,m.p2=v,i?(i.l2===c?i.l2=f:i.r2=f,f.p2=i,s):(f.p2=void 0,f)}const p=f||m;if(p.p2=i,i)i.l2===c?i.l2=p:i.r2=p;else return p;return s};return re.remove2=o,re}var Cn={},iu;function cp(){if(iu)return Cn;iu=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.printOctets=void 0;const e=(t,d=16)=>{let a="";if(!t.length)return a;t[0]<16&&(a+="0"),a+=t[0].toString(16);for(let n=1;n<t.length&&n<d;n++){const u=t[n];a+=" ",u<16&&(a+="0"),a+=u.toString(16)}return t.length>d&&(a+=`… (${t.length-d} more)`),a};return Cn.printOctets=e,Cn}var ou;function Ji(){if(ou)return _n;ou=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.AbstractRga=void 0;const e=z(),t=Mi(),d=sp(),a=ip(),n=op(),u=Mr(),r=pe(),o=Vi(),s=cp(),c=(b,l)=>{const h=b.id,w=l.id;return h.sid-w.sid||h.time-w.time},i=b=>{const l=b.l,h=b.r;b.len=(b.del?0:b.span)+(l?l.len:0)+(h?h.len:0)},f=b=>{const l=b.l,h=b.r;b.len=b.span+(l?l.len:0)+(h?h.len:0)},m=(b,l)=>{for(;b;)b.len+=l,b=b.p},p=b=>{const l=b.r;if(l){b=l;let w;for(;w=b.l;)b=w;return b}let h=b.p;for(;h&&h.r===b;)b=h,h=h.p;return h},v=b=>{const l=b.l;if(l){b=l;let w;for(;w=b.r;)b=w;return b}let h=b.p;for(;h&&h.l===b;)b=h,h=h.p;return h};let y=class{constructor(l){this.id=l,this.root=void 0,this.ids=void 0,this.count=0}ins(l,h,w){const g=this.id,_=l.time,C=l.sid;if(g.time===_&&g.sid===C){this.insAfterRoot(l,h,w);return}let k=this.ids,S=k;for(;k;){const T=k.id,q=T.sid;if(q>C)k=k.l2;else if(q<C)S=k,k=k.r2;else{const B=T.time;if(B>_)k=k.l2;else if(B<_)S=k,k=k.r2;else{S=k;break}}}if(!S)return;const E=S.id,A=E.time,N=E.sid,x=S.span;if(N!==C||_-A>=x)return;const R=_-A;this.insAfterChunk(l,S,R,h,w)}insAt(l,h,w){if(!l){const S=this.id;return this.insAfterRoot(S,h,w),S}const g=this.findChunk(l-1);if(!g)return;const[_,C]=g,O=_.id,k=C===0?O:new e.Timestamp(O.sid,O.time+C);return this.insAfterChunk(k,_,C,h,w),k}insAfterRoot(l,h,w){const g=this.createChunk(h,w),_=this.first();if(!_)this.setRoot(g);else if((0,e.compare)(_.id,h)<0)this.insertBefore(g,_);else{if((0,e.containsId)(_.id,_.span,h))return;this.insertAfterRef(g,l,_)}}insAfterChunk(l,h,w,g,_){const C=h.id,O=C.time,k=C.sid,S=h.span,E=this.createChunk(g,_);if(w+1<S){const N=g.sid,x=g.time;if(k===N&&O<=x&&O+S-1>=x)return;if(x>l.time+1||N>l.sid){this.insertInside(E,h,w+1),this.splay(E);return}}this.insertAfterRef(E,l,h),this.splay(E)}delete(l){const h=l.length;for(let w=0;w<h;w++)this.deleteSpan(l[w]);this.onChange()}deleteSpan(l){const h=l.span,w=l.time,g=w+h-1,_=this.findById(l);if(!_)return;let C=_,O=C;for(;C;){O=C;const k=C.id,S=C.span,E=k.time,A=E+S-1;if(C.del){if(A>=g)break;C=C.s;continue}const N=w<=E,x=w<=A;if(N)if(g>=A){if(C.delete(),m(C,-C.span),g<=A)break}else{const R=g-E+1,T=this.split(C,R);C.delete(),i(T),m(C,-C.span);break}else if(x)if(g>=A){const R=w-E,T=this.split(C,R);if(T.delete(),T.len=T.r?T.r.len:0,m(C,-T.span),g<=A)break}else{const R=this.split(C,g-E+1),T=this.split(C,w-E);T.delete(),i(R),i(T),m(C,-T.span);break}C=C.s}O&&this.mergeTombstones2(_,O)}find(l){let h=this.root;for(;h;){const w=h.l,g=w?w.len:0;let _;if(l<g)h=w;else if(h.del)l-=g,h=h.r;else if(l<g+(_=h.span)){const C=l-g,O=h.id;return C?new e.Timestamp(O.sid,O.time+C):O}else l-=g+_,h=h.r}}findChunk(l){let h=this.root;for(;h;){const w=h.l,g=w?w.len:0;let _;if(l<g)h=w;else if(h.del)l-=g,h=h.r;else{if(l<g+(_=h.span))return[h,l-g];l-=g+_,h=h.r}}}findInterval(l,h){const w=[];if(!h)return w;let g=this.root,_=0;for(;g;){const k=g.l?g.l.len:0;if(l<k)g=g.l;else if(g.del)l-=k,g=g.r;else if(l<k+g.span){_=l-k;break}else l-=k+g.span,g=g.r}if(!g)return w;if(g.span>=h+_){const k=g.id;return w.push((0,e.tss)(k.sid,k.time+_,h)),w}const C=g.span-_,O=g.id;if(w.push((0,e.tss)(O.sid,O.time+_,C)),h-=C,g=p(g),!g)return w;do{if(g.del)continue;const k=g.id,S=g.span;if(h<=S)return w.push((0,e.tss)(k.sid,k.time,h)),w;w.push((0,e.tss)(k.sid,k.time,S)),h-=S}while((g=p(g))&&h>0);return w}findInterval2(l,h){const w=[];return this.range0(void 0,l,h,(g,_,C)=>{const O=g.id;w.push((0,e.tss)(O.sid,O.time+_,C))}),w}range0(l,h,w,g){let _=l||this.findById(h);if(l)for(;_&&!(0,e.containsId)(_.id,_.span,h);)_=p(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,w))return}else{const C=h.time-_.id.time;if((0,e.containsId)(_.id,_.span,w)){const S=w.time-h.time+1;return g(_,C,S),_}const k=_.span-C;if(g(_,C,k))return _}for(_=p(_);_;){if((0,e.containsId)(_.id,_.span,w))return!_.del&&g(_,0,w.time-_.id.time+1),_;if(!_.del&&g(_,0,_.span))return _;_=p(_)}return _}}first(){let l=this.root;for(;l;){const h=l.l;if(h)l=h;else return l}return l}last(){let l=this.root;for(;l;){const h=l.r;if(h)l=h;else return l}return l}lastId(){const l=this.last();if(!l)return;const h=l.id,w=l.span;return w===1?h:new e.Timestamp(h.sid,h.time+w-1)}next(l){return p(l)}prev(l){return v(l)}length(){const l=this.root;return l?l.len:0}size(){return this.count}pos(l){const h=l.p,w=l.l;if(!h)return w?w.len:0;const g=this.pos(h);if(h.r===l)return g+(h.del?0:h.span)+(w?w.len:0);const C=l.r;return g-(l.del?0:l.span)-(C?C.len:0)}setRoot(l){this.root=l,this.insertId(l),this.onChange()}insertBefore(l,h){const w=h.l;h.l=l,l.l=w,l.p=h;let g=0;w&&(w.p=l,g=w.len),l.len=l.span+g,m(h,l.span),this.insertId(l),this.onChange()}insertAfter(l,h){const w=h.r;h.r=l,l.r=w,l.p=h;let g=0;w&&(w.p=l,g=w.len),l.len=l.span+g,m(h,l.span),this.insertId(l),this.onChange()}insertAfterRef(l,h,w){const g=l.id,_=g.sid,C=g.time;let O=!1;for(;;){const k=w.id,S=k.time+w.span;w.s||(O=k.sid===_&&S===C&&S-1===h.time,O&&(w.s=l));const E=p(w);if(!E)break;const A=E.id,N=A.time,x=A.sid;if(N<C)break;if(N===C){if(x===_)return;if(x<_)break}w=E}O&&!w.del?(this.mergeContent(w,l.data),w.s=void 0):this.insertAfter(l,w)}mergeContent(l,h){const w=l.span;l.merge(h),m(l,l.span-w),this.onChange()}insertInside(l,h,w){const g=h.p,_=h.l,C=h.r,O=h.s,k=h.len,S=h.split(w);if(h.s=S,S.s=O,h.l=h.r=S.l=S.r=void 0,S.l=void 0,l.p=g,!_)l.l=h,h.p=l;else{l.l=_,_.p=l;const N=_.r;_.r=h,h.p=_,h.l=N,N&&(N.p=h)}if(!C)l.r=S,S.p=l;else{l.r=C,C.p=l;const N=C.l;C.l=S,S.p=C,S.r=N,N&&(N.p=S)}g?g.l===h?g.l=l:g.r=l:this.root=l,i(h),i(S),_&&(_.len=(_.l?_.l.len:0)+h.len+(_.del?0:_.span)),C&&(C.len=(C.r?C.r.len:0)+S.len+(C.del?0:C.span)),l.len=k+l.span;const E=l.span;let A=l.p;for(;A;)A.len+=E,A=A.p;this.insertId(S),this.insertIdFast(l),this.onChange()}split(l,h){const w=l.s,g=l.split(h),_=l.r;return l.s=g,g.r=_,g.s=w,l.r=g,g.p=l,this.insertId(g),_&&(_.p=g),g}mergeTombstones(l,h){if(!l.del||!h.del)return!1;const w=l.id,g=h.id;return w.sid!==g.sid||w.time+l.span!==g.time?!1:(l.s=h.s,l.span+=h.span,this.deleteChunk(h),!0)}mergeTombstones2(l,h){let w=l;for(;w;){const _=p(w);if(!_)break;if(!this.mergeTombstones(w,_)){if(_===h){if(_){const O=p(_);O&&this.mergeTombstones(_,O)}break}w=w.s}}const g=v(l);g&&this.mergeTombstones(g,l)}removeTombstones(){let l=this.first();const h=[];for(;l;)l.del&&h.push(l),l=p(l);for(let w=0;w<h.length;w++)this.deleteChunk(h[w])}deleteChunk(l){this.deleteId(l);const h=l.p,w=l.l,g=l.r;if(l.id=u.ORIGIN,!w&&!g)h?h.l===l?h.l=void 0:h.r=void 0:this.root=void 0;else if(w&&g){let _=w;for(;_.r;)_=_.r;_.r=g,g.p=_;const C=g.len;let O;for(O=_,h?(h.l===l?h.l=w:h.r=w,w.p=h):(this.root=w,w.p=void 0);O&&O!==h;)O.len+=C,O=O.p}else{const _=w||g;_.p=h,h?h.l===l?h.l=_:h.r=_:this.root=_}}insertId(l){this.ids=(0,n.insert2)(this.ids,l,c),this.count++,this.ids=(0,a.splay2)(this.ids,l)}insertIdFast(l){this.ids=(0,n.insert2)(this.ids,l,c),this.count++}deleteId(l){this.ids=(0,n.remove2)(this.ids,l),this.count--}findById(l){const h=l.sid,w=l.time;let g=this.ids,_=g;for(;g;){const A=g.id,N=A.sid;if(N>h)g=g.l2;else if(N<h)_=g,g=g.r2;else{const x=A.time;if(x>w)g=g.l2;else if(x<w)_=g,g=g.r2;else{_=g;break}}}if(!_)return;const C=_.id,O=C.time,k=C.sid,S=_.span;if(!(k!==h||w<O||w-O>=S))return _}prevId(l){let h=this.findById(l);if(!h)return;const w=l.time;if(h.id.time<w)return new e.Timestamp(l.sid,w-1);if(h=v(h),!h)return;const g=h.id;return h.span>1?new e.Timestamp(g.sid,g.time+h.span-1):g}spanView(l){const h=[];let w=l.span;const g=l.time;let _=this.findById(l);if(!_)return h;if(!_.del)if(_.span>=w+g-_.id.time){const C=g-_.id.time,O=C+w,k=_.view().slice(C,O);return h.push(k),h}else{const C=g-_.id.time,O=_.view().slice(C,l.span);w-=_.span-C,h.push(O)}for(;_=_.s;){const C=_.span;if(!_.del){if(C>w){const O=_.view().slice(0,w);h.push(O);break}h.push(_.data)}if(w-=C,w<=0)break}return h}splay(l){const h=l.p;if(!h)return;const w=h.p,g=h.l===l;if(!w){g?(0,d.rSplay)(l,h):(0,d.lSplay)(l,h),this.root=l,i(h),f(l);return}w.l===h?g?this.root=(0,d.llSplay)(this.root,l,h,w):this.root=(0,d.lrSplay)(this.root,l,h,w):g?this.root=(0,d.rlSplay)(this.root,l,h,w):this.root=(0,d.rrSplay)(this.root,l,h,w),i(w),i(h),f(l),this.splay(l)}iterator(){let l=this.first();return()=>{const h=l;return l&&(l=p(l)),h}}ingest(l,h){if(l<1)return;const w=new Map;this.root=this._ingest(l,()=>{const g=h(),_=g.id,C=_.sid+"."+_.time,O=w.get(C);O&&(O.s=g,w.delete(C));const k=(0,e.tick)(_,g.span);return w.set(k.sid+"."+k.time,g),g})}_ingest(l,h){const w=l>>1,g=l-w-1,_=w>0?this._ingest(w,h):void 0,C=h();_&&(C.l=_,_.p=C);const O=g>0?this._ingest(g,h):void 0;return O&&(C.r=O,O.p=C),i(C),this.insertId(C),C}toStringName(){return"AbstractRga"}toString(l=""){const h=this.view();let w="";return(0,t.isUint8Array)(h)?w+=` { ${(0,s.printOctets)(h)||"∅"} }`:typeof h=="string"&&(w+=`{ ${h.length>32?JSON.stringify(h.substring(0,32))+" …":JSON.stringify(h)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${w}`+(0,r.printTree)(l,[_=>this.root?this.printChunk(_,this.root):"∅"])}printChunk(l,h){return this.formatChunk(h)+(0,o.printBinary)(l,[h.l?w=>this.printChunk(w,h.l):null,h.r?w=>this.printChunk(w,h.r):null])}formatChunk(l){let w=`chunk ${(0,e.printTs)(l.id)}:${l.span} .${l.len}.`;if(l.del)w+=` [${l.span}]`;else if((0,t.isUint8Array)(l.data))w+=` { ${(0,s.printOctets)(l.data)||"∅"} }`;else if(typeof l.data=="string"){const g=l.data.length>32?JSON.stringify(l.data.substring(0,32))+" …":JSON.stringify(l.data);w+=` { ${g} }`}return w}};return _n.AbstractRga=y,_n}var cu;function ap(){if(cu)return Ve;cu=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.ArrNode=Ve.ArrChunk=void 0;const e=Ji(),t=z(),d=Vi(),a=pe();class n{constructor(o,s,c){this.id=o,this.span=s,this.len=c?s:0,this.del=!c,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=c}merge(o){this.data.push(...o),this.span=this.data.length}split(o){const s=this.span;if(this.span=o,!this.del){const i=this.data.splice(o);return new n((0,t.tick)(this.id,o),s-o,i)}return new n((0,t.tick)(this.id,o),s-o,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new n(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ve.ArrChunk=n;let u=class extends e.AbstractRga{constructor(o,s){super(s),this.doc=o,this._tick=0,this._view=[],this.api=void 0}get(o){const s=this.findChunk(o);if(s)return s[0].data[s[1]]}getNode(o){const s=this.get(o);if(s)return this.doc.index.get(s)}getId(o){const s=this.findChunk(o);if(!s)return;const[c,i]=s,f=c.id;return i?(0,t.tick)(f,i):f}getById(o){const s=this.findById(o);if(!s||s.del)return;const c=o.time-s.id.time;return s.data[c]}upd(o,s){const c=this.findById(o);if(!c)return;const i=c.data;if(!i)return;const f=o.time-c.id.time,m=i[f];if(!(m&&(0,t.compare)(m,s)>=0))return i[f]=s,this.onChange(),m}createChunk(o,s){return new n(o,s?s.length:0,s)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const o=this.doc,s=o.clock.time+o.tick,c=this._view;if(this._tick===s)return c;const i=[],f=o.index;let m=!0;for(let v=this.first();v;v=this.next(v))if(!v.del)for(const y of v.data){const b=f.get(y);if(!b){m=!1;continue}const l=b.view();c[i.length]!==l&&(m=!1),i.push(l)}return c.length!==i.length&&(m=!1),m?c:(this._tick=s,this._view=i)}children(o){const s=this.doc.index;for(let c=this.first();c;c=this.next(c)){const i=c.data;if(!i)continue;const f=i.length;for(let m=0;m<f;m++)o(s.get(i[m]))}}name(){return"arr"}printChunk(o,s){const c=this.pos(s);let i="";if(!s.del){const f=this.doc.index;i=(0,a.printTree)(o,s.data.map(m=>f.get(m)).filter(m=>!!m).map((m,p)=>v=>`[${c+p}]: ${m.toString(v+"    "+" ".repeat(String(p).length))}`))}return this.formatChunk(s)+i+(0,d.printBinary)(o,[s.l?f=>this.printChunk(f,s.l):null,s.r?f=>this.printChunk(f,s.r):null])}};return Ve.ArrNode=u,Ve}var $e={},au;function up(){if(au)return $e;au=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.BinNode=$e.BinChunk=void 0;const e=z(),t=Ji();class d{constructor(u,r,o){this.id=u,this.span=r,this.len=o?r:0,this.del=!o,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=o}merge(u){const r=this.data.length,o=new Uint8Array(r+u.length);o.set(this.data),o.set(u,r),this.data=o,this.span=o.length}split(u){if(!this.del){const o=this.data,s=o.subarray(u),c=new d((0,e.tick)(this.id,u),this.span-u,s);return this.data=o.subarray(0,u),this.span=u,c}const r=new d((0,e.tick)(this.id,u),this.span-u,void 0);return this.span=u,r}delete(){this.del=!0,this.data=void 0}clone(){return new d(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}$e.BinChunk=d;let a=class extends t.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const u=new Uint8Array(this.length());let r=0,o=this.first();for(;o;){if(!o.del){const s=o.data;u.set(s,r),r+=s.length}o=this.next(o)}return this._view=u}children(){}child(){}container(){}name(){return"bin"}createChunk(u,r){return new d(u,r?r.length:0,r)}onChange(){this._view=null}toStringName(){return this.name()}};return $e.BinNode=a,$e}var Je={},uu;function lp(){if(uu)return Je;uu=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.StrNode=Je.StrChunk=void 0;const e=z(),t=Ji(),d=Kl();class a{constructor(r,o,s){this.id=r,this.span=o,this.len=s?o:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=s}merge(r){this.data+=r,this.span=this.data.length}split(r){if(!this.del){const s=new a((0,e.tick)(this.id,r),this.span-r,this.data.slice(r));return this.data=this.data.slice(0,r),this.span=r,s}const o=new a((0,e.tick)(this.id,r),this.span-r,"");return this.span=r,o}delete(){this.del=!0,this.data=""}clone(){return new a(this.id,this.span,this.data)}view(){return this.data}}Je.StrChunk=a;let n=class extends t.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let r="";for(let o=this.first();o;o=(0,d.next)(o))r+=o.data;return this._view=r}name(){return"str"}createChunk(r,o){return new a(r,o?o.length:0,o||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Je.StrNode=n,Je}var lu;function dp(){return lu||(lu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var t=Pr();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return t.ConNode}});var d=Yl();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return d.ValNode}});var a=ep();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return a.RootNode}});var n=np();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return n.VecNode}});var u=rp();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return u.ObjNode}});var r=ap();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return r.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return r.ArrChunk}});var o=up();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return o.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return o.BinChunk}});var s=lp();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return s.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return s.StrChunk}})}(js)),js}var du;function ke(){return du||(du=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(c0(),e),t.__exportStar(dp(),e)}(Is)),Is}var ai={},fu;function fp(){return fu||(fu=1,Object.defineProperty(ai,"__esModule",{value:!0})),ai}var ui={},hu;function hp(){return hu||(hu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const t=J;var d=$i();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return d.Model}}),t.__exportStar(Hl(),e)}(ui)),ui}var pu;function fr(){return pu||(pu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(ke(),e),t.__exportStar(fp(),e),t.__exportStar(hp(),e),t.__exportStar(Br(),e)}(Rs)),Rs}var Sn={},On={},En={},mu;function pp(){if(mu)return En;mu=1,Object.defineProperty(En,"__esModule",{value:!0}),En.PropertyLayout=void 0;const e=M(),t=Y(),d=Z(),a=({property:n,formal:u,focused:r})=>{const o=(0,t.useTheme)(),s={color:o.g(.1)};return r&&(s.background=o.bg,s.border=`1px solid ${o.g(.9)}`,s.fontWeight="bold",s.margin="-3px",s.padding="2px"),(!n||n.indexOf(" ")!==-1)&&(s.background=o.blue(.1)),e.createElement(e.Fragment,null,e.createElement("span",{className:d.property,style:s},u?JSON.stringify(n):n),e.createElement("span",{className:d.colon,style:{color:o.g(.5)}},e.createElement("span",null,":")))};return En.PropertyLayout=a,En}var bu;function _e(){if(bu)return On;bu=1,Object.defineProperty(On,"__esModule",{value:!0}),On.JsonCrdtProperty=void 0;const e=M(),t=pp(),d=({node:a})=>!a.parent||a.parent.node.name()!=="obj"?null:e.createElement(t.PropertyLayout,{property:a.step});return On.JsonCrdtProperty=d,On}var kn={},An={},gu;function mp(){if(gu)return An;gu=1,Object.defineProperty(An,"__esModule",{value:!0}),An.TypeAndId=void 0;const e=M(),t=Y(),d=fr(),a=(0,t.rule)(Object.assign(Object.assign({},t.theme.font.mono),{fz:"10px",lh:"9px",us:"none",pe:"none"}));return An.TypeAndId=e.memo(({node:n,active:u,negative:r,extension:o})=>{const s=(0,t.useTheme)(),c=n.node;let i=c.name();o&&c instanceof d.VecNode&&c.isExt()&&(i=e.createElement("span",{style:{whiteSpace:"nowrap"}},"ext ",e.createElement("span",{style:{color:s.color.sem.brand[1]}},c.ext().name())));const{sid:f,time:m}=c.id;return e.createElement("span",{className:a,style:{color:u?r?s.color.sem.negative[0]:s.color.sem.blue[0]:s.g(0,.5)}},i,e.createElement("span",{style:{color:u?s.g(0,.45):s.g(0,.2),display:"block"}},u?(f>999?"...":"")+String(f).slice(String(f).length-4):null,e.createElement("span",{style:{color:u?s.g(0,.7):s.g(0,.3)}},"."+m)))}),An}var ye={},yu;function Ce(){if(yu)return ye;yu=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.isContainer=ye.createValue=ye.id=void 0;const e=a=>{const n=a.node.id;return n.sid+"."+n.time};ye.id=e;const t=(a,n,u,r)=>{let o=n;try{o=JSON.parse(n)}catch{}const s=a.api,c=s.builder,i=u==="any"?r?c.constOrJson(o):c.json(o):u==="con"?s.builder.const(o):u==="vec"?s.builder.vec():u==="val"?s.builder.val():s.builder.const(void 0);if(u==="vec"){if(n){const f=Array.isArray(o)?o:[o];c.insVec(i,f.map((m,p)=>[p,s.builder.maybeConst(m)]))}}else u==="val"&&c.setVal(i,n?s.builder.maybeConst(o):s.builder.const(void 0));return i};ye.createValue=t;const d=a=>!!a&&typeof a=="object";return ye.isContainer=d,ye}var Nn={},vu;function bp(){if(vu)return Nn;vu=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.JsonCrdtRegionEdit=void 0;const e=M(),t=_e(),d=Ii(),a=jr(),n=Ri(),u=te(),r=Ce(),o=le(),s=({node:c,onCancel:i})=>{const{compact:f}=(0,u.useStyles)(),{model:m}=(0,o.useJsonCrdt)(),p=(b,l)=>{const h=c.parent;if(h&&h.node.name()==="obj"){const w=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set({[c.step]:w})}else if(h&&(h.node.name()==="val"||h.node.name()==="root")){const w=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set(w)}else if(h&&h.node.name()==="vec"){const w=(0,r.createValue)(m,b,l,!0);m.api.wrap(h.node).set([[+c.step,w]])}i&&i()},v=c.node.view(),y=(0,r.isContainer)(v)?"":JSON.stringify(v);return e.createElement(n.FocusRegion,{compact:f},e.createElement(t.JsonCrdtProperty,{node:c}),e.createElement("span",{style:{display:"inline-block",margin:"-3px 0",position:"relative"}},e.createElement(d.ValueInput,{focus:!0,withType:!0,visible:!0,initialType:c.node.name()==="con"&&c.node.view()!==void 0?"con":"any",initialValue:y,onSubmit:p,onCancel:i}),!!i&&e.createElement(a.CancelAction,{onClick:()=>i()})))};return Nn.JsonCrdtRegionEdit=s,Nn}var wu;function Ae(){if(wu)return kn;wu=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.JsonCrdtRegion=void 0;const e=M(),t=Ri(),d=ue(),a=te(),n=le(),u=mp(),r=Ce(),o=bp(),s=i=>!i.parent||i.node.name()!=="con"?!1:i.node.val===void 0,c=({node:i,editing:f,extension:m,toolbar:p,children:v})=>{var y;const{model:b}=(0,n.useJsonCrdt)(),{compact:l,readonly:h}=(0,a.useStyles)(),{focused:w,focus:g,pointed:_,point:C}=(0,d.useFocus)(),O=(0,r.id)(i),[k,S]=e.useState(!1),E=V=>{V.stopPropagation(),_!==O&&C(O)},A=V=>{V.preventDefault(),V.stopPropagation(),C(O)},N=()=>{C("")},x=V=>{V.preventDefault(),V.stopPropagation(),g(O)},I=w===O,R=_===O,T=(y=i.parent)===null||y===void 0?void 0:y.node.name(),q=s(i),B=T==="obj",$=T==="arr",L=T==="vec",F=I?e.createElement("span",{style:{display:"inline-block",margin:"-4px 0 0"}},e.createElement(u.TypeAndId,{node:i,active:I,negative:q,extension:m})):void 0;return k?e.createElement(o.JsonCrdtRegionEdit,{node:i,onCancel:()=>S(!1)}):e.createElement(t.FocusRegion,{pointed:R,focused:I,compact:l,negative:q,aside:F,toolbar:p,onClick:x,onMouseMove:E,onMouseEnter:A,onMouseLeave:N,onDelete:f||h||!I||q?void 0:B?()=>{b.api.wrap(i.parent.node).del([i.step])}:$?()=>{b.api.wrap(i.parent.node).del(+i.step,1)}:L?()=>{b.api.wrap(i.parent.node).set([[+i.step,void 0]])}:T==="val"&&!q?()=>{b.api.wrap(i.parent.node).set(void 0)}:void 0,onEdit:f||h?void 0:I&&(T==="obj"||T==="val"||T==="root"||T==="vec")?()=>S(!0):void 0},v)};return kn.JsonCrdtRegion=c,kn}var xn={},_u;function Xl(){if(_u)return xn;_u=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.JsonCrdtConstant=void 0;const e=M(),t=Ke(),d=xl(),a=ue(),n=({id:u,view:r})=>{const{focus:o}=(0,a.useFocus)(),[s,c]=e.useState(!1),i=()=>{r&&typeof r=="object"&&c(!s)};return s?e.createElement("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"}},e.createElement(d.ClickableJson,{readonly:!0,compact:!0,noCollapseToggles:!0,pfx:u,doc:r,onFocus:f=>{f!==null&&o(u)}})):e.createElement(t.JsonAtom,{value:r,onClick:i})};return xn.JsonCrdtConstant=n,xn}var Cu;function gp(){if(Cu)return Sn;Cu=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.JsonCrdtConNode=void 0;const e=M(),t=_e(),d=Ae(),a=te(),n=Ce(),u=Xl(),r=({node:o})=>{const{formal:s}=(0,a.useStyles)();return e.createElement(d.JsonCrdtRegion,{node:o},e.createElement(t.JsonCrdtProperty,{node:o}),e.createElement(u.JsonCrdtConstant,{id:(0,n.id)(o),view:o.node.view()}),!!s&&",")};return Sn.JsonCrdtConNode=r,Sn}var Rn={},In={},Su;function hr(){if(Su)return In;Su=1,Object.defineProperty(In,"__esModule",{value:!0}),In.JsonCrdtObjectLayout=void 0;const e=J,t=M(),d=Al(),a=te(),n=ue(),u=Ce(),r=o=>{var{node:s}=o,c=e.__rest(o,["node"]);const{collapsed:i}=(0,a.useStyles)(),{focused:f}=(0,n.useFocus)(),[m,p]=t.useState(i),v=()=>{!m&&(0,u.id)(s)===f&&p(!0)};return t.createElement(d.ObjectLayout,Object.assign({collapsed:m,onCollapserClick:()=>p(!m),onBracketClick:v,onCollapsedClick:()=>{m&&p(!1)}},c))};return In.JsonCrdtObjectLayout=r,In}var li={},Ou;function pr(){return Ou||(Ou=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useRerenderModel=e.useRerender=e.useNodeApi=void 0;const t=M(),d=le(),a=r=>{const{model:o}=(0,d.useJsonCrdt)();return o.api.wrap(r.node)};e.useNodeApi=a;const n=r=>{const o=(0,e.useNodeApi)(r).events;return t.useSyncExternalStore(o.subscribe,o.getSnapshot)};e.useRerender=n;const u=()=>{const{model:r}=(0,d.useJsonCrdt)(),o=r.api;t.useSyncExternalStore(o.subscribe,()=>r.tick)};e.useRerenderModel=u}(li)),li}var Eu;function yp(){if(Eu)return Rn;Eu=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.JsonCrdtValNode=void 0;const e=M(),t=Z(),d=dr(),a=le(),n=Ae(),u=_e(),r=hr(),o=Ke(),s=pr(),c=({node:i})=>{const{render:f}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const m=i.node.node();if(!m)return null;const p=(0,d.nodeRef)(m,i,"");if(!p)return null;const v=e.createElement("span",{className:t.line},f(p));let y="…";if(m.name()==="con"){const b=m.view();y=e.createElement(o.JsonAtom,{value:b})}return e.createElement(n.JsonCrdtRegion,{node:i},e.createElement(r.JsonCrdtObjectLayout,{node:i,property:e.createElement(u.JsonCrdtProperty,{node:i}),collapsedView:y,brackets:["(",")"]},v))};return Rn.JsonCrdtValNode=c,Rn}var Tn={},jn={},ku;function vp(){if(ku)return jn;ku=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.AddKey=void 0;const e=M(),t=kl(),d=ue(),a=Ce(),n=le(),u=({node:r})=>{const{model:o}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),c=e.useCallback((i,f,m)=>{const p=(0,a.createValue)(o,f,m,!0);o.api.wrap(r.node).set({[i]:p})},[r.node]);return e.createElement(t.ObjectInsert,{withType:!0,visible:s,onSubmit:c})};return jn.AddKey=u,jn}var Pn={},Mn={},Au;function wp(){if(Au)return Mn;Au=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.MiniTitle=void 0;const e=M(),t=Y(),d=(0,t.rule)({...t.theme.font.sans.bold,fz:"10px",textTransform:"uppercase",col:t.theme.g(.5),pad:0,mar:0}),a=({component:n="span",style:u,onClick:r,children:o})=>e.createElement(n,{className:d,style:u,onClick:r,children:o});return Mn.MiniTitle=a,Mn}var Nu;function _p(){if(Nu)return Pn;Nu=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.Tombstones=void 0;const e=M(),t=Y(),d=Ee(),a=wp(),n=(0,t.rule)({d:"block",bxz:"border-box",pd:"0 4px 4px 16px",bdrad:"8px",mr:"4px 0 0 -16px",w:"calc(100% + 16px)",bg:t.theme.red(.05)}),u=(0,t.rule)({d:"block",w:"100%",bxz:"border-box",pd:"4px 8px 3px 3px",cur:"default",us:"none"}),r=({tombstones:o})=>{const[s,c]=e.useState(!1),[i]=(0,d.useT)();return o.length?e.createElement("span",{className:n},e.createElement("style",{className:u,onClick:()=>c(f=>!f)},e.createElement(a.MiniTitle,{style:{fontSize:"0.65em",color:t.theme.red(.75)}},o.length+" "+(o.length===1?i("tombstone"):i("tombstones")))),s&&o):null};return Pn.Tombstones=r,Pn}var xu;function Cp(){if(xu)return Tn;xu=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.JsonCrdtObjNode=void 0;const e=M(),t=fr(),d=Z(),a=le(),n=dr(),u=Ae(),r=_e(),o=hr(),s=pr(),c=vp(),i=_p(),f=te(),m=v=>v instanceof t.ConNode&&v.val===void 0,p=({node:v})=>{const{readonly:y}=(0,f.useStyles)(),{render:b}=(0,a.useJsonCrdt)();(0,s.useRerender)(v);const l=[],h=[];return v.node.nodes((w,g)=>{if(!w)return;const _=(0,n.nodeRef)(w,v,g);if(!_)return;const C=e.createElement("span",{key:g,className:d.line},b(_));m(w)?h.push(C):l.push(C)}),e.createElement(u.JsonCrdtRegion,{node:v},e.createElement(o.JsonCrdtObjectLayout,{node:v,property:e.createElement(r.JsonCrdtProperty,{node:v}),collapsedView:!!l.length&&l.length},l,!y&&e.createElement(c.AddKey,{node:v}),!!h.length&&e.createElement(i.Tombstones,{tombstones:h})))};return Tn.JsonCrdtObjNode=p,Tn}var qn={},Bn={},Ru;function Sp(){if(Ru)return Bn;Ru=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.PushElement=void 0;const e=M(),t=Ti(),d=ue(),a=Ce(),n=le(),u=({node:r})=>{const{model:o}=(0,n.useJsonCrdt)(),s=(0,d.useIsFocused)((0,a.id)(r)),c=e.useCallback((i,f)=>{const m=(0,a.createValue)(o,i,f,!0),p=o.api.wrap(r.node);p.set([[p.view().length,m]])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:s,onSubmit:c})};return Bn.PushElement=u,Bn}var Vn={},$n={},Iu;function Ql(){if(Iu)return $n;Iu=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.SwitchAction=void 0;const e=M(),t=Y(),d=Z(),a=lr(),n=(0,t.drule)({w:"20px",h:"20px",bdrad:"50%",svg:{fill:d.blue}}),u=r=>e.createElement(a.Action,Object.assign({},r,{className:n()}),"~");return $n.SwitchAction=u,$n}var Tu;function Op(){if(Tu)return Vn;Tu=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.JsonCrdtExtNode=void 0;const e=M(),t=Ee(),d=Ae(),a=_e(),n=hr(),u=pr(),r=Xl(),o=Ce(),s=Ke(),c=Ql(),i=({node:f,onViewChange:m})=>{const[p]=(0,t.useT)();(0,u.useRerenderModel)();const y=f.node.view();return e.createElement(d.JsonCrdtRegion,{node:f,extension:!0,toolbar:e.createElement(c.SwitchAction,{onClick:m,tooltip:p('Show "vec" node')})},e.createElement(n.JsonCrdtObjectLayout,{node:f,property:e.createElement(a.JsonCrdtProperty,{node:f}),collapsedView:e.createElement(s.JsonAtom,{value:y}),brackets:["(",")"]},e.createElement(r.JsonCrdtConstant,{id:(0,o.id)(f),view:y})))};return Vn.JsonCrdtExtNode=i,Vn}var ju;function Ep(){if(ju)return qn;ju=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.JsonCrdtVecNode=void 0;const e=M(),t=Ee(),d=Z(),a=le(),n=dr(),u=Ae(),r=_e(),o=hr(),s=pr(),c=Sp(),i=te(),f=Op(),m=Ql(),p=({node:v})=>{const[y]=(0,t.useT)(),[b,l]=e.useState(!1),{readonly:h}=(0,i.useStyles)(),{render:w}=(0,a.useJsonCrdt)();(0,s.useRerenderModel)();const g=v.node.isExt();if(g&&!b)return e.createElement(f.JsonCrdtExtNode,{node:v,onViewChange:()=>l(!0)});const _=[];let C=0;return v.node.children(O=>{if(!O)return;const k=(0,n.nodeRef)(O,v,String(C));k&&(_.push(e.createElement("span",{key:O.id.sid+"."+O.id.time,className:d.line},w(k))),C++)}),e.createElement(u.JsonCrdtRegion,{node:v,toolbar:g?e.createElement(m.SwitchAction,{onClick:()=>l(!1),tooltip:y('Show "ext" view')}):void 0},e.createElement(o.JsonCrdtObjectLayout,{node:v,property:e.createElement(r.JsonCrdtProperty,{node:v}),collapsedView:!!_.length&&_.length,brackets:["[","]"],header:e.createElement("span",{style:{opacity:.5,display:"inline-block",margin:"0.25em 0 0 -0.3em"}},"→")},_,!h&&e.createElement(c.PushElement,{node:v})))};return qn.JsonCrdtVecNode=p,qn}var Jn={},Ln={},Pu;function kp(){if(Pu)return Ln;Pu=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.InsertElement=void 0;const e=M(),t=Ti(),d=ue(),a=Ce(),n=le(),u=({node:r,index:o})=>{const{model:s}=(0,n.useJsonCrdt)(),c=(0,d.useIsFocused)((0,a.id)(r)),i=e.useCallback((f,m)=>{const p=(0,a.createValue)(s,f,m);s.api.wrap(r.node).ins(o,[p])},[r.node]);return e.createElement(t.ArrayInsert,{withType:!0,visible:c,onSubmit:i})};return Ln.InsertElement=u,Ln}var Mu;function Ap(){if(Mu)return Jn;Mu=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.JsonCrdtArrNode=void 0;const e=M(),t=Z(),d=le(),a=dr(),n=Ae(),u=_e(),r=hr(),o=pr(),s=kp(),c=te(),i=({node:f})=>{const{readonly:m}=(0,c.useStyles)(),{render:p}=(0,d.useJsonCrdt)();(0,o.useRerender)(f);const v=[];let y=0;return f.node.children(b=>{if(!b)return;const l=(0,a.nodeRef)(b,f,String(y));if(!l)return;l.step=String(y);const h=b.id.sid+"."+b.id.time+"."+y;v.push(e.createElement(e.Fragment,{key:h},!m&&e.createElement(s.InsertElement,{key:h,node:f,index:y}),e.createElement("span",{className:t.line},p(l)))),y++}),e.createElement(n.JsonCrdtRegion,{node:f},e.createElement(r.JsonCrdtObjectLayout,{node:f,property:e.createElement(u.JsonCrdtProperty,{node:f}),collapsedView:!!v.length&&v.length,brackets:["[","]"]},v,!m&&e.createElement(s.InsertElement,{key:f.node.length(),node:f,index:f.node.length()})))};return Jn.JsonCrdtArrNode=i,Jn}var Dn={},Fn={},Un={},di={},fi={},qu;function Np(){return qu||(qu=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi}var Gn={},Bu;function Zl(){if(Bu)return Gn;Bu=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.Selection=void 0;let e=class{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}};return Gn.Selection=e,Gn}var Hn={},Le={},Vu;function $u(){if(Vu)return Le;Vu=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.invokeFirstOnly=Le.applyChange=void 0;const e=(d,a,n,u)=>d.slice(0,a)+u+d.slice(a+n);Le.applyChange=e;const t=()=>{let d=!1;return a=>{if(!d){d=!0;try{a()}finally{d=!1}}}};return Le.invokeFirstOnly=t,Le}var Ju;function xp(){if(Ju)return Hn;Ju=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.StrBinding=void 0;const e=$u(),t=Zl(),d=$u(),a=Vr();let n=class{constructor(r,o){this.str=r,this.editor=o,this.race=(0,e.invokeFirstOnly)(),this.onModelChange=()=>{this.race(()=>{this.syncFromModel(),this.saveSelection()})},this.onchange=(s,c)=>{this.race(()=>{if(s instanceof Array&&s.length>0){const i=this.str();if(!i)return;let f=!0;if(c){let m=this.view;for(let v=0;v<length;v++){const y=s[v],[b,l,h]=y;m=(0,d.applyChange)(m,b,l,h)}const p=this.editor;p.getLength&&m.length!==p.getLength()||m!==p.get()?f=!1:this.view=m}if(f){const m=s.length;try{i.api.transaction(()=>{let p=this.view;for(let v=0;v<m;v++){const y=s[v],[b,l,h]=y;p=(0,d.applyChange)(p,b,l,h),l&&i.del(b,l),h&&i.ins(b,h)}this.view=p}),this.saveSelection();return}catch{}}}this.syncFromEditor()})},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout(()=>{this.race(()=>{try{const s=this.view,c=this.editor;((c.getLength?s.length!==c.getLength():!1)||s!==c.get())&&this.syncFromEditor()}catch{}this._p&&this.pollChanges()})},this.pollingInterval)},this._s=null,this.bind=s=>{this.syncFromModel();const c=this.editor;c.onchange=this.onchange,c.onselection=()=>this.saveSelection(),s&&this.pollChanges(),this._s=this.str().api.onChange.listen(this.onModelChange)},this.unbind=()=>{var s,c,i;this.stopPolling(),(s=this._s)===null||s===void 0||s.call(this),(i=(c=this.editor).dispose)===null||i===void 0||i.call(c)},this.view=r().view(),o.selection=this.selection=new t.Selection}saveSelection(){var r,o,s;const{editor:c,selection:i}=this,f=this.str();if(!f)return;const[m,p,v]=((r=c.getSelection)===null||r===void 0?void 0:r.call(c))||[-1,-1,0],{start:y,end:b}=i,l=Date.now(),h=f.api.model.tick;y===m&&b===p&&(h===i.tick||l-i.ts<3e3)||(i.start=m,i.end=p,i.dir=v,i.ts=l,i.tick=h,i.startId=typeof m=="number"&&(o=f.findId((m??0)-1))!==null&&o!==void 0?o:null,i.endId=typeof p=="number"&&(s=f.findId((p??0)-1))!==null&&s!==void 0?s:null)}syncFromModel(){const r=this.editor,o=this.str();if(!o)return;const s=(this.view=o.view())||"";if(r.ins&&r.del){const c=r.get();if(s===c)return;const i=(0,a.diff)(c,s),f=i.length;let m=0;for(let p=0;p<f;p++){const v=i[p],[y,b]=v,l=b.length;switch(y){case-1:r.del(m,l);break;case 0:m+=l;break;case 1:r.ins(m,b),m+=l;break}}}else{r.set(s);const{selection:c}=this;if(r.setSelection){const i=c.startId?o.findPos(c.startId)+1:-1,f=c.endId?o.findPos(c.endId)+1:-1;r.setSelection(i,f,c.dir)}}}syncFromEditor(){var r;let o=this.view;const s=this.editor.get();if(s===o)return;const c=this.selection,i=c.start===c.end&&(r=c.start)!==null&&r!==void 0?r:void 0,f=(0,a.diffEdit)(o,s,i||0),m=f.length,p=this.str();p&&(p.api.transaction(()=>{let v=0;for(let y=0;y<m;y++){const b=f[y],[l,h]=b;switch(l){case-1:{o=(0,d.applyChange)(o,v,h.length,""),p.del(v,h.length);break}case 0:{v+=h.length;break}case 1:{o=(0,d.applyChange)(o,v,0,h),p.ins(v,h),v+=h.length;break}}}}),this.view=o,this.saveSelection())}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}};return Hn.StrBinding=n,n.bind=(u,r,o)=>{const s=new n(u,r);return s.syncFromModel(),s.bind(o),s.unbind},Hn}var Lu;function Rp(){return Lu||(Lu=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(Np(),e),t.__exportStar(Zl(),e),t.__exportStar(xp(),e)}(di)),di}var zn={},Du;function Ip(){if(Du)return zn;Du=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.InputEditor=void 0;let e=class{constructor(d,a){this.str=d,this.input=a,this.onInput=n=>{this.emitChange(n)},this.onSelectionChange=()=>{this.onselection()},a.addEventListener("input",this.onInput),document.addEventListener("selectionchange",this.onSelectionChange)}get(){return this.input.value}getLength(){return this.input.value.length}set(d){this.input.value=d}ins(d,a){const n=this.getSelection(),u=this.get(),r=u.slice(0,d)+a+u.slice(d);if(this.set(r),n){let[o,s]=n;const c=a.length;o>=d&&(o+=c),s>d&&(s+=c),this.setSelection(o,s,n[2])}}del(d,a){const n=this.getSelection(),u=this.get(),r=u.slice(0,d)+u.slice(d+a);if(this.set(r),n){let[o,s]=n;o>=d&&(o=Math.max(d,o-a)),s>=d&&(s=Math.max(d,s-a)),this.setSelection(o,s,n[2])}}getSelection(){const d=this.input,{selectionStart:a,selectionEnd:n,selectionDirection:u}=d;return[typeof a=="number"?a:-1,typeof n=="number"?n:-1,u==="backward"?-1:u==="forward"?1:0]}setSelection(d,a,n){const u=this.input;u.selectionStart=d>-1?d:null,u.selectionEnd=a>-1?a:null,u.selectionDirection=n===-1?"backward":n===1?"forward":"none"}emitChange(d){var a,n;if(!d.isComposing){switch(d.inputType){case"insertText":{const u=d.data;if(!u||u.length!==1)break;const{selectionStart:r,selectionEnd:o}=this.input;if(r===null||o===null||r!==o||r<=0)break;const s=this.selection;if(r-u.length!==s.start||typeof s.end!="number"||typeof s.end!="number")break;const c=s.end-s.start,i=[s.start,c,u];this.onchange([i]);return}case"deleteContentBackward":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const o=u===r?[u-1,1,""]:[u,r-u,""];this.onchange([o]);return}case"deleteContentForward":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const o=u===r?[u,1,""]:[u,r-u,""];this.onchange([o]);return}case"deleteByCut":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number"||u===r)break;const o=Math.min(u,r),s=Math.max(u,r),c=this.str().view(),f=this.input.value;if(c.length-f.length!==s-o)break;const m=[o,s-o,""];this.onchange([m]);return}case"insertFromPaste":{const{start:u,end:r}=this.selection;if(typeof u!="number"||typeof r!="number")break;const o=Math.min(u,r),s=Math.max(u,r),c=this.str().view(),i=this.input,f=i.value,m=Math.max((a=i.selectionStart)!==null&&a!==void 0?a:0,(n=i.selectionEnd)!==null&&n!==void 0?n:0);if(m<=o)break;const p=s-o,v=f.slice(o,m);if(f.length!==c.length-p+v.length)return;const y=[o,p,v];this.onchange([y]);return}}this.onchange()}}dispose(){this.input.removeEventListener("input",this.onInput),document.removeEventListener("selectionchange",this.onSelectionChange)}};return zn.InputEditor=e,zn}var Fu;function Tp(){if(Fu)return Un;Fu=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.bind=void 0;const e=Rp(),t=Ip(),d=(a,n,u)=>{const r=new t.InputEditor(a,n),o=new e.StrBinding(a,r);return o.syncFromModel(),o.bind(u),o.unbind};return Un.bind=d,Un}var Wn={},Uu;function jp(){if(Uu)return Wn;Uu=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.SubmitAction=void 0;const e=M(),t=lr(),d=a=>e.createElement(t.Action,Object.assign({},a),"→");return Wn.SubmitAction=d,Wn}var Gu;function Pp(){if(Gu)return Fn;Gu=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.StrEdit=void 0;const e=M(),t=Y(),d=Tp(),a=ur(),n=Ee(),u=Z(),r=xi(),o=Tr(),s=jr(),c=jp(),i=le(),f=({node:m,onCancel:p,onDone:v})=>{const[y]=(0,n.useT)(),b=e.useRef(),{model:l}=(0,i.useJsonCrdt)(),[h,w]=e.useMemo(()=>{const O=l.clone();O.api.flush();const k=O.index.get(m.node.id),S=O.api.wrap(k);return[O,S]},[]),g=e.useSyncExternalStore(w.events.subscribe,w.events.getSnapshot);e.useEffect(()=>{if(!b.current)return;const O=(0,d.bind)(()=>w,b.current);return()=>{O()}},[l]);const _=()=>{if(!!h.api.builder.patch.ops.length){const k=h.api.flush();l.applyLocalPatch(k)}v()},C=(0,o.inputStyle)(t.theme,!t.theme.isLight,'""');return C.margin="-3px -3px -3px -5px",C.padding="2px 4px",C.border=`1px solid ${t.theme.g(.85)}`,e.createElement("span",{className:u.input,style:C},e.createElement(a.FlexibleInput,{focus:!0,inp:O=>{b.current=O},value:g,multiline:!0,uncontrolled:!0,typebefore:'"',typeahead:'"',maxWidth:800,onSubmit:_,onFocus:O=>(0,r.selectOnFocus)(O.target),onCancel:()=>{p&&p()}}),e.createElement(s.CancelAction,{onClick:p,tooltip:y("Cancel")}),e.createElement("span",{className:u.bottomRightActionPos},e.createElement(c.SubmitAction,{onClick:_,tooltip:y("Done (Ctrl + Enter)")})))};return Fn.StrEdit=f,Fn}var Hu;function Mp(){if(Hu)return Dn;Hu=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.JsonCrdtStrNode=void 0;const e=M(),t=Y(),d=Ee(),a=Ae(),n=_e(),u=Ke(),r=te(),o=ue(),s=Ce(),c=Z(),i=Pp(),f=(0,t.rule)({d:"inline-block",pos:"relative",cur:"pointer",bdrad:"2px"}),m=(0,t.rule)({out:"1px dotted transparent","&:hover":{out:`1px dotted ${t.theme.color.sem.blue[0]}`},[`&:hover .${c.tooltip.trim()}`]:{d:"inline-block"}}),p=({node:v})=>{const[y]=(0,d.useT)(),{formal:b,readonly:l}=(0,r.useStyles)(),{focused:h}=(0,o.useFocus)(),[w,g]=e.useState(!1),_=h===(0,s.id)(v);return e.createElement(a.JsonCrdtRegion,{node:v,editing:w},e.createElement(n.JsonCrdtProperty,{node:v}),w?e.createElement(i.StrEdit,{node:v,onCancel:()=>g(!1),onDone:()=>g(!1)}):e.createElement("span",{className:f+(_&&!l?m:""),onClick:_&&!l?()=>g(!0):void 0},e.createElement(u.JsonAtom,{value:v.node.view()}),!l&&e.createElement("span",{className:c.tooltip},y("Edit"))),!!b&&",")};return Dn.JsonCrdtStrNode=p,Dn}var Kn={},zu;function qp(){if(zu)return Kn;zu=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.JsonCrdtBinNode=void 0;const e=M(),t=Ae(),d=_e(),a=Ke(),n=te(),u=({node:r})=>{const{formal:o}=(0,n.useStyles)();return e.createElement(t.JsonCrdtRegion,{node:r},e.createElement(d.JsonCrdtProperty,{node:r}),e.createElement(a.JsonAtom,{value:r.node.view()}),!!o&&",")};return Kn.JsonCrdtBinNode=u,Kn}var Wu;function Bp(){if(Wu)return xt;Wu=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.ClickableJsonCrdt=void 0;const e=M(),t=le(),d=te(),a=dr(),n=Nl(),u=ue(),r=fr(),o=gp(),s=yp(),c=Cp(),i=Ep(),f=Ap(),m=Mp(),p=qp(),v=b=>b.node instanceof r.ConNode?e.createElement(o.JsonCrdtConNode,{node:b}):b.node instanceof r.ValNode?e.createElement(s.JsonCrdtValNode,{node:b}):b.node instanceof r.ObjNode?e.createElement(c.JsonCrdtObjNode,{node:b}):b.node instanceof r.StrNode?e.createElement(m.JsonCrdtStrNode,{node:b}):b.node instanceof r.VecNode?e.createElement(i.JsonCrdtVecNode,{node:b}):b.node instanceof r.ArrNode?e.createElement(f.JsonCrdtArrNode,{node:b}):b.node instanceof r.BinNode?e.createElement(p.JsonCrdtBinNode,{node:b}):"∅",y=b=>{const{model:l,compact:h,readonly:w,showRoot:g,onFocus:_}=b,[C,O]=e.useState(0);e.useEffect(()=>{const S=l.api.onReset.listen(()=>O(E=>E+1));return()=>S()},[l]);const k=e.useMemo(()=>(0,a.nodeRef)(g?l.root:l.root.node(),null,""),[l,C]);return e.createElement(d.context.Provider,{value:{compact:h,readonly:w}},e.createElement(t.context.Provider,{value:{model:l,render:v}},e.createElement(u.FocusProvider,{onFocus:_},!!k&&e.createElement(n.Root,{key:C},v(k)))))};return xt.ClickableJsonCrdt=y,xt}var Ku;function Vp(){return Ku||(Ku=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(xl(),e),t.__exportStar(Bp(),e)}(Yr)),Yr}var $p=Vp();function _i({gridSessionId:e,usersReplicaId:t,chatbotName:d="Grid Assistant",initialMessage:a,open:n,onClose:u,agentRegistrationId:r}){const[o,s]=P.useState(),c=zd(o),i={concreteType:"org.sagebionetworks.repo.model.agent.GridAgentSessionContext",gridSessionId:e,usersReplicaId:t};return j.jsx(uf,{open:n,onClose:u,title:d,children:j.jsx(Wd,{agentRegistrationId:r,chatbotName:d,initialMessage:a,sessionContext:i,textboxPositionOffset:"16px",hideTitle:!0,showAccessLevelMenu:!1,defaultAgentAccessLevel:Dd.WRITE_YOUR_PRIVATE_DATA,externalSession:o,setExternalSession:s,externalChatState:c})})}try{_i.displayName="GridAgentChat",_i.__docgenInfo={description:"",displayName:"GridAgentChat",props:{gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}},usersReplicaId:{defaultValue:null,description:"",name:"usersReplicaId",required:!0,type:{name:"number"}},chatbotName:{defaultValue:{value:"Grid Assistant"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},agentRegistrationId:{defaultValue:null,description:"Optional ID to use a different agent registered in Synapse",name:"agentRegistrationId",required:!1,type:{name:"string"}}}}}catch{}function Or(e,t){switch(e.type){case"CREATE":return t==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const d=t==="undo"?e.previousValue:e.newValue;return d?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:d}:null}case"DELETE":return t==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function kr(e=[],t){const[d,a]=P.useState(e),n=P.useCallback(c=>{a(i=>{const f=[...i,c];return t&&f.length>t&&f.shift(),f})},[t]),u=P.useCallback(()=>{if(d.length===0)return;const c=d[d.length-1];return a(i=>i.slice(0,-1)),c},[d]),r=P.useCallback(()=>d[d.length-1],[d]),o=P.useCallback(()=>{a([])},[]),s=P.useCallback(()=>d.length===0,[d]);return{stack:d,push:n,pop:u,clear:o,peek:r,size:d.length,isEmpty:s}}try{kr.displayName="useStack",kr.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}function Ci(e){return{type:"COMPOSITE",actions:e}}const Jp=100,Lp=100;function Si(e){const t=kr([],Jp),d=kr([],Lp),[a,n]=P.useState(null),[u,r]=P.useState(null),o=!!a,s=!!u,c=S=>{n(S.currentTarget)},i=S=>{r(S.currentTarget)},f=()=>n(null),m=()=>r(null),p=P.useCallback(()=>{if(t.isEmpty())return null;const S=t.peek();let E,A=0;if(S.type==="COMPOSITE"){E="COMPOSITE";for(let N=t.stack.length-1;N>=0&&t.stack[N].type==="COMPOSITE";N--)A++}else{E=S.type;for(let N=t.stack.length-1;N>=0&&t.stack[N].type===E;N--)A++}return{lastType:E,sameTypeCount:A,totalActions:t.size}},[t]),v=P.useCallback(()=>{if(d.isEmpty())return null;const S=d.peek();let E,A=0;if(S.type==="COMPOSITE")E="COMPOSITE",A=1;else{E=S.type;for(let N=d.stack.length-1;N>=0&&d.stack[N].type===E;N--)A++}return{lastType:E,sameTypeCount:A,totalActions:d.size}},[d]),y=p(),b=v(),l=P.useCallback(()=>{if(t.isEmpty())return;const S=t.pop();if(S)if(S.type==="COMPOSITE"){for(let E=S.actions.length-1;E>=0;E--){const A=S.actions[E],N=Or(A,"undo");N&&e(N)}d.push(S)}else{const E=Or(S,"undo");if(!E)return;e(E),d.push(S)}f()},[e,t,d]),h=P.useCallback(()=>{if(d.isEmpty())return;const S=d.pop();if(S)if(S.type==="COMPOSITE"){for(let E=0;E<S.actions.length;E++){const A=S.actions[E],N=Or(A,"redo");N&&e(N)}t.push(S)}else{const E=Or(S,"redo");if(!E)return;e(E),t.push(S)}m()},[d,t,e]);P.useEffect(()=>{const S=E=>{E.ctrlKey&&E.key==="z"&&!E.shiftKey||E.metaKey&&E.key==="z"&&!E.shiftKey?(E.preventDefault(),l()):(E.ctrlKey&&E.key==="y"||E.ctrlKey&&E.shiftKey&&E.key==="z"||E.metaKey&&E.shiftKey&&E.key==="z")&&(E.preventDefault(),h())};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[l,h]);const w=S=>{t.push(S)},g=()=>t.clear(),_=()=>d.clear(),C=(S,E,A)=>{_();const N=[];for(const x of S){const I=x.fromRowIndex,R=x.toRowIndex;if(x.type==="CREATE")for(let T=I;T<R;T++){const q=A[T];N.push({type:"CREATE",rowIndex:T,newValue:q})}if(x.type==="UPDATE"){const T=E.slice(I,R);A.slice(I,R).forEach((B,$)=>{const L=T[$],F=I+$;N.push({type:"UPDATE",rowIndex:F,previousValue:L,newValue:B})})}x.type==="DELETE"&&E.slice(I,R).forEach((q,B)=>{N.push({type:"DELETE",rowIndex:I+B,previousValue:q})})}N.length===1?w(N[0]):N.length>1&&w(Ci(N))},O=j.jsxs(j.Fragment,{children:[j.jsxs(Ue,{variant:"outlined","aria-controls":o?"undo-menu":void 0,"aria-haspopup":"true",onClick:c,disabled:!y,endIcon:j.jsx(Wi,{}),children:["Undo ",y&&`(${y.totalActions})`]}),j.jsx(Gi,{id:"undo-menu",anchorEl:a,open:o,onClose:f,children:y?j.jsxs(ir,{onClick:l,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(ir,{disabled:!0,children:"No actions to undo"})})]}),k=j.jsxs(j.Fragment,{children:[j.jsxs(Ue,{variant:"outlined","aria-controls":s?"redo-menu":void 0,"aria-haspopup":"true",onClick:i,disabled:!b,endIcon:j.jsx(Wi,{}),children:["Redo ",b&&`(${b.totalActions})`]}),j.jsx(Gi,{id:"redo-menu",anchorEl:u,open:s,onClose:m,children:b?j.jsxs(ir,{onClick:h,children:["Redo last ",b.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(ir,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:l,addToUndoStack:w,clearUndoStack:g,addOperationsToUndoStack:C,undoUI:O,undoTotalActions:y?y.totalActions:0,redoPreview:b,redoUI:k,redoTotalActions:b?b.totalActions:0,handleRedo:h,clearRedoStack:_}}try{Ci.displayName="batchGridActions",Ci.__docgenInfo={description:"Helper to batch multiple single actions into a composite action",displayName:"batchGridActions",props:{}}}catch{}try{Si.displayName="useGridUndoRedo",Si.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}function Oi(e){const{inputValue:t,onInputValueChange:d,onConfirmInput:a=we,onSessionChange:n=we,onReplicaChange:u=we}=e,{data:r}=lf({}),{mutate:o}=df({onSuccess:(c,i)=>{ve(`Successfully deleted grid session ${i}`,"success"),n(null),u(null)},onError:c=>{ve(c.reason,"danger")}}),s=P.useMemo(()=>(r==null?void 0:r.pages.flatMap(c=>c.page||[]))||[],[r]);return j.jsx(pf,{freeSolo:!0,fullWidth:!0,renderInput:c=>j.jsx(Fd,{...c,label:"SQL Query or Session ID",placeholder:"Enter a SQL query, RecordSet ID, or session ID"}),options:s,getOptionLabel:c=>typeof c=="string"?c:c.sessionId||"",value:t,onInputChange:(c,i)=>{d(i)},onChange:(c,i)=>{i&&typeof i=="object"?(d(i.sessionId||""),a(i.sessionId||"")):d(i||"")},onKeyDown:c=>{c.key==="Enter"&&a(t)},renderOption:(c,i)=>P.createElement(ir,{...c,key:i.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs(ee,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx(ee,{size:{xs:6,md:2},children:i.sessionId}),j.jsx(ee,{size:{xs:5,md:2},children:i.sourceEntityId}),j.jsx(ee,{size:{xs:0,md:6},children:i.gridJsonSchema$Id??"No schema"}),j.jsx(ee,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:f=>{f.stopPropagation(),o(i.sessionId)},children:"🗑️"})})]}))})}try{Oi.displayName="GridSessionSelectionField",Oi.__docgenInfo={description:"Utility form field to pick the grid session from existing sessions. Currently, for testing/demo purposes only.",displayName:"GridSessionSelectionField",props:{inputValue:{defaultValue:null,description:"",name:"inputValue",required:!0,type:{name:"string"}},onInputValueChange:{defaultValue:null,description:"",name:"onInputValueChange",required:!0,type:{name:"(value: string) => void"}},onConfirmInput:{defaultValue:null,description:"",name:"onConfirmInput",required:!1,type:{name:"(value: string) => void"}},onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}}}}}catch{}function Dp(){const{mutateAsync:e}=hf(),{synapseClient:t}=We();return be({mutationFn:async({createGridRequest:d,sessionId:a})=>{if(!(d||a))throw new Error("Must provide either a CreateGridRequest or sessionId to create or get a grid session.");if(d){const n=await e(d);return console.log("Grid session started:",n),n.gridSession}return console.log(`Joining existing session ID: ${a}`),await t.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:a})}})}function Fp(e){const{mutateAsync:t}=Dp(),{mutateAsync:d}=ff();return be({...e,mutationFn:async({createGridRequest:a,sessionId:n})=>{if(!(a||n))throw new Error("Must provide either a SQL query, recordSetId, or sessionId to initialize grid connection.");const u=await t({createGridRequest:a,sessionId:n}),r=u.sessionId;try{const o=await d(r);console.log("Replica created:",o);const s=o.replica;return{session:u,replica:s}}catch(o){throw new Error("Error starting session:",{cause:o})}}})}const Ei=P.forwardRef((e,t)=>{const{show:d=!1,onSessionChange:a=we,onReplicaChange:n=we}=e,[u,r]=P.useState(""),{mutate:o}=Fp({onMutate(c){console.debug("Starting grid session with args:",c)},onSuccess({session:c,replica:i}){a(c),n(i.replicaId)},onError(c){const i=c&&typeof c=="object"&&"message"in c&&typeof c.message=="string"?c.message:"An error occurred";ve(i,"danger")}}),s=function(c){o(Up(c))};return P.useImperativeHandle(t,()=>({handleStartSession:c=>{o({createGridRequest:c})},handleLoadSession:c=>{o({sessionId:c})}}),[o]),d?j.jsxs(ee,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx(ee,{size:{xs:12},sx:{position:"relative"},children:j.jsx(Oi,{inputValue:u,onInputValueChange:r,onConfirmInput:s,onSessionChange:a,onReplicaChange:n})}),j.jsx(ee,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(ll,{color:"primary",variant:"contained",onClick:()=>{s(u)},children:"Start Grid Session"})})]}):null});function Up(e){const t=ef(e);if(t.type=="unknown")throw new Error("Unknown input type, please provide a valid SQL query, Synapse ID, or session ID.");switch(t.type){case"empty":throw new Error("Input cannot be empty.");case"sql":return{createGridRequest:{initialQuery:{sql:t.input},concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}};case"sessionId":return{sessionId:t.input};case"recordSetId":return{createGridRequest:{recordSetId:t.input,concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest"}}}}try{Ei.displayName="StartGridSession",Ei.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},show:{defaultValue:null,description:"",name:"show",required:!1,type:{name:"boolean"}}}}}catch{}function Gp(e){const t=P.useMemo(()=>e?e.api.subscribe:()=>we,[e]),d=P.useCallback(()=>e?e.api.getSnapshot():null,[e]);return P.useSyncExternalStore(t,d)}function Hp(){const{synapseClient:e}=We();return be({mutationFn:async({sessionId:t,replicaId:d})=>{const{presignedUrl:a}=await e.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:t,createGridPresignedUrlRequest:{gridSessionId:t,replicaId:d}});return a}})}class mr{constructor(t){H(this,"typeCode");this.typeCode=t}getJson(){throw new Error("Method should be implemented by subclass.")}}const ed=8;class td extends mr{constructor(d,a){super(ed);H(this,"methodName");H(this,"payload");this.methodName=d,this.payload=a}getMethodName(){return this.methodName}getPayload(){return this.payload}getJson(){const d=[this.typeCode,this.methodName];return this.payload!==void 0&&d.push(this.payload),d}}const nd=0;class zp extends mr{constructor(d,a,n){super(nd);H(this,"requestId");H(this,"methodName");H(this,"payload");this.requestId=d,this.methodName=a,this.payload=n}getJson(){const d=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&d.push(this.payload),d}}const rd=4;class sd extends mr{constructor(d,a){super(rd);H(this,"subscriptionId");H(this,"payload");this.subscriptionId=d,this.payload=a}getPayload(){return this.payload}getJson(){return[this.typeCode,this.subscriptionId,this.payload]}}const id=5;class od extends mr{constructor(d,a){super(id);H(this,"subscriptionId");H(this,"payload");this.subscriptionId=d,this.payload=a}getSubscriptionId(){return this.subscriptionId}getPayload(){return this.payload}getJson(){const d=[this.typeCode,this.subscriptionId];return this.payload!==void 0&&d.push(this.payload),d}}const cd=1;class cr extends mr{constructor(d,a,n){super(cd);H(this,"requestId");H(this,"methodName");H(this,"payload");this.requestId=d,this.methodName=a,this.payload=n}setRequestId(d){this.requestId=d}getJson(){const d=[this.typeCode,this.requestId,this.methodName];return this.payload!==void 0&&d.push(this.payload),d}}class Wp{static fromJson(t){if(!Array.isArray(t))throw new Error("Invalid JSON-Rx message: not an array");const d=t[0];if(typeof d!="number")throw new Error(`Invalid JSON-Rx message: type code is not a number, received ${d}`);switch(d){case nd:{const[a,n,u,r]=t;return new zp(n,u,r)}case cd:{const[a,n,u,r]=t;return new cr(n,u,r)}case rd:{const[a,n,u]=t;return new sd(n,u)}case id:{const[a,n,u]=t;return new od(n,u)}case ed:{const[a,n,u]=t;return new td(n,u)}default:throw new Error(`Invalid JSON-Rx message: unknown type code ${d}`)}}}const Kp=Math.pow(2,31)-1;class Yp{constructor(){H(this,"counter");this.counter=1}getNext(){const t=this.counter;return this.counter+=1,this.counter>Kp&&(this.counter=1),t}}var hi={},pi={},Yu;function Xp(){return Yu||(Yu=1,Object.defineProperty(pi,"__esModule",{value:!0})),pi}var Yn={},Xn={},De={},Xu;function $r(){return Xu||(Xu=1,Object.defineProperty(De,"__esModule",{value:!0}),De.hasBuffer=De.alphabet=void 0,De.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",De.hasBuffer=typeof ae.Buffer=="function"&&typeof ae.Buffer.from=="function"),De}var Qn={},Zn={},Qu;function Qp(){if(Qu)return Zn;Qu=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.flatstr=void 0;const e=t=>t;return Zn.flatstr=e,Zn}var Zu;function Zp(){if(Zu)return Qn;Zu=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.createToBase64=void 0;const e=Qp(),t=$r(),d=(a=t.alphabet,n="=")=>{if(a.length!==64)throw new Error("chars must be 64 characters long");const u=a.split(""),r=[];for(const c of u)for(const i of u){const f=(0,e.flatstr)(c+i);r.push(f)}const o=n,s=(0,e.flatstr)(n+n);return(c,i)=>{let f="";const m=i%3,p=i-m;for(let v=0;v<p;v+=3){const y=c[v],b=c[v+1],l=c[v+2],h=y<<4|b>>4,w=(b&15)<<8|l;f+=r[h]+r[w]}if(!m)return f;if(m===1){const v=c[p];f+=r[v<<4]+s}else{const v=c[p],y=c[p+1],b=v<<4|y>>4,l=(y&15)<<2;f+=r[b]+u[l]+o}return f}};return Qn.createToBase64=d,Qn}var el;function ad(){if(el)return Xn;el=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.toBase64=void 0;const e=$r(),d=(0,Zp().createToBase64)();return Xn.toBase64=e.hasBuffer?a=>{const n=a.length;return n<=48?d(a,n):ae.Buffer.from(a).toString("base64")}:a=>d(a,a.length),Xn}var tl;function e1(){if(tl)return Yn;tl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.encode=void 0;const t=J.__importStar(Ye()),d=z(),a=ad(),n=(o,s)=>{const c=s.sid;return c===o?s.time:[c,s.time]},u=(o,s)=>{const c=n(o,s);return Array.isArray(c)?(c.push(s.span),c):[c,s.span]},r=o=>{const s=o.getId();if(!s)throw new Error("PATCH_EMPTY");const c=s.sid,i=s.time,f=c===1?[i]:[[c,i]],m=o.meta;m!==void 0&&f.push(m);const p=[f];for(const v of o.ops)if(v instanceof t.NewConOp){const y=v.val;y instanceof d.Timestamp?p.push([0,n(c,y),!0]):y===void 0?p.push([0]):p.push([0,y])}else if(v instanceof t.NewValOp)p.push([1]);else if(v instanceof t.NewObjOp)p.push([2]);else if(v instanceof t.NewVecOp)p.push([3]);else if(v instanceof t.NewStrOp)p.push([4]);else if(v instanceof t.NewBinOp)p.push([5]);else if(v instanceof t.NewArrOp)p.push([6]);else if(v instanceof t.InsValOp)p.push([9,n(c,v.obj),n(c,v.val)]);else if(v instanceof t.InsObjOp){const y=[];for(const[l,h]of v.data)y.push([l,n(c,h)]);const b=[10,n(c,v.obj),y];p.push(b)}else if(v instanceof t.InsVecOp){const y=[];for(const[l,h]of v.data)y.push([l,n(c,h)]);const b=[11,n(c,v.obj),y];p.push(b)}else if(v instanceof t.InsStrOp){const y=[12,n(c,v.obj),n(c,v.ref),v.data];p.push(y)}else if(v instanceof t.InsBinOp){const y=[13,n(c,v.obj),n(c,v.ref),(0,a.toBase64)(v.data)];p.push(y)}else if(v instanceof t.InsArrOp){const y=[];for(const l of v.data)y.push(n(c,l));const b=[14,n(c,v.obj),n(c,v.ref),y];p.push(b)}else if(v instanceof t.UpdArrOp){const y=[15,n(c,v.obj),n(c,v.ref),n(c,v.val)];p.push(y)}else if(v instanceof t.DelOp){const y=[16,n(c,v.obj),v.what.map(b=>u(c,b))];p.push(y)}else if(v instanceof t.NopOp){const y=[17],b=v.len;b>1&&y.push(b),p.push(y)}return p};return Yn.encode=r,Yn}var er={},tr={},nr={},nl;function t1(){if(nl)return nr;nl=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.bufferToUint8Array=void 0;const e=t=>new Uint8Array(t.buffer,t.byteOffset,t.length);return nr.bufferToUint8Array=e,nr}var rr={},rl;function n1(){if(rl)return rr;rl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.createFromBase64=void 0;const e=$r(),t="=",d=(a=e.alphabet,n=!1)=>{if(a.length!==64)throw new Error("chars must be 64 characters long");let u=0;for(let o=0;o<a.length;o++)u=Math.max(u,a.charCodeAt(o));const r=[];for(let o=0;o<=u;o+=1)r[o]=-1;for(let o=0;o<a.length;o++)r[a.charCodeAt(o)]=o;return o=>{if(!o)return new Uint8Array(0);let s=o.length;if(n){const y=s%4;y===2?(o+="==",s+=2):y===3&&(o+="=",s+=1)}if(s%4!==0)throw new Error("Base64 string length must be a multiple of 4");const c=o[s-1]!==t?s:s-4;let i=(s>>2)*3,f=0;o[s-2]===t?(f=2,i-=2):o[s-1]===t&&(f=1,i-=1);const m=new Uint8Array(i);let p=0,v=0;for(;v<c;v+=4){const y=r[o.charCodeAt(v)],b=r[o.charCodeAt(v+1)],l=r[o.charCodeAt(v+2)],h=r[o.charCodeAt(v+3)];if(y<0||b<0||l<0||h<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4,m[p+1]=b<<4|l>>2,m[p+2]=l<<6|h,p+=3}if(f===2){const y=r[o.charCodeAt(c)],b=r[o.charCodeAt(c+1)];if(y<0||b<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4}else if(f===1){const y=r[o.charCodeAt(c)],b=r[o.charCodeAt(c+1)],l=r[o.charCodeAt(c+2)];if(y<0||b<0||l<0)throw new Error("INVALID_BASE64_STRING");m[p]=y<<2|b>>4,m[p+1]=b<<4|l>>2}return m}};return rr.createFromBase64=d,rr}var sl;function r1(){if(sl)return tr;sl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.fromBase64=void 0;const e=t1(),t=$r(),d=n1(),a=t.hasBuffer?u=>(0,e.bufferToUint8Array)(ae.Buffer.from(u,"base64")):null,n=(0,d.createFromBase64)();return tr.fromBase64=a?u=>u.length>48?a(u):n(u):n,tr}var il;function s1(){if(il)return er;il=1,Object.defineProperty(er,"__esModule",{value:!0}),er.decode=void 0;const e=r1(),t=z(),d=qr(),a=(r,o)=>Array.isArray(o)?new t.Timestamp(o[0],o[1]):new t.Timestamp(r,o),n=(r,o)=>o.length===3?new t.Timespan(o[0],o[1],o[2]):new t.Timespan(r,o[0],o[1]),u=r=>{const o=r[0],s=o[0],c=Array.isArray(s)?new t.ClockVector(s[0],s[1]):new t.ServerClockVector(1,s),i=c.sid;c.time;const f=new d.PatchBuilder(c),m=r.length;for(let v=1;v<m;v++){const y=r[v];switch(y[0]){case 0:{const[,b,l]=y;f.con(l?a(i,b):b);break}case 1:{f.val();break}case 2:{f.obj();break}case 3:{f.vec();break}case 4:{f.str();break}case 5:{f.bin();break}case 6:{f.arr();break}case 9:{f.setVal(a(i,y[1]),a(i,y[2]));break}case 10:{const b=a(i,y[1]),l=[],h=y[2],w=h.length;for(let g=0;g<w;g++){const[_,C]=h[g];l.push([_,a(i,C)])}f.insObj(b,l);break}case 11:{const b=a(i,y[1]),l=[],h=y[2],w=h.length;for(let g=0;g<w;g++){const[_,C]=h[g];l.push([_,a(i,C)])}f.insVec(b,l);break}case 12:{f.insStr(a(i,y[1]),a(i,y[2]),y[3]);break}case 13:{f.insBin(a(i,y[1]),a(i,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const b=a(i,y[1]),l=a(i,y[2]),h=y[3],w=[],g=h.length;for(let _=0;_<g;_++)w.push(a(i,h[_]));f.insArr(b,l,w);break}case 15:{const b=a(i,y[1]),l=a(i,y[2]),h=a(i,y[3]);f.updArr(b,l,h);break}case 16:{const b=a(i,y[1]),l=y[2],h=[],w=l.length;for(let g=0;g<w;g++)h.push(n(i,l[g]));f.del(b,h);break}case 17:{f.nop(y[1]||1);break}}}const p=f.patch;return p.meta=o[1],p};return er.decode=u,er}var ol;function i1(){return ol||(ol=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=J;t.__exportStar(Xp(),e),t.__exportStar(e1(),e),t.__exportStar(s1(),e)}(hi)),hi}var Ar=i1();function cl(e){return new TextEncoder().encode(JSON.stringify(e)).length}function o1(e){const t=Ar.decode(e),d=t.getId(),a=t.span();return[[d==null?void 0:d.sid,d.time+a]]}function c1(e,t){if(!e.ops||e.ops.length===0)return[];const d=Ar.encode(e),a=cl(d);if(a<=t)return[d];if(e.ops.length==1)return console.warn(`Patch is too large (${a} B) but cannot be split further since it only contains one operation.`),[d];const n=d[0],u=[];let r=[n];for(let o=1;o<d.length;o+=1){const s=r.length-1;cl([...r,d[o]])>t&&s>0&&(u.push(r),r=[o1(r)]),r.push(d[o])}return r.length>1&&u.push(r),u}var a1=fr(),sr={},al;function u1(){if(al)return sr;al=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.Encoder=void 0;const t=J.__importStar(ke()),d=ad(),a=z();let n=class{encode(r){this.model=r;const o=r.clock;return{time:o.sid===1?o.time:this.cClock(r.clock),root:this.cVal(r.root)}}cClock(r){const o=[],s=r.sid;r.peers.get(s)||o.push([s,r.time]);for(const i of r.peers.values())o.push([i.sid,i.time]);return o}cTs(r){return r.sid===1?r.time:[r.sid,r.time]}cNode(r){if(r instanceof t.ObjNode)return this.cObj(r);if(r instanceof t.ArrNode)return this.cArr(r);if(r instanceof t.StrNode)return this.cStr(r);if(r instanceof t.ValNode)return this.cVal(r);if(r instanceof t.ConNode)return this.cCon(r);if(r instanceof t.BinNode)return this.cBin(r);if(r instanceof t.VecNode)return this.cVec(r);throw new Error("UNKNOWN_NODE")}cObj(r){const o={};return r.nodes((s,c)=>{o[c]=this.cNode(s)}),{type:"obj",id:this.cTs(r.id),map:o}}cVec(r){const o=[],s=r.elements,c=s.length,i=this.model.index;for(let f=0;f<c;f++){const m=s[f];m===void 0?o.push(null):o.push(this.cNode(i.get(m)))}return{type:"vec",id:this.cTs(r.id),map:o}}cArr(r){const o=[],s=r.iterator();let c;for(;c=s();)o.push(this.cArrChunk(c));return{type:"arr",id:this.cTs(r.id),chunks:o}}cArrChunk(r){if(r.del)return{id:this.cTs(r.id),span:r.span};const o=this.model.index;return{id:this.cTs(r.id),value:r.data.map(c=>this.cNode(o.get(c)))}}cStr(r){const o=[],s=r.iterator();let c;for(;c=s();)o.push(this.cStrChunk(c));return{type:"str",id:this.cTs(r.id),chunks:o}}cStrChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:r.data}}cBin(r){const o=[],s=r.iterator();let c;for(;c=s();)o.push(this.cBinChunk(c));return{type:"bin",id:this.cTs(r.id),chunks:o}}cBinChunk(r){return r.del?{id:this.cTs(r.id),span:r.span}:{id:this.cTs(r.id),value:(0,d.toBase64)(r.data)}}cVal(r){return{type:"val",id:this.cTs(r.id),value:this.cNode(r.node())}}cCon(r){const o={type:"con",id:this.cTs(r.id)},s=r.val;return s instanceof a.Timestamp?(o.timestamp=!0,o.value=this.cTs(s)):s!==void 0&&(o.value=s),o}};return sr.Encoder=n,sr}var l1=u1();const d1=30*1024,f1=250;class h1{constructor(t){H(this,"socket");H(this,"model",null);H(this,"messageCounter");H(this,"replicaId");H(this,"verboseEncoder",new l1.Encoder);H(this,"maxPayloadSizeBytes");H(this,"throttledSendPatch");H(this,"onModelCreate",we);H(this,"onGridReady",we);H(this,"onStatusChange",we);H(this,"messageHandler",t=>{var d,a;if(t instanceof sd){const n=t.getPayload();try{const u=Ar.decode(n);this.model?(console.debug("Applying patch from server:",u),(d=this.model)==null||d.applyPatch(u)):(console.debug("Initializing new model from patch:"),console.debug(u.toString()),this.model=a1.Model.fromPatches([u]).fork(this.replicaId),this.onModelCreate(this.model));const r=(a=this.model)==null?void 0:a.api.flush();let o;if((r==null?void 0:r.ops.length)!==0&&(o=Ar.encode(r)),o){const s=new cr(this.messageCounter.getNext(),"patch",o);console.debug("Responding with patch:",s),this.sendMessage(s)}else{const s=this.verboseEncoder.encode(this.model);this.sendSyncMessage(s.time)}}catch(u){console.error("Failed to apply patch or send clock:",u)}}else if(t instanceof od)this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(t instanceof td){const n=t.getMethodName();if(console.debug("Message received from server:",n),n==="ping"&&console.debug("Received ping response from server"),n==="connected"){console.debug("Server ready to receive patches");const u=this.model?this.verboseEncoder.encode(this.model):null;this.sendSyncMessage(u==null?void 0:u.time)}if(n==="error"){console.warn("Error from server:",t.getPayload());return}if(n==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const u=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",u.time);const r=new cr(this.messageCounter.getNext(),"synchronize-clock",u.time);this.sendMessage(r)}}else console.warn("Unexpected WebSocket message format:",t)});const{replicaId:d,url:a,onGridReady:n,onStatusChange:u,onModelCreate:r,maxPayloadSizeBytes:o,socket:s,model:c,patchThrottleMs:i}=t;this.messageCounter=new Yp,this.replicaId=d,this.maxPayloadSizeBytes=o??d1,this.socket=s??new WebSocket(a),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=f=>{typeof f.data=="string"?this.handleMessage(f.data):console.error("Received non-string message data:",f.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=f=>{console.error("WebSocket error:",f)},r&&(this.onModelCreate=r),n&&(this.onGridReady=n),u&&(this.onStatusChange=u),this.model=c||null,this.throttledSendPatch=_f(()=>this.sendPatchImmediate(),i??f1,{leading:!1,trailing:!0})}disconnect(){this.throttledSendPatch.flush(),this.throttledSendPatch.cancel(),this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(t){this.messageHandler(Wp.fromJson(JSON.parse(t)))}sendMessage(t){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",t),this.socket.send(JSON.stringify(t.getJson()))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){this.throttledSendPatch()}sendPatchImmediate(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const t=this.model.api.flush();t&&c1(t,this.maxPayloadSizeBytes).forEach(a=>{console.debug("Sending patch to server:",a);const n=new cr(this.messageCounter.getNext(),"patch",a);this.sendMessage(n)})}sendSyncMessage(t=[]){const d=new cr(this.messageCounter.getNext(),"synchronize-clock",t);this.sendMessage(d)}}function p1(e){const{mutateAsync:t}=Hp(),[d,a]=P.useState(null),n=P.useCallback(()=>{a(null)},[]);return{...be({retry:5,retryDelay:r=>Math.min(r>1?2**r*1e3:1e3,30*1e3),mutationFn:async({replicaId:r,sessionId:o,websocketOptions:s})=>{if(!r)throw new Error("replicaId is required");const c=await t({replicaId:r,sessionId:o});return a(c),new h1({replicaId:r,url:c,...s||{}})},...e}),presignedUrl:d,clearPresignedUrl:n}}function m1(e,t){switch(t.type){case"CONNECT_REQUESTED":{const d=e.connectionParams&&e.connectionParams.replicaId===t.payload.replicaId&&e.connectionParams.sessionId===t.payload.sessionId;return{...e,connectionParams:{replicaId:t.payload.replicaId,sessionId:t.payload.sessionId},hasCompletedInitialSync:d?e.hasCompletedInitialSync:!1,model:d?e.model:null,isConnected:!1,isConnecting:!1,connectionAttemptId:t.payload.attemptId,connectionError:null}}case"CONNECTION_ESTABLISHED":return{...e,websocketInstance:t.payload,isConnecting:!0};case"CONNECTION_OPENED":return{...e,isConnected:!0,isConnecting:!1};case"CONNECTION_CLOSED":return{...e,isConnected:!1,isConnecting:!1};case"GRID_READY":return{...e,hasCompletedInitialSync:!0};case"MODEL_CREATED":return{...e,model:t.payload};case"CONNECTION_ERROR":return{...e,connectionError:t.payload,isConnecting:!1};default:return e}}const b1={model:null,hasCompletedInitialSync:!1,isConnected:!1,isConnecting:!1,connectionParams:null,websocketInstance:null,connectionAttemptId:null,connectionError:null};function g1(){const[e,t]=P.useReducer(m1,b1),d=P.useRef(0),a=P.useRef(null),n=Gp(e.model),u=kf(),{mutateAsync:r,isPending:o,error:s,presignedUrl:c,reset:i,clearPresignedUrl:f}=p1(),m=P.useCallback(l=>{t({type:"MODEL_CREATED",payload:l})},[t]),p=P.useMemo(()=>({onGridReady:()=>t({type:"GRID_READY"}),onStatusChange:l=>t({type:l?"CONNECTION_OPENED":"CONNECTION_CLOSED"}),onModelCreate:m}),[m]),v=P.useCallback((l,h)=>{i(),(!e.connectionParams||e.connectionParams.replicaId!==l||e.connectionParams.sessionId!==h)&&f(),d.current+=1;const g=d.current;t({type:"CONNECT_REQUESTED",payload:{replicaId:l,sessionId:h,attemptId:g}})},[t,e.connectionParams,i,f,d]);P.useEffect(()=>{const{connectionParams:l,connectionAttemptId:h}=e;!l||h===null||e.isConnected||e.isConnecting||o||s||e.connectionError||!u||(a.current=h,r({replicaId:l.replicaId,sessionId:l.sessionId,websocketOptions:{...p,model:e.model}}).then(w=>{if(a.current!==h){w.disconnect();return}t({type:"CONNECTION_ESTABLISHED",payload:w})}).catch(w=>{t({type:"CONNECTION_ERROR",payload:w}),console.error("Failed to establish WebSocket",w)}))},[e,e.connectionParams,e.connectionAttemptId,e.isConnected,e.isConnecting,o,s,u,r,p]);const y=P.useRef(null);P.useEffect(()=>{var w;const l=y.current,h=e.connectionParams;l&&h&&(l.replicaId!==h.replicaId||l.sessionId!==h.sessionId)&&((w=e.websocketInstance)==null||w.disconnect()),y.current=h},[e.connectionParams,e.websocketInstance]),P.useEffect(()=>()=>{var l;(l=e.websocketInstance)==null||l.disconnect(),a.current=null},[e.websocketInstance]);function b(l){if(!l||!l.api.getSnapshot()||!n)return!1;const{columnNames:h,columnOrder:w,rows:g}=n,_=h.length>=1,C=w.length>=1,O=g.length>=0;return _&&C&&O}return{isConnected:e.isConnected,websocketInstance:e.websocketInstance,hasCompletedInitialSync:e.hasCompletedInitialSync,model:e.model,modelSnapshot:n,connect:v,presignedUrl:c,errorEstablishingWebsocketConnection:e.connectionError??s,hasSufficientData:b(e.model)}}var Fe=Br();function y1(e,t,d){var n;let a;return Object.hasOwn(e,t)?a=e[t]:(n=d[t])!=null&&n.isRequired?a=null:a=void 0,a}function v1(e,t,d){const a=e.api.arr(["rows"]),{columnNames:n}=e.api.getSnapshot();switch(t.type){case"CREATE":{const u=n.map(r=>Fe.s.con(y1(t.rowData,r,d)));a==null||a.ins(t.rowIndex,[Fe.s.obj({data:Fe.s.vec(...u),metadata:Fe.s.obj({})})]);break}case"DELETE":a==null||a.del(t.rowIndex,t.count??1);break;case"UPDATE":{Object.entries(t.updatedData).forEach(([u,r])=>{if(u.startsWith("_"))return;const o=n.indexOf(u);if(o!==-1){const s=e.api.vec(["rows",String(t.rowIndex),"data"]);s==null||s.set([[o,Fe.s.con(r)]])}});break}case"SET_SELECTION":{e.api.obj().has("selection")||e.api.obj().add(["selection"],Fe.s.obj({})),e.api.obj(["selection"]).set({[t.replicaId]:Fe.s.con(t.selection)});break}}}function w1(e,t){const d=[];return e.forEach(a=>{if(a.type==="CREATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"CREATE",rowIndex:n,rowData:t[n]});if(a.type==="UPDATE")for(let n=a.fromRowIndex;n<a.toRowIndex;n++)d.push({type:"UPDATE",rowIndex:n,updatedData:t[n]});a.type==="DELETE"&&d.push({type:"DELETE",rowIndex:a.fromRowIndex,count:a.toRowIndex-a.fromRowIndex})}),d}const ul=P.forwardRef(({agentRegistrationId:e,showDebugInfo:t=!1},d)=>{var ge,ie;const[a,n]=P.useState(null),[u,r]=P.useState(null),[o,s]=P.useState(!1),[c,i]=P.useState(null),f=P.useRef(null),{data:m,isLoading:p}=rf();P.useImperativeHandle(d,()=>({initializeGrid:G=>{f.current&&f.current.handleStartSession(G)},loadExistingSession:G=>{f.current&&f.current.handleLoadSession(G)}}),[]);const{isConnected:v,websocketInstance:y,hasCompletedInitialSync:b,model:l,modelSnapshot:h,connect:w,presignedUrl:g,hasSufficientData:_}=g1(),C=P.useRef(null);P.useEffect(()=>{C.current=y},[y]);const O=P.useRef(null);P.useEffect(()=>{if(u==null||!(a!=null&&a.sessionId)){O.current=null;return}const G={replicaId:u,sessionId:a.sessionId},U=O.current;U&&U.replicaId===G.replicaId&&U.sessionId===G.sessionId||(O.current=G,w(u,a.sessionId))},[u,a==null?void 0:a.sessionId,w]),P.useEffect(()=>{l===null&&(i(null),ce(null),se.current&&se.current.setActiveCell(null))},[l]);const k=oh(a),{data:S}=xr(a==null?void 0:a.sourceEntityId,void 0,{enabled:!!(a!=null&&a.sourceEntityId)}),E=(S==null?void 0:S.concreteType)==="org.sagebionetworks.repo.model.table.EntityView",A=P.useMemo(()=>Eh(k??null),[k]),N=v?"Connected":"Disconnected",x=P.useMemo(()=>h?vh(l,h):[],[l,h]),I=P.useCallback(()=>{!v||!C.current||C.current.sendPatch()},[v,C]);P.useEffect(()=>{v&&I()},[v,I]);const R=P.useCallback((G,U)=>{U.forEach(W=>{v1(G,W,A)}),I()},[I,A]),T=(G,U)=>{if(!l){console.error("Model is not initialized");return}if(U=nf(G,x,U),U.length>0){V(),F(U,x,G);const W=w1(U,G);R(l,W)}},q=P.useCallback(G=>{const{selection:U}=G;if(U!=null&&(i(U),l!=null&&u!=null)){const W=mh(U,l);R(l,[{type:"SET_SELECTION",replicaId:u.toString(),selection:W}])}},[R,l,u]),B=P.useCallback(G=>{if(!l){console.error("Model is not initialized");return}G.type==="DELETE"&&se.current&&se.current.setActiveCell(null),R(l,[G])},[l,R]),{undoUI:$,redoUI:L,addOperationsToUndoStack:F,clearRedoStack:V}=Si(B),[Q,ce]=P.useState(null),se=P.useRef(null);return!p&&!(m!=null&&m.isCertified)?j.jsx(mf,{}):j.jsx("div",{children:j.jsxs(ee,{container:!0,spacing:2,children:[j.jsx(ee,{size:{xs:12,xl:8},children:j.jsx(Ei,{ref:f,onSessionChange:n,onReplicaChange:r,show:t})}),j.jsx(ee,{size:{xs:12,xl:4},children:t&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",(a==null?void 0:a.sessionId)||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",u||"No replica created"]}),j.jsxs("p",{children:["Source Entity ID:"," ",(a==null?void 0:a.sourceEntityId)||"No source entity"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",(a==null?void 0:a.gridJsonSchema$Id)||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",g?g.substring(0,30)+(g.length>30?" ... "+g.substring(g.length-10):""):"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:v?"green":"red"},children:N})]})]})}),a&&j.jsxs(j.Fragment,{children:[!_&&j.jsxs(ee,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!a&&j.jsx("p",{children:"Creating grid session..."}),a&&!u&&j.jsx("p",{children:"Setting up real-time sync..."}),a&&u&&!g&&j.jsx("p",{children:"Establishing secure connection..."}),a&&u&&g&&!v&&j.jsx("p",{children:"Connecting to server..."}),v&&!b&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Hd,{numRows:4,numCols:1})]})]}),_&&j.jsxs(j.Fragment,{children:[j.jsx(ee,{size:12,children:j.jsxs(Ud,{direction:"row",spacing:1,sx:{justifyContent:"flex-end"},children:[$,L,j.jsx(Ue,{variant:"outlined",onClick:()=>s(!0),startIcon:j.jsx(Kd,{}),children:"Open chat"}),j.jsx(_i,{agentRegistrationId:e,open:o,onClose:()=>s(!1),gridSessionId:a.sessionId,usersReplicaId:u,chatbotName:"Grid Assistant"}),a.sourceEntityId&&j.jsx(gi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId}),a.sourceEntityId&&j.jsx(yi,{sourceEntityId:a.sourceEntityId,gridSessionId:a.sessionId})]})}),j.jsx(ee,{size:12,children:j.jsx(tf,{gridRef:se,rowValues:x,columnNames:(h==null?void 0:h.columnNames)??[],columnOrder:(h==null?void 0:h.columnOrder)??[],schemaPropertiesInfo:A,entityIsView:E,jsonSchema:k,selectedRowIndex:Q,lastSelection:c,handleChange:T,setSelectedRowIndex:ce,handleSelectionChange:q})}),j.jsx(ee,{size:12,children:Q!==null&&x[Q]&&Array.isArray((ge=x[Q].__validationResults)==null?void 0:ge.allValidationMessages)&&((ie=x[Q].__validationResults)==null?void 0:ie.allValidationMessages.length)>0&&j.jsx(Gd,{variant:"warning",title:"Validation Messages For Selected Row:",isGlobal:!1,description:j.jsx("ul",{children:x[Q].__validationResults.allValidationMessages.map(G=>j.jsx("li",{children:G},G))}),sx:{marginTop:"12px"}})})]}),t&&j.jsxs(ee,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model"}),l?j.jsx($p.ClickableJsonCrdt,{model:l}):"No model available"]})]})]})})});try{ul.displayName="SynapseGrid",ul.__docgenInfo={description:"",displayName:"SynapseGrid",props:{agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}export{Oi as G,ul as S};
