var vc=Object.defineProperty;var wc=(e,c,m)=>c in e?vc(e,c,{enumerable:!0,configurable:!0,writable:!0,value:m}):e[c]=m;var pe=(e,c,m)=>wc(e,typeof c!="symbol"?c+"":c,m);import{j}from"./jsx-runtime-D_zvdyIk.js";import{l as st,bp as _c,cq as Sc,av as xc,S as Ne,bd as ks,aK as Cc,aA as Oc,aC as Rc,s as iu,t as ct,cr as Nc,cs as Ec}from"./useFiles-Bdk-rDlY.js";import{w as is}from"./useDOI-DOXIjdPJ.js";import{u as ft}from"./useMutation-Bbj9coTz.js";import{t as Tc}from"./useEntity-BWFfqTsN.js";import{F as su,C as js,G as Vs}from"./VerificationSubmission-CTjJb3hu.js";import{l as Ic,X as kc}from"./StringUtils-B8-nnzJN.js";import{u as qr}from"./QueryClientProvider-DRK6s_Dv.js";import{u as jc}from"./OrientationBanner-C06D94Hm.js";import{r as z,b as fe}from"./index-BFe7OOCO.js";import"./ErrorPage-CAPub-HS.js";import"./AccessTokenPage-B0OBP2_Q.js";import"./AccountLevelBadges-B2Gh6fSg.js";import"./LastLoginInfo-xfiPw2OX.js";import"./StandaloneLoginForm-Bc8Q77Jf.js";import"./TwoFactorAuthSettingsPanel-CVixmjME.js";import"./TwoFactorEnrollmentForm-VklhPMsA.js";import"./TwoFactorBackupCodes-BtOGIu1B.js";import"./RowSetView-DoL7UZqh.js";import"./CardContainerLogic-wdm7WQp0.js";import{C as As}from"./CardGridWithLinks-Co4nF3ud.js";import"./RowDataTable-CUgLfA4G.js";import"./RowDataTableWithQuery-DV-aJzBs.js";import{f as Vc}from"./DateFormatter-BkO8fN81.js";import{d as Ac}from"./dayjs.min-I_SVux8b.js";import"./MarkdownPopover-RpoDoQj6.js";import"./SkeletonButton-cMRNZ__f.js";import"./SkeletonInlineBlock-CJG5hxVo.js";import{S as Pc}from"./SkeletonTable-vky-mQpv.js";import"./SkeletonParagraph-CpGGXxR9.js";import{d as Et}from"./ToastMessage-BV3snPHA.js";import"./CertificationAnswer-BhHPdo7T.js";import"./ChallengeDetailPage-HFJ8BnY5.js";import"./index-B-alN_QT.js";import"./AvailableEvaluationQueueList-DPx41GKJ.js";import"./ChallengeSubmission-CQBrZ2m3.js";import"./ChangePassword-DFLATdOI.js";import"./ChangePasswordWithToken-BXSNvDzm.js";import{C as Mc}from"./ConfirmationDialog-DXTrv1GJ.js";import"./CookiesNotification-CHEDrdWc.js";import{C as Ps}from"./CTASectionWrapper-CIRAPq07.js";import"./DownloadCartPage-Bm85ubRo.js";import"./ShowDownloadV2-CxXK8rJS.js";import{D as qc}from"./DynamicForm-D3P4nx_0.js";import{W as Dc}from"./WideButton-ySEfm0n7.js";import{B as xe}from"./Box-CteZFSuz.js";import"./EntityBadgeIcons-BjD619Ta.js";import"./EntityFinder-C_giZKqJ.js";import{F as Bc,v as Fc,r as ou}from"./index-CG-3CJHo.js";import{B as Ms,P as Lc}from"./enums-DVP4Sk4u.js";import{d as Ee,a as au}from"./iframe-Bha8qMdA.js";import"./EvaluationCard-CFD2-klJ.js";import"./EvaluationEditorPage-BqmpvVSN.js";import"./ExperimentalMode-B9DVJZL7.js";import{O as Uc}from"./IconSvg-DS7ziQO5.js";import"./FileUpload-RP88jJOp.js";import"./FeaturedDataTabs-De9dZ9an.js";import"./FeaturedToolsList-vhCaimmY.js";import"./DiscussionThread-DcJoG0su.js";import"./ForumPage-CSVvCMR1.js";import{F as $c}from"./FullWidthAlert-DrhjjluB.js";import"./SynapseCardLabel-CWE2BgIs.js";import"./GenericCard-i8mzD-d9.js";import"./HeaderCardV2-SLAUh3DL.js";import"./CardUtils-BoKdz19D.js";import"./Goals-Cdb6wtDx.js";import"./GoalsV2-sQw7eu4b.js";import{G as qs}from"./GoalsV3-B9ze8VB2.js";import"./GoogleMap-DRPgkxAd.js";import"./HasAccessV2-DteFrSlz.js";import"./Icon-CEZW4fyS.js";import"./MarkdownCollapse-DsO5kjej.js";import"./MarkdownEditor-B-6gZxZC.js";import"./MarkdownGithub-CehE7FOY.js";import"./ModalDownload-DDkTDbD0.js";import"./CopyToClipboardInput-DXwstJ8P.js";import"./DialogBase-BkpeHSev.js";import"./WarningDialog-BcYcPiM9.js";import"./ColumnHeader-DCosga88.js";import"./StyledTanStackTable-Dqsoc0sX.js";import"./OAuthAclEditorModal-QA40Ab0N.js";import"./ThemesPlot-DjdQluIO.js";import"./UpsetPlot-B5JS0Ela.js";import"./SynapsePlot-CEfUWZLV.js";import"./Programs-oX1sKaDl.js";import"./TopLevelControls-BqghUhk9.js";import"./ProvenanceGraph-D3zqmQXw.js";import"./ProjectDataAvailability-DQhcsezp.js";import"./QueryContext-sdQU-CUE.js";import"./QueryCount-910fOOXg.js";import"./QueryWrapper-B0FWu2Wh.js";import"./QueryWrapperPlotNav-CQICNpLV.js";import"./RegisterPageLogoutPrompt-D_xQyDDK.js";import"./RenderIfInView-Nu11q2ff.js";import"./Resources-W3nIJd2V.js";import"./AccessRequirementAclEditor-DMv0JeNA.js";import"./RssFeedCards-p-RjEFFg.js";import"./ShowMore-BeiYgOSw.js";import"./StandaloneQueryWrapper-cr4NM9j-.js";import"./LeftRightPanel-DsPn59Y3.js";import"./LightTooltip-Cbz5qUHh.js";import"./StyledFormControl-BTxE9_-m.js";import"./InputSizedButton-DZSrAx5e.js";import"./DropdownSelect-DLVFFiHc.js";import"./SubscriptionItem-Bb-7qNno.js";import"./SubsectionRowRenderer-BSYGAI66.js";import"./SynapseFormWrapper-BIadmuEI.js";import"./SynapseFormSubmissionGrid-BcQRr5xF.js";import"./SynapseTable-BT71VIvT.js";import"./SynapseChat-CS-XpvGj.js";import{T as Xe}from"./Typography-BvT1XRjO.js";import"./TableFeedCards-CYkBghqj.js";import"./TermsAndConditions-7HVJfZxG.js";import"./TextField-CROS1Dky.js";import"./TimelinePlot-CuV14mVA.js";import"./UserBadge-ByDtpf6U.js";import"./UserCardList-Wc1UHTpV.js";import"./UserCardListRotate--Qsxk-O6.js";import"./UserCardListGroups-CuXK9bQD.js";import"./UserOrTeamBadge-D3TdlARA.js";import"./UserProfileLinks-BmOmPtl8.js";import"./EntityHeaderTable-CQ50R3SA.js";import"./AccessRequirementRelatedProjectsList-DKrcAHqI.js";import"./HelpPopover-Cz5EeQSJ.js";import{s as zc}from"./DefaultPropsProvider-DhKH4jS5.js";import{d as ss,B as lu}from"./SynapseConstants-CPxMpVHW.js";import"./SharePageLinkButton-BkY1KO6m.js";import"./SageResourcesPopover-CdzLzFjl.js";import"./RecentPublicationsGrid-C3edsgjS.js";import"./ImageCardGridWithLinks-BYJhVx7w.js";import"./PortalFeatureHighlights-CAelsv1W.js";import{p as uu}from"./SqlFunctions-B8XmRaKt.js";import{u as Gc}from"./index-DDuHxP75.js";import{P as cu}from"./PortalSectionHeader-Bx9IjK_d.js";import{S as vr}from"./Stack-CZIpFnrG.js";import{S as os}from"./Skeleton-E--vr7y2.js";import{F as Wc}from"./Fade-Xf5NEG7w.js";import{C as as}from"./CardMedia-hR6L1lwx.js";import{L as jr}from"./Link-DY_VTRxM.js";import{B as Gt}from"./Button-C0QtNNNQ.js";import{b as Hc}from"./SchemaDrivenAnnotationEditor-ClKtO1ag.js";import{C as Jc}from"./SynapseTableCell-B2qao1Vz.js";import{r as Kc,a as Wt}from"./isArray-Bq1Bv-Mm.js";import{i as Yc}from"./isEqual-BRRciehP.js";import{i as It}from"./_Uint8Array-BmRAF-l6.js";import{g as Xc}from"./_baseIteratee-CbgowUIE.js";import{r as Ht,c as du}from"./index-DZ2PBiP9.js";import{a as Ds}from"./toInteger-Ddxgkesh.js";import{r as Qc}from"./index-Bl_SermX.js";import{r as Zc}from"./index-CR-e9Su5.js";import{A as fu}from"./Autocomplete-GH9vMR45.js";import{T as hu}from"./TextField-BbeBWZ9f.js";import{u as ed}from"./useInfiniteQuery-fZbbZFRp.js";import{n as Tt}from"./useQuery-CHHYNMj4.js";import{G as Se}from"./Grid-BzsiTv5N.js";import{M as yr}from"./MenuItem-DuDcmUCz.js";import{t as td}from"./tslib.es6-Bipx4pcW.js";import{K as Bs}from"./CitationPopoverContent-C6dEjIXs.js";import{M as Fs}from"./Menu-5eR1vFm7.js";import"./fetchWithExponentialTimeout-CXmnpl-T.js";import"./useTimeout-BjZ1pB1q.js";import"./Collapse-DKZz63NR.js";import"./createTheme-r53sen1H.js";import"./useTheme-dw00mKTl.js";import"./useTheme-BVgbn6l0.js";import"./getReactElementRef-CrfOFAx4.js";import"./useForkRef-C3S72d_h.js";import"./_baseUniq-DXFjNF0a.js";import"./_getTag-Dw30EhU3.js";import"./merge-c-k0AbhX.js";import"./_initCloneObject-NVlBGhuH.js";import"./identity-DKeuBCMA.js";import"./createSvgIcon-BlYLmz2K.js";import"./tinycolor-Begke6kS.js";import"./inputBaseClasses-BxOJtLF2.js";import"./calculateFriendlyFileSize-DI3CDhm2.js";import"./CheckCircleTwoTone-CZ1rOWLg.js";import"./InfoTwoTone-DAGfyDTy.js";import"./index-CMkzAbFp.js";import"./index-DYSwa5Xm.js";import"./extendSxProp-BYVH58vt.js";import"./createSimplePaletteValueFilter-BKD40Yni.js";import"./chunk-AYJ5UCUI-D1KYLbuL.js";import"./cloneDeep-CBO0jsPD.js";import"./pickBy-CoFN8YDO.js";import"./isString-DgLVMhvA.js";import"./toString--A387rSg.js";import"./isSymbol-DgpUL_L6.js";import"./pick-BXsLm_3g.js";import"./_baseGet-B34IiA3A.js";import"./_baseSet-Cwmaeoaj.js";import"./hasIn-9PeDx-i5.js";import"./omit-CyL8ky9k.js";import"./_baseSlice-F8doVSIJ.js";import"./useQueries-Ci2OX55Y.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-BK9msdH9.js";import"./index-B3ZoRi4-.js";import"./spreadSx-CwcO6WA9.js";import"./react-D4DcjIMi.js";import"./useMessage-BbszJObp.js";import"./LoadingScreen-Cra6AsMz.js";import"./Backdrop-Bi1domck.js";import"./useSlot-BjGwbouw.js";import"./LinearProgress-Bx8wxTYh.js";import"./DeleteTwoTone-Cv3R34Aq.js";import"./relativeTime-BZgDpjD2.js";import"./Card-BsvBvfSp.js";import"./Paper-cGemMgWu.js";import"./Tooltip-Dx6Egvgv.js";import"./useControlled-D0iW-7vO.js";import"./Grow-DuTgCd74.js";import"./Popper-BO3NETWT.js";import"./ownerDocument-DW-IO8s5.js";import"./isFocusVisible-B8k4qzLc.js";import"./IconButton-RLYr2FEe.js";import"./ButtonBase-BTDiO5jL.js";import"./CircularProgress-tBTi4oIf.js";import"./FormControlLabel-B-PZohGW.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-BY3S1KKy.js";import"./Checkbox-ukFhnKd2.js";import"./SwitchBase-DDkmv9RP.js";import"./mergeSlotProps-CLhLs6iY.js";import"./AccountLevelBadge-Fsw_HIRm.js";import"./index-DR6OCl6S.js";import"./const-BP60AzNb.js";import"./index-D5zGwSlh.js";import"./LoginMethodButton-C0HiufBd.js";import"./Alert-CS4qrGXV.js";import"./Close-BIGKj7ED.js";import"./Dialog-UF7EI0dn.js";import"./DialogContent-BnID3af2.js";import"./Modal-D8Jwwkhl.js";import"./getScrollbarSize-CaCM53D3.js";import"./ownerWindow-HkKU3E4x.js";import"./createChainedFunction-BO_9K8Jh.js";import"./DialogTitle-DHIzTPWi.js";import"./Divider-DwH7ejSJ.js";import"./dividerClasses-iJoxWBPx.js";import"./ConditionalWrapper-CpBCX7_r.js";import"./Avatar-B81EobdY.js";import"./GenericCardIcon-Bu0DNgVq.js";import"./index-M7koxcUX.js";import"./ImageFileHandle-DyFk_-dy.js";import"./CopyToClipboardIcon-DK7yrl8B.js";import"./CreateOrUpdateDoiModal-CN-OXaks.js";import"./ConfirmCloseWithoutSavingDialog-DfnuUUhR.js";import"./JsonSchemaForm-xepV7bV6.js";import"./GridLegacy-DqQ3Bo-v.js";import"./HelpTwoTone-BVNhrBLO.js";import"./InputLabel-Dx-8vfy_.js";import"./FormLabel-Cc7_Sl3b.js";import"./ContentCopy-CzYLCCIW.js";import"./Close-BAIllsKD.js";import"./ArrowUpward-jUDzlMJl.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./groupBy-CzsEdNNA.js";import"./_createAggregator-CLk4e7RG.js";import"./_baseEach-Ch0yoppi.js";import"./_baseMap-MAO9siC0.js";import"./List-PimdfK9j.js";import"./ListItem-Cqeo6QKY.js";import"./isHostComponent-DVu5iVWx.js";import"./isMuiElement-BgenZB_Z.js";import"./listItemButtonClasses-B24itB5K.js";import"./FormHelperText-CEMCIBCl.js";import"./DateTimePicker-D0RC5xyR.js";import"./localizedFormat-DPgNt8qf.js";import"./utc-CkvfhQs5.js";import"./useMobilePicker-DmzIlPTG.js";import"./index-DRzrDJyW.js";import"./index-Chjiymov.js";import"./CSSTransition-DL5bu29-.js";import"./visuallyHidden-Dan1xhjv.js";import"./FormControl-CLZzm45i.js";import"./InputAdornment-GmjF3c7-.js";import"./index-u0VbMJ9T.js";import"./getThemeProps-ugVUIFn4.js";import"./Chip-D6k_dRIo.js";import"./Tabs-DUf561XS.js";import"./debounce-Be36O1Ab.js";import"./KeyboardArrowRight-B4KlkBAh.js";import"./MenuList-Dxjgd3f3.js";import"./Select-CgoA3BkH.js";import"./InputBase-DxzYNUYd.js";import"./Input-DlQJw59M.js";import"./SynapseTableUtils-TteKVdJY.js";import"./useDownloadList-CVY6Mxep.js";import"./useGetEntityChildren-COmfna9s.js";import"./DownloadConfirmationUI-BncSXPUi.js";import"./duration-DXof7ukB.js";import"./SynapseTableConstants-2qH3fDlQ.js";import"./LayersTwoTone-C1V7oURQ.js";import"./DownloadConfirmationUtils-Dk0I8Y7T.js";import"./QueryFilterUtils-GVjTtLq0.js";import"./TableRowSelectionState-BTkr2mr1.js";import"./QueryWrapperErrorBoundary-Ch7APidq.js";import"./ActionRequiredListItem-C3rhZpk0.js";import"./differenceWith-CL2cYvt7.js";import"./MeetAccessRequirementCard-XZRWe5Hk.js";import"./ACTAccessRequirement-WDpE4gfi.js";import"./LockAccessRequirement-B_A_PCc_.js";import"./SelfSignAccessRequirement-C_01XAIc.js";import"./useAccessRequirements-Bs4pf-wO.js";import"./_baseOrderBy-_utGvQOm.js";import"./AccessRequirementList-DGJYhKQA.js";import"./EntityLink-BJnm76dg.js";import"./useGetEntityHeaders-BOtOR_71.js";import"./EntityIcon-aidHjZMi.js";import"./ErrorChip-BSEqcjGM.js";import"./ErrorOutlined-B3kU8RUf.js";import"./UnmanagedACTAccessRequirementItem-CoS_txHX.js";import"./MarkdownSynapse-Df30U1Hn.js";import"./RequirementItem-Bt29b8dA.js";import"./LockTwoTone-BuhO1pcZ.js";import"./UserSearchBoxV2-Dyvd_FQT.js";import"./useDebouncedEffect-BGb05xfX.js";import"./use-deep-compare-effect.esm-Dzeb9zCG.js";import"./uniq-WYnvhmwy.js";import"./without-BG1esKpu.js";import"./Select-aab027f3.esm-B0oY44K8.js";import"./defineProperty-CegpTSss.js";import"./ManagedACTAccessRequirementItemView-bqLrc7Wo.js";import"./SelfSignAccessRequirementItem-DnLWYK5K.js";import"./DataAccessRequestAccessorsFilesForm-Dahfydga.js";import"./useDataAccessSubmission-A7OZZLBG.js";import"./RadioGroup-BvUx_jjx.js";import"./Radio-BcnezuEo.js";import"./FormGroup-lBJEyQ03.js";import"./UploadDocumentField-DSo31RlB.js";import"./ManagedACTAccessRequirementFormWikiWrapper-B8slwXoS.js";import"./ResearchProjectForm-D74B6XEr.js";import"./TextFieldWithWordLimit-Dt_RB5Cv.js";import"./AuthenticatedRequirement-pna1EAJp.js";import"./CertificationRequirement-BxSXN5YG.js";import"./TwoFactorAuthEnabledRequirement-pSfMeTF_.js";import"./ValidationRequirement-BhzUrAd3.js";import"./ActionRequiredCard-CchvshUw.js";import"./RequestDownloadCard-CSN5phiL.js";import"./useGetFeatureFlag-JSRikSWK.js";import"./EntityAclEditorModal-DC-665IW.js";import"./AccessControlListUtils-0vvPawz6.js";import"./AclEditor-D8pRplTb.js";import"./IconSvgButton-wtd1O43z.js";import"./useUpdateAcl-os0TDzq6.js";import"./OpenData-B1jP30H4.js";import"./EnableTwoFaRequirementCard-_t8_haT5.js";import"./IconList-Cl8hYuKL.js";import"./GetAppTwoTone-DaNhLDId.js";import"./pluralize-B99WZNfi.js";import"./SelectionCriteriaPill-BIYKBuxR.js";import"./LastPage-BJLDWRr7.js";import"./StyledTableContainer-DS5GEnfN.js";import"./times-CFf8C9TJ.js";import"./uniqueId-D4-l-flb.js";import"./useGetEntityChallenge-BFWTphSM.js";import"./useTeamMembers-BHcpRVSb.js";import"./useGetUserTeams-Czw40ghE.js";import"./ChallengeRegisterButton-CY_xGFrC.js";import"./ExitToApp-BsXf-Azx.js";import"./SpinnerButton-D6lrCAxw.js";import"./LoginAwareButton-C8QzHXtH.js";import"./ChallengeTeamWizard-CLOz7Vok.js";import"./CreateChallengeTeam-BblrPXgc.js";import"./useTeam-E3-pTPKZ.js";import"./papaparse.min-D1KxGBLm.js";import"./Search-BMETtK8G.js";import"./Box-BEuJ7kcC.js";import"./DataGrid-wrUO_ugz.js";import"./index-BTLPYjNe.js";import"./Switch-BM1rupnr.js";import"./ListItemIcon-BfMLfTvd.js";import"./Badge-D1YY4tM7.js";import"./usePreviousProps-Cz9JdTpV.js";import"./ListItemText-DwxPQMPb.js";import"./ClickAwayListener-DFw4-2za.js";import"./useEntitySelection-6X8FKY5O.js";import"./FileEntityDirectDownload-e9VRX8My.js";import"./DirectDownload-DYCXXGg3.js";import"./immutable.es-BJjDfH8f.js";import"./HelpOutlineTwoTone-BB4Pkymk.js";import"./StepperDialog-B3xbWZ3g.js";import"./useEvaluation-DyBotdXP.js";import"./useChangePasswordFormState-D3Ilx1Ll.js";import"./ProgrammaticInstructionsModal-z83xvWDn.js";import"./InteractiveCopyIdsIcon-D6b_nW-A.js";import"./DirectProgrammaticDownload-D-tBGMo0.js";import"./EntityModal-Blgdw-Qg.js";import"./FileHandleUtils-DAYnepAn.js";import"./useFavorites-CSjwapGt.js";import"./NoSearchResults-nqK8WwUo.js";import"./useSearch-DyEbnyzj.js";import"./index.esm-sw29g_zn.js";import"./Slider-DwheQ65_.js";import"./_arrayReduce-CrxnWFSq.js";import"./forEach-CoE7mUz9.js";import"./CreatedOnByUserDiv-D6Vt_0SS.js";import"./CardContent-_dfdr2Ry.js";import"./upperFirst-CULQdymH.js";import"./_stringToArray-N8cAV6t0.js";import"./index.prod-CHsEQELt.js";import"./InfoOutlined-KgGo70bZ.js";import"./ContentCopyTwoTone-cxfncK6P.js";import"./PhoneTwoTone-H0ejv3dP.js";import"./Plot-B-ZvMvJn.js";import"./useFacetPlots-z_cxM-CI.js";import"./ColorGradient-Zy7TAKxK.js";import"./colorPalette-BALeOMsp.js";import"./EnumFacetFilter-Byss71IM.js";import"./EnumFacetFilterSkeleton-D4Uq-n84.js";import"./EnumFacetFilterUI-FeDtNHxF.js";import"./FacetFilterHeader-DE-jCmXD.js";import"./index-vQlLjtfg.js";import"./index-CmreEc8V.js";import"./index-CCGfyjw4.js";import"./RangeFacetFilterUI-DEsnnbjm.js";import"./RangeSlider-BmtMlXHI.js";import"./NoContentAvailable-CrmWlq7l.js";import"./ForumThreadEditor-CyAg4UNN.js";import"./useThread-D4DWL8pg.js";import"./useSubscription-CLzbTIN8.js";import"./SubscribersModal-BSJ1qveX.js";import"./useForum-CSYEF7Up.js";import"./getValidReactChildren-DQOvLrUz.js";import"./AlertTitle-tYv3ugNo.js";import"./HeaderCard-DZYgs3Q7.js";import"./SustainabilityScorecard-H4reyzZc.js";import"./Dial-Cdlj4zTh.js";import"./CheckIcon-jAsz8IS1.js";import"./FileHandleLink-CAqVEOOo.js";import"./ExpandableContent-Ch5vL0zR.js";import"./useGetGoalData-_4tpRiux.js";import"./NavigateNext-oPwBzISS.js";import"./CardActionArea-DNtxeczJ.js";import"./mouse-DswG4CUc.js";import"./SortDown-Bk_Wydy_.js";import"./Container-BKeli6qe.js";import"./SynapseFormRadioWidget-Pt213VDb.js";import"./ExpandCollapseButton-By7dBIE6.js";import"./OAuthClientAclEditor-BpJBF7s1.js";import"./unCamelCase-ZiU_emRy.js";import"./head-aneRfQQJ.js";import"./LargeButton-DeR5TOPt.js";import"./ExportToAnalysisPlatformDialog-DvF84pEd.js";import"./WizardChoiceButton-qfLmwgac.js";import"./RowSelectionUI-BLcywIsv.js";import"./DownloadLoginModal-BbpVzLOe.js";import"./NoData-BFkdVlRf.js";import"./index-fyYWl0GR.js";import"./index-VF2bnv_l.js";import"./SageFullLogo-A9c2kFrh.js";import"./index-CxkI-YMJ.js";import"./events-DQ172AOg.js";import"./Topic-BjYQDjcI.js";import"./types-CP9zjM1W.js";import"./Popover-BiDWzuU7.js";import"./TeamBadge-BPKUVsYm.js";import"./EntityFinderModal-Dbmeq299.js";import"./EntityHeaderTableCellRenderers-CasoQjXw.js";import"./Slide-Csn2no5M.js";import"./TextWidget-sz_z1ynu.js";var ti=function(){return Kc.Date.now()},nd="Expected a function",rd=Math.max,id=Math.min;function sd(e,c,m){var d,o,u,n,i,s,r=0,t=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(nd);c=Ds(c)||0,It(m)&&(t=!!m.leading,a="maxWait"in m,u=a?rd(Ds(m.maxWait)||0,c):u,p="trailing"in m?!!m.trailing:p);function f(S){var C=d,O=o;return d=o=void 0,r=S,n=e.apply(O,C),n}function w(S){return r=S,i=setTimeout(l,c),t?f(S):n}function y(S){var C=S-s,O=S-r,x=c-C;return a?id(x,u-O):x}function b(S){var C=S-s,O=S-r;return s===void 0||C>=c||C<0||a&&O>=u}function l(){var S=ti();if(b(S))return h(S);i=setTimeout(l,y(S))}function h(S){return i=void 0,p&&d?f(S):(d=o=void 0,n)}function g(){i!==void 0&&clearTimeout(i),r=0,d=s=o=i=void 0}function v(){return i===void 0?n:h(ti())}function _(){var S=ti(),C=b(S);if(d=arguments,o=this,s=S,C){if(i===void 0)return w(s);if(a)return clearTimeout(i),i=setTimeout(l,c),f(s)}return i===void 0&&(i=setTimeout(l,c)),n}return _.cancel=g,_.flush=v,_}var od="Expected a function";function ad(e,c,m){var d=!0,o=!0;if(typeof e!="function")throw new TypeError(od);return It(m)&&(d="leading"in m?!!m.leading:d,o="trailing"in m?!!m.trailing:o),sd(e,c,{leading:d,maxWait:c,trailing:o})}let ni=!1;const ld=(e="GTM-KPW4KS62")=>{const[c]=jc();return z.useEffect(()=>{var m;if(c.analyticsAllowed&&!ni){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":new Date().getTime(),event:"gtm.js"});const d=document.getElementsByTagName("script")[0],o=document.createElement("script"),u="&l=dataLayer";o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id="+e+u,(m=d.parentNode)==null||m.insertBefore(o,d),ni=!0}},[c,e]),ni};function ud(e){const{synapseClient:c}=st();return ft({...e,mutationFn:async m=>{const d=await c.gridServicesClient.postRepoV1GridDownloadCsvAsyncStart({downloadFromGridRequest:m});return(await is(()=>c.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:d.token}))).responseBody}})}function cd(e){const{keyFactory:c,synapseClient:m}=st(),d=qr();return ft({...e,mutationFn:async o=>{const u=await m.tableServicesClient.postRepoV1EntityIdTableTransactionAsyncStart({id:o.entityId,tableUpdateTransactionRequest:o});return(await is(()=>m.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:u.token}))).responseBody},onSuccess:async(o,u,n)=>{await _c(d,c,u.entityId)}})}function dd(e){const c=qr(),{mutateAsync:m}=ud(),{mutateAsync:d}=cd(),o=Tc();return ft({...e,mutationFn:async({gridSessionId:u,sourceEntityId:n})=>{const i=await c.fetchQuery(o(n)),s={...fd(i),sessionId:u},r=await m(s),t={concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:n,changes:[{uploadFileHandleId:r.resultsFileHandleId,tableId:n,concreteType:"org.sagebionetworks.repo.model.table.UploadToTableRequest"}]};return d(t)}})}function fd(e){return Sc(e)?{includeRowIdAndRowVersion:!0,includeEtag:!1,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}:{includeRowIdAndRowVersion:!0,includeEtag:!0,concreteType:"org.sagebionetworks.repo.model.grid.DownloadFromGridRequest"}}try{As.displayName="CardGridWithLinks",As.__docgenInfo={description:"",displayName:"CardGridWithLinks",props:{linkText:{defaultValue:null,description:"",name:"linkText",required:!0,type:{name:"string"}},cards:{defaultValue:null,description:"",name:"cards",required:!0,type:{name:"CardGridWithLinksConfig[]"}}}}}catch{}try{Ps.displayName="CTASectionWrapper",Ps.__docgenInfo={description:"",displayName:"CTASectionWrapper",props:{themeMode:{defaultValue:null,description:"",name:"themeMode",required:!0,type:{name:"enum",value:[{value:'"dark"'},{value:'"light"'}]}},showBlobs:{defaultValue:{value:"true"},description:"",name:"showBlobs",required:!1,type:{name:"boolean"}},content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"ReactNode"}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps"}}}}}catch{}const Ls=({schemaUrl:e,uiSchemaUrl:c,postUrl:m,submitButtonText:d})=>{const[o,u]=z.useState(!1),n=()=>{u(!0)},i=()=>{u(!1)},s=j.jsx(qc,{schemaUrl:e,uiSchemaUrl:c,postUrl:m,onSubmit:()=>{i()}});return j.jsx("div",{className:"browse-tools-page",children:j.jsxs(xe,{sx:{margin:"10px 0px 50px 0px"},children:[j.jsx(Dc,{className:"highlightSubmitToolButton",variant:"contained",onClick:n,children:d}),j.jsx(Mc,{open:o,title:"",content:s,onCancel:i,onConfirm:()=>{},confirmButtonProps:{sx:{display:"none"}},cancelButtonProps:{children:"cancel"}})]})})};try{Ls.displayName="DynamicFormModal",Ls.__docgenInfo={description:"",displayName:"DynamicFormModal",props:{schemaUrl:{defaultValue:null,description:"",name:"schemaUrl",required:!0,type:{name:"string"}},uiSchemaUrl:{defaultValue:null,description:"",name:"uiSchemaUrl",required:!0,type:{name:"string"}},postUrl:{defaultValue:null,description:"",name:"postUrl",required:!0,type:{name:"string"}},mutateFormDataBeforePost:{defaultValue:null,description:"",name:"mutateFormDataBeforePost",required:!1,type:{name:"(formData: any) => any"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!1,type:{name:"() => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"() => void"}},submitButtonText:{defaultValue:null,description:"",name:"submitButtonText",required:!1,type:{name:"string"}}}}}catch{}class wr extends z.Component{constructor(m){super(m);pe(this,"formRef");pe(this,"submitForm",()=>{this.formRef.current.submit()});pe(this,"refresh",()=>{if(this.context.accessToken){const m=[Ne.getUserProfile(this.context.accessToken),Ne.getEntity(this.context.accessToken,this.props.formSchemaEntityId),Ne.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(m).then(d=>{const o=d[0];this.getTargetContainer(o,this.context.accessToken).then(u=>{const n=d[1],i=d[2];this.getSchemaFileContent(u,n,i)})}).catch(d=>{this.onError(d)})}});pe(this,"getSchemaFileContent",(m,d,o)=>{const u=[Ne.getFileResult(d,this.context.accessToken,!0,!0),Ne.getFileResult(o,this.context.accessToken,!0,!0)];Promise.all(u).then(n=>{try{const i=n.map(s=>ks(s.fileHandle,s.preSignedURL));Promise.all(i).then(s=>{const r=JSON.parse(s[0]),t=JSON.parse(s[1]);this.getExistingFileData(m,r,t)}).catch(s=>{console.log("getSchemaFileContent: Error getting form content",s)})}catch(i){console.log("getSchemaFileContent: Error getting schema content",i)}}).catch(n=>{this.onError(n)})});pe(this,"getExistingFileData",(m,d,o)=>{const n={entityName:`${d.title}.json`,parentId:m};let i,s;Ne.lookupChildEntity(n,this.context.accessToken).then(r=>Ne.getEntity(this.context.accessToken,r.id).then(t=>(s=t,this.props.initFormData?Ne.getFileResult(s,this.context.accessToken,!0,!0).then(async a=>{try{const p=await ks(a.fileHandle,a.preSignedURL);i=JSON.parse(p)}catch(p){console.log("getExistingFileData: Error setting form data",p)}}):Promise.resolve()))).finally(()=>{this.setState({formData:i,currentFileEntity:s,formSchema:d,formUiSchema:o})})});pe(this,"getTargetContainer",async(m,d)=>{const o={entityName:m.ownerId,parentId:this.props.parentContainerId};try{const u=await Ne.lookupChildEntity(o,d);return console.log(`EntityForm uploading to https://www.synapse.org/Synapse:${u.id}`),this.setState({userprofile:m,containerId:u.id,isLoading:!1}),u.id}catch(u){return u.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(u)}});pe(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});pe(this,"onError",m=>{this.setState({error:m,isLoading:!1,successfullyUploaded:!1})});pe(this,"onSubmit",({formData:m})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const d=new Blob([JSON.stringify(m)],{type:"text/json"});this.createEntityFile(d)});pe(this,"createEntityFile",m=>{const d=`${this.state.formSchema.title}.json`;Ne.uploadFile(this.context.accessToken,d,m).then(o=>{const u=o.fileHandleId;if(this.state.currentFileEntity){const i={...this.state.currentFileEntity,dataFileHandleId:u};return this.setState({currentFileEntity:i}),Ne.updateEntity(i,this.context.accessToken)}const n={parentId:this.state.containerId,name:d,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:u};return Ne.createEntity(n,this.context.accessToken)}).then(o=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(o.id)}).catch(o=>{this.onError(o)})});this.formRef=z.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return j.jsxs("div",{children:[this.state.error&&j.jsxs("div",{className:"panel panel-danger errors",children:[j.jsx("div",{className:"panel-heading",children:j.jsx("h3",{className:"panel-title",children:"Error"})}),j.jsx("ul",{className:"list-group",children:j.jsxs("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&j.jsx(Bc,{validator:Fc,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:j.jsx("div",{style:{display:"none"},children:j.jsx("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&j.jsxs(j.Fragment,{children:[j.jsx("span",{children:"Saving…"}),j.jsx("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}pe(wr,"contextType",xc);try{wr.displayName="EntityForm",wr.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}try{wr.contextType.displayName="EntityForm.contextType",wr.contextType.__docgenInfo={description:"If set, `this.context` will be set at runtime to the current value of the given Context.",displayName:"EntityForm.contextType",props:{}}}catch{}const Us=e=>{const{accessToken:c}=st(),{synId:m,className:d}=e,[o,u]=z.useState(void 0);z.useEffect(()=>{(async()=>{try{const r=await Ne.getEntity(c,m);if(!Ic(r))throw new Error(`File Entity expected but found ${r}`);const t={requestedFiles:[{associateObjectId:m,associateObjectType:su.FileEntity,fileHandleId:r.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},p=(await Ne.getFiles(t,c)).requestedFiles[0].fileHandle;if(p&&kc(p))u({externalFileHandle:p,fileEntity:r});else throw new Error(`Not an external file handle: ${p==null?void 0:p.id}`)}catch(r){console.error("Error on getting external file handle = ",r)}})()},[m,c]);const n=o==null?void 0:o.externalFileHandle,i=o==null?void 0:o.fileEntity;return n?j.jsx("a",{href:n.externalURL,className:d,target:"_blank",rel:"noopener noreferrer",children:j.jsxs("span",{children:[i==null?void 0:i.name,j.jsx(Uc,{style:{marginLeft:5}})]})}):j.jsx(j.Fragment,{})};try{Us.displayName="ExternalFileHandleLink",Us.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{qs.displayName="GoalsV3",qs.__docgenInfo={description:"",displayName:"GoalsV3",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},svgComponentMap:{defaultValue:null,description:"",name:"svgComponentMap",required:!0,type:{name:"Record<string, FC<SVGProps<SVGSVGElement>>>"}}}}}catch{}function $s(e){const{measurementId:c}=e;return ld(c),j.jsx(j.Fragment,{})}try{$s.displayName="GoogleAnalytics",$s.__docgenInfo={description:`GoogleAnalytics is a component wrapper for the useGoogleAnalytics() hook.
This is exported for use in the Synapse.org GWT codebase.`,displayName:"GoogleAnalytics",props:{measurementId:{defaultValue:null,description:"",name:"measurementId",required:!1,type:{name:"string"}}}}}catch{}function zs(){return j.jsxs(xe,{sx:{color:"grey.700",maxHeight:{xs:"170px",md:"110px"},overflow:"auto",margin:"20px 0px"},children:[j.jsx(Xe,{variant:"smallText1",sx:{fontWeight:700,marginBottom:"5px"},children:"System Use Notice"}),j.jsx(Xe,{variant:"smallText1",sx:{lineHeight:"21px"},children:"Sage Bionetworks actively monitors this system and activity to maintain system security and availability and to ensure appropriate and legitimate usage. Any individual who intentionally accesses a computer or system without authorization, and who alters, damages, makes unauthorized modifications to, or destroys information, or exceeds authorized access, is in violation of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance. Any evidence of possible violations of proper use or applicable laws found as a result of this monitoring may be turned over to law enforcement. Any individual found to be in violation of the system's proper use rules or law could be punished with loss of system access, fines, and/or imprisonment. By proceeding, you hereby acknowledge your agreement with these terms and the system's rules of behavior and consent to such monitoring and information retrieval for law enforcement and other official purposes."})]})}try{zs.displayName="SystemUseNotification",zs.__docgenInfo={description:"FISMA SAR V1-AC-8 System Use Notification, see https://sagebionetworks.jira.com/browse/SWC-6430",displayName:"SystemUseNotification",props:{}}}catch{}const Gs=zc(xe,{label:"MuiContainer"})(({theme:e})=>({paddingRight:15,paddingLeft:15,marginRight:"auto",marginLeft:"auto",[e.breakpoints.up("md")]:{width:920},[e.breakpoints.up("lg")]:{width:1170},[e.breakpoints.up("xl")]:{width:1366}}));try{Gs.displayName="MuiContainer",Gs.__docgenInfo={description:"Drop in MUI substitute class for Bootstrap Container component",displayName:"MuiContainer",props:{border:{defaultValue:null,description:"",name:"border",required:!1,type:{name:'ResponsiveStyleValue<number | (string & {}) | "inset" | "hidden" | "inherit" | "medium" | "none" | "initial" | "-moz-initial" | "revert" | "unset" | "revert-layer" | "thick" | "thin" | "dashed" | ... 183 more ... | "currentcolor"> | ((theme: Theme) => ResponsiveStyleValue<...>)'}},boxShadow:{defaultValue:null,description:"",name:"boxShadow",required:!1,type:{name:"ResponsiveStyleValue<number | BoxShadow> | ((theme: Theme) => ResponsiveStyleValue<number | BoxShadow>)"}},fontWeight:{defaultValue:null,description:"",name:"fontWeight",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},zIndex:{defaultValue:null,description:"",name:"zIndex",required:!1,type:{name:"ResponsiveStyleValue<string | (string & {}) | (number & {})> | ((theme: Theme) => ResponsiveStyleValue<string | (string & {}) | (number & {})>)"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignContent>)"}},alignItems:{defaultValue:null,description:"",name:"alignItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignItems>)"}},alignSelf:{defaultValue:null,description:"",name:"alignSelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | AlignSelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | AlignSelf>)"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"ResponsiveStyleValue<Bottom<string | number> | readonly NonNullable<Bottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},boxSizing:{defaultValue:null,description:"",name:"boxSizing",required:!1,type:{name:"ResponsiveStyleValue<BoxSizing | readonly NonNullable<BoxSizing>[]> | ((theme: Theme) => ResponsiveStyleValue<BoxSizing | readonly NonNullable<...>[]>)"}},color:{defaultValue:null,description:"",name:"color",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Color> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Color>)"}},columnGap:{defaultValue:null,description:"",name:"columnGap",required:!1,type:{name:"ResponsiveStyleValue<ColumnGap<string | number> | readonly NonNullable<ColumnGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},display:{defaultValue:null,description:"",name:"display",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},flexBasis:{defaultValue:null,description:"",name:"flexBasis",required:!1,type:{name:"ResponsiveStyleValue<FlexBasis<string | number> | readonly NonNullable<FlexBasis<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flexDirection:{defaultValue:null,description:"",name:"flexDirection",required:!1,type:{name:"ResponsiveStyleValue<FlexDirection | readonly NonNullable<FlexDirection>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexDirection | readonly NonNullable<...>[]>)"}},flexGrow:{defaultValue:null,description:"",name:"flexGrow",required:!1,type:{name:"ResponsiveStyleValue<FlexGrow | readonly NonNullable<FlexGrow>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexGrow | readonly NonNullable<...>[]>)"}},flexShrink:{defaultValue:null,description:"",name:"flexShrink",required:!1,type:{name:"ResponsiveStyleValue<FlexShrink | readonly NonNullable<FlexShrink>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexShrink | readonly NonNullable<...>[]>)"}},flexWrap:{defaultValue:null,description:"",name:"flexWrap",required:!1,type:{name:"ResponsiveStyleValue<FlexWrap | readonly NonNullable<FlexWrap>[]> | ((theme: Theme) => ResponsiveStyleValue<FlexWrap | readonly NonNullable<...>[]>)"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontFamily> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontFamily>)"}},fontSize:{defaultValue:null,description:"",name:"fontSize",required:!1,type:{name:"ResponsiveStyleValue<FontSize<string | number> | readonly NonNullable<FontSize<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},fontStyle:{defaultValue:null,description:"",name:"fontStyle",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | FontStyle> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | FontStyle>)"}},gridAutoColumns:{defaultValue:null,description:"",name:"gridAutoColumns",required:!1,type:{name:"ResponsiveStyleValue<GridAutoColumns<string | number> | readonly NonNullable<GridAutoColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridAutoFlow:{defaultValue:null,description:"",name:"gridAutoFlow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridAutoFlow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridAutoFlow>)"}},gridAutoRows:{defaultValue:null,description:"",name:"gridAutoRows",required:!1,type:{name:"ResponsiveStyleValue<GridAutoRows<string | number> | readonly NonNullable<GridAutoRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateAreas:{defaultValue:null,description:"",name:"gridTemplateAreas",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | GridTemplateAreas> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | GridTemplateAreas>)"}},gridTemplateColumns:{defaultValue:null,description:"",name:"gridTemplateColumns",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateColumns<string | number> | readonly NonNullable<GridTemplateColumns<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},gridTemplateRows:{defaultValue:null,description:"",name:"gridTemplateRows",required:!1,type:{name:"ResponsiveStyleValue<GridTemplateRows<string | number> | readonly NonNullable<GridTemplateRows<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"ResponsiveStyleValue<Height<string | number> | readonly NonNullable<Height<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},justifyContent:{defaultValue:null,description:"",name:"justifyContent",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyContent> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyContent>)"}},justifyItems:{defaultValue:null,description:"",name:"justifyItems",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifyItems> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifyItems>)"}},justifySelf:{defaultValue:null,description:"",name:"justifySelf",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | JustifySelf> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | JustifySelf>)"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"ResponsiveStyleValue<Left<string | number> | readonly NonNullable<Left<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Left<...> | readonly NonNullable<...>[]>)"}},letterSpacing:{defaultValue:null,description:"",name:"letterSpacing",required:!1,type:{name:"ResponsiveStyleValue<LetterSpacing<string | number> | readonly NonNullable<LetterSpacing<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},lineHeight:{defaultValue:null,description:"",name:"lineHeight",required:!1,type:{name:"ResponsiveStyleValue<LineHeight<string | number> | readonly NonNullable<LineHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockEnd:{defaultValue:null,description:"",name:"marginBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockEnd<string | number> | readonly NonNullable<MarginBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlockStart:{defaultValue:null,description:"",name:"marginBlockStart",required:!1,type:{name:"ResponsiveStyleValue<MarginBlockStart<string | number> | readonly NonNullable<MarginBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBottom:{defaultValue:null,description:"",name:"marginBottom",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineEnd:{defaultValue:null,description:"",name:"marginInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineEnd<string | number> | readonly NonNullable<MarginInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInlineStart:{defaultValue:null,description:"",name:"marginInlineStart",required:!1,type:{name:"ResponsiveStyleValue<MarginInlineStart<string | number> | readonly NonNullable<MarginInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginLeft:{defaultValue:null,description:"",name:"marginLeft",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginRight:{defaultValue:null,description:"",name:"marginRight",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginTop:{defaultValue:null,description:"",name:"marginTop",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"ResponsiveStyleValue<MaxHeight<string | number> | readonly NonNullable<MaxHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},maxWidth:{defaultValue:null,description:"",name:"maxWidth",required:!1,type:{name:"ResponsiveStyleValue<MaxWidth<string | number> | readonly NonNullable<MaxWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minHeight:{defaultValue:null,description:"",name:"minHeight",required:!1,type:{name:"ResponsiveStyleValue<MinHeight<string | number> | readonly NonNullable<MinHeight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},minWidth:{defaultValue:null,description:"",name:"minWidth",required:!1,type:{name:"ResponsiveStyleValue<MinWidth<string | number> | readonly NonNullable<MinWidth<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},order:{defaultValue:null,description:"",name:"order",required:!1,type:{name:"ResponsiveStyleValue<Order | readonly NonNullable<Order>[]> | ((theme: Theme) => ResponsiveStyleValue<Order | readonly NonNullable<Order>[]>)"}},paddingBlockEnd:{defaultValue:null,description:"",name:"paddingBlockEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockEnd<string | number> | readonly NonNullable<PaddingBlockEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlockStart:{defaultValue:null,description:"",name:"paddingBlockStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlockStart<string | number> | readonly NonNullable<PaddingBlockStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBottom:{defaultValue:null,description:"",name:"paddingBottom",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineEnd:{defaultValue:null,description:"",name:"paddingInlineEnd",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineEnd<string | number> | readonly NonNullable<PaddingInlineEnd<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInlineStart:{defaultValue:null,description:"",name:"paddingInlineStart",required:!1,type:{name:"ResponsiveStyleValue<PaddingInlineStart<string | number> | readonly NonNullable<PaddingInlineStart<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingLeft:{defaultValue:null,description:"",name:"paddingLeft",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingRight:{defaultValue:null,description:"",name:"paddingRight",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingTop:{defaultValue:null,description:"",name:"paddingTop",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"ResponsiveStyleValue<Position | readonly NonNullable<Position>[]> | ((theme: Theme) => ResponsiveStyleValue<Position | readonly NonNullable<...>[]>)"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"ResponsiveStyleValue<Right<string | number> | readonly NonNullable<Right<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},rowGap:{defaultValue:null,description:"",name:"rowGap",required:!1,type:{name:"ResponsiveStyleValue<RowGap<string | number> | readonly NonNullable<RowGap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},textAlign:{defaultValue:null,description:"",name:"textAlign",required:!1,type:{name:"ResponsiveStyleValue<TextAlign | readonly NonNullable<TextAlign>[]> | ((theme: Theme) => ResponsiveStyleValue<TextAlign | readonly NonNullable<...>[]>)"}},textOverflow:{defaultValue:null,description:"",name:"textOverflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | TextOverflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | TextOverflow>)"}},textTransform:{defaultValue:null,description:"",name:"textTransform",required:!1,type:{name:"ResponsiveStyleValue<TextTransform | readonly NonNullable<TextTransform>[]> | ((theme: Theme) => ResponsiveStyleValue<TextTransform | readonly NonNullable<...>[]>)"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"ResponsiveStyleValue<Top<string | number> | readonly NonNullable<Top<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Top<string | number> | readonly NonNullable<...>[]>)"}},visibility:{defaultValue:null,description:"",name:"visibility",required:!1,type:{name:"ResponsiveStyleValue<Visibility | readonly NonNullable<Visibility>[]> | ((theme: Theme) => ResponsiveStyleValue<Visibility | readonly NonNullable<...>[]>)"}},whiteSpace:{defaultValue:null,description:"",name:"whiteSpace",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | WhiteSpace> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | WhiteSpace>)"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"ResponsiveStyleValue<Width<string | number> | readonly NonNullable<Width<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderBottom:{defaultValue:null,description:"",name:"borderBottom",required:!1,type:{name:"ResponsiveStyleValue<BorderBottom<string | number> | readonly NonNullable<BorderBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderColor:{defaultValue:null,description:"",name:"borderColor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BorderColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BorderColor>)"}},borderLeft:{defaultValue:null,description:"",name:"borderLeft",required:!1,type:{name:"ResponsiveStyleValue<BorderLeft<string | number> | readonly NonNullable<BorderLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRadius:{defaultValue:null,description:"",name:"borderRadius",required:!1,type:{name:"ResponsiveStyleValue<BorderRadius<string | number> | readonly NonNullable<BorderRadius<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderRight:{defaultValue:null,description:"",name:"borderRight",required:!1,type:{name:"ResponsiveStyleValue<BorderRight<string | number> | readonly NonNullable<BorderRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},borderTop:{defaultValue:null,description:"",name:"borderTop",required:!1,type:{name:"ResponsiveStyleValue<BorderTop<string | number> | readonly NonNullable<BorderTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},flex:{defaultValue:null,description:"",name:"flex",required:!1,type:{name:"ResponsiveStyleValue<Flex<string | number> | readonly NonNullable<Flex<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Flex<...> | readonly NonNullable<...>[]>)"}},gap:{defaultValue:null,description:"",name:"gap",required:!1,type:{name:"ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<Gap<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<Gap<string | number> | readonly NonNullable<...>[]>)"}},gridArea:{defaultValue:null,description:"",name:"gridArea",required:!1,type:{name:"ResponsiveStyleValue<GridArea | readonly NonNullable<GridArea>[]> | ((theme: Theme) => ResponsiveStyleValue<GridArea | readonly NonNullable<...>[]>)"}},gridColumn:{defaultValue:null,description:"",name:"gridColumn",required:!1,type:{name:"ResponsiveStyleValue<GridColumn | readonly NonNullable<GridColumn>[]> | ((theme: Theme) => ResponsiveStyleValue<GridColumn | readonly NonNullable<...>[]>)"}},gridRow:{defaultValue:null,description:"",name:"gridRow",required:!1,type:{name:"ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]> | ((theme: Theme) => ResponsiveStyleValue<GridRow | readonly NonNullable<GridRow>[]>)"}},margin:{defaultValue:null,description:"",name:"margin",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginBlock:{defaultValue:null,description:"",name:"marginBlock",required:!1,type:{name:"ResponsiveStyleValue<MarginBlock<string | number> | readonly NonNullable<MarginBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginInline:{defaultValue:null,description:"",name:"marginInline",required:!1,type:{name:"ResponsiveStyleValue<MarginInline<string | number> | readonly NonNullable<MarginInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},overflow:{defaultValue:null,description:"",name:"overflow",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Overflow> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Overflow>)"}},padding:{defaultValue:null,description:"",name:"padding",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingBlock:{defaultValue:null,description:"",name:"paddingBlock",required:!1,type:{name:"ResponsiveStyleValue<PaddingBlock<string | number> | readonly NonNullable<PaddingBlock<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingInline:{defaultValue:null,description:"",name:"paddingInline",required:!1,type:{name:"ResponsiveStyleValue<PaddingInline<string | number> | readonly NonNullable<PaddingInline<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},bgcolor:{defaultValue:null,description:"",name:"bgcolor",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | BackgroundColor> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | BackgroundColor>)"}},m:{defaultValue:null,description:"",name:"m",required:!1,type:{name:"ResponsiveStyleValue<Margin<string | number> | readonly NonNullable<Margin<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mt:{defaultValue:null,description:"",name:"mt",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mr:{defaultValue:null,description:"",name:"mr",required:!1,type:{name:"ResponsiveStyleValue<MarginRight<string | number> | readonly NonNullable<MarginRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mb:{defaultValue:null,description:"",name:"mb",required:!1,type:{name:"ResponsiveStyleValue<MarginBottom<string | number> | readonly NonNullable<MarginBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},ml:{defaultValue:null,description:"",name:"ml",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},mx:{defaultValue:null,description:"",name:"mx",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginX:{defaultValue:null,description:"",name:"marginX",required:!1,type:{name:"ResponsiveStyleValue<MarginLeft<string | number> | readonly NonNullable<MarginLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},my:{defaultValue:null,description:"",name:"my",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},marginY:{defaultValue:null,description:"",name:"marginY",required:!1,type:{name:"ResponsiveStyleValue<MarginTop<string | number> | readonly NonNullable<MarginTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},p:{defaultValue:null,description:"",name:"p",required:!1,type:{name:"ResponsiveStyleValue<Padding<string | number> | readonly NonNullable<Padding<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pt:{defaultValue:null,description:"",name:"pt",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pr:{defaultValue:null,description:"",name:"pr",required:!1,type:{name:"ResponsiveStyleValue<PaddingRight<string | number> | readonly NonNullable<PaddingRight<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pb:{defaultValue:null,description:"",name:"pb",required:!1,type:{name:"ResponsiveStyleValue<PaddingBottom<string | number> | readonly NonNullable<PaddingBottom<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},pl:{defaultValue:null,description:"",name:"pl",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},px:{defaultValue:null,description:"",name:"px",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingX:{defaultValue:null,description:"",name:"paddingX",required:!1,type:{name:"ResponsiveStyleValue<PaddingLeft<string | number> | readonly NonNullable<PaddingLeft<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},py:{defaultValue:null,description:"",name:"py",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},paddingY:{defaultValue:null,description:"",name:"paddingY",required:!1,type:{name:"ResponsiveStyleValue<PaddingTop<string | number> | readonly NonNullable<PaddingTop<string | number>>[]> | ((theme: Theme) => ResponsiveStyleValue<...>)"}},typography:{defaultValue:null,description:"",name:"typography",required:!1,type:{name:"ResponsiveStyleValue<string> | ((theme: Theme) => ResponsiveStyleValue<string>)"}},displayPrint:{defaultValue:null,description:"",name:"displayPrint",required:!1,type:{name:"ResponsiveStyleValue<readonly string[] | Display> | ((theme: Theme) => ResponsiveStyleValue<readonly string[] | Display>)"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const pu=e=>{z.useEffect(()=>{if(e){const c=document.querySelector("head"),m=document.createElement("script");m.setAttribute("type","application/ld+json");const d=document.createTextNode(e);return m.appendChild(d),c==null||c.appendChild(m),()=>{c==null||c.removeChild(m)}}},[e])};function Ws({thing:e}){return pu(JSON.stringify(e)),j.jsx(j.Fragment,{})}try{Ws.displayName="JsonLdScript",Ws.__docgenInfo={description:"This component will add a json ld script tag to the page when rendered.",displayName:"JsonLdScript",props:{thing:{defaultValue:null,description:"",name:"thing",required:!0,type:{name:"WithContext<Thing>"}}}}}catch{}function Hs({entityId:e,version:c,searchParams:m}){var a,p,f;let d,o;e?(d=e,o=c):m&&(d=m.id,m.version&&(o=parseInt(m.version)));const u={sql:"select croissant_file_s3_object from syn65903895",additionalFilters:[{concreteType:Vs,columnName:"dataset",operator:js.EQUAL,values:[d]}]};o&&u.additionalFilters.push({concreteType:Vs,columnName:"dataset_version",operator:js.EQUAL,values:[`${o}`]});const{data:n}=Cc({entityId:d,query:u,partMask:ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),i=(f=(p=(a=n==null?void 0:n.responseBody)==null?void 0:a.queryResult)==null?void 0:p.queryResults)==null?void 0:f.rows,s=i&&i.length>0?i[0]:void 0,r=s==null?void 0:s.values[0],{data:t}=Oc(r,{enabled:!!r});return pu(t),j.jsx(j.Fragment,{})}try{Hs.displayName="DatasetJsonLdScript",Hs.__docgenInfo={description:"This component will add a Dataset json ld script tag to the page when rendered.",displayName:"DatasetJsonLdScript",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!1,type:{name:"string"}},version:{defaultValue:null,description:"",name:"version",required:!1,type:{name:"number"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"{ [key: string]: string; }"}}}}}catch{}const ls=(e,c)=>{const m={associateObjectId:c,associateObjectType:su.TableEntity,fileHandleId:e||""},d=Rc(m,!1,{enabled:!!e});return d==null?void 0:d.dataUrl},hd=400,pd=({research:e,entityId:c,publicationDateColIndex:m,titleColIndex:d,linkColIndex:o,imageColIndex:u,isLoading:n})=>{const i=e.values[u]??"",s=ls(i??"",c);return n?j.jsx(os,{variant:"rectangular",height:142,width:"100%"}):j.jsxs(xe,{sx:{display:"flex",gap:"30px",borderBottom:"1px solid",padding:"24px 0",borderColor:"grey.300",flexDirection:{xs:"column",sm:"row"}},children:[j.jsxs(vr,{useFlexGap:!0,sx:{gap:"10px"},children:[j.jsx(Xe,{variant:"headline2",sx:{color:"gray.1000",fontSize:"21px"},children:j.jsx(jr,{href:e.values[o]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[d]})}),j.jsx(Xe,{sx:{lineHeight:"normal",color:"grey.600"},children:e.values[m]&&Vc(Ac(Number(e.values[m])),"MMMM, YYYY")})]}),j.jsx(as,{component:"img",image:s,"aria-hidden":"true",sx:{flexShrink:0,width:"140px",height:"93.8px",borderRadius:"6px",objectFit:"cover",marginLeft:{xs:"initial",sm:"auto"}}})]})},md=({research:e,entityId:c,titleColIndex:m,descriptionColIndex:d,linkColIndex:o,imageColIndex:u,isLoading:n})=>{const[i,s]=Gc({threshold:.3,triggerOnce:!0}),r=e.values[u]??"",t=ls(r||"",c);return n?j.jsx(os,{variant:"rectangular",width:"100%",sx:{height:{xs:"250px",sm:"500px",md:"600px",lg:"800px"}}}):j.jsxs(xe,{ref:i,children:[j.jsx(Wc,{in:s,timeout:hd,children:j.jsx(as,{component:"img",image:t,"aria-hidden":"true",sx:{objectFit:"cover",borderRadius:"10px",marginBottom:"30px"}})}),j.jsxs(vr,{useFlexGap:!0,sx:{gap:"16px"},children:[j.jsx(Xe,{variant:"headline2",sx:{color:"grey.1000",fontSize:{xs:"24px",md:"36px"}},children:j.jsx(jr,{href:e.values[o]??"",target:"_blank",sx:{color:"grey.1000",textDecoration:"none","&:hover":{textDecoration:"none"}},children:e.values[m]})}),j.jsx(Xe,{sx:{fontSize:"18px",lineHeight:"22.4px"},children:e.values[d]??""}),j.jsx(jr,{href:e.values[o]??"",target:"_blank",children:"Read more"})]})]})};function Js(e){const{sql:c}=e,m=uu(c),d={partMask:lu|ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:m,query:{sql:c}},{data:o,isLoading:u}=iu(d),n=(o==null?void 0:o.queryResult.queryResults.rows)??[];let i;(b=>{b.TITLE="title",b.DESCRIPTION="description",b.PUBLICATION_DATE="publicationDate",b.IMAGE="image",b.LINK="link"})(i||(i={}));const s=ct("title",o),r=ct("description",o),t=ct("publicationDate",o),a=ct("image",o),p=ct("link",o),f=n[0],w=n.slice(1),y=j.jsx(cu,{title:"Featured Research",sx:{h2:{fontSize:"24px",paddingBottom:0,width:"100%"}}});return j.jsxs(xe,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:{xs:"30px",md:"40px"},padding:{xs:"40px",lg:"80px"}},children:[j.jsx(xe,{sx:{display:{md:"none"}},children:y}),j.jsx(xe,{children:f&&j.jsx(md,{entityId:m,research:f,titleColIndex:s,isLoading:u,descriptionColIndex:r,publicationDateColIndex:t,imageColIndex:a,linkColIndex:p})}),j.jsxs(vr,{children:[j.jsx(xe,{sx:{display:{xs:"none",md:"block"}},children:y}),j.jsx(vr,{sx:{gap:"16px"},children:w.map((b,l)=>j.jsx(pd,{entityId:m,research:b,isLoading:u,titleColIndex:s,descriptionColIndex:r,publicationDateColIndex:t,imageColIndex:a,linkColIndex:p},l))})]})]})}try{Js.displayName="FeaturedResearch",Js.__docgenInfo={description:"",displayName:"FeaturedResearch",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}}}}}catch{}const Vr=({backgroundCss:e,buttonLink:c,title:m,subTitle:d,description:o,backgroundMp4:u,backgroundMp4Css:n})=>j.jsxs(xe,{"data-testid":"HeaderContainer",sx:{background:e,padding:{xs:0,md:"50px 80px"},position:"relative"},children:[u&&j.jsxs(xe,{component:"video",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"fill",zIndex:-1,background:n},children:[j.jsx("source",{src:u,type:"video/mp4"}),"Your browser does not support the video tag."]}),j.jsxs(vr,{sx:{alignItems:"flex-start",padding:{xs:"40px",md:"40px 0"},gap:"24px",width:{sm:"100%",md:"746px"}},children:[j.jsx(Xe,{variant:"headline2",sx:{fontWeight:300,lineHeight:"130%",fontSize:{xs:"36px",md:"42px"},color:"grey.1000"},children:m}),j.jsx(Xe,{variant:"headline3",sx:{fontSize:"24px",fontWeight:"400",lineHeight:"160%",color:"grey.1000"},children:d}),j.jsx(Xe,{sx:{fontSize:"18px",lineHeight:"140%",color:"grey.900"},children:o}),c&&j.jsx(Gt,{href:c,target:"_blank",variant:"contained",role:"button",sx:i=>({whiteSpace:"nowrap",alignSelf:"flex-start",padding:"6px 24px",fontWeight:600,boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)","&:hover":{boxShadow:"0px 16px 16px 0px rgba(0, 0, 0, 0.10), 0px 4px 4px 0px rgba(0, 0, 0, 0.10), 0px 1px 1px 0px rgba(0, 0, 0, 0.10)"},[i.breakpoints.down("sm")]:{width:"100%"}}),children:"Learn more"})]})]});try{Vr.displayName="PortalHomePageHeader",Vr.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}try{Vr.displayName="PortalHomePageHeader",Vr.__docgenInfo={description:"",displayName:"PortalHomePageHeader",props:{backgroundCss:{defaultValue:null,description:"",name:"backgroundCss",required:!0,type:{name:"string"}},buttonLink:{defaultValue:null,description:"",name:"buttonLink",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},subTitle:{defaultValue:null,description:"",name:"subTitle",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},backgroundMp4:{defaultValue:null,description:"",name:"backgroundMp4",required:!1,type:{name:"string"}},backgroundMp4Css:{defaultValue:null,description:"",name:"backgroundMp4Css",required:!1,type:{name:"string"}}}}}catch{}const gd=({partner:e,imageColIndex:c,organizationNameColIndex:m,websiteColIndex:d,entityId:o,isLoading:u})=>{const n=e.values[c]??"",i=ls(n??"",o);if(!(!i&&!(e!=null&&e.values[m])))return u?j.jsx(os,{variant:"rectangular",height:101,width:156}):j.jsx(jr,{href:e.values[d]??"",target:"_blank",sx:{display:"flex",alignItems:"center",justifyContent:"center",textDecoration:"none !important"},children:i?j.jsx(as,{component:"img",image:i,"aria-hidden":"true",sx:{width:"156px",height:"101px",objectFit:"contain",borderRadius:"10px"}}):j.jsx(xe,{sx:{display:"flex",width:"165px",padding:"3px",flexDirection:"column",gap:"10px",border:"2px solid",borderColor:"grey.900",backgroundColor:"#FFF",textAlign:"center"},children:j.jsx(xe,{sx:{display:"flex",padding:"10px",justifyContent:"center",alignItems:"center",gap:"10px",border:"1px solid",borderColor:"grey.900"},children:j.jsx(Xe,{variant:"headline3",sx:{fontSize:"14px",fontWeight:400,lineHeight:"130%",color:"grey.900"},children:e==null?void 0:e.values[m??-1]})})})})},Ks=({sql:e,titleText:c="Our Partners"})=>{const m=uu(e),d={partMask:lu|ss,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",entityId:m,query:{sql:e}},{data:o,isLoading:u}=iu(d),n=(o==null?void 0:o.queryResult.queryResults.rows)??[];let i;(a=>{a.CARDLOGO="cardLogo",a.ORGANIZATION_NAME="organizationName",a.WEBSITE="website"})(i||(i={}));const s=ct("cardLogo",o),r=ct("organizationName",o),t=ct("website",o);return j.jsxs(xe,{sx:{display:"grid",padding:{xs:"40px",lg:"20px 80px"},gridTemplateColumns:{xs:"1fr",md:"1fr 3fr"},gap:"50px"},children:[j.jsx(cu,{title:c,sx:{h2:{fontSize:"24px",paddingTop:"26px",width:"100%"}}}),j.jsx(xe,{sx:a=>({display:"flex",flexWrap:"wrap",gap:"64px",flex:"1 1 0",[a.breakpoints.down("sm")]:{justifyContent:"center"}}),children:n==null?void 0:n.map((a,p)=>j.jsx(gd,{partner:a,imageColIndex:s,organizationNameColIndex:r,websiteColIndex:t,entityId:m,isLoading:u},`partner-${p}`))})]})};try{Ks.displayName="PortalFeaturedPartners",Ks.__docgenInfo={description:"",displayName:"PortalFeaturedPartners",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},titleText:{defaultValue:{value:"Our Partners"},description:"",name:"titleText",required:!1,type:{name:"string"}}}}}catch{}function Xi(e){const{sourceEntityId:c,gridSessionId:m}=e,{mutate:d,isPending:o}=dd({onSuccess:u=>{bd(u)},onError:u=>{Et(u.message,"danger")}});return j.jsx(Gt,{loading:o,onClick:()=>{d({gridSessionId:m,sourceEntityId:c})},variant:"contained",children:"Update table with changes"})}function bd(e){var c,m;if((c=e.results)!=null&&c.length){const d=e.results[0];if(Nc(d)){const o=yd(d).join(`
`);o?Et(`Some changes could not be applied:
${o}`,"danger"):Et("Changes applied successfully","success")}else if(Ec(d)){const o=(m=d.rowsProcessed)==null?void 0:m.toLocaleString();Et(`Successfully updated ${o} rows.`,"success")}}}function yd(e){var c;return((c=e.updateResults)==null?void 0:c.filter(m=>!!m.failureCode).map(m=>`${m.entityId}: ${m.failureMessage} (code: ${m.failureCode})`))??[]}try{Xi.displayName="MergeGridWithSourceTableButton",Xi.__docgenInfo={description:"",displayName:"MergeGridWithSourceTableButton",props:{sourceEntityId:{defaultValue:null,description:"",name:"sourceEntityId",required:!0,type:{name:"string"}},gridSessionId:{defaultValue:null,description:"",name:"gridSessionId",required:!0,type:{name:"string"}}}}}catch{}const mu="__rowKey",vd=e=>{const c=e.trim();if(c){if(c.toUpperCase().startsWith("SELECT"))return{type:"sql",input:c};if(/^[A-Za-z]\w*=+$/.test(c))return{type:"sessionId",input:c}}else return{type:"empty",input:""};return{type:"unknown",input:c}};function wd(e,c){const m=Object.keys(e),d=Object.keys(c);if(m.length!==d.length)return!1;for(const o of m){const u=e[o],n=c[o],i=s=>s==null||s==="";if(!(i(u)&&i(n))&&String(u)!==String(n))return!1}return!0}function _d(e,c,m){function d(o){if(o.type==="UPDATE"){const u=c.slice(o.fromRowIndex,o.toRowIndex),n=e.slice(o.fromRowIndex,o.toRowIndex);return u.map((s,r)=>wd(s,n[r])).every(Boolean)}return!1}return m.filter(o=>!d(o))}function Sd(e){return`[${e.sid},${e.time}]`}function xd(e){const c=new Map,m=/^#\/([^:]+):\s*(.*)$/;for(const d of e){if(typeof d!="string")continue;const u=d.trimStart().match(m);if(u){const n=u[1].trim(),i=u[2].trim();c.has(n)||c.set(n,[]),c.get(n).push(i)}}return c}function Cd(e,c){if(!e||!c)return[];const{columnNames:m,columnOrder:d,rows:o}=c;return o.map(n=>{var s,r;const i={};return d.forEach(t=>{const a=m[t];a&&(i[a]=n.data[t])}),i[mu]=Sd(e.api.obj(["rows",String(o.indexOf(n))]).node.id),i.__validationResults=(s=n.metadata)==null?void 0:s.rowValidation,(r=i.__validationResults)!=null&&r.allValidationMessages&&(i.__cellValidationResults=xd(i.__validationResults.allValidationMessages)),i})}function Od(e){return It(e)&&"type"in e&&(e.type=="null"||Yc(e.type,["null"]))}function gu(e){if(e!=null&&e.oneOf&&Wt(e.oneOf)){const c=e.oneOf.filter(m=>!Od(m));if(c.length==1&&It(c[0]))return c[0]}}function Rd(e){return{value:e.value}}function Nd(e){return Wt(e)&&e.every(c=>It(c)&&"const"in c)}function Ed(e){let c=[];if(e!=null&&e.oneOf&&Wt(e.oneOf)&&!Nd(e.oneOf)){const m=gu(e);m&&Object.hasOwn(m,"enum")&&(c=Ms(m)||[])}else c=Ms(e)||[];return c.map(Rd)}function Ys(e,c){return Xc(e,[Lc,c],{})}function Td(e){if(!e||!It(e))return[];const c=new Set,m=new Set;function d(o){if(!(!It(o)||m.has(o))){if(m.add(o),Wt(o.required))for(const u of o.required)typeof u=="string"&&c.add(u);["allOf"].forEach(u=>{const n=o[u];Wt(n)&&n.forEach(i=>d(i))})}}return d(e),Array.from(c)}function bu(e){if(e.type)return e.type;if(e!=null&&e.oneOf&&Wt(e.oneOf)){const c=gu(e);if(c)return bu(c)}}var ri={},Ae={},ii={},Xs;function Id(){return Xs||(Xs=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.useColumnWidths=e.getColumnWidths=void 0;const c=fe(),m=(o,u)=>{const n=u.map(({basis:s,minWidth:r,maxWidth:t})=>({basis:s,minWidth:r,maxWidth:t,size:s,violation:0,frozen:!1,factor:0}));let i=n.reduce((s,r)=>s-r.size,o);i>0?u.forEach(({grow:s},r)=>{n[r].factor=s}):i<0&&u.forEach(({shrink:s},r)=>{n[r].factor=s});for(const s of n)s.factor===0&&(s.frozen=!0);for(;n.some(({frozen:s})=>!s);){const s=n.reduce((t,a)=>t+(a.frozen?0:a.factor),0);let r=0;for(const t of n)t.frozen||(t.size+=i*t.factor/s,t.size<t.minWidth?t.violation=t.minWidth-t.size:t.maxWidth!==void 0&&t.size>t.maxWidth?t.violation=t.maxWidth-t.size:t.violation=0,t.size+=t.violation,r+=t.violation);if(r>0)for(const t of n)t.violation>0&&(t.frozen=!0);else if(r<0)for(const t of n)t.violation<0&&(t.frozen=!0);else break;i=n.reduce((t,a)=>t-a.size,o)}return n.map(({size:s})=>s)};e.getColumnWidths=m;const d=(o,u)=>{const n=o.map(({basis:i,minWidth:s,maxWidth:r,grow:t,shrink:a})=>[i,s,r,t,a].join(",")).join("|");return(0,c.useMemo)(()=>{if(u===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};const i=(0,e.getColumnWidths)(u,o);let s=0;const r=i.map((t,a)=>(s+=t,a===i.length-1?1/0:s));return{fullWidth:Math.abs(u-s)<.1,columnWidths:i,columnRights:r,totalWidth:s}},[u,n])};e.useColumnWidths=d}(ii)),ii}var Qi=function(e,c){return Qi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,d){m.__proto__=d}||function(m,d){for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(m[o]=d[o])},Qi(e,c)};function yu(e,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");Qi(e,c);function m(){this.constructor=e}e.prototype=c===null?Object.create(c):(m.prototype=c.prototype,new m)}var zt=function(){return zt=Object.assign||function(c){for(var m,d=1,o=arguments.length;d<o;d++){m=arguments[d];for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(c[u]=m[u])}return c},zt.apply(this,arguments)};function vu(e,c){var m={};for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&c.indexOf(d)<0&&(m[d]=e[d]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,d=Object.getOwnPropertySymbols(e);o<d.length;o++)c.indexOf(d[o])<0&&Object.prototype.propertyIsEnumerable.call(e,d[o])&&(m[d[o]]=e[d[o]]);return m}var Or=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ee.global<"u"?Ee.global:typeof self<"u"?self:{};function kd(e){var c=typeof e;return e!=null&&(c=="object"||c=="function")}var us=kd,jd=typeof Or=="object"&&Or&&Or.Object===Object&&Or,Vd=jd,Ad=Vd,Pd=typeof self=="object"&&self&&self.Object===Object&&self,Md=Ad||Pd||Function("return this")(),wu=Md,qd=wu,Dd=function(){return qd.Date.now()},Bd=Dd,Fd=/\s/;function Ld(e){for(var c=e.length;c--&&Fd.test(e.charAt(c)););return c}var Ud=Ld,$d=Ud,zd=/^\s+/;function Gd(e){return e&&e.slice(0,$d(e)+1).replace(zd,"")}var Wd=Gd,Hd=wu,Jd=Hd.Symbol,_u=Jd,Qs=_u,Su=Object.prototype,Kd=Su.hasOwnProperty,Yd=Su.toString,Qt=Qs?Qs.toStringTag:void 0;function Xd(e){var c=Kd.call(e,Qt),m=e[Qt];try{e[Qt]=void 0;var d=!0}catch{}var o=Yd.call(e);return d&&(c?e[Qt]=m:delete e[Qt]),o}var Qd=Xd,Zd=Object.prototype,ef=Zd.toString;function tf(e){return ef.call(e)}var nf=tf,Zs=_u,rf=Qd,sf=nf,of="[object Null]",af="[object Undefined]",eo=Zs?Zs.toStringTag:void 0;function lf(e){return e==null?e===void 0?af:of:eo&&eo in Object(e)?rf(e):sf(e)}var uf=lf;function cf(e){return e!=null&&typeof e=="object"}var df=cf,ff=uf,hf=df,pf="[object Symbol]";function mf(e){return typeof e=="symbol"||hf(e)&&ff(e)==pf}var gf=mf,bf=Wd,to=us,yf=gf,no=NaN,vf=/^[-+]0x[0-9a-f]+$/i,wf=/^0b[01]+$/i,_f=/^0o[0-7]+$/i,Sf=parseInt;function xf(e){if(typeof e=="number")return e;if(yf(e))return no;if(to(e)){var c=typeof e.valueOf=="function"?e.valueOf():e;e=to(c)?c+"":c}if(typeof e!="string")return e===0?e:+e;e=bf(e);var m=wf.test(e);return m||_f.test(e)?Sf(e.slice(2),m?2:8):vf.test(e)?no:+e}var Cf=xf,Of=us,si=Bd,ro=Cf,Rf="Expected a function",Nf=Math.max,Ef=Math.min;function Tf(e,c,m){var d,o,u,n,i,s,r=0,t=!1,a=!1,p=!0;if(typeof e!="function")throw new TypeError(Rf);c=ro(c)||0,Of(m)&&(t=!!m.leading,a="maxWait"in m,u=a?Nf(ro(m.maxWait)||0,c):u,p="trailing"in m?!!m.trailing:p);function f(S){var C=d,O=o;return d=o=void 0,r=S,n=e.apply(O,C),n}function w(S){return r=S,i=setTimeout(l,c),t?f(S):n}function y(S){var C=S-s,O=S-r,x=c-C;return a?Ef(x,u-O):x}function b(S){var C=S-s,O=S-r;return s===void 0||C>=c||C<0||a&&O>=u}function l(){var S=si();if(b(S))return h(S);i=setTimeout(l,y(S))}function h(S){return i=void 0,p&&d?f(S):(d=o=void 0,n)}function g(){i!==void 0&&clearTimeout(i),r=0,d=s=o=i=void 0}function v(){return i===void 0?n:h(si())}function _(){var S=si(),C=b(S);if(d=arguments,o=this,s=S,C){if(i===void 0)return w(s);if(a)return clearTimeout(i),i=setTimeout(l,c),f(s)}return i===void 0&&(i=setTimeout(l,c)),n}return _.cancel=g,_.flush=v,_}var xu=Tf,If=xu,kf=us,jf="Expected a function";function Vf(e,c,m){var d=!0,o=!0;if(typeof e!="function")throw new TypeError(jf);return kf(m)&&(d="leading"in m?!!m.leading:d,o="trailing"in m?!!m.trailing:o),If(e,c,{leading:d,maxWait:c,trailing:o})}var Af=Vf,Cu=function(e,c,m,d){switch(c){case"debounce":return xu(e,m,d);case"throttle":return Af(e,m,d);default:return e}},Zi=function(e){return typeof e=="function"},dt=function(){return typeof window>"u"},io=function(e){return e instanceof Element||e instanceof HTMLDocument},Ou=function(e,c,m,d){return function(o){var u=o.width,n=o.height;c(function(i){return i.width===u&&i.height===n||i.width===u&&!d||i.height===n&&!m?i:(e&&Zi(e)&&e(u,n),{width:u,height:n})})}},Ru=function(e){yu(c,e);function c(m){var d=e.call(this,m)||this;d.cancelHandler=function(){d.resizeHandler&&d.resizeHandler.cancel&&(d.resizeHandler.cancel(),d.resizeHandler=null)},d.attachObserver=function(){var r=d.props,t=r.targetRef,a=r.observerOptions;if(!dt()){t&&t.current&&(d.targetRef.current=t.current);var p=d.getElement();p&&(d.observableElement&&d.observableElement===p||(d.observableElement=p,d.resizeObserver.observe(p,a)))}},d.getElement=function(){var r=d.props,t=r.querySelector,a=r.targetDomEl;if(dt())return null;if(t)return document.querySelector(t);if(a&&io(a))return a;if(d.targetRef&&io(d.targetRef.current))return d.targetRef.current;var p=Qc.findDOMNode(d);if(!p)return null;var f=d.getRenderType();switch(f){case"renderProp":return p;case"childFunction":return p;case"child":return p;case"childArray":return p;default:return p.parentElement}},d.createResizeHandler=function(r){var t=d.props,a=t.handleWidth,p=a===void 0?!0:a,f=t.handleHeight,w=f===void 0?!0:f,y=t.onResize;if(!(!p&&!w)){var b=Ou(y,d.setState.bind(d),p,w);r.forEach(function(l){var h=l&&l.contentRect||{},g=h.width,v=h.height,_=!d.skipOnMount&&!dt();_&&b({width:g,height:v}),d.skipOnMount=!1})}},d.getRenderType=function(){var r=d.props,t=r.render,a=r.children;return Zi(t)?"renderProp":Zi(a)?"childFunction":z.isValidElement(a)?"child":Array.isArray(a)?"childArray":"parent"};var o=m.skipOnMount,u=m.refreshMode,n=m.refreshRate,i=n===void 0?1e3:n,s=m.refreshOptions;return d.state={width:void 0,height:void 0},d.skipOnMount=o,d.targetRef=z.createRef(),d.observableElement=null,dt()||(d.resizeHandler=Cu(d.createResizeHandler,u,i,s),d.resizeObserver=new window.ResizeObserver(d.resizeHandler)),d}return c.prototype.componentDidMount=function(){this.attachObserver()},c.prototype.componentDidUpdate=function(){this.attachObserver()},c.prototype.componentWillUnmount=function(){dt()||(this.observableElement=null,this.resizeObserver.disconnect(),this.cancelHandler())},c.prototype.render=function(){var m=this.props,d=m.render,o=m.children,u=m.nodeType,n=u===void 0?"div":u,i=this.state,s=i.width,r=i.height,t={width:s,height:r,targetRef:this.targetRef},a=this.getRenderType(),p;switch(a){case"renderProp":return d&&d(t);case"childFunction":return p=o,p(t);case"child":if(p=o,p.type&&typeof p.type=="string"){t.targetRef;var f=vu(t,["targetRef"]);return z.cloneElement(p,f)}return z.cloneElement(p,t);case"childArray":return p=o,p.map(function(w){return!!w&&z.cloneElement(w,t)});default:return z.createElement(n,null)}},c}(z.PureComponent);function Pf(e,c){c===void 0&&(c={});var m=function(u){yu(n,u);function n(){var i=u!==null&&u.apply(this,arguments)||this;return i.ref=z.createRef(),i}return n.prototype.render=function(){var i=this.props,s=i.forwardedRef,r=vu(i,["forwardedRef"]),t=s??this.ref;return z.createElement(Ru,zt({},c,{targetRef:t}),z.createElement(e,zt({targetRef:t},r)))},n}(z.Component);function d(u,n){return z.createElement(m,zt({},u,{forwardedRef:n}))}var o=e.displayName||e.name;return d.displayName="withResizeDetector(".concat(o,")"),z.forwardRef(d)}var Mf=dt()?z.useEffect:z.useLayoutEffect;function qf(e){e===void 0&&(e={});var c=e.skipOnMount,m=c===void 0?!1:c,d=e.refreshMode,o=e.refreshRate,u=o===void 0?1e3:o,n=e.refreshOptions,i=e.handleWidth,s=i===void 0?!0:i,r=e.handleHeight,t=r===void 0?!0:r,a=e.targetRef,p=e.observerOptions,f=e.onResize,w=z.useRef(m),y=z.useRef(null),b=a??y,l=z.useRef(),h=z.useState({width:void 0,height:void 0}),g=h[0],v=h[1];return Mf(function(){if(!dt()){var _=Ou(f,v,s,t),S=function(O){!s&&!t||O.forEach(function(x){var R=x&&x.contentRect||{},E=R.width,I=R.height,N=!w.current&&!dt();N&&_({width:E,height:I}),w.current=!1})};l.current=Cu(S,d,u,n);var C=new window.ResizeObserver(l.current);return b.current&&C.observe(b.current,p),function(){C.disconnect();var O=l.current;O&&O.cancel&&O.cancel()}}},[d,u,n,s,t,f,p,b.current]),zt({ref:b},g)}const Df=Object.freeze(Object.defineProperty({__proto__:null,default:Ru,useResizeDetector:qf,withResizeDetector:Pf},Symbol.toStringTag,{value:"Module"})),Bf=au(Df);var tt={},so;function Ff(){return so||(so=1,function(e){var c=tt&&tt.__createBinding||(Object.create?function(w,y,b,l){l===void 0&&(l=b);var h=Object.getOwnPropertyDescriptor(y,b);(!h||("get"in h?!y.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return y[b]}}),Object.defineProperty(w,l,h)}:function(w,y,b,l){l===void 0&&(l=b),w[l]=y[b]}),m=tt&&tt.__setModuleDefault||(Object.create?function(w,y){Object.defineProperty(w,"default",{enumerable:!0,value:y})}:function(w,y){w.default=y}),d=tt&&tt.__importStar||function(w){if(w&&w.__esModule)return w;var y={};if(w!=null)for(var b in w)b!=="default"&&Object.prototype.hasOwnProperty.call(w,b)&&c(y,w,b);return m(y,w),y};Object.defineProperty(e,"__esModule",{value:!0}),e.useColumns=e.parseFlexValue=void 0;const o=d(fe()),u=()=>o.default.createElement(o.default.Fragment,null),n=()=>!1,i=({rowData:w})=>w,s=()=>null,r=({rowIndex:w})=>o.default.createElement(o.default.Fragment,null,w+1),t=()=>!0,a=w=>w,p=w=>{if(typeof w=="number")return{basis:0,grow:w,shrink:1};if(w.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(w.trim()),shrink:1};if(w.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(w.trim()),grow:1,shrink:1};if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){const[y,b]=w.trim().split(" ");return{basis:0,grow:parseFloat(y),shrink:parseFloat(b)}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,b]=w.trim().split(" ");return{basis:parseFloat(b),grow:parseFloat(y),shrink:1}}if(w.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){const[y,b,l]=w.trim().split(" ");return{basis:parseFloat(l),grow:parseFloat(y),shrink:parseFloat(b)}}return{basis:0,grow:1,shrink:1}};e.parseFlexValue=p;const f=(w,y,b)=>(0,o.useMemo)(()=>{var l,h,g,v,_,S,C,O,x,R;const E=[y===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>o.default.createElement(o.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:t}:Object.assign(Object.assign({},y),{basis:(l=y==null?void 0:y.basis)!==null&&l!==void 0?l:40,grow:(h=y==null?void 0:y.grow)!==null&&h!==void 0?h:0,shrink:(g=y==null?void 0:y.shrink)!==null&&g!==void 0?g:0,minWidth:(v=y==null?void 0:y.minWidth)!==null&&v!==void 0?v:0,title:(_=y==null?void 0:y.title)!==null&&_!==void 0?_:o.default.createElement("div",{className:"dsg-corner-indicator"}),component:(S=y==null?void 0:y.component)!==null&&S!==void 0?S:r,isCellEmpty:t}),...w];return b&&E.push(Object.assign(Object.assign({},b),{basis:(C=b==null?void 0:b.basis)!==null&&C!==void 0?C:40,grow:(O=b==null?void 0:b.grow)!==null&&O!==void 0?O:0,shrink:(x=b==null?void 0:b.shrink)!==null&&x!==void 0?x:0,minWidth:(R=b.minWidth)!==null&&R!==void 0?R:0,isCellEmpty:t})),E.map(I=>{var N,P,A,M,B,U,$,H,Z,Y,Q,ie,Ce,Te,be,ot;const at=I.width!==void 0?(0,e.parseFlexValue)(I.width):{basis:void 0,grow:void 0,shrink:void 0};return Object.assign(Object.assign({},I),{basis:(P=(N=I.basis)!==null&&N!==void 0?N:at.basis)!==null&&P!==void 0?P:0,grow:(M=(A=I.grow)!==null&&A!==void 0?A:at.grow)!==null&&M!==void 0?M:1,shrink:(U=(B=I.shrink)!==null&&B!==void 0?B:at.shrink)!==null&&U!==void 0?U:1,minWidth:($=I.minWidth)!==null&&$!==void 0?$:100,component:(H=I.component)!==null&&H!==void 0?H:u,disableKeys:(Z=I.disableKeys)!==null&&Z!==void 0?Z:!1,disabled:(Y=I.disabled)!==null&&Y!==void 0?Y:!1,keepFocus:(Q=I.keepFocus)!==null&&Q!==void 0?Q:!1,deleteValue:(ie=I.deleteValue)!==null&&ie!==void 0?ie:i,copyValue:(Ce=I.copyValue)!==null&&Ce!==void 0?Ce:s,pasteValue:(Te=I.pasteValue)!==null&&Te!==void 0?Te:i,prePasteValues:(be=I.prePasteValues)!==null&&be!==void 0?be:a,isCellEmpty:(ot=I.isCellEmpty)!==null&&ot!==void 0?ot:n})})},[y,b,w]);e.useColumns=f}(tt)),tt}var Zt={},en={},oo;function cs(){if(oo)return en;oo=1,Object.defineProperty(en,"__esModule",{value:!0});function e(m,d,o,u){var n,i=!1,s=0;function r(){n&&clearTimeout(n)}function t(){r(),i=!0}typeof d!="boolean"&&(u=o,o=d,d=void 0);function a(){for(var p=arguments.length,f=new Array(p),w=0;w<p;w++)f[w]=arguments[w];var y=this,b=Date.now()-s;if(i)return;function l(){s=Date.now(),o.apply(y,f)}function h(){n=void 0}u&&!n&&l(),r(),u===void 0&&b>m?l():d!==!0&&(n=setTimeout(u?h:l,u===void 0?m-b:m))}return a.cancel=t,a}function c(m,d,o){return o===void 0?e(m,d,!1):e(m,o,d!==!1)}return en.debounce=c,en.throttle=e,en}var gt={},ao;function Nu(){if(ao)return gt;ao=1;var e=gt&&gt.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(gt,"__esModule",{value:!0}),gt.useDeepEqualState=void 0;const c=fe(),m=e(ou()),d=o=>{const[u,n]=(0,c.useState)(o),i=(0,c.useCallback)(s=>{n(r=>{const t=typeof s=="function"?s(r):s;return(0,m.default)(t,r)?r:t})},[n]);return[u,i]};return gt.useDeepEqualState=d,gt}var lo;function Lf(){if(lo)return Zt;lo=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.useEdges=void 0;const e=fe(),c=cs(),m=Nu(),d=(o,u,n)=>{const[i,s]=(0,m.useDeepEqualState)({top:!0,right:!0,bottom:!0,left:!0});return(0,e.useEffect)(()=>{const r=(0,c.throttle)(100,()=>{var a,p,f,w,y,b,l,h,g,v;s({top:((a=o.current)===null||a===void 0?void 0:a.scrollTop)===0,right:((f=(p=o.current)===null||p===void 0?void 0:p.scrollLeft)!==null&&f!==void 0?f:0)>=((y=(w=o.current)===null||w===void 0?void 0:w.scrollWidth)!==null&&y!==void 0?y:0)-(u??0)-1,bottom:((l=(b=o.current)===null||b===void 0?void 0:b.scrollTop)!==null&&l!==void 0?l:0)>=((g=(h=o.current)===null||h===void 0?void 0:h.scrollHeight)!==null&&g!==void 0?g:0)-(n??0)-1,left:((v=o.current)===null||v===void 0?void 0:v.scrollLeft)===0})}),t=o.current;return t==null||t.addEventListener("scroll",r),setTimeout(r,100),()=>{t==null||t.removeEventListener("scroll",r),r.cancel()}},[n,u,o,s]),i};return Zt.useEdges=d,Zt}var tn={},uo;function Eu(){if(uo)return tn;uo=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.useDocumentEventListener=void 0;const e=fe(),c=(m,d)=>{(0,e.useEffect)(()=>(document.addEventListener(m,d),()=>{document.removeEventListener(m,d)}),[d,m])};return tn.useDocumentEventListener=c,tn}var nn={},co;function Uf(){if(co)return nn;co=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.useGetBoundingClientRect=void 0;const e=fe(),c=cs(),m=(d,o=200)=>{const u=(0,e.useRef)(null),n=(0,e.useMemo)(()=>(0,c.throttle)(o,!0,()=>{setTimeout(()=>{var i;return u.current=((i=d.current)===null||i===void 0?void 0:i.getBoundingClientRect())||null},0)}),[d,o]);return(0,e.useCallback)((i=!1)=>{var s;return i?u.current=((s=d.current)===null||s===void 0?void 0:s.getBoundingClientRect())||null:n(),u.current},[d,n])};return nn.useGetBoundingClientRect=m,nn}var nt={},fo;function Tu(){return fo||(fo=1,function(e){var c=nt&&nt.__createBinding||(Object.create?function(n,i,s,r){r===void 0&&(r=s);var t=Object.getOwnPropertyDescriptor(i,s);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(n,r,t)}:function(n,i,s,r){r===void 0&&(r=s),n[r]=i[s]}),m=nt&&nt.__setModuleDefault||(Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i}),d=nt&&nt.__importStar||function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var s in n)s!=="default"&&Object.prototype.hasOwnProperty.call(n,s)&&c(i,n,s);return m(i,n),i};Object.defineProperty(e,"__esModule",{value:!0}),e.AddRows=e.createAddRowsComponent=void 0;const o=d(fe()),u=(n={})=>({addRows:i})=>{var s,r;const[t,a]=(0,o.useState)(1),[p,f]=(0,o.useState)(String(t));return o.default.createElement("div",{className:"dsg-add-row"},o.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>i(t)},(s=n.button)!==null&&s!==void 0?s:"Add")," ",o.default.createElement("input",{className:"dsg-add-row-input",value:p,onBlur:()=>f(String(t)),type:"number",min:1,onChange:w=>{f(w.target.value),a(Math.max(1,Math.round(parseInt(w.target.value)||0)))},onKeyDown:w=>{w.key==="Enter"&&i(t)}})," ",(r=n.unit)!==null&&r!==void 0?r:"rows")};e.createAddRowsComponent=u,e.AddRows=(0,e.createAddRowsComponent)(),e.AddRows.displayName="AddRows"}(nt)),nt}var rn={},ho;function $f(){if(ho)return rn;ho=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.useDebounceState=void 0;const e=fe(),c=cs(),m=(d,o)=>{const[u,n]=(0,e.useState)(d),i=(0,e.useRef)();(0,e.useEffect)(()=>()=>{var r;return(r=i.current)===null||r===void 0?void 0:r.cancel()},[]);const s=(0,e.useMemo)(()=>i.current=(0,c.debounce)(o,r=>{n(r)}),[o]);return[u,s]};return rn.useDebounceState=m,rn}var rt={},po;function Iu(){return po||(po=1,function(e){var c=rt&&rt.__createBinding||(Object.create?function(r,t,a,p){p===void 0&&(p=a);var f=Object.getOwnPropertyDescriptor(t,a);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(r,p,f)}:function(r,t,a,p){p===void 0&&(p=a),r[p]=t[a]}),m=rt&&rt.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),d=rt&&rt.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&c(t,r,a);return m(t,r),t};Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=e.createContextMenuComponent=e.defaultRenderItem=void 0;const o=d(fe()),u=fe(),n=Eu(),i=r=>r.type==="CUT"?o.createElement(o.Fragment,null,"Cut"):r.type==="COPY"?o.createElement(o.Fragment,null,"Copy"):r.type==="PASTE"?o.createElement(o.Fragment,null,"Paste"):r.type==="DELETE_ROW"?o.createElement(o.Fragment,null,"Delete row"):r.type==="DELETE_ROWS"?o.createElement(o.Fragment,null,"Delete rows ",o.createElement("b",null,r.fromRow)," to ",o.createElement("b",null,r.toRow)):r.type==="INSERT_ROW_BELLOW"?o.createElement(o.Fragment,null,"Insert row below"):r.type==="DUPLICATE_ROW"?o.createElement(o.Fragment,null,"Duplicate row"):r.type==="DUPLICATE_ROWS"?o.createElement(o.Fragment,null,"Duplicate rows ",o.createElement("b",null,r.fromRow)," to ",o.createElement("b",null,r.toRow)):r.type;e.defaultRenderItem=i;const s=(r=e.defaultRenderItem)=>({clientX:t,clientY:a,items:p,close:f})=>{const w=(0,u.useRef)(null),y=(0,u.useCallback)(b=>{var l;((l=w.current)===null||l===void 0?void 0:l.contains(b.target))||f()},[f]);return(0,n.useDocumentEventListener)("mousedown",y),o.createElement("div",{className:"dsg-context-menu",style:{left:t+"px",top:a+"px"},ref:w},p.map(b=>o.createElement("div",{key:b.type,onClick:b.action,className:"dsg-context-menu-item"},r(b))))};e.createContextMenuComponent=s,e.ContextMenu=(0,e.createContextMenuComponent)(e.defaultRenderItem),e.ContextMenu.displayName="ContextMenu"}(rt)),rt}var Ge={},sn={},mo;function zf(){if(mo)return sn;mo=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.parseDom=void 0;const e=typeof DOMParser<"u"?new DOMParser:{parseFromString:()=>null},c=m=>e.parseFromString(m,"text/html");return sn.parseDom=c,sn}var go;function Gf(){if(go)return Ge;go=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.isPrintableUnicode=Ge.encodeHtml=Ge.parseTextPlainData=Ge.parseTextHtmlData=void 0;const e=zf(),c=u=>{var n,i;const s=(0,e.parseDom)(u.replace(/<br\/?>/g,`
`)),r=s.getElementsByTagName("table")[0];if(r){const a=[];for(let p=0;p<r.rows.length;p++){const f=[];a.push(f);for(let w=0;w<r.rows[p].cells.length;w++)f.push((n=r.rows[p].cells[w].textContent)!==null&&n!==void 0?n:"")}return a}const t=s.getElementsByTagName("span")[0];return t?[[(i=t.textContent)!==null&&i!==void 0?i:""]]:[[""]]};Ge.parseTextHtmlData=c;const m=u=>{const n=u.replace(/\r|\n$/g,""),i=[[]];let s=0,r=0,t=!1,a=0;const p=()=>{let f=n.slice(r,s);f[0]==='"'&&f[f.length-1]==='"'&&(t=!0),t&&f[f.length-1]==='"'&&f.includes(`
`)&&(f=f.slice(1,f.length-1).replace(/""/g,'"'),t=!1),t&&f[f.length-1]!=='"'?f.split(`
`).forEach((w,y,{length:b})=>{i[a].push(w),y<b-1&&(i.push([]),a++)}):i[a].push(f)};for(;s<n.length;)t&&n[s]==='"'&&![void 0,"	",'"'].includes(n[s+1])&&(t=!1),t&&n[s]==='"'&&n[s+1]==='"'&&s++,s===r&&n[s]==='"'&&(t=!0),n[s]==="	"&&(p(),r=s+1,t=!1),n[s]===`
`&&!t&&(p(),i.push([]),r=s+1,a++),s++;return p(),i};Ge.parseTextPlainData=m;const d=u=>u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");Ge.encodeHtml=d;const o=u=>u.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;return Ge.isPrintableUnicode=o,Ge}var oi={},bo;function Wf(){return bo||(bo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSelectionWithId=e.getSelection=e.getCellWithId=e.getCell=void 0;const c=(u,n,i,s)=>{if(u===null||!n||!i)return null;if(typeof u!="object")throw new Error("Value must be an object or null");const r=s.findIndex(a=>a.id===u.col),t={col:Math.max(0,Math.min(n-1,r===-1?Number(u.col):r-1)),row:Math.max(0,Math.min(i-1,Number(u.row)))};if(isNaN(t.col)||isNaN(t.row))throw new Error("col or cell are not valid positive numbers");return t};e.getCell=c;const m=(u,n)=>{var i;return u?{col:u.col,row:u.row,colId:(i=n[u.col+1])===null||i===void 0?void 0:i.id}:null};e.getCellWithId=m;const d=(u,n,i,s)=>{if(u===null||!n||!i)return null;if(typeof u!="object")throw new Error("Value must be an object or null");const r={min:(0,e.getCell)(u.min,n,i,s),max:(0,e.getCell)(u.max,n,i,s)};if(!r.min||!r.max)throw new Error("min and max must be defined");return r};e.getSelection=d;const o=(u,n)=>u?{min:(0,e.getCellWithId)(u.min,n),max:(0,e.getCellWithId)(u.max,n)}:null;e.getSelectionWithId=o}(oi)),oi}var on={},yo;function Hf(){if(yo)return on;yo=1,Object.defineProperty(on,"__esModule",{value:!0}),on.getAllTabbableElements=void 0;const e=()=>Array.from(document.querySelectorAll("*")).filter(c=>c instanceof HTMLElement&&typeof c.tabIndex=="number"&&c.tabIndex>=0&&!c.disabled&&(!(c instanceof HTMLAnchorElement)||!!c.href||c.getAttribute("tabIndex")!==null)&&getComputedStyle(c).visibility!=="collapse");return on.getAllTabbableElements=e,on}var Pe={},ai={},li={},ui={},vo;function Jf(){return vo||(vo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function c(u,n,i){let s=i.initialDeps??[],r;function t(){var a,p,f,w;let y;i.key&&((a=i.debug)!=null&&a.call(i))&&(y=Date.now());const b=u();if(!(b.length!==s.length||b.some((g,v)=>s[v]!==g)))return r;s=b;let h;if(i.key&&((p=i.debug)!=null&&p.call(i))&&(h=Date.now()),r=n(...b),i.key&&((f=i.debug)!=null&&f.call(i))){const g=Math.round((Date.now()-y)*100)/100,v=Math.round((Date.now()-h)*100)/100,_=v/16,S=(C,O)=>{for(C=String(C);C.length<O;)C=" "+C;return C};console.info(`%c⏱ ${S(v,5)} /${S(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*_,120))}deg 100% 31%);`,i==null?void 0:i.key)}return(w=i==null?void 0:i.onChange)==null||w.call(i,r),r}return t.updateDeps=a=>{s=a},t}function m(u,n){if(u===void 0)throw new Error(`Unexpected undefined${n?`: ${n}`:""}`);return u}const d=(u,n)=>Math.abs(u-n)<=1,o=(u,n,i)=>{let s;return function(...r){u.clearTimeout(s),s=u.setTimeout(()=>n.apply(this,r),i)}};e.approxEqual=d,e.debounce=o,e.memo=c,e.notUndefined=m}(ui)),ui}var wo;function Kf(){return wo||(wo=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const c=Jf(),m=l=>{const{offsetWidth:h,offsetHeight:g}=l;return{width:h,height:g}},d=l=>l,o=l=>{const h=Math.max(l.startIndex-l.overscan,0),g=Math.min(l.endIndex+l.overscan,l.count-1),v=[];for(let _=h;_<=g;_++)v.push(_);return v},u=(l,h)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;const _=C=>{const{width:O,height:x}=C;h({width:Math.round(O),height:Math.round(x)})};if(_(m(g)),!v.ResizeObserver)return()=>{};const S=new v.ResizeObserver(C=>{const O=()=>{const x=C[0];if(x!=null&&x.borderBoxSize){const R=x.borderBoxSize[0];if(R){_({width:R.inlineSize,height:R.blockSize});return}}_(m(g))};l.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(O):O()});return S.observe(g,{box:"border-box"}),()=>{S.unobserve(g)}},n={passive:!0},i=(l,h)=>{const g=l.scrollElement;if(!g)return;const v=()=>{h({width:g.innerWidth,height:g.innerHeight})};return v(),g.addEventListener("resize",v,n),()=>{g.removeEventListener("resize",v)}},s=typeof window>"u"?!0:"onscrollend"in window,r=(l,h)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&s?()=>{}:c.debounce(v,()=>{h(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{const{horizontal:I,isRtl:N}=l.options;_=I?g.scrollLeft*(N&&-1||1):g.scrollTop,S(),h(_,E)},O=C(!0),x=C(!1);x(),g.addEventListener("scroll",O,n);const R=l.options.useScrollendEvent&&s;return R&&g.addEventListener("scrollend",x,n),()=>{g.removeEventListener("scroll",O),R&&g.removeEventListener("scrollend",x)}},t=(l,h)=>{const g=l.scrollElement;if(!g)return;const v=l.targetWindow;if(!v)return;let _=0;const S=l.options.useScrollendEvent&&s?()=>{}:c.debounce(v,()=>{h(_,!1)},l.options.isScrollingResetDelay),C=E=>()=>{_=g[l.options.horizontal?"scrollX":"scrollY"],S(),h(_,E)},O=C(!0),x=C(!1);x(),g.addEventListener("scroll",O,n);const R=l.options.useScrollendEvent&&s;return R&&g.addEventListener("scrollend",x,n),()=>{g.removeEventListener("scroll",O),R&&g.removeEventListener("scrollend",x)}},a=(l,h,g)=>{if(h!=null&&h.borderBoxSize){const v=h.borderBoxSize[0];if(v)return Math.round(v[g.options.horizontal?"inlineSize":"blockSize"])}return l[g.options.horizontal?"offsetWidth":"offsetHeight"]},p=(l,{adjustments:h=0,behavior:g},v)=>{var _,S;const C=l+h;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:g})},f=(l,{adjustments:h=0,behavior:g},v)=>{var _,S;const C=l+h;(S=(_=v.scrollElement)==null?void 0:_.scrollTo)==null||S.call(_,{[v.options.horizontal?"left":"top"]:C,behavior:g})};class w{constructor(h){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let g=null;const v=()=>g||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:g=new this.targetWindow.ResizeObserver(_=>{_.forEach(S=>{const C=()=>{this._measureElement(S.target,S)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(C):C()})}));return{disconnect:()=>{var _;(_=v())==null||_.disconnect(),g=null},observe:_=>{var S;return(S=v())==null?void 0:S.observe(_,{box:"border-box"})},unobserve:_=>{var S;return(S=v())==null?void 0:S.unobserve(_)}}})(),this.range=null,this.setOptions=g=>{Object.entries(g).forEach(([v,_])=>{typeof _>"u"&&delete g[v]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:d,rangeExtractor:o,onChange:()=>{},measureElement:a,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...g}},this.notify=g=>{var v,_;(_=(v=this.options).onChange)==null||_.call(v,this,g)},this.maybeNotify=c.memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),g=>{this.notify(g)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(g=>g()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var g;const v=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==v){if(this.cleanup(),!v){this.maybeNotify();return}this.scrollElement=v,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((g=this.scrollElement)==null?void 0:g.window)??null,this.elementsCache.forEach(_=>{this.observer.observe(_)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,_=>{this.scrollRect=_,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(_,S)=>{this.scrollAdjustments=0,this.scrollDirection=S?this.getScrollOffset()<_?"forward":"backward":null,this.scrollOffset=_,this.isScrolling=S,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(g,v)=>{const _=new Map,S=new Map;for(let C=v-1;C>=0;C--){const O=g[C];if(_.has(O.lane))continue;const x=S.get(O.lane);if(x==null||O.end>x.end?S.set(O.lane,O):O.end<x.end&&_.set(O.lane,!0),_.size===this.options.lanes)break}return S.size===this.options.lanes?Array.from(S.values()).sort((C,O)=>C.end===O.end?C.index-O.index:C.end-O.end)[0]:void 0},this.getMeasurementOptions=c.memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(g,v,_,S,C)=>(this.pendingMeasuredCacheIndexes=[],{count:g,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C}),{key:!1}),this.getMeasurements=c.memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:g,paddingStart:v,scrollMargin:_,getItemKey:S,enabled:C},O)=>{if(!C)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(E=>{this.itemSizeCache.set(E.key,E.size)}));const x=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const R=this.measurementsCache.slice(0,x);for(let E=x;E<g;E++){const I=S(E),N=this.options.lanes===1?R[E-1]:this.getFurthestMeasurement(R,E),P=N?N.end+this.options.gap:v+_,A=O.get(I),M=typeof A=="number"?A:this.options.estimateSize(E),B=P+M,U=N?N.lane:E%this.options.lanes;R[E]={index:E,start:P,size:M,end:B,key:I,lane:U}}return this.measurementsCache=R,R},{key:!1,debug:()=>this.options.debug}),this.calculateRange=c.memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(g,v,_,S)=>this.range=g.length>0&&v>0?b({measurements:g,outerSize:v,scrollOffset:_,lanes:S}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=c.memo(()=>{let g=null,v=null;const _=this.calculateRange();return _&&(g=_.startIndex,v=_.endIndex),this.maybeNotify.updateDeps([this.isScrolling,g,v]),[this.options.rangeExtractor,this.options.overscan,this.options.count,g,v]},(g,v,_,S,C)=>S===null||C===null?[]:g({startIndex:S,endIndex:C,overscan:v,count:_}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=g=>{const v=this.options.indexAttribute,_=g.getAttribute(v);return _?parseInt(_,10):(console.warn(`Missing attribute name '${v}={index}' on measured element.`),-1)},this._measureElement=(g,v)=>{const _=this.indexFromElement(g),S=this.measurementsCache[_];if(!S)return;const C=S.key,O=this.elementsCache.get(C);O!==g&&(O&&this.observer.unobserve(O),this.observer.observe(g),this.elementsCache.set(C,g)),g.isConnected&&this.resizeItem(_,this.options.measureElement(g,v,this))},this.resizeItem=(g,v)=>{const _=this.measurementsCache[g];if(!_)return;const S=this.itemSizeCache.get(_.key)??_.size,C=v-S;C!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(_,C,this):_.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=C,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(_.index),this.itemSizeCache=new Map(this.itemSizeCache.set(_.key,v)),this.notify(!1))},this.measureElement=g=>{if(!g){this.elementsCache.forEach((v,_)=>{v.isConnected||(this.observer.unobserve(v),this.elementsCache.delete(_))});return}this._measureElement(g,void 0)},this.getVirtualItems=c.memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(g,v)=>{const _=[];for(let S=0,C=g.length;S<C;S++){const O=g[S],x=v[O];_.push(x)}return _},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=g=>{const v=this.getMeasurements();if(v.length!==0)return c.notUndefined(v[y(0,v.length-1,_=>c.notUndefined(v[_]).start,g)])},this.getOffsetForAlignment=(g,v,_=0)=>{const S=this.getSize(),C=this.getScrollOffset();v==="auto"&&(v=g>=C+S?"end":"start"),v==="center"?g+=(_-S)/2:v==="end"&&(g-=S);const O=this.getTotalSize()-S;return Math.max(Math.min(O,g),0)},this.getOffsetForIndex=(g,v="auto")=>{g=Math.max(0,Math.min(g,this.options.count-1));const _=this.measurementsCache[g];if(!_)return;const S=this.getSize(),C=this.getScrollOffset();if(v==="auto")if(_.end>=C+S-this.options.scrollPaddingEnd)v="end";else if(_.start<=C+this.options.scrollPaddingStart)v="start";else return[C,v];const O=v==="end"?_.end+this.options.scrollPaddingEnd:_.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(O,v,_.size),v]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(g,{align:v="start",behavior:_}={})=>{this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(g,v),{adjustments:void 0,behavior:_})},this.scrollToIndex=(g,{align:v="auto",behavior:_}={})=>{g=Math.max(0,Math.min(g,this.options.count-1)),this.cancelScrollToIndex(),_==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const S=this.getOffsetForIndex(g,v);if(!S)return;const[C,O]=S;this._scrollToOffset(C,{adjustments:void 0,behavior:_}),_!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(g))){const[R]=c.notUndefined(this.getOffsetForIndex(g,O)),E=this.getScrollOffset();c.approxEqual(R,E)||this.scrollToIndex(g,{align:O,behavior:_})}else this.scrollToIndex(g,{align:O,behavior:_})}))},this.scrollBy=(g,{behavior:v}={})=>{this.cancelScrollToIndex(),v==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+g,{adjustments:void 0,behavior:v})},this.getTotalSize=()=>{var g;const v=this.getMeasurements();let _;if(v.length===0)_=this.options.paddingStart;else if(this.options.lanes===1)_=((g=v[v.length-1])==null?void 0:g.end)??0;else{const S=Array(this.options.lanes).fill(null);let C=v.length-1;for(;C>=0&&S.some(O=>O===null);){const O=v[C];S[O.lane]===null&&(S[O.lane]=O.end),C--}_=Math.max(...S.filter(O=>O!==null))}return Math.max(_-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(g,{adjustments:v,behavior:_})=>{this.options.scrollToFn(g,{behavior:_,adjustments:v},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(h)}}const y=(l,h,g,v)=>{for(;l<=h;){const _=(l+h)/2|0,S=g(_);if(S<v)l=_+1;else if(S>v)h=_-1;else return _}return l>0?l-1:0};function b({measurements:l,outerSize:h,scrollOffset:g,lanes:v}){const _=l.length-1,S=x=>l[x].start;if(l.length<=v)return{startIndex:0,endIndex:_};let C=y(0,_,S,g),O=C;if(v===1)for(;O<_&&l[O].end<g+h;)O++;else if(v>1){const x=Array(v).fill(0);for(;O<_&&x.some(E=>E<g+h);){const E=l[O];x[E.lane]=E.end,O++}const R=Array(v).fill(g+h);for(;C>=0&&R.some(E=>E>=g);){const E=l[C];R[E.lane]=E.start,C--}C=Math.max(0,C-C%v),O=Math.min(_,O+(v-1-O%v))}return{startIndex:C,endIndex:O}}e.approxEqual=c.approxEqual,e.debounce=c.debounce,e.memo=c.memo,e.notUndefined=c.notUndefined,e.Virtualizer=w,e.defaultKeyExtractor=d,e.defaultRangeExtractor=o,e.elementScroll=f,e.measureElement=a,e.observeElementOffset=r,e.observeElementRect=u,e.observeWindowOffset=t,e.observeWindowRect=i,e.windowScroll=p}(li)),li}var _o;function Yf(){return _o||(_o=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const c=fe(),m=Zc(),d=Kf();function o(t){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const p in t)if(p!=="default"){const f=Object.getOwnPropertyDescriptor(t,p);Object.defineProperty(a,p,f.get?f:{enumerable:!0,get:()=>t[p]})}}return a.default=t,Object.freeze(a)}const u=o(c),n=typeof document<"u"?u.useLayoutEffect:u.useEffect;function i(t){const a=u.useReducer(()=>({}),{})[1],p={...t,onChange:(w,y)=>{var b;y?m.flushSync(a):a(),(b=t.onChange)==null||b.call(t,w,y)}},[f]=u.useState(()=>new d.Virtualizer(p));return f.setOptions(p),n(()=>f._didMount(),[]),n(()=>f._willUpdate()),f}function s(t){return i({observeElementRect:d.observeElementRect,observeElementOffset:d.observeElementOffset,scrollToFn:d.elementScroll,...t})}function r(t){return i({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:d.observeWindowRect,observeElementOffset:d.observeWindowOffset,scrollToFn:d.windowScroll,initialOffset:()=>typeof document<"u"?window.scrollY:0,...t})}e.useVirtualizer=s,e.useWindowVirtualizer=r,Object.keys(d).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:()=>d[t]})})}(ai)),ai}var bt={},So;function Xf(){if(So)return bt;So=1;var e=bt&&bt.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(bt,"__esModule",{value:!0}),bt.Cell=void 0;const c=e(fe()),m=e(Ht()),d=({children:o,gutter:u,stickyRight:n,active:i,disabled:s,className:r,width:t,left:a})=>c.default.createElement("div",{className:(0,m.default)("dsg-cell",u&&"dsg-cell-gutter",s&&"dsg-cell-disabled",u&&i&&"dsg-cell-gutter-active",n&&"dsg-cell-sticky-right",r),style:{width:t,left:n?void 0:a}},o);return bt.Cell=d,bt}var an={},xo;function Qf(){if(xo)return an;xo=1,Object.defineProperty(an,"__esModule",{value:!0}),an.useMemoizedIndexCallback=void 0;const e=fe(),c=(m,d)=>(0,e.useMemo)(()=>{const o=new Map;return u=>(o.has(u)||o.set(u,(...n)=>{m(u,...n.slice(0,d))}),o.get(u))},[d,m]);return an.useMemoizedIndexCallback=c,an}var Co;function Zf(){if(Co)return Pe;Co=1;var e=Pe&&Pe.__createBinding||(Object.create?function(t,a,p,f){f===void 0&&(f=p);var w=Object.getOwnPropertyDescriptor(a,p);(!w||("get"in w?!a.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return a[p]}}),Object.defineProperty(t,f,w)}:function(t,a,p,f){f===void 0&&(f=p),t[f]=a[p]}),c=Pe&&Pe.__setModuleDefault||(Object.create?function(t,a){Object.defineProperty(t,"default",{enumerable:!0,value:a})}:function(t,a){t.default=a}),m=Pe&&Pe.__importStar||function(t){if(t&&t.__esModule)return t;var a={};if(t!=null)for(var p in t)p!=="default"&&Object.prototype.hasOwnProperty.call(t,p)&&e(a,t,p);return c(a,t),a},d=Pe&&Pe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Grid=void 0;const o=Yf(),u=m(fe()),n=d(Ht()),i=Xf(),s=Qf(),r=({data:t,columns:a,outerRef:p,innerRef:f,columnWidths:w,hasStickyRightColumn:y,displayHeight:b,headerRowHeight:l,rowHeight:h,rowKey:g,fullWidth:v,selection:_,activeCell:S,rowClassName:C,cellClassName:O,children:x,editing:R,getContextMenuItems:E,setRowData:I,deleteRows:N,duplicateRows:P,insertRowAfter:A,stopEditing:M,onScroll:B})=>{var U,$,H,Z;const Y=(0,o.useVirtualizer)({count:t.length,getScrollElement:()=>p.current,paddingStart:l,estimateSize:J=>h(J).height,getItemKey:J=>{if(g&&J>0){const he=t[J-1];if(typeof g=="function")return g({rowData:he,rowIndex:J});if(typeof g=="string"&&he instanceof Object&&g in he){const me=he[g];if(typeof me=="string"||typeof me=="number")return me}}return J},overscan:5}),Q=(0,o.useVirtualizer)({count:a.length,getScrollElement:()=>p.current,estimateSize:J=>{var he;return(he=w==null?void 0:w[J])!==null&&he!==void 0?he:100},horizontal:!0,getItemKey:J=>{var he;return(he=a[J].id)!==null&&he!==void 0?he:J},overscan:1,rangeExtractor:J=>{const he=(0,o.defaultRangeExtractor)(J);return he[0]!==0&&he.unshift(0),y&&he[he.length-1]!==a.length-1&&he.push(a.length-1),he}});(0,u.useEffect)(()=>{Q.measure()},[Q,w]);const ie=(0,s.useMemoizedIndexCallback)(I,1),Ce=(0,s.useMemoizedIndexCallback)(N,0),Te=(0,s.useMemoizedIndexCallback)(P,0),be=(0,s.useMemoizedIndexCallback)(A,0),ot=(U=_==null?void 0:_.min.col)!==null&&U!==void 0?U:S==null?void 0:S.col,at=($=_==null?void 0:_.max.col)!==null&&$!==void 0?$:S==null?void 0:S.col,kt=(H=_==null?void 0:_.min.row)!==null&&H!==void 0?H:S==null?void 0:S.row,Kt=(Z=_==null?void 0:_.max.row)!==null&&Z!==void 0?Z:S==null?void 0:S.row;return u.default.createElement("div",{ref:p,className:"dsg-container",onScroll:B,style:{height:b}},u.default.createElement("div",{ref:f,style:{width:v?"100%":Q.getTotalSize(),height:Y.getTotalSize()}},l>0&&u.default.createElement("div",{className:(0,n.default)("dsg-row","dsg-row-header"),style:{width:v?"100%":Q.getTotalSize(),height:l}},Q.getVirtualItems().map(J=>u.default.createElement(i.Cell,{key:J.key,gutter:J.index===0,stickyRight:y&&J.index===a.length-1,width:J.size,left:J.start,className:(0,n.default)("dsg-cell-header",ot!==void 0&&at!==void 0&&ot<=J.index-1&&at>=J.index-1&&"dsg-cell-header-active",a[J.index].headerClassName)},u.default.createElement("div",{className:"dsg-cell-header-container"},a[J.index].title)))),Y.getVirtualItems().map(J=>{const he=J.index>=(kt??1/0)&&J.index<=(Kt??-1/0);return u.default.createElement("div",{key:J.key,className:(0,n.default)("dsg-row",typeof C=="string"?C:null,typeof C=="function"?C({rowData:t[J.index],rowIndex:J.index}):null),style:{height:J.size,top:J.start,width:v?"100%":Q.getTotalSize()}},Q.getVirtualItems().map(me=>{const jt=a[me.index].cellClassName,Vt=a[me.index].disabled,zr=a[me.index].component,_r=Vt===!0||typeof Vt=="function"&&Vt({rowData:t[J.index],rowIndex:J.index}),Sr=(S==null?void 0:S.row)===J.index&&S.col===me.index-1;return u.default.createElement(i.Cell,{key:me.key,gutter:me.index===0,stickyRight:y&&me.index===a.length-1,active:me.index===0&&he,disabled:_r,className:(0,n.default)(typeof jt=="function"?jt({rowData:t[J.index],rowIndex:J.index,columnId:a[me.index].id}):jt,typeof O=="function"?O({rowData:t[J.index],rowIndex:J.index,columnId:a[me.index].id}):O),width:me.size,left:me.start},u.default.createElement(zr,{rowData:t[J.index],getContextMenuItems:E,disabled:_r,active:Sr,columnIndex:me.index-1,rowIndex:J.index,focus:Sr&&R,deleteRow:Ce(J.index),duplicateRow:Te(J.index),stopEditing:M,insertRowBelow:be(J.index),setRowData:ie(J.index),columnData:a[me.index].columnData}))}))}),x))};return Pe.Grid=r,Pe}var We={},Oo;function eh(){return Oo||(Oo=1,function(e){var c=We&&We.__createBinding||(Object.create?function(r,t,a,p){p===void 0&&(p=a);var f=Object.getOwnPropertyDescriptor(t,a);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(r,p,f)}:function(r,t,a,p){p===void 0&&(p=a),r[p]=t[a]}),m=We&&We.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),d=We&&We.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&c(t,r,a);return m(t,r),t},o=We&&We.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRect=void 0;const u=d(fe()),n=o(Ht()),i=(r,t,a,p)=>[[p,r],[t,r],[t,a],[p,a],[p,r]],s=(r,t,a,p)=>`polygon(evenodd, ${[...i(0,"100%","100%",0),...i(r,t,a,p)].map(w=>w.map(y=>typeof y=="number"&&y!==0?y+"px":y).join(" ")).join(",")})`;e.SelectionRect=u.default.memo(({columnWidths:r,columnRights:t,headerRowHeight:a,selection:p,rowHeight:f,activeCell:w,hasStickyRightColumn:y,dataLength:b,viewWidth:l,viewHeight:h,contentWidth:g,edges:v,isCellDisabled:_,editing:S,expandSelection:C})=>{var O,x,R,E;const I=w?_(w):!1,N=(0,u.useMemo)(()=>{if(!p)return I;for(let Y=p.min.col;Y<=p.max.col;++Y)for(let Q=p.min.row;Q<=p.max.row;++Q)if(!_({col:Y,row:Q}))return!1;return!0},[I,_,p]);if(!r||!t)return null;const P=Y=>Y<b-1?1:0,A=Y=>Y<r.length-(y?3:2)?1:0,M=w&&{width:r[w.col+1]+A(w.col),height:f(w.row).height+P(w.row),left:t[w.col],top:f(w.row).top+a},B=p&&{width:r.slice(p.min.col+1,p.max.col+2).reduce((Y,Q)=>Y+Q)+A(p.max.col),height:f(p.max.row).top+f(p.max.row).height-f(p.min.row).top+P(p.max.row),left:t[p.min.col],top:f(p.min.row).top+a},U=(p==null?void 0:p.min)||w,$=(p==null?void 0:p.max)||w,H=$&&C!==null&&{left:t[$.col]+r[$.col+1],top:f($.row).top+f($.row).height+a,transform:`translate(-${$.col<r.length-(y?3:2)?50:100}%, -${$.row<b-1?50:100}%)`},Z=U&&$&&C!==null&&{width:r.slice(U.col+1,$.col+2).reduce((Y,Q)=>Y+Q)+A($.col),height:f($.row+C).top+f($.row+C).height-f($.row+1).top+P($.row+C)-1,left:t[U.col],top:f($.row).top+f($.row).height+a+1};return u.default.createElement(u.default.Fragment,null,u.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:f(b-1).top+f(b-1).height+a,width:g||"100%"}},u.default.createElement("div",{className:(0,n.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!v.top,"dsg-scrollable-view-r":!v.right,"dsg-scrollable-view-b":!v.bottom,"dsg-scrollable-view-l":!v.left}),style:{top:a,left:r[0],height:h?h-a:0,width:g&&l?l-r[0]-(y?r[r.length-1]:0):`calc(100% - ${r[0]+(y?r[r.length-1]:0)}px)`}})),(B||M)&&u.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(O=B==null?void 0:B.left)!==null&&O!==void 0?O:M==null?void 0:M.left,width:(x=B==null?void 0:B.width)!==null&&x!==void 0?x:M==null?void 0:M.width,height:f(b-1).top+f(b-1).height+a}},u.default.createElement("div",{className:(0,n.default)("dsg-selection-col-marker",N&&"dsg-selection-col-marker-disabled"),style:{top:a}})),(B||M)&&u.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(R=B==null?void 0:B.top)!==null&&R!==void 0?R:M==null?void 0:M.top,height:(E=B==null?void 0:B.height)!==null&&E!==void 0?E:M==null?void 0:M.height,width:g||"100%"}},u.default.createElement("div",{className:(0,n.default)("dsg-selection-row-marker",N&&"dsg-selection-row-marker-disabled"),style:{left:r[0]}})),M&&w&&u.default.createElement("div",{className:(0,n.default)("dsg-active-cell",{"dsg-active-cell-focus":S,"dsg-active-cell-disabled":I}),style:M}),B&&M&&u.default.createElement("div",{className:(0,n.default)("dsg-selection-rect",N&&"dsg-selection-rect-disabled"),style:Object.assign(Object.assign({},B),{clipPath:s(M.top-B.top,M.left-B.left,M.top+M.height-B.top,M.left+M.width-B.left)})}),Z&&u.default.createElement("div",{className:(0,n.default)("dsg-expand-rows-rect"),style:Z}),H&&u.default.createElement("div",{className:(0,n.default)("dsg-expand-rows-indicator",N&&"dsg-expand-rows-indicator-disabled"),style:H}))}),e.SelectionRect.displayName="SelectionRect"}(We)),We}var ln={},Ro;function th(){if(Ro)return ln;Ro=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.useRowHeights=void 0;const e=fe(),c=({value:m,rowHeight:d})=>{const o=(0,e.useRef)([]),[,u]=(0,e.useState)(0);return(0,e.useMemo)(()=>{const n=i=>{if(typeof d=="number")return Math.min(m.length-1,Math.max(-1,Math.floor(i/d)));let s=0,r=o.current.length-1;for(;s<=r;){const t=Math.floor((s+r)/2);if(o.current[t].top<i)s=t+1;else if(o.current[t].top>i)r=t-1;else return t}if(r===o.current.length-1&&m.length>o.current.length&&(!o.current.length||i>=o.current[r].top+o.current[r].height)){let t=r===-1?0:o.current[r].top+o.current[r].height;do{r++;const a=d({rowIndex:r,rowData:m[r]});o.current.push({height:a,top:t}),t+=a}while(t<=i&&r<o.current.length-1)}return r};return{resetAfter:i=>{o.current=o.current.slice(0,i),u(s=>s+1)},getRowSize:i=>{if(typeof d=="number")return{height:d,top:d*i};if(i>=m.length)return{height:0,top:0};if(i<o.current.length)return o.current[i];let s=o.current[o.current.length-1].top+o.current[o.current.length-1].height;for(let r=o.current.length;r<=i;r++){const t=d({rowIndex:r,rowData:m[r]});o.current.push({height:t,top:s}),s+=t}return o.current[i]},getRowIndex:n,totalSize:i=>{if(typeof d=="number")return m.length*d;const s=n(i);return o.current[s].top+o.current[s].height}}},[d,m])};return ln.useRowHeights=c,ln}var No;function ku(){return No||(No=1,function(e){var c=Ae&&Ae.__createBinding||(Object.create?function(N,P,A,M){M===void 0&&(M=A);var B=Object.getOwnPropertyDescriptor(P,A);(!B||("get"in B?!P.__esModule:B.writable||B.configurable))&&(B={enumerable:!0,get:function(){return P[A]}}),Object.defineProperty(N,M,B)}:function(N,P,A,M){M===void 0&&(M=A),N[M]=P[A]}),m=Ae&&Ae.__setModuleDefault||(Object.create?function(N,P){Object.defineProperty(N,"default",{enumerable:!0,value:P})}:function(N,P){N.default=P}),d=Ae&&Ae.__importStar||function(N){if(N&&N.__esModule)return N;var P={};if(N!=null)for(var A in N)A!=="default"&&Object.prototype.hasOwnProperty.call(N,A)&&c(P,N,A);return m(P,N),P},o=Ae&&Ae.__awaiter||function(N,P,A,M){function B(U){return U instanceof A?U:new A(function($){$(U)})}return new(A||(A=Promise))(function(U,$){function H(Q){try{Y(M.next(Q))}catch(ie){$(ie)}}function Z(Q){try{Y(M.throw(Q))}catch(ie){$(ie)}}function Y(Q){Q.done?U(Q.value):B(Q.value).then(H,Z)}Y((M=M.apply(N,P||[])).next())})},u=Ae&&Ae.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(e,"__esModule",{value:!0}),e.DataSheetGrid=void 0;const n=d(fe()),i=Id(),s=Bf,r=Ff(),t=Lf(),a=Nu(),p=Eu(),f=Uf(),w=Tu(),y=$f(),b=u(ou()),l=Iu(),h=Gf(),g=Wf(),v=Hf(),_=Zf(),S=eh(),C=th(),O=[],x=[],R=()=>({}),E=()=>null,I=({rowData:N})=>Object.assign({},N);e.DataSheetGrid=n.default.memo(n.default.forwardRef(({value:N=O,className:P,style:A,height:M=400,onChange:B=E,columns:U=x,rowHeight:$=40,headerRowHeight:H=typeof $=="number"?$:40,gutterColumn:Z,stickyRightColumn:Y,rowKey:Q,addRowsComponent:ie=w.AddRows,createRow:Ce=R,autoAddRow:Te=!1,lockRows:be=!1,disableExpandSelection:ot=!1,disableSmartDelete:at=!1,duplicateRow:kt=I,contextMenuComponent:Kt=l.ContextMenu,disableContextMenu:J=!1,onFocus:he=E,onBlur:me=E,onActiveCellChange:jt=E,onSelectionChange:Vt=E,rowClassName:zr,cellClassName:_r,onScroll:Sr},nc)=>{var Gr,Wr,Hr,Jr,Kr,Yr;const At=(0,n.useRef)(null),Ss=J||be,G=(0,r.useColumns)(U,Z,Y),ae=!!Y,xr=(0,n.useRef)(null),$e=(0,n.useRef)(null),Xr=(0,n.useRef)(null),Qr=(0,n.useRef)(null),[rc,ic]=(0,y.useDebounceState)(1,100),{getRowSize:Pt,totalSize:sc,getRowIndex:xs}=(0,C.useRowHeights)({value:N,rowHeight:$}),Cs=Math.min(M,H+sc(M)+rc),{width:Mt,height:pt}=(0,s.useResizeDetector)({targetRef:$e,refreshMode:"throttle",refreshRate:100});ic(pt?Cs-pt:0);const oc=(0,t.useEdges)($e,Mt,pt),{fullWidth:Os,totalWidth:ac,columnWidths:Be,columnRights:ze}=(0,i.useColumnWidths)(G,Mt),[qt,Fe]=(0,n.useState)(null),[Dt,lc]=(0,n.useState)([]),[le,ye]=(0,n.useState)(!1),[Bt,Rs]=(0,n.useState)(0),[Ft,Ns]=(0,n.useState)(null),[k,se]=(0,a.useDeepEqualState)(null),[ve,te]=(0,a.useDeepEqualState)(null),V=(0,n.useMemo)(()=>k&&ve&&{min:{col:Math.min(k.col,ve.col),row:Math.min(k.row,ve.row)},max:{col:Math.max(k.col,ve.col),row:Math.max(k.row,ve.row)}},[k,ve]),[Qe,Lt]=(0,a.useDeepEqualState)({columns:!1,rows:!1,active:!1}),uc=ot||le||Qe.active||(k==null?void 0:k.row)===(N==null?void 0:N.length)-1||(V==null?void 0:V.max.row)===(N==null?void 0:N.length)-1||k&&G.slice(((Gr=V==null?void 0:V.min.col)!==null&&Gr!==void 0?Gr:k.col)+1,((Wr=V==null?void 0:V.max.col)!==null&&Wr!==void 0?Wr:k.col)+2).every(T=>T.disabled===!0)?null:Bt,Es=(0,f.useGetBoundingClientRect)(xr),Ts=(0,f.useGetBoundingClientRect)($e);(0,n.useEffect)(()=>{var T;k!==null&&(document.activeElement.blur(),(T=window.getSelection())===null||T===void 0||T.removeAllRanges())},[k!==null]);const mt=(0,n.useCallback)((T,D=!1,F=!1)=>{const q=Es(D),W=F&&Ts(D);if(q&&ze&&Be){let ne=T.clientX-q.left,L=T.clientY-q.top;return W&&(T.clientY-W.top<=H&&(L=0),T.clientX-W.left<=Be[0]&&(ne=0),ae&&W.right-T.clientX<=Be[Be.length-1]&&(ne=ze[ze.length-2]+1)),{col:ze.findIndex(X=>ne<X)-1,row:xs(L-H)}}return null},[ze,Be,N.length,Es,Ts,H,ae,xs]),Ie=(0,n.useRef)(N);Ie.current=N;const ke=(0,n.useCallback)(T=>{const D=G[T.col+1].disabled;return!!(typeof D=="function"?D({rowData:Ie.current[T.row],rowIndex:T.row}):D)},[G]),Ze=(0,n.useCallback)((T,D=1)=>{be||(te(null),ye(!1),B([...Ie.current.slice(0,T+1),...new Array(D).fill(0).map(Ce),...Ie.current.slice(T+1)],[{type:"CREATE",fromRowIndex:T+1,toRowIndex:T+1+D}]),se(F=>({col:(F==null?void 0:F.col)||0,row:T+D,doNotScrollX:!0})))},[Ce,be,B,se,te]),Ut=(0,n.useCallback)((T,D=T)=>{be||(B([...Ie.current.slice(0,D+1),...Ie.current.slice(T,D+1).map((F,q)=>kt({rowData:F,rowIndex:q+T})),...Ie.current.slice(D+1)],[{type:"CREATE",fromRowIndex:D+1,toRowIndex:D+2+D-T}]),se({col:0,row:D+1,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:2*D-T+1,doNotScrollX:!0}),ye(!1))},[G.length,kt,be,B,se,te,ae]),et=(0,n.useCallback)(T=>{if(!(!pt||!Mt)){if(!T.doNotScrollY){const D=Pt(T.row).top,F=Pt(T.row).top+Pt(T.row).height+H-pt+1,q=$e.current.scrollTop;q>D?$e.current.scrollTop=D:q<F&&($e.current.scrollTop=F)}if(ze&&Be&&$e.current&&!T.doNotScrollX){const D=ze[T.col]-ze[0],F=ze[T.col]+Be[T.col+1]+(ae?Be[Be.length-1]:0)-Mt+1,q=$e.current.scrollLeft;q>D?$e.current.scrollLeft=D:q<F&&($e.current.scrollLeft=F)}}},[pt,Mt,H,ze,Be,Pt,ae]);(0,n.useEffect)(()=>{ve&&et(ve)},[ve,et]),(0,n.useEffect)(()=>{k&&et(k)},[k,et]);const cc=(0,n.useCallback)((T,D)=>{var F,q;B([...(F=Ie.current)===null||F===void 0?void 0:F.slice(0,T),D,...(q=Ie.current)===null||q===void 0?void 0:q.slice(T+1)],[{type:"UPDATE",fromRowIndex:T,toRowIndex:T+1}])},[B]),$t=(0,n.useCallback)((T,D=T)=>{be||(ye(!1),se(F=>{const q=Math.min(Ie.current.length-2-D+T,T);return q<0?null:F&&{col:F.col,row:q}}),te(null),B([...Ie.current.slice(0,T),...Ie.current.slice(D+1)],[{type:"DELETE",fromRowIndex:T,toRowIndex:D+1}]))},[be,B,se,te]),Cr=(0,n.useCallback)((T=!0)=>{const D=T&&!at;if(!k)return;const F=(V==null?void 0:V.min)||k,q=(V==null?void 0:V.max)||k;if(N.slice(F.row,q.row+1).every((ne,L)=>G.every(X=>X.isCellEmpty({rowData:ne,rowIndex:L+F.row})))){D&&$t(F.row,q.row);return}const W=[...N];for(let ne=F.row;ne<=q.row;++ne)for(let L=F.col;L<=q.col;++L)if(!ke({col:L,row:ne})){const{deleteValue:X=({rowData:oe})=>oe}=G[L+1];W[ne]=X({rowData:W[ne],rowIndex:ne})}if(D&&(0,b.default)(W,N)){se({col:0,row:F.row,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:q.row,doNotScrollX:!0});return}B(W,[{type:"UPDATE",fromRowIndex:F.row,toRowIndex:q.row+1}])},[k,G,N,$t,ke,B,V==null?void 0:V.max,V==null?void 0:V.min,se,te,ae]),Zr=(0,n.useCallback)(({nextRow:T=!0}={})=>{(k==null?void 0:k.row)===Ie.current.length-1?T&&Te?Ze(k.row):ye(!1):(ye(!1),T&&se(D=>D&&{col:D.col,row:D.row+1}))},[k==null?void 0:k.row,Te,Ze,se]),Yt=(0,n.useCallback)(T=>o(void 0,void 0,void 0,function*(){var D,F;if(!le&&k){const q=[],W=(V==null?void 0:V.min)||k,ne=(V==null?void 0:V.max)||k;for(let K=W.row;K<=ne.row;++K){q.push([]);for(let ue=W.col;ue<=ne.col;++ue){const{copyValue:de=()=>null}=G[ue+1];q[K-W.row].push(de({rowData:N[K],rowIndex:K}))}}const L=q.map(K=>K.join("	")).join(`
`),X=`<table>${q.map(K=>`<tr>${K.map(ue=>`<td>${(0,h.encodeHtml)(String(ue??"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(T!==void 0){(D=T.clipboardData)===null||D===void 0||D.setData("text/plain",L),(F=T.clipboardData)===null||F===void 0||F.setData("text/html",X),T.preventDefault();return}let oe=!1;if(navigator.clipboard.write!==void 0){const K=new Blob([L],{type:"text/plain"}),ue=new Blob([X],{type:"text/html"}),de=[new ClipboardItem({"text/plain":K,"text/html":ue})];yield navigator.clipboard.write(de).then(()=>{oe=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(L).then(()=>{oe=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(oe=!0);oe||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[k,G,N,le,V]);(0,p.useDocumentEventListener)("copy",Yt);const ei=(0,n.useCallback)(T=>{!le&&k&&(Yt(T),Cr(!1))},[k,Cr,le,Yt]);(0,p.useDocumentEventListener)("cut",ei);const Xt=(0,n.useCallback)(T=>o(void 0,void 0,void 0,function*(){var D,F;if(!le&&k){const q=(V==null?void 0:V.min)||k,W=(V==null?void 0:V.max)||k,ne=yield Promise.all(T[0].map((L,X)=>{var oe,K;const ue=(oe=G[q.col+X+1])===null||oe===void 0?void 0:oe.prePasteValues,de=T.map(je=>je[X]);return(K=ue==null?void 0:ue(de))!==null&&K!==void 0?K:de}));if(T=T.map((L,X)=>ne.map(oe=>oe[X])),T.length===1){const L=[...N];for(let X=0;X<T[0].length;X++){const oe=(D=G[q.col+X+1])===null||D===void 0?void 0:D.pasteValue;if(oe)for(let K=q.row;K<=W.row;K++)ke({col:X+q.col,row:K})||(L[K]=yield oe({rowData:L[K],value:T[0][X],rowIndex:K}))}B(L,[{type:"UPDATE",fromRowIndex:q.row,toRowIndex:W.row+1}]),se({col:q.col,row:q.row}),te({col:Math.min(q.col+T[0].length-1,G.length-(ae?3:2)),row:W.row})}else{let L=[...N];const X=q.row+T.length-N.length;X>0&&(be?T.splice(T.length-X,X):L=[...L,...new Array(X).fill(0).map(()=>Ce())]);for(let K=0;K<T[0].length&&q.col+K<G.length-(ae?2:1);K++){const ue=(F=G[q.col+K+1])===null||F===void 0?void 0:F.pasteValue;if(ue)for(let de=0;de<T.length;de++)ke({col:q.col+K,row:q.row+de})||(L[q.row+de]=yield ue({rowData:L[q.row+de],value:T[de][K],rowIndex:q.row+de}))}const oe=[{type:"UPDATE",fromRowIndex:q.row,toRowIndex:q.row+T.length-(!be&&X>0?X:0)}];X>0&&!be&&oe.push({type:"CREATE",fromRowIndex:q.row+T.length-X,toRowIndex:q.row+T.length}),B(L,oe),se({col:q.col,row:q.row}),te({col:Math.min(q.col+T[0].length-1,G.length-(ae?3:2)),row:q.row+T.length-1})}}}),[k,G,Ce,N,le,ae,ke,be,B,V==null?void 0:V.max,V==null?void 0:V.min,se,te]),dc=(0,n.useCallback)(T=>{var D,F,q,W,ne,L;if(k&&!le){let X=[[""]];!((D=T.clipboardData)===null||D===void 0)&&D.types.includes("text/html")?X=(0,h.parseTextHtmlData)((F=T.clipboardData)===null||F===void 0?void 0:F.getData("text/html")):!((q=T.clipboardData)===null||q===void 0)&&q.types.includes("text/plain")?X=(0,h.parseTextPlainData)((W=T.clipboardData)===null||W===void 0?void 0:W.getData("text/plain")):!((ne=T.clipboardData)===null||ne===void 0)&&ne.types.includes("text")&&(X=(0,h.parseTextPlainData)((L=T.clipboardData)===null||L===void 0?void 0:L.getData("text"))),Xt(X),T.preventDefault()}},[k,Xt,le]);(0,p.useDocumentEventListener)("paste",dc);const fc=(0,n.useCallback)(T=>{var D,F,q;if(qt&&Dt.length)return;const W=T.button===2||T.button===0&&T.ctrlKey,ne=((D=xr.current)===null||D===void 0?void 0:D.contains(T.target))||!1,L=ne?mt(T,!0,!0):null;if(!ne&&le&&k&&G[k.col+1].keepFocus)return;if(T.target instanceof HTMLElement&&T.target.className.includes("dsg-expand-rows-indicator")){Ns(Math.max((F=k==null?void 0:k.row)!==null&&F!==void 0?F:0,(q=V==null?void 0:V.max.row)!==null&&q!==void 0?q:0));return}const X=L&&k&&k.col===L.col&&k.row===L.row&&!ke(k);if(X&&le)return;const oe=(L==null?void 0:L.col)===G.length-2&&ae,K=W&&V&&L&&L.row>=V.min.row&&L.row<=V.max.row&&L.col>=V.min.col&&L.col<=V.max.col,ue=W&&V&&L&&L.row===-1&&L.col>=V.min.col&&L.col<=V.max.col,de=W&&V&&L&&L.row>=V.min.row&&L.row<=V.max.row&&L.col===-1,je=oe&&V&&L&&L.row>=V.min.row&&L.row<=V.max.row;if(W&&!Ss&&Fe({x:T.clientX,y:T.clientY,cursorIndex:L}),(!(T.shiftKey&&k)||W)&&N.length>0&&se(L&&{col:(K||ue)&&k?k.col:Math.max(0,oe?0:L.col),row:(K||de||je)&&k?k.row:Math.max(0,L.row),doNotScrollX:!!(K&&k||oe||L.col===-1),doNotScrollY:!!(K&&k||L.row===-1)}),X&&!W&&(At.current=k),ye(!!(X&&!W)),Lt(L&&!W?{columns:L.col!==-1&&!oe||!!(T.shiftKey&&k),rows:L.row!==-1||!!(T.shiftKey&&k),active:!0}:{columns:!1,rows:!1,active:!1}),T.shiftKey&&k&&!W)te(L&&{col:Math.max(0,L.col-(oe?1:0)),row:Math.max(0,L.row)});else if(!K){if(L&&((L==null?void 0:L.col)===-1||(L==null?void 0:L.row)===-1||oe)){let Oe=L.col,Ve=L.row,Re=!1,Le=!1;(L.col===-1||oe)&&(Oe=G.length-(ae?3:2),Re=!0),L.row===-1&&(Ve=N.length-1,Le=!0),ue&&ve&&(Oe=ve.col,Le=!0),(de||je)&&ve&&(Ve=ve.row,Re=!0),te({col:Oe,row:Ve,doNotScrollX:Re,doNotScrollY:Le})}else te(null);ne&&T.preventDefault()}},[qt,Dt.length,mt,le,k,G,ke,V,ae,Ss,Lt,se,te,ve,N.length]);(0,p.useDocumentEventListener)("mousedown",fc);const hc=(0,n.useCallback)(()=>{var T,D,F,q,W,ne,L,X,oe;if(Ft!==null){if(Bt>0&&k){let K=[];const ue=(V==null?void 0:V.min)||k,de=(V==null?void 0:V.max)||k;for(let je=ue.row;je<=de.row;++je){K.push([]);for(let Oe=ue.col;Oe<=de.col;++Oe){const{copyValue:Ve=()=>null}=G[Oe+1];K[je-ue.row].push(String((T=Ve({rowData:N[je],rowIndex:je}))!==null&&T!==void 0?T:""))}}Promise.all(K[0].map((je,Oe)=>{var Ve,Re;const Le=(Ve=G[ue.col+Oe+1])===null||Ve===void 0?void 0:Ve.prePasteValues,Ue=K.map(yc=>yc[Oe]);return(Re=Le==null?void 0:Le(Ue))!==null&&Re!==void 0?Re:Ue})).then(je=>{var Oe;K=K.map((Re,Le)=>je.map(Ue=>Ue[Le]));const Ve=[...N];for(let Re=0;Re<K[0].length;Re++){const Le=(Oe=G[ue.col+Re+1])===null||Oe===void 0?void 0:Oe.pasteValue;if(Le)for(let Ue=de.row+1;Ue<=de.row+Bt;Ue++)ke({col:Re+ue.col,row:Ue})||(Ve[Ue]=Le({rowData:Ve[Ue],value:K[(Ue-de.row-1)%K.length][Re],rowIndex:Ue}))}B(Ve,[{type:"UPDATE",fromRowIndex:de.row+1,toRowIndex:de.row+1+Bt}])}),Rs(0),se({col:Math.min((D=k==null?void 0:k.col)!==null&&D!==void 0?D:1/0,(F=V==null?void 0:V.min.col)!==null&&F!==void 0?F:1/0),row:Math.min((q=k==null?void 0:k.row)!==null&&q!==void 0?q:1/0,(W=V==null?void 0:V.min.row)!==null&&W!==void 0?W:1/0),doNotScrollX:!0,doNotScrollY:!0}),te({col:Math.max((ne=k==null?void 0:k.col)!==null&&ne!==void 0?ne:0,(L=V==null?void 0:V.max.col)!==null&&L!==void 0?L:0),row:Math.max((X=k==null?void 0:k.row)!==null&&X!==void 0?X:0,(oe=V==null?void 0:V.max.row)!==null&&oe!==void 0?oe:0)+Bt})}Ns(null)}Lt({columns:!1,rows:!1,active:!1})},[Ft,Lt,Bt,k,V==null?void 0:V.min,V==null?void 0:V.max,N,B,se,te,G,ke]);(0,p.useDocumentEventListener)("mouseup",hc);const pc=(0,n.useCallback)(T=>{if(Ft!==null){const D=mt(T);D&&(Rs(Math.max(0,D.row-Ft)),et({col:D.col,row:Math.max(D.row,Ft)}))}if(Qe.active){const D=mt(T),F=G.length-(ae?3:2);te(D&&{col:Qe.columns?Math.max(0,Math.min(F,D.col)):F,row:Qe.rows?Math.max(0,D.row):N.length-1,doNotScrollX:!Qe.columns,doNotScrollY:!Qe.rows}),ye(!1)}},[et,Qe.active,Qe.columns,Qe.rows,mt,G.length,ae,te,N.length,Ft]);(0,p.useDocumentEventListener)("mousemove",pc);const mc=(0,n.useCallback)(T=>{var D;if(k&&!T.isComposing){if(T.key==="Tab"&&!T.shiftKey&&k.col===G.length-(ae?3:2)&&!G[k.col+1].disableKeys)if(k.row===N.length-1){if(Qr.current){T.preventDefault(),se(null),te(null),ye(!1);const F=(0,v.getAllTabbableElements)(),q=F.indexOf(Qr.current);F[(q+1)%F.length].focus();return}}else{se(F=>{var q;return{col:0,row:((q=F==null?void 0:F.row)!==null&&q!==void 0?q:0)+1}}),te(null),ye(!1),T.preventDefault();return}if(T.key==="Tab"&&T.shiftKey&&k.col===0&&!G[k.col+1].disableKeys)if(k.row===0){if(Xr.current){T.preventDefault(),se(null),te(null),ye(!1);const F=(0,v.getAllTabbableElements)(),q=F.indexOf(Xr.current);F[(q-1+F.length)%F.length].focus();return}}else{se(F=>{var q;return{col:G.length-(ae?3:2),row:((q=F==null?void 0:F.row)!==null&&q!==void 0?q:1)-1}}),te(null),ye(!1),T.preventDefault();return}if(!((D=T.key)===null||D===void 0)&&D.startsWith("Arrow")||T.key==="Tab"){if(le&&G[k.col+1].disableKeys||le&&["ArrowLeft","ArrowRight"].includes(T.key))return;const F=([q,W],ne)=>ne&&{col:Math.max(0,Math.min(G.length-(ae?3:2),ne.col+q)),row:Math.max(0,Math.min(N.length-1,ne.row+W))};if(T.key==="Tab"&&T.shiftKey)se(q=>F([-1,0],q)),te(null);else{const q={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[T.key];(T.ctrlKey||T.metaKey)&&(q[0]*=G.length,q[1]*=N.length),T.shiftKey?te(W=>F(q,W||k)):(se(W=>F(q,W)),te(null))}ye(!1),T.preventDefault()}else T.key==="Escape"?(!le&&!ve&&se(null),te(null),ye(!1)):(T.key==="Enter"||T.key==="F2")&&!T.ctrlKey&&!T.metaKey&&!T.altKey&&!T.shiftKey?(te(null),le?G[k.col+1].disableKeys||(Zr(),T.preventDefault()):ke(k)||(At.current=k,ye(!0),et(k),T.preventDefault())):T.key==="Enter"&&!T.ctrlKey&&!T.metaKey&&!T.altKey&&T.shiftKey?Ze((V==null?void 0:V.max.row)||k.row):T.key==="d"&&(T.ctrlKey||T.metaKey)&&!T.altKey&&!T.shiftKey?(Ut((V==null?void 0:V.min.row)||k.row,V==null?void 0:V.max.row),T.preventDefault()):((0,h.isPrintableUnicode)(T.key)||T.code.match(/Key[A-Z]$/))&&!T.ctrlKey&&!T.metaKey&&!T.altKey?!le&&!ke(k)&&(At.current=k,te(null),ye(!0),et(k)):["Backspace","Delete"].includes(T.key)?le||(Cr(),T.preventDefault()):T.key==="a"&&(T.ctrlKey||T.metaKey)&&(le||(se({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),te({col:G.length-(ae?3:2),row:N.length-1,doNotScrollY:!0,doNotScrollX:!0}),T.preventDefault()))}},[k,G,N.length,Cr,Ut,le,Ze,ke,et,V==null?void 0:V.max.row,V==null?void 0:V.min.row,ve,se,te,Zr,ae]);(0,p.useDocumentEventListener)("keydown",mc);const gc=(0,n.useCallback)(T=>{var D;const F=((D=xr.current)===null||D===void 0?void 0:D.contains(T.target))||!1,q=F?mt(T,!0,!0):null,W=q&&k&&k.col===q.col&&k.row===q.row&&le;F&&!W&&T.preventDefault()},[mt,k,le]);(0,p.useDocumentEventListener)("contextmenu",gc),(0,n.useEffect)(()=>{const T=[];(k==null?void 0:k.row)!==void 0&&T.push({type:"COPY",action:()=>{Yt(),Fe(null)}},{type:"CUT",action:()=>{ei(),Fe(null)}},{type:"PASTE",action:()=>o(void 0,void 0,void 0,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(F=>o(void 0,void 0,void 0,function*(){let q=[[""]];if(F.types.includes("text/html")){const W=yield F.getType("text/html");q=(0,h.parseTextHtmlData)(yield W.text())}else if(F.types.includes("text/plain")){const W=yield F.getType("text/plain");q=(0,h.parseTextPlainData)(yield W.text())}else if(F.types.includes("text")){const W=yield F.getType("text");q=(0,h.parseTextHtmlData)(yield W.text())}Xt(q)}));else if(navigator.clipboard.readText!==void 0){const D=yield navigator.clipboard.readText();Xt((0,h.parseTextPlainData)(D))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");Fe(null)})}),(V==null?void 0:V.max.row)!==void 0?T.push({type:"INSERT_ROW_BELLOW",action:()=>{Fe(null),Ze(V.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"INSERT_ROW_BELLOW",action:()=>{Fe(null),Ze(k.row)}}),(V==null?void 0:V.min.row)!==void 0&&V.min.row!==V.max.row?T.push({type:"DUPLICATE_ROWS",fromRow:V.min.row+1,toRow:V.max.row+1,action:()=>{Fe(null),Ut(V.min.row,V.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"DUPLICATE_ROW",action:()=>{Fe(null),Ut(k.row)}}),(V==null?void 0:V.min.row)!==void 0&&V.min.row!==V.max.row?T.push({type:"DELETE_ROWS",fromRow:V.min.row+1,toRow:V.max.row+1,action:()=>{Fe(null),$t(V.min.row,V.max.row)}}):(k==null?void 0:k.row)!==void 0&&T.push({type:"DELETE_ROW",action:()=>{Fe(null),$t(k.row)}}),lc(T),T.length||Fe(null)},[V,k,$t,Ut,Ze,ei,Yt,Xt]);const Is=(0,n.useRef)(Dt);Is.current=Dt;const bc=(0,n.useCallback)(()=>Is.current,[]);(0,n.useImperativeHandle)(nc,()=>({activeCell:(0,g.getCellWithId)(k,G),selection:(0,g.getSelectionWithId)(V??(k?{min:k,max:k}:null),G),setSelection:T=>{const D=(0,g.getSelection)(T,G.length-(ae?2:1),N.length,G);se((D==null?void 0:D.min)||null),ye(!1),Lt({columns:!1,active:!1,rows:!1}),te((D==null?void 0:D.max)||null)},setActiveCell:T=>{const D=(0,g.getCell)(T,G.length-(ae?2:1),N.length,G);se(D),ye(!1),Lt({columns:!1,active:!1,rows:!1}),te(null)}}));const lt=(0,n.useRef)({onFocus:he,onBlur:me,onActiveCellChange:jt,onSelectionChange:Vt});return lt.current.onFocus=he,lt.current.onBlur=me,lt.current.onActiveCellChange=jt,lt.current.onSelectionChange=Vt,(0,n.useEffect)(()=>{At.current&&(le?lt.current.onFocus({cell:(0,g.getCellWithId)(At.current,G)}):lt.current.onBlur({cell:(0,g.getCellWithId)(At.current,G)}))},[le,G]),(0,n.useEffect)(()=>{lt.current.onActiveCellChange({cell:(0,g.getCellWithId)(k,G)})},[k==null?void 0:k.col,k==null?void 0:k.row,G]),(0,n.useEffect)(()=>{lt.current.onSelectionChange({selection:(0,g.getSelectionWithId)(V??(k?{min:k,max:k}:null),G)})},[(Hr=V==null?void 0:V.min.col)!==null&&Hr!==void 0?Hr:k==null?void 0:k.col,(Jr=V==null?void 0:V.min.row)!==null&&Jr!==void 0?Jr:k==null?void 0:k.row,(Kr=V==null?void 0:V.max.col)!==null&&Kr!==void 0?Kr:k==null?void 0:k.col,(Yr=V==null?void 0:V.max.row)!==null&&Yr!==void 0?Yr:k==null?void 0:k.row,k==null?void 0:k.col,k==null?void 0:k.row,G]),n.default.createElement("div",{className:P,style:A},n.default.createElement("div",{ref:Xr,tabIndex:U.length&&N.length?0:void 0,onFocus:T=>{T.target.blur(),se({col:0,row:0})}}),n.default.createElement(_.Grid,{columns:G,outerRef:$e,columnWidths:Be,hasStickyRightColumn:ae,displayHeight:Cs,data:N,fullWidth:Os,headerRowHeight:H,activeCell:k,innerRef:xr,rowHeight:Pt,rowKey:Q,selection:V,rowClassName:zr,editing:le,getContextMenuItems:bc,setRowData:cc,deleteRows:$t,insertRowAfter:Ze,duplicateRows:Ut,stopEditing:Zr,cellClassName:_r,onScroll:Sr},n.default.createElement(S.SelectionRect,{columnRights:ze,columnWidths:Be,activeCell:k,selection:V,headerRowHeight:H,rowHeight:Pt,hasStickyRightColumn:ae,dataLength:N.length,viewHeight:pt,viewWidth:Mt,contentWidth:Os?void 0:ac,edges:oc,editing:le,isCellDisabled:ke,expandSelection:uc})),n.default.createElement("div",{ref:Qr,tabIndex:U.length&&N.length?0:void 0,onFocus:T=>{T.target.blur(),se({col:G.length-(ae?3:2),row:N.length-1})}}),!be&&ie&&n.default.createElement(ie,{addRows:T=>Ze(N.length-1,T)}),qt&&Dt.length>0&&n.default.createElement(Kt,{clientX:qt.x,clientY:qt.y,cursorIndex:qt.cursorIndex,items:Dt,close:()=>Fe(null)}))})),e.DataSheetGrid.displayName="DataSheetGrid"}(Ae)),Ae}var it={},Eo;function nh(){if(Eo)return it;Eo=1;var e=it&&it.__rest||function(u,n){var i={};for(var s in u)Object.prototype.hasOwnProperty.call(u,s)&&n.indexOf(s)<0&&(i[s]=u[s]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(u);r<s.length;r++)n.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(u,s[r])&&(i[s[r]]=u[s[r]]);return i},c=it&&it.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(it,"__esModule",{value:!0}),it.StaticDataSheetGrid=void 0;const m=fe(),d=ku(),o=c(fe());return it.StaticDataSheetGrid=o.default.forwardRef((u,n)=>{var{columns:i,gutterColumn:s,stickyRightColumn:r,addRowsComponent:t,createRow:a,duplicateRow:p,style:f,rowKey:w,onFocus:y,onBlur:b,onActiveCellChange:l,onSelectionChange:h,rowClassName:g,rowHeight:v}=u,_=e(u,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);const[S]=(0,m.useState)({columns:i,gutterColumn:s,stickyRightColumn:r,addRowsComponent:t,createRow:a,duplicateRow:p,style:f,rowKey:w,onFocus:y,onBlur:b,onActiveCellChange:l,onSelectionChange:h,rowClassName:g,rowHeight:v});return o.default.createElement(d.DataSheetGrid,Object.assign({},S,_,{rowHeight:typeof v=="number"?v:S.rowHeight,ref:n}))}),it}var we={},un={},To;function rh(){if(To)return un;To=1,Object.defineProperty(un,"__esModule",{value:!0}),un.useFirstRender=void 0;const e=fe(),c=()=>{const m=(0,e.useRef)(!0),d=m.current;return m.current=!1,d};return un.useFirstRender=c,un}var Io;function Dr(){if(Io)return we;Io=1;var e=we&&we.__createBinding||(Object.create?function(r,t,a,p){p===void 0&&(p=a);var f=Object.getOwnPropertyDescriptor(t,a);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(r,p,f)}:function(r,t,a,p){p===void 0&&(p=a),r[p]=t[a]}),c=we&&we.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),m=we&&we.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var a in r)a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)&&e(t,r,a);return c(t,r),t},d=we&&we.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(we,"__esModule",{value:!0}),we.createTextColumn=we.textColumn=void 0;const o=m(fe()),u=d(Ht()),n=rh(),i=o.default.memo(({active:r,focus:t,rowData:a,setRowData:p,columnData:{placeholder:f,alignRight:w,formatInputOnFocus:y,formatBlurredInput:b,parseUserInput:l,continuousUpdates:h}})=>{const g=(0,o.useRef)(null),v=(0,n.useFirstRender)(),_=(0,o.useRef)({rowData:a,formatInputOnFocus:y,formatBlurredInput:b,setRowData:p,parseUserInput:l,continuousUpdates:h,firstRender:v,focusedAt:0,changedAt:0,escPressed:!1});return _.current={rowData:a,formatInputOnFocus:y,formatBlurredInput:b,setRowData:p,parseUserInput:l,continuousUpdates:h,firstRender:v,focusedAt:_.current.focusedAt,changedAt:_.current.changedAt,escPressed:_.current.escPressed},(0,o.useLayoutEffect)(()=>{t?(g.current&&(g.current.value=_.current.formatInputOnFocus(_.current.rowData),g.current.focus(),g.current.select()),_.current.escPressed=!1,_.current.focusedAt=Date.now()):g.current&&(!_.current.escPressed&&!_.current.continuousUpdates&&!_.current.firstRender&&_.current.changedAt>=_.current.focusedAt&&_.current.setRowData(_.current.parseUserInput(g.current.value)),g.current.blur())},[t]),(0,o.useEffect)(()=>{!t&&g.current&&(g.current.value=_.current.formatBlurredInput(a))},[t,a]),o.default.createElement("input",{defaultValue:b(a),className:(0,u.default)("dsg-input",w&&"dsg-input-align-right"),placeholder:r?f:void 0,tabIndex:-1,ref:g,style:{pointerEvents:t?"auto":"none"},onChange:S=>{_.current.changedAt=Date.now(),h&&p(l(S.target.value))},onKeyDown:S=>{S.key==="Escape"&&(_.current.escPressed=!0)}})});i.displayName="TextComponent",we.textColumn=s();function s({placeholder:r,alignRight:t=!1,continuousUpdates:a=!0,deletedValue:p=null,parseUserInput:f=h=>h.trim()||null,formatBlurredInput:w=h=>String(h??""),formatInputOnFocus:y=h=>String(h??""),formatForCopy:b=h=>String(h??""),parsePastedValue:l=h=>h.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:i,columnData:{placeholder:r,alignRight:t,continuousUpdates:a,formatInputOnFocus:y,formatBlurredInput:w,parseUserInput:f},deleteValue:()=>p,copyValue:({rowData:h})=>b(h),pasteValue:({value:h})=>l(h),isCellEmpty:({rowData:h})=>h==null}}return we.createTextColumn=s,we}var He={},ko;function ih(){if(ko)return He;ko=1;var e=He&&He.__createBinding||(Object.create?function(n,i,s,r){r===void 0&&(r=s);var t=Object.getOwnPropertyDescriptor(i,s);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(n,r,t)}:function(n,i,s,r){r===void 0&&(r=s),n[r]=i[s]}),c=He&&He.__setModuleDefault||(Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i}),m=He&&He.__importStar||function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var s in n)s!=="default"&&Object.prototype.hasOwnProperty.call(n,s)&&e(i,n,s);return c(i,n),i};Object.defineProperty(He,"__esModule",{value:!0}),He.checkboxColumn=void 0;const d=m(fe()),o=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],u=d.default.memo(({focus:n,rowData:i,setRowData:s,active:r,stopEditing:t,disabled:a})=>{const p=(0,d.useRef)(null);return(0,d.useLayoutEffect)(()=>{n&&(s(!i),t({nextRow:!1}))},[n,t]),d.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:p,disabled:a,checked:!!i,onMouseDown:()=>!r&&s(!i),onChange:()=>null})});return u.displayName="CheckboxComponent",He.checkboxColumn={component:u,deleteValue:()=>!1,copyValue:({rowData:n})=>n?"YES":"NO",pasteValue:({value:n})=>!o.includes(n.toLowerCase()),isCellEmpty:({rowData:n})=>!n},He}var cn={},jo;function sh(){if(jo)return cn;jo=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.floatColumn=void 0;const e=Dr();return cn.floatColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:c=>typeof c=="number"?new Intl.NumberFormat().format(c):"",parseUserInput:c=>{const m=parseFloat(c);return isNaN(m)?null:m},parsePastedValue:c=>{const m=parseFloat(c);return isNaN(m)?null:m}}),cn}var dn={},Vo;function oh(){if(Vo)return dn;Vo=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.intColumn=void 0;const e=Dr();return dn.intColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:c=>typeof c=="number"?new Intl.NumberFormat().format(c):"",parseUserInput:c=>{const m=parseFloat(c);return isNaN(m)?null:Math.round(m)},parsePastedValue:c=>{const m=parseFloat(c);return isNaN(m)?null:Math.round(m)}}),dn}var fn={},Ao;function ah(){if(Ao)return fn;Ao=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.percentColumn=void 0;const e=Dr(),c=1e12,m=1e10;return fn.percentColumn=(0,e.createTextColumn)({alignRight:!0,formatBlurredInput:d=>typeof d=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(d):"",formatInputOnFocus:d=>typeof d=="number"&&!isNaN(d)?String(Math.round(d*c)/m):"",parseUserInput:d=>{const o=parseFloat(d);return isNaN(o)?null:o/100},parsePastedValue:d=>{const o=parseFloat(d);return isNaN(o)?null:o}}),fn}var Me={},Po;function lh(){if(Po)return Me;Po=1;var e=Me&&Me.__createBinding||(Object.create?function(i,s,r,t){t===void 0&&(t=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(i,t,a)}:function(i,s,r,t){t===void 0&&(t=r),i[t]=s[r]}),c=Me&&Me.__setModuleDefault||(Object.create?function(i,s){Object.defineProperty(i,"default",{enumerable:!0,value:s})}:function(i,s){i.default=s}),m=Me&&Me.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(i!=null)for(var r in i)r!=="default"&&Object.prototype.hasOwnProperty.call(i,r)&&e(s,i,r);return c(s,i),s},d=Me&&Me.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Me,"__esModule",{value:!0}),Me.dateColumn=void 0;const o=m(fe()),u=d(Ht()),n=o.default.memo(({focus:i,active:s,rowData:r,setRowData:t})=>{var a;const p=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var f,w;i?(f=p.current)===null||f===void 0||f.select():(w=p.current)===null||w===void 0||w.blur()},[i]),o.default.createElement("input",{className:(0,u.default)("dsg-input",!s&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:p,style:{pointerEvents:i?"auto":"none",opacity:r||s?void 0:0},value:(a=r==null?void 0:r.toISOString().substr(0,10))!==null&&a!==void 0?a:"",onChange:f=>{const w=new Date(f.target.value);t(isNaN(w.getTime())?null:w)}})});return n.displayName="DateComponent",Me.dateColumn={component:n,deleteValue:()=>null,copyValue:({rowData:i})=>i?i.toISOString().substr(0,10):null,pasteValue:({value:i})=>{const s=new Date(i.replace(/\.\s?|\//g,"-"));return isNaN(s.getTime())?null:s},minWidth:170,isCellEmpty:({rowData:i})=>!i},Me}var qe={},Mo;function uh(){if(Mo)return qe;Mo=1;var e=qe&&qe.__createBinding||(Object.create?function(i,s,r,t){t===void 0&&(t=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(i,t,a)}:function(i,s,r,t){t===void 0&&(t=r),i[t]=s[r]}),c=qe&&qe.__setModuleDefault||(Object.create?function(i,s){Object.defineProperty(i,"default",{enumerable:!0,value:s})}:function(i,s){i.default=s}),m=qe&&qe.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(i!=null)for(var r in i)r!=="default"&&Object.prototype.hasOwnProperty.call(i,r)&&e(s,i,r);return c(s,i),s},d=qe&&qe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qe,"__esModule",{value:!0}),qe.isoDateColumn=void 0;const o=m(fe()),u=d(Ht()),n=o.default.memo(({focus:i,active:s,rowData:r,setRowData:t})=>{const a=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{var p,f;i?(p=a.current)===null||p===void 0||p.select():(f=a.current)===null||f===void 0||f.blur()},[i]),o.default.createElement("input",{className:(0,u.default)("dsg-input",!s&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:a,style:{pointerEvents:i?"auto":"none",opacity:r||s?void 0:0},value:r??"",onChange:p=>{const f=new Date(p.target.value);t(isNaN(f.getTime())?null:f.toISOString().substr(0,10))}})});return n.displayName="IsoDateComponent",qe.isoDateColumn={component:n,deleteValue:()=>null,copyValue:({rowData:i})=>i,pasteValue:({value:i})=>{const s=new Date(i.replace(/\.\s?|\//g,"-"));return isNaN(s.getTime())?null:s.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:i})=>!i},qe}var De={},qo;function ch(){if(qo)return De;qo=1;var e=De&&De.__createBinding||(Object.create?function(i,s,r,t){t===void 0&&(t=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(i,t,a)}:function(i,s,r,t){t===void 0&&(t=r),i[t]=s[r]}),c=De&&De.__setModuleDefault||(Object.create?function(i,s){Object.defineProperty(i,"default",{enumerable:!0,value:s})}:function(i,s){i.default=s}),m=De&&De.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(i!=null)for(var r in i)r!=="default"&&Object.prototype.hasOwnProperty.call(i,r)&&e(s,i,r);return c(s,i),s},d=De&&De.__rest||function(i,s){var r={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&s.indexOf(t)<0&&(r[t]=i[t]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(i);a<t.length;a++)s.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(i,t[a])&&(r[t[a]]=i[t[a]]);return r};Object.defineProperty(De,"__esModule",{value:!0}),De.keyColumn=void 0;const o=m(fe()),u=i=>{var{columnData:{key:s,original:r},rowData:t,setRowData:a}=i,p=d(i,["columnData","rowData","setRowData"]);const f=(0,o.useRef)(t);f.current=t;const w=(0,o.useCallback)(b=>{a(Object.assign(Object.assign({},f.current),{[s]:b}))},[s,a]);if(!r.component)return o.default.createElement(o.default.Fragment,null);const y=r.component;return o.default.createElement(y,Object.assign({columnData:r.columnData,setRowData:w,rowData:t[s]},p))},n=(i,s)=>Object.assign(Object.assign({id:i},s),{columnData:{key:i,original:s},component:u,copyValue:({rowData:r,rowIndex:t})=>{var a,p;return(p=(a=s.copyValue)===null||a===void 0?void 0:a.call(s,{rowData:r[i],rowIndex:t}))!==null&&p!==void 0?p:null},deleteValue:({rowData:r,rowIndex:t})=>{var a,p;return Object.assign(Object.assign({},r),{[i]:(p=(a=s.deleteValue)===null||a===void 0?void 0:a.call(s,{rowData:r[i],rowIndex:t}))!==null&&p!==void 0?p:null})},pasteValue:({rowData:r,value:t,rowIndex:a})=>{var p,f;return Object.assign(Object.assign({},r),{[i]:(f=(p=s.pasteValue)===null||p===void 0?void 0:p.call(s,{rowData:r[i],value:t,rowIndex:a}))!==null&&f!==void 0?f:null})},disabled:typeof s.disabled=="function"?({rowData:r,rowIndex:t})=>{var a;return typeof s.disabled=="function"?s.disabled({rowData:r[i],rowIndex:t}):(a=s.disabled)!==null&&a!==void 0?a:!1}:s.disabled,cellClassName:typeof s.cellClassName=="function"?({rowData:r,rowIndex:t,columnId:a})=>{var p;return typeof s.cellClassName=="function"?s.cellClassName({rowData:r[i],rowIndex:t,columnId:a}):(p=s.cellClassName)!==null&&p!==void 0?p:void 0}:s.cellClassName,isCellEmpty:({rowData:r,rowIndex:t})=>{var a,p;return(p=(a=s.isCellEmpty)===null||a===void 0?void 0:a.call(s,{rowData:r[i],rowIndex:t}))!==null&&p!==void 0?p:!1}});return De.keyColumn=n,De}var Do;function dh(){return Do||(Do=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.renderContextMenuItem=e.createContextMenuComponent=e.createAddRowsComponent=e.keyColumn=e.isoDateColumn=e.dateColumn=e.percentColumn=e.intColumn=e.floatColumn=e.checkboxColumn=e.createTextColumn=e.textColumn=e.DataSheetGrid=e.DynamicDataSheetGrid=void 0;const c=ku(),m=nh();e.DynamicDataSheetGrid=c.DataSheetGrid,e.DataSheetGrid=m.StaticDataSheetGrid;var d=Dr();Object.defineProperty(e,"textColumn",{enumerable:!0,get:function(){return d.textColumn}}),Object.defineProperty(e,"createTextColumn",{enumerable:!0,get:function(){return d.createTextColumn}});var o=ih();Object.defineProperty(e,"checkboxColumn",{enumerable:!0,get:function(){return o.checkboxColumn}});var u=sh();Object.defineProperty(e,"floatColumn",{enumerable:!0,get:function(){return u.floatColumn}});var n=oh();Object.defineProperty(e,"intColumn",{enumerable:!0,get:function(){return n.intColumn}});var i=ah();Object.defineProperty(e,"percentColumn",{enumerable:!0,get:function(){return i.percentColumn}});var s=lh();Object.defineProperty(e,"dateColumn",{enumerable:!0,get:function(){return s.dateColumn}});var r=uh();Object.defineProperty(e,"isoDateColumn",{enumerable:!0,get:function(){return r.isoDateColumn}});var t=ch();Object.defineProperty(e,"keyColumn",{enumerable:!0,get:function(){return t.keyColumn}});var a=Tu();Object.defineProperty(e,"createAddRowsComponent",{enumerable:!0,get:function(){return a.createAddRowsComponent}});var p=Iu();Object.defineProperty(e,"createContextMenuComponent",{enumerable:!0,get:function(){return p.createContextMenuComponent}}),Object.defineProperty(e,"renderContextMenuItem",{enumerable:!0,get:function(){return p.defaultRenderItem}})}(ri)),ri}var ut=dh();function fh(e,c){if(!c||c==="string")return String(e);if(c==="number"){if(e.trim()==="")return e;const m=Number(e);return isNaN(m)?e:m}else{if(c==="boolean")return e.toLowerCase()==="true"?!0:e.toLowerCase()==="false"?!1:e;if(c==="object"||c==="array")try{return JSON.parse(e)}catch{return e}else return e}}function Bo(e){return typeof e=="object"?JSON.stringify(e):String(e)}function hh({rowData:e,setRowData:c,choices:m,colType:d}){const[o,u]=z.useState(Bo(e));return j.jsx(fu,{freeSolo:!0,disablePortal:!1,options:m,getOptionLabel:n=>Bo(n),value:e,onInputChange:(n,i)=>{u(i)},onChange:(n,i,s)=>{c(s==="createOption"?fh(i,d):i)},blurOnSelect:!0,onBlur:()=>c(o),renderInput:n=>j.jsx(hu,{...n,slotProps:{input:{...n.InputProps,disableUnderline:!0,sx:{height:"100%",padding:"0 10px",backgroundColor:"inherit",borderRadius:0}}}}),sx:{width:"100%",height:"100%","& .MuiAutocomplete-inputRoot":{padding:"0 10px",backgroundColor:"inherit"},"& .MuiFormControl-root":{height:"100%"}}})}function es({choices:e,colType:c}){return{component:m=>j.jsx(hh,{...m,choices:e,colType:c}),copyValue:({rowData:m})=>m,pasteValue:({value:m})=>m,disableKeys:!0,keepFocus:!0}}try{es.displayName="autocompleteColumn",es.__docgenInfo={description:"",displayName:"autocompleteColumn",props:{choices:{defaultValue:null,description:"",name:"choices",required:!0,type:{name:"AutocompleteOption[]"}},colType:{defaultValue:null,description:"",name:"colType",required:!1,type:{name:"JSONSchema7Type"}}}}}catch{}async function ph(e,c){const m=await e.gridServicesClient.postRepoV1GridSessionAsyncStart({createGridRequest:c});if(!m.token)throw new Error("No async job token returned from startGridSession");return(await is(()=>e.asynchronousJobServicesClient.getRepoV1AsynchronousJobJobId({jobId:m.token}))).responseBody}function mh(e){const c=qr(),{keyFactory:m,synapseClient:d}=st();return ft({...e,mutationFn:o=>d.gridServicesClient.postRepoV1GridSessionSessionIdReplica({sessionId:o,createReplicaRequest:{gridSessionId:o}}),onSuccess:async(o,u,n)=>{await c.invalidateQueries({queryKey:m.getGridSessionListKey()})}})}function gh(e){const c=qr(),{keyFactory:m,synapseClient:d}=st();return ft({...e,mutationFn:o=>d.gridServicesClient.deleteRepoV1GridSessionSessionId({sessionId:o}),onSuccess:async(o,u,n)=>{await c.invalidateQueries({queryKey:m.getGridSessionListKey()}),e!=null&&e.onSuccess&&await e.onSuccess(o,u,n)}})}function bh(e){const{keyFactory:c,synapseClient:m}=st();return ed({...e,queryKey:c.getGridSessionListKey(),queryFn:async d=>await m.gridServicesClient.postRepoV1GridSessionList({listGridSessionsRequest:{nextPageToken:d.pageParam}}),initialPageParam:void 0,getNextPageParam:d=>d.nextPageToken})}const yh=e=>{const{synapseClient:c}=st();return ft({...e,mutationFn:async m=>await ph(c,m)})};function vh(){const{mutateAsync:e}=yh(),{synapseClient:c}=st();return ft({mutationFn:async({gridSqlOrSessionId:m,schemaId:d})=>{let o;const u=vd(m);if(!["empty","sql","sessionId"].includes(u.type))throw new Error("Unknown input type, please provide a valid SQL query or session ID.");if(u.type==="empty"||u.type==="sql"){const n={concreteType:"org.sagebionetworks.repo.model.grid.CreateGridRequest",initialQuery:void 0,schema$id:d||void 0};u.type==="sql"?(n.initialQuery={sql:u.input},console.log("Starting grid session with table query: ",u.input)):console.log("Starting a new empty grid session.");const i=await e(n);console.log("Grid session started:",i),o=i.gridSession}else console.log(`Joining existing session ID: ${u.input}`),o=await c.gridServicesClient.getRepoV1GridSessionSessionId({sessionId:u.input});return o}})}function wh(e){const{mutateAsync:c}=vh(),{mutateAsync:m}=mh(),{synapseClient:d}=st();return ft({...e,mutationFn:async({gridSqlOrSessionId:o,schemaId:u})=>{const n=await c({gridSqlOrSessionId:o,schemaId:u}),i=n.sessionId;try{const s=await m(i);console.log("Replica created:",s);const r=s.replica,{presignedUrl:t}=await d.gridServicesClient.postRepoV1GridSessionSessionIdPresignedUrl({sessionId:i,createGridPresignedUrlRequest:{gridSessionId:i,replicaId:r.replicaId}});return{session:n,replica:r,presignedUrl:t}}catch(s){throw new Error("Error starting session:",{cause:s})}}})}const ts=z.forwardRef(({onSessionChange:e=Tt,onReplicaChange:c=Tt,onPresignedUrlChange:m=Tt,query:d},o)=>{const[u,n]=z.useState(""),i=!d,{mutate:s}=wh({onMutate(f){console.log("Starting grid session with args:",f)},onSuccess({session:f,replica:w,presignedUrl:y}){Et("Grid session started successfully","success"),e(f),c(w.replicaId),m(y)}}),{mutate:r}=gh({onSuccess:()=>{Et("Successfully deleted grid session","success"),e(null),c(null),m("")},onError:f=>{Et(f.reason,"danger")}}),{data:t}=bh(),a=z.useMemo(()=>(t==null?void 0:t.pages.flatMap(f=>f.page||[]))||[],[t]),p=function(){s({gridSqlOrSessionId:u})};return z.useImperativeHandle(o,()=>({handleStartSession:f=>{s({gridSqlOrSessionId:f})}}),[s]),i?j.jsxs(Se,{container:!0,spacing:2,sx:{mb:2},children:[j.jsx(Se,{size:{xs:12},sx:{position:"relative"},children:j.jsx(fu,{freeSolo:!0,fullWidth:!0,renderInput:f=>j.jsx(hu,{...f,label:"SQL Query or Session ID",placeholder:"(Optional) Enter a SQL query or session ID"}),options:a,getOptionLabel:f=>typeof f=="string"?f:f.sessionId||"",value:u,onInputChange:(f,w)=>{n(w)},onChange:(f,w)=>{w&&typeof w=="object"?(n(w.sessionId||""),s({gridSqlOrSessionId:w.sessionId})):n(w||"")},onKeyDown:f=>{f.key==="Enter"&&p()},renderOption:(f,w)=>z.createElement(yr,{...f,key:w.sessionId,style:{display:"block",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee"}},j.jsxs(Se,{container:!0,sx:{justifyContent:"space-between","& > *":{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},children:[j.jsx(Se,{size:{xs:6,md:2},children:w.sessionId}),j.jsx(Se,{size:{xs:5,md:2},children:w.sourceEntityId}),j.jsx(Se,{size:{xs:0,md:6},children:w.gridJsonSchema$Id??"No schema"}),j.jsx(Se,{size:{xs:1},children:j.jsx("span",{"data-icon":"delete",title:"Delete session",style:{marginLeft:"8px",color:"#d32f2f",cursor:"pointer",fontSize:"16px",userSelect:"none"},onClick:y=>{y.stopPropagation(),r(w.sessionId)},children:"🗑️"})})]}))})}),j.jsx(Se,{container:!0,size:12,justifyContent:"flex-end",children:j.jsx(Gt,{color:"primary",variant:"contained",onClick:()=>{p()},children:"Start Grid Session"})})]}):null});try{ts.displayName="StartGridSession",ts.__docgenInfo={description:"",displayName:"StartGridSession",props:{onSessionChange:{defaultValue:null,description:"",name:"onSessionChange",required:!1,type:{name:"(session: GridSession) => void"}},onReplicaChange:{defaultValue:null,description:"",name:"onReplicaChange",required:!1,type:{name:"(replicaId: number) => void"}},onPresignedUrlChange:{defaultValue:null,description:"",name:"onPresignedUrlChange",required:!1,type:{name:"(url: string) => void"}},query:{defaultValue:null,description:"",name:"query",required:!1,type:{name:"string"}}}}}catch{}function _h(e){const c=z.useMemo(()=>e?e.api.subscribe:()=>Tt,[e]),m=z.useCallback(()=>e?e.api.getSnapshot():null,[e]);return z.useSyncExternalStore(c,m)}var ci={};const re=au(td);var di={},Fo;function Sh(){return Fo||(Fo=1,Object.defineProperty(di,"__esModule",{value:!0})),di}var hn={},ee={},pn={},Lo;function Ye(){if(Lo)return pn;Lo=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.printTree=void 0;const e=(c="",m)=>{let d="",o=m.length-1;for(;o>=0&&!m[o];o--);for(let u=0;u<=o;u++){const n=m[u];if(!n)continue;const i=u===o,s=n(c+(i?" ":"│")+"  "),r=s?i?"└─":"├─":"│";d+=`
`+c+r+(s?" "+s:"")}return d};return pn.printTree=e,pn}var fi={},hi={},Uo;function xh(){return Uo||(Uo=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var pi={},$o;function Ch(){return $o||($o=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServerClockVector=e.ClockVector=e.LogicalClock=e.interval=e.printTs=e.containsId=e.contains=e.compare=e.equal=e.tick=e.tss=e.ts=e.Timespan=e.Timestamp=void 0;class c{constructor(b,l){this.sid=b,this.time=l}}e.Timestamp=c;class m{constructor(b,l,h){this.sid=b,this.time=l,this.span=h}}e.Timespan=m;const d=(y,b)=>new c(y,b);e.ts=d;const o=(y,b,l)=>new m(y,b,l);e.tss=o;const u=(y,b)=>(0,e.ts)(y.sid,y.time+b);e.tick=u;const n=(y,b)=>y.time===b.time&&y.sid===b.sid;e.equal=n;const i=(y,b)=>{const l=y.time,h=b.time;if(l>h)return 1;if(l<h)return-1;const g=y.sid,v=b.sid;return g>v?1:g<v?-1:0};e.compare=i;const s=(y,b,l,h)=>{if(y.sid!==l.sid)return!1;const g=y.time,v=l.time;return!(g>v||g+b<v+h)};e.contains=s;const r=(y,b,l)=>{if(y.sid!==l.sid)return!1;const h=y.time,g=l.time;return!(h>g||h+b<g+1)};e.containsId=r;const t=y=>{if(y.sid===1)return"."+y.time;let b=""+y.sid;return b.length>4&&(b=".."+b.slice(b.length-4)),b+"."+y.time};e.printTs=t;const a=(y,b,l)=>new m(y.sid,y.time+b,l);e.interval=a;class p extends c{tick(b){const l=new c(this.sid,this.time);return this.time+=b,l}}e.LogicalClock=p;class f extends p{constructor(){super(...arguments),this.peers=new Map}observe(b,l){const h=b.time+l-1,g=b.sid;if(g!==this.sid){const v=this.peers.get(b.sid);v?h>v.time&&(v.time=h):this.peers.set(b.sid,(0,e.ts)(g,h))}h>=this.time&&(this.time=h+1)}clone(){return this.fork(this.sid)}fork(b){const l=new f(b,this.time);return b!==this.sid&&l.observe((0,e.tick)(this,-1),1),this.peers.forEach(h=>{l.observe(h,1)}),l}toString(b=""){const l=this.peers.size;let h=1,g="";return this.peers.forEach(v=>{g+=`
${b}${h===l?"└─":"├─"} ${v.sid}.${v.time}`,h++}),`clock ${this.sid}.${this.time}${g}`}}e.ClockVector=f;class w extends p{constructor(){super(...arguments),this.peers=new Map}observe(b,l){if(b.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<b.time)throw new Error("TIME_TRAVEL");const h=b.time+l;h>this.time&&(this.time=h)}clone(){return this.fork()}fork(){return new w(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}e.ServerClockVector=w}(pi)),pi}var zo;function ce(){return zo||(zo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(xh(),e),c.__exportStar(Ch(),e)}(fi)),fi}var Go;function Jt(){if(Go)return ee;Go=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.NopOp=ee.DelOp=ee.UpdArrOp=ee.InsArrOp=ee.InsBinOp=ee.InsStrOp=ee.InsVecOp=ee.InsObjOp=ee.InsValOp=ee.NewArrOp=ee.NewBinOp=ee.NewStrOp=ee.NewVecOp=ee.NewObjOp=ee.NewValOp=ee.NewConOp=void 0;const e=Ye(),c=ce();class m{constructor(v){this.id=v}span(){return 1}toString(){let v=this.name()+" "+(0,c.printTs)(this.id);const _=this.span();return _>1&&(v+="!"+_),v}}class d extends m{constructor(v,_){super(v),this.id=v,this.val=_}name(){return"new_con"}toString(){const v=this.val,_="Uint8Array",S=v instanceof c.Timestamp?`{ ${(0,c.printTs)(v)} }`:v instanceof Uint8Array?v.length<13?`${_} { ${(""+v).replaceAll(",",", ")} }`:`${_}(${v.length})`:`{ ${JSON.stringify(v)} }`;return super.toString()+" "+S}}ee.NewConOp=d;class o extends m{name(){return"new_val"}}ee.NewValOp=o;class u extends m{name(){return"new_obj"}}ee.NewObjOp=u;class n extends m{name(){return"new_vec"}}ee.NewVecOp=n;class i extends m{name(){return"new_str"}}ee.NewStrOp=i;class s extends m{name(){return"new_bin"}}ee.NewBinOp=s;class r extends m{name(){return"new_arr"}}ee.NewArrOp=r;class t extends m{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.val=S}name(){return"ins_val"}toString(){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}, val = ${(0,c.printTs)(this.val)}`}}ee.InsValOp=t;class a extends m{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_obj"}toString(v=""){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${JSON.stringify(S[0])}: ${(0,c.printTs)(S[1])}`))}}ee.InsObjOp=a;class p extends m{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.data=S}name(){return"ins_vec"}toString(v=""){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)}`+(0,e.printTree)(v,this.data.map(S=>C=>`${S[0]}: ${(0,c.printTs)(S[1])}`))}}ee.InsVecOp=p;class f extends m{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_str"}toString(){return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${(0,c.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}}ee.InsStrOp=f;class w extends m{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_bin"}toString(){const v=(0,c.printTs)(this.ref);return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${v} ← ${this.data} }`}}ee.InsBinOp=w;class y extends m{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.data=C}span(){return this.data.length}name(){return"ins_arr"}toString(){const v=(0,c.printTs)(this.obj),_=(0,c.printTs)(this.ref),S=this.data.map(c.printTs).join(", ");return super.toString()+", obj = "+v+" { "+_+" ← "+S+" }"}}ee.InsArrOp=y;class b extends m{constructor(v,_,S,C){super(v),this.id=v,this.obj=_,this.ref=S,this.val=C}name(){return"upd_arr"}toString(){const v=(0,c.printTs)(this.obj),_=(0,c.printTs)(this.ref),S=(0,c.printTs)(this.val);return super.toString()+", obj = "+v+" { "+_+": "+S+" }"}}ee.UpdArrOp=b;class l extends m{constructor(v,_,S){super(v),this.id=v,this.obj=_,this.what=S}name(){return"del"}toString(){const v=this.what.map(_=>(0,c.printTs)(_)+"!"+_.span).join(", ");return super.toString()+`, obj = ${(0,c.printTs)(this.obj)} { ${v} }`}}ee.DelOp=l;class h extends m{constructor(v,_){super(v),this.id=v,this.len=_}span(){return this.len}name(){return"nop"}}return ee.NopOp=h,ee}var mn={},yt={},Wo;function Br(){return Wo||(Wo=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.hasBuffer=yt.alphabet=void 0,yt.alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yt.hasBuffer=typeof Ee.Buffer=="function"&&typeof Ee.Buffer.from=="function"),yt}var gn={},bn={},Ho;function Oh(){if(Ho)return bn;Ho=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.flatstr=void 0;const e=c=>c;return bn.flatstr=e,bn}var Jo;function Rh(){if(Jo)return gn;Jo=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.createToBase64=void 0;const e=Oh(),c=Br(),m=(d=c.alphabet,o="=")=>{if(d.length!==64)throw new Error("chars must be 64 characters long");const u=d.split(""),n=[];for(const r of u)for(const t of u){const a=(0,e.flatstr)(r+t);n.push(a)}const i=o,s=(0,e.flatstr)(o+o);return(r,t)=>{let a="";const p=t%3,f=t-p;for(let w=0;w<f;w+=3){const y=r[w],b=r[w+1],l=r[w+2],h=y<<4|b>>4,g=(b&15)<<8|l;a+=n[h]+n[g]}if(!p)return a;if(p===1){const w=r[f];a+=n[w<<4]+s}else{const w=r[f],y=r[f+1],b=w<<4|y>>4,l=(y&15)<<2;a+=n[b]+u[l]+i}return a}};return gn.createToBase64=m,gn}var Ko;function ju(){if(Ko)return mn;Ko=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.toBase64=void 0;const e=Br(),m=(0,Rh().createToBase64)();return mn.toBase64=e.hasBuffer?d=>{const o=d.length;return o<=48?m(d,o):Ee.Buffer.from(d).toString("base64")}:d=>m(d,d.length),mn}var Yo;function Nh(){if(Yo)return hn;Yo=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.encode=void 0;const c=re.__importStar(Jt()),m=ce(),d=ju(),o=(i,s)=>{const r=s.sid;return r===i?s.time:[r,s.time]},u=(i,s)=>{const r=o(i,s);return Array.isArray(r)?(r.push(s.span),r):[r,s.span]},n=i=>{const s=i.getId();if(!s)throw new Error("PATCH_EMPTY");const r=s.sid,t=s.time,a=r===1?[t]:[[r,t]],p=i.meta;p!==void 0&&a.push(p);const f=[a];for(const w of i.ops)if(w instanceof c.NewConOp){const y=w.val;y instanceof m.Timestamp?f.push([0,o(r,y),!0]):y===void 0?f.push([0]):f.push([0,y])}else if(w instanceof c.NewValOp)f.push([1]);else if(w instanceof c.NewObjOp)f.push([2]);else if(w instanceof c.NewVecOp)f.push([3]);else if(w instanceof c.NewStrOp)f.push([4]);else if(w instanceof c.NewBinOp)f.push([5]);else if(w instanceof c.NewArrOp)f.push([6]);else if(w instanceof c.InsValOp)f.push([9,o(r,w.obj),o(r,w.val)]);else if(w instanceof c.InsObjOp){const y=[];for(const[l,h]of w.data)y.push([l,o(r,h)]);const b=[10,o(r,w.obj),y];f.push(b)}else if(w instanceof c.InsVecOp){const y=[];for(const[l,h]of w.data)y.push([l,o(r,h)]);const b=[11,o(r,w.obj),y];f.push(b)}else if(w instanceof c.InsStrOp){const y=[12,o(r,w.obj),o(r,w.ref),w.data];f.push(y)}else if(w instanceof c.InsBinOp){const y=[13,o(r,w.obj),o(r,w.ref),(0,d.toBase64)(w.data)];f.push(y)}else if(w instanceof c.InsArrOp){const y=[];for(const l of w.data)y.push(o(r,l));const b=[14,o(r,w.obj),o(r,w.ref),y];f.push(b)}else if(w instanceof c.UpdArrOp){const y=[15,o(r,w.obj),o(r,w.ref),o(r,w.val)];f.push(y)}else if(w instanceof c.DelOp){const y=[16,o(r,w.obj),w.what.map(b=>u(r,b))];f.push(y)}else if(w instanceof c.NopOp){const y=[17],b=w.len;b>1&&y.push(b),f.push(y)}return f};return hn.encode=n,hn}var yn={},vn={},wn={},Xo;function Eh(){if(Xo)return wn;Xo=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.bufferToUint8Array=void 0;const e=c=>new Uint8Array(c.buffer,c.byteOffset,c.length);return wn.bufferToUint8Array=e,wn}var _n={},Qo;function Th(){if(Qo)return _n;Qo=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.createFromBase64=void 0;const e=Br(),c="=",m=(d=e.alphabet,o=!1)=>{if(d.length!==64)throw new Error("chars must be 64 characters long");let u=0;for(let i=0;i<d.length;i++)u=Math.max(u,d.charCodeAt(i));const n=[];for(let i=0;i<=u;i+=1)n[i]=-1;for(let i=0;i<d.length;i++)n[d.charCodeAt(i)]=i;return i=>{if(!i)return new Uint8Array(0);let s=i.length;if(o){const y=s%4;y===2?(i+="==",s+=2):y===3&&(i+="=",s+=1)}if(s%4!==0)throw new Error("Base64 string length must be a multiple of 4");const r=i[s-1]!==c?s:s-4;let t=(s>>2)*3,a=0;i[s-2]===c?(a=2,t-=2):i[s-1]===c&&(a=1,t-=1);const p=new Uint8Array(t);let f=0,w=0;for(;w<r;w+=4){const y=n[i.charCodeAt(w)],b=n[i.charCodeAt(w+1)],l=n[i.charCodeAt(w+2)],h=n[i.charCodeAt(w+3)];if(y<0||b<0||l<0||h<0)throw new Error("INVALID_BASE64_STRING");p[f]=y<<2|b>>4,p[f+1]=b<<4|l>>2,p[f+2]=l<<6|h,f+=3}if(a===2){const y=n[i.charCodeAt(r)],b=n[i.charCodeAt(r+1)];if(y<0||b<0)throw new Error("INVALID_BASE64_STRING");p[f]=y<<2|b>>4}else if(a===1){const y=n[i.charCodeAt(r)],b=n[i.charCodeAt(r+1)],l=n[i.charCodeAt(r+2)];if(y<0||b<0||l<0)throw new Error("INVALID_BASE64_STRING");p[f]=y<<2|b>>4,p[f+1]=b<<4|l>>2}return p}};return _n.createFromBase64=m,_n}var Zo;function Ih(){if(Zo)return vn;Zo=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.fromBase64=void 0;const e=Eh(),c=Br(),m=Th(),d=c.hasBuffer?u=>(0,e.bufferToUint8Array)(Ee.Buffer.from(u,"base64")):null,o=(0,m.createFromBase64)();return vn.fromBase64=d?u=>u.length>48?d(u):o(u):o,vn}var Sn={},xn={},ea;function ds(){return ea||(ea=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.isUint8Array=void 0,xn.isUint8Array=typeof Ee.Buffer=="function"?e=>e instanceof Uint8Array||Ee.Buffer.isBuffer(e):e=>e instanceof Uint8Array),xn}var Cn={},mi={},On={},Rn={},Nn={},En={},ta;function kh(){if(ta)return En;ta=1,Object.defineProperty(En,"__esModule",{value:!0}),En.Slice=void 0;let e=class{constructor(m,d,o,u){this.uint8=m,this.view=d,this.start=o,this.end=u}subarray(){return this.uint8.subarray(this.start,this.end)}};return En.Slice=e,En}var na;function Vu(){if(na)return Nn;na=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.Writer=void 0;const e=kh(),c=new Uint8Array([]),m=new DataView(c.buffer),d=typeof Ee.Buffer=="function",o=d?Ee.Buffer.prototype.utf8Write:null,u=d?Ee.Buffer.from:null,n=typeof TextEncoder<"u"?new TextEncoder:null;let i=class{constructor(r=64*1024){this.allocSize=r,this.view=m,this.x0=0,this.x=0,this.uint8=new Uint8Array(r),this.size=r,this.view=new DataView(this.uint8.buffer)}grow(r){const t=this.x0,a=this.x,p=this.uint8,f=new Uint8Array(r),w=new DataView(f.buffer),y=p.subarray(t,a);f.set(y,0),this.x=a-t,this.x0=0,this.uint8=f,this.size=r,this.view=w}ensureCapacity(r){const t=this.size,a=t-this.x;if(a<r){const p=t-this.x0,f=r-a,w=p+f;this.grow(w<=this.allocSize?this.allocSize:w*2)}}move(r){this.ensureCapacity(r),this.x+=r}reset(){this.x0=this.x}newBuffer(r){const t=this.uint8=new Uint8Array(r);this.size=r,this.view=new DataView(t.buffer),this.x=this.x0=0}flush(){const r=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,r}flushSlice(){const r=new e.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,r}u8(r){this.ensureCapacity(1),this.uint8[this.x++]=r}u16(r){this.ensureCapacity(2),this.view.setUint16(this.x,r),this.x+=2}u32(r){this.ensureCapacity(4),this.view.setUint32(this.x,r),this.x+=4}i32(r){this.ensureCapacity(4),this.view.setInt32(this.x,r),this.x+=4}u64(r){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(r)),this.x+=8}f64(r){this.ensureCapacity(8),this.view.setFloat64(this.x,r),this.x+=8}u8u16(r,t){this.ensureCapacity(3);let a=this.x;this.uint8[a++]=r,this.uint8[a++]=t>>>8,this.uint8[a++]=t&255,this.x=a}u8u32(r,t){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=r,this.view.setUint32(a,t),this.x=a+4}u8u64(r,t){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=r,this.view.setBigUint64(a,BigInt(t)),this.x=a+8}u8f32(r,t){this.ensureCapacity(5);let a=this.x;this.uint8[a++]=r,this.view.setFloat32(a,t),this.x=a+4}u8f64(r,t){this.ensureCapacity(9);let a=this.x;this.uint8[a++]=r,this.view.setFloat64(a,t),this.x=a+8}buf(r,t){this.ensureCapacity(t);const a=this.x;this.uint8.set(r,a),this.x=a+t}utf8(r){const t=r.length*4;if(t<168)return this.utf8Native(r);if(o){const a=o.call(this.uint8,r,this.x,t);return this.x+=a,a}else if(u){const a=this.uint8,p=a.byteOffset+this.x,w=u(a.buffer).subarray(p,p+t).write(r,0,t,"utf8");return this.x+=w,w}else if(t>1024&&n){const a=n.encodeInto(r,this.uint8.subarray(this.x,this.x+t)).written;return this.x+=a,a}return this.utf8Native(r)}utf8Native(r){const t=r.length,a=this.uint8;let p=this.x,f=0;for(;f<t;){let y=r.charCodeAt(f++);if((y&4294967168)===0){a[p++]=y;continue}else if((y&4294965248)===0)a[p++]=y>>6&31|192;else{if(y>=55296&&y<=56319&&f<t){const b=r.charCodeAt(f);(b&64512)===56320&&(f++,y=((y&1023)<<10)+(b&1023)+65536)}(y&4294901760)===0?(a[p++]=y>>12&15|224,a[p++]=y>>6&63|128):(a[p++]=y>>18&7|240,a[p++]=y>>12&63|128,a[p++]=y>>6&63|128)}a[p++]=y&63|128}const w=p-this.x;return this.x=p,w}ascii(r){const t=r.length;this.ensureCapacity(t);const a=this.uint8;let p=this.x,f=0;for(;f<t;)a[p++]=r.charCodeAt(f++);this.x=p}};return Nn.Writer=i,Nn}var ra;function fs(){if(ra)return Rn;ra=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.CrdtWriter=void 0;const e=Vu();let c=class extends e.Writer{id(d,o){d<=7&&o<=15?this.u8(d<<4|o):(this.b1vu56(1,d),this.vu57(o))}vu57(d){if(d<=127)this.u8(d);else if(d<=16383){this.ensureCapacity(2);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=d>>>7}else if(d<=2097151){this.ensureCapacity(3);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=128|d>>>7&127,o[this.x++]=d>>>14}else if(d<=268435455){this.ensureCapacity(4);const o=this.uint8;o[this.x++]=128|d&127,o[this.x++]=128|d>>>7&127,o[this.x++]=128|d>>>14&127,o[this.x++]=d>>>21}else{let o=d|0;o<0&&(o+=4294967296);const u=(d-o)/4294967296;if(d<=34359738367){this.ensureCapacity(5);const n=this.uint8;n[this.x++]=128|d&127,n[this.x++]=128|d>>>7&127,n[this.x++]=128|d>>>14&127,n[this.x++]=128|d>>>21&127,n[this.x++]=u<<4|d>>>28}else if(d<=4398046511103){this.ensureCapacity(6);const n=this.uint8;n[this.x++]=128|d&127,n[this.x++]=128|d>>>7&127,n[this.x++]=128|d>>>14&127,n[this.x++]=128|d>>>21&127,n[this.x++]=128|(u&7)<<4|d>>>28,n[this.x++]=u>>>3}else if(d<=562949953421311){this.ensureCapacity(7);const n=this.uint8;n[this.x++]=128|d&127,n[this.x++]=128|d>>>7&127,n[this.x++]=128|d>>>14&127,n[this.x++]=128|d>>>21&127,n[this.x++]=128|(u&7)<<4|d>>>28,n[this.x++]=128|(u&1016)>>>3,n[this.x++]=u>>>10}else{this.ensureCapacity(8);const n=this.uint8;n[this.x++]=128|d&127,n[this.x++]=128|d>>>7&127,n[this.x++]=128|d>>>14&127,n[this.x++]=128|d>>>21&127,n[this.x++]=128|(u&7)<<4|d>>>28,n[this.x++]=128|(u&1016)>>>3,n[this.x++]=128|(u&130048)>>>10,n[this.x++]=u>>>17}}}b1vu56(d,o){if(o<=63)this.u8(d<<7|o);else{const u=d<<7|64;if(o<=8191){this.ensureCapacity(2);const n=this.uint8;n[this.x++]=u|o&63,n[this.x++]=o>>>6}else if(o<=1048575){this.ensureCapacity(3);const n=this.uint8;n[this.x++]=u|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=o>>>13}else if(o<=134217727){this.ensureCapacity(4);const n=this.uint8;n[this.x++]=u|o&63,n[this.x++]=128|o>>>6&127,n[this.x++]=128|o>>>13&127,n[this.x++]=o>>>20}else{let n=o|0;n<0&&(n+=4294967296);const i=(o-n)/4294967296;if(o<=17179869183){this.ensureCapacity(5);const s=this.uint8;s[this.x++]=u|o&63,s[this.x++]=128|o>>>6&127,s[this.x++]=128|o>>>13&127,s[this.x++]=128|o>>>20&127,s[this.x++]=i<<5|o>>>27}else if(o<=2199023255551){this.ensureCapacity(6);const s=this.uint8;s[this.x++]=u|o&63,s[this.x++]=128|o>>>6&127,s[this.x++]=128|o>>>13&127,s[this.x++]=128|o>>>20&127,s[this.x++]=128|(i&3)<<5|o>>>27,s[this.x++]=i>>>2}else if(o<=0xffffffffffff){this.ensureCapacity(7);const s=this.uint8;s[this.x++]=u|o&63,s[this.x++]=128|o>>>6&127,s[this.x++]=128|o>>>13&127,s[this.x++]=128|o>>>20&127,s[this.x++]=128|(i&3)<<5|o>>>27,s[this.x++]=128|(i&508)>>>2,s[this.x++]=i>>>9}else{this.ensureCapacity(8);const s=this.uint8;s[this.x++]=u|o&63,s[this.x++]=128|o>>>6&127,s[this.x++]=128|o>>>13&127,s[this.x++]=128|o>>>20&127,s[this.x++]=128|(i&3)<<5|o>>>27,s[this.x++]=128|(i&508)>>>2,s[this.x++]=128|(i&65024)>>>9,s[this.x++]=i>>>16}}}}};return Rn.CrdtWriter=c,Rn}var Tn={},In={},ia;function jh(){if(ia)return In;ia=1,Object.defineProperty(In,"__esModule",{value:!0}),In.isFloat32=void 0;const e=new DataView(new ArrayBuffer(4)),c=m=>(e.setFloat32(0,m),m===e.getFloat32(0));return In.isFloat32=c,In}var kn={},sa;function Au(){if(sa)return kn;sa=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.JsonPackExtension=void 0;let e=class{constructor(m,d){this.tag=m,this.val=d}};return kn.JsonPackExtension=e,kn}var jn={},oa;function Vh(){if(oa)return jn;oa=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.CborEncoderFast=void 0;const e=Vu(),c=Number.isSafeInteger;let m=class{constructor(o=new e.Writer){this.writer=o}encode(o){return this.writeAny(o),this.writer.flush()}encodeToSlice(o){return this.writeAny(o),this.writer.flushSlice()}writeAny(o){switch(typeof o){case"number":return this.writeNumber(o);case"string":return this.writeStr(o);case"boolean":return this.writer.u8(244+ +o);case"object":{if(!o)return this.writer.u8(246);switch(o.constructor){case Array:return this.writeArr(o);default:return this.writeObj(o)}}}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(o){o?this.writer.u8(245):this.writer.u8(244)}writeNumber(o){c(o)?this.writeInteger(o):typeof o=="bigint"?this.writeBigInt(o):this.writeFloat(o)}writeBigInt(o){o>=0?this.writeBigUint(o):this.writeBigSint(o)}writeBigUint(o){if(o<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(o));this.writer.u8u64(27,o)}writeBigSint(o){if(o>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(o));const u=-BigInt(1)-o;this.writer.u8u64(59,u)}writeInteger(o){o>=0?this.writeUInteger(o):this.encodeNint(o)}writeUInteger(o){const u=this.writer;u.ensureCapacity(9);const n=u.uint8;let i=u.x;o<=23?n[i++]=0+o:o<=255?(n[i++]=24,n[i++]=o):o<=65535?(n[i++]=25,u.view.setUint16(i,o),i+=2):o<=4294967295?(n[i++]=26,u.view.setUint32(i,o),i+=4):(n[i++]=27,u.view.setBigUint64(i,BigInt(o)),i+=8),u.x=i}encodeNumber(o){this.writeNumber(o)}encodeInteger(o){this.writeInteger(o)}encodeUint(o){this.writeUInteger(o)}encodeNint(o){const u=-1-o,n=this.writer;n.ensureCapacity(9);const i=n.uint8;let s=n.x;u<24?i[s++]=32+u:u<=255?(i[s++]=56,i[s++]=u):u<=65535?(i[s++]=57,n.view.setUint16(s,u),s+=2):u<=4294967295?(i[s++]=58,n.view.setUint32(s,u),s+=4):(i[s++]=59,n.view.setBigUint64(s,BigInt(u)),s+=8),n.x=s}writeFloat(o){this.writer.u8f64(251,o)}writeBin(o){const u=o.length;this.writeBinHdr(u),this.writer.buf(o,u)}writeBinHdr(o){const u=this.writer;o<=23?u.u8(64+o):o<=255?u.u16(22528+o):o<=65535?u.u8u16(89,o):o<=4294967295?u.u8u32(90,o):u.u8u64(91,o)}writeStr(o){const u=this.writer,i=o.length*4;u.ensureCapacity(5+i);const s=u.uint8;let r=u.x;i<=23?u.x++:i<=255?(s[u.x++]=120,r=u.x,u.x++):i<=65535?(s[u.x++]=121,r=u.x,u.x+=2):(s[u.x++]=122,r=u.x,u.x+=4);const t=u.utf8(o);i<=23?s[r]=96+t:i<=255?s[r]=t:i<=65535?u.view.setUint16(r,t):u.view.setUint32(r,t)}writeStrHdr(o){const u=this.writer;o<=23?u.u8(96+o):o<=255?u.u16(30720+o):o<=65535?u.u8u16(121,o):u.u8u32(122,o)}writeAsciiStr(o){this.writeStrHdr(o.length),this.writer.ascii(o)}writeArr(o){const u=o.length;this.writeArrHdr(u);for(let n=0;n<u;n++)this.writeAny(o[n])}writeArrHdr(o){const u=this.writer;o<=23?u.u8(128+o):o<=255?u.u16(38912+o):o<=65535?u.u8u16(153,o):o<=4294967295?u.u8u32(154,o):u.u8u64(155,o)}writeObj(o){const u=Object.keys(o),n=u.length;this.writeObjHdr(n);for(let i=0;i<n;i++){const s=u[i];this.writeStr(s),this.writeAny(o[s])}}writeObjHdr(o){const u=this.writer;o<=23?u.u8(160+o):o<=255?u.u16(47104+o):o<=65535?u.u8u16(185,o):o<=4294967295?u.u8u32(186,o):u.u8u64(187,o)}writeMapHdr(o){this.writeObjHdr(o)}writeStartMap(){this.writer.u8(191)}writeTag(o,u){this.writeTagHdr(o),this.writeAny(u)}writeTagHdr(o){const u=this.writer;o<=23?u.u8(192+o):o<=255?u.u16(55296+o):o<=65535?u.u8u16(217,o):o<=4294967295?u.u8u32(218,o):u.u8u64(219,o)}writeTkn(o){const u=this.writer;o<=23?u.u8(224+o):o<=255&&u.u16(63488+o)}writeStartStr(){this.writer.u8(127)}writeStrChunk(o){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(o){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(o){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(o,u){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}};return jn.CborEncoderFast=m,jn}var Vn={},aa;function hs(){if(aa)return Vn;aa=1,Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.JsonPackValue=void 0;let e=class{constructor(m){this.val=m}};return Vn.JsonPackValue=e,Vn}var la;function Pu(){if(la)return Tn;la=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.CborEncoder=void 0;const e=jh(),c=Au(),m=Vh(),d=hs();let o=class extends m.CborEncoderFast{writeUnknown(n){this.writeNull()}writeAny(n){switch(typeof n){case"number":return this.writeNumber(n);case"string":return this.writeStr(n);case"boolean":return this.writer.u8(244+ +n);case"object":{if(!n)return this.writer.u8(246);switch(n.constructor){case Object:return this.writeObj(n);case Array:return this.writeArr(n);case Uint8Array:return this.writeBin(n);case Map:return this.writeMap(n);case c.JsonPackExtension:return this.writeTag(n.tag,n.val);case d.JsonPackValue:const s=n.val;return this.writer.buf(s,s.length);default:return n instanceof Uint8Array?this.writeBin(n):Array.isArray(n)?this.writeArr(n):n instanceof Map?this.writeMap(n):this.writeUnknown(n)}}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(n);default:return this.writeUnknown(n)}}writeFloat(n){(0,e.isFloat32)(n)?this.writer.u8f32(250,n):this.writer.u8f64(251,n)}writeMap(n){this.writeMapHdr(n.size),n.forEach((i,s)=>{this.writeAny(s),this.writeAny(i)})}writeUndef(){this.writer.u8(247)}};return Tn.CborEncoder=o,Tn}var ua;function Mu(){if(ua)return On;ua=1,Object.defineProperty(On,"__esModule",{value:!0}),On.Encoder=void 0;const c=re.__importStar(Jt()),m=fs(),d=ce(),o=Pu();class u extends o.CborEncoder{constructor(i=new m.CrdtWriter){super(i),this.writer=i,this.patchSid=0}encode(i){this.writer.reset();const s=i.getId(),r=this.patchSid=s.sid,t=this.writer;t.vu57(r),t.vu57(s.time);const a=i.meta;return a===void 0?this.writeUndef():this.writeArr([a]),this.encodeOperations(i),t.flush()}encodeOperations(i){const s=i.ops,r=s.length;this.writer.vu57(r);for(let t=0;t<r;t++)this.encodeOperation(s[t])}encodeId(i){const s=i.sid,r=i.time,t=this.writer;s===this.patchSid?t.b1vu56(0,r):(t.b1vu56(1,r),t.vu57(s))}encodeTss(i){this.encodeId(i),this.writer.vu57(i.span)}writeInsStr(i,s,r,t){const a=this.writer;return i<=7?a.u8(96+i):(a.u8(96),a.vu57(i)),this.encodeId(s),this.encodeId(r),a.utf8(t)}encodeOperation(i){const s=this.writer;switch(i.constructor){case c.NewConOp:{const a=i.val;a instanceof d.Timestamp?(s.u8(1),this.encodeId(a)):(s.u8(0),this.writeAny(a));break}case c.NewValOp:{s.u8(8);break}case c.NewObjOp:{s.u8(16);break}case c.NewVecOp:{s.u8(24);break}case c.NewStrOp:{s.u8(32);break}case c.NewBinOp:{s.u8(40);break}case c.NewArrOp:{s.u8(48);break}case c.InsValOp:{const t=i;s.u8(72),this.encodeId(t.obj),this.encodeId(t.val);break}case c.InsObjOp:{const t=i,a=t.data,p=a.length;p<=7?s.u8(80+p):(s.u8(80),s.vu57(p)),this.encodeId(t.obj);for(let f=0;f<p;f++){const w=a[f];this.writeStr(w[0]),this.encodeId(w[1])}break}case c.InsVecOp:{const t=i,a=t.data,p=a.length;p<=7?s.u8(88+p):(s.u8(88),s.vu57(p)),this.encodeId(t.obj);for(let f=0;f<p;f++){const w=a[f];s.u8(w[0]),this.encodeId(w[1])}break}case c.InsStrOp:{const t=i,a=t.obj,p=t.ref,f=t.data,w=f.length;s.ensureCapacity(24+w*4);const y=s.x,b=this.writeInsStr(w,a,p,f);w!==b&&(s.x=y,this.writeInsStr(b,a,p,f));break}case c.InsBinOp:{const t=i,a=t.data,p=a.length;p<=7?s.u8(104+p):(s.u8(104),s.vu57(p)),this.encodeId(t.obj),this.encodeId(t.ref),s.buf(a,p);break}case c.InsArrOp:{const t=i,a=t.data,p=a.length;p<=7?s.u8(112+p):(s.u8(112),s.vu57(p)),this.encodeId(t.obj),this.encodeId(t.ref);for(let f=0;f<p;f++)this.encodeId(a[f]);break}case c.UpdArrOp:{const t=i;s.u8(120),this.encodeId(t.obj),this.encodeId(t.ref),this.encodeId(t.val);break}case c.DelOp:{const t=i,a=t.what,p=a.length;p<=7?s.u8(128+p):(s.u8(128),s.vu57(p)),this.encodeId(t.obj);for(let f=0;f<p;f++)this.encodeTss(a[f]);break}case c.NopOp:{const a=i.len;a<=7?s.u8(136+a):(s.u8(136),s.vu57(a));break}default:throw new Error("UNKNOWN_OP")}}}return On.Encoder=u,On}var An={},Pn={},Mn={},qn={},Rr={},vt={},ca;function Ah(){if(ca)return vt;ca=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.decodeAsciiMax15=vt.decodeAscii=void 0;const e=String.fromCharCode,c=(d,o,u)=>{const n=[];for(let i=0;i<u;i++){const s=d[o++];if(s&128)return;n.push(s)}return e.apply(String,n)};vt.decodeAscii=c;const m=(d,o,u)=>{if(u<4)if(u<2){if(u===0)return"";{const n=d[o++];if((n&128)>1){o-=1;return}return e(n)}}else{const n=d[o++],i=d[o++];if((n&128)>0||(i&128)>0){o-=2;return}if(u<3)return e(n,i);const s=d[o++];if((s&128)>0){o-=3;return}return e(n,i,s)}else{const n=d[o++],i=d[o++],s=d[o++],r=d[o++];if((n&128)>0||(i&128)>0||(s&128)>0||(r&128)>0){o-=4;return}if(u<6){if(u===4)return e(n,i,s,r);{const t=d[o++];if((t&128)>0){o-=5;return}return e(n,i,s,r,t)}}else if(u<8){const t=d[o++],a=d[o++];if((t&128)>0||(a&128)>0){o-=6;return}if(u<7)return e(n,i,s,r,t,a);const p=d[o++];if((p&128)>0){o-=7;return}return e(n,i,s,r,t,a,p)}else{const t=d[o++],a=d[o++],p=d[o++],f=d[o++];if((t&128)>0||(a&128)>0||(p&128)>0||(f&128)>0){o-=8;return}if(u<10){if(u===8)return e(n,i,s,r,t,a,p,f);{const w=d[o++];if((w&128)>0){o-=9;return}return e(n,i,s,r,t,a,p,f,w)}}else if(u<12){const w=d[o++],y=d[o++];if((w&128)>0||(y&128)>0){o-=10;return}if(u<11)return e(n,i,s,r,t,a,p,f,w,y);const b=d[o++];if((b&128)>0){o-=11;return}return e(n,i,s,r,t,a,p,f,w,y,b)}else{const w=d[o++],y=d[o++],b=d[o++],l=d[o++];if((w&128)>0||(y&128)>0||(b&128)>0||(l&128)>0){o-=12;return}if(u<14){if(u===12)return e(n,i,s,r,t,a,p,f,w,y,b,l);{const h=d[o++];if((h&128)>0){o-=13;return}return e(n,i,s,r,t,a,p,f,w,y,b,l,h)}}else{const h=d[o++],g=d[o++];if((h&128)>0||(g&128)>0){o-=14;return}if(u<15)return e(n,i,s,r,t,a,p,f,w,y,b,l,h,g);const v=d[o++];if((v&128)>0){o-=15;return}return e(n,i,s,r,t,a,p,f,w,y,b,l,h,g,v)}}}}};return vt.decodeAsciiMax15=m,vt}var Nr={},da;function Ph(){if(da)return Nr;da=1,Object.defineProperty(Nr,"__esModule",{value:!0});const e=String.fromCharCode;return Nr.default=(c,m,d)=>{let o=m;const u=o+d,n=[];for(;o<u;){let i=c[o++];if((i&128)!==0){const s=c[o++]&63;if((i&224)===192)i=(i&31)<<6|s;else{const r=c[o++]&63;if((i&240)===224)i=(i&31)<<12|s<<6|r;else if((i&248)===240){const t=c[o++]&63;let a=(i&7)<<18|s<<12|r<<6|t;if(a>65535){a-=65536;const p=a>>>10&1023|55296;i=56320|a&1023,n.push(p)}else i=a}}}n.push(i)}return e.apply(String,n)},Nr}var fa;function Mh(){if(fa)return Rr;fa=1,Object.defineProperty(Rr,"__esModule",{value:!0});const e=re,c=Ah(),m=e.__importDefault(Ph()),d=typeof Ee.Buffer<"u",o=d?Ee.Buffer.prototype.utf8Slice:null,u=d?Ee.Buffer.from:null,n=(t,a,p)=>(0,c.decodeAsciiMax15)(t,a,p)??(0,m.default)(t,a,p),i=(t,a,p)=>(0,c.decodeAscii)(t,a,p)??(0,m.default)(t,a,p),s=o?(t,a,p)=>o.call(t,a,a+p):u?(t,a,p)=>u(t).subarray(a,a+p).toString("utf8"):m.default,r=(t,a,p)=>p<16?n(t,a,p):p<32?i(t,a,p):s(t,a,p);return Rr.default=r,Rr}var ha;function qh(){if(ha)return qn;ha=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.decodeUtf8=void 0;const c=re.__importDefault(Mh());return qn.decodeUtf8=c.default,qn}var pa;function qu(){if(pa)return Mn;pa=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.Reader=void 0;const e=qh();let c=class{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(d){this.x=0,this.uint8=d,this.view=new DataView(d.buffer,d.byteOffset,d.length)}peak(){return this.view.getUint8(this.x)}skip(d){this.x+=d}buf(d){const o=this.x+d,u=this.uint8.subarray(this.x,o);return this.x=o,u}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let d=this.x;const o=(this.uint8[d++]<<8)+this.uint8[d++];return this.x=d,o}i16(){const d=this.view.getInt16(this.x);return this.x+=2,d}u32(){const d=this.view.getUint32(this.x);return this.x+=4,d}i32(){const d=this.view.getInt32(this.x);return this.x+=4,d}u64(){const d=this.view.getBigUint64(this.x);return this.x+=8,d}i64(){const d=this.view.getBigInt64(this.x);return this.x+=8,d}f32(){const d=this.x;return this.x+=4,this.view.getFloat32(d)}f64(){const d=this.x;return this.x+=8,this.view.getFloat64(d)}utf8(d){const o=this.x;return this.x+=d,(0,e.decodeUtf8)(this.uint8,o,d)}ascii(d){const o=this.uint8;let u="";const n=this.x+d;for(let i=this.x;i<n;i++)u+=String.fromCharCode(o[i]);return this.x=n,u}};return Mn.Reader=c,Mn}var ma;function Du(){if(ma)return Pn;ma=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.CrdtReader=void 0;const e=qu();let c=class extends e.Reader{id(){const d=this.u8();return d<=127?[d>>>4,d&15]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const d=this.u8();if(d<=127)return d;const o=this.u8();if(o<=127)return o<<7|d&127;const u=this.u8();if(u<=127)return u<<14|(o&127)<<7|d&127;const n=this.u8();if(n<=127)return n<<21|(u&127)<<14|(o&127)<<7|d&127;const i=this.u8();if(i<=127)return i*268435456+((n&127)<<21|(u&127)<<14|(o&127)<<7|d&127);const s=this.u8();if(s<=127)return s*34359738368+((i&127)*268435456+((n&127)<<21|(u&127)<<14|(o&127)<<7|d&127));const r=this.u8();return r<=127?r*4398046511104+((s&127)*34359738368+((i&127)*268435456+((n&127)<<21|(u&127)<<14|(o&127)<<7|d&127))):this.u8()*562949953421312+((r&127)*4398046511104+((s&127)*34359738368+((i&127)*268435456+((n&127)<<21|(u&127)<<14|(o&127)<<7|d&127))))}vu57Skip(){this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.u8()<=127||this.x++}b1vu56(){const d=this.u8(),o=d&128?1:0,u=127&d;if(u<=63)return[o,u];const n=this.u8();if(n<=127)return[o,n<<6|u&63];const i=this.u8();if(i<=127)return[o,i<<13|(n&127)<<6|u&63];const s=this.u8();if(s<=127)return[o,s<<20|(i&127)<<13|(n&127)<<6|u&63];const r=this.u8();if(r<=127)return[o,r*134217728+((s&127)<<20|(i&127)<<13|(n&127)<<6|u&63)];const t=this.u8();if(t<=127)return[o,t*17179869184+((r&127)*134217728+((s&127)<<20|(i&127)<<13|(n&127)<<6|u&63))];const a=this.u8();if(a<=127)return[o,a*2199023255552+((t&127)*17179869184+((r&127)*134217728+((s&127)<<20|(i&127)<<13|(n&127)<<6|u&63)))];const p=this.u8();return[o,p*281474976710656+((a&127)*2199023255552+((t&127)*17179869184+((r&127)*134217728+((s&127)<<20|(i&127)<<13|(n&127)<<6|u&63))))]}};return Pn.CrdtReader=c,Pn}var Dn={},Bn={},Fn={},ga;function Dh(){if(ga)return Fn;ga=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.decodeF16=void 0;const e=Math.pow,c=m=>{const d=(m&31744)>>10,o=m&1023;return(m>>15?-1:1)*(d?d===31?o?NaN:1/0:e(2,d-15)*(1+o/1024):6103515625e-14*(o/1024))};return Fn.decodeF16=c,Fn}var Er={},Ln={},Tr={},ba;function Bh(){if(ba)return Tr;ba=1,Object.defineProperty(Tr,"__esModule",{value:!0});const e=String.fromCharCode;return Tr.default=(c,m,d)=>{let o=m;const u=o+d;let n="";for(;o<u;){const i=c[o++];if((i&128)===0){n+=e(i);continue}const s=c[o++]&63;if((i&224)===192){n+=e((i&31)<<6|s);continue}const r=c[o++]&63;if((i&240)===224){n+=e((i&31)<<12|s<<6|r);continue}if((i&248)===240){const t=c[o++]&63;let a=(i&7)<<18|s<<12|r<<6|t;if(a>65535){a-=65536;const p=a>>>10&1023|55296;a=56320|a&1023,n+=e(p,a)}else n+=e(a)}else n+=e(i)}return n},Tr}var ya;function Fh(){if(ya)return Ln;ya=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.CachedUtf8Decoder=void 0;const c=re.__importDefault(Bh());let m=1+Math.round(Math.random()*((-1>>>0)-1));function d(n,i){return m^=m<<13,m^=m>>>17,m^=m<<5,(m>>>0)%(i-n+1)+n}class o{constructor(i,s){this.bytes=i,this.value=s}}let u=class{constructor(){this.caches=[];for(let i=0;i<31;i++)this.caches.push([])}get(i,s,r){const t=this.caches[r-1],a=t.length;e:for(let p=0;p<a;p++){const f=t[p],w=f.bytes;for(let y=0;y<r;y++)if(w[y]!==i[s+y])continue e;return f.value}return null}store(i,s){const r=this.caches[i.length-1],t=new o(i,s);r.length>=16?r[d(0,15)]=t:r.push(t)}decode(i,s,r){if(!r)return"";const t=this.get(i,s,r);if(t!==null)return t;const a=(0,c.default)(i,s,r),p=Uint8Array.prototype.slice.call(i,s,s+r);return this.store(p,a),a}};return Ln.CachedUtf8Decoder=u,Ln}var va;function Lh(){if(va)return Er;va=1,Object.defineProperty(Er,"__esModule",{value:!0});const e=Fh();return Er.default=new e.CachedUtf8Decoder,Er}var wa;function Bu(){if(wa)return Bn;wa=1,Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.CborDecoderBase=void 0;const e=re,c=Dh(),m=Au(),d=hs(),o=qu(),u=e.__importDefault(Lh());let n=class{constructor(s=new o.Reader,r=u.default){this.reader=s,this.keyDecoder=r}read(s){return this.reader.reset(s),this.val()}decode(s){return this.reader.reset(s),this.val()}val(){const r=this.reader.u8(),t=r>>5,a=r&31;return t<4?t<2?t===0?this.readUint(a):this.readNint(a):t===2?this.readBin(a):this.readStr(a):t<6?t===4?this.readArr(a):this.readObj(a):t===6?this.readTag(a):this.readTkn(a)}readAnyRaw(s){const r=s>>5,t=s&31;return r<4?r<2?r===0?this.readUint(t):this.readNint(t):r===2?this.readBin(t):this.readStr(t):r<6?r===4?this.readArr(t):this.readObj(t):r===6?this.readTag(t):this.readTkn(t)}readMinorLen(s){if(s<24)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(s){if(s<25)return s===24?this.reader.u8():s;if(s<27)return s===25?this.reader.u16():this.reader.u32();{const r=this.reader.u64();return r>9007199254740991?r:Number(r)}}readNint(s){if(s<25)return s===24?-this.reader.u8()-1:-s-1;if(s<27)return s===25?-this.reader.u16()-1:-this.reader.u32()-1;{const r=this.reader.u64();return r>9007199254740991-1?-r-BigInt(1):-Number(r)-1}}readBin(s){const r=this.reader;if(s<=23)return r.buf(s);switch(s){case 24:return r.buf(r.u8());case 25:return r.buf(r.u16());case 26:return r.buf(r.u32());case 27:return r.buf(Number(r.u64()));case 31:{let t=0;const a=[];for(;this.reader.peak()!==255;){const y=this.readBinChunk();t+=y.length,a.push(y)}this.reader.x++;const p=new Uint8Array(t);let f=0;const w=a.length;for(let y=0;y<w;y++){const b=a[y];p.set(b,f),f+=b.length}return p}default:throw 1}}readBinChunk(){const s=this.reader.u8(),r=s>>5,t=s&31;if(r!==2)throw 2;if(t>27)throw 3;return this.readBin(t)}readAsStr(){const r=this.reader.u8(),t=r>>5,a=r&31;if(t!==3)throw 11;return this.readStr(a)}readStr(s){const r=this.reader;if(s<=23)return r.utf8(s);switch(s){case 24:return r.utf8(r.u8());case 25:return r.utf8(r.u16());case 26:return r.utf8(r.u32());case 27:return r.utf8(Number(r.u64()));case 31:{let t="";for(;r.peak()!==255;)t+=this.readStrChunk();return this.reader.x++,t}default:throw 1}}readStrLen(s){if(s<=23)return s;switch(s){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const s=this.reader.u8(),r=s>>5,t=s&31;if(r!==3)throw 4;if(t>27)throw 5;return this.readStr(t)}readArr(s){const r=this.readMinorLen(s);return r>=0?this.readArrRaw(r):this.readArrIndef()}readArrRaw(s){const r=[];for(let t=0;t<s;t++)r.push(this.val());return r}readArrIndef(){const s=[];for(;this.reader.peak()!==255;)s.push(this.val());return this.reader.x++,s}readObj(s){if(s<28){let r=s;switch(s){case 24:r=this.reader.u8();break;case 25:r=this.reader.u16();break;case 26:r=this.reader.u32();break;case 27:r=Number(this.reader.u64());break}const t={};for(let a=0;a<r;a++){const p=this.key();if(p==="__proto__")throw 6;const f=this.val();t[p]=f}return t}else{if(s===31)return this.readObjIndef();throw 1}}readObjRaw(s){const r={};for(let t=0;t<s;t++){const a=this.key(),p=this.val();r[a]=p}return r}readObjIndef(){const s={};for(;this.reader.peak()!==255;){const r=this.key();if(this.reader.peak()===255)throw 7;const t=this.val();s[r]=t}return this.reader.x++,s}key(){const s=this.reader.u8(),r=s>>5,t=s&31;if(r!==3)return String(this.readAnyRaw(s));const a=this.readStrLen(t);if(a>31)return this.reader.utf8(a);const p=this.keyDecoder.decode(this.reader.uint8,this.reader.x,a);return this.reader.skip(a),p}readTag(s){if(s<=23)return this.readTagRaw(s);switch(s){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(s){return new m.JsonPackExtension(s,this.val())}readTkn(s){switch(s){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new d.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(s<=23)return new d.JsonPackValue(s);throw 1}f16(){return(0,c.decodeF16)(this.reader.u16())}};return Bn.CborDecoderBase=n,Bn}var _a;function Uh(){if(_a)return Dn;_a=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.CborDecoder=void 0;const e=Bu(),c=hs();let m=class extends e.CborDecoderBase{readAsMap(){const o=this.reader.u8(),u=o>>5,n=o&31;switch(u){case 5:return this.readMap(n);default:throw 0}}readMap(o){const u=this.readMinorLen(o);return u>=0?this.readMapRaw(u):this.readMapIndef()}readMapRaw(o){const u=new Map;for(let n=0;n<o;n++){const i=this.val(),s=this.val();u.set(i,s)}return u}readMapIndef(){const o=new Map;for(;this.reader.peak()!==255;){const u=this.val();if(this.reader.peak()===255)throw 7;const n=this.val();o.set(u,n)}return this.reader.x++,o}skipN(o){for(let u=0;u<o;u++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(o){const u=o>>5,n=o&31;switch(u){case 0:case 1:this.skipUNint(n);break;case 2:this.skipBin(n);break;case 3:this.skipStr(n);break;case 4:this.skipArr(n);break;case 5:this.skipObj(n);break;case 7:this.skipTkn(n);break;case 6:this.skipTag(n);break}}skipMinorLen(o){if(o<=23)return o;switch(o){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(o){if(!(o<=23))switch(o){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(o){const u=this.skipMinorLen(o);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const o=this.reader.u8(),u=o>>5,n=o&31;if(u!==2)throw 2;if(n>27)throw 3;this.skipBin(n)}skipStr(o){const u=this.skipMinorLen(o);if(u>=0)this.reader.skip(u);else{for(;this.reader.peak()!==255;)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const o=this.reader.u8(),u=o>>5,n=o&31;if(u!==3)throw 4;if(n>27)throw 5;this.skipStr(n)}skipArr(o){const u=this.skipMinorLen(o);if(u>=0)this.skipN(u);else{for(;this.reader.peak()!==255;)this.skipAny();this.reader.x++}}skipObj(o){const u=this.readMinorLen(o);if(u>=0)return this.skipN(u*2);for(;this.reader.peak()!==255;){if(this.skipAny(),this.reader.peak()===255)throw 7;this.skipAny()}this.reader.x++}skipTag(o){if(this.skipMinorLen(o)<0)throw 1;this.skipAny()}skipTkn(o){switch(o){case 24:this.reader.skip(1);return;case 25:this.reader.skip(2);return;case 26:this.reader.skip(4);return;case 27:this.reader.skip(8);return}if(!(o<=23))throw 1}validate(o,u=0,n=o.length){this.reader.reset(o),this.reader.x=u;const i=u;if(this.skipAny(),this.reader.x-i!==n)throw 8}decodeLevel(o){return this.reader.reset(o),this.readLevel()}readLevel(){const o=this.reader.u8(),u=o>>5,n=o&31;switch(u){case 4:return this.readArrLevel(n);case 5:return this.readObjLevel(n);default:return super.readAnyRaw(o)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const o=this.reader,u=o.x;this.skipAny();const n=o.x;return new c.JsonPackValue(o.uint8.subarray(u,n))}readObjLevel(o){const u=this.readMinorLen(o);return u>=0?this.readObjRawLevel(u):this.readObjIndefLevel()}readObjRawLevel(o){const u={};for(let n=0;n<o;n++){const i=this.key(),s=this.readPrimitiveOrVal();u[i]=s}return u}readObjIndefLevel(){const o={};for(;this.reader.peak()!==255;){const u=this.key();if(this.reader.peak()===255)throw 7;const n=this.readPrimitiveOrVal();o[u]=n}return this.reader.x++,o}readArrLevel(o){const u=this.readMinorLen(o);return u>=0?this.readArrRawLevel(u):this.readArrIndefLevel()}readArrRawLevel(o){const u=[];for(let n=0;n<o;n++)u.push(this.readPrimitiveOrVal());return u}readArrIndefLevel(){const o=[];for(;this.reader.peak()!==255;)o.push(this.readPrimitiveOrVal());return this.reader.x++,o}readHdr(o){const u=this.reader.u8();if(u>>5!==o)throw 0;const i=u&31;if(i<24)return i;switch(i){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(o){const u=this.readObjHdr();for(let n=0;n<u;n++){if(this.key()===o)return this;this.skipAny()}throw 9}findIndex(o){const u=this.readArrHdr();if(o>=u)throw 10;for(let n=0;n<o;n++)this.skipAny();return this}find(o){for(let u=0;u<o.length;u++){const n=o[u];typeof n=="string"?this.findKey(n):this.findIndex(n)}return this}};return Dn.CborDecoder=m,Dn}var Sa;function Fu(){if(Sa)return An;Sa=1,Object.defineProperty(An,"__esModule",{value:!0}),An.Decoder=void 0;const e=Du(),c=ce(),m=Lr(),d=Uh();class o extends d.CborDecoder{constructor(n=new e.CrdtReader){super(n)}decode(n){return this.reader.reset(n),this.readPatch()}readPatch(){const n=this.reader,i=n.vu57(),s=n.vu57(),t=i===1?new c.ServerClockVector(1,s):new c.ClockVector(i,s);this.patchSid=t.sid;const a=this.builder=new m.PatchBuilder(t),p=this.val();return Array.isArray(p)&&(a.patch.meta=p[0]),this.decodeOperations(),a.patch}decodeId(){const n=this.reader,[i,s]=n.b1vu56();return i?new c.Timestamp(n.vu57(),s):new c.Timestamp(this.patchSid,s)}decodeTss(){const n=this.decodeId(),i=this.reader.vu57();return(0,c.interval)(n,0,i)}decodeOperations(){const i=this.reader.vu57();for(let s=0;s<i;s++)this.decodeOperation()}decodeOperation(){const n=this.builder,i=this.reader,s=i.u8();switch(s>>3){case 0:{const t=s&7;n.con(t?this.decodeId():this.val());break}case 1:{n.val();break}case 2:{n.obj();break}case 3:{n.vec();break}case 4:{n.str();break}case 5:{n.bin();break}case 6:{n.arr();break}case 9:{const t=this.decodeId(),a=this.decodeId();n.setVal(t,a);break}case 10:{const t=s&7||i.vu57(),a=this.decodeId(),p=[];for(let f=0;f<t;f++){const w=this.val();if(typeof w!="string")continue;const y=this.decodeId();p.push([w,y])}n.insObj(a,p);break}case 11:{const t=s&7||i.vu57(),a=this.decodeId(),p=[];for(let f=0;f<t;f++){const w=this.val();if(typeof w!="number")continue;const y=this.decodeId();p.push([w,y])}n.insVec(a,p);break}case 12:{const t=s&7||i.vu57(),a=this.decodeId(),p=this.decodeId(),f=i.utf8(t);n.insStr(a,p,f);break}case 13:{const t=s&7||i.vu57(),a=this.decodeId(),p=this.decodeId(),f=i.buf(t);if(!(f instanceof Uint8Array))return;n.insBin(a,p,f);break}case 14:{const t=s&7||i.vu57(),a=this.decodeId(),p=this.decodeId(),f=[];for(let w=0;w<t;w++)f.push(this.decodeId());n.insArr(a,p,f);break}case 15:{const t=this.decodeId(),a=this.decodeId(),p=this.decodeId();n.updArr(t,a,p);break}case 16:{const t=s&7||i.vu57(),a=this.decodeId(),p=[];for(let f=0;f<t;f++)p.push(this.decodeTss());n.del(a,p);break}case 17:{const t=s&7||i.vu57();n.nop(t);break}default:throw new Error("UNKNOWN_OP")}}}return An.Decoder=o,An}var gi={},xa;function $h(){return xa||(xa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.decoder=e.encode=e.encoder=void 0;const c=Mu(),m=Fu(),d=fs(),o=new d.CrdtWriter(1024*4);e.encoder=new c.Encoder(o);const u=i=>e.encoder.encode(i);e.encode=u,e.decoder=new m.Decoder;const n=i=>e.decoder.decode(i);e.decode=n}(gi)),gi}var Ca;function zh(){return Ca||(Ca=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Mu(),e),c.__exportStar(Fu(),e),c.__exportStar($h(),e)}(mi)),mi}var Oa;function Uu(){if(Oa)return Cn;Oa=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.Patch=void 0;const c=re.__importStar(Jt()),m=ce(),d=Ye(),o=zh();let u=class Lu{constructor(){this.ops=[],this.meta=void 0}static fromBinary(i){return(0,o.decode)(i)}getId(){const i=this.ops[0];if(i)return i.id}span(){let i=0;for(const s of this.ops)i+=s.span();return i}nextTime(){const i=this.ops,s=i.length;if(!s)return 0;const r=i[s-1];return r.id.time+r.span()}rewriteTime(i){const s=new Lu,r=this.ops,t=r.length,a=s.ops;for(let p=0;p<t;p++){const f=r[p];f instanceof c.DelOp?a.push(new c.DelOp(i(f.id),i(f.obj),f.what)):f instanceof c.NewConOp?a.push(new c.NewConOp(i(f.id),f.val instanceof m.Timestamp?i(f.val):f.val)):f instanceof c.NewVecOp?a.push(new c.NewVecOp(i(f.id))):f instanceof c.NewValOp?a.push(new c.NewValOp(i(f.id))):f instanceof c.NewObjOp?a.push(new c.NewObjOp(i(f.id))):f instanceof c.NewStrOp?a.push(new c.NewStrOp(i(f.id))):f instanceof c.NewBinOp?a.push(new c.NewBinOp(i(f.id))):f instanceof c.NewArrOp?a.push(new c.NewArrOp(i(f.id))):f instanceof c.InsArrOp?a.push(new c.InsArrOp(i(f.id),i(f.obj),i(f.ref),f.data.map(i))):f instanceof c.UpdArrOp?a.push(new c.UpdArrOp(i(f.id),i(f.obj),i(f.ref),i(f.val))):f instanceof c.InsStrOp?a.push(new c.InsStrOp(i(f.id),i(f.obj),i(f.ref),f.data)):f instanceof c.InsBinOp?a.push(new c.InsBinOp(i(f.id),i(f.obj),i(f.ref),f.data)):f instanceof c.InsValOp?a.push(new c.InsValOp(i(f.id),i(f.obj),i(f.val))):f instanceof c.InsObjOp?a.push(new c.InsObjOp(i(f.id),i(f.obj),f.data.map(([w,y])=>[w,i(y)]))):f instanceof c.InsVecOp?a.push(new c.InsVecOp(i(f.id),i(f.obj),f.data.map(([w,y])=>[w,i(y)]))):f instanceof c.NopOp&&a.push(new c.NopOp(i(f.id),f.len))}return s}rebase(i,s){const r=this.getId();if(!r)throw new Error("EMPTY_PATCH");const t=r.sid,a=r.time;if(s??(s=a),a===i)return this;const p=i-a;return this.rewriteTime(f=>{if(f.sid!==t)return f;const w=f.time;return w<s?f:(0,m.ts)(t,w+p)})}clone(){return this.rewriteTime(i=>i)}toBinary(){return(0,o.encode)(this)}toString(i=""){const s=this.getId();return`Patch ${s?(0,m.printTs)(s):"(nil)"}!${this.span()}`+(0,d.printTree)(i,this.ops.map(t=>a=>t.toString(a)))}};return Cn.Patch=u,Cn}var bi={},yi={},Ra;function Gh(){return Ra||(Ra=1,Object.defineProperty(yi,"__esModule",{value:!0})),yi}var Na;function Fr(){return Na||(Na=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ORIGIN=void 0;const c=re,m=ce();c.__exportStar(Gh(),e),e.ORIGIN=(0,m.ts)(0,0)}(bi)),bi}var vi={},Ea;function $u(){return Ea||(Ea=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.s=e.schema=e.nodes=e.NodeBuilder=void 0;const c=ds(),m=ce(),d=n=>{switch(typeof n){case"number":case"boolean":case"undefined":return!0;case"object":return n===null||n instanceof m.Timestamp;default:return!1}};class o{constructor(i){this.build=i}}e.NodeBuilder=o;var u;(function(n){class i extends o{constructor(b){super(l=>l.con(b)),this.raw=b,this.type="con"}}n.con=i;class s extends o{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="str"}}n.str=s;class r extends o{constructor(b){super(l=>l.json(b)),this.raw=b,this.type="bin"}}n.bin=r;class t extends o{constructor(b){super(l=>{const h=l.val(),g=b.build(l);return l.setVal(h,g),h}),this.value=b,this.type="val"}}n.val=t;class a extends o{constructor(b){super(l=>{const h=l.vec(),g=b.length;if(g){const v=[];for(let _=0;_<g;_++){const C=b[_].build(l);v.push([_,C])}l.insVec(h,v)}return h}),this.value=b,this.type="vec"}}n.vec=a;class p extends o{constructor(b,l){super(h=>{const g=h.obj(),v=[],_={...b,...l},S=Object.keys(_),C=S.length;if(C){for(let O=0;O<C;O++){const x=S[O],R=_[x].build(h);v.push([x,R])}h.insObj(g,v)}return g}),this.obj=b,this.opt=l,this.type="obj"}optional(){return this}}n.obj=p;class f extends o{constructor(b){super(l=>{const h=l.arr(),g=b.length;if(g){const v=[];for(let _=0;_<g;_++)v.push(b[_].build(l));l.insArr(h,h,v)}return h}),this.arr=b,this.type="arr"}}n.arr=f;class w extends o{constructor(b,l){super(h=>{const g=new Uint8Array([b,0,0]),v=h.vec();return g[1]=v.sid%256,g[2]=v.time%256,h.insVec(v,[[0,h.constOrJson(e.s.con(g))],[1,l.build(h)]]),v}),this.id=b,this.data=l,this.type="ext"}}n.ext=w})(u||(e.nodes=u={})),e.schema={con:n=>new u.con(n),str:n=>new u.str(n||""),bin:n=>new u.bin(n),val:n=>new u.val(n),vec:(...n)=>new u.vec(n),obj:(n,i)=>new u.obj(n,i),map:n=>e.schema.obj(n),arr:n=>new u.arr(n),json:n=>{switch(typeof n){case"object":{if(!n)return e.s.val(e.s.con(n));if(n instanceof o)return n;if(Array.isArray(n))return e.s.arr(n.map(i=>e.s.json(i)));if((0,c.isUint8Array)(n))return e.s.bin(n);if(n instanceof m.Timestamp)return e.s.val(e.s.con(n));{const i={},s=Object.keys(n);for(const r of s)i[r]=e.s.jsonCon(n[r]);return e.s.obj(i)}}case"string":return e.s.str(n);default:return e.s.val(e.s.con(n))}},jsonCon:n=>d(n)?e.s.con(n):e.s.json(n),ext:(n,i)=>new u.ext(n,i)},e.s=e.schema}(vi)),vi}var Ta;function Lr(){if(Ta)return Sn;Ta=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.PatchBuilder=void 0;const c=re.__importStar(Jt()),m=ce(),d=ds(),o=Uu(),u=Fr(),n=$u(),i=r=>{switch(typeof r){case"number":case"boolean":return!0;default:return r===null}};let s=class{constructor(t){this.clock=t,this.patch=new o.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const t=this.patch;return this.patch=new o.Patch,t}obj(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewObjOp(t)),t}arr(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewArrOp(t)),t}vec(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewVecOp(t)),t}str(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewStrOp(t)),t}bin(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewBinOp(t)),t}con(t){this.pad();const a=this.clock.tick(1);return this.patch.ops.push(new c.NewConOp(a,t)),a}val(){this.pad();const t=this.clock.tick(1);return this.patch.ops.push(new c.NewValOp(t)),t}root(t){return this.setVal(u.ORIGIN,t)}insObj(t,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),f=new c.InsObjOp(p,t,a),w=f.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(f),p}insVec(t,a){if(!a.length)throw new Error("EMPTY_TUPLES");this.pad();const p=this.clock.tick(1),f=new c.InsVecOp(p,t,a),w=f.span();return w>1&&this.clock.tick(w-1),this.patch.ops.push(f),p}setVal(t,a){this.pad();const p=this.clock.tick(1),f=new c.InsValOp(p,t,a);return this.patch.ops.push(f),p}insStr(t,a,p){if(!p.length)throw new Error("EMPTY_STRING");this.pad();const f=this.clock.tick(1),w=new c.InsStrOp(f,t,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),f}insBin(t,a,p){if(!p.length)throw new Error("EMPTY_BINARY");this.pad();const f=this.clock.tick(1),w=new c.InsBinOp(f,t,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),f}insArr(t,a,p){this.pad();const f=this.clock.tick(1),w=new c.InsArrOp(f,t,a,p),y=w.span();return y>1&&this.clock.tick(y-1),this.patch.ops.push(w),f}updArr(t,a,p){this.pad();const f=this.clock.tick(1),w=new c.UpdArrOp(f,t,a,p);return this.patch.ops.push(w),f}del(t,a){this.pad();const p=this.clock.tick(1);return this.patch.ops.push(new c.DelOp(p,t,a)),p}nop(t){this.pad();const a=this.clock.tick(t);return this.patch.ops.push(new c.NopOp(a,t)),a}jsonObj(t){const a=this.obj(),p=Object.keys(t);if(p.length){const f=[];for(const w of p){const y=t[w],b=y instanceof m.Timestamp?y:i(y)?this.con(y):this.json(y);f.push([w,b])}this.insObj(a,f)}return a}jsonArr(t){const a=this.arr();if(t.length){const p=[];for(const f of t)p.push(this.json(f));this.insArr(a,a,p)}return a}jsonStr(t){const a=this.str();return t&&this.insStr(a,a,t),a}jsonBin(t){const a=this.bin();return t.length&&this.insBin(a,a,t),a}jsonVal(t){const a=this.val(),p=this.con(t);return this.setVal(a,p),a}json(t){if(t instanceof m.Timestamp)return t;if(t===void 0)return this.con(t);if(t instanceof Array)return this.jsonArr(t);if((0,d.isUint8Array)(t))return this.jsonBin(t);if(t instanceof n.NodeBuilder)return t.build(this);switch(typeof t){case"object":return t===null?this.jsonVal(t):this.jsonObj(t);case"string":return this.jsonStr(t);case"number":case"boolean":return this.jsonVal(t)}throw new Error("INVALID_JSON")}constOrJson(t){return t instanceof m.Timestamp?t:i(t)?this.con(t):this.json(t)}maybeConst(t){return t instanceof m.Timestamp?t:this.con(t)}pad(){const t=this.patch.nextTime();if(!t)return;const a=this.clock.time-t;if(a>0){const p=(0,m.ts)(this.clock.sid,t),f=new c.NopOp(p,a);this.patch.ops.push(f)}}};return Sn.PatchBuilder=s,Sn}var Ia;function Wh(){if(Ia)return yn;Ia=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.decode=void 0;const e=Ih(),c=ce(),m=Lr(),d=(n,i)=>Array.isArray(i)?new c.Timestamp(i[0],i[1]):new c.Timestamp(n,i),o=(n,i)=>i.length===3?new c.Timespan(i[0],i[1],i[2]):new c.Timespan(n,i[0],i[1]),u=n=>{const i=n[0],s=i[0],r=Array.isArray(s)?new c.ClockVector(s[0],s[1]):new c.ServerClockVector(1,s),t=r.sid;r.time;const a=new m.PatchBuilder(r),p=n.length;for(let w=1;w<p;w++){const y=n[w];switch(y[0]){case 0:{const[,b,l]=y;a.con(l?d(t,b):b);break}case 1:{a.val();break}case 2:{a.obj();break}case 3:{a.vec();break}case 4:{a.str();break}case 5:{a.bin();break}case 6:{a.arr();break}case 9:{a.setVal(d(t,y[1]),d(t,y[2]));break}case 10:{const b=d(t,y[1]),l=[],h=y[2],g=h.length;for(let v=0;v<g;v++){const[_,S]=h[v];l.push([_,d(t,S)])}a.insObj(b,l);break}case 11:{const b=d(t,y[1]),l=[],h=y[2],g=h.length;for(let v=0;v<g;v++){const[_,S]=h[v];l.push([_,d(t,S)])}a.insVec(b,l);break}case 12:{a.insStr(d(t,y[1]),d(t,y[2]),y[3]);break}case 13:{a.insBin(d(t,y[1]),d(t,y[2]),(0,e.fromBase64)(y[3]));break}case 14:{const b=d(t,y[1]),l=d(t,y[2]),h=y[3],g=[],v=h.length;for(let _=0;_<v;_++)g.push(d(t,h[_]));a.insArr(b,l,g);break}case 15:{const b=d(t,y[1]),l=d(t,y[2]),h=d(t,y[3]);a.updArr(b,l,h);break}case 16:{const b=d(t,y[1]),l=y[2],h=[],g=l.length;for(let v=0;v<g;v++)h.push(o(t,l[v]));a.del(b,h);break}case 17:{a.nop(y[1]||1);break}}}const f=a.patch;return f.meta=i[1],f};return yn.decode=u,yn}var ka;function Hh(){return ka||(ka=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Sh(),e),c.__exportStar(Nh(),e),c.__exportStar(Wh(),e)}(ci)),ci}var Ar=Hh();function ja(e){return new TextEncoder().encode(JSON.stringify(e)).length}function Jh(e){const c=Ar.decode(e),m=c.getId(),d=c.span();return[[m==null?void 0:m.sid,m.time+d]]}function Kh(e,c){if(!e.ops||e.ops.length===0)return[];const m=Ar.encode(e),d=ja(m);if(d<=c)return[m];if(e.ops.length==1)return console.warn(`Patch is too large (${d} B) but cannot be split further since it only contains one operation.`),[m];const o=m[0],u=[];let n=[o];for(let i=1;i<m.length;i+=1){const s=n.length-1;ja([...n,m[i]])>c&&s>0&&(u.push(n),n=[Jh(n)]),n.push(m[i])}return n.length>1&&u.push(n),u}var wi={},_i={},Si={},Va;function Yh(){return Va||(Va=1,Object.defineProperty(Si,"__esModule",{value:!0})),Si}var xi={},Un={},Aa;function Ur(){if(Aa)return Un;Aa=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.ConNode=void 0;const e=ce();let c=class{constructor(d,o){this.id=d,this.val=o,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(d){const o=this.val,u=o instanceof Uint8Array?`Uint8Array { ${(""+o).replaceAll(",",", ")} }`:`{ ${o instanceof e.Timestamp?(0,e.printTs)(o):JSON.stringify(o)} }`;return`${this.name()} ${(0,e.printTs)(this.id)} ${u}`}};return Un.ConNode=c,Un}var $n={},wt={},_t={},zn={},Gn={},Wn={},Pa;function Xh(){if(Pa)return Wn;Pa=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.RelativeTimestamp=void 0;let e=class{constructor(m,d){this.sessionIndex=m,this.timeDiff=d}};return Wn.RelativeTimestamp=e,Wn}var Ma;function Qh(){if(Ma)return Gn;Ma=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.ClockEncoder=void 0;const e=ce(),c=Xh();class m{constructor(u,n){this.index=u,this.clock=n}}let d=class{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(u){this.index=1,this.clock=u;const n=new m(this.index++,(0,e.tick)(u,-1));this.table.clear(),this.table.set(u.sid,n)}append(u){const n=u.time,i=u.sid;let s=this.table.get(i);if(!s){let a=this.clock.peers.get(i);a||(a=new e.Timestamp(i,this.clock.time-1)),s=new m(this.index++,a),this.table.set(i,s)}const t=s.clock.time-n;if(t<0)throw new Error("TIME_TRAVEL");return new c.RelativeTimestamp(s.index,t)}toJson(){const u=[];return this.table.forEach(n=>{const i=n.clock;u.push(i.sid,i.time)}),u}};return Gn.ClockEncoder=d,Gn}var St={},qa;function zu(){if(qa)return St;qa=1,Object.defineProperty(St,"__esModule",{value:!0}),St.CRDT_MAJOR_OVERLAY=St.CRDT_MAJOR=void 0;var e;(function(m){m[m.CON=0]="CON",m[m.VAL=1]="VAL",m[m.OBJ=2]="OBJ",m[m.VEC=3]="VEC",m[m.STR=4]="STR",m[m.BIN=5]="BIN",m[m.ARR=6]="ARR"})(e||(St.CRDT_MAJOR=e={}));var c;return function(m){m[m.CON=0]="CON",m[m.VAL=32]="VAL",m[m.VEC=96]="VEC",m[m.OBJ=64]="OBJ",m[m.STR=128]="STR",m[m.BIN=160]="BIN",m[m.ARR=192]="ARR"}(c||(St.CRDT_MAJOR_OVERLAY=c={})),St}var Da;function Zh(){if(Da)return zn;Da=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.Encoder=void 0;const c=re.__importStar(ht()),m=Qh(),d=fs(),o=ce(),u=Pu(),n=zu();class i extends u.CborEncoder{constructor(r){super(r||new d.CrdtWriter),this.clockEncoder=new m.ClockEncoder,this.time=0,this.cTableEntry=t=>{const a=t.clock,p=this.writer;p.vu57(a.sid),p.vu57(a.time)},this.tsLogical=t=>{const a=this.clockEncoder.append(t);this.writer.id(a.sessionIndex,a.timeDiff)},this.tsServer=t=>{this.writer.vu57(t.time)},this.ts=this.tsLogical,this.cKey=(t,a)=>{this.writeStr(a),this.cNode(this.doc.index.get(t))}}encode(r){this.doc=r;const t=this.writer;return t.reset(),r.clock.sid===1?this.encodeServer(r):this.encodeLogical(r),t.flush()}encodeLogical(r){const t=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(r.clock),t.ensureCapacity(4);const a=t.x0,p=t.x;t.x+=4,this.cRoot(r.root),this.encodeClockTable(a,p)}encodeServer(r){this.ts=this.tsServer;const t=this.writer;t.u8(128),t.vu57(this.time=r.clock.time),this.cRoot(r.root)}encodeClockTable(r,t){const a=this.writer,p=a.x0-r;a.view.setUint32(a.x0+(t-r),a.x-t-p-4);const w=this.clockEncoder.table,y=w.size;a.vu57(y),w.forEach(this.cTableEntry)}cRoot(r){r.val.sid===0?this.writer.u8(0):this.cNode(r.node())}writeTL(r,t){const a=this.writer;t<31?a.u8(r|t):(a.u8(r|31),a.vu57(t))}cNode(r){r instanceof c.ConNode?this.cCon(r):r instanceof c.ValNode?this.cVal(r):r instanceof c.StrNode?this.cStr(r):r instanceof c.ObjNode?this.cObj(r):r instanceof c.VecNode?this.cVec(r):r instanceof c.ArrNode?this.cArr(r):r instanceof c.BinNode&&this.cBin(r)}cCon(r){const t=r.val;this.ts(r.id),t instanceof o.Timestamp?(this.writer.u8(1),this.ts(t)):(this.writer.u8(0),this.writeAny(t))}cVal(r){this.ts(r.id),this.writer.u8(32),this.cNode(r.node())}cObj(r){this.ts(r.id);const t=r.keys;this.writeTL(n.CRDT_MAJOR_OVERLAY.OBJ,t.size),t.forEach(this.cKey)}cVec(r){const t=r.elements,a=t.length;this.ts(r.id),this.writeTL(n.CRDT_MAJOR_OVERLAY.VEC,a);const p=this.doc.index;for(let f=0;f<a;f++){const w=t[f];w?this.cNode(p.get(w)):this.writer.u8(0)}}cStr(r){const t=this.ts;t(r.id),this.writeTL(n.CRDT_MAJOR_OVERLAY.STR,r.count);for(let a=r.first();a;a=r.next(a))t(a.id),a.del?this.writeUInteger(a.span):this.writeStr(a.data)}cBin(r){const t=this.ts,a=this.writer;t(r.id),this.writeTL(n.CRDT_MAJOR_OVERLAY.BIN,r.count);for(let p=r.first();p;p=r.next(p)){t(p.id);const f=p.span,w=p.del;a.b1vu56(~~w,f),!w&&a.buf(p.data,f)}}cArr(r){const t=this.ts,a=this.writer;t(r.id),this.writeTL(n.CRDT_MAJOR_OVERLAY.ARR,r.count);const p=this.doc.index;for(let f=r.first();f;f=r.next(f)){t(f.id);const w=f.span,y=f.del;if(a.b1vu56(~~y,w),y)continue;const b=f.data;for(let l=0;l<w;l++)this.cNode(p.get(b[l]))}}}return zn.Encoder=i,zn}var Hn={},Jn={},Ba;function ep(){if(Ba)return Jn;Ba=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.ClockDecoder=void 0;const e=ce();let c=class Gu{static fromArr(d){const o=new Gu(d[0],d[1]),u=d.length;for(let n=2;n<u;n+=2)o.pushTuple(d[n],d[n+1]);return o}constructor(d,o){this.table=[],this.clock=new e.ClockVector(d,o+1),this.table.push((0,e.ts)(d,o))}pushTuple(d,o){const u=(0,e.ts)(d,o);this.clock.observe(u,1),this.table.push(u)}decodeId(d,o){if(!d)return(0,e.ts)(0,o);const u=this.table[d-1];if(!u)throw new Error("INVALID_CLOCK_TABLE");return(0,e.ts)(u.sid,u.time-o)}};return Jn.ClockDecoder=c,Jn}var Fa;function tp(){if(Fa)return Hn;Fa=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.Decoder=void 0;const c=re.__importStar(ht()),m=ep(),d=Du(),o=ce(),u=ws(),n=Bu(),i=zu();let s=class extends n.CborDecoderBase{constructor(){super(new d.CrdtReader),this.clockDecoder=void 0,this.time=-1,this.cStrChunk=()=>{const t=this.ts(),a=this.val();return typeof a=="string"?new c.StrChunk(t,a.length,a):new c.StrChunk(t,~~a,"")},this.cBinChunk=()=>{const t=this.ts(),a=this.reader,[p,f]=a.b1vu56();return p?new c.BinChunk(t,f,void 0):new c.BinChunk(t,f,a.buf(f))},this.cArrChunk=()=>{const t=this.ts(),[a,p]=this.reader.b1vu56();if(a)return new c.ArrChunk(t,p,void 0);const f=[];for(let w=0;w<p;w++)f.push(this.cNode().id);return new c.ArrChunk(t,p,f)}}decode(t,a){this.clockDecoder=void 0,this.time=-1;const p=this.reader;if(p.reset(t),p.peak()&128){p.x++;const w=this.time=p.vu57();a||(a=u.Model.withServerClock(void 0,w))}else if(this.decodeClockTable(),!a){const w=this.clockDecoder.clock;a=u.Model.create(void 0,w)}return this.doc=a,a.root=new c.RootNode(this.doc,this.cRoot().id),this.clockDecoder=void 0,a}decodeClockTable(){const t=this.reader,a=t.u32(),p=t.x;t.x+=a;const f=t.vu57(),w=t.vu57(),y=t.vu57();this.clockDecoder=new m.ClockDecoder(w,y);for(let b=1;b<f;b++){const l=t.vu57(),h=t.vu57();this.clockDecoder.pushTuple(l,h)}t.x=p}ts(){if(this.time<0){const[p,f]=this.reader.id();return this.clockDecoder.decodeId(p,f)}else return new o.Timestamp(1,this.reader.vu57())}cRoot(){const t=this.reader;return t.uint8[t.x]?this.cNode():u.UNDEFINED}cNode(){const t=this.reader,a=this.ts(),p=t.u8(),f=p>>5,w=p&31;switch(f){case i.CRDT_MAJOR.CON:return this.cCon(a,w);case i.CRDT_MAJOR.VAL:return this.cVal(a);case i.CRDT_MAJOR.OBJ:return this.cObj(a,w!==31?w:t.vu57());case i.CRDT_MAJOR.VEC:return this.cVec(a,w!==31?w:t.vu57());case i.CRDT_MAJOR.STR:return this.cStr(a,w!==31?w:t.vu57());case i.CRDT_MAJOR.BIN:return this.cBin(a,w!==31?w:t.vu57());case i.CRDT_MAJOR.ARR:return this.cArr(a,w!==31?w:t.vu57())}throw new Error("UNKNOWN_NODE")}cCon(t,a){const p=this.doc,f=a?this.ts():this.val(),w=new c.ConNode(t,f);return p.index.set(t,w),w}cVal(t){const a=this.cNode(),p=this.doc,f=new c.ValNode(p,t,a.id);return p.index.set(t,f),f}cObj(t,a){const p=new c.ObjNode(this.doc,t);for(let f=0;f<a;f++)this.cObjChunk(p);return this.doc.index.set(t,p),p}cObjChunk(t){const a=this.key();t.keys.set(a,this.cNode().id)}cVec(t,a){const p=this.reader,f=new c.VecNode(this.doc,t),w=f.elements;for(let y=0;y<a;y++)p.peak()?w.push(this.cNode().id):(p.x++,w.push(void 0));return this.doc.index.set(t,f),f}cStr(t,a){const p=new c.StrNode(t);return a&&p.ingest(a,this.cStrChunk),this.doc.index.set(t,p),p}cBin(t,a){const p=new c.BinNode(t);return a&&p.ingest(a,this.cBinChunk),this.doc.index.set(t,p),p}cArr(t,a){const p=new c.ArrNode(this.doc,t);return a&&p.ingest(a,this.cArrChunk),this.doc.index.set(t,p),p}};return Hn.Decoder=s,Hn}var La;function np(){if(La)return _t;La=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.decoder=_t.encoder=void 0;const e=Zh(),c=tp();return _t.encoder=new e.Encoder,_t.decoder=new c.Decoder,_t}var Ci={},ge={},Kn={},Yn={},Ua;function ps(){if(Ua)return Yn;Ua=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.hasOwnProperty=void 0;const e=Object.prototype.hasOwnProperty;function c(m,d){return e.call(m,d)}return Yn.hasOwnProperty=c,Yn}var $a;function Wu(){if($a)return Kn;$a=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.get=void 0;const e=ps(),c=(m,d)=>{const o=d.length;let u;if(!o)return m;for(let n=0;n<o;n++)if(u=d[n],m instanceof Array){if(typeof u!="number"){if(u==="-")return;const i=~~u;if(""+i!==u)return;u=i}m=m[u]}else if(typeof m=="object"){if(!m||!(0,e.hasOwnProperty)(m,u))return;m=m[u]}else return;return m};return Kn.get=c,Kn}var Oi={},za;function ms(){return za||(za=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isRoot=e.toPath=void 0,e.unescapeComponent=u,e.escapeComponent=n,e.parseJsonPointer=i,e.formatJsonPointer=s,e.isChild=t,e.isPathEqual=a,e.parent=f,e.isValidIndex=w;const c=/~1/g,m=/~0/g,d=/~/g,o=/\//g;function u(b){return b.indexOf("~")===-1?b:b.replace(c,"/").replace(m,"~")}function n(b){return b.indexOf("/")===-1&&b.indexOf("~")===-1?b:b.replace(d,"~0").replace(o,"~1")}function i(b){return b?b.slice(1).split("/").map(u):[]}function s(b){return(0,e.isRoot)(b)?"":"/"+b.map(l=>n(String(l))).join("/")}const r=b=>typeof b=="string"?i(b):b;e.toPath=r;function t(b,l){if(b.length>=l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}function a(b,l){if(b.length!==l.length)return!1;for(let h=0;h<b.length;h++)if(b[h]!==l[h])return!1;return!0}const p=b=>!b.length;e.isRoot=p;function f(b){if(b.length<1)throw new Error("NO_PARENT");return b.slice(0,b.length-1)}function w(b){if(typeof b=="number")return!0;const l=Number.parseInt(b,10);return String(l)===b&&l>=0}const y=b=>{const l=b.length;let h=0,g;for(;h<l;){if(g=b.charCodeAt(h),g>=48&&g<=57){h++;continue}return!1}return!0};e.isInteger=y}(Oi)),Oi}var Xn={},Ri={},Ni={},Ga;function rp(){return Ga||(Ga=1,Object.defineProperty(Ni,"__esModule",{value:!0})),Ni}var Ei={},Wa;function ip(){return Wa||(Wa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validatePath=e.validateJsonPointer=void 0;const c=o=>{if(typeof o=="string"){if(o){if(o[0]!=="/")throw new Error("POINTER_INVALID");if(o.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,e.validatePath)(o)};e.validateJsonPointer=c;const{isArray:m}=Array,d=o=>{if(!m(o))throw new Error("Invalid path.");if(o.length>256)throw new Error("Path too long.");for(const u of o)switch(typeof u){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};e.validatePath=d}(Ei)),Ei}var Je={},Ha;function sp(){if(Ha)return Je;Ha=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.isObjectReference=Je.isArrayEnd=Je.isArrayReference=Je.find=void 0;const e=ps(),{isArray:c}=Array,m=(n,i)=>{const s=i.length;if(!s)return{val:n};let r,t;for(let p=0;p<s;p++)if(r=n,t=i[p],c(r)){const f=r.length;if(t==="-")t=f;else if(typeof t=="string"){const w=~~t;if(""+w!==t)throw new Error("INVALID_INDEX");if(t=w,t<0)throw new Error("INVALID_INDEX")}n=r[t]}else if(typeof r=="object"&&r)n=(0,e.hasOwnProperty)(r,t)?r[t]:void 0;else throw new Error("NOT_FOUND");return{val:n,obj:r,key:t}};Je.find=m;const d=n=>c(n.obj)&&typeof n.key=="number";Je.isArrayReference=d;const o=n=>n.obj.length===n.key;Je.isArrayEnd=o;const u=n=>typeof n.obj=="object"&&typeof n.key=="string";return Je.isObjectReference=u,Je}var Ti={},Qn={},Ja;function op(){if(Ja)return Qn;Ja=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.findByPointer=void 0;const e=ps(),c=ms(),{isArray:m}=Array,d=(o,u)=>{if(!o)return{val:u};let n,i,s=0,r=1;for(;s>-1;)if(s=o.indexOf("/",r),i=s>-1?o.substring(r,s):o.substring(r),r=s+1,n=u,m(n)){const t=n.length;if(i==="-")i=t;else{const a=~~i;if(""+a!==i)throw new Error("INVALID_INDEX");if(i=a,i<0)throw"INVALID_INDEX"}u=n[i]}else if(typeof n=="object"&&n)i=(0,c.unescapeComponent)(i),u=(0,e.hasOwnProperty)(n,i)?n[i]:void 0;else throw"NOT_FOUND";return{val:u,obj:n,key:i}};return Qn.findByPointer=d,Qn}var Ka;function ap(){return Ka||(Ka=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(op(),e)}(Ti)),Ti}var Ya;function lp(){return Ya||(Ya=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(rp(),e),c.__exportStar(ms(),e),c.__exportStar(ip(),e),c.__exportStar(Wu(),e),c.__exportStar(sp(),e),c.__exportStar(ap(),e)}(Ri)),Ri}var Xa;function up(){if(Xa)return Xn;Xa=1,Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.find=void 0;const e=lp(),c=ht(),m=(d,o)=>{const u=(0,e.toPath)(o);let n=d;const i=u.length;if(!i)return n;let s=0;for(;s<i&&n;){const r=u[s++];if(n=n.container(),!n)throw new Error("NOT_CONTAINER");if(n instanceof c.ObjNode){const t=n.get(String(r));if(!t)throw new Error("NOT_FOUND");n=t}else if(n instanceof c.ArrNode){const t=n.getNode(Number(r));if(!t)throw new Error("NOT_FOUND");n=t}else if(n instanceof c.VecNode){const t=n.get(Number(r));if(!t)throw new Error("NOT_FOUND");n=t}}return n};return Xn.find=m,Xn}var Zn={},Ke={},er={},Qa;function Hu(){if(Qa)return er;Qa=1,Object.defineProperty(er,"__esModule",{value:!0}),er.FanOut=void 0;class e{constructor(){this.listeners=new Set}emit(m){this.listeners.forEach(d=>d(m))}listen(m){const d=this.listeners;return d.add(m),()=>d.delete(m)}}return er.FanOut=e,er}var Za;function Ju(){if(Za)return Ke;Za=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.OnNewFanOut=Ke.MapFanOut=Ke.MicrotaskBufferFanOut=Ke.MergeFanOut=void 0;const e=Hu();class c extends e.FanOut{constructor(n){super(),this.fanouts=n,this.unsubs=[]}listen(n){this.listeners.size||(this.unsubs=this.fanouts.map(s=>s.listen(r=>this.emit(r))));const i=super.listen(n);return()=>{if(i(),!this.listeners.size){for(const s of this.unsubs)s();this.unsubs=[]}}}}Ke.MergeFanOut=c;class m extends e.FanOut{constructor(n){super(),this.source=n,this.buffer=[],this.unsub=void 0}listen(n){this.unsub||(this.unsub=this.source.listen(s=>{const r=this.buffer;r.length||queueMicrotask(()=>{this.emit(r),this.buffer=[]}),r.push(s)}));const i=super.listen(n);return()=>{i(),this.listeners.size||this.clear()}}clear(){var n;this.listeners.clear(),this.buffer=[],(n=this.unsub)==null||n.call(this),this.unsub=void 0}}Ke.MicrotaskBufferFanOut=m;class d extends e.FanOut{constructor(n,i){super(),this.source=n,this.mapper=i,this.unsub=void 0}listen(n){this.unsub||(this.unsub=this.source.listen(s=>this.emit(this.mapper(s))));const i=super.listen(n);return()=>{i(),this.listeners.size||this.clear()}}clear(){var n;this.listeners.clear(),(n=this.unsub)==null||n.call(this),this.unsub=void 0}}Ke.MapFanOut=d;class o extends e.FanOut{constructor(n,i=void 0){super(),this.source=n,this.last=i,this.unsub=void 0}listen(n){this.unsub||(this.unsub=this.source.listen(s=>{this.last!==s&&this.emit(this.last=s)}));const i=super.listen(n);return()=>{i(),this.listeners.size||this.clear()}}clear(){var n;this.listeners.clear(),this.last=void 0,(n=this.unsub)==null||n.call(this),this.unsub=void 0}}return Ke.OnNewFanOut=o,Ke}var el;function cp(){if(el)return Zn;el=1,Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.NodeEvents=void 0;const e=Ju();let c=class{constructor(d){this.api=d,this.subscribe=o=>this.onViewChanges.listen(()=>o()),this.getSnapshot=()=>this.api.view(),this.onChanges=new e.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new e.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}};return Zn.NodeEvents=c,Zn}var tr={},tl;function dp(){if(tl)return tr;tl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.ExtNode=void 0;const e=ce();let c=class{constructor(d){this.data=d,this.api=void 0,this.id=d.id}children(d){}child(){return this.data}container(){return this.data.container()}toString(d,o){return this.name()+(o?" "+(0,e.printTs)(o):"")+" "+this.data.toString(d)}};return tr.ExtNode=c,tr}var Ii={},xt={},ki={},ji={},nl;function fp(){return nl||(nl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=void 0;const c=Array.isArray,m=Object.prototype,d=(o,u)=>{if(o===u)return!0;let n=0,i=0;if(c(o)){if(!c(u)||(n=o.length,n!==u.length))return!1;for(i=n;i--!==0;)if(!(0,e.deepEqual)(o[i],u[i]))return!1;return!0}if(o&&u&&typeof o=="object"&&typeof u=="object"){e:{if(o.__proto__===m)break e;if(o instanceof Uint8Array){if(!(u instanceof Uint8Array))return!1;const r=o.length;if(r!==u.length)return!1;for(let t=0;t<r;t++)if(o[t]!==u[t])return!1;return!0}}const s=Object.keys(o);if(n=s.length,n!==Object.keys(u).length||c(u))return!1;for(i=n;i--!==0;){const r=s[i];if(!(0,e.deepEqual)(o[r],u[r]))return!1}return!0}return!1};e.deepEqual=d}(ji)),ji}var rl;function hp(){return rl||(rl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(fp(),e)}(ki)),ki}var nr={},il;function pp(){if(il)return nr;il=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.cmpUint8Array=void 0;const e=(c,m)=>{const d=c.length;if(d!==m.length)return!1;for(let o=0;o<d;o++)if(c[o]!==m[o])return!1;return!0};return nr.cmpUint8Array=e,nr}var Vi={},Ai={},sl;function mp(){return sl||(sl=1,Object.defineProperty(Ai,"__esModule",{value:!0})),Ai}var ol;function $r(){return ol||(ol=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(mp(),e),c.__exportStar(ce(),e),c.__exportStar(Jt(),e),c.__exportStar(Uu(),e),c.__exportStar(Lr(),e),c.__exportStar($u(),e)}(Vi)),Vi}var Pi={},al;function gs(){return al||(al=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.invert=e.dst=e.src=e.diffEdit=e.diff=e.sfx=e.pfx=void 0;const c=l=>{const h=l.charCodeAt(0);return h>=56320&&h<=57343},m=l=>{const h=l.charCodeAt(l.length-1);return h>=55296&&h<=56319},d=(l,h)=>{l.push([0,""]);let g=0,v=0,_=0,S="",C="",O=0;for(;g<l.length;){if(g<l.length-1&&!l[g][1]){l.splice(g,1);continue}const R=l[g];switch(R[0]){case 1:_++,g++,C+=R[1];break;case-1:v++,g++,S+=R[1];break;case 0:{let E=g-_-v-1;if(h){const A=l[E];if(E>=0){let U=A[1];if(m(U)){const $=U.slice(-1);if(A[1]=U=U.slice(0,-1),S=$+S,C=$+C,!U){l.splice(E,1),g--;let H=E-1;const Z=l[H];if(Z){const Y=Z[0];Y===1?(_++,H--,C=Z[1]+C):Y===-1&&(v++,H--,S=Z[1]+S)}E=H}}}const M=l[g],B=M[1];if(c(B)){const U=B.charAt(0);M[1]=B.slice(1),S+=U,C+=U}}if(g<l.length-1&&!l[g][1]){l.splice(g,1);break}const I=S.length>0,N=C.length>0;if(I||N){I&&N&&(O=(0,e.pfx)(C,S),O!==0&&(E>=0?l[E][1]+=C.slice(0,O):(l.splice(0,0,[0,C.slice(0,O)]),g++),C=C.slice(O),S=S.slice(O)),O=(0,e.sfx)(C,S),O!==0&&(l[g][1]=C.slice(C.length-O)+l[g][1],C=C.slice(0,C.length-O),S=S.slice(0,S.length-O)));const A=_+v,M=S.length,B=C.length;M===0&&B===0?(l.splice(g-A,A),g=g-A):M===0?(l.splice(g-A,A,[1,C]),g=g-A+1):B===0?(l.splice(g-A,A,[-1,S]),g=g-A+1):(l.splice(g-A,A,[-1,S],[1,C]),g=g-A+2)}const P=l[g-1];g!==0&&P[0]===0?(P[1]+=l[g][1],l.splice(g,1)):g++,_=0,v=0,S="",C="";break}}}l[l.length-1][1]===""&&l.pop();let x=!1;for(g=1;g<l.length-1;){const R=l[g-1],E=l[g+1];if(R[0]===0&&E[0]===0){const I=R[1],N=l[g],P=N[1],A=E[1];P.slice(P.length-I.length)===I?(l[g][1]=I+P.slice(0,P.length-I.length),E[1]=I+A,l.splice(g-1,1),x=!0):P.slice(0,A.length)===A&&(R[1]+=E[1],N[1]=P.slice(A.length)+A,l.splice(g+1,1),x=!0)}g++}x&&d(l,h)},o=(l,h,g,v)=>{const _=r(l.slice(0,g),h.slice(0,v),!1),S=r(l.slice(g),h.slice(v),!1);return _.concat(S)},u=(l,h)=>{const g=l.length,v=h.length,_=Math.ceil((g+v)/2),S=_,C=2*_,O=new Array(C),x=new Array(C);for(let M=0;M<C;M++)O[M]=-1,x[M]=-1;O[S+1]=0,x[S+1]=0;const R=g-v,E=R%2!==0;let I=0,N=0,P=0,A=0;for(let M=0;M<_;M++){for(let B=-M+I;B<=M-N;B+=2){const U=S+B;let $=0;const H=O[U-1],Z=O[U+1];B===-M||B!==M&&H<Z?$=Z:$=H+1;let Y=$-B;for(;$<g&&Y<v&&l.charAt($)===h.charAt(Y);)$++,Y++;if(O[U]=$,$>g)N+=2;else if(Y>v)I+=2;else if(E){const Q=S+R-B,ie=x[Q];if(Q>=0&&Q<C&&ie!==-1&&$>=g-ie)return o(l,h,$,Y)}}for(let B=-M+P;B<=M-A;B+=2){const U=S+B;let $=B===-M||B!==M&&x[U-1]<x[U+1]?x[U+1]:x[U-1]+1,H=$-B;for(;$<g&&H<v&&l.charAt(g-$-1)===h.charAt(v-H-1);)$++,H++;if(x[U]=$,$>g)A+=2;else if(H>v)P+=2;else if(!E){const Z=S+R-B,Y=O[Z];if(Z>=0&&Z<C&&Y!==-1){const Q=S+Y-Z;if($=g-$,Y>=$)return o(l,h,Y,Q)}}}}return[[-1,l],[1,h]]},n=(l,h)=>{if(!l)return[[1,h]];if(!h)return[[-1,l]];const g=l.length,v=h.length,_=g>v?l:h,S=g>v?h:l,C=S.length,O=_.indexOf(S);if(O>=0){const x=_.slice(0,O),R=_.slice(O+C);return g>v?[[-1,x],[0,S],[-1,R]]:[[1,x],[0,S],[1,R]]}return C===1?[[-1,l],[1,h]]:u(l,h)},i=(l,h)=>{if(!l||!h||l.charAt(0)!==h.charAt(0))return 0;let g=0,v=Math.min(l.length,h.length),_=v,S=0;for(;g<_;)l.slice(S,_)===h.slice(S,_)?(g=_,S=g):v=_,_=Math.floor((v-g)/2+g);const C=l.charCodeAt(_-1);return C>=55296&&C<=56319&&_--,_};e.pfx=i;const s=(l,h)=>{if(!l||!h||l.slice(-1)!==h.slice(-1))return 0;let g=0,v=Math.min(l.length,h.length),_=v,S=0;for(;g<_;)l.slice(l.length-_,l.length-S)===h.slice(h.length-_,h.length-S)?(g=_,S=g):v=_,_=Math.floor((v-g)/2+g);const C=l.charCodeAt(l.length-_);return C>=55296&&C<=56319&&_--,_};e.sfx=s;const r=(l,h,g)=>{if(l===h)return l?[[0,l]]:[];const v=(0,e.pfx)(l,h),_=l.slice(0,v);l=l.slice(v),h=h.slice(v);const S=(0,e.sfx)(l,h),C=l.slice(l.length-S);l=l.slice(0,l.length-S),h=h.slice(0,h.length-S);const O=n(l,h);return _&&O.unshift([0,_]),C&&O.push([0,C]),d(O,g),O},t=(l,h)=>r(l,h,!0);e.diff=t;const a=(l,h,g)=>{e:{if(g<0)break e;const v=l.length,_=h.length;if(v===_)break e;const S=h.slice(g),C=S.length;if(C>v||l.slice(v-C)!==S)break e;if(_>v){const R=v-C,E=l.slice(0,R),I=h.slice(0,R);if(E!==I)break e;const N=h.slice(R,g),P=[];return E&&P.push([0,E]),N&&P.push([1,N]),S&&P.push([0,S]),P}else{const R=_-C,E=h.slice(0,R),I=l.slice(0,R);if(I!==E)break e;const N=l.slice(R,v-C),P=[];return I&&P.push([0,I]),N&&P.push([-1,N]),S&&P.push([0,S]),P}}return(0,e.diff)(l,h)};e.diffEdit=a;const p=l=>{let h="";const g=l.length;for(let v=0;v<g;v++){const _=l[v];_[0]!==1&&(h+=_[1])}return h};e.src=p;const f=l=>{let h="";const g=l.length;for(let v=0;v<g;v++){const _=l[v];_[0]!==-1&&(h+=_[1])}return h};e.dst=f;const w=l=>{const h=l[0];return h===0?l:h===1?[-1,l[1]]:[1,l[1]]},y=l=>l.map(w);e.invert=y;const b=(l,h,g,v)=>{const _=l.length;let S=h;for(let C=_-1;C>=0;C--){const[O,x]=l[C];if(O===0)S-=x.length;else if(O===1)g(S,x);else{const R=x.length;S-=R,v(S,R,x)}}};e.apply=b}(Pi)),Pi}var Mi={},ll;function gp(){return ll||(ll=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dst=e.src=e.apply=e.diff=e.toBin=e.toStr=void 0;const m=re.__importStar(gs()),d=r=>{let t="";const a=r.length;for(let p=0;p<a;p++)t+=String.fromCharCode(r[p]);return t};e.toStr=d;const o=r=>{const t=r.length,a=new Uint8Array(t);for(let p=0;p<t;p++)a[p]=r.charCodeAt(p);return a};e.toBin=o;const u=(r,t)=>{const a=(0,e.toStr)(r),p=(0,e.toStr)(t);return m.diff(a,p)};e.diff=u;const n=(r,t,a,p)=>m.apply(r,t,(f,w)=>a(f,(0,e.toBin)(w)),p);e.apply=n;const i=r=>(0,e.toBin)(m.src(r));e.src=i;const s=r=>(0,e.toBin)(m.dst(r));e.dst=s}(Mi)),Mi}var qi={},ul;function bp(){return ul||(ul=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diff=e.agg=void 0;const m=re.__importStar(gs()),d=u=>{const n=[],i=u.length;let s=[];const r=(t,a)=>{if(!a.length)return;const p=s.length;if(p){const f=s[p-1];if(f[0]===t){f[1]+=a;return}}s.push([t,a])};e:for(let t=0;t<i;t++){const a=u[t],p=a[0],f=a[1],w=f.indexOf(`
`);if(w<0){r(p,f);continue e}else r(p,f.slice(0,w+1)),s.length&&n.push(s),s=[];let y=w;const b=f.length;t:for(;y<b;){const l=f.indexOf(`
`,y+1);if(l<0){r(p,f.slice(y+1));break t}n.push([[p,f.slice(y+1,l+1)]]),y=l}}s.length&&n.push(s);{const t=n.length;for(let a=0;a<t;a++){const p=n[a];let f=p.length;e:{if(f<2)break e;const w=p[0],y=p[1],b=y[0];if(w[0]===0&&(b===-1||b===1)){for(let l=2;l<f;l++)if(p[l][0]!==b)break e;for(let l=a+1;l<t;l++){const h=n[l],g=h.length,v=w[1];let _,S;if(h.length>1&&(_=h[0])[0]===b&&(S=h[1])[0]===0&&v===_[1])p.splice(0,1),y[1]=v+y[1],S[1]=v+S[1],h.splice(0,1);else for(let C=0;C<g;C++)if(h[C][0]!==b)break e}}}f=p.length;e:{if(f<2)break e;const w=p[p.length-1],y=w[1],b=p[p.length-2];if(w[0]===-1)for(let l=a+1;l<t;l++){const h=n[l],g=h.length;if(g<=1){if(h[0][0]!==-1)break e}else{const v=h[h.length-1];if(v[0]!==0)break e;for(let x=0;x<h.length-1;x++)if(h[x][0]!==-1)break e;let _=v[1];const S=_.endsWith(`
`);if(S||(_+=`
`),_.length>y.length||!y.endsWith(_))break e;const C=y.length-_.length;C<0?(w[0]=0,b[0]===0&&(b[1]+=y,p.splice(f-1,1))):C===0?(p.splice(f-1,1),b[0]===0?b[1]+=_:p.push([0,_])):(w[1]=y.slice(0,C),p.push([0,_]));const O=h[h.length-2];O[0]===-1?(O[1]+=S?_:_.slice(0,-1),h.splice(g-1,1)):v[0]=-1}}}}}return n};e.agg=d;const o=(u,n)=>{const i=u.join(`
`)+`
`,s=n.join(`
`)+`
`;if(i===s)return[];const r=m.diff(i,s),t=(0,e.agg)(r),a=t.length,p=[];let f=-1,w=-1;const y=u.length,b=n.length;for(let l=0;l<a;l++){const h=t[l];let g=h.length;if(!g)continue;const v=h[g-1],_=v[0],S=v[1];if(S===`
`)h.splice(g-1,1);else{const O=S.length;S[O-1]===`
`&&(O===1?h.splice(g-1,1):v[1]=S.slice(0,O-1))}let C=0;if(g=h.length,l+1===a)f+1<y?w+1<b?(C=g===1&&h[0][0]===0?0:2,f++,w++):(C=-1,f++):(C=1,w++);else{const x=h[0][0];g===1&&x===_&&x===0?(f++,w++):_===0?(C=2,f++,w++):_===1?(C=1,w++):_===-1&&(C=-1,f++)}p.push([C,f,w,h])}return p};e.diff=o}(qi)),qi}var Di={},rr={},cl;function bs(){if(cl)return rr;cl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.sort=void 0;const e=c=>{const m=c.length;for(let d=1;d<m;d++){const o=c[d];let u=d;for(;u!==0&&c[u-1]>o;)c[u]=c[u-1],u--;c[u]=o}return c};return rr.sort=e,rr}var Bi={},dl;function ys(){return dl||(dl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash=e.updateJson=e.updateBin=e.updateStr=e.updateNum=e.CONST=void 0;const c=bs();var m;(function(s){s[s.START_STATE=5381]="START_STATE",s[s.NULL=982452847]="NULL",s[s.TRUE=982453247]="TRUE",s[s.FALSE=982454243]="FALSE",s[s.ARRAY=982452259]="ARRAY",s[s.STRING=982453601]="STRING",s[s.OBJECT=982454533]="OBJECT",s[s.BINARY=982454837]="BINARY"})(m||(e.CONST=m={}));const d=(s,r)=>(s<<5)+s+r;e.updateNum=d;const o=(s,r)=>{const t=r.length;s=(0,e.updateNum)(s,m.STRING),s=(0,e.updateNum)(s,t);let a=t;for(;a;)s=(s<<5)+s+r.charCodeAt(--a);return s};e.updateStr=o;const u=(s,r)=>{const t=r.length;s=(0,e.updateNum)(s,m.BINARY),s=(0,e.updateNum)(s,t);let a=t;for(;a;)s=(s<<5)+s+r[--a];return s};e.updateBin=u;const n=(s,r)=>{switch(typeof r){case"number":return(0,e.updateNum)(s,r);case"string":return s=(0,e.updateNum)(s,m.STRING),(0,e.updateStr)(s,r);case"object":{if(r===null)return(0,e.updateNum)(s,m.NULL);if(Array.isArray(r)){const p=r.length;s=(0,e.updateNum)(s,m.ARRAY);for(let f=0;f<p;f++)s=(0,e.updateJson)(s,r[f]);return s}if(r instanceof Uint8Array)return(0,e.updateBin)(s,r);s=(0,e.updateNum)(s,m.OBJECT);const t=(0,c.sort)(Object.keys(r)),a=t.length;for(let p=0;p<a;p++){const f=t[p];s=(0,e.updateStr)(s,f),s=(0,e.updateJson)(s,r[f])}return s}case"boolean":return(0,e.updateNum)(s,r?m.TRUE:m.FALSE)}return s};e.updateJson=n;const i=s=>(0,e.updateJson)(m.START_STATE,s)>>>0;e.hash=i}(Bi)),Bi}var Fi={},fl;function Ku(){return fl||(fl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHash=void 0;const c=bs(),m=ys(),d=o=>{switch(typeof o){case"string":return(0,m.hash)(o).toString(36);case"number":case"bigint":return o.toString(36);case"boolean":return o?"T":"F";case"object":if(o===null)return"N";if(Array.isArray(o)){const u=o.length;let n="[";for(let i=0;i<u;i++)n+=(0,e.structHash)(o[i])+",";return n+"]"}else{if(o instanceof Uint8Array)return(0,m.hash)(o).toString(36);{const u=Object.keys(o);(0,c.sort)(u);let n="{";const i=u.length;for(let s=0;s<i;s++){const r=u[s];n+=(0,m.hash)(r).toString(36)+":"+(0,e.structHash)(o[r])+","}return n+"}"}}default:return"U"}};e.structHash=d}(Fi)),Fi}var hl;function yp(){return hl||(hl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.structHashCrdt=void 0;const c=bs(),m=tc(),d=ys(),o=Ku(),u=n=>{if(n instanceof m.ConNode)return(0,o.structHash)(n.val);if(n instanceof m.ValNode)return(0,e.structHashCrdt)(n.node());if(n instanceof m.StrNode)return(0,d.hash)(n.view()).toString(36);if(n instanceof m.ObjNode){let i="{";const s=Array.from(n.keys.keys());(0,c.sort)(s);const r=s.length;for(let t=0;t<r;t++){const a=s[t],p=n.get(a);i+=(0,d.hash)(a).toString(36)+":"+(0,e.structHashCrdt)(p)+","}return i+"}"}else if(n instanceof m.ArrNode||n instanceof m.VecNode){let i="[";return n.children(s=>{i+=(0,e.structHashCrdt)(s)+","}),i+"]"}else if(n instanceof m.BinNode)return(0,d.hash)(n.view()).toString(36);return"U"};e.structHashCrdt=u}(Di)),Di}var Li={},pl;function vp(){return pl||(pl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(ys(),e),c.__exportStar(Ku(),e)}(Li)),Li}var ml;function wp(){if(ml)return xt;ml=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.JsonCrdtDiff=xt.DiffError=void 0;const e=re,c=hp(),m=pp(),d=$r(),o=ht(),u=e.__importStar(gs()),n=e.__importStar(gp()),i=e.__importStar(bp()),s=yp(),r=vp();class t extends Error{constructor(f="DIFF"){super(f)}}xt.DiffError=t;let a=class{constructor(f){this.model=f,this.builder=new d.PatchBuilder(f.clock.clone())}diffStr(f,w){const y=f.view();if(y===w)return;const b=this.builder;u.apply(u.diff(y,w),y.length,(l,h)=>b.insStr(f.id,l?f.find(l-1):f.id,h),(l,h)=>b.del(f.id,f.findInterval(l,h)))}diffBin(f,w){const y=f.view();if((0,m.cmpUint8Array)(y,w))return;const b=this.builder;n.apply(n.diff(y,w),y.length,(l,h)=>b.insBin(f.id,l?f.find(l-1):f.id,h),(l,h)=>b.del(f.id,f.findInterval(l,h)))}diffArr(f,w){const y=[];f.children(O=>{y.push((0,s.structHashCrdt)(O))});const b=[],l=w.length;for(let O=0;O<l;O++)b.push((0,r.structHash)(w[O]));const h=i.diff(y,b);if(!h.length)return;const g=[],v=[],_=h.length;for(let O=_-1;O>=0;O--){const[x,R,E]=h[O];switch(x){case 0:break;case 1:{const I=w[E],N=R>=0?f.find(R):f.id;if(!N)throw new t;g.push([N,[I]]);break}case-1:{const I=f.findInterval(R,1);if(!I||!I.length)throw new t;v.push(...I);break}case 2:{const I=w[E];try{this.diffAny(f.getNode(R),I)}catch(N){if(N instanceof t){const P=f.findInterval(R,1);v.push(...P);const A=R?f.find(R-1):f.id;if(!A)throw new t;g.push([A,[I]])}else throw N}}}}const S=this.builder,C=g.length;for(let O=0;O<C;O++){const[x,R]=g[O];S.insArr(f.id,x,R.map(E=>S.json(E)))}v.length&&S.del(f.id,v)}diffObj(f,w){const y=this.builder,b=[],l=new Set;f.forEach(v=>{l.add(v),w[v]===void 0&&b.push([v,y.con(void 0)])});const h=Object.keys(w),g=h.length;for(let v=0;v<g;v++){const _=h[v],S=w[_];if(l.has(_)){const C=f.get(_);if(C)try{this.diffAny(C,S);continue}catch(O){if(!(O instanceof t))throw O}}b.push([_,f.get(_)instanceof o.ConNode?y.con(S):y.constOrJson(S)])}b.length&&y.insObj(f.id,b)}diffVec(f,w){const y=this.builder,b=[],l=f.elements,h=l.length,g=w.length,v=f.doc.index,_=Math.min(h,g);for(let S=g;S<h;S++){const C=l[S];if(C){const O=v.get(C);if(!O||O instanceof o.ConNode&&O.val===void 0)return;b.push([S,y.con(void 0)])}}for(let S=0;S<_;S++){const C=w[S],O=f.get(S);if(O)try{this.diffAny(O,C);continue}catch(x){if(!(x instanceof t))throw x}b.push([S,y.constOrJson(C)])}for(let S=h;S<g;S++)b.push([S,y.constOrJson(w[S])]);b.length&&y.insVec(f.id,b)}diffVal(f,w){try{this.diffAny(f.node(),w)}catch(y){if(y instanceof t){const b=this.builder;b.setVal(f.id,b.constOrJson(w))}else throw y}}diffAny(f,w){if(f instanceof o.ConNode){if(f.val!==w&&!(0,c.deepEqual)(f.val,w))throw new t}else if(f instanceof o.StrNode){if(typeof w!="string")throw new t;this.diffStr(f,w)}else if(f instanceof o.ObjNode){if(!w||typeof w!="object"||Array.isArray(w))throw new t;this.diffObj(f,w)}else if(f instanceof o.ValNode)this.diffVal(f,w);else if(f instanceof o.ArrNode){if(!Array.isArray(w))throw new t;this.diffArr(f,w)}else if(f instanceof o.VecNode){if(!Array.isArray(w))throw new t;this.diffVec(f,w)}else if(f instanceof o.BinNode){if(!(w instanceof Uint8Array))throw new t;this.diffBin(f,w)}else throw new t}diff(f,w){return this.diffAny(f,w),this.builder.flush()}};return xt.JsonCrdtDiff=a,xt}var gl;function _p(){return gl||(gl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.merge=e.diff=void 0;const c=wp(),m=(o,u)=>{const i=new c.JsonCrdtDiff(o.api.model).diff(o.node,u);return i.ops.length?i:void 0};e.diff=m;const d=(o,u)=>{const n=(0,e.diff)(o,u);return n&&o.api.model.applyPatch(n),n};e.merge=d}(Ii)),Ii}var Ui={},bl;function Sp(){return bl||(bl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.proxy$=e.proxy=void 0;const c=(d,o=[])=>new Proxy(()=>{},{get:(u,n,i)=>(o.push(String(n)),(0,e.proxy)(d,o)),apply:(u,n,i)=>d(o,...i)});e.proxy=c;const m=(d,o,u=[])=>new Proxy({},{get:(n,i,s)=>i===o?d(u):(u.push(String(i)),(0,e.proxy$)(d,o,u))});e.proxy$=m}(Ui)),Ui}var yl;function xp(){if(yl)return ge;yl=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.ModelApi=ge.ArrApi=ge.BinApi=ge.StrApi=ge.ObjApi=ge.VecApi=ge.ValApi=ge.ConApi=ge.NodeApi=void 0;const e=re,c=Ye(),m=Wu(),d=ms(),o=up(),u=ce(),n=ht(),i=cp(),s=Hu(),r=Lr(),t=Ju(),a=dp(),p=e.__importStar(_p()),f=Sp(),w=O=>{if(!O)return[void 0,""];if(typeof O=="number")return[void 0,O];switch(typeof O=="string"&&(O=(0,d.toPath)(O)),O.length){case 0:return[void 0,""];case 1:return[void 0,O[0]];default:{const x=O[O.length-1];return[O.slice(0,-1),x]}}};class y{constructor(x,R){this.node=x,this.api=R,this.ev=void 0}get events(){return this.ev||(this.ev=new i.NodeEvents(this))}find(x){let R=this.node;if(x===void 0){if(typeof R.child=="function"){const E=R.child();if(!E){if(R instanceof n.RootNode)return R;throw new Error("NO_CHILD")}return E}throw new Error("CANNOT_IN")}for(typeof x=="string"&&x&&x[0]!=="/"&&(x="/"+x),typeof x=="number"&&(x=[x]);R instanceof n.ValNode;)R=R.child();return(0,o.find)(R,x)}in(x){const R=this.find(x);return this.api.wrap(R)}asVal(){if(this.node instanceof n.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof n.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof n.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof n.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof n.VecNode)return this.api.wrap(this.node);throw new Error("NOT_VEC")}asObj(){if(this.node instanceof n.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof n.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CON")}asExt(x){let R;const E=this.node;if(E instanceof a.ExtNode&&(R=E),E instanceof n.VecNode&&(R=E.ext()),!R)throw new Error("NOT_EXT");const I=this.api.wrap(R);if(!x||I instanceof x.Api)return I;throw new Error("NOT_EXT")}val(x){return this.in(x).asVal()}str(x){return this.in(x).asStr()}bin(x){return this.in(x).asBin()}arr(x){return this.in(x).asArr()}vec(x){return this.in(x).asVec()}obj(x){return this.in(x).asObj()}con(x){return this.in(x).asCon()}view(){return this.node.view()}select(x,R){try{let E=x!==void 0?this.find(x):this.node;if(R)for(;E instanceof n.ValNode;)E=E.child();return this.api.wrap(E)}catch{return}}read(x){const R=this.view();if(Array.isArray(x))return(0,m.get)(R,x);if(!x)return R;let E=x+"";return x&&E[0]!=="/"&&(E="/"+E),(0,m.get)(R,(0,d.toPath)(E))}add(x,R){const[E,I]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g)N.set({[I]:R});else if(N instanceof S||N instanceof v||N instanceof _){const P=N.length();let A=0;if(typeof I=="number")A=I;else if(I==="-")A=P;else if(A=~~I,A+""!==I)break e;if(A!==A)break e;if(A<0&&(A=0),A>P&&(A=P),N instanceof S)N.ins(A,Array.isArray(R)?R:[R]);else if(N instanceof v)N.ins(A,R+"");else if(N instanceof _){if(!(R instanceof Uint8Array))break e;N.ins(A,R)}}else if(N instanceof h)N.set([[~~I,R]]);else break e;return!0}catch{}return!1}replace(x,R){const[E,I]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g){const P=I+"";if(!N.has(P))break e;N.set({[I]:R})}else if(N instanceof S){const P=N.length();let A=0;if(typeof I=="number")A=I;else if(A=~~I,A+""!==I)break e;if(A!==A||A<0||A>P)break e;A===P?N.ins(A,[R]):N.upd(A,R)}else if(N instanceof h)N.set([[~~I,R]]);else break e;return!0}catch{}return!1}remove(x,R=1){const[E,I]=w(x);e:try{const N=this.select(E,!0);if(N instanceof g){const P=I+"";if(!N.has(P))break e;N.del([P])}else if(N instanceof S||N instanceof v||N instanceof _){const P=N.length();let A=0;if(typeof I=="number")A=I;else if(I==="-")A=R;else if(A=~~I,A+""!==I)break e;if(A!==A||A<0||A>P)break e;N.del(A,Math.min(R,P-A))}else if(N instanceof h)N.set([[~~I,void 0]]);else break e;return!0}catch{}return!1}diff(x){return p.diff(this,x)}merge(x){return p.merge(this,x)}op(x){var N;if(!Array.isArray(x))return!1;const[R,E,I]=x;switch(R){case"add":return this.add(E,I);case"replace":return this.replace(E,I);case"merge":return!!((N=this.select(E))!=null&&N.merge(I));case"remove":return this.remove(E,I)}}get s(){return{$:this}}get $(){return(0,f.proxy$)(x=>{try{return this.api.wrap(this.find(x))}catch{return}},"$")}toString(x=""){return"api("+(this.constructor===y?"*":this.node.name())+")"+(0,c.printTree)(x,[E=>this.node.toString(E)])}}ge.NodeApi=y;class b extends y{get s(){return{$:this}}}ge.ConApi=b;class l extends y{get(){return this.in()}set(x){const{api:R,node:E}=this,N=R.builder.constOrJson(x);R.builder.setVal(E.id,N),R.apply()}get s(){const x=this;return{$:this,get _(){const E=x.node.node();return x.api.wrap(E).s}}}}ge.ValApi=l;class h extends y{get(x){return this.in(x)}set(x){const{api:R,node:E}=this,{builder:I}=R;I.insVec(E.id,x.map(([N,P])=>[N,I.constOrJson(P)])),R.apply()}push(...x){const R=this.length();this.set(x.map((E,I)=>[R+I,E]))}length(){return this.node.elements.length}get s(){return new Proxy({},{get:(R,E,I)=>{if(E==="$")return this;if(E==="toExt")return()=>this.asExt();const N=Number(E);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const P=this.node.get(N);if(!P)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(P).s}})}}ge.VecApi=h;class g extends y{get(x){return this.in(x)}set(x){const{api:R,node:E}=this,{builder:I}=R;I.insObj(E.id,Object.entries(x).map(([N,P])=>[N,I.constOrJson(P)])),R.apply()}del(x){const{api:R,node:E}=this,{builder:I}=R;R.builder.insObj(E.id,x.map(N=>[N,I.con(void 0)])),R.apply()}has(x){return this.node.keys.has(x)}get s(){return new Proxy({},{get:(R,E,I)=>{if(E==="$")return this;const N=String(E),P=this.node.get(N);if(!P)throw new Error("NO_SUCH_KEY");return this.api.wrap(P).s}})}}ge.ObjApi=g;class v extends y{ins(x,R){const{api:E,node:I}=this;E.onBeforeLocalChange.emit(E.next);const N=E.builder;N.pad();const P=E.builder.nextTime(),A=new u.Timestamp(N.clock.sid,P),M=I.insAt(x,A,R);if(!M)throw new Error("OUT_OF_BOUNDS");N.insStr(I.id,M,R),E.advance()}del(x,R){const{api:E,node:I}=this;E.onBeforeLocalChange.emit(E.next);const N=E.builder;N.pad();const P=I.findInterval(x,R);if(!P)throw new Error("OUT_OF_BOUNDS");I.delete(P),N.del(I.id,P),E.advance()}findId(x){const R=this.node,I=R.length()-1;return x>I&&(x=I),x<0?R.id:R.find(x)||R.id}findPos(x){const R=this.node,E=R.id;if(E.sid===x.sid&&E.time===x.time)return-1;const I=R.findById(x);return I?R.pos(I)+(I.del?0:x.time-I.id.time):-1}length(){return this.node.length()}get s(){return{$:this}}}ge.StrApi=v;class _ extends y{ins(x,R){const{api:E,node:I}=this,N=x?I.find(x-1):I.id;if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.insBin(I.id,N,R),E.apply()}del(x,R){const{api:E,node:I}=this,N=I.findInterval(x,R);if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.del(I.id,N),E.apply()}length(){return this.node.length()}get s(){return{$:this}}}ge.BinApi=_;class S extends y{get(x){return this.in(x)}ins(x,R){const{api:E,node:I}=this,{builder:N}=E,P=x?I.find(x-1):I.id;if(!P)throw new Error("OUT_OF_BOUNDS");const A=[];for(let M=0;M<R.length;M++)A.push(N.json(R[M]));N.insArr(I.id,P,A),E.apply()}push(...x){const R=this.length();this.ins(R,x)}upd(x,R){const{api:E,node:I}=this,N=I.getId(x);if(!N)throw new Error("OUT_OF_BOUNDS");const{builder:P}=E;P.updArr(I.id,N,P.constOrJson(R)),E.apply()}del(x,R){const{api:E,node:I}=this,N=I.findInterval(x,R);if(!N)throw new Error("OUT_OF_BOUNDS");E.builder.del(I.id,N),E.apply()}length(){return this.node.length()}get s(){return new Proxy({},{get:(R,E,I)=>{if(E==="$")return this;const N=Number(E);if(Number.isNaN(N))throw new Error("INVALID_INDEX");const P=this.node.getNode(N);if(!P)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(P).s}})}}ge.ArrApi=S;class C extends l{constructor(x){super(x.root,void 0),this.model=x,this.next=0,this.onBeforeReset=new s.FanOut,this.onReset=new s.FanOut,this.onBeforePatch=new s.FanOut,this.onPatch=new s.FanOut,this.onBeforeLocalChange=new s.FanOut,this.onLocalChange=new s.FanOut,this.onLocalChanges=new t.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new s.FanOut,this.onTransaction=new s.FanOut,this.onChange=new t.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new t.MicrotaskBufferFanOut(this.onChange),this.onFlush=new s.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=R=>this.onChanges.listen(()=>R()),this.getSnapshot=()=>this.view(),this.api=this,this.builder=new r.PatchBuilder(x.clock),x.onbeforereset=()=>this.onBeforeReset.emit(),x.onreset=()=>this.onReset.emit(),x.onbeforepatch=R=>this.onBeforePatch.emit(R),x.onpatch=R=>this.onPatch.emit(R)}wrap(x){if(x instanceof n.ValNode)return x.api||(x.api=new l(x,this));if(x instanceof n.StrNode)return x.api||(x.api=new v(x,this));if(x instanceof n.BinNode)return x.api||(x.api=new _(x,this));if(x instanceof n.ArrNode)return x.api||(x.api=new S(x,this));if(x instanceof n.ObjNode)return x.api||(x.api=new g(x,this));if(x instanceof n.ConNode)return x.api||(x.api=new b(x,this));if(x instanceof n.VecNode)return x.api||(x.api=new h(x,this));if(x instanceof a.ExtNode){if(x.api)return x.api;const R=this.model.ext.get(x.extId);return x.api=new R.Api(x,this)}else throw new Error("UNKNOWN_NODE")}root(x){return this.set(x)}set(x){return super.set(x),this}apply(){const x=this.builder.patch.ops,R=x.length,E=this.model,I=this.next;this.onBeforeLocalChange.emit(I);for(let N=this.next;N<R;N++)E.applyOperation(x[N]);this.next=R,E.tick++,this.onLocalChange.emit(I)}advance(){const x=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(x)}transaction(x){if(this.inTx)x();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),x(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const x=this.builder.flush();return this.next=0,x.ops.length&&this.onFlush.emit(x),x}autoFlush(x=!1){const R=()=>this.builder.patch.ops.length&&this.flush(),E=this.onLocalChanges.listen(R),I=this.onBeforeTransaction.listen(R),N=this.onTransaction.listen(R);return x&&R(),this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,E(),I(),N()}}}return ge.ModelApi=C,ge}var vl;function Yu(){return vl||(vl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(xp(),e)}(Ci)),Ci}var ir={},wl;function Cp(){if(wl)return ir;wl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.randomSessionId=void 0;const e=65535,c=9007199254740991-e,m=()=>Math.floor(c*Math.random()+e);return ir.randomSessionId=m,ir}var sr={},_l;function Op(){if(_l)return sr;_l=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.Extensions=void 0;const e=Ye();let c=class Xu{constructor(){this.ext={}}register(d){this.ext[d.id]=d}get(d){return this.ext[d]}size(){return Object.keys(this.ext).length}clone(){const d=new Xu;for(const o of Object.values(this.ext))d.register(o);return d}toString(d=""){const o=Object.keys(this.ext).map(u=>+u).sort();return"extensions"+(0,e.printTree)(d,o.map(u=>n=>`${u}: ${this.ext[u].name}`))}};return sr.Extensions=c,sr}var Ct={},$i={},zi={},or={},Sl;function vs(){if(Sl)return or;Sl=1,Object.defineProperty(or,"__esModule",{value:!0}),or.printBinary=void 0;const e=(c="",m)=>{const d=m[0],o=m[1];let u="";return d&&(u+=`
`+c+"← "+d(c+"  ")),o&&(u+=`
`+c+"→ "+o(c+"  ")),u};return or.printBinary=e,or}var xl;function Rp(){return xl||(xl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(vs(),e)}(zi)),zi}var Cl;function Np(){return Cl||(Cl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.print=e.remove=e.insert=e.insertLeft=e.insertRight=void 0;const c=Rp(),m=JSON.stringify,d=(y,b,l)=>{const h=b.p;if(!h)return y;const g=b===h.l;let v=h.bf|0;switch(g?h.bf=++v:h.bf=--v,v){case 0:return y;case 1:case-1:return d(y,h,b);default:{const _=l===b.l;return g?_?(o(h,b),b.p?y:b):(n(h,b,l),l.p?y:l):_?(i(h,b,l),l.p?y:l):(u(h,b),b.p?y:b)}}},o=(y,b)=>{const l=y.p,h=b.r;b.p=l,b.r=y,y.p=b,y.l=h,h&&(h.p=y),l&&(l.l===y?l.l=b:l.r=b);let g=y.bf,v=b.bf;g+=-1-(v>0?v:0),v+=-1+(g<0?g:0),y.bf=g,b.bf=v},u=(y,b)=>{const l=y.p,h=b.l;b.p=l,b.l=y,y.p=b,y.r=h,h&&(h.p=y),l&&(l.l===y?l.l=b:l.r=b);let g=y.bf,v=b.bf;g+=1-(v<0?v:0),v+=1+(g>0?g:0),y.bf=g,b.bf=v},n=(y,b,l)=>{u(b,l),o(y,l)},i=(y,b,l)=>{o(b,l),u(y,l)},s=(y,b,l)=>(l.r=b,b.p=l,l.bf--,l.l?y:d(y,l,b));e.insertRight=s;const r=(y,b,l)=>(l.l=b,b.p=l,l.bf++,l.r?y:d(y,l,b));e.insertLeft=r;const t=(y,b,l)=>{if(!y)return b;const h=b.k;let g=y,v,_=0;for(;v=(_=l(h,g.k))<0?g.l:g.r;)g=v;return _<0?(0,e.insertLeft)(y,b,g):(0,e.insertRight)(y,b,g)};e.insert=t;const a=(y,b)=>{if(!y)return b;const l=b.p,h=b.l,g=b.r;if(b.p=b.l=b.r=void 0,h&&g)if(h.r){let S=h,C=S;for(;C=S.r;)S=C;const O=S.l,x=S.p,R=O;return l&&(l.l===b?l.l=S:l.r=S),S.p=l,S.r=g,S.bf=b.bf,h!==S&&(S.l=h,h.p=S),g.p=S,x&&(x.l===S?x.l=R:x.r=R),R&&(R.p=x),f(l?y:S,x,1)}else{l&&(l.l===b?l.l=h:l.r=h),h.p=l,h.r=g,g.p=h;const S=b.bf;if(l)return h.bf=S,p(y,h,1);const C=S-1;if(h.bf=C,C>=-1)return h;const O=g.l;return g.bf>0?(i(h,g,O),O):(u(h,g),g)}const v=h||g;return v&&(v.p=l),l?l.l===b?(l.l=v,p(y,l,1)):(l.r=v,f(y,l,1)):v};e.remove=a;const p=(y,b,l)=>{let h=b.bf|0;h-=l,b.bf=h;let g=l;if(h===-1)return y;if(h<-1){const _=b.r;if(_.bf<=0)_.l&&_.bf===0&&(g=0),u(b,_),b=_;else{const S=_.l;i(b,_,S),b=S}}const v=b.p;return v?v.l===b?p(y,v,g):f(y,v,g):b},f=(y,b,l)=>{let h=b.bf|0;h+=l,b.bf=h;let g=l;if(h===1)return y;if(h>1){const _=b.l;if(_.bf>=0)_.r&&_.bf===0&&(g=0),o(b,_),b=_;else{const S=_.r;n(b,_,S),b=S}}const v=b.p;return v?v.l===b?p(y,v,g):f(y,v,g):b},w=(y,b="")=>{if(!y)return"∅";const{bf:l,l:h,r:g,k:v,v:_}=y,S=_&&typeof _=="object"&&_.constructor===Object?m(_):_&&typeof _=="object"?_.toString(b):m(_),C=v!==void 0?` { ${m(v)} = ${S} }`:"",O=l?` [${l}]`:"";return y.constructor.name+`${O}`+C+(0,c.printBinary)(b,[h?x=>(0,e.print)(h,x):null,g?x=>(0,e.print)(g,x):null])};e.print=w}($i)),$i}var ar={},Gi={},lr={},Ol;function Qu(){if(Ol)return lr;Ol=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.first=void 0;const e=c=>{let m=c;for(;m;)if(m.l)m=m.l;else return m;return m};return lr.first=e,lr}var ur={},Rl;function Ep(){if(Rl)return ur;Rl=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.next=void 0;const e=Qu(),c=m=>{const d=m.r;if(d)return(0,e.first)(d);let o=m.p;for(;o&&o.r===m;)m=o,o=o.p;return o};return ur.next=c,ur}var Nl;function Zu(){return Nl||(Nl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.insert=e.insertLeft=e.insertRight=e.findOrNextLower=e.find=e.size=e.prev=e.last=e.next=e.first=void 0;const c=Qu();Object.defineProperty(e,"first",{enumerable:!0,get:function(){return c.first}});const m=Ep();Object.defineProperty(e,"next",{enumerable:!0,get:function(){return m.next}});const d=f=>{let w=f;for(;w;)if(w.r)w=w.r;else return w;return w};e.last=d;const o=f=>{if(f.l){for(f=f.l;f.r;)f=f.r;return f}let w=f.p;for(;w&&w.l===f;)f=w,w=w.p;return w};e.prev=o;const u=f=>{const w=f.l,y=f.r;return 1+(w?u(w):0)+(y?u(y):0)},n=f=>f?u(f):0;e.size=n;const i=(f,w,y)=>{let b=f;for(;b;){const l=y(w,b.k);if(l===0)return b;b=l<0?b.l:b.r}return b};e.find=i;const s=(f,w,y)=>{let b=f,l;for(;b;){const h=y(b.k,w);if(h===0)return b;if(h>0)b=b.l;else{const g=b.r;if(l=b,!g)return l;b=g}}return l};e.findOrNextLower=s;const r=(f,w)=>{const y=f.r=w.r;w.r=f,f.p=w,y&&(y.p=f)};e.insertRight=r;const t=(f,w)=>{const y=f.l=w.l;w.l=f,f.p=w,y&&(y.p=f)};e.insertLeft=t;const a=(f,w,y)=>{if(!f)return w;const b=w.k;let l=f;for(;l;){const h=y(b,l.k),g=h<0?l.l:l.r;if(g)l=g;else{h<0?(0,e.insertLeft)(w,l):(0,e.insertRight)(w,l);break}}return f};e.insert=a;const p=(f,w)=>{const y=w.p,b=w.l,l=w.r;if(w.p=w.l=w.r=void 0,!b&&!l){if(y)y.l===w?y.l=void 0:y.r=void 0;else return;return f}else if(b&&l){let g=b;for(;g.r;)g=g.r;return g.r=l,l.p=g,y?(y.l===w?y.l=b:y.r=b,b.p=y,f):(b.p=void 0,b)}const h=b||l;if(h.p=y,y)y.l===w?y.l=h:y.r=h;else return h;return f};e.remove=p}(Gi)),Gi}var Wi={},El;function Tp(){return El||(El=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),re.__exportStar(Ye(),e)}(Wi)),Wi}var Tl;function Ip(){if(Tl)return ar;Tl=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.createMap=void 0;const e=Zu(),c=Tp(),m=(o,u)=>o===u?0:o<u?-1:1,d=(o,u,n,i,s,r)=>{class t{constructor(p){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=e.next,this.comparator=p||m}set(p,f){const w=this.root;if(w===void 0){this._size=1;const v=new o(p,f);return this.root=this.min=this.max=u(void 0,v,this.comparator)}const y=this.comparator;let b;const l=this.max;if(b=y(p,l.k),b===0)return l.v=f,l;if(b>0){const v=this.max=new o(p,f);return this.root=i(w,v,l),this._size++,v}const h=this.min;if(b=y(p,h.k),b===0)return h.v=f,h;if(b<0){const v=this.min=new o(p,f);return this.root=n(w,v,h),this._size++,v}let g=w;do{if(b=y(p,g.k),b===0)return g.v=f,g;if(b>0){const v=g.r;if(v===void 0){const _=new o(p,f);return this.root=i(w,_,g),this._size++,_}g=v}else if(b<0){const v=g.l;if(v===void 0){const _=new o(p,f);return this.root=n(w,_,g),this._size++,_}g=v}}while(!0)}find(p){const f=this.comparator;let w=this.root;for(;w;){const y=+f(p,w.k);if(y===0)return w;w=y<0?w.l:w.r}}get(p){var f;return(f=this.find(p))==null?void 0:f.v}del(p){const f=this.find(p);return f?(f===this.max&&(this.max=(0,e.prev)(f)),f===this.min&&(this.min=(0,e.next)(f)),this.root=s(this.root,f),this._size--,!0):!1}clear(){this._size=0,this.root=this.min=this.max=void 0}has(p){return!!this.find(p)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(p){return(0,e.findOrNextLower)(this.root,p,this.comparator)||void 0}forEach(p){let f=this.first();if(f)do p(f);while(f=(0,e.next)(f))}first(){return this.min}last(){return this.max}iterator0(){let p=this.first();return()=>{if(!p)return;const f=p;return p=(0,e.next)(p),f}}iterator(){const p=this.iterator0();return{next:()=>{const f=p();return{value:f,done:!f}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(p){return this.constructor.name+(0,c.printTree)(p,[f=>r(this.root,f)])}}return t};return ar.createMap=d,ar}var Il;function kp(){if(Il)return Ct;Il=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.AvlMap=Ct.AvlNode=void 0;const e=Np(),c=Ip();class m{constructor(o,u){this.k=o,this.v=u,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}return Ct.AvlNode=m,Ct.AvlMap=(0,c.createMap)(m,e.insert,e.insertLeft,e.insertRight,e.remove,e.print),Ct}var kl;function ws(){if(kl)return wt;kl=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.Model=wt.UNDEFINED=void 0;const e=re,c=e.__importStar(Jt()),m=e.__importStar(ce()),d=np(),o=Yu(),u=Fr(),n=Cp(),i=ht(),s=Ur(),r=Ye(),t=Op(),a=kp(),p=$r();wt.UNDEFINED=new s.ConNode(u.ORIGIN,void 0);let f=class ns{rndSid(){const y=this.clock,b=y.sid,l=y.peers;for(;;){const h=(0,n.randomSessionId)();if(b!==h&&!l.has(h))return h}}static fromPatches(y){if(!y.length)throw new Error("NO_PATCHES");const h=y[0].getId().sid;if(!h)throw new Error("NO_SID");const g=ns.create(void 0,h);return g.applyBatch(y),g}constructor(y){this.root=new i.RootNode(this,u.ORIGIN),this.index=new a.AvlMap(m.compare),this.ext=new t.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=y,y.time||(y.time=1)}get api(){return this._api||(this._api=new o.ModelApi(this)),this._api}get s(){return this.api.s._}get $(){return this.api.$}applyBatch(y){const b=y.length;for(let l=0;l<b;l++)this.applyPatch(y[l])}applyLocalPatch(y){const b=y.getId();if(b){const l=this.clock;if(l.sid===b.sid){const h=l.time;h>b.time&&(y=y.rebase(h))}}this.applyPatch(y)}applyPatch(y){var h,g;(h=this.onbeforepatch)==null||h.call(this,y);const b=y.ops,{length:l}=b;for(let v=0;v<l;v++)this.applyOperation(b[v]);this.tick++,(g=this.onpatch)==null||g.call(this,y)}applyOperation(y){this.clock.observe(y.id,y.span());const b=this.index;if(y instanceof c.InsStrOp){const l=b.get(y.obj);l instanceof i.StrNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof c.NewObjOp){const l=y.id;b.get(l)||b.set(l,new i.ObjNode(this,l))}else if(y instanceof c.NewArrOp){const l=y.id;b.get(l)||b.set(l,new i.ArrNode(this,l))}else if(y instanceof c.NewStrOp){const l=y.id;b.get(l)||b.set(l,new i.StrNode(l))}else if(y instanceof c.NewValOp){const l=y.id;b.get(l)||b.set(l,new i.ValNode(this,l,u.ORIGIN))}else if(y instanceof c.NewConOp){const l=y.id;b.get(l)||b.set(l,new s.ConNode(l,y.val))}else if(y instanceof c.InsObjOp){const l=b.get(y.obj),h=y.data,g=h.length;if(l instanceof i.ObjNode)for(let v=0;v<g;v++){const _=h[v],S=b.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(_[0]+"",S.id);C&&this._gcTree(C)}}else if(y instanceof c.InsVecOp){const l=b.get(y.obj),h=y.data,g=h.length;if(l instanceof i.VecNode)for(let v=0;v<g;v++){const _=h[v],S=b.get(_[1]);if(!S||l.id.time>=_[1].time)continue;const C=l.put(Number(_[0]),S.id);C&&this._gcTree(C)}}else if(y instanceof c.InsValOp){const l=y.obj,h=l.sid===0&&l.time===0?this.root:b.get(l);if(h instanceof i.ValNode&&b.get(y.val)){const v=h.set(y.val);v&&this._gcTree(v)}}else if(y instanceof c.InsArrOp){const l=b.get(y.obj);if(l instanceof i.ArrNode){const h=[],g=y.data,v=g.length;for(let _=0;_<v;_++){const S=g[_];b.get(S)&&(l.id.time>=S.time||h.push(S))}h.length&&l.ins(y.ref,y.id,h)}}else if(y instanceof c.UpdArrOp){const l=b.get(y.obj);if(l instanceof i.ArrNode){const h=y.val;if(b.get(h)){const g=l.upd(y.ref,h);g&&this._gcTree(g)}}}else if(y instanceof c.DelOp){const l=b.get(y.obj);if(l instanceof i.ArrNode){const h=y.what.length;for(let g=0;g<h;g++){const v=y.what[g];for(let _=0;_<v.span;_++){const S=l.getById(new m.Timestamp(v.sid,v.time+_));S&&this._gcTree(S)}}l.delete(y.what)}else(l instanceof i.StrNode||l instanceof i.BinNode)&&l.delete(y.what)}else if(y instanceof c.NewBinOp){const l=y.id;b.get(l)||b.set(l,new i.BinNode(l))}else if(y instanceof c.InsBinOp){const l=b.get(y.obj);l instanceof i.BinNode&&l.ins(y.ref,y.id,y.data)}else if(y instanceof c.NewVecOp){const l=y.id;b.get(l)||b.set(l,new i.VecNode(this,l))}}_gcTree(y){if(y.sid===0)return;const l=this.index.get(y);if(!l)return;const h=l.api;h&&h.events.handleDelete(),l.children(g=>this._gcTree(g.id)),this.index.del(y)}fork(y=this.rndSid()){const b=ns.fromBinary(this.toBinary());return b.clock.sid!==y&&b.clock instanceof m.ClockVector&&(b.clock=b.clock.fork(y)),b.ext=this.ext,b}clone(){return this.fork(this.clock.sid)}reset(y){var g,v;(g=this.onbeforereset)==null||g.call(this);const b=this.index;this.index=new a.AvlMap(m.compare);const l=y.toBinary();d.decoder.decode(l,this),this.clock=y.clock.clone(),this.ext=y.ext.clone();const h=this._api;h&&(h.flush(),h.builder.clock=this.clock,h.node=this.root),b.forEach(({v:_})=>{const S=_.api;if(!S)return;const C=this.index.get(_.id);if(!C){S.events.handleDelete();return}S.node=C,C.api=S}),this.tick++,(v=this.onreset)==null||v.call(this)}view(){return this.root.view()}toBinary(){return d.encoder.encode(this)}setSchema(y,b=!0){const l=this.clock;if(l.time===1){const g=l.sid;b&&(l.sid=2),this.api.set(y),b&&this.setSid(g)}return this}setSid(y){const b=this.clock,l=b.sid;l!==y&&(b.sid=y,b.observe(new m.Timestamp(l,b.time-1),1))}toString(y=""){const b=()=>"",l=this.ext.size()>0;return"model"+(0,r.printTree)(y,[h=>this.root.toString(h),b,h=>{const g=[];return this.index.forEach(v=>g.push(v.v)),`index (${g.length} nodes)`+(g.length?(0,r.printTree)(h,g.map(v=>_=>`${v.name()} ${m.printTs(v.id)}`)):"")},b,h=>`view${(0,r.printTree)(h,[g=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,`
`+g)])}`,b,h=>this.clock.toString(h),l?b:null,l?h=>this.ext.toString(h):null])}};return wt.Model=f,f.sid=n.randomSessionId,f.create=(w,y=f.sid())=>{const b=typeof y=="number"?y===1?new m.ServerClockVector(1,1):new m.ClockVector(y,1):y,l=new f(b);return w!==void 0&&l.setSchema(w instanceof p.NodeBuilder?w:p.s.json(w),!0),l},f.withServerClock=(w,y=1)=>f.create(w,new m.ServerClockVector(1,y)),f.fromBinary=w=>d.decoder.decode(w),f.load=(w,y,b)=>{const l=d.decoder.decode(w);return b&&l.setSchema(b,!0),typeof y=="number"&&l.setSid(y),l},wt}var jl;function ec(){if(jl)return $n;jl=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.ValNode=void 0;const e=ce(),c=Ye(),m=ws();let d=class{constructor(u,n,i){this.doc=u,this.id=n,this.val=i,this.api=void 0}set(u){if((0,e.compare)(u,this.val)<=0&&this.val.sid!==0||(0,e.compare)(u,this.id)<=0)return;const n=this.val;return this.val=u,n}node(){return this.val.sid===0?m.UNDEFINED:this.child()}view(){var u;return(u=this.node())==null?void 0:u.view()}children(u){u(this.node())}child(){return this.doc.index.get(this.val)}container(){const u=this.node();return u?u.container():void 0}name(){return"val"}toString(u=""){const n=this.node();return this.name()+" "+(0,e.printTs)(this.id)+(0,c.printTree)(u,[s=>n?n.toString(s):(0,e.printTs)(this.val)])}};return $n.ValNode=d,$n}var cr={},Vl;function jp(){if(Vl)return cr;Vl=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.RootNode=void 0;const e=Fr(),c=ec();let m=class extends c.ValNode{constructor(o,u){super(o,e.ORIGIN,u)}name(){return"root"}};return cr.RootNode=m,cr}var dr={},fr={},Al;function Vp(){if(Al)return fr;Al=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.CRDT_CONSTANTS=void 0;var e;return function(c){c[c.MAX_TUPLE_LENGTH=255]="MAX_TUPLE_LENGTH"}(e||(fr.CRDT_CONSTANTS=e={})),fr}var Pl;function Ap(){if(Pl)return dr;Pl=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.VecNode=void 0;const e=Ur(),c=Vp(),m=Ye(),d=ce();let o=class{constructor(n,i){this.doc=n,this.id=i,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}length(){return this.elements.length}val(n){return this.elements[n]}get(n){const i=this.elements[n];if(i)return this.doc.index.get(i)}put(n,i){if(n>c.CRDT_CONSTANTS.MAX_TUPLE_LENGTH)throw new Error("OUT_OF_BOUNDS");const s=this.val(n);if(!(s&&(0,d.compare)(s,i)>=0)){if(n>this.elements.length)for(let r=this.elements.length;r<n;r++)this.elements.push(void 0);return n<this.elements.length?this.elements[n]=i:this.elements.push(i),s}}ext(){if(this.__extNode)return this.__extNode;const n=this.getExtId();if(!(n>=0))return;const s=this.doc.ext.get(n);if(s)return this.__extNode=new s.Node(this.get(1)),this.__extNode}isExt(){return!!this.ext()}getExtId(){if(this.elements.length!==2)return-1;const n=this.get(0);if(!(n instanceof e.ConNode))return-1;const i=n.val,s=this.id;return!(i instanceof Uint8Array)||i.length!==3||i[1]!==s.sid%256||i[2]!==s.time%256?-1:i[0]}child(){return this.ext()}container(){return this}children(n){const i=this.elements,s=i.length,r=this.doc.index;for(let t=0;t<s;t++){const a=i[t];if(!a)continue;const p=r.get(a);p&&n(p)}}view(){const n=this.ext();if(n)return n.view();let i=!0;const s=this._view,r=[],t=this.doc.index,a=this.elements,p=a.length;for(let f=0;f<p;f++){const w=a[f],y=w?t.get(w):void 0,b=y?y.view():void 0;s[f]!==b&&(i=!1),r.push(b)}return i?s:this._view=r}name(){return"vec"}toString(n=""){const i=this.ext(),s=this.name()+" "+(0,d.printTs)(this.id)+(i?` { extension = ${this.getExtId()} }`:"");if(i)return this.child().toString(n,this.id);const r=this.doc.index;return s+(0,m.printTree)(n,[...this.elements.map((t,a)=>p=>`${a}: ${t&&r.get(t)?r.get(t).toString(p+"  "+" ".repeat((""+a).length)):"nil"}`),...i?[t=>`${this.child().toString(t)}`]:[]])}};return dr.VecNode=o,dr}var hr={},Ml;function Pp(){if(Ml)return hr;Ml=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.ObjNode=void 0;const e=Ye(),c=ce(),m=Ur();let d=class{constructor(u,n){this.doc=u,this.id=n,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(u){const n=this.keys.get(u);if(n)return this.doc.index.get(n)}put(u,n){const i=this.keys.get(u);if(!(i&&(0,c.compare)(i,n)>=0))return this.keys.set(u,n),i}nodes(u){const n=this.doc.index;this.keys.forEach((i,s)=>u(n.get(i),s))}forEach(u){const n=this.doc.index;this.keys.forEach((i,s)=>{const r=n.get(i);!r||r instanceof m.ConNode&&r.val===void 0||u(s,r)})}children(u){const n=this.doc.index;this.keys.forEach((i,s)=>u(n.get(i)))}child(){}container(){return this}view(){const u=this.doc,n=u.clock.time+u.tick,i=this._view;if(this._tick===n)return i;const s={},r=u.index;let t=!0;return this.keys.forEach((a,p)=>{const f=r.get(a);if(!f){t=!1;return}const w=f.view();w!==void 0?(i[p]!==w&&(t=!1),s[p]=w):i[p]!==void 0&&(t=!1)}),t?i:(this._tick=n,this._view=s)}name(){return"obj"}toString(u=""){return this.name()+" "+(0,c.printTs)(this.id)+(0,e.printTree)(u,[...this.keys.entries()].filter(([,i])=>!!this.doc.index.get(i)).map(([i,s])=>r=>JSON.stringify(i)+(0,e.printTree)(r+" ",[t=>this.doc.index.get(s).toString(t)])))}};return hr.ObjNode=d,hr}var Ot={},pr={},Hi={},ql;function Mp(){return ql||(ql=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.rlSplay=e.lrSplay=e.llSplay=e.rrSplay=e.lSplay=e.rSplay=e.splay=void 0;const c=(s,r,t)=>{const a=r.p;if(!a)return s;const p=a.p,f=a.l===r;return p?(p.l===a?f?s=(0,e.llSplay)(s,r,a,p):s=(0,e.lrSplay)(s,r,a,p):f?s=(0,e.rlSplay)(s,r,a,p):s=(0,e.rrSplay)(s,r,a,p),t>1?(0,e.splay)(s,r,t-1):s):(f?(0,e.rSplay)(r,a):(0,e.lSplay)(r,a),r)};e.splay=c;const m=(s,r)=>{const t=s.r;s.p=void 0,s.r=r,r.p=s,r.l=t,t&&(t.p=r)};e.rSplay=m;const d=(s,r)=>{const t=s.l;s.p=void 0,s.l=r,r.p=s,r.r=t,t&&(t.p=r)};e.lSplay=d;const o=(s,r,t,a)=>{const p=t.l,f=r.l,w=a.p;return r.p=w,r.l=t,t.p=r,t.l=a,t.r=f,a.p=t,a.r=p,p&&(p.p=a),f&&(f.p=t),w?w.l===a?w.l=r:w.r=r:s=r,s};e.rrSplay=o;const u=(s,r,t,a)=>{const p=t.r,f=r.r,w=a.p;return r.p=w,r.r=t,t.p=r,t.l=f,t.r=a,a.p=t,a.l=p,p&&(p.p=a),f&&(f.p=t),w?w.l===a?w.l=r:w.r=r:s=r,s};e.llSplay=u;const n=(s,r,t,a)=>{const p=r.l,f=r.r,w=a.p;return r.p=w,r.l=t,r.r=a,t.p=r,t.r=p,a.p=r,a.l=f,p&&(p.p=t),f&&(f.p=a),w?w.l===a?w.l=r:w.r=r:s=r,s};e.lrSplay=n;const i=(s,r,t,a)=>{const p=r.r,f=r.l,w=a.p;return r.p=w,r.l=a,r.r=t,t.p=r,t.l=p,a.p=r,a.r=f,p&&(p.p=t),f&&(f.p=a),w?w.l===a?w.l=r:w.r=r:s=r,s};e.rlSplay=i}(Hi)),Hi}var Ji={},Dl;function qp(){return Dl||(Dl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.splay2=void 0;const c=(s,r)=>{const t=r.p2;if(!t)return s;const a=t.p2,p=t.l2===r;return a?(a.l2===t?p?s=u(s,r,t,a):s=n(s,r,t,a):p?s=i(s,r,t,a):s=o(s,r,t,a),(0,e.splay2)(s,r)):(p?m(r,t):d(r,t),r)};e.splay2=c;const m=(s,r)=>{const t=s.r2;s.p2=void 0,s.r2=r,r.p2=s,r.l2=t,t&&(t.p2=r)},d=(s,r)=>{const t=s.l2;s.p2=void 0,s.l2=r,r.p2=s,r.r2=t,t&&(t.p2=r)},o=(s,r,t,a)=>{const p=t.l2,f=r.l2,w=a.p2;return r.p2=w,r.l2=t,t.p2=r,t.l2=a,t.r2=f,a.p2=t,a.r2=p,p&&(p.p2=a),f&&(f.p2=t),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},u=(s,r,t,a)=>{const p=t.r2,f=r.r2,w=a.p2;return r.p2=w,r.r2=t,t.p2=r,t.l2=f,t.r2=a,a.p2=t,a.l2=p,p&&(p.p2=a),f&&(f.p2=t),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},n=(s,r,t,a)=>{const p=r.l2,f=r.r2,w=a.p2;return r.p2=w,r.l2=t,r.r2=a,t.p2=r,t.r2=p,a.p2=r,a.l2=f,p&&(p.p2=t),f&&(f.p2=a),w?w.l2===a?w.l2=r:w.r2=r:s=r,s},i=(s,r,t,a)=>{const p=r.r2,f=r.l2,w=a.p2;return r.p2=w,r.l2=a,r.r2=t,t.p2=r,t.l2=p,a.p2=r,a.r2=f,p&&(p.p2=t),f&&(f.p2=a),w?w.l2===a?w.l2=r:w.r2=r:s=r,s}}(Ji)),Ji}var _e={},Bl;function Dp(){if(Bl)return _e;Bl=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.remove2=_e.insert2=_e.prev2=_e.next2=_e.last2=_e.first2=void 0;const e=s=>{let r=s;for(;r;)if(r.l2)r=r.l2;else return r;return r};_e.first2=e;const c=s=>{let r=s;for(;r;)if(r.r2)r=r.r2;else return r;return r};_e.last2=c;const m=s=>{if(s.r2){for(s=s.r2;s.l2;)s=s.l2;return s}let r=s.p2;for(;r&&r.r2===s;)s=r,r=r.p2;return r};_e.next2=m;const d=s=>{if(s.l2){for(s=s.l2;s.r2;)s=s.r2;return s}let r=s.p2;for(;r&&r.l2===s;)s=r,r=r.p2;return r};_e.prev2=d;const o=(s,r)=>{const t=s.r2=r.r2;r.r2=s,s.p2=r,t&&(t.p2=s)},u=(s,r)=>{const t=s.l2=r.l2;r.l2=s,s.p2=r,t&&(t.p2=s)},n=(s,r,t)=>{if(!s)return r;let a=s;for(;a;){const p=t(r,a),f=p<0?a.l2:a.r2;if(f)a=f;else{p<0?u(r,a):o(r,a);break}}return s};_e.insert2=n;const i=(s,r)=>{const t=r.p2,a=r.l2,p=r.r2;if(r.p2=r.l2=r.r2=void 0,!a&&!p){if(t)t.l2===r?t.l2=void 0:t.r2=void 0;else return;return s}else if(a&&p){let w=a;for(;w.r2;)w=w.r2;return w.r2=p,p.p2=w,t?(t.l2===r?t.l2=a:t.r2=a,a.p2=t,s):(a.p2=void 0,a)}const f=a||p;if(f.p2=t,t)t.l2===r?t.l2=f:t.r2=f;else return f;return s};return _e.remove2=i,_e}var mr={},Fl;function Bp(){if(Fl)return mr;Fl=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.printOctets=void 0;const e=(c,m=16)=>{let d="";if(!c.length)return d;c[0]<16&&(d+="0"),d+=c[0].toString(16);for(let o=1;o<c.length&&o<m;o++){const u=c[o];d+=" ",u<16&&(d+="0"),d+=u.toString(16)}return c.length>m&&(d+=`… (${c.length-m} more)`),d};return mr.printOctets=e,mr}var Ll;function _s(){if(Ll)return pr;Ll=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.AbstractRga=void 0;const e=ce(),c=ds(),m=Mp(),d=qp(),o=Dp(),u=Fr(),n=Ye(),i=vs(),s=Bp(),r=(b,l)=>{const h=b.id,g=l.id;return h.sid-g.sid||h.time-g.time},t=b=>{const l=b.l,h=b.r;b.len=(b.del?0:b.span)+(l?l.len:0)+(h?h.len:0)},a=b=>{const l=b.l,h=b.r;b.len=b.span+(l?l.len:0)+(h?h.len:0)},p=(b,l)=>{for(;b;)b.len+=l,b=b.p},f=b=>{const l=b.r;if(l){b=l;let g;for(;g=b.l;)b=g;return b}let h=b.p;for(;h&&h.r===b;)b=h,h=h.p;return h},w=b=>{const l=b.l;if(l){b=l;let g;for(;g=b.r;)b=g;return b}let h=b.p;for(;h&&h.l===b;)b=h,h=h.p;return h};let y=class{constructor(l){this.id=l,this.root=void 0,this.ids=void 0,this.count=0}ins(l,h,g){const v=this.id,_=l.time,S=l.sid;if(v.time===_&&v.sid===S){this.insAfterRoot(l,h,g);return}let O=this.ids,x=O;for(;O;){const M=O.id,B=M.sid;if(B>S)O=O.l2;else if(B<S)x=O,O=O.r2;else{const U=M.time;if(U>_)O=O.l2;else if(U<_)x=O,O=O.r2;else{x=O;break}}}if(!x)return;const R=x.id,E=R.time,I=R.sid,N=x.span;if(I!==S||_-E>=N)return;const A=_-E;this.insAfterChunk(l,x,A,h,g)}insAt(l,h,g){if(!l){const x=this.id;return this.insAfterRoot(x,h,g),x}const v=this.findChunk(l-1);if(!v)return;const[_,S]=v,C=_.id,O=S===0?C:new e.Timestamp(C.sid,C.time+S);return this.insAfterChunk(O,_,S,h,g),O}insAfterRoot(l,h,g){const v=this.createChunk(h,g),_=this.first();if(!_)this.setRoot(v);else if((0,e.compare)(_.id,h)<0)this.insertBefore(v,_);else{if((0,e.containsId)(_.id,_.span,h))return;this.insertAfterRef(v,l,_)}}insAfterChunk(l,h,g,v,_){const S=h.id,C=S.time,O=S.sid,x=h.span,R=this.createChunk(v,_);if(g+1<x){const I=v.sid,N=v.time;if(O===I&&C<=N&&C+x-1>=N)return;if(N>l.time+1||I>l.sid){this.insertInside(R,h,g+1),this.splay(R);return}}this.insertAfterRef(R,l,h),this.splay(R)}delete(l){const h=l.length;for(let g=0;g<h;g++)this.deleteSpan(l[g]);this.onChange()}deleteSpan(l){const h=l.span,g=l.time,v=g+h-1,_=this.findById(l);if(!_)return;let S=_,C=S;for(;S;){C=S;const O=S.id,x=S.span,R=O.time,E=R+x-1;if(S.del){if(E>=v)break;S=S.s;continue}const I=g<=R,N=g<=E;if(I)if(v>=E){if(S.delete(),p(S,-S.span),v<=E)break}else{const A=v-R+1,M=this.split(S,A);S.delete(),t(M),p(S,-S.span);break}else if(N)if(v>=E){const A=g-R,M=this.split(S,A);if(M.delete(),M.len=M.r?M.r.len:0,p(S,-M.span),v<=E)break}else{const A=this.split(S,v-R+1),M=this.split(S,g-R);M.delete(),t(A),t(M),p(S,-M.span);break}S=S.s}C&&this.mergeTombstones2(_,C)}find(l){let h=this.root;for(;h;){const g=h.l,v=g?g.len:0;let _;if(l<v)h=g;else if(h.del)l-=v,h=h.r;else if(l<v+(_=h.span)){const S=l-v,C=h.id;return S?new e.Timestamp(C.sid,C.time+S):C}else l-=v+_,h=h.r}}findChunk(l){let h=this.root;for(;h;){const g=h.l,v=g?g.len:0;let _;if(l<v)h=g;else if(h.del)l-=v,h=h.r;else{if(l<v+(_=h.span))return[h,l-v];l-=v+_,h=h.r}}}findInterval(l,h){const g=[];if(!h)return g;let v=this.root,_=0;for(;v;){const O=v.l?v.l.len:0;if(l<O)v=v.l;else if(v.del)l-=O,v=v.r;else if(l<O+v.span){_=l-O;break}else l-=O+v.span,v=v.r}if(!v)return g;if(v.span>=h+_){const O=v.id;return g.push((0,e.tss)(O.sid,O.time+_,h)),g}const S=v.span-_,C=v.id;if(g.push((0,e.tss)(C.sid,C.time+_,S)),h-=S,v=f(v),!v)return g;do{if(v.del)continue;const O=v.id,x=v.span;if(h<=x)return g.push((0,e.tss)(O.sid,O.time,h)),g;g.push((0,e.tss)(O.sid,O.time,x)),h-=x}while((v=f(v))&&h>0);return g}findInterval2(l,h){const g=[];return this.range0(void 0,l,h,(v,_,S)=>{const C=v.id;g.push((0,e.tss)(C.sid,C.time+_,S))}),g}range0(l,h,g,v){let _=l||this.findById(h);if(l)for(;_&&!(0,e.containsId)(_.id,_.span,h);)_=f(_);if(_){if(_.del){if((0,e.containsId)(_.id,_.span,g))return}else{const S=h.time-_.id.time;if((0,e.containsId)(_.id,_.span,g)){const x=g.time-h.time+1;return v(_,S,x),_}const O=_.span-S;if(v(_,S,O))return _}for(_=f(_);_;){if((0,e.containsId)(_.id,_.span,g))return!_.del&&v(_,0,g.time-_.id.time+1),_;if(!_.del&&v(_,0,_.span))return _;_=f(_)}return _}}first(){let l=this.root;for(;l;){const h=l.l;if(h)l=h;else return l}return l}last(){let l=this.root;for(;l;){const h=l.r;if(h)l=h;else return l}return l}lastId(){const l=this.last();if(!l)return;const h=l.id,g=l.span;return g===1?h:new e.Timestamp(h.sid,h.time+g-1)}next(l){return f(l)}prev(l){return w(l)}length(){const l=this.root;return l?l.len:0}size(){return this.count}pos(l){const h=l.p,g=l.l;if(!h)return g?g.len:0;const v=this.pos(h);if(h.r===l)return v+(h.del?0:h.span)+(g?g.len:0);const S=l.r;return v-(l.del?0:l.span)-(S?S.len:0)}setRoot(l){this.root=l,this.insertId(l),this.onChange()}insertBefore(l,h){const g=h.l;h.l=l,l.l=g,l.p=h;let v=0;g&&(g.p=l,v=g.len),l.len=l.span+v,p(h,l.span),this.insertId(l),this.onChange()}insertAfter(l,h){const g=h.r;h.r=l,l.r=g,l.p=h;let v=0;g&&(g.p=l,v=g.len),l.len=l.span+v,p(h,l.span),this.insertId(l),this.onChange()}insertAfterRef(l,h,g){const v=l.id,_=v.sid,S=v.time;let C=!1;for(;;){const O=g.id,x=O.time+g.span;g.s||(C=O.sid===_&&x===S&&x-1===h.time,C&&(g.s=l));const R=f(g);if(!R)break;const E=R.id,I=E.time,N=E.sid;if(I<S)break;if(I===S){if(N===_)return;if(N<_)break}g=R}C&&!g.del?(this.mergeContent(g,l.data),g.s=void 0):this.insertAfter(l,g)}mergeContent(l,h){const g=l.span;l.merge(h),p(l,l.span-g),this.onChange()}insertInside(l,h,g){const v=h.p,_=h.l,S=h.r,C=h.s,O=h.len,x=h.split(g);if(h.s=x,x.s=C,h.l=h.r=x.l=x.r=void 0,x.l=void 0,l.p=v,!_)l.l=h,h.p=l;else{l.l=_,_.p=l;const I=_.r;_.r=h,h.p=_,h.l=I,I&&(I.p=h)}if(!S)l.r=x,x.p=l;else{l.r=S,S.p=l;const I=S.l;S.l=x,x.p=S,x.r=I,I&&(I.p=x)}v?v.l===h?v.l=l:v.r=l:this.root=l,t(h),t(x),_&&(_.len=(_.l?_.l.len:0)+h.len+(_.del?0:_.span)),S&&(S.len=(S.r?S.r.len:0)+x.len+(S.del?0:S.span)),l.len=O+l.span;const R=l.span;let E=l.p;for(;E;)E.len+=R,E=E.p;this.insertId(x),this.insertIdFast(l),this.onChange()}split(l,h){const g=l.s,v=l.split(h),_=l.r;return l.s=v,v.r=_,v.s=g,l.r=v,v.p=l,this.insertId(v),_&&(_.p=v),v}mergeTombstones(l,h){if(!l.del||!h.del)return!1;const g=l.id,v=h.id;return g.sid!==v.sid||g.time+l.span!==v.time?!1:(l.s=h.s,l.span+=h.span,this.deleteChunk(h),!0)}mergeTombstones2(l,h){let g=l;for(;g;){const _=f(g);if(!_)break;if(!this.mergeTombstones(g,_)){if(_===h){if(_){const C=f(_);C&&this.mergeTombstones(_,C)}break}g=g.s}}const v=w(l);v&&this.mergeTombstones(v,l)}removeTombstones(){let l=this.first();const h=[];for(;l;)l.del&&h.push(l),l=f(l);for(let g=0;g<h.length;g++)this.deleteChunk(h[g])}deleteChunk(l){this.deleteId(l);const h=l.p,g=l.l,v=l.r;if(l.id=u.ORIGIN,!g&&!v)h?h.l===l?h.l=void 0:h.r=void 0:this.root=void 0;else if(g&&v){let _=g;for(;_.r;)_=_.r;_.r=v,v.p=_;const S=v.len;let C;for(C=_,h?(h.l===l?h.l=g:h.r=g,g.p=h):(this.root=g,g.p=void 0);C&&C!==h;)C.len+=S,C=C.p}else{const _=g||v;_.p=h,h?h.l===l?h.l=_:h.r=_:this.root=_}}insertId(l){this.ids=(0,o.insert2)(this.ids,l,r),this.count++,this.ids=(0,d.splay2)(this.ids,l)}insertIdFast(l){this.ids=(0,o.insert2)(this.ids,l,r),this.count++}deleteId(l){this.ids=(0,o.remove2)(this.ids,l),this.count--}findById(l){const h=l.sid,g=l.time;let v=this.ids,_=v;for(;v;){const E=v.id,I=E.sid;if(I>h)v=v.l2;else if(I<h)_=v,v=v.r2;else{const N=E.time;if(N>g)v=v.l2;else if(N<g)_=v,v=v.r2;else{_=v;break}}}if(!_)return;const S=_.id,C=S.time,O=S.sid,x=_.span;if(!(O!==h||g<C||g-C>=x))return _}prevId(l){let h=this.findById(l);if(!h)return;const g=l.time;if(h.id.time<g)return new e.Timestamp(l.sid,g-1);if(h=w(h),!h)return;const v=h.id;return h.span>1?new e.Timestamp(v.sid,v.time+h.span-1):v}spanView(l){const h=[];let g=l.span;const v=l.time;let _=this.findById(l);if(!_)return h;if(!_.del)if(_.span>=g+v-_.id.time){const S=v-_.id.time,C=S+g,O=_.view().slice(S,C);return h.push(O),h}else{const S=v-_.id.time,C=_.view().slice(S,l.span);g-=_.span-S,h.push(C)}for(;_=_.s;){const S=_.span;if(!_.del){if(S>g){const C=_.view().slice(0,g);h.push(C);break}h.push(_.data)}if(g-=S,g<=0)break}return h}splay(l){const h=l.p;if(!h)return;const g=h.p,v=h.l===l;if(!g){v?(0,m.rSplay)(l,h):(0,m.lSplay)(l,h),this.root=l,t(h),a(l);return}g.l===h?v?this.root=(0,m.llSplay)(this.root,l,h,g):this.root=(0,m.lrSplay)(this.root,l,h,g):v?this.root=(0,m.rlSplay)(this.root,l,h,g):this.root=(0,m.rrSplay)(this.root,l,h,g),t(g),t(h),a(l),this.splay(l)}iterator(){let l=this.first();return()=>{const h=l;return l&&(l=f(l)),h}}ingest(l,h){if(l<1)return;const g=new Map;this.root=this._ingest(l,()=>{const v=h(),_=v.id,S=_.sid+"."+_.time,C=g.get(S);C&&(C.s=v,g.delete(S));const O=(0,e.tick)(_,v.span);return g.set(O.sid+"."+O.time,v),v})}_ingest(l,h){const g=l>>1,v=l-g-1,_=g>0?this._ingest(g,h):void 0,S=h();_&&(S.l=_,_.p=S);const C=v>0?this._ingest(v,h):void 0;return C&&(S.r=C,C.p=S),t(S),this.insertId(S),S}toStringName(){return"AbstractRga"}toString(l=""){const h=this.view();let g="";return(0,c.isUint8Array)(h)?g+=` { ${(0,s.printOctets)(h)||"∅"} }`:typeof h=="string"&&(g+=`{ ${h.length>32?JSON.stringify(h.substring(0,32))+" …":JSON.stringify(h)} }`),`${this.toStringName()} ${(0,e.printTs)(this.id)} ${g}`+(0,n.printTree)(l,[_=>this.root?this.printChunk(_,this.root):"∅"])}printChunk(l,h){return this.formatChunk(h)+(0,i.printBinary)(l,[h.l?g=>this.printChunk(g,h.l):null,h.r?g=>this.printChunk(g,h.r):null])}formatChunk(l){let g=`chunk ${(0,e.printTs)(l.id)}:${l.span} .${l.len}.`;if(l.del)g+=` [${l.span}]`;else if((0,c.isUint8Array)(l.data))g+=` { ${(0,s.printOctets)(l.data)||"∅"} }`;else if(typeof l.data=="string"){const v=l.data.length>32?JSON.stringify(l.data.substring(0,32))+" …":JSON.stringify(l.data);g+=` { ${v} }`}return g}};return pr.AbstractRga=y,pr}var Ul;function Fp(){if(Ul)return Ot;Ul=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.ArrNode=Ot.ArrChunk=void 0;const e=_s(),c=ce(),m=vs(),d=Ye();class o{constructor(i,s,r){this.id=i,this.span=s,this.len=r?s:0,this.del=!r,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=r}merge(i){this.data.push(...i),this.span=this.data.length}split(i){const s=this.span;if(this.span=i,!this.del){const t=this.data.splice(i);return new o((0,c.tick)(this.id,i),s-i,t)}return new o((0,c.tick)(this.id,i),s-i,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new o(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}Ot.ArrChunk=o;let u=class extends e.AbstractRga{constructor(i,s){super(s),this.doc=i,this._tick=0,this._view=[],this.api=void 0}get(i){const s=this.findChunk(i);if(s)return s[0].data[s[1]]}getNode(i){const s=this.get(i);if(s)return this.doc.index.get(s)}getId(i){const s=this.findChunk(i);if(!s)return;const[r,t]=s,a=r.id;return t?(0,c.tick)(a,t):a}getById(i){const s=this.findById(i);if(!s||s.del)return;const r=i.time-s.id.time;return s.data[r]}upd(i,s){const r=this.findById(i);if(!r)return;const t=r.data;if(!t)return;const a=i.time-r.id.time,p=t[a];if(!(p&&(0,c.compare)(p,s)>=0))return t[a]=s,this.onChange(),p}createChunk(i,s){return new o(i,s?s.length:0,s)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const i=this.doc,s=i.clock.time+i.tick,r=this._view;if(this._tick===s)return r;const t=[],a=i.index;let p=!0;for(let w=this.first();w;w=this.next(w))if(!w.del)for(const y of w.data){const b=a.get(y);if(!b){p=!1;continue}const l=b.view();r[t.length]!==l&&(p=!1),t.push(l)}return r.length!==t.length&&(p=!1),p?r:(this._tick=s,this._view=t)}children(i){const s=this.doc.index;for(let r=this.first();r;r=this.next(r)){const t=r.data;if(!t)continue;const a=t.length;for(let p=0;p<a;p++)i(s.get(t[p]))}}name(){return"arr"}printChunk(i,s){const r=this.pos(s);let t="";if(!s.del){const a=this.doc.index;t=(0,d.printTree)(i,s.data.map(p=>a.get(p)).filter(p=>!!p).map((p,f)=>w=>`[${r+f}]: ${p.toString(w+"    "+" ".repeat(String(f).length))}`))}return this.formatChunk(s)+t+(0,m.printBinary)(i,[s.l?a=>this.printChunk(a,s.l):null,s.r?a=>this.printChunk(a,s.r):null])}};return Ot.ArrNode=u,Ot}var Rt={},$l;function Lp(){if($l)return Rt;$l=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.BinNode=Rt.BinChunk=void 0;const e=ce(),c=_s();class m{constructor(u,n,i){this.id=u,this.span=n,this.len=i?n:0,this.del=!i,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=i}merge(u){const n=this.data.length,i=new Uint8Array(n+u.length);i.set(this.data),i.set(u,n),this.data=i,this.span=i.length}split(u){if(!this.del){const i=this.data,s=i.subarray(u),r=new m((0,e.tick)(this.id,u),this.span-u,s);return this.data=i.subarray(0,u),this.span=u,r}const n=new m((0,e.tick)(this.id,u),this.span-u,void 0);return this.span=u,n}delete(){this.del=!0,this.data=void 0}clone(){return new m(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}Rt.BinChunk=m;let d=class extends c.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const u=new Uint8Array(this.length());let n=0,i=this.first();for(;i;){if(!i.del){const s=i.data;u.set(s,n),n+=s.length}i=this.next(i)}return this._view=u}children(){}child(){}container(){}name(){return"bin"}createChunk(u,n){return new m(u,n?n.length:0,n)}onChange(){this._view=null}toStringName(){return this.name()}};return Rt.BinNode=d,Rt}var Nt={},zl;function Up(){if(zl)return Nt;zl=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.StrNode=Nt.StrChunk=void 0;const e=ce(),c=_s(),m=Zu();class d{constructor(n,i,s){this.id=n,this.span=i,this.len=s?i:0,this.del=!s,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=s}merge(n){this.data+=n,this.span=this.data.length}split(n){if(!this.del){const s=new d((0,e.tick)(this.id,n),this.span-n,this.data.slice(n));return this.data=this.data.slice(0,n),this.span=n,s}const i=new d((0,e.tick)(this.id,n),this.span-n,"");return this.span=n,i}delete(){this.del=!0,this.data=""}clone(){return new d(this.id,this.span,this.data)}view(){return this.data}}Nt.StrChunk=d;let o=class extends c.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let n="";for(let i=this.first();i;i=(0,m.next)(i))n+=i.data;return this._view=n}name(){return"str"}createChunk(n,i){return new d(n,i?i.length:0,i||"")}onChange(){this._view=""}toStringName(){return this.name()}};return Nt.StrNode=o,Nt}var Gl;function $p(){return Gl||(Gl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StrChunk=e.StrNode=e.BinChunk=e.BinNode=e.ArrChunk=e.ArrNode=e.ObjNode=e.VecNode=e.RootNode=e.ValNode=e.ConNode=void 0;var c=Ur();Object.defineProperty(e,"ConNode",{enumerable:!0,get:function(){return c.ConNode}});var m=ec();Object.defineProperty(e,"ValNode",{enumerable:!0,get:function(){return m.ValNode}});var d=jp();Object.defineProperty(e,"RootNode",{enumerable:!0,get:function(){return d.RootNode}});var o=Ap();Object.defineProperty(e,"VecNode",{enumerable:!0,get:function(){return o.VecNode}});var u=Pp();Object.defineProperty(e,"ObjNode",{enumerable:!0,get:function(){return u.ObjNode}});var n=Fp();Object.defineProperty(e,"ArrNode",{enumerable:!0,get:function(){return n.ArrNode}}),Object.defineProperty(e,"ArrChunk",{enumerable:!0,get:function(){return n.ArrChunk}});var i=Lp();Object.defineProperty(e,"BinNode",{enumerable:!0,get:function(){return i.BinNode}}),Object.defineProperty(e,"BinChunk",{enumerable:!0,get:function(){return i.BinChunk}});var s=Up();Object.defineProperty(e,"StrNode",{enumerable:!0,get:function(){return s.StrNode}}),Object.defineProperty(e,"StrChunk",{enumerable:!0,get:function(){return s.StrChunk}})}(xi)),xi}var Wl;function ht(){return Wl||(Wl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(Yh(),e),c.__exportStar($p(),e)}(_i)),_i}var Ki={},Hl;function zp(){return Hl||(Hl=1,Object.defineProperty(Ki,"__esModule",{value:!0})),Ki}var Yi={},Jl;function Gp(){return Jl||(Jl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Model=void 0;const c=re;var m=ws();Object.defineProperty(e,"Model",{enumerable:!0,get:function(){return m.Model}}),c.__exportStar(Yu(),e)}(Yi)),Yi}var Kl;function tc(){return Kl||(Kl=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const c=re;c.__exportStar(ht(),e),c.__exportStar(zp(),e),c.__exportStar(Gp(),e),c.__exportStar($r(),e)}(wi)),wi}var Wp=tc(),gr={},Yl;function Hp(){if(Yl)return gr;Yl=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.Encoder=void 0;const c=re.__importStar(ht()),m=ju(),d=ce();let o=class{encode(n){this.model=n;const i=n.clock;return{time:i.sid===1?i.time:this.cClock(n.clock),root:this.cVal(n.root)}}cClock(n){const i=[],s=n.sid;n.peers.get(s)||i.push([s,n.time]);for(const t of n.peers.values())i.push([t.sid,t.time]);return i}cTs(n){return n.sid===1?n.time:[n.sid,n.time]}cNode(n){if(n instanceof c.ObjNode)return this.cObj(n);if(n instanceof c.ArrNode)return this.cArr(n);if(n instanceof c.StrNode)return this.cStr(n);if(n instanceof c.ValNode)return this.cVal(n);if(n instanceof c.ConNode)return this.cCon(n);if(n instanceof c.BinNode)return this.cBin(n);if(n instanceof c.VecNode)return this.cVec(n);throw new Error("UNKNOWN_NODE")}cObj(n){const i={};return n.nodes((s,r)=>{i[r]=this.cNode(s)}),{type:"obj",id:this.cTs(n.id),map:i}}cVec(n){const i=[],s=n.elements,r=s.length,t=this.model.index;for(let a=0;a<r;a++){const p=s[a];p===void 0?i.push(null):i.push(this.cNode(t.get(p)))}return{type:"vec",id:this.cTs(n.id),map:i}}cArr(n){const i=[],s=n.iterator();let r;for(;r=s();)i.push(this.cArrChunk(r));return{type:"arr",id:this.cTs(n.id),chunks:i}}cArrChunk(n){if(n.del)return{id:this.cTs(n.id),span:n.span};const i=this.model.index;return{id:this.cTs(n.id),value:n.data.map(r=>this.cNode(i.get(r)))}}cStr(n){const i=[],s=n.iterator();let r;for(;r=s();)i.push(this.cStrChunk(r));return{type:"str",id:this.cTs(n.id),chunks:i}}cStrChunk(n){return n.del?{id:this.cTs(n.id),span:n.span}:{id:this.cTs(n.id),value:n.data}}cBin(n){const i=[],s=n.iterator();let r;for(;r=s();)i.push(this.cBinChunk(r));return{type:"bin",id:this.cTs(n.id),chunks:i}}cBinChunk(n){return n.del?{id:this.cTs(n.id),span:n.span}:{id:this.cTs(n.id),value:(0,m.toBase64)(n.data)}}cVal(n){return{type:"val",id:this.cTs(n.id),value:this.cNode(n.node())}}cCon(n){const i={type:"con",id:this.cTs(n.id)},s=n.val;return s instanceof d.Timestamp?(i.timestamp=!0,i.value=this.cTs(s)):s!==void 0&&(i.value=s),i}};return gr.Encoder=o,gr}var Jp=Hp();const Kp=30*1024;class Yp{constructor(c){pe(this,"socket");pe(this,"model",null);pe(this,"sequenceNumber",0);pe(this,"replicaId");pe(this,"verboseEncoder",new Jp.Encoder);pe(this,"maxPayloadSizeBytes");pe(this,"onModelCreate",Tt);pe(this,"onGridReady",Tt);pe(this,"onStatusChange",Tt);pe(this,"messageHandler",c=>{var m,d;if(c=JSON.parse(c),Array.isArray(c)&&c.length===3&&c[0]===4){const[,,o]=c;try{const u=Ar.decode(o);this.model?(console.debug("Applying patch from server:",u),(m=this.model)==null||m.applyPatch(u)):(console.debug("Initializing new model from patch:"),console.debug(u.toString()),this.model=Wp.Model.fromPatches([u]).fork(this.replicaId),this.onModelCreate(this.model));const n=(d=this.model)==null?void 0:d.api.flush();let i;if((n==null?void 0:n.ops.length)!==0&&(i=Ar.encode(n)),i){const s=[1,this.sequenceNumber,"patch",i];console.debug("Responding with patch:",s),this.sendMessage(s)}else{const s=this.verboseEncoder.encode(this.model);this.sendSyncMessage(s.time)}}catch(u){console.error("Failed to apply patch or send clock:",u)}}else if(Array.isArray(c)&&c.length===2&&c[0]===5)this.sequenceNumber+=1,this.onGridReady(),console.debug("Clocks synchronized with server. Incrementing sequence number.");else if(Array.isArray(c)&&c[0]===8){if(console.debug("Message received from server:",c[1]),c[1]==="ping"&&console.debug("Received ping response from server"),c[1]==="connected"&&(console.debug("Server ready to receive patches"),this.sendSyncMessage()),c[1]==="error"){console.warn("Error from server:",c[2]);return}if(c[1]==="new-patch"){if(!this.model){console.warn("Model is not initialized. Cannot handle 'new-patch' message.");return}const o=this.verboseEncoder.encode(this.model);console.debug("New patch received, syncing data:",o.time);const u=[1,this.sequenceNumber,"synchronize-clock",o.time];this.sendMessage(u)}}else console.warn("Unexpected WebSocket message format:",c)});const{replicaId:m,url:d,onGridReady:o,onStatusChange:u,onModelCreate:n,maxPayloadSizeBytes:i,socket:s}=c;this.replicaId=m,this.maxPayloadSizeBytes=i??Kp,this.socket=s??new WebSocket(d),this.socket.onopen=()=>{console.debug("Connected to the WebSocket server"),this.onStatusChange(!0,this)},this.socket.onmessage=r=>{this.handleMessage(r.data)},this.socket.onclose=()=>{console.debug("Disconnected from the WebSocket server"),this.onStatusChange(!1,this)},this.socket.onerror=r=>{console.error("WebSocket error:",r)},n&&(this.onModelCreate=n),o&&(this.onGridReady=o),u&&(this.onStatusChange=u)}disconnect(){this.socket.readyState===WebSocket.OPEN?(this.socket.close(),console.debug("WebSocket connection closed")):console.warn("WebSocket is not open. No action taken.")}handleMessage(c){this.messageHandler(c)}sendMessage(c){this.socket.readyState===WebSocket.OPEN?(console.debug("Sending message:",c),this.socket.send(JSON.stringify(c))):console.error("WebSocket is not open. Unable to send message. Current state:",this.socket.readyState)}sendPatch(){if(!this.model){console.warn("Model is not initialized. Cannot send patch.");return}const c=this.model.api.flush();c&&Kh(c,this.maxPayloadSizeBytes).forEach(d=>{console.debug("Sending patch to server:",d);const o=[1,this.sequenceNumber,"patch",d];this.sendMessage(o)})}sendSyncMessage(c=[]){const m=[1,this.sequenceNumber,"synchronize-clock",c];this.sendMessage(m)}}function Xp(){const[e,c]=z.useState(null),[m,d]=z.useState(null),[o,u]=z.useState(!1),[n,i]=z.useState(!1),s=_h(e),r=z.useCallback((t,a)=>{if(a&&!m){const p=new Yp({replicaId:t,url:a,onGridReady:()=>{u(!0)},onStatusChange:(f,w)=>{i(f)},onModelCreate:f=>{c(f)}});d(p)}},[]);return z.useEffect(()=>()=>{m&&m.disconnect(),c(null),u(!1)},[m]),{isConnected:n,createWebsocket:r,websocketInstance:m,isGridReady:o,model:e,modelSnapshot:s}}function Xl(e,c){switch(e.type){case"CREATE":return c==="undo"?{type:"DELETE",rowIndex:e.rowIndex}:e.newValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.newValue}:null;case"UPDATE":{const m=c==="undo"?e.previousValue:e.newValue;return m?{type:"UPDATE",rowIndex:e.rowIndex,updatedData:m}:null}case"DELETE":return c==="undo"?e.previousValue?{type:"CREATE",rowIndex:e.rowIndex,rowData:e.previousValue}:null:{type:"DELETE",rowIndex:e.rowIndex};default:return null}}function Pr(e=[],c){const[m,d]=z.useState(e),o=z.useCallback(r=>{d(t=>{const a=[...t,r];return c&&a.length>c&&a.shift(),a})},[c]),u=z.useCallback(()=>{if(m.length===0)return;const r=m[m.length-1];return d(t=>t.slice(0,-1)),r},[m]),n=z.useCallback(()=>m[m.length-1],[m]),i=z.useCallback(()=>{d([])},[]),s=z.useCallback(()=>m.length===0,[m]);return{stack:m,push:o,pop:u,clear:i,peek:n,size:m.length,isEmpty:s}}try{Pr.displayName="useStack",Pr.__docgenInfo={description:"Hook for managing a stack data structure",displayName:"useStack",props:{}}}catch{}const Qp=100,Zp=100;function rs(e){const c=Pr([],Qp),m=Pr([],Zp),[d,o]=z.useState(null),[u,n]=z.useState(null),i=!!d,s=!!u,r=x=>{o(x.currentTarget)},t=x=>{n(x.currentTarget)},a=()=>o(null),p=()=>n(null),f=z.useCallback(()=>{if(c.isEmpty())return null;const R=c.peek().type;let E=0;for(let I=c.stack.length-1;I>=0&&c.stack[I].type===R;I--)E++;return{lastType:R,sameTypeCount:E,totalActions:c.size}},[c.stack.length,c]),w=z.useCallback(()=>{if(m.isEmpty())return null;const R=m.peek().type;let E=0;for(let I=m.stack.length-1;I>=0&&m.stack[I].type===R;I--)E++;return{lastType:R,sameTypeCount:E,totalActions:m.size}},[m.stack.length,m]),y=f(),b=w(),l=z.useCallback(()=>{if(c.isEmpty())return;const x=c.pop();if(x){const R=Xl(x,"undo");if(!R)return;m.push(x),e(R)}a()},[e,c,m]),h=z.useCallback(()=>{if(m.isEmpty())return;const x=m.pop();if(x){const R=Xl(x,"redo");if(!R)return;c.push(x),e(R)}p()},[m,c,e]);z.useEffect(()=>{const x=R=>{R.ctrlKey&&R.key==="z"&&!R.shiftKey||R.metaKey&&R.key==="z"&&!R.shiftKey?(R.preventDefault(),l()):(R.ctrlKey&&R.key==="y"||R.ctrlKey&&R.shiftKey&&R.key==="z"||R.metaKey&&R.shiftKey&&R.key==="z")&&(R.preventDefault(),h())};return window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}},[l,h]);const g=x=>c.push(x),v=()=>c.clear(),_=()=>m.clear(),S=(x,R,E)=>{_();for(const I of x){const N=I.fromRowIndex,P=I.toRowIndex;if(I.type==="CREATE")for(let A=N;A<P;A++){const M=E[A];g({type:"CREATE",rowIndex:A,newValue:M})}if(I.type==="UPDATE"){const A=R.slice(N,P);E.slice(N,P).forEach((B,U)=>{const $=A[U],H=N+U;g({type:"UPDATE",rowIndex:H,previousValue:$,newValue:B})})}I.type==="DELETE"&&R.slice(N,P).forEach((M,B)=>{g({type:"DELETE",rowIndex:N+B,previousValue:M})})}},C=j.jsxs(j.Fragment,{children:[j.jsxs(Gt,{"aria-controls":i?"undo-menu":void 0,"aria-haspopup":"true",onClick:r,disabled:!y,endIcon:j.jsx(Bs,{}),children:["Undo ",y&&`(${y.totalActions})`]}),j.jsx(Fs,{id:"undo-menu",anchorEl:d,open:i,onClose:a,children:y?j.jsxs(yr,{onClick:l,children:["Undo last ",y.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(yr,{disabled:!0,children:"No actions to undo"})})]}),O=j.jsxs(j.Fragment,{children:[j.jsxs(Gt,{"aria-controls":s?"redo-menu":void 0,"aria-haspopup":"true",onClick:t,disabled:!b,endIcon:j.jsx(Bs,{}),children:["Redo ",b&&`(${b.totalActions})`]}),j.jsx(Fs,{id:"redo-menu",anchorEl:u,open:s,onClose:p,children:b?j.jsxs(yr,{onClick:h,children:["Redo last ",b.lastType.toLowerCase()," action"]},"lastAction"):j.jsx(yr,{disabled:!0,children:"No actions to redo"})})]});return{undoPreview:y,handleUndo:l,addToUndoStack:g,clearUndoStack:v,addOperationsToUndoStack:S,undoUI:C,undoTotalActions:y?y.totalActions:0,redoPreview:b,redoUI:O,redoTotalActions:b?b.totalActions:0,handleRedo:h,clearRedoStack:_}}try{rs.displayName="useGridUndoRedo",rs.__docgenInfo={description:"Hook to manage undo/redo functionality for a grid backed by a CRDT model.",displayName:"useGridUndoRedo",props:{}}}catch{}var br=$r();function e0(e,c){const m=e.api.arr(["rows"]),{columnNames:d}=e.api.getSnapshot();switch(c.type){case"CREATE":{const o=d.map(u=>br.s.con(c.rowData[u]??null));m==null||m.ins(c.rowIndex,[br.s.obj({data:br.s.vec(...o),metadata:br.s.obj({})})]);break}case"DELETE":m==null||m.del(c.rowIndex,c.count??1);break;case"UPDATE":{Object.entries(c.updatedData).forEach(([o,u])=>{if(o.startsWith("_"))return;const n=d.indexOf(o);if(n!==-1){const i=e.api.vec(["rows",String(c.rowIndex),"data"]);i==null||i.set([[n,br.s.con(u)]])}});break}}}function t0(e,c,m){const d=[];return e.forEach(o=>{if(o.type==="CREATE")for(let u=o.fromRowIndex;u<o.toRowIndex;u++)d.push({type:"CREATE",rowIndex:u,rowData:c[u]});if(o.type==="UPDATE")for(let u=o.fromRowIndex;u<o.toRowIndex;u++)d.push({type:"UPDATE",rowIndex:u,updatedData:c[u]});o.type==="DELETE"&&d.push({type:"DELETE",rowIndex:o.fromRowIndex,count:o.toRowIndex-o.fromRowIndex})}),d}function n0(e){const{rowData:c,rowIndex:m,columnId:d,selectedRowIndex:o}=e,u=o===m,n=c.__cellValidationResults,i=[];return u&&i.push("cell-row-selected"),n&&d&&n.has(d)&&i.push("cell-invalid"),i.length?du(i):void 0}const Mr=z.forwardRef(({query:e,showDebugInfo:c=!1},m)=>{var M,B;const[d,o]=z.useState(null),[u,n]=z.useState(null),[i,s]=z.useState(""),r=z.useRef(null);z.useImperativeHandle(m,()=>({initializeGrid:()=>{r.current&&r.current.handleStartSession(e)}}),[e]);const{isConnected:t,websocketInstance:a,createWebsocket:p,isGridReady:f,model:w,modelSnapshot:y}=Xp();z.useEffect(()=>{u&&i&&p(u,i)},[u,i,p]);const{data:b}=Hc((d==null?void 0:d.gridJsonSchema$Id)??"",{enabled:!!(d!=null&&d.gridJsonSchema$Id)}),l=t?"Connected":"Disconnected",h=z.useMemo(()=>y?Cd(w,y):[],[w,y]),g=y?v(y):[];function v(U){if(!U)return[];const{columnNames:$,columnOrder:H}=U,Z=b?Td(b):[];return H.map(Q=>{const ie=$[Q],Ce=b?Ed(Ys(b,ie)).map(be=>be.value):null,Te=b?bu(Ys(b,ie)):null;return Te==="boolean"?{...ut.keyColumn(ie,ut.checkboxColumn),title:ie,headerClassName:Z.includes(ie)?"header-cell-required":"header-cell"}:Te==="number"||Te==="integer"?{...ut.keyColumn(ie,ut.floatColumn),title:ie,headerClassName:Z.includes(ie)?"header-cell-required":"header-cell"}:Ce&&Ce.length>0?{...ut.keyColumn(ie,es({choices:Ce,colType:Te})),title:ie,headerClassName:Z.includes(ie)?"header-cell-required":"header-cell"}:{...ut.keyColumn(ie,ut.createTextColumn({continuousUpdates:!1})),title:ie,headerClassName:Z.includes(ie)?"header-cell-required":"header-cell"}})}const _=z.useCallback(ad(()=>{console.log("Auto-committing changes"),a==null||a.sendPatch()},500),[a]),S=z.useCallback((U,$)=>{$.forEach(H=>{e0(U,H)}),_()},[_]),C=(U,$)=>{if(!w){console.error("Model is not initialized");return}if($=_d(U,h,$),$.length>0){I(),E($,h,U);const H=t0($,U);S(w,H)}},O=z.useCallback(U=>{if(!w){console.error("Model is not initialized");return}U.type==="DELETE"&&A.current&&A.current.setActiveCell(null),S(w,[U])},[w,S]),{undoUI:x,redoUI:R,addOperationsToUndoStack:E,clearRedoStack:I}=rs(O),[N,P]=z.useState(null),A=z.useRef(null);return j.jsx("div",{children:j.jsxs(Se,{container:!0,spacing:2,children:[j.jsx(Se,{size:{xs:12,xl:8},children:j.jsx(ts,{ref:r,onSessionChange:o,onReplicaChange:n,onPresignedUrlChange:s,query:e})}),j.jsx(Se,{size:{xs:12,xl:4},children:c&&j.jsxs("div",{children:[j.jsxs("p",{children:["Session ID: ",(d==null?void 0:d.sessionId)||"No session created"]}),j.jsxs("p",{children:["Replica ID: ",u||"No replica created"]}),j.jsxs("p",{children:["JSON Schema $id:"," ",(d==null?void 0:d.gridJsonSchema$Id)||"No schema attached to session"]}),j.jsxs("p",{children:["Presigned URL:"," ",i.substring(0,30)+(i.length>30?" ... "+i.substring(i.length-10,i.length):"")||"No URL generated"]}),j.jsxs("p",{children:["WebSocket Status:"," ",j.jsx("span",{style:{color:t?"green":"red"},children:l})]})]})}),d&&j.jsxs(j.Fragment,{children:[!f&&j.jsxs(Se,{size:12,children:[j.jsx("h3",{children:"Setting up grid..."}),j.jsxs("div",{style:{marginBottom:"10px"},children:[!d&&j.jsx("p",{children:"Creating grid session..."}),d&&!u&&j.jsx("p",{children:"Setting up real-time sync..."}),d&&u&&!i&&j.jsx("p",{children:"Establishing secure connection..."}),d&&u&&i&&!t&&j.jsx("p",{children:"Connecting to server..."}),t&&!f&&j.jsx("p",{children:"Loading table data..."}),j.jsx(Pc,{numRows:4,numCols:1})]})]}),f&&j.jsxs(Se,{size:12,children:[x,R,j.jsx(ut.DataSheetGrid,{ref:A,value:h,columns:g,rowKey:mu,rowClassName:({rowData:U,rowIndex:$})=>{var H,Z,Y;return du({"row-valid":((H=U.__validationResults)==null?void 0:H.isValid)===!0,"row-invalid":((Z=U.__validationResults)==null?void 0:Z.isValid)===!1,"row-unknown":!!b&&((Y=U.__validationResults)==null?void 0:Y.isValid)==null,"row-selected":N===$})},cellClassName:({rowData:U,rowIndex:$,columnId:H})=>n0({rowData:U,rowIndex:$,columnId:H,selectedRowIndex:N}),duplicateRow:({rowData:U})=>({...U}),onChange:C,onActiveCellChange:({cell:U})=>{P(U?U.row:null)}}),N!==null&&h[N]&&Array.isArray((M=h[N].__validationResults)==null?void 0:M.allValidationMessages)&&((B=h[N].__validationResults)==null?void 0:B.allValidationMessages.length)>0&&j.jsx($c,{variant:"warning",title:"Validation Messages:",isGlobal:!1,description:j.jsx("ul",{children:h[N].__validationResults.allValidationMessages.map(U=>j.jsx("li",{children:U},U))}),sx:{marginTop:"12px"}})]}),f&&d.sourceEntityId&&j.jsx(Se,{container:!0,size:12,sx:{justifyContent:"flex-end"},children:j.jsx(Xi,{sourceEntityId:d.sourceEntityId,gridSessionId:d.sessionId})}),c&&j.jsxs(Se,{size:12,style:{margin:"10px 0",padding:"10px",border:"1px solid #ccc",maxHeight:"400px",overflowY:"auto"},children:[j.jsx("h3",{children:"Model snapshot"}),y?j.jsx(Jc,{value:y}):"No model available"]})]})]})})});try{Mr.displayName="SynapseGrid",Mr.__docgenInfo={description:"",displayName:"SynapseGrid",props:{query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"string"}},showDebugInfo:{defaultValue:{value:"false"},description:"",name:"showDebugInfo",required:!1,type:{name:"boolean"}}}}}catch{}const cS={title:"Components/SynapseGrid",component:Mr,parameters:{stack:"staging"},argTypes:{showDebugInfo:{control:"boolean",description:"Show debug information including session details and model snapshot"}}},r0=e=>{const c=z.useRef(null);return j.jsxs("div",{children:[j.jsx(Gt,{variant:"outlined",onClick:()=>{var m;return(m=c.current)==null?void 0:m.initializeGrid()},sx:{color:"inherit",margin:"10px 0"},children:"Start Grid Session"}),j.jsx(Mr,{ref:c,...e})]})},Ir={render:r0,args:{query:"SELECT * FROM syn35295069"},parameters:{msw:{handlers:[]}}},kr={args:{query:"",showDebugInfo:!0},parameters:{msw:{handlers:[]}}};var Ql,Zl,eu;Ir.parameters={...Ir.parameters,docs:{...(Ql=Ir.parameters)==null?void 0:Ql.docs,source:{originalSource:`{
  render: GridWithButton,
  args: {
    query: 'SELECT * FROM syn35295069'
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(eu=(Zl=Ir.parameters)==null?void 0:Zl.docs)==null?void 0:eu.source}}};var tu,nu,ru;kr.parameters={...kr.parameters,docs:{...(tu=kr.parameters)==null?void 0:tu.docs,source:{originalSource:`{
  args: {
    query: '',
    showDebugInfo: true
  },
  parameters: {
    msw: {
      handlers: []
    }
  }
}`,...(ru=(nu=kr.parameters)==null?void 0:nu.docs)==null?void 0:ru.source}}};const dS=["GridWithQuery","GridWithUserInputAndDebugInfo"];export{Ir as GridWithQuery,kr as GridWithUserInputAndDebugInfo,dS as __namedExportsOrder,cS as default};
