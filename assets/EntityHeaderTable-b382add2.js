import{j as t,a as d,F as Q}from"./jsx-runtime-9dc53467.js";import{r as a,R as oe}from"./index-76fb7be0.js";import{T as ue,V as me,W as ee,X as ye,Y as ge,Z as fe,_ as he,$ as Ce,a0 as _e}from"./HelpPopover-5a96505e.js";import{B as Ie,D as Se}from"./SynapseClient-7700f4cc.js";import{P as we}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-c0eacdfc.js";import{S as te}from"./RegularExpressions-bc0adf55.js";import{a as xe}from"./useGetEntityHeaders-dfa410e8.js";import{I as be,A as Ee}from"./IconSvg-b2c8dc9b.js";import"./SkeletonButton-96bd3884.js";import{S as Re}from"./SkeletonTable-04ae7db3.js";import{p as Fe}from"./papaparse.min-8c9ba15c.js";import{u as Ve}from"./UserSearchBoxV2-14c329a6.js";import{M as ae}from"./TextField-4b8d3337.js";import{E as De}from"./EntityLink-9ac6c0eb.js";import{L as Te}from"./Link-adab3de3.js";import{T as v}from"./Typography-62cfc992.js";import{C as ie}from"./FormControlLabel-825bc21f.js";import{E as ke}from"./EntityFinderModal-a94788e1.js";import{V as He,F as Ne}from"./useEntitySelection-bf333189.js";import{c as ve}from"./cloneDeep-4246eae0.js";import{p as Me}from"./pluralize-9f2b9a2f.js";import{u as Ae}from"./ThemesPlot-752c0644.js";import{B as f}from"./Box-737945d6.js";import{B as L}from"./Button-a2b8b546.js";import{I as ne}from"./IconButton-30f6f351.js";import{I as Be}from"./InputLabel-060c2cf9.js";import{M as Pe}from"./Tooltip-e8bd1358.js";import{M as qe}from"./Alert-f631f725.js";import{A as Le}from"./AlertTitle-38884730.js";import{n as Ue}from"./uniq-f9854dd4.js";function U({initialValue:r,onChange:o,options:l,delay:p=250,...u}){const[s,h]=a.useState(r);return Ve(()=>{o(s)},[o,s],p),t(ue,{freeSolo:!0,disablePortal:!0,isOptionEqualToValue:(m,y)=>y.length==0||m===y,options:l,value:s,onChange:(m,y)=>{h(y??"")},sx:{marginRight:"10px"},renderInput:m=>t(ae,{...m,...u,value:s,onChange:y=>h(y.target.value)})})}try{U.displayName="DebouncedInput",U.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function O({column:r,table:o}){var s;const l=(s=o.getPreFilteredRowModel().flatRows[0])==null?void 0:s.getValue(r.id),p=r.getFilterValue()??"",u=oe.useMemo(()=>typeof l=="number"?[]:Array.from(r.getFacetedUniqueValues().keys()).sort(),[r.getFacetedUniqueValues()]);return t(U,{type:"text",options:u,initialValue:p,onChange:h=>r.setFilterValue(h),label:`Filter by ${r.columnDef.header} (${r.getFacetedUniqueValues().size})`})}try{O.displayName="Filter",O.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function z(r){const{cell:o}=r,{row:l}=o,{original:p}=l,{id:u,isDummy:s}=p;return s?t(Te,{href:`${we.PORTAL}#!Synapse:${u}`,children:u}):t(De,{entity:p})}function j(r){const{cell:o}=r;return t(v,{variant:"body1",children:o.getContext().getValue()})}function $(r){const{cell:o}=r;return t(v,{variant:"body1",sx:{textTransform:"capitalize"},children:o.getContext().getValue()})}function G(r){const{table:o}=r;return t(ie,{checked:o.getIsAllRowsSelected(),indeterminate:o.getIsSomeRowsSelected(),onClick:o.getToggleAllRowsSelectedHandler()})}function W(r){const{row:o}=r;return t(ie,{checked:o.getIsSelected(),disabled:!o.getCanSelect(),indeterminate:o.getIsSomeSelected(),onClick:o.getToggleSelectedHandler()})}try{z.displayName="EntityHeaderNameCell",z.__docgenInfo={description:"",displayName:"EntityHeaderNameCell",props:{}}}catch{}try{j.displayName="EntityHeaderIDCell",j.__docgenInfo={description:"",displayName:"EntityHeaderIDCell",props:{}}}catch{}try{$.displayName="EntityHeaderTypeCell",$.__docgenInfo={description:"",displayName:"EntityHeaderTypeCell",props:{}}}catch{}try{G.displayName="CheckBoxHeader",G.__docgenInfo={description:"",displayName:"CheckBoxHeader",props:{}}}catch{}try{W.displayName="CheckBoxCell",W.__docgenInfo={description:"",displayName:"CheckBoxCell",props:{}}}catch{}const M=r=>d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:t("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),t("g",{mask:"url(#mask0_6722_37828)",children:t("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{M.displayName="AddAd",M.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function Oe(r,o,l){const[p,u]=a.useState({}),[s,h]=a.useState(ve(r)),[m,y]=a.useState(""),[A,V]=a.useState([]),b=a.useCallback(g=>{y(g),o&&o(g)},[o]),w=a.useCallback(g=>{u({}),h(g),l&&l(g),V([]),b("")},[l,b]);return{rowSelection:p,setRowSelection:u,refsInState:s,setRefsInState:w,newEntityIDs:m,setNewEntityIDs:b,parseErrors:A,setParseErrors:V}}const ze={selectMultiple:!0,versionSelection:He.DISALLOWED,initialScope:Ne.ALL_PROJECTS,initialContainer:"root"},je=10,re=r=>{const{references:o,isEditable:l,onUpdate:p=Ue,removeSelectedRowsButtonText:u="Remove Selected Rows",onUpdateEntityIDsTextbox:s,objectNameCopy:h="entity",hideTextFieldToPasteValue:m=!1,entityFinderConfiguration:y=ze}=r,[A,V]=a.useState([]),[b,w]=a.useState(!1),{rowSelection:g,setRowSelection:le,refsInState:C,setRefsInState:E,newEntityIDs:c,setNewEntityIDs:D,parseErrors:T,setParseErrors:R}=Oe(o,s,p),B=a.useCallback(n=>{R([`Invalid Synapse ID(s): ${n.join(",")}`])},[R]),P=a.useCallback(n=>{const e=n.map(i=>({targetId:i.trim()}));E([...C,...e])},[C,E]),se=a.useCallback(()=>{c?c.includes(",")?Fe.parse(c,{complete:n=>{if(n.errors.length>0){const e=n.errors.map(i=>i.message);R(e)}else{const e=n.data[0],i=e.filter(S=>!S.trim().match(te));i.length>0?B(i):P(e)}}}):c.trim().match(te)?P([c]):B([c]):(R([]),D(""))},[P,c,B,D,R]),x=Ae(Me(h)),Z=a.useMemo(()=>[{id:"select",header:G,cell:W}],[]),q=a.useMemo(()=>[{accessorFn:n=>n.name,id:"name",cell:z,header:"Name"},{accessorFn:n=>n.id,id:"id",cell:j,header:"SynID"},{accessorFn:n=>n.isDummy?"-":Ie(Se(n)),id:"type",header:"Type",cell:$,filterFn:"includesString"}],[]),de=a.useMemo(()=>l?Z.concat(q):q,[q,l,Z]),Y=Object.keys(g).length,{data:F,isSuccess:ce,isLoading:J}=xe(C,{useErrorBoundary:!0}),k=a.useMemo(()=>{const n=F?F==null?void 0:F.results:[],e=new Set;n.map(_=>e.add(_.id));const S=C.filter(_=>!e.has(_.targetId)).map(_=>({id:_.targetId,name:_.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return n.concat(S)},[C,F]),I=me({data:k,columns:de,state:{rowSelection:g,columnFilters:A},enableRowSelection:l,onRowSelectionChange:le,onColumnFiltersChange:V,getCoreRowModel:ye(),getFilteredRowModel:ge(),getSortedRowModel:fe(),getFacetedRowModel:he(),getFacetedUniqueValues:Ce(),getFacetedMinMaxValues:_e(),columnResizeMode:"onChange"}),pe=a.useCallback(()=>{const e=k.filter((i,S)=>g[S]!==!0).map(i=>({targetId:i.id}));E(e)},[k,g,E]),X=Y>0,H=k.length,K=I.getPrePaginationRowModel().rows.length,N=H>je;return a.useEffect(function(){N||I.setColumnFilters([])},[I,N]),J?t(Re,{numCols:3,numRows:Math.min(10,C.length)}):ce?d("div",{children:[d(f,{display:"flex",justifyContent:"space-between",p:"12px 10px 10px 5px",children:[N&&d(v,{variant:"body1",sx:{marginBottom:"10px"},children:[H," ",x," ",K<H?`(${K} visible)`:"",X&&t("span",{children:` (${Y} selected)`})]}),l&&C.length>0&&t(L,{variant:"contained",disabled:!X,onClick:pe,children:u})]}),t(f,{display:"flex",pb:2,children:I.getHeaderGroups().map(n=>n.headers.map(e=>e.isPlaceholder?null:t(oe.Fragment,{children:e.column.getCanFilter()&&N?t(f,{sx:{flexGrow:1},children:t(O,{column:e.column,table:I})}):null},e.column.id)))}),H>0&&t(f,{sx:n=>({overflow:"auto",maxHeight:"250px",paddingLeft:"2px",th:{height:"38px",backgroundColor:n.palette.grey[200],zIndex:100},"tr:nth-of-type(2n)":{backgroundColor:n.palette.grey[100]}}),children:d("table",{style:{borderCollapse:"collapse",width:"100%"},children:[t("thead",{children:I.getHeaderGroups().map(n=>t("tr",{children:n.headers.map(e=>{let i="5%";switch(e.id){case"name":i="50%";break;case"id":i="22%";break;case"type":i="22%";break}return d("th",{colSpan:e.colSpan,style:{width:i,position:"sticky",top:"0px"},children:[e.isPlaceholder?null:d(f,{display:"flex",alignItems:"center",children:[ee(e.column.columnDef.header,e.getContext()),t(f,{mx:"auto"}),e.column.getCanSort()&&t(ne,{onClick:e.column.getToggleSortingHandler(),size:"small",sx:{marginLeft:"auto",marginRight:"16px"},children:t(be,{icon:e.column.getIsSorted()==="asc"?"sortUp":"sortDown",wrap:!1,fontSize:"inherit",sx:{color:e.column.getIsSorted()?"primary.main":"grey.700",backgroundColor:"none"}})})]}),e.column.getCanResize()&&t("div",{className:`resizer ${e.column.getIsResizing()?"isResizing":""}`,onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler()})]},e.id)})},n.id))}),t("tbody",{children:I.getRowModel().rows.map(n=>t("tr",{style:{height:"30px"},children:n.getVisibleCells().map(e=>t("td",{style:{width:e.column.getSize()},children:ee(e.column.columnDef.cell,e.getContext())},e.id))},n.id))})]})}),t(ke,{configuration:y,promptCopy:`Select ${x} to add to the Synapse ID list`,show:b,title:`Select ${x}`,confirmButtonCopy:`Add ${x}`,onConfirm:n=>{if(m){const e=[...C,...n];E(e),p(e)}else{const e=n.map(_=>_.targetId),S=(c.trim().length>0?c.concat(","):c).concat(e.join(","));D(S)}w(!1)},onCancel:()=>w(!1)}),l&&d(f,{sx:{marginTop:"10px"},children:[m&&d(L,{variant:"outlined",onClick:()=>{w(!0)},startIcon:t(M,{}),children:["Add ",x]}),!m&&d(Q,{children:[t(Be,{htmlFor:"synIDs",children:"Add Synapse IDs"}),d(f,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[t(ae,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:n=>{D(n.target.value)},value:c,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')"}),t(f,{sx:{padding:"5px 0px 0px 5px"},children:t(Pe,{title:"Add a Synapse ID to the list via the Entity Finder",children:t(ne,{onClick:()=>{w(!0)},children:t(M,{})})})}),d(L,{variant:"outlined",onClick:se,disabled:J||c.trim().length==0,startIcon:t(Ee,{}),children:["Add ",x]})]})]}),T&&T.length>0&&d(qe,{severity:"error",sx:{my:2},children:[t(Le,{children:"Parsing errors encountered:"}),t("ul",{children:T.map((n,e)=>t(v,{component:T.length>1?"li":"span",lineHeight:1.5,variant:"smallText1",children:n},e))})]})]})]}):t(Q,{})};try{re.displayName="EntityHeaderTable",re.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((updatedRefs: ReferenceList) => void)"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"((value: string) => void)"}},objectNameCopy:{defaultValue:null,description:"",name:"objectNameCopy",required:!1,type:{name:"string"}},hideTextFieldToPasteValue:{defaultValue:null,description:"",name:"hideTextFieldToPasteValue",required:!1,type:{name:"boolean"}},entityFinderConfiguration:{defaultValue:null,description:"",name:"entityFinderConfiguration",required:!1,type:{name:'Omit<EntityFinderProps, "onSelectedChange">'}}}}}catch{}export{re as E};
