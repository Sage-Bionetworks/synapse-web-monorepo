{"version":3,"file":"useMutation-dd95c1dd.js","sources":["../../../../node_modules/.pnpm/react-query@3.39.3_react-dom@18.2.0_react@18.2.0/node_modules/react-query/es/core/mutationObserver.js","../../../../node_modules/.pnpm/react-query@3.39.3_react-dom@18.2.0_react@18.2.0/node_modules/react-query/es/react/useMutation.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport { getDefaultState } from './mutation';\nimport { notifyManager } from './notifyManager';\nimport { Subscribable } from './subscribable';\n// CLASS\nexport var MutationObserver = /*#__PURE__*/function (_Subscribable) {\n  _inheritsLoose(MutationObserver, _Subscribable);\n\n  function MutationObserver(client, options) {\n    var _this;\n\n    _this = _Subscribable.call(this) || this;\n    _this.client = client;\n\n    _this.setOptions(options);\n\n    _this.bindMethods();\n\n    _this.updateResult();\n\n    return _this;\n  }\n\n  var _proto = MutationObserver.prototype;\n\n  _proto.bindMethods = function bindMethods() {\n    this.mutate = this.mutate.bind(this);\n    this.reset = this.reset.bind(this);\n  };\n\n  _proto.setOptions = function setOptions(options) {\n    this.options = this.client.defaultMutationOptions(options);\n  };\n\n  _proto.onUnsubscribe = function onUnsubscribe() {\n    if (!this.listeners.length) {\n      var _this$currentMutation;\n\n      (_this$currentMutation = this.currentMutation) == null ? void 0 : _this$currentMutation.removeObserver(this);\n    }\n  };\n\n  _proto.onMutationUpdate = function onMutationUpdate(action) {\n    this.updateResult(); // Determine which callbacks to trigger\n\n    var notifyOptions = {\n      listeners: true\n    };\n\n    if (action.type === 'success') {\n      notifyOptions.onSuccess = true;\n    } else if (action.type === 'error') {\n      notifyOptions.onError = true;\n    }\n\n    this.notify(notifyOptions);\n  };\n\n  _proto.getCurrentResult = function getCurrentResult() {\n    return this.currentResult;\n  };\n\n  _proto.reset = function reset() {\n    this.currentMutation = undefined;\n    this.updateResult();\n    this.notify({\n      listeners: true\n    });\n  };\n\n  _proto.mutate = function mutate(variables, options) {\n    this.mutateOptions = options;\n\n    if (this.currentMutation) {\n      this.currentMutation.removeObserver(this);\n    }\n\n    this.currentMutation = this.client.getMutationCache().build(this.client, _extends({}, this.options, {\n      variables: typeof variables !== 'undefined' ? variables : this.options.variables\n    }));\n    this.currentMutation.addObserver(this);\n    return this.currentMutation.execute();\n  };\n\n  _proto.updateResult = function updateResult() {\n    var state = this.currentMutation ? this.currentMutation.state : getDefaultState();\n\n    var result = _extends({}, state, {\n      isLoading: state.status === 'loading',\n      isSuccess: state.status === 'success',\n      isError: state.status === 'error',\n      isIdle: state.status === 'idle',\n      mutate: this.mutate,\n      reset: this.reset\n    });\n\n    this.currentResult = result;\n  };\n\n  _proto.notify = function notify(options) {\n    var _this2 = this;\n\n    notifyManager.batch(function () {\n      // First trigger the mutate callbacks\n      if (_this2.mutateOptions) {\n        if (options.onSuccess) {\n          _this2.mutateOptions.onSuccess == null ? void 0 : _this2.mutateOptions.onSuccess(_this2.currentResult.data, _this2.currentResult.variables, _this2.currentResult.context);\n          _this2.mutateOptions.onSettled == null ? void 0 : _this2.mutateOptions.onSettled(_this2.currentResult.data, null, _this2.currentResult.variables, _this2.currentResult.context);\n        } else if (options.onError) {\n          _this2.mutateOptions.onError == null ? void 0 : _this2.mutateOptions.onError(_this2.currentResult.error, _this2.currentResult.variables, _this2.currentResult.context);\n          _this2.mutateOptions.onSettled == null ? void 0 : _this2.mutateOptions.onSettled(undefined, _this2.currentResult.error, _this2.currentResult.variables, _this2.currentResult.context);\n        }\n      } // Then trigger the listeners\n\n\n      if (options.listeners) {\n        _this2.listeners.forEach(function (listener) {\n          listener(_this2.currentResult);\n        });\n      }\n    });\n  };\n\n  return MutationObserver;\n}(Subscribable);","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React from 'react';\nimport { notifyManager } from '../core/notifyManager';\nimport { noop, parseMutationArgs } from '../core/utils';\nimport { MutationObserver } from '../core/mutationObserver';\nimport { useQueryClient } from './QueryClientProvider';\nimport { shouldThrowError } from './utils'; // HOOK\n\nexport function useMutation(arg1, arg2, arg3) {\n  var mountedRef = React.useRef(false);\n\n  var _React$useState = React.useState(0),\n      forceUpdate = _React$useState[1];\n\n  var options = parseMutationArgs(arg1, arg2, arg3);\n  var queryClient = useQueryClient();\n  var obsRef = React.useRef();\n\n  if (!obsRef.current) {\n    obsRef.current = new MutationObserver(queryClient, options);\n  } else {\n    obsRef.current.setOptions(options);\n  }\n\n  var currentResult = obsRef.current.getCurrentResult();\n  React.useEffect(function () {\n    mountedRef.current = true;\n    var unsubscribe = obsRef.current.subscribe(notifyManager.batchCalls(function () {\n      if (mountedRef.current) {\n        forceUpdate(function (x) {\n          return x + 1;\n        });\n      }\n    }));\n    return function () {\n      mountedRef.current = false;\n      unsubscribe();\n    };\n  }, []);\n  var mutate = React.useCallback(function (variables, mutateOptions) {\n    obsRef.current.mutate(variables, mutateOptions).catch(noop);\n  }, []);\n\n  if (currentResult.error && shouldThrowError(undefined, obsRef.current.options.useErrorBoundary, [currentResult.error])) {\n    throw currentResult.error;\n  }\n\n  return _extends({}, currentResult, {\n    mutate: mutate,\n    mutateAsync: currentResult.mutate\n  });\n}"],"names":["MutationObserver","_Subscribable","_inheritsLoose","client","options","_this","_proto","_this$currentMutation","action","notifyOptions","variables","_extends","state","getDefaultState","result","_this2","notifyManager","listener","Subscribable","useMutation","arg1","arg2","arg3","mountedRef","React","_React$useState","forceUpdate","parseMutationArgs","queryClient","useQueryClient","obsRef","currentResult","unsubscribe","x","mutate","mutateOptions","noop","shouldThrowError"],"mappings":"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","x_google_ignoreList":[0,1]}