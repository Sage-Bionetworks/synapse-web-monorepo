import{r as A}from"./index-Cu9bd8lq.js";import{u as G}from"./useQueries-CXm_8CG9.js";import{u as m}from"./useQuery-BEUP4ZKU.js";import{bl as w,bm as I,bn as h,l as a,S as o,bo as L}from"./useFiles-CtkjCMBr.js";import{u as d}from"./utils-BECe8vEQ.js";import{u as E}from"./useMutation-BUHlmdy0.js";import{u as p}from"./useInfiniteQuery-D5MQ6_Ek.js";import{q as M}from"./RegularExpressions-vjpKT7U4.js";import{a as C}from"./isArray-ggc3KxVp.js";import{i as Q}from"./_baseTimes-36S_kd0L.js";import{i as T,o as K}from"./omitBy-CbRW8hgL.js";import"./OrientationBanner-CHSjXMjA.js";import{i as F}from"./QueryFilterUtils-ZUN-EXhd.js";import{g as B}from"./InfiniteQueryUtils-CKlRW-xB.js";import{z as k}from"./index-BNbykmw2.js";import"./jsx-runtime-DoxjgJx5.js";import{p as D}from"./pick-T3sTJ-VZ.js";import{o as v}from"./omit-mADO6BNz.js";const P=(e,n)=>{if(!(C(e)||C(n))&&!(!Q(e)||!Q(n))&&!(!T(e,void 0)&&!T(n,void 0)))return w(K(e,s=>s===void 0),K(n,s=>s===void 0),P)};function O(e,n){return w(e,n,P)}function J(e,n){const s=new Set;for(const u of e)s.add(u.id);for(const u of n)if(u.id!=null&&!s.has(u.id))throw new Error(`Proposed schema contains a new column model with ID ${u.id} that is not in the old schema.`)}async function U(e,n,s,u){J(s,u);const t=new Map;for(const l of s)t.set(l.id,l);let r=[];for(const l of u){const y={...l};if(y.id!=null){const g=t.get(y.id);g!=null&&!O(g,y)&&delete y.id}r.push(y)}const c=(await I(e,r)).list,i=[],f=new Set;for(let l=0;l<u.length;l++){const y=u[l].id??null,g=c[l].id;y!=null&&f.add(y),f.add(g),y!=null&&y!==g?i.push({oldColumnId:y,newColumnId:g}):y==null&&i.push({oldColumnId:null,newColumnId:g})}for(const l of s){const y=l.id;f.has(y)||i.push({oldColumnId:y,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:n,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:n,changes:i,orderedColumnIds:c.map(l=>l.id)}]}}function q(e,n,s=k){const{accessToken:u,keyFactory:t}=a();return{queryKey:t.getEntityBundleQueryKey(e,n,s),queryFn:()=>o.getEntityBundleV2(e,s,n,u)}}function oe(e,n,s=k,u){const t=q(e,n,s);return m({...u,...t})}function ie(e,n,s=k,u){const t=q(e,n,s);return h({...u,...t})}function V(){const{keyFactory:e,accessToken:n}=a();return(s,u)=>({queryKey:e.getEntityVersionQueryKey(s,u),queryFn:()=>o.getEntity(n,s,u==null?void 0:u.toString())})}function ye(e,n,s){const u=V();return m({...s,...u(e,n)})}function le(e,n){const{accessToken:s,keyFactory:u}=a(),t=A.useMemo(()=>({queries:e.map(r=>({queryKey:u.getEntityVersionQueryKey(r.id,r.versionNumber),queryFn:()=>o.getEntity(s,r.id,r.versionNumber),options:n}))}),[s,e,u,n]);return G(t)}function fe(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({mutationFn:t=>o.createEntity(t,s),onSuccess:async(t,r,c)=>{const i=u.getEntityQueryKey(t.id);n.setQueryData(i,t),n.setQueryData(u.getEntityLookupQueryKey({parentId:t.parentId,entityName:t.name}),t.id),await F(n,u,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function me(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.updateEntity(t,s),onSuccess:async(t,r,c)=>{const i=u.getEntityQueryKey(t.id);n.setQueryData(i,t),await F(n,u,t.id,i),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function de(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.deleteEntity(s,t),onSuccess:async(t,r,c)=>{await F(n,u,r),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function Ee(e,n){const{accessToken:u,keyFactory:t}=a();return p({...n,queryKey:t.getEntityVersionsQueryKey(e),queryFn:async r=>await o.getEntityVersions(e,u,r.pageParam,200),initialPageParam:void 0,getNextPageParam:B})}function b(e){return D(e,M[e.concreteType])}function x(e){return v(e,M[e.concreteType])}function ge(e,n,s,u){const{accessToken:t,keyFactory:r}=a();return m({...u,queryKey:r.getEntityJsonQueryKey(e,n,s),queryFn:()=>o.getEntityJson(e,n,s,t),select:c=>{const i=b(c),f=x(c);return{entity:c,entityMetadata:i,annotations:f}}})}function Fe(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>{const r=t.id;return o.updateEntityJson(r,t,s)},onSuccess:async(t,r,c)=>{const i=t.id,f=u.getEntityJsonQueryKey(i,void 0,!1);n.setQueryData(f,t),await F(n,u,i,f),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function ke(e,n){const{accessToken:s,keyFactory:u}=a();return m({...n,queryKey:u.getEntityPathQueryKey(e),queryFn:()=>o.getEntityPath(e,s)})}function qe(e,n){const{accessToken:s,keyFactory:u}=a();return m({...n,queryKey:u.getEntityPathQueryKey(e),queryFn:()=>o.getEntityACL(e,s)})}function Se(e,n){const{accessToken:s,keyFactory:u}=a();return m({...n,queryKey:u.getEntityAliasQueryKey(e),queryFn:()=>o.getEntityAlias(e,s)})}function Ce(e,n,s){const{accessToken:u,keyFactory:t}=a();return m({...s,queryKey:t.getEntityEvaluationsQueryKey(e),queryFn:()=>o.getAllEntityEvaluations(e,n,u)})}function Qe(e,n){const{accessToken:s,keyFactory:u}=a();return m({...n,queryKey:u.getEntityPermissionsQueryKey(e),queryFn:()=>o.getEntityPermissions(e,s)})}const S=async(e,n,s,u)=>{const t=u.getEntityACLQueryKey(e);n&&s.setQueryData(t,n),await F(s,u,e,t)};function Te(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.createEntityACL(t,s),onSuccess:async(t,r,c)=>{await S(t.id,t,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function Ke(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.updateEntityACL(t,s),onSuccess:async(t,r,c)=>{await S(t.id,t,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function we(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:t=>o.deleteEntityACL(t,s),onSuccess:async(t,r,c)=>{await S(r,null,n,u),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function R(e){return{...q(e,void 0,{includeBenefactorACL:!0}),select:s=>s.benefactorAcl}}function he(e,n){const s=R(e);return h({...n,...s})}function Me(e){const n=d(),{accessToken:s,keyFactory:u}=a();return E({...e,mutationFn:async t=>{const r=await U(s,t.entityId,t.originalColumnModels,t.newColumnModels);return o.updateTable(r,s)},onSuccess:async(t,r,c)=>{await F(n,u,r.entityId),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function Pe(){const{keyFactory:e,synapseClient:n}=a();return s=>({queryKey:e.getEntityLookupQueryKey(s),queryFn:async()=>{var u;return((u=await L(()=>n.entityServicesClient.postRepoV1EntityChild({entityLookupRequest:s})))==null?void 0:u.id)??null}})}export{ye as a,me as b,Me as c,ke as d,ge as e,de as f,le as g,Ce as h,Ke as i,Se as j,qe as k,Qe as l,fe as m,Fe as n,Ee as o,Pe as p,V as q,ie as r,he as s,Te as t,oe as u,we as v};
