import{j as a,a as m,F as q}from"./jsx-runtime-ad672792.js";import{ag as $e,aN as Xe,aH as He,ah as et,aj as tt,aT as at,aY as nt}from"./SynapseContext-d9d41f69.js";import{r as p,R as ke}from"./index-f1f749bf.js";import{i as rt,r as lt,h as st,a as Oe}from"./queryUtils-2a5692a0.js";import{u as ze,a as Ye,b as ot}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as it}from"./NoSearchResults-79eea014.js";import{s as ct}from"./NoData-80d05b97.js";import{u as ut}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-5116adf5.js";import{p as dt,q as mt,o as pt,i as ht,j as yt,n as ft,V as W,J as ce,x as gt,y as _t,w as Ct}from"./SynapseConstants-9d1f6e44.js";import{u as Ft}from"./useEntity-a144a0c2.js";import{b as Nt}from"./useGetQueryResultBundle-e8c55a35.js";import{p as St,a as bt}from"./sqlFunctions-838d033f.js";import{i as _e,a as Ce,c as vt}from"./QueryFilter-4b31080c.js";import{c as pe}from"./cloneDeep-de653b9f.js";import{i as Z}from"./isEqual-fb1c71a1.js";import{E as ne}from"./ElementWithTooltip-739b3ae0.js";import{u as he}from"./useGetInfoFromIds-c6504d1e.js";import{I as Y,a as Et}from"./IconSvg-44530777.js";import{C as We}from"./Checkbox-9c5dca81.js";import{D as A}from"./Dropdown-cc33f611.js";import{R as wt}from"./RadioGroup-2b4593e6.js";import{d as Qe}from"./dayjs.min-e0adaab4.js";import{R as Tt}from"./RangeSlider-cf7db10e.js";import{B as ye}from"./Box-2e3c1244.js";import{S as te}from"./Skeleton-cff63b1c.js";import{S as xt}from"./Stack-e5639b81.js";import{c as Vt,P as It}from"./factory-76e91d33.js";import{r as Rt}from"./react-sizeme-2217af01.js";import{g as kt}from"./ColorGradient-3d3e1969.js";import{l as qt}from"./LoadingScreen-ded2c742.js";import{M as X}from"./Modal-6ffa84ac.js";import{B as Ge}from"./Button-7d415009.js";import{a as Qt}from"./Clear-a9f76abf.js";import{S as Lt}from"./SelectionCriteriaPill-a97a5882.js";const Pt="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",At="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Fe=$e(Pt),Dt=$e(At),re=e=>a(te,{style:{...e.style,display:"inline-block"},...e});try{re.displayName="SkeletonInlineBlock",re.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rounded"'},{value:'"rectangular"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const $=p.createContext(void 0),Ne=({children:e,queryContext:t})=>a($.Provider,{value:t,children:e});function U(){const e=p.useContext($);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function tn(){const e=p.useContext($);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function an(){const e=p.useContext($);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Le=$.Consumer;try{$.displayName="QueryContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{Ne.displayName="QueryContextProvider",Ne.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{Le.displayName="QueryContextConsumer",Le.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function je(e,t){return`${e}${t}`}function Ut(e,t){const n=window.location.search,r=`${e}=${t}`;return n?n.includes(`${e}=`)?window.location.search.slice(n.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${r}`:o).join("&"):`${n.substr(1)}&${r}`:r}function Mt(e,t){if(!window.location.search)return;const n=je(e,t),l=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===n).map(s=>s.split("=")[1])[0];return l?decodeURIComponent(l):void 0}function Bt(e,t,n){const r=t!==void 0?je(e,t):e,l=Ut(r,n),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${l}`;window.history.replaceState("object or string","Title",o)}function $t(e,t){const n=Mt(e,t);let r;if(n){const l=JSON.parse(n);l.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:dt|mt|pt|ht|yt,entityId:St(l.sql),query:l})}return r}function Ht(e){const{initQueryRequest:t,componentIndex:n=0,shouldDeepLink:r=!1,onQueryChange:l}=e,[s,o]=p.useState(t);p.useEffect(()=>{const f=$t("QueryWrapper",n);f&&o(f)},[n]);const c=p.useCallback(()=>pe(s),[s]),d=p.useCallback(()=>pe(t),[t]),i=p.useCallback(f=>{let F;typeof f=="function"?F=f(c()):F=f;const V=pe(F);if(o(V),V.query){const S=JSON.stringify(V.query);if(r){const L=encodeURIComponent(S);Bt("QueryWrapper",n,L)}l&&l(S)}},[n,c,l,r]),{entityId:g,versionNumber:T}=p.useMemo(()=>bt(s.query.sql),[s.query.sql]),_=s.query.limit??ft,I=Math.ceil(((s.query.offset??0)+Number(_))/_),u=p.useCallback(f=>{i(F=>(F.query.limit=f,F))},[i]),C=p.useCallback(f=>{i(F=>(F.query.offset=(f-1)*_,F))},[_,i]),h=p.useCallback(()=>{i(t)},[t,i]);ze(()=>{s!=t&&h()},[t]);const w=p.useCallback(f=>{i(F=>(F.query.selectedFacets=(F.query.selectedFacets??[]).filter(V=>!Z(V,f)),F))},[i]),y=p.useCallback((f,F)=>{i(V=>(V.query.selectedFacets=(V.query.selectedFacets??[]).map(S=>(Fe(S)&&Z(S,f)&&(S.facetValues=S.facetValues.filter(L=>L!==F)),S)).filter(S=>Fe(S)?Array.isArray(S.facetValues)&&S.facetValues.length>0:!0),V))},[i]),x=p.useCallback(f=>{i(F=>(F.query.additionalFilters=(F.query.additionalFilters??[]).filter(V=>!Z(V,f)),F))},[i]),N=p.useCallback((f,F)=>{i(V=>(V.query.additionalFilters=(V.query.additionalFilters??[]).map(S=>((_e(S)||Ce(S))&&Z(S,f)&&(S.values=S.values.filter(L=>L!==F)),S)).filter(S=>_e(S)||Ce(S)?Array.isArray(S.values)&&S.values.length>0:!0),V))},[i]);return{entityId:g,versionNumber:T,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:_,currentPage:I,setPageSize:u,goToPage:C,resetQuery:h,removeSelectedFacet:w,removeValueFromSelectedFacet:y,removeQueryFilter:x,removeValueFromQueryFilter:N}}const ue="isShowingFacetFilters",de="isHidingFacetFilters";function Pe(e){const{initQueryRequest:t,onQueryChange:n,onQueryResultBundleChange:r,lockedColumn:l,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:g,getInitQueryRequest:T,getLastQueryRequest:_,setQuery:I,currentPage:u,pageSize:C,goToPage:h,setPageSize:w,resetQuery:y,removeSelectedFacet:x,removeValueFromSelectedFacet:N,removeQueryFilter:f,removeValueFromQueryFilter:F}=Ht({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:n}),V=p.useMemo(()=>_(),[_]),{data:S,isLoading:L,error:v,isPreviousData:R}=Nt(V,{keepPreviousData:!0},d),b=S==null?void 0:S.responseBody,k=L||R,{data:P}=Ft(i,g);Ye(()=>{b&&r&&r(JSON.stringify(b))},[b,r]);const J=b?rt(b.facets,b.selectColumns):!0,B=p.useMemo(()=>lt(b,l),[b,l]),z=p.useMemo(()=>{const O=_();return st(O.query,l)},[_,l]),K=p.useCallback(O=>{var me;return((me=b==null?void 0:b.columnModels)==null?void 0:me.find(Ze=>Ze.name===O))??null},[b==null?void 0:b.columnModels]),E={data:B,currentPage:u,pageSize:C,setPageSize:w,isLoadingNewBundle:k,getLastQueryRequest:_,getInitQueryRequest:T,error:v,entity:P,executeQueryRequest:I,isFacetsAvailable:J,asyncJobStatus:c,goToPage:h,hasResettableFilters:z,removeSelectedFacet:x,removeValueFromSelectedFacet:N,resetQuery:y,removeQueryFilter:f,removeValueFromQueryFilter:F,lockedColumn:l,getColumnModel:K},{children:D}=e;return a(Ne,{queryContext:E,children:a("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${J?"has-facets":""}`,children:D})})}try{Pe.displayName="QueryWrapper",Pe.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function Ot(){return m(q,{children:[a("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),a("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ae=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ae||{});function zt(){return m("div",{className:"text-center",children:[it,a("h4",{children:"No Matching Results"}),a("p",{children:"Try checking the spelling or removing filters."})]})}function Yt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ct,a("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Wt=()=>{try{return JSON.parse(sessionStorage.getItem(gt)||"")}catch{return[]}},Gt=()=>{try{return JSON.parse(sessionStorage.getItem(_t)||"")}catch{return[]}},jt=()=>{try{return JSON.parse(sessionStorage.getItem(Ct)||"")}catch{return[]}},Jt=e=>{const t=Wt().find(n=>n.id===e);return(t==null?void 0:t.name)??e},Kt=e=>{const t=jt().find(n=>n.id===e);return(t==null?void 0:t.name)||e},Zt=e=>{const t=Gt().find(n=>n.ownerId===e);return(t==null?void 0:t.userName)||e},Xt=(e,t)=>{if(e===W)return ce;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return Jt(e);case Q.USERID:case Q.USERID_LIST:return Zt(e);case Q.EVALUATIONID:return Kt(e);default:return e}},G=p.createContext(void 0),Se=({children:e,queryVisualizationContext:t})=>a(G.Provider,{value:t,children:e});function M(){const e=p.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Ae=G.Consumer;function De(e){const{noContentPlaceholderType:t=ae.INTERACTIVE}=e,{data:n,getLastQueryRequest:r,isFacetsAvailable:l,isLoadingNewBundle:s,hasResettableFilters:o}=U(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{l||i(N=>({...N,showFacetFilter:!1,showFacetVisualization:!1}))},[l]),p.useEffect(()=>{s&&I([])},[s]);const[g,T]=p.useState([]),[_,I]=p.useState([]),u=r(),C=ot(n==null?void 0:n.selectColumns);p.useEffect(()=>{T((C==null?void 0:C.slice(0,e.visibleColumnCount??1/0).map(N=>N.name))??[])},[C,u.query.sql,e.visibleColumnCount]);const h=p.useCallback(N=>{const f=localStorage.getItem("force-display-original-column-names")==="true";return!N||f?N:c[N]?c[N]:ut(N)},[c]),w=p.useCallback(()=>{switch(t){case ae.INTERACTIVE:return o?a(zt,{}):a(Yt,{});case ae.STATIC:default:return a(Ot,{})}},[t,o]),y={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:g,setColumnsToShowInTable:T,selectedRowIndices:_,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:h,getDisplayValue:Xt,NoContentPlaceholder:w},{children:x}=e;return a(Se,{queryVisualizationContext:y,children:x})}try{De.displayName="QueryVisualizationWrapper",De.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{Se.displayName="QueryVisualizationContextProvider",Se.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{Ae.displayName="QueryVisualizationContextConsumer",Ae.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const Ue=()=>{const{error:e}=U();return a(Xe,{error:e})};try{Ue.displayName="QueryWrapperErrorBanner",Ue.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const be=e=>m("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{be.displayName="IconPlus",be.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const ve=e=>m("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{ve.displayName="IconMinus",ve.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const le=({label:e,isCollapsed:t,onClick:n})=>{const{getColumnDisplayName:r}=M();return m("div",{className:"FacetFilterHeader",children:[a("label",{className:"FacetFilterHeader__label",children:r(e)}),a("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>n(!t),children:t?a(be,{className:"icon-plus",title:"Expand Menu"}):a(ve,{className:"icon-minus",title:"Collapse Menu"})})]})};try{le.displayName="FacetFilterHeader",le.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function ea(e){return e.replace(/\s/g,"").toLowerCase()}function Me(e,t=[],n=[],r=[]){const{value:l}=e;let s=l;l===W&&(s=ce);const o=t.find(i=>i.ownerId===l);o&&(s=o?o.userName:`unknown (${l})`);const c=n.find(i=>i.id===l);c&&(s=c?c.name:`unknown (${l})`);const d=r.find(i=>i.id===l);return d!=null&&d.name&&(s=d.name),`${s}`}function ta(e,t,n){const r=[...e.sort((l,s)=>s.count-l.count)];return t||r.length<=n||r.slice(n).find(l=>l.isSelected)?r:r.splice(0,n)}const j=({facetValues:e,columnModel:t,onClear:n,onChange:r,containerAs:l="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,g]=p.useState(o),[T,_]=p.useState(!1),[I,u]=p.useState(!1),[C,h]=p.useState(""),[w,y]=p.useState(e);ze(()=>{y(e)},[e]);const x=5,N=1500,f=ke.createRef(),F={};let V;const S=e.filter(E=>E.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(E=>E.value):[],v=he({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(E=>E.value):[],b=he({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(E=>E.value):[],P=he({ids:k,type:"EVALUATION_QUEUE"}),J=E=>{const D=E.target.value;if(h(D),d(!0),!D)e.forEach(H=>{H.isSelected=!1}),y(e);else{const H=e.filter(O=>Me(O,v,b,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?O:null);y(H)}};if(!t)return a(q,{});const B=l==="Dropdown",z=m("div",{className:B?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[a("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{y(e),u(!1),d(!1)},children:a("span",{className:"EnumFacetFilter__previous",children:a(Y,{icon:"arrowBack"})})}),C.length>0&&a("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var E;h(""),(E=f.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__reset",children:a(Y,{icon:"close"})})}),a("input",{type:"text",placeholder:"Find values",value:C,ref:f,onChange:E=>{J(E)}})]}),!I&&m("div",{className:"EnumFacetFilter__checkAll",children:[a(We,{className:"EnumFacetFilter__checkbox",onChange:()=>{n()},checked:S,label:"All",isSelectAll:!0},"select_all"),a("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var E;h(""),u(!0),(E=f.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__searchicon",children:a(Y,{icon:"search"})})})]})]}),m("div",{children:[w.length>0&&ta(w,c||B,x).map((E,D)=>a(aa,{id:ea(E.value),index:D,label:Me(E,v,b,P),count:E.count,isDropdown:B,initialIsSelected:E.isSelected,onChange:H=>{F[E.value]=H,clearTimeout(V),V=setTimeout(()=>{r(F),_(!1)},N)}},`checkLabel${D}`)),!B&&m(q,{children:[!c&&w.length>x&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",w.length,")"]})})}),c&&w.length>x&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:a("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),w.length<=0&&a("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),K=()=>_(!T);return B?s==="SelectBox"?m(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:T,onToggle:K,children:[m(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[S&&"All",!S&&e.filter(E=>E.isSelected).length===1&&e.filter(E=>E.isSelected)[0].value,!S&&e.filter(E=>E.isSelected).length>1&&"Multiple Values Selected"]}),a(A.Menu,{children:z})]}):m(A,{className:"EnumFacetFilter",show:T,onToggle:K,children:[a(ne,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),a(A.Menu,{children:z})]}):m(q,{children:[a(le,{isCollapsed:i,label:t.name,onClick:E=>g(E)}),a(He,{className:"EnumFacetFilter",in:!i,children:z})]})};function aa({id:e,index:t,label:n,count:r,isDropdown:l,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return ke.useEffect(()=>{d(s)},[s]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{l&&(d(!c),o(!c))},children:[a(We,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:n},`${e}-${t}`),l&&m("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!l&&a("div",{className:"EnumFacetFilter__count",children:r})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Ee=({facet:e,isChecked:t,onClick:n})=>{const{getColumnDisplayName:r}=M();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:n,children:[r(e.columnName),a(Y,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{Ee.displayName="FacetChip",Ee.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const we=e=>{const t="Min value should be less then max value",[n,r]=p.useState(!1),[l,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Qe(e.initialValues.min).format("YYYY-MM-DD"),max:Qe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:g},T="number")=>{if(i==null||g===null||g===void 0)return r(!1),!0;if(T==="number"){if(Number(i)>Number(g))return r(!0),!1}else if(Date.parse(i)>Date.parse(g))return r(!0),!1;return r(!1),!0},d=(i,g,T="number")=>{c(i,T)&&g(i)};return m("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[a("input",{"aria-label":"min",type:e.type,value:l.min,onChange:({target:i})=>s({min:i.value,max:l.max})},"range_min"),a("div",{children:"to"}),a("input",{"aria-label":"max",type:e.type,value:l.max,onChange:({target:i})=>s({min:l.min,max:i.value})},"range_max")]}),a("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(l,e.onChange,e.type),children:"Apply"}),n&&a("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{we.displayName="Range",we.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const Te=({facetResult:e,columnModel:t,onChange:n,collapsed:r=!1})=>{const[l,s]=p.useState(r),o=[{label:ce,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:g}=e;const T=!i&&!g;i=i||c,g=g||d;const _=t.columnType==="DOUBLE"?"number":"date",I=(y,x)=>x?"":y===W?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",u=(y,x)=>{h(y),y!=="RANGE"&&x([y,y])},[C,h]=p.useState(I(i,T));return m("div",{children:[a(le,{isCollapsed:l,label:t.name,onClick:y=>s(y)}),m(He,{in:!l,children:[a(wt,{value:C,id:"rangeSelector",options:o,onChange:y=>u(y,n)}),C==="RANGE"&&(c===d?a("label",{children:d}):m(q,{children:[t.columnType==="INTEGER"&&m(Tt,{domain:[c,d],initialValues:{min:i,max:g},step:1,doUpdateOnApply:!0,onChange:y=>n([y.min,y.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&a(we,{initialValues:{min:i,max:g},type:_,onChange:y=>n([y.min,y.max])},"Range")]}))]})]})};try{Te.displayName="RangeFacetFilter",Te.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Je=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),na=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},qe=(e,t)=>{var s;const n=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],r=n.findIndex(o=>o.columnName===e.columnName),l=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?l?n.splice(r,1):n[r]=e:n.push(e),n};function se(e,t,n,r,l=!1){r?t.facetValues.forEach(c=>{c.value===r&&(c.isSelected=l)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=Je(t),o=qe(s,e);n(o)}const xe=(e,t,n,r)=>{const l=r&&Object.keys(r)||[];l.length&&t.facetValues.forEach(c=>{l.includes(c.value)&&(c.isSelected=r?!!r[c.value]:!1)});const s=Je(t),o=qe(s,e);n(o)},ra=(e,t,n,r)=>{t.columnMin=r[0],t.columnMax=r[1];const l=na(t),s=qe(l,e);n(s)};function oe(e,t){const n=(t??[]).map(r=>r.columnName);return new Set([...e.slice(0,3).map(r=>r.columnName),...n])}function ee(){const e=m(xt,{direction:"row",gap:"10px",sx:{my:1},children:[a(te,{width:"15px"}),a(te,{width:"40%"})]});return m(ye,{className:"FacetFilterControls__facet",children:[a(ye,{className:"FacetFilterHeader",children:a(te,{width:"100%"})}),m(ye,{children:[e,e,e]})]})}function la(){const{topLevelControlsState:e}=M(),{showFacetFilter:t}=e;return m("div",{className:`FacetFilterControls ${t?ue:de}`,children:[a(ee,{}),a(ee,{}),a(ee,{}),a(ee,{})]})}function Ve(e){const{availableFacets:t}=e,{data:n,getLastQueryRequest:r,executeQueryRequest:l}=U(),s=r(),o=n.facets.filter(u=>t==null||t.includes(u.columnName)).filter(u=>!Oe(u)),[c,d]=ke.useState(oe(o,s.query.selectedFacets)),{topLevelControlsState:i}=M(),{showFacetFilter:g}=i;Ye(()=>{d(oe(o,s.query.selectedFacets))},[o]);const T=n.selectColumns,_=u=>{const C=r();C.query.selectedFacets=u,C.query.offset=0,l(C)},I=u=>{const C=new Set(c);C.has(u.columnName)?C.delete(u.columnName):C.add(u.columnName),d(C)};return m("div",{className:`FacetFilterControls ${g?ue:de}`,children:[(o??[]).filter(u=>c.has(u.columnName)).map(u=>{const C=T.find(h=>h.name===u.columnName);return m("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&C&&a(j,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:C,onChange:h=>xe(s,u,_,h),onClear:()=>se(s,u,_)}),u.facetType==="range"&&C&&a(Te,{facetResult:u,columnModel:C,collapsed:!1,onChange:h=>ra(s,u,_,h)})]},u.columnName)}),m("div",{children:[a("div",{className:"AvailableFacet",children:a("label",{className:"AvailableFacet__label",children:"Available Facets"})}),o.map(u=>a(Ee,{facet:u,onClick:()=>I(u),isChecked:c.has(u.columnName)},u.columnName))]})]})}function nn(e){const{data:t,isLoadingNewBundle:n}=U();return n?a(la,{}):t==null||t.facets==null?a(q,{}):a(Ve,{...e})}try{oe.displayName="getDefaultShownFacetFilters",oe.__docgenInfo={description:`Determines which facet filters should be shown after loading a new bundle. The shown facets will be the first
three available facets, plus any other facets that have a filter applied.`,displayName:"getDefaultShownFacetFilters",props:{}}}catch{}try{Ve.displayName="FacetFilterControls",Ve.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{availableFacets:{defaultValue:null,description:"",name:"availableFacets",required:!1,type:{name:"string[]"}}}}}catch{}const sa=Vt(It),oa=19,ia=30,ca={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},ua=(e,t)=>{t=t||0;let n=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let r=0;r<t;r++)n.indexOf(".")!==-1&&(n=n.replace("0%","%"),n=n.replace(".%","%"));return n};function Ke(e,t){if(!e)return e;const n=e.trim();return n.length>t?n.substr(0,t-1)+"â€¦":e}async function da(e,t,n,r,l){var u,C;const{colorPalette:s}=kt(n,e.facetValues.length),o=async(h,w,y)=>{const x=new Map;x.set(W,ce);const N=h.map(f=>f.value).filter(f=>f!==W);if(w===Q.ENTITYID||w===Q.ENTITYID_LIST){const f=await at(N,y);for(const F of f.results)x.set(F.id,F.name)}else if(w===Q.USERID||w===Q.USERID_LIST){const f=await nt(N,y);for(const F of f.children)x.set(F.ownerId,F.userName)}return h.map(f=>({facet:f,label:c(f,!1,x),truncatedLabel:c(f,!0,x),count:f.count}))},c=(h,w,y)=>{let x=y.get(h.value)??h.value;return w&&(x=Ke(x,oa)),x},d=await o(e.facetValues,t,l),i=d.map(h=>h.truncatedLabel),T=e.facetValues.some(h=>h.isSelected)?e.facetValues.map((h,w)=>h.isSelected?s[w]:s[w].replace("rgb(","rgba(").replace(")",", 0.25)")):s,_={values:r==="PIE"?e.facetValues.map(h=>h.count):void 0,labels:d.map(h=>h.label),text:i,x:r==="BAR"?e.facetValues.map(h=>{var w;return((w=d.find(y=>y.facet===h))==null?void 0:w.label)??h.value}):void 0,y:r==="BAR"?e.facetValues.map(h=>h.count):void 0,facetEnumerationValues:e.facetValues.map(h=>h.value),name:e.columnName,hovertemplate:r==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:r==="PIE"?"pie":"bar",pull:r==="PIE"?e.facetValues.map(h=>h.isSelected?.1:0):void 0,marker:{colors:r==="PIE"?T:void 0,color:r==="BAR"?T:void 0}};return{data:[_],labels:d,colors:r==="PIE"?(u=_.marker)==null?void 0:u.colors:(C=_.marker)==null?void 0:C.color}}const ma=(e,t,n)=>{if(e.points&&e.points[0]){const r=e.points[0],l=r.data.facetEnumerationValues[r.pointNumber],s=t.facetValues.find(o=>o.value===l);n(t,s,!s.isSelected)}};function pa(e,t,n){const l=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?l:l/3;return s>n&&(s=n),{width:`${l}px`,height:`${s}px`}}function Ie(e){const{labels:t,colors:n=[],isExpanded:r}=e;if(!t)return a(q,{});const l=r?Math.min(t.length,9):Math.min(t.length,3);if(l===0)return a(q,{});const s=t.reduce((o,c)=>o+c.count,0);return a("div",{className:`FacetNavPanel__body__legend${r?"--expanded":""}`,children:t.slice(0,l).map((o,c)=>{const i=`(${ua(o.count/s,1)}) ${o.label}`,g=Ke(i,ia);return a(ne,{tooltipText:o.label,children:m("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[a("div",{style:{backgroundColor:n[c]}}),a("label",{children:g})]},`legendLabel_${c}`)},o.label)})})}const ha=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",ie=e=>{const{onHide:t,isModalView:n,applyChangesToFacetFilter:r,applyChangesToGraphSlice:l,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=et(),{data:g,isLoadingNewBundle:T,getLastQueryRequest:_}=U(),{getColumnDisplayName:I}=M(),[u,C]=p.useState(!1),h=I(o.columnName),w=p.useCallback(()=>{var N,f;return(f=(N=g==null?void 0:g.columnModels)==null?void 0:N.find(F=>F.name===o.columnName))==null?void 0:f.columnType},[g,o.columnName]),{data:y}=tt(["extractPlotDataArray",o,w(),s,c,i],()=>da(o,w(),s,c,i),{enabled:!!o}),x=()=>m("div",{onClick:N=>{N.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(A,{children:[a(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(A.Menu,{className:"chart-tools",children:[a(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),a(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!g&&T||!o?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:qt}):m(q,{children:[m(X,{animation:!1,show:u,onHide:()=>C(!1),backdrop:"static",children:[a(X.Header,{closeButton:!0,children:a(X.Title,{children:h??""})}),m(X.Body,{children:[a(ie,{...e,isModalView:!0}),a("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:a(Ge,{variant:"secondary",className:"SaveFiltersButton",onClick:()=>C(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${n?"--expanded":""}`,children:[!n&&m("div",{className:"FacetNavPanel__title",children:[!g&&T?a(re,{width:100}):a("span",{className:"FacetNavPanel__title__name",children:h}),m("div",{className:"FacetNavPanel__title__tools",children:[a(j,{facetValues:o.facetValues,columnModel:g==null?void 0:g.columnModels.find(N=>N.name===o.columnName),onChange:N=>{xe(_(),o,r,N)},onClear:()=>{se(_(),o,r)},containerAs:"Dropdown"}),a(ne,{tooltipText:"Expand to large graph",callbackFn:()=>C(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),a(ne,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),n&&m(q,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),a(j,{facetValues:o.facetValues,columnModel:g==null?void 0:g.columnModels.find(N=>N.name===o.columnName),onChange:N=>{xe(_(),o,r,N)},onClear:()=>{se(_(),o,r)},containerAs:"Dropdown",dropdownType:"SelectBox"}),a(Qt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:a(Et,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),a(x,{})]}),m("div",{className:`FacetNavPanel__body${n?"--expanded":""}`,role:"graphics-object",children:[a(Rt.SizeMe,{monitorHeight:!0,children:({size:N})=>a("div",{className:ha(n,c),children:a(sa,{layout:ca,data:(y==null?void 0:y.data)??[],style:pa(N.width,c,n?300:150),config:{displayModeBar:!1},onClick:f=>ma(f,o,l)},`${o.columnName}-${c}-${N.width}`)})}),a(Ie,{labels:y==null?void 0:y.labels,colors:y==null?void 0:y.colors,isExpanded:n})]})]})]})};try{Ie.displayName="FacetPlotLegend",Ie.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{ie.displayName="FacetNavPanel",ie.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function ya(e,t,n){const r=t.getColumnModel(e.columnName);return e.values.map(l=>{let s=l;l!=null&&l.startsWith("%")&&(l!=null&&l.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=n.getDisplayValue(s,r.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${l}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,l)}}})}function fa(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function ga(e,t,n){var r;return _e(e)||Ce(e)?e.columnName===((r=t.lockedColumn)==null?void 0:r.columnName)?[]:ya(e,t,n):vt(e)?[fa(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function _a(e,t,n){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const r=t.getColumnModel(e.columnName),{getColumnDisplayName:l,getDisplayValue:s}=n;if(Fe(e))return e.facetValues.map(c=>{const d=s(c,r.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${l(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Dt(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${l(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function Ca(){var c;const e=U(),t=M(),{getLastQueryRequest:n}=e,r=n(),l=(((c=r.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>ga(d,e,t)),s=(r.query.selectedFacets??[]).flatMap(d=>_a(d,e,t)),o=[...l,...s];return a(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(Lt,{...d,key:i})})})}function Re(e){const{style:t,frontText:n,endText:r="",hideIfUnfiltered:l=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=U(),{topLevelControlsState:g,unitDescription:T}=M(),_=s==null?void 0:s.queryCount,I=g==null?void 0:g.showFacetFilter,u=i;return d?a(q,{}):a("div",{className:`TotalQueryResults ${I?ue:de} ${i?"hasFilters":""}`,style:t,children:o?a(re,{width:100}):m(q,{children:[(i||!l)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[n," ",_==null?void 0:_.toLocaleString()," ",T," ",r]}),u&&m("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[a(Y,{icon:"deleteSweep"}),"Clear all filters"]})]}),a("div",{className:"TotalQueryResults__selections",children:a(Ca,{})})]})})}try{Re.displayName="TotalQueryResults",Re.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const fe=2;function ge(e,t){var r;return((r=e==null?void 0:e.facets)==null?void 0:r.filter(l=>l.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(l.columnName)>-1)&&l.facetValues.length>0&&!Oe(l)))??[]}const Be=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:n,isLoadingNewBundle:r,executeQueryRequest:l,error:s,asyncJobStatus:o}=U(),{topLevelControlsState:c}=M(),[d,i]=p.useState([]),[g,T]=p.useState(!0),{showFacetVisualization:_,showFacetFilter:I}=c,u=n();p.useEffect(()=>{const v=ge(t,e);v.length!==0&&g&&(i(v.map((R,b)=>({name:R.columnName,isHidden:b>=fe,plotType:"PIE"}))),T(!1))},[t,g,e]);const C=v=>{i(R=>R.map((b,k)=>v?{...b,isHidden:!1}:{...b,isHidden:k>=fe}))},h=v=>{u.query.selectedFacets=v,u.query.offset=0,l(u)},w=v=>d.find(k=>k.name===v&&k.isHidden===!0)!==void 0,y=p.useMemo(()=>d.find(v=>v.isHidden===!0)?"MORE":d.length<=fe?"NONE":"LESS",[d]),x=v=>{F(v,"isHidden",!0)},N=(v,R)=>{F(v,"plotType",R)},f=v=>{var b;return((b=d.find(k=>k.name===v))==null?void 0:b.plotType)??"PIE"},F=(v,R,b)=>{i(k=>k.map(P=>P.name===v?{...P,[R]:b}:P))},V=ge(t,e),S=ge(t,e).map((v,R)=>({columnName:v.columnName,colorIndex:R})),L=(u==null?void 0:u.query.selectedFacets)!==void 0&&u.query.selectedFacets.length>0||(u==null?void 0:u.query.additionalFilters)!==void 0&&(u==null?void 0:u.query.additionalFilters.length)>0;return s?a(q,{}):!t&&r?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&m("div",{children:[a("span",{className:"spinner"}),o.progressMessage]})}):m(q,{children:[a(Re,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),V.length>0&&m("div",{className:`FacetNav ${_?"":"hidden"} ${I?ue:de} ${y==="LESS"?"less":""}`,children:[a("div",{className:"FacetNav__row",role:"list",children:V.map(v=>{var R;return a("div",{className:"col-sm-12 col-md-4",style:{display:w(v.columnName)?"none":"block"},children:a(ie,{index:(R=S.find(b=>b.columnName===v.columnName))==null?void 0:R.colorIndex,onHide:()=>x(v.columnName),plotType:f(v.columnName),onSetPlotType:b=>N(v.columnName,b),facetToPlot:v,applyChangesToFacetFilter:h,applyChangesToGraphSlice:(b,k,P)=>se(u,b,h,k==null?void 0:k.value,P),isModalView:!1})},v.columnName)})}),y!=="NONE"&&a("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:a(Ge,{variant:"secondary",className:"btn-wide FacetNav__showMore",onClick:()=>C(y==="MORE"),children:y==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Be.displayName="FacetNav",Be.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{j as E,nn as F,ve as I,ae as N,ue as Q,re as S,Re as T,de as a,M as b,Ht as c,Ne as d,De as e,Le as f,an as g,tn as h,xe as i,se as j,Ae as k,Ue as l,Be as m,Pe as n,ge as o,da as p,pa as q,Ie as r,be as s,U as u};
//# sourceMappingURL=FacetNav-2b188222.js.map
