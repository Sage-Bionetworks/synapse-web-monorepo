import{ao as B,an as X,az as qe,aa as $,r as f,j as e,b_ as Z,cV as S,cW as J,cX as ee,cY as w,bk as te,ag as se,V as ne,bl as ae,am as H,bi as Y,X as E,bj as W,B as _,c3 as Q,R as q,cZ as ge,aU as Ae,c_ as he,bh as Te}from"./iframe-B4CHAk6x.js";import{e as je,f as Ie,g as be,h as xe,i as Se,j as _e,k as Ee,l as Ce}from"./useAccessRequirements-FtOKRHB-.js";import{g as ve}from"./groupBy-CokvvLVN.js";import{a as ke}from"./DialogBase-iAyUtvLT.js";import{E as we}from"./EntityLink-DwAOHTKN.js";import{U as Fe}from"./UserOrTeamBadge-CtQnH6Sg.js";import{U as Ne}from"./UnmanagedACTAccessRequirementItem-BWgcspeU.js";import{c as De}from"./UserSearchBoxV2-DB7zO4VS.js";import{M as Ve}from"./MarkdownSynapse-BVqNsxRc.js";import{M as Pe}from"./ManagedACTAccessRequirementItemView-Bjuv7y5k.js";import{S as Me}from"./SelfSignAccessRequirementItem-D5-spuwL.js";import{D as Ue}from"./DataAccessRequestAccessorsFilesForm-C_tZ88OG.js";import{R as Le}from"./ResearchProjectForm-Du_sfs7C.js";import{A as Oe}from"./AuthenticatedRequirement-Ce0ozRXz.js";import{C as Be}from"./CertificationRequirement-BXY4ukUv.js";import{T as He}from"./TwoFactorAuthEnabledRequirement-BUD0UTOX.js";import{V as Ye}from"./ValidationRequirement-R6IK9tfS.js";const We=50;function Qe(t,s){const{accessToken:a,keyFactory:r}=B();return X({...s,queryKey:r.getRestrictionInformationQueryKey(t),queryFn:()=>$.getRestrictionInformation(t,a)})}function Ge(t){return t.reduce((s,a)=>({restrictionInformation:s.restrictionInformation.concat(a.restrictionInformation)}),{restrictionInformation:[]})}function ft(t,s){const{accessToken:a,keyFactory:r}=B(),u=qe(),l=async()=>{const y=De(t.objectIds,We).map(i=>{const c={...t,objectIds:i};return $.getRestrictionInformationBatch(c,a)}),m=await Promise.all(y),d=Ge(m);return d.restrictionInformation.forEach(i=>{u.setQueryData(r.getRestrictionInformationQueryKey({objectId:String(i.objectId),restrictableObjectType:t.restrictableObjectType}),i)}),d};return X({...s,queryKey:r.getRestrictionInformationBatchQueryKey(t),queryFn:l})}function M(t){const{accessRequirement:s,subjectId:a,subjectType:r,onRejectTerms:u,onRequestAccess:l}=t,{data:p,isLoading:y,error:m}=je(s.id.toString()),{data:d,isLoading:i,error:c}=Ie(String(s.id)),{data:h,isLoading:F,error:g}=Qe({objectId:a,restrictableObjectType:r},{enabled:!!a&&!!r}),{mutate:C,error:T,isPending:j}=be(),N=f.useCallback(()=>{d&&C({submissionId:d.currentSubmissionStatus.submissionId,accessRequirementId:String(s.id)})},[s.id,d,C]),D=y||i||F;let v=null;return(m||c||g||T)&&(v=e.jsxs(Z,{className:"access-requirement-list-alert",severity:"error",children:[m&&m.reason,c&&c.reason,g&&g.reason,T&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error canceling your data access request:"}),e.jsx("br",{}),T.reason]})]})),e.jsx(Pe,{isLoading:D,accessRequirement:s,accessRequirementStatus:d,restrictionInformation:h,wikiPage:p&&e.jsx(Ve,{wikiId:p.wikiPageId,ownerId:p.ownerObjectId,objectType:p.ownerObjectType}),error:v,onCancelDataAccessRequest:N,onRejectTerms:u,onRequestAccess:l,cancelRequestIsPending:j})}try{M.displayName="ManagedACTAccessRequirementItem",M.__docgenInfo={description:`Renders a {@link RequirementItem} for a ManagedACTAccessRequirement, which allows a user to see if they have met the
requirement, and if not, complete a data access request to apply for access.`,displayName:"ManagedACTAccessRequirementItem",props:{accessRequirement:{defaultValue:null,description:"The ManagedACTAccessRequirement to be displayed.",name:"accessRequirement",required:!0,type:{name:"ManagedACTAccessRequirement"}},subjectId:{defaultValue:null,description:"If available, the ID of the object that this access requirement is being displayed for.",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"If available, the type of the object that this access requirement is being displayed for.",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}},onRejectTerms:{defaultValue:null,description:'Invoked when the user clicks the "I do not accept" button.',name:"onRejectTerms",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:'Invoked when the user clicks the "Request access" button.',name:"onRequestAccess",required:!0,type:{name:"() => void"}}}}}catch{}function U(t){const{accessRequirement:s,subjectId:a,subjectType:r,onHide:u,onRequestAccess:l}=t;switch(s.concreteType){case w:case ee:return e.jsx(Me,{accessRequirement:s,onHide:u});case J:return e.jsx(Ne,{accessRequirement:s,onHide:u,subjectId:a,subjectType:r});case S:return e.jsx(M,{accessRequirement:s,subjectId:a,subjectType:r,onRejectTerms:u,onRequestAccess:()=>{l(s)}});default:return console.warn("Unsupported access requirement type:",s.concreteType),e.jsx(e.Fragment,{})}}try{U.displayName="AccessRequirementListItem",U.__docgenInfo={description:"Renders an individual AR item for the AccessRequirementList",displayName:"AccessRequirementListItem",props:{accessRequirement:{defaultValue:null,description:"",name:"accessRequirement",required:!0,type:{name:"AccessRequirement"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onRequestAccess:{defaultValue:null,description:"",name:"onRequestAccess",required:!0,type:{name:"(accessRequirement: ManagedACTAccessRequirement) => void"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}function L(t){const{modifiedDataAccessRequest:s,onHide:a}=t,[r,u]=f.useState(),[l,p]=f.useState(!1),{mutate:y}=xe({onSuccess:()=>{a()},onError:d=>{u({key:"error",message:`Sorry, there is an error in submitting your request. ${d.reason?d.reason+".":" "}Please close this dialog and try again later.`}),p(!0)}});function m(){s&&y(s)}return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs(se,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Save Changes",e.jsx(ne,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:a,children:e.jsx(H,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsxs(Y,{children:[e.jsx(E,{variant:"body1",children:"Would you like to save your recent changes?"}),r&&e.jsx(Z,{severity:r.key,children:r.message})]}),e.jsxs(W,{children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(_,{variant:"contained",onClick:()=>{m()},children:"Save changes"})]}),l&&e.jsx(_,{variant:"contained",onClick:a,children:"Close"})]})]})}try{L.displayName="CancelRequestDataAccess",L.__docgenInfo={description:"",displayName:"CancelRequestDataAccess",props:{modifiedDataAccessRequest:{defaultValue:null,description:"",name:"modifiedDataAccessRequest",required:!0,type:{name:"Request | Renewal"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}function O(t){const{onHide:s}=t;return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs(se,{direction:"row",sx:{alignItems:"center",gap:"5px"},children:["Your Data Access Request Has Been Submitted",e.jsx(ne,{sx:{flexGrow:1}}),e.jsx(ae,{onClick:s,children:e.jsx(H,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e.jsx(Y,{children:e.jsx(E,{variant:"body1",children:"Your data access request been submitted and is currently being reviewed. Please allow for up to 2 weeks for your request to be reviewed and approved."})}),e.jsx(W,{children:e.jsx(_,{variant:"contained",onClick:s,children:"Finish"})})]})}try{O.displayName="RequestDataAccessSuccess",O.__docgenInfo={description:"",displayName:"RequestDataAccessSuccess",props:{onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}}}}}catch{}const re=[w,ee,S,J],Ke=new Set(re),G=Ae(E,{label:"DialogSubsectionHeader"})(({theme:t})=>({marginTop:t.spacing(4),marginBottom:t.spacing(2),paddingBottom:t.spacing(1),fontSize:"18px",fontWeight:"bold",borderBottom:"1px solid",borderColor:t.palette.grey[200]})),K=t=>t.some(ze),ze=t=>!Ke.has(t.concreteType);function z(t){const{onHide:s=Q,renderAsModal:a=!1,numberOfFilesAffected:r,requestObjectName:u,customDialogActions:l,onSubmissionCreated:p=Q}=t,y="entityId"in t,m="teamId"in t,d="accessRequirementFromProps"in t,i="subjectId"in t?t.subjectId:y?t.entityId:m?t.teamId:void 0,c="subjectType"in t?t.subjectType:y?q.ENTITY:m?q.TEAM:void 0;let{dialogTitle:h="Data Access Request"}=t;const{isAuthenticated:F}=B(),[g,C]=f.useState(0),T=ge(),[j,N]=f.useState(),[D,v]=f.useState(""),[ie,ce]=f.useState(),oe=Se(),{data:ue}=_e(i,{enabled:i!==void 0&&c===q.TEAM}),{data:de}=Ee(i,{enabled:i!==void 0&&c===q.ENTITY}),o=(d?t.accessRequirementFromProps:void 0)??de??ue,{data:V}=Ce((o??[]).map(n=>String(n.id)),{enabled:!!o,staleTime:1/0}),P=f.useMemo(()=>{if(o&&V){const n=ve(o,"concreteType");return re.map(A=>{const x=n[A];return x?V.map(k=>x.find(Re=>k===String(Re.id))):[]}).flat().filter(A=>A!==void 0)}},[o,V]),I=n=>{const{managedACTAccessRequirement:b,step:A,researchProjectId:x,dataAccessRequest:k}=n;b&&N(b),x&&v(x),k&&ce(k),C(A)},le=o==null?void 0:o.some(n=>n.concreteType===S&&n.isTwoFaRequired),me=o==null?void 0:o.some(n=>(n.concreteType===S||n.concreteType===w)&&n.isCertifiedUserRequired),pe=o==null?void 0:o.some(n=>(n.concreteType===S||n.concreteType===w)&&n.isValidatedProfileRequired),fe=f.useMemo(()=>u||(r?e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:"file",sx:{width:"30px"}})," ",r," ","File(s)"]}):i!==void 0&&c===q.ENTITY?e.jsx(we,{entity:i}):c===q.TEAM?e.jsx(Fe,{principalId:i}):(console.warn(`Unhandled case for AccessRequirementList requestDetails: ${c}: ${i}`),e.jsx(e.Fragment,{}))),[r,u,i,c]),ye=[2,1].includes(g)&&oe?"xl":"md";let R=e.jsx(e.Fragment,{});switch(g){case 1:R=e.jsx(Le,{managedACTAccessRequirement:j,onSave:n=>{I({managedACTAccessRequirement:j,step:2,researchProjectId:n.id})},onHide:s});break;case 2:R=e.jsx(Ue,{researchProjectId:D,managedACTAccessRequirement:j,subjectId:i??"",subjectType:c??q.ENTITY,onHide:s,onCancel:n=>{I({step:3,dataAccessRequest:n})},onSubmissionCreated:n=>{I({step:5}),p(n)},onBackClicked:()=>{I({step:1})}});break;case 3:R=e.jsx(L,{modifiedDataAccessRequest:ie,onHide:s});break;case 4:he(T.toString()),h="Please Log In",R=e.jsx(e.Fragment,{});break;case 5:R=e.jsx(O,{onHide:s});break;case 0:default:R=e.jsxs(e.Fragment,{children:[a?e.jsx(ke,{title:h,onCancel:s}):e.jsx(E,{variant:"h5",sx:{mb:2},children:h}),e.jsxs(Y,{children:[e.jsx(G,{variant:"h4",sx:{mt:0},children:"What is this request for?"}),e.jsx(E,{variant:"body1",component:"span",children:fe}),e.jsx(G,{variant:"h4",children:"What do I need to do?"}),e.jsx(Oe,{}),me&&e.jsx(Be,{}),pe&&e.jsx(Ye,{}),le&&e.jsx(He,{}),P==null?void 0:P.map(n=>e.jsx(U,{accessRequirement:n,subjectId:i,subjectType:c,onHide:s,onRequestAccess:b=>{I({managedACTAccessRequirement:b,step:F?1:4})}},n.id))]}),e.jsx(W,{children:l||e.jsx(e.Fragment,{children:a&&e.jsx(_,{variant:"contained",onClick:s,children:"Close"})})})]})}return a?e.jsx(Te,{maxWidth:ye,fullWidth:!0,open:!0,onClose:s,children:R}):e.jsx(e.Fragment,{children:R})}try{z.displayName="AccessRequirementList",z.__docgenInfo={description:`The AccessRequirementListV2 component renders a set of {@link AccessRequirement}s (either pre-defined, or those applied
to an entity, based on provided props).

The component shows the user the approval status of each AR and provides a workflow for accepting the terms of or
creating a submission for any of the Access Requirements.`,displayName:"AccessRequirementList",props:{numberOfFilesAffected:{defaultValue:null,description:"",name:"numberOfFilesAffected",required:!1,type:{name:"number"}},requestObjectName:{defaultValue:null,description:"",name:"requestObjectName",required:!1,type:{name:"string"}},renderAsModal:{defaultValue:null,description:"",name:"renderAsModal",required:!1,type:{name:"boolean"}},dialogTitle:{defaultValue:null,description:"",name:"dialogTitle",required:!1,type:{name:"string"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},accessRequirementFromProps:{defaultValue:null,description:"",name:"accessRequirementFromProps",required:!1,type:{name:"AccessRequirement[]"}},customDialogActions:{defaultValue:null,description:"",name:"customDialogActions",required:!1,type:{name:"ReactNode"}},onSubmissionCreated:{defaultValue:null,description:"",name:"onSubmissionCreated",required:!1,type:{name:"(submissionId: string) => void"}},entityId:{defaultValue:null,description:"Fetches the access requirements associated with an entity\n@deprecated Please use `subjectId` and `subjectType`",name:"entityId",required:!0,type:{name:"string"}},teamId:{defaultValue:null,description:"Fetches the access requirements associated with a team\n@deprecated Please use `subjectId` and `subjectType`",name:"teamId",required:!0,type:{name:"string"}},subjectId:{defaultValue:null,description:"",name:"subjectId",required:!1,type:{name:"string"}},subjectType:{defaultValue:null,description:"",name:"subjectType",required:!1,type:{name:"enum",value:[{value:'"ENTITY"'},{value:'"EVALUATION"'},{value:'"TEAM"'}]}}}}}catch{}try{K.displayName="checkHasUnsupportedRequirement",K.__docgenInfo={description:"",displayName:"checkHasUnsupportedRequirement",props:{}}}catch{}export{z as A,Qe as a,K as c,ft as u};
