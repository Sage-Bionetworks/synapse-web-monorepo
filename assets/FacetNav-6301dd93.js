import{j as a,a as m,F as q}from"./jsx-runtime-ad672792.js";import{ah as Oe,aP as et,aI as ze,ai as tt,ak as at,aU as nt,aZ as lt}from"./SynapseContext-d313cbec.js";import{r as p,R as qe}from"./index-f1f749bf.js";import{i as rt,r as st,h as ot,a as Ye}from"./queryUtils-7639a20c.js";import{u as We,a as Ge,b as it}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as ct}from"./NoSearchResults-79eea014.js";import{s as ut}from"./NoData-80d05b97.js";import{u as dt}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-5116adf5.js";import{p as mt,q as pt,o as ht,i as yt,j as ft,n as gt,V as G,J as de,x as _t,y as Ct,w as Ft}from"./SynapseConstants-9d1f6e44.js";import{u as Nt}from"./useEntity-c8966376.js";import{b as St}from"./useGetQueryResultBundle-8a54fdb6.js";import{p as bt,a as vt}from"./sqlFunctions-783bb8e8.js";import{i as Ce,a as Fe,c as Et}from"./QueryFilter-ab706eb8.js";import{c as ye}from"./cloneDeep-c3de8e39.js";import{i as X}from"./isEqual-20a71e93.js";import{D as A,E as le}from"./ElementWithTooltip-71b82886.js";import{u as fe}from"./useGetInfoFromIds-07fb992b.js";import{I as Y,a as wt}from"./IconSvg-6d8374ab.js";import{u as xt}from"./uniqueId-4d05949d.js";import{R as Tt}from"./RadioGroup-2b4593e6.js";import{d as Le}from"./dayjs.min-e0adaab4.js";import{R as Vt}from"./RangeSlider-d547757a.js";import{B as W}from"./Box-4cee9ecb.js";import{S as ae}from"./Skeleton-fcc77827.js";import{S as It}from"./Stack-2d799158.js";import{c as Rt,P as kt}from"./factory-76e91d33.js";import{r as qt}from"./react-sizeme-2217af01.js";import{g as Qt}from"./ColorGradient-3d3e1969.js";import{l as Lt,M as ee}from"./LoadingScreen-402343c0.js";import{T as Pe}from"./Typography-33ebb906.js";import{B as je}from"./Button-7d415009.js";import{a as Pt}from"./Clear-499958d6.js";import{S as At}from"./SelectionCriteriaPill-3f7506bf.js";const Dt="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",Ut="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Ne=Oe(Dt),Mt=Oe(Ut),re=e=>a(ae,{style:{...e.style,display:"inline-block"},...e});try{re.displayName="SkeletonInlineBlock",re.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rounded"'},{value:'"rectangular"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const $=p.createContext(void 0),Se=({children:e,queryContext:t})=>a($.Provider,{value:t,children:e});function U(){const e=p.useContext($);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function tn(){const e=p.useContext($);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function an(){const e=p.useContext($);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Ae=$.Consumer;try{$.displayName="QueryContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{Se.displayName="QueryContextProvider",Se.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{Ae.displayName="QueryContextConsumer",Ae.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function Je(e,t){return`${e}${t}`}function Bt(e,t){const l=window.location.search,n=`${e}=${t}`;return l?l.includes(`${e}=`)?window.location.search.slice(l.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${n}`:o).join("&"):`${l.substr(1)}&${n}`:n}function $t(e,t){if(!window.location.search)return;const l=Je(e,t),r=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===l).map(s=>s.split("=")[1])[0];return r?decodeURIComponent(r):void 0}function Ht(e,t,l){const n=t!==void 0?Je(e,t):e,r=Bt(n,l),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${r}`;window.history.replaceState("object or string","Title",o)}function Ot(e,t){const l=$t(e,t);let n;if(l){const r=JSON.parse(l);r.sql&&(n={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:mt|pt|ht|yt|ft,entityId:bt(r.sql),query:r})}return n}function zt(e){const{initQueryRequest:t,componentIndex:l=0,shouldDeepLink:n=!1,onQueryChange:r}=e,[s,o]=p.useState(t);p.useEffect(()=>{const g=Ot("QueryWrapper",l);g&&o(g)},[l]);const c=p.useCallback(()=>ye(s),[s]),d=p.useCallback(()=>ye(t),[t]),i=p.useCallback(g=>{let F;typeof g=="function"?F=g(c()):F=g;const V=ye(F);if(o(V),V.query){const S=JSON.stringify(V.query);if(n){const L=encodeURIComponent(S);Ht("QueryWrapper",l,L)}r&&r(S)}},[l,c,r,n]),{entityId:f,versionNumber:x}=p.useMemo(()=>vt(s.query.sql),[s.query.sql]),_=s.query.limit??gt,I=Math.ceil(((s.query.offset??0)+Number(_))/_),u=p.useCallback(g=>{i(F=>(F.query.limit=g,F))},[i]),C=p.useCallback(g=>{i(F=>(F.query.offset=(g-1)*_,F))},[_,i]),h=p.useCallback(()=>{i(t)},[t,i]);We(()=>{s!=t&&h()},[t]);const w=p.useCallback(g=>{i(F=>(F.query.selectedFacets=(F.query.selectedFacets??[]).filter(V=>!X(V,g)),F))},[i]),y=p.useCallback((g,F)=>{i(V=>(V.query.selectedFacets=(V.query.selectedFacets??[]).map(S=>(Ne(S)&&X(S,g)&&(S.facetValues=S.facetValues.filter(L=>L!==F)),S)).filter(S=>Ne(S)?Array.isArray(S.facetValues)&&S.facetValues.length>0:!0),V))},[i]),T=p.useCallback(g=>{i(F=>(F.query.additionalFilters=(F.query.additionalFilters??[]).filter(V=>!X(V,g)),F))},[i]),N=p.useCallback((g,F)=>{i(V=>(V.query.additionalFilters=(V.query.additionalFilters??[]).map(S=>((Ce(S)||Fe(S))&&X(S,g)&&(S.values=S.values.filter(L=>L!==F)),S)).filter(S=>Ce(S)||Fe(S)?Array.isArray(S.values)&&S.values.length>0:!0),V))},[i]);return{entityId:f,versionNumber:x,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:_,currentPage:I,setPageSize:u,goToPage:C,resetQuery:h,removeSelectedFacet:w,removeValueFromSelectedFacet:y,removeQueryFilter:T,removeValueFromQueryFilter:N}}const me="isShowingFacetFilters",pe="isHidingFacetFilters";function De(e){const{initQueryRequest:t,onQueryChange:l,onQueryResultBundleChange:n,lockedColumn:r,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:f,getInitQueryRequest:x,getLastQueryRequest:_,setQuery:I,currentPage:u,pageSize:C,goToPage:h,setPageSize:w,resetQuery:y,removeSelectedFacet:T,removeValueFromSelectedFacet:N,removeQueryFilter:g,removeValueFromQueryFilter:F}=zt({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:l}),V=p.useMemo(()=>_(),[_]),{data:S,isLoading:L,error:v,isPreviousData:R}=St(V,{keepPreviousData:!0},d),b=S==null?void 0:S.responseBody,k=L||R,{data:P}=Nt(i,f);Ge(()=>{b&&n&&n(JSON.stringify(b))},[b,n]);const K=b?rt(b.facets,b.selectColumns):!0,B=p.useMemo(()=>st(b,r),[b,r]),z=p.useMemo(()=>{const O=_();return ot(O.query,r)},[_,r]),Z=p.useCallback(O=>{var he;return((he=b==null?void 0:b.columnModels)==null?void 0:he.find(Xe=>Xe.name===O))??null},[b==null?void 0:b.columnModels]),E={data:B,currentPage:u,pageSize:C,setPageSize:w,isLoadingNewBundle:k,getLastQueryRequest:_,getInitQueryRequest:x,error:v,entity:P,executeQueryRequest:I,isFacetsAvailable:K,asyncJobStatus:c,goToPage:h,hasResettableFilters:z,removeSelectedFacet:T,removeValueFromSelectedFacet:N,resetQuery:y,removeQueryFilter:g,removeValueFromQueryFilter:F,lockedColumn:r,getColumnModel:Z},{children:D}=e;return a(Se,{queryContext:E,children:a("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${K?"has-facets":""}`,children:D})})}try{De.displayName="QueryWrapper",De.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function Yt(){return m(q,{children:[a("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),a("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ne=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ne||{});function Wt(){return m("div",{className:"text-center",children:[ct,a("h4",{children:"No Matching Results"}),a("p",{children:"Try checking the spelling or removing filters."})]})}function Gt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ut,a("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const jt=()=>{try{return JSON.parse(sessionStorage.getItem(_t)||"")}catch{return[]}},Jt=()=>{try{return JSON.parse(sessionStorage.getItem(Ct)||"")}catch{return[]}},Kt=()=>{try{return JSON.parse(sessionStorage.getItem(Ft)||"")}catch{return[]}},Zt=e=>{const t=jt().find(l=>l.id===e);return(t==null?void 0:t.name)??e},Xt=e=>{const t=Kt().find(l=>l.id===e);return(t==null?void 0:t.name)||e},ea=e=>{const t=Jt().find(l=>l.ownerId===e);return(t==null?void 0:t.userName)||e},ta=(e,t)=>{if(e===G)return de;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return Zt(e);case Q.USERID:case Q.USERID_LIST:return ea(e);case Q.EVALUATIONID:return Xt(e);default:return e}},j=p.createContext(void 0),be=({children:e,queryVisualizationContext:t})=>a(j.Provider,{value:t,children:e});function M(){const e=p.useContext(j);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Ue=j.Consumer;function Me(e){const{noContentPlaceholderType:t=ne.INTERACTIVE}=e,{data:l,getLastQueryRequest:n,isFacetsAvailable:r,isLoadingNewBundle:s,hasResettableFilters:o}=U(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{r||i(N=>({...N,showFacetFilter:!1,showFacetVisualization:!1}))},[r]),p.useEffect(()=>{s&&I([])},[s]);const[f,x]=p.useState([]),[_,I]=p.useState([]),u=n(),C=it(l==null?void 0:l.selectColumns);p.useEffect(()=>{x((C==null?void 0:C.slice(0,e.visibleColumnCount??1/0).map(N=>N.name))??[])},[C,u.query.sql,e.visibleColumnCount]);const h=p.useCallback(N=>{const g=localStorage.getItem("force-display-original-column-names")==="true";return!N||g?N:c[N]?c[N]:dt(N)},[c]),w=p.useCallback(()=>{switch(t){case ne.INTERACTIVE:return o?a(Wt,{}):a(Gt,{});case ne.STATIC:default:return a(Yt,{})}},[t,o]),y={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:f,setColumnsToShowInTable:x,selectedRowIndices:_,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:h,getDisplayValue:ta,NoContentPlaceholder:w},{children:T}=e;return a(be,{queryVisualizationContext:y,children:T})}try{Me.displayName="QueryVisualizationWrapper",Me.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{j.displayName="QueryVisualizationContext",j.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{be.displayName="QueryVisualizationContextProvider",be.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{Ue.displayName="QueryVisualizationContextConsumer",Ue.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const Be=()=>{const{error:e}=U();return a(et,{error:e})};try{Be.displayName="QueryWrapperErrorBanner",Be.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const se=e=>{const{checked:t=!1,hideLabel:l=!1,isSelectAll:n=!1,disabled:r=!1}=e,[s,o]=p.useState(t),[c]=p.useState(xt("src-checkbox-"));p.useEffect(()=>{o(t)},[t]);const d=f=>{e.onChange(f.target.checked),n&&f.target.checked===!1?o(!0):o(f.target.checked)};let i="checkbox";return e.className&&(i+=` ${e.className}`),m("div",{className:i,onClick:e.onClick,children:[a("input",{"aria-label":e.label,type:"checkbox",checked:s,id:c,onChange:d,disabled:r,"data-testid":e["data-testid"]}),a("label",{htmlFor:c,children:l?a(q,{}):e.label}),e.children??a(q,{})]})};try{se.displayName="Checkbox",se.__docgenInfo={description:"",displayName:"Checkbox",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},hideLabel:{defaultValue:null,description:"",name:"hideLabel",required:!1,type:{name:"boolean"}},checked:{defaultValue:null,description:"",name:"checked",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: boolean) => void"}},isSelectAll:{defaultValue:null,description:"",name:"isSelectAll",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: SyntheticEvent<HTMLDivElement, Event>) => void)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},"data-testid":{defaultValue:null,description:"",name:"data-testid",required:!1,type:{name:"string"}}}}}catch{}const ve=e=>m("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{ve.displayName="IconPlus",ve.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const Ee=e=>m("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{Ee.displayName="IconMinus",Ee.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const oe=({label:e,isCollapsed:t,onClick:l})=>{const{getColumnDisplayName:n}=M();return m("div",{className:"FacetFilterHeader",children:[a("label",{className:"FacetFilterHeader__label",children:n(e)}),a("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>l(!t),children:t?a(ve,{className:"icon-plus",title:"Expand Menu"}):a(Ee,{className:"icon-minus",title:"Collapse Menu"})})]})};try{oe.displayName="FacetFilterHeader",oe.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function aa(e){return e.replace(/\s/g,"").toLowerCase()}function $e(e,t=[],l=[],n=[]){const{value:r}=e;let s=r;r===G&&(s=de);const o=t.find(i=>i.ownerId===r);o&&(s=o?o.userName:`unknown (${r})`);const c=l.find(i=>i.id===r);c&&(s=c?c.name:`unknown (${r})`);const d=n.find(i=>i.id===r);return d!=null&&d.name&&(s=d.name),`${s}`}function na(e,t,l){const n=[...e.sort((r,s)=>s.count-r.count)];return t||n.length<=l||n.slice(l).find(r=>r.isSelected)?n:n.splice(0,l)}const J=({facetValues:e,columnModel:t,onClear:l,onChange:n,containerAs:r="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,f]=p.useState(o),[x,_]=p.useState(!1),[I,u]=p.useState(!1),[C,h]=p.useState(""),[w,y]=p.useState(e);We(()=>{y(e)},[e]);const T=5,N=1500,g=qe.createRef(),F={};let V;const S=e.filter(E=>E.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(E=>E.value):[],v=fe({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(E=>E.value):[],b=fe({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(E=>E.value):[],P=fe({ids:k,type:"EVALUATION_QUEUE"}),K=E=>{const D=E.target.value;if(h(D),d(!0),!D)e.forEach(H=>{H.isSelected=!1}),y(e);else{const H=e.filter(O=>$e(O,v,b,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?O:null);y(H)}};if(!t)return a(q,{});const B=r==="Dropdown",z=m("div",{className:B?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[a("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{y(e),u(!1),d(!1)},children:a("span",{className:"EnumFacetFilter__previous",children:a(Y,{icon:"arrowBack"})})}),C.length>0&&a("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var E;h(""),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__reset",children:a(Y,{icon:"close"})})}),a("input",{type:"text",placeholder:"Find values",value:C,ref:g,onChange:E=>{K(E)}})]}),!I&&m("div",{className:"EnumFacetFilter__checkAll",children:[a(se,{className:"EnumFacetFilter__checkbox",onChange:()=>{l()},checked:S,label:"All",isSelectAll:!0},"select_all"),a("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var E;h(""),u(!0),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__searchicon",children:a(Y,{icon:"search"})})})]})]}),m("div",{children:[w.length>0&&na(w,c||B,T).map((E,D)=>a(la,{id:aa(E.value),index:D,label:$e(E,v,b,P),count:E.count,isDropdown:B,initialIsSelected:E.isSelected,onChange:H=>{F[E.value]=H,clearTimeout(V),V=setTimeout(()=>{n(F),_(!1)},N)}},`checkLabel${D}`)),!B&&m(q,{children:[!c&&w.length>T&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",w.length,")"]})})}),c&&w.length>T&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:a("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),w.length<=0&&a("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),Z=()=>_(!x);return B?s==="SelectBox"?m(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:x,onToggle:Z,children:[m(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[S&&"All",!S&&e.filter(E=>E.isSelected).length===1&&e.filter(E=>E.isSelected)[0].value,!S&&e.filter(E=>E.isSelected).length>1&&"Multiple Values Selected"]}),a(A.Menu,{children:z})]}):m(A,{className:"EnumFacetFilter",show:x,onToggle:Z,children:[a(le,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),a(A.Menu,{children:z})]}):m(q,{children:[a(oe,{isCollapsed:i,label:t.name,onClick:E=>f(E)}),a(ze,{className:"EnumFacetFilter",in:!i,children:z})]})};function la({id:e,index:t,label:l,count:n,isDropdown:r,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return qe.useEffect(()=>{d(s)},[s]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{r&&(d(!c),o(!c))},children:[a(se,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:l},`${e}-${t}`),r&&m("span",{className:"EnumFacetFilter__count",children:["(",n,")"]}),!r&&a("div",{className:"EnumFacetFilter__count",children:n})]})}try{J.displayName="EnumFacetFilter",J.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const we=({facet:e,isChecked:t,onClick:l})=>{const{getColumnDisplayName:n}=M();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:l,children:[n(e.columnName),a(Y,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{we.displayName="FacetChip",we.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const xe=e=>{const t="Min value should be less then max value",[l,n]=p.useState(!1),[r,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Le(e.initialValues.min).format("YYYY-MM-DD"),max:Le(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:f},x="number")=>{if(i==null||f===null||f===void 0)return n(!1),!0;if(x==="number"){if(Number(i)>Number(f))return n(!0),!1}else if(Date.parse(i)>Date.parse(f))return n(!0),!1;return n(!1),!0},d=(i,f,x="number")=>{c(i,x)&&f(i)};return m("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[a("input",{"aria-label":"min",type:e.type,value:r.min,onChange:({target:i})=>s({min:i.value,max:r.max})},"range_min"),a("div",{children:"to"}),a("input",{"aria-label":"max",type:e.type,value:r.max,onChange:({target:i})=>s({min:r.min,max:i.value})},"range_max")]}),a("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(r,e.onChange,e.type),children:"Apply"}),l&&a("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{xe.displayName="Range",xe.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const Te=({facetResult:e,columnModel:t,onChange:l,collapsed:n=!1})=>{const[r,s]=p.useState(n),o=[{label:de,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:f}=e;const x=!i&&!f;i=i||c,f=f||d;const _=t.columnType==="DOUBLE"?"number":"date",I=(y,T)=>T?"":y===G?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",u=(y,T)=>{h(y),y!=="RANGE"&&T([y,y])},[C,h]=p.useState(I(i,x));return m("div",{children:[a(oe,{isCollapsed:r,label:t.name,onClick:y=>s(y)}),m(ze,{in:!r,children:[a(Tt,{value:C,id:"rangeSelector",options:o,onChange:y=>u(y,l)}),C==="RANGE"&&(c===d?a("label",{children:d}):m(q,{children:[t.columnType==="INTEGER"&&m(Vt,{domain:[c,d],initialValues:{min:i,max:f},step:1,doUpdateOnApply:!0,onChange:y=>l([y.min,y.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&a(xe,{initialValues:{min:i,max:f},type:_,onChange:y=>l([y.min,y.max])},"Range")]}))]})]})};try{Te.displayName="RangeFacetFilter",Te.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Ke=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),ra=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Qe=(e,t)=>{var s;const l=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],n=l.findIndex(o=>o.columnName===e.columnName),r=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return n>-1?r?l.splice(n,1):l[n]=e:l.push(e),l};function ie(e,t,l,n,r=!1){n?t.facetValues.forEach(c=>{c.value===n&&(c.isSelected=r)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=Ke(t),o=Qe(s,e);l(o)}const Ve=(e,t,l,n)=>{const r=n&&Object.keys(n)||[];r.length&&t.facetValues.forEach(c=>{r.includes(c.value)&&(c.isSelected=n?!!n[c.value]:!1)});const s=Ke(t),o=Qe(s,e);l(o)},sa=(e,t,l,n)=>{t.columnMin=n[0],t.columnMax=n[1];const r=ra(t),s=Qe(r,e);l(s)};function ce(e,t){const l=(t??[]).map(n=>n.columnName);return new Set([...e.slice(0,3).map(n=>n.columnName),...l])}function te(){const e=m(It,{direction:"row",gap:"10px",sx:{my:1},children:[a(ae,{width:"15px"}),a(ae,{width:"40%"})]});return m(W,{className:"FacetFilterControls__facet",children:[a(W,{className:"FacetFilterHeader",children:a(ae,{width:"100%"})}),m(W,{children:[e,e,e]})]})}function oa(){const{topLevelControlsState:e}=M(),{showFacetFilter:t}=e;return m("div",{className:`FacetFilterControls ${t?me:pe}`,children:[a(te,{}),a(te,{}),a(te,{}),a(te,{})]})}function Ie(e){const{availableFacets:t}=e,{data:l,getLastQueryRequest:n,executeQueryRequest:r}=U(),s=n(),o=l.facets.filter(u=>t==null||t.includes(u.columnName)).filter(u=>!Ye(u)),[c,d]=qe.useState(ce(o,s.query.selectedFacets)),{topLevelControlsState:i}=M(),{showFacetFilter:f}=i;Ge(()=>{d(ce(o,s.query.selectedFacets))},[o]);const x=l.selectColumns,_=u=>{const C=n();C.query.selectedFacets=u,C.query.offset=0,r(C)},I=u=>{const C=new Set(c);C.has(u.columnName)?C.delete(u.columnName):C.add(u.columnName),d(C)};return m("div",{className:`FacetFilterControls ${f?me:pe}`,children:[(o??[]).filter(u=>c.has(u.columnName)).map(u=>{const C=x.find(h=>h.name===u.columnName);return m("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&C&&a(J,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:C,onChange:h=>Ve(s,u,_,h),onClear:()=>ie(s,u,_)}),u.facetType==="range"&&C&&a(Te,{facetResult:u,columnModel:C,collapsed:!1,onChange:h=>sa(s,u,_,h)})]},u.columnName)}),m("div",{children:[a("div",{className:"AvailableFacet",children:a("label",{className:"AvailableFacet__label",children:"Available Facets"})}),o.map(u=>a(we,{facet:u,onClick:()=>I(u),isChecked:c.has(u.columnName)},u.columnName))]})]})}function nn(e){const{data:t,isLoadingNewBundle:l}=U();return l?a(oa,{}):t==null||t.facets==null?a(q,{}):a(Ie,{...e})}try{ce.displayName="getDefaultShownFacetFilters",ce.__docgenInfo={description:`Determines which facet filters should be shown after loading a new bundle. The shown facets will be the first
three available facets, plus any other facets that have a filter applied.`,displayName:"getDefaultShownFacetFilters",props:{}}}catch{}try{Ie.displayName="FacetFilterControls",Ie.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{availableFacets:{defaultValue:null,description:"",name:"availableFacets",required:!1,type:{name:"string[]"}}}}}catch{}const ia=Rt(kt),ca=19,ua=30,da={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}};function Ze(e,t){if(!e)return e;const l=e.trim();return l.length>t?l.substr(0,t-1)+"â€¦":e}async function ma(e,t,l,n,r){var u,C;const{colorPalette:s}=Qt(l,e.facetValues.length),o=async(h,w,y)=>{const T=new Map;T.set(G,de);const N=h.map(g=>g.value).filter(g=>g!==G);if(w===Q.ENTITYID||w===Q.ENTITYID_LIST){const g=await nt(N,y);for(const F of g.results)T.set(F.id,F.name)}else if(w===Q.USERID||w===Q.USERID_LIST){const g=await lt(N,y);for(const F of g.children)T.set(F.ownerId,F.userName)}return h.map(g=>({facet:g,label:c(g,!1,T),truncatedLabel:c(g,!0,T),count:g.count}))},c=(h,w,y)=>{let T=y.get(h.value)??h.value;return w&&(T=Ze(T,ca)),T},d=await o(e.facetValues,t,r),i=d.map(h=>h.truncatedLabel),x=e.facetValues.some(h=>h.isSelected)?e.facetValues.map((h,w)=>h.isSelected?s[w]:s[w].replace("rgb(","rgba(").replace(")",", 0.25)")):s,_={values:n==="PIE"?e.facetValues.map(h=>h.count):void 0,labels:d.map(h=>h.label),text:i,x:n==="BAR"?e.facetValues.map(h=>{var w;return((w=d.find(y=>y.facet===h))==null?void 0:w.label)??h.value}):void 0,y:n==="BAR"?e.facetValues.map(h=>h.count):void 0,facetEnumerationValues:e.facetValues.map(h=>h.value),name:e.columnName,hovertemplate:n==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:n==="PIE"?"pie":"bar",pull:n==="PIE"?e.facetValues.map(h=>h.isSelected?.1:0):void 0,marker:{colors:n==="PIE"?x:void 0,color:n==="BAR"?x:void 0}};return{data:[_],labels:d,colors:n==="PIE"?(u=_.marker)==null?void 0:u.colors:(C=_.marker)==null?void 0:C.color}}const pa=(e,t,l)=>{if(e.points&&e.points[0]){const n=e.points[0],r=n.data.facetEnumerationValues[n.pointNumber],s=t.facetValues.find(o=>o.value===r);l(t,s,!s.isSelected)}};function ha(e,t,l){const r=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?r:r/3;return s>l&&(s=l),{width:`${r}px`,height:`${s}px`}}function Re(e){const{labels:t,colors:l=[],isExpanded:n}=e;if(!t)return a(q,{});const r=n?Math.min(t.length,9):Math.min(t.length,4);return r===0?a(q,{}):a("div",{className:`FacetNavPanel__body__legend${n?"--expanded":""}`,children:t.slice(0,r).map((s,o)=>{const c=Ze(s.label,ua);return a(le,{tooltipText:s.label,children:m(W,{sx:{display:"flex",alignItems:"center",gap:"10px"},children:[a(W,{sx:{width:"14px",height:"14px",cursor:"default",backgroundColor:l[o]},style:{cursor:"default"}},`legendLabel_${o}`),a(Pe,{variant:"body2",children:c}),a(Pe,{variant:"body2",sx:{color:"grey.600"},children:s.count})]})},s.label)})})}const ya=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",ue=e=>{const{onHide:t,isModalView:l,applyChangesToFacetFilter:n,applyChangesToGraphSlice:r,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=tt(),{data:f,isLoadingNewBundle:x,getLastQueryRequest:_}=U(),{getColumnDisplayName:I}=M(),[u,C]=p.useState(!1),h=I(o.columnName),w=p.useCallback(()=>{var N,g;return(g=(N=f==null?void 0:f.columnModels)==null?void 0:N.find(F=>F.name===o.columnName))==null?void 0:g.columnType},[f,o.columnName]),{data:y}=at(["extractPlotDataArray",o,w(),s,c,i],()=>ma(o,w(),s,c,i),{enabled:!!o}),T=()=>m("div",{onClick:N=>{N.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(A,{children:[a(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(A.Menu,{className:"chart-tools",children:[a(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),a(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!f&&x||!o?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Lt}):m(q,{children:[m(ee,{animation:!1,show:u,onHide:()=>C(!1),backdrop:"static",children:[a(ee.Header,{closeButton:!0,children:a(ee.Title,{children:h??""})}),m(ee.Body,{children:[a(ue,{...e,isModalView:!0}),a("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:a(je,{variant:"secondary",className:"SaveFiltersButton",onClick:()=>C(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${l?"--expanded":""}`,children:[!l&&m("div",{className:"FacetNavPanel__title",children:[!f&&x?a(re,{width:100}):a("span",{className:"FacetNavPanel__title__name",children:h}),m("div",{className:"FacetNavPanel__title__tools",children:[a(J,{facetValues:o.facetValues,columnModel:f==null?void 0:f.columnModels.find(N=>N.name===o.columnName),onChange:N=>{Ve(_(),o,n,N)},onClear:()=>{ie(_(),o,n)},containerAs:"Dropdown"}),a(le,{tooltipText:"Expand to large graph",callbackFn:()=>C(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),a(le,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),l&&m(q,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),a(J,{facetValues:o.facetValues,columnModel:f==null?void 0:f.columnModels.find(N=>N.name===o.columnName),onChange:N=>{Ve(_(),o,n,N)},onClear:()=>{ie(_(),o,n)},containerAs:"Dropdown",dropdownType:"SelectBox"}),a(Pt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:a(wt,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),a(T,{})]}),m("div",{className:`FacetNavPanel__body${l?"--expanded":""}`,role:"graphics-object",children:[a(qt.SizeMe,{monitorHeight:!0,children:({size:N})=>a("div",{className:ya(l,c),children:a(ia,{layout:da,data:(y==null?void 0:y.data)??[],style:ha(N.width,c,l?300:150),config:{displayModeBar:!1},onClick:g=>pa(g,o,r)},`${o.columnName}-${c}-${N.width}`)})}),a(Re,{labels:y==null?void 0:y.labels,colors:y==null?void 0:y.colors,isExpanded:l})]})]})]})};try{Re.displayName="FacetPlotLegend",Re.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{ue.displayName="FacetNavPanel",ue.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function fa(e,t,l){const n=t.getColumnModel(e.columnName);return e.values.map(r=>{let s=r;r!=null&&r.startsWith("%")&&(r!=null&&r.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=l.getDisplayValue(s,n.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${r}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,r)}}})}function ga(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function _a(e,t,l){var n;return Ce(e)||Fe(e)?e.columnName===((n=t.lockedColumn)==null?void 0:n.columnName)?[]:fa(e,t,l):Et(e)?[ga(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function Ca(e,t,l){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const n=t.getColumnModel(e.columnName),{getColumnDisplayName:r,getDisplayValue:s}=l;if(Ne(e))return e.facetValues.map(c=>{const d=s(c,n.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${r(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Mt(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${r(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function Fa(){var c;const e=U(),t=M(),{getLastQueryRequest:l}=e,n=l(),r=(((c=n.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>_a(d,e,t)),s=(n.query.selectedFacets??[]).flatMap(d=>Ca(d,e,t)),o=[...r,...s];return a(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(At,{...d,key:i})})})}function ke(e){const{style:t,frontText:l,endText:n="",hideIfUnfiltered:r=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=U(),{topLevelControlsState:f,unitDescription:x}=M(),_=s==null?void 0:s.queryCount,I=f==null?void 0:f.showFacetFilter,u=i;return d?a(q,{}):a("div",{className:`TotalQueryResults ${I?me:pe} ${i?"hasFilters":""}`,style:t,children:o?a(re,{width:100}):m(q,{children:[(i||!r)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[l," ",_==null?void 0:_.toLocaleString()," ",x," ",n]}),u&&m("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[a(Y,{icon:"deleteSweep"}),"Clear all filters"]})]}),a("div",{className:"TotalQueryResults__selections",children:a(Fa,{})})]})})}try{ke.displayName="TotalQueryResults",ke.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const ge=2;function _e(e,t){var n;return((n=e==null?void 0:e.facets)==null?void 0:n.filter(r=>r.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(r.columnName)>-1)&&r.facetValues.length>0&&!Ye(r)))??[]}const He=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:l,isLoadingNewBundle:n,executeQueryRequest:r,error:s,asyncJobStatus:o}=U(),{topLevelControlsState:c}=M(),[d,i]=p.useState([]),[f,x]=p.useState(!0),{showFacetVisualization:_,showFacetFilter:I}=c,u=l();p.useEffect(()=>{const v=_e(t,e);v.length!==0&&f&&(i(v.map((R,b)=>({name:R.columnName,isHidden:b>=ge,plotType:"PIE"}))),x(!1))},[t,f,e]);const C=v=>{i(R=>R.map((b,k)=>v?{...b,isHidden:!1}:{...b,isHidden:k>=ge}))},h=v=>{u.query.selectedFacets=v,u.query.offset=0,r(u)},w=v=>d.find(k=>k.name===v&&k.isHidden===!0)!==void 0,y=p.useMemo(()=>d.find(v=>v.isHidden===!0)?"MORE":d.length<=ge?"NONE":"LESS",[d]),T=v=>{F(v,"isHidden",!0)},N=(v,R)=>{F(v,"plotType",R)},g=v=>{var b;return((b=d.find(k=>k.name===v))==null?void 0:b.plotType)??"PIE"},F=(v,R,b)=>{i(k=>k.map(P=>P.name===v?{...P,[R]:b}:P))},V=_e(t,e),S=_e(t,e).map((v,R)=>({columnName:v.columnName,colorIndex:R})),L=(u==null?void 0:u.query.selectedFacets)!==void 0&&u.query.selectedFacets.length>0||(u==null?void 0:u.query.additionalFilters)!==void 0&&(u==null?void 0:u.query.additionalFilters.length)>0;return s?a(q,{}):!t&&n?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&m("div",{children:[a("span",{className:"spinner"}),o.progressMessage]})}):m(q,{children:[a(ke,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),V.length>0&&m("div",{className:`FacetNav ${_?"":"hidden"} ${I?me:pe} ${y==="LESS"?"less":""}`,children:[a("div",{className:"FacetNav__row",role:"list",children:V.map(v=>{var R;return a("div",{className:"col-sm-12 col-md-4",style:{display:w(v.columnName)?"none":"block"},children:a(ue,{index:(R=S.find(b=>b.columnName===v.columnName))==null?void 0:R.colorIndex,onHide:()=>T(v.columnName),plotType:g(v.columnName),onSetPlotType:b=>N(v.columnName,b),facetToPlot:v,applyChangesToFacetFilter:h,applyChangesToGraphSlice:(b,k,P)=>ie(u,b,h,k==null?void 0:k.value,P),isModalView:!1})},v.columnName)})}),y!=="NONE"&&a("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:a(je,{variant:"secondary",className:"btn-wide FacetNav__showMore",onClick:()=>C(y==="MORE"),children:y==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{He.displayName="FacetNav",He.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{se as C,J as E,nn as F,Ee as I,ne as N,me as Q,re as S,ke as T,pe as a,M as b,zt as c,Se as d,Me as e,Ae as f,an as g,tn as h,Ve as i,ie as j,Ue as k,Be as l,He as m,De as n,_e as o,ma as p,ha as q,Re as r,ve as s,U as u};
//# sourceMappingURL=FacetNav-6301dd93.js.map
