import{r as o,da as F,iJ as p,j as t,_ as M,aq as w,cL as L,dO as R,iH as N,d7 as A,B as E,X as O,iK as j,dc as V,J as U}from"./iframe-Ci1lmE8g.js";import{a as k,u as P}from"./useForum-0H-gdn8a.js";import{u as z}from"./useSubscription-JrIAe_RB.js";import{C as B}from"./ConfirmationDialog-C00Ejex4.js";import{I as q}from"./InfiniteTableLayout-m9rAA5y-.js";import{u as H,g as G,S as Y,c as X}from"./StyledTanStackTable-GTBXW4q7.js";import{C as l}from"./ColumnHeader-fXs1jCpX.js";import{U as J,c as K}from"./UserBadge-DRfGM4AR.js";import{F as W}from"./ForumThreadEditor-Bi-oPyJL.js";import{S as Q}from"./SubscribersModal-DdjyuG4f.js";const d=X();function Z(a){return[d.accessor("title",{header:e=>t.jsx(l,{...e,title:"Topic"}),cell:({row:e})=>t.jsxs(M,{onClick:()=>a(e.original.id),children:[e.original.isPinned?t.jsx(w,{icon:"pushpin"}):t.jsx(t.Fragment,{}),e.original.title]}),enableSorting:!0,size:250}),d.accessor("createdBy",{header:e=>t.jsx(l,{...e,title:"Author"}),cell:({getValue:e})=>t.jsx(J,{userId:e()}),enableSorting:!1,size:60}),d.accessor("activeAuthors",{header:e=>t.jsx(l,{...e,title:"Active Users"}),cell:({getValue:e})=>e().map(n=>t.jsx("div",{className:"avatarContainer",children:t.jsx(K,{showCardOnHover:!0,className:"ActiveUsers",size:L,avatarSize:"MEDIUM",ownerId:n})},n)),enableSorting:!1}),d.accessor("numberOfReplies",{header:e=>t.jsx(l,{...e,title:"Replies"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("numberOfViews",{header:e=>t.jsx(l,{...e,title:"Views"}),cell:({getValue:e})=>e().toLocaleString(),enableSorting:!0,minSize:10,size:20}),d.accessor("lastActivity",{header:e=>t.jsx(l,{...e,title:"Activity"}),cell:({getValue:e})=>R(e()).format("L"),enableSorting:!0,size:30})]}function T({forumId:a,limit:e,filter:n,onClickLink:h}){var r;const[s,b]=o.useState([{desc:!0,id:"lastActivity"}]),c=o.useMemo(()=>{if(!F(s)){if(s[0].id=="lastActivity")return p.PINNED_AND_LAST_ACTIVITY;if(s[0].id=="numberOfReplies")return p.NUMBER_OF_REPLIES;if(s[0].id=="title")return p.THREAD_TITLE;if(s[0].id=="numberOfViews")return p.NUMBER_OF_VIEWS}return p.PINNED_AND_LAST_ACTIVITY},[s]),{data:i,isLoading:g,hasNextPage:_,fetchNextPage:x,isFetchingNextPage:f}=k(a,e,c,!((r=s[0])!=null&&r.desc),n),y=o.useMemo(()=>(i==null?void 0:i.pages.flatMap(m=>m.results))??[],[i]),C=o.useMemo(()=>Z(h),[h]),S=H({data:y,columns:C,state:{sorting:s},onSortingChange:b,getRowId:m=>m.id,getCoreRowModel:G(),columnResizeMode:"onChange",manualSorting:!0,enableMultiSort:!1,enableFilters:!1}),u=!g&&S.getRowModel().rows.length===0;return t.jsx("div",{className:"ForumTable",children:t.jsx(q,{table:t.jsx(Y,{table:S,styledTableContainerProps:{sx:{my:2,maxHeight:"250px"}}}),isLoading:g,isEmpty:u,hasNextPage:_,onFetchNextPageClicked:()=>{x()},isFetchingNextPage:f})})}try{T.displayName="ForumTable",T.__docgenInfo={description:"",displayName:"ForumTable",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}},filter:{defaultValue:null,description:"",name:"filter",required:!0,type:{name:"enum",value:[{value:'"NO_FILTER"'},{value:'"DELETED_ONLY"'},{value:'"EXCLUDE_DELETED"'}]}}}}}catch{}const $="You will need to sign in for access to that resource";function I({forumId:a,limit:e,onClickLink:n}){const[h,s]=o.useState(!1),[b,c]=o.useState(!1),[i,g]=o.useState(!1),[_,x]=o.useState(!1),{subscription:f,isLoading:y,toggleSubscribed:C}=z(a,N.FORUM);function S(){try{C()}catch(D){U(D.reason,"danger")}}const{data:u}=P(a),{data:r}=A(),m=u==null?void 0:u.includes((r==null?void 0:r.ownerId)??""),v=()=>{(r==null?void 0:r.userName)=="anonymous"?c(!0):s(!0)};return t.jsxs("div",{className:"ForumTable",children:[t.jsxs("div",{className:"ForumTable__top-level-control",children:[t.jsx(Q,{id:a,objectType:N.FORUM,showModal:_,handleModal:x}),t.jsx(E,{variant:f?"outlined":"contained",color:"primary",onClick:()=>S(),disabled:y,children:f?"Unfollow":"Follow"}),t.jsx(E,{variant:"contained",color:"primary",onClick:()=>v(),children:"New Thread"}),m&&t.jsx(E,{variant:"contained",color:"primary",onClick:()=>g(!i),children:i?"Hide Deleted Threads":"Show Deleted Threads"})]}),i&&t.jsxs(t.Fragment,{children:[t.jsx(O,{variant:"h4",children:"Deleted Threads"}),t.jsx(T,{onClickLink:n,forumId:a,limit:e,filter:j.DELETED_ONLY})]}),t.jsx(T,{onClickLink:n,forumId:a,limit:e,filter:j.EXCLUDE_DELETED}),t.jsx(W,{isReply:!1,id:a,onClose:()=>s(!1),isDialog:!0,openDialog:h}),t.jsx(B,{open:b,title:"Sign In Required",content:$,onCancel:()=>c(!1),hasCancelButton:!1,onConfirm:()=>c(!1),confirmButtonProps:{children:"Sign In",className:V}})]})}try{I.displayName="ForumPage",I.__docgenInfo={description:"",displayName:"ForumPage",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!0,type:{name:"(threadId: string) => void"}}}}}catch{}export{I as F};
