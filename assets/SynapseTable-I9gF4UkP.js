import{j as c}from"./jsx-runtime-D_zvdyIk.js";import{l as A,bi as Se,bn as E,s as Te,ao as De}from"./useFiles-BI7PLl8w.js";import{g as D,R as xe,F as Y}from"./VerificationSubmission-CNoSrCdk.js";import{f as Ee}from"./StringUtils-CwQ1lgbR.js";import"./OrientationBanner-35DwZATM.js";import{r as p}from"./index-BI5lQOsu.js";import{u as L}from"./useEntity-CWBMR5Sb.js";import{e as te,u as Ne,d as Re,S as Ae}from"./StyledTanStackTable-BnQVShNM.js";import{M as Le}from"./ModalDownload-DVuXy5F9.js";import{u as x}from"./QueryContext-B4qAbhAw.js";import{c as N,u as oe,g as ve,e as Ve}from"./QueryWrapper-By4zMATm.js";import{b as _e,s as je,a as Fe}from"./TableRowSelectionState-CARYCGLR.js";import{i as He}from"./isEqual-D_Pln4BK.js";import{u as qe,a as ke}from"./useGetEntityHeaders-N5do7nhC.js";import{b as Pe}from"./useDownloadList-BNJ_sYFp.js";import{I as Oe}from"./IconSvg-3yfKKeyh.js";import{d as R}from"./ToastMessage-DyXUaZmH.js";import{T as Ue}from"./Tooltip-BsozqXdX.js";import{L as Qe}from"./Link-vLahYdB5.js";import{F as ze}from"./FileEntityDirectDownload-CIAbKRgo.js";import{H as Be}from"./HasAccessV2-dSNLIJYl.js";import{C as $e}from"./ColumnHeader-CexgLd39.js";import{E as Ge}from"./EnumFacetFilter-CN4MBQw8.js";import{h as Me}from"./SynapseConstants-Bh0ooQxO.js";import{b as We}from"./SqlFunctions-zz0CCrj4.js";import{I as Ye}from"./InteractiveCopyIdsIcon-D6wmrGKe.js";import{S as Je}from"./LoadingScreen-CUreOsba.js";import{S as Ke}from"./SynapseTableCell-DfORG7dp.js";import{u as Xe}from"./index-CIJIbj4S.js";import{C as Ze}from"./Checkbox-xCR9zb4H.js";import{u as se,b as en}from"./react-OMVIaA_-.js";import{i as H,a as ae,b as nn}from"./SynapseTableUtils-CwFS8uhM.js";import{u as tn}from"./QueryClientProvider-DcA49eyX.js";import{a as on}from"./AccessRequirementList-G7k300sq.js";import{c as sn}from"./UserBadge-BnEdmLEg.js";import{c as an}from"./cloneDeep-BWho0j_J.js";import{b as rn}from"./use-deep-compare-effect.esm-CY1r6QOX.js";const ie=p.createContext(void 0);function re(){const n=p.useContext(ie);if(n===void 0)throw new Error("useSynapseTableContext must be used within a SynapseTableContext");return n}function q(n){const{entityId:e,entityVersionNumber:s}=n,{accessToken:t}=A(),o=!!t,{data:i}=L(e,s),{mutate:a}=Pe({onSuccess:()=>{R(`${(i==null?void 0:i.name)??e} was successfully added to your Download Cart.`,"success")},onError:l=>{R(`Unable to add the file to your Download Cart. ${l.reason}`,"danger")}});return o?c.jsx(c.Fragment,{children:c.jsx(Ue,{title:"Add this file to your Download Cart",placement:"right",enterNextDelay:300,children:c.jsx(Qe,{"data-testid":"AddToDownloadListV2",onClick:()=>{a({entityId:e,entityVersionNumber:s})},className:"ignoreLink",children:c.jsx(Oe,{icon:"addToCart"})})})}):c.jsx(c.Fragment,{})}try{q.displayName="AddToDownloadListV2",q.__docgenInfo={description:"",displayName:"AddToDownloadListV2",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},entityVersionNumber:{defaultValue:null,description:"",name:"entityVersionNumber",required:!1,type:{name:"number"}}}}}catch{}const k=n=>{const e=A(),{getCurrentQueryRequest:s}=x(),t=p.useMemo(()=>s(),[s]),[o,i]=p.useState(!1),[a,l]=p.useState(),[r,m]=p.useState();p.useEffect(()=>(r||m(new AbortController),()=>{r&&r.abort()}),[r]);const u=()=>{i(!0);const{sql:d}=t.query,{entityId:y,versionNumber:f}=We(d),w=f?`.${f}`:"";t.partMask=Me;const C=`${y}${w}`,b=d.indexOf(C);t.query.sql=`select id from ${C}${d.substring(b+C.length)}`,Se(t,e.accessToken,r==null?void 0:r.signal).then(I=>{l(I)}).catch(I=>{console.error(I),R("Unable to query for all Synapse IDs to copy","danger")}).finally(()=>{i(!1)})};return p.useEffect(()=>{if(a){const{rows:d}=a.queryResult.queryResults,y=d.map(f=>`${f.values[0]}`).join(`
`);Ee(y).then(()=>{R("Successfully copied to clipboard"),l(void 0)})}},[a]),o?c.jsx(Je,{size:25}):c.jsx(Ye,{...n,onCopy:()=>{u()}})};try{k.displayName="EntityIDColumnCopyIcon",k.__docgenInfo={description:"",displayName:"EntityIDColumnCopyIcon",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const v="org.sagebionetworks.web.client.SynapseTablePredefinedColumn",V=te();function ln(n){var l;const{row:e,table:s}=n,t=(l=s.options.meta)==null?void 0:l.rowSet,o=se(_e),[i,a]=en(je);return c.jsx("div",{children:c.jsx(Ze,{inputProps:{"aria-label":"Select row"},checked:o(e.original,t.headers),onChange:(r,m)=>{const u=[...i];if(m)u.push(e.original);else{const d=u.findIndex(y=>He(y,e.original));d>-1&&u.splice(d,1)}a(u)}})})}const J=V.display({id:`${v}.RowSelectionColumn`,enableResizing:!1,cell:ln,maxSize:36,meta:{textAlign:"center"}});function cn(n){const e=_(n),s=U(n),t=s?parseInt(s):void 0,{data:o}=qe(e);return c.jsx("div",{"data-testid":"AddToDownloadListCell",children:(o==null?void 0:o.type)==="org.sagebionetworks.repo.model.FileEntity"&&c.jsx(q,{entityId:e,entityVersionNumber:t})})}const K=V.display({id:`${v}.AddToDownloadListColumn`,enableResizing:!1,cell:cn,maxSize:50,meta:{textAlign:"center"}});function dn(n){const e=_(n),s=U(n);return c.jsx("div",{"data-testid":"DirectDownloadCell",children:c.jsx(ze,{entityId:e,entityVersionNumber:s,iconSvgPropOverrides:{sx:{color:"primary.main"}}})})}const X=V.display({id:`${v}.DirectDownload`,enableResizing:!1,cell:dn,maxSize:50,meta:{textAlign:"center"}});function _(n){var i,a;const{row:e,table:s}=n,t=(i=s.options.meta)==null?void 0:i.rowEntityIDColumnIndex;return t!==void 0?e.original.values[t]:(a=e.original.rowId)==null?void 0:a.toString()}function un(n){var s;const{table:e}=n;return((s=e.options.meta)==null?void 0:s.rowEntityVersionColumnIndex)!==void 0}function U(n){var i,a;const{row:e,table:s}=n,t=(i=s.options.meta)==null?void 0:i.rowEntityVersionColumnIndex;return t!==void 0?e.original.values[t]:(a=e.original.versionNumber)==null?void 0:a.toString()}function mn(n){const{showExternalAccessIcon:e}=re(),{ref:s,inView:t}=Xe({triggerOnce:!0}),o=_(n),i=!e||e&&t;return c.jsx("div",{ref:s,"data-testid":"AccessCell",children:i&&c.jsx(Be,{entityId:o,showButtonText:!1,showExternalAccessIcon:e},o)})}const Z=V.display({id:`${v}.Access`,enableResizing:!1,cell:mn,maxSize:50,meta:{textAlign:"center"}});function P(n){var S;const{column:e}=n,{lockedColumn:s}=x(),{data:t}=N(),o=(t==null?void 0:t.columnModels)??[],a=((t==null?void 0:t.selectColumns)??[]).find(h=>h.name===e.id),l=o.find(h=>h.name===e.id),r=(t==null?void 0:t.facets)??[],{getColumnDisplayName:m,getHelpText:u}=oe(),d=a?m(a.name):e.id,y=a?u(a.name):void 0,f=r.findIndex(h=>h.columnName===(l==null?void 0:l.name)&&h.jsonPath==null),w=f!==-1&&r[f].facetType==="enumeration",C=r[f],b=a&&a.name.toLowerCase()===((S=s==null?void 0:s.columnName)==null?void 0:S.toLowerCase()),I=a&&a.name=="id"&&a.columnType==D.ENTITYID;return n.column.getCanFilter=p.useCallback(()=>!!(w&&!b&&l),[w,b,l]),c.jsx($e,{...n,title:d,helpText:y,filterControl:c.jsx("span",{children:c.jsx(Ge,{containerAs:"Dropdown",facet:C,defaultShowAllValues:!0})}),additionalButtons:c.jsx(c.Fragment,{children:I&&c.jsx(k,{size:"small"})})})}function O(n){var d,y;const{cell:e,table:s}=n,{data:t}=N(),o=_(n),i=U(n),a=i!==void 0?parseInt(i):void 0,l=((y=(d=s.options.meta)==null?void 0:d.rowSet)==null?void 0:y.headers)??[],r=l.find(f=>f.name===e.column.id),m=(t==null?void 0:t.columnModels)??[],{columnLinks:u}=re();if(r){const f=(u??[]).find(b=>b.matchColumnName===r.name),w=r.columnType,C=e.column.getIsSorted()?"SRC-boldText":"";return c.jsx(Ke,{columnType:w,columnValue:e.getValue(),isBold:C,columnLinkConfig:f,columnName:r.name,rowData:e.row.original.values,selectColumns:l,columnModels:m,rowId:o,rowVersionNumber:a,isRowEntityColumn:un(n)},e.id)}else return c.jsx("td",{},e.id)}try{P.displayName="TableDataColumnHeader",P.__docgenInfo={description:"",displayName:"TableDataColumnHeader",props:{}}}catch{}try{O.displayName="TableDataCell",O.__docgenInfo={description:"",displayName:"TableDataCell",props:{}}}catch{}function fn(n){const{entityId:e,versionNumber:s}=x(),{data:t}=L(e,s),{data:o}=N(),i=E(D.FILEHANDLEID,o==null?void 0:o.selectColumns);let a=[];return t&&n&&o&&o.selectColumns&&(a=n.rows.reduce((l,r)=>(i.forEach(m=>{const u=r.values[m];if(u){const d=o==null?void 0:o.selectColumns[m];ae(t)&&d.name==="dataFileHandleId"?l.push({fileHandleId:u,associateObjectId:String(r.rowId),associateObjectType:Y.FileEntity}):l.push({fileHandleId:u,associateObjectId:t.id,associateObjectType:Y.TableEntity})}}),l),a)),De({requestedFiles:a,includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},{enabled:a.length>0})}function pn(n){const{entityId:e,versionNumber:s}=x(),{data:t}=L(e,s),{data:o}=N();let i=[];t&&H(t)&&(i=n.rows.reduce((r,m)=>{const{rowId:u,versionNumber:d}=m;return u&&r.push({targetId:`syn${u}`,targetVersionNumber:d}),r},i));let a=E(D.ENTITYID,o==null?void 0:o.selectColumns);if(t&&H(t)){const r=Te("id",o);a=a.filter(m=>m!==r)}const l=E(D.ENTITYID_LIST,o==null?void 0:o.selectColumns);return i=n.rows.reduce((r,m)=>(a.forEach(u=>{const d=m.values[u];d&&!r.find(y=>y.targetId===d&&y.targetVersionNumber==null)&&r.push({targetId:d})}),l.forEach(u=>{const d=m.values[u];d&&JSON.parse(d).forEach(f=>{f&&!r.find(w=>w.targetId===f&&w.targetVersionNumber==null)&&r.push({targetId:f})})}),r),i),i}function yn(n){return ke(n,{enabled:n.length>0})}function wn(n){const{data:e}=N(),s=E(D.USERID,e==null?void 0:e.selectColumns),t=E(D.USERID_LIST,e==null?void 0:e.selectColumns),o=n.rows.reduce((i,a)=>(s.forEach(l=>{const r=a.values[l];r&&!i.includes(r)&&i.push(r)}),t.forEach(l=>{const r=a.values[l];r&&JSON.parse(r).forEach(u=>{i.includes(String(u))||i.push(String(u))})}),i),[]);return sn(o,{enabled:o.length>0})}function Cn(n){const e=p.useMemo(()=>{const s=n.map(t=>t.targetId);return Array.from(new Set(s))},[n]);return on({objectIds:e,restrictableObjectType:xe.ENTITY},{enabled:n.length>0})}function hn(n){const e=pn(n),{isLoading:s}=yn(e),{isLoading:t}=Cn(e),{isLoading:o}=fn(n),{isLoading:i}=wn(n);return{dataHasBeenPrefetched:!s&&!t&&!o&&!i}}function lt(){const{keyFactory:n,accessToken:e}=A(),{currentQueryRequest:s}=x(),t=tn(),o=void 0;return p.useCallback(i=>{const a=ve({pageNumber:i},an(s)),{rowDataQueryOptions:l}=Ve(a,o,n,e);return t.prefetchQuery(l)},[e,s,n,o,t])}function gn(n){return n.map(e=>({id:e.column,desc:e.direction==="DESC"}))}function bn(n){return n.map(e=>({column:e.id,direction:e.desc?"DESC":"ASC"}))}function In(){var o,i;const n=x(),e=rn((i=(o=n.nextQueryRequest)==null?void 0:o.query)==null?void 0:i.sort),s=p.useMemo(()=>e?gn(e):[],[e]);return{sort:s,setSort:a=>{let l;typeof a=="function"?l=a(s):l=a;const r=bn(l);n.executeQueryRequest(m=>({...m,query:{...m.query,sort:r,offset:0}}))}}}const Sn=[],Tn=te();function ee(n){var W;const{showDownloadColumn:e,hideDownload:s}=n,{rowSet:t,isLoadingNewPage:o,customColumns:i=Sn,showAccessColumn:a,showExternalAccessIcon:l,showAccessColumnHeader:r,showDirectDownloadColumn:m=e,hideAddToDownloadListColumn:u=s,columnLinks:d}=n,{entityId:y,versionNumber:f,getCurrentQueryRequest:w,fileIdColumnName:C,fileVersionColumnName:b}=x(),I=p.useMemo(()=>w(),[w]),S=t.headers,{data:h}=L(y,f),{columnsToShowInTable:Q,NoContentPlaceholder:le}=oe(),ce=p.useMemo(()=>({columnLinks:d,showExternalAccessIcon:l}),[d,l]),de=!!A().accessToken,[ue,me]=p.useState(!1),{sort:fe,setSort:pe}=In(),j=se(Fe),z=!!(a&&h&&(H(h)&&ne(t)||C)),B=h&&de&&(ae(h)&&ne(t)||C),$=!!(B&&m),G=!!(B&&!u&&!j),ye=C?t.headers.findIndex(g=>g.name==C):void 0,we=b?t.headers.findIndex(g=>g.name==b):void 0,Ce=p.useMemo(()=>[...i,J,K,X,{...Z,header:a&&r?"Access":""},...S.map((g,T)=>Tn.accessor(F=>F.values[T],{id:g.name,enableSorting:nn(g.columnType),enableResizing:!0,size:200,header:P,cell:O}))??[]],[i,S,a,r]),M=p.useMemo(()=>({[J.id]:j,[K.id]:G,[X.id]:$,[Z.id]:z}),[j,z,G,$]),he=p.useMemo(()=>S.reduce((g,T)=>({...g,[T.name]:Q.includes(T.name)}),M),[Q,S,M]),{dataHasBeenPrefetched:ge}=hn(t),be=o||!ge,Ie=Ne({data:t.rows,columns:Ce,getCoreRowModel:Re(),manualSorting:!0,manualFiltering:!0,onSortingChange:pe,enableMultiSort:!0,columnResizeMode:"onChange",state:{sorting:fe,columnVisibility:he},meta:{rowSet:t,rowEntityIDColumnIndex:ye,rowEntityVersionColumnIndex:we,renderPlaceholderData:be,getWrapInExpandableTd:g=>{const T=S.find(F=>F.name===g.column.id);return!!(T&&T.columnType!==D.JSON)}}});return t?!((((W=t.rows)==null?void 0:W.length)??0)>0)&&(I.query.offset===0||I.query.offset==null)?c.jsx(le,{}):c.jsx(ie.Provider,{value:ce,children:c.jsxs("div",{children:[ue&&c.jsx(Le,{onClose:()=>{me(!1)},queryBundleRequest:I}),c.jsx(Ae,{styledTableContainerProps:{className:"SynapseTable","data-testid":"SynapseTable",density:"default"},table:Ie,fullWidth:!1})]})}):c.jsx(c.Fragment,{})}function ne(n){var e;return!!((e=n.rows)!=null&&e.every(s=>!!s.rowId))}try{ee.displayName="SynapseTable",ee.__docgenInfo={description:"",displayName:"SynapseTable",props:{rowSet:{defaultValue:null,description:"The row data shown in the table.",name:"rowSet",required:!0,type:{name:"RowSet"}},isLoadingNewPage:{defaultValue:null,description:"Whether a new page of data is being loaded",name:"isLoadingNewPage",required:!0,type:{name:"boolean"}},customColumns:{defaultValue:null,description:"Custom columns to render in the table",name:"customColumns",required:!1,type:{name:"ColumnDef<Row, any>[]"}},showAccessColumn:{defaultValue:null,description:"If true and entity is a view or dataset, renders a column that represents if the caller has permission to download the entity represented by the row",name:"showAccessColumn",required:!1,type:{name:"boolean"}},showExternalAccessIcon:{defaultValue:{value:"false"},description:`If true, the component will show enhanced UI for the case where
- the entity is a FileEntity, AND
- the caller has permission to fetch the dataFileHandle, AND
- the dataFileHandle is an instance of ExternalFileHandleInterface (i.e. the file is not controlled by Synapse)
Note that this requires an additional API call that cannot be batched, so it should be avoided in bulk  contexts if possible.`,name:"showExternalAccessIcon",required:!1,type:{name:"boolean"}},showAccessColumnHeader:{defaultValue:null,description:"",name:"showAccessColumnHeader",required:!1,type:{name:"boolean"}},showDownloadColumn:{defaultValue:null,description:"@deprecated use showDirectDownloadColumn",name:"showDownloadColumn",required:!1,type:{name:"boolean"}},hideDownload:{defaultValue:null,description:"@deprecated use hideAddToDownloadListColumn",name:"hideDownload",required:!1,type:{name:"boolean"}},showDirectDownloadColumn:{defaultValue:null,description:"If true and entity is a file view or dataset, renders a column that allows the logged-in user to directly download the file, if they have permission",name:"showDirectDownloadColumn",required:!1,type:{name:"boolean"}},hideAddToDownloadListColumn:{defaultValue:null,description:"If true, the add to download list column will be hidden",name:"hideAddToDownloadListColumn",required:!1,type:{name:"boolean"}},columnLinks:{defaultValue:null,description:"Configuration to override cell renderers with e.g. a link to a portals detail page",name:"columnLinks",required:!1,type:{name:"LabelLinkConfig"}}}}}catch{}export{ee as S,lt as u};
