import{j as e}from"./jsx-runtime-DoxjgJx5.js";import{r as c}from"./index-Cu9bd8lq.js";import"./SkeletonButton-qvhv91j_.js";import"./SkeletonInlineBlock-xinjJ1wr.js";import"./SkeletonTable-BnQ5noh_.js";import{S as P}from"./SkeletonParagraph-D8hc_zPd.js";import{u as q}from"./utils-Cz4ynwjU.js";import{L as R}from"./ListItem-CRhDLg2K.js";import{L as A}from"./ListItemText-DVxJOeuN.js";import{B as d}from"./Box-tOdEuW_y.js";import{c as F}from"./createSvgIcon--fcRVpp9.js";import{u as L}from"./useMutation-DAMF4D7y.js";import{u as z}from"./useInfiniteQuery-B_UIb3Ib.js";import{k as T,S as b}from"./SynapseClient-BrqMkGUT.js";import"./RegularExpressions-B4Jr_WQF.js";import"./OrientationBanner-Ct6IgTPI.js";import{J as D}from"./index-lW5bDacg.js";import{T as _}from"./Typography-Ctk8_6Bo.js";import{L as K}from"./List-DCKeaqo7.js";import{T as N}from"./TextField-Babz9VTU.js";import{I as G}from"./IconButton-rjGZl5Ij.js";import{A as U}from"./ArrowUpward-CAQmf2j-.js";const Y=F([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")],"SmartToyTwoTone"),u=({userMessage:s,chatResponseText:a,scrollIntoView:o=!1})=>{const i=q(),n=c.useRef(null);return c.useEffect(()=>{o&&n.current&&n.current.scrollIntoView({behavior:"smooth"})},[n]),e.jsxs(e.Fragment,{children:[e.jsx(R,{ref:n,sx:{alignSelf:"flex-end",backgroundColor:i.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(A,{primary:s})}),a&&e.jsxs(R,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(d,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(Y,{sx:{color:"secondary.main"}})}),e.jsx(A,{primary:a,sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"}})]}),!a&&e.jsx(P,{numRows:3})]})};try{u.displayName="SynapseChatInteraction",u.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}}}}}catch{}function J(s){const{accessToken:a}=T();return L({mutationFn:o=>b.createAgentSession(o,a),onSuccess:async(o,i,n)=>{}})}function O(s,a){const{accessToken:o}=T();return L({mutationFn:i=>b.getAgentChatAsyncJobResults(i,o,a),onSuccess:(i,n,r)=>{s!=null&&s.onSuccess&&i.responseBody&&s.onSuccess(i.responseBody,n,r)}})}function Q(s,a){const{accessToken:o,keyFactory:i}=T();return z({...a,queryKey:i.chatAgentSessionHistoryQueryKey(s),queryFn:n=>b.getSessionHistory({...s},o),initialPageParam:void 0,getNextPageParam:n=>n.nextPageToken})}const V=({initialMessage:s,agentId:a,chatbotName:o="SynapseChat",hideTitle:i=!1,textboxPositionOffset:n="0px"})=>{const{data:r,mutate:f}=J(),B=q(),[I,E]=c.useState([]),[l,h]=c.useState(),[y,C]=c.useState(""),[p,j]=c.useState(""),[v,H]=c.useState(!1),{mutate:M}=O({onSuccess:t=>{C(t.responseText)}}),{data:x}=Q({sessionId:r==null?void 0:r.sessionId},{enabled:!!r}),w=c.useMemo(()=>(x==null?void 0:x.pages.flatMap(t=>t.page).reverse())??[],[x]);c.useEffect(()=>{y&&l&&(l.chatResponseText=y,E([...I,l]),C(""),h(void 0))},[y,l]),c.useEffect(()=>{f&&!r&&f({agentAccessLevel:D.PUBLICLY_ACCESSIBLE,agentId:a})},[f,r]),c.useEffect(()=>{r&&s&&!v&&(h({userMessage:s}),M({chatText:s,sessionId:r.sessionId}),H(!0))},[r,s,v]);const g=()=>{p.trim()&&(h({userMessage:p}),j(""),M({chatText:p,sessionId:r.sessionId}))},m=!p||!!l,W=t=>{!m&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),g())},k=B.palette.secondary[300];return r?e.jsxs(d,{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",children:[!i&&e.jsx(_,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:o}),e.jsx(d,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(K,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[w&&w.map((t,S)=>e.jsx(u,{userMessage:t.usersRequestText,chatResponseText:t.agentResponseText},S)),I.map((t,S)=>e.jsx(u,{userMessage:t.userMessage,chatResponseText:t.chatResponseText},S)),l&&e.jsx(u,{userMessage:l.userMessage,chatResponseText:l.chatResponseText,scrollIntoView:!0})]})}),e.jsx(d,{sx:{position:"sticky",bottom:n,backgroundColor:"white"},children:e.jsxs(d,{component:"form",sx:{pb:"10px",position:"sticky"},onSubmit:g,children:[e.jsx(N,{fullWidth:!0,value:p,onChange:t=>j(t.target.value),onKeyDown:W,placeholder:`Message ${o}`,InputProps:{sx:{borderRadius:96.6},endAdornment:e.jsx(G,{disabled:m,onClick:g,sx:{ml:"7px",mr:"-8px",color:k,borderStyle:"solid",borderWidth:m?"1px":"2px",borderColor:m?"gray":k},children:e.jsx(U,{})})}}),e.jsxs(_,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[o," can make mistakes."]})]})})]}):e.jsx(P,{numRows:6})};try{V.displayName="SynapseChat",V.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentId:{defaultValue:null,description:"",name:"agentId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}}}}}catch{}export{V as S};
