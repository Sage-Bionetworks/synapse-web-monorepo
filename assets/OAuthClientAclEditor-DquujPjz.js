import{ao as o,an as x,aI as d,aJ as C,ab as _,r as y,c4 as q,j as p,ah as L,c9 as Q,c5 as T}from"./iframe-BoCRNbsR.js";import{u as F}from"./useInfiniteQuery-C7o_Dqt1.js";import{A as R}from"./AclEditor-n-YHTSaj.js";import{u as K}from"./useUpdateAcl-BcLimx6Z.js";import{c as k,u as P}from"./AccessControlListUtils-CXAjf6zR.js";function G(t){const{synapseClient:s,keyFactory:a}=o();return F({...t,queryKey:a.getMyOAuthClientsQueryKey(),queryFn:async n=>await s.openIDConnectServicesClient.getAuthV1Oauth2Client({nextPageToken:n.pageParam}),initialPageParam:void 0,getNextPageParam:n=>n.nextPageToken})}function B(t){const s=d(),{accessToken:a,keyFactory:n}=o();return C({...t,mutationFn:e=>_.deleteOAuthClient(e,a),onSuccess:async(e,i,c)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),t?.onSuccess&&await t.onSuccess(e,i,c)}})}function J(t){const s=d(),{synapseClient:a,keyFactory:n}=o();return C({...t,mutationFn:e=>a.openIDConnectServicesClient.putAuthV1Oauth2ClientId({id:e.client_id,oAuthClient:e}),onSuccess:async(e,i,c)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),t?.onSuccess&&await t.onSuccess(e,i,c)}})}function W(t){const s=d(),{synapseClient:a,keyFactory:n}=o();return C({...t,mutationFn:e=>a.openIDConnectServicesClient.postAuthV1Oauth2Client({oAuthClient:e}),onSuccess:async(e,i,c)=>{await s.invalidateQueries({queryKey:n.getMyOAuthClientsQueryKey()}),t?.onSuccess&&await t.onSuccess(e,i,c)}})}function D(t,s){const{synapseClient:a,keyFactory:n}=o();return x({...s,queryKey:n.getOAuthClientAclQueryKey(t),queryFn:()=>a.openIDConnectServicesClient.getAuthV1Oauth2ClientIdAcl({id:t})})}function N(t){const s=d(),{synapseClient:a,keyFactory:n}=o();return C({...t,mutationFn:e=>a.openIDConnectServicesClient.putAuthV1Oauth2ClientIdAcl({id:e.id,accessControlList:e}),onSuccess:async(e,i,c)=>{const A=n.getOAuthClientAclQueryKey(e.id);if(s.setQueryData(A,e),t?.onSuccess)return await t.onSuccess(e,i,c)}})}const w=["CAN_ADMINISTER_OAUTH_CLIENT"],f=y.forwardRef(function(s,a){const{clientId:n,onSaveComplete:e}=s,[i,c]=y.useState(null),A=()=>{c(null),e(!0)},S=u=>{c(u.reason),e(!1)},{data:r,isLoading:I}=D(n,{staleTime:1/0}),{resourceAccessList:l,setResourceAccessList:h,addResourceAccessItem:g,updateResourceAccessItem:O,removeResourceAccessItem:v,resetDirtyState:E}=K({onChange:()=>c(null),onError:c});y.useEffect(()=>{r&&(E(),h(k(r.resourceAccess)))},[r,h]);const{mutate:m}=N({onSuccess:()=>A(),onError:u=>S(u)});return y.useImperativeHandle(a,()=>({save(){const u=P(r,l);r===null&&u==null||q(r?.resourceAccess,l)&&r?.id===u?.id?e(!0):m(u)}}),[n,r,l,e,m]),p.jsxs(L,{direction:"column",sx:{gap:"20px"},children:[p.jsx(R,{resourceAccessList:l,availablePermissionLevels:w,isLoading:I,canEdit:!0,emptyText:"",onAddPrincipalToAcl:u=>g(u,Q("CAN_ADMINISTER_OAUTH_CLIENT")),updateResourceAccessItem:O,removeResourceAccessItem:v,showAddRemovePublicButton:!1,showNotifyCheckbox:!1,isInherited:!1}),i&&p.jsx(T,{severity:"error",children:i})]})});try{f.displayName="OAuthClientAclEditor",f.__docgenInfo={description:"",displayName:"OAuthClientAclEditor",props:{clientId:{defaultValue:null,description:"",name:"clientId",required:!0,type:{name:"string"}},onSaveComplete:{defaultValue:null,description:"",name:"onSaveComplete",required:!0,type:{name:"(saveSuccessful: boolean) => void"}}}}}catch{}export{f as O,J as a,B as b,G as c,W as u};
