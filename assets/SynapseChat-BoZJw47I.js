import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{l as h,S as v}from"./useFiles-D6LCpGCY.js";import{s as g}from"./VerificationSubmission-BDh1zA9f.js";import"./StringUtils-C95LMFI-.js";import"./OrientationBanner-C9Jr3Oy3.js";import{r as a}from"./index-DiBgT_g4.js";import{u as xe}from"./useQuery-Bc5xDMAa.js";import{u as D}from"./useMutation-CKcr9VY9.js";import{S as fe}from"./LoadingScreen-BCdGsqjQ.js";import"./SkeletonButton-CXp9eL6q.js";import"./SkeletonInlineBlock-Icy7iBdW.js";import"./SkeletonTable-CB0JFsSD.js";import{S as ge}from"./SkeletonParagraph-C-QRIlLc.js";import{d as he}from"./ToastMessage-D7DNdCG4.js";import{D as ye}from"./DropdownSelect-Bk1nQTbv.js";import{B as p}from"./Box-B47wL6Kg.js";import{T as A}from"./Typography-0IkQ6ATH.js";import{M as Se}from"./MarkdownSynapse-CHjjqyZA.js";import{u as Z}from"./useTheme-Dk4dRd2j.js";import{L as Q}from"./ListItem-Dy9rx-Rr.js";import{L as Ae}from"./ListItemText-DoaxhhDe.js";import{c as Ie}from"./createSvgIcon-DiCPcpir.js";import{A as ee}from"./Alert-DHjgiXNM.js";import{L as ve}from"./List-donUnVaj.js";import{T as Te}from"./ButtonBase-CtFWPYLG.js";import{F as Ce}from"./Fade-CySYR3x4.js";import{T as Ee}from"./TextField-C1rbPxGi.js";import{I as be}from"./IconButton-D3dEJ89e.js";import{A as Re}from"./ArrowUpward-BCnRnrF_.js";const _e=Ie([e.jsx("path",{d:"M18 7H6v12h12zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13",opacity:".3"},"0"),e.jsx("path",{d:"M8 15h8v2H8z"},"1"),e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12z"},"2"),e.jsx("circle",{cx:"15",cy:"11.5",r:"1.5"},"3"),e.jsx("circle",{cx:"9",cy:"11.5",r:"1.5"},"4")]);function je(s){const{accessToken:i}=h();return D({mutationFn:n=>v.createAgentSession(n,i),onSuccess:async(n,r,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,r,o)}})}function Le(s){const{accessToken:i}=h();return D({mutationFn:n=>v.updateAgentSession(n,i),onSuccess:async(n,r,o)=>{s!=null&&s.onSuccess&&await s.onSuccess(n,r,o)},onError:async(n,r,o)=>{s!=null&&s.onError&&await s.onError(n,r,o)}})}function Me(s,i){const{accessToken:n}=h();return D({mutationFn:r=>v.getAgentChatAsyncJobResults(r,n,i),onSuccess:(r,o,c)=>{s!=null&&s.onSuccess&&r.responseBody&&s.onSuccess(r.responseBody,o,c)},onError:(r,o,c)=>{s!=null&&s.onError&&s.onError(r,o,c)}})}function Ve(s,i){const{accessToken:n,keyFactory:r}=h();return xe({...i,queryKey:r.getChatAgentTraceKey(s),queryFn:()=>v.getChatAgentTraceEvents(s,n)})}const V=[{value:g.PUBLICLY_ACCESSIBLE,label:"Public Data Only"},{value:g.READ_YOUR_PRIVATE_DATA,label:"Read Your Private Data"},{value:g.WRITE_YOUR_PRIVATE_DATA,label:"Read & Write Your Data"}];function w({onChange:s,initAccessLevel:i}){const n=V.findIndex(l=>l.value==i),r=V.map(l=>l.label),[o,c]=a.useState(n);return e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:"20px"},children:[e.jsx(A,{variant:"label",sx:{gridColumn:"2",mt:"10px",mr:"15px"},children:"Access:"}),e.jsx(ye,{variant:"outlined",options:r,selectedIndex:o,setSelectedIndex:l=>{o!==l&&(c(l),s(V[l].value))}})]})}try{w.displayName="AccessLevelMenu",w.__docgenInfo={description:"",displayName:"AccessLevelMenu",props:{initAccessLevel:{defaultValue:null,description:"",name:"initAccessLevel",required:!0,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newAccessLevel: AgentAccessLevel) => void"}}}}}catch{}function I({userMessage:s,chatResponseText:i,chatErrorReason:n,scrollIntoView:r=!1}){const o=Z(),c=a.useRef(null);a.useEffect(()=>{r&&c.current&&c.current.scrollIntoView({behavior:"smooth"})},[c]);const l=a.useMemo(()=>{const y=new DOMParser().parseFromString(i??"","text/html");return y.querySelectorAll("tool_name").forEach(T=>T.remove()),y.body.textContent??""},[i]);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{ref:c,sx:{alignSelf:"flex-end",backgroundColor:o.palette.secondary[100],borderRadius:"24px",maxWidth:"70%",display:"block",mb:"5px",p:"8px 12px",wordWrap:"break-word",width:"auto"},children:e.jsx(Ae,{primary:s})}),l&&e.jsxs(Q,{sx:{display:"grid",gridTemplateColumns:"50px auto",columnGap:"0px",justifyItems:"center",alignItems:"start",p:"0px"},children:[e.jsx(p,{sx:{p:"3px",mt:"10px",height:"31px",borderRadius:"50%",borderStyle:"solid",borderWidth:"1px",borderColor:"grey.300"},children:e.jsx(_e,{sx:{color:"secondary.main"}})}),e.jsx(p,{sx:{borderRadius:"10px",padding:"10px",maxWidth:"100%"},children:e.jsx(Se,{markdown:l})})]}),n&&e.jsx(ee,{severity:"error",sx:{my:2},children:n})]})}try{I.displayName="SynapseChatInteraction",I.__docgenInfo={description:"",displayName:"SynapseChatInteraction",props:{userMessage:{defaultValue:null,description:"",name:"userMessage",required:!0,type:{name:"string"}},chatResponseText:{defaultValue:null,description:"",name:"chatResponseText",required:!1,type:{name:"string"}},scrollIntoView:{defaultValue:{value:"false"},description:"",name:"scrollIntoView",required:!1,type:{name:"boolean"}},chatErrorReason:{defaultValue:null,description:"",name:"chatErrorReason",required:!1,type:{name:"string"}}}}}catch{}function X({initialMessage:s,agentRegistrationId:i,chatbotName:n="SynapseChat",hideTitle:r=!1,textboxPositionOffset:o="0px",sessionContext:c,externalSession:l,setExternalSession:k,externalInteractions:y,setExternalInteractions:P,showAccessLevelMenu:T=!0}){const{accessToken:se}=h(),[te,ne]=a.useState(),u=l??te,q=k??ne,{mutate:C,error:B}=je({onSuccess:t=>q(t)}),{mutate:re}=Le({onSuccess:t=>q(t),onError:t=>he(`Unable to update the agent session: ${t.message}`,"danger")}),ae=Z(),[U,oe]=a.useState(c?g.WRITE_YOUR_PRIVATE_DATA:g.PUBLICLY_ACCESSIBLE),[ie,ce]=a.useState([]),Y=y??ie,le=P??ce,[d,E]=a.useState(),[b,O]=a.useState(),[R,F]=a.useState(""),[_,W]=a.useState(""),[f,N]=a.useState(""),[z,ue]=a.useState(!1),[m,G]=a.useState(),{mutate:j}=Me({onSuccess:t=>{F(t.responseText)},onError:t=>{W(t.reason)}},t=>{O(t.jobId)}),{data:x}=Ve({jobId:b,newerThanTimestamp:m==null?void 0:m.timestamp},{enabled:!!b,refetchInterval:b?1e3:!1,refetchIntervalInBackground:!0});a.useEffect(()=>{if(x&&x.page.length>0){const t=x.page[x.page.length-1],pe=new DOMParser().parseFromString(t.message,"text/html").getElementsByTagName("thinking"),me=Array.from(pe).map(M=>{var $;return($=M==null?void 0:M.textContent)==null?void 0:$.trim()}).join(`
`);t.friendlyMessage=me??t.message,G(t),console.debug(x.page)}},[x]),a.useEffect(()=>{d&&(R||_)&&(d.chatResponseText=R,d.chatErrorReason=_,le([...Y,d]),F(""),W(""),E(void 0),O(void 0),G(void 0))},[R,_,d]),a.useEffect(()=>{C&&!u&&C({agentAccessLevel:U,agentRegistrationId:i,sessionContext:c})},[C,u,se,c]),a.useEffect(()=>{u&&s&&!z&&(E({userMessage:s}),j({chatText:s,sessionId:u.sessionId,enableTrace:!0}),ue(!0))},[u,s,z,j]);const L=()=>{f.trim()&&(E({userMessage:f}),N(""),j({chatText:f,sessionId:u.sessionId,enableTrace:!0}))},S=!u||!f||!!d,de=t=>{!S&&t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),L())},H=ae.palette.secondary[300];if(B)return e.jsx(ee,{severity:"error",sx:{my:2},children:B.reason});const K=(m==null?void 0:m.friendlyMessage)??"Processing...";return e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",maxWidth:"1100px",mx:"auto",height:"100%"},children:[!r&&e.jsx(A,{variant:"headline1",sx:{p:"20px",borderBottom:"1px solid",borderColor:"grey.300",position:"sticky",top:"0px",backgroundColor:"white",zIndex:1},children:n}),T&&e.jsx(w,{initAccessLevel:U,onChange:t=>{oe(t),re({agentAccessLevel:t,sessionId:u.sessionId})}}),!u&&e.jsx(ge,{numRows:10}),u&&e.jsx(p,{sx:{flexGrow:1,overflowY:"auto",mb:2},children:e.jsxs(ve,{sx:{flex:1,overflowY:"auto",pt:"20px",display:"flex",flexDirection:"column"},children:[Y.map((t,J)=>e.jsx(I,{userMessage:t.userMessage,chatResponseText:t.chatResponseText,chatErrorReason:t.chatErrorReason},J)),d&&e.jsxs(e.Fragment,{children:[e.jsx(I,{userMessage:d.userMessage,chatResponseText:d.chatResponseText,chatErrorReason:d.chatErrorReason,scrollIntoView:!0}),e.jsxs(p,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:"5px"},children:[e.jsx(fe,{size:40}),e.jsx(p,{sx:{position:"relative",pt:"130px"},children:e.jsx(Te,{children:e.jsx(Ce,{timeout:500,children:e.jsx(A,{sx:{textAlign:"center",position:"absolute",width:"100%",top:0},variant:"body1Italic",children:K})},K)})})]})]})]})}),e.jsx(p,{sx:{position:"sticky",bottom:o,backgroundColor:"white"},children:e.jsxs(p,{component:"form",sx:{pt:"8px",mt:"5px",pb:"10px",position:"sticky",borderTop:"1px solid",borderColor:"grey.400"},onSubmit:L,children:[e.jsx(Ee,{fullWidth:!0,value:f,onChange:t=>N(t.target.value),onKeyDown:de,placeholder:`Message ${n}`,slotProps:{input:{sx:{borderRadius:96.6},endAdornment:e.jsx(be,{disabled:S,onClick:L,sx:{ml:"7px",mr:"-8px",color:H,borderStyle:"solid",borderWidth:S?"1px":"2px",borderColor:S?"gray":H},children:e.jsx(Re,{})})}}}),e.jsxs(A,{variant:"smallText1",sx:{pt:"8px",textAlign:"center"},children:[n," can make mistakes."]})]})})]})}try{X.displayName="SynapseChat",X.__docgenInfo={description:"",displayName:"SynapseChat",props:{initialMessage:{defaultValue:null,description:"",name:"initialMessage",required:!1,type:{name:"string"}},agentRegistrationId:{defaultValue:null,description:"",name:"agentRegistrationId",required:!1,type:{name:"string"}},chatbotName:{defaultValue:{value:"SynapseChat"},description:"",name:"chatbotName",required:!1,type:{name:"string"}},hideTitle:{defaultValue:{value:"false"},description:"",name:"hideTitle",required:!1,type:{name:"boolean"}},textboxPositionOffset:{defaultValue:{value:"0px"},description:"",name:"textboxPositionOffset",required:!1,type:{name:"string"}},sessionContext:{defaultValue:null,description:"",name:"sessionContext",required:!1,type:{name:"GridAgentSessionContext"}},externalSession:{defaultValue:null,description:"",name:"externalSession",required:!1,type:{name:"AgentSession"}},setExternalSession:{defaultValue:null,description:"",name:"setExternalSession",required:!1,type:{name:"(s: AgentSession) => void"}},externalInteractions:{defaultValue:null,description:"",name:"externalInteractions",required:!1,type:{name:"ChatInteraction[]"}},setExternalInteractions:{defaultValue:null,description:"",name:"setExternalInteractions",required:!1,type:{name:"(i: ChatInteraction[]) => void"}},defaultAgentAccessLevel:{defaultValue:null,description:"",name:"defaultAgentAccessLevel",required:!1,type:{name:"enum",value:[{value:'"PUBLICLY_ACCESSIBLE"'},{value:'"READ_YOUR_PRIVATE_DATA"'},{value:'"WRITE_YOUR_PRIVATE_DATA"'}]}},showAccessLevelMenu:{defaultValue:{value:"true"},description:"",name:"showAccessLevelMenu",required:!1,type:{name:"boolean"}}}}}catch{}export{X as S,_e as a};
