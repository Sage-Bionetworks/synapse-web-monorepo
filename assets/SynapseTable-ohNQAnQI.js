import{r as y,ao as R,K as A,j as r,c0 as Ie,$ as Se,am as De,_ as Te,d$ as xe,f6 as Ee,a2 as Ne,fP as Ae,eT as D,e_ as te,bG as Re,c4 as ve,fQ as x,fk as Le,R as qe,G as W,d5 as _e,aI as Ve,f0 as je}from"./iframe-MmUnwf_I.js";import{u as v}from"./useEntity-Dp_Npi43.js";import{c as ne,u as He,g as Fe,S as Me}from"./StyledTanStackTable-CTBFGNM8.js";import{M as ke}from"./ModalDownload-Cz8GI_s7.js";import{u as T}from"./QueryContext-DZSdjZ6V.js";import{u as E,a as oe,g as Pe,e as Oe}from"./QueryWrapper-D_fAx5vq.js";import{d as Qe,s as Ue,i as $e}from"./TableRowSelectionState-I8TMdEDY.js";import{u as ze,a as Be}from"./useGetEntityHeaders-BYHlx3ny.js";import{c as Ge}from"./useDownloadList-Ch8YVR7Z.js";import{F as We}from"./FileEntityDirectDownload-BfJUAb8i.js";import{H as Ye}from"./HasAccessV2-BQZF7DN8.js";import{C as Je}from"./ColumnHeader-g54u34wv.js";import{E as Ke}from"./EnumFacetFilter-BoQ9AgB9.js";import{I as Xe}from"./InteractiveCopyIdsIcon-DiltLmF8.js";import{S as Ze}from"./SynapseTableCell-BGUq6mWn.js";import{u as et}from"./index-BbSQNdTj.js";import{C as tt}from"./Checkbox-BQeLkSuG.js";import{i as H,b as se,c as nt}from"./SynapseTableUtils-BW5vflV6.js";import{u as ot}from"./AccessRequirementList-CQhIyCqc.js";import{u as st}from"./UserBadge-DP5amhmd.js";import{a as at}from"./use-deep-compare-effect.esm-BqBQcVZ-.js";const ae=y.createContext(void 0);function ie(){const e=y.useContext(ae);if(e===void 0)throw new Error("useSynapseTableContext must be used within a SynapseTableContext");return e}function F(e){const{entityId:t,entityVersionNumber:o}=e,{isAuthenticated:n}=R(),{data:a}=v(t,o),{mutate:l}=Ge({onSuccess:()=>{A(`${a?.name??t} was successfully added to your Download Cart.`,"success")},onError:i=>{A(`Unable to add the file to your Download Cart. ${i.reason}`,"danger")}});return n?r.jsx(r.Fragment,{children:r.jsx(Ie,{title:"Add this file to your Download Cart",placement:"right",enterNextDelay:300,children:r.jsx(Se,{"data-testid":"AddToDownloadListV2",onClick:()=>{l({entityId:t,entityVersionNumber:o})},className:"ignoreLink",children:r.jsx(De,{icon:"addToCart"})})})}):r.jsx(r.Fragment,{})}try{F.displayName="AddToDownloadListV2",F.__docgenInfo={description:"",displayName:"AddToDownloadListV2",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},entityVersionNumber:{defaultValue:null,description:"",name:"entityVersionNumber",required:!1,type:{name:"number"}}}}}catch{}const M=e=>{const t=R(),{getCurrentQueryRequest:o}=T(),n=y.useMemo(()=>o(),[o]),[a,l]=y.useState(!1),[i,c]=y.useState(),[s,m]=y.useState();y.useEffect(()=>(s||m(new AbortController),()=>{s&&s.abort()}),[s]);const u=()=>{l(!0);const{sql:d}=n.query,{entityId:p,versionNumber:f}=Ee(d),C=f?`.${f}`:"";n.partMask=Ne;const h=`${p}${C}`,I=d.indexOf(h);n.query.sql=`select id from ${h}${d.substring(I+h.length)}`,Ae(n,t.accessToken,s?.signal).then(b=>{c(b)}).catch(b=>{console.error(b),A("Unable to query for all Synapse IDs to copy","danger")}).finally(()=>{l(!1)})};return y.useEffect(()=>{if(i){const{rows:d}=i.queryResult.queryResults,p=d.map(f=>`${f.values[0]}`).join(`
`);Te(p).then(()=>{A("Successfully copied to clipboard"),c(void 0)})}},[i]),a?r.jsx(xe,{size:25}):r.jsx(Xe,{...e,onCopy:()=>{u()}})};try{M.displayName="EntityIDColumnCopyIcon",M.__docgenInfo={description:"",displayName:"EntityIDColumnCopyIcon",props:{component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}const L="org.sagebionetworks.web.client.SynapseTablePredefinedColumn",q=ne();function it(e){const{row:t,table:o}=e,n=o.options.meta?.rowSet,a=te(Qe),[l,i]=Re(Ue);return r.jsx("div",{children:r.jsx(tt,{inputProps:{"aria-label":"Select row"},checked:a(t.original,n.headers),onChange:(c,s)=>{const m=[...l];if(s)m.push(t.original);else{const u=m.findIndex(d=>ve(d,t.original));u>-1&&m.splice(u,1)}i(m)}})})}const Y=q.display({id:`${L}.RowSelectionColumn`,enableResizing:!1,cell:it,maxSize:36,meta:{textAlign:"center"}});function lt(e){const t=_(e),o=O(e),n=o?parseInt(o):void 0,{data:a}=ze(t);return r.jsx("div",{"data-testid":"AddToDownloadListCell",children:a?.type==="org.sagebionetworks.repo.model.FileEntity"&&r.jsx(F,{entityId:t,entityVersionNumber:n})})}const J=q.display({id:`${L}.AddToDownloadListColumn`,enableResizing:!1,cell:lt,maxSize:50,meta:{textAlign:"center"}});function rt(e){const t=_(e),o=O(e);return r.jsx("div",{"data-testid":"DirectDownloadCell",children:r.jsx(We,{entityId:t,entityVersionNumber:o,iconSvgPropOverrides:{sx:{color:"primary.main"}}})})}const K=q.display({id:`${L}.DirectDownload`,enableResizing:!1,cell:rt,maxSize:50,meta:{textAlign:"center"}});function _(e){const{row:t,table:o}=e,n=o.options.meta?.rowEntityIDColumnIndex;return n!==void 0?t.original.values[n]:t.original.rowId?.toString()}function ct(e){const{table:t}=e;return t.options.meta?.rowEntityVersionColumnIndex!==void 0}function O(e){const{row:t,table:o}=e,n=o.options.meta?.rowEntityVersionColumnIndex;return n!==void 0?t.original.values[n]:t.original.versionNumber?.toString()}function dt(e){const{showExternalAccessIcon:t}=ie(),{ref:o,inView:n}=et({triggerOnce:!0}),a=_(e),l=!t||t&&n;return r.jsx("div",{ref:o,"data-testid":"AccessCell",children:l&&r.jsx(Ye,{entityId:a,showButtonText:!1,showExternalAccessIcon:t},a)})}const X=q.display({id:`${L}.Access`,enableResizing:!1,cell:dt,maxSize:50,meta:{textAlign:"center"}});function k(e){const{column:t}=e,{lockedColumn:o}=T(),{data:n}=E(),a=n?.columnModels??[],i=(n?.selectColumns??[]).find(w=>w.name===t.id),c=a.find(w=>w.name===t.id),s=n?.facets??[],{getColumnDisplayName:m,getHelpText:u}=oe(),d=i?m(i.name):t.id,p=i?u(i.name):void 0,f=s.findIndex(w=>w.columnName===c?.name&&w.jsonPath==null),C=f!==-1&&s[f].facetType==="enumeration",h=s[f],I=i&&i.name.toLowerCase()===o?.columnName?.toLowerCase(),b=i&&i.name=="id"&&i.columnType==D.ENTITYID;return e.column.getCanFilter=y.useCallback(()=>!!(C&&!I&&c),[C,I,c]),r.jsx(Je,{...e,title:d,helpText:p,filterControl:r.jsx("span",{children:r.jsx(Ke,{containerAs:"Dropdown",facet:h,defaultShowAllValues:!0})}),additionalButtons:r.jsx(r.Fragment,{children:b&&r.jsx(M,{size:"small"})})})}function P(e){const{cell:t,table:o}=e,{data:n}=E(),a=_(e),l=O(e),i=l!==void 0?parseInt(l):void 0,c=o.options.meta?.rowSet?.headers??[],s=c.find(d=>d.name===t.column.id),m=n?.columnModels??[],{columnLinks:u}=ie();if(s){const d=(u??[]).find(C=>C.matchColumnName===s.name),p=s.columnType,f=t.column.getIsSorted()?"SRC-boldText":"";return r.jsx(Ze,{columnType:p,columnValue:t.getValue(),isBold:f,columnLinkConfig:d,columnName:s.name,rowData:t.row.original.values,selectColumns:c,columnModels:m,rowId:a,rowVersionNumber:i,isRowEntityColumn:ct(e)},t.id)}else return r.jsx("td",{},t.id)}try{k.displayName="TableDataColumnHeader",k.__docgenInfo={description:"",displayName:"TableDataColumnHeader",props:{}}}catch{}try{P.displayName="TableDataCell",P.__docgenInfo={description:"",displayName:"TableDataCell",props:{}}}catch{}function ut(e){const{entityId:t,versionNumber:o}=T(),{data:n}=v(t,o),{data:a}=E(),l=x(D.FILEHANDLEID,a?.selectColumns);let i=[];return n&&e&&a&&a.selectColumns&&(i=e.rows.reduce((c,s)=>(l.forEach(m=>{const u=s.values[m];if(u){const d=a?.selectColumns[m];se(n)&&d.name==="dataFileHandleId"?c.push({fileHandleId:u,associateObjectId:String(s.rowId),associateObjectType:W.FileEntity}):c.push({fileHandleId:u,associateObjectId:n.id,associateObjectType:W.TableEntity})}}),c),i)),_e({requestedFiles:i,includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},{enabled:i.length>0})}function mt(e){const{entityId:t,versionNumber:o}=T(),{data:n}=v(t,o),{data:a}=E();let l=[];n&&H(n)&&(l=e.rows.reduce((s,m)=>{const{rowId:u,versionNumber:d}=m;return u&&s.push({targetId:`syn${u}`,targetVersionNumber:d}),s},l));let i=x(D.ENTITYID,a?.selectColumns);if(n&&H(n)){const s=Le("id",a);i=i.filter(m=>m!==s)}const c=x(D.ENTITYID_LIST,a?.selectColumns);return l=e.rows.reduce((s,m)=>(i.forEach(u=>{const d=m.values[u];d&&!s.find(p=>p.targetId===d&&p.targetVersionNumber==null)&&s.push({targetId:d})}),c.forEach(u=>{const d=m.values[u];d&&JSON.parse(d).forEach(f=>{f&&!s.find(C=>C.targetId===f&&C.targetVersionNumber==null)&&s.push({targetId:f})})}),s),l),l}function yt(e){return Be(e,{enabled:e.length>0})}function ft(e){const{data:t}=E(),o=x(D.USERID,t?.selectColumns),n=x(D.USERID_LIST,t?.selectColumns),a=e.rows.reduce((l,i)=>(o.forEach(c=>{const s=i.values[c];s&&!l.includes(s)&&l.push(s)}),n.forEach(c=>{const s=i.values[c];s&&JSON.parse(s).forEach(u=>{l.includes(String(u))||l.push(String(u))})}),l),[]);return st(a,{enabled:a.length>0})}function pt(e){const t=y.useMemo(()=>{const o=e.map(n=>n.targetId);return Array.from(new Set(o))},[e]);return ot({objectIds:t,restrictableObjectType:qe.ENTITY},{enabled:e.length>0})}function Ct(e){const t=mt(e),{isLoading:o}=yt(t),{isLoading:n}=pt(t),{isLoading:a}=ut(e),{isLoading:l}=ft(e);return{dataHasBeenPrefetched:!o&&!n&&!a&&!l}}function $t(){const{keyFactory:e,accessToken:t}=R(),{currentQueryRequest:o}=T(),n=Ve(),a=void 0;return y.useCallback(l=>{const i=Pe({pageNumber:l},je(o)),{rowDataQueryOptions:c}=Oe(i,a,e,t);return n.prefetchQuery(c)},[t,o,e,a,n])}function wt(e){return e.map(t=>({id:t.column,desc:t.direction==="DESC"}))}function ht(e){return e.map(t=>({column:t.id,direction:t.desc?"DESC":"ASC"}))}function gt(){const e=T(),t=at(e.nextQueryRequest?.query?.sort),o=y.useMemo(()=>t?wt(t):[],[t]);return{sort:o,setSort:a=>{let l;typeof a=="function"?l=a(o):l=a;const i=ht(l);e.executeQueryRequest(c=>({...c,query:{...c.query,sort:i,offset:0}}))}}}const bt=[],It=ne();function Z(e){const{showDownloadColumn:t,hideDownload:o}=e,{rowSet:n,isLoadingNewPage:a,customColumns:l=bt,showAccessColumn:i,showExternalAccessIcon:c,showAccessColumnHeader:s,showDirectDownloadColumn:m=t,hideAddToDownloadListColumn:u=o,columnLinks:d}=e,{entityId:p,versionNumber:f,getCurrentQueryRequest:C,fileIdColumnName:h,fileVersionColumnName:I}=T(),b=y.useMemo(()=>C(),[C]),w=n.headers,{data:N}=v(p,f),{columnsToShowInTable:Q,NoContentPlaceholder:le}=oe(),re=y.useMemo(()=>({columnLinks:d,showExternalAccessIcon:c}),[d,c]),{isAuthenticated:ce}=R(),[de,ue]=y.useState(!1),{sort:me,setSort:ye}=gt(),V=te($e),U=!!(i&&N&&(H(N)&&ee(n)||h)),$=N&&ce&&(se(N)&&ee(n)||h),z=!!($&&m),B=!!($&&!u&&!V),fe=h?n.headers.findIndex(g=>g.name==h):void 0,pe=I?n.headers.findIndex(g=>g.name==I):void 0,Ce=y.useMemo(()=>[...l,Y,J,K,{...X,header:i&&s?"Access":""},...w.map((g,S)=>It.accessor(j=>j.values[S],{id:g.name,enableSorting:nt(g.columnType),enableResizing:!0,size:200,header:k,cell:P}))??[]],[l,w,i,s]),G=y.useMemo(()=>({[Y.id]:V,[J.id]:B,[K.id]:z,[X.id]:U}),[V,U,B,z]),we=y.useMemo(()=>w.reduce((g,S)=>({...g,[S.name]:Q.includes(S.name)}),G),[Q,w,G]),{dataHasBeenPrefetched:he}=Ct(n),ge=a||!he,be=He({data:n.rows,columns:Ce,getCoreRowModel:Fe(),manualSorting:!0,manualFiltering:!0,onSortingChange:ye,enableMultiSort:!0,columnResizeMode:"onChange",state:{sorting:me,columnVisibility:we},meta:{rowSet:n,rowEntityIDColumnIndex:fe,rowEntityVersionColumnIndex:pe,renderPlaceholderData:ge,getWrapInExpandableTd:g=>{const S=w.find(j=>j.name===g.column.id);return!!(S&&S.columnType!==D.JSON)}}});return n?!((n.rows?.length??0)>0)&&(b.query.offset===0||b.query.offset==null)?r.jsx(le,{}):r.jsx(ae.Provider,{value:re,children:r.jsxs("div",{children:[de&&r.jsx(ke,{onClose:()=>{ue(!1)},queryBundleRequest:b}),r.jsx(Me,{styledTableContainerProps:{className:"SynapseTable","data-testid":"SynapseTable",density:"default"},table:be,fullWidth:!1})]})}):r.jsx(r.Fragment,{})}function ee(e){return!!e.rows?.every(t=>!!t.rowId)}try{Z.displayName="SynapseTable",Z.__docgenInfo={description:"",displayName:"SynapseTable",props:{rowSet:{defaultValue:null,description:"The row data shown in the table.",name:"rowSet",required:!0,type:{name:"RowSet"}},isLoadingNewPage:{defaultValue:null,description:"Whether a new page of data is being loaded",name:"isLoadingNewPage",required:!0,type:{name:"boolean"}},customColumns:{defaultValue:null,description:"Custom columns to render in the table",name:"customColumns",required:!1,type:{name:"ColumnDef<Row, any>[]"}},showAccessColumn:{defaultValue:null,description:"If true and entity is a view or dataset, renders a column that represents if the caller has permission to download the entity represented by the row",name:"showAccessColumn",required:!1,type:{name:"boolean"}},showExternalAccessIcon:{defaultValue:{value:"false"},description:`If true, the component will show enhanced UI for the case where
- the entity is a FileEntity, AND
- the caller has permission to fetch the dataFileHandle, AND
- the dataFileHandle is an instance of ExternalFileHandleInterface (i.e. the file is not controlled by Synapse)
Note that this requires an additional API call that cannot be batched, so it should be avoided in bulk  contexts if possible.`,name:"showExternalAccessIcon",required:!1,type:{name:"boolean"}},showAccessColumnHeader:{defaultValue:null,description:"",name:"showAccessColumnHeader",required:!1,type:{name:"boolean"}},showDownloadColumn:{defaultValue:null,description:"@deprecated use showDirectDownloadColumn",name:"showDownloadColumn",required:!1,type:{name:"boolean"}},hideDownload:{defaultValue:null,description:"@deprecated use hideAddToDownloadListColumn",name:"hideDownload",required:!1,type:{name:"boolean"}},showDirectDownloadColumn:{defaultValue:null,description:"If true and entity is a file view or dataset, renders a column that allows the logged-in user to directly download the file, if they have permission",name:"showDirectDownloadColumn",required:!1,type:{name:"boolean"}},hideAddToDownloadListColumn:{defaultValue:null,description:"If true, the add to download list column will be hidden",name:"hideAddToDownloadListColumn",required:!1,type:{name:"boolean"}},columnLinks:{defaultValue:null,description:"Configuration to override cell renderers with e.g. a link to a portals detail page",name:"columnLinks",required:!1,type:{name:"LabelLinkConfig"}}}}}catch{}export{Z as S,$t as u};
