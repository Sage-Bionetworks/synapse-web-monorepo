import{hl as pe,as as Y,ar as ne,a9 as se,U as he,j as e,r as c,c8 as Q,d7 as R,V as y,e5 as N,c3 as v,X as C,c5 as ge,B as j,bp as fe,hm as Te,dP as xe,_ as Ie,cs as Ce,ct as ye,b_ as re,dO as be,e3 as _e,dv as Se,bU as je}from"./iframe-SFoYirDz.js";import{u as ve}from"./useGetEntityChallenge-PMR6TiQA.js";import{d as Ee,a as ie,e as oe,u as Me}from"./useTeamMembers-GcPvWJRn.js";import{u as Ne}from"./useGetUserTeams-Mbe8IeFz.js";import{D as Re}from"./DialogBase-inZlHGFS.js";import{C as we}from"./CreateChallengeTeam-BuAI8GOa.js";import{u as z}from"./useTeam-D7DbBh-2.js";import{U as qe}from"./UserBadge-DEHXVbtz.js";import{U as Ae}from"./UserOrTeamBadge-QF8a2JC_.js";import{S as Le}from"./Search-BOn_c909.js";import{B as te}from"./Box-DGlbSIkV.js";import{R as Fe}from"./Radio-DepSv39E.js";import{D as Oe}from"./DataGrid-C9oEaHRg.js";const ke=pe();function Be(t,r){const{accessToken:i,keyFactory:s}=Y();return ne({...r,queryKey:s.getTeamListQueryKey(t.sort().join()),queryFn:()=>se.getTeamList(t,i)})}function Ve(t,r){const{accessToken:i,keyFactory:s}=Y();return ne({...r,queryKey:s.getChallengeTeamListQueryKey(t),queryFn:()=>se.getAllChallengeTeams(i,t)})}const Ue=he([e.jsx("path",{d:"m20 8-8 5-8-5v10h16zm0-2H4l8 4.99z",opacity:".3"},"0"),e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2M20 6l-8 4.99L4 6zM4 8l8 5 8-5v10H4z"},"1")]),V=c.forwardRef(function(r,i){const{teamId:s,onRequestSubmitted:o=Q}=r,[u,d]=c.useState(""),{data:a}=R(),{data:l,status:f,error:b}=z(s,{enabled:!!s}),{mutate:h}=Ee({onSuccess:()=>{o()}}),E=_=>{const T=_.target.value;d(T)};return c.useImperativeHandle(i,()=>({submit(){a&&h({teamId:s,userId:a.ownerId,message:u,expiresOn:void 0})}}),[u,h,s,a]),f==="pending"?e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):f==="error"?e.jsx(v,{severity:"error",children:b.message}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e.jsx("strong",{children:l.name})," team."]}),e.jsx(y,{children:e.jsx(ge,{label:"Your Message to Team Managers(s)",id:"membershipRequestMessage",value:u,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:E})})]})});try{V.displayName="MembershipRequestForm",V.__docgenInfo={description:"Component that provides a form that a user can use to create a MembershipRequest for a Team.\n\nTo submit the form, pass a ref and call the `submit` handle on the ref.",displayName:"MembershipRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onRequestSubmitted:{defaultValue:null,description:"",name:"onRequestSubmitted",required:!0,type:{name:"() => void"}}}}}catch{}function U(t){const{teamId:r,onSuccess:i=Q,...s}=t,{data:o}=R(),{mutate:u,isPending:d}=ie({onSuccess:()=>{i()}}),a=!o||d,l=c.useCallback(()=>{o!=null&&o.ownerId&&u({teamId:r,userId:o.ownerId})},[o==null?void 0:o.ownerId,u,r]);return e.jsx(j,{variant:"contained",disabled:a,startIcon:d?e.jsx(N,{}):void 0,...s,onClick:l,children:"Accept Invitation"})}function G(t){const{teamId:r}=t,{data:i}=R(),{data:s,status:o,error:u}=oe(i==null?void 0:i.ownerId,{enabled:!!(i!=null&&i.ownerId)}),{data:d}=z(r,{enabled:!!r});if(o==="pending")return e.jsx(N,{});if(o==="error")return e.jsx(v,{severity:"error",children:u.message});const a=s.find(l=>l.teamId===r);return a==null?e.jsxs(v,{severity:"error",children:["No matching invitation for team ",d?d.name:`ID: ${r}`]}):e.jsxs(fe,{sx:{gap:2},children:[e.jsxs(C,{variant:"body1",children:[e.jsx(qe,{userId:a.createdBy})," has invited you to join"," ",e.jsx("span",{children:e.jsx(Ae,{principalId:r})}),a.message?" with the following message:":"."]}),a.message&&e.jsx(C,{variant:"body1",component:"blockquote",children:a.message}),e.jsx(C,{variant:"body1",children:"Do you want to accept this invitation?"})]})}try{U.displayName="AcceptMembershipInvitationButton",U.__docgenInfo={description:"",displayName:"AcceptMembershipInvitationButton",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any, keyof IntrinsicElements>"}}}}}catch{}try{G.displayName="OpenMembershipInvitation",G.__docgenInfo={description:`For the current, authenticated user, displays the details of an open MembershipInvitation for the provided team ID.

This component requires
  1. The current user is logged-in
  2. The current user has an open invitation to join the teamId passed in via props

To prompt the user to accept the invitation, use the {@link AcceptMembershipInvitationButton} component.`,displayName:"OpenMembershipInvitation",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!1,type:{name:"() => void"}}}}}catch{}const D=({createdNewTeam:t,teamId:r})=>{const{data:i,status:s,error:o}=z(r,{enabled:!!r});return r?s==="pending"?e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{})}):s==="error"?e.jsx(v,{severity:"error",children:o.message}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",t?"created":"joined"," team"," ",e.jsx("b",{children:i.name})," and have been added to this challenge."]}),t&&e.jsx(y,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{D.displayName="RegistrationSuccessful",D.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string"}}}}}catch{}function H(t){const{value:r,rowCount:i,onChange:s}=t,o=i>5?"calc(100% - 8px)":"100%";return e.jsxs(te,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:o,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e.jsx(te,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e.jsx(Le,{sx:{color:"#878E95"}})}),e.jsx(Te,{value:r,onChange:s,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})}try{H.displayName="ChallengeTeamSearch",H.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function J(t){const{challengeId:r,onSelectTeam:i,selectedTeamId:s}=t,{data:o,isLoading:u}=Ve(r),{data:d}=R(),{data:a}=oe(d==null?void 0:d.ownerId,{enabled:!!(d!=null&&d.ownerId)}),[l,f]=c.useState(""),b=(o==null?void 0:o.map(n=>n.teamId))??[],{data:h,isLoading:E}=Be(b,{enabled:!!b.length}),_=c.useMemo(()=>{const n=l.toLowerCase(),w=(h==null?void 0:h.list.filter(g=>g.canPublicJoin||g.canRequestMembership!==!1||(a==null?void 0:a.some(x=>x.teamId===g.id))))??[];let p=w;return n.length&&(p=w.filter(g=>{var x;return g.name.toLowerCase().includes(n)||((x=g.description)==null?void 0:x.toLowerCase().includes(n))})),p.map(g=>({...g,hasInvitation:!!(a!=null&&a.some(x=>x.teamId===g.id))}))},[a,l,h==null?void 0:h.list]),T=u||E,M=c.useMemo(()=>[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:n})=>e.jsx(Fe,{value:n.id,checked:String(n.id)===s,onClick:()=>{i(String(n.id))},inputProps:{"aria-label":`Select ${n.name}`}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:n})=>e.jsx(Ie,{href:`${Ce(ye.PORTAL_ENDPOINT)}/Team:${n.id}`,target:"_blank",underline:"hover",children:n.name})},{field:"hasInvitation",headerName:"",width:15,filterable:!1,hideable:!1,disableColumnMenu:!0,align:"center",renderCell:({value:n})=>n?e.jsx(re,{title:"You have been invited to join this team",children:e.jsx(Ue,{fontSize:"small",sx:{color:"grey.700"}})}):null},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({value:n})=>xe(be(n),"MM/DD/YY")},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}],[i,s]);return e.jsxs(y,{sx:{height:220},children:[!T&&e.jsx(H,{value:l,onChange:n=>f(n.target.value),rowCount:_.length}),e.jsx(Oe,{initialState:{sorting:{sortModel:[{field:"hasInvitation",sort:"desc"}]}},loading:T,rows:_,columns:M,rowCount:5,hideFooter:!0,density:"compact",rowBufferPx:500,sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:n=>n.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]})}try{J.displayName="ChallengeTeamTable",J.__docgenInfo={description:`Table component that displays teams that
 1. are registered for the challenge specified by the challengeId prop
 2. the current user is able to join, create a request to join, or accept an invitation to join`,displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}const Ge='To participate in a challenge, you need to create a new Team or join an existing one.   By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.   All team members will need a Synapse account so that they can login and accept the team invitation.',P=({challengeId:t,onCreateTeam:r,selectedTeamId:i,onSelectTeam:s})=>e.jsxs(ke,{spacing:2,children:[e.jsx(C,{variant:"body1",sx:{lineHeight:"20px"},children:Ge}),e.jsx(y,{sx:{height:270},children:e.jsx(J,{challengeId:t,selectedTeamId:i,onSelectTeam:s})}),e.jsx(y,{children:e.jsx(j,{color:"primary",variant:"contained",onClick:r,startIcon:e.jsx(_e,{}),children:"Create New Team"})})]});try{P.displayName="SelectChallengeTeam",P.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string) => void"}}}}}catch{}function De(t){switch(t){case"SELECT_YOUR_CHALLENGE_TEAM":return"Select Your Challenge Team";case"ACCEPT_INVITATION":return"Invitation to Join Team";case"JOIN_REQUEST_FORM":return"Request Team Membership";case"JOIN_REQUEST_SENT":return"Request Sent";case"CREATE_NEW_TEAM":return"Create Team";case"REGISTRATION_SUCCESSFUL":return"Registration Successful!"}}function ae(t){const{projectId:r,isShowingModal:i=!1,onClose:s}=t,{accessToken:o}=Y(),u=!!o,[d,a]=c.useState("SELECT_YOUR_CHALLENGE_TEAM"),[l,f]=c.useState(),[b,h]=c.useState(!1),[E,_]=c.useState(!1),T=c.useRef(null),M=c.useRef(null),{data:n,isLoading:w}=R({enabled:u}),{data:p,isLoading:g}=ve(r),{mutateAsync:x,isPending:A,error:L}=ie(),{data:W,error:F}=Ne(p==null?void 0:p.id,1,0,{enabled:!!(u&&p)}),O=W&&W.results.length>0,{data:I,isLoading:$,error:k}=Me(l,String(n==null?void 0:n.ownerId),{enabled:u&&!!l&&!!n}),K=c.useCallback(async()=>{!l||!n||(await x({teamId:l,userId:n.ownerId}),a("REGISTRATION_SUCCESSFUL"))},[x,a,l,n]),le=c.useCallback(()=>{_(!1),f(void 0),s()},[s]),de=w||g,S=c.useMemo(()=>{switch(d){case"SELECT_YOUR_CHALLENGE_TEAM":case"JOIN_REQUEST_SENT":case"REGISTRATION_SUCCESSFUL":return e.jsx(e.Fragment,{});case"ACCEPT_INVITATION":case"JOIN_REQUEST_FORM":case"CREATE_NEW_TEAM":default:return e.jsx(j,{variant:"outlined",onClick:()=>{a("SELECT_YOUR_CHALLENGE_TEAM"),f(void 0)},children:"Back"})}},[d]),B=c.useMemo(()=>e.jsx(j,{variant:"contained",onClick:()=>{s()},children:"Close"}),[s]),{actions:ce=e.jsx(e.Fragment,{}),content:ue=e.jsx(e.Fragment,{})}=c.useMemo(()=>{if(!u)return{content:e.jsx(v,{severity:"error",children:e.jsx(Se,{})})};if(O)return{content:e.jsx(v,{severity:"error",children:e.jsx(C,{children:"You are already a member of a registered submission team for this Challenge."})})};switch(d){case"SELECT_YOUR_CHALLENGE_TEAM":{let m="Join Team",Z=!1,q=Q,ee="";return I&&I.hasOpenInvitation?(m="View Invitation to Join Team",q=()=>{a("ACCEPT_INVITATION")}):I&&I.hasOpenRequest?(m="Join Request Pending",Z=!0,ee="You have already submitted a request to join this team."):I&&I.membershipApprovalRequired?(m="Request to Join Team",q=()=>{a("JOIN_REQUEST_FORM")}):I&&I.canJoin&&(m="Join Team",q=()=>{K()}),{content:p&&!O&&e.jsx(P,{challengeId:p.id,onCreateTeam:()=>a("CREATE_NEW_TEAM"),selectedTeamId:l,onSelectTeam:me=>f(me)}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(re,{title:ee,children:e.jsx("span",{children:e.jsx(j,{onClick:q,startIcon:A?e.jsx(N,{}):void 0,disabled:!l||$||A||Z,variant:"contained",children:m})})})]})}}case"ACCEPT_INVITATION":return{content:e.jsx(G,{teamId:l}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(U,{teamId:l,onSuccess:()=>{a("REGISTRATION_SUCCESSFUL")}})]})};case"JOIN_REQUEST_FORM":return{content:e.jsx(V,{ref:T,teamId:l,onRequestSubmitted:()=>{a("JOIN_REQUEST_SENT")}}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(j,{variant:"contained",onClick:()=>{var m;(m=T==null?void 0:T.current)==null||m.submit()},children:"Send Request"})]})};case"JOIN_REQUEST_SENT":return{content:e.jsx(C,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."}),actions:e.jsxs(e.Fragment,{children:[S,B]})};case"REGISTRATION_SUCCESSFUL":return{content:e.jsx(D,{createdNewTeam:E,teamId:l}),actions:e.jsxs(e.Fragment,{children:[S,B]})};case"CREATE_NEW_TEAM":return{content:e.jsx(we,{ref:M,challengeId:p==null?void 0:p.id,onCanSubmitChange:m=>h(m),onFinished:m=>{_(!0),f(m),a("REGISTRATION_SUCCESSFUL")}}),actions:e.jsxs(e.Fragment,{children:[S,e.jsx(j,{variant:"contained",disabled:!b,onClick:()=>{var m;(m=M==null?void 0:M.current)==null||m.submit()},children:"Create Team"})]})}}},[u,O,d,l,S,B,E,I,p,A,$,K,b]),X=(L==null?void 0:L.message)||(k==null?void 0:k.message)||(F==null?void 0:F.message);return e.jsx(Re,{onCancel:le,open:i,actions:ce,title:De(d),content:e.jsx(je,{children:e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:de?e.jsx(N,{size:40}):e.jsxs(e.Fragment,{children:[ue,X&&e.jsx(v,{severity:"error",children:X})]})})})})}try{ae.displayName="ChallengeTeamWizard",ae.__docgenInfo={description:`The ChallengeTeamWizard is used to guide a user through the process of joining or creating a team for a challenge.

A required precondition is that the user is NOT on any registered submission team for the challenge.`,displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:null,description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{ae as C};
