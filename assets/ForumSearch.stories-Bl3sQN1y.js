import{an as O,r,j as e,V as F,c1 as E,al as T,X as m,dH as U,dG as D,jq as V,jr as C,js as A,jt as b,ju as M,cy as P,J as k,c6 as q,br as L,B as $}from"./iframe-DvdBRTAM.js";import{N as G}from"./NoSearchResults-Dj_MBbX-.js";import{u as K}from"./useEntity-CZLbcF9Z.js";import{c as z}from"./useForum-DWQin2dj.js";import{S as H}from"./Search-BTojMQnI.js";import{S as J}from"./SkeletonParagraph-CljYlKAw.js";import{U as X}from"./UserBadge-b2NCXEqP.js";import{I as B}from"./InputAdornment-GtQDdrds.js";import"./index-Chi_LkuB.js";import"./pickBy-C-PLJ321.js";import"./isString-sJ0BruNM.js";import"./_baseIteratee-Dv0BX8Lk.js";import"./useQueries-Cz9ppJHT.js";import"./useSuspenseQuery-0rL7Zkrv.js";import"./useInfiniteQuery-B2hHHZp9.js";import"./InfiniteQueryUtils-CKlRW-xB.js";import"./useEntityBundle-C2JsL5FI.js";import"./useUserBundle-DBtVzZkD.js";import"./SkeletonTable-ChN7ZUgX.js";import"./MenuItem-wnk0lrZ5.js";import"./Card-zdgtOjjY.js";import"./Chip-BH2X6cI_.js";const N=async s=>(await fetch(s,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text(),v=s=>{const{threadId:d,replyId:a}=s,{accessToken:o}=O(),[n,S]=r.useState(),[h,g]=r.useState(""),[u,_]=r.useState(),[R,y]=r.useState(),[f,j]=r.useState(!1);r.useEffect(()=>{(async()=>{let i;j(!0);const c=await V(d,o);if(a){const l=await C(a,o);i=await A(l.messageKey,o),y(await b(l.createdBy)),_(l)}else y(await b(c.createdBy)),i=await M(c.messageKey,o);g(await N(i.messageUrl)),S(c),j(!1)})()},[o,a,d]);const x=(p,i,c)=>{let l=`${P.PORTAL}Synapse:${i}/discussion/threadId=${p}`;return c&&(l+=`&replyId=${c}`),l};return e.jsx("div",{className:"search-result-container",children:e.jsxs(F,{sx:{display:"grid",gridTemplateColumns:"40px auto"},children:[e.jsx("div",{children:f?e.jsx(E,{variant:"circular",width:"30px",height:"30px"}):a?e.jsx(T,{icon:"replyTwoTone"}):e.jsx(T,{icon:"chatTwoTone"})}),e.jsx("div",{children:f?e.jsx(J,{numRows:4}):e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"headline3",gutterBottom:!0,children:e.jsx("a",{className:"link",href:x(n?.id,n?.projectId,u?.id),children:n?.title})}),e.jsx("div",{className:"truncated",children:e.jsx(m,{variant:"body1",gutterBottom:!0,children:h})}),e.jsxs("div",{className:"search-result-footer",children:[a?"Reply":"Thread"," by"," ",e.jsx(X,{userId:R?.ownerId})," ",U(D(u?.createdOn))]})]})})]})})};try{N.displayName="getMessage",N.__docgenInfo={description:"",displayName:"getMessage",props:{}}}catch{}try{v.displayName="DiscussionSearchResult",v.__docgenInfo={description:"",displayName:"DiscussionSearchResult",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},replyId:{defaultValue:null,description:"",name:"replyId",required:!1,type:{name:"string"}}}}}catch{}const Y=()=>e.jsxs(F,{sx:{textAlign:"center"},children:[e.jsx(G,{height:"181px",sx:{pt:"40px",pb:"10px"}}),e.jsx(m,{variant:"body1",children:"No results with this query"}),e.jsx(m,{variant:"body1Italic",children:"Search the full text of posts, replies, and titles"})]}),w=s=>{const{onSearchResultsVisible:d}=s,[a,o]=r.useState(""),[n,S]=r.useState(""),[h,g]=r.useState(!1),{data:u}=K(s.projectId,void 0,{enabled:!!s.projectId}),{data:_,isLoading:R,hasNextPage:y,isFetchingNextPage:f,fetchNextPage:j,error:x}=z(s.forumId,{searchString:n},{enabled:!!n});r.useEffect(()=>{x&&k(x.reason,"danger")},[x]);const p=_?.pages.flatMap(t=>t.matches??[])??[],i=!R&&n&&p.length==0,c=()=>{g(!1),o("")};function l(){S(a),g(!0)}return r.useEffect(()=>{d&&d(h)},[h,d]),e.jsxs("div",{className:"ForumSearch",children:[e.jsx("div",{children:e.jsx(q,{sx:t=>({[t.breakpoints.down("md")]:{width:"100%"}}),type:"search",placeholder:"Search discussions",value:a,onChange:t=>{o(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&l()},slotProps:{input:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(H,{})}),endAdornment:a&&e.jsx(B,{position:"end",children:e.jsx(L,{size:"small",onClick:()=>{c()},children:e.jsx(T,{icon:"clear",wrap:!1})})})}}})}),h&&e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[s.projectId&&u&&e.jsxs(m,{variant:"body1Italic",className:"NoResultsText",children:['No results for "',n,'" in ',u?.name]}),e.jsx(Y,{})]}),p&&e.jsxs(e.Fragment,{children:[s.projectId&&!i&&e.jsxs(m,{variant:"body1Italic",className:"ResultsText",sx:{my:2,mx:1},children:['Results for "',n,'" in ',u?.name,":"]}),p.map(t=>e.jsx("div",{children:e.jsx(v,{threadId:t.threadId,replyId:t.replyId})},`${t.forumId}-${t.threadId}-${t.replyId}`))]}),y&&e.jsx($,{variant:"contained",color:"primary",disabled:f,onClick:()=>{j()},sx:{mx:1,mt:2},children:"Load more"})]})]})};try{w.displayName="ForumSearch",w.__docgenInfo={description:"",displayName:"ForumSearch",props:{forumId:{defaultValue:null,description:"",name:"forumId",required:!0,type:{name:"string"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!1,type:{name:"string"}},onSearchResultsVisible:{defaultValue:null,description:"",name:"onSearchResultsVisible",required:!1,type:{name:"(visible: boolean) => void"}}}}}catch{}const{fn:Q}=__STORYBOOK_MODULE_TEST__,Ie={title:"Synapse/ForumSearch",component:w},I={args:{forumId:"1032",onSearchResultsVisible:Q()}};I.parameters={...I.parameters,docs:{...I.parameters?.docs,source:{originalSource:`{
  args: {
    forumId: '1032',
    onSearchResultsVisible: fn()
  }
}`,...I.parameters?.docs?.source}}};const Se=["Demo"];export{I as Demo,Se as __namedExportsOrder,Ie as default};
