import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{r as s,R as se}from"./index-Dl6G-zuu.js";import{a as me,T as ye,V as Q,W as ge,X as fe,Y as xe,Z as he,_ as Ce,$ as _e}from"./HelpPopover-B0dE4417.js";import{x as Ie,aV as Se,ag as ee}from"./SynapseClient-DRbPdjiJ.js";import"./OrientationBanner-Dih8CVog.js";import{S as te}from"./RegularExpressions-D_Bl7pBr.js";import{P as we}from"./getEndpoint-CjoHA800.js";import{E as be,u as Ee}from"./EntityLink-Cb7jDhhf.js";import{I as je,A as Re}from"./IconSvg-B_5LF0ig.js";import"./SkeletonButton-2OUtbWJw.js";import{S as Ve}from"./SkeletonTable-CULGn8eZ.js";import{p as Fe}from"./papaparse.min-D3VSFJh2.js";import{u as Te}from"./UserSearchBoxV2-ho87y9x6.js";import{M as ae}from"./TextField-BYBL0P0S.js";import{L as De}from"./Link-EkQ0dGSu.js";import{T as H}from"./Typography-B88_J_TK.js";import{C as ie}from"./FormControlLabel-CoC9JpgE.js";import{E as ke}from"./EntityFinderModal-BqBB7Hrb.js";import{V as He,F as Ne}from"./useEntitySelection-DfCsiGfy.js";import{c as ne}from"./cloneDeep-CwQXpD5Z.js";import{p as ve}from"./pluralize-CVwSCrA2.js";import{a as Me}from"./ThemesPlot-10Wj7B8X.js";import{B as g}from"./Box-DRdN2jdb.js";import{B}from"./Button-mb55Lwfk.js";import{I as re}from"./IconButton-CgTC7RgJ.js";import{I as Ae}from"./InputLabel-D0wmCbAz.js";import{M as Pe}from"./Tooltip-CYVQ1vhC.js";import{M as qe}from"./Alert-HJYNNEvY.js";import{A as Be}from"./AlertTitle-DKiwjjrh.js";import{n as Le}from"./noop-DX6rZLP_.js";function L({initialValue:r,onChange:o,options:i,delay:l=250,...c}){const[d,y]=s.useState(r);return Te(()=>{o(d)},[o,d],l),e.jsx(me,{freeSolo:!0,disablePortal:!0,isOptionEqualToValue:(f,p)=>p.length==0||f===p,options:i,value:d,onChange:(f,p)=>{y(p??"")},sx:{marginRight:"10px"},renderInput:f=>e.jsx(ae,{...f,...c,value:d,onChange:p=>y(p.target.value)})})}try{L.displayName="DebouncedInput",L.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function O({column:r,table:o}){var d;const i=(d=o.getPreFilteredRowModel().flatRows[0])==null?void 0:d.getValue(r.id),l=r.getFilterValue()??"",c=se.useMemo(()=>typeof i=="number"?[]:Array.from(r.getFacetedUniqueValues().keys()).sort(),[r.getFacetedUniqueValues()]);return e.jsx(L,{type:"text",options:c,initialValue:l,onChange:y=>r.setFilterValue(y),label:`Filter by ${r.columnDef.header} (${r.getFacetedUniqueValues().size})`})}try{O.displayName="Filter",O.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function U(r){const{cell:o}=r,{row:i}=o,{original:l}=i,{id:c,isDummy:d}=l;return d?e.jsx(De,{href:`${we.PORTAL}#!Synapse:${c}`,children:c}):e.jsx(be,{entity:l})}function z(r){const{cell:o}=r;return e.jsx(H,{variant:"body1",children:o.getContext().getValue()})}function $(r){const{cell:o}=r;return e.jsx(H,{variant:"body1",sx:{textTransform:"capitalize"},children:o.getContext().getValue()})}function G(r){const{table:o}=r;return e.jsx(ie,{checked:o.getIsAllRowsSelected(),indeterminate:o.getIsSomeRowsSelected(),onClick:o.getToggleAllRowsSelectedHandler()})}function W(r){const{row:o}=r;return e.jsx(ie,{checked:o.getIsSelected(),disabled:!o.getCanSelect(),indeterminate:o.getIsSomeSelected(),onClick:o.getToggleSelectedHandler()})}try{U.displayName="EntityHeaderNameCell",U.__docgenInfo={description:"",displayName:"EntityHeaderNameCell",props:{}}}catch{}try{z.displayName="EntityHeaderIDCell",z.__docgenInfo={description:"",displayName:"EntityHeaderIDCell",props:{}}}catch{}try{$.displayName="EntityHeaderTypeCell",$.__docgenInfo={description:"",displayName:"EntityHeaderTypeCell",props:{}}}catch{}try{G.displayName="CheckBoxHeader",G.__docgenInfo={description:"",displayName:"CheckBoxHeader",props:{}}}catch{}try{W.displayName="CheckBoxCell",W.__docgenInfo={description:"",displayName:"CheckBoxCell",props:{}}}catch{}const N=r=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_6722_37828)",children:e.jsx("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{N.displayName="AddAd",N.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function Oe(r,o,i){const[l,c]=s.useState({}),[d,y]=s.useState(ne(r)),[f,p]=s.useState(""),[v,j]=s.useState([]);s.useEffect(()=>{y(ne(r))},[r]);const S=s.useCallback(m=>{p(m),o&&o(m)},[o]),M=s.useCallback(m=>{c({}),y(m),i&&i(m),j([]),S("")},[i,S]);return{rowSelection:l,setRowSelection:c,refsInState:d,setRefsInState:M,newEntityIDs:f,setNewEntityIDs:S,parseErrors:v,setParseErrors:j}}const Ue={selectMultiple:!0,versionSelection:He.DISALLOWED,initialScope:Ne.ALL_PROJECTS,initialContainer:"root"},ze=10,oe=r=>{const{references:o,isEditable:i,disabled:l,onUpdate:c=Le,removeSelectedRowsButtonText:d="Remove Selected Rows",onUpdateEntityIDsTextbox:y,objectNameCopy:f="entity",hideTextFieldToPasteValue:p=!1,entityFinderConfiguration:v=Ue}=r,[j,S]=s.useState([]),[M,m]=s.useState(!1),{rowSelection:R,setRowSelection:le,refsInState:x,setRefsInState:w,newEntityIDs:u,setNewEntityIDs:V,parseErrors:F,setParseErrors:b}=Oe(o,y,c),A=s.useCallback(n=>{b([`Invalid Synapse ID(s): ${n.join(",")}`])},[b]),P=s.useCallback(n=>{const t=n.map(a=>({targetId:a.trim()}));w([...x,...t])},[x,w]),de=s.useCallback(()=>{u?u.includes(",")?Fe.parse(u,{complete:n=>{if(n.errors.length>0){const t=n.errors.map(a=>a.message);b(t)}else{const t=n.data[0],a=t.filter(_=>!_.trim().match(te));a.length>0?A(a):P(t)}}}):u.trim().match(te)?P([u]):A([u]):(b([]),V(""))},[P,u,A,V,b]),I=Me(ve(f)),Z=s.useMemo(()=>[{id:"select",header:G,cell:W}],[]),q=s.useMemo(()=>[{accessorFn:n=>n.name,id:"name",cell:U,header:"Name"},{accessorFn:n=>n.id,id:"id",cell:z,header:"SynID"},{accessorFn:n=>n.isDummy?"-":Ie(Se(n)),id:"type",header:"Type",cell:$,filterFn:"includesString"}],[]),ce=s.useMemo(()=>i?Z.concat(q):q,[q,i,Z]),Y=Object.keys(R).length,{data:E,isSuccess:pe,isLoading:J}=Ee(x,{throwOnError:!0}),T=s.useMemo(()=>{const n=E?E==null?void 0:E.results:[],t=new Set;n.forEach(h=>t.add(ee(h.id)));const _=x.filter(h=>!t.has(ee(h.targetId))).map(h=>({id:h.targetId,name:h.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return n.concat(_)},[x,E]),C=ye({data:T,columns:ce,state:{rowSelection:R,columnFilters:j},enableRowSelection:i,onRowSelectionChange:le,onColumnFiltersChange:S,getCoreRowModel:ge(),getFilteredRowModel:fe(),getSortedRowModel:xe(),getFacetedRowModel:he(),getFacetedUniqueValues:Ce(),getFacetedMinMaxValues:_e(),columnResizeMode:"onChange"}),ue=s.useCallback(()=>{const t=T.filter((a,_)=>R[_]!==!0).map(a=>({targetId:a.id}));w(t)},[T,R,w]),X=Y>0,D=T.length,K=C.getPrePaginationRowModel().rows.length,k=D>ze;return s.useEffect(function(){k||C.setColumnFilters([])},[C,k]),J?e.jsx(Ve,{numCols:3,numRows:Math.min(10,x.length)}):pe?e.jsxs("div",{children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",p:"12px 10px 10px 5px",children:[k&&e.jsxs(H,{variant:"body1",sx:{marginBottom:"10px"},children:[D," ",I," ",K<D?`(${K} visible)`:"",X&&e.jsx("span",{children:` (${Y} selected)`})]}),i&&x.length>0&&e.jsx(B,{variant:"contained",disabled:!X||l,onClick:ue,children:d})]}),e.jsx(g,{display:"flex",pb:2,children:C.getHeaderGroups().map(n=>n.headers.map(t=>t.isPlaceholder?null:e.jsx(se.Fragment,{children:t.column.getCanFilter()&&k?e.jsx(g,{sx:{flexGrow:1},children:e.jsx(O,{column:t.column,table:C})}):null},t.column.id)))}),D>0&&e.jsx(g,{sx:n=>({overflow:"auto",maxHeight:"250px",paddingLeft:"2px",th:{height:"38px",backgroundColor:n.palette.grey[200],zIndex:100},"tr:nth-of-type(2n)":{backgroundColor:n.palette.grey[100]}}),children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:C.getHeaderGroups().map(n=>e.jsx("tr",{children:n.headers.map(t=>{let a="5%";switch(t.id){case"name":a="50%";break;case"id":a="22%";break;case"type":a="22%";break}return e.jsxs("th",{colSpan:t.colSpan,style:{width:a,position:"sticky",top:"0px"},children:[t.isPlaceholder?null:e.jsxs(g,{display:"flex",alignItems:"center",children:[Q(t.column.columnDef.header,t.getContext()),e.jsx(g,{mx:"auto"}),t.column.getCanSort()&&e.jsx(re,{onClick:t.column.getToggleSortingHandler(),size:"small",sx:{marginLeft:"auto",marginRight:"16px"},children:e.jsx(je,{icon:t.column.getIsSorted()==="asc"?"sortUp":"sortDown",wrap:!1,fontSize:"inherit",sx:{color:t.column.getIsSorted()?"primary.main":"grey.700",backgroundColor:"none"}})})]}),t.column.getCanResize()&&e.jsx("div",{className:`resizer ${t.column.getIsResizing()?"isResizing":""}`,onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler()})]},t.id)})},n.id))}),e.jsx("tbody",{children:C.getRowModel().rows.map(n=>e.jsx("tr",{style:{height:"30px"},children:n.getVisibleCells().map(t=>e.jsx("td",{style:{width:t.column.getSize()},children:Q(t.column.columnDef.cell,t.getContext())},t.id))},n.id))})]})}),e.jsx(ke,{configuration:v,promptCopy:`Select ${I} to add to the Synapse ID list`,show:M,title:`Select ${I}`,confirmButtonCopy:`Add ${I}`,onConfirm:n=>{if(p){const t=[...x,...n];w(t),c(t)}else{const t=n.map(h=>h.targetId),_=(u.trim().length>0?u.concat(","):u).concat(t.join(","));V(_)}m(!1)},onCancel:()=>m(!1)}),i&&e.jsxs(g,{sx:{marginTop:"10px"},children:[p&&e.jsxs(B,{variant:"outlined",onClick:()=>{m(!0)},startIcon:e.jsx(N,{}),disabled:l,children:["Add ",I]}),!p&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{htmlFor:"synIDs",children:"Add Synapse IDs"}),e.jsxs(g,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[e.jsx(ae,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:n=>{V(n.target.value)},value:u,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')",disabled:l}),e.jsx(g,{sx:{padding:"5px 0px 0px 5px"},children:e.jsx(Pe,{title:"Add a Synapse ID to the list via the Entity Finder",children:e.jsx(re,{disabled:l,onClick:()=>{m(!0)},children:e.jsx(N,{})})})}),e.jsxs(B,{variant:"outlined",onClick:de,disabled:J||u.trim().length==0||l,startIcon:e.jsx(Re,{}),children:["Add ",I]})]})]}),F&&F.length>0&&e.jsxs(qe,{severity:"error",sx:{my:2},children:[e.jsx(Be,{children:"Parsing errors encountered:"}),e.jsx("ul",{children:F.map((n,t)=>e.jsx(H,{component:F.length>1?"li":"span",lineHeight:1.5,variant:"smallText1",children:n},t))})]})]})]}):e.jsx(e.Fragment,{})};try{oe.displayName="EntityHeaderTable",oe.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((updatedRefs: ReferenceList) => void)"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"((value: string) => void)"}},objectNameCopy:{defaultValue:null,description:"",name:"objectNameCopy",required:!1,type:{name:"string"}},hideTextFieldToPasteValue:{defaultValue:null,description:"",name:"hideTextFieldToPasteValue",required:!1,type:{name:"boolean"}},entityFinderConfiguration:{defaultValue:null,description:"",name:"entityFinderConfiguration",required:!1,type:{name:'Omit<EntityFinderProps, "onSelectedChange">'}}}}}catch{}export{oe as E};
