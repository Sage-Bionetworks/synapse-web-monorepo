var z=Object.defineProperty;var J=(o,c,t)=>c in o?z(o,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[c]=t;var h=(o,c,t)=>(J(o,typeof c!="symbol"?c+"":c,t),t);import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{r as S,R}from"./index-Dl6G-zuu.js";import{C as $}from"./ChallengeRegisterButton-B6e9NuoH.js";import{C as W}from"./ChallengeTeamWizard-Dy-6BLwq.js";import{k,I as D,U as Y,bw as Q,p as u,bx as N,by as K,bz as X}from"./SynapseClient-DhKwb7ze.js";import"./OrientationBanner-Dih8CVog.js";import"./getEndpoint-CjoHA800.js";import{u as P}from"./useGetEntityChallenge-DLYCr0nI.js";import{u as Z}from"./useGetUserTeams-CIqI4Jf9.js";import{b as ee,c as te,d as re}from"./useTeamMembers-y0gmqbM-.js";import{A as ne,C as ie,L as se,G as oe}from"./HelpPopover-DvC-H6Hv.js";import{d as L}from"./ToastMessage-CsPwcNWl.js";import"./AccessTokenPage-D1n_p3zL.js";import"./AccountLevelBadges-DtvQd0X4.js";import"./LastLoginInfo-D6m3_SbJ.js";import"./StandaloneLoginForm-4X5EFRNG.js";import"./TwoFactorAuthSettingsPanel-DrM68mIj.js";import"./TwoFactorEnrollmentForm-D8rrK9G3.js";import"./TwoFactorBackupCodes-DLGV3W8d.js";import"./Constants-YkhgpLsv.js";import"./CertificationQuiz-9Gg1Sk8G.js";import"./index-CUX4iJUP.js";import"./AvailableEvaluationQueueList-92KW85-v.js";import"./ChallengeSubmission-4EXTmmaR.js";import"./useChangePasswordFormState-eZZGXJ4D.js";import"./ChangePasswordWithToken-BrBOz2CE.js";import"./FullWidthAlert-DFaJ0Nkn.js";import"./DownloadCartPage-Del2ONgv.js";import"./ShowDownloadV2--N6RWBUw.js";import"./useEntitySelection-BQ-sAEce.js";import"./isPlainObject-Bs6xKDnB.js";import"./mapValues-BliEdlJP.js";import"./uniq-0oAaZ0Sl.js";import"./styled-OgyJf9MH.js";import"./EvaluationCard-DVg4JceY.js";import"./EvaluationEditorPage-Cqyiquzm.js";import"./ExperimentalMode-ag5cQx5U.js";import{R as ae,F as le}from"./index-Pxtlv3yl.js";import{O as ce}from"./IconSvg-BQOE5FOT.js";import"./FileUpload-BEMCIN3I.js";import"./FeaturedDataTabs-izQa1ls7.js";import"./FeaturedToolsList-BE2US90E.js";import"./DiscussionThread-D82jKTdA.js";import"./ForumPage-Dz02OzsF.js";import"./Goals-nkt91M46.js";import"./GoogleMap-gSh8Xulz.js";import"./Icon-C1dU0jmq.js";import"./OAuthManagement-DlvkMTxE.js";import"./ThemesPlot-C-gYglGo.js";import"./UpsetPlot-Bgx4fIjj.js";import"./ProjectViewCarousel-ChgPS40x.js";import"./Programs-Cy6NoORD.js";import"./QueryCount-BjznCpkS.js";import"./RenderIfInView-DZNTcvvm.js";import"./Resources-Cp3LMIat.js";import"./AccessRequirementAclEditor-B-E1Gw0q.js";import"./RssFeedCards-BW7iiu2c.js";import"./ShowMore-DozljGbX.js";import"./SkeletonButton-2OUtbWJw.js";import"./SkeletonTable-CULGn8eZ.js";import"./LeftRightPanel-DwKmO81x.js";import"./LightTooltip-MfbtOvTK.js";import"./StyledFormControl-BNgdB6B_.js";import"./WideButton-D5-h12qa.js";import"./InputSizedButton-BdA8J1bf.js";import"./SubscriptionItem-q0Jkz_3J.js";import"./DropdownSelect-Yw82a5Qm.js";import"./SubsectionRowRenderer-Dn8F_llC.js";import"./SynapseFormWrapper-DXXy5p8U.js";import"./SynapseFormSubmissionGrid-CX7CFRiP.js";import"./SystemUseNotification-Bs40tZIU.js";import"./TableFeedCards-P2bzwg3s.js";import"./TermsAndConditions-BhFmQQqc.js";import"./TextField-BYZwcPau.js";import"./TimelinePlot-Dl6jeC2e.js";import"./UserBadge-B4kMvK9Y.js";import"./UserCardList-Ib8JSHd3.js";import"./UserCardListRotate-CB_iCLF2.js";import"./UserCardListGroups-GmPbRjmM.js";import"./UserOrTeamBadge-CiuKWMP3.js";import"./UserProfileLinks-CYu_LpX0.js";import"./EntityHeaderTable-CQYaOR92.js";import"./AccessRequirementRelatedProjectsList-2FFfb5o7.js";import{j as me,k as de}from"./useAccessRequirements-jjo52Y94.js";import{u as pe}from"./useEntity-C6GwlDAY.js";import{S as ue}from"./LoadingScreen-Cp1NTgGu.js";import{M as he}from"./Alert-HJYNNEvY.js";import{T as fe}from"./Typography-B88_J_TK.js";import{B as v}from"./Button-mb55Lwfk.js";function _(o){const{open:c,projectId:t,onRegisterComplete:i,onCancel:n}=o,{data:s,error:l}=pe(t),{accessToken:a}=k(),{data:r,error:m}=P(t),g=!!a,{data:y,error:d}=D({enabled:g}),p=r==null?void 0:r.participantTeamId,x=y==null?void 0:y.ownerId,{data:f,error:b}=ee(p,x,{enabled:!!(p&&x)}),{mutateAsync:T,isPending:F,error:j}=te(),{data:C,isSuccess:A,error:M}=me(r==null?void 0:r.participantTeamId,{enabled:!!(r!=null&&r.participantTeamId)}),V=de((C==null?void 0:C.map(E=>String(E.id)))??[]),O=A&&V.every(E=>E.status==="success"&&E.data.isApproved),B=S.useCallback(async()=>{p&&x&&!(f!=null&&f.isMember)&&await T({teamId:p,userId:x}),i()},[T,i,p,f==null?void 0:f.isMember,x]),w=[l,m,d,b,M,j].filter(E=>!!E);let q=f!=null&&f.isMember?"Continue":"Register";return F&&(q="Registering..."),Y(w)?!p||!c?e.jsx(e.Fragment,{}):e.jsx(ne,{dialogTitle:"Challenge Terms and Conditions",subjectId:p,subjectType:ae.TEAM,teamId:r==null?void 0:r.participantTeamId,renderAsModal:!0,requestObjectName:s==null?void 0:s.name,onHide:()=>{n()},customDialogActions:e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outlined",onClick:n,children:"Cancel"}),e.jsx(v,{variant:"contained",onClick:()=>{B()},startIcon:F?e.jsx(ue,{}):void 0,disabled:!O||F,children:q})]})}):e.jsx(he,{severity:"error",children:w.map((E,G)=>e.jsx(fe,{variant:"body1",children:E.reason},G))})}try{_.displayName="ChallengeRequirementsModal",_.__docgenInfo={description:`The challenge requirements modal will
 1. Display the access requirements that must be accepted to join a participant team. The component will guide the user through meeting the requirements.
 2. If the user has accepted the requirements, the user can click 'Register' to join the team
    If the user has not accepted the requirements, the user cannot register for the challenge.`,displayName:"ChallengeRequirementsModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},onRegisterComplete:{defaultValue:null,description:"",name:"onRegisterComplete",required:!0,type:{name:"() => void"}}}}}catch{}function U({projectId:o}){const{accessToken:c}=k(),t=!!c,[i,n]=S.useState(!1),[s,l]=S.useState(!1),[a,r]=S.useState(!1),{data:m}=D(),g=C=>{n(C)},y=()=>{l(!0)},d=()=>{r(!0)},{data:p}=P(o),{data:x}=Z(p==null?void 0:p.id,1,0,{enabled:!!(t&&p)}),f=x&&x.results.length>0,{mutate:b}=re({onSuccess:()=>{L("You are no longer registered for this challenge","info")},onError:C=>{L(C.reason,"danger")}}),T=()=>{t&&p&&m&&b({teamId:p.participantTeamId,userId:m.ownerId})},F=()=>{l(!1)},j=()=>{l(!1),n(!f)};return e.jsxs(e.Fragment,{children:[e.jsx($,{projectId:o,onJoinClick:y,onLeaveClick:d}),e.jsx(_,{open:s,projectId:o,onRegisterComplete:j,onCancel:F}),e.jsx(W,{projectId:o,onClose:()=>{g(!1)},isShowingModal:i}),e.jsx(ie,{open:a,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>r(!1),onConfirm:()=>{T(),r(!1)}})]})}try{U.displayName="ChallengeDetailPage",U.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}class I extends R.Component{constructor(t){super(t);h(this,"formRef");h(this,"submitForm",()=>{this.formRef.current.submit()});h(this,"refresh",()=>{if(this.context.accessToken){const t=[u.getUserProfile(this.context.accessToken),u.getEntity(this.context.accessToken,this.props.formSchemaEntityId),u.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(t).then(i=>{const n=i[0];this.getTargetContainer(n,this.context.accessToken).then(s=>{const l=i[1],a=i[2];this.getSchemaFileContent(s,l,a)})}).catch(i=>{this.onError(i)})}});h(this,"getSchemaFileContent",(t,i,n)=>{const s=[u.getFileResult(i,this.context.accessToken,!0,!0),u.getFileResult(n,this.context.accessToken,!0,!0)];Promise.all(s).then(l=>{try{const a=l.map(r=>N(r.fileHandle,r.preSignedURL));Promise.all(a).then(r=>{const m=JSON.parse(r[0]),g=JSON.parse(r[1]);this.getExistingFileData(t,m,g)}).catch(r=>{console.log("getSchemaFileContent: Error getting form content",r)})}catch(a){console.log("getSchemaFileContent: Error getting schema content",a)}}).catch(l=>{this.onError(l)})});h(this,"getExistingFileData",(t,i,n)=>{const l={entityName:`${i.title}.json`,parentId:t};let a,r;u.lookupChildEntity(l,this.context.accessToken).then(m=>u.getEntity(this.context.accessToken,m.id).then(g=>(r=g,this.props.initFormData?u.getFileResult(r,this.context.accessToken,!0,!0).then(async y=>{try{const d=await N(y.fileHandle,y.preSignedURL);a=JSON.parse(d)}catch(d){console.log("getExistingFileData: Error setting form data",d)}}):Promise.resolve()))).finally(()=>{this.setState({formData:a,currentFileEntity:r,formSchema:i,formUiSchema:n})})});h(this,"getTargetContainer",async(t,i)=>{const n={entityName:t.ownerId,parentId:this.props.parentContainerId};try{const s=await u.lookupChildEntity(n,i);return console.log(`EntityForm uploading to https://www.synapse.org/#!Synapse:${s.id}`),this.setState({userprofile:t,containerId:s.id,isLoading:!1}),s.id}catch(s){return s.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(s)}});h(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});h(this,"onError",t=>{this.setState({error:t,isLoading:!1,successfullyUploaded:!1})});h(this,"onSubmit",({formData:t})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const i=new Blob([JSON.stringify(t)],{type:"text/json"});this.createEntityFile(i)});h(this,"createEntityFile",t=>{const i=`${this.state.formSchema.title}.json`;u.uploadFile(this.context.accessToken,i,t).then(n=>{const s=n.fileHandleId;if(this.state.currentFileEntity){const a={...this.state.currentFileEntity,dataFileHandleId:s};return this.setState({currentFileEntity:a}),u.updateEntity(a,this.context.accessToken)}const l={parentId:this.state.containerId,name:i,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:s};return u.createEntity(l,this.context.accessToken)}).then(n=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(n.id)}).catch(n=>{this.onError(n)})});this.formRef=R.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return e.jsxs("div",{children:[this.state.error&&e.jsxs("div",{className:"panel panel-danger errors",children:[e.jsx("div",{className:"panel-heading",children:e.jsx("h3",{className:"panel-title",children:"Error"})}),e.jsx("ul",{className:"list-group",children:e.jsxs("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&e.jsx(se,{validator:oe,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:e.jsx("div",{style:{display:"none"},children:e.jsx("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&e.jsxs(R.Fragment,{children:[e.jsx("span",{children:"Savingâ€¦"}),e.jsx("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}h(I,"contextType",Q);try{I.displayName="EntityForm",I.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}try{I.contextType.displayName="EntityForm.contextType",I.contextType.__docgenInfo={description:`Context lets components pass information deep down without explicitly
passing props.

Created from {@link createContext}`,displayName:"EntityForm.contextType",props:{}}}catch{}const H=o=>{const{accessToken:c}=k(),{synId:t,className:i}=o,[n,s]=S.useState(void 0);S.useEffect(()=>{(async()=>{try{const m=await u.getEntity(c,t);if(!K(m))throw new Error(`File Entity expected but found ${m}`);const g={requestedFiles:[{associateObjectId:t,associateObjectType:le.FileEntity,fileHandleId:m.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},d=(await u.getFiles(g,c)).requestedFiles[0].fileHandle;if(d&&X(d))s({externalFileHandle:d,fileEntity:m});else throw new Error(`Not an external file handle: ${d==null?void 0:d.id}`)}catch(m){console.error("Error on getting external file handle = ",m)}})()},[t,c]);const l=n==null?void 0:n.externalFileHandle,a=n==null?void 0:n.fileEntity;return l?e.jsx("a",{href:l.externalURL,className:i,target:"_blank",rel:"noopener noreferrer",children:e.jsxs("span",{children:[a==null?void 0:a.name,e.jsx(ce,{style:{marginLeft:5}})]})}):e.jsx(e.Fragment,{})};try{H.displayName="ExternalFileHandleLink",H.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{U as C};
