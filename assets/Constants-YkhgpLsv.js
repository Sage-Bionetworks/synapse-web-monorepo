import{r as I,R as w}from"./index-Dl6G-zuu.js";import{I as z,J as de,K as ce,g as pe,N as X,Q as me}from"./SynapseConstants-BdplthnD.js";import{u as J}from"./useMutation-0IPuWcM5.js";import{p as P}from"./SynapseClient-DhKwb7ze.js";import{g as re,B as ae}from"./getEndpoint-CjoHA800.js";import{j as i}from"./jsx-runtime-Du8NFWEI.js";import"./OrientationBanner-Dih8CVog.js";import{F as fe}from"./FullWidthAlert-DFaJ0Nkn.js";import{T as H}from"./TextField-BYZwcPau.js";import{L}from"./Link-EkQ0dGSu.js";import{B as Y}from"./Button-mb55Lwfk.js";import{L as M}from"./LoginMethodButton-BwzAif3x.js";import{B as V}from"./Box-DRdN2jdb.js";import{s as ge}from"./styled-OgyJf9MH.js";import{M as Oe}from"./TextField-BYBL0P0S.js";import{I as he}from"./IconSvg-BQOE5FOT.js";import{I as Ee}from"./IconButton-CgTC7RgJ.js";function Ke(t,r){const[s,a]=I.useState("CHOOSE_AUTH_METHOD"),[c,n]=I.useState(),[l,u]=I.useState(),[h,p]=I.useState();I.useEffect(()=>{const d=new URL(window.location.href.replaceAll("#","/")),{searchParams:_}=d;if(_){const S=_.get("userId"),O=_.get("twoFaToken");S&&O&&(u(parseInt(S,10)),p(O),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(s)||a("VERIFICATION_CODE"))}},[s]),I.useEffect(()=>{r&&(p(r.twoFaToken),u(r.userId),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(s)||a("VERIFICATION_CODE"))},[r]),I.useEffect(()=>{n(void 0)},[s]);async function y(d){await P.setAccessTokenCookie(d.accessToken),localStorage.setItem(z,d.authenticationReceipt),a("LOGGED_IN"),t&&t()}const{mutate:U,isPending:x}=J({mutationFn:({username:d,password:_,authenticationReceipt:S})=>P.login(d,_,S),onError:d=>{n(d.reason)},onSuccess:async d=>{d&&("errorCode"in d?(a("VERIFICATION_CODE"),p(d.twoFaToken),u(d.userId)):await y(d))}}),{mutate:D,isPending:v}=J({mutationFn:P.loginWith2fa,onError:d=>{n(d.reason),(d.reason.includes("The provided twoFaToken is invalid")||d.reason.includes("Token has expired"))&&(console.warn(d),n("Something went wrong. Refresh the page and try again."),window.location.href.includes("twoFaToken")&&window.history.replaceState({},document.title,window.location.href.replaceAll(/(twoFaToken|userId)=[^&]*&?/g,"")))},onSuccess:y});return{step:s,onStepChange:a,submitUsernameAndPassword:(d,_)=>{n(void 0);const S=localStorage.getItem(z);U({username:d,password:_,authenticationReceipt:S})},submitOneTimePassword:(d,_=s==="RECOVERY_CODE"?"RECOVERY_CODE":"TOTP")=>{if(n(void 0),h==null||l==null){n("You did not first log in with your password or a third-party identity provider.");return}D({userId:l,twoFaToken:h,otpCode:d,otpType:_})},errorMessage:c,isLoading:x||v}}function j(t){const{resetPasswordUrl:r=`${re(ae.PORTAL_ENDPOINT)}#!PasswordReset:0`,onSubmit:s,isLoading:a}=t,[c,n]=I.useState(""),[l,u]=I.useState("");function h(p){p.preventDefault(),s(c,l)}return i.jsxs("form",{onSubmit:p=>{h(p)},children:[i.jsx(H,{required:!0,fullWidth:!0,autoFocus:!0,autoComplete:"username",label:"Username or Email Address",id:"username",type:"text",value:c,onChange:p=>n(p.target.value)}),i.jsx(H,{required:!0,fullWidth:!0,autoComplete:"current-password",label:"Password",id:"current-password",type:"password",value:l,onChange:p=>u(p.target.value)}),i.jsx(L,{href:r,children:"Forgot password?"}),i.jsx(Y,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",disabled:a,sx:{height:"50px",mt:4,mb:2},children:a?"Logging you in...":"Sign in"})]})}try{j.displayName="UsernamePasswordForm",j.__docgenInfo={description:"",displayName:"UsernamePasswordForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(username: string, password: string) => void"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function B(t){const{onBeginOAuthSignIn:r,ssoRedirectUrl:s,onSelectUsernameAndPassword:a,state:c}=t;function n(l,u){r&&r(),l.preventDefault();const h=s?`${s}${u}`:`${P.getRootURL()}?provider=${u}`;P.oAuthUrlRequest(u,h,c).then(p=>{window.location=p.authorizationUrl}).catch(p=>{console.log("Error on oAuth url ",p)})}return i.jsxs(V,{children:[i.jsx(M,{loginMethod:de,iconName:"google24",onClick:l=>{n(l,X.GOOGLE)}}),i.jsx(M,{loginMethod:ce,iconName:"orcid",onClick:l=>{n(l,X.ORCID)}}),i.jsx(M,{loginMethod:pe,iconName:"email",onClick:a})]})}try{B.displayName="AuthenticationMethodSelection",B.__docgenInfo={description:`To support Google SSO in your portal, you must add your domain to the Authorized Redirect URIs for Synapse authentication.
This can be done by visiting https://sagebionetworks.jira.com/servicedesk/customer/portal/9 to set up a collaboration.
Synapse engineers must add your redirect URL in the Google API console found at https://console.cloud.google.com/ for this functionality to work.`,displayName:"AuthenticationMethodSelection",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},onSelectUsernameAndPassword:{defaultValue:null,description:"",name:"onSelectUsernameAndPassword",required:!0,type:{name:"() => void"}},state:{defaultValue:null,description:"",name:"state",required:!1,type:{name:"OAuth2State"}}}}}catch{}const _e=ge(Oe)`
  input {
    text-align: center;
  }
`,Ce={TextFieldStyled:_e},Te=t=>i.jsx(Ce.TextFieldStyled,{...t}),F={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace",home:"Home",end:"End"};function ye(t,r){return t<=0?[]:Array.from({length:t},r)}function Se(t,r,s){return t.map((a,c)=>r===c?s:a)}function Q(t){return t.join("")}function Z(t,r){return[...t,r]}function Re(t,r,s){return t.reduce((a,c,n)=>{const{characters:l,restArrayMerged:u}=a;if(n<s)return{restArrayMerged:u,characters:Z(l,c)};const[h,...p]=u;return{restArrayMerged:p,characters:Z(l,h||"")}},{restArrayMerged:r,characters:[]}).characters}function Ae(t){return t.split("")}function ee(t){const r=w.useRef(()=>{throw new Error("Cannot call an event handler while rendering.")});return w.useInsertionEffect(()=>{r.current=t}),w.useCallback((...s)=>{var a;return(a=r.current)==null?void 0:a.call(r,...s)},[])}const Ie=()=>!0,we=w.forwardRef((t,r)=>{const{value:s="",length:a=4,autoFocus:c=!1,onChange:n,TextFieldsProps:l,onComplete:u,validateChar:h=Ie,className:p,onBlur:y,...U}=t,x=w.useRef(s),D=ee(u),v=ee(e=>{const o=e.slice(0,a);return{isCompleted:o.length===a,finalValue:o}});w.useEffect(()=>{const{isCompleted:e,finalValue:o}=v(x.current);e&&D(o)},[a,D,v]);const C=ye(a,(e,o)=>({character:s[o]||"",inputRef:w.createRef()})),b=e=>C.findIndex(({inputRef:o})=>o.current===e),d=()=>C.map(({character:e})=>e),_=(e,o)=>{const m=Se(d(),e,o);return Q(m)},S=e=>{var o,m;(m=(o=C[e])==null?void 0:o.inputRef.current)==null||m.focus()},O=e=>{var o,m;(m=(o=C[e])==null?void 0:o.inputRef.current)==null||m.select()},$=e=>{e+1!==a&&(C[e+1].character?O(e+1):S(e+1))},K=(e,o)=>typeof h!="function"?!0:h(e,o),ie=e=>{const o=b(e.target);if(o===0&&e.target.value.length>1){const{finalValue:A,isCompleted:N}=v(e.target.value);n==null||n(A),N&&(u==null||u(A)),O(A.length-1);return}const m=e.target.value[0]||"";let E=m;E&&!K(E,o)&&(E="");const f=_(o,E);n==null||n(f);const{isCompleted:R,finalValue:T}=v(f);R&&(u==null||u(T)),E!==""?f.length-1<o?O(f.length):$(o):m===""&&f.length<=o&&O(o-1)},se=e=>{const o=e.target,m=o.selectionStart,E=o.selectionEnd,f=b(o),R=m===0&&E===0;if(o.value===e.key)e.preventDefault(),$(f);else if(F.backspace===e.key){if(!o.value)e.preventDefault(),O(f-1);else if(R){e.preventDefault();const T=_(f,"");n==null||n(T),T.length<=f&&O(f-1)}}else F.left===e.key?(e.preventDefault(),O(f-1)):F.right===e.key?(e.preventDefault(),O(f+1)):F.home===e.key?(e.preventDefault(),O(0)):F.end===e.key&&(e.preventDefault(),O(C.length-1))},ue=e=>{const o=e.clipboardData.getData("text/plain"),m=e.target,E=C.findIndex(({character:g,inputRef:k})=>g===""||k.current===m),f=d(),R=Re(f,Ae(o),E).map((g,k)=>K(g,k)?g:""),T=Q(R);n==null||n(T);const{isCompleted:A,finalValue:N}=v(T);A?(u==null||u(N),O(a-1)):O(T.length)},le=e=>{if(!C.some(({inputRef:o})=>o.current===e.relatedTarget)){const{isCompleted:o,finalValue:m}=v(s);y==null||y(m,o)}};return i.jsx(V,{display:"flex",gap:"20px",alignItems:"center",ref:r,className:`MuiOtpInput-Box ${p||""}`,...U,children:C.map(({character:e,inputRef:o},m)=>{const{onPaste:E,onFocus:f,onKeyDown:R,className:T,onBlur:A,...N}=typeof l=="function"?l(m)||{}:l||{};return i.jsx(Te,{autoFocus:c?m===0:!1,autoComplete:"one-time-code",value:e,inputRef:o,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${m+1} ${T||""}`,onPaste:g=>{g.preventDefault(),ue(g),E==null||E(g)},onFocus:g=>{g.preventDefault(),g.target.select(),f==null||f(g)},onChange:ie,onKeyDown:g=>{se(g),R==null||R(g)},onBlur:g=>{A==null||A(g),le(g)},...N},m)})})}),te=6,De=["0","1","2","3","4","5","6","7","8","9"];function q(t){const{onSubmit:r,isLoading:s}=t,[a,c]=w.useState("");return i.jsxs(V,{children:[i.jsx(we,{autoFocus:!0,length:te,value:a,onChange:c,onComplete:r,validateChar:n=>De.includes(n)||n==="",gap:"2px",sx:{mx:"auto",maxWidth:"350px",".MuiInputBase-root":{paddingLeft:"5px",paddingRight:"5px"},".MuiFormControl-root:first-of-type > .MuiInputBase-root":{borderTopRightRadius:0,borderBottomRightRadius:0},".MuiFormControl-root:last-of-type > .MuiInputBase-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},".MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root":{borderRadius:0}}}),i.jsx(Y,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:a.length!==te||s,onClick:n=>{n.preventDefault(),r(a)},children:s?"Verifying...":"Submit"})]})}try{q.displayName="TOTPForm",q.__docgenInfo={description:"",displayName:"TOTPForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}const ve=19;function G(t){const{onSubmit:r,isLoading:s}=t,[a,c]=w.useState("");return i.jsxs(V,{children:[i.jsx(H,{placeholder:"Enter backup code",value:a,onChange:n=>{const l=n.target.value.toLowerCase().replace(/[^a-z0-9-]/gi,"");c(l)}}),i.jsx(Y,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:a.length!==ve||s,onClick:n=>{n.preventDefault(),r(a)},children:s?"Verifying...":"Submit"})]})}try{G.displayName="RecoveryCodeForm",G.__docgenInfo={description:"",displayName:"RecoveryCodeForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function W(t){const{step:r,isLoading:s,onSubmit:a,onClickUseBackupCode:c,onClickUseTOTP:n}=t;return i.jsxs(i.Fragment,{children:[r==="VERIFICATION_CODE"&&i.jsxs(i.Fragment,{children:[i.jsx(q,{isLoading:s,onSubmit:l=>{a(l,"TOTP")}}),i.jsx(L,{align:"center",color:"grey.700",sx:{display:"block",mx:"auto"},onClick:()=>{c()},children:"Use a backup code instead"})]}),r==="RECOVERY_CODE"&&i.jsxs(i.Fragment,{children:[i.jsx(G,{isLoading:s,onSubmit:l=>{a(l,"RECOVERY_CODE")}}),i.jsx(L,{align:"center",color:"grey.700",sx:{display:"block",mx:"auto"},onClick:()=>{n()},children:"Use authenticator app instead"})]})]})}try{W.displayName="OneTimePasswordForm",W.__docgenInfo={description:`Component that allows the user to enter a one-time password second authentication factor,
such as a timed one-time password (TOTP) generated using a shared secret, or a single-use recovery code.`,displayName:"OneTimePasswordForm",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'}]}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onClickUseTOTP:{defaultValue:null,description:"",name:"onClickUseTOTP",required:!0,type:{name:"() => void"}},onClickUseBackupCode:{defaultValue:null,description:"",name:"onClickUseBackupCode",required:!0,type:{name:"() => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(code: string, otpType: TwoFactorAuthOtpType) => void"}}}}}catch{}function ne(t){const{ssoRedirectUrl:r,ssoState:s,registerAccountUrl:a=`${re(ae.PORTAL_ENDPOINT)}#!RegisterAccount:0`,resetPasswordUrl:c,onBeginOAuthSignIn:n,onStepChange:l,step:u,submitUsernameAndPassword:h,submitOneTimePassword:p,errorMessage:y,isLoading:U}=t;return i.jsxs(i.Fragment,{children:[u=="CHOOSE_AUTH_METHOD"&&i.jsx(B,{onSelectUsernameAndPassword:()=>l("USERNAME_PASSWORD"),onBeginOAuthSignIn:n,ssoRedirectUrl:r,state:s}),u==="USERNAME_PASSWORD"&&i.jsx(j,{isLoading:U,resetPasswordUrl:c,onSubmit:(x,D)=>{h(x,D)}}),(u==="VERIFICATION_CODE"||u==="RECOVERY_CODE")&&i.jsx(W,{step:u,isLoading:U,onSubmit:(x,D)=>{p(x,D)},onClickUseTOTP:()=>{l("VERIFICATION_CODE")},onClickUseBackupCode:()=>{l("RECOVERY_CODE")}}),(u==="CHOOSE_AUTH_METHOD"||u==="USERNAME_PASSWORD")&&i.jsx(V,{sx:{display:"flex",justifyContent:"center",mt:"10px"},children:i.jsx(L,{href:a,align:"center",children:"Don't have an account? Create one now"})}),y&&i.jsx(fe,{variant:"warning",isGlobal:!1,description:y})]})}try{ne.displayName="LoginForm",ne.__docgenInfo={description:"",displayName:"LoginForm",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},registerAccountUrl:{defaultValue:null,description:"",name:"registerAccountUrl",required:!1,type:{name:"string"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | ONE_TIME_PASSWORD_STEP | "LOGGED_IN") => void'}},twoFactorAuthenticationRequired:{defaultValue:null,description:"",name:"twoFactorAuthenticationRequired",required:!1,type:{name:"TwoFactorAuthErrorResponse"}},submitUsernameAndPassword:{defaultValue:null,description:"",name:"submitUsernameAndPassword",required:!0,type:{name:"(username: string, password: string) => void"}},submitOneTimePassword:{defaultValue:null,description:"",name:"submitOneTimePassword",required:!0,type:{name:"(code: string, otpType?: TwoFactorAuthOtpType | undefined) => void"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!0,type:{name:"string | undefined"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},ssoState:{defaultValue:null,description:"",name:"ssoState",required:!1,type:{name:"OAuth2State"}}}}}catch{}function xe(t){switch(t){case"CHOOSE_AUTH_METHOD":return"CHOOSE_AUTH_METHOD";case"USERNAME_PASSWORD":return"CHOOSE_AUTH_METHOD";case"VERIFICATION_CODE":return"CHOOSE_AUTH_METHOD";case"RECOVERY_CODE":return"VERIFICATION_CODE";case"LOGGED_IN":return"LOGGED_IN"}}function oe(t){const{step:r,onStepChange:s,sx:a}=t;return r==="USERNAME_PASSWORD"||r==="VERIFICATION_CODE"||r==="RECOVERY_CODE"?i.jsx(Ee,{className:me,type:"button",onClick:()=>{s(xe(r))},sx:a,children:i.jsx(he,{icon:"arrowBack",wrap:!1,sx:{height:"24px",width:"24px"}})}):null}try{oe.displayName="LoginFlowBackButton",oe.__docgenInfo={description:"",displayName:"LoginFlowBackButton",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | ONE_TIME_PASSWORD_STEP | "LOGGED_IN") => void'}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps"}}}}}catch{}const ze="Enter the 6-digit, time-based verification code provided by your authenticator app.",Xe="Enter a one-time backup code. Your backup code is a 16 digit code, with groups of 4 letters or numbers separated by hyphens.";export{oe as L,W as O,Xe as R,ze as T,ne as a,Ke as u};
