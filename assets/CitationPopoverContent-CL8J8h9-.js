import{r as l}from"./index-kWfO1b8W.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{u as F}from"./useQuery-BSWJfU5w.js";import{C as I}from"./Close-GTAtPIZU.js";import{C as E}from"./CopyToClipboardIcon-zTSP8elP.js";import{P as k}from"./Popover-Cg69tTCq.js";import{S as L}from"./Stack-BhLVBw8q.js";import{B as p}from"./Box-slc6oXgZ.js";import{T as m}from"./Typography-BV-cLTY-.js";import{A as B}from"./Alert-D-pb2H1j.js";import{F as H}from"./FormControl-DBf4pIdW.js";import{S as T}from"./Select-D27Lwf6S.js";import{c as V}from"./createSvgIcon-Cp1oITzz.js";import{M as s}from"./MenuItem-gZ6DnfD7.js";import{B as _}from"./Button-CzXiqLg_.js";const q=V(e.jsx("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"})),D=(t,o)=>l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:12,height:13,viewBox:"0 0 12 13",fill:"none",ref:o,...t},l.createElement("path",{d:"M1.2002 6.85162H3.497C3.497 7.82963 3.09981 8.71402 2.4614 9.35362C2.45901 9.356 2.45421 9.3608 2.45179 9.36322V10.3364C3.18859 10.2116 3.84859 9.85881 4.35379 9.35361C4.99457 8.71283 5.38939 7.82961 5.38939 6.85161L5.38943 2.66241H1.20022L1.2002 6.85162Z",fill:"currentColor"}),l.createElement("path",{d:"M6.61035 2.66242V6.85162H8.90715C8.90715 7.82963 8.50996 8.71402 7.87155 9.35362C7.86917 9.356 7.86436 9.3608 7.86194 9.36322V10.3364C8.59874 10.2116 9.25874 9.85881 9.76394 9.35361C10.4048 8.714 10.7995 7.83081 10.7995 6.85161V2.66241L6.61035 2.66242Z",fill:"currentColor"})),ie=l.forwardRef(D),O=async(t,o)=>{const i=t?t.replace("https://doi.org/",""):"",r=await fetch(`https://citation.doi.org/format?doi=${i}&style=${o}&lang=en-US`,{headers:{Accept:`text/x-${o}`}});if(!r.ok)throw new Error(`Failed to fetch citation: ${r.status}: ${r.statusText}`);return await r.text()},R=(t,o,i)=>F({queryKey:["citation",t,o],queryFn:()=>O(t,o),enabled:!!t&&!!o&&i}),$=(t,o,i)=>{const r=`${t.replace(/\s+/g,"_")}`,n=document.createElement("a");n.href=i,n.setAttribute("download",`${r}.${o}`),document.body.appendChild(n),n.click(),document.body.removeChild(n)},A={width:"100%",".MuiInputBase-root":{minHeight:"38px",borderRadius:0,"&:before, &:after":{borderBottom:"none !important"}},"& .MuiOutlinedInput-notchedOutline":{border:0},"&.MuiOutlinedInput-root.Mui-focused .MuiOutlinedInput-notchedOutline":{border:"none"},".MuiSelect-select":{display:"flex",alignItems:"center"},".MuiInputBase-input":{padding:"7px 10px"}},h=t=>{const{doi:o,title:i,boilerplateText:r,defaultCitationFormat:n,onClose:c,anchorEl:f,open:g,id:b}=t,[d,C]=l.useState(n||"bibtex"),{data:x,isLoading:v,error:u}=R(o||"",d,!0),y=a=>{if(!a)return;const j={apa:"ris",bibtex:"bib",ieee:"ris",nature:"ris",science:"ris"}[d]||"txt",M=new Blob([a],{type:"text/plain"}),S=URL.createObjectURL(M);$(i||"citation",j,S)},w=a=>{C(a.target.value)};return e.jsx(k,{"aria-label":"Citation options",role:"dialog",id:b,elevation:9,open:g,anchorEl:f,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{square:!0,sx:a=>({width:"500px",position:"relative",[a.breakpoints.down("sm")]:{maxWidth:"100%",maxHeight:"100%",top:"0 !important",left:"0 !important",bottom:"0 !important"}})}},children:e.jsxs(L,{sx:{gap:"20px",padding:"20px"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{sx:{fontSize:"20px",fontWeight:700,lineHeight:"normal"},children:"Cite As:"}),e.jsx(I,{sx:{cursor:"pointer",display:{xs:"block",sm:"none"},marginLeft:"auto",color:"#878E95"},onClick:()=>{c==null||c({},"escapeKeyDown")}})]}),u&&e.jsx(B,{severity:"error",sx:{my:2},icon:!1,children:u.message}),e.jsxs(m,{variant:"smallText1",sx:{lineHeight:"normal",maxHeight:"300px",overflowY:"scroll",wordWrap:"break-word"},children:[r&&e.jsxs(e.Fragment,{children:[r,e.jsx("br",{})]}),v?e.jsxs(p,{sx:{fontWeight:700},children:[e.jsx("br",{}),"Loading citation..."]}):x]}),e.jsxs(p,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:{xs:"10px",sm:"8px"},width:"100%",maxHeight:"38px"},children:[e.jsx(p,{sx:{flex:1},children:e.jsx(H,{sx:A,children:e.jsxs(T,{variant:"standard",sx:{svg:{color:"#878E95",width:"24px",height:"24px",right:"10px"}},value:d,onChange:w,IconComponent:q,children:[e.jsx(s,{value:"bibtex",children:"bibtex"}),e.jsx(s,{value:"apa",children:"apa"}),e.jsx(s,{value:"ieee",children:"ieee"}),e.jsx(s,{value:"nature",children:"nature"}),e.jsx(s,{value:"science",children:"science"})]})})}),e.jsx(_,{onClick:()=>y(x||""),variant:"contained",sx:{padding:"6px 16px",borderRadius:0},children:"Download Citation"}),e.jsx(E,{value:x||"",sx:{borderRadius:0,padding:"6px 16px",border:"1px solid",borderColor:"primary.main"}})]})]})})};try{h.displayName="CitationPopoverContent",h.__docgenInfo={description:"",displayName:"CitationPopoverContent",props:{doi:{defaultValue:null,description:"",name:"doi",required:!0,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},boilerplateText:{defaultValue:null,description:"",name:"boilerplateText",required:!1,type:{name:"string"}},defaultCitationFormat:{defaultValue:null,description:"",name:"defaultCitationFormat",required:!1,type:{name:"enum",value:[{value:'"bibtex"'},{value:'"apa"'},{value:'"ieee"'},{value:'"nature"'},{value:'"science"'}]}},selectSx:{defaultValue:null,description:"",name:"selectSx",required:!1,type:{name:"SxProps"}}}}}catch{}export{h as C,ie as F};
