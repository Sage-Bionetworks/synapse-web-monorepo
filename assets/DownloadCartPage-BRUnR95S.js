import{r as o,j as e,b$ as C,al as h,V as b,e8 as M,hf as ee,hg as ae,e4 as ie,B as N,dZ as G,Z as ne,J as V,cy as se,dH as q,dG as $,an as B,bV as te,c6 as le,ay as W,hh as oe,hi as re,c2 as ce,bX as de,dU as me,X as F,aa as ue}from"./iframe-CrIG5yS4.js";import{u as U,e as pe,f as Y,g as ge}from"./useDownloadList-wzV9jtxi.js";import{H as z}from"./HelpPopover-C0SNysP_.js";import{P as Z}from"./ProgrammaticInstructionsModal-B_7cTjhy.js";import{u as he,g as fe,S as xe,c as ye}from"./StyledTanStackTable-BZrZNHYt.js";import{F as we}from"./FileEntityDirectDownload-tDGd6K7P.js";import{I as je}from"./InteractiveCopyIdsIcon-BSH-rP1E.js";import"./SkeletonButton-C2iZcuLE.js";import"./SkeletonInlineBlock-DCJOzeCR.js";import{S as be}from"./SkeletonTable-CZxqZr7Y.js";import"./SkeletonParagraph-BI2gfc3a.js";import{T as k}from"./SynapseTableConstants-2qH3fDlQ.js";import{C as j}from"./ColumnHeader-nSAYtF_4.js";import{U as ve}from"./UserBadge-BoI25jFW.js";import{p as A}from"./pluralize-CC--1ngb.js";import{I as Ce}from"./InputAdornment-DX87peCP.js";import{u as Se,A as De}from"./ActionRequiredListItem-OWWsAOnu.js";import{L as Ne}from"./ActionRequiredCard-Cvk1BFpG.js";const K=`import synapseclient
syn = synapseclient.Synapse()
syn.login(authToken="YOUR_TOKEN_HERE")
`,Fe=`library(synapser)
synLogin(authToken="YOUR_TOKEN_HERE")
`;function T({entityId:n,version:i}){const[s,a]=o.useState(!1),c=`${Fe}
# Obtain a pointer and download the data
${n} <- synGet(entity='${n}'${i?`, version=${i}`:""} ) `,l=`${K}
# Obtain a pointer and download the data
${n} = syn.get(entity='${n}'${i?`, version=${i}`:""} )

# Get the path to the local copy of the data file
filepath = ${n}.path`,r=`synapse get ${n} ${i?`--version ${i}`:""}`;return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Programmatic download options",enterNextDelay:k,placement:"left",children:e.jsx("span",{children:e.jsx("button",{className:"btn-download-icon",onClick:()=>a(!0),children:e.jsx(h,{icon:"code"})})})}),s&&e.jsx(Z,{show:!0,onClose:()=>a(!1),title:"Download Programmatically",cliCode:r,rCode:c,pythonCode:l})]})}try{T.displayName="DirectProgrammaticDownload",T.__docgenInfo={description:"",displayName:"DirectProgrammaticDownload",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},version:{defaultValue:null,description:"",name:"version",required:!1,type:{name:"number"}}}}}catch{}function E(n){const{numFiles:i,numPackagableFiles:s,numBytes:a}=n,c=i-s,l=i===0,r=l?"SRC-inactive":"SRC-primary-text-color";return e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"start ",gap:"25px",fontWeight:"bold",svg:{mr:"5px"}},children:[e.jsx("span",{children:!l&&e.jsxs(e.Fragment,{children:[i.toLocaleString()," ",A("File",i)]})}),e.jsxs("span",{children:[e.jsx("span",{className:r,children:e.jsx(h,{wrap:!1,icon:"packagableFile"})}),!l&&e.jsxs(e.Fragment,{children:[s.toLocaleString()," ",A("File",s)," eligible for packaging"]})]}),a>0&&e.jsx(C,{title:"This is the total size of all files in the Download Cart that are available to download.",enterNextDelay:k,placement:"top",children:e.jsx("span",{className:"item",children:M(a)})}),c>0&&e.jsxs("span",{className:"item",children:[e.jsx("span",{className:"SRC-warning-color",children:e.jsx(h,{icon:"warningOutlined"})}),!l&&e.jsxs(e.Fragment,{children:[c.toLocaleString()," ",A("File",c)," ineligible for packaging"]})]})]})}try{E.displayName="DownloadDetails",E.__docgenInfo={description:"",displayName:"DownloadDetails",props:{numFiles:{defaultValue:null,description:"",name:"numFiles",required:!0,type:{name:"number"}},numPackagableFiles:{defaultValue:null,description:"",name:"numPackagableFiles",required:!0,type:{name:"number"}},numBytes:{defaultValue:null,description:"",name:"numBytes",required:!0,type:{name:"number"}}}}}catch{}function ke(){const{data:n}=U({throwOnError:!0});return n?e.jsx("div",{children:e.jsx(E,{numBytes:n.sumOfFileSizesAvailableForDownload,numPackagableFiles:n.numberOfFilesAvailableForDownloadAndEligibleForPackaging,numFiles:n.numberOfFilesAvailableForDownload})}):null}const Ie="TESTING_TRASH_BTN_CLASS";function _e(n,i){V(`${i} has been removed from your list.`,"success",{title:n})}function Pe(n){const{ctx:i}=n,{mutateAsync:s,isPending:a}=Y({onSuccess:()=>V(`${i.row.original.fileName} has been removed from your list.`,"success",{title:"File Removed"})});return e.jsx(C,{title:"Remove from Download Cart",placement:"left",enterNextDelay:k,children:e.jsx("span",{className:"removeItem",children:e.jsx("button",{className:Ie,onClick:()=>{s({batchToRemove:[{fileEntityId:i.row.original.fileEntityId,versionNumber:i.row.original.versionNumber}]})},children:a?e.jsx(G,{}):e.jsx(h,{icon:"removeCircle"})})})})}const x=ye(),Ae=n=>{const{onCopySynIds:i,removeItem:s}=n;return[x.accessor("isEligibleForPackaging",{header:()=>e.jsx(e.Fragment,{}),cell:a=>e.jsxs("div",{children:[a.getValue()&&e.jsx(C,{title:"Eligible for packaging",enterNextDelay:k,placement:"right",children:e.jsx("span",{className:"eligibileIcon",children:e.jsx(h,{wrap:!1,icon:"packagableFile"})})}),!a.getValue()&&e.jsx(C,{title:"This file is ineligible for Web packaging because it is >100MB, or it is an external link, or it is not stored on Synapse native storage",enterNextDelay:k,placement:"right",children:e.jsx("span",{className:"ineligibileIcon",children:e.jsx(h,{wrap:!1,icon:"warningOutlined"})})})]}),enableResizing:!1,enableColumnFilter:!1,size:50}),x.accessor("fileName",{header:a=>e.jsx(j,{...a,title:"Name"}),cell:a=>e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:`${se.PORTAL}Synapse:${a.row.original.fileEntityId}.${a.row.original.versionNumber}`,children:a.getValue()}),enableColumnFilter:!1,size:160}),x.accessor("fileSizeBytes",{header:a=>e.jsx(j,{...a,title:"Size"}),cell:a=>a.getValue()!=null?M(a.getValue()):e.jsx(e.Fragment,{}),enableColumnFilter:!1,size:100}),x.accessor("fileEntityId",{header:a=>e.jsx(j,{...a,title:"SynID",additionalButtons:e.jsx(je,{size:"small",onCopy:i})}),cell:a=>`${a.getValue()}.${a.row.original.versionNumber}`,enableColumnFilter:!1,size:100}),x.accessor("projectName",{header:a=>e.jsx(j,{...a,title:"Project"}),enableColumnFilter:!1}),x.accessor("addedOn",{header:a=>e.jsx(j,{...a,title:"Added On"}),cell:a=>q($(a.getValue())),enableColumnFilter:!1}),x.accessor("createdBy",{header:a=>e.jsx(j,{...a,title:"Created By"}),cell:a=>e.jsx(ve,{userId:a.getValue()}),enableColumnFilter:!1}),x.accessor("createdOn",{header:a=>e.jsx(j,{...a,title:"Created On"}),cell:a=>q($(a.getValue())),enableColumnFilter:!1}),x.display({id:"actions",header:a=>e.jsx(j,{...a,title:"Actions"}),cell:a=>e.jsxs("div",{className:"actionsContainer",children:[e.jsx("span",{className:"downloadItem",children:e.jsx(we,{entityId:a.row.original.fileEntityId,entityVersionNumber:a.row.original.versionNumber,displayFileName:!1,onClickCallback:c=>{c||s({fileEntityId:a.row.original.fileEntityId,versionNumber:a.row.original.versionNumber},a.row.original.fileName,"File Downloaded")}})}),e.jsx("span",{className:"programmaticAccessItem",children:e.jsx(T,{entityId:a.row.original.fileEntityId,version:a.row.original.versionNumber})}),e.jsx(Pe,{ctx:a})]}),enableResizing:!1,enableColumnFilter:!1,size:140,meta:{textAlign:"center"}})]};function Te(n){if(n.length===0)return;const i=n[0];let s="addedOn";return i.id==="fileName"?s="fileName":i.id==="fileSizeBytes"?s="fileSize":i.id==="fileEntityId"?s="synId":i.id==="projectName"?s="projectName":i.id==="addedOn"?s="addedOn":i.id==="createdBy"?s="createdBy":i.id==="createdOn"&&(s="createdOn"),{field:s,direction:i.desc?"DESC":"ASC"}}function Ee(){const n=ee(),[i,s]=o.useState(!1),[a,c]=o.useState([{desc:!0,id:"addedOn"}]),[l,r]=o.useState(void 0),{data:u,status:S,isFetchingNextPage:g,isLoading:D,hasNextPage:y,fetchNextPage:t,isError:p,error:m}=pe(Te(a),l);o.useEffect(()=>{p&&m&&n(m)},[p,m,n]);const{mutateAsync:f}=Y(),v=o.useCallback(async(d,P,I)=>{await f({batchToRemove:[d]}),_e(I,P)},[f]),w=o.useMemo(()=>(u==null?void 0:u.pages.flatMap(d=>d.page))??[],[u==null?void 0:u.pages]),X=o.useMemo(()=>Ae({removeItem:(...d)=>{v(...d)},onCopySynIds:()=>{s(!0)}}),[v]),J=he({data:w,columns:X,getCoreRowModel:fe(),manualSorting:!0,onSortingChange:c,state:{columnPinning:{right:["actions"]},sorting:a},columnResizeMode:"onChange",meta:{getRowClassNames(d){return d.original.isEligibleForPackaging?"":"ineligibleForPackaging"}}});o.useEffect(()=>{S==="success"&&!g&&y&&t&&i?t():!y&&i&&(()=>{const P=w.map(I=>`${I.fileEntityId}.${I.versionNumber}`).join(`
`);ne(P).then(()=>{V("Successfully copied to clipboard")}),s(!1)})()},[S,g,y,t,i,w]);const _=d=>d?d=="eligibleForPackaging"?"Only Eligible":"Only Ineligible":"All",Q=[void 0,"eligibleForPackaging","ineligibleForPackaging"];return e.jsxs("div",{children:[e.jsx(ae,{show:i}),e.jsxs(b,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:"center",py:"15px",rowGap:"15px"},children:[e.jsx(ke,{}),e.jsxs(b,{sx:{display:"flex",gap:"10px",alignItems:"inherit",justifyContent:"end"},children:[e.jsx(b,{sx:{fontWeight:"700",fontSize:"14px"},children:"Filter Files By"}),e.jsx(b,{sx:{button:{width:"144px"}},children:e.jsx(ie,{native:!0,fullWidth:!0,value:_(l),children:Q.map(d=>e.jsx("option",{onClick:()=>{r(d)},children:_(d)},`${_(d)}-filter-option`))})})]})]}),w.length>0&&e.jsxs("div",{className:"DownloadListTableV2",children:[e.jsx(xe,{table:J,fullWidth:!1}),y&&e.jsx(b,{sx:{display:"flex",justifyContent:"right"},children:e.jsx(N,{variant:"contained",sx:{my:2,ml:"auto"},onClick:()=>{t()},disabled:g,startIcon:g?e.jsx(G,{}):void 0,children:g?"Loading...":"Show More"})})]}),D&&e.jsx(be,{numCols:5,numRows:3})]})}function R(){const{accessToken:n}=B();return n?e.jsx(te,{children:e.jsx(Ee,{})}):e.jsx(e.Fragment,{})}try{R.displayName="AvailableForDownloadTable",R.__docgenInfo={description:"Table of the files added to the Download Cart that are currently available for download.",displayName:"AvailableForDownloadTable",props:{}}}catch{}const Re="Please provide a package file name and try again.",O=n=>{const{accessToken:i}=B(),[s,a]=o.useState(!1),[c,l]=o.useState(""),[r,u]=o.useState(),[S,g]=o.useState(void 0),{onPackageCreation:D}=n,y=async p=>{if(p.preventDefault(),!c){u({message:Re,variant:"danger"});return}a(!0);try{const m=`${c}.zip`,f=await oe(m,i);g(f);const{resultFileHandleId:v}=f;try{window.location.href=await re(v,i),l(""),g(void 0),D()}catch(w){console.error("Err on getFileHandleByIdURL = ",w)}}catch(m){u({message:m.reason,variant:"danger"})}finally{a(!1)}},t=p=>{l(p.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"CreatePackageV2",children:e.jsxs("div",{className:"createPackageStep",children:[e.jsx("span",{className:"createPackageTitle",children:"Create your Download Package"}),e.jsx("span",{className:"createPackageDescription",children:"Name your download package and select Download Package to get started."}),!s&&!S&&e.jsxs(b,{sx:{display:"flex",alignItems:"stretch"},children:[e.jsx(le,{onChange:t,type:"text",placeholder:"PackageName",sx:{width:"233px"},slotProps:{input:{endAdornment:e.jsx(Ce,{position:"end",children:".zip"})}}}),e.jsx(N,{variant:"contained",color:"primary",onClick:p=>{y(p)},sx:{marginLeft:"20px"},disabled:!c,children:"Download Package"})]}),s&&e.jsxs("div",{className:"creatingPackage",children:[e.jsx("span",{className:"spinner"}),e.jsx("span",{style:{marginLeft:5},children:"Creating package..."})]})]})}),e.jsx(W,{show:!!r,variant:r!=null&&r.variant?r.variant:"success",description:r==null?void 0:r.message,autoCloseAfterDelayInSeconds:10,onClose:()=>{u(void 0)}})]})};try{O.displayName="CreatePackageV2",O.__docgenInfo={description:"",displayName:"CreatePackageV2",props:{onPackageCreation:{defaultValue:null,description:"",name:"onPackageCreation",required:!0,type:{name:"() => void"}}}}}catch{}function L(n){const{onViewSharingSettingsClicked:i}=n,{data:s,isLoading:a}=ge({throwOnError:!0}),c=Se(s);return e.jsx(e.Fragment,{children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:3,pt:5},children:[c.map((l,r)=>l?e.jsx(De,{action:l.action,count:l.count,onViewSharingSettingsClicked:i},r):!1),a&&ce(3).map(l=>e.jsx(Ne,{},l))]})})}try{L.displayName="DownloadListActionsRequired",L.__docgenInfo={description:"",displayName:"DownloadListActionsRequired",props:{onViewSharingSettingsClicked:{defaultValue:null,description:'Invoked when a user clicks "View Sharing Settings" for a set of files that require the Download permission',name:"onViewSharingSettingsClicked",required:!1,type:{name:"(benefactorId: string) => void"}}}}}catch{}const Oe=`${K}
dl_list_file_entities = syn.get_download_list()`,Le="synapse get-download-list";function H(n){const{accessToken:i}=B(),[s,a]=o.useState(0),[c,l]=o.useState(!1),[r,u]=o.useState(!1),[S,g]=o.useState(!1),[D,y]=o.useState(),{data:t,isLoading:p,isError:m,error:f,refetch:v}=U();if(o.useEffect(()=>{m&&f&&y(f)},[m,f]),o.useEffect(()=>{t&&t.numberOfFilesRequiringAction==0&&a(1)},[t]),D)return e.jsx(de,{error:D});const w=async()=>{await ue.clearDownloadListV2(i),v()};return e.jsxs("div",{className:"DownloadCartPage",children:[e.jsx("div",{children:e.jsxs("div",{className:"pageHeader",children:[e.jsxs("div",{className:"grid",children:[e.jsx("h3",{className:"pageHeaderTitle",children:"Your Download Cart"}),e.jsx(C,{title:"Immediately removes all items from your download cart",enterNextDelay:300,placement:"right",children:e.jsx(N,{onClick:()=>{w()},variant:"text",color:"primary",startIcon:e.jsx(me,{}),children:"Clear Your Download Cart"})})]}),e.jsx(F,{className:"description",variant:"body1",sx:{display:{xs:"none",md:"block"}},children:"Your added files can be found in the tabs below. Files requiring actions before download are listed in the Access Actions Required tab, while those ready for download can be found in the Download List tab."})]})}),e.jsx("div",{className:"tabs-container",children:e.jsx("div",{className:"container",children:e.jsxs("ul",{className:"nav nav-tabs",children:[e.jsx("li",{className:`nav-item ${s==0?"active":""}`,"aria-selected":s==0,children:e.jsxs("button",{onClick:()=>a(0),children:["Access Actions Required",!m&&!p&&t&&e.jsx("span",{className:"fileCount",children:t.totalNumberOfFiles-t.numberOfFilesAvailableForDownload})]})}),e.jsx("li",{className:`nav-item ${s==1?"active":""}`,"aria-selected":s==1,children:e.jsxs("button",{onClick:()=>a(1),children:["Download List",!m&&!p&&t&&e.jsx("span",{className:"fileCount",children:t.numberOfFilesAvailableForDownload})]})})]})})}),e.jsxs("div",{style:{display:s==0&&!m&&!p&&t?"block":"none"},children:[(t==null?void 0:t.numberOfFilesRequiringAction)&&t.numberOfFilesRequiringAction>0&&e.jsx("div",{children:e.jsx("div",{className:"actionsRequiredContainer container",children:e.jsx(L,{...n})})}),(t==null?void 0:t.numberOfFilesRequiringAction)===0&&e.jsx("div",{className:"placeholder",children:e.jsx("div",{children:"No actions are currently required."})})]}),s==1&&!m&&!p&&t&&e.jsxs("div",{children:[t.numberOfFilesAvailableForDownload>0&&e.jsxs("div",{className:"DownloadListTabContent",children:[e.jsx("div",{className:"subSectionOverviewContainer",children:e.jsxs("div",{className:"subSectionOverview container",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"headlineWithHelp",children:[e.jsxs(F,{variant:"headline3",sx:{mb:2},children:[e.jsx(h,{icon:"packagableFile"})," Web Download (.ZIP Packages)"]}),e.jsx(z,{markdownText:"This will allow you to create a .zip file that contains eligible files. Files greater that 100 MB, external links, or files which are not stored on Synapse native storage are ineligible. In most cases, ineligible files can be downloaded individually. External links will require navigation to an external site, which may require a separate login process.",helpUrl:"https://help.synapse.org/docs/Downloading-Data-From-the-Synapse-UI.2004254837.html"})]}),e.jsx(F,{variant:"body1",component:"div",sx:{mb:2,display:{xs:"none",md:"block"}},children:e.jsxs("ul",{children:[e.jsx("li",{children:"Eligible files will be added to .ZIP packages of up to 1GB in size"}),e.jsx("li",{children:"If you have more than 1GB, you can create multiple packages"}),e.jsx("li",{children:"Will only include files which are hosted on Synapse native storage"}),e.jsx("li",{children:"Packages include a CSV manifest that contains file annotations and other information for each file"})]})}),t.numberOfFilesAvailableForDownloadAndEligibleForPackaging>0&&e.jsx(N,{variant:"contained",onClick:()=>{l(!0)},startIcon:e.jsx(h,{icon:"download",wrap:!1}),children:"Download As .Zip Packages"}),t.numberOfFilesAvailableForDownloadAndEligibleForPackaging==0&&e.jsx(C,{title:"You cannot create a .zip package because there are no eligible files.",enterNextDelay:300,placement:"top",children:e.jsx("span",{children:e.jsx(N,{variant:"contained",disabled:!0,startIcon:e.jsx(h,{icon:"download",wrap:!1}),children:"Download As .Zip Packages"})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"headlineWithHelp",children:[e.jsxs(F,{variant:"headline3",sx:{mb:2},children:[e.jsx(h,{icon:"code"})," Programmatic Download"]}),e.jsx(z,{markdownText:"This will provide syntax which you can enter into your programmatic client. It is suitable for large files (>100 MB), for packages > 1GB, and for files which arenâ€™t stored on Synapse native storage (e.g. in a special AWS S3 or Google Cloud bucket).  External links will require navigation to an external site, which may require a separate login process.",helpUrl:"https://help.synapse.org/docs/Downloading-Data-Programmatically.2003796248.html"})]}),e.jsx(F,{variant:"body1",component:"div",sx:{mb:2,display:{xs:"none",md:"block"}},children:e.jsxs("ul",{children:[e.jsx("li",{children:"Requires installation of a programmatic client (R, Python, CLI)"}),e.jsx("li",{children:"No limit to the file size or the size of the package that can be downloaded"}),e.jsx("li",{children:"Will include files which are hosted on and off Synapse native storage"}),e.jsx("li",{children:"Packages include a CSV manifest that contains file annotations and other information for each file"})]})}),e.jsx(N,{variant:"contained",onClick:()=>{u(!0)},startIcon:e.jsx(h,{icon:"code",wrap:!1}),children:"Create Programmatic Package"})]})]})}),e.jsxs("div",{className:"availableForDownloadTableContainer container",children:[c&&e.jsx(O,{onPackageCreation:()=>{g(!0),v()}}),e.jsx(R,{})]})]}),t.numberOfFilesAvailableForDownload===0&&e.jsx("div",{className:"placeholder",children:e.jsx("div",{children:"Your Download Cart is currently empty."})})]}),e.jsx(W,{show:S,variant:"success",title:"Package Created",description:"A package has been created with eligible files. The items contained in this .zip file have been removed from your list. If your package is over 1GB, you will need to create multiple packages.",autoCloseAfterDelayInSeconds:10,onClose:()=>{g(!1)}}),r&&e.jsx(Z,{show:!0,onClose:()=>u(!1),title:"Download Programmatically",pythonCode:Oe,cliCode:Le})]})}try{H.displayName="DownloadCartPage",H.__docgenInfo={description:"Show the Download Cart page.",displayName:"DownloadCartPage",props:{onViewSharingSettingsClicked:{defaultValue:null,description:'Invoked when a user clicks "View Sharing Settings" for a set of files that require the Download permission',name:"onViewSharingSettingsClicked",required:!1,type:{name:"(benefactorId: string) => void"}}}}}catch{}export{H as D,K as P,Fe as R};
