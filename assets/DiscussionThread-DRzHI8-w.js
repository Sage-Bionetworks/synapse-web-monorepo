import{j as e}from"./jsx-runtime-Du8NFWEI.js";import{O as A,q as k}from"./VerificationSubmission-DL9jxYsQ.js";import{u as F,A as te}from"./useEntity--O3QjCXV.js";import{d as O}from"./dayjs.min-d18Up55D.js";import{r as n}from"./index-Dl6G-zuu.js";import{q as Y}from"./useFiles-DgS9yAar.js";import"./StringUtils-By8SXO8c.js";import{S as se}from"./SynapseConstants-ByimdbyM.js";import"./OrientationBanner-D9CLn5zV.js";import{u as ne,a as ie,F as j,b as re}from"./ForumThreadEditor-CnIj-5gk.js";import{u as ae,a as le,b as de}from"./useThread-Dp49Pofh.js";import{a as ce}from"./useSubscription-BKpJLMzV.js";import{f as G}from"./DateFormatter-zUiwJ_5Z.js";import{M as q,C as ue}from"./ConfirmationDialog-DRN0Y6d0.js";import{I as i}from"./IconSvg-KrLXYQAC.js";import{W as R}from"./WarningDialog-ReCmuZ6V.js";import{d as y}from"./ToastMessage-B9KBAHGM.js";import{U as W}from"./UserBadge-hwvv3EJa.js";import{S as me}from"./SkeletonTable-DaoaRpY-.js";import{S as pe}from"./SubscribersModal-DuhrRh_Y.js";import{B as D}from"./Button-DtfaTZY_.js";import{T as he}from"./Typography-DrqHmlDD.js";import{B as v}from"./Box-CaFleW7-.js";import{T as E}from"./TextField-CrNNFkUB.js";const fe=()=>alert("This functionality has not been implemented yet");function _(d){const{reply:t,onClickLink:C=fe}=d,[c,u]=n.useState(!1),[b,r]=n.useState(!1),{data:m}=Y(),{data:a}=F(t.projectId),{data:p,isLoading:x}=ne(t),{mutate:g}=ie({onSuccess:()=>{r(!1),y("A reply has been deleted.","info")}}),h=t.createdBy==(m==null?void 0:m.ownerId);return e.jsx("div",{className:"reply-container",children:x?e.jsx(me,{numCols:1,numRows:4}):e.jsx(e.Fragment,{children:p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(W,{userId:t.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{className:"message-body",children:[e.jsx(q,{markdown:p,objectType:A.REPLY}),e.jsxs("span",{children:["posted ",G(O(t.createdOn),"M/D/YYYY")]}),e.jsxs("div",{style:{float:"right"},children:[e.jsx("button",{onClick:()=>C(),children:e.jsx(i,{icon:"link"})}),h&&e.jsx("button",{onClick:()=>u(!0),children:e.jsx(i,{icon:"edit"})}),(a==null?void 0:a.permissions.canModerate)&&e.jsx("button",{onClick:()=>r(!0),children:e.jsx(i,{icon:"delete"})})]})]})]}),e.jsx(j,{isReply:!0,initialText:p,onClose:()=>u(!1),id:t.id,isDialog:!0,openDialog:c}),e.jsx(R,{open:b,title:"Confirm Deletion",content:"Are you sure you want to delete this reply?",onCancel:()=>{r(!1)},onConfirm:()=>g({forumId:t.forumId,threadId:t.threadId,replyId:t.id}),confirmButtonColor:"error",confirmButtonText:"Delete"})]})})})}try{_.displayName="DiscussionReply",_.__docgenInfo={description:"",displayName:"DiscussionReply",props:{reply:{defaultValue:null,description:"",name:"reply",required:!0,type:{name:"DiscussionReplyBundle"}},onClickLink:{defaultValue:null,description:"",name:"onClickLink",required:!1,type:{name:"(() => void)"}}}}}catch{}const xe="You are following this topic. Click to stop following.",je="You are not following this topic. Click to follow.",ye="You will need to sign in for access to that resource",B="Write a reply...";function L(d){const{threadId:t,limit:C}=d,[c,u]=n.useState(!0),[b,r]=n.useState(!1),[m,a]=n.useState(!1),[p,x]=n.useState(!1),[g,h]=n.useState(!1),[H,f]=n.useState(!1),[P,S]=n.useState(!1),[U,V]=n.useState(!1),{threadData:o,threadBody:T,togglePin:X}=ae(t),{data:s}=Y(),{data:w}=F((o==null?void 0:o.projectId)??"",void 0,te,{enabled:!!o}),{subscription:M,toggleSubscribed:z,isLoading:K}=ce(t,k.THREAD),{mutate:J}=le({onSuccess:()=>{h(!1),y("A thread has been deleted.","info")}}),{mutate:Q}=de({onSuccess:()=>{S(!1),y("A thread has been restored.","info")}}),Z=(o==null?void 0:o.createdBy)==(s==null?void 0:s.ownerId);function $(){if((s==null?void 0:s.userName)=="anonymous")f(!0);else try{z()}catch(l){y(l.reason,"danger")}}const{data:I,hasNextPage:ee,fetchNextPage:oe}=re(t,c,C),N=(I==null?void 0:I.pages.flatMap(l=>l.results))??[];return e.jsxs("div",{className:"DiscussionThread",children:[o&&T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(D,{variant:c?"contained":"outlined",onClick:()=>u(!0),children:"Date Posted"}),e.jsx(D,{variant:c?"outlined":"contained",onClick:()=>u(!1),children:"Most Recent"})]}),e.jsx(W,{userId:o.createdBy,withAvatar:!0,avatarSize:"MEDIUM",showCardOnHover:!0}),e.jsxs("div",{children:[e.jsx(he,{style:{marginTop:"4px"},variant:"headline2",children:o.title}),e.jsx(pe,{id:t,objectType:k.THREAD,showModal:U,handleModal:V})]}),e.jsx("div",{children:e.jsx(q,{markdown:T,objectType:A.THREAD})}),e.jsxs("span",{children:["posted ",G(O(o.createdOn),"M/D/YYYY")]}),e.jsx(j,{isReply:!1,initialText:T,onClose:()=>r(!1),initialTitle:o==null?void 0:o.title,id:t,isDialog:!0,openDialog:b})]}):e.jsx(e.Fragment,{}),e.jsx("div",{className:"control-container",children:o!=null&&o.isDeleted?e.jsx("button",{onClick:()=>S(!0),children:e.jsx(i,{icon:"restore",label:"Restore deleted thread"})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx("button",{className:"follow-button","aria-label":M?"Unfollow thread":"Follow thread",disabled:K,onClick:()=>$(),children:M?e.jsx(i,{icon:"visibility",label:xe}):e.jsx(i,{icon:"visibilityOff",label:je})})}),Z&&e.jsx("button",{onClick:()=>r(!0),children:e.jsx(i,{icon:"edit",label:"Edit thread"})}),w!=null&&w.permissions.canModerate?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(!0),children:e.jsx(i,{icon:"delete",label:"Delete thread"})}),e.jsx("button",{onClick:()=>X(),children:o!=null&&o.isPinned?e.jsx(i,{icon:"pushpin",sx:{color:"error.main"},label:"Unpin thread"}):e.jsx(i,{icon:"pushpin",label:"Pin thread"})})]}):null]})}),e.jsx(v,{sx:{mt:2,mb:3},children:m?e.jsx(j,{id:t,isReply:!0,onClose:()=>a(!1),isDialog:!1}):e.jsx(E,{fullWidth:!0,placeholder:B,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):a(!0)}})}),e.jsx("div",{children:N.map(l=>e.jsx(_,{reply:l},l.id))}),N.length>0&&e.jsx(v,{sx:{mt:2,mb:3},children:p?e.jsx(j,{id:t,isReply:!0,onClose:()=>x(!1),isDialog:!1}):e.jsx(E,{fullWidth:!0,placeholder:B,onClick:()=>{(s==null?void 0:s.userName)=="anonymous"?f(!0):x(!0)}})}),ee?e.jsx(D,{variant:"outlined",onClick:()=>{oe()},children:"Show more results"}):e.jsx(e.Fragment,{}),e.jsx(R,{open:g,title:"Confirm Deletion",content:"Are you sure you want to delete this thread?",onCancel:()=>h(!1),onConfirm:()=>o&&J(o),confirmButtonColor:"error",confirmButtonText:"Delete"}),e.jsx(R,{open:P,title:"Confirm Restoration",content:"Are you sure you want to restore this thread?",onCancel:()=>S(!1),onConfirm:()=>o&&Q(o),confirmButtonColor:"info",confirmButtonText:"Restore"}),e.jsx(ue,{open:H,title:"Sign In Required",content:ye,onCancel:()=>f(!1),hasCancelButton:!1,onConfirm:()=>f(!1),confirmButtonProps:{children:"Sign In",className:se}})]})}try{L.displayName="DiscussionThread",L.__docgenInfo={description:"",displayName:"DiscussionThread",props:{threadId:{defaultValue:null,description:"",name:"threadId",required:!0,type:{name:"string"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}}}}}catch{}export{L as D};
