import{ce as b,cf as V,as as k,r as i,cg as x,ch as A,ci as F,cj as H,ck as L,cl as C,cm as D,cn as G,aB as M,co as O,j as w,c0 as P}from"./iframe-SFoYirDz.js";import{u as Y}from"./useDebouncedEffect-CSXLwZhB.js";import{u as j}from"./use-deep-compare-effect.esm-CucFAbzx.js";import{u as q}from"./uniq-BBRbUiEP.js";import{w as B}from"./without-5Jyro_ef.js";import{a as K}from"./UserBadge-DEHXVbtz.js";import{u as J,S as $,c as v}from"./Select-aab027f3.esm-hNKGDf6H.js";import{U as _}from"./UserOrTeamBadge-QF8a2JC_.js";var Q=Math.ceil,W=Math.max;function X(n,e,t){e===void 0?e=1:e=W(b(e),0);var l=n==null?0:n.length;if(!l||e<1)return[];for(var r=0,a=0,o=Array(Q(l/e));r<l;)o[a++]=V(n,r,r+=e);return o}const Z={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},z={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},ee={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},ne=async(n,e)=>{const t=await C(n,e),r=n.filter(a=>t.results.map(o=>o.id).indexOf(a.targetId)===-1).map(a=>({...z,id:a.targetId,name:`${a.targetId}`}));return[...t.results,...r]},te=async n=>{const e=(await D(n)).children,l=n.filter(r=>e.map(a=>a.ownerId).indexOf(r)===-1).map(r=>({...Z,ownerId:r,name:`Unknown User (${r})`}));return[...e,...l]},ae=async(n,e)=>{const t=await L({evaluationIds:n},e),r=n.filter(a=>t.results.map(o=>o.id).indexOf(a)===-1).map(a=>({...ee,id:a,name:a}));return[...t.results,...r]};function re(n){const{ids:e,type:t}=n,{accessToken:l}=k(),[r,a]=i.useState([]),o=t==="USER_PROFILE"?"ownerId":"id",g=(u=>{switch(u){case"USER_PROFILE":return H;case"ENTITY_HEADER":return F;case"EVALUATION_QUEUE":return A;default:return""}})(t),y=r.map(u=>u[o]),p=e.filter(u=>u!==x),h=q(B(p,...y));return i.useEffect(()=>{(S=>{if(!S.length)return;const d=sessionStorage.getItem(g);try{const m=d?JSON.parse(d):[],I=m.map(c=>c[o]);for(const c of S)I.includes(c[o])||m.push(c);sessionStorage.setItem(g,JSON.stringify(m))}catch{sessionStorage.setItem(g,JSON.stringify(S))}})(r)},[r,o,g]),j(()=>{let u=!1;return(async()=>{if(h.length>0)try{const d=Array.from(h),m=t==="ENTITY_HEADER"?d.map(f=>({targetId:f})):d,I=X(m,45),c=[];for(const f of I){let E=[];switch(t){case"USER_PROFILE":E=await te(f);break;case"ENTITY_HEADER":E=await ne(f,l);break;case"EVALUATION_QUEUE":E=await ae(f,l);break}c.push(...E)}u||a(f=>f.concat(...c))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{u=!0}},[l,t,h]),r}var se=i.forwardRef(function(n,e){var t=J(n);return i.createElement($,G({ref:e},t))}),oe=se;const le={SingleValue:n=>{const{data:e}=n;return i.createElement(v.SingleValue,{...n,key:e==null?void 0:e.id},w.jsx(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:n=>{const{data:e}=n;return i.createElement(v.Option,{...n,key:e==null?void 0:e.id},w.jsx(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}};function T(n){const{inputId:e,defaultValue:t=null,onChange:l,filterPredicate:r,typeFilter:a,placeholder:o,focusOnSelect:U=!1,value:g}=n,{palette:y}=M(),[p,h]=i.useState(""),[u,S]=i.useState("");Y(()=>{S(p)},[p],500);const[d=void 0]=re({ids:t?[t]:[],type:"USER_PROFILE"}),m=!!u,{data:I,isLoading:c}=K(u,a,{enabled:m}),f=i.useRef(null);i.useEffect(()=>{U&&f.current&&f.current.focus()});const E=i.useMemo(()=>c||p!==u?()=>"Loadingâ€¦":void 0,[c,u,p]),N=(I??[]).filter(r??(()=>!0)).map(s=>({id:s.ownerId.toString(),value:s.ownerId.toString(),label:s.userName,header:s})),R=i.useMemo(()=>o!==void 0?o:a==O.USERS_ONLY?"Name (first and last)":a==O.TEAMS_ONLY?"Team name":"Name (first and last) or team name",[o,a]);return t&&d==null?w.jsx(P,{width:"100%"}):w.jsx(oe,{className:"UserSearchBoxV2",ref:f,inputValue:p,onInputChange:h,filterOption:()=>!0,isLoading:c,options:!c&&N||[],noOptionsMessage:E,openMenuOnClick:!1,placeholder:R,defaultValue:t?{id:t,value:t,label:d.userName,header:d}:void 0,inputId:e,isClearable:!0,value:g,styles:{control:s=>({...s,backgroundColor:y.grey[200]}),input:s=>({...s,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:s=>({...s,zIndex:2})},components:le,onChange:s=>{l&&l((s==null?void 0:s.id)??null,(s==null?void 0:s.header)??null)}})}try{T.displayName="UserSearchBoxV2",T.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"(principalId: string, header: UserGroupHeader) => void"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"(item: UserGroupHeader) => boolean"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<{ id: string; value: string; label: string; header: UserGroupHeader; }>"}}}}}catch{}export{oe as S,T as U,X as c,re as u};
